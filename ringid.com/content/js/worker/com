/*! @copywrite Ringid.com  2016-11-14 */
Array.prototype.joinAsDataView=function(){var e,t,n=this,o=0,r=0;if(!n.length)return new DataView(new ArrayBuffer(0));for(var s=0;s<n.length;s++)n[s]instanceof DataView&&(r+=n[s].byteLength);if(!r)return new DataView(new ArrayBuffer(0));e=new ArrayBuffer(r),t=new DataView(e);for(var s=0;s<n.length;s++)if(n[s]instanceof DataView)for(var a=0;a<n[s].byteLength;a++)t.setUint8(o++,n[s].getUint8(a));return t},String.prototype.repeat||(String.prototype.repeat=function(e){return Array(e+1).join(this)}),DataView.prototype.copy=function(e,t){var n=this;e=e||0,t=t||n.byteLength;for(var o=new ArrayBuffer(t),r=new DataView(o),s=0;s<t;s++)r.setUint8(s,n.getUint8(e++));return r},DataView.prototype.getString=function(e,t){var n="";e=e||0,t=t||this.byteLength-e,t<0&&(t+=this.byteLength);for(var o=e;o<e+t;o++)n+=String.fromCharCode(this.getUint8(o));return decodeURIComponent(escape(n))},DataView.prototype.getIntByByte=function(e,t){var n=this;switch(t){case 1:return n.getUint8(e);case 2:return n.getUint16(e);case 4:return n.getUint32(e);case 6:case 8:var o,r,s="";for(o=e;o<e+t;o++)r=n.getUint8(o).toString(2),s+=r.length<8?"0".repeat(8-r.length)+r:r;return parseInt(s,2);default:return n.getUint8(e)}},DataView.prototype.addAttributeInt=function(e,t,n,o){switch(this.setUint8(e++,t),this.setUint8(e++,n),n){case 1:this.setUint8(e++,o);break;case 2:this.setUint16(e,o),e+=2;break;case 4:this.setUint32(e,o),e+=4}return e},DataView.prototype.addAttributeString=function(e,t,n){this.setUint8(e++,t),this.setUint8(e++,n.length);for(var o=0;o<n.length;o++)this.setUint8(e++,n.charCodeAt(o));return e},DataView.prototype.addAttributeData=function(e,t,n,o,r){o=o||0,r=r||n.byteLength,this.setUint8(e++,t),this.setUint16(e,r),e+=2;for(var s=0;s<r;s++)this.setUint8(e++,n.getUint8(o++));return e},DataView.prototype.getBool=function(e){return 1===this.getUint8(e)},DataView.prototype.print_r=function(e,t,n){t=t||0,n=n||this.byteLength;for(var o,r,s="Index\t\tBinary\t\tInteger\t\tChar\n",a="",i=t;i<n;i++)r=this.getUint8(i),o=String.fromCharCode(r),s+=i+"\t\t \t\t"+r.toString(2)+"\t\t\t\t"+r+"\t\t\t\t"+o+"\n",a+=o;if(!e||"string"==typeof e)return a};function isObject(e){return null!==e&&"object"==typeof e}function isDate(e){return"[object Date]"===toString.call(e)}function isRegExp(e){return"[object RegExp]"===toString.call(e)}function isFunction(e){return"function"==typeof e}function isElement(e){return!(!e||!e.nodeName)}function isString(e){return"string"==typeof e}var objectFreeze=Object.freeze?Object.freeze:noop;function baseExtend(e,t,n){for(var o=0,r=t.length;o<r;++o){var s=t[o];if(isObject(s)||isFunction(s))for(var a=Object.keys(s),i=0,c=a.length;i<c;i++){var E=a[i],g=s[E];n&&isObject(g)?isDate(g)?e[E]=new Date(g.valueOf()):isRegExp(g)?e[E]=new RegExp(g):g.nodeName?e[E]=g.cloneNode(!0):(isObject(e[E])||(e[E]=Array.isArray(g)?[]:{}),baseExtend(e[E],[g],!0)):e[E]=g}}return e}function object_extend(e){return baseExtend(e,Array.prototype.slice.call(arguments,1))}function getUniqueId(e){return e||(e=""),e+""+Math.floor(Math.random()*(new Date).getTime())}!function(e){function t(e,t){var n=t&&t.protocols;t&&(n=t),this.protocols=n||"Sec-WebSocket-Protocol",this.url=e||"Missing URL",this.ssl=/(wss)/i.test(this.url),this._pause=!1,this._reconnectAttempts=0,this.initialTimeout=500,this.maxTimeout=3e5,this.sendQueue=[],this.forceQueue=[],this.onOpenCallbacks=[],this.onMessageCallbacks=[],this.onErrorCallbacks=[],this.onCloseCallbacks=[],this._connect(),this.reconnectRequested=!1}t.prototype._normalCloseCode=1e3,t.prototype._reconnectableStatusCodes=[4e3],t.prototype._readyStateConstants={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,RECONNECT_ABORTED:4},t.prototype._connect=function(e){!e&&this.socket&&this.isOpen()||this.isConnecting()||(this.isOpen()&&this.close(),this.protocols?this.socket=new WebSocket(this.url,this.protocols):this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.socket.onopen=this._onOpenHandler.bind(this),this.socket.onmessage=this._onMessageHandler.bind(this),this.socket.onerror=this._onErrorHandler.bind(this),this.socket.onclose=this._onCloseHandler.bind(this),this.socket._emit=this.socket.emit,this.socket.emit=function(){try{this.socket._emit.apply(this.socket,arguments)}catch(e){}})},t.prototype.fireQueue=function(){if(!this.isOpen())return void(this.isConnecting()||this.reconnect());if(!this._pause)for(;this.sendQueue.length;){var e=this.sendQueue.shift();e=new Uint8Array(e.buffer),this.socket.send(e)}},t.prototype.fireForceQueue=function(){if(!this.isOpen())return void(this.isConnecting()||this.reconnect());for(;this.forceQueue.length;){var e=this.forceQueue.shift();e=new Uint8Array(e.buffer),this.socket.send(e)}},t.prototype.notifyOpenCallbacks=function(e){for(var t=0;t<this.onOpenCallbacks.length;t++)this.onOpenCallbacks[t].call(this,e)},t.prototype.notifyCloseCallbacks=function(e){for(var t=0;t<this.onCloseCallbacks.length;t++)this.onCloseCallbacks[t].call(this,e)},t.prototype.notifyErrorCallbacks=function(e){for(var t=0;t<this.onErrorCallbacks.length;t++)this.onErrorCallbacks[t].call(this,e)},t.prototype.onOpen=function(e){return this.onOpenCallbacks.push(e),this},t.prototype.onClose=function(e){return this.onCloseCallbacks.push(e),this},t.prototype.onError=function(e){return this.onErrorCallbacks.push(e),this},t.prototype.isOpen=function(){return this.socket&&this.socket.readyState===this._readyStateConstants.OPEN},t.prototype.isConnecting=function(){return this.socket&&this.socket.readyState===this._readyStateConstants.CONNECTING},t.prototype.pause=function(e){return this._pause=e,this.fireQueue(),this._pause},t.prototype.onMessage=function(e){if(!isFunction(e))throw new Error("Callback must be a function");return this.onMessageCallbacks.push(e),this},t.prototype._onOpenHandler=function(e){this._reconnectAttempts=0,this.reconnectRequested=!1,this.notifyOpenCallbacks(e),this.fireQueue(),this.fireForceQueue(),Logger.log(e.timeStamp,"CONNECTION_OPEN")},t.prototype._onCloseHandler=function(e){this.notifyCloseCallbacks(e),this.reconnectRequested=!1,Logger.log(e.code,"CONNECTION_CLOSE")},t.prototype._onMessageHandler=function(e){for(var t=this,n=0;n<t.onMessageCallbacks.length;n++)currentCallback=t.onMessageCallbacks[n],currentCallback.call(t,e.data)},t.prototype._onErrorHandler=function(e){this.notifyErrorCallbacks(e),this.reconnectRequested=!1},t.prototype.send=function(e,t){var n=this;return t?void(n.isOpen()?n.socket.send(new Uint8Array(e.buffer)):(n.isConnecting()||n.reconnect(),n.forceQueue.push(e))):(n.sendQueue.push(e),n.fireQueue(),n)},t.prototype.close=function(e){return e||!this.socket.bufferedAmount?this.socket.close():Logger.log("bufferedAmount remains can't close now"),this},t.prototype.reconnect=function(){if(!this.reconnectRequested){var e=this._getBackoffDelay(++this._reconnectAttempts),t=e/1e3;Logger.log("Reconnecting in "+t+" seconds"),setTimeout(this._connect.bind(this),e),this.reconnectRequested=!0}return this},t.prototype._getBackoffDelay=function(e){var t=Math.random()+1,n=this.initialTimeout,o=2,r=e,s=this.maxTimeout;return Math.floor(Math.min(t*n*Math.pow(o,r),s))};function n(e,n){var o=/wss?:\/\//.exec(e);if(!o)throw new Error("Invalid url provided");return n?new t(e,n):new t(e)}e.SocketProvider=n}(self);function buildPacketAndSend(e){var t,n=e.data||{};return n.pckId=e.packetId,settings.aSkey&&(n.sId=settings.aSkey),n.tbid=settings.tabId,n.dvc=settings.device,Logger.log(n,"PACKET_DATA"),n=JSON.stringify(n),n.length+2>settings.CLIENT_DATA_SIZE&&25!==e.data.actn&&3!==e.port?(t=changeMessageToByte(n,1,e.port),sendBrokenPacket(t,e.action,e.port,e.packetId)):(t=changeMessageToByte(n,0,e.port),void sendData(t,e.action,e.packetId,3==e.port,e.flooding))}function sendData(e,t,n,o,r){return floodingRequest[t]||(floodingRequest[t]=[]),!r&&floodingRequest[t].length?void Logger.log("already sending a same action request",t,n,"FLOODING_ERROR"):(floodingData[n]={action:t,data:e,force:!!o,ack:!1,responded:!1,scount:0,lrt:0,frt:0,ttl:10},floodingRequest[t].push(n),void(floodingDataInterval||(floodingDataInterval=setTimeout(processSafeModeSender,300))))}function deleteExpiredPacket(){var e=Object.keys(floodingRequest),t=[];e.forEach(function(e){var n={};floodingRequest[e].forEach(function(t){floodingData[t]?floodingData[t].ttl--:(delete floodingData[t],n[t]=!0,responseFalse(e,t))});var o=[];floodingRequest[e].forEach(function(r){try{floodingData[r].ttl||t.push(e)}catch(s){}n[r]||o.push(r)}),floodingRequest[e]=o}),t.forEach(function(e){delete floodingRequest[e]})}function processSafeModeSender(){var e,t=!1;if(ProccessRunning=!0,!connection.isOpen()&&!connection.isConnecting())return deleteExpiredPacket(),connection.reconnect(),setTimeout(processSafeModeSender,1500),void(ProccessRunning=!1);for(e in floodingRequest)floodingRequest.hasOwnProperty(e)&&floodingRequest[e].length&&(sendCurrentActionRequests(e,floodingRequest[e]),Logger.log("current stack actn =>"+e+" : "+floodingRequest[e].length,"REQUEST_STACK"),floodingRequest[e].length?t=!0:delete floodingRequest[e]);ProccessRunning=!1,floodingDataInterval=t?setTimeout(processSafeModeSender,300):null}function sendCurrentActionRequests(e,t){var n,o,r,s=Date.now();for(n=0;n<t.length;n++){if(o=t[n],r=floodingData[o],!r)return t.splice(n,1),sendCurrentActionRequests(e,t);if(!r.ack&&!r.responded){if(r.scount>9){delete floodingData[o],t.splice(n,1),responseFalse(e,o);continue}if(r.scount>0&&s-r.lrt<3e3)continue;Logger.log("action => "+e+" packId =>"+o+" time : => "+(s-r.lrt)+"  count => "+r.scount,"SENDER"),connection.send(r.data,r.force),r.scount++,r.lrt=s,1===r.scount&&(r.frt=s);break}r.responded?(delete floodingData[o],t.splice(n,1)):s-r.frt>6e4&&(delete floodingData[o],t.splice(n,1),responseFalse(e,o))}}function changeMessageToByte(e,t,n){isString(e)||(e=JSON.stringify(e));var o,r,s=0,a=t?e.length:e.length+2;if(o=new ArrayBuffer(a),r=new DataView(o),t||(r.setUint8(s++,n),r.setUint8(s++,0)),e.length)for(i=0;i<e.length;i++)r.setUint8(s++,e.charCodeAt(i));return r}function keepAlive(){if(!settings.aSkey)return!1;var e=new ArrayBuffer(settings.aSkey.length+2),t=2;for(keepAlivePacket=new DataView(e),keepAlivePacket.setUint8(0,1),keepAlivePacket.setUint8(1,0),i=0;i<settings.aSkey.length;i++)keepAlivePacket.setUint8(t++,settings.aSkey.charCodeAt(i));KeepAliveInterval&&clearInterval(KeepAliveInterval),KeepAliveInterval=setInterval(function(){PingPongMap.last_sent>PingPongMap.last_received&&PingPongMap.sc-PingPongMap.rc>3&&(postMessage({name:"NET_ERROR",notifier:"event"}),PingPongMap.sc=0,PingPongMap.sc=0,PingPongMap.last_sent=0,PingPongMap.last_received=0,PingPongMap.net_error=!0),connection.isOpen()?(connection.send(keepAlivePacket),PingPongMap.last_sent=Date.now(),PingPongMap.sc++):connection.reconnect(),postMessage({connected:connection.isOpen(),intervel:1e4,notifier:"keepalivesent"});var e,t=Date.now();for(e in toIgnorePacketIds)toIgnorePacketIds.hasOwnProperty(e)&&t-toIgnorePacketIds[e]>5e3&&delete toIgnorePacketIds[e];Logger.log(keepAlivePacket.print_r("return"),"PING");try{Object.keys(chatRequestMap).forEach(function(e){Date.now()-chatRequestMap[e]>1e4&&delete chatRequestMap[e]})}catch(n){Logger.log("Clear Request Map Error",n,"CHAT")}},1e4)}function stopKeepAlive(){clearInterval(KeepAliveInterval),KeepAliveInterval=null,keepAlivePacket=null}function sendBrokenPacket(e,t,n,o){var r,s,a,i,c,E,g,u=129,l=0,_=e.byteLength,d=(Date.now(),Math.ceil(_/settings.CLIENT_DATA_SIZE)),T=(settings.aSkey||settings.sKey).substr(1,4)+getUniqueId(settings.tabId).toString(),p=d<128?1:2;for(Logger.log("PacketId : "+o+" TotalPacket : "+d,"BROKEN_PACKET"),s=0;s<d;s++)i=settings.CLIENT_DATA_SIZE*(s+1)-1,i>_&&(i=_-1),g=(settings.aSkey||settings.sKey).substr(-4,4)+"-"+s+"-"+getUniqueId(settings.tabId).toString(),E=new ArrayBuffer(u+(i-l+1)),c=new DataView(E),c.setUint8(0,n),c.setUint8(1,1),r=2,r=c.addAttributeInt(r,ATTRIBUTE_CODES.ACTION,2,t),r=c.addAttributeString(r,ATTRIBUTE_CODES.CLIENT_PACKET_ID,g),r=c.addAttributeInt(r,ATTRIBUTE_CODES.TOTAL_PACKET,p,d),r=c.addAttributeInt(r,ATTRIBUTE_CODES.PACKET_NUMBER,p,s),r=c.addAttributeString(r,ATTRIBUTE_CODES.UNIQUE_KEY,T),settings.aSkey&&(r=c.addAttributeString(r,ATTRIBUTE_CODES.WEB_UNIQUE_KEY,settings.aSkey)),r=c.addAttributeInt(r,ATTRIBUTE_CODES.WEB_TAB_ID,1,settings.tabId),r=c.addAttributeData(r,ATTRIBUTE_CODES.DATA,e,l,i-l+1),l=i+1,a=c.copy(0,r),sendbPacket(o,a,g,t),Logger.log("Pushed : "+s,"BROKEN_PACKET");brokenRequest[o].timeout=Math.max(Math.min(1*d,30*p),10),brokenRequestInterval||processBrokenRequest()}function sendbPacket(e,t,n,o){brokenRequest[e]||(brokenRequest[e]={packets:[],total:0,totalAck:0,rs:0,responded:!1}),brokenRequest[e].packets.push(n),brokenRequest[e].total++,brokenData[n]={action:o,packetId:e,data:t,ack:!1,scount:0,lrt:0,frt:0}}function processBrokenRequest(){var e,t,n,o,r=Date.now(),s=!1;if(Logger.log("Started Sending TimeOut","BROKEN_PACKET"),!connection.isOpen()&&!connection.isConnecting())return connection.reconnect(),void(brokenRequestInterval=setTimeout(processBrokenRequest,1500));for(e in brokenRequest)if(brokenRequest.hasOwnProperty(e)&&brokenRequest[e].packets.length){if(Logger.log("Starting For WholePacket : "+e,"BROKEN_PACKET"),n=brokenRequest[e].packets,brokenRequest[e].rs||(brokenRequest[e].rs=r),brokenRequest[e].responded){for(t=0;t<n.length;t++)delete brokenRequest[n[t]];delete brokenRequest[e],Logger.log("deleted : "+e+"Because Its responded","BROKEN_PACKET")}else if(!n.length&&r-brokenRequest[e].rs>brokenRequest[e].timeout)delete brokenRequest[e],responseFalse(o.action,e),Logger.log("Responded False cause timeout "+brokenRequest[e].timeout+"passes","BROKEN_PACKET");else{var a=0;for(t=0;t<n.length;t++){if(Logger.log("Starting Sub Packet "+n[t],"BROKEN_PACKET"),a>10){Logger.log("SCOUNT UP LIMIT : "+a,"BROKEN_PACKET");break}if(o=brokenData[n[t]]){if(o.scount>9){for(Logger.log("packet tried Timeout response false",o,"BROKEN_PACKET"),t=0;t<n.length;t++)delete brokenRequest[n[t]];delete brokenRequest[e],responseFalse(o.action,e);break}r-o.lrt<1e3?Logger.log("continue cause last sent less then 1 sec ago : "+n[t],"BROKEN_PACKET"):(o.scount++,o.lrt=r,Logger.log("sending : "+n[t]+" for "+o.scount+" time : "+r+" scount : "+a,"BROKEN_PACKET"),1===o.scount&&(o.frt=r),connection.send(o.data),a++)}else n.splice(t,1),Logger.log("continue cause of packet not found: ",o,"BROKEN_PACKET")}}s=!0}brokenRequestInterval=s?setTimeout(processBrokenRequest,500):null}!function(e){"use strict";var t={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166};function n(e){var t=[];return t[e.SUCCESS]="sucs",t[e.REASON_CODE]="reasonCode",t[e.MESSAGE]="message",t[e.TOTAL_PACKET]="totalPacket",t[e.PACKET_NUMBER]="packetNo",t[e.TOTAL_RECORDS]="totalRecord",t[e.USER_TABLE_IDS]="utIds",t[e.USER_ID]="utId",t[e.USER_IDENTITY]="uId",t[e.USER_NAME]="fn",t[e.PROFILE_IMAGE]="prIm",t[e.PROFILE_IMAGE_ID]="prImId",t[e.UPDATE_TIME]="ut",t[e.CONTACT_UPDATE_TIME]="cut",t[e.CONTACT_TYPE]="ct",t[e.NEW_CONTACT_TYPE]="nct",t[e.DELETED]="deleted",t[e.BLOCK_VALUE]="bv",t[e.FRIENDSHIP_STATUS]="frnS",t[e.CHANGE_REQUESTER]="changeRequester",t[e.CONTACT]="contacts",t[e.CALL_ACCESS]="cla",t[e.CHAT_ACCESS]="chta",t[e.FEED_ACCESS]="fda",t[e.ANONYMOUS_CALL]="anc",t[e.SESSION_ID]="sessionId",t[e.MUTUAL_FRIEND_COUNT]="mutualFriends",function n(o,r){for(var s,a,i={},c=r;c<o.byteLength&&!(c+1>=o.byteLength);){switch(s=o.getUint16(c),c+=2,a=0,s){case e.SUCCESS:a=o.getUint8(c++),i[t[s]]=o.getBool(c);break;case e.REASON_CODE:case e.TOTAL_PACKET:case e.PACKET_NUMBER:case e.TOTAL_RECORDS:case e.USER_ID:case e.PROFILE_IMAGE_ID:case e.UPDATE_TIME:case e.CONTACT_UPDATE_TIME:case e.CONTACT_TYPE:case e.NEW_CONTACT_TYPE:case e.DELETED:case e.BLOCK_VALUE:case e.FRIENDSHIP_STATUS:case e.CHANGE_REQUESTER:case e.MUTUAL_FRIEND_COUNT:case e.CALL_ACCESS:case e.CHAT_ACCESS:case e.FEED_ACCESS:a=o.getUint8(c++),i[t[s]]=o.getIntByByte(c,a);break;case e.MESSAGE:case e.USER_NAME:case e.USER_IDENTITY:case e.PROFILE_IMAGE:case e.SESSION_ID:a=o.getUint8(c++),i[t[s]]=o.getString(c,a);break;case e.USER_TABLE_IDS:a=o.getUint16(c),c+=2,i[t[s]]=[];for(var E,g,u,l,_=c;_<c+a;)E=o.getIntByByte(_,8),_+=8,g=o.getUint8(_++),u=o.getUint8(_++),l=o.getUint8(_++),i[t[s]].push({key:E,value:{ct:g,mb:u,frnS:l}});break;case e.CONTACT:a=o.getUint16(c),c+=2,Array.isArray(i[t[s]])||(i[t[s]]=[]),i[t[s]].push(n(o.copy(c,a),0));break;default:a=o.getUint8(c++)}c+=a}return i}}function o(e,t){var n,o={},r={};function s(t,n){var o,r,s,a,i={};for(o=n;o<t.byteLength;){switch(s=t.getUint16(o),o+=2,r=t.getUint8(o++),a=t.getIntByByte(o,r),s){case e.ACTION:i.actn=a;break;case e.SERVER_PACKET_ID:i.pckFs=a;break;case e.CLIENT_PACKET_ID:i.pckId=t.getString(o,r);break;case e.WEB_UNIQUE_KEY:break;case e.WEB_TAB_ID:i.tabId=a;break;case e.AUTHIP:i.authServer=t.getString(o,r);break;case e.AUTHPORT:i.comPort=a;break;case e.AUTH_E_USERNAME:i.authEUsername=t.getString(o,r);break;case e.AUTH_E_PASSWORD:i.authEPassword=t.getString(o,r);break;case e.AUTH_E_SALT:i.authESalt=t.getString(o,r);break;default:return o-=3,i.headerLength=o,i}o+=r}return i}function a(t,n){var o,r,s,a,i={actn:0,pckFs:0,total:0,current:0,key:0};for(n=n||1,o=n;o<t.byteLength;){switch(s=t.getUint8(o++),r=t.getUint8(o++),a=t.getIntByByte(o,r),s){case e.ACTION:i.actn=a;break;case e.SERVER_PACKET_ID:i.pckFs=a;break;case e.TOTAL_PACKET:i.total=a;break;case e.PACKET_NUMBER:i.current=a;break;case e.UNIQUE_KEY:i.key=a;break;case e.DATA:o--,r=t.getUint16(o),o+=2,i.data=t.copy(o,r);break;case e.WEB_UNIQUE_KEY:break;case e.WEB_TAB_ID:i.tabId=a}o+=r}return i}function i(e){var n,r,i,c,E;switch(n=e.getUint8(0)){case 0:case 2:if(r=s(e,1),200===r.actn)return r;if(0===n){c=e.getString(r.headerLength,e.byteLength-r.headerLength);try{c=JSON.parse(c),c=object_extend({},c,r)}catch(g){Logger.log(g,c,"PARSE_ERROR"),c=!1}return c}return c=t(e,r.headerLength),!!c&&object_extend({},c,r);case 1:case 3:if(i=a(e,1),!i.key)return!1;if(o[i.key]?o[i.key].packetLength++:(o[i.key]=[],o[i.key].packetLength=1),o[i.key][i.current]=i.data,i.total===o[i.key].packetLength){if(E=o[i.key].joinAsDataView(),delete o[i.key],r=s(E,0),1===n){c=E.getString(r.headerLength,E.byteLength-r.headerLength);try{c=JSON.parse(c),c=object_extend({},c,r)}catch(g){return c=!1,!1}return c}return c=t(E,r.headerLength),!!c&&object_extend({},c,r)}return!1}}return n={parse:function(e){return i(e)},addParser:function(e,t){r[e]=t}}}e.RingParser=o(t,n(t)),e.ATTRIBUTE_CODES=t}(self);function postRingLoggerMessage(e,t){postMessage({notifier:e,m:Array.prototype.slice.call(t)})}var Logger={log:function(){postRingLoggerMessage("debug",arguments)},error:function(){postRingLoggerMessage("error",arguments)}},REQUEST_TYPE={KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},AUTH_SERVER_ACTIONS={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_USER_MOOD_PRESENCE:199,GET_OFFLINE_IP_PORT:83},CHAT_AUTH_SERVER_RQUESTS=[AUTH_SERVER_ACTIONS.START_F2F_CHAT,AUTH_SERVER_ACTIONS.RECEIVED_F2F_CHAT,AUTH_SERVER_ACTIONS.START_TAG_CHAT,AUTH_SERVER_ACTIONS.RECEIVED_TAG_CHAT,AUTH_SERVER_ACTIONS.ADD_TAG_CHAT_MEMBERS,AUTH_SERVER_ACTIONS.GET_USER_MOOD_PRESENCE,AUTH_SERVER_ACTIONS.GET_OFFLINE_IP_PORT],settings={CLIENT_DATA_SIZE:460,device:5},connection,pendingRequest={},TOTAL_REQUEST_PROCESS,toIgnorePacketIds={},PingPongMap={last_received:0,last_sent:0,sc:0,rc:0,net_error:!1,connection_error:0},keepAlivePacket,KeepAliveInterval,floodingRequest={},brokenRequest={},brokenData={},floodingData={},floodingDataInterval,brokenRequestInterval,ProccessRunning=!1,chatWorkerPort,chatRequestMap={};function sendToChatWorker(e){chatWorkerPort?chatWorkerPort.postMessage(e):(e.notifier="forward_to_chat",postMessage(e))}function socketOnMessage(e){var t,n,o;if(t=new DataView(e),!t.byteLength)throw new Error("Invalid Array Buffer to Parse : worker js socket on message");if(n=RingParser.parse(t))if(200===n.actn){if(n.pckId)if(floodingData[n.pckId])floodingData[n.pckId].ack=!0;else if(brokenData[n.pckId]){var r=brokenData[n.pckId].packetId,s=brokenRequest[r].packets.indexOf(n.pckId);s>-1&&(Logger.log("ACKNOWLEDGE OF : "+s+"  PackId : "+n.pckId,"BROKEN_PACKET"),brokenRequest[r].packets.splice(s,1),brokenRequest[r].totalAck++,delete brokenData[n.pckId])}Logger.log(n,"ACKNOWLDGE")}else if(4e3===n.actn)PingPongMap.last_received=Date.now(),PingPongMap.rc++,o={currentTime:PingPongMap.last_received,serverTime:n.t},postMessage({keepAliveTimeObject:o,notifier:"timestamp-changed"}),chatWorkerPort||sendToChatWorker({type:"server_time",value:n.t,diff:Date.now()-n.t}),Logger.log(n,"PONG");else{if(n.pckId){if(toIgnorePacketIds[n.pckId])return void Logger.log(n,"IGNORING_FOR_ROUTE_CHANGE");floodingData[n.pckId]?(floodingData[n.pckId].ack=!0,floodingData[n.pckId].responded=!0):brokenRequest[n.pckId]&&(brokenRequest[n.pckId].ack=!0,brokenRequest[n.pckId].responded=!0)}chatRequestMap[n.pckId]||CHAT_AUTH_SERVER_RQUESTS.indexOf(parseInt(n.actn))!=-1?sendToChatWorker(n):postMessage({data:n,notifier:"received"}),Logger.log(n,"RECEIVED")}}function responseFalse(e,t){brokenRequest[t]&&(brokenRequest[t].ack=!0,brokenRequest[t].responded=!0),chatRequestMap[t]||CHAT_AUTH_SERVER_RQUESTS.indexOf(parseInt(e))!=-1?sendToChatWorker({actn:parseInt(e),pckId:t,sucs:!1,rc:1111}):postMessage({data:{actn:parseInt(e),pckId:t,sucs:!1,rc:1111},notifier:"received"})}function socketOnOpen(){PingPongMap.connection_error=0,PingPongMap.net_error&&(PingPongMap.net_error=!1,postMessage({name:"NET_SUCCESS",notifier:"event"}),settings.aSkey&&keepAlive())}function socketOnError(){PingPongMap.connection_error++,PingPongMap.connection_error>5&&(postMessage({name:"NET_ERROR",notifier:"event"}),PingPongMap.net_error=!0)}self.onmessage=WorkerOnMessageProcessor;function _sendData(e){buildPacketAndSend(e)}function onChatWorkerMessage(e){var t=e.data,n={packetId:t.packetId||getUniqueId(),data:t,port:t.requestType||REQUEST_TYPE.CHAT,action:t.actn};chatRequestMap[n.packetId]=Date.now(),_sendData(n)}function WorkerOnMessageProcessor(e){if(!e.data.command)throw new Error("You must provide a command to operate worker");switch(e.data.command){case"SETTINGS":connection&&connection.close(),object_extend(settings,e.data),connection=new SocketProvider(settings.url),connection.onOpen(socketOnOpen),connection.onMessage(socketOnMessage),connection.onError(socketOnError);try{e.ports[0]&&(chatWorkerPort=e.ports[0],chatWorkerPort.onmessage=onChatWorkerMessage)}catch(e){}setTimeout(function(){Logger.log("30sec pass hit enter","DEBUG")},1500),Logger.log(connection.isOpen()+"  con  "+connection.isConnecting(),"DEBUG"),Logger.log(settings,"WORKER_SETTTING");break;case"UPDATE_SALT":stopKeepAlive(),settings.aSkey=e.data.aSkey,keepAlive();break;case"SEND":_sendData(e.data);break;case"PAUSE":connection&&connection.pause(!0);break;case"RESUME":connection&&connection.pause(!1);break;case"ROUTE_CHANGE":clearPageActions();break;case"KEEPALIVE":e.data.aSkey&&settings.aSkey!==e.data.aSkey&&(settings.aSkey=e.data.aSkey),e.data.uKey&&(settings.uKey=e.data.uKey),keepAlive();break;case"FROM_CHAT_WORKER":var t={data:e.data.object};onChatWorkerMessage.call(this,t)}}function clearPageActions(){var e,t,n=[88,87,110,94,198,295];for(e=0;e<n.length;e++)if(floodingRequest[n[e]]&&floodingRequest[n[e]].length)for(t=0;t<floodingRequest[n[e]].length;t++)floodingData[floodingRequest[n[e]]]&&!floodingData[floodingRequest[n[e]]].responded&&(toIgnorePacketIds[floodingRequest[n[e]]]=Date.now()),delete floodingData[floodingRequest[n[e]]],floodingRequest[n[e]].splice(e,1)}