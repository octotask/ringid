/*! @copywrite Ringid.com  2016-07-23 */
var RingWorker,RingMessageChannel;try{RingMessageChannel=new MessageChannel}catch(e){RingMessageChannel=new BroadcastChannel("ring_channel")}!function(e){"use strict";function t(){var e,t=Cookies.get("top");return t?(e=parseInt(t)+1,e>255&&(e=1)):e=1,Cookies.set("top",e),e}e._cti=t();try{e.location.origin||(e.location.origin=e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")),RingWorker=new Worker(e.location.origin+"/js/worker/com")}catch(e){RingWorker={addCallback:angular.noop,addEventListener:angular.noop,postMessage:angular.noop}}RingWorker.FNS={},RingWorker.addCallback=function(e,t,n){this.FNS[e]||(this.FNS[e]=[]),n=n||null,this.FNS[e].push({ctx:n,fn:t})},RingWorker.send=function(e,t,n,r){if(!n||!e)throw new Error("You must sent data and port");this.postMessage({command:"SEND",packetId:t,data:e,flooding:r,port:n,action:e.actn})},RingWorker.addEventListener("message",function(e){var t,n;if(e.data.notifier&&this.FNS[e.data.notifier])for(n=0;n<this.FNS[e.data.notifier].length;n++)t=this.FNS[e.data.notifier][n],t.fn.call(t.ctx,e.data)}),RingWorker.addCallback("debug",function(e){},RingWorker),RingWorker.addEventListener("error",function(e){}),RingWorker.pushMessage=function(e,t){try{t?this.postMessage(e,t):this.postMessage(e)}catch(e){}},RingWorker.pushMessage({command:"SETTINGS",tabId:e._cti,url:"ws://"+e.location.host+"/DataSocket/"+e._cti,aSkey:Cookies.get("sId"),sKey:Cookies.get("sessionID"),CLIENT_DATA_SIZE:460},[RingMessageChannel.port1])}(window),function(e,t){"use strict";e.emojiSupported=function(){var e=document.createElement("canvas");if(!e.getContext||!e.getContext("2d")||"function"!=typeof e.getContext("2d").fillText)return!1;var t=e.getContext("2d");return t.textBaseline="top",t.font="32px Arial",t.fillText("ðŸ˜ƒ",0,0),0!==t.getImageData(16,16,1,1).data[0]}(),e.eventFix=function(t){t=t||e.event;var n=t.pageX,r=t.pageY;void 0===n&&(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElerment.scrollTop)},e.scrollToYOffset=function(t,n){var r=t/(n/15),i=setInterval(function(){e.scrollY<t?e.scrollBy(0,r):clearInterval(i)},15)},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),i.prototype=new r,i}),String.prototype.format||(String.prototype.format=function(){var e="[object Array]"===Object.prototype.toString.call(arguments[0])?arguments[0]:arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),String.prototype.supplant||(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t})}),String.prototype.repeat||(String.prototype.repeat=function(e){return Array(e+1).join(this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))},String.prototype.getUTF8Length=function(){for(var e=0,t=this,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e+=1:r<=2047?e+=2:r>=55296&&r<=57343?(e+=4,n++):e+=r<65535?3:4}return e},String.prototype.toCharCodeArray=function(){for(var e=[],t=0;t<this.length;t++)e.push(this.charCodeAt(t));return e},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.contains||(Array.prototype.contains=function(e,t){if(!t)return this.indexOf(e);var n=this.length>>>0,r=Number(arguments[1])||0;for(r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);r<n;r++)if(r in this&&t.call(this,this[r],e))return r;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],i=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)if(o in t){var a=t[o];e.call(i,a,o,t)&&r.push(a)}return r}),Array.prototype.keyValues||(Array.prototype.keyValues=function(e){var t,n=[];for(t=0;t<this.length;t++)this[t][e]&&n.push(this[t][e]);return n}),Array.prototype.values||(Array.prototype.values=function(){var e,t=[];for(e=0;e<this.length;e++)t.push(this[e]);return t}),Array.prototype.joinAsDataView=function(){var e,n,r=this,i=0,o=0;if(!r.length)return new t(new ArrayBuffer(0));for(var a=0;a<r.length;a++)r[a]instanceof t&&(o+=r[a].byteLength);if(!o)return new t(new ArrayBuffer(0));e=new ArrayBuffer(o),n=new t(e);for(var a=0;a<r.length;a++)if(r[a]instanceof t)for(var s=0;s<r[a].byteLength;s++)n.setUint8(i++,r[a].getUint8(s));return n},Array.prototype.difference=function(e){if(!e||!e.length||!this.length)return this;for(var t={},n=[],r=0;r<e.length;)t[e[r]]=!0,r++;for(r=0;r<this.length;r++)t[this[r]]||n.push(this[r]);return n},t.prototype.copy=function(e,n){var r=this;e=e||0,n=n||r.byteLength;for(var i=new ArrayBuffer(n),o=new t(i),a=0;a<n;a++)o.setUint8(a,r.getUint8(e++));return o},t.prototype.merge=function(e,n,r,i,o){var a,s,c=new t(this.buffer,e,n),l=new ArrayBuffer(c.byteLength+(o-i+1)),u=new t(l);for(a=0;a<c.byteLength;a++)u.setUint8(a,c.getUint8(a));for(s=a;s<u.byteLength;s++)u.setUint8(s,r.getUint8(i++));return u},t.prototype.addAttributeInt=function(e,t,n,r){switch(this.setUint8(e++,t),this.setUint8(e++,n),n){case 1:this.setUint8(e++,r);break;case 2:this.setUint16(e,r),e+=2;break;case 4:this.setUint32(e,r),e+=4}return e},t.prototype.addAttributeString=function(e,t,n){this.setUint8(e++,t),this.setUint8(e++,n.length);for(var r=0;r<n.length;r++)this.setUint8(e++,n.charCodeAt(r));return e},t.prototype.addAttributeData=function(e,t,n,r,i){r=r||0,i=i||n.byteLength,this.setUint8(e++,t),this.setUint16(e,i),e+=2;for(var o=0;o<i;o++)this.setUint8(e++,n.getUint8(r++));return e},t.prototype.print_r=function(e,t,n){t=t||0,n=n||this.byteLength;for(var r,i,o="Index\t\tBinary\t\tInteger\t\tChar\n",a="",s=t;s<n;s++)i=this.getUint8(s),r=String.fromCharCode(i),o+=s+"\t\t \t\t"+i.toString(2)+"\t\t\t\t"+i+"\t\t\t\t"+r+"\n",a+=r;if(!e||"string"==typeof e)return a},t.prototype.printBytes=function(){for(var e=[],t=0;t<this.byteLength;t++)e.push(this.getUint8(t));e.push(-1e3)},t.prototype.getString=function(e,t){var n,r,i,o,a=this,s=[];for(t=t||a.byteLength;t>0;)n=a.getUint8(e),a.getUint8(e)<=127?(s.push(a.getUint8(e++)),t--):a.getUint8(e)>=128&&a.getUint8(e)<=223?(s.push((31&a.getUint8(e++))<<6|63&a.getUint8(e++)),t-=2):a.getUint8(e)>=224&&a.getUint8(e)<=239?(s.push((31&a.getUint8(e++))<<12|((63&a.getUint8(e++))<<6|63&a.getUint8(e++))),t-=3):(o=(7&a.getUint8(e++))<<18|((63&a.getUint8(e++))<<12|((63&a.getUint8(e++))<<6|63&a.getUint8(e++))),o-=65536,r=(o>>10)+55296,i=o%1024+56320,s.push(r,i),t-=4);return String.fromCharCode.apply(null,s)},t.prototype.getStringUtf16=function(e,t,n){t=0|t,e=e||this.byteLength-t;var r=!1,i="",o=!1;if("undefined"!=typeof Buffer&&(i=[],o=!0),e<0&&(e+=this.byteLength),n){var a=this.getUint16(t);65534===a&&(r=!0),t+=2,e-=2}for(var s=t;s<t+e;s+=2){var c=this.getUint16(s,r);c>=0&&c<=55295||c>=57344&&c<=65535?o?i.push(c):i+=String.fromCharCode(c):c>=65536&&c<=1114111&&(c-=65536,o?(i.push(((1047552&c)>>10)+55296),i.push((1023&c)+56320)):i+=String.fromCharCode(((1047552&c)>>10)+55296)+String.fromCharCode((1023&c)+56320))}return o?i.toString():decodeURIComponent(escape(i))},t.prototype.getIntByByte=function(e,t){var n=this;switch(t){case 1:return n.getUint8(e);case 2:return n.getUint16(e);case 4:return n.getUint32(e);case 6:case 8:var r,i,o="";for(r=e;r<e+t;r++)i=n.getUint8(r).toString(2),o+=i.length<8?"0".repeat(8-i.length)+i:i;return parseInt(o,2);default:return n.getUint8(e)}},t.prototype.getSynch=function(e){for(var t=0,n=2130706432;n;)t>>=1,t|=e&n,n>>=8;return t},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=this.byteLength),e=Math.floor(e),t=Math.floor(t),e<0&&(e+=this.byteLength),t<0&&(t+=this.byteLength),e=Math.min(Math.max(0,e),this.byteLength),t=Math.min(Math.max(0,t),this.byteLength),t-e<=0)return new ArrayBuffer(0);var n=new ArrayBuffer(t-e),r=new Uint8Array(n),i=new Uint8Array(this,e,t-e);return r.set(i),n}),t.prototype.setUint64=function(e,t){var n=this,r=Number.isInteger(t)?t.toString(2):parseInt(t).toString(2);r=r.length<64?"0".repeat(64-r.length)+r:r;for(var i=r.match(/.{1,32}/g),o=i.map(function(e){return parseInt(e,2)}),a=0;a<o.length;a++)n.setUint32(e+4*a,o[a])},t.prototype.getBool=function(e){return 1===this.getUint8(e)},e.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,n=(t.parentNode||t.document).querySelectorAll(e),r=-1;n[++r]&&n[r]!=t;);return!!n[r]}}(e.Element.prototype),e.Element&&function(e){e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(e.Element.prototype),e.requestAnimationFrame=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,t.prototype.getUint24=function(e,t){return t?this.getUint8(e)+(this.getUint8(e+1)<<8)+(this.getUint8(e+2)<<16):this.getUint8(e+2)+(this.getUint8(e+1)<<8)+(this.getUint8(e)<<16)},Math.easeIn=function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)},e.decodeEntities=function(){var e=document.createElement("div");function t(t){return t&&"string"==typeof t&&(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),t=t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=t,t=e.textContent,e.textContent=""),t}return t}(),"function"!=typeof Object.assign&&!function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}}()}(window,DataView),function(e,t){"use strict";e.module("ringid.digits",["ringid.config","ringid.global_services"])}(angular,window),angular.module("ringid.digits").service("digitsService",digitsService),digitsService.$inject=["settings"];function digitsService(e){var t=!1;this.initialize=function(){t||(Digits.init({consumerKey:e.digitsConsumerKey}),t=!0)}}angular.module("ringid.digits").directive("rgVerifyPhone",rgVerifyPhone),rgVerifyPhone.$inject=["$ringhttp","settings","$http","Auth","Ringalert","MESSAGES","digitsService","Storage","$compile"];function rgVerifyPhone(e,t,n,r,i,o,a,s,c){function l(e,l){var u,d=!1;function g(e){}function m(a){var s=u.find("iframe");s&&(s[0].style.height="100%");var c=a.oauth_echo_headers,l={authHeader:c["X-Verify-Credentials-Authorization"],apiUrl:c["X-Auth-Service-Provider"]};n.post(t.digitsServiceUrl,l).then(function(t){if(t.data.phoneNumber&&t.data.phoneNumber.length>1){for(var n,a={mbl:"",mblDc:""},s=t.data.phoneNumber,c=r.getCountryList(),l=0;l<c.length;l++)if(n=s.substr(0,c[l].code.length),c[l].code===n){a.mblDc=c[l].code,a.mbl=s.substr(c[l].code.length);break}e.verify()(a)}else i.show(o.REQUEST_FAILED)})}function f(){d=!0,u=c('<div class="verify-phone"></div>')(e),l.after(u);var t="",n=s.getData("country");n&&n.hasOwnProperty("code")&&(t=n.code),a.initialize(),Digits.embed({container:".verify-phone",phoneNumber:t,theme:{accent:"F47727"}}).done(m).fail(g),e.$rgDigest()}function E(){d=!1,u&&u.remove()}e.$watch("enabled",function(e){e&&!d?f():!e&&d&&E()})}return{restrict:"E",scope:{verify:"&",enabled:"="},link:l}}!function(e,t){"use strict";e.module("ringid.config",[])}(angular,window);var server=location.href.split("/")[2],protocol="http://",baseUrl=location.protocol+"//"+location.host,setting_default={ac:"http://devauth.ringid.com/rac/",ims:"http://devimages.ringid.com/",imsres:"http://devimagesres.ringid.com/",stmapi:"http://devsticker.ringid.com/",stmres:"http://devstickerres.ringid.com/",vodapi:"http://devmediacloudapi.ringid.com/",vodres:"http://devmediacloud.ringid.com/",apiVersion:140},settings={apiVersion:setting_default.apiVersion,constantServer:"http://auth.ringid.com/cnstnts?pf=5&v="+setting_default.apiVersion+"&apt=1",socketProtocol:"ws://",secure:!1,analytics:!0,debugEnabled:!1,httpsUrl:"http://"+server,siteUrl:server,baseUrl:baseUrl,base:location.host,chatImBase:protocol+"image.ringid.com/chatContens/",chatVideoBase:protocol+"image.ringid.com/chatContens/",chatAudioBase:protocol+"image.ringid.com/chatContens/",tagChatImBase:protocol+"image.ringid.com/groupContents/",chatHeartBeatUrl:baseUrl+"/images/ping.jpg",emotionServer:setting_default.imsres+"/emoticon/d5/",emoticonBase:protocol+server+"/images/emoticon/",stickerBase:setting_default.stmres+"stickermarket/d5/",stickerApi:setting_default.stmapi+"ringmarket/StickerHandler/?pf=5&v="+setting_default.apiVersion+"&",imMediaBase:protocol+"image.ringid.com/ringmarket/ChatImageHandler",digitsServiceUrl:"http://www.ringid.com/DigitsService",digitsConsumerKey:"wnZ1SukFsxdnr22U4PLiS3T9J",twitterApiURL:"http://api.twitter.com/1.1/account/verify_credentials.json",ogServiceUrl:protocol+server+"/OGService",sessionTimeout:216e5,FEED_LIMIT:6,FEED_TEXT_LIMIT:65335,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE"};function setUrlBase(e){settings.signupInit=e.ac+"ringid?pf=5&v="+settings.apiVersion+"&",settings.signupSocialInit=e.ac+"comports?pf=5&v="+settings.apiVersion+"&",settings.imBase=e.imsres,settings.imServer=e.ims+"ringmarket/",settings.mediaServer=e.vodapi+"/stream/",settings.mediaBase=e.vodres,settings.stickerBase=e.stmres+"stickermarket/d5/",settings.stickerApi=e.stmapi+"ringmarket/StickerHandler/?pf=5&v="+settings.apiVersion+"&"}settings.updateUrlBase=setUrlBase,settings.updateUrlBase(setting_default);var PLATFORM={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},RING_ROUTES={HOME:"/",USER_PROFILE:"/profile/:uId/:subpage?/:albumId?",CIRCLE_HOME:"/circle/:circleId/:subpage?",CIRCLE:"/circle",WHO_SHARED_FEED:"/feed_shares/:feedId/:commentId?",SINGLE_FEED:"/feed/:feedId/:commentId?/:shared?",SINGLE_IMAGE:"/image/:imageId/:commentId?",SINGLE_MEDIA:"/media/:mediaId/:commentId?",MEDIA_FEEDS:"/medias",LOGIN_SOCIAL:"/social/:operation/:platform/:token",SIGNUP_SOCIAL:"/social/:operation/:platform/:token",MEDIA_CLOUD:"/media",MEDIA_POST:"/media/upload",MEDIA_CLOUD_MYALBUM:"/media/myalbums",MEDIA_CLOUD_ALBUM:"/media/:albumtype",MEDIA_CLOUD_SEARCH:"/media/:stype/:sk?",MEDIA_CLOUD_USERMEDIA:"/media/:albumtype/:utid/:albumid",FAQ:"/faq",API_DASHBOARD:"/apidashboard"},DEFAULTS_TITLE="ringID: Free Video Calls, Secret Chats, Feeds, Stickers & more",PAGE_TITLES={DEFAULT:DEFAULTS_TITLE};PAGE_TITLES[RING_ROUTES.HOME]=DEFAULTS_TITLE,PAGE_TITLES[RING_ROUTES.CIRCLE_HOME]="ringID Circle",PAGE_TITLES[RING_ROUTES.CIRCLE]="ringID Circle",PAGE_TITLES[RING_ROUTES.SINGLE_FEED]=DEFAULTS_TITLE,PAGE_TITLES[RING_ROUTES.MEDIA_FEEDS]="Media Feeds",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_POST]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_MYALBUM]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_ALBUM]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_SEARCH]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_USERMEDIA]="Media Cloud",angular.module("ringid.config").constant("settings",settings).constant("PLATFORM",PLATFORM).constant("RING_ROUTES",RING_ROUTES).constant("PAGE_TITLES",PAGE_TITLES).constant("MIN_TIMESTAMP",0xe87c62b0141);var ATTRIBUTE_CODES={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166,ADDED_TIME:168};angular.module("ringid.config").constant("ATTRIBUTE_CODES",ATTRIBUTE_CODES),angular.module("ringid.config").constant("REASON_CODES",{NONE:0,PERMISSION_DENIED:1,PASSCODE_SENT_INTERVAL:2,DONT_DISTURB_MODE:3,ALREADY_SHARED:4,NOT_TAG_MEMBER:5,TAG_DOES_NOT_EXIST:6,SMS_SENDING_FAILED:7,EMAIL_SENDING_FAILED:8,FRIEND_OFFLINE:9,NOT_FRIEND:10,USERID_FRIENDID_SAME:11,ALREADY_FRIEND_REQUESTED:12,EXCEPTION_OCCURED:13,DATABASE_ROLL_BACKED:14,CANT_SHARE_OWN_FEED:15,FRIEND_DID_NOT_FOUND:16,SMS_SEND_RETRY_LIMIT_OVER:17,NO_MORE_FEED:18,NOT_FOUND:404}).constant("SystemEvents",{COMMON:{WINDOW_RESIZED:"WINDOW_RESIZED",COLUMN_CHANGED:"COLUMN_CHANGED",LOADING:"LOADING"},MEDIA:{SLIDER_IMAGE_LOADED:"SLIDER_IMAGE_LOADED"},PORTAL:{DONE_FOLLOW_PORTAL:"DONE_FOLLOW_PORTAL",UNFOLLOW_PORTAL:"UNFOLLOW_PORTAL"},BUSINESS:{DONE_FOLLOW_BUSINESS:"DONE_FOLLOW_BUSINESS",UNFOLLOW_BUSINESS:"UNFOLLOW_BUSINESS"},RINGBOX:{UPDATE:"CONTENT_UPDATE"},CIRCLE:{MY_CIRCLE_LIST_FETCH_COMPLETE:"MY_CIRCLE_LOAD_COMPLETE",MY_CIRCLE_LIST_PROCESS_COMPLETE:"MY_CIRCLE_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE:"MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE",MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE:"MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE:"MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE",MY_CIRCLE_MEMBER_REMOVED:"MY_CIRCLE_MEMBER_REMOVED",MY_CIRCLE_REMOVED:"MY_CIRCLE_REMOVED",MY_CIRCLE_UPDATE_MEMBER_COUNT:"MY_CIRCLE_UPDATECOUNT"},FILE_UPLOAD:{PROGRESS_UPDATE:"PROGRESS_UPDATE",QUEUE_START:"QUEUE_START",QUEUE_COMPLETE:"QUEUE_COMPLETE",UPLOADS_POSTED:"UPLOADS_POSTED"},ALBUM:{PHOTOS_SELECTED:"PHOTOS_SELECTED"},IMAGE:{DO_REPOSITION:"DO_REPOSITION",RESIZE:"RESIZE"},FEED:{UPDATED:"UPDATED",CREATED:"CREATED",DELETED:"DELETED",RESET:"RESET",HEIGHT:"HEIGHT",BUSY:"BUSY"},FRIEND:{PENDING_FRIENDS_COUNT_CHANGED:"PENDING_FRIENDS_COUNT_CHANGED",UTID_LIST_RECEIVED:"UTID_LIST_RECEIVED"},AUTH:{LOGIN:"LOGIN",LOGIN_REQUIRED:"LOGIN_REQUIRED",LOGIN_DONE:"LOGIN_DONE"},CHAT:{BOX_CAM_UPLOAD:"BOX_CAM_UPLOAD",BOX_OPENNED:"BOX_OPENNED",BOX_UPDATED:"BOX_UPDATED",WAS_FOCUSED:"WAS_FOCUSED",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",NEW_MESSAGE_PUSHED:"NEW_MESSAGE_PUSHED",MESSAGE_RECEIVED:"MESSAGE_RECEIVED",UNREAD_MESSAGE_INFO_UPDATED:"UNREAD_MESSAGE_INFO_UPDATED",SINGLE_MESSAGE_UPDATED:"SINGLE_MESSAGE_UPDATED",SINGLE_MESSAGE_TIMEOUT:"SINGLE_MESSAGE_TIMEOUT",MESSAGE_SUBMITTED:"MESSAGE_SUBMITTED",MESSAGE_PUSHED:"MESSAGE_PUSHED",DO_START_SECRET_TIMER:"DO_START_SECRET_TIMER",SIMPLE_MESSAGE_TIMEOUT:"SIMPLE_MESSAGE_TIMEOUT",MY_TAG_LIST_RECEIVED:"MY_TAG_LIST_RECEIVED",TAG_LIST_UPDATED:"TAG_LIST_UPDATED",TAG_REGISTERED:"TAG_REGISTERED",TAG_UNREGISTERED:"TAG_UNREGISTERED",TAG_MEMBER_FETCHED:"TAG_MEMBER_FETCHED",TAB_SYNC_NEW_DATA:"TAB_SYNC_NEW_DATA",HISTORY_LOADED:"HISTORY_LOADED",CHAT_REGISTER:"CHAT_REGISTER",TAB_SYNC:"TAB_SYNC",SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",CONVERSATION_COUNT_RESETED:"CONVERSATION_COUNT_RESETED"}}).constant("MESSAGES",{REQUEST_PROCESSED:"Your Request Was Successfully Processed",REQUEST_FAILED:"Your Request Was Failed ! Please Try Later.",RC0:"NONE.",RC1:"PERMISSION_DENIED",RC2:"PASSCODE_SENT_INTERVAL",RC3:"DONT_DISTURB_MODE",RC4:"You have already shared this post.",RC5:"NOT_TAG_MEMBER.",RC6:"TAG_DOES_NOT_EXIST.",RC7:"SMS_SENDING_FAILED.",RC8:"EMAIL_SENDING_FAILED.",RC9:"FRIEND_OFFLINE",RC10:"You are not permitted to share this post",RC11:"USERID_FRIENDID_SAME",RC12:"ALREADY_FRIEND_REQUESTED",RC13:"EXCEPTION_OCCURED",RC14:"DATABASE_ROLL_BACKED",RC15:"You Can't Share Your Own Post",RC16:"FRIEND_DID_NOT_FOUND",RC17:"SMS_SEND_RETRY_LIMIT_OVER",RC18:"NO_MORE_FEED",RC19:"UNKNOWN",RC20:"UNKNOWN",RC21:"LOGGED_IN_FROM_ANOTHER_DEVICE",RC22:"UNKNOWN",RC23:"UNKNOWN",RC26:"USER_EXIST",RC27:"DUPLICATE_DATA",RC33:"THIS_IS_SPECIAL_FRIEND",RC37:"ANONYMOUS_CHAT_PERMISSION_DENIED",RC24:"Wrong Password.",RC38:"Could not find DeviceID!",RC39:"This phone number is not verified.",RC40:"This email is not verified.",RC41:"Your facebook ID is not verified.",RC42:"Your twitter ID is not verified.",RC43:"Could not find Your facebook ID.",RC44:"Could not find Your twitter ID.",RC45:"Wrong RingID!",RC46:"Wrong Phone number!",RC47:"Wrong Email!",RC48:"Device Id required!",RC49:"Password required",RC50:"Login Type required",RC51:"Phone country code required!",RC52:"Phone number required!",RC53:"RingID required!",RC54:"Email required!",RC55:"Version required!",RC56:"Device required!",RC57:"Wrong information",RC60:"Friend limit over!",RC64:"Pending friend limit over!",RC65:"Friend's pending friend limit over",RC66:"Friend's friend limit over",RC404:"NOT_FOUND",CRCFS1:"Wall post can't be shared",CRCFS2:"Group post can't be shared",CRCFS3:"You already shared this post",FEED_INV:"Please insert some text or upload an image!",FTL_ERROR:"A status can't be longer than {max_limit} characters, but this one is {length} characters long. Please make it a little shorter and try again.",FEED:{ACT_1:"{0} liked this post",ACT_2:"{0} commented on this post",ACT_3:"{0} shared this post",TYPE_0:"{0}",TYPE_11:"{0}",TYPE_11C:"{0} posted",TYPE_11F:"{0} posted",TYPE_12:"{0} have||has updated profile picture",TYPE_13:"{0} have||has updated cover picture",TYPE_2:"{0}",TYPE_2L:"{0} shared a link",TYPE_2C:"{0} posted",TYPE_2CL:"{0} shared a link",TYPE_2F:"{0} posted",TYPE_2FL:"{0} shared a link",TYPE_3:"{0} have||has added {1} photos",TYPE_4:"{0} created a album",TYPE_50:"{0} added {1} music",TYPE_51:"{0} shared {1}'s music",TYPE_60:"{0} added {1} video",TYPE_62:"{0} shared {1}'s video",TYPE_D:"{0}",C_POSTFIX:" in {0}",F_POSTFIX:" on {0}'s timeline",TYPE_SHARE:"{0} shared {1}'s feed"},NEWSPORTAL:{C_UNFOLLOW:"Are you sure you want to unfollow?"}}).constant("APP_CONSTANTS",{NOT_FRIEND:0,FRIEND:1,INCOMING_FRIEND:2,OUTGOING_FRIEND:3,TYPE_SEARCH_BY_ALL:0,TYPE_SEARCH_BY_NAME:1,TYPE_SEARCH_BY_PHONE:2,TYPE_SEARCH_BY_EMAIL:3,TYPE_SEARCH_BY_RINGID:4,TYPE_SEARCH_BY_LOCATION:5,IMAGE_UPLOAD_LIMIT:40,VIDEO_UPLOAD_LIMIT:5,AUDIO_UPLOAD_LIMIT:5,COVER_PIC_UPLOAD_MAXIMUM_WIDTH:1480,COVER_PIC_UPLOAD_MAXIMUM_HEIGHT:2048,COVER_PIC_UPLOAD_MINIMUM_WIDTH:740,COVER_PIC_UPLOAD_MINIMUM_HEIGHT:280,PROFILE_PIC_UPLOAD_MINIMUM_WIDTH:100,PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT:100,COVER_PIC_CROP_WIDTH:1480,COVER_PIC_CROP_HEIGHT:450,PROFILE_PIC_CROP_WIDTH:200,IMAGE_UPLOAD_MIN_WIDTH:10,IMAGE_UPLOAD_MIN_HEIGHT:10,MEDIA_UPLOAD_SIZE_LIMIT:524288e3,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE",NEWS_FEED_MEDIA_TYPE_AUDIO:1,NEWS_FEED_MEDIA_TYPE_VIDEO:2}).constant("PrivacySet",{PVC1:{icon:"img_sprite post-ico only-i",iconfeed:"img_sprite post-ico-gray only-i",text:"Only me",value:1},PVC2:{icon:"img_sprite post-ico fri-i",iconfeed:"post-ico-gray fri-i",text:"Friends",value:2},PVC3:{icon:"img_sprite post-ico pub-i",iconfeed:"img_sprite post-ico-gray pub-i",text:"Public",value:3}}).constant("SPAM_TYPES",{USER:1,FEED:2,IMAGE:3,MEDIA:4}).constant("CLIENT_DATA_SIZE",460).constant("AUTH_SERVER_CONFIG",{REQUEST_DELAY:200}).value("DATE_FORMAT","MMM d, y h:mm a").value("STICKER_IMAGE_TYPE",{EMOTICON:1,LARGE_EMOTICON:2,STICKER:3}).value("STICKER_COLLECTION_CATEGORY_PRE_FETCH_COUNT",5),angular.module("ringid.config").constant("OPERATION_TYPES",{SYSTEM:{REQUEST_TYPE:{KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:114,TYPE_NEWS_FEED:88,TYPE_MY_NEWS_FEED:94,TYPE_FRIEND_NEWSFEED:110,TYPE_GROUP_NEWS_FEED:198,TYPE_MEDIAS_NEWS_FEED:87,TYPE_NEWS_PORTAL_FEED:295,TYPE_BUSINESS_PAGE_FEED:306,TYPE_COMMENTS_FOR_STATUS:84,ACTION_SHARE_STATUS:191,ACTION_GET_FULL_COMMENT:137,TYPE_ADD_MULTI_IMAGE:117,TYPE_ADD_STATUS:177,NEWS_FEED_TYPE_IMAGE:1,NEWS_FEED_TYPE_STATUS:2,NEWS_FEED_TYPE_MULTIPLE_IMAGE:3,NEWS_FEED_TYPE_ALBUM:4,NEWS_FEED_TYPE_AUDIO:5,NEWS_FEED_TYPE_VIDEO:6,TYPE_SINGLE_IMAGE_STATUS:1,TYPE_TEXT_STATUS:2,TYPE_MULTI_IMAGE_STATUS:3,TYPE_DELETE_STATUS:179,TYPE_EDIT_STATUS:178,TYPE_LIKE_STATUS:184,TYPE_UNLIKE_STATUS:186,TYPE_ADD_STATUS_COMMENT:181,TYPE_LIKE_COMMENT:123,TYPE_UNLIKE_COMMENT:125,TYPE_DELETE_STATUS_COMMENT:183,TYPE_EDIT_STATUS_COMMENT:189,TYPE_LIKES_FOR_STATUS:92,TYPE_LIST_LIKES_OF_COMMENT:116,TYPE_TAG_USER_LIST:274,TYPE_WHO_SHARES_LIST:249,TYPE_UPDATE_ADD_STATUS:377,TYPE_UPDATE_EDIT_STATUS:378,ACTION_UPDATE_SHARE_STATUS:391,TYPE_UPDATE_LIKE_STATUS:384,TYPE_UPDATE_UNLIKE_STATUS:386,TYPE_UPDATE_DELETE_STATUS:379,TYPE_UPDATE_ADD_STATUS_COMMENT:381,TYPE_UPDATE_LIKE_COMMENT:323,TYPE_UPDATE_UNLIKE_COMMENT:325,TYPE_UPDATE_DELETE_STATUS_COMMENT:383,TYPE_UPDATE_EDIT_STATUS_COMMENT:389,ALBUM:{TYPE_UPLOAD_ALBUM_IMAGE:85,TYPE_UPDATE_UPLOAD_ALBUM_IMAGE:90,TYPE_DELETE_ALBUM_IMAGE:176,TYPE_UPDATE_DELETE_ALBUM_IMAGE:376},AUTH:{TYPE_INVALID_LOGIN_SESSION:19,TYPE_SIGN_IN:20,TYPE_SIGN_OUT:22,TYPE_SIGN_UP:21,PHN_MAIL_VERIFICATION_CHECK:28,TYPE_SESSION_VALIDATION:76,TYPE_MULTIPLE_SESSION:75,SIGNUP_SEND_CODE_EMAIL:220,SIGNUP_SEND_CODE_PHONE:100,SIGNUP_REGISTER:126,PASSWORD_RECOVER_OPTIONS:222,PASSWORD_RECOVER_SEND_CODE:217,PASSWORD_RECOVER_VERIFY_CODE:218,PASSWORD_RECOVER:219},FRIENDS:{TYPE_CONTACT_UTIDS:29,TYPE_CONTACT_LIST:23,TYPE_PEOPLE_YOU_MAY_KNOW:31,TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:32,TYPE_FRIEND_CONTACT_LIST:107,TYPE_CONTACT_SEARCH:34,ACTION_FRIEND_SEARCH:35,TYPE_ADD_FRIEND:127,TYPE_UPDATE_ADD_FRIEND:327,TYPE_DELETE_FRIEND:128,TYPE_UPDATE_DELETE_FRIEND:328,TYPE_ACCEPT_FRIEND:129,TYPE_UPDATE_ACCEPT_FRIEND:329,TYPE_ACTION_BLOCK_UNBLOCK_FRIEND:243,TYPE_ACTION_CHANGE_FRIEND_ACCESS:244},NOTIFICATION:{TYPE_MY_NOTIFICATIONS:111,TYPE_SINGLE_NOTIFICATION:113,CLEAR_NOTIFICATION_COUNTER:195,MSG_TYPE_UPDATE_PROFILE_IMAGE:1,MSG_TYPE_UPDATE_COVER_IMAGE:2,MSG_TYPE_ADD_FRIEND:3,MSG_TYPE_ACCEPT_FRIEND:4,MSG_TYPE_ADD_GROUP_MEMBER:5,MSG_TYPE_ADD_STATUS_COMMENT:6,MSG_TYPE_LIKE_STATUS:7,MSG_TYPE_LIKE_COMMENT:8,MSG_TYPE_ADD_COMMENT_ON_COMMENT:9,MSG_TYPE_SHARE_STATUS:10,MSG_TYPE_LIKE_IMAGE:11,MSG_TYPE_IMAGE_COMMENT:12,MSG_TYPE_LIKE_IMAGE_COMMENT:13,MSG_TYPE_LIKE_AUDIO_MEDIA:17,MSG_TYPE_AUDIO_MEDIA_COMMENT:18,MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:19,MSG_TYPE_AUDIO_MEDIA_VIEW:20,MSG_TYPE_LIKE_VIDEO_MEDIA:21,MSG_TYPE_VIDEO_MEDIA_COMMENT:22,MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:23,MSG_TYPE_VIDEO_MEDIA_VIEW:24,MSG_TYPE_YOU_HAVE_BEEN_TAGGED:25,MSG_TYPE_UPGRADE_FRIEND_ACCESS:14,MSG_TYPE_ACCEPT_FRIEND_ACCESS:15,MSG_TYPE_DOWNGRADE_FRIEND_ACCESS:16},CIRCLE:{TYPE_CREATE_GROUP:50,TYPE_GROUP_DETAILS:52,TYPE_LEAVE_GROUP:53,TYPE_GROUP_LIST:70,TYPE_GROUP_MEMBERS_LIST:99,TYPE_GROUP_MEMBERS_SEARCH_RESULT:101,TYPE_DELETE_GROUP:152,TYPE_REMOVE_GROUP_MEMBER:154,TYPE_ADD_GROUP_MEMBER:156,TYPE_EDIT_GROUP_MEMBER:158,TYPE_UPDATE_ADD_GROUP:352,TYPE_UPDATE_DELETE_GROUP:352,TYPE_UPDATE_REMOVE_GROUP_MEMBER:354,TYPE_UPDATE_ADD_GROUP_MEMBER:356,TYPE_UPDATE_EDIT_GROUP_MEMBER:358,TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:51},CHAT:{FRIEND_CHAT_REQUEST:175,FRIEND_CHAT_UPDATE:375},TAG_CHAT:{TAG_CHAT_REQUEST_START:134,TAG_CHAT_UPDATE_START:334,TAG_CHAT_REQUEST_ADD_MEMBER:135,TAG_CHAT_UPDATE_ADD_MEMBER:335},PORTAL:{ACTION_NEWSPORTAL_LIST:299,ACTION_NEWSPORTAL_CATEGORIES_LIST:294,ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL:296,ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED:300,ACTION_CONTACT_SEARCH:34},MEDIA:{ACTION_CHECK_MEDIA_IN_ALBUMS:1006,ACTION_ADD_MEDIA_CONTENT:258,ACTION_UPDATE_MEDIA_CONTENT:259,ACTION_DELETE_MEDIA_CONTENT:260,ACTION_MEDIA_ALBUM_CONTENT_LIST:261,ACTION_MEDIA_CONTENT_DETAILS:262,ACTION_ADD_MEDIA_ALBUM:253,ACTION_UPDATE_MEDIA_ALBUM:254,ACTION_DELETE_MEDIA_ALBUM:255,ACTION_MEDIA_ALBUM_LIST:256,ACTION_MEDIA_ALBUM_DETAILS:257,ACTION_MEDIA_SEARCH_RESULT:277,ACTION_SPECIFIC_MEDIA_RESULT:278,ACTION_GET_TAGGED_MEDIA_SONGS:279,ACTION_GET_MEDIA_SLIDER_IMG:1005,ACTION_GET_HASHTAG_SUGGESTION:280,ACTION_GET_TRENDING_KEYWORDS:281,ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT:272,ACTION_ADD_COMMENT_ON_MEDIA:265,ACTION_LIKE_UNLIKE_MEDIA:264,ACTION_EDIT_COMMENT_ON_MEDIA:266,ACTION_MEDIA_COMMENT_LIST:270,ACTION_MEDIA_LIKE_LIST:269,ACTION_DELETE_COMMENT_ON_MEDIA:267,ACTION_LIKE_UNLIKE_MEDIA_COMMENT:268,ACTION_MEDIACOMMENT_LIKE_LIST:271,ACTION_UPDATE_LIKE_UNLIKE_MEDIA:464,ACTION_UPDATE_ADD_MEDIA_COMMENT:465,ACTION_UPDATE_EDIT_MEDIA_COMMENT:466,ACTION_UPDATE_DELETE_MEDIA_COMMENT:467,ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:468,ACTION_UPDATE_INCREASE_MEDIA_CONTENT_VIEW_COUNT:472},IMAGE:{PROFILE_IMAGE_ALBUM_ID:"profileimages",COVER_IMAGE_ALBUM_ID:"coverimages",FEED_IMAGE_ALBUM_ID:"default",TYPE_FRIEND_ALBUM_IMAGES:109,FETCH_ALBUM_LIST:96,FETCH_FRIEND_ALBUM_LIST:108,TYPE_ALBUM_IMAGES:97,TYPE_COMMENTS_FOR_IMAGE:89,TYPE_LIKES_FOR_IMAGE:93,TYPE_IMAGE_COMMENT_LIKES:196,TYPE_LIKE_IMAGE:185,TYPE_UNLIKE_IMAGE:187,TYPE_IMAGE_DETAILS:121,TYPE_EDIT_IMAGE_COMMENT:194,TYPE_ADD_IMAGE_COMMENT:180,TYPE_LIKE_UNLIKE_IMAGE_COMMENT:197,TYPE_DELETE_IMAGE_COMMENT:182,DELETE_IMAGE:246,TYPE_UPDATE_ADD_IMAGE_COMMENT:380,TYPE_UPDATE_EDIT_IMAGE_COMMENT:394,TYPE_UPDATE_DELETE_IMAGE_COMMENT:382,TYPE_UPDATE_LIKE_IMAGE:385,TYPE_UPDATE_UNLIKE_IMAGE:387,TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:397},PROFILE:{TYPE_CHANGE_COVER_PIC:103,TYPE_CHANGE_PROFILE_PIC:63,TYPE_REMOVE_PROFILE_IMAGE:43,TYPE_REMOVE_COVER_IMAGE:104,TYPE_ACTION_USER_MOOD:193,TYPE_ACTION_USER_MOOD_PRESENCE:199,FETCH_FRIEND_MUTUAL_FRIEND_LIST:118,CHANGE_PASSWORD:130,ACTION_USERS_PRESENCE_DETAILS:136,ACTION_USERS_PRESENCE_DETAILS_DATA:336,TYPE_ACTION_CURRENT_USER_BASICINFO:21,TYPE_ACTION_OTHER_USER_BASICINFO:95,TYPE_ACTION_GET_USER_DETAILS:204,TYPE_ACTION_LIST_WORK_AND_EDUCATIONS:230,TYPE_ACTION_MODIFY_USER_PROFILE:25,TYPE_ACTION_MODIFY_PRIVACY_SETTINGS:74,TYPE_CHANGE_PRIVACY:216,TYPE_CHANGE_FRIEND_PRIVACY:82,SEND_VERIFICATION_CODE_TO_MAIL:221,SEND_VERIFICATION_CODE_TO_PHONE:212,TYPE_ACTION_ADD_EDUCATION:231,TYPE_ACTION_UPDATE_EDUCATION:232,TYPE_ACTION_REMOVE_EDUCATION:233,TYPE_ACTION_GET_WORK:234,TYPE_ACTION_GET_EDUCATION:235,TYPE_ACTION_GET_SKILL:236,TYPE_ACTION_ADD_SKILL:237,TYPE_ACTION_UPDATE_SKILL:238,TYPE_ACTION_REMOVE_SKILL:239,TYPE_ACTION_ADD_WORK:227,TYPE_ACTION_UPDATE_WORK:228,TYPE_ACTION_REMOVE_WORK:229,ADD_SOCIAL_NETWORK:276},REPORT:{ACTION_SPAM_REASON_LIST:1001,ACTION_REPORT_SPAM:1002},FETCH_EMOTION_LIST:273},STICKER:{GET_MY_STICKER:206,ADD_REMOVE_STICKER:207,ADD_JT_VALUE:1,REMOVE_JT_VALUE:3}}),function(e,t){"use strict";e.module("ringid.language",[])}(angular,window),angular.module("ringid.language").factory("languageConstant",function(){var e={default:{add_friend:"Add Friend",remove_friend:"Remove Friend",common_friend:"Common Friend",request_sent:"Request Sent",unfriend:"Unfriend",block:"Block",unblock:"UnBlock",edit:"Edit",update:"Update",delete:"Delete",cancel:"Cancel",save:"Save",text_add:"Add",accept:"Accept",remove:"Remove",change:"Change",
send:"Send",verify:"verify",add:"Add"}};return{set:function(t){e[t]={}},get:function(t,n){return t=t||"default",e[t]}}}),function(e,t){"use strict";e.module("ringid.connector",["ngWebSocket","ringid.config"])}(angular,window),angular.module("ringid.connector").factory("$$rgsyncher",rgSynchar),rgSynchar.$inject=["$$stackedMap","$rootScope","Utils"];function rgSynchar(e,t,n){var r=e.createNew(),i=function(){r.length()>0&&o()},o=function(){var e;r.doForAll(function(t){e=t.call(null),e&&!e.$$phase&&e.$digest()})};return t.$on("ringActive",i),{add:function(e){var t=n.getUniqueID();return r.add(t,e),t},remove:function(e){return r.remove(e)},synch:i}}angular.module("ringid.connector").service("mergerService",mergerService),mergerService.$inject=["$$q"];function mergerService(e){var t={defer:function(){var t=e.defer(),n={};return{resolve:function(e){var r,i,o,a;if(e.seq||e.totalPacket){if(r=e.pckId,n[e.pckId]||(n[e.pckId]=[]),t.notify(e),e.seq?(i=e.seq.lastIndexOf("/"),o=e.seq.substr(0,i),a=e.seq.substr(i+1,e.seq.length)):(o=e.packetNo,a=e.totalPacket),n[e.pckId]["sq"+o])return!0;if(n[e.pckId]["sq"+o]=!0,n[e.pckId].push(e),a!=n[e.pckId].length)return!0;for(var s={},c=0;c<n[e.pckId].length;c++)for(r in n[e.pckId][c])n[e.pckId][c][r]instanceof Array?s[r]=(s[r]||[]).concat(n[e.pckId][c][r]):s[r]=n[e.pckId][c][r];t.resolve(s),delete n[e.pckId]}else t.resolve(e)},promise:t.promise}}};return t}angular.module("ringid.connector").factory("$$connector",$$connector),$$connector.$inject=["settings","Storage","$rootScope","$websocket","$$stackedMap","ATTRIBUTE_CODES","Utils","$$q","OPERATION_TYPES","CLIENT_DATA_SIZE","mergerService"];function $$connector(e,t,n,r,i,o,a,s,c,l,u){var d,g=(t.getCookie("sessionID"),t.getCookie("uId"),{}),m=!1,f=(Date.now(),!1),E=i.createNew(),p=[],T=i.createNew();function h(e){return function(t){if(!t||!t.actn)return!1;if(!angular.isArray(e))return t.actn===e;for(var n=0;n<e.length;n++)if(t.actn===e[n])return!0;return!1}}function _(e){if(g[e.pckId]===!0)return!0;if(g[e.pckId]){var t=g[e.pckId].resolve.call(g[e.pckId],e);return t||(g[e.pckId]=!!t,setTimeout(function(){delete g[e.pckId]},3e3)),!0}return!1}function I(e){var t=!1;return E.length()>0&&E.doForAll(function(n){var r,i=n.filter;i?angular.isFunction(i)&&(r=i.call(null,e),r&&(t=!0,n.fn.call(n,e))):n.fn.call(null,e)}),t}function A(e){if(e){var t,n;if(e.actn===c.SYSTEM.AUTH.TYPE_INVALID_LOGIN_SESSION)return void I(e);e.hasOwnProperty("pckId")&&(t=_(e)),t||(n=I(e),n||p.push(e))}}function v(){window.onbeforeunload=function(){if(n.unloadWarn)return"You have unsaved changes.  Do you want to leave this page and lose your changes?"}}function S(e,t,n,r){var i;if(i=e.pckId||a.getUniqueID(),e.pckId=i,n&&(g[i]=n),e)return RingWorker.send(e,i,t,r)}function C(e,t,n,r){var i,o=n?u.defer():s.defer();return i=S(e,t,o,r),o.promise}return d={init:v,close:function(){},send:function(e,t,n){S(e,t,!1,n)},request:function(e,t,n){return C(e,t,!1,n)},pull:function(e,t,n){return C(e,t,!0,n)},subscribe:function(e,t){var r,i,o=[];if(t=t||{},t.key=t.key||a.getUniqueID(),t.scope=t.scope||n,t.autoApply=!1,t.fn=e||angular.noop,!t.filter&&t.action&&(t.filter=h(t.action)),E.add(t.key,t),t.callWithUnresolved){for(r=0;r<p.length;r++)i=t.filter.call(null,p[r]),i?t.fn.call(null,p[r]):o.push(p[r]);p.length=0,p=o}return t.key},unsubscribe:function(e){E.remove(e)},stop:function(){m=!0},resume:function(){m=!1},reset:function(){},addInterval:function(e){var t=a.getUniqueID();return T.add(t,e),t},removeInterval:function(e){T.remove(e)},keepAlive:function(){f=!0,RingWorker.pushMessage({command:"KEEPALIVE",aSkey:t.getCookie("sId"),uKey:t.getCookie("uId")})},notifyRouteChange:function(){RingWorker.pushMessage({command:"ROUTE_CHANGE"})}},n.$on("ringInactive",function(e){}),n.$on("$locationChangeStart",function(e){}),RingWorker.addCallback("received",function(e){A(e.data)}),RingWorker.addCallback("event",function(e){e.name&&n.$broadcast(e.name)}),d}!function(e,t){"use strict";e.module("ringid.global_services",["ringid.config","ringid.connector","ringid.utils","ui-notification"])}(angular,window),angular.module("ringid.global_services").factory("$$userMap",["settings","$$stackedMap","$filter","Utils","Storage","Contacts","$$q","Api",function(e,t,n,r,i,o,a,s){var c={0:"p",1:"desktop",2:"android",3:"iphone",4:"windows",5:"web"},l={fn:"",uId:0,cnty:"",el:"",gr:"",am:"",mblDc:"",mbl:"",prIm:"images/prof.png",cIm:"images/default_cover.jpg",prImId:0,cImId:0,cimX:0,cimY:0,bDay:"",blc:0,re:"",utId:0,tf:0,nmf:0,chta:0,cla:0,fda:0,cc:"",hc:"",adt:0,iev:0,imnv:0,isnp:0,isbusn:0,psnc:0,lot:0,mood:0,apt:0,dt:"",frnS:0,ct:0,nct:0,pimX:0,pimY:0,bv:0,owner:0,basicInfo:!1,privacyInfo:{}};function u(e,t,n,r){this.groups={},this.updateUserObj(e),this.isCurrent=n,this.isProfile=t,this.requestedMutualFriend=!1,this.loading=!1,this.user.psnc=this.isCurrent?2:this.user.psnc,this.user.dvc=this.isCurrent?5:this.user.dvc,e.hasOwnProperty("grpId")&&(this.groups[e.grpId]=e.admin);var i=!0;"fetchDetails"in e&&!e.fetchDetails&&(i=!1),e=null,!i||this.user.prIm&&this.user.uId&&this.user.utId&&(this.user.nmf||!r)||this.requestUserDetails(!!r)}return u.prototype={updateUserObj:function(e){e=e||{},this.user?angular.extend(this.user,e):this.user=angular.extend({},l,e),e.grpId&&(this.groups[e.grpId]=e.admin),""===this.user.prIm&&(this.user.prIm="images/prof.png"),""===this.user.cIm&&(this.user.cIm="images/default_cover.jpg"),0===this.user.frnS&&(this.user.frnS=o.getFrns(this.user.utId).frnS||this.user.frnS),e.mfc&&(this.user.nmf=e.mfc),e.mutualFriends&&(this.user.nmf=e.mutualFriends),this.user.uId=this.user.uId.toString(),this.user.utId=this.user.utId.toString(),e=null},fetchPresence:function(){var e=this;s.user.fetchUserPresence([this.user.uId]).then(function(t){e.updateUserObj(t)})},requestUserDetails:function(e){var t,n={},r=this;if(this.user.utId&&"0"!=this.user.utId?n.utId=this.user.utId:this.user.uId&&(n.uId=this.user.uId),n.utId||n.uId)return e&&(this.requestedMutualFriend=!0),t=s.user.getUserDetails(n,!!e,this.user.isnp),t.then(function(e){e.sucs&&r.updateUserObj(e.userDetails)}),t},getName:function(){return this.user.fn},getCardTemplate:function(){return this.user.isnp||this.user.isbusn?"pages/partials/hovercards/portal-profile-hover.html":"pages/partials/hovercards/profile-hover.html"},avatar:function(t){var n=this.user.prIm||"";if("iurl"===t)return n;if("original"===t)return e.imBase+n;if(n.indexOf("prof.png")>0)return n;n=n.replace("profileimages/",""),"original"===t?t="":t||(t="crp"),t=(/\/uploaded\//.test(n)?"":"p")+t;var r=n.lastIndexOf("/")+1;return n=[e.imBase,n.slice(0,r),t,n.slice(r)].join(""),n.indexOf("prof.png")>0?this.user.prIm:n},getKey:function(){return this.user.uId||this.user.utId},getUId:function(){return this.user.uId},setUid:function(e){this.user.uId=e},getUtId:function(){return+this.user.utId},equals:function(e,t){return t||(t="uId"),angular.isObject(e)&&(e="uId"===t?e.getKey():e.getUtId()),this.user[t]==e},link:function(){return this.user.isnp?"#/newsportal/"+this.user.uId:this.user.isbusn?"#/pages/"+this.user.uId:this.user.uId||3!==this.user.ct?e.baseUrl+r.getRingRoute("USER_PROFILE",{uId:this.user.uId,utId:this.user.utId})+(1===this.user.frnS||this.isCurrent?"":"/about"):""},getRingNumber:function(){return this.user.uId.replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")},navActiveLink:function(){if(this.user.uId||this.user.utId){var e="/profile/"+this.user.uId+"/post";return e}return""},toString:function(){return this.user.uId},friendshipStatus:function(){return 0===this.user.frnS?o.getFrns(this.user.utId).frnS||this.user.frnS:this.user.frnS},isLoading:function(e){return"undefined"==typeof e?this.user.loading:(this.user.loading=e,this.user.loading)},commonFriends:function(e,t){var n;return(!this.user.nmf&&!this.requestedMutualFriend||e)&&(n=this.requestUserDetails(!0)),t?n||a.when(this.user.nmf):this.user.nmf},isCurrentUser:function(){return this.isCurrent},sortBy:function(){return this.user.adt},getLiteUser:function(){return this},isAdmin:function(e){return!!this.groups.hasOwnProperty(e)&&this.groups[e]},setGroupAdmin:function(e){this.groups[e]=!0},removeGroupAdmin:function(e){delete this.groups[e]},overwriteInfo:function(e){this.user.prIm=e.prIm||this.user.prIm},haveProfileData:function(){return this.isProfile},getBasicInfo:function(){var e=r.profileVerbalDate(this.user.bDay),t=r.profileVerbalDate(this.user.mDay);return{fn:this.user.fn||"",birthDay:this.user.bDay||"",mDay:this.user.mDay||"",birthday:e,marriageDay:t,el:this.user.el||"",hc:this.user.hc.trim()||"",cc:this.user.cc.trim()||"",gr:this.user.gr||"",am:this.user.am.trim()||"",uId:this.user.uId.toString().substring(2)||""}},resetCover:function(){0!==this.user.cImId&&(this.user.cImId=0,s.user.removeCover(this.user.cIm)),this.user.cIm="images/default_cover.jpg"},getCover:function(t){var n,r,i=this.user.cIm;return"iurl"===t?i:t&&"original"===t?e.imBase+i:i?i.indexOf("default")>0?i:i.indexOf("web")>0?e.imBase+i:(n=(/\/uploaded\//.test(i)?"":"p")+(t||"crp"),r=i.lastIndexOf("/")+1,i=[e.imBase,i.slice(0,r),n,i.slice(r)].join("")):"images/default_cover.jpg"},getCoverXY:function(){return{x:this.user.cimX,y:this.user.cimY}},setCover:function(e){this.user.cIm=e.iurl,this.user.cimX=e.cimX,this.user.cimY=e.cimY,this.user.cImId=e.cImId},getAvatarXY:function(){return{x:this.user.pimX,y:this.user.pimY}},setProfileImage:function(e,t){this.user.prIm=e,this.user.prImId=t},setName:function(e){this.user.fn=e},setAboutMe:function(e){this.user.am=e},setHomeCity:function(e){this.user.hc=e},setCurrentCity:function(e){this.user.cc=e},setGender:function(e){this.user.gr=e},setBirthday:function(e){this.user.bDay=e},setMarriageday:function(e){this.user.mDay=e},getEmail:function(){return this.user.el},getMobileDc:function(){return this.user.mblDc},getMobileNumber:function(){return this.user.mbl},getCountry:function(){return this.user.cnty},friendType:function(){return this.user.ct},setFriendType:function(e){this.user.ct=e},newFriendType:function(){return this.user.nct},getLink:function(e){var t="";if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+'="'+e[n]+'" ');return"<a "+t+' href="'+this.link()+'">'+this.user.fn+"</a>"},resetAvatar:function(){0!==this.user.prImId&&(this.user.prImId=0,s.user.removeAvatar(this.user.prIm)),this.user.prIm="images/prof.png"},avatarXY:function(){return{x:this.user.pimX,y:this.user.pimY}},getBday:function(){return this.user.bDay},getUserMood:function(){return this.user.mood},setUserMood:function(e){this.user.mood=e},getAppType:function(){return this.user.apt},setAppType:function(e){this.user.apt=e},getDeviceToken:function(){return this.user.dt},setDeviceToken:function(e){this.user.dt=e},isBlocked:function(){return 0===this.user.cla&&0===this.user.chta&&0===this.user.fda?this.user.bv=1:this.user.bv=0,this.user.bv},setBlock:function(e){var t;t=1===e?0:1,this.user.cla=t,this.user.chta=t,this.user.fda=t,this.user.bv=e},isFriend:function(){return 1===this.user.frnS},unFriend:function(){this.user.frnS=0},getAccess:function(){return{chta:this.user.chta,cla:this.user.cla,fda:this.user.fda}},canChat:function(){return 1===this.user.chta},canSeeFeed:function(){return 1===this.user.fda},setOnlineStatus:function(e){this.user.psnc=e},getOnlineStatus:function(){return this.user.psnc},isOnline:function(){return 2===this.user.psnc&&1===this.user.mood},onlineDevice:function(){return c[this.user.dvc]},getPlatform:function(){return this.user.dvc},setPlatform:function(e){this.user.dvc=e},lastOnline:function(){return 0!==this.user.lot&&r.verbalDate(this.user.lot)},getProfileImageId:function(){return this.user.prImId},getCoverImageId:function(){return this.user.cImId},isEmailVerified:function(){return this.user.iev},isMobileVerified:function(){return this.user.iev},isNewsPortalUser:function(){return this.user.isnp},isBusinessPageUser:function(){return this.user.isbusn},toggleMood:function(e){this.user.mood=e?1:2,s.user.changeMood(this.user.mood).then(function(e){e.sucs!==!0&&(this.user.mood=e.mood)})},hasDetails:function(){return!!(this.user.prIm&&this.user.uId&&this.user.utId&&this.user.fn)}},function(e,t,n,r,i){return new u(e,t,n,r,i)}}]).factory("userFactory",["$$userMap","$$stackedMap",function(e,t){var n=t.createNew(),r={},i="ru_",o={getSortIndex:function(){return"adt"},create:function(t,o,a){o=!!o,a=!!a;var s,c;return angular.isObject(t)?t.uId?(t.uId=t.uId.toString(),s=t.uId,s=i+s,c=n.get(s)):t.utId?(t.utId=t.utId.toString(),c=r[t.utId],c||(c=!1)):c=!1:(s=i+t,c=n.get(s)),c===!1?t.utId&&r[t.utId]?(c=r[t.utId],s=i+t.uId,n.save(s,c),c.updateUserObj(t)):(c=e(t,o,a),c.getUtId()&&(r[c.getUtId()]=c)):c.updateUserObj(t),n.save(s,c),c},createByUtId:function(t,n,i){return r[t.utId]||(r[t.utId]=e(t,!1,!1,i)),n?r[t.utId].getLiteUser():r[t.utId]},createByUId:function(e,t){var n={uId:e,fetchDatails:!1},r=o.create(n);return r.hasDetails()?t&&t({fetchedDetails:!1}):r.requestUserDetails().then(function(e){var n={sucs:e.sucs,fetchedDetails:!0,rc:e.rc};t&&t(n)}),r},getUser:function(e){return e=i+e,n.get(e)},getByUtId:function(e){return e&&r[e]||!1},getAllUtIds:function(){return Object.keys(r)},getUIdByUtId:function(e){return r[e]&&r[e].getUId()},getUtIdByUId:function(e){var t;try{t=o.getUser(e)}catch(e){}return t&&t.getUtId()}};return o}]),angular.module("ringid.global_services").service("userService",userService),userService.$inject=["userFactory","Utils"];function userService(e,t){var n=this,r={},i={},o={},a=!1;n.register=function(e,o,a,s){if("undefined"==typeof s&&(s=!0),e){var c=arguments,l=n;r[e]||(r[e]=[]);var u=t.getUniqueID("us");return i[u]=function(){o.call(a,c),s&&l.unregister(u)},r[e].push(u),n.start(),u}},n.trigger=function(e){if(r[e]){var t=[];r[e].forEach(function(e){i[e]&&(i[e].call(null),i[e]&&t.push(e))}),r[e]=t}},n.unregister=function(e){i[e]&&delete i[e]},n.fetchUser=function(t){o[t]||(o[t]=!0,e.createByUId(t,function(e){delete o[t],n.start()}),n.start())},n.start=function(){a||(a=!0,setTimeout(function(){for(var t=Object.keys(r),i=0;i<t.length;i++){var o=t[i],s=e.getUser(o);s&&s.hasDetails()?n.trigger(o):n.fetchUser(o)}a=!1}))}}angular.module("ringid.global_services").factory("Api",ApiFactory),ApiFactory.$inject=["OPERATION_TYPES","$$connector","settings","$ringhttp"];function ApiFactory(e,t,n,r){var i=e.SYSTEM,o=e.SYSTEM.REQUEST_TYPE;function a(e){return t.request({actn:i.PROFILE.TYPE_ACTION_USER_MOOD,mood:e},o.AUTHENTICATION)}function s(e,n,r,a){var s={actn:i.PROFILE.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!n};return r&&(s.pType=3),a&&(s.pType=4),angular.extend(s,e),t.request(s,o.REQUEST,!0)}function c(e){return t.pull({actn:i.PROFILE.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:e.getUId()},o.REQUEST)}function l(e){var n={actn:i.PROFILE.ACTION_USERS_PRESENCE_DETAILS,uIds:e};return t.request(n,o.REQUEST)}function u(){return r.get(n.baseUrl+"/resources/countries.json")}function d(e){var n={actn:i.MEDIA.ACTION_MEDIA_CONTENT_DETAILS,cntntId:e.cntntId,utId:e.utId};return t.request(n,o.REQUEST)}function g(e){var n={actn:i.PROFILE.TYPE_REMOVE_PROFILE_IMAGE,prIm:e};return t.request(n,o.UPDATE)}function m(e){var n={actn:i.PROFILE.TYPE_REMOVE_COVER_IMAGE,cIm:e};return t.request(n,o.UPDATE)}function f(e){return t.request({actn:i.PROFILE.SEND_VERIFICATION_CODE_TO_PHONE,mbl:e.mbl,mblDc:e.mblDc,pkd:!0},o.REQUEST)}return{fetchCountryList:u,user:{changeMood:a,getUserDetails:s,getMutualFriends:c,fetchUserPresence:l,removeAvatar:g,removeCover:m,verifyPhoneNo:f},media:{fetchDetails:d}}}angular.module("ringid.global_services").factory("Utils",UtilsFactory),UtilsFactory.$inject=["$window","$document","RING_ROUTES","$filter","APP_CONSTANTS","StickerEmoticonFactory","StickerEmoticonService","$q","Storage","$rootScope","MESSAGES","SystemEvents","GlobalEvents","$ringhttp","settings"];function UtilsFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f){var E=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,p=o.getEmoticonPattern(),T=a.getEmoticonMap(),h={x:0,y:0,yo:0};function _(){var n=e,r=t,i=r[0].documentElement,o=r[0].getElementsByTagName("body")[0];return h.x=n.innerWidth||i.clientWidth||o.clientWidth,h.y=n.innerHeight||i.clientHeight||o.clientHeight,h.yo=n.pageYOffset,h}_();function I(e,t,n,r){var i=1;return(e>n||t>r)&&(i=Math.min(n/e,r/t)),{width:e*i,height:t*i}}var A=function(t){return t||(t=""),t+(window._cti||"")+e.Math.floor(e.Math.random()*(new e.Date).getTime())},v=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},S=function(e){return/^(f|ht)tps?:\/\//i.test(e)||(e="http://"+e),e},C=function(e,t){e=v(e);var n=e,r=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return t||(t=0),"blob:http"===n.substring(0,9)&&(n='<img width="100%" src="'+n+'" />',t=2),0===t&&(n=n.replace(E,function(e){var t=S(e);return'<a class="feedanchor" target="_blank" href="'+t+'">'+e+"</a>"})),n=n.replace(p,function(e){return'<span class="em_list '+T[e].replace(/\.[A-Za-z]{3}/,"")+'" data-link="'+e+'" title="'+e+'">&nbsp;</span>'}),window.emojiSupported||(n=n.replace(r,function(e){var t,n,r;return t=e.charCodeAt(0),n=e.charCodeAt(1),r=(1024*(t-55296)+(n-56320)+65536).toString(16),'<u class="emo_list U_'+r+'"></u>'})),1===t&&(n=e),n};function D(e,t){return C(e,t)}function M(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0),n.data=t,document.dispatchEvent(n)}function y(e,t){var n=function(e){t.call(this,e.data||{})};return document.addEventListener(e,n),n}function N(e,t){document.removeEventListener(e,t)}function b(e){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function O(){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t}function P(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return n===r&&(r=t.clientWidth),document.body.removeChild(t),e=t=null,n-r}function R(e,t){if(!n[e])return"";var r,i=n[e];switch(e){case"HOME":case"FAQ":break;case"SINGLE_FEED":t.feedId&&(i=i.replace(":feedId",t.feedId));var o=t.shared?"shared":"";i=i.replace(":shared?",o),o?(r=t.commentId||0,i=i.replace(":commentId?",r)):(r=t.commentId||"",i=i.replace(":commentId?/",r));break;case"WHO_SHARED_FEED":t.feedId&&(i=i.replace(":feedId",t.feedId)),r=t.commentId||"",i=i.replace(":commentId?",r);break;case"SINGLE_IMAGE":t.imageId&&(i=i.replace(":imageId",t.imageId)),r=t.commentId||"",i=i.replace(":commentId?",r);break;case"SINGLE_MEDIA":t.mediaId&&(i=i.replace(":mediaId",t.mediaId)),r=t.commentId||"",i=i.replace(":commentId?",r);break;case"USER_PROFILE":t.uId&&(i=i.replace(":uId",t.uId)),i=t.utId?i.replace(":utId",t.utId):i.replace("/:utId",""),i=t.albumId?i.replace(":albumId?",t.albumId):i.replace("/:albumId?","");break;case"CIRCLE_HOME":t.circleId&&(i=i.replace(":circleId",t.circleId))}return i=t.subpage?i.replace(":subpage?",t.subpage):i.replace("/:subpage?",""),"/#"+i}function U(e){return r("date")(e,"yyyy-MM-dd")}function L(e){var t=e.split(","),n=new Uint8Array(t);return n.buffer}function F(e){var t=new Uint8Array(e);return Array.prototype.join.call(t,",")}function w(e){var t=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return!!e&&(t.test(e)||p.test(e))}function k(t,n){var i,o,a,s=e.Math,c=new Date;if(n=n||Date.now(),isNaN(t)?(i=new Date((t||"").replace(/-/g,"/").replace(/[TZ]/g," ")),t=i.getTime()):i=new Date(t),o=(n-t)/1e3,a=s.floor(o/86400),isNaN(a))return"";switch(!0){case a<1:switch(!0){case o<60:return"just now";case o<120:return"1 minute ago";case o<3600:return s.floor(o/60)+" minutes ago";case o<7200:return"1 hour ago";case o<86400:return s.floor(o/3600)+" hours ago";default:return r("date")(t,"MMM d, h:mm a")}break;case 1===a:return"yesterday at "+r("date")(t,"h:mm a");case a<7:return r("date")(t,"EEEE 'at' h:mm a");case a<365:return c.getUTCFullYear()===i.getUTCFullYear()?r("date")(t,"MMMM d 'at' h:mm a"):r("date")(t,"MMMM d yyyy 'at' h:mm a");default:return r("date")(t,"MMM d, yyyy")}}function $(){h||_();var e=h.x;return e<1280?1:e>=1280&&e<=1800?2:e>1800?3:void 0}function G(e,t,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||e.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}}function B(e){var t,n,r,i=";base64,";if(e.indexOf(i)===-1)return t=e.split(","),n=t[0].split(":")[1],r=decodeURIComponent(t[1]),new Blob([r],{type:n});t=e.split(i),n=t[0].split(":")[1],r=window.atob(t[1]);for(var o=new Uint8Array(r.length),a=0;a<r.length;++a)o[a]=r.charCodeAt(a);return new Blob([o],{type:n})}function x(e){return r("date")(e,"h:mm a")}var H=function(e,t,n){n||(n="({0},{1})".format(e,t));var r="https://maps.googleapis.com/maps/api/staticmap?center={0},{1}&zoom=18&size=640x170&key={3}&markers=color:orange|label:A|{2}|{0},{1}";return r=r.format(e,t,n,i.GOOGLE_MAP_KEY)},Y=function(e,t,n,r){var i;return i=e&&t?"https://maps.google.com/maps?q={0},{1}&hl=en;z=18;iwd=1".format(e,t):"http://maps.google.com?q={0}".format(n),r&&(i+="&output=embed"),i};function K(e){var t=s.defer(),n=t.promise,r=c.getData("uLocationInfo");return r&&r.lat?(r.sucs=!0,n=r):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var r=n.coords.latitude,i=n.coords.longitude,o={lat:r,lng:i};if(e){var a=new google.maps.Geocoder;a.geocode({location:o},function(e,n){n===google.maps.GeocoderStatus.OK?(c.setData("uLocationInfo",{lat:r,lng:i,description:e[1].formatted_address}),t.resolve({sucs:!0,lat:r,lng:i,description:e[1].formatted_address})):(c.setData("uLocationInfo",{lat:r,lng:i}),t.resolve({sucs:!0,lat:r,lng:i}))})}else c.setData("uLocationInfo",{lat:r,lng:i}),t.resolve({sucs:!0,lat:r,lng:i})},function(e){t.resolve({sucs:!1,error:e})}),s.when(n)}function j(){return document.title}function V(e,t){document.title=e,t&&l.$broadcast("PAGE_TITLE_CHANGE",{title:e})}function W(e){return e.mg?e.mg:q(e.rc)}function q(e){return u["RC"+e]?u["RC"+e]:""}function z(){var e=$(),t=parseInt(c.getCookie("col"));return!t||t>e?e=e>2?2:e:t}var Q,X,Z,J=500;function ee(){Q=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,X=0,Z=-1*Q}function te(){X+=25;var e=Math.easeIn(X,Q,Z,J);document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e,X<J&&requestAnimationFrame(te)}function ne(e){return m.get(f.ogServiceUrl+"?url="+encodeURIComponent(e))}function re(e){var t=s.defer(),n=new Image;return n.onload=function(){t.resolve({imgUrl:this.src,width:this.width,height:this.height})},n.src=e,setTimeout(function(){t.resolve({width:0,height:0})},3e4),t.promise}function ie(e,t){var n=s.defer(),r=[];return t.width||(t.width=0),t.height||(t.height=0),angular.forEach(e,function(i){setTimeout(function(){re(i).then(function(i){var o,a;i.width&&i.width>=t.width&&(o=!0),i.height&&i.height>=t.height&&(a=!0),o&&a&&(r.push(i.imgUrl),r.length==e.length?n.resolve(i.imgUrl):n.notify(i.imgUrl))})})}),setTimeout(function(){0==r.length&&n.resolve([])},2e4),n.promise}function oe(e){c.setCookie("col",parseInt(e))}function ae(e){requestAnimationFrame(function(){_(),l.windowHeight=h.y,l.windowWidth=h.x,l.$broadcast(d.COMMON.WINDOW_RESIZED,h)}),e.preventDefault()}return g.bindHandler("window","resize",ae),g.bindHandler("window","scroll",ae),{generateUUID:O,tabId:window._cti,viewport:h,viewportsize:_,scrollbarWidth:P(),getUniqueID:A,triggerCustomEvent:M,onCustomEvent:y,removeCustomEvent:N,getRingRoute:R,profileVerbalDate:U,verbalDate:k,getScaledImageSize:I,debounce:G,dataURLToBlob:B,string2ArrayBuffer:L,arrayBuffer2String:F,safeDigest:b,chatVerbalDate:x,parseForLE:D,getGoogleMapJSUrl:Y,getGoogleMapStaticUrl:H,hasEmoticon:w,getUserLocation:K,getCurrentPageTitle:j,setPageTitle:V,getReasoneMessage:q,getReasonMessageFromResponse:W,getDefaultColumn:$,feedColumn:z,animateScroll:te,resetScroll:ee,getOGDetails:ne,filterImagesByDimentions:ie,setFeedColumn:oe}}angular.module("ringid.global_services").factory("$ringhttp",ringhttp),ringhttp.$inject=["settings","$templateCache"];function ringhttp(e,t){var n=(new Date).getTime(),r={},i=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.response}return[t,e]};function o(o,a,s,c,l){var u=!1,d=0,g={success:function(){},error:function(){},abort:function(){},progress:function(){}},m=a;a=/^(http|https):\/\//.test(a)?a:e.baseUrl+(0===a.indexOf("/")?a:"/"+a);var f={success:function(e){return g.success=e,f},error:function(e){return g.error=e,f},abort:function(e){return g.abort=e,f},progress:function(e){return g.progress=e,f},abortRequest:function(){E.abort()}};try{var E=new XMLHttpRequest;u="GET"===o&&/\.html$/.test(a),u&&r.hasOwnProperty(m)?r[m].push(g):u&&t.get(m)?setTimeout(function(){g.success.apply(g,[t.get(m),E])}):(u&&(a=a+"?time="+n,r[m]=[],r[m].push(g)),E.open(o,a,!0),E.responseType=c||"text",E.onreadystatechange=function(){var e;4===E.readyState&&(200===E.status?(e=i(E),u?(t.put(m,e[0]),r[m].forEach(function(e){e.success.apply(e,[t.get(m),E])}),delete r[m]):(g.progress.apply(g,[100]),g.success.apply(g,e))):g.error.apply(g,e))},E.upload.onabort=function(){g.abort.apply(g)},E.upload.onprogress=function(e){d=Math.round(e.loaded/e.total*100),d=d>0?d-1:d,g.progress.apply(g,[d])},E.send(s))}catch(e){}return f}return{get:function(e,t,n){return o("GET",e,t,n)},post:function(e,t,n){return o("POST",e,t,n)}}}angular.module("ringid.global_services").factory("GlobalEvents",GlobalEvents);function GlobalEvents(){var e={};function t(t){if(3!==t.which&&0!==e[t.type].length)for(var n=0,r=e[t.type].length;n<r;n++)e[t.type][n].call(null,t)}return{bindHandler:function(n,r,i){if(e.hasOwnProperty(r)||(e[r]=[]),e[r].push(i),1===e[r].length)switch(n){case"document":document.addEventListener(r,t);break;case"window":window.addEventListener(r,t);break;default:document.addEventListener(r,t)}},unbindHandler:function(n,r,i){setTimeout(function(){if(e[r].splice(e[r].indexOf(i),1),0===e[r].length)switch(n){case"document":document.removeEventListener(r,t);break;case"window":window.removeEventListener(r,t);break;default:document.removeEventListener(r,t)}})}}}angular.module("ringid.global_services").factory("Ringalert",Ringalert),Ringalert.$inject=["$ringbox","Notification","MESSAGES"];function Ringalert(e,t,n){var r={delay:3e3,positionX:"right",positionY:"top",replaceMessage:!0},i={title:"Warning",message:"Click ok to continue",showOk:!0,showCancel:!0,craac:!1,textOk:"OK",textCancel:"Cancel",okCallback:angular.noop,cencelCallback:angular.noop};return{show:function(e,i){i=i||"info",angular.isString(e)&&(e={message:e}),e.message=e.message||e.mg,e.message||("success"===i?e.message=n.REQUEST_PROCESSED:"error"===i&&(e.message=n.REQUEST_FAILED));try{t[i](angular.extend({},r,e))}catch(e){}},clear:function(){t.clearAll()},alert:function(t){t=t||{},t=angular.extend({},i,t);var n=e.open({type:"remote",scope:!1,scopeData:t,templateUrl:t.templateUrl||"templates/popups/ring-alert.html"});n.result.then(function(e){var n="string"==typeof e?e:e.sucs;"ok"===n&&angular.isFunction(t.okCallback)?t.okCallback.call(null,e):t.cencelCallback.call(null,e)})}}}angular.module("ringid.global_services").factory("$$stackedMap",function(){return{createNew:function(e,t){var n=[],r=this;e=e||!1,t=t||"desc";function i(e){e=e||"sortBy";var r=-1,i=1;"desc"===t&&(r=1,i=-1),n.sort(function(t,n){return n.value[e]()>t.value[e]()?r:t.value[e]()>n.value[e]()?i:0})}function o(e){for(var t=0;t<n.length;t++)if(e==n[t].key)return t;return-1}function a(e){var t=o(e);return t!==-1&&t!==n.length-1&&n[t+1].value}function s(e){var t=o(e);return t!==-1&&0!==t&&n[t-1].value}var c={concat:function(e){n=n.concat(e)},reset:function(){n=[]},all:function(){return n},setStack:function(e){n=e},add:function(t,r){return n.push({key:t,value:r}),e!==!1&&i(),!1},next:function(e){return a(e)},previous:function(e){return s(e)},getByIndex:function(e,t){return!(!n.length||!(e>=0||e<n.length))&&(t?n[e]:n[e].value)},getIndex:function(e){return o(e)},get:function(e){var t=o(e);return t>=0&&n[t].value},save:function(t,r){var a;a=o(t),a===-1?c.add(t,r):n[a]={key:t,value:r},e!==!1&&i()},sort:function(e,n){e&&(t=e),i(n)},keys:function(){for(var e=[],t=0;t<n.length;t++)e.push(n[t].key);return e},values:function(){for(var e=[],t=0;t<n.length;t++)e.push(n[t].value);return e},top:function(e){return!!n.length&&(e=!!e,e?n[n.length-1]:n[n.length-1].value)},bottom:function(e){return!!n.length&&(e=!!e,e?n[0]:n[0].value)},sliceBy:function(e,t){return t||(t=0),(e>n.length||!e)&&(e=n.length),n.slice(t,e)},remove:function(e){var t=o(e);return t>-1&&(n.splice(t,1),!0)},removeTop:function(){return n.splice(n.length-1,1)[0]},length:function(){return n.length},nonClosedLength:function(){var e=0;return angular.forEach(n,function(t,n){e+=t.closedBox?1:0}),e},copy:function(){for(var i=r.createNew(e,t),o=0;o<n.length;o++)i.add(n[o].key,n[o].value);return i},doForAll:function(e){for(var t=0;t<n.length;t++)e.call(null,n[t].value)}};return c}}}),angular.module("ringid.global_services").factory("Auth",AuthFactory),AuthFactory.$inject=["SystemEvents","$rootScope","Storage","Utils","$q","$ringhttp","settings","OPERATION_TYPES","userFactory","$ringbox","Ringalert","$$connector","$ocLazyLoad","Api"];function AuthFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m){var f=n.getCookie("sessionID"),E=!1,p=!1,T=!0,h=!1,_=s.SYSTEM.AUTH,I=s.SYSTEM.REQUEST_TYPE,A={},v=[],S={code:"+880",flagcode:"b880"},C=n.getCookie("sId"),D=n.getCookie("uId"),M=parseInt(n.getCookie("utId"),10),y=r.generateUUID();t.$on("ringActive",function(){Cookies.get("sessionID")!==f&&window.location.reload()});function N(e,t,n){var i={};switch(e){case"fetchRecoverOptions":i.actn=_.PASSWORD_RECOVER_OPTIONS,i.did=y,i.rb=t.mblDc+t.mbl,i.mbl=t.mbl,i.mblDc=t.mblDc,i.vsn=a.apiVersion,i.wk=r.getUniqueID(),i.lt=2;break;case"recoveryVerifyCode":i.actn=_.PASSWORD_RECOVER_VERIFY_CODE,i.uId=t.uId,i.vc=t.vc,i.wk=r.getUniqueID(),i.lt=1;break;case"recoverySendCode":i.actn=_.PASSWORD_RECOVER_SEND_CODE,i.wk=r.getUniqueID(),n?(i.lt=2,i.rb=t.mblDc+t.mbl,i.mbl=t.mbl,i.mblDc=t.mblDc):(i.lt=3,i.rb=t.email,i.el=t.email.utf8Encode());break;case"resetPassword":i.actn=_.PASSWORD_RECOVER,i.uId=t.uId,i.nPw=t.password,i.wk=r.getUniqueID(),i.lt=1;break;case"isValidSession":i.actn=_.TYPE_SESSION_VALIDATION,i.dvcc=5,i.utId=M,i.did=y;break;case"logout":i.actn=_.TYPE_SIGN_OUT;break;case"validSocialId":var o="facebook"===t.platform?a.signupSocialInit+"fb="+t.id+"&lt=4":a.signupSocialInit+"twtr="+t.id+"&lt=5";i=o+"&time="+(new Date).getTime();break;case"signupSendCode":i.wk=r.getUniqueID(),i.uId=t.uId,i.did=t.did,i.lt=1,"email"===t.authMethod?(i.el=t.email.utf8Encode(),i.actn=_.SIGNUP_SEND_CODE_EMAIL):(i.actn=_.SIGNUP_SEND_CODE_PHONE,
i.mbl=t.mbl,i.mblDc=t.mblDc);break;case"signupVerifyCode":i.wk=r.getUniqueID(),i.uId=t.uId,i.did=t.did,i.lt=1,"email"===t.authMethod?(i.actn=_.SIGNUP_SEND_CODE_EMAIL,i.el=t.email.utf8Encode(),i.evc=t.vc):(i.actn=_.SIGNUP_SEND_CODE_PHONE,i.mbl=t.mbl,i.mblDc=t.mblDc,i.vc=t.vc);break;case"signup":switch(i.actn=_.SIGNUP_REGISTER,i.wk=r.getUniqueID(),i.uId=t.uId,i.did=t.did,i.nm=t.name.utf8Encode(),i.usrPw=t.password,i.lt=1,i.ispc=0,i.mbl=t.mbl,i.mblDc=t.mblDc,t.authMethod){case"email":i.el=t.email.utf8Encode(),i.evc=t.vc;break;case"facebook":i.fb=t.id,i.it=t.access_token,i.lt=4;break;case"twitter":i.twtr=t.id,i.it=t.access_token,i.lt=5;break;default:i.mbl=t.mbl,i.mblDc=t.mblDc,i.vc=t.vc}break;case"login":if(t.hasOwnProperty("silent")&&t.silent===!0)return i.actn=_.TYPE_SIGN_IN,i.vsn=a.apiVersion,i.wk=r.getUniqueID(),i.dvc=5,i.tbid=r.tabId,i;switch(i.actn=_.TYPE_SIGN_IN,i.vsn=a.apiVersion,i.usrPw=t.password,i.lt=1,i.sn=a.apiVersion,i.wk=r.getUniqueID(),i.dvc=5,i.tbid=r.tabId,i.did=t.did,t.authMethod){case"ringid":i.lt=1,i.uId=t.silent?t.ringid:"21"+t.ringid;break;case"email":i.lt=3,i.el=t.email.utf8Encode();break;case"facebook":i.uId=t.uId,i.pen=1,i.lt=4,i.apt=1,i.smid=t.id,i.it=t.access_token,delete i.usrPw;break;case"twitter":i.uId=t.uId,delete i.usrPw,i.smid=t.id,i.it=t.access_token,i.lt=5;break;default:i.lt=2,i.mbl=t.mbl,i.mblDc=t.mblDc}t.salt&&t.sId&&(i.salt=t.salt,i.sId=t.sId);break;default:i=t}return i}function b(e){return x._currentUser=e,e}function O(e){e&&(x.loginData=e,n.setData("loginData",e))}var P=function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},R=function(e){P("uId"),P("utId"),P("sId"),P("authServer"),P("comPort"),P("la"),P("col"),e||(P("sessionID"),f=void 0),P("la")},U=function(e,t){n.setCookie("uId",e.uId||"",t),n.setCookie("sId",e.sId||"",t),n.setCookie("utId",e.utId||"",t),t&&n.setCookie("la",(new Date).getTime(),t),e.authServer&&n.setCookie("authServer",e.authServer||"",t),e.comPort&&n.setCookie("comPort",e.comPort||"",t)},L=function(e,t){e&&(R(),n.reset()),t?setTimeout(function(){window.location="/?rand="+r.getUniqueID()},e):setTimeout(function(){window.location="/"},e)};function F(e,t,r){try{var i={usrPw:t.authEPassword,salt:t.authESalt,sId:t.sId,lt:e.lt};switch(e.lt){case 1:i.uId=t.authEUsername;break;case 2:i.mbl=t.authEUsername,i.mblDc=e.mblDc;break;case 3:i.el=t.authEUsername}n.setData("remInfo",i);var o=n.getCookie("sessionID");n.setCookie("sessionID",o,r)}catch(e){}}function w(e,t){var n=i.defer();return o.get(a.signupInit+"did="+y+"&time="+(new Date).getTime()).success(function(r){r.success===!0?(U({uId:r.ringID,authServer:r.authServerIP,comPort:r.comPort}),e=angular.extend(e,{uId:r.ringID,did:y}),t?n.resolve(e):d.request(N("signupSendCode",e),I.AUTHENTICATION).then(function(e){n.resolve(angular.extend(e,{uId:r.ringID}))},function(e){n.reject(e)})):n.reject(r)}).error(function(){n.reject()}),n.promise}function k(e,t){h=!0,e.did=y,d.request(N("login",e),I.AUTHENTICATION).then(function(r){h=!1,r.sucs===!0?(x._validSession=!0,e.remember?(F(e,r,30),n.setData("remember",!0)):(n.deleteData("remInfo"),n.deleteData("remember")),e.authMethod&&n.setData("activeTab",e.authMethod),V(r,!0),t.resolve(r)):(x._validSession=!1,t.reject(r))},function(n){n.sucs===!1&&1111===n.rc?k(e,t):(x._validSession=!1,h=!1,t.reject({sucs:!1,mg:"Reqeust Failed"}))})}function $(){var e=n.getData("loginData");!e||window.hasOwnProperty("ringLoggedIn")&&!window.ringLoggedIn?j():V(e)}function G(e){switch(e.actn){case _.TYPE_MULTIPLE_SESSION:h||u.alert({title:"Signed Out!",message:"You are signed in from another device",showCancel:!1,okCallback:function(){j(!0)}});break;case _.TYPE_INVALID_LOGIN_SESSION:h||(E=!0,x.loginFromLocalData());break;case _.TYPE_SESSION_VALIDATION:h||(p=!0,x.isLoggedIn()?j(!0):x.loginFromLocalData())}}function B(){return d.request({actn:_.PHN_MAIL_VERIFICATION_CHECK},I.REQUEST)}var x={_currentUser:null,_validSession:!1,isPendingAsync:function(){var e,t=i.defer();return T?e=setInterval(function(){T||(clearInterval(e),x._validSession?t.resolve():t.reject())},1e3):t.resolve(),t.promise},isPending:function(){return T},sendCode:w,updateLocalStorageLoginData:O,verifyCode:function(e){return e=angular.extend({},e,{did:y}),d.request(N("signupVerifyCode",e),I.AUTHENTICATION)},signup:function(e){var t=i.defer();return angular.extend(e,{did:y}),d.request(N("signup",e),I.AUTHENTICATION).then(function(e){t.resolve(e)},function(){t.reject()}),t.promise},openSignup:function(e,t){var n=i.defer();return o.get(N("socialData")).success(function(r){r.success===!1&&2===r.rc?(l.open({type:"remote",scope:!1,controller:"SignUpController",resolve:{localData:{socialData:e,credentials:t},remoteData:angular.noop},templateUrl:"templates/welcome/ring-signup-popup.html"}),n.resolve()):n.reject({rc:"dologin",mg:"Already Registered Social ID"})}).error(function(){n.reject({rc:0,mg:"Request Failed"})}),n.promise},login:function(e,t){var r=i.defer();if(t)angular.extend(e,{did:y}),o.get(N("validSocialId",e)).success(function(t){t.success===!0||"true"===t.success?(U({uId:t.ringID,authServer:t.authServerIP,comPort:t.comPort}),e.uId=t.ringID,e.authMethod=e.platform,k(e,r)):r.reject({rc:"invalidsocialid",mg:"Unregistered Social ID. Please Register."})}).error(function(){r.reject({rc:0,mg:"Request Failed"})});else{switch(e.authMethod){case"email":n.setData("autoFill",e.email);break;case"ringid":n.setData("autoFill",e.ringid);break;case"phone":n.setData("autoFill",e.mbl)}k(e,r)}return r.promise},logout:function(n){x.isLoggedIn()&&(t.$broadcast(e.LOADING,!0),d.request(N("logout"),I.AUTHENTICATION).then(function(n){t.$broadcast(e.LOADING,!1),j(!0)})),setTimeout(function(){j(!0)},1e3),d.stop()},clearCookies:function(e){R(e)},loginFromLocalData:function(){var e=n.getData("remInfo");if(!h&&e&&(e.uId||e.el||e.mbl)){var t={remember:!0,silent:!0};angular.extend(t,e),x.login(t).then(function(e){e.sucs?V(e):j(!0)},function(){j(!0)})}else j(!0)},currentUser:function(){return x._currentUser},isLoggedIn:function(){return!!x._currentUser&&!!n.getCookie("sId")&&!!n.getCookie("sessionID")},isValidSession:function(){var e=i.defer();return M&&C&&D?d.request(N("isValidSession")).then(function(t){t.sucs?(x._validSession=!0,e.resolve(t)):(x._validSession=!1,e.reject(t))},function(){e.reject(x._validSession)}):e.reject(x._validSession),e.promise},reloadHome:L,getCountry:function(){var e=n.getData("country");return e&&e.country&&(S.code=e.code,S.flagcode=e.flagcode),S},getCountryList:function(){return v},getPermission:function(){return A},setAchatPermission:function(e){A.ancht=e},setAinfndreqPermission:function(e){A.aifr=e},setAfamPermission:function(e){A.afam=e},setAafPermission:function(e){A.aaf=e},ensureLoginState:$,handleInvalidSession:G,fetchPrivacy:B,fetchRecoverOptions:function(e){return d.request(N("fetchRecoverOptions",e),I.AUTHENTICATION)},recoverySendCode:function(e,t){return d.request(N("recoverySendCode",e,t),I.AUTHENTICATION)},recoveryVerifyCode:function(e){return d.request(N("recoveryVerifyCode",e),I.AUTHENTICATION)},resetPassword:function(e){return d.request(N("resetPassword",e),I.AUTHENTICATION)}},H=["/templates/dropdowns/notification-dropdown.html","/templates/dropdowns/friend-request-dropdown.html","/templates/partials/emoticon-window.html","/templates/dropdowns/circle-list-dropdown.html","/templates/dropdowns/search-dropdown.html","/templates/partials/hovercards/profile-hover.html","/templates/partials/notification/image-popup.html","/templates/partials/notification/media-popup.html","/templates/partials/notification/feed-popup_with_image.html","/templates/partials/stickers/popups/sticker-market.html"];function Y(e){setTimeout(function(){o.get(e)},100)}function K(){0===v.length&&m.fetchCountryList().success(function(e){v=e;var t=n.getData("country");t&&t.country?(S.code=t.code,S.flagcode=t.flagcode):o.get(a.baseUrl+"/country").success(function(e){if(e&&e.length>0){e=e.toLowerCase();for(var t=0;t<v.length;t++)if(v[t].country.toLowerCase()===e){S.code=v[t].code,S.flagcode=v[t].flagcode,n.setData("country",v[t]);break}}})})}function j(r){b(null),T=!1,x.clearCookies(!0),n.reset(),l.closeAll(),r?L(1):(K(),t.$broadcast(e.AUTH.LOGIN,!1))}function V(r,i){x.loginData=r,U(r,!!i&&30),b(c.create(r,!0,!0)),n.init(r),K(),setTimeout(function(){H.forEach(Y)},2e3),d.resume(),d.keepAlive(),T=!1,t.$broadcast(e.AUTH.LOGIN,!0),setTimeout(function(){B().then(function(e){T=!1,e.sucs===!0?(x._validSession=!0,A=e):x._validSession=!1},function(){T=!1})})}return x}angular.module("ringid.global_services").factory("chatHistoryFactory",["Storage","Auth","userFactory","SystemEvents","Utils",function(e,t,n,r,i){var o=CHAT_APP.Constants.GENERAL_CONSTANTS,a=CHAT_APP.Constants.CHAT_VERSION_INFO,s={},c={},l={},u=0,d=0,g=function(){s=e.getData("chatOpenedBoxes")||{},c=e.getData("chatBoxes")||{}},m=function(){return d},f=function(){d=0},E=function(){var t=e.getData("unreadMessageIds");u=0,d=0,t?Object.keys(t).forEach(function(e,n){l[e]={},t[e].forEach(function(t,n){l[e][t]=!0,u++}),d++}):l={}},p=function(t){t!==!1&&(t=!0);var n={};Object.keys(l).forEach(function(e,t){n[e]=Object.keys(l[e])}),e.setData("unreadMessageIds",n,t),i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)},T=function(){s={},c={},A(!1),v(!1),p(!1),_(a,!1)},h=function(){var t=e.getData("cgInf");t&&t.version&&t.version==a.version||T(),t?angular.extend(a,t):_()},_=function(t,n){n!==!1&&(n=!0),t&&angular.extend(a,t),e.setData("cgInf",a,n)},I=function(e){e.user||(e.user=n.create(e.user));var t=e.user;try{var t=e.user.getKey()}catch(e){}var r={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:t};return e.usersToChange&&(r.usersToChange=e.usersToChange),e.statusType&&(r.statusType=e.statusType),r},A=function(t){t!==!1&&(t=!0),e.setData("chatBoxes",c,t)},v=function(t){t!==!1&&(t=!0),e.setData("chatOpenedBoxes",s,t)},S=function(e,t){var e=e.toString();s||(s={}),s[e]||(s[e]={boxId:e,isTagChat:t}),v()},C=function(e,t){if(c[e]){var n=c[e].messages;if(n)for(var r=0,i=n.length;r<i;r++)if(n[r].key==t)return n[r]}return!1},D=function(e,t){l[e]||(l[e]={},i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)),l[e][t]||(l[e][t]=!0,u++),d=Object.keys(l).length},M=function(e,t){l[e]&&l[e][t]&&(delete l[e][t],u--,p())},y=function(e){c[e];if(l[e]){var t=Object.keys(l[e]).length;delete l[e],u-=t,u<0&&(u=0),p(),d=Object.keys(l).length,i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)}},N=function(){return l},b=function(){return u},O=function(e){return l[e]?Object.keys(l[e]).length:0},P=function(){h(),g(),E()},R={init:P,loadChatBoxes:g,loadChatGeneralInfo:h,saveChatGeneralInfo:_,updateChatOpenBoxes:v,updateChatBoxes:A,addUnreadMessageInfo:D,removeUnreadMessageInfo:M,updateUnreadMessageInfos:p,getUnreadMessageInfos:N,getUnreadMessageCount:b,getUnreadConversationCount:m,resetConversationCount:f,getUnreadMessageCountByBoxId:O,removeUnreadMessageInfoByBoxId:y,getMessageByPacketId:C,getChatOpenBoxes:function(){return s},getChatBoxes:function(){return c},addOpenBox:S,removeOpenBox:function(e){s[e]&&delete s[e],v()},countOpenBoxes:function(){return s?Object.keys(s).length:0},getAllOpenBoxes:function(){return!!(s&&Object.keys(s).length>0)&&s},addBox:function(e){S(e.key,e.isTagChat);var e={key:e.key,ip:e.ip,rPort:e.rPort,closedBox:e.closedBox,isMinimized:e.isMinimized,isHidden:e.isHidden,isFocused:e.isFocused,blinkOn:e.blinkOn,timeout:e.timeout,secretChat:e.secretChat,nonDomBox:e.nonDomBox,offlineStatus:e.offlineStatus,isTagChat:e.isTagChat,chatBoxClass:e.chatBoxClass,unreadCount:e.unreadCount,isSecretVisible:e.isSecretVisible,blocked:e.blocked,blockedByUtId:e.blockedByUtId,messages:[]};c||(c={}),c[e.key]||(c[e.key]=e),A()},updateBox:function(e){var e={key:e.key,ip:e.ip,rPort:e.rPort,closedBox:e.closedBox,isMinimized:e.isMinimized,isHidden:e.isHidden,isFocused:e.isFocused,blinkOn:e.blinkOn,timeout:e.timeout,secretChat:e.secretChat,nonDomBox:e.nonDomBox,offlineStatus:e.offlineStatus,isTagChat:e.isTagChat,isSecretVisible:e.isSecretVisible,blocked:e.blocked,blockedByUtId:e.blockedByUtId,chatBoxClass:e.chatBoxClass,unreadCount:e.unreadCount};c||(c={}),c[e.key]?angular.extend(c[e.key],e):c[e.key]=e,A()},getBox:function(e){return!!c[e]&&c[e]},addMessage:function(e,t){var t=t.toString();if(c[t]){e.user&&e.user.getKey||(e.user=n.create(e.user));var r={key:e.key||e.packetId,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime||"",status:e.status||0,fullName:e.fullName||"",tagName:e.tagName||"",messageDate:e.messageDate,seenSent:e.seenSent||!1,isDeleted:e.isDeleted||!1,messageDateString:e.messageDateString||"",timeout:e.timeout||0,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:e.user.getKey(),userId:e.user.getKey()};!e.user,e.statusType&&(r.statusType=e.statusType),e.usersToChange&&(r.usersToChange=e.usersToChange),c[t].messages||(c[t].messages=[]);var i=0;try{for(var a=0;a<c[t].messages.length;a++)if(c[t].messages[a].key===r.key){i=1;break}}catch(e){}0===i&&(c[t].messages.push(r),c[t].messages.sort(function(e,t){return e.messageDate-t.messageDate}),c[t].messages.splice(0,c[t].messages.length-o.HISTORY_MAX_MESSAGE))}A()},removeMessage:function(e,t){var t=t.toString(),n=!1;if(c&&c[t])for(var r=0;r<c[t].messages.length;r++)c[t].messages[r].key===e&&(c[t].messages.splice(r,1),n=!0);n&&A()},updateMessage:function(e,r){var r=r.toString();t.loginData.uId;if(c[r]){angular.isObject(e.user)||(e.user=n.create(e.user));var i={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,isSecretVisible:e.isSecretVisible,tag_chat:e.tag_chat,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:e.user.getKey()};e.usersToChange&&(i.usersToChange=e.usersToChange),e.statusType&&(i.statusType=e.statusType);for(var o=0;o<c[r].messages.length;o++)if(c[r].messages[o].key==i.key){c[r].messages[o]=i;break}}A()},updateMessages:function(e,t){if(e.length){for(var t=t.toString(),n={},r=0,i=e.length;r<i;r++)n[e[r].key]=e[r];if(c)for(var o=c[t],a=0;a<o.messages.length;a++){var s=o.messages[a],l=n[s.key];l&&(o.messages[a]=I(l))}A()}},isInLocalStorageChatMsgMap:function(e,t){try{return!!c[e][t]}catch(e){return!1}},countMessage:function(e){t.loginData.uId;if(c[e]){var n=c[e];return n.messages?n.messages.length:0}return!1},getMessages:function(e){if(c[e]){var t=c[e];return t.messages}return[]},getMessage:function(e,t){if(c[e]&&c[e].messages)for(var n=0;n<c[e].messages.length;n++)if(c[e].messages[n].key==t)return c[e].messages[n];return!1}};return R}]),angular.module("ringid.global_services").factory("Storage",StorageFactory),StorageFactory.$inject=[];function StorageFactory(){var e,t,n=!1,r=function(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),n=!0,window[e]}catch(e){return n=!1,{}}};t=r("localStorage");var i=function(n){e=n,angular.isDefined(t[e])&&a(e,{})},o=function(t){switch(t){case"loginData":case"country":case"remInfo":case"stickerData":break;case"chatOpenedBoxes":case"chatBoxes":case"cgInf":case"cts":case"unreadMessageIds":case"uLocationInfo":case"mood":case"utIds":case"incomingUtIds":case"outgoingUtIds":case"suggestionUtIds":case"contacts":case"notikeys":case"notiseen":case"oldNotiCount":case"mediaRecent":case"albumname":case"circledata":case"circleut":case"myStickers":t=e+"-"+t}return t},a=function(e,r){e=o(e),n?t.setItem(e,angular.toJson(r)):t[e]=angular.toJson(r)},s=function(e){return e=o(e),n?angular.fromJson(t.getItem(e)):angular.fromJson(t[e])},c=function(e){e=o(e),n?t.removeItem(e):delete t[e]};function l(r){var o;function l(){if(s("contacts")||a("contacts",{}),s("chatOpenedBoxes")||a("chatOpenedBoxes",{}),s("chatBoxes")||a("chatBoxes",{}),s("unreadMessageIds")||a("unreadMessageIds",[]),s("mediaRecent")||a("mediaRecent",[]),s("notiseen")||a("notiseen",[]),s("oldNotiCount")||a("oldNotiCount",0),s("uLocationInfo")||a("uLocationInfo",{}),n){for(var r=[],i=0,l=t.length;i<l;++i)o=t.key(i).match(/(\d+)-([a-z]+)/i),o&&o.length>1&&o[1]!=e&&r.push(t.key(i));r.forEach(function(e){c(e)})}}r?(r=angular.fromJson(r),i(r.utId),a("loginData",r),l()):Cookies.get("utId")&&(i(Cookies.get("utId")),l())}var u=function(e,t){setTimeout(function(){a(e,t)},200)};return l(s("loginData")),{init:function(e){l(e)},reset:function(){c("loginData"),c("remInfo"),c("contacts"),c("chatOpenedBoxes"),c("suggestionUtIds")},setData:function(e,t,n){n?u(e,t):a(e,t)},getData:function(e){return s(e)},deleteData:function(e){c(e)},setContact:function(e,t){if(e){var n=s("contacts")||{};n.hasOwnProperty(e)?n[e]=angular.extend({},n[e],t):n[e]=t,a("contacts",n)}},getContact:function(e){var t=s.contacts;return t&&t[e]?t[e]:null},updateLoginData:function(e,t){var n=s("loginData");n[e]=t,a("loginData",n)},setCookie:function(e,t,n){n?Cookies.set(e,t,{expires:n}):Cookies.set(e,t)},getCookie:function(e){return Cookies.get(e)},removeCookie:function(e){return Cookies.remove(e)}}}angular.module("ringid.global_services").provider("$ringbox",function(){var e={boxes:[],boxeScopes:[],boxeDeferred:[],template:'<div class="ringbox"><div class="ringbox-overlay"></div><div class="ringbox-outerContainer"><div class="ringbox-content ringbox-invisible"><div class="ringbox-inner"></div><div class="ringbox-loader"><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div></div></div></div>',init:function(){var e=angular.element(this.template);return this.boxes.push(e),e},adjustBoxes:function(){for(var e=0;e<this.boxes.length;e++)this.boxes[e].removeClass("rl_"+e);for(var e=0;e<this.boxes.length;e++)this.boxes[e].addClass("rl_"+e)},$get:["$injector","$rootScope","$$q","$templateCache","$controller","$compile","$document","$player","$ringhttp","$sniffer","Notification","SystemEvents","Utils",function(t,n,r,i,o,a,s,c,l,u,d,g,m){var f={},E=this,p=u.vendorPrefix.toLowerCase();function T(e){if(e.template)return r.when(e.template);var t=angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl;if(i.get(t))return r.when(i.get(t));var n=r.defer();return l.get(t).success(function(e){i.put(t,e),n.resolve(e)}).error(function(){n.reject()}),n.promise}function h(e){var n=[];return angular.forEach(e,function(e){angular.isDefined(e.promise)?n.push(e.promise):angular.isFunction(e)?n.push(r.when(t.invoke(e))):(angular.isArray(e)||angular.isObject(e))&&n.push(e)}),n}f.minimizedBox={dom:null,scope:null,deferred:null},f.clear=function(e,t,n){0==E.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened","").trim()),e&&e.$destroy(),t&&t.resolve.apply(null,n),c.miniPlayer.player||0!=E.boxes.length||c.destroyAll()},f.close=function(e){e&&e.stopPropagation&&e.stopPropagation(),E.boxes.length>0&&(E.boxes.pop().remove(),f.clear(E.boxeScopes.pop(),E.boxeDeferred.pop(),arguments))},f.closeAll=function(){for(var e=E.boxes.length-1;e>=0;e--)E.boxes.pop().remove(),f.clear(E.boxeScopes.pop(),E.boxeDeferred.pop(),arguments)};var _=function(){f.minimizedBox.dom[0].style.display="none",c.showMiniPlayer(),0==E.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened",""))};return f.removeMinimize=function(){f.minimizedBox.dom&&f.minimizedBox.dom.remove(),f.minimizedBox.scope&&f.minimizedBox.scope.$destroy()},f.minimize=function(){if(E.boxes.length>0){f.minimizedBox.dom=E.boxes.pop(),f.minimizedBox.scope=E.boxeScopes.pop(),f.minimizedBox.deferred=E.boxeDeferred.pop();var e=f.minimizedBox.dom[0].querySelector(".ringbox-content"),t=e.offsetLeft+(e.offsetWidth-335)/2-200,n=window.innerHeight-(e.offsetTop+(e.offsetHeight-150)/2)-120,r="translate(-"+t+"px,"+n+"px) scale(0.35,0.24)";f.minimizedBox.dom[0].querySelector(".pv-profile").style.display="none",e.style.webkitTransition="transform 0.5s",e.style.MozTransition="transform 0.5s",e.style.msTransition="transform 0.5s",e.style.OTransition="transform 0.5s",e.style.transition="transform 0.5s",e.style.webkitTransform=r,e.style.MozTransform=r,e.style.msTransform=r,e.style.OTransform=r,e.style.transform=r,e.addEventListener(p+"TransitionEnd",_),e.addEventListener("transitionend",_)}},f.maximize=function(e,t){if(f.minimizedBox.dom){var n=f.minimizedBox.dom[0].querySelector(".ringbox-content");f.minimizedBox.dom[0].querySelector("div.ringbox-overlay");f.minimizedBox.dom[0].querySelector(".pv-profile").style.display="block",f.minimizedBox.dom[0].style.display="table",e.appendChild(t),n.style.webkitTransform="initial",n.style.MozTransform="initial",n.style.msTransform="initial",n.style.OTransform="initial",n.style.transform="initial",E.boxes.push(f.minimizedBox.dom),E.boxeScopes.push(f.minimizedBox.scope),E.boxeDeferred.push(f.minimizedBox.deferred),1==E.boxes.length&&(document.body.className=document.body.className.trim()+" ringbox-opened"),f.minimizedBox={dom:null,scope:null,deferred:null},n.removeEventListener(p+"TransitionEnd",_),n.removeEventListener("transitionend",_)}},f.open=function(t){var i=r.defer(),l=r.defer(),u=!1,p=!1,_=E.init(),I=angular.element(_[0].querySelector("div.ringbox-content")),A=angular.element(I[0].querySelector("div.ringbox-loader")),v=angular.element(I[0].querySelector("div.ringbox-inner")),S=angular.element(_[0].querySelector("div.ringbox-overlay"));"undefined"==typeof t.loaderHide&&(t.loaderHide=!0),I.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"}),t.animation&&I.addClass("animation"),E.adjustBoxes(),t=angular.extend({},t);var C=(t.scope||n).$new();C.boxIsLoading=!0,angular.forEach(e.options,function(e,n){C[n]=t[n]}),angular.isObject(t.scopeData)&&angular.forEach(t.scopeData,function(e,n){C[n]=t.scopeData[n]}),E.boxeScopes.push(C),E.boxeDeferred.push(i);var D=function(){I.addClass("ringbox-invisible"),A.css({display:"block"}),v.css({display:"none"}),I.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"})},M=function(){setTimeout(function(){A.css({display:"none"}),v.css({display:"inline-block"}),N(),I.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),I.removeClass("ringbox-invisible")},300)},y=function(){document.body.appendChild(_[0]),document.body.className=document.body.className.replace("ringbox-opened",""),document.body.className=document.body.className.trim()+" ringbox-opened",p=!1};t.templateUrl&&(t.templateUrl.indexOf("image-popup.html")||t.templateUrl.indexOf("media-popup.html"))?p=setTimeout(y,200):y(),C.$on(g.RINGBOX.UPDATE,function(e,t){N(!0)});var N=function(e){if((!e||"none"==A.css("display"))&&I&&t.scrollable){var n,r=v[0].offsetHeight;n=Math.max(m.viewport.y/2-r/2,40),I.css({"margin-top":n+"px"}),r>m.viewport.y?S.css({right:m.scrollbarWidth+"px"}):S.css({right:"0px"})}};if(!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var b=r.all([T(t)].concat(h(t.resolve))),O={result:i.promise,opened:l.promise,close:f.close,closeAll:f.closeAll,showLoader:D,hideLoader:M,adjustHeight:N};return b.then(function(e){if(C.boxIsLoading=!1,C.$close=f.close,v){u&&clearTimeout(u);var n,r={},i=1;if(t.controller){r.$scope=C,r.$boxInstance=O;for(var s in t.resolve)t.resolve.hasOwnProperty(s)&&(r[s]=e[i++]);n=o(t.controller,r),t.controllerAs&&(C[t.controllerAs]=n)}v.html(e[0]),a(v.contents())(C),p&&(clearTimeout(p),t.loaderHide&&(A.css({display:"none"}),I.removeClass("ringbox-invisible")),y()),I.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),t.loaderHide&&M(),C.$parent.$rgDigest()}},function(e){i.reject(e),f.close()}),b.then(function(){l.resolve(!0)},function(){l.reject(!1)}),t.scrollable&&(_.addClass("scrollable"),N()),t.onBackDropClickClose&&(S.on("click",function e(t){S.off("click",e),f.close(t)}),t.scrollable&&_[0].addEventListener("click",function e(t){t.stopPropagation(),t.target.className.indexOf("ringbox-outerContainer")!=-1&&(_[0].removeEventListener("click",e),f.close())},!1)),t.onEscape&&s.bind("keyup",function e(t){var n=t.which||t.keyCode||t.key;if(32!=n&&t.stopImmediatePropagation(),27==n){if(c.escapeKey)return void(c.escapeKey=!1);s.unbind("keyup",e),f.close()}return!1}),t.scrollable&&_.bind("scroll",function(e){_[0].scrollHeight-(_[0].offsetHeight+_[0].scrollTop)<100&&(angular.isFunction(C.onScroll)&&C.onScroll(),angular.isFunction(C.loadMore)&&C.loadMore())}),C.$on("$destroy",function(){_=null,I=null,A=null,v=null,O=null,t=null,S=null,b=null}),u=setTimeout(function(){C&&C.boxIsLoading&&(d.error({message:"Something went wrong! Please try again."}),f.close())},2e4),O},f}]};return e}).directive("rgRingbox",["$ringbox",function(e){return{restrict:"EA",scope:{ringboxData:"&",scopeData:"&",onRingBoxOpen:"&",onRingBoxClose:"&",onScroll:"&",ringboxFalsyFunc:"&",ringboxOpen:"&"},link:function(t,n,r){var i;function o(i){i.preventDefault();var o,a,s={},c={};o=r.ringboxType,o||(o="html"),r.ringboxData&&(s=angular.isFunction(t.ringboxData)?t.ringboxData():t.ringboxData),r.scopeData&&(c=angular.isFunction(t.scopeData)?t.scopeData():t.scopeData);var l=s.data?s.data:s,u={type:o,scrollable:!(!r.ringboxScrollable||"true"!=r.ringboxScrollable&&1!=r.ringboxScrollable),loaderHide:!r.loaderHide||"false"!=r.loaderHide&&0!=r.loaderHide,scope:!!r.ringboxScope&&t,scopeData:c||{},controller:r.ringboxController||"",resolve:{localData:l,remoteData:s.promise?s:angular.noop},onBackDropClickClose:!r.ringBackdropClose||"false"!=r.ringBackdropClose&&0!=r.ringBackdropClose,animation:!r.ringboxAnimation||"false"!=r.ringboxAnimation&&0!=r.ringboxAnimation,onEscape:!r.ringCloseEscape||"false"!=r.ringCloseEscape&&0!=r.ringCloseEscape};if("remote"===o)u.templateUrl=r.ringboxTarget||t.ringboxTarget||r.href||r.src;else if("video"===o);else if("inline"===o)u.template=r.ringboxTarget||t.ringboxTarget;else if(o="html",a=r.ringboxTarget||t.ringboxTarget){if(u.template=angular.element(document.querySelector(a)),!(u.template.length>0))throw new Error("Opps ! Your Provideed Target element Does Not Exist!");u.template=u.template[0].outerHTML}else u.template=n.html();var d=e.open(u);d.result.then(function(e){angular.isDefined(t.onRingBoxClose)&&angular.isFunction(t.onRingBoxClose)&&t.onRingBoxClose()}),d.opened.then(function(){angular.isDefined(t.onRingBoxOpen)&&angular.isFunction(t.onRingBoxOpen)&&t.onRingBoxOpen()})}function a(e){n.on("click",e),i=t.$on("$destroy",function(){n.off("click",e)})}function s(e){e.preventDefault(),e.stopPropagation(),angular.isFunction(t.ringboxFalsyFunc)&&t.ringboxFalsyFunc()}r.ringboxOpen?t.$watch("ringboxOpen()",function(e){i&&(n.off("click",o),n.off("click",s),i()),a(e?o:s)}):a(""===r.rgRingbox||"true"===r.rgRingbox||r.rgRingbox===!0?o:s)}}}]),angular.module("ringid.global_services").factory("Contacts",ContactsFactory),ContactsFactory.$inject=["settings","$$stackedMap","Storage"];function ContactsFactory(e,t,n){var r={utIds:t.createNew(),incomingUtIds:t.createNew(),outgoingUtIds:t.createNew()},i=t.createNew();return{init:function(){},initStorage:function(){},utIds:function(){return r.utIds},outgoingUtIds:function(){return r.outgoingUtIds},incomingUtIds:function(){return r.incomingUtIds},remove:function(e,t){return i.save(t,r[e].get(t)),r[e].remove(t)},add:function(e,t,n){r[e].save(t,n)},getFrns:function(e){return r.utIds.get(e)||r.incomingUtIds.get(e)||r.outgoingUtIds.get(e)||i.get(e)||{frnS:0}}}}!function(e,t){"use strict";e.module("ringid.global_directives",["ngRoute","ringid.config"])}(angular,window),angular.module("ringid.global_directives").directive("rgColumn",["$document","Storage","Utils",function(e,t,n){return{restrict:"A",controller:["Utils","$scope","SystemEvents","$rootScope",function(e,t,n,r){t.spans=e.feedColumn(),t.defaultSpan=e.getDefaultColumn(),t.choose=function(i){e.resetScroll(),e.animateScroll(),e.setFeedColumn(i),t.spans=i,r.$broadcast(n.COMMON.COLUMN_CHANGED,i)},t.$watch(e.feedColumn,function(e){t.spans=e,r.$broadcast(n.COMMON.COLUMN_CHANGED,e)}),t.$on(n.COMMON.WINDOW_RESIZED,function(){t.defaultSpan=e.getDefaultColumn()})}],template:'<span></span>                        <span></span>                        <span></span>                        <div class="col-area">                        <div class="col-area-wrapper">                            <div class="list-ico width-26 top-l" data-tool="3 Column" ng-click="choose(3)"  ng-if="defaultSpan > 2" ng-class="{\'list-act\' : spans == 3 }">                                <span></span>                                <span></span>                                <span></span>                            </div>                            <div class="list-ico width-17 top-l" data-tool="2 Column" ng-click="choose(2)"  ng-if="defaultSpan > 1" ng-class="{\'list-act\' : spans == 2 }">                                <span></span>                                <span></span>                            </div>                            <div  class="list-ico width-9 top-l" data-tool="1 Column" ng-click="choose(1)" ng-class="{\'list-act\' : spans == 1 }">                                <span></span>                            </div>                            </div>                        </div>',link:function(t,n,r,i){var o;function a(t){t.preventDefault(),o||(o=angular.element(n.find("div")[0]),e.on("click",s)),o.toggleClass("colshow")}function s(e){var t=n.parent().parent()[0];e.target!=t&&e.target.parentNode!=t&&null!=e.target.parentNode&&e.target.parentNode.parentNode!=t&&"pt-top"!=e.target.className&&c(e)}n.parent().parent().on("click",a);function c(e){o.removeClass("colshow")}t.$on("$destroy",function(){n.off("click",a),e.off("click",s),o=void 0})}}}]),angular.module("ringid.global_directives").provider("$player",Player).directive("rgPlayer",rgPlayer);function Player(){this.dicts={maximize:"Back to normal view",minimize:"Go to small view",fullScreen:"Full Screen",playlist:"Playlist",auto:"Auto Play"},this.instances=[],this.template='<div class="rg-player"><div class="container"><div class="play-info"></div><div class="play-error"></div> <div class="music-bars"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><div class="big-play"><span class="img_sprite icon-player"></span></div><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div><div class="player-poster"><img class="poster" /></div></div><div class="playlist-wrapper"></div><div class="media-control"><div class="media-tip"></div><div class="media-control-bg"></div><div class="media-control-layer"><div class="bar-panel"><div class="bar-container"><div class="bar-background"><div class="bar-fill-1"></div><div class="bar-fill-2"></div><div class="bar-hover"></div></div><div class="bar-scrubber"><div class="bar-scrubber-icon"></div></div><div class="seek-time"><div class="timer"></div></div></div></div><div class="control-left"><div class="play-btns"><button class="img_sprite w-h-13 icon-previous-p control-btn prev-btn"></button><button class="img_sprite w-h-13 icon-play-p control-btn start-btn"></button><button class="img_sprite w-h-13 icon-next-p control-btn next-btn"></button></div><div class="volume-bar"><div class="img_sprite w-h-13 icon-speaker-fill volume-icon unmute"></div><div class="volume-bar-container volume-bar-hide"><div data-rel="0" class="bar fill"></div><div data-rel="1" class="bar fill"></div><div data-rel="2" class="bar fill"></div><div data-rel="3" class="bar fill"></div><div data-rel="4" class="bar"></div><div data-rel="5" class="bar"></div><div data-rel="6" class="bar"></div><div data-rel="7" class="bar"></div><div data-rel="8" class="bar"></div><div data-rel="9" class="bar"></div></div></div><div class="time-indicator time-running"></div><div class="time-indicator time-total"></div></div><div class="control-right"><button class="control-btn hd">HD</button><button class="img_sprite w-h-13 icon-minimize control-btn minimize" tooltip="'+this.dicts.minimize+'"></button><button class="img_sprite w-h-13 icon-screen-f control-btn full-screen" tooltip="'+this.dicts.fullScreen+'"></button><button class="img_sprite w-h-13 icon-play-list control-btn playlist-btn" tooltip="'+this.dicts.playlist+'"></button><button class="control-btn auto" tooltip="'+this.dicts.auto+'">AUTO</button></div></div></div></div>',
this.trackTemplate='<a rel="data-rel" href="#"><span class="list-thumb"><img src="data-thumb" /></span><span class="list-title">data-caption<b>data-duration</b></span></a>',this.secToTime=function(e){e=Math.floor(e);var t=parseInt(e/3600)%24,n=parseInt(e/60)%60,e=e<0?0:e%60,r="";return t>0&&(r+=t<10?"0"+t:t),r+=(n<10?"0"+n:n)+":"+(e<10?"0"+e:e)},this.findPos=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}},this.destroy=function(e){try{e.removeEvent(),e.provider.pause(),e.provider.src="",e.dom=null,delete e.provider}catch(e){}},this.addRemoveClass=function(e,t,n){var r;for(r=0;r<n.length;r++)e.className=e.className.replace(n[r],"").trim();for(r=0;r<t.length;r++)e.className+=" "+t[r]},this.createMediaObject=function(e){return"audio"==e?document.createElement("audio"):document.createElement("video")},this.getDefaultThumb=function(e){return e&&"images/default_audio_image.jpg"!=e||(e="images/player-audio.png"),e},this.$get=["$compile","$document",function(e,t){var n=this,r={};return r.escapeKey=!1,r.miniPlayer={dom:{container:null,move:null,resize:null,maximize:null,close:null},parent:null,player:null},r.wh=window.innerHeight,r.destroy=function(){n.instances.length>0&&n.destroy(n.instances.pop())},r.destroyAll=function(){for(var e=n.instances.length-1;e>=0;e--)n.destroy(n.instances.pop())},r.toggleMinMax=function(){for(var e,t=n.instances.length-1;t>=0;t--)if(!n.instances[t].chat){e=n.instances[t];break}e.minimize()},r.showMiniPlayer=function(){r.miniPlayer.player&&(r.miniPlayer.dom.container.appendChild(r.miniPlayer.player.parent),r.miniPlayer.dom.container.style.display="block","PLAYING"==r.miniPlayer.player.playingState&&setTimeout(function(){r.miniPlayer.player.provider.play()}))},r.closeMiniPlayer=function(){r.miniPlayer.player&&(r.ringboxRemove(),r.destroy(),r.miniPlayer.dom.container.parentNode.removeChild(r.miniPlayer.dom.container),r.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},r.miniPlayer.player=null)},r.addToPlaylist=function(e){for(var t=n.instances.length-1;t>=0;t--)if(!n.instances[t].chat){n.instances[t].AddToPlaylist(e);break}},r.player=function(t){r.ringboxRemove=t.ringboxRemove?t.ringboxRemove:function(){},t.chatVersion||r.closeMiniPlayer();var i={};i.source=t.source||"",i.autoPlay=t.autoPlay||!1,i.showMinMax=t.showMinMax||!1,i.auto=t.auto||!1,i.parent=document.getElementById(t.parentId),i.poster=t.poster||"",i.mediaType=t.type||"video",i.dom={},i.playingState=this.autoPlay?"INIT":"STOPPED",i.screenState="NORMAL",i.volumeState="UNMUTE",i.volume=5,i.duration=0,i.currentTrack=0,i.playlist=t.playlist||[],i.title=t.title||"",i.playlistState=!1,i.hd=!1,i.isMouseDown=!1,i.isLoading=i.autoPlay,i.isFirefox=!!navigator.userAgent.match(/firefox/i),i.canPlay=!0,i.chat=!!t.chatVersion,i.provider=n.createMediaObject(i.mediaType),i.parent.innerHTML=n.template,i.dom.player=i.parent.querySelector(".rg-player"),i.dom.container=i.parent.querySelector(".container"),i.dom.playlistWrap=i.parent.querySelector(".playlist-wrapper"),i.dom.control=i.parent.querySelector(".media-control"),i.dom.bigBlay=i.dom.container.querySelector(".big-play"),i.dom.bigBlayIcon=i.dom.bigBlay.querySelector("span"),i.dom.playError=i.dom.container.querySelector(".play-error"),i.dom.playInfo=i.dom.container.querySelector(".play-info"),i.dom.musicBar=i.dom.container.querySelector(".music-bars"),i.dom.loader=i.dom.container.querySelector(".loader"),i.dom.poster=i.dom.container.querySelector(".player-poster"),i.dom.posterImg=i.dom.poster.querySelector(".poster"),i.dom.barContainer=i.dom.control.querySelector(".bar-container"),i.dom.barScrubber=i.dom.control.querySelector(".bar-scrubber"),i.dom.barLoaded=i.dom.control.querySelector(".bar-fill-1"),i.dom.barPosition=i.dom.control.querySelector(".bar-fill-2"),i.dom.barHover=i.dom.control.querySelector(".bar-hover"),i.dom.controlLayer=i.dom.control.querySelector(".media-control-layer"),i.dom.controlBG=i.dom.control.querySelector(".media-control-bg"),i.dom.controlTip=i.dom.control.querySelector(".media-tip"),i.dom.playBtn=i.dom.control.querySelector(".start-btn"),i.dom.nextBtn=i.dom.control.querySelector(".next-btn"),i.dom.prevBtn=i.dom.control.querySelector(".prev-btn"),i.dom.timeRunning=i.dom.control.querySelector(".time-running"),i.dom.timeTotal=i.dom.control.querySelector(".time-total"),i.dom.hd=i.dom.control.querySelector(".hd"),i.dom.playlistBtn=i.dom.control.querySelector(".playlist-btn"),i.dom.minimize=i.dom.control.querySelector(".minimize"),i.dom.auto=i.dom.control.querySelector(".auto"),i.dom.volumeIcon=i.dom.control.querySelector(".volume-icon"),i.dom.volumeBarContainer=i.dom.control.querySelector(".volume-bar-container"),i.dom.volumeBars=i.dom.volumeBarContainer.querySelectorAll(".bar"),i.dom.fullScreenBtn=i.dom.control.querySelector(".full-screen"),i.dom.seekTimer=i.dom.control.querySelector(".seek-time"),i.dom.timer=i.dom.control.querySelector(".timer"),i.dom.playlist=null,i.dom.player.style.width=t.width?t.width+"px":"100%",i.dom.player.style.height=t.height?t.height+"px":"100%",i.dom.timeRunning.innerHTML="00:00",i.dom.timeTotal.innerHTML="00:00",!t.chatVersion&&i.showMinMax||(i.dom.minimize.style.display="none"),i.dom.poster.appendChild(i.provider),r.miniPlayer.parent=i.parent.parentNode;function o(){var e=document.mozFullScreen||document.webkitIsFullScreen;e||"FULL"!=i.screenState||i.fullScreen()}function a(e){var t=e.which||e.keyCode||e.key;r.miniPlayer.player||32===t&&i.playPause()}function s(e){e.stopPropagation(),i.playPause()}function c(e){e.stopPropagation(),i.playNext()}function l(e){e.stopPropagation(),i.playPrev()}function u(e){e.stopPropagation(),i.muteUnmute()}function d(e){e.stopPropagation(),i.fullScreen()}function g(e){e.stopPropagation(),i.minimize()}function m(e){i.timeInfo(e),i.isMouseDown&&i.setPosition(e,!1)}function f(e){i.isMouseDown=!0,n.addRemoveClass(i.dom.barContainer,["down"],[])}function E(e){i.isMouseDown=!1,i.setPosition(e,!0),n.addRemoveClass(i.dom.barContainer,[],["down"])}function p(e){i.isMouseDown=!1,n.addRemoveClass(i.dom.barContainer,[],["down"])}function T(e){return e.stopPropagation(),i.playlistState?void i.showPlaylist(!1):void i.playPause()}function h(e){e.stopPropagation(),i.showControl(!0)}function _(e){e.stopPropagation(),i.showControl(!1)}function I(e){e.stopPropagation(),r.miniPlayer.player&&i.maximize(),i.showPlaylist()}function A(e){e.stopPropagation(),i.setAuto()}function v(e){e.stopPropagation(),i.showTootip(e,this.getAttribute("tooltip"))}function S(e){e.stopPropagation(),i.dom.controlTip.style.display="none"}function C(e){e.stopPropagation(),i.showTootip(e,this.getAttribute("tooltip"))}function D(e){e.stopPropagation(),i.dom.controlTip.style.display="none"}function M(e){e.stopPropagation(),i.showTootip(e,this.getAttribute("tooltip"))}function y(e){e.stopPropagation(),i.dom.controlTip.style.display="none"}function N(e){e.stopPropagation(),i.showTootip(e,this.getAttribute("tooltip"))}function b(e){e.stopPropagation(),i.dom.controlTip.style.display="none"}function O(e){e.stopPropagation();var t=parseInt(this.getAttribute("data-rel"));i.changeVolume(t)}var P,R,U,L=!1,F=!1,w=!1,k=350,$=120,G=window.innerHeight,B=window.innerWidth;function x(e){F=!0,L&&fastdom.read(function(){r.miniPlayer.dom.resize&&(document.body.style.cursor="move",r.miniPlayer.dom.resize.style.cursor="move",i.dom.container.style.cursor="move",fastdom.write(function(){e.clientX+P>=200&&e.clientX+P<=B-k-210&&(r.miniPlayer.dom.container.style.left=e.clientX+P+"px"),e.clientY+R>=50&&e.clientY+R<=G-$&&(r.miniPlayer.dom.container.style.top=e.clientY+R+"px")}))})}function H(e){e.stopPropagation(),L=!1,document.body.style.cursor="default",r.miniPlayer.dom.resize.style.cursor="ns-resize",i.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",H)}function Y(e){e.preventDefault(),e.stopPropagation(),L=!0,B=window.innerWidth,G=window.innerHeight,P=r.miniPlayer.dom.container.offsetLeft-e.clientX,R=r.miniPlayer.dom.container.offsetTop-e.clientY,document.addEventListener("mousemove",x,!1),document.addEventListener("mouseup",H,!1)}function K(e){return F?void(F=!1):void i.playPause()}function j(e){w&&fastdom.read(function(){if(r.miniPlayer.dom.container){var t=r.miniPlayer.dom.container.offsetHeight,n=parseInt(r.miniPlayer.dom.container.style.top.replace("px",""));fastdom.write(function(){document.body.style.cursor="ns-resize",r.miniPlayer.dom.move.style.cursor="ns-resize",i.dom.container.style.cursor="ns-resize",U>=e.clientY&&t<250&&(t+=3,n-=3,r.miniPlayer.dom.container.style.height=t+"px",r.miniPlayer.dom.container.style.top=n+"px",U=e.clientY),U<e.clientY&&t>120&&(t-=3,n+=3,r.miniPlayer.dom.container.style.height=t+"px",r.miniPlayer.dom.container.style.top=n+"px",U=e.clientY)})}})}function V(e){e.stopPropagation(),w=!1,document.body.style.cursor="default",r.miniPlayer.dom.move.style.cursor="move",i.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",V)}function W(e){e.preventDefault(),e.stopPropagation(),w=!0,B=window.innerWidth,G=window.innerHeight,U=e.clientY,document.addEventListener("mousemove",j,!1),document.addEventListener("mouseup",V,!1)}function q(e){e.preventDefault(),e.stopPropagation(),i.maximize()}function z(e){e.preventDefault(),e.stopPropagation(),r.closeMiniPlayer()}return i.initEvent=function(){i.dom.playBtn.addEventListener("click",s,!1),i.dom.nextBtn.addEventListener("click",c,!1),i.dom.prevBtn.addEventListener("click",l,!1),i.dom.volumeIcon.addEventListener("click",u,!1),i.dom.fullScreenBtn.addEventListener("click",d,!1),i.dom.minimize.addEventListener("click",g,!1),i.dom.barContainer.addEventListener("mousemove",m,!1),i.dom.barContainer.addEventListener("mousedown",f,!1),i.dom.barContainer.addEventListener("mouseup",E,!1),i.dom.barContainer.addEventListener("mouseleave",p,!1),i.dom.container.addEventListener("click",T,!1),i.dom.player.addEventListener("mouseover",h,!1),i.dom.player.addEventListener("mouseleave",_,!1),i.dom.playlistBtn.addEventListener("click",I,!1),i.dom.auto.addEventListener("click",A,!1);for(var e=0;e<i.dom.volumeBars.length;e++)i.dom.volumeBars[e].addEventListener("click",O);i.dom.auto.addEventListener("mouseover",v,!1),i.dom.auto.addEventListener("mouseleave",S,!1),i.dom.minimize.addEventListener("mouseover",C,!1),i.dom.minimize.addEventListener("mouseleave",D,!1),i.dom.fullScreenBtn.addEventListener("mouseover",M,!1),i.dom.fullScreenBtn.addEventListener("mouseleave",y,!1),i.dom.playlistBtn.addEventListener("mouseover",N,!1),i.dom.playlistBtn.addEventListener("mouseleave",b,!1),document.addEventListener("mozfullscreenchange",o,!1),document.addEventListener("webkitfullscreenchange",o,!1),document.addEventListener("fullscreenchange",o,!1),document.addEventListener("keyup",a,!1),i.setMediaEvent(),i.createPlaylist(),i.showPoster(!0),i.auto&&i.setAuto(!0)},i.setMediaEvent=function(){i.provider.addEventListener("loadedmetadata",function(e,t){i.initTime(i.provider.duration),i.autoPlay&&i.play()}),i.provider.addEventListener("progress",function(){var e=i.provider.buffered.length>0?i.provider.buffered.end(i.provider.buffered.length-1):0,t=i.provider.currentTime+.05>=e?"BUFFERING":"PLAYING_BUFFERING";i.showBuffered(e,i.provider.duration),i.stateChanged(t)}),i.provider.addEventListener("timeupdate",function(){i.provider&&!i.isMouseDown&&i.showPosition(i.provider.currentTime,i.provider.duration)}),i.provider.addEventListener("play",function(){i.stateChanged("PLAYING"),"video"==i.mediaType&&i.showPoster(!1),angular.isFunction(t.scope.onStart())&&t.scope.onStart()()}),i.provider.addEventListener("pause",function(){i.stateChanged("PAUSED"),"video"==i.mediaType&&i.showPoster(!1)}),i.provider.addEventListener("ended",function(){i.stateChanged("ENDED"),"video"==i.mediaType&&i.showPoster(!1),angular.isFunction(t.scope.onEnded())&&t.scope.onEnded()()}),i.provider.addEventListener("stalled",function(){!i.provider}),i.provider.addEventListener("error",function(){i.provider&&(i.error=i.provider.error.code,i.canPlay=!1,i.showError())})},i.removeEvent=function(){i.dom.playBtn.removeEventListener("click",s),i.dom.nextBtn.removeEventListener("click",c),i.dom.prevBtn.removeEventListener("click",l),i.dom.volumeIcon.removeEventListener("click",u),i.dom.fullScreenBtn.removeEventListener("click",d),i.dom.minimize.removeEventListener("click",g),i.dom.barContainer.removeEventListener("mousemove",m),i.dom.barContainer.removeEventListener("mousedown",f),i.dom.barContainer.removeEventListener("mouseup",E),i.dom.barContainer.removeEventListener("mouseleave",p),i.dom.container.removeEventListener("click",T),i.dom.player.removeEventListener("mouseover",h),i.dom.player.removeEventListener("mouseleave",_),i.dom.playlistBtn.removeEventListener("click",I),i.dom.auto.removeEventListener("click",A);for(var e=0;e<i.dom.volumeBars.length;e++)i.dom.volumeBars[e].removeEventListener("click",O);i.dom.auto.removeEventListener("mouseover",v),i.dom.auto.removeEventListener("mouseleave",S),i.dom.minimize.removeEventListener("mouseover",C),i.dom.minimize.removeEventListener("mouseleave",D),i.dom.fullScreenBtn.removeEventListener("mouseover",M),i.dom.fullScreenBtn.removeEventListener("mouseleave",y),i.dom.playlistBtn.removeEventListener("mouseover",N),i.dom.playlistBtn.removeEventListener("mouseleave",b),document.removeEventListener("mozfullscreenchange",o),document.removeEventListener("webkitfullscreenchange",o),document.removeEventListener("fullscreenchange",o),document.removeEventListener("keyup",a)},i.maximize=function(){if(r.miniPlayer.player)return t.ringboxMaximize(r.miniPlayer.parent,i.parent),"PLAYING"==i.playingState&&setTimeout(function(){i.provider.play()}),r.miniPlayer.dom.move.removeEventListener("mousedown",Y),r.miniPlayer.dom.move.removeEventListener("click",K),r.miniPlayer.dom.resize.removeEventListener("mousedown",W),r.miniPlayer.dom.close.removeEventListener("click",z),r.miniPlayer.dom.maximize.removeEventListener("click",q),r.miniPlayer.dom.container.parentNode.removeChild(r.miniPlayer.dom.container),r.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},r.miniPlayer.player=null,n.addRemoveClass(i.dom.minimize,["icon-minimize"],["icon-maximize"]),i.dom.fullScreenBtn.style.display="block",void i.dom.minimize.setAttribute("tooltip",n.dicts.minimize)},i.minimize=function(){if(r.miniPlayer.player)return void i.maximize();var e=document.createElement("div"),o=document.createElement("a"),a=document.createElement("div"),s=document.createElement("div"),c=document.createElement("a");c.setAttribute("class","mini-close"),c.innerHTML='<div class="img_sprite w-h-16px icon-close pop-close"></div>',o.setAttribute("class","img_sprite w-h-18px maximize icon-maximize"),o.setAttribute("style","position: absolute;right: 22px;top: 5px;color: #fff;"),a.setAttribute("class","move-player"),a.appendChild(o),a.appendChild(c),e.setAttribute("id","mini-player"),e.setAttribute("class","mini-player"),s.setAttribute("class","resize-player"),e.style.display="none",e.appendChild(a),e.appendChild(s),document.body.appendChild(e),i.showPlaylist(!0),i.showControl(!0),r.miniPlayer.dom.container=e,r.miniPlayer.dom.resize=s,r.miniPlayer.dom.move=a,r.miniPlayer.dom.close=c,r.miniPlayer.dom.maximize=o,r.miniPlayer.player=i,i.dom.minimize.setAttribute("tooltip",n.dicts.maximize),t.ringboxMinimize(),G="FULL"==i.screenState?r.wh:window.innerHeight,e.style.top=G-$+"px",n.addRemoveClass(i.dom.minimize,["icon-maximize"],["icon-minimize"]),i.dom.fullScreenBtn.style.display="none",c.addEventListener("click",z,!1),o.addEventListener("click",q,!1),a.addEventListener("mousedown",Y,!1),a.addEventListener("click",K,!1),s.addEventListener("mousedown",W,!1),c=o=s=a=e=null},i.playPause=function(){if(i.canPlay)return"PLAYING"==i.playingState?(i.pause(),i.showLoader(),i.showBigPlay(),i.showControl(!1),i.showPlaylist(!0),void i.showInfo(!0)):"PAUSED"==i.playingState?(i.resume(),i.showLoader(),i.showBigPlay(),void i.showInfo()):"STOPPED"==i.playingState?(i.play(),i.showLoader(),i.showBigPlay(),i.showPlaylist(!0),void i.showInfo()):void 0},i.muteUnmute=function(){return"UNMUTE"==i.volumeState?(i.setVolume(0),n.addRemoveClass(i.dom.volumeIcon,["icon-speaker-m"],["icon-speaker-fill"]),void(i.volumeState="MUTE")):"MUTE"==i.volumeState?(i.setVolume(i.volume),n.addRemoveClass(i.dom.volumeIcon,["icon-speaker-fill"],["icon-speaker-m"]),void(i.volumeState="UNMUTE")):void 0},i.initTime=function(e){i.dom.timeTotal.innerHTML=n.secToTime(e),i.duration=e},i.showPosition=function(e,t){0==i.duration&&t>0&&i.initTime(t),e>t&&i.initTime(e),i.dom.timeRunning.innerHTML=n.secToTime(e),i.dom.barScrubber.style.left=0==i.duration?"-"+i.dom.barScrubber.offsetWidth/2+"px":"calc("+e/i.duration*100+"% - "+i.dom.barScrubber.offsetWidth/2+"px)",i.dom.barPosition.style.width=0==i.duration?"0%":e/i.duration*100+"%"},i.showBuffered=function(e,t){0==i.duration&&t>0&&i.initTime(t),i.dom.barLoaded.style.width=0==i.duration?"0%":e/i.duration*100+"%"},i.timeInfo=function(e){var t="FULL"==i.screenState?{x:0,y:0}:n.findPos(i.dom.barContainer),r=e.pageX-t.x,o=Math.round(r*i.duration/i.dom.barContainer.offsetWidth);o<0&&(o=0),i.dom.timer.innerHTML=n.secToTime(o),i.dom.seekTimer.style.left=r-i.dom.seekTimer.offsetWidth/2+"px",i.dom.barHover.style.left=r-i.dom.barHover.offsetWidth/2+"px"},i.showTootip=function(e,t){var r="FULL"==i.screenState?{x:0,y:0}:n.findPos(i.dom.barContainer),o=e.pageX-r.x;i.dom.controlTip.innerHTML=t,i.dom.controlTip.style.display="block";var a=i.dom.barContainer.offsetWidth,s=i.dom.controlTip.offsetWidth;o=a<=s/2+o?a-s/2:o,i.dom.controlTip.style.left=o-s/2+"px"},i.setPosition=function(e,t){if("STOPPED"!=i.playingState&&i.canPlay){var r="FULL"==i.screenState?{x:0,y:0}:n.findPos(i.dom.barContainer),o=e.pageX-r.x,a=Math.round(o*i.duration/i.dom.barContainer.offsetWidth);t&&i.seek(a),i.showPosition(a)}},i.changeVolume=function(e){var t;for(t=0;t<i.dom.volumeBars.length;t++)n.addRemoveClass(i.dom.volumeBars[t],[],["fill"]);for(t=0;t<=e;t++)n.addRemoveClass(i.dom.volumeBars[t],["fill"],[]);return i.volume=e+1,"MUTE"==i.volumeState?void i.muteUnmute():void i.setVolume(i.volume)},i.showHD=function(){i.hd?i.dom.hd.style.display="inline-block":i.dom.hd.style.display="none"},i.showPoster=function(e){""!=i.poster&&(e?(i.dom.posterImg.src=i.poster,i.dom.posterImg.style.display="inline-block"):i.dom.posterImg.style.display="none")},i.showInfo=function(e){if(""==i.title||"audio"!=i.mediaType||e?i.dom.playInfo.style.display="none":(i.dom.playInfo.innerHTML=i.title,i.dom.playInfo.style.display="block"),i.playlist.length>0){var t=i.playlist[i.currentTrack].value.getThumb();t=n.getDefaultThumb(t),i.poster=t,"audio"==i.mediaType&&i.showPoster(!0)}},i.showLoader=function(){i.isLoading&&i.canPlay?i.dom.loader.style.display="block":i.dom.loader.style.display="none",i.showMusicBar(),i.showBigPlay()},i.showError=function(){i.dom.playError.innerHTML="Sorry, your browser does not support this media format.",i.showLoader(),i.canPlay?i.dom.playError.style.display="none":(i.showPoster(!1),i.dom.playError.style.display="block")},i.showBigPlay=function(e){return i.canPlay?(e?n.addRemoveClass(i.dom.bigBlayIcon,["icon-reload-p"],[]):n.addRemoveClass(i.dom.bigBlayIcon,[],["icon-reload-p"]),"PAUSED"!=i.playingState&&"STOPPED"!=i.playingState||i.isLoading?i.dom.bigBlay.style.display="none":i.dom.bigBlay.style.display="block",void i.showMusicBar()):void(i.dom.bigBlay.style.display="none")},i.initPlaylist=function(){i.playlist.length>1?(i.dom.playlistBtn.style.display="inline-block",i.dom.prevBtn.style.display="inline-block",i.dom.nextBtn.style.display="inline-block",i.dom.auto.style.display="inline-block"):(i.dom.playlistBtn.style.display="none",i.dom.prevBtn.style.display="none",i.dom.nextBtn.style.display="none",i.dom.auto.style.display="none"),i.dom.playlistWrap.style.right="-250px"},i.showPlaylist=function(e){return i.playlistState||e?(i.dom.playlistWrap.style.right="-250px",i.dom.playlistWrap.style.zIndex=999,void(i.playlistState=!1)):i.playlistState?void 0:(i.dom.playlistWrap.style.right="0",i.dom.playlistWrap.style.zIndex=1e4,void(i.playlistState=!0))},i.createPlaylist=function(){if(!(i.playlist.length<2)){for(var r,o,a='<div class="playlist-scrollbar-wrapper"><div rg-scrollbar="true" class="playlist-scrollbar"><ul class="playlist">',s=0;s<i.playlist.length;s++)r=i.playlist[s].value.getThumb(),r=n.getDefaultThumb(r),o=n.trackTemplate.replace(/data-rel/g,s),o=o.replace(/data-thumb/g,r),o=o.replace(/data-caption/g,i.playlist[s].value.getCaption()),o=o.replace(/data-duration/g,n.secToTime(i.playlist[s].value.getDuration())),i.source==i.playlist[s].value.getStreamUrl()&&(i.currentTrack=s),a+="<li>"+o+"</li>";a+="</ul></div></div>",i.dom.playlistWrap.innerHTML="",i.dom.playlistWrap.appendChild(e(a)(t.scope)[0]),i.dom.playlistUL=i.dom.playlistWrap.querySelector(".playlist"),i.dom.playlist=i.dom.playlistWrap.querySelectorAll("ul.playlist > li > a"),t.scope.$parent.$rgDigest();for(var s=0;s<i.dom.playlist.length;s++)i.dom.playlist[s].addEventListener("click",function(e){e.preventDefault(),i.currentTrack=this.getAttribute("rel"),i.title=i.playlist[i.currentTrack].value.getCaption(),i.load(i.playlist[i.currentTrack].value.getStreamUrl())})}},i.updatePlaylist=function(e){e&&(i.playlist=e,i.createPlaylist())},i.AddToPlaylist=function(e){var t,r;if(!i.dom.playlistUL)return void i.updatePlaylist(e);if(e&&i.dom.playlistUL)for(var o=0;o<e.length;o++){var a=document.createElement("li");t=e[o].value.getThumb(),t=n.getDefaultThumb(t),r=n.trackTemplate.replace(/data-rel/g,o),r=r.replace(/data-thumb/g,t),r=r.replace(/data-caption/g,e[o].value.getCaption()),r=r.replace(/data-duration/g,n.secToTime(e[o].value.getDuration())),a.innerHTML=r,i.dom.playlistUL.appendChild(a)}},i.setTrack=function(){if(!(i.playlist.length<2)){0==i.currentTrack?n.addRemoveClass(i.dom.prevBtn,["disabled"],[]):n.addRemoveClass(i.dom.prevBtn,[],["disabled"]),i.currentTrack==i.playlist.length-1?n.addRemoveClass(i.dom.nextBtn,["disabled"],[]):n.addRemoveClass(i.dom.nextBtn,[],["disabled"]);for(var e=0;e<i.dom.playlist.length;e++)e==i.currentTrack?n.addRemoveClass(i.dom.playlist[e],["active"],["active"]):n.addRemoveClass(i.dom.playlist[e],[],["active"]);i.showInfo()}},i.setAuto=function(e){return e?void n.addRemoveClass(i.dom.auto,["enbled"],[]):i.auto?(i.auto=!1,void n.addRemoveClass(i.dom.auto,[],["enbled"])):i.auto?void 0:(i.auto=!0,void n.addRemoveClass(i.dom.auto,["enbled"],[]))},i.showMusicBar=function(){"audio"!=i.mediaType||"PLAYING"!=i.playingState||i.isLoading?i.dom.musicBar.style.display="none":i.dom.musicBar.style.display="block"},i.showControl=function(e){return r.miniPlayer.player?void(i.dom.controlLayer.style.bottom="0px"):void("PLAYING"==i.playingState&&e?(i.dom.controlLayer.style.bottom="0px",i.dom.controlBG.style.opacity=1):(i.dom.controlLayer.style.bottom="-60px",i.dom.controlBG.style.opacity=0))},i.stateChanged=function(e){"BUFFERING"==e?i.isLoading=!0:i.isLoading=!1,i.showLoader(),"PLAYING"==e&&(i.playingState="PLAYING",i.showBigPlay(),n.addRemoveClass(i.dom.playBtn,["icon-pause-p"],["icon-play-p"])),"ENDED"!=e&&"IDLE"!=e||(i.playingState="STOPPED",i.showBigPlay(!0),i.showPlaylist(!0),n.addRemoveClass(i.dom.playBtn,["icon-play-p"],["icon-pause-p"]),i.initTime(0),i.showPosition(0),i.showInfo(!0),i.auto&&i.playlist.length>0&&i.playNext())},i.reset=function(){i.isLoading=!0,i.initTime(0),i.showPosition(0),i.showBuffered(0),i.showLoader(),i.showInfo()},i.fullScreen=function(){if("NORMAL"==i.screenState){if(i.dom.player.requestFullscreen)i.dom.player.requestFullscreen();else if(i.dom.player.mozRequestFullScreen)i.dom.player.mozRequestFullScreen();else{if(!i.dom.player.webkitRequestFullScreen)return!1;i.dom.player.webkitRequestFullScreen()}return i.screenState="FULL",i.showControl(!0),n.addRemoveClass(i.dom.player,["full"],[]),n.addRemoveClass(i.dom.fullScreenBtn,["icon-screen-fe"],["icon-screen-f"]),r.miniPlayer.dom.container&&n.addRemoveClass(r.miniPlayer.dom.container,["full"],[]),i.dom.fullScreenBtn.setAttribute("tooltip",n.dicts.maximize),!0}if("FULL"==i.screenState)return document.cancelFullscreen?document.cancelFullscreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),n.addRemoveClass(i.dom.player,[],["full"]),n.addRemoveClass(i.dom.fullScreenBtn,["icon-screen-f"],["icon-screen-fe"]),r.miniPlayer.dom.container&&n.addRemoveClass(r.miniPlayer.dom.container,[],["full"]),i.showControl(!1),i.screenState="NORMAL",r.escapeKey=!0,i.dom.fullScreenBtn.setAttribute("tooltip",n.dicts.fullScreen),!0},i.playNext=function(){i.currentTrack!=i.playlist.length-1&&(i.currentTrack++,i.title=i.playlist[i.currentTrack].value.getCaption(),i.load(i.playlist[i.currentTrack].value.getStreamUrl()),t.onNext&&t.onNext.apply(t.scope))},i.playPrev=function(){0!=i.currentTrack&&(i.currentTrack--,i.title=i.playlist[i.currentTrack].value.getCaption(),i.load(i.playlist[i.currentTrack].value.getStreamUrl()),t.onNext&&t.onNext.apply(t.scope))},i.getPlaylistUI=function(){return i.dom.playlistWrap},i.getNextUI=function(){return i.dom.nextBtn},i.getPrevUI=function(){return i.dom.prevBtn},i.load=function(e){i.reset(),i.setTrack(),i.provider.pause(),i.seek(0),i.provider.src=e,i.source=e,angular.isFunction(t.scope.onChange())&&i.playlist.length>0&&t.scope.onChange()(i.playlist[i.currentTrack].value)},i.play=function(){i.provider.play(),i.playingState="PLAYING",n.addRemoveClass(i.dom.playBtn,["icon-pause-p"],["icon-play-p"])},i.pause=function(){i.provider.pause(),i.playingState="PAUSED",n.addRemoveClass(i.dom.playBtn,["icon-play-p"],["icon-pause-p"])},i.resume=function(){i.provider.play(),i.playingState="PLAYING",n.addRemoveClass(i.dom.playBtn,["icon-pause-p"],["icon-play-p"])},i.seek=function(e){try{i.provider.currentTime=e}catch(e){}},i.stop=function(){i.provider.pause(),i.seek(0),i.playingState="STOPPED",n.addRemoveClass(i.dom.playBtn,["icon-play-p"],["icon-pause-p"])},i.setVolume=function(e){i.provider.volume=e/10},i.initEvent(),i.showControl(),i.showLoader(),i.showBigPlay(),i.showError(),i.showInfo(),i.showMusicBar(),i.initPlaylist(),i.showHD(),i.playingState="STOPPED",i.provider.autoplay=!1,i.load(t.source),i.setVolume(i.volume),n.instances.push(i),i},r}]}rgPlayer.$inject=["$compile","$player","$ringbox"];function rgPlayer(e,t,n){function r(e,r,i){var o=i.id?i.id:"player_1",a=i.width?i.width:"100%",s=i.height?i.height:"100%",c="false"!=i.auto&&0!=i.auto,l=i.url?i.url:"",u=i.title?i.title:"",d="true"==i.isVideo||0==i.isVideo?"video":"audio",g=i.poster?i.poster:"audio"==d?"images/player-audio.png":"",m="false"!=i.autoPlay&&0!=i.autoPlay,f="true"==i.chat||1==i.chat,E=null,p=null;g&&"default_audio_image.jpg"!=g||(g="images/player-audio.png");var T='<div title="" id="player_'+o+'" class="player '+d+'"></div>';r.append(T),setTimeout(function(){E=t.player({source:l,title:u,playlist:e.playlist,auto:c,type:d,parentId:"player_"+o,autoPlay:m,chatVersion:f,width:a,height:s,poster:g,ringboxMinimize:n.minimize,ringboxMaximize:n.maximize,ringboxRemove:n.removeMinimize,scope:e}),p=r[0].closest(".ringbox-inner").querySelector(".player-size"),p&&p.addEventListener("click",h,!1)});function h(e){e.preventDefault(),e.stopPropagation(),E.minimize()}e.$on("$destroy",function(){p&&p.removeEventListener("click",h),p=null})}return{restrict:"E",scope:{onChange:"&",onStart:"&",onEnded:"&",playlist:"="},link:r}}angular.module("ringid.global_directives").directive("rgImgLoad",rgImgLoad).directive("rgClick",rgClick).directive("rgConditionalClick",rgConditionalClick),rgConditionalClick.$inject=[];function rgConditionalClick(){return function(e,t,n){angular.isFunction(n.rgConditionalClick)&&(t.bind("click",function(e){n.rgConditionalClick()}),e.$on("$destroy",function(){t.unbind("click")}))}}rgClick.$inject=["$parse"];function rgClick(e){return{restrict:"A",link:function(t,n,r){var i=e(r.rgClick);r.rgClickNoapply;function o(e){i(t,{$event:e}),t.$rgDigest()}n.bind("click",o),t.$on("$destroy",function(){n.unbind("click",o)})}}}function rgImgLoad(){return{restrict:"A",transclude:!0,link:function(e,t,n){t.on("load",function(){})}}}angular.module("ringid.global_directives").provider("$scrollbar",ScrollbarProvider).directive("rgScrollbar",rgScrollbar).factory("rgScrollbarService",rgScrollbarService);function ScrollbarProvider(){this.findPos=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}},this.findPosType=function(e){var t,n=0;if(e=e.offsetParent)do if(t=getComputedStyle(e,null),"fixed"==t.getPropertyValue("position")){n=1;break}while(e=e.offsetParent);return n},this.tabindex=100,this.$get=["$$q",function(e){var t=this;function n(n,r){var i,o,a,s,c,l,u,d=this,g=500,r={scrollbarWidth:r.scrollbarWidth?r.scrollbarWidth:8,scrollbarAlways:!!r.scrollbarAlways&&r.scrollbarAlways,dragSpeedModifier:r.dragSpeedModifier?r.dragSpeedModifier:5,minThumbHeight:r.minThumbHeight?r.minThumbHeight:10,clickSpeedModifier:r.clickSpeedModifier?r.clickSpeedModifier:40,keyboardSpeedModifier:r.keyboardSpeedModifier?r.keyboardSpeedModifier:20,keyboardEvent:!!r.keyboardEvent&&r.keyboardEvent,onBottomReached:!!r.onBottomReached&&r.onBottomReached};this.scrollbarMousedown=!1,this.isFreezed=!1,this.freezeInfo={height:"",position:"",scrollHeight:0},this.scrollbarVisible=!1,this.displayState="none",this.hasScroll=!1,this.lastY=0,this.scrollHeight=0,this.offsetHeight=0,this.visibleHeight=0,this.thumbHeight=0,this.thumbTimer=null,this.mousewheel="undefined"!=typeof InstallTrigger?"DOMMouseScroll":"mousewheel",this.isTouchSupport="ontouchstart"in window||navigator.msMaxTouchPoints,this.isFixedPosition=-1,this.dom=Object.create(null),this.dom.element=n,this.dom.scrollbarContainer=this.dom.element.parentNode,this.dom.wrapper=document.createElement("div"),this.dom.scrollbar=document.createElement("div"),this.dom.scrollbarThumb=document.createElement("div"),this.dom.scrollbar.className="scrollbar",this.dom.scrollbarThumb.className="thumb",this.dom.wrapper.className="ringscroll",this.dom.element.style.overflow="hidden",this.dom.wrapper.setAttribute("style","position:relative;width:auto;overflow:hidden;height:100%;"),this.dom.scrollbar.setAttribute("style","height:100%;right:1px;opacity:0;top:0px;position:absolute;z-index:1;width:"+r.scrollbarWidth+"px"),this.dom.scrollbarThumb.setAttribute("style","right:1px;top:0px;opacity:0;position:absolute;z-index:1;width:"+r.scrollbarWidth+"px"),this.dom.scrollbarContainer.insertBefore(this.dom.wrapper,this.dom.element),this.dom.wrapper.appendChild(this.dom.element),this.dom.wrapper.appendChild(this.dom.scrollbar),this.dom.wrapper.appendChild(this.dom.scrollbarThumb),this.scroll=function(e,t,n){var l;fastdom.read(function(){d.dom.element&&(d.hiddenHeight=d.scrollHeight-d.offsetHeight,d.visibleHeight=d.offsetHeight-d.thumbHeight,l=e/d.visibleHeight,e=Math.min(Math.max(e,0),d.visibleHeight),t?(c=0,i=d.dom.element.scrollTop,o=d.hiddenHeight*l-i,a=n,s=e-a,d.doAnimation()):fastdom.write(function(){d.dom.element.scrollTop=d.hiddenHeight*l,d.dom.scrollbarThumb.style.top=e+"px"}),e==d.visibleHeight&&r.onBottomReached&&angular.isFunction(r.onBottomReached)&&r.onBottomReached())})},this.reCalculate=function(t){var n,i,o=!!t&&e.defer();return fastdom.read(function(){d.dom&&(d.isFreezed&&(d.dom.wrapper.style.height="100%",d.dom.element.style.position=d.freezeInfo.position,d.dom.element.style.height=d.freezeInfo.height,d.dom.element.style.bottom="initial"),d.scrollHeight=d.dom.element.scrollHeight,d.offsetHeight=d.dom.element.offsetHeight,d.hiddenHeight=d.scrollHeight-d.offsetHeight,d.thumbHeight=Math.max(d.offsetHeight/d.scrollHeight*d.offsetHeight,r.minThumbHeight),(isNaN(d.thumbHeight)||"Infinity"==d.thumbHeight)&&(d.thumbHeight=0),d.visibleHeight=d.offsetHeight-d.thumbHeight,d.isFreezed&&(d.dom.element.scrollTop=d.scrollHeight-d.freezeInfo.scrollHeight),
n=d.visibleHeight/d.hiddenHeight,i=d.dom.element.scrollTop*n,d.displayState=d.thumbHeight>=d.offsetHeight?"none":"block",d.hasScroll=!(d.thumbHeight>=d.offsetHeight),fastdom.write(function(){d.dom&&(d.dom.scrollbar.style.display=d.displayState,d.dom.scrollbarThumb.style.height=d.thumbHeight+"px",d.dom.scrollbarThumb.style.display=d.displayState,d.dom.scrollbarThumb.style.top=i+"px"),o&&o.resolve(),d.isFreezed=!1}))}),!!o&&o.promise},this.scrollBySelector=function(e,t,n){var r,i,o,a=0,s=null,c=0,l=0,u=0,g=0;n="undefined"!=typeof n&&null!==n?parseInt(n):0,s=this.dom.element.querySelector(e),s&&(i=s.offsetTop,r=s.offsetHeight,l=parseFloat(d.dom.scrollbarThumb.style.top),t&&(a=r),l+this.dom.element.scrollTop<i&&(u=this.dom.element.offsetHeight-r,t&&(a=-1*r)),o=i+a+n-u,g=o/this.hiddenHeight,c=g*this.visibleHeight,this.scroll(c,!0,l))},this.freeze=function(){if(this.hasScroll){var e=this.scrollHeight-(this.dom.element.scrollTop+this.offsetHeight);if(""==this.freezeInfo.height){var t=getComputedStyle(this.dom.element,null);this.freezeInfo.height=t.getPropertyValue("height"),this.freezeInfo.position=t.getPropertyValue("position")}this.freezeInfo.scrollHeight=this.scrollHeight,this.dom.wrapper.style.height=this.offsetHeight+"px",this.dom.element.style.position="absolute",this.dom.element.style.bottom="-"+e+"px",this.dom.element.style.height="auto",this.isFreezed=!0}},this.scrollByPos=function(e,t){var n,r;t="undefined"!=typeof t&&null!==t&&t,t&&(r=parseFloat(this.dom.scrollbarThumb.style.top)),e=parseInt(e),n=e*this.visibleHeight/100,this.scroll(n,t,r)},this.scrollTop=function(e){this.scrollByPos(0,e)},this.scrollBottom=function(e){this.scrollByPos(100,e)},this.hideScrollbar=function(){r.scrollbarAlways||d.isFreezed||(d.scrollbarMousedown||(d.dom.scrollbar.style.opacity=0,d.dom.scrollbarThumb.style.opacity=0,d.scrollbarVisible=!1),d.thumbTimer=null)},this.showScrollbar=function(){this.isFreezed||d.reCalculate(),d.dom.scrollbar.style.opacity=1,d.dom.scrollbarThumb.style.opacity=1,d.scrollbarVisible=!0,r.keyboardEvent&&d.dom.element.focus()},this.destroy=function(){this.dom.scrollbarContainer.removeEventListener("mouseenter",A),this.dom.scrollbarContainer.removeEventListener("mouseleave",I),this.dom.scrollbarThumb.removeEventListener("mousedown",p),this.dom.scrollbar.removeEventListener("click",f),this.dom.element.removeEventListener(this.mousewheel,E),this.dom.element.removeEventListener("keydown",m),this.dom.element.removeEventListener("touchmove",_),d=this.dom=null},this.doAnimation=function(){c+=25;var e=Math.easeIn(c,i,o,g),t=Math.easeIn(c,a,s,g);d.dom.element.scrollTop=e,d.dom.scrollbarThumb.style.top=t+"px",c<g&&requestAnimationFrame(d.doAnimation)},this.dom.scrollbarContainer.addEventListener("mouseenter",A,!1),this.dom.scrollbarContainer.addEventListener("mouseleave",I,!1),this.dom.scrollbarThumb.addEventListener("mousedown",p,!1),this.dom.scrollbar.addEventListener("click",f,!1),this.dom.element.addEventListener(this.mousewheel,E,!1),r.keyboardEvent&&(this.dom.element.addEventListener("keydown",m),this.dom.element.setAttribute("tabindex",t.tabindex++)),this.isTouchSupport&&this.dom.element.addEventListener("touchmove",_);function m(e){e.preventDefault(),e.stopPropagation();var t=e.which||e.keyCode||e.key;if(38==t||40==t){d.showScrollbar();var n=parseFloat(d.dom.scrollbarThumb.style.top),i=r.keyboardSpeedModifier;38==t&&(i*=-1);var o=n+i;d.scroll(o),d.thumbTimer&&clearTimeout(d.thumbTimer),d.thumbTimer=setTimeout(d.hideScrollbar,1e3)}}function f(e){e.preventDefault();var n,i,o,a=t.findPos(d.dom.scrollbar),s=parseFloat(d.dom.scrollbarThumb.style.top);d.isFixedPosition==-1&&(d.isFixedPosition=t.findPosType(d.dom.element)),n=(d.isFixedPosition?e.clientY:e.pageY)-a.y,i=r.clickSpeedModifier+parseInt(d.scrollHeight/d.offsetHeight/20)*r.clickSpeedModifier,n<s&&(i*=-1),o=s+i,d.scroll(o,!0,s)}function E(e){if("none"!=d.displayState){e.preventDefault(),d.scrollbarVisible||d.showScrollbar();var t,n,i,o=parseFloat(d.dom.scrollbarThumb.style.top);t=e.wheelDelta?-.025*e.wheelDelta:3*e.detail,n=Math.max(parseInt(2*d.offsetHeight/d.scrollHeight*r.dragSpeedModifier),1),i=o+t*n,d.scroll(i)}}function p(e){e.preventDefault(),e.stopPropagation(),d.scrollbarVisible||d.showScrollbar(),d.scrollbarMousedown=!0,l=e.pageY,u=parseFloat(d.dom.scrollbarThumb.style.top),document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",h,!1)}function T(e){var t=u+e.pageY-l;d.scroll(t)}function h(e){e.stopPropagation(),d.scrollbarMousedown=!1,document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",h)}function _(e){e.preventDefault();var t,n,i=2,o=e.touches[0].clientY,a=parseFloat(d.dom.scrollbarThumb.style.top);n=Math.max(parseInt(2*d.offsetHeight/d.scrollHeight*r.dragSpeedModifier),1),t=o<d.lasty?a+i*n:a-i*n,d.scroll(t),d.lasty=o}function I(){d.hideScrollbar()}function A(){d.showScrollbar()}}var r={};return r.create=function(e,t){var r=new n(e,t);return r},r}]}rgScrollbar.$inject=["$scrollbar"];function rgScrollbar(e){function t(t,n,r){if("true"!=r.disabled&&1!=r.disabled){var i={};r.thumbHeight&&parseInt(r.thumbHeight)>0&&(i.minThumbHeight=parseInt(r.thumbHeight)),r.keyboard&&(i.keyboardEvent=!0),t.bottomReached&&(i.onBottomReached=t.bottomReached);var o=e.create(n[0],i);t.$on("scrollTop",function(e){e.stopPropagation&&e.stopPropagation(),setTimeout(function(){o.scroll(0)},100)}),t.$on("scrollTo",function(e,t,n,r){e.stopPropagation&&e.stopPropagation(),"string"==typeof t?o.scrollBySelector(t,n,r):o.scrollByPos(t)}),t.$on("recalculate",function(e){e.stopPropagation&&e.stopPropagation(),o.reCalculate()}),t.$on("hasScroll",function(e,t){e.stopPropagation&&e.stopPropagation(),t.scroll=!o.hasScroll}),t.$on("freeze",function(e,t){e.stopPropagation&&e.stopPropagation(),o.freeze()}),t.$on("$destroy",function(){o.destroy(),o=null})}}return{restrict:"A",scope:{bottomReached:"&"},link:t}}function rgScrollbarService(){return{scrollTop:function(e){e.$broadcast("scrollTop")},scrollTo:function(e,t,n,r){e.$broadcast("scrollTo",t,n,r)},recalculate:function(e){e.$broadcast("recalculate")},hasScroll:function(e){e.$broadcast("hasScroll",e)}}}angular.module("ringid.global_directives").service("rgDropdownService",rgDropdownService).directive("rgDropdown",rgDropdown),rgDropdownService.$inject=["GlobalEvents"];function rgDropdownService(e){var t=this,n=!1,r=!1;function i(e){var n=e.keyCode||e.which;27===n&&t.close(e)}function o(){n&&angular.isFunction(n.ddBeforeClose)&&n.ddBeforeClose(),r(),e.unbindHandler("document","click",t.close),e.unbindHandler("document","keydown",i)}function a(){n.ddOpened(),e.bindHandler("document","click",t.close),e.bindHandler("document","keydown",i)}t.open=function(e,t){r&&o(),r=e,n=t,a()},t.close=function(e){e&&(e.preventDefault(),e.stopPropagation()),r&&o(),r=!1,n=!1}}rgDropdown.$inject=["$ringhttp","settings","$compile","rgDropdownService","languageConstant","Utils","rgScrollbarService"];function rgDropdown(e,t,n,r,i,o,a){function s(t,o){var a,s,c=!1,l=!1;t.consType=i.get();function u(e){e.stopPropagation()}function d(e){c?r.close():(E(e),r.open(p,t)),u(e)}function g(e){setTimeout(function(){l||d(e)},500)}o.on("click",d),(t.ddHtml||t.ddTemplate)&&(t.ddTemplate?s=t.ddTemplate:e.get(t.ddHtml).success(function(e){s=e}).error(function(){t.$rgDigest()}));function m(e){l=!0,o.off("mouseleave",g)}function f(e){l=!1,g(e),o.on("mouseleave",g)}function E(e){c=!0,a=n(s)(t),t.ddControl&&t.ddControl.hasOwnProperty("append")&&!t.ddControl.append?o.after(a):o.append(a);for(var r=0;r<a.length;r++)a[r].addEventListener("click",u);t.ddControl&&t.ddControl.showOnHover&&(o[0].addEventListener("mouseleave",g),a[a.length-1].addEventListener("mouseenter",m),a[a.length-1].addEventListener("mouseleave",f)),t.$rgDigest()}function p(){var e;for(c=!1,e=0;e<a.length;e++)a[e].removeEventListener("click",u);t.ddControl&&t.ddControl.showOnHover&&(o[0].removeEventListener("mouseleave",g),a[a.length-1].removeEventListener("mouseenter",m),a[a.length-1].removeEventListener("mouseleave",f)),a.remove(),t.$parent.$rgDigest()}t.$on("$destory",function(){o[0].removeEventListener("click",d),p()})}return{restrict:"AE",link:s,scope:{ddHtml:"=",ddControl:"=",ddTemplate:"=",ddAction:"&",ddOpened:"&",ddBeforeClose:"&"}}}angular.module("ringid.global_directives").directive("rgPageTitle",rgPageTitle),rgPageTitle.$inject=["$rootScope","chatHistoryFactory","Utils","SystemEvents"];function rgPageTitle(e,t,n,r){var i,o=1e3,a=n.getCurrentPageTitle(),s=function(){var e=t.getUnreadConversationCount();return e>0?"("+e+") "+a:a},c=s;function l(){i=setInterval(function(){var e=s();n.setPageTitle(n.getCurrentPageTitle()===e?a:e)},o)}function u(){clearInterval(i),n.setPageTitle(c())}return e.$on("ringActive",u),e.$on("ringInactive",l),e.$on("PAGE_TITLE_CHANGE",function(e,t){a=t.title}),n.onCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){n.setPageTitle(c())}),n.onCustomEvent(r.CHAT.CONVERSATION_COUNT_RESETED,function(){n.setPageTitle(c())}),{}}!function(e,t){"use strict";e.module("ringid.social",[])}(angular,window),angular.module("ringid.social").service("socialUtils",function(){var e=this;e.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,r){return r?n.toUpperCase():n})},e.parseQueryString=function(e){var t,n,r={};return angular.forEach((e||"").split("&"),function(e){e&&(n=e.split("="),t=decodeURIComponent(n[0]),r[t]=!angular.isDefined(n[1])||decodeURIComponent(n[1]))}),r},e.joinUrl=function(e,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;var n=[e,t].join("/"),r=function(e){return e.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return r(n)},e.merge=function(t,n){var r={};for(var i in t)t.hasOwnProperty(i)&&(i in n&&"object"==typeof t[i]&&null!==i?r[i]=e.merge(t[i],n[i]):r[i]=t[i]);for(i in n)if(n.hasOwnProperty(i)){if(i in r)continue;r[i]=n[i]}return r}}),angular.module("ringid.social").constant("socialConfig",{providers:{facebook:{name:"facebook",url:"/auth/facebook",clientId:"477404429103451",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/static-index.html",requiredUrlParams:["access_code"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:680,height:500}},twitter:{twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin+"/static-index.html",type:"1.0",serverUrl:window.location.origin+"/TwiteerLoginService",popupOptions:{width:595,height:745}}}}),angular.module("ringid.social").factory("socialPopup",socialPopup),socialPopup.$inject=["$$q","$interval","$window","socialConfig","socialUtils"];function socialPopup(e,t,n,r,i){var o={};return o.url="",o.popupWindow=null,o.open=function(e,t,i){o.url=e;var a=o.stringifyOptions(o.prepareOptions(i)),s=n.navigator.userAgent,c=r.cordova||s.indexOf("CriOS")>-1?"_blank":t;return o.popupWindow=n.open(e,c,a),n.popup=o.popupWindow,o.popupWindow&&o.popupWindow.focus&&o.popupWindow.focus(),o},o.eventListener=function(t){var n=e.defer();return o.popupWindow.addEventListener("loadstart",function(e){if(0===e.url.indexOf(t)){var r=document.createElement("a");if(r.href=e.url,r.search||r.hash){var a=r.search.substring(1).replace(/\/$/,""),s=r.hash.substring(1).replace(/\/$/,""),c=i.parseQueryString(s),l=i.parseQueryString(a);angular.extend(l,c),l.error||n.resolve(l),o.popupWindow.close()}}}),o.popupWindow.addEventListener("loaderror",function(){n.reject({rc:0,mg:"Error Loading Authorization URL"})}),o.popupWindow.addEventListener("onbeforeunload",function(){n.reject({rc:0,mg:"Popup closed unexpectedly"})}),n.promise},o.pollPopup=function(){var n=e.defer(),r=t(function(){try{var e=document.location.host,a=o.popupWindow.location.host;if(a===e&&(o.popupWindow.location.search||o.popupWindow.location.hash)){var s=o.popupWindow.location.search.substring(1).replace(/\/$/,""),c=o.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),l=i.parseQueryString(c),u=i.parseQueryString(s);angular.extend(u,l),u.error?n.reject(u):n.resolve(u),t.cancel(r),o.popupWindow.close()}}catch(e){}o.popupWindow&&!o.popupWindow.closed&&void 0!==o.popupWindow.closed||t.cancel(r)},50);return n.promise},o.prepareOptions=function(e){e=e||{};var t=e.width||500,r=e.height||500;return angular.extend({width:t,height:r,left:n.screenX+(n.outerWidth-t)/2,top:n.screenY+(n.outerHeight-r)/2.5},e)},o.stringifyOptions=function(e){var t=[];return angular.forEach(e,function(e,n){t.push(n+"="+e)}),t.join(",")},o}angular.module("ringid.social").factory("socialOauth",socialOauth).factory("socialOauth1",socialOauth1).factory("socialOauth2",socialOauth2),socialOauth.$inject=["socialConfig","socialOauth1","socialOauth2"];function socialOauth(e,t,n){var r={};return r.authenticate=function(r,i){var o="1.0"===e.providers[r].type?new t:new n;return o.open(e.providers[r],i)},r}socialOauth2.$inject=["$$q","$window","socialUtils","socialConfig","Storage","socialPopup","$ringhttp"];function socialOauth2(e,t,n,r,i,o,a){return function(){function t(){var e=[],t=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return angular.forEach(t,function(t){angular.forEach(s[t],function(t){var r=n.camelCase(t),i=angular.isFunction(s[t])?s[t]():s[r];e.push([t,i])})}),e.map(function(e){return e.join("=")}).join("&")}var r={},s={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"token",responseParams:{token:"token",clientId:"clientId",redirectUri:"redirectUri"}};return r.open=function(n,r){var c=e.defer();s=angular.extend({},n,s);var l,u,d=s.name+"_state";angular.isFunction(s.state)?i.setData(d,s.state()):angular.isString(s.state)&&i.setData(d,s.state),l=[s.authorizationEndpoint,t(r)].join("?"),u=o.open(l,s.name,s.popupOptions,s.redirectUri);var g=setInterval(function(){u.popupWindow.closed&&(clearInterval(g),c.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return u.pollPopup().then(function(e){clearInterval(g),a.get("https://graph.facebook.com/me?access_token="+e.access_token).success(function(t){t.id?c.resolve({platform:s.name,id:t.id,name:t.name,access_token:e.access_token}):c.reject()}).error(function(){c.reject()})},function(){c.reject({mg:"Popup blocked by Browser. Please unblock."})}),c.promise},r}}socialOauth1.$inject=["$q","socialConfig","socialUtils","socialPopup","$ringhttp"];function socialOauth1(e,t,n,r,i){return function(){function t(e,t){t.uId=t.uId.toString();var n="?step=3&oauth_token="+e.oauth_token+"&verifier="+e.oauth_verifier+(t.uId&&t.uId.length>2?"&uId="+t.uId:"")+"&time="+(new Date).getTime();return i.get(s.serverUrl+n)}function n(){return i.get(s.serverUrl+"?step=1&callback="+encodeURIComponent(s.redirectUri)+"&time="+Date.now())}function o(e){var t=[];return angular.forEach(e,function(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")}var a={},s={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return a.open=function(i,a){var c,l=e.defer();angular.extend(s,i),c=r.open("",s.name,s.popupOptions,s.redirectUri);var u=setInterval(function(){c.popupWindow.closed&&(clearInterval(u),l.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return n().success(function(e){if(e.sucs===!0){var n=e.data,r=[s.authorizationEndpoint,o({oauth_token:n.token,callback_url:s.redirectUri})].join("?");c.popupWindow?(c.popupWindow.location=r,c.pollPopup().then(function(e){clearInterval(u),t(e,a).success(function(t){if(t.sucs===!0||2===t.rc){var n=t.data.members,r=JSON.parse(n.userDetails),i=JSON.parse(n.accessToken);l.resolve({platform:s.name,id:r.id_str,name:r.name,access_token:i.token,oauthParameters:i.oauthParameters,oauth_token:e.oauth_token,oauth_verifier:e.oauth_verifier})}else l.reject({mg:"exchangeForRequest failed"})}).error(function(){l.reject({mg:"exchangeForRequest failed. Server error"})})})):l.reject({mg:"Popup blocked by Browser. Please unblock."})}else l.reject({mg:"exchangeForRequest failed"})}).error(function(){l.reject({mg:"exchangeForRequest failed. Server error"})}),l.promise},a}}angular.module("ringid.social").provider("$authSocial",["socialConfig",function(e){angular.forEach(Object.keys(e.providers),function(t){this[t]=function(n){return angular.extend(e.providers[t],n)}},this);var t=function(t){e.providers[t.name]=e.providers[t.name]||{},angular.extend(e.providers[t.name],t)};this.oauth1=function(n){t(n),e.providers[n.name].type="1.0"},this.oauth2=function(n){t(n),e.providers[n.name].type="2.0"},this.$get=["$$q","socialOauth",function(e,t){var n={};return n.login=function(n){var r,i=e.defer();return r?i.resolve(r):t.authenticate(n,"login").then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},n.authenticate=function(n,r){var i=e.defer();return t.authenticate(n,r).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},n}]}]),function(e,t){"use strict";e.module("ringid.auth",["ringid.config","ringid.digits","ringid.connector","ringid.social"])}(angular,window),angular.module("ringid.auth").directive("rgSlider",function(){return{link:function(e,t,n){var r,i=0,o=!1,a=null,s=[],c=t[0],l=n.navClass||"",u=n.slideClass||"",d=n.descClass||"",g=1e3*parseInt(n.delay)||3e3,m=angular.element(c.querySelectorAll("."+u)),f=angular.element(c.querySelectorAll("."+d)),E=c.querySelectorAll("."+l)||{},p=120,T=.6,h=.6,_=.8,I=c.querySelector(".nav-carousel"),A=I.querySelectorAll("img");A=Array.prototype.slice.call(A);var v=[],S=I.clientWidth,C=I.clientHeight,D=Math.floor(A.length/2);O(),M();function M(){for(m.removeClass("active"),m.eq(i).addClass("active"),f.removeClass("active"),f.eq(i).addClass("active"),r=0;r<s.length;r++)s[r].find("li").removeClass("active"),s[r].find("li").eq(i).addClass("active");v[0]&&R(F(i)),o&&(i=i+1==m.length?0:i+1,y())}function y(){a=setTimeout(function(){M()},g)}function N(){clearTimeout(a)}function b(e){for(var t=e.parentNode.childNodes,n=0,r=0;r<t.length;r++){if(t[r]==e)return n;1==t[r].nodeType&&n++}return-1}function O(){var e;for(r=0;r<E.length;r++)e=angular.element(E[r]),s.push(e),e.find("li").on("click",function(e){i=b(this),N(),M()});m.on("mouseenter",function(e){e.stopPropagation(),o=!1,N()}),m.on("mouseleave",function(e){e.stopPropagation(),o=!1,y()}),f.on("mouseenter",function(e){e.stopPropagation(),o=!1,N()}),f.on("mouseleave",function(e){e.stopPropagation(),o=!1,y()})}function P(){var e,t,n,o,a,s,c;for(e=A[0].clientWidth,t=A[0].clientHeight,n=1,o=Math.round(S/2)-Math.round(e/2),a=Math.round(C/2)-Math.round(t/2),v[D]={w:e,h:t,o:n,l:o,t:a,z:D,i:0},c=p,s=D,r=D+1;r<A.length;r++)c*=T,e=h*v[r-1].w,t=h*v[r-1].h,n=_*v[r-1].o,o=v[r-1].l+v[r-1].w+c-e,--s,a=Math.round(C/2)-Math.round(t/2),v[r]={w:e,h:t,o:n,l:o,t:a,z:s,i:r};for(c=p,s=D,r=D-1;r>=0;r--)c*=T,e=h*v[r+1].w,t=h*v[r+1].h,n=_*v[r+1].o,o=v[r+1].l-c,--s,a=Math.round(C/2)-Math.round(t/2),v[r]={w:e,h:t,o:n,l:o,t:a,z:s,i:r};for(r=0;r<A.length;r++)A[r].orgPos=r,A[r].crslPos=r,A[r].addEventListener("click",function(e){this.crslPos!=D&&(i=this.orgPos,N(),M(),R(this))})}function R(e){U(e),L()}function U(e){for(var t,n=e.crslPos<D?"forward":"backward";e.crslPos!=D;)for("forward"==n?(t=A.pop(),A.unshift(t)):(t=A.shift(),A.push(t)),r=0;r<A.length;r++)A[r].crslPos=r,A[r].className="";e.className="active"}function L(){for(r=0;r<A.length;r++)A[r].style.width=v[r].w+"px",A[r].style.height=v[r].h+"px",A[r].style.opacity=v[r].o,A[r].style.left=v[r].l+"px",A[r].style.top=v[r].t+"px",A[r].style.zIndex=v[r].z,v[r].i=r}function F(e){for(r=0;r<A.length;r++)if(e==A[r].orgPos)return A[r]}A[0].src=A[0].src,A[0].addEventListener("load",function(){P(),R(A[0]),setTimeout(function(){I.style.visibility="visible"},800)})}}}),angular.module("ringid.auth").controller("AuthController",AuthController),AuthController.$inject=["rgDropdownService","Storage","Auth","$scope","$$connector","$rootScope","Ringalert","settings","MESSAGES"];function AuthController(e,t,n,r,i,o,a,s,c){r.requestFailed=l,r.activeTab="phone",r.credentials={username:"",authMethod:"phone",uId:"",lt:2,mbl:"",email:"",ringid:"",password:"",remember:!!t.getData("remember"),mblDc:n.getCountry().code,flagcode:n.getCountry().flagcode},r.autofill={email:r.credentials.email,ringid:r.credentials.ringid,mbl:r.credentials.mbl},r.errorMsg="",r.requestSuccess=!1,r.disableForm=!1,r.formStyle={left:"0px"},r.activateTab=u,r.setPrefix=d,r.login=g,r.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" ><li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',r.ddControl={append:!1,countryList:n.getCountryList};function l(e,t,n){e?(r.disableForm=!1,e.sucs===!0||"true"===e.sucs?(r.requestSuccess=!0,r.errorMsg=e.mg||c.REQUEST_PROCESSED):(r.requestSuccess=!1,r.errorMsg=e.hasOwnProperty("rc")&&e.rc>0?c["RC"+e.rc]:e.mg||c.REQUEST_FAILED,s.analytics&&ga("send","event",t+" Message:"+r.errorMsg+" RC:"+e.rc||"UNKNOWN")),n&&a.show(r.errorMsg,"error")):(r.disableForm=!0,r.requestSuccess=!0,r.errorMsg=""),r.$rgDigest()}function u(e){if(!r.disableForm){switch(r.errorMsg="",r.activeTab=e,r.activeTab){case"email":r.credentials.authMethod="email",r.formStyle.left="-800px",r.credentials.lt=3;break;case"ringid":r.credentials.authMethod="ringid",r.formStyle.left="-400px",r.credentials.lt=1;break;case"facebook":r.credentials.authMethod="social",r.formStyle.left="-1200px",r.credentials.lt=4;break;case"twitter":r.credentials.authMethod="social",r.formStyle.left="-1200px",r.credentials.lt=5;break;case"social":r.credentials.authMethod="social",r.formStyle.left="-1200px";break;default:r.credentials.authMethod="phone",r.formStyle.left="0px",r.credentials.lt=2}r.$rgDigest()}}function d(n){n.event&&e.close(n.event),t.setData("country",n.item),r.credentials.mblDc=n.item.code,r.credentials.flagcode=n.item.flagcode,r.$rgDigest()}function g(e,t){if(t&&t.preventDefault(),e){switch(r.credentials.authMethod){case"ringid":r.credentials.username=r.credentials.ringid;break;case"email":r.credentials.username=r.credentials.email;break;case"phone":r.credentials.username=r.credentials.mbl}r.requestFailed(!1),n.login(r.credentials).then(function(e){e.sucs===!0||"true"===e.sucs?r.params&&r.params.fromPopup?(r.closeAll(),window.location="/"):o.$rgDigest():r.requestFailed(e,"Signin:"+r.credentials.authMethod)},function(e){r.requestFailed(e,"Signin:"+r.credentials.authMethod)})}}function m(){var e=t.getData("activeTab");if(e){var n=t.getData("autoFill");switch(e){case"phone":r.credentials.mbl=n,r.credentials.username=n,r.credentials.lt=2;break;case"email":r.credentials.lt=3,r.credentials.email=n,r.credentials.username=n;break;case"ringid":r.credentials.ringid=n,r.credentials.username=n,r.credentials.lt=1}u(e)}r.$rgDigest()}m()}angular.module("ringid.auth").controller("RingboxAuthController",RingboxAuthController),RingboxAuthController.$inject=["$scope","$boxInstance","$controller","localData"];function RingboxAuthController(e,t,n,r){e.close=t.close,e.closeAll=t.closeAll,e.showLoader=t.showLoader,e.hideLoader=t.hideLoader,e.params=r,n("SignInController",{$scope:e})}angular.module("ringid.auth").controller("SignInController",SignInController),SignInController.$inject=["$authSocial","$controller","$scope","Auth","Ringalert","$rootScope","$ringbox","$sce"];function SignInController(e,t,n,r,i,o,a,s){angular.extend(this,t("AuthController",{$scope:n})),n.noSignupAllowed=function(){var e=s.trustAsHtml('<p>Please sign up from your iOS, Android, Windows enabled device or Desktop prior to logging in from the Web version.</p><p>Create an account for Newsportal & Pages, <a href="accounts.html" class="ring-color">Click here</a></p>'),t=a.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{title:"Sign Up",message:e}},templateUrl:"templates/partials/ringbox-alert.html"});t.result.then(angular.noop)};function c(t){e.authenticate(t,n.credentials).then(function(e){n.params&&n.params.fromPopup&&n.showLoader(),r.login(angular.extend(e,n.credentials),!0).then(function(){ga("send","event","Signin Success. ","Auth Method: "+t),n.params&&n.params.fromPopup?(boxInstance.hideLoader(),window.location="/"):o.$rgDigest()},function(e){switch(n.params&&n.params.fromPopup&&boxInstance.hideLoader(),e.rc){case"invalidsocialid":n.requestFailed(e,t+": Unregistered Social ID",!0);break;default:n.requestFailed(e,t+": Something went wrong",!0)}})},function(e){n.params&&n.params.fromPopup&&boxInstance.hideLoader(),n.requestFailed(e,t+": Authentication Failed",!0)})}n.socialLogin=function(e){n.credentials.authMethod=e,c("twitter"===e?e:e)}}angular.module("ringid.auth").controller("SignUpController",SignUpController),SignUpController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","remoteData","localData","Storage","rgDropdownService"];function SignUpController(e,t,n,r,i,o,a,s,c){angular.extend(this,n("AuthController",{$scope:t})),t.close=r.close,t.closeAll=r.closeAll,t.newUid="",t.credentials.repassword="",t.credentials.vc="",t.credentials.name="",t.signupStep=1,t.sendCode=l,t.verifyCode=u,t.signup=d,a&&(t.formStyle.left="0px",t.credentials.mbl="",t.credentials.email="",t.credentials.ringid="",t.credentials.password="",a.signupData&&(t.credentials.authMethod=a.signupData.signupType,t.credentials.flagcode=a.signupData.flagcode),a.socialData&&(angular.extend(t.credentials,a.credentials),t.newUid=a.credentials.uId.toString().substr(2),t.credentials.authMethod=a.socialData.platform,t.credentials.id=a.socialData.id,t.credentials.name=a.socialData.name,t.credentials.access_token=a.socialData.access_token,t.signupStep=3,t.formStyle.left="-700px")),o&&(t.newUid=o.uId.toString().substr(2));function l(n,r){r.preventDefault(),t.disableForm||(t.requestFailed(!1),e.sendCode(t.credentials).then(function(e){e.sucs===!0&&(t.credentials.uId=e.uId,t.newUid=e.uId.toString().substr(2),t.signupStep=2,t.formStyle.left="-350px"),t.requestFailed(e,"Signup:sendcode")},function(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:sendcode")}))}function u(n,r){r.preventDefault(),t.disableForm||(t.requestFailed(!1),e.verifyCode(t.credentials).then(function(e){e.sucs===!0&&(t.signupStep=3,t.formStyle.left="-700px"),t.requestFailed(e,"Signup:verify")},function(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:verify")}))}function d(n,i){i.preventDefault(),t.disableForm||t.credentials.password!==t.credentials.repassword||(t.requestFailed(!1),e.signup(t.credentials).then(function(e){e.sucs===!0&&(t.login(!0),r.closeAll()),t.requestFailed(e,"Signup:sendCode")},function(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:signup")}))}}angular.module("ringid.auth").controller("SignUpSelectController",SignUpSelectController),SignUpSelectController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","Ringalert"];function SignUpSelectController(e,t,n,r,i,o){angular.extend(this,n("AuthController",{$scope:t})),t.close=r.close,t.closeAll=r.closeAll,t.socialSignup=function(n){r.showLoader(),e.sendCode(t.credentials,!0).then(function(){i.authenticate(n,t.credentials).then(function(i){e.openSignup(i,t.credentials).then(angular.noop,function(o){"dologin"===o.rc?(t.credentials.authMethod=n,r.showLoader(),e.login(angular.extend(i,t.credentials),!0).then(function(){t.closeAll()},function(e){r.hideLoader(),t.requestFailed(e,n+": Social Login Failed",!0)})):(r.hideLoader(),t.requestFailed(o,n+": Authentication Failed",!0))})},function(e){r.hideLoader(),t.requestFailed(e,n+": Authentication Failed",!0)})},function(e){r.hideLoader(),t.requestFailed(e,n+": Authentication Failed",!0)})},t.signupData=function(n){return{data:function(){return{signupData:{signupType:n,code:"phone"===n?e.getCountry().code:"Email",flagcode:"phone"===n?e.getCountry().flagcode:"remail"}}},promise:e.sendCode(t.credentials)}}}angular.module("ringid.auth").controller("PasswordRecoverController",PasswordRecoverController),PasswordRecoverController.$inject=["$controller","Auth","$scope","$boxInstance"];function PasswordRecoverController(e,t,n,r){angular.extend(this,e("AuthController",{$scope:n})),n.close=r.close;var i;n.activeTab="email",n.activeForm="sendcode",n.activateTab=s,n.activateTab(n.activeTab),n.credentials.email="",n.credentials.mbl="",n.fetchRecoverOptions=o,n.sendCode=c,n.verifyCode=l,n.resetPassword=a,n.verifierEnabled=!1,n.enableVerifier=function(){n.verifierEnabled=!0};function o(e){t.fetchRecoverOptions(e).then(function(e){n.verifierEnabled=!1,e.sucs===!0&&(n.activeForm="resetpassword",e.sgtns.forEach(function(e){/^21/.test(e)&&(n.credentials.uId=e)})),n.requestFailed(e,"Recovery:verify")},function(e){n.verifierEnabled=!1,n.requestFailed(response,"Recovery:verify")})}function a(e,r){r.preventDefault(),n.disableForm||n.credentials.password!==n.credentials.repassword||(n.requestFailed(!1),t.resetPassword(n.credentials).then(function(e){n.disableForm=!1,n.errorMsg=e.mg,e.sucs===!0&&n.close(),n.requestFailed(e,"Recovery:reset")},function(e){n.requestFailed(angular.extend(e,{sucs:!1}),"Recovery:reset")}))}function s(e){n.disableForm||"sendcode"!==n.activeForm||(n.activeTab=e,"email"===n.activeTab?(n.credentials.authMethod="email",n.formStyle.left="0px"):(n.credentials.authMethod="phone",n.formStyle.left="-350px"),n.$rgDigest())}function c(e,r,o){i=o,r.preventDefault(),n.disableForm||(n.requestFailed(!1),t.recoverySendCode(n.credentials,i).then(function(e){e.sucs===!0&&(n.activeForm="verifycode",n.credentials.uId=e.uId),n.requestFailed(e,"phone")},function(e){n.requestFailed(angular.extend(e,{sucs:!1}),"phone")}))}function l(e,r){r.preventDefault(),n.disableForm||(n.requestFailed(!1),t.recoveryVerifyCode(n.credentials).then(function(e){e.sucs===!0&&(n.activeForm="resetpassword"),n.requestFailed(e,"Recovery:verify")},function(e){n.requestFailed(angular.extend(e,{sucs:!1}),"Recovery:verify")}))}}!function(e,t){"use strict";e.module("ringid.filters",["ringid.config"])}(angular,window),angular.module("ringid.filters",["ringid.config"]).filter("validProfileImage",validProfileImage).filter("friendListFilter",friendListFilter).filter("mapListFilter",mapListFilter).filter("stackMapFilter",stackMapFilter).filter("ymdDateFilter",ymdDateFilter).filter("mediaFilter",mediaFilter).filter("mapFilter",mapFilter).filter("objectFilter",objectFilter).filter("trust",trustFilter),validProfileImage.$inject=["settings"];function validProfileImage(e){return function(t){return t.indexOf("prof.png")>0?t:e.imBase+t}}function stackMapFilter(){return function(e,t){if(e){for(var n=0;n<e.length;n++)t.get(e[n].key);return e}}}friendListFilter.$inject=["APP_CONSTANTS"];function friendListFilter(e){return function(t,n){if(t){for(var r=[],i=n.name.toLowerCase(),o=0;o<t.length;o++)n.showMutual&&t[o].value.friendshipStatus()!==e.FRIEND||(0===i.length||t[o].value.getName().toLowerCase().indexOf(i)>-1)&&r.push(t[o]);return r}}}function mapListFilter(){return function(e,t){if(e){for(var n=[],r=0;r<e.length;r++)t.get(e[r].value.getKey())||n.push(e[r]);return n}}}function ymdDateFilter(){return function(e){var t=new Date(e),n=""+(t.getMonth()+1),r=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),[i,n,r].join("-")}}function mediaFilter(){return function(e,t){if(e){for(var n=[],r=0;r<e.length;r++)e[r].value.getType()===t&&n.push(e[r]);return n}}}function mapFilter(){return function(e,t){if(e){for(var n=[],r=t.value?t.value.toLowerCase():"",i=0;i<e.length;i++)e[i].value[t.mapApi]().toLowerCase().indexOf(r)>-1&&n.push(e[i]);return n}}}function objectFilter(){function e(e,t){return e.indexOf(t)>-1}function t(e,t){return t===e}return function(n,r){var i,o=[];if(n&&n.length>0){switch(r.compare){case"string":i=e;break;default:i=t}for(var a=0;a<n.length;a++)i(n[a][r.prop],r.value)&&o.push(n[a]);return o}}}trustFilter.$inject=["$sce"];
function trustFilter(e){return function(t,n){return e.trustAs(n||"html",t)}}!function(e,t){"use strict";e.module("ringid.shared",["ringid.filters","ringid.auth","ringid.global_services","ringid.config"])}(angular,window),angular.module("ringid.shared").factory("$$stickerMap",$$stickerMap).factory("$$stickerImageMap",$$stickerImageMap),$$stickerImageMap.$inject=["settings","STICKER_IMAGE_TYPE"];function $$stickerImageMap(e,t){return{create:function(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};return{getKey:function(){return o.id},src:function(){return o.src},symbol:function(){return o.symbol},getName:function(){return o.name},srcWithoutBase:function(){return o.src.replace(e.stickerBase,"")},isEmoticon:function(){return o.isEmoticon},isLargeEmoticon:function(){return o.isLargeEmoticon},isSticker:function(){return o.isSticker}}}}}$$stickerMap.$inject=["$$stackedMap","$$stickerImageMap","settings"];function $$stickerMap(e,t,n){return{create:function(r,i){for(var o,a=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",s={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+a+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":a+"ca.png",installed:i||!1},c=0;c<r.imageList.length;c++)o=t.create(r.imageList[c],s.type,a),s.imageListMap.add(o.getKey(),o);return{sortBy:function(){return s.categoryId},isInstalled:function(){return s.installed},setInstalled:function(e){s.installed=e},isEmoticon:function(){return s.isEmoticon},isLargeEmoticon:function(){return s.isLargeEmoticon},isSticker:function(){return s.isSticker},getKey:function(){return s.categoryId},getImages:function(){return s.imageListMap},getType:function(){return s.type},link:function(){return s.regularUrl},hoverLink:function(){return s.hoverUrl}}}}}angular.module("ringid.shared").factory("circleMap",circleMap),circleMap.$inject=["userFactory","$$stackedMap","settings","Utils"];function circleMap(e,t,n,r){return{create:function(i){var o={gNm:"",grpId:0,ists:0,sAd:"",ut:0,mc:"",mt:"",groupMembers:"",memberList:[],members:{},allMembersMap:t.createNew(),adminIds:[],memberIds:[]};angular.isObject(i)&&(o=angular.extend({},o,i));function a(){}function s(e){var t=o.memberIds.indexOf(e);t!==-1&&o.memberIds.splice(t,1)}function c(e){var t=o.adminIds.indexOf(e);t!==-1&&o.adminIds.splice(t,1)}function l(){o.mc=o.allMembersMap.length()}function u(e){angular.extend(o,e)}var d={sortBy:function(){return o.gNm.toLowerCase()},update:u,addMember:function(t,n){var r=e.create(t);o.allMembersMap.save(r.getKey(),r),n?d.promoteToAdmin(r.getKey()):d.removeFromAdmin(r.getKey()),l()},isAdmin:function(){return 1===o.mt},isMember:function(){return 0===o.mt},isSuperAdmin:function(e){return o.sAd===e},getSuperAdminUId:function(){return o.sAd},promoteToAdmin:function(e){c(e),o.adminIds.push(e),o.allMembersMap.get(e).setGroupAdmin(o.grpId),a()},removeFromAdmin:function(e){s(e),o.memberIds.push(e),o.allMembersMap.get(e).removeGroupAdmin(o.grpId),a()},getAdmins:function(){for(var e=o.allMembersMap.copy(),t=0;t<o.memberIds.length;t++)e.remove(o.memberIds[t]);return e},getMember:function(e){return o.allMembersMap.get(e)},getMembers:function(){for(var e=o.allMembersMap.copy(),t=0;t<o.adminIds.length;t++)e.remove(o.adminIds[t]);return e},setMembers:function(t){angular.forEach(t,function(t){if(!t.ists){var n=e.create(t);o.allMembersMap.save(n.getKey(),n),t.admin?o.adminIds.indexOf(n.getKey())!==-1?o.adminIds.push(n.getKey()):d.promoteToAdmin(n.getKey()):o.memberIds.indexOf(n.getKey())!==-1?o.memberIds.push(n.getKey()):d.removeFromAdmin(n.getKey())}}),a()},resetMembers:function(){o.allMembersMap.reset(),o.adminIds=[],o.memberIds=[]},removeMember:function(e){var t;t=o.allMembersMap.remove(e),s(e),c(e),l()},getAllMembers:function(){return o.allMembersMap},getMemberIds:function(){return o.memberIds.slice()},getAdminIds:function(){return o.adminIds.slice()},getMembersObjectCount:function(){return o.allMembersMap.length()},getMembersCount:function(){return o.mc},getMemberType:function(){return o.mt},setMemberCount:function(e){o.mc=e},getLink:function(e){return e=e||"",n.baseUrl+r.getRingRoute("CIRCLE_HOME",{circleId:o.grpId,subpage:e})},getLinkOnly:function(e){return e=e||"",r.getRingRoute("CIRCLE_HOME",{circleId:o.grpId,subpage:e}).slice(1)},getKey:function(){return o.grpId},getName:function(){return o.gNm},getAnchor:function(){return'<a class="cir-title" href="/#/circle/'+o.grpId+'" >'+o.gNm+"</a>"}};return d}}}angular.module("ringid.shared").factory("$$imageMap",$$imageMap),$$imageMap.$inject=["settings","$$stackedMap","userFactory","Utils"];function $$imageMap(e,t,n,r){var i={albId:"",albn:"",cptn:"",nfId:0,ic:0,ih:0,il:0,imT:0,imgId:0,iurl:"",iw:0,nc:0,nl:0,tm:0,user:null};function o(e,t){var n=this;e=e||{},t&&(n._u=t),n.updateImage(e),Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.image.imgId,showReportButton:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"image"}}})}return o.prototype={updateImage:function(e,t){this.image?angular.extend(this.image,e):this.image=angular.extend({},i,e),e=null,this.key="im"+this.image.imgId,this.image.tm?this._time=r.verbalDate(this.image.tm):this._time={},!this._u&&this.image.hasOwnProperty("uId")&&(this._u=n.create({uId:this.image.uId,fn:this.image.fn||""}))},user:function(){return this._u},src:function(t){if("iurl"===t)return this.image.iurl;var n=this.image.iurl.lastIndexOf("/")+1,r=/\/uploaded\//.test(this.image.iurl)?"":"p";return void 0!==t?[e.imBase,this.image.iurl.slice(0,n),r,t,this.image.iurl.slice(n)].join(""):[e.imBase,this.image.iurl.slice(0,n),r,this.image.iurl.slice(n)].join("")},getByProperty:function(e,t){return t=t||!1,this.image.hasOwnProperty(e)?user[e]:t},sortBy:function(){return this.image.imgId},getIh:function(){return this.image.ih},getIw:function(){return this.image.iw},sortByTime:function(){return this.image.tm},getAlbumName:function(){return this.image.albn},getAlbumId:function(){return this.image.albId},getCaption:function(){return this.image.cptn},getKey:function(){return this.image.imgId},getMapKey:function(){return this.key},getFeedKey:function(){return this.image.nfId},setFeedKey:function(e){this.image.nfId=e},time:function(){return this._time},like:function(e,t){return e?(this.image.il=1^this.image.il,t?this.image.nl=t:this.image.nl=0==this.image.il?this.image.nl-1:this.image.nl+1,this.image.il):this.image.il},getLikes:function(){return this.image.nl},getTotalLikes:function(){return this.image.nl},getImageType:function(){return this.image.imT},incomingLike:function(e){return e&&++this.image.nl||--this.image.nl},offset:function(){return{width:this.image.iw,height:this.image.ih}},selfComment:function(){return this.image.ic},getTotalComment:function(){return this.image.nc},setTotalComment:function(e,t){this.image.nc=e,angular.isDefined(t)&&(this.image.ic=t)},getUrl:function(){return"/image/"+this.getKey()},getRelativeHeight:function(e){try{return this.image.ih/this.image.iw*e}catch(e){return this.image.ih}}},function(e,t){return new o(e,t)}}angular.module("ringid.shared").factory("$$mediaMap",$$mediaMap),$$mediaMap.$inject=["userFactory","Auth","$$stackedMap","settings","APP_CONSTANTS","mediaHttpService","$$q","Storage","Ringalert","Api","$ringhttp"];function $$mediaMap(e,t,n,r,i,o,a,s,c,l,u){var d=i,g={ac:0,albId:0,cc:0,ic:0,il:0,lc:0,is:0,ns:0,nfId:0,albn:"",artst:"",cntntId:0,drtn:0,mdaT:1,strmURL:"",thmbURL:"",ttl:"",tih:0,tiw:0,user:null,viewtime:0,utId:"",autoplay:!1,gotDetails:!1};function m(e,t){var n=this;n.updateMedia(e),n.setUser(e,t),e=null,Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.media.key,showReportButton:function(){return!n._u.isCurrentUser()},showAddToAlbum:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"media"},getRingboxData:function(){return function(){return{media:n}}},showMediaShareButton:function(){return!!n.token}}})}function f(e){var t,n=new Date,r=!1,i={ac:e.mdaCntntDTO.ac,albId:e.mdaCntntDTO.albId,albn:e.mdaCntntDTO.albn,artst:e.mdaCntntDTO.artst,cntntId:e.mdaCntntDTO.cntntId,mdaT:e.mdaCntntDTO.mdaT,drtn:e.mdaCntntDTO.drtn,strmURL:e.mdaCntntDTO.strmURL,thmbURL:e.mdaCntntDTO.thmbURL,ttl:e.mdaCntntDTO.ttl,utId:e.utId,viewtime:n.getTime()},o=s.getData("mediaRecent")||[];for(t=0;t<o.length;t++)if(o[t].cntntId===e.mdaCntntDTO.cntntId){r=t;break}r?o[r]=i:(o.length>=6&&o.shift(),o.push(i)),s.setData("mediaRecent",o)}return m.prototype={updateMedia:function(e,t){angular.isObject(e)&&(this.media?angular.extend(this.media,e):this.media=angular.extend({},g,e),this.media.gotDetails=!!t,this.media.key=this.media.cntntId||this.media.id,e.thmbURL&&e.thmbURL.length>1?this.media.poster=r.mediaBase+e.thmbURL:(this.media.poster=this.media.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",this.media.feedThumb=this.media.poster,this.media.tih=330,this.media.tiw=600)),e=null},setUser:function(t,n){if(angular.isDefined(n))this._u=n;else if(t.utId?this._u=e.getByUtId(t.utId):t.uId?this._u=e.getUser(t.uId):this._u=!1,!this._u){var r={};t.uId&&(r.uId=t.uId),t.utId&&(r.utId=t.utId),t.fn&&(r.fn=t.fn),t.prIm&&(r.prIm=t.prIm),this._u=e.create(r)}},sortBy:function(){return this.media.viewtime},getMediaUtId:function(){return this.media.utId},getAlbumId:function(){return this.media.albId},getAlbumName:function(){return this.media.albn},getArtistName:function(){return this.media.artst},getKey:function(){return this.media.key},getFeedKey:function(){return this.media.nfId},setFeedKey:function(e){return this.media.nfId=e,this.media.nfId},isAudio:function(){return this.media.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return this.media.mdaT===d.NEWS_FEED_MEDIA_TYPE_VIDEO},owner:function(){return this._u},user:function(){return this._u},getId:function(){return this.media.cntntId},setIsAutoPlay:function(e){this.media.autoplay=e},getIsAutoPlay:function(){return this.media.autoplay},getViewCount:function(){return this.media.ac>1?"Views : "+this.media.ac:"View : "+this.media.ac},getViewCountOnly:function(){return this.media.ac},getDuration:function(e){if(e){var t=this.media.drtn/60===0?"00":Math.floor(this.media.drtn/60),n=this.media.drtn%60===0?"00":Math.floor(this.media.drtn%60);return t=t<10&&"00"!==t?"0"+t:t,n=n<10&&"00"!==n?"0"+n:n,t+":"+n}return this.media.drtn},getCaption:function(){return this.media.ttl},getStreamUrl:function(){var e=r.mediaBase+this.media.strmURL;if(2===this.media.mdaT){var t=this.media.strmURL.match(/media-(\d+)/);if(t&&2===t.length&&parseInt(t[1])>140){var n=e.lastIndexOf("/")+1;e=[e.slice(0,n),"h",e.slice(n)].join("")}}return e},getStreamUrlOnly:function(){return this.media.strmURL},getThumb:function(){return this.media.poster},getThumbUrlOnly:function(){return this.media.thmbURL},getThumbForMedia:function(){return""===this.media.thmbURL?1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg":this.media.poster},getThumbForMediaOnly:function(){return""===this.media.thmbURL?1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg":this.media.poster},feedThumb:function(){return this.media.feedThumb},iLiked:function(){return this.media.il},like:function(e,t){return e?(this.media.il=1^this.media.il,t?this.media.lc=t:this.media.lc=0===this.media.il?this.media.lc-1:this.media.lc+1,this.media.il):this.media.il},getLikes:function(){return this.media.lc},getTotalLikes:function(){return this.media.lc},setTotalComment:function(e,t){this.media.cc=e,angular.isDefined(t)&&(this.media.ic=t)},selfComment:function(){return this.media.ic},getTotalComment:function(){return this.media.cc},getTotalShare:function(){return this.media.ns},setTotalShare:function(e){this.media.ns=e},share:function(e){return e?(this.media.is=1^this.media.is,this.media.ns=this.media.is?this.media.ns+1:this.media.ns-1,this.media.is):this.media.is},thumbOffset:function(e){return e?"height"===e?this.media.tih:this.media.tiw:{width:this.media.tiw,height:this.media.tih}},getEmbedUrl:function(e){return r.httpsUrl+"/player/embed?id="+this.token},addToAlbumData:function(){return{strmURL:this.media.strmURL,tiw:this.media.tiw,tih:this.media.tih,drtn:this.media.drtn,thmbURL:this.media.thmbURL,artst:this.media.artst,ttl:this.media.ttl.utf8Encode()}},increaseView:function(){var e=a.defer(),t=this;return o.increaseViewCount(t.media.cntntId).then(function(n){n.sucs===!0&&t.media.ac++,e.resolve()}),e.promise},updateRecentMedias:f,fetchDetails:function(e){var t=a.defer(),n=this;if(n.media.gotDetails)t.resolve(n);else{var r={cntntId:n.getKey(),utId:e?e.getUtId():n.owner().getUtId()};l.media.fetchDetails(r).then(function(e){e.sucs===!0?(n.updateMedia(e.mdaCntntDTO,!0),f(e),t.resolve(n)):(t.reject(e),c.show(e,"info"))})}return t.promise},getToken:function(){return this.token},setMediaToken:function(e){var t=a.defer(),n=this;return n.token?setTimeout(function(){t.resolve(n.token)}):u.get("mediaID?mediaID="+n.getKey()+"&ip="+s.getCookie("authServer")+"&port="+s.getCookie("comPort")).success(function(e){e.sucs?(n.token=e.id,t.resolve(e.id)):t.reject(!1)}).error(function(e){t.reject(e)}),t.promise}},function(e,t){return new m(e,t)}}angular.module("ringid.shared").factory("$$newsPortalMap",$$newsPortalMap),$$newsPortalMap.$inject=["settings"];function $$newsPortalMap(e){return{create:function(t){var n={fn:t.fn,nPCatId:t.nPCatId,nPCatName:t.nPCatName,nPslgn:t.nPslgn,prIm:t.prIm,subCount:t.subCount,subsc:t.subsc,uId:t.uId,utId:t.utId};return{getKey:function(){return n.utId},getFullName:function(){return n.fn},getCategoryId:function(){return n.nPCatId},getCategoryName:function(){return n.nPCatName},getPortalSlogan:function(){return n.nPslgn},getProfileImage:function(){return n.prIm?e.imBase+n.prIm:"../../../images/test/1.png"},getFollowAndSliderImage:function(){return n.prIm?e.imBase+n.prIm:"../../../images/test/2.png"},getSubCount:function(){return n.subCount},setIfSubscribed:function(e){n.subsc=e},isSubscribed:function(){return n.subsc},getUid:function(){return n.uId}}}}}angular.module("ringid.shared").factory("$$businessPageMap",$$businessPageMap),$$businessPageMap.$inject=["settings"];function $$businessPageMap(e){return{create:function(t){var n={fn:t.fn,nPCatId:t.nPCatId,nPCatName:t.nPCatName,nPslgn:t.nPslgn,prIm:t.prIm,subCount:t.subCount,subsc:t.subsc,uId:t.uId,utId:t.utId,nop:t.nop};return{getKey:function(){return n.utId},getFullName:function(){return n.fn},getCategoryId:function(){return n.nPCatId},getCategoryName:function(){return n.nPCatName},getSlogan:function(){return n.nPslgn},getProfileImage:function(){return n.prIm?e.imBase+n.prIm:"../../../images/test/1.png"},getFollowAndSliderImage:function(){return n.prIm?e.imBase+n.prIm:"../../../images/test/2.png"},getSubCount:function(){return n.subCount},setIfSubscribed:function(e){n.subsc=e},isSubscribed:function(){return n.subsc},getUid:function(){return n.uId}}}}}angular.module("ringid.shared").factory("$$mediaAlbumMap",$$mediaAlbumMap),$$mediaAlbumMap.$inject=["Ringalert","Auth","settings","fileUploadService","$$stackedMap","$$mediaMap","APP_CONSTANTS","mediaHttpService","Utils"];function $$mediaAlbumMap(e,t,n,r,i,o,a,s,c){var l=a;function u(e){return parseInt(e.id)||parseInt(e.albId)}return{createKey:function(e){return u(e)},createAlbum:function(t,a){var d={albn:"",albId:0,mc:0,mdc:0,mdaT:1,sts:0,utId:0,imgURL:"",contents:i.createNew(),uniqueKey:c.getUniqueID(),cover:"",key:0,type:"",owner:0},g=function(e){angular.isObject(e)&&(d=angular.extend({},d,e),d.albId=parseInt(e.id)||parseInt(e.albId),d.owner=a,d.key=u(e),e.imgURL&&e.imgURL.length>1?d.cover=n.imBase+e.imgURL:d.cover=t.mdaT===l.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",d.type=t.mdaT===l.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video")};g(t);function m(e,t,n){var r;t=t||d.owner;for(var i=0,a=e.length;i<a;i++)n&&(e[i].nfId=n),r=o(angular.extend(e[i],{albId:d.id}),t),d.contents.save(r.getKey(),r);return d}return{getKey:function(){return d.key},getType:function(){return d.type},isAudio:function(){return d.mdaT===l.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return d.mdaT===l.NEWS_FEED_MEDIA_TYPE_VIDEO},getId:function(){return d.albId},getName:function(){return d.albn},getCover:function(){return d.cover},getContentCount:function(){return d.mc||d.mdc},getContents:function(){return d.contents},updateAlbum:function(e){g(e)},pushContent:function(e,t,n,r){return m(e,t,n,r)},getALbumUtId:function(){return d.utId},link:function(e,t){if(e.getUId()||e.getUtId()){var r=c.getRingRoute("USER_PROFILE",{uId:e.getUId(),utId:e.getUtId(),subpage:"media",albumId:d.albId});return t?r.replace("#",""):n.baseUrl+r}return""},addNewContent:function(t){var n,i,o="audio"===d.type?"audioFiles":"videoFiles",a={albId:d.albId,mdaLst:[],mdaT:d.mdaT};if(t){if(d.contents.get(t.getKey()))return void e.show("Content Already Added","warning");a.mdaLst.push(t.addToAlbumData())}else for(n=0,i=r[o].length;n<i;n++)a.mdaLst.push(r[o][n].getAuthData());s.addMediaToAlbum(a).then(function(e){if(e.sucs===!0){for(d.mc+=e.mdaIds.length,n=0,i=e.mdaIds.length;n<i;n++)a.mdaLst[n].cntntId=e.mdaIds[n];m(a.mdaLst)}})},deleteContent:function(e){s.deleteAlbumContent(e.getId()).then(function(t){t.sucs===!0&&(d.contents.remove(e.getKey()),d.mc--)})},fetchContentDetails:function(){var e=d.contents.all();function t(e,t){setTimeout(function(){s.likeList(e.getId()).then(function(e){})},t)}for(var n=0,r=e.length;n<r;n++)t(e[n].value,200*n+200)}}}}}angular.module("ringid.shared").factory("$$feedMap",$$feedMap),$$feedMap.$inject=["Auth","settings","$$stackedMap","$$imageMap","Media","$$mediaAlbumMap","$$mediaMap","userFactory","Utils","circlesManager","$sce","EmotionFactory","MESSAGES","OPERATION_TYPES","PrivacySet"];function $$feedMap(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f){var E="nf_",p="tm",T=g.FEED,h=m.SYSTEM,_='<user-card user="feed.user()"></user-card>',I={nfId:0,utId:0,isNew:0,lctn:"",lat:9999,lng:9999,gNm:"",grpId:0,sts:"",stsTags:[],tim:0,imT:0,fndId:0,whoShare:{},mdaCntntLst:[],type:0,mdLst:[],tm:Date.now(),at:Date.now(),ic:0,il:0,is:0,nc:0,nl:0,ns:0,sc:0,tfc:0,stp:0,fc:0,actvt:0,afn:"",auId:0,lnkDmn:"",lnkDsc:"",lnkTtl:"",lnkURL:"",lnlImgURL:"",fTgLst:[]};function A(e,t){var r=this;if(r.key=E+e.nfId,r.updateRaw(e),r.setFeedUser(t),r.feelings={},r.tagUsers=[],r.shareUsers=[],r.circle={},r.orginal={},r.feedHtml="",r.images=n.createNew(!0,"asc"),r.medias=n.createNew(),r.audios=n.createNew(),r.setImages(),r.initMedias(),r._f.fndId?r.friend=s.create({uId:r._f.fndId,fn:r._f.ffn,ln:r._f.fln}):r.friend=!1,r.initOgData(),r.initLocationData(),r.update(null,!1,!0),r.isSingleContentFeed()){var i=r.getSingleContent();r.images.length()||(r._f.is=i.share(),r._f.ns=i.getTotalShare()),r._f.ic=i.selfComment(),r._f.nc=i.getTotalComment()}Object.defineProperty(r,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{feedKey:r._f.nfId,showEdit:function(){return!!(r._u.isCurrentUser()&&r._f.nl<1)},feedUser:function(){return r._u},tagButtonText:function(){return r.tagUsers.length?"Edit Tag":"Add Tag"},showDelete:function(){return r._u.isCurrentUser()||r.friend&&r.friend.isCurrentUser()},showTagButton:function(){return r._u.isCurrentUser()&&!r._f.grpId},showReportButton:function(){return!r._u.isCurrentUser()},getSpamId:function(){return r.isSingleContentFeed()?r.getSingleContent().getKey():r.getKey()},getSpamType:function(){return r.images.length()&&"image"||r.medias.length()&&"media"||r.audios.length()&&"media"||"feed"},showSaveOptionForNews:function(){return 7===r._f.type&&!r._f.npFeedInfo.svd},showUnsaveOptionForNews:function(){return 7===r._f.type&&r._f.npFeedInfo.svd},showSaveOptionForBusiness:function(){return 8===r._f.type&&!r._f.npFeedInfo.svd},showUnsaveOptionForBusiness:function(){return 8===r._f.type&&r._f.npFeedInfo.svd},isNewsPortalFeed:function(){return 7===r._f.type}}})}return A.prototype={updateRaw:function(e,t){var n;this._f?(n=t||!e.tm?this._f.tm:e.tm,angular.extend(this._f,e),this._f.tm=n):this._f=angular.extend({},I,e),9999===this._f.lat&&(this._f.lctn=""),e=null},update:function(e,t,n){var r=this;n||r.updateRaw(e,t),r._f.mdLst&&r._f.mdLst.length&&(r.feelings=d.getEmotion(r._f.mdLst[0],!0)),r.setTagUsers(),r._f.at?r.vtime=c.verbalDate(r._f.at):r.vtime="",r.setFeedTopMessage(),r.processFeedMessage(),r.addPostfixMessage(),r.parseStatus(),e=null},getKey:function(){return this._f.nfId},sortBy:function(){return this._f[p]||this._f.tm},getMapKey:function(){return this.key},setFeedKey:function(e){this._f.nfId=e},getFeedKey:function(e){return this._f.nfId},getPrivacy:function(){return f["PVC"+(this._f.fpvc||3)]},getByProperty:function(e,t){return t=t||!1,this._f.hasOwnProperty(e)?this._f[e]:t},checkMessageUpdated:function(){return this.message+this._f.lctn+this.tagUsers.reduce(function(e,t){return e.toString()+t.toString()},"")+this._f.tfc},getTargetWall:function(){return this.friend},getTargetCircle:function(){return angular.equals({},this.circle)?this._f.gNm:this.circle},setFeedUser:function(e){var t=this;if(angular.isDefined(e))t._u=e;else if(t._f.utId?t._u=s.getByUtId(t._f.utId):t._f.uId?t._u=s.getUser(t._f.uId):t._u=!1,!t._u){var n={};t._f.uId&&(n.uId=t._f.uId),t._f.utId&&(n.utId=t._f.utId),t._f.fn&&(n.fn=t._f.fn),t._f.prIm&&(n.prIm=t._f.prIm),3===t._f.spType&&(t._f.isnp=!0,n.isnp=t._f.isnp),4===t._f.spType&&(t._f.isbusn=!0,n.isbusn=t._f.isbusn),t._u=s.create(n)}},user:function(){return this._u},processFeedMessage:function(){var e,t="",n="",r=[_],i=this;switch(i.friend?t="F":i._f.grpId&&(i.circle=l.getCircle(i._f.grpId),t="C"),i._f.type){case h.NEWS_FEED_TYPE_IMAGE:i.images.length()>0?(i.message=T["TYPE_1"+i.images.top().getImageType()+t]||T.TYPE_D,i.message=i.feedConditionalReplacer(i.message,[i._u.isCurrentUser()])):i.message=T.TYPE_D;break;case h.NEWS_FEED_TYPE_STATUS:i.hasOgData()&&(n="L"),i.message=T["TYPE_2"+t+n];break;case h.NEWS_FEED_TYPE_MULTIPLE_IMAGE:i.message=T["TYPE_"+i._f.type],i.message=i.feedConditionalReplacer(i.message,[i._u.isCurrentUser()]),r.push(i._f.tim);break;case h.NEWS_FEED_TYPE_ALBUM:case h.NEWS_FEED_TYPE_AUDIO:case h.NEWS_FEED_TYPE_VIDEO:e=i._f.stp||0,i.message=T["TYPE_"+i._f.type+e],e||!i.medias.length()&&!i.audios.length()?r.push('<user-card class="share-user" user="feed.getSingleContent().user()"></user-card>'):r.push(i.medias.length()||i.audios.length());break;default:i.message=T.TYPE_D}i.friend?i.message+=" "+T.F_POSTFIX.format('<user-card class="wall-user" user="feed.getTargetWall()"></user-card>'):i._f.grpId&&(i.message+=" "+T.C_POSTFIX.format('<a class="cir-title" href="/#/circle/'+i._f.grpId+'" >'+i._f.gNm+"</a>")),i.rawmessage=i.message,i.message=i.message.format(r),i.oldMessage=i.message},updateShareMessage:function(){var e=_;this.orginal.getTotalShare()>1&&(e+="and "+(this.orginal.getTotalShare()-1)+" other people");var t=[_];this.message=T.TYPE_SHARE,t.push('<user-card class="share-user" user="feed.getOrginalFeed().user()"></user-card>'),this.message=this.message.format(t),this.oldMessage=this.message,this.addPostfixMessage()},addPostfixMessage:function(){var e=this;e.message=e.oldMessage,(e._f.mdLst.length||e.tagUsers.length||e.location)&&("{0}"!==e.rawmessage?e.message+=" &mdash;":e.message+=" is"),e._f.mdLst.length&&(e.message+='<span class="feelings-text">feeling</span> <img class="feed_emo" src="'+e.feelings.url+'" />&nbsp;'+e.feelings.nm),e.tagUsers.length&&(e.message+='&nbsp;<feed-tag-more-user tag-feed="feed"></feed-tag-more-user>'),this._f.lctn&&(e.message+='&nbsp;<location-card feed="feed"></location-card>')},getMessageText:function(){return this.message},hasActivityMessage:function(){return this._f.actvt>0&&1!==this._f.fc},setActivity:function(e){this._f.actvt=e.actvt||0,this._f.afn=e.afn,this._f.auId=e.auId,this.setFeedTopMessage()},setFeedTopMessage:function(){var t=this;if(t._f.actvt>0){if(t.subMessage="",t._f.actvt&&g.FEED["ACT_"+t._f.actvt]){var n=s.getByUtId(t._f.auId),r="<b>You</b>";n?n.isCurrentUser()||(r='<user-card user="feed.getActivityUser()"></user-card>'):e.currentUser().getUtId()!==t._f.auId&&(n=s.createByUtId({fn:t._f.afn,utId:t._f.auId},!0),r='<user-card user="feed.getActivityUser()"></user-card>'),t._au=n,t.subMessage=g.FEED["ACT_"+t._f.actvt].format(r)}t.subMessage=u.trustAsHtml(t.subMessage)}},getActivityMessage:function(e,t,n){return this.subMessage},getActivityUser:function(){return this._au},feedTextParser:function(e,t,n){var r,e,i=[],o="";if(n=n||e.length,t=t||[],n>0&&(e=e.substr(0,n)),e||t){if(t&&t.length){var a,l=0;t.sort(function(e,t){return t.pstn>e.pstn?-1:1});for(var d=0;d<t.length&&t[d].pstn<n;d++)a=t[d].pstn-l,r=s.create(t[d]),a>0&&i.push(c.parseForLE(e.substr(l,a))),i.push(r.getLink({class:"tag",title:r.getName().trim(),"data-link":r.getUtId()})),l=t[d].pstn;a=e.length-l,a>0&&i.push(c.parseForLE(e.substr(l,a))),o=i.join("")}else o=c.parseForLE(e);o=u.trustAsHtml(o)}return o},parseStatus:function(){this.feedHtml=this.feedTextParser(this._f.sts,this._f.stsTags)},parseMoreText:function(e){this._f.sts=e.sts,this.parseStatus()},getCroppedHtml:function(e){return this.feedTextParser(e,this._f.stsTags,e.length)},showMore:function(){return!!this._f.sc},setText:function(e,t){this._f.sts=e,t&&(this._f.stsTags=t),this.parseStatus()},text:function(){return this._f.sts},getDynamicText:function(){return this.feedHtml},getDynamicTextMore:function(e,t){e=parseInt(e)>0?parseInt(e):20;for(var n,r="(",i=c.parseForLE(this._f.sts),o=e;o>0;o--)r+="[\\S]+\\s";return r+=")(.*)",n=i.replace(new RegExp(r),'<span class="with-more"><input id="read'+t+'" type="checkbox" /><span class="less">$1</span><span class="more">$2</span><label for="read'+t+'" class="trigger"></label></span>'),u.trustAsHtml(n)},getAtTime:function(){return this._f.at},time:function(){return this.vtime},updateTime:function(){this.vtime=c.verbalDate(this._f.at)},setTime:function(e){this._f.tm=e},getTimestamp:function(){return this._f.tm},incomingLike:function(e){return e&&++this._f.nl||--this._f.nl},like:function(e,t){return e?(this._f.il=1^this._f.il,t?this._f.nl=t:this._f.nl=this._f.il?this._f.nl+1:this._f.nl-1,this.identical&&this.identical.like(e),this._f.il):this._f.il},setTotalLikes:function(e,t){this._f.nl=e,angular.isDefined(t)&&(this._f.il=t),this.identical&&this.identical.setTotalLikes(e,t)},setIdenticalFeed:function(e){this.identical=e},getTotalLikes:function(){return this._f.nl},setTotalComment:function(e,t){this._f.nc=e,angular.isDefined(t)&&(this._f.ic=t),this.identical&&this.identical.setTotalComment(e.ic)},getTotalComment:function(){return this._f.nc},selfComment:function(){return this._f.ic},getTotalShare:function(){return this._f.ns},getShareUsers:function(){return this.shareUsers},addShareUser:function(e){return"array"==typeof e?this.shareUsers=this.shareUsers.concat(e):this.shareUsers.push(e),this.shareUsers},share:function(e,t){return e?(this._f.is=1^this._f.is,t?this._f.ns=t:this._f.ns=this._f.is?this._f.ns+1:this._f.ns-1,this._f.is):this._f.is},shares:function(e){this.orginal=e,this.orginal.addShareUser(this._u),this.updateShareMessage()},getWhoShares:function(){return this._f.whoShare},getOrginalFeed:function(){return this.orginal},hasSharedFeed:function(){return!angular.equals({},this.orginal)},getTotalImage:function(){return this._f.tim},setImages:function(){var e,t,n,i=0;if(this._f.imageList){try{e=angular.isString(this._f.imageList)?angular.fromJson(this._f.imageList):this._f.imageList}catch(e){}for(t=e.length>3?3:e.length,i=0;i<t;i++)e[i].nfId=this._f.nfId,n=r(e[i],this._u),this.images.add(n.getMapKey(),n)}switch(this.images.length()){case 1:this.imlayout=5;break;case 2:this.imlayout=4;break;default:this.imlayout=this._f.nfId%4}},getImages:function(e){return e?this.images:this.images.all()},getImageLayout:function(e){return this.imlayout},hasMedia:function(){return this.images.length()>0||this.medias.length()>0||this.audios.length()>0},getAlbum:function(){return this.album},initMedias:function(){if(this._f.mdaCntntLst&&this._f.mdaCntntLst.length>0){var e=this._f.stp>0?null:this._u,t=this._f.mdaCntntLst;this.album=o.createAlbum({albn:t[0].albn,albId:t[0].albId,mc:t.length,mdaT:t[0].mdaT,utId:e?e.getUtId():0}),this.album.pushContent(t,e,this._f.nfId),this.album.isAudio()?this.audios=this.album.getContents():this.album.isVideo()&&(this.audios=this.album.getContents())}},getMedias:function(){return this.medias},getAudios:function(){return this.audios},setViewColumn:function(e){this.viewColumn=e},getViewColumn:function(){return this.viewColumn},getUrl:function(){return c.getRingRoute("SINGLE_FEED",{feedId:this._f.nfId,shared:this.hasSharedFeed()})},getWhoShareUrl:function(){var e;return e=this.hasSharedFeed()?this.getOrginalFeed().getKey():this.getKey(),c.getRingRoute("WHO_SHARED_FEED",{feedId:e})},hasFeelings:function(){return!!this._f.mdLst.length},getFeelings:function(){return this.feelings},setFeelings:function(e){e&&e.id?(this.feelings=e,this._f.mdLst[0]=e.id):(this.feelings={},this._f.mdLst=[]),this.addPostfixMessage()},setTagUsers:function(e,t){if(e?this._f.fTgLst=e:e=this._f.fTgLst,this.tagUsers.length=0,e&&e.length)for(var n=0;n<e.length;n++)e[n].fn=e[n].nm,this.tagUsers.push(s.createByUtId(e[n]));angular.isDefined(t)&&(this._f.tfc=t)},updateTagUser:function(e){this.setTagUsers(e.fTgLst,e.tfc),this.addPostfixMessage()},hasTagUsers:function(){return!!this.tagUsers.length},getTagUsers:function(){return this.tagUsers},validateForUpdateTag:function(){return""!==this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length()},hasMoreTagUsers:function(){return this._f.tfc>this.tagUsers.length},getMoreTagUsers:function(){return this._f.tfc-this.tagUsers.length},getTotalTag:function(){return this._f.tfc},getLocationText:function(){return this._f.lctn},getLocationShortText:function(){if(this._f.lctn){var e=this._f.lctn,t=this._f.lctn.split(",");return t.length>2&&(e=t[0].replace("(","")),e.length>30&&(e=e.substr(0,30)+"..."),e}},setLocationText:function(e){return this._f.lctn=e,this.addPostfixMessage(),e},resetLocationText:function(){this._f.lctn=""},getContentType:function(){var e;return e=this.images.length()?"image":this.medias.length()?"media":this.audios.length()?"media":"feed"},hasLocationInfo:function(){return!(""===this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length())},getLocationInfo:function(){return this.locationData},getLocationUrl:function(){return u.trustAsResourceUrl(c.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!1))},getLocationEmbedUrl:function(){return u.trustAsResourceUrl(c.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!0))},getLocationStaticEmbedUrl:function(){return u.trustAsResourceUrl(c.getGoogleMapStaticUrl(this._f.lat,this._f.lng,this._f.lctn))},initLocationData:function(){9999!==this._f.lat?this.locationData={description:this._f.lctn,lat:this._f.lat,lng:this._f.lng}:this.locationData={description:this._f.lctn}},setLocationInfo:function(e){this._f.lctn=e.description,this._f.lat=e.lat,this._f.lng=e.lng,this.initLocationData(),this.addPostfixMessage()},getStrmURL:function(){return this._f.strmURL},getLinkDomain:function(){return this._f.lnkDmn},getLinkUrl:function(){return this._f.lnkURL},getLinkTitle:function(){return this._f.lnkTtl},getLinkDescription:function(){return this._f.lnkDsc},getLinkImageUrl:function(){return this._f.lnlImgURL},hasOgData:function(){return!!(this._f.lnlImgURL||this._f.lnkTtl||this._f.lnkDsc)},getOgData:function(){return this.ogData},initOgData:function(){this.ogData||(this.ogData={}),this.ogData.image=this._f.lnlImgURL,this.ogData.description=this._f.lnkDsc,this.ogData.title=this._f.lnkTtl,this.ogData.url=this._f.lnkURL,
this.ogData.lnkDmn=this._f.lnkDmn},setOgData:function(e){this._f.lnkDsc=e.lnkDsc||e.description||"",this._f.lnkTtl=e.lnkTtl||e.title||"",this._f.lnkURL=e.lnkURL||e.url||"",this._f.lnlImgURL=e.lnlImgURL||e.image||"",this._f.lnkDmn=e.lnkDmn||e.domain||"",this.initOgData()},isEmpty:function(e){return e=e||{},!this.text||e.tagUsers&&this.tagUsers.length},isSpecial:function(){return 1===this._f.fc},isFeed:!0,isTimelinePost:function(){return this.friend&&this.friend.isCurrentUser()},isWallPost:function(){return!!this.friend},isCirclePost:function(){return this._f.grpId>0},isMediaShared:function(){return this._f.stp>0},isSingleContentFeed:function(){return 1===this.images.length()||1===this.medias.length()||1===this.audios.length()},getSingleContent:function(){return this.images.length()&&this.images.bottom()||this.medias.length()&&this.medias.bottom()||this.audios.length()&&this.audios.bottom()||this},hasNewsPortalFeed:function(){return this._f.npFeedInfo},hasExternalUrl:function(){return this._f.npFeedInfo.exUrlOp},getNewsPortalcatId:function(){return this._f.npFeedInfo.nCatId},setNewsPortalDescription:function(e){this._f.npFeedInfo.nDctn=e},getNewsPortalDescription:function(){return this._f.npFeedInfo.nDctn},getNewsPortalShortDescription:function(){return this._f.npFeedInfo.nSDctn},getNewsPortalTitle:function(){return this._f.npFeedInfo.nTtl},hasNewsPortalUrl:function(){return!!this._f.npFeedInfo.nUrl},getNewsPortalUrl:function(){return this._f.npFeedInfo.nUrl},getPortalBaseUrl:function(){var e,t=this._f.npFeedInfo.nUrl;return e=t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0],e=e.split(":")[0]},isSavedNewsPortal:function(){return this._f.npFeedInfo.svd},setPortalSaveStatus:function(e){this._f.npFeedInfo.svd=e},isPending:function(e){return void 0!==e&&(this.pending=!!e),this.pending},isShareAble:function(e){var t,n=!0,r=this.isSingleContentFeed()&&!this.images.length(),i=this.getSingleContent();return this._u.isCurrentUser()||r&&i.user().isCurrentUser()?(t="RC15",n=!1):this.friend?(t="CRCFS1",n=!1):this._f.grpId?(t="CRCFS2",n=!1):this._f.is&&!r&&(t="CRCFS3",n=!1),e?{sucs:n,rc:t}:n},encodeUtf8Fields:function(){var e,t,n=["location","lctn","lnkDmn","lnkDsc","lnkTtl","lnkURL","lnlImgURL"];for(e=0;e<n.length;e++)t=n[e],this._f[t]?this._f[t]=this._f[t].utf8Encode():this._f[t]=""},feedConditionalReplacer:function(e,t){var n=0;return t=t||[],e=e.replace(/(\w+)?\|\|(\w+)?/g,function(e,r,i){return void 0!==t[n]?t[n]?r:i:""}),e.replace(/(\s){2,}/g," ")}},{getPrefix:function(){return E},setSortKey:function(e){p=e},setPrefix:function(e){E=e},getSortIndex:function(){return p},makeKey:function(e){return E+e},create:function(e,t){return new A(e,t)}}}angular.module("ringid.shared").factory("$$commentMap",["$$stackedMap","settings","$filter","userFactory","Utils","$$stickerMap","$sce",function(e,t,n,r,i,o,a){var s={cmn:"",cmnId:0,deleted:!1,edited:!1,fn:"",il:0,isNew:1,ln:"",nfId:0,imageId:0,tl:0,tm:"",uId:"",prIm:"",pending:!1};function c(e,t){t&&(this._u=t),this.updateComment(e)}return c.prototype={updateComment:function(e){this.comment?angular.extend(this.comment,e):this.comment=angular.extend({},s,e),this.updateTime(),this.setHtml(),this._u||(this._u=r.create({fn:this.comment.fn,ln:this.comment.ln,uId:this.comment.uId,prIm:this.comment.prIm}))},updateTime:function(){this.comment.tm||(this.comment.tm=Date.now()),this.vtime=i.verbalDate(this.comment.tm)},setHtml:function(){this.html=a.trustAsHtml(i.parseForLE(this.comment.cmn))},user:function(){return this._u},isOwner:function(e){return e===this._u.getKey()},text:function(){return this.comment.cmn},setComment:function(e){this.comment.cmn=e,this.setHtml()},setText:function(e){this.comment.cmn=e,this.setHtml()},getDynamicText:function(){return this.html},getByProperty:function(e,t){return t=t||!1,this.comment.hasOwnProperty(e)?this.comment[e]:t},sortBy:function(){return this.comment.cmnId},getKey:function(){return this.comment.cmnId},setKey:function(e){this.comment.cmnId=e},getFeedKey:function(){return this.comment.nfId},setFeedKey:function(e){this.comment.nfId=e},getImageKey:function(){return this.comment.imageId},setImageKey:function(e){this.comment.imageId=e},getTimestamp:function(){return this.comment.tm},setTime:function(e){this.comment.tm=e,this.updateTime()},getTimeUpdate:function(){return this.updateTime(),this.vtime},time:function(){return this.vtime},like:function(e,t){return e?(this.comment.il=1^this.comment.il,t?this.comment.tl=t:this.comment.tl=0==this.comment.il?this.comment.tl-1:this.comment.tl+1,this.comment.il):this.comment.il},getTotalLikes:function(){return this.comment.tl},incomingLike:function(e){this.comment.tl=e},isPending:function(e){return void 0!==e&&(this.comment.pending=!!e),this.comment.pending},isEditable:function(){return this._u.isCurrentUser()&&0===this.like()},isDeleteAble:function(e){return this._u.isCurrentUser()||e&&e.user().isCurrentUser()}},{getSortIndex:function(){return"tm"},create:function(e,t){return new c(e,t)}}}]),angular.module("ringid.shared").factory("$$albumMap",$$albumMap),$$albumMap.$inject=["settings","$$imageMap","$$stackedMap","userFactory","profileHttpService"];function $$albumMap(e,t,n,r,i){var o={albId:"",timg:"",imageList:[],ut:0};function a(e,t){var n=this;e=e||{},n.updateAlbum(e,t)}function s(e,n){for(var r,i,o=0,a=n.length;o<a;o++)i=angular.extend({},n[o],{albId:e.album.albId}),r=t(i,e._u),e.album.images.save(r.getKey(),r),e.album.ut<n[o].tm&&(e.album.ut=n[o].tm)}return a.prototype={updateAlbum:function(e,t){this.album?angular.extend(this.album,e):this.album=angular.extend({},o,e),t&&(this._u=r.create({uId:t})),this.album.images=n.createNew(),this.album.imageList&&this.album.imageList.length>0&&s(this,this.album.imageList)},pushImages:function(e){s(this,e.imageList)},getKey:function(){return this.album.albId},removeImage:function(e){this.album.images.remove(e)&&(this.album.tn=this.album.tn-1,"profileimages"===this.album.albId&&e===this._u.getProfileImageId()?this._u.resetAvatar():"coverimages"===this.album.albId&&e===this._u.getCoverImageId()&&this._u.resetCover())},getName:function(){return this.album.albn},getCoverImage:function(t){var n=this.album.cvImg.lastIndexOf("/")+1;return t="p"+t,[e.imBase,this.album.cvImg.slice(0,n),t,this.album.cvImg.slice(n)].join("")},getTotalImageCount:function(){return this.album.tn},getUpdateTime:function(){return this.album.tm},getImages:function(){return this.album.images}},function(e,t){return new a(e,t)}}var frameTypes={TIT2:"title",TOPE:"original-artist",TPE1:"artist",TOA:"original-artist",TP1:"artist",TT2:"title",APIC:"image",PIC:"image"},frameImageTypes=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"];angular.module("ringid.shared").service("mediaMetadata",mediaMetadata),mediaMetadata.$inject=["$$q","Ringalert","Utils"];function mediaMetadata(e,t,n){var r=this;function i(e){var t={drtn:Math.floor(e.duration),tiw:e.videoHeight,tih:e.videoWidth,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile};window.URL.revokeObjectURL(e.src),e.deferObj.resolve(t)}function o(e){var t,n=new DataView(e),r={tag:null,value:null},i={id:n.getString(0,3),type:n.getString(0,1),size:n.getUint24(3)};if(!(i.id in frameTypes))return!1;if(r.tag=frameTypes[i.id],"T"===i.type)t=n.getUint8(7),r.value=n.getString(7,n.byteLength-7);else if("PIC"===i.id){t=n.getUint8(6);var o={type:null,mime:"image/"+n.getString(7,3).toLowerCase(),description:null,data:null};o.type=frameImageTypes[n.getUint8(11)]||"other";for(var a=11,s=0,c=a;;c++)if(0===n.getUint8(c)){s=c-a;break}o.description=0===s?null:n.getString(a,s),r.value=new Blob(new Uint8Array(e.slice(a+1)),{type:o.mime})}return!!r.tag&&r}function a(e,t,n){if(n=n||0,t=t||4,t<3)return o(e);var r,i=new DataView(e),a={tag:null,value:null},s={id:i.getString(0,4),type:i.getString(0,1),size:i.getSynch(i.getUint32(4)),flags:[i.getUint8(8),i.getUint8(9)]};if(0!==s.flags[0]||!(s.id in frameTypes))return!1;if(a.tag=frameTypes[s.id],"T"===s.type)if(r=i.getUint8(10),0===r||3===r)a.value=i.getString(11,i.byteLength-11);else if(1===r)a.value=i.getStringUtf16(-11,11,!0);else{if(2!==r)return!1;a.value=i.getStringUtf16(-11,11)}else if("APIC"===s.id){r=i.getUint8(10);for(var c={type:null,mime:null,description:null,data:null},l=11,u=0,d=l;;d++)if(0===i.getUint8(d)){u=d-l;break}c.mime=i.getString(l,u),c.type=frameImageTypes[i.getUint8(l+u+1)]||"other",l+=u+2,u=0;for(var d=l;;d++)if(0===i.getUint8(d)){u=d-l;break}c.description=0===u?null:i.getString(l,u),a.value=new Blob(new Uint8Array(e.slice(l+1)),{type:c.mime})}return!!a.tag&&a}function s(e,t){var n,r,i=new DataView(e),o={},s=0,c=10,l=i.byteLength-128;if("TAG"===i.getString(l,3)&&(l+=3,t.ttl=i.getString(l,30).trim()||null,l+=30,t.artst=i.getString(l,30).trim()||null),n=i.getUint8(3),r=i.getUint8(5),s+=i.getSynch(i.getUint32(6)),s>i.byteLength||"ID3"!==i.getString(0,3)||n>4||0!==(128&r));else for(0!==(64&r)&&(c+=i.getSynch(i.getUint32(11)));c<s;){for(var u,d,g,m=!0,f=0;f<3;f++)g=i.getUint8(c+f),(g<65||g>90)&&(g<48||g>57)&&(m=!1);if(!m)break;d=n<3?e.slice(c,c+6+i.getUint24(c+3)):e.slice(c,c+10+i.getSynch(i.getUint32(c+4))),u=a(d,n),u&&(o[u.tag]=u.value),c+=d.byteLength}t.ttl=o.title||t.ttl||"",t.artst=o.artist||o["original-artist"]||t.artst||""}function c(){var e=this,t={drtn:Math.floor(e.duration),tiw:0,tih:0,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile,thmbURL:""},n=new FileReader;n.onload=function(){s(this.result,t),e.deferObj.resolve(t)},n.readAsArrayBuffer(e.fileObj)}function l(e){this.deferObj.reject()}r.generateMeta=function(t,n){var r,o=e.defer();return"audio"===n?(r=document.createElement("audio"),r.addEventListener("loadeddata",c),r.fileObj=t):(r=document.createElement("video"),r.addEventListener("loadeddata",function(){var e=this;e.currentTime=e.duration>20?10:e.duration/2;function t(){r.removeEventListener("timeupdate",t),i(e)}r.addEventListener("timeupdate",t)})),r.deferObj=o,r.nameFromFile=t.name,r.addEventListener("onerror",l),r.src=window.URL.createObjectURL(t),o.promise}}angular.module("ringid.shared").service("imageQuality",imageQuality),imageQuality.$inject=["$$q","APP_CONSTANTS","Ringalert","Utils"];function imageQuality(e,t,n,r){var i=this,o=t.COVER_PIC_UPLOAD_MINIMUM_WIDTH,a=t.COVER_PIC_UPLOAD_MINIMUM_HEIGHT,s=t.COVER_PIC_UPLOAD_MAXIMUM_WIDTH,c=t.COVER_PIC_UPLOAD_MAXIMUM_HEIGHT,l=t.PROFILE_PIC_UPLOAD_MINIMUM_WIDTH,u=t.PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT,d=t.IMAGE_UPLOAD_MIN_HEIGHT,g=t.IMAGE_UPLOAD_MIN_WIDTH;i.resizeImage=function(t,n){var i=new Image,m=!1,f=e.defer(),E={ih:0,iw:0,previewUrl:"",file:""},p=window.URL||window.webkitURL;function T(){var e,i,p=this,T=1,h=p.width,_=p.height;function I(o){e=document.createElement("canvas"),e.width=E.iw,e.height=E.ih,i=e.getContext("2d"),i.drawImage(p,0,0,E.iw,E.ih),o&&(E.imQ=o.qualityIM.quality),E.previewUrl=e.toDataURL("image/jpeg"),E.file=r.dataURLToBlob(E.previewUrl),E.file.name=t.name||n+".jpg",f.resolve(E)}h>s||_>c?h/s>_/c?(T=s/h,E.iw=s,E.ih=Math.floor(T*_)):(T=c/_,E.ih=c,E.iw=Math.floor(T*h)):(E.iw=h,E.ih=_);var A=d,v=g;switch(n){case"profilephoto":(E.iw<l||E.ih<u)&&(A=u,v=l,m=!0);break;case"coverphoto":(E.iw<o||E.ih<a)&&(A=a,v=o,m=!0);break;case"image":case"status":case"chatimage":case"tagchatimage":(E.iw<g||E.ih<d)&&(m=!0)}m?f.reject("Image Size below Minimum("+v+"px by "+A+"px) :"+t.name):I(!1)}function h(){f.reject("Image invalid: "+t.name)}return"string"==typeof t?(i.setAttribute("crossOrigin","anonymous"),i.src=t):i.src=p.createObjectURL(t),i.onload=T,i.onerror=h,f.promise}}angular.module("ringid.shared").service("fileUploadService",fileUploadService),fileUploadService.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","Utils","$ringhttp","imageQuality","mediaMetadata"];function fileUploadService(e,t,n,r,i,o,a,s,c,l){var u={};function d(e){var t,n,r,i=new DataView(e);return i.byteLength?(t=i.getBool(0),t===!1?(r=i.getUint8(1),n={sucs:!1,mg:i.getString(2,r)}):t===!0&&(r=i.getUint8(1),n={sucs:!0,url:i.getString(2,r)})):n={sucs:!1,mg:"Failed. Response unreadable"},n}function g(u,g,f,E){var p,T="",h={uniqueId:a.getUniqueID(),uploadType:u,file:g||null,fileName:g.name&&g.name.substr(0,g.name.lastIndexOf("."))||"uploadFile",fileType:(g.name&&g.type?g.type.substr(0,g.type.indexOf("/")):void 0)||"image",response:{url:""},meta:{ttl:"status"!==u&&"image"!==u&&g.name?g.name.substr(0,g.name.lastIndexOf("."))||g.name:""},gotMeta:!1,previewUrl:"",progressVal:0,queued:!1,uploadComplete:!1,uploadFail:!1};switch(u){case"audio":h.fileName+=".mp3";break;case"video":h.fileName+=".mp4";break;default:h.meta.ttl="",h.fileName+=".jpg"}h.previewUrl=n.baseUrl+"/images/default_"+h.fileType+"_image.jpg","profilephoto"!==u&&"coverphoto"!==u||(h.repositionD={ih:0,iw:0,cimX:0,cimY:0});function _(e){h.progressVal=e,"coverphoto"!==h.uploadType&&"profilephoto"!==h.uploadType||(m.progress=h.progressVal),r.$broadcast(i.FILE_UPLOAD.PROGRESS_UPDATE),f()}function I(e){var t;switch(h.uploadType){case"chatimage":t=d(e),t.sucs===!0&&(t.url=t.url),m.uploadProgress=!1,angular.extend(t,h.meta||{});break;case"tagchatimage":t=angular.fromJson(e),t.sucs===!0&&(t.url=t.iurl),m.uploadProgress=!1,angular.extend(t,h.meta||{});break;case"video":t=d(e),h.meta.thmbURL=t.url?t.url.substr(0,t.url.lastIndexOf("."))+".jpg":"",h.previewUrl=t.url?n.mediaBase+h.meta.thmbURL:"";break;case"audio":t=d(e);break;case"coverphoto":case"profilephoto":t=angular.fromJson(e),t.ih=h.meta.ih,t.iw=h.meta.iw,m.uploadProgress=!1;break;case"image":t=angular.fromJson(e),h.previewUrl=t.iurl?n.imBase+t.iurl.substr(0,t.iurl.lastIndexOf("/")+1)+"pthumb"+t.iurl.substr(t.iurl.lastIndexOf("/")+1):"";break;case"thumb":t=d(e);break;default:t=angular.fromJson(e)}h.response=angular.extend({},h.response,t),t.sucs===!0?h.uploadComplete=!0:h.uploadFail=!0,h.queued=!1,t.sucs!==!0&&o.show(t.mg||"Failed","error"),p.resolve(t)}function A(){f(),p.reject()}function v(e){h.uploadFail=!0,o.show("Upload failed!","error"),E?p.resolve():p.reject()}function S(e){switch(h.fileType){case"video":case"audio":l.generateMeta(h.file,h.fileType).then(function(t){h.meta=angular.extend({},t,h.meta),e({success:!0}),f()},function(t){o(t,"error"),h.uploadFail=!0,p?p.reject(t):e({success:!1,message:t}),f()});break;case"image":c.resizeImage(h.file,h.uploadType).then(function(t){h.file=t.file,h.meta.ih=t.ih,h.meta.iw=t.iw,h.previewUrl=t.previewUrl,e({success:!0}),f()},function(t){h.uploadFail=!0,p?(o.show(t,"error"),p.reject(t)):e({success:!1,message:t}),f()})}h.gotMeta=!0,f()}return{getKey:function(){return h.uniqueId},setRepositionData:function(e){h.repositionD=angular.extend({},h.repositionD||{},e)},getRepositionData:function(){return"profilephoto"===h.uploadType?{pimX:h.repositionD.cimX,pimY:h.repositionD.cimY}:{cimX:h.repositionD.cimX,cimY:h.repositionD.cimY}},getFile:function(){return h.file},getName:function(){return h.file.name},fetchMeta:S,initUpload:function(){var r=new FormData,i="text";switch(p=e.defer(),h.queued=!0,r.append("sId",t.getCookie("sId")),r.append("uId",t.getCookie("uId")),r.append("authServer",t.getCookie("authServer")),r.append("comPort",t.getCookie("comPort")),r.append("x-app-version",n.apiVersion),h.uploadType){case"profilephoto":T=n.imServer+"ImageUploadHandler";break;case"coverphoto":T=n.imServer+"CoverImageUploadHandler";break;case"tagchatimage":T=n.imServer+"GroupContentHandler";break;case"chatimage":T=n.imServer+"ChatImageHandler",i="arraybuffer";break;case"image":T=n.imServer+"AlbumImageUploadHandler";break;case"video":T=n.mediaServer+"Mp4UploadHandler",i="arraybuffer";break;case"audio":T=n.mediaServer+"Mp3UploadHandler",i="arraybuffer";break;case"thumb":T=n.mediaServer+"ThumbImageHandler",i="arraybuffer",h.gotMeta=!0}h.gotMeta?o():S(o);function o(){"coverphoto"!==h.uploadType&&"profilephoto"!==h.uploadType||Object.keys(h.repositionD).forEach(function(e){r.append(e,h.repositionD[e])}),r.append("file",h.file,h.fileName),h.xhr=s.post(T,r,i).success(I).error(v).progress(_).abort(A)}return p.promise},cptn:function(e){return arguments.length>0&&(h.meta.ttl=e),h.meta.ttl},getPreview:function(){return h.previewUrl},cancelUpload:function(){h.uploadFail=!0,h.xhr?h.xhr.abortRequest():h.deferred&&h.deferred.reject()},setPreview:function(e){h.previewUrl=e},getProgress:function(){return h.progressVal},uploadCompleted:function(){return h.uploadComplete},uploadFailed:function(){return h.uploadFail},getQueued:function(){return h.queued},setQueued:function(e){h.queued=e||!0},setMeta:function(e){h.meta=e},getMeta:function(){return!!h.hasOwnProperty("meta")&&h.meta},getAuthData:function(e){var t={};switch(h.fileType){case"image":t={ih:h.meta.ih,iw:h.meta.iw,iurl:h.response.iurl,cptn:h.meta.ttl.utf8Encode()};break;case"video":case"audio":if(t={strmURL:h.response.url,tiw:h.meta.tiw,tih:h.meta.tih,drtn:h.meta.drtn,thmbURL:h.meta.thmbURL,artst:h.meta.artst.utf8Encode(),ttl:h.meta.ttl.utf8Encode()},e){for(var n=0;n<m.tagList.length;n++)m.tagList[n].sk=m.tagList[n].sk.utf8Encode();t.htgLst=m.tagList}break;default:t=h.response}return t}}}var m=this,f=-1;m.resetUpload=function(){m.progress=0,m.tagList=[],m.uploadProgress=!1,m.profileImageFile=null,m.coverImageFile=null,m.imageFiles=[],m.videoFiles=[],m.audioFiles=[],m.chatImageFiles={},m.selectFromAlbum=!1},m.resetUpload(),m.createUploadFile=function(e,t){return new g(e,t,E)},m.setUploadAlbum=function(e){f=e},m.getUploadAlbum=function(){return f},m.queueFile=function(e,t){switch(e){case"profilephoto":return m.progress=0,m.profileImageFile=new g(e,t,E),m.profileImageFile;case"coverphoto":return m.progress=0,m.coverImageFile=new g(e,t,E),m.coverImageFile;case"tagchatimage":case"chatimage":return new g(e,t,E);case"image":m.imageFiles.push(new g(e,t,E,(!0)));break;case"video":m.videoFiles.push(new g(e,t,E,(!0)));break;case"audio":m.audioFiles.push(new g(e,t,E,(!0)))}E()},m.setReposition=function(e,t){"coverphoto"===t?m.coverImageFile.setRepositionData(e):"profilephoto"===t&&m.profileImageFile.setRepositionData(e)},m.getReposition=function(e){return"coverphoto"===e?m.coverImageFile.getRepositionData():"profilephoto"===e?m.profileImageFile.getRepositionData():{}},m.uploadQueue=function(t,n){var o,a=[],s=t+"Files";if(n<m[s].length){o=n+2<m[s].length?n+2:m[s].length;for(var c=n;c<o;c++)!m[s][c]||m[s][c].getQueued()||m[s][c].uploadFailed()||a.push(m[s][c].initUpload());if(0===a.length)return void m.uploadQueue(t,o);e.all(a).then(function(){u(),m.uploadQueue(t,o)},function(e){o-=u(),m.uploadQueue(t,o)})}else var l=setInterval(function(){m.uploadProgress=!1,u(!0);for(var e=0;e<m[s].length;e++)if(!m[s][e].uploadCompleted()){m.uploadProgress=!0;break}m.uploadProgress||(clearInterval(l),r.$broadcast(i.FILE_UPLOAD.QUEUE_COMPLETE,t),E())},2e3);function u(e){for(var t=e?0:n,r=0,i=t,o=m[s].length;i<o;i++)m[s][i]&&m[s][i].uploadFailed()&&(m[s].splice(i,1),r++,i--,o--);return r>0&&E(),r}},m.setScopeForDigest=function(e){u[e.$id]=e},m.removeScope=function(e){u[e.$id]&&(u[e.$id]=null)};function E(){var e;for(var t in u)u.hasOwnProperty(t)&&(e=u[t],e&&e.$id&&!e.$$destroyed&&e.$rgDigest())}}angular.module("ringid.shared").service("StickerEmoticonService",StickerEmoticonService).factory("StickerEmoticonFactory",StickerEmoticonFactory),StickerEmoticonService.$inject=["STICKER_IMAGE_TYPE","settings"];function StickerEmoticonService(e,t){var n=this,r={":D":"awesome.png",":<3":"loved.png","*D*":"excited.png",":)":"happy.png",":-(":"alone.png","(cool)":"cool.png","x=(":"angry.png","o_-":"fresh.png",":>s":"sick.png",":?":"confused.png",";|":"thoughtful.png",":*":"fantastic.png",":=(":"upset.png",">u<":"blah.png","(amused)":"amused.png","(hot)":"hot.png","(-_^)":"motivated.png","(^_^)":"satisfied.png",">=<":"hurt.png",":(s":"ill.png","(cute)":"cute.png","I=)":"relived.png",":O":"shoked.png","(beautiful)":"beautiful.png",":|p":"hyper.png","(pumped)":"pumped.png","%)":"drunk.png","o(":"impatient.png","(restless)":"restless.png",":-)":"emotional.png","(hungry)":"hungry.png","(nostalgic)":"nostalgic.png","(blessed)":"blessed.png","</3":"heartboken.png","(naughty)":"naughty.png","(entertained)":"entertained.png","(broken)":"broken.png","(cold)":"cold.png","(down)":"down.png","(sorry)":"sorry.png","(frustrated)":"frustrated.png",":-s":"scared.png",":@":"fuming.png",NN:"run.png",":'q":"crying.png",":'D":"laughing.png",":'(":"soreness.png","(boiling)":"boiling.png",":x":"xmode.png",":p":"cheeky.png",":=0":"laughing-inside.png","|-O":"yawn.png",":6":"devil.png",":-#":"zipped-lip.png","(clap)":"clap.png","<3":"heart.png","(pink-heart)":"pink-heart.png","(k)":"pink-lip.png","(#)":"sun.png","(*)":"star.png","(g)":"gift.png","(K)":"red-lip.png","(f)":"rose.png"},i=angular.extend({":&lt;3":"loved.png","&lt;/3":"heartboken.png","&gt;=&lt;":"hurt.png","&gt;u&lt;":"blah.png",":&gt;s":"sick.png","&lt;3":"heart.png"},r);function o(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var a=[];for(var s in i)i.hasOwnProperty(s)&&a.push(o(s));var c=new RegExp(a.join("|"),"g");n.getEmoImageName=function(e){try{return r[e]}catch(e){return"default.png"}},n.getAllEmoticons=function(){var t={type:e.EMOTICON,imageList:[]};return angular.forEach(r,function(n,r){t.imageList.push({name:n,symbol:r,type:e.EMOTICON})}),t},n.getEmoticonUrlMap=function(){var e={};return angular.forEach(r,function(n,r){e[r]=t.emoticonBase+n}),e},n.getEmoticonUrlMapWithHtmlEncode=function(){var e={};return angular.forEach(i,function(n,r){e[r]=t.emoticonBase+n}),e},n.getEmoticonPattern=function(){return c},n.getEmoticonMap=function(){return i}}StickerEmoticonFactory.$inject=["StickerEmoticonService"];function StickerEmoticonFactory(e){function t(){return e.getAllEmoticons()}function n(t){return e.getEmoImageName(t)}function r(e,t,n){var r=settings.stickerBase+e+"/"+t+"/"+n;return r}return{getAllEmoticons:t,getEmoImageName:n,getStickerImageUrl:r,getEmoticonUrlMap:e.getEmoticonUrlMap,getEmoticonUrlMapWithHtmlEncode:e.getEmoticonUrlMapWithHtmlEncode,getEmoticonPattern:e.getEmoticonPattern}}angular.module("ringid.shared").factory("friendsFactory",friendsFactory),friendsFactory.$inject=["$rootScope","SystemEvents","$$q","Contacts","APP_CONSTANTS","Auth","Storage","$$connector","OPERATION_TYPES","userFactory","friendsHttpService","$$stackedMap","Ringalert","Utils"];function friendsFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m){var f=c.SYSTEM.FRIENDS,E=!1,p=i,T=0,h=0,_={totalPacket:0,complete:!1},I=function(e,t){var n,r,i,s=[],c=[],l=[];if(t)l=e;else{for(n=0,r=e.length;n<r;n++)e[n]!==o.currentUser().getUtId()&&(a.getContact(e[n])?c.push(a.getContact(e[n])):l.push(e[n]));c.lenght>0&&v(c)}var u=new ArrayBuffer(8*l.length),d=new DataView(u);for(n=0,i=0,r=l.length;n<r;n++)d.setInt32(i,0),i+=4,d.setInt32(i,l[n]),i+=4;for(n=0;n<d.byteLength;n++)s.push(d.getInt8(n));return s},A=function(e,t,n){var i=r.remove("utIds",e);t&&G.friends.remove(e),i&&!n||(i=r.remove("incomingUtIds",e),t&&G.incomingFriends.remove(e),i&&!n||(i=r.remove("outgoingUtIds",e),t&&G.outgoingFriends.remove(e)))},v=function(e){for(var t,n,r=0,i=e.length;r<i;r++)t=l.create(e[r]),n=t.friendshipStatus(),e[r].deleted&&1===e[r].deleted||(n===p.FRIEND?G.friends.save(t.getUtId(),t):n===p.INCOMING_FRIEND?G.incomingFriends.save(t.getUtId(),t):n===p.OUTGOING_FRIEND&&G.outgoingFriends.save(t.getUtId(),t),A(e[r].utId,!1,!0))},S=function(e,t){var n=t&&t.mg?t.mg:"Reqeust Failed";g.show(n,"error"),e&&e.reject({sucs:!1,mg:n})},C=function(e){var n,i,o;switch(e.actn){case f.TYPE_CONTACT_UTIDS:if(e.sucs===!0){for(0!==_.totalPacket||_.complete||(_.totalPacket=e.totalPacket),_.totalPacket--,i=0,o=e.utIds.length;i<o;i++)switch(e.utIds[i].value.frnS){case p.FRIEND:r.add("utIds",e.utIds[i].key,e.utIds[i].value);break;case p.INCOMING_FRIEND:r.add("incomingUtIds",e.utIds[i].key,e.utIds[i].value);break;case p.OUTGOING_FRIEND:r.add("outgoingUtIds",e.utIds[i].key,e.utIds[i].value)}0===_.totalPacket&&(_.complete=!0,r.initStorage()),m.triggerCustomEvent(t.FRIEND.UTID_LIST_RECEIVED)}else e.sucs===!1&&1111===e.rc&&u.getContactList();break;case f.TYPE_UPDATE_ADD_FRIEND:e.sucs===!0&&r.add("incomingUtIds",e.utId,{frns:p.INCOMING_FRIEND});break;case f.TYPE_UPDATE_DELETE_FRIEND:e.sucs===!0&&e.utId&&(A(e.utId,!0,!0),n=l.create(e),n.updateUserObj({frnS:p.NOT_FRIEND}));break;case f.TYPE_UPDATE_ACCEPT_FRIEND:e.sucs===!0&&(A(e.utId,!0),G.friends.add(e.utId,l.create(e)))}},D=function(e){switch(e){case"friendslist":case"friends":return G.friends;case"incoming":return G.incomingFriends;case"outgoing":return G.outgoingFriends;case"userfriends":return G.userFriends}},M=function(){T=0,G.userFriends.reset()},y=function(e){var t,r=n.defer();return u.getUserContacts(e,h).then(function(e){if(T=0===T?e.tf:T,e.sucs===!0){h+=e.contactList.length;for(var n=0;n<e.contactList.length;n++)t=l.create(e.contactList[n]),G.userFriends.save(t.getKey(),t);r.resolve()}else r.reject(e)},function(e){r.reject(e)}),r.promise},N=function(e,t){var i,o=[],s=n.defer();switch(t=t?t:20,e=e?e:"utIds"){case"friends":case"friendslist":case"utIds":o=I(r.utIds().keys().slice(0,t)),G.state.isFriendsLoading=o.length>0;break;case"userfriends":break;case"incoming":case"incomingUtIds":o=I(r.incomingUtIds().keys().slice(0,t));break;case"outgoing":case"outgoingUtIds":o=I(r.outgoingUtIds().keys().slice(0,t))}return o.length>0?u.getContactListDetails({utIDs:o,uo:!1}).then(function(e){if(e.sucs===!0){for(i=0;i<e.contacts.length;i++)a.setContact(e.contacts[i].utId,e.contacts[i]);v(e.contacts),s.resolve(e)}else s.reject(e)},function(e){s.reject(e)}):s.reject({sucs:!1}),s.promise},b=function(e){if(e.length>0){var t=I(e,!0);if(t.length>0)return u.getContactListDetails({utIDs:t,uo:!1})}},O=function(e,t){switch(e.friend.isLoading(!0),e.action){case"remove":case"unfriend":return U(e,t);case"add":case"addfriend":return P(e,t);case"accept":return R(e,t);case"incoming_reject":case"outgoing_reject":case"reject":return L(e,t);case"block":return e.block=1,e.bv=0,F(e,t);case"unblock":return e.block=0,e.bv=1,F(e,t);default:return e.friend.isLoading(!1),!1}},P=function(e,t){var i=!!t&&n.defer(),o=e.friend.getUtId();if(u.sendFriendRequest({uId:e.friend.getKey()}).then(function(n){e.friend.isLoading(!1),n.sucs===!0?(r.add("outgoingUtIds",o,{frns:p.OUTGOING_FRIEND}),t&&i.resolve(n),e.friend.updateUserObj(angular.extend({},n,{frns:p.OUTGOING_FRIEND}))):S(i,n)},function(t){e.friend.isLoading(!1),S(i,t)}),t)return i.promise},R=function(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();if(u.acceptFriendRequest({friendId:r.friend.getKey(),utId:r.friend.getUtId()}).then(function(n){r.friend.isLoading(!1),n.sucs===!0?(A(a,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),r.friend.updateUserObj(angular.extend({},n,{frnS:p.FRIEND})),G.friends.save(a,r.friend),i&&o.resolve(n)):S(o,n)},function(e){r.friend.isLoading(!1),S(o,e)}),i)return o.promise},U=function(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();if(u.unFriend({friendId:r.friend.getKey()}).then(function(n){r.friend.isLoading(!1),n.sucs===!0?(A(a,!0,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),r.friend.updateUserObj(angular.extend({},n,{frnS:p.NOT_FRIEND})),i&&o.resolve(n)):S(o,n)},function(e){r.friend.isLoading(!1),S(o,e)}),i)return o.promise},L=function(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();if(u.unFriend({friendId:r.friend.getKey()}).then(function(n){r.friend.isLoading(!1),n.sucs===!0?(r.friend.updateUserObj(angular.extend({},n,{frnS:p.NOT_FRIEND})),A(a,!0,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),i&&o.resolve(n)):S(o,n)},function(e){r.friend.isLoading(!1),S(o,e)}),i)return o.promise},F=function(e,t){var r=!!t&&n.defer();if(u.blockFriend(e).then(function(n){e.friend.isLoading(!1),n.sucs===!0&&e.friend.setBlock(e.block),t&&r.resolve()},function(){e.friend.isLoading(!1),t&&r.reject()}),t)return r.promise},w=function(){for(var e="",t=0;t<G.friends.size();t++)e+=",".fFactory.friends[t].getKey();return e},k=function(e,t){if(t){var r=n.defer();return u.searchContact(e,t).then(function(e){e.sucs?r.resolve():r.reject()},function(){r.reject()},function(e){if(e.sucs===!0){for(var t=0;t<e.searchedcontaclist.length;t++)a.setContact(e.searchedcontaclist[t].utId,e.searchedcontaclist[t]);v(e.searchedcontaclist)}else r.reject()}),r.promise}return u.searchContact(e,!1)};function $(e,t){switch(e){case"utIds":r.utIds().save(t,{frnS:p.FRIEND});break;case"incomingUtIds":r.incomingUtIds().save(t,{frnS:p.INCOMING_FRIEND});break;case"outgoingUtIds":r.outgoingUtIds().save(t,{frnS:p.OUTGOING_FRIEND})}}var G={state:{noFriends:!1,isFriendsLoading:!1,isUserFriendsLoading:!1,isRequestsLoading:!1},getRequestCount:function(){var e=r.incomingUtIds().length()+G.incomingFriends.length();return e>99?"99+":e},getPendingCount:function(){return r.outgoingUtIds().length()+G.outgoingFriends.length()},totalFriends:function(e){return"userfriends"===e?T:r.utIds().length()+G.friends.length()},totalUserFriends:function(){return T},friends:d.createNew(),userFriends:d.createNew(),incomingFriends:d.createNew(),outgoingFriends:d.createNew(),process:C,getFriends:D,resetUserFriends:M,getUserContacts:y,getContactDetails:N,getContactDetailsByUtIds:b,removeFriend:U,friendAction:O,addFriend:P,rejectFriendRequest:L,acceptFriendRequest:R,searchContact:k,initFriends:B,addToUtIdList:$,blockFriend:F,getIds:w,utIDsToByteArray:I};s.subscribe(G.process,{action:[f.TYPE_CONTACT_UTIDS,f.TYPE_UPDATE_ADD_FRIEND,f.TYPE_UPDATE_DELETE_FRIEND,f.TYPE_UPDATE_ACCEPT_FRIEND],callWithUnresolved:!0});function B(e){E&&!e||(E=!0,r.init(),u.getContactList())}return G}angular.module("ringid.shared").service("friendsHttpService",friendsHttpService),friendsHttpService.$inject=["$$connector","OPERATION_TYPES","APP_CONSTANTS"];function friendsHttpService(e,t,n){var r=this,i=t.SYSTEM.FRIENDS,o=n,a=t.SYSTEM.REQUEST_TYPE;r.searchContact=function(t,n){var r={actn:n?i.ACTION_FRIEND_SEARCH:i.TYPE_CONTACT_SEARCH,scat:o.TYPE_SEARCH_BY_ALL,schPm:t.schPm.utf8Encode(),st:t.st||0},s=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return s.test(t.schPm)&&(r.scat=o.TYPE_SEARCH_BY_EMAIL),e.pull(r,a.REQUEST,!0)},r.getContactList=function(t){var n={actn:i.TYPE_CONTACT_UTIDS,cut:-1,ut:t||-1};return e.send(n,a.REQUEST)},r.getContactListDetails=function(t){var n={actn:i.TYPE_CONTACT_LIST,uo:t.uo||!1,utIDs:t.utIDs};return e.pull(n,a.REQUEST,!0)},r.getUserContacts=function(t,n){var r={actn:i.TYPE_FRIEND_CONTACT_LIST,utId:t,st:n||0};return e.pull(r,a.REQUEST)},r.unFriend=function(t){var n={actn:i.TYPE_DELETE_FRIEND,uId:t.friendId};return e.request(n,a.UPDATE,!0)},r.changeFriendType=function(t){var n={actn:i.TYPE_ACTION_CHANGE_FRIEND_ACCESS,ct:t.ct,utId:t.utId};return e.request(n,a.UPDATE)},r.sendFriendRequest=function(t){var n={actn:i.TYPE_ADD_FRIEND,uId:t.uId};return e.request(n,a.UPDATE,!0)},r.blockFriend=function(t){var n={actn:i.TYPE_ACTION_BLOCK_UNBLOCK_FRIEND,idList:[t.friend.getUtId()],bv:t.bv};return e.request(n,a.REQUEST)},r.saveCallPvcEdit=function(t){var n={actn:t.actn,sn:t.callsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveChatPvcEdit=function(t){var n={actn:t.actn,sn:t.chatsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveFeedPvcEdit=function(t){var n={actn:t.actn,sn:t.feedsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.acceptFriendRequest=function(t){var n={actn:i.TYPE_ACCEPT_FRIEND,utId:t.utId};return e.request(n,a.UPDATE,!0)}}angular.module("ringid.shared").service("circleHttpService",circleHttpService),circleHttpService.$inject=["$$connector","OPERATION_TYPES"];function circleHttpService(e,t){var n=this,r=t.SYSTEM.CIRCLE,i=t.SYSTEM.REQUEST_TYPE;n.go=function(t,n){return n=n||"post",e.request(t)},n.getCircleMembers=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_LIST,grpId:t,scl:1,lmt:o||40,pvtid:n||0};return e.send(a,i.REQUEST)},n.createCircle=function(t){var n={actn:r.TYPE_CREATE_GROUP,gNm:t.tg.utf8Encode(),uId:t.uId,groupMembers:t.alluser};return e.request(n,i.UPDATE);
},n.getCircles=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.send(t,i.REQUEST)},n.getCircle=function(t){return e.request({actn:r.TYPE_GROUP_DETAILS,grpId:t},i.REQUEST)},n.getCirclesInfo=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.request(t,i.REQUEST)},n.addMembers=function(t){var n={actn:r.TYPE_ADD_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.removeMember=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:[{uId:t.uId}]};return e.request(n,i.UPDATE)},n.removeMembers=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmins=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmin=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:t.grpId,groupMembers:[{admin:t.admin,uId:t.uId}]};return e.request(n,i.UPDATE)},n.leaveCircle=function(t){var n={actn:r.TYPE_LEAVE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.deleteCircle=function(t){var n={actn:r.TYPE_DELETE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.getMemberResult=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_SEARCH_RESULT,grpId:n,schPm:t,st:o||0};return e.send(a,i.REQUEST)}}angular.module("ringid.shared").service("portalHttpService",portalHttpService),portalHttpService.$inject=["OPERATION_TYPES","$$connector"];function portalHttpService(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getPortalDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,st:e||0,pType:3};return t.pull(n,i.REQUEST,!0)},n.getPortalFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,st:e||0,pType:3};return t.pull(n,i.REQUEST,!0)},n.getPortalCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,utId:e,pType:3};return t.pull(n,i.REQUEST,!0)},n.searchNewsPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:3,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,o,a){var s={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,id:e,subscType:a,npSubIds:n,npUnSubIds:o,pType:3};return t.request(s,i.UPDATE)},n.unFollowPortal=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,id:e,pType:3};return t.request(n,i.UPDATE)},n.getPortalShortDetails=function(e){var n={actn:o,isnp:!0,uId:e,pType:3};return t.request(n,i.REQUEST)}}!function(){angular.module("ringid.shared").service("businessHttpService",e),e.$inject=["OPERATION_TYPES","$$connector"];function e(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getBusinessDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,st:e||0,pType:4};return t.pull(n,i.REQUEST,!0)},n.getBusinessFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,st:e||0,pType:4};return t.pull(n,i.REQUEST,!0)},n.getBusinessCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,utId:e,pType:4};return t.pull(n,i.REQUEST,!0)},n.searchBusinessPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:4,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,o,a){var s={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,id:e,subscType:a,npSubIds:n,npUnSubIds:o,pType:4};return t.request(s,i.UPDATE)},n.unFollowBusiness=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,id:e,pType:4};return t.request(n,i.UPDATE)},n.getBusinessShortDetails=function(e){var n={actn:o,uId:e,pType:4};return t.request(n,i.REQUEST)}}}(),angular.module("ringid.shared").factory("circlesManager",circlesManager),circlesManager.$inject=["$routeParams","$location","$rootScope","$$connector","OPERATION_TYPES","Storage","$$stackedMap","$$q","circleMap","userFactory","circleHttpService","Notification","SystemEvents","Ringalert","Auth"];function circlesManager(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f){var E,p,T,h=a.createNew(!0,"asc"),_=!1,I=a.createNew(!0,"asc"),A=i.SYSTEM.CIRCLE;function v(e){I.remove(e),n.$broadcast(g.CIRCLE.MY_CIRCLE_REMOVED,{circleId:e})}function S(e,t){var n=e.get(t.grpId);return n?n.update(t):n=c.create(t),e.save(n.getKey(),n),n}function C(e){var t;return e.ists||(t=e.sAd==f.currentUser().getKey()?S(h,e):S(I,e)),t}function D(e){angular.forEach(e,C)}function M(n){e.circleId&&e.circleId==n&&t.path("/")}function y(){m.show("Circle does not exist!","warning"),t.path("/")}function N(e){var t,n;if(e.sucs)switch(e.actn){case A.TYPE_UPDATE_EDIT_GROUP_MEMBER:case A.TYPE_UPDATE_ADD_GROUP_MEMBER:t=e.grpId,n=L(t),n&&n.setMembers(e.groupMembers);break;case A.TYPE_UPDATE_DELETE_GROUP:t=e.grpId,n=L(t),n&&(v(n.getKey()),M(e.grpId));break;case A.TYPE_UPDATE_REMOVE_GROUP_MEMBER:t=e.grpId,n=L(t),e.removedMembers&&n&&angular.forEach(e.removedMembers,function(e){n.removeMember(e)});break;case A.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:e.groupList=[{gNm:e.gNm,grpId:e.grpId,mc:e.mc,sAd:e.sAd}],D(e.groupList),P(e.groupMembers)}}function b(e){return e.actn===A.TYPE_UPDATE_EDIT_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_ADD_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_DELETE_GROUP||e.actn===A.TYPE_UPDATE_REMOVE_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND}function O(e){clearTimeout(E),e.actn===A.TYPE_GROUP_LIST&&e.sucs===!0&&(D(e.groupList),n.$broadcast(g.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE))}function P(e){if(e.sucs===!0&&angular.isArray(e.groupMembers)&&e.groupMembers.length){for(var t=0;t<e.groupMembers.length;t++)p=e.groupMembers[t].id;var r=h.get(e.groupMembers[0].grpId);if(r||(r=I.get(e.groupMembers[0].grpId)),!r)return;r.setMembers(e.groupMembers)}n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:!0})}function R(e){if(T=e.tr,e.sucs===!0&&angular.isArray(e.groupMembers)&&e.groupMembers.length){var t=h.get(e.groupMembers[0].grpId);if(t||(t=I.get(e.groupMembers[0].grpId)),!t)return;t.setMembers(e.groupMembers)}n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:e.sucs})}function U(e,t){u.getCircle(e).then(function(e){e.sucs===!0&&(t.setMemberCount(e.mc),n.$broadcast(g.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT))})}function L(e){return h.get(e)||I.get(e)}function F(e){var t=L(e),n=s.defer();return t?setTimeout(function(){n.resolve(t)}):u.getCircle(e).then(function(r){r.sucs?(r.grpId=e,r.ists=0,t=C(r),n.resolve(t)):n.reject(!1)},function(e){}),n.promise}function w(e){return e?h:I}function k(e){var t=s.defer();return u.createCircle(e).then(function(e){e.sucs===!0&&u.getCircles(),t.resolve(e)}),t.promise}function $(e,t){var n=s.defer(),r={grpId:t,members:e};return u.addMembers(r).then(function(e){L(t);n.resolve(e)}),n.promise}function G(e,t,n){0===t&&(p=t),u.getCircleMembers(e,p,n)}function B(e,t){u.getMemberResult(e,t,T)}function x(e){var t=s.defer();return u.leaveCircle({grpId:e.getKey()}).then(function(n){var r=angular.fromJson(n);r.sucs===!0?(h.remove(e.getKey()),I.remove(e.getKey()),t.resolve(r)):t.reject("Failed")}),t.promise}function H(e){var t=s.defer();return u.deleteCircle({grpId:e.getKey()}).then(function(n){n.sucs===!0?(h.remove(e.getKey()),I.remove(e.getKey()),t.resolve(n)):t.reject("Failed")}),t.promise}function Y(e,t){var r={grpId:t.getKey(),uId:e},i=t.removeMember(e);u.removeMember(r).then(function(e){e.sucs!==!0&&(t.addMember(i),m.show(e,"error")),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(e){})}function K(e,t){var r={grpId:t.getKey(),members:[]};angular.forEach(e,function(e){r.members.push({uId:e}),t.removeMember(e)}),t.setMemberCount(t.getMembersObjectCount()),u.removeMembers(r).then(function(r){r.sucs!==!0&&(angular.forEach(e,function(e){t.addMember(e)}),t.setMemberCount(t.getMembersObjectCount()),m.show(r,"error")),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(e){})}function j(e,t){u.addRemoveAdmin(e).then(function(r){if(r.sucs===!0){var i=r.groupMembers[0];i.uId===e.uId&&i.admin===!0?t.promoteToAdmin(e.uId):i.uId===e.uId&&i.admin===!1&&t.removeFromAdmin(e.uId),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}},function(e){})}function V(e){_||(r.subscribe(N,{action:[A.TYPE_UPDATE_DELETE_GROUP,A.TYPE_UPDATE_REMOVE_GROUP_MEMBER,A.TYPE_UPDATE_ADD_GROUP_MEMBER,A.TYPE_UPDATE_EDIT_GROUP_MEMBER]}),r.subscribe(O,{action:[A.TYPE_GROUP_LIST]})),_&&!e||(_=!0,u.getCircles())}return{init:V,processCircleUpdates:N,circleUpdateFilter:b,processCirclesData:O,processCircleMembersData:P,processCircleSearchMembersData:R,getCircle:L,getCirclePromise:F,getCircles:w,createCircle:k,getCircleMembers:G,leaveGroup:x,deleteCircle:H,addMembers:$,removeMember:Y,removeMembers:K,toggleMembership:j,redirectHome:y,getMemberResult:B,getSingleCircleInfo:U}}angular.module("ringid.shared").service("imageHttpService",imageHttpService),imageHttpService.$inject=["$$q","settings","$$connector","OPERATION_TYPES"];function imageHttpService(e,t,n,r){var i=this,o=r.SYSTEM.REQUEST_TYPE,a=r.SYSTEM.IMAGE;i.fetchAlbumList=function(e){var t={};e?(t.actn=a.FETCH_FRIEND_ALBUM_LIST,t.fndId=e):t.actn=a.FETCH_ALBUM_LIST,n.send(t,o.REQUEST)},i.getAlbumImages=function(e){var t={};e.fndId?(t.actn=a.TYPE_FRIEND_ALBUM_IMAGES,t.fndId=e.fndId):t.actn=a.TYPE_ALBUM_IMAGES,t.st=e.st||0,t.albId=e.albId,n.send(t,o.REQUEST,!0)},i.deleteImage=function(e){return n.request({actn:a.DELETE_IMAGE,imgIds:[e]},o.UPDATE)},i.getImageDetails=function(e){return n.request({actn:a.TYPE_IMAGE_DETAILS,imgId:e},o.REQUEST)},i.getProfilePicORCoverPicImageDetails=function(t){var n=e.defer();return i.go({actn:a.GET_CP_OR_PP_DETAIL,type:t.type}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i.getFeedImages=function(e){var t={actn:r.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e};return n.request(t,o.REQUEST)}}angular.module("ringid.shared").factory("AlbumFactory",AlbumFactory),AlbumFactory.$inject=["$$q","settings","Auth","$$albumMap","$$imageMap","$$stackedMap","$$connector","OPERATION_TYPES","imageHttpService","Ringalert"];function AlbumFactory(e,t,n,r,i,o,a,s,c,l){var u={imagesLoading:!1,albumsLoading:!1},d=s.SYSTEM.IMAGE,g=o.createNew(),m=o.createNew();function f(e,t){var n,i,o;switch(e.actn){case d.TYPE_ALBUM_IMAGES:e.sucs===!0?g.get(e.albId)?g.get(e.albId).pushImages(e):(n=new r(e),g.save(n.getKey(),n)):e.sucs===!1&&1111===e.rc;break;case d.TYPE_FRIEND_ALBUM_IMAGES:e.sucs===!0&&(m.get(e.albId)?m.get(e.albId).pushImages(e):(n=new r(e),m.save(n.getKey(),n)));break;case d.FETCH_FRIEND_ALBUM_LIST:if(e.sucs===!0)for(i=0,o=e.albumList.length;i<o;i++)n=new r(e.albumList[i],t),m.save(n.getKey(),n);break;case d.FETCH_ALBUM_LIST:if(e.sucs===!0)for(i=0,o=e.albumList.length;i<o;i++)n=new r(e.albumList[i],t),g.save(n.getKey(),n)}}function E(e,t){var r=!1,i=0;if(n.currentUser().getKey()===t){if(i=g.get(e)?g.get(e).getImages().length():0,0!==i&&i>=g.get(e).getTotalImageCount())return}else if(r=t,i=m.get(e)?m.get(e).getImages().length():0,0!==i&&i>=m.get(e).getTotalImageCount())return;c.getAlbumImages({fndId:r,albId:e,st:i})}function p(e){var t=!1;n.currentUser().getKey()!==e&&(t=e),c.fetchAlbumList(t)}return{processResponse:f,state:u,resetAlbums:function(e){e?g.reset():m.reset()},deleteImage:function(e){return c.deleteImage(e.getKey())},getAlbums:function(e){return n.currentUser().getKey()===e?g:m},loadMoreImage:E,fetchAllAlbums:p,getFeedImages:c.getFeedImages,getImageDetails:function(t,n){var r=e.defer();return c.getImageDetails(t).then(function(e){e.sucs===!0?(n&&!e.nfId&&(e.nfId=n),r.resolve(i(e))):l.show(e,"error")},function(e){r.reject()}),r.promise}}}angular.module("ringid.shared").service("mediaHttpService",mediaHttpService),mediaHttpService.$inject=["OPERATION_TYPES","$$connector"];function mediaHttpService(e,t){var n=this,r=e.SYSTEM.MEDIA,i=e.SYSTEM.REQUEST_TYPE;n.fetchMediaAlbums=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_LIST,mdaT:e.mdaT||1,utId:e.utId};t.send(n,i.REQUEST,!0)},n.fetchHashtagSuggestion=function(e){return t.pull({actn:r.ACTION_GET_HASHTAG_SUGGESTION,schPm:e.utf8Encode()},i.REQUEST)},n.fetchSearchResult=function(e){var n={actn:r.ACTION_MEDIA_SEARCH_RESULT,schPm:e.utf8Encode()};return t.pull(n,i.REQUEST)},n.fetchContent=function(e){var n={actn:r.ACTION_SPECIFIC_MEDIA_RESULT,schPm:e.sk.utf8Encode(),sugt:e.sugt,pvtid:e.pvtid||0,scl:e.scl||1};return t.send(n,i.REQUEST)},n.fetchAlbumDetails=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_DETAILS,albId:e};return t.request(n,i.REQUEST)},n.addMediaAlbum=function(e){var n={actn:r.ACTION_ADD_MEDIA_ALBUM,imgURL:e.imgURL||"",albn:e.albn.utf8Encode(),mdaT:e.mdaT};return t.request(n,i.UPDATE)},n.updateMediaAlbum=function(e){var n={actn:r.ACTION_UPDATE_MEDIA_ALBUM,albId:e.albId,imgURL:e.imgURL,mdaT:e.mdaT,albn:e.albn.utf8Encode()};return t.request(n,i.UPDATE)},n.deleteAlbum=function(e){var n={actn:r.ACTION_DELETE_MEDIA_ALBUM,albId:e};return t.request(n,i.UPDATE)},n.fetchAlbumContents=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId,utId:e.utId,st:e.st||0};t.send(n,i.REQUEST)},n.fetchAlbumContentsForpopup=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId||e.id,utId:e.utId,st:e.st||0};return t.pull(n,i.REQUEST)},n.addMediaToAlbum=function(e){var n={actn:r.ACTION_ADD_MEDIA_CONTENT,albId:e.albId,mdaLst:e.mdaLst,mdaT:e.mdaT};return t.request(n,i.UPDATE)},n.updateMediaAlbum=function(e){var n={actn:r.ACTION_UPDATE_MEDIA_CONTENT,mdaCntntDTO:e.mdaCntntDTO};return t.request(n,i.UPDATE)},n.deleteAlbumContent=function(e){var n={actn:r.ACTION_DELETE_MEDIA_CONTENT,cntntId:e};return t.request(n,i.UPDATE)},n.increaseViewCount=function(e,n){var o={actn:r.ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT,cntntId:e};return n&&(o.nfId=n),t.request(o,i.UPDATE)},n.getSearchTrends=function(){var e={actn:281};return t.pull(e,i.REQUEST)},n.getTaggedMedia=function(e){var n={actn:r.ACTION_GET_TAGGED_MEDIA_SONGS,htid:e,pvtid:0,scl:2};return t.send(n,i.REQUEST)},n.fetchSliderImage=function(e){var n={actn:r.ACTION_GET_MEDIA_SLIDER_IMG,mdaT:e.mdaT};return t.pull(n,i.REQUEST,!0)}}angular.module("ringid.shared").factory("Media",MediaFactory),MediaFactory.$inject=["mapFilterFilter","Utils","Ringalert","userFactory","Auth","$routeParams","Storage","OPERATION_TYPES","APP_CONSTANTS","mediaHttpService","$$mediaAlbumMap","$$mediaMap","$$stackedMap","$$q","$$connector","SystemEvents","$rootScope"];function MediaFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){var T,h,_={albumsLoading:!1,contentsLoading:!1,noresultfound:!1},I=!1,A=g.createNew(),v=g.createNew(),S=g.createNew(),C=g.createNew(),D=g.createNew(),M=0,y=s.SYSTEM.MEDIA,N=s.SYSTEM.REQUEST_TYPE,b=c,O=[],P=[],R=[];function U(e){var t,n,o,a;switch(e.actn){case y.ACTION_MEDIA_ALBUM_LIST:if(e.sucs===!0&&e.mediaAlbumList)for(T=i.currentUser().getUtId()===e.utId?i.currentUser():r.create({utId:e.utId}),n=0,o=e.mediaAlbumList.length;n<o;n++)a=e.mediaAlbumList[n].albId||e.mediaAlbumList[n].id,t=A.get(a)||v.get(a),t?t.updateAlbum(e.mediaAlbumList[n]):t=u.createAlbum(e.mediaAlbumList[n],T),T&&T.isCurrentUser()?A.save(t.getKey(),t):v.save(t.getKey(),t);break;case y.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(e.sucs===!0&&e.mdaCntntLst){var s=u.createKey(e);t=A.get(s)||v.get(s),t&&t.pushContent(e.mdaCntntLst)}}}function L(e,t){switch(M=e||!!i.currentUser()&&i.currentUser().getUtId(),t){case"audio":l.fetchMediaAlbums({utId:M,mdaT:b.NEWS_FEED_MEDIA_TYPE_AUDIO});break;case"video":setTimeout(function(){l.fetchMediaAlbums({utId:M,mdaT:b.NEWS_FEED_MEDIA_TYPE_VIDEO})},500);break;default:l.fetchMediaAlbums({utId:M,mdaT:b.NEWS_FEED_MEDIA_TYPE_AUDIO}),setTimeout(function(){l.fetchMediaAlbums({utId:M,mdaT:b.NEWS_FEED_MEDIA_TYPE_VIDEO})},500)}}function F(e){return e=parseInt(e),A.get(e)||v.get(e)||S.get(e)}h=f.subscribe(U,{action:[y.ACTION_MEDIA_ALBUM_LIST,y.ACTION_MEDIA_SEARCH_RESULT]});function w(){return!I&&(I=!0,L(),!0)}function k(e,t){switch(e){case"mediaInAlbums":return f.request({actn:y.ACTION_CHECK_MEDIA_IN_ALBUMS,strmURL:t.strmURL},N.REQUEST)}}return{init:w,state:_,processResponse:U,getAlbum:F,resetMediaAlbums:function(){v.reset()},getUserAlbums:function(t){return t?e(v.all(),{mapApi:"getType",value:t,compare:"regex"}):v},getAlbums:function(t,n){var r=t?A:v;return n?e(r.all(),{mapApi:"getType",value:n,compare:"regex"}):r},getSearchedSongs:function(){return D},getSearchedAlbums:function(){return C},getContentIdArray:function(){return P},resetContentIdArray:function(){P=[]},getAlbumIdArray:function(){return R},resetAlbumIdArray:function(){R=[]},getSearchedTagArr:function(){return O},resetSearchedSongs:function(){return D.reset()},resetSearchedAlbum:function(){return C.reset()},resetSearchedTagArr:function(){O=[]},fetchAllAlbums:L,createAlbum:function(e,n){var r,o;return n&&(e.id=t.getUniqueID(),o=m.defer()),n&&l.addMediaAlbum(e).then(function(t){t.sucs===!0?(r=u.createAlbum(angular.extend(e,{id:t.albId}),i.currentUser()),A.save(r.getKey(),r),o.resolve(r)):o.reject(!1)},function(){o.reject(!1)}),n?o.promise:r},deleteAlbum:function(e){l.deleteAlbum(e.getId()).then(function(t){t.sucs===!0&&A.remove(e.getKey())})},fetchAlbumContents:l.fetchAlbumContents,fetchAlbumContentsForpopup:l.fetchAlbumContentsForpopup,getSearchTrends:function(){return l.getSearchTrends()},getTaggedMedia:function(e){l.getTaggedMedia(e)},fetchSearchResult:function(e){return l.fetchSearchResult(e)},fetchSliderImage:function(e){return l.fetchSliderImage(e)},fetchHashtagSuggestion:l.fetchHashtagSuggestion,fetchContent:function(e){return _.noresultfound=!1,l.fetchContent(e)},makeApiCall:k}}angular.module("ringid.shared").factory("EmotionFactory",["$$connector","settings","OPERATION_TYPES",function(e,t,n){var r={},i=n.SYSTEM,o=0,a={};function s(e){return{id:e.id,title:e.nm,nm:e.nm,url:t.emotionServer+e.url,cat:e.cat}}function c(e){var t;if(e.sucs&&e.mdLst.length)for(t=0;t<e.mdLst.length;t++)r[e.mdLst[t].id]=s(e.mdLst[t]),o++;u()}e.subscribe(c,{action:i.FETCH_EMOTION_LIST});function l(){var e=[];for(var t in r)r.hasOwnProperty(t)&&e.push(r[t]);return e}function u(){var e;for(var t in a)e=a[t],e&&e.$id&&!e.$$destroyed&&e.setEmotion.call(e,l())}function d(){o?u():e.send({actn:i.FETCH_EMOTION_LIST},i.REQUEST_TYPE.REQUEST)}return{init:d,getEmotions:l,getLength:function(){return o},getEmotion:function(e,t){var n=angular.isObject(e)?e.id:e;return t?r[n]?r[n]:!!angular.isObject(e)&&s(e):r[n]||!1},setScopeForDigest:function(e){a[e.$id]=e},removeScope:function(e){a[e.$id]&&(a[e.$id]=null)}}}]),angular.module("ringid.shared").factory("feedFactory",feedFactory),feedFactory.$inject=["fileUploadService","$$connector","$$q","$$stackedMap","$$feedMap","Utils","OPERATION_TYPES","APP_CONSTANTS","Ringalert","Auth","MIN_TIMESTAMP","$rootScope","SystemEvents"];function feedFactory(e,t,n,r,i,o,a,s,c,l,u,d,g){var m=a.SYSTEM,f=s,E=m.TYPE_NEWS_FEED+".all",p=0,T={},h=[],_=!1,I=[],A={},v={};return A[m.TYPE_NEWS_FEED]=ee,A[m.TYPE_MY_NEWS_FEED]=ee,A[m.TYPE_FRIEND_NEWSFEED]=ee,A[m.TYPE_GROUP_NEWS_FEED]=ee,A[m.TYPE_MEDIAS_NEWS_FEED]=ee,A[m.TYPE_NEWS_PORTAL_FEED]=ee,A[m.TYPE_BUSINESS_PAGE_FEED]=ee,A[m.TYPE_UPDATE_ADD_STATUS]=ge,A[m.ACTION_UPDATE_SHARE_STATUS]=de,A[m.TYPE_UPDATE_DELETE_STATUS]=ue,A[m.TYPE_UPDATE_EDIT_STATUS]=le,A[m.TYPE_UPDATE_LIKE_STATUS]=le,A[m.TYPE_UPDATE_UNLIKE_STATUS]=le,A[m.TYPE_UPDATE_ADD_STATUS_COMMENT]=le,A[m.TYPE_UPDATE_DELETE_STATUS_COMMENT]=le,{init:N,addScope:function(e,t){v[e]=t},removeScope:function(e){v[e]&&delete v[e]},getFeed:fe,updateTime:y,pushFeed:ee,processIncomingFeed:te,setpushInIncomingFeed:function(e){_=!!e},getPushIncomingFeed:function(){return _},hasUnprocessedFeed:function(){return h.length},addIgnoreFilter:Ee,removeIgnoreFilter:pe,setFactoryKey:Te,createFeed:R,process:he,getFeedFilter:_e,noMoreFeed:ve,requestForFeed:Se,initFeedRequest:Ce,getSingleFeed:Me,requestForMoreFeed:De,getRawFeeds:Ie,getFeeds:Ae,addFeed:Ne,shareFeed:be,deleteFeed:Oe,saveFeed:Pe,updateFeed:Re,reset:b,moreFeedText:Ue,getSingleFeedPageKey:Fe,getWhoShareFeedId:we,getTagUsers:Le,setSortBy:S,getCurrentPageValue:M,hasSpecialFeed:function(){var e=M();return m.TYPE_NEWS_FEED===e.action&&T.special&&T.special.length()>0},getSpecialFeedList:function(){return T.special&&T.special.all()},synchLike:se,synchComment:ce,getPortalFeedDetails:ye};function S(e){i.setSortKey(e)}function C(){return T.hasOwnProperty(E)?T[E].data:r.createNew()}function D(){return T.hasOwnProperty(E)?T[E].removed:r.createNew()}function M(){var e=[];try{e=E.split(".",3)}catch(e){return!1}return!(e.length<2)&&{action:parseInt(e[0]),page:e[1],ptype:e[2]}}function y(){for(var e=C(),t=0;t<e.length();t++){var n=Date.now()-e.all()[t].value.getTimestamp();n<36e5&&e.all()[t].value.updateTime()}}function N(e){var t=C();return t.length()<10&&(Se(e),!0)}function b(){C().reset(),D().reset(),h.length=0}function O(){var e=i.getSortIndex(),t=C();if("tm"===e)return t.length()?t.top().getTimestamp():u;var n=t.length()?t.top().getAtTime():u;return n}function P(){var e=i.getSortIndex(),t=C();if("tm"===e)return t.length()?t.bottom().getTimestamp():Date.now();var n=t.length()?t.bottom().getAtTime():Date.now();return n}function R(e,t){return i.create(e,t)}function U(){return!0}function L(e,t){return e.nfId==t.page||e.whShrLst&&e.whShrLst[0].nfId==t.page}function F(e,t){return!!e.grpId&&e.grpId==t.page}function w(e,t,n){return t.action===n}function k(e,t,n){return t.action===n}function $(e,t){return t||(t=M()),!!(t.page===e.uId||e.fndId&&t.page===e.fndId)}function G(e,t,n){return t.action===n}function B(e,t){return t||(t=M()),!!(t.page===e.uId||e.fndId&&t.page===e.fndId)}function x(e,t){return t||(t=M()),!!(t.page===e.uId||e.fndId&&t.page===e.fndId)||!(!e.orgFd||t.page!==e.orgFd.uId)}function H(e){Y(e)}function Y(e){X(e,x,{processWhoShare:function(e,t,n){var r,i;e.uId===n.page&&e.orgFd&&(i=R(e.orgFd),r=R(e),r.shares(i),t.save(r.getMapKey(),r))}})}function K(e){X(e,$)}function j(e){X(e,F)}function V(e){X(e,w)}function W(e){X(e,k)}function q(e){X(e,G)}function z(e){X(e,U)}function Q(e){var t;T.special||(T.special=r.createNew(i.getSortIndex(),"desc")),t=R(e),T.special.save(t.getMapKey(),t)}function X(e,t,n){n=n||{},angular.isFunction(t)||(t=function(){return!0});var r=angular.isArray(e)?e:e.newsFeedList;if(angular.isArray(r))for(var i,o,a,s,c=M(),l=C(),u=0;u<r.length;u++)a=r[u],s=a.nfId,0==p?p=s:s<p&&(p=s),1!=a.fc?t(a,c,e.actn)&&(a.deleted?deleteFromIndexedFeed(a.nfId):a.whShrLst||a.orgFd?n.processWhoShare&&angular.isFunction(n.processWhoShare)?n.processWhoShare.call(null,a,l,c):(a.orgFd?(i=R(a),(o=ie(a.orgFd.nfId))||(o=R(a.orgFd))):(i=R(a.whShrLst[0]),(o=ie(a.nfId))||(o=R(a))),i.shares(o),l.save(i.getMapKey(),i),ne(o,i.getKey())):(i=R(a),l.save(i.getMapKey(),i))):Q(r[u])}function Z(e){X(e,L)}function J(e){switch(e||(e=M()),e.action){case m.TYPE_MY_NEWS_FEED:case m.TYPE_FRIEND_NEWSFEED:return 3==e.ptype?$:4==e.ptype?B:x;case m.TYPE_GROUP_NEWS_FEED:return F;case m.TYPE_MEDIAS_NEWS_FEED:return w;case m.TYPE_NEWS_PORTAL_FEED:return k;case m.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:return L;case m.TYPE_BUSINESS_PAGE_FEED:return G;case m.TYPE_NEWS_FEED:default:return U}}function ee(e){var t=M();switch(t.action){case m.TYPE_MY_NEWS_FEED:Y(e);break;case m.TYPE_FRIEND_NEWSFEED:3==t.ptype?K(e):H(e);break;case m.TYPE_GROUP_NEWS_FEED:j(e);break;case m.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:Z(e);break;case m.TYPE_NEWS_FEED:z(e);break;case m.TYPE_MEDIAS_NEWS_FEED:V(e);break;case m.TYPE_NEWS_PORTAL_FEED:W(e);break;case m.TYPE_BUSINESS_PAGE_FEED:q(e)}}function te(){for(var e;h.length&&_;)e=h.shift(),e.callback?e.callback.call(null,e,!0):ee([e])}function ne(e,t,n){n||(n=D()),e.reference=t,n.save(e.getMapKey(),e)}function re(e,t){return t||(t=D()),e=i.getPrefix()+e,t.get(e)}function ie(e){var t;return t=C(),e=i.getPrefix()+e,t.get(e)}function oe(e){var t=C();t.add(e.getMapKey(),e)}function ae(e,t){return t||(t=C()),t.remove(i.makeKey(e))}function se(e,t,n){if(e){var r=fe(e);return r&&r.isSingleContentFeed()?(r.setTotalLikes(n,t),v[e]):void 0}}function ce(e,t,n){if(e){var r=v[e];return r&&r.feed.isSingleContentFeed()?(r.feed.setTotalComment(t,n),r):void 0}}function le(e){var t=ie(e.nfId),n=v[e.nfId];if(t&&n){switch(e.actn){case m.TYPE_UPDATE_EDIT_STATUS:t.update(e);break;case m.TYPE_UPDATE_LIKE_STATUS:case m.TYPE_UPDATE_UNLIKE_STATUS:t.setTotalLikes(e.loc),t.setFeedTopMessage();break;case m.TYPE_UPDATE_ADD_STATUS_COMMENT:case m.TYPE_UPDATE_DELETE_STATUS_COMMENT:t.setTotalComment(e.loc),t.setFeedTopMessage()}return n}}function ue(e){ae(e.nfId)}function de(e,t,n,r){if(_&&!t){e.callback=de;var i=J();return void(i.call(null,e.newsFeed)&&h.push(e))}var o=e.newsFeed.orgFd&&e.newsFeed.orgFd.nfId;if(o){var a=ie(o),s=D();if(a){if(n)return a.setActivity(e.newsFeed.orgFd),v[a.getKey()];ne(a,e.newsFeed.nfId,s),ae(a.getKey())}else if(a=re(o,s)){var i=J();return void X([e.newsFeed],i,{processWhoShare:function(e,t,i){var o,s=ie(a.reference);if(!s)return void ee([e]);if(i.page!=m.TYPE_FRIEND_NEWSFEED&&i.page!=m.TYPE_MY_NEWS_FEED){if(a.update(e,!0),n)return a.addShareUser(r),s.updateShareMessage(),s.setActivity(e),v[s.getKey()];o=R(e),o.setActivity(e.orgFd),ae(a.reference),o.shares(a),t.save(o.getMapKey(),o)}}})}ee([e.newsFeed])}}function ge(e){if(e.imageList||1!==e.type||(e.imageList=[e]),_){var t=J();t.call(null,e,M())&&h.push(e)}else ee([e])}function me(e){var t,n=!1,r=angular.isArray(e)?e[0]:e;if(I.length)for(t=0;t<I.length;t++)I[t].action===r.actn&&(n=I[t].callback.call(null,r));if(A[r.actn]&&!n)return A[r.actn].call(null,r)}function fe(e){return ie(e)}function Ee(e,t){var n=o.getUniqueID();return I.push({key:n,action:e,callback:t}),n}function pe(e){for(var t=-1,n=0;n<I.length;n++)I[n].key===e&&(t=n);return t!=-1?I.splice(t,1):[]}function Te(e){E=e,T.hasOwnProperty(E)||(T[E]={data:r.createNew(i.getSortIndex(),"desc"),removed:r.createNew(),no_more_feed:!1})}function he(e){return me(e)}function _e(){return function(e){return!!A[e.actn]}}function Ie(){return C().all()}function Ae(){var e=C();return e.all()}function ve(){return!!T.hasOwnProperty(E)&&T[E].no_more_feed}function Se(e){var n=f.FEED_LIMIT;switch(e=angular.copy(e||{}),e.pvtid=p||0,e.st=Ae().length||0,o.feedColumn()){case 1:n=5;break;case 2:n=6;break;case 3:n=9}return e.lmt=e.lmt||n,t.send(e,m.REQUEST_TYPE.REQUEST)}function Ce(e){e=angular.copy(e||{}),e.scl=2,e.tm=0,Se(e)}function De(e,t){var n=O();return e=angular.copy(e||{}),e.scl=t||2,e.tm=n?n:u,Se(e)}function Me(e,r){var i={actn:m.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e},o=n.defer(),a=fe(e);return a?o.resolve(a):t.request(i,m.REQUEST_TYPE.REQUEST).then(function(e){if(e.sucs===!0){var t=angular.isArray(e)?e:e.newsFeedList[0];if(r&&t.orgFd){if(t.orgFd){a=R(t);var n=R(t.orgFd);a.shares(n)}}else a=R(t);if(a){var i=C();i.save(a.getMapKey(),a)}o.resolve(a)}else o.resolve(!1)},function(e){o.reject(e)}),o.promise}function ye(e){var r,i,o;return r={actn:m.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e},i=n.defer(),t.request(r,m.REQUEST_TYPE.REQUEST).then(function(e){e.sucs===!0?(o=e.newsFeedList[0],i.resolve(o)):i.resolve(!1)},function(e){i.reject(e)}),i.promise}function Ne(r,i,a){var s,l=n.defer(),u=0,E=C(),p=o.getUniqueID();r.stsTags=[];var T="",T="";r.text&&(T=r.text.replace(/##([\d]+)##/g,function(e,t,n){var i;return i=n-u,r.stsTags.push({pstn:i,utId:t}),u+=e.length,""}),r.text=T),a?s=r.feed?r.feed:fe(r.nfId):(s=R({nfId:p,fpvc:r.fpvc,sts:r.text,lat:r.lat||9999,lng:r.lng||9999,tm:P()+2,grpId:r.group||"",friendId:r.friend||"",fndId:r.friend||"",mdLst:r.mdIds||[],isNew:1,pending:!0,lctn:r.lctn||"",lnkDmn:r.lnkDmn||"",lnkDsc:r.lnkDsc||"",lnkTtl:r.lnkTtl||"",lnkURL:r.lnkURL||"",lnlImgURL:r.lnlImgURL||""},i),E.save(s.getMapKey(),s));var h={};if(r.cntntIDLst&&(h.cntntIDLst=r.cntntIDLst),r.group&&(h.grpId=r.group),r.friend&&(h.fndId=parseInt(r.friend)),r.lctn&&(h.lctn=r.lctn.utf8Encode()),r.lnkDmn&&(h.lnkDmn=r.lnkDmn.utf8Encode()),r.lnkDsc&&(h.lnkDsc=r.lnkDsc.utf8Encode()),r.lnkTtl&&(h.lnkTtl=r.lnkTtl.utf8Encode()),r.lnkURL&&(h.lnkURL=r.lnkURL.utf8Encode()),r.lnlImgURL&&(h.lnlImgURL=r.lnlImgURL.utf8Encode()),r.stsTags.length&&(h.stsTags=r.stsTags),h.actn=m.TYPE_ADD_STATUS,r.images&&r.images.length>0)if(1===r.images.length)h.type=m.NEWS_FEED_TYPE_IMAGE,h=angular.extend({},h,r.images[0].getAuthData());else{h.actn=m.TYPE_ADD_MULTI_IMAGE,h.type=m.NEWS_FEED_TYPE_MULTIPLE_IMAGE,h.imageList=[];for(var _=0,I=r.images.length;_<I;_++)h.imageList.push(r.images[_].getAuthData())}else if(r.videos&&r.videos.length>0){h.mdaCntntDTO={albId:e.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:f.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:f.NEWS_FEED_MEDIA_TYPE_VIDEO},h.type=m.NEWS_FEED_TYPE_VIDEO;for(var _=0,I=r.videos.length;_<I;_++)h.mdaCntntDTO.mdaLst.push(r.videos[_].getAuthData(!0)),0===_&&(h.mdaCntntDTO.htgLst=h.mdaCntntDTO.mdaLst[0].htgLst)}else if(r.audios&&r.audios.length>0){h.mdaCntntDTO={albId:e.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:f.NEWS_FEED_MEDIA_TYPE_AUDIO,lnkT:f.NEWS_FEED_MEDIA_TYPE_AUDIO},h.type=m.NEWS_FEED_TYPE_AUDIO;for(var _=0,I=r.audios.length;_<I;_++)h.mdaCntntDTO.mdaLst.push(r.audios[_].getAuthData(!0)),0===_&&(h.mdaCntntDTO.htgLst=h.mdaCntntDTO.mdaLst[0].htgLst)}else h.actn=m.TYPE_ADD_STATUS,a?h.type=r.audio?m.NEWS_FEED_TYPE_AUDIO:m.NEWS_FEED_TYPE_VIDEO:h.type=m.NEWS_FEED_TYPE_STATUS;return r.mdIds&&(h.mdIds=r.mdIds),r.tFrndIds&&(h.tFrndIds=r.tFrndIds),h.vldt=r.vldt||"-1",h.lng=r.lng||9999,h.lat=r.lat||9999,h.sts=r.text.utf8Encode(),h.fpvc=r.fpvc||2,t.request(h,m.REQUEST_TYPE.UPDATE).then(function(e){d.$broadcast(g.FILE_UPLOAD.UPLOADS_POSTED),e.sucs?(a?s&&s.share(e.mdaCntntLst[0].is,e.mdaCntntLst[0].ns):(E.remove(s.getMapKey()),e.type===m.TYPE_SINGLE_IMAGE_STATUS&&(e.imageList=[e]),ee([e])),l.resolve(e)):(a||(E.remove(s.getMapKey()),c.show(e,"error")),l.reject(e))},function(e){a||(E.remove(s.getMapKey()),c.show(json,"error")),l.reject(json)}),l.promise}function be(e){if(e.addShare)return Ne(e,e.user,!0);var r=n.defer(),i={actn:m.ACTION_SHARE_STATUS,sfId:e.feed.getKey(),type:2,sts:e.text.utf8Encode()};return e.mdIds&&(i.mdIds=e.mdIds),e.tFrndIds&&(i.tFrndIds=e.tFrndIds),e.location&&(e.location.description&&(i.lctn=e.location.description.utf8Encode()),e.location.lat&&(i.lat=e.location.lat,i.lng=e.location.lng)),t.request(i,m.REQUEST_TYPE.UPDATE).then(function(t){t.sucs?(de(t,!0,!0,l.currentUser()),e.feed.share(!0),r.resolve(t)):r.reject(t)},function(e){r.reject(e)}),r.promise}function Oe(e,r){var i=n.defer(),o=ie(r),a=C();return o?(o.user().isCurrentUser(e.getKey())||setTimeout(function(){i.reject("You are not authorized to delete this feed.")},100),o!==!1?(ae(o.getKey(),a),t.request({actn:m.TYPE_DELETE_STATUS,nfId:r},m.REQUEST_TYPE.UPDATE).then(function(e){e.sucs?i.resolve(e):(oe(o),i.reject(e))},function(e){oe(o),i.reject(e)})):setTimeout(function(){i.reject("Feed Not Found!")},100),i.promise):(setTimeout(function(){i.reject("Can't Delete Invalid Feed")}),i.promise)}function Pe(e,n,r){var i={actn:m.PORTAL.ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED,optn:n,pType:r,feedIdList:[e]};return t.request(i,m.REQUEST_TYPE.UPDATE)}function Re(e,r,i,o,a,s,c){if(angular.isObject(r)||(r=ie(d)),r&&r.user().isCurrentUser(e.getKey())){var l,u=n.defer(),d=r.getKey(),g=r.text(),f=r.getLocationInfo(),E=r.getFeelings(),p=[],T=0;i&&(l=i.replace(/##([\d]+)##/g,function(e,t,n){var r;return r=n-T,p.push({pstn:r,utId:t}),T+=e.length,""}),i=l);var h={actn:m.TYPE_EDIT_STATUS,nfId:d,sts:i.utf8Encode()};p.length&&(h.stsTags=p),o=o||{},h.lctn=o.description?o.description.utf8Encode():"",h.lat=o.lat||9999,h.lng=o.lng||9999;var _=a&&(!r.hasOgData()||r.getLinkUrl()!=a.url||r.getLinkImageUrl()!=a.image);_&&(h.lnkDmn=a.domain||"",h.lnkDsc=a.description?a.description.utf8Encode():"",h.lnkTtl=a.title?a.title.utf8Encode():"",h.lnkURL=a.url?a.url.utf8Encode():"",h.lnlImgURL=a.image||"");var I=!1;return s&&s.id?(h.mdIds=[s.id],I=!0):(h.mdIds=[],I=!0),c&&(c.removed&&(h.rTFrndIds=c.removed),c.new&&(h.tFrndIds=c.new)),r!==!1&&(r.setText(i,p),r.setLocationInfo(o),I&&r.setFeelings(s),_&&r.setOgData(a),t.request(h,m.REQUEST_TYPE.UPDATE).then(function(e){e.sucs===!1?(r.setText(g),r.setLocationInfo(f),I&&r.setFeelings(E),_&&r.setOgData(oldOgData),u.reject(e)):u.resolve(e);
},function(e){r.setText(g),r.setLocationInfo(f),I&&r.setFeelings(E),_&&r.setOgData(oldOgData),u.reject(e)})),u.promise}}function Ue(e){var r=n.defer(),i={actn:m.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e.getKey()};return t.request(i,m.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?r.resolve(e):(c.show(e,"error"),r.reject())},function(e){c.show(e,"error"),r.reject()}),r.promise}function Le(e){return t.pull({actn:m.TYPE_TAG_USER_LIST,nfId:e.getKey()},m.REQUEST_TYPE.REQUEST)}function Fe(e){return m.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS+"."+e}function we(e){var t=angular.isArray(e)?e:e.newsFeedList;return!!(t.length>0&&t[0].whShrLst[0])&&t[0].whShrLst[0].nfId}}angular.module("ringid.shared").factory("InviteFactory",InviteFactory),InviteFactory.$inject=["$$connector","OPERATION_TYPES","userFactory","Storage","friendsFactory","$$stackedMap","$$q"];function InviteFactory(e,t,n,r,i,o,a){var s,c=[],l=!1,u=t.SYSTEM.FRIENDS,d=t.SYSTEM.REQUEST_TYPE,g=(t.SYSTEM.PROFILE,{init:T,state:{isRequestsLoading:!1},suggestionFriends:o.createNew(),getSuggestionContactsDetails:E,removeSuggestion:p,allSuggestionFriends:o.createNew(),noOfSuggestions:function(){return g.suggestionFriends.length()}});function m(e){var t;switch(e.actn){case u.TYPE_PEOPLE_YOU_MAY_KNOW:if(e.sucs===!0){for(t=0;t<e.contactIds.length;t++)c.push(e.contactIds[t]);E()}else e.sucs===!1&&1111===e.rc&&f();break;case u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:if(g.state.isRequestsLoading=!1,e.sucs===!0)for(t=0;t<e.contactList.length;t++)c.splice(c.indexOf(e.contactList[t].utId),1),s=n.create(e.contactList[t]),s.isFriend()||g.suggestionFriends.save(s.getUtId(),s);else e.sucs===!1&&1111===e.rc&&E()}}function f(){return e.send({actn:u.TYPE_PEOPLE_YOU_MAY_KNOW},d.REQUEST)}function E(t){if(t=t||10,!g.state.isRequestsLoading)return g.state.isRequestsLoading=!0,e.send({actn:u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:c.slice(0,t)},d.REQUEST)}function p(t,n){var r=a.defer(),o={actn:33,utId:t};return e.request(o,d.REQUEST).then(function(e){e.sucs===!0&&("remove"!==n&&i.addToUtIdList("outgoingUtIds",e.utId),g.suggestionFriends.remove(t),g.suggestionFriends.length()<5&&E(),r.resolve(e))},function(e){r.reject(e)}),r.promise}function T(t){l||e.subscribe(m,{action:[u.TYPE_PEOPLE_YOU_MAY_KNOW,u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),l&&!t||(l=!0,f())}return g}angular.module("ringid.shared").factory("CommentHttpService",CommentHttpService).controller("CommentsController",CommentsController).directive("rgComments",rgComments).directive("rgImageComments",rgImageComments),CommentHttpService.$inject=["$$connector","OPERATION_TYPES"];function CommentHttpService(e,t){var n,r=t.SYSTEM;n={getComment:i,getComments:o,addComment:a,updateComment:s,deleteComment:c,getUpdateFilter:l};function i(t){var n={};switch(t.type){case"feed":n.cmntT=1,n.nfId=t.key;break;case"image":n.cmntT=2,n.imgId=t.key;break;case"media":n.cmntT=3,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.actn=r.ACTION_GET_FULL_COMMENT,n.cmnId=t.commentId,e.request(n,r.REQUEST_TYPE.REQUEST)}function o(t,n,i){var o={};if(!t.key||!t.type)throw new Error("key and type must needed for fetcing comment");switch(t.type){case"feed":o.actn=r.TYPE_COMMENTS_FOR_STATUS,o.nfId=t.key;break;case"image":o.actn=r.IMAGE.TYPE_COMMENTS_FOR_IMAGE,o.imgId=t.key,t.target.getFeedKey()&&(o.nfId=t.target.getFeedKey());break;case"media":o.actn=r.MEDIA.ACTION_MEDIA_COMMENT_LIST,o.cntntId=t.key,t.target.getFeedKey()&&(o.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n?(o.scl=i?i:1,o.tm=n):o.st=t.st||0,e.pull(o,r.REQUEST_TYPE.REQUEST,!0)}function a(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_ADD_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_ADD_IMAGE_COMMENT,n.imgId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;case"media":n.actn=r.MEDIA.ACTION_ADD_COMMENT_ON_MEDIA,n.cntntId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n.cmn=t.text.utf8Encode(),e.request(n,r.REQUEST_TYPE.UPDATE,!0)}function s(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_EDIT_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_EDIT_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_EDIT_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,n.cmn=t.text.utf8Encode(),e.request(n,r.REQUEST_TYPE.UPDATE)}function c(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_DELETE_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_DELETE_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_DELETE_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,e.request(n,r.REQUEST_TYPE.UPDATE,!0)}function l(e,t){var n,i,o=[r.TYPE_UPDATE_ADD_STATUS_COMMENT,r.TYPE_UPDATE_LIKE_COMMENT,r.TYPE_UPDATE_UNLIKE_COMMENT,r.TYPE_UPDATE_DELETE_STATUS_COMMENT,r.TYPE_UPDATE_EDIT_STATUS_COMMENT],a=[r.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT],s=[r.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT];switch(e){case"feed":n=o,i="nfId";break;case"image":n=a,i="imgId";break;case"media":n=s,i="cntntId";break;default:return[1111111]}return function(e){return n.indexOf(e.actn)!==-1&&e[i]===t}}return n}CommentsController.$inject=["$scope","$$connector","Ringalert","Utils","CommentHttpService","Auth","$$stackedMap","$$commentMap","rgDropdownService","OPERATION_TYPES","rgScrollbarService","feedFactory","SystemEvents"];function CommentsController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,f,E=l.SYSTEM,p=!1;e.comments=a.createNew(!0,"asc"),e.loadingComment=!1,e.canComment=!0,e.commentEditorEnabled=!1,e.commentKey="",e.commenttext="",e.ddCommentHtml="templates/dropdowns/comment-edit-dropdown.html",e.previousComment=!!e.target.getTotalComment(),e.afterComment=!0,e.models={commentedittext:""},e.currentUser=o.currentUser(),e.openRingboxLike=function(e){return e.getTotalLikes()>0},e.loadMoreComment=S,e.loadPreviousComment=A,e.addComment=N,e.updateComment=b,"feed"===e.commentType&&e.target.isSingleContentFeed()?(e.target.getMedias().length()||e.target.getAudios().length()?e.likeType="media":e.target.getImages(!0).length()&&(e.likeType="image"),e.parentKey=e.target.getSingleContent().getKey()):(e.likeType=e.commentType,e.parentKey=e.target.getKey()),e.hideScroll=!!e.hideScroll&&"false"!==e.hideScroll,e.showPreviousButton=function(){return e.target.getTotalComment()>e.comments.length()&&e.previousComment&&!e.loadingComment},e.showMoreButton=function(){return e.target.getTotalComment()>e.comments.length()&&e.afterComment&&!e.loadingComment},e.cancelEdit=function(){e.commentEditorEnabled=!1,T()},e.commentContentEdit=function(e){return function(){return e.getDynamicText()}},e.actionCommentDropdown=function(e){switch(c.close(e.event),e.action){case"edit":h(e.commentMap.getKey(),e.commentMap.text());break;case"delete":O(e.commentMap)}};function T(){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function h(t,n){t&&(e.commentEditorEnabled=!0,e.commentKey=t,e.models.commentedittext=n,T())}function _(t){e.loadingComment=t,f&&(window.clearTimeout(f),f=void 0)}function I(){m=t.subscribe(function(t){switch(t.actn){case E.TYPE_UPDATE_ADD_STATUS_COMMENT:case E.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT:case E.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT:y({comments:[t]});break;case E.TYPE_UPDATE_EDIT_STATUS_COMMENT:case E.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT:case E.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT:var n=e.comments.get(t.cmnId);n&&n.setComment(t.cmn);break;case E.TYPE_UPDATE_LIKE_COMMENT:case E.TYPE_UPDATE_UNLIKE_COMMENT:case E.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:case E.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:var n=e.comments.get(t.cmnId);n&&n.incomingLike(t.loc);break;case E.TYPE_UPDATE_DELETE_STATUS_COMMENT:case E.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT:case E.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT:e.comments.remove(t.cmnId)}T()},{filter:i.getUpdateFilter(e.commentType,e.target.getKey())}),e.$on("$destroy",function(){m&&t.unsubscribe(m),m=!1})}function A(t){var n,r=!1;e.comments.length()&&(n=e.comments.getByIndex(0),r=n.getTimestamp()),M(r,2,t)}function v(t){t.comments&&(t.comments.length>5&&e.target.getTotalComment()>e.comments.length()+t.comments.length?(t.comments.sort(function(e,t){return e.tm>t.tm?1:-1}),t.comments.splice(0,1),y({comments:t.comments}),e.previousComment=!0):(e.previousComment=!1,y(t)))}function S(){var t=!1;if(parseInt(e.activeCommentId)>0){var n;e.comments.length()&&(n=e.comments.getByIndex(e.comments.length()-1),t=n.getTimestamp())}M(t,1)}function C(t){t.comments&&(t.comments.length>5&&e.target.getTotalComment()>e.comments.length()+t.comments.length?(t.comments.sort(function(e,t){return e.tm<t.tm?1:-1}),t.comments.splice(0,1),y({comments:t.comments}),e.afterComment=!0):(e.afterComment=!1,y(t)))}function D(){if(parseInt(e.activeCommentId)>0){var t=e.commentType,n=e.target;"feed"===e.commentType&&e.target.isSingleContentFeed()&&(n=e.target.getSingleContent(),t=e.target.getContentType()),i.getComment({key:n.getKey(),type:t,commentId:parseInt(e.activeCommentId)}).then(function(t){t.sucs?(y({comments:[t.cmntDTO]}),S(),setTimeout(function(){A(!0)},500)):(e.activeCommentId=0,M()),T()},function(e){M()})}else M(),e.afterComment=!1}function M(t,n,r){if(e.target.getTotalComment()&&((2!==n||e.showPreviousButton())&&(1!==n||e.showMoreButton())||r)){_(!0);var o=e.commentType,a=e.target;"feed"===e.commentType&&e.target.isSingleContentFeed()&&(a=e.target.getSingleContent(),o=e.target.getContentType()),f=setTimeout(_.bind(e,!1),3e3),i.getComments({key:a.getKey(),type:o,st:e.comments.length(),target:a},t,n).then(function(t){t.sucs&&(parseInt(e.activeCommentId)?2===n?v(t):C(t):y(t)),_(!1),T(),e.$emit(g.RINGBOX.UPDATE)},function(e){},function(e){}),T()}}function y(t){var n,r;for(r=0;r<t.comments.length;r++)n=s.create(t.comments[r]),e.comments.save(n.getKey(),n)}function N(){var t,o,a=e.commenttext,c=e.target,l=e.commentType;e.canComment=!1,P()&&(t=r.getUniqueID(),o={cmnId:t,cmn:a,deleted:!1,isNew:!0,edited:!1,pending:!0},"feed"===e.commentType&&e.target.isSingleContentFeed()&&(c=e.target.getSingleContent(),l=e.target.getContentType()),e.comments.add(t,s.create(o,e.currentUser)),i.addComment({key:c.getKey(),type:l,text:a,target:c}).then(function(r){if(r.sucs===!0){e.comments.remove(t),o.cmnId=r.cmnId,o.pending=!1,angular.extend(r,o);var i=s.create(r,e.currentUser);if(e.comments.add(i.getKey(),i),e.target.setTotalComment(r.loc,1),"feed"===e.commentType&&e.target.isSingleContentFeed())c.setTotalComment(r.loc,1);else if("feed"!==e.commentType){var l=d.synchComment(e.target.getFeedKey(),r.loc,1);l&&l.$rgDigest()}e.canComment=!0,e.commenttext="",T(),u.scrollTo(e,".com-"+i.getKey()),u.recalculate(e),e.$emit(g.RINGBOX.UPDATE)}else e.comments.remove(t),e.canComment=!0,n.show(r,"error"),e.commenttext=a,T()},function(r){e.comments.remove(t),e.canComment=!0,n.show(r,"error"),e.commenttext=a,T()}),u.scrollTo(e,".com-"+t),u.recalculate(e))}function b(t){if(!t.user().isCurrentUser())return void(e.commentEditorEnabled=!1);var r=e.models.commentedittext.trim(),o=e.commentType,a=e.target,s=t.text();t.setComment(r),t.isPending(!0),"feed"===e.commentType&&e.target.isSingleContentFeed()&&(a=e.target.getSingleContent(),o=e.target.getContentType()),""!==r?(i.updateComment({key:a.getKey(),type:o,commentId:t.getKey(),text:e.models.commentedittext}).then(function(r){r.sucs||(t.setComment(s),n.show(r,"error")),t.isPending(!1),e.models.commentedittext="",T(),e.$emit(g.RINGBOX.UPDATE)},function(e){t.setComment(s),n.show(json,"error"),T()}),e.commentEditorEnabled=!1):n.show("Please write something","error"),T()}function O(t){var r=e.commentType,o=e.target;t.isPending(!0),"feed"===e.commentType&&e.target.isSingleContentFeed()&&(o=e.target.getSingleContent(),r=e.target.getContentType()),i.deleteComment({key:o.getKey(),type:r,commentId:t.getKey()}).then(function(r){if(r.sucs){if(e.comments.remove(r.cmnId),e.target.setTotalComment(r.loc,r.ic),"feed"===e.commentType&&e.target.isSingleContentFeed())o.setTotalComment(r.loc,r.ic);else if("feed"!==e.commentType){var i=d.synchComment(e.target.getFeedKey(),r.loc,r.ic);i&&i.$rgDigest()}}else t.isPending(!1),n.show(r,"error");T(),e.$emit(g.RINGBOX.UPDATE)},function(e){t.isPending(!1),n.show(e,"error"),T()}),T()}function P(){return e.commenttext.length<1?(e.commentErrorClass="inputerror",e.canComment=!0,!1):(e.commentErrorClass="",!0)}e.$watch("showCommentBox",function(t){t&&(m||I(),e.comments.length()||D())}),e.$watch("target.getKey()",function(n){p&&(m&&(t.unsubscribe(m),I(),e.comments.reset()),e.comments.length()||D()),p=!0})}function rgComments(){return{restrict:"E",controller:CommentsController,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@",hideScroll:"@"},template:'<div class="feed_comment"><div rg-scrollbar="scrollbar()" disabled="{{::hideScroll}}" ng-class="!hideScroll ? \'comm-scroll-height\':\'\'"><ul class="media-list"><li class="item b-none bd" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item com-{{::comment.getKey()}}" rg-repeat="comm in comments.all() track by comm.key" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),comment_blink: (comment.getKey() == activeCommentId)}"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><a ng-href="{{comment.user().link()}}"><img ng-src="{{ comment.user().avatar(\'thumb\')}}" alt=""></a></div><div class="comm-p"><p class="unm"><a ng-href="{{comment.user().link()}}">{{comment.user().getName()}}</a></p><p class="comment_text" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.$parent.commentEditorEnabled" placeholder="Write your comment..."></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-top-7 feed-m"><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i>{{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class="" style="position: relative"><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li></ul></div><div ng-show="loadingComment" style="text-align:center;margin-top:10px"><div class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div></div><div class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></div><div ng-if="target.getTotalComment() > comments.length()" class="divider"></div><div class="mar-top-10"><div class="comment-w" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div>'}}function rgImageComments(){return{restrict:"E",controller:CommentsController,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@"},template:'<div class="feed-comment-wrapper" style="height:calc(100% - 165px)"><div class="feed_comment" rg-scrollbar="scrollbar()"><ul class="feed-img-l"><li class="item b-none" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item pv-item com-{{::comment.getKey()}}" ng-repeat="comm in comments.all()" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),active: (comment.getKey() == activeCommentId) }"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{::comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{::comment.user().link()}}">{{::comment.user().getName()}}</a></p><p class="txt_justify" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="$parent.cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.commentEditorEnabled" placeholder="Write something...." style="width: 94%"></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="$parent.cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::commentType}}" target="comment" target-parent="target.getKey()" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-left-60"><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i> {{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class=""><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li><li ng-show="loadingComment" class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></li><li class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></li></ul></div><div class="pv-c-top"><div class="width-100-percent"><div class="pv-pro float-left"><img ng-src="{{::currentUser.avatar(\'thumb\')}}" alt=""></div><div class="comment-w" style="width:85%" ng-class="commentErrorClass"><div class="comment-editor popimgcmnt-box"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div></div>'}}angular.module("ringid.shared").factory("LikeHttpService",LikeHttpService).controller("LikeController",LikeController).controller("WhoLikeController",WhoLikeController).directive("rgLikes",rgLikes).directive("rgLikerAnchor",rgLikerAnchor).directive("rgWhoLike",rgWhoLike).directive("rgLikerButton",rgLikerButton),LikeHttpService.$inject=["$$connector","OPERATION_TYPES"];function LikeHttpService(e,t){var n,r=t.SYSTEM;n={likeUnlike:i,likeUnlikeComment:o,fetchWhoLikes:s,fetchWhoLikesComment:a};function i(t){var n={};switch(t.type){case"feed":n.actn=1===t.il?r.TYPE_LIKE_STATUS:r.TYPE_UNLIKE_STATUS;break;case"image":n.actn=r.IMAGE.TYPE_LIKE_IMAGE,n.imgId=t.target.getKey(),n.lkd=t.il;break;case"media":n.actn=r.MEDIA.ACTION_LIKE_UNLIKE_MEDIA,n.cntntId=t.target.getKey(),n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey()),e.request(n,r.REQUEST_TYPE.UPDATE)}function o(t){var n={};switch(t.type){case"feed":n.actn=t.il?r.TYPE_LIKE_COMMENT:r.TYPE_UNLIKE_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_LIKE_UNLIKE_IMAGE_COMMENT,n.imgId=t.key,n.lkd=t.il;break;case"media":n.actn=r.MEDIA.ACTION_LIKE_UNLIKE_MEDIA_COMMENT,n.cntntId=t.key,n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.cmnId=t.target.getKey(),e.request(n,r.REQUEST_TYPE.UPDATE)}function a(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_LIST_LIKES_OF_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_IMAGE_COMMENT_LIKES,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_MEDIACOMMENT_LIKE_LIST,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.st=t.st||0,n.cmnId=t.target.getKey(),e.pull(n,r.REQUEST_TYPE.REQUEST)}function s(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_LIKES_FOR_STATUS,n.nfId=t.target.getKey();break;case"image":n.actn=r.IMAGE.TYPE_LIKES_FOR_IMAGE,n.imgId=t.target.getKey();break;case"media":n.actn=r.MEDIA.ACTION_MEDIA_LIKE_LIST,n.cntntId=t.target.getKey();break;default:throw new Error("comment type not familiar")}return t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey()),n.st=t.st||0,e.pull(n,r.REQUEST_TYPE.REQUEST)}return n}WhoLikeController.$inject=["$scope","LikeHttpService","rgScrollbarService","userFactory","friendsFactory","Api","Auth"];function WhoLikeController(e,t,n,r,i,o,a){e.loading=!0,e.users=[],e.contactListAction=function(t){t.friend.isLoading()||(i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.isCurrentUser=function(e){return e.equals(a._currentUser)},e.loadmore=function(){e.loading||s()};function s(){var i,o="fetchWhoLikes";e.users.length<e.target.getTotalLikes()&&(i={target:e.target,type:e.likeType,st:e.users.length},"true"==e.likeComment&&(o="fetchWhoLikesComment",i.parentKey=e.targetOwner(),i.key=e.targetParent()),e.loading=!0,t[o](i).then(function(t){if(e.loading=!1,!t.sucs)return void e.$close();var i,o;for(i=0;i<t.likes.length;i++)o=r.createByUtId(t.likes[i],!0,!0),e.users.push(o),o.commonFriends(!0,!0).then(function(){e.$rgDigest()});n.recalculate(e),e.$rgDigest()},function(t){e.$close()},function(e){}))}s(),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:o.user.getMutualFriends(e)}}}LikeController.$inject=["$scope","LikeHttpService","Ringalert","$ringbox","feedFactory"];function LikeController(e,t,n,r,i){e.anchorCallback=angular.noop,e.buttonCallback=angular.noop;function o(t){e.target.like(!0,!!t.loc&&t.loc),n.show(t,"error"),e.anchorCallback.call(null,e.target.like()),e.buttonCallback.call(null,e.target.like()),e.$rgDigest()}e.LikeUnlike=function(){var n,r="likeUnlike";n={target:e.target,type:e.likeType},"true"==e.likeComment&&(r="likeUnlikeComment",n.parentKey=e.targetOwner(),n.key=e.targetParent()),n.il=e.target.like(!0),e.anchorCallback.call(null,n.il),e.buttonCallback.call(null,n.il),t[r](n).then(function(t){if(t.sucs){if("feed"!==e.likeType&&"true"!==e.likeComment&&t.nfId){var r=i.synchLike(t.nfId,n.il,t.loc);r&&r.$rgDigest()}}else o(t)},o),e.$rgDigest()},e.$watch("target",function(t){e.anchorCallback.call(null,t.like()),e.buttonCallback.call(null,t.like(),!0)}),e.showWhoLike=function(){if(e.target.getTotalLikes()){r.open({type:"remote",scope:e,controller:"WhoLikeController",templateUrl:"templates/home/wholikes.html"})}}}rgLikerButton.$inject=[];function rgLikerButton(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a><i class="img_sprite lc-ico"></i><b>{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</b></a>',link:function(e,t,n,r){function i(e,n){e?(t[0].firstChild.className=t[0].firstChild.className.replace("icon-like","").trim(),t[0].firstChild.className=t[0].firstChild.className.replace("icon-like-h","").trim(),t[0].firstChild.className+=" icon-like-h",n||(t[0].firstChild.innerHTML='<span class="like-ani"></span>',window.setTimeout(function(){t&&(t[0].firstChild.innerHTML="")},2e3))):(t[0].firstChild.className=t[0].firstChild.className.replace("icon-like-h","").trim(),t[0].firstChild.className=t[0].firstChild.className.replace("icon-like","").trim(),t[0].firstChild.className+=" icon-like")}e.buttonCallback=i,i(e.target.like(),!0),t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}rgLikerAnchor.$inject=[];function rgLikerAnchor(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</a>',link:function(e,t,n,r){t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}rgWhoLike.$inject=["$ringbox"];function rgWhoLike(e){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes()}}</a>',link:function(e,t,n,r){t.bind("click",e.showWhoLike),e.$on("$destroy",function(){t.unbind("click",e.showWhoLike)})}}}rgLikes.$inject=[];function rgLikes(){return{restrict:"EA",scope:{target:"=",likeType:"@",targetParent:"&",targetOwner:"&",likeComment:"@"},controller:"LikeController",template:"<rg-liker-button></rg-liker-button><rg-who-like></rg-who-like>",link:function(e,t,n){function r(e){e?t.addClass("active"):t.removeClass("active")}e.anchorCallback=r,r(e.target.like()),e.$watch("target.like()",function(){r(e.target.like()),e.buttonCallback.call(null,e.target.like(),!0)})}}}angular.module("ringid.shared").provider("$editor",EditorProvider).directive("rgEditor",rgEditor);function EditorProvider(){this.$get=["$compile","StickerEmoticonService","StickerEmoticonFactory","$sniffer","$rootScope",function(e,t,n,r,i){var o=t.getEmoticonMap(),a=n.getEmoticonPattern(),s=/<a.*?data-link="(.*?)".*?>.*?<\/a>/gi,c=r.vendorPrefix.toLowerCase(),l=!(!navigator.userAgent.match(/Trident/)||!navigator.userAgent.match(/rv[ :]11/)),u={13:{fn:"enter",action:"enter",event:"keydown"},8:{fn:"backspace",action:"backspace",event:"keydown"},32:{fn:"space",action:"space",event:"keydown"},46:{fn:"delete",action:"delete",event:"keydown"},27:{fn:"escape",action:"escape",event:"keydown"},37:{fn:"adjust",action:"left",event:"keyup"},39:{fn:"adjust",action:"right",event:"keyup"},38:{fn:"adjust",action:"up",event:"keyup"},40:{fn:"adjust",action:"down",event:"keyup"},"00":{fn:"adjust",action:"click",event:"mouseup"}};"moz"==c&&(u[8]={fn:"backspace",action:"backspace",event:"both"},u[46]={fn:"delete",action:"delete",event:"both"});var d={container:null,event:null,keyCode:0,selection:null,range:null,previousSelection:{},init:function(e,t,n,r,i){var o,a,s,c,l=!0,f=null,E=null;for(this.container=e,this.keyCode=t,this.event=n,this.selection=m.getSelection(),this.range=m.getCurrentRange(),this.action="",f=g.getFirstNode(this.container),E=this.container.lastChild,o=g.getCurrentBoundary(this.selection),o=g.getSafeBoundary(this.selection,o,t,f,E),a=0;a<i.length;a++)c=i[a],c&&(c.event==n.type||"both"==c.event)&&(u[t]&&c.action&&c.action.indexOf(u[t].action)!=-1||c.action===!1)&&c.fn.call(c.context,n,t)===!1&&(l=!1);if(i=[],l){for(u[t]&&d[u[t].fn]&&(u[t].event==n.type||"both"==u[t].event)&&(this.action=u[t].action,d[u[t].fn](o)),!u[t]&&"keydown"==n.type&&o&&d.adjust(o,!1),a=0;a<r.length;a++)s=r[a],s&&s.event==n.type&&(u[t]&&s.action==u[t].action||s.action===!1)&&s.fn.call(s.context,n,t);r=[],f=E=null}},setContainer:function(e,t){this.container=e,t&&m.intersectsNode(e)===!1&&(m.toElmentEnd(e),this.container.focus())},adjust:function(e,t){if(e){if(t="undefined"==typeof t||null===t||t,e.zws&&0==e.candidate.length&&("left"==this.action||"right"==this.action||"click"==this.action))return void(t&&this.event.preventDefault());if(!this.selection.isCollapsed&&"mouseup"==this.event.type&&this.previousSelection&&this.previousSelection.anchorNode==this.selection.anchorNode&&this.previousSelection.anchorOffset==this.selection.anchorOffset&&this.previousSelection.focusOffset==this.selection.focusOffset)return void(this.previousSelection={});if(!t&&this.selection.isCollapsed===!1){if(this.event.ctrlKey||this.event.shiftKey||this.event.metaKey)return;return void(e&&"ltr"==e.direction?m.deleteContents(e.start,e.startPos,e.end,e.endPos):e&&"rtl"==e.direction?m.deleteContents(e.end,e.endPos,e.start,e.startPos):m.deleteContents(this.range.startContainer,this.range.startOffset,this.range.endContainer,this.range.endOffset))}g.adjustCursor(this.selection,e),t&&this.event.preventDefault(),this.selection&&this.selection.anchorNode&&(this.previousSelection.anchorNode=this.selection.anchorNode,this.previousSelection.anchorOffset=this.selection.anchorOffset,this.previousSelection.focusOffset=this.selection.focusOffset)}},enter:function(e){var t,n,r,i=!1;e&&!this.selection.isCollapsed&&("ltr"==e.direction?m.deleteContents(e.start,e.startPos,e.end,e.endPos):m.deleteContents(e.end,e.endPos,e.start,e.startPos),this.range=m.getCurrentRange());try{i=document.execCommand("insertBrOnReturn",!1,!0)}catch(e){i=!1}i||(this.event.preventDefault(),this.range.deleteContents(),t=document.createElement("br"),this.range.insertNode(t),""!=this.container.style.maxHeight&&(this.container.scrollTop=this.container.scrollTop+18),m.toElmentAfter(t),n=t=r=null)},escape:function(){},backspace:function(e){if(e){var t=this.container.innerText||this.container.textContent;if(2==t.length)return void this.event.preventDefault();if("last"!=e.zwsType||e.start!==e.end||e.startPos!=e.endPos){if(e.zws&&"first"==e.zwsType&&0==e.candidate.length)return void this.event.preventDefault();var n;"ltr"==e.direction?(n=g.getNode(e.start,"prev",e.start.length-e.startPos),m.deleteContents(e.start,e.startPos,e.end,e.endPos)):(n=g.getNode(e.end,"next",e.end.length-e.endPos),m.deleteContents(e.end,e.endPos,e.start,e.startPos)),n.parent&&(n.pos="rtl"==e.direction?n.node.childNodes.length:0),m.toElementByType(n.node,n.type,n.pos),this.event.preventDefault(),n=null}}},delete:function(e){if(e){var t=this.container.innerText||this.container.textContent;if(2==t.length)return void this.event.preventDefault();if("first"!=e.zwsType||e.start!==e.end||e.startPos!=e.endPos){if(e.zws&&"last"==e.zwsType&&0==e.candidate.length)return void this.event.preventDefault();var n;this.selection.isCollapsed||"ltr"==e.direction?(n=g.getNode(e.start,"next",e.start.length-e.startPos),m.deleteContents(e.start,e.startPos,e.end,e.endPos)):(n=g.getNode(e.end,"prev",e.end.length-e.endPos),m.deleteContents(e.end,e.endPos,e.start,e.startPos)),n.parent&&(n.pos=this.selection.isCollapsed||"ltr"==e.direction?n.node.childNodes.length:0),m.toElementByType(n.node,n.type,n.pos),this.event.preventDefault(),n=null}}},space:function(){var e,t="";if(t=g.findCurrentWord(null,this.container),t&&(t=t.replace(/\u200B|\n/g,"")),o[t]){var e=!("ms"!=c||!g.isEditorTag(this.range.endContainer)||3!=this.range.endContainer.childNodes[this.range.endOffset].nodeType||"8203"!=this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0));if(e){var n=this.range.endContainer.childNodes[this.range.endOffset-1];this.range.setStart(n,n.length),this.range.setEnd(n,n.length),n=null}this.range.setStart(this.range.startContainer,this.range.endOffset-t.length),this.range.deleteContents(),
this.addEmoticon(t,!0),this.event.preventDefault()}},addEmoticon:function(e,t){var n,r,i,o;if(this.range=m.getCurrentRange(),r=g.parseText(e),t&&""==r.replace(s,"")&&(r+=String.fromCharCode(32)),g.removeClass(this.container),m.insertHtml(r),o=this.container.querySelectorAll(".caret"),o=Array.prototype.slice.call(o),this.selection&&(i=this.selection.focusNode),i&&i.nextSibling&&3==i.nextSibling.nodeType&&1==i.nextSibling.length&&10==i.nextSibling.nodeValue.charCodeAt(0)&&i.nextSibling.parentNode.removeChild(i.nextSibling),i&&3==i.nodeType&&10==i.nodeValue.charCodeAt(i.nodeValue.length-1)&&(i.nodeValue=i.nodeValue.replace(/\u200B|\n/g,"")),!i&&o.length>0){var a=o[o.length-1].nextSibling.nextSibling;a&&3==a.nodeType&&1==a.length&&10==a.nodeValue.charCodeAt(0)&&a.parentNode.removeChild(a),a=null}o.length>0?(i=o[o.length-1],i.nextSibling&&3==i.nextSibling.nodeType?m.toElementByType(i.nextSibling,"pos",1):m.toElmentAfter(i)):i?(n=g.getNode(i,"next",0),m.toElementByType(n.node,n.type,n.pos)):m.toElmentEnd(this.container),this.container.focus(),n=o=i=null},addTag:function(e,t){var n,r,i,o,a,s,l={};t="@"+t,3!=this.range.startContainer.nodeType&&(this.range=m.getCurrentRange()),a=this.range.collapsed?this.range.endOffset:this.range.startOffset;var u=!("ms"!=c||!g.isEditorTag(this.range.endContainer)||3!=this.range.endContainer.childNodes[this.range.endOffset].nodeType||"8203"!=this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0));if(u){a=this.range.endContainer.childNodes[this.range.endOffset-1].nodeValue.length;var d=this.range.endContainer.childNodes[this.range.endOffset-1];this.range.setStart(d,0),this.range.setEnd(d,0),d=null}if(!(a-t.length<0)){if(this.range.setStart(this.range.startContainer,a-t.length),this.range.setEnd(this.range.startContainer,a),this.range.deleteContents(),l.class="tag",l.title=e.getName().trim(),l["data-link"]=e.getUtId(),l.text=e.getName().trim(),g.removeClass(this.container),i=g.getBlockHTML(l),m.insertHtml(i),s=this.container.querySelectorAll(".caret"),s=Array.prototype.slice.call(s),o=this.selection.focusNode!==this.container&&this.selection.focusNode.nextSibling&&this.selection.focusNode.nextSibling!==this.container.lastChild?this.selection.focusNode.nextSibling:this.selection.focusNode,r=g.examineNode(o,"focus",this.selection),r.node&&"parent"==r.position&&(o=r.node),o&&o.nextSibling&&3==o.nextSibling.nodeType&&1==o.nextSibling.length&&10==o.nextSibling.nodeValue.charCodeAt(0)&&o.nextSibling.parentNode.removeChild(o.nextSibling),o&&3==o.nodeType&&10==o.nodeValue.charCodeAt(o.nodeValue.length-1)&&(o.nodeValue=o.nodeValue.replace(/\u200B|\n/g,"")),!o&&s.length>0){var d=s[s.length-1].nextSibling;d&&3==d.nodeType&&1==d.length&&10==d.nodeValue.charCodeAt(0)&&d.parentNode.removeChild(d),d=null}s.length>0?m.toElmentAfter(s[s.length-1]):o?(n=g.getNode(o,"next",0),m.toElementByType(n.node,n.type,n.pos)):m.toElmentEnd(this.container),this.container.focus(),n=s=o=null}},paste:function(e){var t,n=g.parseText(e);m.insertHtml(n),this.container.focus(),t=null}},g={examineNode:function(e,t,n){var r,i=Object.create(null),o="focus"==t?n.focusOffset:n.anchorOffset;return i.position=!1,i.length=0,i.node=null,e?(1==e.nodeType&&"true"==e.getAttribute("data-block")&&(i.node=e,i.position="self"),r=g.getNextNode(e,e.length),r&&1==r.nodeType&&"true"==r.getAttribute("data-block")&&(1==e.nodeType||3==e.nodeType&&o==e.length)&&(i.node=r,i.position="next"),r=g.getPrevNode(e,e.length),r&&1==r.nodeType&&"true"==r.getAttribute("data-block")&&(1==e.nodeType||3==e.nodeType&&0==o)&&(i.node=r,i.position="prev"),r="b"==e.parentNode.nodeName.toLowerCase()?e.parentNode.parentNode:e.parentNode,r&&1==r.nodeType&&"true"==r.getAttribute("data-block")&&(i.node=r,i.position="parent"),i.node&&(i.length=3==i.node.nodeType?i.node.nodeValue.length:0),r=null,i):i},getCurrentBoundary:function(e){var t=m.getDirection(),n=Object.create(null);return e?(n.start=e.anchorNode,n.startPos=e.anchorOffset,n.end=e.focusNode,n.endPos=e.focusOffset,n.direction=t,n):n},adjustCursor:function(e,t){e.isCollapsed?m.toElementByType(t.end,t.type,t.endPos):!e.isCollapsed&&t.isAnchorMoved?m.extendSelection(t,!1):m.extendSelection(t)},getSafeBoundary:function(e,t,n,r,i){var o,a,s,c,l=!1,d=null,m=null,f=[],E={enter:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},backspace:{focus:"prev",anchor:"next",dir:"rtl",reverse:!0,both:!0},delete:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!0},space:{focus:"next",anchor:"next",dir:"ltr",reverse:!1,both:!1},escape:{},left:{focus:"prev",anchor:"next",dir:"rtl",reverse:!1,both:!1},right:{focus:"next",anchor:"prev",dir:"ltr",reverse:!1,both:!1},up:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},down:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},click:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},any:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1}};if(o=u[n]?u[n].action:"any",""!=o&&E[o]&&E[o].hasOwnProperty("focus")){for(t.isAnchorMoved=!1,t.candidate=[],e.isCollapsed&&!E[o].both||f.push({node:e.anchorNode,type:"anchor",offset:e.anchorOffset}),f.push({node:e.focusNode,type:"focus",offset:e.focusOffset});s=f.pop();)s.node&&(a=E[o][s.type],E[o].reverse&&t.direction!=E[o].dir&&(a="next"==a?"prev":"next"),d=g.examineNode(s.node,s.type,e),"any"==o&&e.isCollapsed&&(d.length==e.focusOffset||"next"==d.position&&e.focusNode.length==e.focusOffset)&&(d.node=null),"backspace"!=o&&"click"!=o||"next"!=d.position||!e.isCollapsed||3!=e.focusNode.nodeType||e.focusNode.length!=e.focusOffset||(d.node=null),d.node&&(m=g.getNode(d.node,a,0),"focus"==s.type?(t.end=m.node,t.endPos=m.pos):(t.start=m.node,t.startPos=m.pos,t.isAnchorMoved=!0),t.type=m.type,l=!0,t.candidate.push(d.node)));return t.zws=!1,t.zwsType="","ltr"==t.direction&&t.start===r&&(0==t.startPos?(e.isCollapsed?(t.endPos=t.startPos=1,t.type=t.type?t.type:"pos"):(t.startPos=1,t.type=t.type?t.type:"pos"),l=!0):1==t.startPos&&"any"!=o&&3==t.start.nodeType&&"8203"==t.start.nodeValue.charCodeAt(0)&&e.isCollapsed&&(t.zws=!0,t.zwsType="first",l=!0)),"backspace"==o&&e.isCollapsed&&0==t.startPos&&g.getPrevNode(t.start,t.start.length)===r&&(t.zws=!0,t.zwsType="first",l=!0),"rtl"==t.direction&&t.end==r&&0==t.endPos&&(t.endPos=1,t.type=t.type?t.type:"pos",l=!0),g.isEditorTag(t.end)&&0==t.endPos&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",l=!0),g.isEditorTag(t.end)&&t.endPos==t.end.childNodes.length&&t.end.lastChild&&3==t.end.lastChild.nodeType&&"8203"==t.end.lastChild.nodeValue.charCodeAt(0)&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",l=!0),"ltr"==t.direction&&i&&t.end===i&&(c=t.end.length,c>0&&t.endPos==c?(e.isCollapsed?(t.endPos=t.startPos=c-1,t.type=t.type?t.type:"pos"):(t.endPos=c-1,t.type=t.type?t.type:"pos"),l=!0):t.endPos==c-1&&"any"!=o&&3==t.end.nodeType&&"8203"==t.end.nodeValue.charCodeAt(c-1)&&e.isCollapsed&&(t.zws=!0,t.zwsType="last",l=!0)),"delete"==o&&e.isCollapsed&&t.end.length==t.endPos&&g.getNextNode(t.end,t.endPos)===i&&(t.zws=!0,t.zwsType="last",l=!0),c=t.start.length,"rtl"==t.direction&&t.start==i&&t.startPos==c&&(t.startPos=c-1,t.type=t.type?t.type:"pos",l=!0),d=m=f=r=i=s=null,!!l&&t}},parseText:function(e){return e=e.replace(a,function(e){var t=[];return t.class="em_list "+o[e].replace(/\.[A-Za-z]{3}/,""),t.title=e,t["data-link"]=e,t.text="<b>"+e.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</b>&nbsp;",g.getBlockHTML(t)})},removeClass:function(e){if(e){var t,n=e.querySelectorAll(".caret");for(t=0;t<n.length;t++)n[t].className=n[t].className.replace("caret","").trim();n=null}},adjustMarkup:function(e){if(e){var t,n=e.querySelectorAll(".em_list");for(t=0;t<n.length;t++)n[t].innerHTML="<b>"+n[t].getAttribute("data-link")+"</b>&nbsp;";n=null}},getBlockHTML:function(e){var t='<a href="#" onclick="return false" class="'+e.class+' caret" title="'+e.title+'" data-link="'+e["data-link"]+'" spellcheck="false" data-block="true">'+e.text+"</a>";return t},getPrevNode:function(e,t){if(t="undefined"!=typeof t&&null!==t?t:0,!e)return e;if(e.length>t)return e;for(var n=e.previousSibling;n&&!(n.length>0||1==n.nodeType);)n=n.previousSibling;return n},getNextNode:function(e,t){if(t="undefined"!=typeof t&&null!==t?t:0,!e)return e;if(e.length>t)return e;for(var n=e.nextSibling;n&&!(n.length>0||1==n.nodeType);)n=n.nextSibling;return n},getNode:function(e,t,n){var r=Object.create(null),i=!1,o=this.isEditorTag(e);return e?(r.node=null,t="undefined"!=typeof t&&null!==t?t:"prev",n="undefined"!=typeof n&&null!==n?n:0,e.length>n&&(i=!0),o||(r.node="prev"==t?this.getPrevNode(e,n):this.getNextNode(e,n)),r.node&&("prev"==t&&(r.pos=i?r.node.length-n:r.node.length),"next"==t&&(r.pos=i?r.node.length-n:0),r.type="pos"),r.parent=!1,r.node||(r.node=o?e:e.parentNode,r.pos="next"==t?r.node.childNodes.length:0,r.type="pos",r.parent=!0),r):e},isEditorTag:function(e){return e&&1==e.nodeType&&"true"==e.getAttribute("data-editor")||!1},isEmpty:function(e){if(0==e.childNodes.length)return!1;for(var t=e.firstChild;t&&!(1==t.nodeType||t.length>0);)t=t.nextSibling;return!t},getFirstNode:function(e,t){if(0==e.childNodes.length)return!1;var n=e.firstChild;for(t="undefined"!=typeof t&&null!==t&&t;n&&(!(1==n.nodeType||n.length>0)||t&&3==n.nodeType&&!(n.length>1)&&"8203"==n.nodeValue.charCodeAt(0));)n=n.nextSibling;return n},findCurrentWord:function(e,t){var n,r=m.getSelection(),i="",o=-1,a="",s=!1,l=g.getFirstNode(t,!0);e=e?e:null;var u=!("ms"!=c||!g.isEditorTag(r.focusNode)||3!=r.focusNode.childNodes[r.focusOffset].nodeType||"8203"!=r.focusNode.childNodes[r.focusOffset].nodeValue.charCodeAt(0));if((r&&3==r.focusNode.nodeType||u)&&(i=u?r.focusNode.childNodes[r.focusOffset-1].nodeValue:r.focusNode.nodeValue.substr(0,r.anchorOffset),i=i.replace(/\s+$/,""),o=e?i.lastIndexOf(e):1,o>=0))for(n=i.length-1;n>=0;n--){if(/\s/.test(i[n])){s=!0;break}if(i[n]==e){a=i[n]+a;break}a=i[n]+a}return null==e?(s||u||l===r.anchorNode||(a=""),l=null,a):(a[0]!=e&&(a=""),a=a.length>1&&(l===r.anchorNode&&r.anchorNode.nodeValue[0]==e||u||t.firstChild===r.anchorNode&&r.anchorNode.nodeValue[1]==e||r.anchorNode.previousSibling&&3==r.anchorNode.previousSibling.nodeType&&32==r.anchorNode.previousSibling.nodeValue.charCodeAt(r.anchorNode.previousSibling.length-1)||32==i.charCodeAt(o-1))||160==i.charCodeAt(o-1)?a.replace(e,""):"",l=null,a)},findPos:function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}}},m={toPos:function(e,t){var n=this.getSelection(),r=this.getRange();t="undefined"!=typeof t&&null!==t?t:e.length||e.childNodes.length,r.setStart(e,t),r.setEnd(e,t),r.collapse(!0),n.removeAllRanges(),n.addRange(r),r.detach(),n=null},toElementStart:function(e,t){t&&e.focus(),this.toPos(e,0)},toElmentEnd:function(e,t){return t&&e.focus(),g.isEditorTag(e)&&e.lastChild&&3==e.lastChild.nodeType&&"8203"==e.lastChild.nodeValue.charCodeAt(e.lastChild.nodeValue.length-1)?void this.toPos(e.lastChild,e.lastChild.nodeValue.length-1):void this.toPos(e)},toElmentBefore:function(e){var t=this.getSelection(),n=this.getRange();n.setStartBefore(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null},toElmentAfter:function(e){var t=this.getSelection(),n=this.getRange();n.setStartAfter(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null},toElementByType:function(e,t,n){t="undefined"!=typeof t?t:"end","end"==t&&this.toElmentEnd(e),"start"==t&&this.toElementStart(e),"pos"==t&&this.toPos(e,n)},deleteContents:function(e,t,n,r){var i=this.getSelection(),o=this.getRange();t="undefined"!=typeof t&&null!==t?t:e.length||e.childNodes.length,n="undefined"!=typeof n?n:e,r="undefined"!=typeof r&&null!==r?r:n.length||n.childNodes.length,e===n&&t==r||(1==e.nodeType?o.setStartBefore(e):o.setStart(e,t),1==n.nodeType?o.setEndAfter(n):o.setEnd(n,r),i.removeAllRanges(),i.addRange(o),document.execCommand("delete",!1),o.detach())},insertHtml:function(e){var t=(this.getSelection(),this.getCurrentRange());if(this.isIE())t.pasteHTML(e);else if(l){var n,r=document.createElement("div"),i=document.createDocumentFragment();for(r.innerHTML=e;n=r.firstChild;)i.appendChild(n);t.insertNode(i),r=i=n=null}else document.execCommand("insertHtml",!1,e)},getSelection:function(){return this.isIE()?document.selection:window.getSelection()},isIE:function(){return document.selection&&"Control"!=document.selection.type},extendSelection:function(e,t){var n=this.getSelection(),r=this.getRange();return t="undefined"==t||null==t||t,n.extend&&t?void n.extend(e.end,e.endPos):("ltr"==e.direction?(r.setStart(e.start,e.startPos),r.setEnd(e.end,e.endPos)):(r.setStart(e.end,e.endPos),r.setEnd(e.start,e.startPos)),n.removeAllRanges(),n.addRange(r),r.detach(),void(n=null))},reset:function(){var e=this.getSelection(),t=this.getRange(),n=this.getDirection();"ltr"==n?t.setStart(e.focusNode,e.focusOffset):t.setStart(e.anchorNode,e.anchorOffset),t.collapse(!0),e.removeAllRanges(),e.addRange(t),t.detach(),e=null},getRange:function(){return document.createRange()},getCurrentRange:function(){var e=this.getSelection();return this.isIE()?e.createRange():!!e.rangeCount&&e.getRangeAt(0)},getDirection:function(){var e=this.getSelection(),t=!1,n=this.getRange();return e&&!e.isCollapsed&&(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),t=n.collapsed,n.detach()),e=null,t?"rtl":"ltr"},intersectsNode:function(e){var t=this.getCurrentRange(),n=null;if(n=t.commonAncestorContainer,t.intersectsNode)return t.intersectsNode(e);for(;n&&n!==e;)n=n.parentNode;return!!n}};function f(e){var t=this;this.content="",this.tagOpen=!1,this.fragment=null,this.dom={},this.processors=[],this.callback=[],this.lastDisable=0,this.maxHeight=0,this.init=function(e){this.newLine=e.newLine!==!1,this.maxHeight=e.maxHeight,this.placeholder=e.placeholder||"",this.isDisabled=e.isDisabled||!1,this.emotion=e.emotion?e.emotion:null,this.fragment=document.createDocumentFragment(),this.dom.placeholder=document.createElement("span"),this.dom.placeholder.setAttribute("data-placeholder",this.placeholder),this.fragment.appendChild(this.dom.placeholder),this.dom.editor=document.createElement("div"),this.dom.editor.setAttribute("contenteditable","true"),this.dom.editor.setAttribute("spellcheck","true"),this.dom.editor.setAttribute("data-editor","true"),this.dom.editor.setAttribute("class","editor"),this.fragment.appendChild(this.dom.editor),this.emotion&&this.fragment.appendChild(this.emotion),this.addProcessor("keydown",!1,this.checkDisability,this),this.addProcessor("keydown","enter",this.checkNewLine,this),this.addProcessor("both","enter,up,down",this.checkTag,this),this.addCallback("keyup","delete,backspace",this.checkBR,this),this.addCallback("keyup",!1,this.addDelimiter,this),this.addCallback("keydown",!1,this.setPlaceholderContent,this),this.addCallback("keyup",!1,this.updateContent,this),this.addDelimiter(),this.initEvent(),this.maxHeight>0&&(this.dom.editor.style.maxHeight=this.maxHeight+"px")},this.addDelimiter=function(){var e,t,n=this.dom.editor.innerText||this.dom.editor.textContent;t=g.getFirstNode(this.dom.editor),"8203"!=n.charCodeAt(0)&&(e=document.createTextNode("â€‹"),t?this.dom.editor.insertBefore(e,t):this.dom.editor.appendChild(e)),n=this.dom.editor.innerText||this.dom.editor.textContent,1!=n.length&&"8203"==n.charCodeAt(n.length-1)||(e=document.createTextNode("â€‹"),this.dom.editor.appendChild(e)),t=e=null},this.addProcessor=function(e,t,n,r){this.processors.push({event:e,action:t,fn:n,context:r})},this.addCallback=function(e,t,n,r){this.callback.push({event:e,action:t,fn:n,context:r})},this.setFocus=function(){m.toElmentEnd(this.dom.editor,!0)},this.showError=function(){this.hideError(),this.dom.editor.className=this.dom.editor.className+" error"},this.hideError=function(){this.dom.editor.className=this.dom.editor.className.replace("error","").trim()},this.enable=function(){this.isDisabled=!1},this.disable=function(){this.isDisabled=!0},this.set=function(e){e&&(e=e.replace(/\n/g,"<br />"),e=e.replace(/href="(.*?)"/g,'href="#"'),e=e.replace(/<span/g,'<a href="#" onclick="return false" data-block="true"'),e=e.replace(/<\/span>/g,"</a>"),e=e.replace(/class="tag"/g,'class="tag" onclick="return false" data-block="true"'),e=e.replace(/<a.*?class="feedanchor".*?>(.*?)<\/a>/g,"$1"),this.dom.editor.innerHTML=e,this.updateContent(),this.addDelimiter(),g.adjustMarkup(this.dom.editor))},this.get=function(){return this.content},this.clear=function(){this.dom.editor.innerHTML="",this.dom.placeholder.innerHTML="",this.updateContent(),this.addDelimiter(),i.unloadWarn=!1},this.setNewLineMode=function(e){this.newLine=e},this.getNode=function(){return this.fragment},this.addEmoticon=function(e){d.setContainer(this.dom.editor,!0),d.addEmoticon(e,!0),this.updateContent()},this.addTag=function(e,t){d.setContainer(this.dom.editor,!0),d.addTag(e,t),this.updateContent()},this.findWord=function(e){return g.findCurrentWord(e,this.dom.editor)},this.setPlaceholderContent=function(e,t){e.ctrlKey||e.shiftKey||e.metaKey||u[t]||""!=this.dom.placeholder.innerHTML||(this.dom.placeholder.innerHTML=String.fromCharCode(t))},this.checkDisability=function(e,t){return!this.isDisabled||(e.preventDefault(),this.lastDisable=(new Date).getTime()/1e3,(new Date).getTime()-this.lastDisable>2e3&&(this.isDisabled=!1),!1)},this.checkTag=function(e,t){return!this.tagOpen||(e.preventDefault(),!1)},this.checkNewLine=function(e,t){return!!(this.newLine||e.shiftKey||e.ctrlKey)||(e.preventDefault(),!1)},this.checkBR=function(e,t){this.dom.editor.firstElementChild&&this.dom.editor.firstElementChild===this.dom.editor.lastElementChild&&"br"==this.dom.editor.firstElementChild.nodeName.toLowerCase()&&this.dom.editor.removeChild(this.dom.editor.firstElementChild)},this.updateContent=function(e,t){var n=this.dom.editor.innerHTML.replace(/<br>/g,"\n");n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&amp;/g,"&"),n=n.replace(/&nbsp;/g," "),n=n.replace(/\u200B/g,""),n=n.replace(/\n{3,}/g,"\n\n"),n=n.replace(s,function(e,t){return isNaN(t)?t:"##"+t+"##"}),this.content=n.trim();var r=this.dom.editor.innerHTML.replace(/<br>/g,"\n");r=r.replace(/&nbsp;/g," "),r=r.replace(/\u200B/g,""),r=r.replace(/\n{3,}/g,"\n\n"),this.dom.placeholder.innerHTML=r,this.onUpdate&&"function"==typeof this.onUpdate&&this.onUpdate.call(null),""!=this.content?i.unloadWarn=!0:i.unloadWarn=!1},this.initEvent=function(){this.dom.editor.addEventListener("mouseup",n),this.dom.editor.addEventListener("keydown",r),this.dom.editor.addEventListener("keyup",o),this.dom.editor.addEventListener("dragover",c),this.dom.editor.addEventListener("drop",l),this.dom.editor.addEventListener("paste",f),this.dom.editor.addEventListener("cut",E),this.dom.editor.addEventListener("blur",a)},this.getPosition=function(){var e=0,t=0,n=this.dom.editor.getBoundingClientRect(),r=m.getCurrentRange().getClientRects();return e=n.left,t=n.top,r.length>0&&(r=r[0],e=r.left-e,t=r.top-t),{x:e,y:t+12}},this.destroy=function(){this.dom.editor.removeEventListener("mouseup",n),this.dom.editor.removeEventListener("keydown",r),this.dom.editor.removeEventListener("keyup",o),this.dom.editor.removeEventListener("dragover",c),this.dom.editor.removeEventListener("drop",l),this.dom.editor.removeEventListener("paste",f),this.dom.editor.removeEventListener("cut",E),this.dom.editor.removeEventListener("blur",a),this.dom=t=null,i.unloadWarn=!1},this.init(e);function n(e){d.init(t.dom.editor,"00",e,t.callback,t.processors),t.dom.placeholder.className="active",e.stopPropagation()}function r(e){e.stopPropagation();var n=e.which||e.keyCode||e.key;d.init(t.dom.editor,n,e,t.callback,t.processors)}function o(e){e.stopPropagation();var n=e.which||e.keyCode||e.key;d.init(t.dom.editor,n,e,t.callback,t.processors)}function a(e){e.stopPropagation(),e.preventDefault(),t.dom.placeholder.className=""}function c(e){return e.stopPropagation(),e.preventDefault(),!1}function l(e){return e.stopPropagation(),e.preventDefault(),!1}function f(e){e.stopPropagation(),e.preventDefault();var n="";if(e.clipboardData)n=e.clipboardData.getData("text/plain");else if(window.clipboardData)try{n=window.clipboardData.getData("Text")}catch(e){}n=n.replace(/\n/g,"<br />"),n=n.replace(/\s\s+/g," "),n=n.replace(/\u200B/g,""),d.paste(n),t.updateContent()}function E(e){e.stopPropagation(),t.updateContent()}}var E={};return E.create=function(e){var t=new f(e);return t},E}]}rgEditor.$inject=["$compile","$editor","SystemEvents"];function rgEditor(e,t,n){function r(r,i,o){var a,s,c,l;r.filterFriend="",r.editorContent="",s="true"==o.showSticker||o.showSticker===!0?"true":"false",c={newLine:"false"!=o.newLine&&o.newLine!==!1,placeholder:o.placeholder?o.placeholder:"",isDisabled:"true"==o.isDisabled||o.newLine===!0,maxHeight:o.maxHeight?parseInt(o.maxHeight):0},o.showEmoji&&(c.emotion=e('<a href="javascript:void(0)"><i class="img_sprite icon-emoticon ico-sty" rg-emoticon="" clicked="insertEmoji" show-sticker="'+s+'"></i></a>')(r)[0],i.addClass("with_emo")),a=t.create(c),i.append(a.getNode()),a.onUpdate=g,r.insertEmoji=function(e){a.addEmoticon(e.symbol(),!0)},r.closeDropdownFriend=function(){l&&(l.remove(),l=void 0),a.tagOpen=!1},r.chooseFriend=function(e,t){r.filterFriend&&(a.addTag(e,r.filterFriend),r.closeDropdownFriend())};function u(t,n){if(r.filterFriend=a.findWord("@"),32==n&&(r.filterFriend=""),""==r.filterFriend&&l&&r.closeDropdownFriend(),r.filterFriend&&!l){l=e('<rg-friend-dropdown template-url="templates/dropdowns/tag-editor-dropdown.html" tag-items="[]" filter-text="filterFriend" focus-filter="" on-close="closeDropdownFriend" on-select="chooseFriend"></rg-friend-dropdown>')(r),i.after(l);var o=a.getPosition();l.css({position:"absolute",left:o.x+"px",top:o.y+"px"})}l&&(a.tagOpen=!0,document.addEventListener("click",function e(t){l&&t.target!==l[0]&&r.closeDropdownFriend(),document.removeEventListener("click",e)},!1))}function d(e,t){return l&&(e.preventDefault(),l.triggerHandler(e,t)),!0}function g(e,t){r.editorContent=a.get(),r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}o.onRingbox&&a.addCallback("keydown",!1,function(e,t){r.$emit(n.RINGBOX.UPDATE)}),o.tagFriend&&(a.addCallback("keyup",!1,u,null),a.addCallback("keyup","escape",r.closeDropdownFriend,r),a.addProcessor("keydown","up,down,enter",d,null)),o.onEscape&&a.addCallback("keyup","escape",r.onEscape(),r),o.onEnter&&a.addProcessor("keydown","enter",function(e,t){return!(c.newLine===!1&&!e.shiftKey&&!e.ctrlKey)||(r.onEnter()(r.onEnterArg),!1)}),r.$on("cleareditor",function(){a.clear()}),r.$on("seteditor",function(e,t){t=t||r.editorContent,a.set(t)}),r.$watch("isDisabled",function(e){e?(a.disable(),a.clear()):a.enable()}),o.focus&&r.$watch("focus",function(e){e&&(setTimeout(function(){a.setFocus()},0),o.editMode&&a.set(r.editMode()().toString()))}),r.$on("$destroy",function(){a.destroy(),a=c=l=null})}return{scope:{editorContent:"=",onEnter:"&",onEscape:"&",onEnterArg:"=",isDisabled:"=",focus:"=",editMode:"&"},restrict:"E",link:r}}angular.module("ringid.shared").directive("rgEmoticon",rgEmoticon),rgEmoticon.$inject=["$compile","$timeout","$document","Utils","StickerFactory","rgScrollbarService","$templateCache","$ringhttp"];function rgEmoticon(e,t,n,r,i,o,a,s){var c=function(t,n,c){var l,u,d="templates/partials/emoticon-window.html",g=!1,m=400,f=300,E="true"==c.showSticker?300:260;t.emoWindowStyle={height:E+"px",width:f+"px"},t.showsticker="true"==c.showSticker,t.selectedStickerCatId=0;function p(){t.$parent&&1!==t.$parent.$id?t.$parent.$rgDigest():t.$rgDigest()}function T(e){e.preventDefault(),g=!g,g?I(e):h()}n[0].addEventListener("click",T);function h(e){(!e||"click"!==e.type||e.target!==n[0]&&e.target.parentNode&&e.target.parentNode!==n[0]&&e.target.parentNode.parentNode!==n[0]&&"pt-top"!==e.target.className)&&(g=!1,document.removeEventListener("click",h),document.removeEventListener("scroll",h),n[0].removeEventListener("resize",A),l[0].parentNode.removeChild(l[0]))}function _(r){l=e(r)(t),n.append(l),A(),document.addEventListener("click",h),document.addEventListener("scroll",h),window.addEventListener("resize",A)}function I(e){u=e,a.get(d)?_(a.get(d)):s.get(d).success(function(e){_(e)})}t.selectEmoOrSticker=v;function A(){var e=0,i=n[0].getBoundingClientRect(),o=r.viewport.x-i.width,a=r.viewport.y;e=Math.floor(i.width/2),u.clientX+m<o&&u.clientY+m<a?(t.emoWindowStyle.top=i.top+(e+15)+"px",t.emoWindowStyle.left=i.left+(e+5)+"px"):u.clientX+m>o&&u.clientY+m>a?(t.emoWindowStyle.top=i.top-E+(e-5)+"px",t.emoWindowStyle.left=i.left-f+(e-5)+"px"):u.clientX+m>o?(t.emoWindowStyle.top=i.top+(e+5)+"px",t.emoWindowStyle.left=i.left-f+(e-5)+"px"):u.clientY+m>a&&(t.emoWindowStyle.top=i.top-E+(e-5)+"px",t.emoWindowStyle.left=i.left+(e+5)+"px"),p()}function v(e,n){n.stopPropagation(),c.clicked&&t.$eval(c.clicked)(e,n),h(),p()}t.selectStickerCatId=function(e,n){e.stopPropagation(),t.selectedStickerCatId=n,i.getStickerMapByCatId(n).then(function(e){t.emoticonMap=e,p()}),o.scrollTop(t),p()},t.showEmoticons=function(e){e.stopPropagation(),t.emoticonMap=i.getEmoticonMap(),p()},t.$on("$destroy",function(){document.removeEventListener("click",h),document.removeEventListener("scroll",h),n[0].removeEventListener("resize",A)})};l.$inject=["$scope"];function l(e){function t(){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}e.startAt=0,e.getMyStickers=function(){return e.myStickerCatIds().slice(e.startAt,e.startAt+4)},e.getTopStickers=function(){return i.getStickerCategories("top").slice(0,4)},e.loadPrevious=function(n){e.startAt=e.startAt>0?e.startAt-1:0,n.stopPropagation(),t()},e.loadNext=function(n){e.startAt=e.startAt+3<e.myStickerCatIds().length-1?e.startAt+1:e.startAt,n.stopPropagation(),t()},e.myStickerCatIds=i.getMyStickerCatIds,e.getSticker=i.getStickerCategoryObject,e.emoticonMap=i.getEmoticonMap()}return{restrict:"A",link:c,controller:l}}angular.module("ringid.shared").service("rgHashtagService",rgHashtagService).directive("rgHashtag",rgHashtag),rgHashtagService.$inject=["GlobalEvents"];function rgHashtagService(e){var t=this,n=!1,r=!1;t.close=function(i){r&&(r.style.display="none",n.resetTag(i),n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))},t.open=function(i,o){r=i,n=o,r.style.display="block",e.bindHandler("document","click",t.close)}}rgHashtag.$inject=["$compile","fileUploadService","Media","rgHashtagService","SystemEvents","$rootScope","rgScrollbarService"];function rgHashtag(e,t,n,r,i,o,a){var s=function(e,o){var s,c,l,u;e.selectedTag=-1,e.tagList=t.tagList,e.tagSuggestions=[],e.tagLoading=!1,u=o[0].parentNode.querySelector("textarea#add-hashtag"),s=o[0].parentNode.querySelector("div#hashtag-dropdown"),u.addEventListener("keyup",m),u.addEventListener("keydown",g),e.removeTag=function(n,r){n.preventDefault(),t.tagList.splice(r,1),e.$rgDigest()},e.addHashTag=function(t){e.tagList.push(t),r.close(!0)},e.resetTag=function(n){t.tagSuggestions=[],e.selectedTag=-1,n&&(u.value=""),e.$rgDigest()},e.gotMedias=function(){return t.audioFiles.length>0||t.videoFiles.length>0},e.$on(i.FILE_UPLOAD.UPLOADS_POSTED,function(){e.tagList=[],e.resetTag(!0)});function d(t){t?e.selectedTag=e.selectedTag<=0?0:e.selectedTag-1:e.selectedTag=e.selectedTag+1>=e.tagSuggestions.length?e.tagSuggestions.length-1:e.selectedTag+1,e.selectedTag>=0&&(u.value=e.tagSuggestions[e.selectedTag].sk),a.scrollTo(e,e.selectedTag/e.tagSuggestions.length*100),e.$rgDigest()}function g(t){var n=t.keyCode||t.which,i=u.value.trim();27!==n&&13!==n&&10!==n||(t.preventDefault(),t.stopPropagation(),i.length>0?(e.selectedTag>-1?e.addHashTag(e.tagSuggestions[e.selectedTag]):e.addHashTag({sk:i,ukey:0}),r.close(),e.tagLoading=!1):u.value="")}function m(t){var n=t.keyCode||t.which,i=u.value.trim();38===n&&i.length>0?d(!0):40===n&&i.length>0?d(!1):27===n||13===n||10===n?t.preventDefault():i.length>0?l=setTimeout(f,200):0===i.length&&(clearTimeout(l),r.close()),e.$rgDigest()}function f(){var t=u.value.trim();t.length>0&&c!==t?(r.open(s,e),c=t,e.tagLoading=!0,e.selectedTag=-1,e.tagSuggestions=[],n.fetchHashtagSuggestion(t).then(function(t){e.tagLoading&&(clearTimeout(l),e.tagLoading=!1,t.sucs===!0?e.tagSuggestions=t.sgstn:r.close(),e.$rgDigest())})):clearTimeout(l),e.$rgDigest()}e.$on("$destroy",function(){u.removeEventListener("keyup",m),u.removeEventListener("keypress",g)})};return{restrict:"E",link:s,template:'<div ng-show="gotMedias()"><div ><ul class="tag-fnd-lst"><li ng-repeat="tag in tagList" ><span class="tag-title" ng-bind="tag.sk" ></span>&nbsp;<span class="tag-cros" rg-click="removeTag($event, $index)">X</span></li></ul></div></div><div  ng-show="ddControl.uploadWhat !== \'image\' && getMedia(true).length > 0"  class="b-t-b"><span class="top-r float-left" data-tool="Type something for tags suggestion OR press enter to add new tag"><i class="p-10 img_sprite view-ico" style="margin:7px;padding:0;"></i></span><textarea id="add-hashtag" ng-model="tagName" type="text"  class="media-tags float-left"  placeholder="Add Hashtag" ></textarea><div class="clear"></div></div><div id="hashtag-dropdown" class="m-s-height tag-dd active" style="display:none;"><div class="loader-s" ng-show="tagLoading"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div><ul class="m-s-result" rg-scrollbar="true" style="overflow: hidden;"><li ng-repeat="tag in tagSuggestions track by tag.ukey" ng-class="{active:$index==selectedTag}"  class="m-t-icon" rg-click="addHashTag({sk: tag.sk, ukey: tag.ukey})"><a href="javascript:void(0)" title="{{tag.sk}}" ng-bind="tag.sk" > abc</a></li></ul></div>'}}angular.module("ringid.shared").directive("rgUpload",rgUpload),rgUpload.$inject=["$compile","fileUploadService","Media"];function rgUpload(e,t,n){r.$inject=["Auth","$scope","mediaMetadata","imageQuality","APP_CONSTANTS","SystemEvents","Ringalert","$$q","$rootScope","rgDropdownService"];function r(e,r,i,o,a,s,c,l,u,d){var g=a,m=0;r.uploadProgress=t.uploadProgress,r.previewStartAt=0,r.tagList=t.tagList,r.ddHtml="templates/dropdowns/album-dropdown.html",r.ddControl={Media:n,uploadWhat:"image",createAlbum:!1,albumName:"",selectedAlbum:0},r.selectAlbum=function(){return{data:function(){return{from:"feedpost",mediaType:r.ddControl.uploadWhat}}}},r.getMedia=E,r.removeMedia=p,r.loadPrevious=T,r.loadNext=h,r.disableUpload=_,r.uploadAudio=I,r.uploadVideo=A,r.uploadImage=v;function f(){m=0,r.previewStartAt=0,r.ddControl.uploadWhat="image",r.ddControl.createAlbum=!1,r.ddControl.albumName="",r.ddControl.selectedAlbum=0,t.resetUpload(),t.tagList=[],r.tagList=t.tagList,r.$rgDigest()}r.$on(s.FILE_UPLOAD.UPLOADS_POSTED,f);function E(e){return e?t[r.ddControl.uploadWhat+"Files"]:t[r.ddControl.uploadWhat+"Files"].slice(r.previewStartAt,r.previewStartAt+3)}function p(e){t[r.ddControl.uploadWhat+"Files"][e].getQueued()?t[r.ddControl.uploadWhat+"Files"][e].cancelUpload():t[r.ddControl.uploadWhat+"Files"].splice(r.previewStartAt+e,1),0===t[r.ddControl.uploadWhat+"Files"].length?f():r.previewStartAt=r.previewStartAt>0?r.previewStartAt-1:r.previewStartAt}function T(){r.previewStartAt=r.previewStartAt-3>0?r.previewStartAt-3:0}function h(){r.previewStartAt=r.previewStartAt+3<=t[r.ddControl.uploadWhat+"Files"].length-4?r.previewStartAt+3:t[r.ddControl.uploadWhat+"Files"].length-3}function _(e){return t[r.ddControl.uploadWhat+"Files"].length>0&&r.ddControl.uploadWhat!==e}function I(){t.videoFiles=[],t.imageFiles=[];var e,n,i=this;for(e=0;e<i.files.length;e++)m+=i.files[e].size;if(i.files.length+t.audioFiles.length>g.AUDIO_UPLOAD_LIMIT)c.show("Maximum upload limit "+g.AUDIO_UPLOAD_LIMIT,"warning");else if(m>g.MEDIA_UPLOAD_SIZE_LIMIT)for(c.show("Maximum allowed total upload files size 500MB!","warning"),e=0;e<i.files.length;e++)m-=i.files[e].size;else{r.hasOwnProperty("rgUploadAction")&&r.rgUploadAction("audio"),0===t.audioFiles.length&&(r.ddControl.uploadWhat="audio",r.ddControl.selectedAlbum=null,t.setUploadAlbum(-1));var o=t.audioFiles.length;for(e=0,n=i.files.length;e<n;e++)S("audio",i.files[e])?t.queueFile("audio",i.files[e]):c.show("Invalid Audio File: "+i.files[e].name,"error");
u.$broadcast(s.FILE_UPLOAD.QUEUE_START),t.uploadQueue("audio",o)}i.value=null,r.$rgDigest()}function A(){var e,n,i=this;for(e=0;e<i.files.length;e++)m+=i.files[e].size;if(i.files.length+t.videoFiles.length>g.VIDEO_UPLOAD_LIMIT)c.show("Maximum upload limit "+g.VIDEO_UPLOAD_LIMIT,"warning");else if(m>g.MEDIA_UPLOAD_SIZE_LIMIT)for(c.show("Maximum allowed total upload files size 500MB!","warning"),e=0;e<i.files.length;e++)m-=i.files[e].size;else{0===t.videoFiles.length&&(r.ddControl.uploadWhat="video",r.ddControl.selectedAlbum=null,t.setUploadAlbum(-1)),r.hasOwnProperty("rgUploadAction")&&r.rgUploadAction("video");var o=t.videoFiles.length;for(e=0,n=i.files.length;e<n;e++)S("video",i.files[e])?t.queueFile("video",i.files[e]):c.show("Invalid Video File: "+i.files[e].name,"error");t.uploadQueue("video",o),u.$broadcast(s.FILE_UPLOAD.QUEUE_START)}i.value=null,r.$rgDigest()}function v(){r.ddControl.uploadWhat="image";var e=this;switch(r.rgUploadType){case"coverphoto":case"profilephoto":case"tagchatimage":case"chatimage":if(S("image",e.files[0])){var n=t.queueFile(r.rgUploadType,e.files[0]);r.hasOwnProperty("rgUploadAction")&&r.rgUploadAction()({action:r.rgUploadType,uploadFile:n})}else c.show("Invalid Image File: "+e.files[0].name,"error");e.value=null;break;case"status":if(e.files.length+t.imageFiles.length>g.IMAGE_UPLOAD_LIMIT){c.show("Maximum upload limit "+g.IMAGE_UPLOAD_LIMIT,"warning");break}for(var i=t.imageFiles.length,o=0;o<e.files.length;o++)S("image",e.files[o])?t.queueFile("image",e.files[o]):c.show("Invalid Image File: "+e.files[o].name,"error");u.$broadcast(s.FILE_UPLOAD.QUEUE_START),t.uploadQueue("image",i),e.value=null}r.$rgDigest()}function S(e,t){var n;switch(e){case"image":n=new RegExp("image/*");break;case"audio":n=new RegExp("audio/mp3*");break;case"video":n=new RegExp("video/mp4");break;case"default":}return n.test(t.type)}r.$on("$destroy",function(){var e,n;switch(r.rgUploadType){case"coverphoto":t.coverImageFile&&(t.coverImageFile.cancelUpload(),t.coverImageFiles=null);break;case"profilephoto":t.profileImageFile&&(t.profileImageFile.cancelUpload(),t.profileImageFiles=null);break;case"tagchatimage":case"chatimage":t.chatImageFiles[r.rgUploadBoxValue]&&(t.chatImageFiles[r.rgUploadBoxValue].cancelUpload(),delete t.chatImageFiles[r.rgUploadBoxValue]);break;case"status":if(t.imageFiles.length>0){for(e=0,n=t.imageFiles.length;e<n;e++)t.imageFiles[e].cancelUpload();t.imageFiles=[]}else if(t.videoFiles.length>0){for(e=0,n=t.videoFiles.length;e<n;e++)t.videoFiles[e].cancelUpload();t.videoFiles=[]}else if(t.audioFiles.length>0){for(e=0,n=t.audioFiles.length;e<n;e++)t.audioFiles[e].cancelUpload();t.audioFiles=[]}}})}var i=function(n,r,i){var o,a,s,c=i.rgUploadType,l="",u="",d='<div class="to-add" ng-show="ddControl.uploadWhat !== \'image\' && getMedia(true).length > 0" ><span ><a  class="img_sprite btn-share vid top-l" data-tooltip-post="Add to album"  rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true" ringbox-type="remote" ringbox-target="templates/dropdowns/popup-album-dropdown.html" ringbox-data="selectAlbum(media.value)" ></a> </span></div><rg-hashtag></rg-hashtag><div class="status-photo-view" style="border-bottom:1px solid #ebebeb;margin:0;padding:0;margin-bottom:10px;" id="img-height" ng-show="getMedia(true).length > 0"><div id="sts-img-preview" style="text-align:center;" class="scroll"><div ng-show="previewStartAt+3 < getMedia(true).length" class="np-box img_sprite icon-right-arrow"  style="right:0;margin-top:60px;" rg-click="loadNext()"></div><div ng-show="previewStartAt > 0" class="np-box  img_sprite icon-left-arrow" style="left:0;margin-top:60px;"  rg-click="loadPrevious()"></div><div style="margin-top:3px;" class="status-photo-view-thumb" ng-repeat="image in getMedia()"><div ng-show="image.getProgress() !== 100" class="progress-bar-placement" style="position:absolute;width:100%;text-align:center;"><div class="percent">{{image.getProgress()}}%</div><div class="progress-bar"><div class="uploaded" ng-style="{\'width\': image.getProgress()+ \'%\'}"></div></div></div><div  id="singleImage{{$index}}"  style="position:absolute;width:100%;text-align:center;"><input class="add-title" ng-model="image.cptn" ng-model-options="{ getterSetter: true }" type="text" name="" placeholder="Add Photo Title" ng-show="!image.progressVisible" /><div class="photo-view" style="background-image: url({{image.getPreview()}}); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer;"><div class="status-photo-view-thumb-hover"><span id="closebtn0" class="close" style="display: block;" rg-click="removeMedia($index)" inc="0"><div class=" up-p"></div></span></div></div></div></div></div>';switch(c){case"coverphoto":case"profilephoto":l='<input  id="'+c+'" type="file" name="'+c+'"  accept="image/*" >',r.append(e(l)(n));break;case"tagchatimage":case"chatimage":l='<label  class="img_sprite icon-camera ico-sty ng-binding ng-scope"><input  id="'+c+'" type="file" style="display:none;" accept="image/*" ></label>',r.append(e(l)(n));break;case"audio":l='<a data-tooltip-post="Add Audios" href="javascript:void(0)"><label  class="audio-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a>',r.append(e(l)(n));break;case"video":l='<a data-tooltip-post="Add Videos" href="javascript:void(0)"><label  class="video-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="video" type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a>',r.append(e(l)(n));break;case"status":l='<div ng-show="rgUploadEnabled "class="post-b-ico"><a data-tooltip-post="Add Videos" href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico video-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'video\')" id="video"type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a></div><div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Audios" href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico audio-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'audio\')" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a></div>',i.rgUploadFeed&&"true"==i.rgUploadFeed&&(l='<div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Photos"  href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico camera-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'image\')" id="'+c+'" type="file" style="display:none;" multiple="multiple" accept="image/*"></label></a></div>'+l),r.append(e(l)(n)),o=r.parent().prepend(e(d)(n))}u=r[0].querySelector("input#"+c),"status"===c?(i.rgUploadFeed&&"true"==i.rgUploadFeed&&u.addEventListener("change",n.uploadImage),a=r[0].querySelector("input#video"),a.addEventListener("change",n.uploadVideo),s=r[0].querySelector("input#audio"),s.addEventListener("change",n.uploadAudio)):"audio"===c?u.addEventListener("change",n.uploadAudio):"video"===c?u.addEventListener("change",n.uploadVideo):u.addEventListener("change",n.uploadImage),n.$rgDigest(),n.$on("$destroy",function(){switch(c){case"status":i.rgUploadFeed&&"true"==i.rgUploadFeed&&u.removeEventListener("change",n.uploadImage),s.removeEventListener("change",n.uploadAudio),a.removeEventListener("change",n.uploadVideo);break;case"image":u.removeEventListener("change",n.uploadImage);break;case"audio":u.removeEventListener("change",n.uploadAudio);break;case"video":u.removeEventListener("change",n.uploadVideo)}t.removeScope(n)}),t.setScopeForDigest(n)};return{restrict:"AE",scope:{rgUploadEnabled:"=",rgUploadType:"@",rgUploadAction:"&",rgUploadBoxValue:"="},link:i,controller:r}}angular.module("ringid.shared").directive("rgInvite",rgInvite),rgInvite.$inject=["$$connector","OPERATION_TYPES","InviteFactory","friendsFactory","Api"];function rgInvite(e,t,n,r,i){function o(o,a){var s,c,l,u,d,g,m,f,E=t.SYSTEM.FRIENDS;a[0].style.display="none",o.removeOutGoingFriends=function(){for(var e=[],t=n.suggestionFriends.all(),r=n.suggestionFriends.length(),i=0;i<r;i++)0!==t[i].value.friendshipStatus()&&e.push(t[i].value.getUtId());for(var o=0;o<e.length;o++)n.suggestionFriends.remove(e[o])},o.getSuggestions=function(){return o.removeOutGoingFriends(),n.suggestionFriends.length()<5&&n.getSuggestionContactsDetails(),{data:function(){return{target:n.suggestionFriends}}}},o.removeSugg=function(){n.removeSuggestion(m.getUtId(),"remove"),_()},o.getMutualFriend=function(){return{data:function(){return{target:m}},promise:i.user.getMutualFriends(m)}},o.friendRequestAction=function(){var e=3===m.friendshipStatus()?"remove":"addfriend",t=m;h(),r.friendAction({friend:t,action:e},!0).then(function(e){_(),I(e.sucs),T(),e.sucs===!0&&n.removeSuggestion(t.getUtId()).then(function(e){e.sucs===!0&&n.suggestionFriends.remove(t.getUtId())})},function(){I(),T()}),I()};function p(){s=a[0].querySelector("#invname"),c=a[0].querySelector("#invavatarlink"),l=a[0].querySelector("#invavatarimg"),u=a[0].querySelector("#invmutual"),d=a[0].querySelector("#invaddfriend"),a[0].addEventListener("mouseenter",h),a[0].addEventListener("mouseleave",T),a[0].style.display="block",_(),T()}function T(){h(),g=setInterval(_,5e3)}function h(){clearInterval(g)}function _(){m=m?n.suggestionFriends.next(m.getUtId())||n.suggestionFriends.bottom():n.suggestionFriends.bottom(),m?(s.textContent=m.getName(),s.setAttribute("href",m.link()),c.setAttribute("href",m.link()),l.setAttribute("src",m.avatar("thumb")),u.textContent=m.commonFriends()+" mutual friends",m.commonFriends()>0?u.style.display="block":u.style.display="none",I()):a[0].style.display="none"}function I(e){m.isLoading()?d.parentElement.classList.add("f-loading"):d.parentElement.classList.remove("f-loading")}function A(){e.subscribe(function(){f||(f=setTimeout(function(){p()},1e3))},{action:[E.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),setTimeout(n.init,5e3)}A(),o.$on("$destroy",function(){a[0].removeEventListener("mouseenter",T),a[0].removeEventListener("mouseenter",h)})}return{restrict:"A",templateUrl:"templates/partials/friend-invite.html",link:o}}angular.module("ringid.shared").controller("MenuController",MenuController),MenuController.$inject=["$scope","$location"];function MenuController(e,t){e.isCurrentPath=function(e,n){if(1==e.length)return n?t.path().indexOf(e[0])>-1:t.path()==e[0];for(var r=0;r<e.length;r++)if(t.path().indexOf(e[r])>-1)return n?t.path().indexOf(e[r])>-1:t.path()==e[r]}}angular.module("ringid.shared").controller("allSuggestionController",allSuggestionController),allSuggestionController.$inject=["$scope","$boxInstance","localData","friendsFactory","InviteFactory","OPERATION_TYPES","$$connector","rgScrollbarService","Api"];function allSuggestionController(e,t,n,r,i,o,a,s,c){e.users=[];var l=o.SYSTEM.FRIENDS;e.state=i.state,t.opened.then(function(){e.users=n.target.all(),e.$rgDigest()});var u=n.target.length();e.$watch("state.isRequestsLoading",function(t,n){e.$rgDigest()}),e.contactListAction=function(t){t.friend.isLoading()||(r.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.loadmorefriend=function(){i.getSuggestionContactsDetails(5),e.$rgDigest()},e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:c.user.getMutualFriends(e)}};var d=a.subscribe(g,{action:[l.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]});function g(t){t&&(i.noOfSuggestions()>u&&(s.recalculate(e),e.$rgDigest()),u=i.noOfSuggestions())}e.$on("$destroy",function(){a.unsubscribe(d)})}angular.module("ringid.shared").controller("mutualFriendsController",mutualFriendsController),mutualFriendsController.$inject=["$scope","remoteData","friendsFactory","userFactory","Api","rgScrollbarService"];function mutualFriendsController(e,t,n,r,i,o){var a=t.mfIDs;e.mutualfriends=[],n.getContactDetailsByUtIds(a).then(function(t){if(e.mutualfriends=[],t.sucs===!0){for(var n=0;n<t.contacts.length;n++)e.mutualfriends.push(r.create(t.contacts[n]));e.$rgDigest()}o.recalculate(e),e.$rgDigest()}),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:i.user.getMutualFriends(e)}}}!function(e,t){"use strict";e.module("ringid.utils",["ringid.config","ringid.global_services"])}(angular,window),angular.module("ringid.utils").directive("ogImageSrc",ogImageSrc).directive("rgUrlOgPreview",rgUrlOgPreview),ogImageSrc.$inject=["SystemEvents"];function ogImageSrc(e){return{restrict:"A",link:function(t,n,r){n[0].onload=function(){t.feedKey?t.$emit(e.FEED.HEIGHT,t.feedKey):t.$emit(e.RINGBOX.UPDATE)},n[0].src=r.ogImageSrc}}}rgUrlOgPreview.$inject=["$ringhttp","$templateCache","$compile","Utils"];function rgUrlOgPreview(e,t,n,r){return{restrict:"E",replace:!0,scope:{onClick:"&",ogData:"=",showPreview:"=",loadingData:"=",editMode:"@",feedKey:"@"},templateUrl:"",link:function(t,r,i){var o="templates/partials/url-og-preview.html";i.template&&(o=i.template),e.get(o).success(function(e){r.append(n(e)(t)),t.$rgDigest()})},controller:["$scope","$sce","settings",function(e,t,n){e.selectedOgImageIndex=0,e.onClick=o,e.onImageCloseClick=p,e.onDetailCloseClick=T,e.selectPreviousImage=E,e.selectNextImage=f,e.shouldShowNextButton=h,e.shouldShowPreviousButton=_,e.isYoutubeUrl=y,e.getYoutubeUrl=b,e.filterOnProgress=!1,e.ogData.title=decodeEntities(e.ogData.title),e.ogData.description=decodeEntities(e.ogData.description),e.shouldShowNextPreviousButtonContainer=I,e.shouldShowImageCloseButton=A,e.init=function(){e.ogData&&e.ogData.url&&(m(),O(e.ogData.url),e.ogData.url&&(/^https?:\/\//.test(e.ogData.url)||(e.ogData.url="http://"+e.ogData.url)),e.ogData.image&&(/^https?:\/\//.test(e.ogData.image)||(e.ogData.image="http://"+e.ogData.image),n.secure&&/^http:/.test(e.ogData.image)&&(e.ogData.image=n.httpsUrl+"/ImageProxy.png?url="+e.ogData.image.replace(/http:\/\//,""))),e.ogData.images&&e.ogData.images.length>0&&P())},e.$watch("ogData",function(){e.init()});function i(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){r.safeDigest(e)}}function o(){if(e.ogData&&!e.ogData.images){var t=e.ogData.url;t&&window.open(t,"_blank")}}function a(){e.ogData.images&&(e.ogData.image=e.ogData.images[e.selectedOgImageIndex])}function s(){e.ogData.image=""}function c(){e.ogData.title=""}function l(){e.ogData.description=""}function u(){e.ogData.url=""}function d(){e.ogData.lnkDmn=""}function g(t,n){e.ogData.meta[t]=n}function m(t,n){e.ogData.meta={youtube:!1,youtube_id:""}}function f(){e.selectedOgImageIndex<e.ogData.images.length-1&&(e.selectedOgImageIndex+=1),a(),i()}function E(){e.selectedOgImageIndex>0&&(e.selectedOgImageIndex-=1),a(),i()}function p(e){e.preventDefault(),e.stopPropagation(),s(),i()}function T(e){e.preventDefault(),e.stopPropagation(),c(),l(),u(),d(),i()}function h(){return!!e.ogData.images&&e.selectedOgImageIndex<e.ogData.images.length-1}function _(){return e.selectedOgImageIndex>0}function I(){return!!e.editMode&&!!e.ogData.image&&e.ogData.filteredImages.length>1}function A(){return!!e.editMode&&!e.filterOnProgress&&!!e.ogData.image}function v(){e.filterOnProgress=!0}function S(){e.filterOnProgress=!1}function C(t){e.ogData.filteredImages.push(t)}function D(t){e.ogData.filteredImages=[]}function M(t){e.ogData.image=t}function y(){return!e.ogData.meta&&e.ogData.url&&(m(),O(e.ogData.url)),!!e.ogData.meta&&e.ogData.meta.youtube}function N(){return e.ogData.meta.youtube_id}function b(){return t.trustAsResourceUrl("https://www.youtube.com/embed/"+N()+"?autoplay=0&autohide=1&border=0&wmode=opaque&enablejsapi=1")}function O(e){var t=/((http|https):\/{2})+((www\.)?youtube\.com)([?&]?([^=]+)=([^&]*))?/im;if(e){var n=e.match(t);n&&n[3]&&n[7]?(g("youtube",!0),g("youtube_id",n[7])):g("youtube",!1)}}function P(){D(),v();var t=e.ogData.images;r.filterImagesByDimentions(t,{width:200}).then(function(t){e.ogData.image||M(t),C(t),e.filterOnProgress&&S(),i()},function(){},function(t){C(t),e.ogData.image||M(t),i()})}}]}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){}ringUtilsModule.directive("rgUrlOgFetcher",rgUrlOgFetcher),rgUrlOgFetcher.$inject=["$compile"];function rgUrlOgFetcher(e){return{restrict:"E",scope:{fetchedOgInfo:"=",editorContent:"=",showPreview:"=",filterOnProgress:"=",loadingData:"="},link:function(e,t,n){e.fetchedOgInfo=e.fetchedOgInfo||{},e.filterOnProgress&&(e.filterOnProgress=!1)},controller:["$scope","$rootScope","$timeout","Utils","settings",function(e,t,n,r,i){var o=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,a={},s="";function c(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){r.safeDigest(e)}}e.$watch("editorContent",r.debounce(function(e,t){l(e,t),c()},500));function l(t,n){if(S(t,n)){if(t&&o.test(t)){var i=t.match(o),a=i[1];if(a){var s=i[5]?i[5]:"";if(/^https?:\/\//.test(a)||(a="http://"+a),!u(a))return;var l=g(a);l?(m(l),h(),v()):(E(),v(),c(),r.getOGDetails(a).success(function(e){p(),e&&e.sucs?(d(a,e),e.lnkDmn=s,e.url=a,e=A(e,a),m(e),h()):(f(),_()),v(),c()}).error(function(e){f(),I(),_(),p(),v(),c()}))}}else f(),_();e.$parent.$rgDigest()}}function u(t){return(!e.fetchedOgInfo||s!=t)&&(s=t,!0)}function d(e,t){a[e]=t}function g(e){a[e]}function m(t){e.fetchedOgInfo=t}function f(){e.fetchedOgInfo={}}function E(){e.loadingData=!0}function p(){e.loadingData=!1}function T(){return e.loadingData}function h(){e.showPreview=!0}function _(){e.showPreview=!1}function I(){s=""}function A(e,t){var n=angular.extend({},e);if(n.url||(n.url=t),n.title||(n.title=n.lnkDmn),e.images)for(var r=e.images.length,o=0;o<r;o++)i.secure&&/^http:/.test(e.images[o])&&(e.images[o]=i.httpsUrl+"/ImageProxy.png?url="+e.images[o].replace(/http:\/\//,""));return n.title=decodeEntities(n.title),n.description=decodeEntities(n.description),n}function v(){n(function(){t.$broadcast("statusHeightChange")})}function S(t,n){return!T()&&((!e.fetchedOgInfo||!(e.fetchedOgInfo.image||e.fetchedOgInfo.title||e.fetchedOgInfo.description))&&(I(),!0))}}]}}angular.module("ringid.utils").directive("rgLoaderView",rgLoaderView).directive("rgLoaderView1",rgLoaderView1).directive("rgLoaderView2",rgLoaderView2);function rgLoaderView(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view.html"}}function rgLoaderView1(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view1.html"}}function rgLoaderView2(){return{restrict:"E",scope:{isLoading:"="},templateUrl:"templates/partials/loading_view2.html"}}angular.module("ringid.utils").directive("rgCompile",["$compile",function(e){return function(t,n,r){t.$watch(function(e){return e.$eval(r.rgCompile)},function(r){n.html(r),e(n.contents())(t)})}}]);var app;app=angular.module("ringid.utils"),app.directive("rgKeyUp",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(e){}}t.bind("keyup",r),e.$on("$destroy",function(){t.unbind("keyup",r)})}}),app.directive("rgKeyPress",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(e){}}t.bind("keypress",r),e.$on("$destroy",function(){t.unbind("keypress",r)})}});var app;app=angular.module("ringid.utils"),app.factory("windowFocusHandler",windowFocusHandler),windowFocusHandler.$inject=["$window","Utils","$$stackedMap"];function windowFocusHandler(e,t,n){var r=n.createNew(),i=function(){r.doForAll(function(e){e.call(null)})};return e.onfocus=i,{add:function(e){var n=t.getUniqueID();return r.add(n,e),n},remove:function(e){return r.remove(e)},fire:function(){i()}}}app.factory("windowBlurHandler",windowBlurHandler),windowBlurHandler.$inject=["$window","Utils","$$stackedMap"];function windowBlurHandler(e,t,n){var r=n.createNew(),i=function(){r.doForAll(function(e){e.call(null)})};return e.onblur=i,{add:function(e){var n=t.getUniqueID();return r.add(n,e),n},remove:function(e){return r.remove(e)},fire:function(){i()}}}!function(e,t){"use strict";e.module("ringid.directives",["ringid.config","ringid.connector","ringid.global_services"])}(angular,window),angular.module("ringid.directives").directive("rgRoundProgress",[function(){var e=function(e,t,n){if(1===e.length){var r,i,o,a,s,c,l,u,d,g,m,f=e[0],E=document.createElement("canvas");return{pre:function(e,t,n,p){var T=(window.outerWidth-20)/1920;r=+(e.roundProgressBarStyle.dataRoundProgressWidth||"200")*T,i=+(e.roundProgressBarStyle.dataRoundProgressHeight||"200")*T,E.setAttribute("width",r),E.setAttribute("height",i),E.setAttribute("data-round-progress-model",f.getAttribute("data-round-progress-model")),f.parentNode.replaceChild(E,f),o=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleWidth||"4")*T,a=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleWidth||"8")*T,d=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleRadius||"85")*T,g=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleRadius||"85")*T,m=+(e.roundProgressBarStyle.dataRoundProgressLabelFont||"24")*T+"px Arial",s=e.roundProgressBarStyle.dataRoundProgressOuterCircleBackgroundColor||"#505769",c=e.roundProgressBarStyle.dataRoundProgressOuterCircleForegroundColor||"#13A8E8",l=e.roundProgressBarStyle.dataRoundProgressInnerCircleColor||"#505769",u=e.roundProgressBarStyle.dataRoundProgressLabelColor||"#fff"},post:function(e,t,n,s){var l=E.getAttribute("data-round-progress-model");e.$watch(l,function(e,t){var n=E.getContext("2d");n.clearRect(0,0,r,i);var s=r/2,l=i/2;n.beginPath(),n.arc(s,l,parseInt(g),0,2*Math.PI,!1),n.lineWidth=parseInt(a),n.strokeStyle="rgba(255,255,255,0.5)",n.globalCompositeOperation="source-over",n.stroke(),n.font=m,n.textAlign="center",n.textBaseline="middle",n.fillStyle=u,n.fillText(e.label+"%",s,l);var f=-(Math.PI/2),p=2*Math.PI*e.percentage-Math.PI/2,T=!1;n.beginPath(),n.arc(s,l,parseInt(d),f,p,T),n.lineWidth=parseInt(o),n.strokeStyle=c,n.stroke()},!0)}}}},t={compile:e,replace:!0};return t}]),angular.module("ringid.directives").directive("rgLoading",rgLoading),rgLoading.$inject=["$rootScope","SystemEvents"];function rgLoading(e,t){return{restrict:"E",template:'<a class="glo-l ng-cloak"> <span class="load-circle"><span class="ld-cir1 glo-cir"></span><span class="ld-cir2 glo-cir"></span><span class="ld-cir3 glo-cir"></span><span class="ld-cir4 glo-cir"></span><span class="ld-cir5 glo-cir"></span><span class="ld-cir6 glo-cir"></span><span class="ld-cir7 glo-cir"></span><span class="ld-cir8 glo-cir"></span><span class="ld-cir9 glo-cir"></span><span class="ld-cir10 glo-cir"></span><span class="ld-cir11 glo-cir"></span><span class="ld-cir12 glo-cir"></span></span><span class="glo-type">Processing...</span></a>',scope:{rgLoadingObj:"="},link:function(n,r){e.$on(t.AUTH.LOGIN,function(){r[0].style.display="none",n.$rgDigest()}),e.$on(t.LOADING,function(e,t){t?r[0].style.display="block":r[0].style.display="none"}),r[0].style.display="none"}}}angular.module("ringid.directives").directive("rgGlobalLoader",rgGlobalLoader);function rgGlobalLoader(){return{restrict:"E",template:'<div id="global-loader" class="rgbubbling"><span id="rgbubbling_1"></span><span id="rgbubbling_2"></span><span id="rgbubbling_3"></span></div>'}}angular.module("ringid.directives").directive("rgEmotion",rgEmotionDirective).directive("rgEmotionDropdown",rgEmotionDropdown),rgEmotionDirective.$inject=["$compile","$document","EmotionFactory"];function rgEmotionDirective(e,t,n){return{restrict:"A",scope:{onSelect:"&"},link:function(r,i){var o;r.active=!1,r.emotionFilterText="";function a(){r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}r.initEMotionList=function(t){n.init(),o||(o=e('<rg-emotion-dropdown filter-text="emotionFilterText" focus-filter="active" on-close="close" on-select="choose"></rg-emotion-dropdown>')(r),i.after(o)),o.css("display",t)},r.choose=function(e,t){r.onSelect({item:e}),r.emotionFilterText="",r.initEMotionList("none",t),r.active=!1,a()};function s(e){e.preventDefault(),r.active?r.initEMotionList("none",e):r.initEMotionList("block",e),r.active=!r.active,a()}i.on("click",s);function c(e){e.target!==i[0]&&e.target.parentNode&&e.target.parentNode!==i[0]&&e.target.parentNode.parentNode!==i[0]&&"pt-top"!==e.target.className&&r.close(e)}t.on("click",c),r.close=function(e){r.active&&(r.initEMotionList("none",e),r.active=!1),a()},r.$on("$destroy",function(){i.off("click",s),t.off("click",c),o=void 0})}}}rgEmotionDropdown.$inject=["EmotionFactory"];function rgEmotionDropdown(e){function t(e){e.stopPropagation()}return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&onClose"},templateUrl:"templates/dropdowns/emotion-dropdown.html",compile:function(){return{pre:function(t){t.emotions={},t.emotions[0]=e.getEmotions(),t.setEmotion=function(e){t.emotions[0]=e,t.$rgDigest()},e.setScopeForDigest(t),t.updateModel=function(e){t.filterText=e.target.value,t.$parent.$rgDigest()},t.loading=!!t.emotions.length,t.choose=angular.isFunction(t.onSelect)?t.onSelect():angular.noop,t.close=angular.isFunction(t.onClose)?t.onClose():angular.noop,t.$on("$destroy",function(){e.removeScope(t)})},post:function(e,n){n.on("click",t),e.$on("$destroy",function(){n.off("click",t)}),e.$rgDigest()}}}}}angular.module("ringid.directives").directive("rgPhotos",rgPhotos),rgPhotos.$inject=["$window","$document","Utils"];function rgPhotos(e,t,n){r.$inject=["rgScrollbarService","$scope","$rootScope","AlbumFactory","$routeParams","userFactory","fileUploadService","SystemEvents","Auth","$ringbox","Ringalert","$$connector","OPERATION_TYPES"];function r(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,f=g.SYSTEM.IMAGE;t.profileObj=o.getUser(i.uId),t.showAlbumPreview=!0,t.activeAlbum=null,t.state=r.state,t.albums=r.getAlbums(i.uId),t.loadMoreImage=p,t.deleteImage=h,t.getImageData=T,t.toggleAlbumPreview=_,t.selectPhoto=I;function E(n,r){"album"===r?t.state.albumsLoading=n:(t.state.imagesLoading=n,e.recalculate(t)),t.$rgDigest()}function p(){!t.state.imagesLoading&&t.activeAlbum.getImages().length()<t.activeAlbum.getTotalImageCount()&&(E(!0,"image"),r.loadMoreImage(t.activeAlbum.getKey(),i.uId))}function T(e){return function(){return{image:e,popupFrom:"profile"}}}function h(e){var n="Are you sure you want to delete?",i=l.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"});i.result.then(function(n){n&&r.deleteImage(e).then(function(n){n.sucs===!0?t.activeAlbum.removeImage(e.getKey()):u("Image delete failed","error"),t.$rgDigest()})})}function _(e){e?(t.activeAlbum=e,t.showAlbumPreview=!1,t.activeAlbum.getImages().length()<20&&t.loadMoreImage()):(t.showAlbumPreview=!0,t.activeAlbum=null),t.$rgDigest()}function I(e){t.forSelection&&n.$broadcast(s.IMAGE.DO_REPOSITION,{image:e.src()})}function A(){m=d.subscribe(function(e){switch(e.actn){case f.TYPE_ALBUM_IMAGES:case f.TYPE_FRIEND_ALBUM_IMAGES:e.sucs===!1&&1111===e.rc?r.fetchAllAlbums(i.uId):(r.processResponse(e),E(!1));break;case f.FETCH_FRIEND_ALBUM_LIST:case f.FETCH_ALBUM_LIST:e.sucs===!1&&1111===e.rc?p():(r.processResponse(e,i.uId),E(!1,"album"))}},{action:[f.TYPE_ALBUM_IMAGES,f.TYPE_FRIEND_ALBUM_IMAGES,f.FETCH_FRIEND_ALBUM_LIST,f.FETCH_ALBUM_LIST]}),E(!0,"album"),r.fetchAllAlbums(i.uId)}A(),t.$on("$destroy",function(){t.albums.reset(),d.unsubscribe(m)})}var i=function(r,i){function o(){r.showAlbumPreview||e.innerHeight+e.scrollY>=t[0].body.offsetHeight&&r.loadMoreImage()}!r.hasOwnProperty("forSelection")||r.forSelection!==!0&&"true"!==r.forSelection?(r.forSelection=!1,e.addEventListener("scroll",o)):(i[0].children[0].children[0].style.overflow="hidden",i[0].children[0].children[0].style.maxHeight=n.viewportsize().y-200+"px"),r.$on("$destroy",function(){e.removeEventListener("scroll",o)}),r.$rgDigest()};return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/photos.html",scope:{forSelection:"@forSelection",$close:"&boxClose"}}}angular.module("ringid.directives").directive("rgHref",["$location","$route","$rootScope",function(e,t,n){function r(r,i){var o=/#/g.exec(r);o=o?r.substr(o.index+1):r,e.path()==o&&"true"===i.reloadpage&&t.reload(),n.$coreDigest()}return function(e,t,n){var i;n.$observe("rgHref",function(e){return i&&t.unbind("click",r),e?(i=angular.bind(null,r,e,n),t.attr("href",e),void t.bind("click",i)):void t.removeAttr("href")}),e.$on("$destroy",function(){i&&t.unbind("click",i)})}}]),angular.module("ringid.directives").filter("userListFilter",userListFilter).directive("rgFriendDropdown",rgFriendDropdown);function userListFilter(){return function(e,t,n){if(e){for(var r,i=[],o=new RegExp(t,"i"),a=0;a<e.length;a++){if(i.length>10)return i;r=e[a].value.getLiteUser(),o.test(r.getName())&&n.indexOf(r)===-1&&i.push(r)}return i}}}rgFriendDropdown.$inject=["friendsFactory","$filter"];function rgFriendDropdown(e,t){return{scope:{filterText:"=",focusFilter:"=",onSelect:"&",onClose:"&",tagItems:"="},templateUrl:function(e,t){return t.templateUrl||"templates/dropdowns/tag-friend-dropdown.html"},compile:function(n,r,i){return{pre:function(n,r,i,o){var a=!1;n.users=[];function s(){n.users=t("userListFilter")(e.friends.all(),n.filterText,n.tagItems),n.activeId>=n.users.length&&(n.activeId=0)}function c(){a||(e.searchContact({schPm:n.filterText},!0).then(function(){n.$rgDigest()}),n.loading=!0,a=!0)}n.$watch(e.friends.length,function(e,t){s(),a&&(n.loading=!1,a=!1)}),n.$watch("filterText",function(e,t){s(),a=!1,n.users.length<5&&t.length<e.length&&c()}),n.$watch("users.length",function(t,r){t<5&&t<r&&(n.filterText.length>0?c():e.getContactDetails()),t>5&&!a&&(n.loading=!1)}),n.loading=!!n.users.length,n.choose=function(e,t){n.onSelect()(e,t),s(),n.$rgDigest()},n.close=angular.isFunction(n.onClose)?n.onClose():angular.noop;var l=!1;n.processKeyup=function(e){if(l)return void e.preventDefault();if(38==e.keyCode||40==e.keyCode){var t=this.selectionStart;this.value=(38==e.keyCode?1:-1)+parseInt(this.value,10),this.selectionStart=t,this.selectionEnd=t,l=!0,setTimeout(function(){l=!1},1),e.preventDefault()}},n.activeId=0,n.setActiveId=function(e){n.activeId=e},r.bind("keydown",function(e,t){t=t||e.which||e.keyCode||e.key,13===t?n.users.length&&(n.choose(n.users[n.activeId],e),n.filterText=""):38===t?n.activeId=Math.max(n.activeId-1,0):40===t&&(n.activeId=Math.min(n.activeId+1,n.users.length-1)),n.$rgDigest()}),r.bind("mouseleave",function(){n.activeId=0})},post:function(e,t,n,r){t.on("click",function(e){e.stopPropagation()}),e.$rgDigest()}}}}}angular.module("ringid.directives").directive("rgHovercard",rgHovercard),rgHovercard.$inject=["$ringhttp","$templateCache","$compile","$window"];function rgHovercard(e,t,n,r){angular.element(document.querySelector("body"));return{scope:!0,link:function(t,r,i){var o;function a(e){var a,s=!1;function c(){s&&o&&(o.off("mouseenter",l),o.off("mouseleave",u),o.remove(),o=void 0),s=!1}function l(){s=!1;
}function u(){s=!0,c()}function d(a){s||(o||(o=angular.element('<div class="fr-menu"></div>'),o.html(e),r.after(o)),i.onHoverStart&&"function"==typeof t[i.onHoverStart]&&t[i.onHoverStart](),n(o)(t),o.css({display:"block"}),o.on("mouseleave",u),o.on("mouseenter",l),t.$rgDigest())}function g(e){s=!0,window.setTimeout(c,500),window.clearTimeout(a),a=!1,r.off("mouseleave",g)}function m(e){a||(a=window.setTimeout(d.bind(this,e),1200)),r.on("mouseleave",g)}r.on("mouseenter",m),t.$on("$destroy",function(){g(),r.off("mouseenter",d),r.off("mouseleave",g)})}"false"!==i.rgHovercard&&e.get(i.hoverTemplateUrl).success(function(e){a(e)}),"false"!==i.rgHovercard&&e.get(i.hoverTemplateUrl).success(function(e){a(e)})}}}angular.module("ringid.directives").directive("rgTagFriend",rgTagFriend),rgTagFriend.$inject=["$compile","$document"];function rgTagFriend(e,t){return{restrict:"A",scope:{onSelect:"&",tagItems:"="},link:function(n,r,i){if("false"===i.rgTagFriend)return void r.parent().remove();var o;n.active=!1,n.filterText="",n.init=function(t,i){o||(o=e('<rg-friend-dropdown tag-items="tagItems" filter-text="filterText" focus-filter="active" on-close="close" on-select="choose"></rg-friend-dropdown>')(n),r.after(o)),n.active=!0},n.choose=function(e,t){n.onSelect({item:e}),n.filterText="",n.$parent&&1!==n.$parent.$id?n.$parent.$rgDigest():$scope.$rgDigest()};function a(e){e.preventDefault(),n.active?(n.close(e),t.off("click",s)):(n.init(e),t.on("click",s))}function s(e){e.target!=r[0]&&e.target.parentNode!=r[0]&&null!=e.target.parentNode&&e.target.parentNode.parentNode!=r[0]&&"pt-top"!=e.target.className&&n.close(e)}r.on("click",a),n.close=function(e){n.active&&(o.off("keydown"),o.remove(),o=void 0,n.active=!1)},n.$on("$destroy",function(){r.off("click",a),t.off("click",s),o&&(o=void 0)})}}}angular.module("ringid.directives").directive("rgImg",rgImg).directive("rgImgChange",rgImgChange);function rgImgChange(){return{restrict:"A",controller:["$element",function(e){this.setPopupStyle=function(t,n){e[0].style.height=t+"px",e[0].style.width=n+"px"}}]}}rgImg.$inject=["$compile","Utils"];function rgImg(e,t){return{restrict:"A",require:"^rgImgChange",scope:{rgImgObj:"="},link:function(n,r,i,o){var a=500,s=500,c=0,l=0,u=300,d=60,g=0,m=0,f=0,E=0,p=e('<img src="'+n.rgImgObj.src()+'" />')(n);g=t.viewport.x-40-u-d,m=t.viewport.y-40-d,c=g-s>s?g-s:s,l=m-a>a?m-a:a,r.append(p),i.$observe("rgImg",function(e){p[0].setAttribute("src",""),p[0].setAttribute("src",e),T(n.rgImgObj.getIh(),n.rgImgObj.getIw())});function T(e,t){e>m||t>g?t/g>=e/m?(f=g,E=Math.floor(g/t*e)):(E=m,f=Math.floor(m/e*t)):(E=e,f=t),p[0].style.width=f+"px",p[0].style.height=E+"px",f<c&&(f=c),E<l&&(E=l),f<c&&(f=c),E<l&&(E=l),f=f+u+d,E+=d,"false"==i.commentsection&&(f-=300),o.setPopupStyle(E,f)}}}}angular.module("ringid.directives").directive("rgSrc",rgSrc);function rgSrc(){return{restrict:"A",link:function(e,t,n){n.rgSrc&&e.$watch(n.rgSrc,function(e){null===e||void 0===e?t.removeAttr("src"):t.attr("src",e)})}}}angular.module("ringid.directives").directive("rgRepeat",rgRepeat),rgRepeat.$inject=["$parse","$rootScope","$animate","SystemEvents"];function rgRepeat(e,t,n,r){function i(i,o){return function(i,o,a,s,c){var l,u,d,g=a.rgRepeat,m=g.match(/^\s*(.+)\s+in\s+(.*?)\s+track\s+by\s+(.+)\s*$/),f=Object.create(null);if(!m)throw"Expected expression in form of '_item_ in _collection track by _key_'";var E=document.createComment(" end rgRepeat: "+g+" ");l=m[1],u=m[2];var p=e(m[3]);d=m[1],i.$watchCollection(u,T);function T(e){var a,s,l,u,g,m,T,h,_,I=e.length,A=o[0],v=Object.create(null);for(t.$$postDigest(function(){var t,n,r;for(t=0;t<e.length;t++)n=e[t],f[n.$TrackID]&&(r=f[n.$TrackID],r.childHead&&(r.scope.$$childHead=r.childHead))}),a=0;a<I;a++)l=e[a],T={},T[d]=l,g=p(i,T),f[g]?(m=f[g],delete f[g]):(u=i.$new(),u[d]=l,m={},m.clone=null,m.scope=u),e[a].$TrackID=g,v[g]=m;for(g in f)if(f[g]){for(m=f[g],s=0;s<m.clone.length;s++)A.parentNode.removeChild(m.clone[s]);m.scope.$destroy()}for(a=0;a<I;a++)l=e[a],g=l.$TrackID,m=v[g],m.scope.$index=a,_=m.clone,_?(h=A,m.startNode!=h&&n.move(m.clone,null,angular.element(A)),A=m.clone[m.clone.length-1],m.childHead=m.scope.$$childHead,m.scope.$$childHead=null):c(m.scope,function(e){var t=E.cloneNode(!1);e[e.length++]=t,n.enter(e,null,angular.element(A)),A=t,m.clone=e,m.startNode=e[0]});i.target&&i.target.getMapKey&&i.$emit(r.FEED.HEIGHT,i.target.getMapKey()),f=v}}}return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:i}}angular.module("ringid.directives").factory("ReportHttpService",ReportHttpService).controller("ReportController",ReportController).directive("rgReport",rgReport),ReportHttpService.$inject=["$$connector","$$q","OPERATION_TYPES","SPAM_TYPES"];function ReportHttpService(e,t,n,r){var i,o=n.SYSTEM.REPORT,a={};i={getSpamReasonList:s,reportSpam:c};function s(i){var s=t.defer();if(!i||"string"!=typeof i)throw new Error("PARAMS_ERROR SPAM_TYPE Must be string");var c=r[i.toUpperCase()];return a[c]?setTimeout(function(){s.resolve(a[c])}):e.pull({actn:o.ACTION_SPAM_REASON_LIST,spmt:c},n.SYSTEM.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?(a[c]=e.rsnLst,s.resolve(a[c])):s.reject(e)},function(e){s.reject(e)}),s.promise}function c(t){if(!t.spmt||!t.spmid||!t.rsnid)throw new Error("PARAMS_ERROR");var i={actn:o.ACTION_REPORT_SPAM,spmt:r[t.spmt],spmid:t.spmid,rsnid:t.rsnid};return e.request(i,n.SYSTEM.REQUEST_TYPE.UPDATE)}return i}ReportController.$inject=["$scope","remoteData","ReportHttpService","Ringalert"];function ReportController(e,t,n,r){e.title="Let us know why that's bothers you !",e.spamList=t,e.reason=e.spamList[0].id,e.report=function(){return e.reason?void n.reportSpam({spmt:e.spamType.toUpperCase(),spmid:e.spamId,rsnid:e.reason}).then(function(t){if(e.$close(),t.sucs){var n={title:"Done!",message:t.mg,showCancel:!1};r.alert(n)}else r.show(t,"error")}):void(e.error="Please choose one reason")}}rgReport.$inject=["$ringbox","ReportHttpService","rgDropdownService","SPAM_TYPES"];function rgReport(e,t,n,r){return{restrict:"EA",scope:{spamId:"=",spamType:"@"},link:function(r,i,o){function a(i){n.close(i);var o=e.open({type:"remote",scope:r,controller:"ReportController",resolve:{remoteData:t.getSpamReasonList(r.spamType)},templateUrl:"templates/popups/rg-report.html"});o.result.then(function(e){})}i.on("click",a)}}}!function(e,t){"use strict";e.module("ringid.notification",["ringid.config","ringid.directives"])}(angular,window),angular.module("ringid.notification").factory("$$notiMap",$$notiMap),$$notiMap.$inject=["OPERATION_TYPES","Utils","settings"];function $$notiMap(e,t,n){var r=e.SYSTEM.NOTIFICATION,i={acId:0,cmnId:0,fndId:0,fndN:"",id:0,imgId:0,loc:0,mt:0,nfId:0,ut:0,nt:0,prIm:0,message:"",updateTime:"",popupType:"",groupId:0,user:null,seen:!1,mayMerge:1,othersCounter:0};function o(e){var t="",n={message:"",popupType:"",mayMerge:1};function i(){var t=e.uIdList.length-1;return t>1?" and "+t+" others ":1===t?" and "+t+" other ":""}switch(e.mt){case r.MSG_TYPE_UPDATE_PROFILE_IMAGE:n.message=" changed profile photo",n.popupType="image",n.mayMerge=2;break;case r.MSG_TYPE_UPDATE_COVER_IMAGE:n.message=" changed cover photo",n.popupType="image",n.mayMerge=2;break;case r.MSG_TYPE_LIKE_IMAGE:n.message=i()+" liked your photo",n.popupType="image";break;case r.MSG_TYPE_IMAGE_COMMENT:n.message=i()+" commented on your photo",n.popupType="image";break;case r.MSG_TYPE_LIKE_IMAGE_COMMENT:n.message=i()+" liked your comment",n.popupType="image";break;case r.MSG_TYPE_ADD_FRIEND:n.message=" wants to be friends with you",n.popupType="profile";break;case r.MSG_TYPE_ACCEPT_FRIEND:n.message=" has accepted your friend request",n.popupType="profile";break;case r.MSG_TYPE_ADD_GROUP_MEMBER:n.message=" has added you in a group "+t,n.popupType="group",n.mayMerge=0;break;case r.MSG_TYPE_ADD_STATUS_COMMENT:n.message=i()+" commented on your post",n.popupType="feed";break;case r.MSG_TYPE_LIKE_STATUS:n.message=i()+" liked your post",n.popupType="feed";break;case r.MSG_TYPE_LIKE_COMMENT:n.message=i()+" liked your comment",n.popupType="feed";break;case r.MSG_TYPE_SHARE_STATUS:n.message=i()+" shared your post",n.popupType="feed";break;case r.MSG_TYPE_LIKE_AUDIO_MEDIA:n.message=i()+" liked your music",n.popupType="media";break;case r.MSG_TYPE_AUDIO_MEDIA_COMMENT:n.message=i()+" commented on your music",n.popupType="media";break;case r.MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:n.message=i()+" liked your comment",n.popupType="media";break;case r.MSG_TYPE_AUDIO_MEDIA_VIEW:n.message=i()+" viewed your music",n.popupType="media";break;case r.MSG_TYPE_LIKE_VIDEO_MEDIA:n.message=i()+" liked your video",n.popupType="media";break;case r.MSG_TYPE_VIDEO_MEDIA_COMMENT:n.message=i()+" commented on your video",n.popupType="media";break;case r.MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:n.message=i()+" liked your comment",n.popupType="media";break;case r.MSG_TYPE_VIDEO_MEDIA_VIEW:n.message=i()+" viewed you video",n.popupType="media";break;case r.MSG_TYPE_YOU_HAVE_BEEN_TAGGED:n.message=" tagged you in a status",n.popupType="feed";break;default:n.popupType="nomatch",n.mayMerge=0}return n}function a(e){this.updateNoti(e),e=null}return a.prototype={updateNoti:function(e){var n;angular.isObject(e)&&(this.noti?angular.extend(this.noti,e):(this.noti=angular.extend({},i,e),this.noti.uIdList=[]),this.noti.updateTime=t.verbalDate(this.noti.ut)||this.noti.ut,n=o(this.noti),this.noti.message=n.message,this.noti.popupType=n.popupType,this.noti.mayMerge=n.mayMerge,this.noti.fndId&&this.noti.uIdList.push(this.noti.fndId)),e=null},sortBy:function(){return this.noti.ut},getName:function(){return this.noti.fndN},isInUidList:function(e){return this.noti.uIdList.indexOf(e)>-1},uIdList:function(e){if(!e||!e.length)return this.noti.uIdList;for(var t=0;t<e.length;t++)this.noti.uIdList.indexOf(e[t])===-1&&this.noti.uIdList.push(e[t])},getUid:function(){return this.noti.fndId},getUserAvatar:function(){if(this.noti.user)return this.noti.user.avatar("thumb");if(this.noti.prIm){var e=this.noti.prIm.lastIndexOf("/")+1;return[n.imBase,this.noti.prIm.slice(0,e),"pthumb",this.noti.prIm.slice(e)].join("")}return"images/prof.png"},getMessage:function(){return this.noti.message},getTime:function(e){return e?this.noti.ut:this.noti.updateTime},updateNotiTime:function(){this.noti.updateTime=t.verbalDate(this.noti.ut)},getKey:function(){return this.noti.id},getPopupType:function(){return this.noti.popupType},getMessageType:function(){return this.noti.mt},getNotiType:function(){return this.noti.nt},getActivityId:function(){return this.noti.acId},getNewsFeedId:function(){return this.noti.nfId},getLink:function(){var e="",n={};switch(this.noti.popupType){case"image":n.mediaId=this.noti.imgId,this.noti.cmnId&&(n.commentId=this.noti.cmnId),e=t.getRingRoute("SINGLE_IMAGE",n);break;case"media":n.mediaId=this.noti.imgId,this.noti.cmnId&&(n.commentId=this.noti.cmnId),e=t.getRingRoute("SINGLE_MEDIA",n);break;case"profile":e=t.getRingRoute("USER_PROFILE",{uId:this.noti.fndId});break;case"group":e=t.getRingRoute("CIRCLE_HOME",{circleId:this.noti.acId});break;case"feed":n.feedId=this.noti.nfId,this.noti.cmnId&&(n.commentId=this.noti.cmnId),e=t.getRingRoute("SINGLE_FEED",n);break;default:e=""}return e},getImgId:function(){return this.noti.imgId},getCommentId:function(){return this.noti.cmnId},getSeenStatus:function(){return this.noti.seen},updateSeenStatus:function(e){this.noti.seen=e},canMerge:function(){return this.noti.mayMerge},setNotiMessage:function(e){this.noti.othersCounter+=e;var t=o(this.noti);this.noti.message=t.message},getRingboxTemplate:function(){var e="";switch(this.noti.popupType){case"image":e="templates/partials/notification/image-popup.html";break;case"media":e="templates/partials/notification/media-popup.html";break;case"feed":e="templates/partials/notification/feed-popup_with_image.html";break;default:e=""}return e},getControllerName:function(){return"image"===this.noti.popupType&&"RingBoxImageController"||"feed"===this.noti.popupType&&"NotiPopupController"||"media"===this.noti.popupType&&"RingBoxMediaController"},showRingbox:function(){return"feed"===this.noti.popupType||"image"===this.noti.popupType||"media"===this.noti.popupType}},function(e){return new a(e)}}angular.module("ringid.notification").service("notificationHttpService",notificationHttpService),notificationHttpService.$inject=["$$connector","settings","OPERATION_TYPES"];function notificationHttpService(e,t,n){var r=this,i=n.SYSTEM.NOTIFICATION,o=n.SYSTEM.REQUEST_TYPE;r.requestNotification=function(t){var n={actn:i.TYPE_MY_NOTIFICATIONS};t&&t.from_index>0&&(n=angular.extend({},n,t)),e.send(n,o.REQUEST)},r.clearNotiCount=function(){var t=new Date,n=t.getTime(),r={actn:i.CLEAR_NOTIFICATION_COUNTER,ut:n};return e.request(r,o.REQUEST)},r.getNotificationDetails=function(t){var r={actn:n.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:t.activityId};return e.request(r,o.REQUEST)},r.getImageAlbumDetails=function(t){var r={actn:n.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,request_type:o.REQUEST,imgId:t.imgId};return e.request(r,o.REQUEST)}}angular.module("ringid.notification").factory("NotificationFactory",NotificationFactory),NotificationFactory.$inject=["$$connector","$q","Storage","notificationHttpService","$$stackedMap","$$notiMap","OPERATION_TYPES","$rootScope","SystemEvents","Auth"];function NotificationFactory(e,t,n,r,i,o,a,s,c,l){var u=i.createNew(!0,"desc"),d=!1,g=a.SYSTEM.NOTIFICATION,m=0,f=0,E=-1,p={loading:!1,noMoreData:!1},T=function(e){var t,r=!0;function i(e){function n(n){e.value.getTime(!0)<t.getTime(!0)?(f=f>0?f-1:0,t.uIdList(e.value.uIdList()),t.setNotiMessage(),u.remove(e.value.getKey())):(r=!1,e.value.uIdList(t.uIdList()),e.value.setNotiMessage())}if(e.value.getMessageType()===t.getMessageType())if(1===e.value.canMerge())switch(e.value.getPopupType()){case"feed":e.value.getNewsFeedId()===t.getNewsFeedId()&&n(e.value.isInUidList(t.getUid())?!1:!0);break;case"image":case"media":e.value.getImgId()===t.getImgId()&&n(e.value.isInUidList(t.getUid())?!1:!0)}else 2===e.value.canMerge()&&e.value.getUid()===t.getUid()&&n(!1)}switch(e.actn){case g.TYPE_MY_NOTIFICATIONS:if(e.sucs===!0||"true"===e.sucs){var a=[];m+=e.nList.length;var s=parseInt(n.getData("oldNotiCount"));s>e.tn?(f=e.tn,n.setData("oldNotiCount",0)):f=e.tn-s;for(var c=0;c<e.nList.length;c++){r=!0,t=o(e.nList[c]),u.all().forEach(i),a.push(e.nList[c].ut);var l=n.getData("notiseen");if(r){for(var d=0;d<l.length;d++)l[d]===e.nList[c].id&&t.updateSeenStatus(!0);u.save(t.getKey(),t)}}var T=a.sort();E=T[0]||E}else e.sucs===!1&&1111===e.rc?h():p.noMoreData=!0;break;case g.TYPE_SINGLE_NOTIFICATION:m++,r=!0,t=o(e),u.all().forEach(i),r&&u.save(t.getKey(),t),f++}},h=function(e){e=e||10;var t={from_index:m>0?m:0,to_index:m>0?m+e:e,scl:2,ut:E};r.requestNotification(t)};function _(t){d&&!t||(d=!0,e.subscribe(T,{action:[g.TYPE_MY_NOTIFICATIONS,g.TYPE_SINGLE_NOTIFICATION]}),h())}return{init:_,state:p,loadMoreNoti:h,process:T,getNotifications:function(){return u},getNotification:function(e){return u.get(e)},clearCounter:function(){f>0&&(n.setData("oldNotiCount",f+parseInt(n.getData("oldNotiCount"))),f=0);for(var e=0;e<u.length();e++){var t=Date.now()-u.all()[e].value.sortBy();t<36e5&&u.all()[e].value.updateNotiTime()}},getNotiCount:function(){return f>99?"99+":f}}}angular.module("ringid.notification").directive("rgNotification",rgNotification),rgNotification.$inject=["$window","$document","$ringhttp","$compile"];function rgNotification(e,t,n,r){i.$inject=["NotificationFactory","$location","AlbumFactory","Auth","rgDropdownService","Ringalert","Storage","$scope","rgScrollbarService","OPERATION_TYPES","$$connector","notificationHttpService","SystemEvents","Api"];function i(e,t,n,r,i,o,a,s,c,l,u,d,g,m){var f,E=parseInt(s.loadCount),p=l.SYSTEM.NOTIFICATION;s.state=e.state,s.notifications=e.getNotifications(),s.loadMoreNotification=I,s.getRingboxData=T,s.notificationAction=e.notificationAction;function T(e){switch(e.value.getPopupType()){case"image":return h({action:"image",noti:e.value,nfId:e.value.getNewsFeedId(),imgId:e.value.getImgId(),templateType:"image"});case"media":return h({action:"media",noti:e.value,nfId:e.value.getNewsFeedId(),mediaId:e.value.getImgId(),templateType:"media"});case"feed":return h({action:"ringbox",nfId:e.value.getNewsFeedId(),noti:e.value,templateType:"feed_with_text"})}}function h(e){var i=a.getData("notiseen");switch(i||(i=[],a.setData("notiseen",i)),i.indexOf(e.noti.getKey())===-1&&(i.push(e.noti.getKey()),e.noti.updateSeenStatus(!0),i.length>150&&i.shift()),a.setData("notiseen",i),e.action){case"redirect":if(circle){var s=e.link.slice(1);t.path(s)}else o.show("Circle does not exist!","error");break;case"ringbox":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,templateType:e.templateType}},promise:d.getNotificationDetails({activityId:e.nfId})};case"media":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,mediaId:e.mediaId,popupFrom:"notification",templateType:e.templateType}},promise:m.media.fetchDetails({cntntId:e.mediaId,utId:r.currentUser().getUtId()})};case"image":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,imgId:e.imgId,popupFrom:"notification",templateType:e.templateType}},promise:n.getImageDetails(e.imgId,e.nfId)}}}function _(e){s.state.loading=e,e||(c.recalculate(s),s.$emit(g.FEED.HEIGHT)),s.$rgDigest()}function I(){s.state.loading||s.state.noMoreData||(_(!0),e.loadMoreNoti(E))}E>20&&s.$emit(g.FEED.HEIGHT),s.notifications.length()<E&&I();var A=u.subscribe(function(){f||(f=setTimeout(function(){f=null,_(!1)},200))},{action:[p.TYPE_MY_NOTIFICATIONS,p.TYPE_SINGLE_NOTIFICATION]});s.$on("$destroy",function(){u.unsubscribe(A)})}function o(e,t,i){var o=i.templateUrl?i.templateUrl:"templates/dropdowns/notification-dropdown.html";n.get(o).success(function(n){t.append(r(n)(e)),e.$rgDigest()})}return{restrict:"AE",controller:i,scope:{loadCount:"@",templateUrl:"@"},link:o}}angular.module("ringid.notification").controller("NotiPopupController",NotiPopupController),NotiPopupController.$inject=["$$connector","OPERATION_TYPES","Auth","$scope","localData","remoteData","NotificationFactory","$$feedMap","feedFactory","rgDropdownService","Ringalert","MESSAGES"];function NotiPopupController(e,t,n,r,i,o,a,s,c,l,u,d){var g=(t.SYSTEM,t.SYSTEM.NOTIFICATION,!0);if(r.currentUser=n.currentUser(),r.feed={},r.focused=!1,r.showCommentBox=!0,r.showFeedFullContent=!0,r.nocontent=!1,r.ddHtml="templates/dropdowns/feed-edit-dropdown.html",r.getMediaData=E,i&&i.notiKey&&(r.key=i.notiKey,r.noti=i.noti,r.templateType=i.templateType),r.boxIsLoading=!1,o.sucs===!1)return r.nocontent=!0,u.show(o,"error"),r.$close(),!1;var m=angular.fromJson(o.newsFeedList);if(g&&m[0]&&m[0].orgFd){r.feed=s.create(m[0]);var f=s.create(m[0].orgFd);r.feed.shares(f)}else r.feed=s.create(o.newsFeedList[0]);r.keyid=r.feed&&r.feed.getKey(),(r.feed.hasMedia()||r.feed.hasSharedFeed()&&r.feed.getOrginalFeed().getImages().length)&&(r.templateType="feed_with_image"),r.noti.getCommentId()>0&&(r.activeCommentId=r.noti.getCommentId());function E(e,t){return t||(t=r.feed),{data:function(){return{media:e,album:t.getAlbum(),feedTime:t.time()}},promise:e.fetchDetails()}}r.shareMenuDisabled=!!r.shareMenuDisabled&&r.shareMenuDisabled;r.toggleCommentBox=function(e){e.stopPropagation(),r.showCommentBox=!r.showCommentBox,r.showCommentBox&&(r.showShareBox=!1)},r.toggleShareBox=function(e){e.stopPropagation();var t=r.feed.hasSharedFeed()?r.feed.getOrginalFeed():r.feed,n=t.isShareAble(!0);n.sucs?(r.showShareBox=!r.showShareBox,r.showShareBox&&(r.showCommentBox=!1)):u.show(d[n.rc],"warning")},r.getImageData=function(e,t){return function(){return{image:e,feed:t}}}}angular.module("ringid.notification").controller("ImageController",["$routeParams","$scope","Auth","$$imageMap","$$stackedMap","AlbumFactory","$$connector","OPERATION_TYPES",function(e,t,n,r,i,o,a,s){var c,l,u=i.createNew(),d=s.SYSTEM.IMAGE;t.showCommentBox=!0,t.nextImg=!1,t.prevImg=!1,t.changeImage=m,t.openRingboxLike=g,t.actionImageDropdown=angular.noop,t.showOption=function(){return t.image.ddControl.showReportButton()},t.ddTemplate='<div class="ng-cloak action-top feed-drop_top float-right"><div class="ac-top-line" ng-if="ddControl.showReportButton()"><span class="report-ico"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div>',"</div>";function g(){return t.image&&t.image.getLikes()>0}function m(n){"next"===n?"profile"===t.params.popupFrom?u.previous(t.image.getKey())?t.image=u.next(t.image.getKey())||u.bottom():o.loadMoreImage(t.image.getAlbumId(),e.uId):t.image=u.next(t.image.getKey())||u.bottom():t.image=u.previous(t.image.getKey())||u.top(),p(n),t.$rgDigest()}function f(n){if(n)o.getFeedImages(n).then(function(e){if(e.sucs===!0){for(var n,i=e.newsFeedList[0].imageList,o=0,a=i.length;o<a;o++)i[o].nfId=e.nfId,i[o].imgId===t.image.getKey()?(t.image.updateImage(i[o]),u.save(t.image.getKey(),t.image)):(n=r(i[o],t.feed.user()),u.save(n.getKey(),n));E()}});else{var i=o.getAlbums(e.uId);u=i.get(t.image.getAlbumId()).getImages(),E()}}function E(){u.length()>1&&(t.nextImg=!!u.next(t.image.getKey())||!!u.bottom(),t.prevImg=!!u.previous(t.image.getKey())||!!u.top()),t.$rgDigest()}function p(e){var n,r=new Image;n="next"===e?u.next(t.image.getKey()):u.previous(t.image.getKey()),setTimeout(function(){r.src=n?n.src():""},200)}function T(){l=a.subscribe(function(e){t.image&&t.image.getKey()===e.imgId&&(t.image.setTotalComment(e.loc),t.$rgDigest())},{action:[d.TYPE_UPDATE_ADD_IMAGE_COMMENT,d.TYPE_UPDATE_DELETE_IMAGE_COMMENT]}),c=a.subscribe(function(n){n.sucs===!0&&(u=o.getAlbums(e.uId).get(t.image.getAlbumId()).getImages(),t.image=u.next(t.image.getKey())||u.bottom(),t.$rgDigest())},{action:[d.TYPE_ALBUM_IMAGES,d.TYPE_FRIEND_ALBUM_IMAGES]}),t.params.image?t.image=t.params.image:t.params.imgId&&(t.remoteData?t.image=t.remoteData:o.getImageDetails(t.params.imgId).then(function(e){t.image=e,t.$rgDigest()})),t.params.feed&&(t.feed=t.params.feed,f(t.feed.getKey())),"profile"===t.params.popupFrom&&f(),t.$rgDigest()}T(),t.$on("$destroy",function(){l&&a.unsubscribe(l),a.unsubscribe(c)})}]),angular.module("ringid.notification").controller("MediaController",MediaController),MediaController.$inject=["APP_CONSTANTS","fileUploadService","$routeParams","$scope","Auth","rgDropdownService","Media","$$connector","OPERATION_TYPES","Ringalert","feedFactory","$ringbox","$$mediaMap"];function MediaController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,f=c.SYSTEM.MEDIA;r.currentUser=i.currentUser(),r.showCommentBox=!0,r.changeMedia=_;var E=function(){window.FB&&window.FB.ui({method:"share",href:r.media.getEmbedUrl()},function(e){})};r.actionImageDropdown=function(e){"shareToFb"==e.action&&E()},r.showOptionMenu=function(){return r.media.ddControl.showReportButton()||r.media.ddControl.showAddToAlbum()||r.media.ddControl.showMediaShareButton()},r.ddTemplate='<div class="ng-cloak action-top vp-position float-right"><div class="ac-top-line" ng-if="ddControl.showReportButton()"><span class="report-ico"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div><div class="ac-top-line" ng-if="ddControl.showAddToAlbum()"><span class="share-ico"></span><a rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true"ringbox-type="remote" ringbox-target="templates/dropdowns/popup-album-dropdown.html" ringbox-data="ddControl.getRingboxData()">Add to Album</a></div> <div class="ac-top-line" ng-if="ddControl.showMediaShareButton()"><span class="share-ico"></span><a href="javascript:void(0);"  rg-click="ddAction()({event: $event, action:\'shareToFb\' })"   >Share in Facebook</a></div> </div>',r.params&&"notification"===r.params.popupFrom?r.remoteData&&r.remoteData.sucs?(r.media=g(r.remoteData.mdaCntntDTO),r.album=a.getAlbum(r.media.getAlbumId())):r.$close():(r.media=r.params.media,r.playlist=r.params.playlist),r.media&&!r.media.owner().hasDetails()&&r.media.owner().requestUserDetails().then(function(){r.$rgDigest()});function p(){r.media.setMediaToken().then(function(){r.$rgDigest()})}function T(){r.media.increaseView().then(function(){r.$rgDigest()},function(){r.$rgDigest()}),p()}r.selectAlbum=h;function h(e){return{data:function(){return{media:e}}}}function _(e){r.media=e,r.media.fetchDetails(),T(),r.$rgDigest()}r.shareMedia=function(){var e=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:r.media},onBackDropClickClose:!0,templateUrl:"templates/home/share-media.html"});e.result.then(function(){r.$rgDigest()})},m=s.subscribe(function(e){r.media&&r.media.getKey()===e.cntntId&&r.media.setTotalComment(e.loc)},{action:[f.ACTION_UPDATE_ADD_MEDIA_COMMENT,f.ACTION_UPDATE_DELETE_MEDIA_COMMENT]}),r.$on("$destroy",function(){m&&s.unsubscribe(m)})}angular.module("ringid.notification").controller("RingBoxImageController",RingBoxImageController),RingBoxImageController.$inject=["$scope","$boxInstance","$controller","localData","remoteData","feedFactory"];function RingBoxImageController(e,t,n,r,i,o){e.close=t.close,r&&r.imgId&&(e.templateType=r.templateType),e.params=r,e.remoteData=i,r.noti&&r.noti.getCommentId()>0&&(e.activeCommentId=r.noti.getCommentId()),n("ImageController",{$scope:e})}angular.module("ringid.notification").controller("RingBoxMediaController",RingBoxMediaController),RingBoxMediaController.$inject=["$scope","$boxInstance","$controller","localData","remoteData","Media"];function RingBoxMediaController(e,t,n,r,i,o){e.close=a,r&&r.mediaId&&(e.templateType=r.templateType),e.params=r,e.remoteData=i,n("MediaController",{$scope:e}),e.destroyPlayer=angular.noop;function a(){e.destroyPlayer(),t.close()}}!function(e,t){"use strict";e.module("ringid.friend",["ringid.config","ringid.shared"])}(angular,window),angular.module("ringid.friend").directive("rgFriends",rgFriends),rgFriends.$inject=["friendsFactory","$ringhttp","$compile","$routeParams","$window","$document","Contacts","APP_CONSTANTS"];function rgFriends(e,t,n,r,i,o,a,s){c.$inject=["$scope","$attrs","$document","rgScrollbarService","Contacts","userFactory","$$stackedMap","rgDropdownService","$$connector","OPERATION_TYPES","Ringalert","Api"];function c(t,n,i,o,a,s,c,l,u,d,g,m){var f,E,p=d.SYSTEM.FRIENDS,T=0,h=!0,_=[];t.isOwner=!1,t.showMutual=!1,t.showPending=!1,t.friendName="",t.state={loading:!1,noData:!1},t.friends=e.getFriends(t.rgFriendsType),t.totalFriends=e.totalFriends,t.getPendingCount=e.getPendingCount,t.toggleShowMutual=I,t.toggleShowPending=A,t.loadMoreFriends=D,t.getMutualFriend=M,t.searchContact=C,t.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),g.show("Coming soon","info")};function I(e){t.showMutual=!!e,t.showMutual&&v(),t.$rgDigest()}function A(n){t.showPending=!!n,t.showPending?(t.friends=e.getFriends("outgoing"),S(!0),e.getContactDetails("outgoing").then(function(){S(!1)},function(){S(!1)})):t.friends=e.getFriends(t.rgFriendsType),t.$rgDigest()}function v(){var n;_.length>0&&(S(!0),e.getContactDetailsByUtIds(_.splice(0,10),!0).then(function(e){if(e.sucs===!0)for(var r=0;r<e.contacts.length;r++)n=s.create(e.contacts[r]),t.friends.save(n.getKey(),n);S(!1)},function(e){e.sucs===!1&&1111===e.rc?v():S(!1)}))}function S(e){t.state.loading=!!e,e||o.recalculate(t),t.state.loading||(t.state.noData=0===t.friends.length()&&0===a.utIds().length()),t.$rgDigest()}function C(){("friends"===t.rgFriendsType||"friendslist"===t.rgFriendsType)&&t.friendName&&t.friendName.length>0&&(S(!0),e.searchContact({schPm:t.friendName},!0).then(function(){S(!1)},function(){S(!1)}))}function D(n){var r,i;t.showMutual?v():t.showPending?(S(!0),e.getContactDetails("outgoing").then(function(){S(!1)},function(){S(!1)})):(n||!t.state.loading&&t.friends.length()!==t.totalFriends(t.rgFriendsType))&&(S(!0),"userfriends"===t.rgFriendsType?(r=e.getUserContacts,i=t.profileObj.getUtId()):r=e.getContactDetails,r(i).then(function(){t.friends.length()<20&&t.friends.length()<t.totalFriends(t.rgFriendsType)?(S(!1),D()):S(!1)},function(e){e.sucs===!1&&1111===e.rc?D(n):"friendslist"===t.rgFriendsType&&T<5?(T++,setTimeout(function(){D(n)},2e3)):S(!1)}))}function M(e){return{data:function(){return{target:e}},promise:m.user.getMutualFriends(e)}}function y(){t.ddTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event: $event})" href="#"> <span class="img_sprite w-h-13 icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" class="border-0" href="#"><span class="img_sprite w-h-13 icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" class="border-0" href="#"><span class="img_sprite w-h-13 icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a></div>',t.ddAction=function(n){n.friend.isLoading()||(e.friendAction(n,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),l.close(n.event))},t.showBackKey=0,t.showBack=function(e,n){var r=n.target.getAttribute("data-is-anchor");r||(t.showBackKey=e,n.preventDefault(),n.stopPropagation(),t.$rgDigest())}}function N(){switch(E=u.subscribe(function(e){switch(e.actn){case p.TYPE_CONTACT_UTIDS:"friends"!==t.rgFriendsType&&"friendslist"!==t.rgFriendsType||!h||(h=!1,setTimeout(function(){a.utIds().length()>0&&t.friends.length()<20&&D(!0),t.state.noData=0===t.friends.length()&&0===a.utIds().length()},1e3));break;default:S(!1)}},{action:[p.TYPE_CONTACT_UTIDS,p.TYPE_UPDATE_ADD_FRIEND,p.TYPE_UPDATE_DELETE_FRIEND],callWithUnresolved:!0}),t.rgFriendsType){case"friendslist":break;case"friends":e.initFriends(),t.isOwner=!0,t.pendingRequests=e.getFriends("outgoing"),y(),f=setTimeout(t.toggleLoading,6e4);break;case"userfriends":y(),t.totalUserFriends=e.totalUserFriends,t.profileObj=s.getUser(r.uId),D(!0),m.user.getMutualFriends(t.profileObj).then(function(e){e.sucs===!0&&(t.profileObj.updateUserObj({nmf:e.mfIDs.length}),_=e.mfIDs,t.$rgDigest())}),f=setTimeout(t.toggleLoading,6e4)}}N(),t.$on("$destroy",function(){clearTimeout(f),"userfriends"===t.rgFriendsType&&e.resetUserFriends(),u.unsubscribe(E)})}function l(r,c,l){var u;t.get(l.rgFriendsTpl).success(function(e){c.append(n(e)(r)),r.$rgDigest()});function d(){i.innerHeight+i.scrollY>=o[0].body.offsetHeight&&r.loadMoreFriends()}"friends"!==r.rgFriendsType&&"userfriends"!==r.rgFriendsType||angular.element(i).on("scroll",d),r.$on("$destroy",function(){switch(r.rgFriendsType){case"friends":u=e.outgoingFriends.keys();for(var t=0;t<u.length;t++)a.add("outgoingUtIds",u[t],{frnS:s.INCOMING_FRIEND});e.outgoingFriends.reset();case"userFriends":angular.element(i).off("scroll",d)}})}return{restrict:"AE",scope:{rgFriendsType:"@"},controller:c,link:l}}angular.module("ringid.friend").directive("rgRequests",rgRequests),rgRequests.$inject=["friendsFactory","$compile","$routeParams","$window","$document","$ringhttp"];function rgRequests(e,t,n,r,i,o){a.$inject=["$scope","Api","rgScrollbarService","Contacts","OPERATION_TYPES","$$connector","userFactory","Ringalert","SystemEvents"];function a(t,n,r,i,o,a,s,c,l){var u,d=o.SYSTEM.FRIENDS,g=parseInt(t.loadCount);t.state={loading:!1,noMoreData:!1},t.requests=e.getFriends("incoming"),t.getRequestCount=e.getRequestCount,t.friendAction=m,t.loadMoreRequests=E,t.getMutualFriend=p;function m(n){n.friend.isLoading()||e.friendAction(n,!0).then(function(){t.requests.length()<g&&E(),t.$rgDigest()},function(){t.requests.length()<g&&E(),t.$rgDigest()})}function f(e){t.state.loading=e,e||(t.state.noMoreData=0===i.incomingUtIds().length(),r.recalculate(t),t.$emit(l.FEED.HEIGHT)),t.$rgDigest()}function E(n){(n||!t.state.noMoreData&&!t.state.loading)&&(f(!0),
e.getContactDetails("incoming",g).then(function(){f(!1)},function(e){e.sucs===!1&&1111===e.rc?E(!0):f(!1)}))}function p(e){return{data:function(){return{target:e}},promise:n.user.getMutualFriends(e)}}function T(){g>20&&t.$emit(l.FEED.HEIGHT),i.incomingUtIds().length()>0&&t.requests.length()<g&&E(!0),u=a.subscribe(function(e){switch(e.actn){case d.TYPE_CONTACT_UTIDS:i.incomingUtIds().length()>0&&t.requests.length()<g&&E(!0);break;default:f(!1)}},{action:[d.TYPE_CONTACT_UTIDS,d.TYPE_UPDATE_ADD_FRIEND,d.TYPE_UPDATE_DELETE_FRIEND]})}T(),t.$on("$destroy",function(){a.unsubscribe(u)})}function s(e,n,r){var i=r.templateUrl?r.templateUrl:"templates/dropdowns/friend-request-dropdown.html";o.get(i).success(function(r){n.append(t(r)(e)),e.$rgDigest()})}return{restrict:"AE",scope:{loadOnScroll:"@",loadCount:"@",templateUrl:"@"},link:s,controller:a}}!function(e,t){"use strict";e.module("ringid.header",["ringid.config","ringid.auth","ringid.shared","ringid.notification","ringid.friend","ringid.chat"])}(angular,window),angular.module("ringid.header").controller("HeaderController",HeaderController),HeaderController.$inject=["$scope","$rootScope","$location","rgDropdownService","$$connector","OPERATION_TYPES","friendsFactory","NotificationFactory","Auth","rgScrollbarService","chatHistoryFactory","Utils","SystemEvents"];function HeaderController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m=this,f=o.SYSTEM,E=h();m.getActiveMenu=_,m.logout={ddHtml:"templates/dropdowns/logout-dropdown.html",ddControl:c,ddAction:function(){r.close(),c.logout()},ddOpened:function(){h("logout")},ddBeforeClose:function(){h("")}},m.freq={ddTemplate:'<rg-requests load-on-scroll="true" load-count="10" ></rg-requests>',ddOpened:function(){h("friend_request")},ddBeforeClose:function(){h("")}},m.requestCount=a.getRequestCount,setTimeout(a.initFriends,2e3),m.chatHistory={ddHtml:"templates/partials/chat/chat-history-dropdown.html",ddOpened:function(){u.resetConversationCount(),h("chat_history"),d.triggerCustomEvent(g.CHAT.CONVERSATION_COUNT_RESETED)},ddBeforeClose:function(){h("")}},m.unreadChatConversationCount=u.getUnreadConversationCount,d.onCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){e.$rgDigest()}),m.noti={ddTemplate:'<rg-notification load-count="10" template-url="templates/dropdowns/notification-dropdown.html"></rg-notification>',ddOpened:function(){s.clearCounter(),h("notification")},ddBeforeClose:function(){h("")}},m.notiCount=s.getNotiCount;var p=i.subscribe(function(){setTimeout(function(){e.$rgDigest()},200)},{action:[f.FRIENDS.TYPE_UPDATE_ADD_FRIEND,f.FRIENDS.TYPE_UPDATE_DELETE_FRIEND,f.NOTIFICATION.TYPE_MY_NOTIFICATIONS,f.NOTIFICATION.TYPE_SINGLE_NOTIFICATION]});setTimeout(s.init,5e3),e.hideColumn=!1;function T(){var t=n.path();"/"===t?e.hideColumn=!1:e.hideColumn=!0}t.$on("$routeChangeStart",function(e){T()}),T();function h(t){E=t&&""!==t?t:"/"===n.path()?"home":"none",e.$rgDigest()}function _(){return E}m.defaultSpan=d.getDefaultColumn,t.$on("$routeChangeStart",function(){h(),i.unsubscribe(p)}),e.$on(g.COMMON.WINDOW_RESIZED,function(){e.$rgDigest()}),e.$on(g.FRIEND.PENDING_FRIENDS_COUNT_CHANGED,function(){e.$rgDigest()})}angular.module("ringid.header").service("rgSearchService",rgSearchService).directive("rgSearch",rgSearch),rgSearchService.$inject=["GlobalEvents"];function rgSearchService(e){var t=this,n=!1,r=!1;t.close=function(){r&&(n.searchText="",r.style.display="none",n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))},t.open=function(i,o){r=i,n=o,r.style.display="block",e.bindHandler("document","click",t.close)}}rgSearch.$inject=["rgSearchService"];function rgSearch(e){var t=function(t,n){var r=n.find("input");t.template=n[0].querySelector("#search-dropdown"),t.template.style.display="none",r.on("keypress",function(e){13===e.keyCode&&e.preventDefault()}),t.doTheSearch=function(){t.searchText.length>0?t.doSearch():e.close()};function i(e){"a"!==e.target.tagName.toLowerCase()&&"a"!==e.target.parentNode.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation()}n.on("click",i),t.$on("$destroy",function(){n.off("click",i)})};n.$inject=["$scope","$$stackedMap","userFactory","friendsFactory","friendsHttpService","$timeout","rgScrollbarService","Api"];function n(t,n,r,i,o,a,s,c){var l,u,d=0,g="";t.searchText="",t.gotAllResult=!1,t.showLoadbar=!1,t.noResult=!0,t.listData=n.createNew(),t.resetSearch=function(){d=0,t.noResult=!1,t.gotAllResult=!1,t.listData.reset(),t.$rgDigest()},t.contactListAction=function(e){e.friend.isLoading()||(i.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())},t.doSearch=E,t.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:c.user.getMutualFriends(e)}};function m(){g!==t.searchText&&(t.resetSearch(),d=0)}function f(){t.noResult=0===t.listData.length(),t.gotAllResult=t.listData.length()>0,t.showLoadbar=!1,t.$rgDigest()}function E(n){m(),(n||!t.showLoadbar&&!t.gotAllResult)&&(clearTimeout(u),t.showLoadbar=!0,t.showDropdown||e.open(t.template,t),g=t.searchText,o.searchContact({schPm:t.searchText,st:t.listData.length()}).then(p,p),u=setTimeout(f,8e3),t.$rgDigest())}function p(e){if(clearTimeout(u),e.sucs===!0){for(var n=0,i=e.searchedcontaclist.length;n<i;n++)l=r.create(e.searchedcontaclist[n]),l&&t.listData.save(l.getKey(),l);e.searchedcontaclist.length>0&&s.recalculate(t),t.showLoadbar=!1,t.noResult=0===t.listData.length(),t.$rgDigest()}else d++,d<3?E(!0):(clearTimeout(u),f())}}return{restrict:"E",scope:{placeholder:"@"},templateUrl:"templates/dropdowns/search-dropdown.html",link:t,controller:n}}!function(e,t){"use strict";e.module("ringid.feed",["ngWebSocket","ringid.utils","ringid.config","ringid.connector","ringid.directives"])}(angular,window),angular.module("ringid.feed").directive("rgFeedSubscriber",rgFeedSubscriber),rgFeedSubscriber.$inject=["$$connector","feedFactory","$window","$$rgsyncher","OPERATION_TYPES","REASON_CODES","$rootScope"];function rgFeedSubscriber(e,t,n,r,i,o,a){return function(n,s,c){var l=n.$parent,u=0,d=(i.SYSTEM,!1),g=!1;function m(e){var n;g||(g=!0,l.addIgnore(),setTimeout(function(){a.$broadcast("FIRST_FEED_RECEIVED")},1e3)),!e.sucs&&e.rc>0&&e.rc==o.NO_MORE_FEED?l.setNoMoreFeed(!0):1111===e.rc?l.feeds.length||t.initFeedRequest(l.params):n=t.process(e),n?n.$rgDigest():(u++,l.feeds=t.getFeeds(),l.busy&&(l.busy=!1,l.clearRequestTimer()),d===!1&&(d=!0,requestAnimationFrame(function(){l.$rgDigest(),d=!1})))}var f=e.subscribe(m,{filter:t.getFeedFilter(),callWithUnresolved:!0}),E=r.add(function(){t.requestForFeed(l.params,1)});l.$on("$destroy",function(){e.unsubscribe(f),t.reset(),r.remove(E),g&&l.removeIgnore()})}}angular.module("ringid.feed").directive("feedImage",feedImage),feedImage.$inject=["Utils","SystemEvents","$compile"];function feedImage(e,t,n){function r(e,t){return t*e.height/e.width}function i(e,t){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="RingBoxImageController" ringbox-type="remote" ringbox-animation="true" ringbox-target="templates/partials/notification/'+(t||"image-popup.html")+'"ringbox-data="getImageData(feedimages['+e+'].value, feed)"></div>'}function o(e,t,n){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="'+n+'" ringbox-type="remote" ringbox-animation="true" ringbox-target="'+t+'"ringbox-scrollable="true" loader-hide = "false" ringbox-data="getFeedInfo(feed)"></div>'}function a(e){return'<a ng-href="{{feed.getNewsPortalUrl()}}" target="_blank" class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+"].value.src(600)}}')\"></a>"}var s={layout_0:'<div class="grid">'+i(0)+'</div><div class="grid">'+i(1)+i(2)+"</div>",layout_2:'<div class="grid">'+i(0)+i(1)+'</div><div class="grid">'+i(2)+"</div>",layout_4:'<div class="grid">'+i(0)+i(1)+"</div>",layout_5:i(0)};s.layout_1=s.layout_0,s.layout_3=s.layout_2,s.layout_6=s.layout_5;var c={layout_0:'<div class="grid">'+i(0,"image-popup-special.html")+'</div><div class="grid">'+i(1,"image-popup-special.html")+i(2,"image-popup-special.html")+"</div>",layout_2:'<div class="grid">'+i(0,"image-popup-special.html")+i(1,"image-popup-special.html")+'</div><div class="grid">'+i(2,"image-popup-special.html")+"</div>",layout_4:'<div class="grid">'+i(0,"image-popup-special.html")+i(1,"image-popup-special.html")+"</div>",layout_5:i(0,"image-popup-special.html")};c.layout_1=c.layout_0,c.layout_3=c.layout_2,c.layout_6=c.layout_5;var l={layout_0:'<div class="grid">'+o(0,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+'</div><div class="grid">'+o(1,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+o(2,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+"</div>",layout_2:'<div class="grid">'+o(0,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+o(1,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+'</div><div class="grid">'+o(2,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+"</div>",layout_4:'<div class="grid">'+o(0,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+o(1,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")+"</div>",layout_5:o(0,"pages/newsportal/portal-feed-popup.html","PortalFeedSubController")};l.layout_1=l.layout_0,l.layout_3=l.layout_2,l.layout_6=l.layout_5;var u={layout_0:'<div class="grid">'+o(0,"pages/business/business-feed-popup.html","businessFeedPopupController")+'</div><div class="grid">'+o(1,"pages/business/business-feed-popup.html","businessFeedPopupController")+o(2,"pages/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_2:'<div class="grid">'+o(0,"pages/business/business-feed-popup.html","businessFeedPopupController")+o(1,"pages/business/business-feed-popup.html","businessFeedPopupController")+'</div><div class="grid">'+o(2,"pages/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_4:'<div class="grid">'+o(0,"pages/business/business-feed-popup.html","businessFeedPopupController")+o(1,"pages/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_5:o(0,"pages/business/business-feed-popup.html","businessFeedPopupController")};u.layout_1=u.layout_0,u.layout_3=u.layout_2,u.layout_6=u.layout_5;var d={layout_0:'<div class="grid">'+a(0)+'</div><div class="grid">'+a(1)+a(2)+"</div>",layout_2:'<div class="grid">'+a(0)+a(1)+'</div><div class="grid">'+a(2)+"</div>",layout_4:'<div class="grid">'+a(0)+a(1)+"</div>",layout_5:a(0)};return d.layout_1=d.layout_0,d.layout_3=d.layout_2,d.layout_6=d.layout_5,{restrict:"A",scope:!0,link:function(e,t,i){var o;if("shared"===i.feedImage&&(e.feed=e.feed.getOrginalFeed()),e.layout_id=e.feed.getImageLayout(),e.feedimages=e.feed.getImages(),5===e.layout_id&&(e.feedimages[0].value.offset().width<600&&e.feedimages[0].value.offset().height<400?e.layout_id=6:r(e.feedimages[0].value.offset(),600)<400&&(e.layout_id=6)),t.addClass("img-layout-"+e.layout_id),e.feedimages.length){o=i.popupTemplate?c:s,"true"===i.portal&&"false"===i.exUrl&&(o=l),"true"===i.portal&&"true"===i.exUrl&&(o=d),"true"===i.pages&&"false"===i.exUrl&&(o=u),"true"===i.pages&&"true"===i.exUrl&&(o=d);var a=n(o["layout_"+e.layout_id])(e);e.feed.getTotalImage()>3&&(a[1].lastChild.innerHTML='<div class="img-bg-opa"></div>    <div class="img-bg-counter">+'+(e.feed.getTotalImage()-3)+"</div>"),t.html(""),t.append(a)}}}}angular.module("ringid.feed").directive("rgMoreFeed",rgMoreFeed),rgMoreFeed.$inject=["feedFactory","SystemEvents","$ringbox"];function rgMoreFeed(e,t,n){return{restrict:"A",link:function(r,i,o){var a,s=r.$eval(o.rgMoreFeed),c=0,l=s.getDynamicText().toString(),u=s.showMore(),d=s.text();function g(){var e=d;r.showFeedFullContent||(d.length>250&&(e=d.substr(0,d.indexOf(" ",249)),u=!0),e&&e.split(/\r\n|\n\r/).length>10&&(u=!0,e=e.split(/\r\n|\n\r/,10).join("\n\r")),e=u?s.getCroppedHtml(e):l),e?(i.html(e),r.editorEnabled?i.addClass("ng-hide"):i.removeClass("ng-hide")):i.addClass("ng-hide"),m()}function m(){u&&(a=angular.element('<span style="display:inline-block;margin-left:5px;" class="showpointer showmore"> Show More</span>'),i.append(a),a.bind("click",E),r.$on("$destroy",function(){a&&(a.unbind("click"),a=null)}))}function f(){l=s.getDynamicText().toString(),u=s.showMore(),a&&(a.unbind("click"),a=null),g()}g(),r.$on(t.FEED.UPDATED,function(e,t){t.id===s.getKey()&&f()}),r.$on(t.FEED.RESET,function(e,t){t.getKey()===s.getKey()&&(s=t,f())}),r.$watch("feed.text()",function(e,t){c>0&&f(),c++}),r.$watch("editorEnabled",function(e,t){});function E(){if(s.showMore()){n.open({type:"remote",scope:!1,scrollable:!0,controller:"PopupSingleFeedController",onBackDropClickClose:!0,resolve:{remoteData:function(){return e.moreFeedText(s)}},templateUrl:"pages/home/popup-feed.html"})}else i.html(l),a.unbind("click"),a=null}}}}angular.module("ringid.feed").directive("rgIncomingFeed",rgIncomingFeed),rgIncomingFeed.$inject=["feedFactory","$window","Utils","OPERATION_TYPES"];function rgIncomingFeed(e,t,n,r){return{restrict:"A",link:function(i,o,a){var s,c=angular.element(t),l=e.getCurrentPageValue(),u=0,d=r.SYSTEM;switch(l.action){case d.TYPE_MY_NEWS_FEED:case d.TYPE_FRIEND_NEWSFEED:u=492;break;case d.TYPE_GROUP_NEWS_FEED:u=250;break;case d.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:case d.TYPE_NEWS_FEED:default:u=0}function g(){var e,t,r=n.viewport.yo;u>0&&(t=u+75,e=t-r,e>0&&(e<75?o.css("top","75px"):o.css("top",e+"px")))}function m(){e.hasUnprocessedFeed()?o.hasClass("active")||o.addClass("active"):o.removeClass("active")}function f(){n.viewport.yo>500?e.setpushInIncomingFeed(!0):e.hasUnprocessedFeed()&&s>n.viewport.yo?(e.processIncomingFeed(),e.setpushInIncomingFeed(!1),m()):e.setpushInIncomingFeed(!1),o.hasClass("active")&&g(),s=n.viewport.yo}i.$watch(e.hasUnprocessedFeed,function(e,t){e>t&&m()}),o.on("click",function(){e.processIncomingFeed(),e.setpushInIncomingFeed(!1),m(),n.resetScroll(),n.animateScroll(),i.setFeed(),i.$rgDigest()}),c.bind("scroll",f);var E=function(){c.unbind("scroll",f),o.off("click")};m(),i.$on("$destroy",E)}}}angular.module("ringid.feed").directive("feedTimeoutSelect",feedTimeoutSelect).directive("feedTimoutOption",feedTimoutOption).directive("feedTimeoutMenu",feedTimeoutMenu);function feedTimoutOption(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed-timeout-option.html",link:function(e){e.$rgDigest()},controller:["$scope",function(e){e.rows=[1,9,17],e.cols=[0,1,2,3,4,5,6,7],e.lastCols=[25,26,27,28,29,30],e.select=function(t){angular.isFunction(e.onSelect)&&e.onSelect({item:t}),e.close(),e.$parent.$rgDigest()}}]}}function feedTimeoutSelect(){return function(e,t,n){t.on("click",function(t){t.stopPropagation(),e.select(n.feedTimeoutSelect)}),e.$on("$destroy",function(){t.off("click")})}}feedTimeoutMenu.$inject=["$document","$compile"];function feedTimeoutMenu(e,t){return{restrict:"A",scope:{onSelect:"&ringOnOptionSelect",value:"=selectedValue"},link:function(n,r,i){var o,a=!1;n.close=function(){o&&o.remove(),o=null,a=!1,e.off("click",s)},n.$watch("value",function(e,t){parseInt(e)>-1?r.addClass("active"):r.removeClass("active")});function s(e){e.target!=r[0]&&e.target.parentNode!=r[0]&&e.target.parentNode.parentNode!=r[0]&&"pt-top"!=e.target.className&&n.close()}r.on("click",function(i){return a?(n.close(),""):(o||(o=t(angular.element("<feed-timout-option></feed-timout-option>"))(n)),r.after(o),a=!0,void e.on("click",s))}),n.$on("$destroy",function(){r.off("click"),e.off("click",s)})}}}angular.module("ringid.feed").directive("feedRepeat",feedRepeat),feedRepeat.$inject=["$parse","$compile","$templateCache","$http","Utils","$rootScope","SystemEvents","$sniffer","feedFactory"];function feedRepeat(e,t,n,r,i,o,a,s,c){function l(l,u){return function(u,d,g,m,f){var E,p,T,h,_,I,A=g.feedRepeat,v=A.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),S=[],C=3,D=i.feedColumn(),M=Object.create(null),y=[],N=!1,b=document.querySelector("div.middle"),O=document.getElementById("feeds-container"),P=i.viewport.y,R=P/2,U=0,L=0,F=s.vendorPrefix.toLowerCase(),w="moz"!=F&&"ms"!=F,k=!1,$=!0,G=0,B="",x=[],H=!1,Y=!1,K=!1,j=Object.create(null),V=!1;window.performance.now();p=v[1],T=v[2];v[3]?e(v[3]):"";for(h=v[1],E=0;E<C;E++){_={},I=document.createElement("div"),I.className="cell cell-id"+E,I.appendChild(document.createComment("cell: "+E)),_.element=I;var W=document.createElement("div");W.innerHTML='<div class="rf-box"><div class="rf-top"><div class="rf-cir"><span class="icon-logo-circle"></span></div><div class="rf-line"></div></div><div class="rc-feed"> </div><div class="rc-feed rc2"> </div><div class="rc-feed rc3"> </div><div class="rf-ics"></div></div>',W.style.display="none",I.appendChild(W),_.loader=W,S[E]=_,u.showPostBox()&&g.postbox&&0==E?(!function(e){r.get(g.postbox,{cache:n}).then(function(n){var r=t(n.data)(u);e.insertBefore(r[0],e.firstChild.nextSibling),H=!0,requestAnimationFrame(function(){ne(u[T])}),u.$rgDigest()})}(I),V=!0):(H=!0,requestAnimationFrame(function(){ne(u[T])})),W=null}for(u.showSpecialFeed()&&r.get("templates/partials/special-feed.html",{cache:n}).then(function(e){B=e.data}),E=0;E<C;E++)d[0].appendChild(S[E].element);function q(e,t){Y==e||K||(requestAnimationFrame(function(){for(var t=0;t<D;t++)S&&S[t].loader&&(S[t].loader.style.display=e?"block":"none");K=!1}),K=!0,Y=e)}function z(){for(var e=0;e<C;e++)e<D?S[e].element.style.display="block":S[e].element.style.display="none"}function Q(){ne(u[T]),J(!1),k=!1,q(k,"line 160"),z()}b.style.height=P+"px",l[0].className="cols-"+D,z(),k=!0,q(k,"line 170");var X=-1*P*4,Z=4*P;document.documentElement.scrollTop=0,document.body.parentNode.scrollTop=0,document.body.scrollTop=0;function J(e){H&&S&&requestAnimationFrame(function(){var t;if(L=d[0].scrollHeight,t=L-i.viewport.y-i.viewport.y,i.viewport.yo>t&&e){if(u.LoadMoreData(),u.noMoreFeed)return;u.busy!=k&&(k=u.busy,q(k,"Line 205"))}if(!(N||Math.abs(i.viewport.yo-U)<R)){var n,r,o,a,s,c=[139,0,0],l=[],g=[],m=[0,0,0],f=[0,0,0];for(U=i.viewport.yo,V||(c[0]=0),E=0;E<x.length;E++)o=x[E],r=o.key,j[r]&&(a=j[r],a&&(s=a.height,n=a.cell,c[n]+=s,c[n]>=X+U&&c[n]<=U+P+Z?a.clone.RG_HIDDEN&&l.push(a.clone):(c[n]<X+U&&(m[n]+=s),c[n]>=X+U&&c[n]>U+P+Z&&(f[n]+=s),a.clone.RG_HIDDEN||g.push(a.clone))));for(E=0;E<y.length;E++)o=y[E],r=o.key,M[r]&&(a=M[r],a&&(s=a.height,n=a.cell,c[n]+=s,c[n]>=X+U&&c[n]<=U+P+Z?a.clone.RG_HIDDEN&&l.push(a.clone):(c[n]<X+U&&(m[n]+=s),c[n]>=X+U&&c[n]>U+P+Z&&(f[n]+=s),a.clone.RG_HIDDEN||g.push(a.clone))));o=null,a=null;var p=Math.max(Math.max.apply(null,c),P);b.style.height=p+R+"px";for(var T=0;T<S.length;T++)S[T].element.style.paddingTop=m[T]+"px";for(var T=0;T<l.length;T++)l[T].style.display="block",l[T].RG_HIDDEN=!1;for(var T=0;T<g.length;T++)g[T].style.display="none",g[T].RG_HIDDEN=!0}})}window.addEventListener("scroll",J),u.$on(a.COMMON.COLUMN_CHANGED,function(e,t){D=t,l[0].className="cols-"+D,Q()}),u.$on(a.COMMON.WINDOW_RESIZED,function(e,t){D=i.feedColumn(),l[0].className="cols-"+D}),u.$watchCollection(T,ne),u.$on("$destroy",function(){M=y=I=S=_=j=x=b=O=B=Y=null,window.removeEventListener("scroll",J)}),u.$on(a.FEED.HEIGHT,function(e,t){e.stopPropagation(),M&&M[t]&&ee(t)}),u.$on(a.FEED.BUSY,function(e,t){k=t,q(k,"LINE 343")});function ee(e){fastdom.defer(3,function(){M&&M[e]&&(M[e].height=M[e].clone.offsetHeight+12)})}function te(){this.removeEventListener(F+"TransitionEnd",te),this.removeEventListener("transitionend",te),this.parentNode.removeChild(this)}function ne(e){var n,r,i,a,s,l,d,g,m,E=e.length,p=[],T=Object.create(null),_=0;if(N=!0,H&&S){if(0==e.length&&$)return void(u.noMoreFeed&&requestAnimationFrame(function(){u.$rgDigest()}));for(o.$$postDigest(function(){var t,n,r;for(t=0;t<e.length;t++)n=e[t],s=n.key,M[s]&&(r=M[s],r&&r.childHead&&(r.scope.$$childHead=r.childHead))}),c.hasSpecialFeed()&&(x=c.getSpecialFeedList(),_=x.length),n=0;n<E;n++){if(a=(n+_)%D,r=e[n],s=r.key,M[s]){if(l=M[s],!l)continue;l.cell=a,delete M[s]}else i=u.$new(),i[h]=r,l={},l.clone=null,l.cell=a,l.scope=i,l.height=110,l.key=s,l.serial=-1;T[s]=l}for(n=0;n<D;n++)p[n]||(p[n]=V&&0==n&&S[n].element.firstElementChild?S[n].element.firstElementChild:S[n].element.firstChild);for(s in M)if(M[s]){if(l=M[s],!l)continue;l.clone.style.opacity=0,l.clone.RG_DELETE=!0,l.clone.addEventListener(F+"TransitionEnd",te),l.clone.addEventListener("transitionend",te),l.scope.$destroy()}var I=2,A=[];if(B&&_>0)for(n=0;n<_;n++){if(r=x[n],s=r.key,a=n%D,d=p[a],g=d.parentNode,j[s]){if(l=j[s],!l)continue;m=l.clone,l.cell=a,m!=d.nextSibling&&g.insertBefore(m,d.nextSibling),p[l.cell]=m}else i=u.$new(),i[h]=r.value,m=t(B)(i),g.insertBefore(m[0],d.nextSibling),d=m[0],d.style.opacity=1,l={},l.clone=m[0],l.cell=a,l.scope=i,l.height=110,l.key=s,l.serial=n,l.serialElm=l.clone.querySelector("[feed-serial]"),p[a]=d,j[s]=l,function(e,t){fastdom.defer(1,function(){t&&(t.height=e.offsetHeight+12)})}(d,l);l.serialElm&&(l.serialElm.innerHTML=n+1)}for(n=0;n<E;n++)if(r=e[n],s=r.key,l=T[s]){if(l.scope.$index=n,d=p[l.cell],g=d.parentNode,m=l.clone){do d=d.nextSibling;while(d&&d.RG_DELETE);m!=d&&g.insertBefore(m,d),p[l.cell]=m,l.childHead=l.scope.$$childHead,l.scope.$$childHead=null}else f(l.scope,function(e){g.insertBefore(e[0],d.nextSibling),d=e[0],function(e,t){fastdom.defer(++I,function(){t&&(t.height=e.offsetHeight+12)})}(d,l),!w||$||G<10?d.style.opacity=1:A.push(d),l.clone=d,p[l.cell]=d,l.serialElm=l.clone.querySelector("[feed-serial]"),G++});l.serial!=n+_&&l.serialElm&&(l.serialElm.innerHTML=_+n+1,l.serial=n+_)}A.length>0&&fastdom.defer(2,function(){if(!A)return!1;for(n=0;n<A.length;n++)A[n].style.opacity=1;A=null}),u.busy!=k&&(k=u.busy,q(k,"Line 639"),k=null),M=T,y=e,N=!1,T=null,$=!1,l=null,m=null,g=null,d=null,p=null,i=null,e.length<=10&&requestAnimationFrame(function(){u.$rgDigest()})}}}}return{restrict:"A",transclude:!0,priority:1e3,terminal:!0,compile:l}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedLocationViewItem",feedLocationViewItem);function feedLocationViewItem(){return{restrict:"E",scope:{onHover:"&",onSelect:"&",location:"="},templateUrl:"templates/partials/feed_location/item.html",link:function(e,t,n){t.on("click",function(t){t.stopPropagation(),e.onSelect&&e.onSelect({location:e.location})}),e.onHover&&t.on("mouseover",function(t){e.onHover({location:e.location})}),e.$on("$destroy",function(){t.off("click"),t.off("mouseover")})}}}feedApp.directive("feedLocationView",feedLocationView),feedLocationView.$inject=["Utils"];function feedLocationView(e){function t(e){e.stopPropagation()}return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed_location/view.html",compile:function(e,n,r){return{pre:function(e,t,n,r){e.initLocation(t)},post:function(e,n,r,i){e.$rgDigest(),n.on("click",t),e.$on("$destroy",function(){n.off("click",t)})}}},controller:["$scope",function(t){t.keyword="",t.showLocationMap=!0,t.suggestedLocations=[],t.loadingData=!1,t.selfLocation={},t.onLocationItemSelect=function(e){if(angular.isFunction(t.onItemSelect)){try{var n={description:e.terms[0].value}}catch(t){var n={description:e.description}}n.lat=9999,n.lng=9999,e.geometry&&e.geometry.location&&(n.lat=e.geometry.location.lat(),n.lng=e.geometry.location.lng()),t.onItemSelect({location:n}),t.$parent.$rgDigest()}t.close()},t.shareUserLocation=function(){e.getUserLocation().then(function(e){e.sucs?(t.onItemSelect({location:e}),t.$rgDigest(),t.close()):Ringalert.show({mg:"Unable to detect user location"},"error")})},t.onLocationItemHover=c;var n,r,i,o,a,s={};t.initLocation=function(n){a=n.find("input")[0],i=new google.maps.places.PlacesService(a),o=new google.maps.places.AutocompleteService,a.focus(),e.getUserLocation(!0).then(function(e){t.selfLocation=e,T(e.sucs?{lat:e.lat,lng:e.lng,description:e.description}:{lat:23.772493,lng:90.4098315,description:"IPvision Ltd."})}),t.keyword=t.value?t.value.description:""};function c(e){try{h(e.place_id),m()}catch(e){}}function l(e){i.getDetails({placeId:e},function(t,n){n==google.maps.places.PlacesServiceStatus.OK&&(angular.extend(s[e],t),s[e]=t),E()})}var u=function(e,n){return n!=google.maps.places.PlacesServiceStatus.OK?void g():(f(),angular.forEach(e,function(e){var n=e.place_id;s[n]?angular.extend(s[n],e):(l(n),s[n]=e),t.suggestedLocations.push(s[n])}),t.suggestedLocations.length>0&&g(),void E())};function d(){t.loadingData=!0}function g(){t.loadingData=!1}function m(){t.showLocationMap=!0}function f(){t.suggestedLocations=[]}function E(){t.$rgDigest()}function p(e){return new google.maps.LatLng(e.lat,e.lng)}function T(e){var t=p(e);r=new google.maps.Map(document.getElementById("feed-location-map"),{center:t,zoom:13}),e.description&&o.getPlacePredictions({input:e.description,rankBy:google.maps.places.RankBy.DISTANCE},u)}function h(e){var t=s[e];t&&(n&&n.setMap(null),r.setCenter(t.geometry.location),n=new google.maps.Marker({map:r,place:{placeId:e,location:t.geometry.location}}))}function _(e){f(),d(),E(),o.getPlacePredictions({input:e},u)}function I(e){var n=e.target.value;n&&n.length>3?_(n):(f(),E()),t.keyword=e.target.value}t.processKeyup=e.debounce(I,500)}]}}function feedLocationPreview(){return{replace:!0,template:'<span ng-if="!!feed.getLocationInfo().lat" ><a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">  <img height="170px" width="100%" ng-src="{{ ::feed.getLocationStaticEmbedUrl() }}" alt="location-hover" /> </a>'}}feedApp.directive("feedLocationPreview",feedLocationPreview);var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedLocationMenu",feedLocationMenu),feedLocationMenu.$inject=["$document","$compile","Utils"];function feedLocationMenu(e,t,n){return{restrict:"A",scope:{onItemSelect:"&feedLocationMenuOnSelect",value:"=selectedValue",viewWidth:"@",viewHeight:"@",autoAdjust:"@"},link:function(r,i,o){var a,s,c=!1,l=20;r.viewDirection="right",o.feedLocationMenuDirection&&(r.viewDirection=o.feedLocationMenuDirection,s=!0),r.viewWidth=r.viewWidth||600,r.viewHeight=r.viewHeight||466,r.close=function(){a&&a.remove(),a=null,c=!1,e.off("click",u)},r.$watch("value",function(e,t){e.description?i.addClass("active"):i.removeClass("active")});function u(e){e.target!=i[0]&&e.target.parentNode!=i[0]&&e.target.parentNode.parentNode!=i[0]&&"pt-top"!=e.target.className&&(r.close(),"false"!==r.autoAdjust&&d(event))}function d(e){window.eventFix(e);var t=n.viewportsize();!s&&e.pageY+r.viewHeight+l>t.y&&window.scrollToYOffset(e.pageY-t.y/2,500),e.pageX+r.viewWidth+l>t.x-200&&(r.viewDirection+=" left")}i.on("click",function(n){return c?(r.close(),""):("false"!==r.autoAdjust&&d(n),a||(a=t(angular.element("<feed-location-view></feed-location-view>"))(r)),i.after(a),c=!0,void e.on("click",u))}),r.$on("$destroy",function(){a&&a.remove(),i.off("click"),e.off("click",u)}),r.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedTop",rgNewsFeedTop),rgNewsFeedTop.$inject=["$templateCache"];function rgNewsFeedTop(e){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",template:e.get("top.html")}}angular.module("ringid.feed").directive("rgNewsFeedBottom",rgNewsFeedBottom),rgNewsFeedBottom.$inject=["$templateCache"];function rgNewsFeedBottom(e){return{restrict:"E",template:e.get("bottom.html")}}angular.module("ringid.feed").directive("rgNewsFeedDetails",rgNewsFeedDetails);function rgNewsFeedDetails(){return{restrict:"E",templateUrl:"templates/partials/news_feed/details.html",link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedSharedFeed",rgNewsFeedSharedFeed);function rgNewsFeedSharedFeed(){return{restrict:"E",templateUrl:"templates/partials/news_feed/shared_feed.html"}}angular.module("ringid.feed").directive("rgNewsFeedMenu",rgNewsFeedMenu),rgNewsFeedMenu.$inject=["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert"];function rgNewsFeedMenu(e,t,n,r,i){return{restrict:"E",template:n.get("menu.html"),link:function(n,o,a){var s=null,c=null,l=o[0].querySelector("[data-events]"),u=o[0].closest("[data-feed-bottom]");function d(e){if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){e.stopPropagation();var t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0);if(!o.sucs)return void i.show(r[o.rc],"warning");g()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),m()),n.$rgDigest()}l.addEventListener("click",d);function g(){return n.showCommentBox&&(u.removeChild(s),n.showCommentBox=!1),n.showShareBox?n.showShareBox?(u.removeChild(c),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey()):(c=c?c:e("<feed-inline-share-view></feed-inline-share-view>")(n)[0],u.appendChild(c),n.showShareBox=!0,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}function m(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox" comment-type = "feed" comment-order = "asc"></rg-comments>',n.showShareBox&&(u.removeChild(c),n.showShareBox=!1),n.showCommentBox?(u.removeChild(s),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,s=s?s:e(r)(n)[0],u.appendChild(s),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}n.closeShareBox=function(){n.showShareBox=!0,g(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,m(),n.$rgDigest()},n.$on("$destroy",function(){l.removeEventListener("click",d),l=null,u=null,s=null,c=null})}}}angular.module("ringid.feed").directive("rgPortalNewsFeedMenu",["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert","$ringbox",function(e,t,n,r,i,o){return{restrict:"E",template:n.get("menu.html"),link:function(n,a,s){var c=null,l=null,u=a[0].querySelector("[data-events]"),d=a[0].closest("[data-feed-bottom]");function g(e){if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){e.stopPropagation();var t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0);if(!o.sucs)return void i.show(r[o.rc],"warning");m()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),f()),n.$rgDigest()}u.addEventListener("click",g);function m(){if(n.showCommentBox&&(d.removeChild(c),n.showCommentBox=!1),!n.showShareBox){var e=o.open({type:"remote",scope:!1,controller:"feedNewsPortalShareController",scopeData:{feed:n.feed},onBackDropClickClose:!0,templateUrl:"templates/newsportal/portal-share-news.html"});return void e.result.then(function(){n.$rgDigest()})}return n.showShareBox?(d.removeChild(l),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey())}function f(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox" comment-type = "feed" comment-order = "asc"></rg-comments>',n.showCommentBox?(d.removeChild(c),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,c=c?c:e(r)(n)[0],d.appendChild(c),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}n.closeShareBox=function(){n.showShareBox=!0,m(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,f(),n.$rgDigest()},n.$on("$destroy",function(){u.removeEventListener("click",g),u=null,d=null,c=null,l=null})}}}]),angular.module("ringid.feed").directive("locationCard",function(){return{restrict:"E",replace:!0,scope:{feed:"="},template:'<span class="location">&nbsp;at&nbsp;<a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">{{::feed.getLocationShortText()}}</a></span>'
}}).directive("userCard",function(){return{restrict:"E",replace:!0,controller:["$scope","Api","friendsFactory","settings","portalHttpService",function(e,t,n,r,i){e.getUserDetail=function(){e.showMfc=!1,t.user.getUserDetails({utId:e.user.getUtId()},!0,e.user.isNewsPortalUser(),e.user.isBusinessPageUser()).then(function(t){t.sucs&&(e.mfc=t.userDetails.mfc,e.showMfc=!0,e.user.setUid(t.userDetails.uId),t.userDetails.npDTO&&(e.portalCategory=t.userDetails.npDTO.nPCatName,e.follower=t.userDetails.npDTO.subCount,e.isSubscribed=t.userDetails.npDTO.subsc,e.profileImage=r.imBase+t.userDetails.prIm),e.$rgDigest())})},e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:t.user.getMutualFriends(e)}},e.contactListAction=function(t){t.friend.isLoading()||(n.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}}],scope:{user:"="},template:'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="{{::!user.isCurrentUser()}}" on-hover-start="getUserDetail" hover-template-url="{{user.getCardTemplate()}}">{{::user.getName()}}</a></span>'}}).directive("feedMessage",feedMessage).directive("feedTagMoreUser",feedTagMoreUser),feedMessage.$inject=["$compile"];function feedMessage(e){return{restrict:"A",scope:{feed:"=feedMessage"},link:function(t,n,r){t.$watch("feed.checkMessageUpdated()",function(r){n.html(t.feed.getMessageText()),e(n.contents())(t)})}}}feedTagMoreUser.$inject=[];function feedTagMoreUser(){return{restrict:"E",scope:{feed:"=tagFeed"},controller:["$scope","feedFactory",function(e,t){if(e.getTagUsers=function(e){return{data:function(){return{target:e}},promise:t.getTagUsers(e)}},e.tooltip="",e.feed.getTotalTag()>2){var n=e.feed.getTagUsers();n.length>1&&(e.tooltip+=n[1].getName(),n[2]&&(e.tooltip+="\n"+n[2].getName(),e.feed.getTotalTag()>3&&(e.tooltip+="\nand "+(e.feed.getTotalTag()-3)+" others")))}}],template:'<span class="">with&nbsp;</span><span class="tag-people"><user-card user="feed.getTagUsers()[0]"></user-card></span><span ng-if="::feed.getTotalTag() > 1">&nbsp;and&nbsp;<span class="tag-people" ng-if="::feed.getTotalTag() == 2"><user-card user="feed.getTagUsers()[1]"></user-card></span><span class="" ng-if="::feed.getTotalTag() > 2"><a rg-ringbox="true" ringbox-controller="feedTagUserListController" ringbox-type="remote"ringbox-target="templates/home/tag-user-list.html"ringbox-data="getTagUsers(feed)" class="tag-f-msg" data-tooltip="{{::tooltip}}">{{::feed.getTotalTag() -1}} others peoples</a></span></span>'}}angular.module("ringid.feed").directive("rgSingleFeedHeader",rgSingleFeedHeader).directive("rgSingleFeedBody",rgSingleFeedBody).directive("rgSingleFeedMenu",rgSingleFeedMenu);function rgSingleFeedBody(){return{restrict:"E",templateUrl:"templates/partials/single_feed/body.html"}}function rgSingleFeedHeader(){return{restrict:"E",templateUrl:"templates/partials/single_feed/header.html"}}function rgSingleFeedMenu(){return{restrict:"E",templateUrl:"templates/partials/single_feed/menu.html"}}angular.module("ringid.feed").directive("rgSingleFeedDetails",rgSingleFeedDetails);function rgSingleFeedDetails(){return{restrict:"E",templateUrl:"templates/partials/single_feed/details.html"}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedInlineShareView",feedInlineShareView),feedInlineShareView.$inject=["GlobalEvents","$compile","$ringhttp"];function feedInlineShareView(e,t,n){return{restrict:"E",template:'<div class="status-box noselect inline-share"><form enctype="multipart/form-data"><div style="padding:10px"><div class="float-left"><div class="thumbnail"><div class="icon-logo-circle pss-logo"><a><img class="responsive-all" rg-src="currentUser.avatar(\'thumb\')"></a></div></div></div><div class="post-t float-right"><div class="inline-share-box"><rg-editor class="editor" editor-content="feedText" new-line="on" on-escape="closeShareBox" focus="showShareBox" placeholder="Write something...."></rg-editor><span class="esc-cancel" rg-click="closeShareBox()">Press Esc to <a>Cancel</a></span><p ng-if="emotions.length" class="pst-loc-txt"><span class="feelings-text">feeling</span> <img class="feed_emo" rg-src="emotions[0].url"> {{emotions[0].nm}} &nbsp;<span class="icon-close f-12" rg-click="emotions.length = 0"></span></p><div ng-if="tagList.length"><ul class="tag-fnd-lst"><span class="tag-with">With : </span><li ng-repeat="usr in tagList"><span class="tag-title">{{::usr.getName()}}</span>&nbsp;<span class="tag-cros" rg-click="removeTag(usr)">X</span></li></ul></div><p ng-if="feedLocation.description" class="pst-loc-txt">{{ feedLocation.description}} <span class="showpointer icon-close f-12" rg-click="resetFeedLocation()"></span></p><p ng-show="!boxIsLoading && errorMessage" class="s-error">{{errorMessage}}</p><!--<p ng-show="!boxIsLoading && !errorMessage" class="s-info"><b>Enter</b> to SHARE, <b>ESC</b> to Cancel</p>--><rg-loader-view2 is-loading="boxIsLoading"></rg-loader-view2></div></div><div class="clear"></div></div><div class="status-photo-box" style="margin:0;padding:0;border-top:1px solid #ebebeb;width:100%"><div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Feeling" rg-emotion on-select="chooseEmotion(item)" class="p-ab"><span class="img_sprite status-ico feeling-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Tag Friends" rg-tag-friend="" show-if="showAddTag" tag-items="tagList" on-select="addTag(item)" class="p-ab"><span class="img_sprite status-ico tag-f-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Location" feed-location-menu="" feed-location-menu-on-select="updateFeedLocation(location)" autoAdjust="{{::autoAdjustScroll}}" selected-value="feedLocation" class="p-ab"><span class="img_sprite status-ico location-ico"></span></a></div><div class="float-right pad-7-0"><input type="button" ng-disabled="inputDisabled" rg-click="shareFeed()" class="share_btn float-right" value="Share"></div><!--<p>Press escape to cancel</p>--></div></div></form><div class="clear"></div></div>',controller:"feedInlineShareController",link:function(e,t,n){}}}angular.module("ringid.feed").controller("FeedMainController",["$scope","$timeout","feedFactory","$rootScope","SystemEvents",function(e,t,n,r,i){n.reset(),e.noMoreFeed=!1,e.showPostBox=e.showPostBox||function(){return!0},e.showSpecialFeed=e.showSpecialFeed||function(){return!0},e.feeds=n.getFeeds(),n.setFactoryKey(e.pagekey),n.setSortBy(e.sortBy||"tm"),e.busy=!0;var o=setInterval(function(){n.updateTime(),e.$rgDigest()},3e5);e.setFeed=function(t){e.feeds=[],e.feeds=n.getFeeds(),t&&e.$rgDigest()},e.forAdd=e.forAdd||"my",e.getFeeds=function(){return e.feeds&&0!==e.feeds.length||e.setFeed(),e.feeds};var a,s;e.LoadMoreData=function(t){s=e.feeds.length,e.busy!==!1||e.noMoreFeed||(e.busy=!0,n.requestForMoreFeed(e.params),e.clearRequestTimer(),a=setTimeout(function(){e.busy&&s===e.feeds.length&&(e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy))},6e3))},e.clearRequestTimer=function(e){a&&clearTimeout(a),a=e},e.$on("FeedListChanged",function(){e.setFeed()}),e.setNoMoreFeed=function(t){e.noMoreFeed=t,n.noMoreFeed(t),e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy)},e.noDataYet=function(){return e.noMoreFeed&&0==e.feeds.length},e.getFeedInfo=function(e){return{data:function(){return{target:e}},promise:n.getPortalFeedDetails(e.getKey())}},n.initFeedRequest(e.params),e.$on("$destroy",function(){o&&(clearInterval(o),o=null)}),e.$on(i.COMMON.COLUMN_CHANGED,function(){e.$rgDigest()})}]),angular.module("ringid.feed").controller("SingleFeedSubController",["$$feedMap","$scope","$controller","$routeParams","feedFactory","Auth","SystemEvents","Utils","$location",function(e,t,n,r,i,o,a,s,c){t.feedId=parseInt(r.feedId||0),t.shared=!!r.shared,t.activeCommentId=parseInt(r.commentId||0),t.isReady=!1,t.noData=!1,t.pagekey=i.getSingleFeedPageKey(t.feedId),i.setFactoryKey(t.pagekey),t.singleFeed=!0,t.hideSerial=!0,t.showFeedFullContent=!0,t.ogData={},t.currentUser=o.currentUser(),l(),t.setFeed=function(e){e?c.path("/"):l()},t.skipSaveScope=!0,t.getFeedInfo=function(e){return{data:function(){return{target:e}}}},n("FeedSubController",{$scope:t});function l(){i.getSingleFeed(t.feedId,t.shared).then(function(e){e?(t.feed=e,t.isReady=!0,u()):(t.feed=!1,t.isReady=!0,t.noData=!0),t.$rgDigest()})}function u(){t.feed&&(t.serial=t.feed.serial,t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.shareMenuDisabled=t.feed.isCirclePost(),t.ogData=t.feed.getOgData(),t.ogShowPreview=t.feed.hasOgData(),t.showCommentBox=!0,n("FeedSubController",{$scope:t}),s.safeDigest(t),t.$broadcast(a.FEED.RESET,t.feed))}}]),angular.module("ringid.feed").controller("FeedSubController",FeedSubController),FeedSubController.$inject=["rgDropdownService","$rootScope","$scope","$location","feedFactory","Ringalert","MESSAGES","SystemEvents","$ringbox","Media","Utils","APP_CONSTANTS"];function FeedSubController(e,t,n,r,i,o,a,s,c,l,u,d){n.showdroparrow=0,n.showCommentBox=!1,n.showShareBox=!1,n.showCommentView=!0,n.showShareForm=!1;var g=n.feed&&n.feed.value?n.feed.value:n.feed;g&&g.isSingleContentFeed()?(g.getMedias().length()||g.getAudios().length()?n.likeType="media":g.getImages(!0).length()&&(n.likeType="image"),n.likeTarget=g.getSingleContent()):(n.likeType="feed",n.likeTarget=g),n.shareMenuDisabled=!!n.shareMenuDisabled&&n.shareMenuDisabled,n.toggleCommentBox=function(e){e.stopPropagation(),n.showCommentBox=!n.showCommentBox,n.showCommentBox&&(n.showShareBox=!1)},n.ddTemplate='<div class="ng-cloak action feed-ac float-right"><div class="feed-line" ng-if="ddControl.showEdit()"><span class="drop-sprite w-h-13 edit-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edit\', feedKey: ddControl.feedKey})" href="#">Edit</a></div><div class="feed-line" ng-if="ddControl.showReportButton()"><span class="drop-sprite add-tag-mar w-h-13 report-ico feed-font"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div><div class="feed-line" ng-if="ddControl.showTagButton()"><span class="drop-sprite add-tag-mar w-h-13 add-tag-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edittag\', feedKey: ddControl.feedKey})" href="#" class="border-0">{{ddControl.tagButtonText()}}</a></div><div class="feed-line"  ng-if="ddControl.showDelete()"><span class="drop-sprite w-h-13 delete-mar delete-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'delete\', feedKey: ddControl.feedKey})" href="#" class="border-0">Delete</a></div><div class="feed-line" ng-if="ddControl.showSaveOptionForNews()"><span class="drop-sprite follow-drop save-ico w-h-13"></span><a rg-click="ddAction()({event: $event, action:\'save\', feedKey: ddControl.feedKey,ptype:3})" href="#" class="border-0">Save</a></div><div class="feed-line"  ng-if="ddControl.showUnsaveOptionForNews()"><span class="img_sprite w-h-13 icon-delete-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'unsave\', feedKey: ddControl.feedKey,ptype:3})" href="#" class="border-0">Unsave</a></div><div class="feed-line" ng-if="ddControl.showSaveOptionForBusiness()"><span class="drop-sprite follow-drop save-ico w-h-13"></span><a rg-click="ddAction()({event: $event, action:\'save\', feedKey: ddControl.feedKey,ptype:4})" href="#" class="border-0">Save</a></div><div class="feed-line"  ng-if="ddControl.showUnsaveOptionForBusiness()"><span class="img_sprite w-h-13 icon-delete-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'unsave\', feedKey: ddControl.feedKey,ptype:4})" href="#" class="border-0">Unsave</a></div></div>',n.actionFeedDropdown=function(t){switch(e.close(t.event),t.event.preventDefault(),t.action){case"edit":n.enableEditor(t.feedKey);break;case"edittag":f();break;case"delete":n.deleteFeed(t.feedKey);break;case"save":n.saveFeed(t.feedKey,1,t.ptype);break;case"unsave":n.saveFeed(t.feedKey,2,t.ptype)}},n.noDownload=function(e){e.preventDefault(),o.show("Currently download option is available in ringID desktop and mobile app version only.")},n.selectAlbum=function(e){return{data:function(){return{media:e}}}},n.enableEditor=function(e){var t,r,o={};t=i.getFeed(e),o.localData={feed:t},t.showMore()?o.remoteData=i.moreFeedText(t):o.remoteData=!1,r=c.open({type:"remote",scope:!1,controller:"FeedEditController",scrollable:!0,resolve:o,templateUrl:"pages/partials/news_feed/edit.html"}),r.result.then(function(e){e.sucs&&n.$rgDigest()})},n.deleteFeed=function(e){var t="Are you sure you want to delete?",r=c.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"});r.result.then(function(t){t&&i.deleteFeed(n.currentUser,e).then(function(e){n.setFeed(!0),o.show(e,"success")},function(e){n.setFeed(!0),o.show(e,"error")})})},n.saveFeed=function(e,t,r){var o;i.saveFeed(e,t,r).then(function(r){if(r.sucs===!0){o=1===t;var a=i.getFeed(e);a.setPortalSaveStatus(o),n.$rgDigest()}})},n.getShareData=function(){return function(){return{keyid:n.keyid,feed:n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed}}},n.getImageData=function(e,t){return function(){return{image:e,feed:t}}},n.getMediaData=function(e,t){return{data:function(){return{media:e,playlist:t.getAlbum().getContents().all(),feedTime:t.time()}},promise:e.fetchDetails()}},n.getMediaFirstData=function(e){e=e||n.feed;var t=e.getMedias().top();if(t)return n.getMediaData(t,e)},n.getAudioFirstData=function(e){e=e||n.feed;var t=e.getAudios().top();if(t)return n.getMediaData(t,e)},n.goToFeed=m,n.isShareAble=function(e){return e=e.hasSharedFeed()?e.getOrginalFeed():e,e.isShareAble()};function m(e){e&&r.path(e)}function f(){var e=c.open({type:"remote",scope:!1,controller:"feedEditTagController",resolve:{localData:{feed:n.feed},remoteData:function(){return n.feed.hasTagUsers()?i.getTagUsers(n.feed):{}}},templateUrl:"templates/home/feed-tag-user-edit.html"});e.result.then(function(e){e&&(n.feed=e),n.cancelEdit()})}if(n.openRingBoxLike=function(){return n.feed.getTotalLikes()>0},n.openRingboxShare=function(){return(n.feed.hasSharedFeed()?n.feed.getOrginalFeed().getTotalShare()>0:n.feed.getTotalShare())>0&&!n.feed.isMediaShared()&&!n.feed.isSingleContentFeed()},n.whoShareFalsyFunc=function(){n.feed.isSingleContentFeed()&&o.show("Oops! This feature is coming soon","info")},!n.skipSaveScope){var E=n.feed.value?n.feed.value.getKey():n.feed.getKey();i.addScope(E,n),n.$on("$destroy",function(){i.removeScope(n.feed.getKey())})}}angular.module("ringid.feed").controller("PopupSingleFeedController",PopupSingleFeedController),PopupSingleFeedController.$inject=["$scope","remoteData","$boxInstance","$controller","$$feedMap"];function PopupSingleFeedController(e,t,n,r,i){e.feed=i.create(t.newsFeedList[0]),e.hideSerial=!0,e.showCommentBox=!0,e.showFeedFullContent=!0,r("FeedSubController",{$scope:e})}angular.module("ringid.feed").controller("FeedWhoShareController",FeedWhoShareController),FeedWhoShareController.$inject=["$$connector","$scope","$$feedMap","feedFactory","OPERATION_TYPES","$rootScope","Ringalert"];function FeedWhoShareController(e,t,n,r,i,o,a){var s,c,l,u,d=i.SYSTEM;t.feeds=[],t.message="",t.boxIsLoading=!t.params.boxIsLoading||t.params.boxIsLoading;var g;t.params&&(g=r.getFeed(t.params.keyid)),t.showMessage=!1,t.shareMenuDisabled=!0,t.singleFeed=!0,t.busy=!1,t.boxHeight=o.windowHeight-20,s=e.subscribe(function(e){if(t.boxIsLoading=!1,t.isReady=!0,t.busy=!1,!e.sucs)return t.$close(),void a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error");if(e.newsFeedList.length)for(u=0;u<e.newsFeedList.length;u++){var r=n.create(e.newsFeedList[u]);r.getKey()===g.getKey()&&r.setIdenticalFeed(g),t.feeds.push(r)}t.$rgDigest()},{action:d.TYPE_WHO_SHARES_LIST});function m(){t.boxIsLoading=!0,t.feeds.length<t.params.feed.getTotalShare()&&!t.busy&&(e.send({actn:d.TYPE_WHO_SHARES_LIST,nfId:t.params.feed.getKey(),st:t.feeds.length},d.REQUEST_TYPE.REQUEST),t.busy=!0,setTimeout(function(){t.busy=t.busy||!1,t.$rgDigest()},3e3),t.$rgDigest())}t.loadMore=m,t.loadMore(),t.$on("$destroy",function(){r.removeIgnoreFilter(c),r.removeIgnoreFilter(l),e.unsubscribe(s)}),t.skipSaveScope=!0}angular.module("ringid.feed").controller("FeedRingboxWhoShareController",FeedRingboxWhoShareController),FeedRingboxWhoShareController.$inject=["$controller","$scope","localData"];function FeedRingboxWhoShareController(e,t,n){t.viewType="ringbox",t.params=n,e("FeedWhoShareController",{$scope:t})}angular.module("ringid.feed").controller("feedShareController",feedShareController),feedShareController.$inject=["$scope","Auth","feedFactory","$rootScope","Ringalert","Utils"];function feedShareController(e,t,n,r,i,o){e.feed=e.params.feed,e.afterShareCallback=e.afterShareCallback||e.params.afterShareCallback,e.updateFeedLocation=E,e.resetFeedLocation=f,e.currentUser=t.currentUser(),f(),g(),d(),c(),u(),e.shareFeed=a;function a(t){var r=h();s(),l(),d(),n.shareFeed(r).then(function(t){u(),g(),c(),d(),f(),p(),_(),T(t),e.media?(e.media.share(!0),e.$close()):e.popup?e.$close():e.$parent.$rgDigest()},function(t){u(),c(),I(t),e.$parent.$rgDigest()}),e.$rgDigest()}function s(){e.inputDisabled=!0}function c(){e.inputDisabled=!1}function l(){e.boxIsLoading=!0}function u(){e.boxIsLoading=!1}function d(){e.errorMessage=""}function g(){e.feedText=""}function m(t){e.feedLocation=t}function f(t){e.feedLocation=""}function E(t){m(t),e.$rgDigest()}function p(){r.$broadcast("FeedListChanged"),e.$broadcast("cleareditor")}function T(e){i.show(e,"success")}function h(){var t,n=e.media?null:e.feed,r={text:e.feedText,feed:n&&n.hasSharedFeed()?n.getOrginalFeed():n,location:e.feedLocation},i=e.media;if(e.emotions.length&&(r.mdIds=[e.emotions[0].id],e.emotions.length=0),e.tagList.length){for(r.tFrndIds=[],t=0;t<e.tagList.length;t++)r.tFrndIds.push(e.tagList[t].getUtId());e.tagList.length=0}return(i||n&&n.isSingleContentFeed()&&(n.getMedias().length()||n.getAudios().length()))&&(i=i||n.getSingleContent(),r.audio=i.isAudio(),r.cntntIDLst=[i.getKey()],r.addShare=!0,r.user=e.currentUser),r}function _(){e.afterShareCallback&&e.afterShareCallback()}function I(t){var n=o.getReasonMessageFromResponse(t);""==n&&(n="Unable To Share Status. Please Try Again Later"),e.errorMessage=n}e.emotions=[],e.tagList=[],e.addTag=function(t){var n=e.tagList.indexOf(t);n===-1&&e.tagList.push(t)},e.removeTag=function(t){var n=e.tagList.indexOf(t);n>=0&&e.tagList.splice(n,1)},e.chooseEmotion=function(t){e.emotions.length=0,e.emotions.push(t)}}angular.module("ringid.feed").controller("feedRingboxShareController",feedRingboxShareController),feedRingboxShareController.$inject=["$scope","$boxInstance","$controller","localData"];function feedRingboxShareController(e,t,n,r){e.params={feed:r.feed,afterShareCallback:e.$close,showSharePostBox:!0},n("feedShareController",{$scope:e})}angular.module("ringid.feed").controller("feedMediaShareController",feedMediaShareController).controller("feedNewsPortalShareController",feedNewsPortalShareController).controller("feedInlineShareController",feedInlineShareController),feedInlineShareController.$inject=["$scope","$controller"];function feedInlineShareController(e,t){e.params={feed:e.feed,afterShareCallback:e.closeShareBox,showSharePostBox:!0},t("feedShareController",{$scope:e})}feedMediaShareController.$inject=["$scope","$controller"];function feedMediaShareController(e,t){e.params={feed:null},e.afterShareCallback=angular.noop,e.closeShareBox=function(){e.$close()},e.autoAdjustScroll="false"}feedNewsPortalShareController.$inject=["$scope"];function feedNewsPortalShareController(e){e.closeShareBox=function(){e.$close()},e.afterShareCallback=angular.noop,e.autoAdjustScroll="false",e.popup=!0}angular.module("ringid.feed").controller("FeedAddController",["fileUploadService","$rootScope","$scope","feedFactory","$timeout","$routeParams","SystemEvents","OPERATION_TYPES","rgDropdownService","PrivacySet","MESSAGES","settings",function(e,t,n,r,i,o,a,s,c,l,u,d){n.privacySet=l,"circle"==n.forAdd||"friend"===n.forAdd?n.showPrivacy=!1:(n.showPrivacy=!0,n.privacy=l.PVC3),n.setPrivacy=function(e){n.privacy=l["PVC"+e.privacy],c.close(e.event),n.$rgDigest()},n.privacyTemplate='<div class="ng-cloak action  ab-drop postbox-action"><div class="a-box" ><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC1.value})" href="#"><span class="{{::ddControl.PVC1.icon}} ab-delete"></span> {{::ddControl.PVC1.text}}</a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC2.value})" href="#"><span class="{{::ddControl.PVC2.icon}} ab-delete"></span> {{::ddControl.PVC2.text}} </a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC3.value})" href="#"><span class="{{::ddControl.PVC3.icon}} ab-delete"></span> {{::ddControl.PVC3.text}}</a></div></div>',n.feedText="",n.feedLocation={},n.ogData={},n.filterOnProgress=!1,n.ogDataLoading=!1,n.ogShowPreview=!1,n.inputDisabled=!1,n.getValidityValues=function(){return new Array(30)},n.showTimeout=!1,n.validity=-1;var g={vldt:n.validity};"friend"===n.forAdd?g.friend=o.uId:"circle"===n.forAdd&&(g.group=o.circleId),n.$on(a.FILE_UPLOAD.QUEUE_START,function(){n.inputDisabled=!0,n.$rgDigest()}),n.$on(a.FILE_UPLOAD.QUEUE_COMPLETE,function(){n.inputDisabled=!1,n.$rgDigest()}),n.shouldDisableInput=function(){return n.inputDisabled||n.ogDataLoading||n.filterOnProgress},n.shouldDisableLocation=function(){return!1},n.shouldDisableLink=function(){return e.imageFiles.length>0||e.videoFiles.length>0||e.audioFiles.length>0||!!n.feedLocation.lat},n.shouldDisableMedia=function(){return!!n.ogData.url||!!n.feedLocation.lat};var m,f,E=(new Date).getTime();for(n.addFeed=function(){var t={vldt:n.validity};if(n.inputDisabled=!0,t=angular.extend({},g,{text:n.feedText,vldt:n.validity,images:e.imageFiles,videos:e.videoFiles,audios:e.audioFiles}),n.privacy&&(t.fpvc=n.privacy.value),n.feedLocation.description&&(t.lctn=n.feedLocation.description,t.lat=n.feedLocation.lat,t.lng=n.feedLocation.lng),n.ogData.url&&(t.lnkDmn=n.ogData.lnkDmn||n.ogData.url||"",t.lnkDsc=n.ogData.description||"",t.lnkTtl=n.ogData.title||"",t.lnkURL=n.ogData.url||"",t.lnlImgURL=n.ogData.image||""),n.emotions.length&&(t.mdIds=[n.emotions[0].id],n.emotions.length=0),n.tagList.length){for(t.tFrndIds=[],f=0;f<n.tagList.length;f++)t.tFrndIds.push(n.tagList[f].getUtId());n.tagList.length=0}var i=n.feedText;if(""!=t.text&&t.lnkURL){var o=t.text.replace("https","").replace("http",""),a=t.lnkURL.replace("https","").replace("http","");"/"==o[o.length-1]&&(o=o.slice(0,-1)),"/"==a[a.length-1]&&(a=a.slice(0,-1)),o==a&&(t.text="")}function s(){return!!t.lnkURL||t.images.length>0||t.videos.length>0||t.audios.length>0||!!t.mdIds&&t.mdIds.length>0||!!t.lctn||!!t.tFrndIds&&t.tFrndIds.length>0}function c(){var e=!0;if(n.errorMessage="",""!==t.text){var r,i=t.text.length,o=t.text.getUTF8Length();o>d.FEED_TEXT_LIMIT&&(r=Math.floor(i*d.FEED_TEXT_LIMIT/o),n.errorMessage=u.FTL_ERROR.supplant({length:i,max_limit:r}),e=!1)}else s()||(e=!1,n.errorMessage=u.FEED_INV);return e}function l(){E=m,r.addFeed(t,n.currentUser).then(function(e){n.setFeed(e),n.$parent.$rgDigest()},function(){n.setFeed(),n.feedText=i,n.$broadcast("seteditor",i),n.$parent.$rgDigest()},function(e){}),e.imageFiles.length=0,e.imageFiles=[],e.videoFiles.length=0,e.videoFiles=[],e.audioFiles.length=0,e.audioFiles=[],n.feedText="",n.validity=-1,n.feedLocation={},n.ogData={},n.ogShowPreview=!1,n.inputDisabled=!1,n.errorMessage="",n.setFeed(),n.$broadcast("cleareditor"),n.$parent.$rgDigest()}c()?(m=Date.now(),m-E<200?setTimeout(l,200):l()):(n.inputDisabled=!1,n.ogShowPreview=!1,n.$rgDigest())},n.selectOptions=[],n.selectOptions[0]={value:-1,title:"Unlimited"},f=1;f<=30;f++)n.selectOptions[f]={value:f,title:f+" Day"};n.selectedTimeout=function(e){n.validity=e,n.$rgDigest()},n.selectedLocation=function(e){n.feedLocation=e,n.$rgDigest()},n.resetFeedLocation=function(){n.feedLocation={},n.$rgDigest()},n.emotions=[],n.tagList=[],n.addTag=function(e){var t=n.tagList.indexOf(e);t===-1&&n.tagList.push(e),n.$rgDigest()},n.removeTag=function(e){var t=n.tagList.indexOf(e);t>=0&&n.tagList.splice(t,1),n.$rgDigest()},n.chooseEmotion=function(e){n.emotions.length=0,n.emotions.push(e),n.$rgDigest()};var p=r.getCurrentPageValue();n.showAddTag=p.action!==s.SYSTEM.TYPE_GROUP_NEWS_FEED}]),angular.module("ringid.feed").controller("FeedEditController",FeedEditController),FeedEditController.$inject=["Auth","SystemEvents","$scope","localData","remoteData","feedFactory","Ringalert"];function FeedEditController(e,t,n,r,i,o,a){var s=r.feed;n.emotions=[],n.editorEnabled=!1,n.errorImageEdit=!1,n.feedLocation={},n.ogData=n.ogData||{},n.filterOnProgress=!1,n.ogDataLoading=!1,n.ogShowPreview=!1,n.previousFeedLocation="",n.feedEditChooseEmotion=d,n.cancelEdit=f,n.updateFeed=m,n.selectedFeedLocation=u,n.resetFeedLocation=l,n.getFeedHtml=c,i&&(i.newsFeedList?s.parseMoreText(i.newsFeedList[0]):s.parseMoreText(i)),n.editorEnabled=!0,n.feedText=s.text(),n.feedLocation=angular.copy(s.getLocationInfo()),n.ogData=angular.copy(s.getOgData()),n.ogData.image&&(n.ogData.images=[n.ogData.image]),n.ogShowPreview=s.hasOgData(),n.emotions=s.hasFeelings()?[s.getFeelings()]:[];function c(){return s.getDynamicText()}function l(){n.feedLocation={}}function u(e){n.feedLocation=e,n.$rgDigest()}function d(e){n.emotions.length=0,n.emotions.push(e),n.$rgDigest()}function g(){return!(n.feedText||n.feedLocation.description||n.ogData.url||n.feelings&&n.feelings.id||n.feed.hasMedia()||n.feed.hasTagUsers())}n.sentRequest=!1;function m(){n.feedText=n.feedText.trim(),n.emotions.length?(n.feelings=n.emotions[0],n.emotions.length=0):n.feelings=!1,g()?(n.errorImageEdit=!0,n.editorEnabled=!0):(n.sentRequest=!0,o.updateFeed(e.currentUser(),s,n.feedText,n.feedLocation,n.ogData,n.feelings).then(function(e){e.sucs?n.$close({sucs:!0}):(n.sentRequest=!1,a.show(e,"error"),n.$rgDigest())},function(e){a.show(e,"error"),n.$rgDigest()})),n.$rgDigest()}function f(){n.$close({sucs:!1})}n.contentHightChanged=function(){n.$emit(t.RINGBOX.UPDATE)}}angular.module("ringid.feed").controller("FeedDashboardController",["$scope","$controller","OPERATION_TYPES","Ringalert",function(e,t,n,r){e.pagekey=n.SYSTEM.TYPE_NEWS_FEED+".all",e.action=n.SYSTEM.TYPE_NEWS_FEED,e.params={actn:n.SYSTEM.TYPE_NEWS_FEED},e.forAdd="my",t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedProfileController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i,o,a=n.uId,s=a;e.currentUser&&e.currentUser.equals(a)?(i="my",o=r.SYSTEM.TYPE_MY_NEWS_FEED):(i="friend",o=r.SYSTEM.TYPE_FRIEND_NEWSFEED),s=o+"."+a,e.pagekey=s,e.action=o,e.params={actn:o,fndId:a},e.forAdd=i,e.sortBy="at",t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedCircleController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="circle",a=n.circleId,s=r.SYSTEM.TYPE_GROUP_NEWS_FEED+"."+a;e.pagekey=s,e.action=r.SYSTEM.TYPE_GROUP_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_GROUP_NEWS_FEED,grpId:a},e.forAdd=o,e.shareMenuDisabled=!0,t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedMediasController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="my",a=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED+".medias";e.pagekey=a,e.action=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,pvtid:0,st:0,mtf:0},e.a_f_m="f",e.setTrending=function(t){e.params.mtf=t;var n=e.a_f_m;1===t?e.a_f_m="t":e.a_f_m="f",n!==e.a_f_m&&(i.reset(),i.initFeedRequest(e.params),e.$rgDigest())},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedNewsportalController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="newsportal",a=r.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal";e.pagekey=a,e.action=r.SYSTEM.TYPE_NEWS_PORTAL_FEED,e.params={actn:r.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},e.isReady=!0,e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("feedTagUserListController",feedTagUserListController),feedTagUserListController.$inject=["$scope","remoteData","userFactory","Api"];function feedTagUserListController(e,t,n,r){var i=t.fTgLst;e.usersUtIds=[],e.users=[];var o=i.length;if(o){e.total=o;for(var a=0;a<i.length;a++)i[a].fn=i[a].nm,e.users.push(n.createByUtId(i[a],!0))}e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:r.user.getMutualFriends(e)}}}angular.module("ringid.feed").filter("filterUserByName",filterUserByName).controller("feedEditTagController",feedEditTagController);function filterUserByName(){return function(e,t){if(e){for(var n=[],r=new RegExp(t,"i"),i=0;i<e.length;i++)e[i].getName().match(r)&&n.push(e[i]);return n}}}feedEditTagController.$inject=["$scope","localData","remoteData","$$connector","feedFactory","OPERATION_TYPES","userFactory","$filter","friendsFactory","Ringalert","Auth"];function feedEditTagController(e,t,n,r,i,o,a,s,c,l,u){var d=t.feed,g=!1,m=[],f=[],E=[];e.users=[],e.filterText="",e.loading=!0,e.currentType="a";var p=u.currentUser();function T(){e.users=s("filterUserByName")(E,e.filterText)}function h(){g||(c.searchContact({schPm:e.filterText},!0),e.loading=!0,g=!0)}e.$watch("filterText",function(t,n){T(),e.users.length<5&&t.length>n.length?(g=!1,h()):(g=!1,e.loading=!1)}),e.$watch(c.friends.length(),function(t,n){_(),e.loading=!1,g=!1});function _(){if("a"!==e.currentType)return void T();c.friends.doForAll(function(e){var t=e.getLiteUser();E.contains(t,function(e,t){return e.equals(t,"utId")})===-1&&m.contains(t,function(e,t){return e.equals(t,"utId")})===-1&&E.push(t)});var t=m.filter(function(e){return E.contains(e,function(e,t){return e.equals(t,"utId")})===-1});E=E.concat(t),T()}if(n&&n.fTgLst&&n.fTgLst.length){for(var I=0;I<n.fTgLst.length;I++)n.fTgLst[I].fn=n.fTgLst[I].nm,m.contains(n.fTgLst[I].utId,function(e,t){return e.equals(t,"utId")})===-1&&(m.push(a.createByUtId(n.fTgLst[I],!0)),f.push(m[I]));_()}e.loading=!1,d.hasTagUsers()||_(),e.toggle=function(t){e.currentType!=t&&(e.currentType=t,"a"==t?(E=[],_()):(E=m,T()))},e.checked=function(e){return m.indexOf(e)>-1},e.loadMore=function(){e.filterText.length?h():(c.getContactDetails(),e.loading=!0)},e.addRemoveTag=function(t,n){var r=m.indexOf(n);r>-1?m.splice(r,1):(m.push(n),e.users.length-m.length<5&&e.loadMore())},e.saveTagUser=function(){var t,n=f.difference(m),r=m.difference(f);if(!n.length&&!r.length)return void l.show("Please Make Your Changes Before Submit","warning");if(0===r.length&&n.length===f.length&&!d.validateForUpdateTag())return void l.show("You can't submit an empty feed","warning");var o={},a={};if(n.length)for(t=0;t<n.length;t++)o[n[t].getUtId()]=!0;if(r.length)for(t=0;t<r.length;t++)a[r[t].getUtId()]=!0;var s={removed:Object.keys(o),new:Object.keys(a)};i.updateFeed(p,d,d.text(),d.getLocationInfo(),!1,d.getFeelings(),s).then(function(t){d.updateTagUser(t),e.$close(d)},function(e){l.show(e,"error")})},e.$on("$destroy",function(){})}angular.module("ringid.feed").directive("rgCommonFeedTop",rgCommonFeedTop),rgCommonFeedTop.$inject=[];function rgCommonFeedTop(){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e,t,n){}}}angular.module("ringid.feed").directive("rgCommonFeedBottom",rgCommonFeedBottom),rgCommonFeedBottom.$inject=[];function rgCommonFeedBottom(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath}}}angular.module("ringid.feed").directive("rgCommonFeedDetails",rgCommonFeedDetails);function rgCommonFeedDetails(){
return{restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}!function(e,t){"use strict";e.module("ringid.chat",["ringid.config","ringid.sticker","ngWebSocket","ringid.utils","ringid.connector","angularAudioRecorder"])}(angular,window),function(e){e.CHAT_APP={GLOBALS:{uId:-1,appVersion:-1},Constants:{},PacketFormats:{},PacketFormats:{},AuthPacketSender:{},AuthRequests:{},AuthResponses:{},ChatPacketSender:{},Helpers:{},ResponseHelpers:{},SharedHelpers:{},ChatPacketParser:{},PacketSendFlow:{},ChatSessionPacketSender:{},ChatOnlinePacketSender:{},ChatOfflinePacketSender:{},MODELS:{SESSION_OBJECT:{}},CHAT_CLOCK:{},REQUEST_CACHE:{},RESPONSE_CACHE:{},CHAT_SESSION:{},BROKEN_PACKET_CACHE:{},UTILS:{},ChatConnector:{},AuthConnector:{},getCurrentUserId:function(){return CHAT_APP.GLOBALS.uId},getAppVersion:function(){return CHAT_APP.GLOBALS.appVersion},getOfflineIp:function(){return CHAT_APP.GLOBALS.oIpPort.ip},getOfflinePort:function(){return CHAT_APP.GLOBALS.oIpPort.port},Init:function(){}}}(window),function(e){var t={FRIEND_CHAT_REGISTER:1,FRIEND_CHAT_UNREGISTER:2,FRIEND_CHAT_REGISTER_CONFIRMATION:3,FRIEND_CHAT_IDLE:4,FRIEND_CHAT_TYPING:5,FRIEND_CHAT_MSG:6,FRIEND_CHAT_MSG_EDIT:7,FRIEND_CHAT_BROKEN_MSG:8,FRIEND_CHAT_BROKEN_MSG_EDIT:9,FRIEND_CHAT_MULTIPLE_MSG:10,FRIEND_CHAT_DELIVERED:15,FRIEND_CHAT_SENT:16,FRIEND_CHAT_SEEN:17,FRIEND_CHAT_SEEN_CONFIRMATION:18,FRIEND_CHAT_MULTIPLE_MSG_DELETE:19,FRIEND_CHAT_MSG_DELETE_CONFIRMATION:20,FRIEND_CHAT_BROKEN:24,FRIEND_CHAT_BROKEN_CONFIRMATION:25,FRIEND_CHAT_BLOCK:27,FRIEND_CHAT_UNBLOCK:28,FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION:29},n={TAG_CHAT_TAG_REGISTER:41,TAG_CHAT_TAG_UNREGISTER:42,TAG_CHAT_TAG_REGISTER_CONFIRMATION:43,TAG_CHAT_TAG_INFORMATION:46,TAG_CHAT_TAG_INFORMATION_CONFIRMATION:47,TAG_CHAT_TAG_MEMBER_ADD:51,TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION:52,TAG_CHAT_MEMBER_REMOVE_LEAVE:53,TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION:54,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE:55,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION:56,TAG_CHAT_IDLE:61,TAG_CHAT_TYPING:62,TAG_CHAT_MSG:63,TAG_CHAT_MSG_EDIT:64,TAG_CHAT_BROKEN_MSG:65,TAG_CHAT_BROKEN_MSG_EDIT:66,TAG_CHAT_MULTIPLE_MSG:67,TAG_CHAT_DELIVERED:68,TAG_CHAT_SENT:69,TAG_CHAT_SEEN:70,TAG_CHAT_SEEN_CONFIRMATION:71,TAG_CHAT_MULTIPLE_MSG_DELETE:72,TAG_CHAT_MSG_DELETE_CONFIRMATION:73,TAG_CHAT_GENERAL_BROKEN_PACKET:74,TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION:75},r={OFFLINE_FRIEND_INFORMATION:91,OFFLINE_FRIEND_INFORMATION_CONFIRMATION:92,OFFLINE_GET_REQUEST:93,OFFLINE_GET_REQUEST_CONFIRMATION:94,OFFLINE_FRIEND_UNREAD_MESSAGE:95,OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:96,OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST:97,OFFLINE_FRIEND_HISTORY_MESSAGE:98,OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION:99,OFFLINE_GET_FRIEND_MESSAGE_STATUS:100,OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION:101,OFFLINE_TAG_INFORMATION_ACTIVITY:104,OFFLINE_MY_TAG_LIST:105,OFFLINE_TAG_UNREAD_MESSAGE:106,OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:107,OFFLINE_TAG_CREATE_TAG:108,OFFLINE_TAG_CREATE_TAG_CONFIRMATION:109,OFFLINE_TAG_HISTORY_MESSAGE_REQUEST:110,OFFLINE_TAG_HISTORY_MESSAGE:111,OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS:112,OFFLINE_TAG_INFORMATION_WITH_MEMBERS:113,OFFLINE_TAG_CONFIRMATION:117,OFFLINE_BROKEN_HISTORY_PACKET:118,OFFLINE_BROKEN_PACKET:119,OFFLINE_BROKEN_PACKET_CONFIRMATION:120},i=Object.assign({},t,n,r),o={};o[t.FRIEND_CHAT_REGISTER]=t.FRIEND_CHAT_REGISTER_CONFIRMATION,o[t.FRIEND_CHAT_MSG]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],o[t.FRIEND_CHAT_MSG_EDIT]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],o[t.FRIEND_CHAT_BROKEN_MSG]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],o[t.FRIEND_CHAT_BROKEN_MSG_EDIT]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],o[t.FRIEND_CHAT_DELIVERED]=[t.FRIEND_CHAT_SEEN,t.FRIEND_CHAT_SEEN_CONFIRMATION],o[t.FRIEND_CHAT_SEEN]=t.FRIEND_CHAT_SEEN_CONFIRMATION,o[t.FRIEND_CHAT_BROKEN]=t.FRIEND_CHAT_BROKEN_CONFIRMATION,o[t.FRIEND_CHAT_MULTIPLE_MSG_DELETE]=t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,o[r.OFFLINE_FRIEND_INFORMATION]=r.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,o[r.OFFLINE_FRIEND_UNREAD_MESSAGE]=r.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,o[r.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]=r.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,o[r.OFFLINE_FRIEND_HISTORY_MESSAGE]=r.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,o[r.OFFLINE_GET_FRIEND_MESSAGE_STATUS]=r.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,o[n.TAG_CHAT_TAG_REGISTER]=n.TAG_CHAT_TAG_REGISTER_CONFIRMATION,o[n.TAG_CHAT_TAG_INFORMATION]=n.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,o[n.TAG_CHAT_TAG_MEMBER_ADD]=n.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,o[n.TAG_CHAT_MULTIPLE_MSG_DELETE]=n.TAG_CHAT_MSG_DELETE_CONFIRMATION,o[n.TAG_CHAT_MEMBER_REMOVE_LEAVE]=n.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,o[n.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]=n.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,o[n.TAG_CHAT_GENERAL_BROKEN_PACKET]=n.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,o[n.TAG_CHAT_MSG]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],o[n.TAG_CHAT_MSG_EDIT]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],o[n.TAG_CHAT_BROKEN_MSG]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],o[n.TAG_CHAT_BROKEN_MSG_EDIT]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],o[n.TAG_CHAT_DELIVERED]=[n.TAG_CHAT_SEEN,n.TAG_CHAT_SEEN_CONFIRMATION],o[n.TAG_CHAT_SEEN]=n.TAG_CHAT_SEEN_CONFIRMATION,o[r.OFFLINE_TAG_CREATE_TAG]=r.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,o[r.OFFLINE_GET_REQUEST]=r.OFFLINE_GET_REQUEST_CONFIRMATION,o[r.OFFLINE_TAG_UNREAD_MESSAGE]=r.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,o[r.OFFLINE_BROKEN_PACKET]=r.OFFLINE_BROKEN_PACKET_CONFIRMATION,o[r.OFFLINE_BROKEN_HISTORY_PACKET]=r.OFFLINE_BROKEN_PACKET_CONFIRMATION,o[r.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]=r.OFFLINE_TAG_CONFIRMATION,o[r.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]=r.OFFLINE_TAG_CONFIRMATION;var a={PACKET_IP_SIZE:4,PACKET_PORT_SIZE:2,PACKET_DYNAMIC_ATTRIBUTE:-1,PACKET_RAW_BYTE_ATTRIBUTE:-2,ONE_BYTE_SIZE:1,TWO_BYTE_SIZE:2,FOUR_BYTE_SIZE:4,EIGHT_BYTE_SIZE:8,PACKET_MAX_SIZE:512,TAG_ID_NO_OF_TIME_DIGIT:10,TAG_ID_NO_OF_USER_ID_DIGIT:6,OFFLINE_PACKET_TYPE_START:91,ATTRIBUTE_TYPE:{INTEGER:1,STRING:2,BYTE:3}},s={LOCAL_CHAT:!1,LOCAL_CHAT_REG_IP:"192.168.1.125",LOCAL_CHAT_REG_PORT:1500,LOCAL_CHAT_OFFLINE_IP:"192.168.1.125",LOCAL_CHAT_OFFLINE_PORT:1200,API_VERSION:3,API_VERSION_PORT_OFFSET:0,AUTH_UID_LIST_LIMIT:15,ACTUAL_TAG_REGISTER_TIMEOUT:180,TAG_REGISTER_TIMEOUT:160,API_FETCH_RETRY_COUNT:5,API_FETCH_RETRY_DELAY:3e3,RETRY_COUNT:5,AUTH_REQUEST_TIMEOUT:2e3,REQUEST_TIMEOUT:15e3,BOX_WAITING_TIME:180,UDP_SERVER_KEEP_ALIVE_INTERVAL:1e4,REQUEST_CACHE_VALIDITY:15e3,RESPONSE_CACHE_VALIDITY:4e3,BROKEN_CACHE_VALIDITY:3e5,TEMP_MESSAGE_CACHE_VALIDITY:12e4,SESSION_TYPES:{FRIEND:1,TAG:2},REQUEST_TYPES:{FRIEND:1,TAG:2},MEMBER_STATUS:{MEMBER:1,ADMIN:2,OWNER:3,REMOVED:4,LEAVE:5},MEMBER_MOODS:{ONLINE:1,AWAY:2,OFFLINE:3,DO_NOT_DISTURB:4},REGISTRATION_TYPES:{CREATE:1,ONLY_REGISTER:2,CHAT_INVITE:3},MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,TEXT:2,EMOTICON_MESSAGE:3,LOCATION_SHARE:4,LINK_SHARE:5,STICKER:6,IMAGE:7,AUDIO:8,VIDEO:9,CAMERA_IMAGE:10,FILE_STREAM:11,CONTACT_SHARE:12,FILE_STREAM_MAINIFEST:13,HISTORY_RE_FETCH:14,RING_MEDIA_MESSAGE:15,GROUP_ACTIVITY:20,TYPING:101},STATUS_MESSAGE_TYPES:{TAG_MEMBER_ADD:1,TAG_MEMBER_DELETE:2,TAG_MEMBER_LEAVE:3,TAG_MEMBER_STATUS_CHANGE_OWNER:4,TAG_MEMBER_STATUS_CHANGE_ADMIN:5,TAG_MEMBER_STATUS_CHANGE_MEMBER:6,TAG_NAME_CHANGE:7,TAG_PICTURE_CHANGE:8,TAG_INFO_UPDATED:9,TAG_ADMIN_ADD:10},PAGE_DIRECTION:{UP:1,DOWN:2},PAGE_LIMIT:10,ONLINE_STATUS:{OFFLINE:1,ONLINE:2,AWAY:3},ONLINE_MOOD:{ALIVE:1,DONT_DISTURB:2,BUSY:3,INVISIBLE:4},SECRET_VISIBILITY:{NON_VISIBLE:0,VISIBLE:1},TAG_ACTIVITY_TYPE:{DELETED:0,ADDED:1,LEAVE:2,TAG_RENAME:3,MEMBER_TYPE_CHANGE:4,TAG_URL_RENAME:5,TAG_CREATED:6},USER_PRESENCE:{OFFLINE:1,ONLINE:2,AWAY:3},HISTORY_MAX_MESSAGE:10,TAB_SYNC_MAX_TIME:18e4,TAB_SYNC_ACTIONS:{AUTH_REQUEST:0,CHAT_REQUEST:1,GENERAL_INFO_UPDATE:3,CHAT_BOX_INFO_UPDATE:4,SECRET_CHAT_TIMER:5,CHAT_HISTORY_REFRESH:6,CHAT_MSESSAGE_UPDATE:7},MAX_TASK_RETRY_COUNT:15,SHARED_WORKER_PATH:"js/worker/chat/shared.js",CHAT_WORKER_PATH:"/js/worker/chat/chat.worker.js"},c={KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},l={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_USER_MOOD_PRESENCE:199,GET_OFFLINE_IP_PORT:83},u={};u[l.RECEIVED_F2F_CHAT]=l.START_TAG_CHAT,u[l.RECEIVED_TAG_CHAT]=l.START_TAG_CHAT;var d={DEBUG:0,AUTH_REQUEST_RESPONSE:1,CHAT_REQUEST_RESPONSE:2,CHAT_DATA_RECEIVED:3,AUTH_DATA_RECEIVED:4,EXCEPTION:5,CHAT_TIMER_UPDATE:6,RE_INIT:7},g={serverTimeDiff:0,serverTime:0,offlineUpdateTime:0},m={version:"2.6"},f={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},E={OFFLINE:1,ONLINE:2},p={MESSAGE_SENDING:{ONLINE_IP_PORT_REQUEST:0,FIRST_ONLINE:1,PRESENCE_REFRESH:2,SECOND_ONLINE:3,ONLINE_IP_PORT_REFRESH:4,THIRD_ONLINE:5,ONLINE_SUCCESS:6,ONLINE_FAILED:7,FIRST_OFFLINE:101,OFFLINE_IP_PORT_REFRESH:102,SECOND_OFFLINE:102,OFFLINE_FAILED:104,OFFLINE_SUCCESS:105,SUCCESS:201,FAILED:202}},T={PERMISSION_DENIED:1},h=({SEND_MESSAGE:[p.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,p.MESSAGE_SENDING.FIRST_ONLINE,p.MESSAGE_SENDING.PRESENCE_REFRESH,p.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,p.MESSAGE_SENDING.ONLINE_FAILED,p.MESSAGE_SENDING.FIRST_OFFLINE,p.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]},{});!function(t,n,r){var i,o,a,s,c=e.angular&&angular.isObject||e.isObject;for(i in t)if(o=t[i],c(o)){t[i+"_VALUE"]=[];for(a in o)s=o[a],t[i+"_VALUE"][s]=a}for(var l=Object.keys(n.MESSAGE_SENDING),u=0,d=l.length;u<d;u++){var g=n.MESSAGE_SENDING[l[u]];try{r[g].NAME=l[u]}catch(e){r[g]={},r[g].NAME=l[u]}}}(s,p,h),e.CHAT_APP.Constants={FRIEND_CHAT_PACKET_TYPE:t,TAG_CHAT_PACKET_TYPE:n,OFFLINE_PACKET_TYPE:r,PACKET_TYPES:i,CONFIRMATION_MAP:o,GENERAL_CONSTANTS:s,PACKET_CONSTANTS:a,WORKER_NOTIFIER_TYPES:d,AUTH_SERVER_ACTIONS:l,AUTH_SERVER_REQUEST_UPDATE_MAP:u,CHAT_STATES:p,CHAT_STATE_INFO:h,CHAT_GLOBAL_VALUES:g,AUTH_REQUEST_TYPE:c,PLATFORM:f,CHAT_VERSION_INFO:m,RESPONSE_REASON_CODES:T,CHAT_SERVER_TYPES:E}}(window),function(e){var t=e.CHAT_APP.Constants,n=t.GENERAL_CONSTANTS;t.CHAT_GLOBAL_VALUES;function r(t,n){var r,i=CHAT_APP.SharedHelpers.getChatServerCurrentTime(),o=e.CHAT_APP.getCurrentUserId();return r=n||t?t:i,r||Logger.debug("alert","Invalid Timestamp","CHAT"),PacketIDGenerator.create(o,r,n)}function i(e,t,n,r,i){var o=0,a=function(){!o||o<r&&!t.call(null,o)?(e.call(),o++,setTimeout(a,i)):t.call(null,o)||n.call()};a()}function o(e){var t=CHAT_APP.SharedHelpers.getCurrentChatServerTime();return t-e<n.ACTUAL_TAG_REGISTER_TIMEOUT}function a(){var e=this,t={},n={},r={},i=null;function o(e,r,i){var o=getUniqueId("ctr");return t[o]=e,n[o]={delay:r,count:r,maxIteration:i},o}function a(e){delete t[e],delete n[e],Logger.debug("debug","TIMER DELETED FOR ID "+e,"CHAT_TIMER_DEBUG")}function s(e,t){r[e]||(r[e]={});var n=getUniqueId("ccl");return r[e][n]=t,n}function c(e,t){delete r[e][t]}e.setTimeout=function(t,n){if(n>999){var r=e.hasTimer(),i=o(t,n,1);return r?void 0:e.start(),Logger.debug("debug","TIMETOUT SET FOR ID "+i,"CHAT_TIMER_DEBUG"),i}return Logger.debug("error","USE CHAT CLOCK TIMER FOR WAIT TIME > 1000msc, Use Default Timeout/Interval for < 1000msc.","CHAT_TIMER_DEBUG"),0},e.setInterval=function(t,n,r){if(n>999){var i=e.hasTimer(),a=o(t,n,r||-1);return i?void 0:e.start(),Logger.debug("debug","INTERVAL SET FOR ID "+a,"CHAT_TIMER_DEBUG"),a}return Logger.debug("error","USE CHAT CLOCK TIMER FOR WAIT TIME > 1000msc, Use Default Timeout/Interval for < 1000msc.","CHAT_TIMER_DEBUG"),0},e.clearTimeout=function(e){a(e)},e.clearInterval=function(e){a(e)},e.hasTimer=function(){return Object.keys(n).length>0},e.on=function(e,t){return s(e,t)},e.off=function(e,t){c(e,t)},e.trigger=function(e,t){if(r[e]){var n=Object.keys(r[e]);n.forEach(function(n){r[e][n].call(this,t)})}},e.stop=function(){clearInterval(i)},e.start=function(){i=setInterval(function(){e.trigger("TICK");for(var r=Object.keys(n),i=0;i<r.length;i++){var o=r[i],s=n[o];s&&(0==s.maxIteration?a(o):0==s.count||s.maxIteration==-1?(t[o].call(),s.maxIteration!=-1?s.count=s.delay:void 0):(s.count--,s.maxIteration!=-1?s.maxIteration--:void 0))}},1e3)}}e.CHAT_APP.UTILS={hasChatSession:o,getUUIDPacketId:r,callXTimeAfterYIntervalStopOnSuccess:i,ChatClock:a}}(window),function(e){var t=e.CHAT_APP,n=t.Constants,r=(n.GENERAL_CONSTANTS,n.CHAT_GLOBAL_VALUES);t.ChatConnector;function i(){if(r.serverTime>0){var e=Date.now()+r.serverTimeDiff,t=e-r.serverTime,n=r.serverTime+t%1e3;return n}return Date.now()}function o(e){var t=Date.now()-i(),n=e+t;return n}e.CHAT_APP.SharedHelpers={getChatServerCurrentTime:i,getClientTimeFromServerTime:o}}(window),function(e){var t=e.CHAT_APP.Constants,n=t.FRIEND_CHAT_PACKET_TYPE,r=t.TAG_CHAT_PACKET_TYPE,i=t.OFFLINE_PACKET_TYPE,o=t.PACKET_CONSTANTS,a={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,LAST_ONLINE_TIME:26,NO_OF_ITEMS:27,BLOCK_UNBLOCK_DATE:28,MESSAGE_STATUS:29,IS_ADD_TO_DB:30,TAG_NAME_LENGTH:31,TAG_NAME:32,TAG_PICTURE_URL_LENGTH:33,TAG_PICTURE_URL:34,TAG_MEMBER_TYPE:35,TAG_MEMBER_ADDED_BY:36,TAG_NO_OF_MEMBERS:37,TAG_NO_OF_BROKEN_PKT:38,TAG_INFORMATION_UPDATE_FLAG:39,TAG_INFORMATION_TAG_NO_OF_MEMBERS:40,REGISTRATION_TYPE:41,PAGE_DIRECTION:42,PAGE_LIMIT:43,ACTIVITY_TYPE:45,ACTIVITY_VALUE_LENGTH:46,ACTIVITY_VALUE:47,CHANGED_BY_USER_ID:48,FRIEND_APP_TYPE:60,FRIEND_DEVICE_TOKEN_LENGTH:61,FRIEND_DEVICE_TOKEN:62,IS_SECRET_VISIBLE:63,APP_VERSION:64,RAW_DATA_BYTE:80},s={};s[a.PACKET_TYPE]={ATTRIBUTE_NAME:"PACKET_TYPE",VAR_NAME:"packetType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.USER_ID]={ATTRIBUTE_NAME:"USER_ID",VAR_NAME:"userId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.FRIEND_ID]={ATTRIBUTE_NAME:"FRIEND_ID",VAR_NAME:"friendId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.PACKET_ID_LENGTH]={ATTRIBUTE_NAME:"PACKET_ID_LENGTH",VAR_NAME:"packetIdLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.PACKET_ID]={ATTRIBUTE_NAME:"PACKET_ID",VAR_NAME:"packetId",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.PLATFORM]={ATTRIBUTE_NAME:"PLATFORM",VAR_NAME:"platform",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.CHAT_BINDING_PORT]={ATTRIBUTE_NAME:"CHAT_BINDING_PORT",VAR_NAME:"chatBindingPort",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[a.TAG_ID]={ATTRIBUTE_NAME:"TAG_ID",VAR_NAME:"tagId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.ONLINE_STATUS]={ATTRIBUTE_NAME:"ONLINE_STATUS",VAR_NAME:"onlineStatus",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.USER_MOOD]={ATTRIBUTE_NAME:"USER_MOOD",VAR_NAME:"userMood",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.MESSAGE_TYPE]={ATTRIBUTE_NAME:"MESSAGE_TYPE",VAR_NAME:"messageType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TIMEOUT]={ATTRIBUTE_NAME:"TIMEOUT",VAR_NAME:"timeout",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.LATITUDE]={ATTRIBUTE_NAME:"LATITUDE",VAR_NAME:"latitude",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[a.LONGITUDE]={ATTRIBUTE_NAME:"LONGITUDE",VAR_NAME:"longitude",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[a.MESSAGE_LENGTH]={ATTRIBUTE_NAME:"MESSAGE_LENGTH",VAR_NAME:"messageLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.MESSAGE]={ATTRIBUTE_NAME:"MESSAGE",VAR_NAME:"message",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.MESSAGE_DATE]={ATTRIBUTE_NAME:"MESSAGE_DATE",VAR_NAME:"messageDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.NO_OF_MESSAGE]={ATTRIBUTE_NAME:"NO_OF_MESSAGE",VAR_NAME:"messagesLength",VAR_CONTAINER_NAME:"messages",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.FULL_NAME_LENGTH]={ATTRIBUTE_NAME:"FULL_NAME_LENGTH",VAR_NAME:"fullNameLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.FULL_NAME]={ATTRIBUTE_NAME:"FULL_NAME",VAR_NAME:"fullName",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.NO_OF_PACKET]={ATTRIBUTE_NAME:"NO_OF_PACKET",VAR_NAME:"packetsLength",VAR_CONTAINER_NAME:"packets",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.SEQUENCE_NO]={ATTRIBUTE_NAME:"SEQUENCE_NO",VAR_NAME:"sequenceNo",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.NO_OF_MEMBERS]={ATTRIBUTE_NAME:"NO_OF_MEMBERS",VAR_NAME:"membersLength",VAR_CONTAINER_NAME:"members",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.UPDATE_TIME]={ATTRIBUTE_NAME:"UPDATE_TIME",VAR_NAME:"updateTime",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.SERVER_DATE]={ATTRIBUTE_NAME:"SERVER_DATE",VAR_NAME:"serverDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.LAST_ONLINE_TIME]={ATTRIBUTE_NAME:"LAST_ONLINE_TIME",VAR_NAME:"lastOnlineTime",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.NO_OF_ITEMS]={ATTRIBUTE_NAME:"NO_OF_ITEMS",VAR_NAME:"noOfItems",VAR_CONTAINER_NAME:"items",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.BLOCK_UNBLOCK_DATE]={ATTRIBUTE_NAME:"BLOCK_UNBLOCK_DATE",VAR_NAME:"blockUnblockDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.MESSAGE_STATUS]={ATTRIBUTE_NAME:"MESSAGE_STATUS",VAR_NAME:"status",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.IS_ADD_TO_DB]={ATTRIBUTE_NAME:"IS_ADD_TO_DB",VAR_NAME:"isAddToDb",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_NAME_LENGTH]={ATTRIBUTE_NAME:"TAG_NAME_LENGTH",VAR_NAME:"tagNameLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.TAG_NAME]={ATTRIBUTE_NAME:"TAG_NAME",VAR_NAME:"tagName",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.TAG_PICTURE_URL_LENGTH]={ATTRIBUTE_NAME:"TAG_PICTURE_URL_LENGTH",VAR_NAME:"tagPictureUrlLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_PICTURE_URL]={ATTRIBUTE_NAME:"TAG_PICTURE_URL",VAR_NAME:"tagPictureUrl",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.TAG_MEMBER_TYPE]={ATTRIBUTE_NAME:"TAG_MEMBER_TYPE",VAR_NAME:"status",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_MEMBER_ADDED_BY]={ATTRIBUTE_NAME:"TAG_MEMBER_ADDED_BY",VAR_NAME:"addedBy",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersLength",VAR_CONTAINER_NAME:"tagMembers",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.TAG_NO_OF_BROKEN_PKT]={ATTRIBUTE_NAME:"TAG_NO_OF_BROKEN_PKT",VAR_NAME:"brokenPacketsLength",VAR_CONTAINER_NAME:"brokenPackets",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_INFORMATION_UPDATE_FLAG]={ATTRIBUTE_NAME:"TAG_INFORMATION_UPDATE_FLAG",VAR_NAME:"updateFlag",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_INFORMATION_TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_INFORMATION_TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersCount",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.REGISTRATION_TYPE]={ATTRIBUTE_NAME:"REGISTRATION_TYPE",VAR_NAME:"registrationType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.PAGE_DIRECTION]={ATTRIBUTE_NAME:"PAGE_DIRECTION",VAR_NAME:"pageDirection",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.PAGE_LIMIT]={ATTRIBUTE_NAME:"PAGE_LIMIT",VAR_NAME:"pageLimit",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.ACTIVITY_TYPE]={ATTRIBUTE_NAME:"ACTIVITY_TYPE",VAR_NAME:"activityType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1,CONDITIONAL:!0},s[a.ACTIVITY_VALUE_LENGTH]={ATTRIBUTE_NAME:"ACTIVITY_VALUE_LENGTH",VAR_NAME:"activityValueLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.ACTIVITY_VALUE]={ATTRIBUTE_NAME:"ACTIVITY_VALUE",VAR_NAME:"activityValue",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.CHANGED_BY_USER_ID]={ATTRIBUTE_NAME:"CHANGED_BY_USER_ID",VAR_NAME:"changedByUserId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.FRIEND_APP_TYPE]={ATTRIBUTE_NAME:"FRIEND_APP_TYPE",VAR_NAME:"friendAppType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.FRIEND_DEVICE_TOKEN_LENGTH]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN_LENGTH",VAR_NAME:"friendDeviceTokenLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.FRIEND_DEVICE_TOKEN]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN",VAR_NAME:"friendDeviceToken",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.IS_SECRET_VISIBLE]={ATTRIBUTE_NAME:"IS_SECRET_VISIBLE",VAR_NAME:"isSecretVisible",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.APP_VERSION]={ATTRIBUTE_NAME:"APP_VERSION",VAR_NAME:"appVersion",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.RAW_DATA_BYTE]={ATTRIBUTE_NAME:"RAW_DATA_BYTE",VAR_NAME:"bytes",VAR_TYPE:o.ATTRIBUTE_TYPE.BYTE,SIZE:-2};var c={};c[n.FRIEND_CHAT_REGISTER]={PACKET_NAME:"FRIEND_CHAT_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[n.FRIEND_CHAT_UNREGISTER]={PACKET_NAME:"FRIEND_CHAT_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM,a.ONLINE_STATUS,a.USER_MOOD]},c[n.FRIEND_CHAT_REGISTER_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.CHAT_BINDING_PORT,a.SERVER_DATE]},c[n.FRIEND_CHAT_IDLE]={PACKET_NAME:"FRIEND_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PLATFORM]},c[n.FRIEND_CHAT_TYPING]={PACKET_NAME:"FRIEND_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PLATFORM]},c[n.FRIEND_CHAT_MSG]={PACKET_NAME:"FRIEND_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_BROKEN_MSG]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_MULTIPLE_MSG]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE]]},c[n.FRIEND_CHAT_DELIVERED]={PACKET_NAME:"FRIEND_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[n.FRIEND_CHAT_SENT]={PACKET_NAME:"FRIEND_CHAT_SENT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[n.FRIEND_CHAT_SEEN]={PACKET_NAME:"FRIEND_CHAT_SEEN",BROKEN_CONTAINER:"messages",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_DATE,a.MESSAGE_STATUS],a.PLATFORM]},c[n.FRIEND_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[n.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[n.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[n.FRIEND_CHAT_BROKEN]={PACKET_NAME:"FRIEND_CHAT_BROKEN",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},c[n.FRIEND_CHAT_BROKEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BROKEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},c[n.FRIEND_CHAT_BLOCK]={PACKET_NAME:"FRIEND_CHAT_BLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.BLOCK_UNBLOCK_DATE,a.IS_ADD_TO_DB]},c[n.FRIEND_CHAT_UNBLOCK]={PACKET_NAME:"FRIEND_CHAT_UNBLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.BLOCK_UNBLOCK_DATE]},c[n.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_TAG_REGISTER]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[r.TAG_CHAT_TAG_UNREGISTER]={PACKET_NAME:"TAG_CHAT_TAG_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ONLINE_STATUS,a.USER_MOOD]},c[r.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.CHAT_BINDING_PORT,a.SERVER_DATE]},c[r.TAG_CHAT_TAG_INFORMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ACTIVITY_TYPE,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL]},c[r.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_TAG_MEMBER_ADD]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE]]},c[r.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_MEMBER_REMOVE_LEAVE]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID]]},c[r.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.TAG_MEMBER_TYPE]]},c[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_IDLE]={PACKET_NAME:"TAG_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PLATFORM]},c[r.TAG_CHAT_TYPING]={PACKET_NAME:"TAG_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PLATFORM]},c[r.TAG_CHAT_MSG]={PACKET_NAME:"TAG_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_BROKEN_MSG]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_MULTIPLE_MSG]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_DELIVERED]={PACKET_NAME:"TAG_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_SENT]={PACKET_NAME:"TAG_CHAT_SENT",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_SEEN]={PACKET_NAME:"TAG_CHAT_SEEN",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[r.TAG_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_GENERAL_BROKEN_PACKET]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},c[r.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},c[i.OFFLINE_FRIEND_INFORMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.PLATFORM,a.ONLINE_STATUS,a.FRIEND_APP_TYPE,a.FRIEND_DEVICE_TOKEN_LENGTH,a.FRIEND_DEVICE_TOKEN,a.USER_MOOD]},c[i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[i.OFFLINE_GET_REQUEST]={PACKET_NAME:"OFFLINE_GET_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.UPDATE_TIME,a.BLOCK_UNBLOCK_DATE,a.APP_VERSION,a.PLATFORM]},c[i.OFFLINE_GET_REQUEST_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_REQUEST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SERVER_DATE]},c[i.OFFLINE_FRIEND_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE]]},c[i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST",
CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PAGE_DIRECTION,a.PAGE_LIMIT,a.PLATFORM]},c[i.OFFLINE_FRIEND_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.MESSAGE_STATUS],a.PAGE_DIRECTION]},c[i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID,a.PACKET_ID_LENGTH,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID],a.PLATFORM]},c[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[i.OFFLINE_TAG_INFORMATION_ACTIVITY]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_ACTIVITY",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.ACTIVITY_TYPE,a.USER_ID,a.ACTIVITY_VALUE_LENGTH,a.ACTIVITY_VALUE,a.TAG_MEMBER_TYPE,a.CHANGED_BY_USER_ID,a.UPDATE_TIME]]},c[i.OFFLINE_MY_TAG_LIST]={PACKET_NAME:"OFFLINE_MY_TAG_LIST",BROKEN_CONTAINER:"items",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.TAG_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_MEMBER_ADDED_BY,a.TAG_INFORMATION_TAG_NO_OF_MEMBERS]]},c[i.OFFLINE_TAG_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]]},c[i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[i.OFFLINE_TAG_CREATE_TAG]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE],a.PLATFORM]},c[i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PAGE_DIRECTION,a.PAGE_LIMIT,a.APP_VERSION,a.PLATFORM]},c[i.OFFLINE_TAG_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE],a.PAGE_DIRECTION]},c[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[i.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE,a.TAG_MEMBER_ADDED_BY]]},c[i.OFFLINE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[i.OFFLINE_BROKEN_HISTORY_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_HISTORY_PACKET",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},c[i.OFFLINE_BROKEN_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE,a.USER_ID,a.PLATFORM]},c[i.OFFLINE_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"OFFLINE_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},e.CHAT_APP.PacketFormats={CHAT_PACKET_ATTRIBUTE:a,CHAT_PACKET_ATTRIBUTE_INFO:s,CHAT_PACKET_INFO:c}}(window),function(e){"use strict";function t(){var t=e.CHAT_APP.Constants.PACKET_TYPES,n=e.CHAT_APP.Constants.PLATFORM.WEB,r=e.CHAT_APP.getAppVersion,i=e.CHAT_APP.getCurrentUserId,o=e.CHAT_APP.UTILS.getUUIDPacketId;this.getFriendChatRegisterObject=function(e,r){var a={packetType:t.FRIEND_CHAT_REGISTER,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatUnregisterObject=function(e,r,a,s){var c={packetType:t.FRIEND_CHAT_UNREGISTER,userId:i(),friendId:e,platform:n,onlineStatus:r,userMood:a,packetId:s||o()};return c},this.getFriendChatRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.FRIEND_CHAT_REGISTER_CONFIRMATION,friendId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getFriendChatIdleObject=function(e){var r={packetType:t.FRIEND_CHAT_IDLE,userId:i(),friendId:e,platform:n};return r},this.getFriendChatTypingObject=function(e){var r={packetType:t.FRIEND_CHAT_TYPING,userId:i(),friendId:e,platform:n};return r},this.getFriendChatMsgObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatMsgEditObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG_EDIT,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatBrokenMsgObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatBrokenMsgEditObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG_EDIT,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatMultipleMsgObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_MULTIPLE_MSG,userId:i(),friendId:e,messages:n,packetId:r||o()};return a},this.getFriendChatDeliveredObject=function(e,r){var a={packetType:t.FRIEND_CHAT_DELIVERED,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatSentObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SENT,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatSeenObject=function(e,r,a){var s={packetType:t.FRIEND_CHAT_SEEN,userId:i(),friendId:e,messages:r,platform:n,packetId:a||o()};return s},this.getFriendChatSeenConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SEEN_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatMultipleMsgDeleteObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_MULTIPLE_MSG_DELETE,userId:i(),friendId:e,packets:n,packetId:r||o()};return a},this.getFriendChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatBrokenObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BROKEN,userId:i(),friendId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getFriendChatBrokenConfirmationObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_BROKEN_CONFIRMATION,userId:i(),friendId:e,sequenceNo:n,packetId:r||o()};return a},this.getFriendChatBlockObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BLOCK,userId:i(),friendId:e,blockUnblockDate:n,isAddToDb:r,packetId:a||o()};return s},this.getFriendChatUnblockObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_UNBLOCK,userId:i(),friendId:e,blockUnblockDate:n,packetId:r||o()};return a},this.getFriendChatBlockUnblockConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getTagChatTagRegisterObject=function(e,r){var a={packetType:t.TAG_CHAT_TAG_REGISTER,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getTagChatTagUnregisterObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_TAG_UNREGISTER,userId:i(),tagId:e,onlineStatus:n,userMood:r,packetId:a||o()};return s},this.getTagChatTagRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.TAG_CHAT_TAG_REGISTER_CONFIRMATION,tagId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getTagChatTagInformationObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_TAG_INFORMATION,userId:i(),tagId:e,activityType:n,tagName:r,tagPictureUrl:a,packetId:s||o()};return c},this.getTagChatTagInformationConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberAddObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_ADD,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberAddConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatMemberRemoveLeaveObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatMemberRemoveLeaveConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberTypeChangeObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberTypeChangeConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatIdleObject=function(e){var r={packetType:t.TAG_CHAT_IDLE,userId:i(),tagId:e,platform:n};return r},this.getTagChatTypingObject=function(e){var r={packetType:t.TAG_CHAT_TYPING,userId:i(),tagId:e,platform:n};return r},this.getTagChatMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatMsgEditObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG_EDIT,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatBrokenMsgObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatBrokenMsgEditObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG_EDIT,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatMultipleMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MULTIPLE_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatDeliveredObject=function(e,n,r){var a={packetType:t.TAG_CHAT_DELIVERED,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSentObject=function(e,n){var r={packetType:t.TAG_CHAT_SENT,tagId:e,packetId:n||o()};return r},this.getTagChatSeenObject=function(e,n,r){var a={packetType:t.TAG_CHAT_SEEN,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSeenConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_SEEN_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getTagChatMultipleMsgDeleteObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MULTIPLE_MSG_DELETE,userId:i(),tagId:e,packets:n,packetId:r||o()};return a},this.getTagChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatGeneralBrokenPacketObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET,userId:i(),tagId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getTagChatGeneralBrokenPacketConfirmationObject=function(e,n,r){var a={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,userId:i(),tagId:e,sequenceNo:n,packetId:r||o()};return a},this.getOfflineFriendInformationObject=function(e,r,a,s,c,l,u){var d={packetType:t.OFFLINE_FRIEND_INFORMATION,userId:i(),friendId:e,fullName:r,platform:n,onlineStatus:a,friendAppType:s,friendDeviceToken:c,userMood:l,packetId:u||o()};return d},this.getOfflineFriendInformationConfirmationObject=function(e,r){var i={packetType:t.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,friendId:e,platform:n,packetId:r||o()};return i},this.getOfflineGetRequestObject=function(e,a,s){var c={packetType:t.OFFLINE_GET_REQUEST,userId:i(),updateTime:e,blockUnblockDate:a,appVersion:r(),platform:n,packetId:s||o()};return c},this.getOfflineGetRequestConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_GET_REQUEST_CONFIRMATION,serverDate:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineFriendHistoryMessageRequestObject=function(e,r,a,s){var c={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,userId:i(),friendId:e,pageDirection:r,pageLimit:a,platform:n,packetId:s||o()};return c},this.getOfflineFriendHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE,friendId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineFriendHistoryMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,friendId:e,packetId:n||o()};return r},this.getOfflineGetFriendMessageStatusObject=function(e,r,a){var s={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS,userId:i(),friendId:e,packets:r,platform:n,packetId:a||o()};return s},this.getOfflineGetFriendMessageStatusConfirmationObject=function(e,n,r){var i={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,friendId:e,packets:n,packetId:r||o()};return i},this.getOfflineTagInformationActivityObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_INFORMATION_ACTIVITY,tagId:e,noOfItems:n,items:r,packetId:i||o()};return a},this.getOfflineMyTagListObject=function(e,n,r){var i={packetType:t.OFFLINE_MY_TAG_LIST,noOfItems:e,items:n,packetId:r||o()};return i},this.getOfflineTagUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineTagUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineTagCreateTagObject=function(e,r,a,s,c){var l={packetType:t.OFFLINE_TAG_CREATE_TAG,userId:i(),tagId:e,tagName:r,tagPictureUrl:a,tagMembers:s,platform:n,packetId:c||o()};return l},this.getOfflineTagCreateTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineTagHistoryMessageRequestObject=function(e,a,s,c){var l={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,userId:i(),tagId:e,pageDirection:a,pageLimit:s,appVersion:r(),platform:n,packetId:c||o()};return l},this.getOfflineTagHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE,tagId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineGetTagInformationWithMembersObject=function(e,r){var a={packetType:t.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getOfflineTagInformationWithMembersObject=function(e,n,r,i,a){var s={packetType:t.OFFLINE_TAG_INFORMATION_WITH_MEMBERS,tagId:e,tagName:n,tagPictureUrl:r,tagMembers:i,packetId:a||o()};return s},this.getOfflineTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineBrokenHistoryPacketObject=function(e,n,r){var i={packetType:t.OFFLINE_BROKEN_HISTORY_PACKET,sequenceNo:e,bytes:n,packetId:r||o()};return i},this.getOfflineBrokenPacketObject=function(e,r,a){var s={packetType:t.OFFLINE_BROKEN_PACKET,sequenceNo:e,bytes:r,userId:i(),platform:n,packetId:a||o()};return s},this.getOfflineBrokenPacketConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_BROKEN_PACKET_CONFIRMATION,userId:i(),sequenceNo:e,packetId:n||o()};return r}}e.CHAT_APP.ChatRequests=new t}(window),function(e){"use strict";var t=e.CHAT_APP,n=t.AUTH_REQUEST_TYPE,r=t.getCurrentUserId;function i(){var e=(t.Constants.AUTH_REQUEST_TYPE,t.Constants.AUTH_SERVER_ACTIONS);this.getOfflineIpPort=function(t){var n={actn:e.GET_OFFLINE_IP_PORT,rid:r()};return t&&(n.pckId=t),n},this.getTagChatRegisterIpPort=function(t,n,r){var i={actn:e.START_TAG_CHAT,tid:t,uIds:n};return r&&(i.pckId=r),i},this.getFriendChatRegisterIpPort=function(t,n){var i={actn:e.START_F2F_CHAT,fndId:t,uId:r()};return n&&(i.pckId=n),i},this.getTagChatMembersAddObject=function(t,n,r,i,o){var a={actn:e.ADD_TAG_CHAT_MEMBERS,tid:t,uIds:n,chIp:r,chRp:i};return o&&(a.pckId=o),a},this.getOfflineIpPort=function(){var t={actn:e.GET_OFFLINE_IP_PORT,rid:r(),requestType:n.REQUEST};return t},this.getFriendPresenceObject=function(t){var n={actn:e.GET_USER_MOOD_PRESENCE,fndId:t};return n}}e.CHAT_APP.AuthRequests=new i}(window),function(e){var t=0,n=50,r=o(),i=122192928e9;function o(){return Date.UTC(1582,9,15)}function a(e){var t=s(e),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}}function s(e){return e-r}function c(){return(new Date).getTime()}function l(e){for(var r,i,o=0;o++<n;){if(r=e,r>t)return t=r,r;if(r<t)return t+1;if(i=t+1,i==t)return t=i,i}return i}function u(e,t,n){try{e=parseInt(e)}catch(e){return""}var r;n?r=t:(t||(t=c()),r=l(t));var i=a(r);return i.hi=4096|i.hi,g(i.low,i.mid,i.hi,e)}function d(e,t,n){e=String(e),n=n?n:"0";for(var r=t-e.length;r>0;r>>>=1,n+=n)1&r&&(e=n+e);return e}function g(e,t,n,r){var i=d(e.toString(16),8)+"-"+d(t.toString(16),4)+"-"+d(n.toString(16),4)+"-"+d((0).toString(16),4)+"-"+d(r.toString(16),12);return i}function m(e){var t=e.split("-"),n=[t[2].substring(1),t[1],t[0]].join(""),r=parseInt(n,16);r-=i;var o=Math.floor(r/1e4);return o}function f(){}f.prototype.create=u,f.prototype.getTimestamp=m,e=e||new f,window.PacketIDGenerator=e}(window.PacketIDGenerator);var TAG_CHAT_LANG={STATUS_MESSAGES:{SELF_ADD_MEMBER:"You added {new_member_name} as Group {new_member_type}.",SELF_ADD_MULTIPLE_MEMBER:"You added {new_member_name} and {rest_count} as Group {new_member_type}.",SELF_REMOVE_MEMBER:"You removed {old_member_name} from the group.",SELF_REMOVE_MULTIPLE_MEMBER:"You removed {old_member_name} and {rest_count} from the group.",OTHER_ADD_MEMBER:"{member_name} added {new_member_name} as Group {new_member_type}.",OTHER_ADD_MULTIPLE_MEMBER:"{member_name} added {new_member_name} and {rest_count} as Group {new_member_type}.",OTHER_REMOVE_MEMBER:"{member_name} removed {old_member_name} from the group.",OTHER_REMOVE_MULTIPLE_MEMBER:"{member_name} removed {old_member_name} and {rest_count} from the group.",SELF_LEAVE_GROUP:"You left this conversation.",OTHER_LEAVE_GROUP:"{member_name} left this conservation.",SELF_RENAME_GROUP:"You named the group {group_name}.",OTHER_RENAME_GROUP:"{member_name} named the group {group_name}.",SELF_CHANGE_GROUP_PIC:"You changed the group photo.",OTHER_CHANGE_GROUP_PIC:"{member_name} changed the group photo.",SELF_UPDATE_GROUP_INFO:"You named the group {group_name} and changed the group photo.",OTHER_UPDATE_GROUP_INFO:"{member_name} named the group {group_name} and changed the group photo.",SELF_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} Group Admin.",OTHER_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} as Admin.",SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} and {rest_count} as Group admin.",SELF_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} from Admin.",OTHER_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} from Group Admin.",SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} and {rest_count} from Group Admin.",SELF_REMOVED_FROM_ADMIN_BY_SELF:"You removed yourself from Admin",OTHER_REMOVED_FROM_ADMIN_BY_SELF:"{admin_name} removed himself/herself from Admin",SELF_USER_ADDED_AS_OWNER:"{member_name} made you owner.",OTHER_USER_ADDED_AS_OWNER:"{member_name} made {admin_name} Owner. ",SELF_NOT_GROUP_MEMBER:"You are no longer member of this group"},DEFAULT_FAILURE_MESSAGE:"Request has not been processed successfully. Please try again",DEFAULT_SUCCESS_MESSAGE:"Request has been processed successfully."},CHAT_LANG={MESSAGE_DELETE_TEXT:"This message has been deleted"},ChatApp=angular.module("ringid.chat");ChatApp.constant("CHAT_LANG",{TAG:TAG_CHAT_LANG,CHAT:CHAT_LANG});var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("ChatResponses",ChatResponses),ChatResponses.$inject=["$rootScope","chatHistoryFactory","SystemEvents","Auth","tagChatFactory","ChatFactory","tagChatManager","Utils","userFactory","ChatResponseProcessor","ChatSeenSend","ChatHelper","ChatConnector"];function ChatResponses(e,t,n,r,i,o,a,s,c,l,u,d,g){var m=window.CHAT_APP,f=m.Constants.PACKET_TYPES,E=m.Constants,p=E.GENERAL_CONSTANTS,T=E.CHAT_GLOBAL_VALUES,h=m.ChatRequests,_={};function I(e){return _[e]}function A(e){switch(e){case p.MESSAGE_TYPES.DELETE_MESSAGE:case p.MESSAGE_TYPES.TEXT:case p.MESSAGE_TYPES.EMOTICON_MESSAGE:case p.MESSAGE_TYPES.LOCATION_SHARE:case p.MESSAGE_TYPES.LINK_SHARE:case p.MESSAGE_TYPES.STICKER:case p.MESSAGE_TYPES.IMAGE:case p.MESSAGE_TYPES.CAMERA_IMAGE:case p.MESSAGE_TYPES.AUDIO:case p.MESSAGE_TYPES.VIDEO:case p.MESSAGE_TYPES.RING_MEDIA_MESSAGE:return!0;default:return!1}}function v(e){var t=e.packetType,n=I(t);if(!n)return!1;try{n.processor.call(this,e)}catch(e){}return!0}function S(e){e.userId,e.friendId,e.packetId}function C(e){var t=e.userId,n=(e.friendId,e.onlineStatus,e.userMood,e.packetId,o.getBoxByUId(t));t===n.getKey()&&o.closeChatBox(n.getKey())}function D(e){var t=e.friendId,n=(e.chatBindingPort,e.serverDate);e.packetId;T.serverTime=n,T.serverTimeDiff=Date.now()-n;var r=o.getBoxByUId(t);r||(r=o.creatNonDomBox(t,!1))}function M(e){var t=e.userId,n=(e.friendId,o.getBoxByUId(t));n&&n.setFriendTypingBool(!1)}function y(e){var t;e.userId,e.friendId;t=e.userId==r.currentUser().getKey()?e.friendId:e.userId;var i=o.getBoxByUId(t);i&&(i.setFriendTypingBool(!0),setTimeout(function(){i.setFriendTypingBool(!1),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t})},3e3))}function N(e){var i=e.userId,a=e.friendId,d=e.messageType,g=e.timeout,m=(e.message,e.messageDate),f=(e.isSecretVisible,e.packetId);if(A(d)){var E,T=e.boxId,h=r.currentUser().getKey();if(T||(T=i),T==h&&(T=a),T=T.toString(),!t.isInLocalStorageChatMsgMap(T,f)){var _=o.getBoxByUId(T);if(d===p.MESSAGE_TYPES.DELETE_MESSAGE)l.doOnMessageTypeDeleteMessage(T,i,f,e,_);else if(e.messageType>p.MESSAGE_TYPES.BLANK_MESSAGE){_?e.fromHistory||_.nonDomBox||(_.nonDomBox=!0,_.loadHistoryMessages(),s.triggerCustomEvent(n.CHAT.BOX_OPENNED,{boxId:T})):o.openChatBox(T),_=o.getBoxByUId(T),_.setFriendTypingBool(!1),e.fromHistory&&e.fromOffline||(_&&!_.isFocused&&_.latestSeenMessageDate<=m?(e.status="Unread",E="unread"):e.status=e.status||"Received"),e.fromHistory?"Unread"!=e.status&&(e.seenSent=!0):E="bottom",e.tag_chat=!1;var a=_.getKey();if("Edited"==e.status||!_.isSamePacketId(f)){if(e.user=c.create({uId:i,fetchDatails:!1}),"Unread"==e.status&&(o.increaseUnreadMessageCount(T,e.packetId),_.updateUnreadCount()),_.pushMessage(e,_.getKey()),!e.fromHistory&&_.isFocused){var I=p.MESSAGE_TYPES,v=[{key:e.packetId,value:_.getMessage(e.packetId)}];[I.IMAGE,I.AUDIO,I.VIDEO,I.CAMERA_IMAGE,I.RING_MEDIA_MESSAGE].indexOf(d)==-1&&(u.sendSeenPacket(_,v),g>0&&s.triggerCustomEvent(n.CHAT.WAS_FOCUSED,{box:_,filteredMessages:v}))}t.updateBox(_)}}}}}function b(e){e.userId,e.friendId,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;e.status="Edited",N(e)}function O(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;N(e)}function P(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;b(e)}function R(e){e.userId,e.friendId,e.messages,e.packetId}function U(e){var t=e.userId,n=e.friendId,r=e.packetId,i=l.getFriendBoxId(t,n),o=l.getFriendBox(i),a=o.getMessage(r);a&&(l.updateMessageStatusToDelivered(i,a),o.sendTabUpdate(a))}function L(e){var t=e.userId,n=e.friendId,r=e.packetId,i=l.getFriendBoxId(t,n),o=l.getFriendBox(i),a=o.getMessage(r);a&&(l.updateMessageStatusToDelivered(o.getKey(),a),o.sendTabUpdate(a))}function F(e){for(var r=e.userId,i=e.friendId,o=(e.messages,e.packetId,l.getFriendBoxId(r,i)),a=l.getFriendBox(o),c=0;c<e.messages.length;c++){var u=a.getMessage(e.messages[c].packetId);if(u){var d=!1;e.messages[c].status==p.MESSAGE_STATUS.DELETED||(e.messages[c].status==p.MESSAGE_STATUS.SEEN?(u.status="Seen",s.triggerCustomEvent(n.CHAT.DO_START_SECRET_TIMER,{boxId:o,others:!1,messages:[{key:e.messages[c].packetId,value:u}]}),d=!0):e.messages[c].status==p.MESSAGE_STATUS.VIEWED&&(u.status="Viewed",s.triggerCustomEvent(n.CHAT.DO_START_SECRET_TIMER,{boxId:o,others:!0,messages:[{key:e.messages[c].packetId,value:u}]}),d=!0)),d&&(t.updateMessage(u,a.getKey()),a.sendTabUpdate(u))}}}function w(e){e.userId,e.friendId,e.packetId}function k(e){for(var n=e.userId,i=e.friendId,o=e.packets,a=(e.packetId,l.getFriendBoxId(n,i)),s=l.getFriendBox(a),c=0;c<o.length;c++){var u=o[c].packetId,d=s.getMessage(u);d&&(n!=r.currentUser().getKey()?(d.messageType=p.MESSAGE_TYPES.DELETE_MESSAGE,d.text="This message has been deleted",d.setTextPartition(),d.status="Deleted"):s.removeMessage(u),t.updateMessage(d,s.getKey()),s.sendTabUpdate(d))}}function $(e){var t=e.userId,n=e.friendId,r=(e.packetId,l.getFriendBoxId(t,n));l.getFriendBox(r)}function G(e){e.userId,e.friendId,e.sequenceNo,e.rawDataByte,e.packetId}function B(e){e.userId,e.friendId,e.sequenceNo,e.packetId}function x(e){e.userId,e.friendId,e.blockUnblockDate,e.isAddToDb,e.packetId}function H(e){e.userId,e.friendId,e.blockUnblockDate,e.packetId}function Y(e){e.userId,e.friendId,e.packetId}function K(e){e.userId,e.tagId,e.packetId}function j(e){e.userId,e.tagId,e.onlineStatus,e.userMood,e.packetId}function V(e){var t=e.tagId,n=(e.chatBindingPort,e.serverDate);e.packetId;T.serverTime=n,T.serverTimeDiff=Date.now()-n;var r=o.getBoxByUId(t);r||(r=o.creatNonDomBox(t,!0))}function W(e){e.userId,e.tagId,e.activityType,e.tagName,e.tagPictureUrl,e.packetId;l.processTagInformation(e)}function q(e){e.userId,e.tagId,e.packetId}function z(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;l.processTagMemberAddUpdate(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function Q(e){e.userId,e.tagId,e.packetId}function X(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;l.processTagMemberRemoveLeave(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function Z(e){var t=e.userId,i=e.tagId;e.packetId;t===r.currentUser().getKey()&&l.doTagUnregisterTask(i),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:i})}function J(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;l.processTagMemberStatusChange(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function ee(e){e.userId,e.tagId,e.packetId}function te(e){var t=(e.userId,e.tagId),n=o.getBoxByUId(t);n&&n.setFriendTypingBool(!1)}function ne(e){var t,r,a=e.userId,c=e.tagId;t=o.getBoxByUId(c),t&&(r=i.getTag(c),r&&(t.showTypingText(a),setTimeout(function(){t.hideTypingText(),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c})},3e3)))}function re(e){var r=e.userId,d=e.tagId,m=e.messageType,f=(e.message,e.messageDate),E=e.packetId;if(A(m)&&(d=d.toString(),e.fromHistory||!t.isInLocalStorageChatMsgMap(d,E))){var T=i.getTag(d);if(!T){var _=h.getOfflineGetTagInformationWithMembersObject(d);g.send(_),T=i.getOrCreateTag(d)}var I,v=o.getBoxByUId(d);if(m===p.MESSAGE_TYPES.DELETE_MESSAGE)l.doOnMessageTypeDeleteMessage(d,r,E,e,v);else if(m>p.MESSAGE_TYPES.BLANK_MESSAGE){v=a.openTagChatBoxIfClosed(d,v),e.fromHistory||(I="bottom"),e.fromHistory&&e.fromOffline||(v&&!v.isFocused&&v.latestSeenMessageDate<=f?(e.status="Unread",I="unread"):e.status=e.status||"Received"),e.tag_chat=!0;var d=v.getKey();if(!v.isSamePacketId(E)){if(e.user=c.create({uId:r,fetchDatails:!1}),!e.fromHistory&&T&&T.isTagSafeToShow()&&(v.nonDomBox||(v.nonDomBox=!0,v.loadHistoryMessages(),s.triggerCustomEvent(n.CHAT.BOX_OPENNED,{boxId:d}))),e.fromHistory?("Unread"!=e.status&&(e.seenSent=!0),t.removeUnreadMessageInfo(d,E),v.updateUnreadCount()):"Unread"==e.status&&(o.increaseUnreadMessageCount(d,E),v.updateUnreadCount()),v.pushMessage(e,v.getKey()),!e.fromHistory&&v.isFocused){var S=p.MESSAGE_TYPES,C=[{key:e.packetId,value:v.getMessage(e.packetId)}];[S.IMAGE,S.AUDIO,S.VIDEO,S.CAMERA_IMAGE,S.RING_MEDIA_MESSAGE].indexOf(m)==-1&&u.sendSeenPacket(v,C)}t.updateBox(v)}}}}function ie(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId;e.status="Edited",re(e)}function oe(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function ae(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function se(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId}function ce(e){var n=(e.userId,e.friendId,e.tagId),r=e.packetId,i=l.getTagChatBox(n),o=i.getMessage(r);o&&("Seen"!==o.status&&(o.status="Delivered"),t.updateMessage(o,i.getKey())),t.updateBox(i)}function le(e){var n=e.tagId,r=e.packetId,i=l.getTagChatBox(n),o=i.updateMessageStatus(r,"Sent");o&&t.updateMessage(o,i.getKey()),t.updateBox(i)}function ue(e){var n=(e.userId,e.friendId,e.tagId),r=e.packetId,i=l.getTagChatBox(n),o=i.updateMessageStatus(r,"Seen");o&&t.updateMessage(o,i.getKey()),t.updateBox(i)}function de(e){e.tagId,e.packetId}function ge(e){var t=e.userId,n=e.tagId,r=e.packets;e.packetId;if(angular.isArray(r))for(var i=l.getTagChatBox(n),o=0;o<r.length;o++)l.doOnMessageTypeDeleteMessage(n,t,r[o].packetId,null,i)}function me(e){e.userId,e.tagId,e.packetId}function fe(e){e.userId,e.tagId,e.sequenceNo,e.rawDataByte,e.packetId}function Ee(e){e.userId,e.tagId,e.sequenceNo,e.packetId}function pe(e){e.userId,e.friendId,e.fullName,e.onlineStatus,e.friendAppType,e.friendDeviceToken,e.userMood,e.packetId}function Te(e){e.friendId,e.packetId}function he(e){e.userId,e.updateTime,e.blockUnblockDate,e.packetId}function _e(e){var t=e.serverDate;e.packetId;T.serverTime=t,T.serverTimeDiff=Date.now()-t}function Ie(e){for(var t=e.messages,n=(e.packetId,0);n<t.length;n++){var r=t[n];r.messageType!=p.MESSAGE_TYPES.DELETE_MESSAGE?r.status="Unread":r.status="Deleted",r.fromOffline=!0,r.fromHistory=!1,N(r)}}function Ae(e){e.userId,e.packets,e.packetId}function ve(e){e.userId,e.friendId,e.pageDirection,e.pageLimit,
e.packetId}function Se(e){var t=e.friendId,i=e.messages,a=e.pageDirection,c=(e.packetId,r.currentUser().getKey()),u=[],d=o.getBoxByUId(t);if(d||(d=o.creatNonDomBox(t)),i.length||a==p.PAGE_DIRECTION.DOWN){for(var g=!1,m=0;m<i.length;m++){var f=i[m];f.messageType==p.MESSAGE_TYPES.HISTORY_RE_FETCH||f.messageType==p.MESSAGE_TYPES.DELETE_MESSAGE&&f.userId==c||(g=!0,f.userId.toString()==c?(f.status=l.getMessageStatus(f.status)||"Delivered",f.friendId=t):(f.status==p.MESSAGE_STATUS.DELETED?f.status="Deleted":f.status<p.MESSAGE_STATUS.SEEN?f.status="Unread":f.status="Received",f.friendId=c),f.boxId=t,f.fromOffline=!0,f.fromHistory=!0,N(f)),u.push(f.packetId)}g&&(d.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t,noScroll:!0}))}else d.hasHistoryMessage=!1}function Ce(e){e.friendId,e.packetId}function De(e){e.userId,e.friendId,e.packets,e.packetId}function Me(e){e.friendId,e.packets,e.packetId}function ye(e){var t=e.tagId,n=(e.noOfItems,e.items),r=e.packetId;n.forEach(function(e){l.processAGroupActivity(t,r,e)})}function Ne(e){for(var t,r=(e.noOfItems,e.items,e.packetId,0);r<e.items.length;r++)t=i.createNewTag(e.items[r]),i.addTagObject(t);s.triggerCustomEvent(n.CHAT.MY_TAG_LIST_RECEIVED)}function be(e){for(var t=(e.messages,e.packetId,0);t<e.messages.length;t++){var n=e.messages[t];n.messageType!=p.MESSAGE_TYPES.DELETE_MESSAGE?n.status="Unread":n.status="Deleted",n.fromUnread=!0,n.fromOffline=!0,n.messageType==p.MESSAGE_TYPES.GROUP_ACTIVITY?l.processGroupActivityMessage(n):re(n)}}function Oe(e){e.userId,e.packets,e.packetId}function Pe(e){e.userId,e.tagId,e.tagName,e.tagPictureUrl,e.tagMembers,e.packetId}function Re(e){e.tagId,e.packetId}function Ue(e){e.userId,e.tagId,e.pageDirection,e.pageLimit,e.packetId}function Le(e){var t=e.tagId,i=e.messages,o=e.pageDirection,a=(e.packetId,r.currentUser().getKey()),c=l.getTagChatBox(t);if(i.length||o==p.PAGE_DIRECTION.DOWN){for(var u,d=0;d<i.length;d++){var g=i[d];g.tagId=t,g.fromHistory=!0,g.fromOffline=!0,g.messageType==p.MESSAGE_TYPES.GROUP_ACTIVITY?(u=!0,l.processGroupActivityMessage(g)):g.messageType==p.MESSAGE_TYPES.HISTORY_RE_FETCH||g.messageType==p.MESSAGE_TYPES.DELETE_MESSAGE&&g.userId==a||(u=!0,g.status==p.MESSAGE_STATUS.DELETED?g.status="Deleted":g.userId==r.currentUser().getKey()?g.status="Seen":g.status="Received",re(g))}u&&(c.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t,noScroll:!0}))}else c.hasHistoryMessage=!1}function Fe(e){e.userId,e.tagId,e.packetId}function we(e){var t=e.tagId,r=(e.tagName,e.tagPictureUrl,e.tagMembers);e.packetId;e.tagMembersCount=r.length;var o=i.getOrCreateTag(t,e);l.addMembersToTagObject(o,e.tagMembers),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function ke(e){e.tagId,e.packetId}function $e(e){e.sequenceNo,e.rawDataByte,e.packetId}function Ge(e){e.sequenceNo,e.rawDataByte,e.userId,e.packetId}function Be(e){e.userId,e.sequenceNo,e.packetId}return _[f.FRIEND_CHAT_REGISTER]={processor:S},_[f.FRIEND_CHAT_UNREGISTER]={processor:C},_[f.FRIEND_CHAT_REGISTER_CONFIRMATION]={processor:D},_[f.FRIEND_CHAT_IDLE]={processor:M},_[f.FRIEND_CHAT_TYPING]={processor:y},_[f.FRIEND_CHAT_MSG]={processor:N},_[f.FRIEND_CHAT_MSG_EDIT]={processor:b},_[f.FRIEND_CHAT_BROKEN_MSG]={processor:O},_[f.FRIEND_CHAT_BROKEN_MSG_EDIT]={processor:P},_[f.FRIEND_CHAT_MULTIPLE_MSG]={processor:R},_[f.FRIEND_CHAT_DELIVERED]={processor:U},_[f.FRIEND_CHAT_SENT]={processor:L},_[f.FRIEND_CHAT_SEEN]={processor:F},_[f.FRIEND_CHAT_SEEN_CONFIRMATION]={processor:w},_[f.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={processor:k},_[f.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={processor:$},_[f.FRIEND_CHAT_BROKEN]={processor:G},_[f.FRIEND_CHAT_BROKEN_CONFIRMATION]={processor:B},_[f.FRIEND_CHAT_BLOCK]={processor:x},_[f.FRIEND_CHAT_UNBLOCK]={processor:H},_[f.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={processor:Y},_[f.TAG_CHAT_TAG_REGISTER]={processor:K},_[f.TAG_CHAT_TAG_UNREGISTER]={processor:j},_[f.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={processor:V},_[f.TAG_CHAT_TAG_INFORMATION]={processor:W},_[f.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={processor:q},_[f.TAG_CHAT_TAG_MEMBER_ADD]={processor:z},_[f.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={processor:Q},_[f.TAG_CHAT_MEMBER_REMOVE_LEAVE]={processor:X},_[f.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={processor:Z},_[f.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={processor:J},_[f.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={processor:ee},_[f.TAG_CHAT_IDLE]={processor:te},_[f.TAG_CHAT_TYPING]={processor:ne},_[f.TAG_CHAT_MSG]={processor:re},_[f.TAG_CHAT_MSG_EDIT]={processor:ie},_[f.TAG_CHAT_BROKEN_MSG]={processor:oe},_[f.TAG_CHAT_BROKEN_MSG_EDIT]={processor:ae},_[f.TAG_CHAT_MULTIPLE_MSG]={processor:se},_[f.TAG_CHAT_DELIVERED]={processor:ce},_[f.TAG_CHAT_SENT]={processor:le},_[f.TAG_CHAT_SEEN]={processor:ue},_[f.TAG_CHAT_SEEN_CONFIRMATION]={processor:de},_[f.TAG_CHAT_MULTIPLE_MSG_DELETE]={processor:ge},_[f.TAG_CHAT_MSG_DELETE_CONFIRMATION]={processor:me},_[f.TAG_CHAT_GENERAL_BROKEN_PACKET]={processor:fe},_[f.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={processor:Ee},_[f.OFFLINE_FRIEND_INFORMATION]={processor:pe},_[f.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={processor:Te},_[f.OFFLINE_GET_REQUEST]={processor:he},_[f.OFFLINE_GET_REQUEST_CONFIRMATION]={processor:_e},_[f.OFFLINE_FRIEND_UNREAD_MESSAGE]={processor:Ie},_[f.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={processor:Ae},_[f.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={processor:ve},_[f.OFFLINE_FRIEND_HISTORY_MESSAGE]={processor:Se},_[f.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={processor:Ce},_[f.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={processor:De},_[f.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={processor:Me},_[f.OFFLINE_TAG_INFORMATION_ACTIVITY]={processor:ye},_[f.OFFLINE_MY_TAG_LIST]={processor:Ne},_[f.OFFLINE_TAG_UNREAD_MESSAGE]={processor:be},_[f.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={processor:Oe},_[f.OFFLINE_TAG_CREATE_TAG]={processor:Pe},_[f.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={processor:Re},_[f.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={processor:Ue},_[f.OFFLINE_TAG_HISTORY_MESSAGE]={processor:Le},_[f.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={processor:Fe},_[f.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={processor:we},_[f.OFFLINE_TAG_CONFIRMATION]={processor:ke},_[f.OFFLINE_BROKEN_HISTORY_PACKET]={processor:$e},_[f.OFFLINE_BROKEN_PACKET]={processor:Ge},_[f.OFFLINE_BROKEN_PACKET_CONFIRMATION]={processor:Be},{processUpdates:v}}angular.module("ringid.chat").factory("ChatAuthResponses",ChatAuthResponses),ChatAuthResponses.$inject=["$rootScope","tagChatFactory","ChatFactory","ChatPacketSenderService","userFactory","friendsFactory","chatRequestProcessor","chatHistoryFactory","ChatWorkerCommands","Auth","ChatConnector"];function ChatAuthResponses(e,t,n,r,i,o,a,s,c,l,u){var d=CHAT_APP.Constants,g=d.GENERAL_CONSTANTS.SESSION_TYPES,m=d.RESPONSE_REASON_CODES,f=CHAT_APP.Constants.AUTH_SERVER_ACTIONS,E=d.GENERAL_CONSTANTS.USER_PRESENCE,p=CHAT_APP.ChatRequests,T=function(e){var t=n.getBoxByUId(e);return t||(t=n.creatNonDomBox(e,!1),t.loadHistoryMessages()),t},h={};function _(e){return h[e]}function I(e){1111==e.rc;var t=e.actn,n=_(t);if(!n)return!1;try{n.processor.call(this,e)}catch(e){}return!0}function A(e){var r=e.tid,i=t.getTag(r);if(i)i=t.getOrCreateTag(r);else{var o=n.getBoxByUId(r);o||(o=n.creatNonDomBox(r,!0));var a=p.getOfflineGetTagInformationWithMembersObject(r);u.request(a).then(function(e){if(e.sucs){var n=t.getTag(r);n&&c.startChatSession(r,g.TAG,n.getMemberUserIds())}})}}function v(e){var r=e.tid,i=t.getTag(r);if(i)i=t.getOrCreateTag(r),c.startChatSession(r,g.TAG),e.uIds&&angular.forEach(e.uIds,function(e){i.addMember(t.createNewTagMember(i.getTagId(),{userId:e},!0))});else{var o=n.getBoxByUId(r);o||(o=n.creatNonDomBox(r,!0));var a=p.getOfflineGetTagInformationWithMembersObject(r);u.request(a,10).then(function(e){if(e.sucs){t.getTag(r)}})}}function S(e){var t=e.fndId,n=t;if(n!=l.currentUser().getKey()){var r=T(n);r.platform=e.dvc;var c=i.create({uId:e.fndId,utId:e.utId,fn:e.nm});o.getContactDetailsByUtIds([e.utId]);var u=c.getOnlineStatus();c.setOnlineStatus(e.psnc),e.mood&&c.setUserMood(e.mood),e.dt&&c.setDeviceToken(e.dt),e.apt&&c.setAppType(e.apt),e.dvc&&c.setPlatform(e.dvc),u!=c.getOnlineStatus()&&a.sendFriendInformation(c),e.sucs===!0&&e.psnc==E.ONLINE?r.offlineStatus=!1:e.rc==m.PERMISSION_DENIED?r.blocked=!0:r.offlineStatus=!0,s.updateBox(r)}}function C(e){S(e)}function D(e){}function M(e){if(e.fndId){var t=i.getUser(e.fndId);t&&(e.psnc&&t.setOnlineStatus(e.psnc),e.mood&&t.setUserMood(e.mood),e.dvc&&t.setPlatform(e.dvc))}}return h[f.START_F2F_CHAT]={processor:C},h[f.GET_USER_MOOD_PRESENCE]={processor:M},h[f.START_TAG_CHAT]={processor:D},h[f.RECEIVED_TAG_CHAT]={processor:A},h[f.ADD_TAG_CHAT_MEMBERS]={processor:v},h[f.RECEIVED_F2F_CHAT]={processor:S},{processUpdates:I}}angular.module("ringid.chat").controller("ChatController",ChatController),ChatController.$inject=["$scope","$rootScope","ChatFactory","ChatHelper","chatRequestProcessor","ChatUtilsFactory","ChatResponses","ChatAuthResponses","settings","SystemEvents","friendsFactory","ChatPacketSenderService","chatTabSync","Utils","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","$location","ChatConnector","ChatWorkerCommands"];function ChatController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h,_,I,A){var v,S,C=CHAT_APP.Constants,D=C.GENERAL_CONSTANTS,M=D.SESSION_TYPES,y=(CHAT_APP.SharedHelpers,!1);e.boxes=n.getBoxes(),e.$on("chatDataReceived",function(t,n){a.processUpdates(n.jsonData),m.safeDigest(e)}),e.$on("authDataReceived",function(t,n){s.processUpdates(n.jsonData),m.safeDigest(e)}),e.domBoxLength=function(){for(var t=0,n=0;n<e.boxes.length;n++)1==e.boxes[n].value.nonDomBox&&t++;return t>10?10:t},e.availableNo=n.getNumberOfAvailableChatBox(),e.getProfileLink=c.baseUrl+"/#/profile/",e.goToProfile=function(e,t){_.path(t),e.stopPropagation()},e.contactListAction=function(t){t.friend.isLoading()||(u.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.$on(l.COMMON.WINDOW_RESIZED,function(t,r){e.availableNo=n.getNumberOfAvailableChatBox(r.x),m.safeDigest(e)});var N=m.onCustomEvent(l.CHAT.TAB_SYNC_NEW_DATA,function(e){e.type==D.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE?n.refreshBox(e.boxId):e.type==D.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE&&(f.loadChatBoxes(),n.openAndAddMessage(e.boxId,e.msg))}),b=function(){e.$on("NET_SUCCESS",function(){i.getUnreadMessagesMultipleTimes()}),window.addEventListener("online",function(e){window.navigator.onLine&&i.getUnreadMessagesMultipleTimes()})},O=function(){o.hasOfflineIpPort()?i.getUnreadMessagesMultipleTimes():d.doUpdateOfflineIpPort().then(function(e){i.getUnreadMessagesMultipleTimes()})},P=function(){var e=f.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t,r){var i,o=e[t];if(!o.isTagChat){n.openChatBox(o.boxId),i=n.getBoxByUId(o.boxId);var a=f.getBox(o.boxId);angular.extend(i,a),A.startChatSession(o.boxId,M.FRIEND),i&&i.loadHistoryMessages()}})},R=function(){var e=f.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t,n){var r=e[t];r.isTagChat&&h.openPreviouslyOpenedBoxes(r.boxId)})};function U(){try{I.initiate(),f.init(),g.init(),O(),b(),v=m.onCustomEvent(l.FRIEND.UTID_LIST_RECEIVED,function(){P()}),S=m.onCustomEvent(l.CHAT.MY_TAG_LIST_RECEIVED,function(){R()})}catch(e){}}var L=function(){t.$on("FIRST_FEED_RECEIVED",function(){y||(y=!0,U())}),setTimeout(function(){y||(y=!0,U())},6e3)};T.isLoggedIn()?L():e.$on(l.AUTH.LOGIN,function(e,t){t===!0&&L()}),e.$on("$destroy",function(){m.removeCustomEvent(l.CHAT.TAB_SYNC_NEW_DATA,N),m.removeCustomEvent(l.FRIEND.UTID_LIST_RECEIVED,v),m.removeCustomEvent(l.CHAT.MY_TAG_LIST_RECEIVED,S)})}angular.module("ringid.chat").controller("ChatHistoryController",ChatHistoryController),ChatHistoryController.$inject=["$scope","$rootScope","ChatFactory","Storage","Auth","Api","tagChatFactory","userFactory","Utils","chatHistoryFactory","$$stackedMap","SystemEvents","rgScrollbarService"];function ChatHistoryController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m=CHAT_APP.Constants,f=m.GENERAL_CONSTANTS,E=(m.CHAT_GLOBAL_VALUES,CHAT_APP.SharedHelpers);e.selectedLeftBox={key:0,messages:[]},e.boxes=u.createNew(!0),e.recentMessages=u.createNew(!0),e.ready=t.chatHistoryReady||!1,e.selectLeftBox=function(t){e.selectedLeftBox=t};var p=function(e){var t=E.getClientTimeFromServerTime(e),n=c.verbalDate(t);return n};e.getMessageTime=p;var T=function(t,n){n&&(t.user=s.create({uId:n}),t.user.requestUserDetails().then(function(){e.$rgDigest()}))},h=function(e){return e.statusType?"Activity message.":e.messageType==f.MESSAGE_TYPES.PLAIN_MESSAGE?e.text:"Received media message."},_=function(e){return"Unread"==e.status||"Received"==e.status&&!e.seenSent},I=function(e){return l.getUnreadMessageCountByBoxId(e.key)},A=function(e){var t=angular.copy(e);return t.date=p(t.messageDate),t.isUnread=function(){return _(t)},t.messageText=function(){return h(t)},t.user.getKey&&T(t,t.user),t.isSelf=function(){return e.userId==i.currentUser().getKey()},t},v=function(e){var t=!1;return e.messages&&e.messages.length>0&&(e.messages.sort(function(e,t){return e.messageDate>t.messageDate?1:e.messageDate<t.messageDate?-1:0}),t=e.messages[e.messages.length-1]),t},S=function(t){var n=l.getChatBoxes(),r=n[t],i=e.boxes.get(t);if(i){i.messages=r.messages;var o=v(i);o&&(i.lastMessage=A(o))}},C=function(e){var t=angular.copy(e),n=v(t);if(n&&(t.lastMessage=A(n)),t.unreadCount=function(){return I(e)},t.sortBy=function(){return this.lastMessage.messageDate},t.isTagChat){var r=e.key;a.getTag(r);t.getTitle=function(){var e=a.getTag(r);return e?e.getTagName():""},t.getCover=function(){var e=a.getTag(r);return e?e.getPictureFullUrl():""},t.shouldVisible=function(){var e=a.getTag(r);return!!e&&e.isTagSafeToShow()}}else T(t,t.key),t.getTitle=function(){return t.user.getName()},t.getCover=function(){return t.user.avatar("thumb")},t.shouldVisible=function(){return!0};return t};e.initBoxMessages=function(t){t.messages&&angular.forEach(t.messages,function(t,n){var t=A(t);e.recentMessages.add(t.key,t)})},e.initRecentMessages=function(){var t=(i.currentUser().getKey(),l.getChatBoxes());t&&angular.forEach(t,function(t,n){var r=C(t);r.lastMessage&&e.boxes.add(t.key,r)})},e.clearRecentMessages=function(){e.recentMessages.clear()},e.openChatBox=function(e,t){c.triggerCustomEvent(d.CHAT.UNREAD_MESSAGE_INFO_UPDATED),t?n.openTagChatBox(e):n.openChatBox(e)},e.initRecentMessages(),t.chatHistoryReady||setTimeout(function(){e.ready=!0,t.chatHistoryReady=!0,e.$rgDigest(),g.recalculate(e)},3e3);var D=c.onCustomEvent(d.CHAT.MY_TAG_LIST_RECEIVED,function(){c.safeDigest(e)}),M=c.onCustomEvent(d.CHAT.TAG_LIST_UPDATED,function(){c.safeDigest(e)}),y=c.onCustomEvent(d.CHAT.MESSAGE_RECEIVED,function(t){S(t.boxId),c.safeDigest(e)}),N=c.onCustomEvent(d.CHAT.MESSAGE_SUBMITTED,function(t){S(t.boxId),c.safeDigest(e)});e.$on("$destroy",function(){c.removeCustomEvent(d.CHAT.MY_TAG_LIST_RECEIVED,D),c.removeCustomEvent(d.CHAT.TAG_LIST_UPDATED,M),c.removeCustomEvent(d.CHAT.MESSAGE_SUBMITTED,N),c.removeCustomEvent(d.CHAT.MESSAGE_RECEIVED,y)})}angular.module("ringid.chat").controller("ChatMediaUploadController",ChatMediaUploadController),ChatMediaUploadController.$inject=["$scope","fileUploadService","Utils","$boxInstance","localData","SystemEvents"];function ChatMediaUploadController(e,t,n,r,i,o){e.navSection=0,e.sendMedia=function(){if(e.capturedMedia&&i.boxId){var a=t.queueFile("chatimage",n.dataURLToBlob(e.capturedMedia));n.triggerCustomEvent(o.CHAT.BOX_CAM_UPLOAD,{uploadFile:a,boxId:i.boxId}),r.close()}}}angular.module("ringid.chat").controller("TagChatController",TagChatController),TagChatController.$inject=["$scope","$templateCache","$timeout","settings","$$connector","Auth","Ringalert","rgDropdownService","ChatFactory","Utils","tagChatStorage","friendsFactory","tagChatFactory","tagChatManager","chatRequestProcessor","ChatHelper","SystemEvents"];function TagChatController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){var T=this;T.memberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html",T.memberDDActions=S,T.getTagDDControl=I,T.ready=!1,T.groupFilter="groups",T.debug=!1;var h=o.currentUser();CHAT_APP.Constants.CHAT_GLOBAL_VALUES;T.isCurrentUserOwner=function(e){return e.getOwnerUserId()==h.getKey()},T.isCurrentUserMember=function(e){return e.isUserMember(h.getKey())},T.allTags=g.getTags(),T.changeGroupFilter=function(e){T.groupFilter=e||"groups"},T.showGroupLogs=function(e){return"logs"===T.groupFilter},T.showGroups=function(e){return"groups"===T.groupFilter},T.getTagPictureImageByMemberAvatars=A,T.getLastMessageOnATag=v,T.imageBase=r.imBase,T.getUserAvatar=function(e){return e&&e.avatar()?e.avatar():"images/prof.png"},T.getLastMessageText=function(e){return 2===e.messageType?e.text:[6,7,8,9].indexOf(e.messageType)!==-1&&"Media"};e.shouldShow=function(){return T.ready},e.showSingleMemberAlert=function(){a.show({mg:"Please add a member before leaving the group."},"info")};var _=l.onCustomEvent(p.CHAT.TAG_LIST_UPDATED,function(){T.allTags=g.getTags(),T.ready=!0,l.safeDigest(e)});n(function(){T.ready=!0},8e3);function I(e){return{tagId:e.getTagId(),isOwner:T.isCurrentUserOwner(e)}}function A(e){for(var t=[],n=e.getMembersObjectMap().all(),r=0,i=0;i<n.length&&r<3;i++){var o=n[i].value,a=o.getPictureUrl();""!==a&&(t.push(a),r++)}return t}function v(e){var t=u.getLastMessageByTag(e.getTagId());return!!t&&t.value}function S(t){switch(t.action){case"edit":case"view":return s.close(),function(){return{tagId:t.tagId}};case"delete":s.close();var n=g.getTag(t.tagId);n.setObjectLock(),m.leaveFromTag(t.tagId,h.getKey()).then(function(t){n.removeObjectLock(),e.$rgDigest()},function(t){n.removeObjectLock(),a.show(t,"error"),e.$rgDigest()}),e.$rgDigest()}}e.$on("$destroy",function(){l.removeCustomEventListener(p.CHAT.TAG_LIST_UPDATED,_)})}angular.module("ringid.chat").controller("TagChatPopupController",TagChatPopupController),TagChatPopupController.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","profileFactory","rgScrollbarService","CHAT_LANG","SystemEvents"];function TagChatPopupController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){var T=E.TAG,h=CHAT_APP.Constants.GENERAL_CONSTANTS;t.state={loading:!1,noData:!1};var _={};t.friends=c.getFriends("friends"),t.friendName="",t.editMode=!1,t.addToTag=L,t.removeMember=F,t.createChatTag=O,t.updateChatTag=R,t.loadMoreFriends=b,t.cancel=G,t.validateTag=B,t.newOwnerTagMember=!1,t.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:a.generateNewTagId()},t.uploading=!1,t.selectNewOwner=$,t.setNewOwner=k,t.isMemberSelected=w,t.canRemoveMember=y,t.canUpdateTagInfo=N,t.getPicturePreviewUrl=function(){return g.tagChatImBase+t.models.pictureUrl},t.contactListAction=function(e){e.friend.isLoading()||(c.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())},t.uploadAction=function(e){e.uploadFile.fetchMeta(function(){t.models.pictureUrl=e.uploadFile.getPreview(),t.uploading=!0,d.safeDigest(t),e.uploadFile.initUpload().then(function(e){t.uploading=!1,t.models.pictureFileName=e.iurl,t.models.pictureUrl=g.imBase+e.url,d.safeDigest(t)},function(e){t.uploading=!1})})};var I=i.currentUser().getKey();function A(){t.memberList=r.createNew(),t.adminList=r.createNew()}if(l&&l.tagId){t.tag=a.getTag(l.tagId),_=t.memberList;var v=t.tag.getMembersObjectMap();v?(t.memberAdminList=v.copy(),A(),t.tag.initMemberObjects(),angular.forEach(t.memberAdminList.all(),function(e){e.value.isMember()?t.memberList.add(e.key,e.value):t.adminList.add(e.key,e.value)})):A(),t.models.tagName=t.tag.getTagName(),t.models.popupTitle="Update Group chat",t.models.pictureUrl=t.tag.getPictureFullUrl(),t.models.pictureFileName=t.tag.getPictureUrl(),t.editMode=!0}else A();var S=d.onCustomEvent(p.CHAT.TAG_MEMBER_FETCHED,function(e){t.$rgDigest()});function C(){e(function(){t.friends=c.friends.copy(),d.safeDigest(t)},2e3)}t.$watch("friendName",function(e,t){""!=e&&(c.searchContact({schPm:e},!0),C())}),t.$watch(function(){return t.friends.length()-t.adminList.length()-t.memberList.length()},function(e,t){e<10&&b()});function D(e){return!!e&&e.getOwnerUserId()===i.currentUser().getKey()}function M(e){return!0}function y(e){if(e.getId()===I)return!1;if(t.tag&&!D(t.tag)){var n=e.getAddedBy()!==i.currentUser().getKey();if(t.tag.isCurrentUserStatusAdmin(I))if(e.isAdmin()&&n);else if(!e.isMember())return!1;if(t.tag.isCurrentUserStatusMember(I)&&n)return!1}return!0}function N(){return!t.editMode||!t.tag.isCurrentUserStatusMember(I)}t.$watch("friendName",function(e){e&&e.length>1&&(U(!0),c.searchContact({schPm:e},!0).then(function(){t.friends=c.getFriends("friends"),U(!1)},function(){U(!1)}))});function b(){t.state.loading||t.friends.length()===c.totalFriends("friends")||(U(!0),c.getContactDetails().then(function(){t.friends=c.getFriends("friends"),U(!1)},function(){U(!1)}),setTimeout(function(){t.state.loading=!1},3e3))}function O(){if(!B())return void d.safeDigest(t);var e=t.models.tagName,r=t.memberList.keys(),i=t.adminList.keys(),o=t.models.tagId,a=t.models.pictureFileName;s.createTag({tagName:e,memberUIds:r,adminUIds:i,tagId:o,tagPictureUrl:a}).then(function(e){},function(e){u.show(T.DEFAULT_FAILURE_MESSAGE,"error")},function(e){}),n.close()}function P(e){var n=a.getTag(t.tag.getTagId());n.removeObjectLock()}function R(){if(!B())return void d.safeDigest(t);var e=a.getTag(t.tag.getTagId()),r=t.models.tagName,i=t.models.pictureFileName,o=t.memberList.keys(),c=t.adminList.keys();t.tag.setObjectLock(),s.updateTag(e,r,i,o,c).then(function(e){P(t.tag.getTagId())},function(e){P(t.tag.getTagId()),u.show(T.DEFAULT_FAILURE_MESSAGE,"error")},function(e){e.sucs&&P(t.tag.getTagId())}),t.editMode=!1,d.triggerCustomEvent(p.CHAT.MY_TAG_LIST_RECEIVED),n.close()}function U(n){e(function(){t.state.loading=n,n||f.recalculate(t)})}function L(e,n){t.memberList.length()+t.adminList.length()>t.friends.length()-10&&b();var r=t.tag?t.tag.getTagId():t.models.tagId,i=a.createNewTagMember(r,{status:"member"==n?h.MEMBER_STATUS.MEMBER:h.MEMBER_STATUS.ADMIN,addedBy:I},!1);return M(i)?(t.tag&&i.setTagId(t.tag.getTagId()),i.initWithUserMapObject(e),"admin"===n?t.adminList.add(i.getId(),i):t.memberList.add(i.getId(),i),void d.safeDigest(t)):void u.show("Permission Denied","error")}function F(e){y(e)?(e.isAdmin()?t.adminList.remove(e.getId()):t.memberList.remove(e.getId()),d.safeDigest(t)):u.show("Permission Denied","error")}function w(e){return t.newOwnerTagMember&&e.getId()===t.newOwnerTagMember.getId()}function k(e){t.newOwnerTagMember=e,d.safeDigest(t)}function $(){var e=t.newOwnerTagMember,r=t.tag;t.newOwnerTagMember=!1;var o=e.getStatus();e.makeOwner();var a=r.getMember(i.currentUser().getKey());a.makeMember();var c=function(){e.setStatus(o),a.makeOwner(),r.removeObjectLock()},l=[e.serialize(),a.serialize()],g=[e,a];r.setObjectLock(),s.changeTagMemberStatus(r.getTagId(),l,g).then(function(){s.leaveFromTag(r.getTagId()).then(function(e){r.removeObjectLock()},function(){u.show(T.DEFAULT_FAILURE_MESSAGE,"error"),c()})},function(){u.show(T.DEFAULT_FAILURE_MESSAGE,"error"),c()}),d.safeDigest(t),n.close()}function G(){t.newOwnerTagMember=!1,n.close(),d.safeDigest(t)}function B(){return t.models.tagName.length>100?t.models.errTagName="Maximum 100 alpha numeric characters":t.models.errTagName="",t.models.errMemberList=t.memberList.length()+t.adminList.length()<2,!t.models.errMemberList&&!t.models.errTagName}t.$on("$destroy",function(){d.removeCustomEvent(p.CHAT.TAG_MEMBER_FETCHED,S),t.tag&&t.tag.unregisterMemberObjectsListener()})}angular.module("ringid.chat").controller("TagChatDebugInfoController",TagChatDebugInfoController),TagChatDebugInfoController.$inject=["$scope","$boxInstance","Auth","ChatFactory","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","profileFactory"];function TagChatDebugInfoController(e,t,n,r,i,o,a,s,c,l,u,d){CHAT_APP.Constants.GENERAL_CONSTANTS;e.currentUserUId=n.currentUser().getKey(),e.registerTag=g,e.unregisterTag=m,s&&s.tagId&&(e.tag=i.getTag(s.tagId),e.tagDebugInfo={},e.tagDebugInfo.isTagRegistered=i.isTagRegistered(s.tagId),e.chatBox=r.getBoxByUId(s.tagId));function g(){o.registerTag(e.tag.getTagId())}function m(){}}var chatApp;chatApp=angular.module("ringid.chat"),chatApp.factory("ChatUtilsFactory",ChatUtilsFactory),ChatUtilsFactory.$inject=["Auth","Utils"];function ChatUtilsFactory(e,t){var n=CHAT_APP.Constants,r=(n.GENERAL_CONSTANTS,n.CHAT_GLOBAL_VALUES,function(e){return e=t.parseForLE(e,0)}),i=function(){var t=e.loginData,n={ip:"",port:""};return t&&(n.ip=t.oIP,n.port=t.oPrt),n},o=function(){var e=i();return!(!e||!e.ip||!e.port)},a=function(e){var n=CHAT_APP.SharedHelpers.getClientTimeFromServerTime(e);return t.chatVerbalDate(n)};return{parseForLE:r,getOfflineIpPort:i,hasOfflineIpPort:o,getChatVerbalDateFromServerDate:a}}angular.module("ringid.chat").service("rgRecorderService",rgRecorderService);function __getUserMedia(){var e,t;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(t="new",e=navigator.mediaDevices.getUserMedia):(t="old",e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),{gum:e,version:t}}function rgRecorder(e){var t=this,n="old",r=null,i={recordedImage:{width:0,height:0,image:""},recordedVideo:{width:0,height:0,video:""},mediaPreview:{width:400,height:400},mediaStream:"",mediaObject:"",isStreaming:!1,text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser"}};angular.extend(i,e);var o=function(){},a=function(){};this._callbacks={streamReady:o,error:a};var s=function(){var e=__getUserMedia();r=e.gum,n=e.version},c=function(){t.getMediaObject().readyState>3?t.onCanPlay():t.getMediaObject().addEventListener("canplay",t.onCanPlay,!1)},l=function(e){var t=document.createElement("video"),n=window.URL||window.webkitURL;return t.src=n.createObjectURL(e),t.autoplay=!0,t},u=function(e){i.mediaStream=e,i.mediaObject=l(e),c()},d=function(e){var n;n="DevicesNotFoundError"==e.name||"OverconstrainedError"==e.name?i.text.WEBCAM_DISCONNECTED:"PermissionDeniedError"==e.name?i.text.PERMISSION_DENINED:i.text.GUM_NOT_SUPPORTED,t.triggerEvent("error",{text:n})};t.on=function(e,n){t._callbacks[e]=n},t.triggerEvent=function(e,n){t._callbacks[e]&&t._callbacks[e].call(t,n)},t.getProps=function(){return i},t.getMediaPreview=function(){return i.mediaPreview},t.getMediaObject=function(){return i.mediaObject},t.getStream=function(){return i.mediaStream},t.setStream=function(e){i.mediaStream=e},t.isStreaming=function(e){return e?void(i.isStreaming=e):i.isStreaming},t.startRecording=function(){t.getStream().record()},t.stopRecording=function(){var e=t.getStream();if(e.getTracks){var n=e.getTracks();n.forEach(function(e){e.stop()})}else e.stop()},t.getRecordedMedia=function(e){t.getStream().getRecordedData(e)},t.captureImage=function(){var e=t.getMediaObject(),n=document.createElement("canvas"),r=n.getContext("2d");return!(!e.width||!e.height)&&(n.width=e.width,n.height=e.height,r.drawImage(e,0,0,e.width,e.height),n.toDataURL("image/jpeg"))},t.onCanPlay=function(e){var n=t.getMediaObject(),r=t.getMediaPreview();if(!t.isStreaming()){var i=n.videoHeight/(n.videoWidth/r.width);isNaN(i)&&(i=width/(4/3)),n.setAttribute("width",r.width),n.setAttribute("height",i),t.isStreaming(!0),t.triggerEvent("streamReady",{stream:t.getStream(),media:n})}},t.openMedia=function(e){if(r)try{"old"==n?r.call(navigator,e,u,d):r.call(navigator.mediaDevices,e).then(u).catch(d)}catch(e){}else t.triggerEvent("error",{text:i.text.GUM_NOT_SUPPORTED})},t.destroy=function(){var e=t.getMediaObject();e&&e.removeEventListener("canplay",t.onCanPlay),t.getStream()&&(t.stopRecording(),t.setStream(null))};var g=function(){s()};g()}function rgRecorderService(){var e=!1,t=!1;this.getRecorderInstance=function(e){return new rgRecorder(e)},this.hasUserMediaSupport=function(){return e||(t=!!__getUserMedia().gum,e=!0),t}}angular.module("ringid.chat").factory("ChatMap",["$$stackedMap","$interval","$websocket","$rootScope","$sce","Auth","ChatConnector","userFactory","Utils","tagChatFactory","chatHistoryFactory","settings","tagChatHelper","tagChatStorage","ChatUtilsFactory","rgScrollbarService","chatTabSync","$$mediaMap","SystemEvents",function(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h){var _=CHAT_APP.Constants,I=(_.CHAT_GLOBAL_VALUES,_.GENERAL_CONSTANTS),A=CHAT_APP.SharedHelpers,v=function(e){var t=e.key||e.packetId,n=e.messageDate||(new Date).getTime(),r={key:t.toString(),packetId:t.toString(),text:e.message||e.mg||e.text,hrtime:f.getChatVerbalDateFromServerDate(n),status:e.status||0,fullName:e.fullName,tagName:e.tagName||"",messageDate:n,isDeleted:!1,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat||!1,seenSent:e.seenSent||!1,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,lastUpdateTime:(new Date).getTime(),platform:5,scroll:e.scroll};return e.tag_chat?(r.packetType=e.packetType||63,r.brokenPacketType=e.brokenPacketType):(r.packetType=e.packetType||6,r.brokenPacketType=e.brokenPacketType),r.status_text="Pending",e.status&&(r.status_text=e.status),r};return{create:function(n,o){var a,m,E,_,S=n;o?(E=n,m=l.getTag(E)):_=s.create({uId:n});var C=!1,D=!1,M={},y="",N=e.createNew(!0,"asc"),b=function(e,t,r){var o;if(e.type&&101===e.type)return void(C=!0);if(0==e.type&&0===e.status)return o=N.get(N.packetId),void(o.isDeleted=!0);var a="",l=v(e);angular.isObject(t)?e.userId=t.getKey():t=s.create({uId:e.userId,fetchDatails:!1});var m={locationInfo:{},ogData:{},seenUserIds:{},deliveredUserIds:{},user:t,sortBy:function(){return e.messageDate},getTextPartition:function(){return a},setTextPartition:function(){a=f.parseForLE(m.text),a=i.trustAsHtml(a)},getMessageTime:function(){return Cmessage.hrtime},seenUsersCount:function(){return Object.keys(m.seenUserIds).length},deliveredUsersCount:function(){return Object.keys(m.deliveredUserIds).length},addSeenUserId:function(e){m.seenUserIds[e]=!0},addDeliveredUserId:function(e){m.deliveredUserIds[e]=!0},updateLocationInfo:function(){var e,t,n;try{e=angular.fromJson(m.text),t=e.la,n=e.lo,m.locationInfo={lat:t,long:n,description:e.loc},m.plainText=e.loc}catch(e){}},updateLinkShareInfo:function(){m.ogData={};try{var e=angular.fromJson(m.text);m.ogData={lnkDmn:e.u,description:e.d,title:e.t,url:e.u,image:e.i,message:e.m},m.plainText=e.m}catch(e){}},updateMediaInfo:function(){var e;try{e=angular.fromJson(m.text),m.mediaInfo={url:e.u,caption:e.c,width:e.w,height:e.h};var t=c.getScaledImageSize(m.mediaInfo.width,m.mediaInfo.height,c.viewport.x,c.viewport.y),n=c.getScaledImageSize(m.mediaInfo.width,m.mediaInfo.height,150,300);m.mediaInfo.width=t.width,m.mediaInfo.height=t.height,m.mediaInfo.thumbWidth=n.width,m.mediaInfo.thumbHeight=n.height,m.plainText=e.c}catch(e){}},updateRingMediaInfo:function(){var e;try{var e=angular.fromJson(m.text);m.ringMediaObject=T(e)}catch(e){}},getSafeMapJsUrl:function(){return i.trustAsResourceUrl(m.mapJsEmbededUrl)},refreshStatusMessageText:function(){a=g.getTagChatStatusMessage(e),a=i.trustAsHtml(a)}};if(angular.extend(m,l),e.userId=m.userId=m.user.getKey(),e.usersToChange&&(m.usersToChange=e.usersToChange),e.statusType&&(m.statusType=e.statusType),"status_update"!==e.status)if(1!=e.secretTimedOut&&"Deleted"===e.status)m.messageType=2,a=f.parseForLE(m.text);else switch(e.messageType){case I.MESSAGE_TYPES.DELETE_MESSAGE:m.text="This msg has been deleted",m.setTextPartition();break;case I.MESSAGE_TYPES.TEXT:case I.MESSAGE_TYPES.EMOTICON_MESSAGE:a=f.parseForLE(m.text);break;case I.MESSAGE_TYPES.LOCATION_SHARE:m.updateLocationInfo();var E=m.locationInfo.lat,_=m.locationInfo.long;0!=E&&0!=_?(m.mapStaticUrl=c.getGoogleMapStaticUrl(E,_),m.mapJsUrl=c.getGoogleMapJSUrl(E,_),m.mapJsEmbededUrl=c.getGoogleMapJSUrl(E,_,"",!0)):a=f.parseForLE(m.text);
break;case I.MESSAGE_TYPES.LINK_SHARE:m.updateLinkShareInfo();break;case I.MESSAGE_TYPES.STICKER:m.stickerUrl=d.stickerBase+m.text;break;case I.MESSAGE_TYPES.IMAGE:case I.MESSAGE_TYPES.CAMERA_IMAGE:m.updateMediaInfo();try{m.mediaUrl=d.imBase+m.mediaInfo.url}catch(e){m.mediaUrl=""}a="";break;case I.MESSAGE_TYPES.AUDIO:m.updateMediaInfo(),m.isVideo=!1;try{m.mediaUrl=d.mediaBase+m.mediaInfo.url}catch(e){m.mediaUrl=""}break;case I.MESSAGE_TYPES.VIDEO:m.updateMediaInfo(),m.isVideo=!0;try{m.mediaUrl=d.mediaBase+m.mediaInfo.url}catch(e){m.mediaUrl=""}break;case I.MESSAGE_TYPES.RING_MEDIA_MESSAGE:m.updateRingMediaInfo();try{m.plainText=m.ringMediaObject.getCaption(),m.thumbURL=m.ringMediaObject.getThumbForMedia(),m.albumName=m.ringMediaObject.getAlbumName(),m.artistName=m.ringMediaObject.getArtistName(),m.durationText=m.ringMediaObject.getDuration(!0)}catch(e){m.thumbURL=""}break;default:return}else{if(!(e.usersToChange&&e.usersToChange.length>0))return;if(a=g.getTagChatStatusMessage(e),!a)return}a=i.trustAsHtml(a),N.save(m.key,m),e.fromLocalHistory||R(m);var A=n.toString();u.addMessage(m,A),c.triggerCustomEvent(h.CHAT.MESSAGE_PUSHED,{boxId:A,fromLocalHistory:e.fromLocalHistory||!1,fromHistory:e.fromHistory||!1,msg_status:l.status_text.toLowerCase(),isEdit:e.isEdit}),r&&p.sendData(I.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:A,msg:l,isTagChat:e.tag_chat})},O=function(e,t){var n=e.key||e.packetId,r=A.getChatServerCurrentTime(),o=[],a={key:n,text:e.message||e.mg||e.text,hrtime:f.getChatVerbalDateFromServerDate(r),status:e.status||0,messageType:e.messageType,uploading:e.uploading,uploadProgress:e.uploadProgress,messageDate:r,isDeleted:!1,messageDateString:e.messageDateString||"",mediaUrl:e.mediaUrl,mediaInfo:{thumbWidth:150,thumbHeight:63},timeout:e.timeout,isSecretVisible:e.isSecretVisible,user:angular.isObject(t)?t:s.getUser(e.userId),userId:angular.isObject(t)?t.getKey():e.userId,lastUpdateTime:(new Date).getTime(),sortBy:function(){return e.messageDate},getTextPartition:function(){return o},setTextPartition:function(){o=f.parseForLE(a.text),o=i.trustAsHtml(o)}};o=f.parseForLE(a.text),o=i.trustAsHtml(o),N.save(a.key,a),c.triggerCustomEvent(h.CHAT.MESSAGE_PUSHED,{boxId:S,fromLocalHistory:!1,fromHistory:!1,msg_status:a.status})},P=function(e,t){},R=function(e){var t=a,n=e.key||e.packetId;if("status_update"==e.status)try{n=n.split("_")[0]}catch(e){}t.messageMaxDate<e.messageDate&&(t.messageMaxDate=e.messageDate,t.messageMaxPacketId=n),(!t.messageMinDate||t.messageMinDate>=e.messageDate)&&(t.messageMinDate=e.messageDate,t.messageMinPacketId=n)};return a={isTagChat:!1,boxTitle:"",unreadCount:0,messageMaxPacketId:"",messageMinPacketId:"",messageMaxDate:0,messageMinDate:0,latestSeenMessageDate:0,hasHistoryMessage:!1,messages:N.all(),getTitleString:function(){var e=a,t=e.getTitle();return o||t||(t=e.getKey()),e.unreadCount>0&&(t=t+" ("+e.unreadCount+")"),t},updateUnreadCount:function(){var e=a;e.unreadCount=u.getUnreadMessageCountByBoxId(S)},getProfileLink:function(){var e=a;if(!e.isTagChat)return"/profile/"+e.getUser().getKey()},checkWaitingTimePassed:function(){var e=Math.floor(Date.now()/1e3);return e-this.lastCommunicationTime>this.waitingTime},pushMessage:function(e,t,n){b(e,t,n)},pushDummyMessage:function(e,t){O(e,t)},sendTabUpdate:function(e){var t=v(e);p.sendData(I.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:S,msg:t,isTagChat:e.tag_chat})},processMessage:function(e,t){P(e,t)},getKey:function(){return n.toString()},getTagItem:function(){return m||l.getTag(a.getKey())},getUser:function(){return m?m:_},getTitle:function(){return m?this.boxTitle=m.getTagName():_&&(this.boxTitle=_.getName()),this.boxTitle},setTitle:function(e){this.boxTitle=e},isConsicutive:function(e){var t=N.get(e),n=N.previous(e);return!(!n||"status_update"==n.status||n.user.getKey()!==t.user.getKey())},isSamePacketId:function(e){return!!N.get(e.toString())},getMessages:function(){return N.all()},getMessage:function(e){return N.get(e.toString())},getBottomMessage:function(){return N.bottom()},getTopMessage:function(){return N.top()},removeMessage:function(e){N.remove(e.toString())},updateMessageStatus:function(e,t){var n=N.get(e);return!!n&&(n.status=t,n)},isTyping:function(){return C},setTypingBool:function(e){C=e},isFriendTyping:function(){return D},showTypingText:function(e){M[e]=!0,C=D=!0},hideTypingText:function(e){delete M[e],C=D=!1},getTypingText:function(){if(y="is typing ...",o){var e=l.getTag(a.getKey()),t=Object.keys(M),n=" is typing ...";M.length>3&&(t=M.slice(0,3),n=" and "+M.length-3+" others are typing...");var r=[];t.forEach(function(t){var n=e.getMember(t);r.push(n.getName())}),y=r.join(",")+n}else y=a.getUser().getName()+" "+y;return y},setFriendTypingBool:function(e){D=e},startTimer:function(){var e=a,n=e.getMessages();if(angular.isArray(n)&&n.length>0)for(var i=0;i<n.length;i++)if(n[i].value.timeout>0&&0==e.isMinimized&&0==e.isHidden&&!n[i].value.timerStartFlag)switch(n[i].value.messageType){case 2:case 3:case 4:case 5:case 6:var o=n[i].value.timeout,s=n[i].value;s.key=s.packetId,n[i].value.timerStartFlag=!0;var c=function(e,t){r.$broadcast("timeoutDelete",e.key,t)};!function(e,n){t(function(){c(e,n--)},1e3,n+1)}(s,o)}},updateBoxMessageMinMaxPacketId:R,loadHistoryMessages:function(){var e=a,t=!1,n=u.getMessages(S);if(n)for(var r=0;r<n.length;r++){var i=n[r];R(i),i.fromLocalHistory=!0;var o=!1;0==i.status&&(A.getChatServerCurrentTime()-i.messageDate>12e4?(i.status="Failed",t=!0):o=!0),"Seen"==i.stauts&&i.messageDate>e.latestSeenMessageDate&&(e.latestSeenMessageDate=i.messageDate)}t&&u.updateMessages(n,S),e.updateUnreadCount(),c.triggerCustomEvent(h.CHAT.HISTORY_LOADED,{boxId:S})}}}}}]);var ChatWorker;angular.module("ringid.chat").factory("ChatConnector",ChatConnector),ChatConnector.$inject=["$rootScope","$q","Auth","ChatUtilsFactory","settings"];function _updateGobal(e,t){CHAT_APP.GLOBALS[e]=t}function ChatConnector(e,t,n,r,i){var o=CHAT_APP.Constants,a=CHAT_APP.PacketFormats.CHAT_PACKET_INFO,s=o.WORKER_NOTIFIER_TYPES,c=o.GENERAL_CONSTANTS,l=o.CHAT_GLOBAL_VALUES,u={},d=!1;ChatWorker=new Worker(window.location.origin+c.CHAT_WORKER_PATH);var g=function(e,t){try{a[e.packetType].PACKET_NAME}catch(e){}},m=function(e,t,n){u[e]||(u[e]=[]),n=n||null,u[e]={ctx:n,fn:t,ct:Date.now()}},f=function(){if(!d){if(!RingMessageChannel.port2)return void setTimeout(f,500);var e={command:"SETTINGS",url:i.socketProtocol+window.location.host+"/ChatSocket/"+window._cti,tabId:window._cti,salt:Cookies.get("sId"),sKey:Cookies.get("sessionID"),appVersion:i.apiVersion,CLIENT_DATA_SIZE:512};try{var t=n.currentUser().getKey();t&&(e.uId=n.currentUser().getKey()),e.oIpPort=r.getOfflineIpPort()}catch(e){}try{ChatWorker.postMessage(e,[RingMessageChannel.port2])}catch(e){}_updateGobal("uId",t),_updateGobal("appVersion",i.apiVersion),d=!0}};return ChatWorker.addEventListener("error",function(e){}),ChatWorker.addEventListener("message",function(t){switch(t.data.notifier){case s.DEBUG:try{}catch(e){}break;case s.CHAT_DATA_RECEIVED:t.data.object&&e.$broadcast("chatDataReceived",{jsonData:t.data.object});break;case s.AUTH_DATA_RECEIVED:t.data.object&&e.$broadcast("authDataReceived",{jsonData:t.data.object});break;case s.CHAT_REQUEST_RESPONSE:var n=t.data.object.packetId,r=t.data.object,i=u[n];n&&i&&(r.notify?i.fn.notify.call(i.ctx,r):r.sucs?i.fn.resolve.call(i.ctx,r):r.error?i.fn.resolve.call(i.ctx,r):r.sucs||i.fn.resolve.call(i.ctx,r)),delete u[n];break;case s.AUTH_REQUEST_RESPONSE:break;case s.CHAT_TIMER_UPDATE:var o=t.data.object.serverTime;l.serverTime=o;break;case s.RE_INIT:f();break;case s.EXCEPTION:try{}catch(e){}}}),{initiate:f,sendCommand:function(e,t){var n={command:e,tabId:window._cti},r=angular.extend({},t,n);ChatWorker.postMessage(r)},sendGlobal:function(e,t){_updateGobal(e,t);var n={command:"UPDATE_GLOBALS",tabId:window._cti};n[e]=t,ChatWorker.postMessage(n)},rawSend:function(e){ChatWorker.postMessage({command:"RAW_SEND",tabId:window._cti,object:e})},send:function(e,t){g(e,"send"),ChatWorker.postMessage({command:"SEND",tabId:window._cti,object:e,retryCount:t})},request:function(e,n){g(e,"request");var i=t.defer();return e.packetId||(e.packetId=r.getUUIDPacketId()),m(e.packetId,i,this),ChatWorker.postMessage({command:"REQUEST",tabId:window._cti,object:e,retryCount:n}),i.promise}}}angular.module("ringid.chat").factory("ChatExceptions",ChatExceptions),ChatExceptions.$inject=[];function ChatExceptions(){function e(e,t){}return{ChatPacketException:e}}angular.module("ringid.chat").factory("ChatFactory",["settings","Storage","$$stackedMap","ChatMap","Auth","Utils","ChatConnector","chatHistoryFactory","userFactory","friendsFactory","tagChatFactory","$interval","SystemEvents","OPERATION_TYPES","$rootScope",function(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f){var E=null;function p(){return E||(E=new CHAT_APP.UTILS.ChatClock),E}var T=(CHAT_APP.Constants.GENERAL_CONSTANTS.SESSION_TYPES,n.createNew()),h=function(e){if(e)var t=e-400-165;else var t=o.viewport.x-400-165;var n=parseInt(t/310);return n},_=function(e){var t=e.friendName.split(",")[0],n=v(t);if(angular.isArray(e.messageList))for(var r=0;r<e.messageList.length;r++)n.pushMessage(e.messageList[r])},I=function(e){var t={key:e,isMinimized:!1,isHidden:!1,isFocused:!1,blinkOn:!1,timeout:5,secretChat:!1,nonDomBox:!1,closedBox:!1,offlineStatus:!1,blocked:!1,blockedByUtId:[],isSecretVisible:!0,singlePage:!1,lastSeenBar:!0,unreadCount:0,bottomScrolled:!1,chatBoxClass:"chat-body-opened"};return t},A=function(e,t,n){e=e.toString(),n||(n={});var i=T.get(e);if(i!==!1)return i;if(i=r.create(e,t),!t){var o=c.create({uId:e});o.fetchPresence()}var a=I(e);return a.isFocused=!0,a.nonDomBox=!0,a.isTagChat=t,a.lastLogin=i.getUser()&&i.getUser().lastOnline?i.getUser().lastOnline():"",a=angular.extend(i,a,n)},v=function(e,t){var n=A(e,t);return T.save(e,n),s.addBox(n),n},S=function(e,t){var n=!1;e=e.toString();var r=T.get(e);r===!1?(r=v(e,!1),n=!0):(r.nonDomBox||(n=!0),r.isFocused=!0,r.nonDomBox=!0,r.blinkOn=!1,s.updateBox(r)),n&&o.triggerCustomEvent(g.CHAT.BOX_OPENNED,{boxId:e,sendToTab:t})},C=function(e,t){var n=!1;e=e.toString();var r=T.get(e);return r===!1?(r=v(e,!0),n=!0):(r.nonDomBox||(n=!0),r.isFocused=!0,r.nonDomBox=!0,r.blinkOn=!1,s.updateBox(r)),n&&o.triggerCustomEvent(g.CHAT.BOX_OPENNED,{boxId:e,sendToTab:t}),r},D=function(e,t){e=e.toString();var n=r.create(e,t),i=I(e);return i.closedBox=!0,i.isTagChat=t,i=angular.extend(n,i),T.save(e,i),s.addBox(i),n},M=function(e){e=e.toString();var t=T.get(e);t!==!1&&(T.remove(e),t.isFocused=!0,T.save(e,t),f.$broadcast("focusOn",e))},y=function(e){e=e.toString();var t=T.get(e);t.closedBox=!0,s.updateBox(t),T.remove(e)},N=function(e){e=e.toString();var t=T.get(e);t.closedBox=!0,s.updateBox(t),T.remove(e)},b=function(e){e=e.toString();var t=T.get(e);t.isMinimized=!t.isMinimized,t.isMinimized?(t.isFocused=!1,t.chatBoxClass="chat-body"):(t.isFocused=!0,t.chatBoxClass="chat-body-opened"),s.updateBox(t)},O=function(e){s.loadChatBoxes();var t=s.getBox(e),n=T.get(e);if(n)t.closedBox?T.remove(e):(angular.extend(n,t),n.loadHistoryMessages());else if(!t.closedBox){var r=A(e,t.isTagChat,t);T.save(e,r),r.loadHistoryMessages()}},P=function(e,t){if(t){var n=i.currentUser(),r=T.get(e);if(r)r.nonDomBox=!0,r.pushMessage(t,n);else{if(t.tag_chat){var a=u.getTag(e);a.isTagSafeToShow()&&C(e)}else S(e);r=v(e,t.tag_chat),r.loadHistoryMessages()}o.triggerCustomEvent(g.CHAT.NEW_MESSAGE_PUSHED,{boxId:e,scroll:"bottom"})}};return{openChatBox:S,openTagChatBox:C,closeTagChatBox:N,creatNonDomBox:D,makeVisibleChatBox:M,processInMessage:_,closeChatBox:y,refreshBox:O,minimizeBox:b,openAndAddMessage:P,getBoxes:function(){return T.all()},ggg:function(){return T.nonClosedLength()},getBoxByUId:function(e){return T.get(e)},getNumberOfAvailableChatBox:function(e){return h(e)},getNonClosedLength:function(){return T.nonClosedLength()},increaseUnreadMessageCount:function(e,t){s.addUnreadMessageInfo(e,t),s.updateUnreadMessageInfos()},decreaseUnreadMessageCount:function(e,t){s.removeUnreadMessageInfo(e,t),s.updateUnreadMessageInfos()},getUnreadMessageCount:function(){return s.getUnreadMessageCount()},getUnreadConversationCount:function(){return s.getUnreadConversationCount()},getChatClock:p}}]),angular.module("ringid.chat").factory("ChatHelper",ChatHelper),ChatHelper.$inject=["SystemEvents","ChatFactory","OPERATION_TYPES","ChatConnector","ChatWorkerCommands","Auth","$interval","Utils","chatHistoryFactory"];function ChatHelper(e,t,n,r,i,o,a,s,c){CHAT_APP.Constants.GENERAL_CONSTANTS;return{sendChatSeenConfirmation:E,startTimerText:m,startTimerOthers:f,decreaseUnreadCount:l,increaseUnreadCount:d,deleteMessageFromOwn:g,loadHistoryMessageForF2FChat:p};function l(t,n){n?t.unreadCount-n>0?t.unreadCount-=n:t.unreadCount-n<0?t.unreadCount=0:t.unreadCount=0:u(t),c.updateBox(t),c.removeUnreadMessageInfoByBoxId(t.getKey()),s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}function u(e){e.unreadCount=0}function d(e,t){e&&e.isFocused===!1&&(e.unreadCount+=t)}function g(t,n){if(t&&n.key){t.removeMessage(n.key),c.removeMessage(n.key,t.getKey());for(var r=t.getMessages(),i=0,o=r.length;i<o;i++)r[i].value.showDate=r[i].value.takeDecisionForShowingDate(),r[i].value.showAvator=r[i].value.takeDecisionForShowingMessageUserAvator();s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}}function m(e,t){if(!(t.length<1))for(var n=0,r=t.length;n<r;n++)if(t[n].value.timeout>0&&!t[n].value.timerStartFlag)switch(t[n].value.messageType){case 2:case 3:case 4:case 5:case 6:var i=t[n].value.timeout,o=t[n].value;t[n].value.timerStartFlag=!0;var s=function(t,n){e.$broadcast("timeoutDelete",t.key,n)};!function(e,t){a(function(){s(e,t--)},1e3,t+1)}(o,i)}}function f(e,t){if(t[0].value&&t[0].value.timeout>0&&!t[0].value.timerStartFlag)switch(t[0].value.messageType){case 7:case 8:case 9:case 10:var n=t[0].value.timeout,r=t[0].value;t[0].value.timerStartFlag=!0;var i=function(t,n){e.$broadcast("timeoutDelete",t.key,n)};!function(e,t){a(function(){i(e,t--)},1e3,t+1)}(r,n)}}function E(e,t,n,i,o){CHAT_APP.ChatRequests.getFriendChatSeenConfirmationObject(i,packetType);r.send(seenConfirmationObject)}function p(e,n){n||(n=t.getBoxByUId(e)),n&&n.loadHistoryMessages()}}angular.module("ringid.chat").service("ChatPacketSenderService",ChatPacketSenderService),ChatPacketSenderService.$inject=["Auth","Utils","ChatFactory","tagChatFactory","ChatUtilsFactory","$q","chatHistoryFactory","chatTabSync","ChatConnector","ChatWorkerCommands","SystemEvents"];function ChatPacketSenderService(e,t,n,r,i,o,a,s,c,l,u){var d=this,g=CHAT_APP.Constants,m=CHAT_APP.SharedHelpers,f=g.GENERAL_CONSTANTS,E=g.TAG_CHAT_PACKET_TYPE,p=g.FRIEND_CHAT_PACKET_TYPE,T=(g.OFFLINE_PACKET_TYPE,g.CHAT_STATES,g.PLATFORM),h=(f.SESSION_TYPES,CHAT_APP.UTILS.getUUIDPacketId),_=function(e,t){if(t&&t.url){var n=e.message,r={u:t.url,d:t.description,t:t.title,i:t.image,m:n};e.message=angular.toJson(r)}return e},I=function(e,t){if(t&&t.lat){e.la=t.lat,e.lo=t.lng,e.loc=t.description;var n={lo:e.lo,la:e.la,loc:e.loc};e.message=angular.toJson(n)}return e},A=function(e,t){if(t&&t.url){var n={u:t.url,c:t.caption,w:t.width,h:t.height};e.message=angular.toJson(n),e.mediaUrl=t.url,e.plainText=t.caption}return e},v=function(t,n,r,i){var o,a,s,c,l=!1,u=e.currentUser(),d=e.currentUser().getKey(),g=m.getChatServerCurrentTime(),f=t.isTagChat;if(t.editMessageKey?(a=t.editMessageKey,t.editMessageKey=void 0,g=parseInt(t.editMessageDate),t.editMessageDate=void 0,l=!0,f?(s=E.TAG_CHAT_MSG_EDIT,c=E.TAG_CHAT_BROKEN_MSG_EDIT):(s=p.FRIEND_CHAT_MSG_EDIT,c=p.FRIEND_CHAT_BROKEN_MSG_EDIT)):(a=h(g,!0),f?(s=E.TAG_CHAT_MSG,c=E.TAG_CHAT_BROKEN_MSG):(s=p.FRIEND_CHAT_MSG,c=p.FRIEND_CHAT_BROKEN_MSG)),o={isEdit:l,tag_chat:!1,packetType:s,brokenPacketType:c,fullName:u.getName(),userId:d,messageType:r,messageDate:g,message:n,key:a,packetId:a,isSecretVisible:t.isSecretVisible?1:0,timeout:0,platform:T.WEB},f){var _=t.getKey();o.tag_chat=!0,o.tagId=_}else o.friendId=t.getUser().getKey(),t.secretChat?o.timeout=t.timeout:o.timeout=0;return o},S=function(e,n){switch(t.hasEmoticon(e.message)&&(e.messageType=3),e.messageType){case f.MESSAGE_TYPES.LOCATION_SHARE:I(e,n.locationData);break;case f.MESSAGE_TYPES.LINK_SHARE:_(e,n.ogData);break;case f.MESSAGE_TYPES.IMAGE:case f.MESSAGE_TYPES.CAMERA_IMAGE:case f.MESSAGE_TYPES.VIDEO:A(e,n.mediaData)}},C=function(e,n,r){var i=e.getMessage(n.packetId);i&&(i.status=r,a.updateMessage(i,e.getKey()),t.triggerCustomEvent(u.CHAT.BOX_UPDATED,{boxId:e.getKey()}))},D=function(t,n){var r=e.currentUser();t.pushMessage(n,r,!0)},M=function(e,t,n,r){var i=v(e,t,n,r);return S(i,r),i};function y(e){var t=e.boxId,r=e.packetId;if(t&&r){var i=n.getBoxByUId(t);if(i)C(i,{packetId:r},"Failed");else{var o=a.getMessage(t,r);o.status="Failed",a.updateMessage(o,t)}}}var N=function(e,t,n,r){var i=M(e,t,n,r);b(e,i)},b=function(e,t){return D(e,t),t.message=t.message.utf8Encode(),setTimeout(function(){c.request(t).then(function(t){t.sucs||(t.boxId=e.getKey(),y(t))})}),t},O=function(e,t,n){t.tag_chat?t.tagId=e.getKey():t.friendId=e.getKey();var r=M(e,t.text,t.messageType,t.messageData);r.message=r.message.utf8Encode(),r.packetId=t.packetId,r.key=t.packetId,t.status="Pending",setTimeout(function(){c.request(r).then(function(t){t.sucs||(t.boxId=e.getKey(),y(t))})})},P=function(e){var t;t=e.isTagChat?CHAT_APP.ChatRequests.getTagChatTypingObject(e.getKey()):CHAT_APP.ChatRequests.getFriendChatTypingObject(e.getKey()),c.rawSend(t)},R=function(e){var t,n=0,r=0;t=e.isTagChat?CHAT_APP.ChatRequests.getFriendChatUnregisterObject(e.getKey(),n,r):CHAT_APP.ChatRequests.getTagChatTagUnregisterObject(e.getKey(),n,r),c.send(t)},U=function(e){var t=f.MESSAGE_TYPES.TEXT;return e.locationData.lat?t=f.MESSAGE_TYPES.LOCATION_SHARE:e.ogData.url&&(t=f.MESSAGE_TYPES.LINK_SHARE),t};d.sendMessage=N,d.retryMessage=O,d.sendTypingPacket=P,d.sendChatUnRegisterPacket=R,d.getSendMessageObject=M,d.pushMessageToBox=D,d.getMessageType=U,d.doSendMessage=b}angular.module("ringid.chat").factory("ChatSeenSend",ChatSeenSend),ChatSeenSend.$inject=["ChatWorkerCommands","ChatFactory","chatHistoryFactory","Utils","Auth","tagChatFactory","tagChatManager","ChatHelper","tagChatHelper","$q","ChatUtilsFactory","ChatConnector"];function ChatSeenSend(e,t,n,r,i,o,a,s,c,l,u,d){var g=CHAT_APP.Constants,m=CHAT_APP.ChatRequests,f=(g.CHAT_GLOBAL_VALUES,g.GENERAL_CONSTANTS),E=(g.TAG_CHAT_PACKET_TYPE,g.FRIEND_CHAT_PACKET_TYPE),p=(f.USER_PRESENCE,f.MESSAGE_STATUS_VALUE,CHAT_APP.SharedHelpers),T=function(e,t,n){var r=m.getFriendChatSeenObject(e,t);r.brokenPacketType=E.FRIEND_CHAT_SEEN;for(var i=p.getChatServerCurrentTime(),o=0;o<t.length;o++)r.messages[o].packetId=t[o].key,r.messages[o].messageDate=i,r.messages[o].status=v(t[o].messageType);d.request(r).then(function(r){r.sucs&&(_(e,t),n.resolve("success"))},function(){n.reject("failed")})},h=function(e,t){if(!(t.length<1)){var n=l.defer(),r=A(t),i=e.getKey();return e.isTagChat?(I(i,r),n.resolve({sucs:!0})):(T(i,r,n),n.promise)}},_=function(e,r){for(var i=t.getBoxByUId(e),o=[],a=0;a<r.length;a++)if(i){var s=i.getMessage(r[a].key);s&&(s.seenSent=!0,s.status="Received",o.push(s))}n.updateMessages(o,e)},I=function(e,t){var n=o.getTag(e);i.loginData.uId;if(n){for(var r=0;r<t.length;r++){var a=t[r].key,s=t[r].senderId,c=m.getTagChatSeenObject(s,e,a);d.send(c)}_(e,t)}},A=function(e){for(var t=[],n=0;n<e.length;n++)t.push({key:e[n].key,messageType:e[n].value.messageType,senderId:e[n].value.user.getKey()});return t},v=function(e){var t=0;switch(e){case 2:case 3:case 4:case 5:case 6:t=f.MESSAGE_STATUS.SEEN;break;case 7:case 8:case 9:case 10:t=f.MESSAGE_STATUS.VIEWED}return t};return{sendSeenPacket:h}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("chatTabSync",chatTabSync);function CrossTab(){var e,t,n,r={};function i(){var e="CrossTab not supported",t=[];throw localStorage||t.push("localStorage not available"),window.addEventListener||t.push("addEventListener not available"),t.length>0&&(e+=": "+t.join(", ")),new Error(e)}function o(){return(new Date).getTime()}function a(n){if(n&&"__CROSSTAB"==n.key){var i;try{i=n.newValue?JSON.parse(n.newValue):{}}catch(e){i={}}i&&i.id&&i.id!==CrossTab.id&&(n.newValue===e&&n.oldValue===t||(e=n.newValue,t=n.oldValue,r.message&&r.message.call(this,i.data)))}}function s(e,t){var r={id:n,data:t,timestamp:o()};localStorage.setItem(e,JSON.stringify(r))}function c(){window.removeEventListener("beforeunload",l,!1),window.addEventListener("unload",l,!1)}function l(){}function u(e,t,n){n=n||"0";var r=e.toString();return r.length>=t?r:new Array(t-r.length+1).join(n)+r}var d=function(){return o().toString()+u(2147483647*Math.random()|0,10)};function g(e){CrossTab.supported||i();var t={data:e,origin:n};s("__CROSSTAB",t)}this.on=function(e,t){r[e]=t},this.setId=function(e){n=e},this.getId=function(){return n},this.broadcast=g,this.init=function(){CrossTab.supported=!!localStorage&&window.addEventListener,CrossTab.supported?(n=d(),window.addEventListener("storage",a,!1),window.addEventListener("beforeunload",l,!1),window.addEventListener("DOMContentLoaded",c,!1)):CrossTab.broadcast=i}}chatTabSync.$inject=["Storage","Utils","SystemEvents"];function chatTabSync(e,t,n){var r,i,o,a,s=CHAT_APP.Constants.GENERAL_CONSTANTS,c=!!window.SharedWorker,l=!!window.localStorage,u=function(e,t){try{i.port.postMessage({origin:r,data:angular.extend(t,{type:e})})}catch(e){}},d=function(e,t){try{o.broadcast(angular.extend(t,{type:e}))}catch(e){}},g=function(){r=t.getUniqueID("t"),i=new SharedWorker(s.SHARED_WORKER_PATH),i.port.addEventListener("message",function(e){var i=e.data;i.origin!==r&&t.triggerCustomEvent(n.CHAT.TAB_SYNC_NEW_DATA,i.data)}.bind(this),!1),i.port.start()},m=function(){o=new CrossTab,o.init(),r=o.getId(),o.on("message",function(e){e.origin!==r&&t.triggerCustomEvent(n.CHAT.TAB_SYNC_NEW_DATA,e.data)})},f=function(e,t){a&&a.call(this,e,t)},E=function(){c?(g(),a=u):l?(m(),a=d):a=function(){}};return{init:E,sendData:f}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.service("ChatWorkerCommands",ChatWorkerCommands),ChatWorkerCommands.$inject=["ChatConnector"];function ChatWorkerCommands(e){var t=function(e){return!!e||(Ringlogger.alert("Invalid Chat Session Type",e,Ringlogger.tags.CHAT),!1)};this.startChatSession=function(n,r,i){t(r)&&e.sendCommand("START_CHAT_SESSION",{id:n,type:r,uIds:i})},this.endChatSession=function(n,r){t(r)&&e.sendCommand("END_CHAT_SESSION",{id:n,type:r})},this.sendAuthRequest=function(t){e.sendCommand("SEND_AUTH_REQUSET",{object:t,type:"send"})},this.sendTagChatMemberAddAuthRequest=function(t){e.sendCommand("SEND_TAG_CHAT_MEMBER_ADD_AUTH_REQUEST",{object:t,type:"send"})},this.doGetChatHistoryMessages=function(t,n,r,i,o){e.sendCommand("FETCH_HISTORY_MESSAGE",{id:t,type:i,pageDirection:n,limit:r,packetId:o})}}angular.module("ringid.chat").factory("tagChatFactory",tagChatFactory),tagChatFactory.$inject=["$$stackedMap","$$connector","userFactory","friendsFactory","Auth","Utils","tagChatModels"];function tagChatFactory(e,t,n,r,i,o,a){var s=CHAT_APP.Constants,c=CHAT_APP.SharedHelpers,l=s.GENERAL_CONSTANTS,u=s.PACKET_CONSTANTS,d=(s.CHAT_GLOBAL_VALUES,s.AUTH_SERVER_ACTIONS,s.TAG_CHAT_PACKET_TYPE,s.FRIEND_CHAT_PACKET_TYPE,s.CONFIRMATION_MAP,CHAT_APP.UTILS,{}),g=e.createNew(!0),m=!0;return{createNewTag:h,createNewTagMember:_,createNewTagMessage:I,createTagStatusMessage:A,addTagObject:S,removeTagObject:T,getTags:E,getTag:p,generateNewTagId:f,getOrCreateTag:C,getOrCreateMessage:M,updateTag:D,getTagLastMessageObject:v,setTagChatInitiator:y,resetTagChatInitiator:N,isTagChatInitiator:b,shouldProcessRequest:O,startProcessingRequest:m};function f(){var e=i.currentUser().getKey().toString(),t=(new Date).getTime().toString(),n=t.substr(0,u.TAG_ID_NO_OF_TIME_DIGIT);return n+=e.substr(e.length-u.TAG_ID_NO_OF_USER_ID_DIGIT)}function E(){return g}function p(e){return g.get(e)}function T(e){return g.remove(e)}function h(e,t){return t||(t=new a.TagObject),e.tagId?t.setTagId(e.tagId):t.setTagId(f()),e.packetId&&t.setPacketId(e.packetId),e.userId&&t.setUserId(e.userId),e.tagName&&t.setTagName(e.tagName),e.tagPictureUrl&&t.setPictureUrl(e.tagPictureUrl),e.serverDate&&t.setServerDate(e.serverDate),e.tagMembersCount&&t.setMembersCount(e.tagMembersCount),t}function _(e,t,n){var r=new a.TagMember;return e&&r.setTagId(e),t&&(t.userId&&r.setId(t.userId),t.fullName&&r.setFullName(t.fullName),t.addedBy&&r.setAddedBy(t.addedBy),t.status?r.setStatus(t.status):r.setStatus(l.MEMBER_STATUS.MEMBER)),r}function I(e,t,n){var r=new a.TagMessage;return e&&r.setTagId(e),t&&(t.userId&&r.setUserId(t.userId),t.user&&r.setUserId(t.user),t.fullName&&r.setFullName(t.fullName),t.message&&r.setMessageText(t.message),t.hrtime&&r.setHumanReadableTime(t.hrtime),t.messageDate&&r.setMessageDate(t.messageDate),t.isDeleted&&r.markAsDeleted(t.isDeleted),t.messageDateString&&r.setMessageDateString(t.messageDateString),t.timeout&&r.setTimeout(t.timeout),t.messageType&&r.setMessageType(t.messageType),t.status&&r.setStatus(t.status),t.packetId&&r.setPacketId(t.packetId),t.usersToChange&&r.setUsersToChange(t.usersToChange),t.usersToChangeName&&r.setUsersToChangeName(t.usersToChangeName),t.statusType&&r.setStatusType(t.statusType),t.tagName&&r.setTagName(t.tagName)),r}function A(e,t,r,i,o,a){var s={},l=p(t);if(l){var u;u=a.messageDate?a.messageDate:c.getChatServerCurrentTime();var d=n.getUser(r),g="";if(d&&""!=d.getName()&&(g=d.getName()),s={message:"",fullName:g,status:"status_update",statusType:i,tagName:a?a.tagName:"",messageDate:u,messageType:2,tag_chat:!0,userId:r,user:r,packetId:e},s.usersToChange={},o.length>0)for(var m=0;m<o.length;m++){var f=o[m];s.usersToChange[f.userId]=!0}var E=I(t,s);return E}return!1}function v(e){var t={key:e.key,text:e.text,messageType:e.messageType,messageDate:e.messageDate};return t}function S(e){if(!(e instanceof a.TagObject))return!1;var t=g.get(e.getTagId());return t?t.update(e):g.add(e.getTagId(),e),!0}function C(e,t){t||(t={tagId:e});var n=p(e);return n=n?h(t,n):h(t),g.save(e,n),n}function D(e,t,n){return n||(n=p(e)),n=h(t,n),g.save(e,n),n}function M(e,t){var n={tagId:e};t||(t={tagId:e});var r=p(e);r||(r=h(n),g.save(e,r));var i=I(e,t,!0),o=r.getMessage(t.packetId);return o?o.update(i):(o=i,r.addMessage(o)),o}function y(e){d[e]=!0,setTimeout(function(){d[e]=!1},l.API_FETCH_RETRY_DELAY)}function N(e){d[e]=!1}function b(e){return!!d[e]}function O(e){if(e.actn){var t=e.tid||e.tagId,n=_isInRequestCacheForAuth(t,e.actn);return!n}}}angular.module("ringid.chat").factory("tagChatHelper",tagChatHelper),tagChatHelper.$inject=["CHAT_LANG","Auth","tagChatFactory","userFactory","userService","Utils"];function tagChatHelper(e,t,n,r,i,o){var a=CHAT_APP.Constants,s=(CHAT_APP.SharedHelpers,a.GENERAL_CONSTANTS),c=(a.CHAT_GLOBAL_VALUES,e.TAG);return{getTagChatStatusMessage:d,getTagEmptyMessageObject:g};function l(e){var t;return e===s.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD?t="member":e===s.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD&&(t="admin"),t}function u(e,t){var n=e.getMember(t);if(n)return n.getName();var i=r.getUser(t);return i&&""!=i.getName()?i.getName():t}function d(e){var i,o,a,d=t.currentUser(),g=(d.getKey(),""),m="",f="",E=e.usersToChange.length-1,p=e.fullName,T=(e.userId,e.tagName);if(i=e.tagId,o=n.getOrCreateTag(i),a=d.getKey()===e.userId.toString(),o){p||(p=u(o,e.userId));var h=[],_=0;e.usersToChange.forEach(function(e){var t=r.getUser(e);if(t&&""!=t.getName())h.push(t.getName()),_++;else{var n=u(o,e);h.push(n)}}),_==e.usersToChange.length&&(e.allStatusUserFetched=!0),m=h.length>0?h[0]:e.usersToChange[0],f=h.slice(1).join(", ").replace('"',"'");var I,A,v={},S=c.STATUS_MESSAGES;switch(e.statusType){case s.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:case s.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:A=l(e.statusType),v.member_name=p,v.new_member_name=m==d.getName()?"you":m,v.new_member_type=A,v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),I=a?E?S.SELF_ADD_MULTIPLE_MEMBER:S.SELF_ADD_MEMBER:E?S.OTHER_ADD_MULTIPLE_MEMBER:S.OTHER_ADD_MEMBER;break;case s.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE:v.member_name=p,v.old_member_name=m==d.getName()?"you":m,v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),I=a?E?S.SELF_REMOVE_MULTIPLE_MEMBER:m===p?S.SELF_LEAVE_GROUP:S.SELF_REMOVE_MEMBER:E?S.OTHER_REMOVE_MULTIPLE_MEMBER:m===p?S.OTHER_LEAVE_GROUP:S.OTHER_REMOVE_MEMBER;break;case s.STATUS_MESSAGE_TYPES.TAG_MEMBER_LEAVE:v.member_name=p,I=a?S.SELF_LEAVE_GROUP:S.OTHER_LEAVE_GROUP;break;case s.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:v.member_name=p,v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),m!==d.getName()?v.old_member_name=m:v.old_member_name="you",I=a?E?S.SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:S.SELF_MEMBER_CHANGE_TO_ADMIN:E?S.OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:S.OTHER_MEMBER_CHANGE_TO_ADMIN;break;case s.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:v.admin_name=p,m!==d.getName()?v.old_admin_name=m:v.old_admin_name="you",v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),I=a?E?S.SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:m===p?S.SELF_REMOVED_FROM_ADMIN_BY_SELF:S.SELF_ADMIN_CHANGE_TO_MEMBER:E?S.OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:m===p?S.OTHER_REMOVED_FROM_ADMIN_BY_SELF:S.OTHER_ADMIN_CHANGE_TO_MEMBER;break;case s.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER:v.member_name=p,v.admin_name=m,I=m!==d.getName()?S.OTHER_USER_ADDED_AS_OWNER:S.SELF_USER_ADDED_AS_OWNER;break;case s.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:v.member_name=p,v.group_name=T,I=a?S.SELF_UPDATE_GROUP_INFO:S.OTHER_UPDATE_GROUP_INFO;break;case s.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE:v.member_name=p,v.group_name=T,I=a?S.SELF_RENAME_GROUP:S.OTHER_RENAME_GROUP;break;case s.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE:v.member_name=p,v.group_name=T,I=a?S.SELF_CHANGE_GROUP_PIC:S.OTHER_CHANGE_GROUP_PIC}return I&&(g=I.supplant(v)),g}}function g(e){var r=t.currentUser(),i=(r.getKey(),{tagId:e,userId:r.getKey(),fullName:r.getName(),message:" ",messageDate:(new Date).getTime(),messageType:s.MESSAGE_TYPES.BLANK_MESSAGE,packetId:CHAT_APP.UTILS.getUUIDPacketId()}),o=n.createNewTagMessage(e,i);return o}}angular.module("ringid.chat").factory("tagChatManager",tagChatManager),tagChatManager.$inject=["$$connector","$q","$timeout","Auth","CHAT_LANG","tagChatFactory","ChatWorkerCommands","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","ChatUtilsFactory","ChatConnector","SystemEvents"];function tagChatManager(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h,_){var I=CHAT_APP.Constants,A=CHAT_APP.SharedHelpers,v=I.GENERAL_CONSTANTS,S=(I.AUTH_SERVER_ACTIONS,I.TAG_CHAT_PACKET_TYPE,I.OFFLINE_PACKET_TYPE),C=(I.FRIEND_CHAT_PACKET_TYPE,i.TAG,CHAT_APP.AuthRequests),D=CHAT_APP.ChatRequests,M=CHAT_APP.UTILS.callXTimeAfterYIntervalStopOnSuccess;function y(e){var n,i,s,c,l,u=r.currentUser(),d=t.defer();e.tagMembersCount=e.memberUIds.length+e.adminUIds.length+1,n=o.createNewTag(e),i={userId:u.getKey(),addedBy:u.getKey(),status:v.MEMBER_STATUS.OWNER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s);for(var m=0;m<e.memberUIds.length;m++){var f=e.memberUIds[m];i={userId:f,addedBy:u.getKey(),status:v.MEMBER_STATUS.MEMBER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s)}for(var E=0;E<e.adminUIds.length;E++){var p=e.adminUIds[E];c={userId:p,addedBy:u.getKey(),status:v.MEMBER_STATUS.ADMIN},l=o.createNewTagMember(n.getTagId(),c,!0),n.addMember(l)}n.setObjectLock(),o.addTagObject(n),g.triggerCustomEvent(_.CHAT.TAG_LIST_UPDATED),e.uIds=e.adminUIds.concat(e.memberUIds);var T=D.getOfflineTagCreateTagObject(n.getTagId(),n.getTagName(),n.getPictureUrl(),n.getSerializedMembers());return T.brokenPacketType=S.OFFLINE_BROKEN_PACKET,h.request(T).then(function(e){n.removeObjectLock(),e.sucs?(d.resolve(e),a.startChatSession(n.getTagId(),v.SESSION_TYPES.TAG,n.getMemberUserIds())):e.error?d.error(e):d.reject(e)}),d.promise}function N(e,t,n){var i,a,s,c,l,u,g,m,f,E=r.currentUser(),p=[],T=[],h=[],_=[],I=[],A=[],S={},C={},D={};
i=e.getMembersObjectMap().copy(),a=i,s=a.all(),angular.forEach(t,function(e){S[e]=!0}),angular.forEach(n,function(e){C[e]=!0});for(var M=0;M<s.length;M++)c=s[M].value,D[c.getId()]=!0,c.isOwner()||(C[c.getId()]||S[c.getId()]?(l=!1,c.isAdmin()?S[c.getId()]&&(c.makeMember(),l=!0):c.isMember()&&C[c.getId()]&&(c.makeAdmin(),l=!0),l&&(T.push(c.serialize()),A.push(c))):(p.push(c.serialize()),I.push(c)));return angular.forEach(t,function(t){D[t]||t===E.getKey()||(u=d.getUser(t),g=o.createNewTagMember(e.getTagId(),{userId:t,addedBy:E.getKey(),fullName:u.getName(),status:v.MEMBER_STATUS.MEMBER},!0),_.push(g),h.push(g.serialize()))}),angular.forEach(n,function(t){D[t]||t===E.getKey()||(m=d.getUser(t),f=o.createNewTagMember(e.getTagId(),{userId:t,addedBy:E.getKey(),fullName:m.getName(),status:v.MEMBER_STATUS.ADMIN},!0),_.push(f),h.push(f.serialize()))}),{serializedMemberAdminsToRemove:p,serializedMemberAdminsToStatusChange:T,serializedNewMemberAdminsToAdd:h,membersAdminToAddOnSuccess:_,membersAdminToRemoveOnSuccess:I,membersAdminToUpdateOnSuccess:A}}function b(e,n,i){var o,c,l=r.currentUser(),u=t.defer();if(n.length>0){o=!1,c=n.keyValues("userId");var d=C.getTagChatMembersAddObject(e.getTagId(),c);a.sendTagChatMemberAddAuthRequest(d);var d=D.getTagChatTagMemberAddObject(e.getTagId(),n),g=A.getChatServerCurrentTime();h.request(d).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.addMember(t)}),e.setMembersCount(e.getMembersCount()+i.length),s.showTagMembersAddStatusMessage(e.getTagId(),l.getKey(),n,g,!1,t.packetId),u.resolve({sucs:!0,mg:"Member( "+i.length+" ) Added in "+e.getTagName()}))},function(e){u.reject({sucs:!1,mg:"Unable to send tag new member add packet to chat server."})})}else u.resolve({sucs:!1});return u.promise}function O(e,n,i){var o=r.currentUser(),a=t.defer();if(n.length>0){var c=A.getChatServerCurrentTime(),l=D.getTagChatMemberRemoveLeaveObject(e.getTagId(),n);h.request(l).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.removeMember(t)}),e.setMembersCount(e.getMembersCount()-i.length),s.showTagMembersRemoveStatusMessage(e.getTagId(),o.getKey(),n,c,t.packetId),a.resolve({sucs:!0,mg:"Member( "+i.length+" ) Removed from "+e.getTagName()}))},function(e){a.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."})})}else a.resolve({sucs:!1});return a.promise}function P(e,n,i){var o=r.currentUser(),a=t.defer(),c=A.getChatServerCurrentTime();if(n.length>0){var l=D.getTagChatTagMemberTypeChangeObject(e.getTagId(),n);h.request(l).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.updateMember(t)}),s.showMemberTypeChangeStatusMessage(e.getTagId(),o.getKey(),n,c,!1,t.packetId),a.resolve({sucs:!0,mg:"Member( "+i.length+" ) Status Updated for "+e.getTagName()}))},function(e){a.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."})})}else a.resolve({sucs:!1});return a.promise}function R(e,n,i){var o,a,c=r.currentUser(),l=t.defer(),u=e.getTagName(),d=e.getPictureUrl(),g=e.getTagName()!==n,m=e.getPictureUrl()!==i,f=g||m;if(f){if(o=s.getTagInfoChangeStatusMessage(e.getTagId(),{tagName:n||"",tagPictureUrl:i||""}),g){e.setTagName(n),a=v.TAG_ACTIVITY_TYPE.TAG_RENAME;var E=D.getTagChatTagInformationObject(e.getTagId(),a,n,d);h.request(E).then(function(t){t.sucs&&(s.showTagInfoChangeStatusMessage(e.getTagId(),c.getKey(),{statusMessageType:o,tagName:n},!1),m||l.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(t){g&&e.setTagName(u),l.reject({sucs:!1,mg:"Unable to send tag info tag name change packet to chat server."})})}if(m){e.setPictureUrl(i),a=v.TAG_ACTIVITY_TYPE.TAG_URL_RENAME;var E=D.getTagChatTagInformationObject(e.getTagId(),a,u,i);h.request(E).then(function(t){t.sucs&&(s.showTagInfoChangeStatusMessage(e.getTagId(),c.getKey(),{statusMessageType:o,tagName:n},!1),l.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(t){m&&e.setPictureUrl(d),l.reject({sucs:!1,mg:"Unable to send tag info tag picture url packet to chat server."})})}}else l.resolve({sucs:!1});return l.promise}function U(e,n,i,o,a){var s,c,l,u,d,m,f,E=(r.currentUser(),t.defer());s=N(e,o,a),c=s.serializedNewMemberAdminsToAdd,l=s.membersAdminToAddOnSuccess,u=s.serializedMemberAdminsToRemove,d=s.membersAdminToRemoveOnSuccess,m=s.serializedMemberAdminsToStatusChange,f=s.membersAdminToUpdateOnSuccess;var p=0;return b(e,c,l).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),O(e,u,d).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),P(e,m,f).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),R(e,n,i).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),setTimeout(function(){p?E.resolve({sucs:!0}):E.reject({sucs:!1})},18e3),g.triggerCustomEvent(_.CHAT.TAG_LIST_UPDATED),E.promise}function L(e){var t=o.getTag(e),n=t.getMember(r.currentUser().getKey());return F(e,[n.serialize()],[n])}function F(e,n,i){var a=r.currentUser(),s=t.defer(),c=o.getTag(e),l=D.getTagChatMemberRemoveLeaveObject(e,n);return h.request(l).then(function(t){if(t.sucs){c=o.getTag(e);for(var n="Member( "+i.length+" ) Removed from "+c.getTagName(),r=!1,l=0;l<i.length;l++){var u=i[l];if(u.getId()===a.getKey()&&(n="You left from ("+c.getTagName()+") conversation ",o.removeTagObject(e),r=!0,s.resolve({sucs:!0,mg:n})),r)break;c.removeMember(u)}r||s.resolve({sucs:!0,mg:n})}},function(e){s.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."})}),g.triggerCustomEvent(_.CHAT.TAG_LIST_UPDATED),s.promise}function w(e,n,i){var a=(r.currentUser(),t.defer()),s=o.getTag(e),c=D.getTagChatTagMemberTypeChangeObject(e,n);return h.request(c).then(function(e){e.sucs&&(angular.forEach(i,function(e){s.updateMember(e)}),a.resolve({sucs:!0,mg:"Member( "+n.length+" ) Status Updated for "+s.getTagName()}))},function(e){a.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."})}),g.triggerCustomEvent(_.CHAT.TAG_LIST_UPDATED),a.promise}function k(e){M(function(){var t=o.getTag(e);if(t&&t.isTagSafeToShow()){var n=l.getBoxByUId(e);$(e,n)}},function(t){var n=o.getTag(e);return!(!n||!n.isTagSafeToShow())},function(){},5,5e3)}function $(e,t){var n=!1;if(!t){n=!0;var r=o.getOrCreateTag(e);r.isTagSafeToShow()?(l.openTagChatBox(e),t=l.getBoxByUId(e),t.setTitle(r.getTagName())):t=l.creatNonDomBox(e,!0),t.setTitle(r.getTagName())}return n&&t.loadHistoryMessages(),t}return{createTag:y,updateTag:U,leaveFromTag:L,removeTagMember:F,changeTagMemberStatus:w,openTagChatBoxIfClosed:$,openPreviouslyOpenedBoxes:k}}var tagChatApp=angular.module("ringid.chat");tagChatApp.factory("tagChatModels",tagChatModels),tagChatModels.$inject=["$$stackedMap","userFactory","userService","Utils","Auth","settings","SystemEvents"];function tagChatModels(e,t,n,r,i,o,a){var s=CHAT_APP.Constants.GENERAL_CONSTANTS;s.LOCAL_CHAT,s.API_VERSION_PORT_OFFSET;function c(){var t=this,n={id:0,name:"Group",pictureUrl:"",userId:0,packetId:0,memberCount:0,serverDate:0,serverDateDiff:0,members:e.createNew(),messages:e.createNew(),objectLock:!1,ownerUserId:0,creationTime:0};this.getTagId=function(){return n.id},this.setTagId=function(e){n.id=e,n.creationTime=e.toString().substr(0,s.TAG_ID_NO_OF_TIME_DIGIT)},this.getTagCreationTime=function(){return n.creationTime},this.getUserId=function(){return n.userId},this.setUserId=function(e){n.userId=e},this.getPacketId=function(){return n.packetId},this.setPacketId=function(e){n.packetId=e},this.renewPacketId=function(){t.setPacketId(r.getUniqueID("tgrc"))},this.getTagName=function(){return n.name},this.setTagName=function(e){n.name=e},this.setPictureUrl=function(e){n.pictureUrl=e},this.getPictureUrl=function(){return n.pictureUrl.trim()},this.getPictureFullUrl=function(){return""!=this.getPictureUrl()?o.imBase+this.getPictureUrl():"images/prof.png"},this.setServerDate=function(e){n.serverDate=e,t.setServerDateDiff(e-parseInt((new Date).getTime()))},this.getServerDate=function(){return n.serverDate},this.setServerDateDiff=function(e){n.serverDateDiff=e},this.getServerDateDiff=function(){return n.serverDateDiff},this.getMembersCount=function(){return n.memberCount},this.setMembersCount=function(e){n.memberCount=e},this.isTagSafeToShow=function(){return n.memberCount>0},this.initMembers=function(){n.members=e.createNew()},this.addMember=function(e){n.members||(n.members=t.initMembers()),e.isOwner()&&(n.ownerUserId=e.getId()),n.members.save(e.getId(),e)},this.updateMember=function(e){this.addMember(e)},this.removeMember=function(e){e instanceof l?n.members.remove(e.getId()):n.members.remove(e)},this.membersLength=function(){return n.members?n.members.length():0},this.getMember=function(e){return n.members.get(e)},this.getMemberObjects=function(){return n.members.values()},this.getMemberUserIds=function(){return n.members.keys()},this.getMembersObjectMap=function(){return n.members},this.setMembersObjectMap=function(e){n.members=e},this.initMemberObjects=function(){for(var e=n.members.all(),t=0;t<n.members.length();t++){var r=e[t].value;r.initUserObjects()}},this.unregisterMemberObjectsListener=function(){for(var e=n.members.all(),t=0;t<n.members.length();t++){var r=e[t].value;r.unregisterUserObjectsListener()}},this.getSerializedMembers=function(){for(var e=n.members.all(),t=[],r=0;r<e.length;r++){var i=e[r].value;t.push(i.serialize())}return t},this.isUserMember=function(e){return!!n.members&&!!n.members.get(e)},this.isCurrentUserStatusAdmin=function(e){var t=!!n.members&&n.members.get(e);return!!t&&t.isAdmin()},this.isCurrentUserStatusMember=function(e){var t=!!n.members&&n.members.get(e);return!!t&&t.isMember()},this.setObjectLock=function(){n.objectLock=!0},this.removeObjectLock=function(){n.objectLock=!1},this.hasObjectLock=function(){return n.objectLock},this.setOwnerUserId=function(e){n.ownerUserId=e},this.getOwnerUserId=function(){return n.ownerUserId},this.initMessages=function(){n.messages=e.createNew()},this.addMessage=function(e){n.messages||(n.messages=t.initMessages()),n.messages.save(e.getPacketId(),e)},this.removeMessage=function(e){e instanceof u?n.messages.remove(e.getId()):n.messages.remove(e)},this.messagesLength=function(){return n.messages?n.messages.length():0},this.getMessage=function(e){return n.messages.get(e)},this.getMessageObjects=function(){return n.messages.values()},this.getMessageUserIds=function(){return n.messages.keys()},this.getMessagesObjectMap=function(){return n.messages},this.setMessagesObjectMap=function(e){n.messages=e},this.debug=function(){return n}}c.prototype.copy=function(){var e=new c;return e.setTagId(this.getTagId()),e.setTagName(this.getTagName()),e.setPictureUrl(this.getPictureUrl()),e.setUserId(this.getUserId()),e.setPacketId(this.getPacketId()),e.setChatBindingPort(this.getChatBindingPort()),e.setChatIp(this.getChatIp()),e.setChatRegisterPort(this.getChatRegisterPort()),e.setServerDate(this.getServerDate()),e.setMembersObjectMap(this.getMembersObjectMap().copy()),e},c.prototype.update=function(e){e.getTagName()&&this.setTagName(e.getTagName()),e.getPictureUrl()&&this.setPictureUrl(e.getPictureUrl()),e.getUserId()&&this.setUserId(e.getUserId()),e.getPacketId()&&this.setPacketId(e.getPacketId()),e.getServerDate()&&this.setServerDate(e.getServerDate())},c.prototype.sortBy=function(){return this.getTagCreationTime()};function l(){var e=this,c={tagId:0,userId:0,fullName:"",status:0,statusValue:"",addedBy:0,user:{},addedByUser:{},userRegisterKey:null,addedByUserRegisterKey:null};this.initWithUserMapObject=function(t){e.setId(t.getKey()),e.setFullName(t.getName()),e.setUserObj(t)},this.setTagId=function(e){c.tagId=e},this.getTagId=function(){return c.tagId},this.setId=function(e){c.userId=e.toString()},this.getId=function(){return c.userId},this.getUser=function(){return t.getUser(c.userId)},this.setFullName=function(e){c.fullName=e},this.getFullName=function(){return c.fullName},this.getPictureUrl=function(){return e.getUser().getUserAvatar?o.imBase+e.getUser().getUserAvatar():"images/prof.png"},this.getName=function(){return""!==c.fullName?c.fullName:e.getUser()?e.getUser().getName():c.userId},this.getStatus=function(){return c.status},this.getStatusValue=function(){return c.status===s.MEMBER_STATUS.ADMIN?"admin":c.status===s.MEMBER_STATUS.MEMBER?"member":"owner"},this.setStatus=function(e){c.status=e},this.setAddedBy=function(e){c.addedBy=e.toString()},this.getAddedBy=function(){return c.addedBy},this.getAddedByUser=function(){return t.getUser(c.addedBy)},this.getAddedByUserName=function(){return!!e.getAddedByUser()&&e.getAddedByUser().getName()},this.setAddedByUserObj=function(e){c.addedByUser=e},this.setUserObj=function(e){c.user=e},this.unregisterUserObjectsListener=function(){n.unregister(c.userRegisterKey),c.userRegisterKey=null,n.unregister(c.addedByUserRegisterKey),c.addedByUserRegisterKey=null},this.initUserObjects=function(){var t=e.getUser();c.userRegisterKey||t&&t.hasDetails()||(c.userRegisterKey=n.register(c.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:c.userId,tagId:c.tagId})}));var i=e.getAddedByUser();c.addedByUserRegisterKey||i&&i.hasDetails()||(c.addedByUserRegisterKey=n.register(c.addedBy,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:c.addedBy,tagId:c.tagId})}))},this.isCurrentUser=function(){return e.getId()===i.currentUser().getKey()},this.isAdmin=function(){return c.status==s.MEMBER_STATUS.ADMIN},this.isMember=function(){return c.status==s.MEMBER_STATUS.MEMBER},this.isOwner=function(){return c.status==s.MEMBER_STATUS.OWNER},this.isRemoved=function(){return c.status==s.MEMBER_STATUS.REMOVED},this.makeAdmin=function(){c.status=s.MEMBER_STATUS.ADMIN},this.makeMember=function(){c.status=s.MEMBER_STATUS.MEMBER},this.makeOwner=function(){c.status=s.MEMBER_STATUS.OWNER},this.serialize=function(){return{userId:e.getId(),fullName:e.getName().utf8Encode(),status:e.getStatus(),addedBy:e.getAddedBy()}}}function u(){var e=this,i={tagId:0,text:"",hrtime:"",status:"",messageDate:"",isDeleted:!1,messageDateString:"",timeout:0,userId:0,fullName:"",type:0,packetId:0,user:{},seenPacketSent:!1,deliveredPacketSent:!1,statusType:"",seenUsers:[],deliveredUsers:[],usersToChange:{},usersToChangeName:{},tagName:"",allStatusUserFetched:!1,statusUsersFetchCount:0,userRegisterKey:null};this.getTagId=function(){return i.tagId},this.setTagId=function(e){i.tagId=e},this.getHumanReadableTime=function(){return i.hrtime},this.setHumanReadableTime=function(e){i.hrtime=e},this.setFullName=function(e){i.fullName=e.substring(0,127)},this.getFullName=function(){return i.fullName},this.getPacketId=function(){return i.packetId},this.setPacketId=function(e){i.packetId=e},this.getMessageText=function(e){return i.text},this.setMessageText=function(e){i.text=e},this.setStatus=function(e){i.status=e},this.getStatus=function(){return i.status},this.setMessageDate=function(e){i.messageDate=e},this.getMessageDate=function(){return i.messageDate},this.markAsDeleted=function(){i.isDeleted=!0},this.unMarkFromDeleted=function(){i.isDeleted=!1},this.getIsDeleted=function(){return i.isDeleted},this.setMessageDateString=function(e){i.messageDateString=e},this.setTimeout=function(e){i.timeout=e},this.setUserId=function(e){i.userId=e},this.getMessageDateString=function(){return i.messageDateString},this.getTimeout=function(){return i.timeout},this.getUserId=function(){return i.userId},this.getUser=function(){return t.getUser(i.userId)},this.getMessageType=function(){return i.type},this.setMessageType=function(e){return i.type=e},this.initUserObjects=function(){var t=e.getUser();i.userRegisterKey||t&&t.hasDetails()||(i.userRegisterKey=n.register(i.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:i.userId,tagId:i.tagId})}))},this.unregisterUserObjectsListener=function(){n.unregister(i.userRegisterKey),i.userRegisterKey=null},this.getSeenPacketSent=function(){return i.seenPacketSent},this.getDeliveredPacketSent=function(){return i.deliveredPacketSent},this.setSeenPacketSent=function(e){i.seenPacketSent=e},this.setDeliveredPacketSent=function(e){i.deliveredPacketSent=e},this.addSeenUserId=function(e){i.seenUsers.push(e)},this.addDeliveredUserId=function(e){i.deliveredUsers.push(e)},this.setUsersToChange=function(e){i.usersToChange=e},this.getUsersToChange=function(){return i.usersToChange},this.setUsersToChangeName=function(e){i.usersToChangeName=e},this.getUsersToChange=function(){return i.usersToChangeName},this.setStatusType=function(e){i.statusType=e},this.getStatusType=function(){return i.statusType},this.getTagName=function(){return i.tagName},this.setTagName=function(e){i.tagName=e},this.serialize=function(){return{tagId:e.getTagId(),userId:e.getUserId(),user:e.getUserId(),packetId:e.getPacketId(),fullName:e.getFullName().utf8Encode(),status:e.getStatus(),statusType:e.getStatusType(),type:e.getMessageType(),hrtime:e.getHumanReadableTime(),messageDate:e.getMessageDate(),isDeleted:i.isDeleted,timeout:e.getTimeout(),text:e.getMessageText().utf8Encode(),seenPacketSent:e.getSeenPacketSent(),deliveredPacketSent:e.getDeliveredPacketSent(),usersToChange:Object.keys(i.usersToChange),allStatusUserFetched:i.allStatusUserFetched,messageType:e.getMessageType(),tag_chat:!0,tagName:e.getTagName()}}}return u.prototype.update=function(e){e.getFullName()&&this.setFullName(e.getFullName()),e.getStatus()&&this.setStatus(e.getStatus()),e.getStatusType()&&this.setStatusType(e.getStatusType()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getMessageDate()&&this.setMessageDate(e.getMessageDate()),e.getMessageText()&&this.setMessageText(e.getMessageText()),e.getUsersToChange()&&this.setUsersToChange(e.getUsersToChange()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getSeenPacketSent()&&this.setSeenPacketSent(e.getSeenPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getTimeout()&&this.setTimeout(e.getTimeout()),e.getIsDeleted()&&this.markAsDeleted(),e.getHumanReadableTime()||this.setHumanReadableTime(e.getHumanReadableTime())},{TagObject:c,TagMember:l,TagMessage:u}}angular.module("ringid.chat").factory("tagChatStorage",tagChatStorage),tagChatStorage.$inject=["Storage","Auth","Utils"];function tagChatStorage(e,t,n){var r={packets:{}};function i(){return"tagc-store-"+t.currentUser().getKey()}function o(t){e.setData(i(),angular.toJson(t))}function a(e,t){r.packets[e]=n.arrayBuffer2String(t.buffer.slice(6)),o(r)}function s(e){return n.string2ArrayBuffer(r.packets[e])}function c(){return r.packets}return t.isLoggedIn(),{savePacket:a,getPacket:s,getAllPackets:c}}angular.module("ringid.chat").factory("tagChatUI",tagChatUI),tagChatUI.$inject=["ChatFactory","Utils","chatHistoryFactory","tagChatFactory","Ringalert"];function tagChatUI(e,t,n,r,i){var o=CHAT_APP.Constants,a=o.GENERAL_CONSTANTS;return{getTagInfoChangeStatusMessage:u,showTagInfoChangeStatusMessage:d,showMemberTypeChangeStatusMessage:l,showTagMembersAddStatusMessage:g,showTagMembersRemoveStatusMessage:m};function s(e){var t;return t="admin"===e?a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:"member"===e?a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER}function c(e){for(var t={},n=0;n<e.length;n++){var r,i=e[n];r=angular.isString(i.status)?s(i.status):i.status,t[r]||(t[r]=[]),t[r].push(i)}return t}function l(t,i,o,s,l,u){var d=e.getBoxByUId(t),g=c(o),m={};s&&(u=CHAT_APP.UTILS.getUUIDPacketId(s,!0),m.messageDate=s);var f=1;for(var E in g)if(g.hasOwnProperty(E)){f||(u=u+"_"+f);var p="";E=parseInt(E),p=E===a.MEMBER_STATUS.ADMIN?a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:E===a.MEMBER_STATUS.MEMBER?a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER;var T=r.createTagStatusMessage(u,t,i,p,g[E],m);if(!T)continue;var h=T.serialize();d?(h.fromHistory=l,d.pushMessage(h,i)):n.addMessage(h,t)}}function u(e,t,n){n||(n=r.getTag(e));var i=0;return n&&(t.tagName&&t.tagPictureUrl&&n.getTagName()!==t.tagName&&n.getPictureUrl()!==t.tagPictureUrl.trim()?i=a.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:(t.tagName&&n.getTagName()!==t.tagName&&(i=a.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE),t.tagPictureUrl&&n.getPictureUrl()!==t.tagPictureUrl.trim()&&(i=a.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE))),i}function d(t,i,o,a,s,c){c||(c=r.getTag(t)),s||(s=CHAT_APP.UTILS.getUUIDPacketId());var l=o.statusMessageType;if(l||(l=u(t,o,c)),o.messageDate&&(s=CHAT_APP.UTILS.getUUIDPacketId(o.messageDate,!0)),0!==l){var d=e.getBoxByUId(t),g=r.createTagStatusMessage(s,t,i,l,[],o);if(!g)return;var m=g.serialize();d?(m.fromHistory=a,d.pushMessage(m,i)):n.addMessage(m,t)}}function g(t,i,o,s,l,u,d){d||(d=r.getTag(t));var g=e.getBoxByUId(t),m=c(o),f={};s&&(f.messageDate=s);for(var E in m)if(m.hasOwnProperty(E)){var p=u+"_"+E,T="";E=parseInt(E),E===a.MEMBER_STATUS.ADMIN?T=a.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:E===a.MEMBER_STATUS.MEMBER?T=a.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:E===a.MEMBER_STATUS.OWNER&&(T=a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER);var h=r.createTagStatusMessage(p,t,i,T,m[E],f);if(!h)continue;var _=h.serialize();g?(_.fromHistory=l,g.pushMessage(_,i)):n.addMessage(_,t)}}function m(t,i,o,s,c,l,u){u||(u=r.getTag(t)),l||(l=CHAT_APP.UTILS.getUUIDPacketId(s,!0));for(var d=e.getBoxByUId(t),g=0;g<o.length;g++){var m=u.getMember(o[g].userId);m&&(o[g].fullName=m.getName())}var f={};s&&(f.messageDate=s,l=CHAT_APP.UTILS.getUUIDPacketId(s,!0));var E=r.createTagStatusMessage(l,t,i,a.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE,o,f);if(E){var p=E.serialize();d?(p.fromHistory=c,d.pushMessage(p,i)):n.addMessage(p,t)}}}angular.module("ringid.chat").factory("chatRequestProcessor",chatRequestProcessor),chatRequestProcessor.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","CHAT_LANG","ChatUtilsFactory","ChatConnector"];function chatRequestProcessor(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T){var h=window.CHAT_APP,_=h.Constants,I=(_.GENERAL_CONSTANTS,_.CHAT_GLOBAL_VALUES),A=h.ChatRequests,v=h.SharedHelpers,S=(E.TAG,function(){var e=I.offlineUpdateTime,t=v.getChatServerCurrentTime(),n=A.getOfflineGetRequestObject(e,0);T.request(n).then(function(e){e.sucs&&(I.offlineUpdateTime=t)})}),C=function(e,t,n,r){n=n||h.UTILS.getUUIDPacketId(),r=r||10;var i=A.getOfflineTagHistoryMessageRequestObject(e,t,r,n);return T.request(i)},D=function(e,t,n,r){n=n||h.UTILS.getUUIDPacketId(),r=r||10;var i=A.getOfflineFriendHistoryMessageRequestObject(e,t,r,n);return T.request(i)},M=function(e,t){var n=A.getOfflineTagUnreadMessageConfirmationObject(t);T.send(n)},y=function(e,t,n){var r=A.getOfflineFriendUnreadMessageConfirmationObject(n,t);T.send(r)},N=function(e){var t;return t=e.isTagChat?C:D},b=function(e){var t=A.getOfflineFriendInformationObject(e.getUId(),e.getName(),e.getOnlineStatus(),e.getAppType()||1,e.getDeviceToken(),e.getUserMood());T.send(t)};return{getUnreadMessagesMultipleTimes:S,getTagHistoryMessagesMultipleTimes:C,getFriendHistoryMessagesMultipleTimes:D,getHistoryRequestMethodByBox:N,sendTagUnreadMessageConfirmation:M,sendFriendUnreadMessageOfflineConfirmation:y,sendFriendInformation:b}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("ChatResponseProcessor",ChatResponseProcessor),ChatResponseProcessor.$inject=["tagChatFactory","Auth","ChatFactory","chatHistoryFactory","CHAT_LANG","Utils","tagChatUI","SystemEvents"];function ChatResponseProcessor(e,t,n,r,i,o,a,s){var c=window.CHAT_APP.Constants,l=c.GENERAL_CONSTANTS,i=i.CHAT;function u(e,t,i){var o=n.getBoxByUId(e);return o||(n.creatNonDomBox(e,i),o=n.getBoxByUId(e),o.nonDomBox=t||!1,r.updateBox(o)),o}function d(e){CHAT_SESSION.UnRegister(e)}function g(e){var t=l.MESSAGE_STATUS_VALUE[e];return t&&(t=t.charAt(0)+t.substr(1).toLowerCase()),t}function m(e,o,a,s,c){if(c||(c=n.getBoxByUId(e)),o==t.currentUser().getKey())c&&c.removeMessage(a),r.removeMessage(a,e);else{var u,d=!1;u=c?c.getMessage(a):r.getMessage(e,a),u||(u=s,d=!0),u.messageType=l.MESSAGE_TYPES.DELETE_MESSAGE,u.message=i.MESSAGE_DELETE_TEXT,u.status="Deleted",c?d&&c.pushMessage(u,o):r.updateMessage(u,e)}}function f(e,n){var r;return r=e==t.currentUser().getKey()?n:e}function E(e,t){return u(e,t,!1)}function p(e,t){t&&("Seen"!=t.status&&"Deleted"!=t.status&&"Viewed"!=t.status&&"Played"!=t.status&&(t.status="Delivered"),r.updateMessage(t,e))}function T(e){d(e)}function h(t,n,r){r||(r=e.getTag(t));var i=u(t,n,!0);return r&&i.setTitle(r.getTagName()),i}function _(e){d(e)}function I(t){var n,r=t.userId,i=t.tagId,o=t.tagMembers,s=t.packetId,c=t.messageDate||null;n=e.getOrCreateTag(i),a.showTagMembersAddStatusMessage(i,r,o,c,t.fromHistory,s,n),n&&!t.fromHistory&&N(n,o,r)}function A(t){var n,r,i=t.userId,o=t.tagId,s=t.tagMembers,c=t.packetId,l=t.messageDate||null;delete t.packetId,n=e.getOrCreateTag(o),a.showTagMembersRemoveStatusMessage(o,i,s,l,t.fromHistory,c,n),t.fromHistory||(r=b(n,s),r&&(y(o),_(o)))}function v(t){var n,r=(t.userId,t.tagId),i=(t.activityType,t.tagName,t.tagPictureUrl,t.packetId,e.getTag(r));i?(a.showTagInfoChangeStatusMessage(r,t.userId,t,t.fromHistory),t.fromHistory||(n=e.updateTag(r,t,i))):t.fromHistory||(n=e.createNewTag(t),e.addTagObject(n)),o.triggerCustomEvent(s.CHAT.TAG_LIST_UPDATED)}function S(t){var n,r=t.userId,i=t.tagId,o=t.tagMembers,s=t.packetId,c=t.messageDate||null;n=e.getOrCreateTag(i),a.showMemberTypeChangeStatusMessage(i,r,o,c,t.fromHistory,s),t.fromHistory||O(n,o)}function C(e){var t=h(e.tagId);t.updateBoxMessageMinMaxPacketId(e)}function D(e,t,n){if(n.changedByUserId!=n.userId||n.status!=l.MEMBER_STATUS.OWNER)switch(n.activityType){case l.TAG_ACTIVITY_TYPE.DELETED:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.ADDED:I({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status,fullName:n.activityValue}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.LEAVE:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.TAG_RENAME:v({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.MEMBER_TYPE_CHANGE:S({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:v({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagPictureUrl:n.activityValue,fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.TAG_CREATED:C({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,tagMembers:[],fromHistory:n.fromHistory})}}function M(e){var t,n=e.packetType,r=(e.userId,e.tagId),i=e.packetId,o=e.messageDate;try{t=angular.fromJson(e.message)}catch(e){return}var a={changedByUserId:e.userId,userId:t.mId,status:t.mT,activityValue:t.n,activityType:n,activityDate:o,fromHistory:e.fromHistory||!1};D(r,i,a)}function y(e){var t=n.getBoxByUId(e);t&&(n.closeChatBox(t.getKey()),r.removeOpenBox(t.getKey()))}function N(t,n,r){for(var i=0;i<n.length;i++){var o=n[i];r&&(o.addedBy=r);var a=e.createNewTagMember(t.getTagId(),o,!1);a.isRemoved()||t.addMember(a)}}function b(e,t){for(var n=!1,r=0;r<t.length;r++){var i=e.getMember(t[r].userId);i&&(n=i.isCurrentUser(),e.removeMember(i))}return n}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(e){var i=e.getMember(r.userId);i&&i.setStatus(r.status)}}}return{doFriendUnregisterTask:T,getFriendBoxId:f,getFriendBox:E,updateMessageStatusToDelivered:p,doOnMessageTypeDeleteMessage:m,getMessageStatus:g,doTagUnregisterTask:_,getTagChatBox:h,processAGroupActivity:D,processGroupActivityMessage:M,addMembersToTagObject:N,removeMembersFromTagObject:b,updateMemberStatusInTagObject:O,processTagMemberAddUpdate:I,processTagMemberRemoveLeave:A,processTagInformation:v,processTagMemberStatusChange:S}}angular.module("ringid.chat").directive("rgImageCapture",rgImageCapture),rgImageCapture.$inject=["Utils","rgRecorderService"];function rgImageCapture(e,t){return{link:function(n,r,i){var o={CAPTURE:"Capture",RETAKE:"ReTake"};n.videoId=e.getUniqueID("rgRec"),n.showLoader=!0,n.media=null,n.errorText="",n.connected=!1,n.captureText=o.CAPTURE;var a=function(){return document.querySelector("#"+n.videoId)},s={text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser. Please use upgraded browser."}},c=t.getRecorderInstance(s);c.on("streamReady",function(e){n.showLoader=!1,n.connected=!0,n.$rgDigest();try{a().appendChild(e.media),n.media=e.media,e.media.play()}catch(e){}}),c.on("error",function(e){n.errorText=e.text,n.showLoader=!1,n.connected=!1,n.$rgDigest()}),n.connect=function(){n.showLoader=!0,n.connected=!1,c.openMedia({video:!0,audio:!1})},setTimeout(function(){n.connect()},500),n.doCapture=function(){if(n.captureText==o.CAPTURE){var e=c.captureImage();e&&(n.capturedMedia=e,n.captureText=o.RETAKE),n.media&&n.media.pause()}else n.capturedMedia=null,n.captureText=o.CAPTURE,n.media.play();n.$rgDigest()},n.$on("$destroy",function(){c.destroy()})},templateUrl:"templates/partials/recorder/image.html"}}openBox.$inject=["ChatFactory","tagChatFactory","rgDropdownService","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"];function openBox(e,t,n,r,i,o,a,s){return{link:function(c,l,u){l.on("click",function(l){var d=CHAT_APP.Constants.GENERAL_CONSTANTS,g=d.SESSION_TYPES,m=!!u.boxId&&u.boxId,f="true"==u.isTagChat;if(m&&u.openChatBox!=i.currentUser().getKey()){r.safeDigest(c),n.close(l);var E,p=!1;if(f){if(E=t.getTag(m),E&&E.isTagSafeToShow()){p=!0;var E=t.getTag(m);a.startChatSession(m,g.TAG,E.getMemberUserIds()),e.openTagChatBox(m,!0)}}else a.startChatSession(m,g.FRIEND),e.openChatBox(m,!0);var T=e.getBoxByUId(m);T&&(o.decreaseUnreadCount(T),p&&T.setTitle(E.getTagName())),r.safeDigest(c),s.$broadcast("focusOn",m),l.preventDefault(),l.stopPropagation()}})}}}openChatBox.$inject=["ChatFactory","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"];function openChatBox(e,t,n,r,i,o){return{link:function(a,s,c){s.on("click",function(s){var l=c.openChatBox,u=CHAT_APP.Constants.GENERAL_CONSTANTS,d=u.SESSION_TYPES;if(l&&l!=n.currentUser().getKey()){t.safeDigest(a),e.openChatBox(l,!0);var g=e.getBoxByUId(l);if(1==g.getUser().friendshipStatus())i.startChatSession(l,d.FRIEND);else{var m=n.getPermission();if(1==m.ancht)i.startChatSession(l,d.FRIEND);else{var g=e.getBoxByUId(l);g.blocked=!0}}g&&r.decreaseUnreadCount(g),o.$broadcast("focusOn",l),s.preventDefault(),s.stopPropagation()}})}}}openTagChatBox.$inject=["ChatFactory","tagChatFactory","tagChatManager","Auth","$rootScope","ChatHelper","ChatWorkerCommands"];function openTagChatBox(e,t,n,r,i,o,a){return{link:function(n,s,c){s.on("click",function(){var n=CHAT_APP.Constants.GENERAL_CONSTANTS,s=n.SESSION_TYPES,l=c.openTagChatBox;if(!(l<=0)&&c.openChatBox!=r.currentUser().getKey()){var u=t.getTag(l),d=e.openTagChatBox(l,!0);d.setTitle(u.getTagName()),u&&u.isTagSafeToShow()&&u&&a.startChatSession(l,s.TAG,u.getMemberUserIds()),d&&(d.loadHistoryMessages(),o.decreaseUnreadCount(d)),i.$broadcast("focusOn",l),event.preventDefault(),event.stopPropagation()}})}}}makeVisibleChatBox.$inject=["ChatFactory","$rootScope"];function makeVisibleChatBox(e,t){return{link:function(t,n,r){n.on("click",function(i){t.rbox.value.isFocused=!0,e.makeVisibleChatBox(r.makeVisibleChatBox),n.parent().parent().children().eq(0).removeClass("blink"),i.preventDefault()})}}}showHiddenBoxes.$inject=["ChatFactory","$rootScope"];function showHiddenBoxes(e,t){return{link:function(t,n,r){n.on("click",function(){
e.openChatBox(r.openChatBox)})}}}closeBox.$inject=["ChatFactory","chatHistoryFactory","tagChatFactory"];function closeBox(e,t,n){return{restrict:"A",link:function(r,i,o){i.on("click",function(){e.closeChatBox(r.box.value.getKey()),t.removeOpenBox(r.box.value.getKey());var i=n.getTag(r.box.value.getKey());i&&i.initMessages(),r.$parent.$digest()})}}}minimizeBox.$inject=["ChatFactory","$rootScope"];function minimizeBox(e,t){return{restrict:"A",link:function(n,r,i){r.on("click",function(r){n.box.value.blinkOn&&!n.box.value.isMinimized?(n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):n.box.value.blinkOn&&n.box.value.isMinimized?(e.minimizeBox(n.box.value.getKey()),n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):n.box.value.blinkOn||n.box.value.isMinimized?!n.box.value.blinkOn&&n.box.value.isMinimized&&(e.minimizeBox(n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):(e.minimizeBox(n.box.value.getKey()),t.$broadcast("focusOn",null)),n.$digest(),r.stopPropagation()})}}}maximizeBox.$inject=["ChatFactory"];function maximizeBox(e){return{scope:!1,restrict:"A",link:function(e,t,n){}}}tagChatEdit.$inject=["ChatFactory","rgDropdownService","$compile"];function tagChatEdit(e,t,n){return{restrict:"A",link:function(e,t,n){t.on("click",function(t){e.showDropdown=!e.showDropdown,t.stopPropagation()})},controller:["$scope","tagChatFactory","tagChatManager","Auth","Ringalert","$compile",function(e,n,r,i,o,a){e.showDropdown=!1,e.hasTagObjectLock=function(e){var t=n.getTag(e);return!!t&&t.hasObjectLock()},e.getTagDDControl=function(e){var t=n.getTag(e),r=t.getMember(i.loginData.uId);return{tagId:e,isOwner:!!r&&r.isOwner()}},e.tagMemberDDActions=s,e.tagMemberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html";function s(e){switch(e.action){case"edit":case"view":return t.close(e.event),function(){return{tagId:e.tagId}};case"delete":t.close(e.event);var i=n.getTag(e.tagId);i.setObjectLock(),r.leaveFromTag(e.tagId,currentUser.getKey()).then(function(e){i.removeObjectLock(),o.show(e,"info")},function(e){i.removeObjectLock(),o.show(e,"error")})}}}]}}chatScrollBottom.$inject=["$rootScope","$scrollbar","Utils","SystemEvents"];function chatScrollBottom(e,t,n,r){return{restrict:"A",link:function(e,i,o){e.$on("ScrollToBottom",function(t,n){n==e.box.value.getKey()&&(i[0].scrollTop=i[0].scrollHeight,t.preventDefault())});var a={minThumbHeight:20},s=t.create(i[0],a);e.bottomReached=function(){ChatHelper.decreaseUnreadCount(box),e.$rgDigest()};function c(){e.refreshScrollbar(!0,function(){var t=i[0].querySelector(".status-unread-container");t?s.scrollBySelector(".status-unread-container",!0):s.scrollBottom(!0),t=null,e.$rgDigest()})}e.scrollbarFreezed=!1,e.freezeScrollbar=function(){e.scrollbarFreezed=!0,s.freeze()},e.refreshScrollbar=function(t,n){(e.scrollbarFreezed||t)&&(e.scrollbarFreezed=!1,s.reCalculate(!0).then(function(){e.scroll=s.hasScroll,n&&n.call(this)})),e.bottomScrolled||(e.bottomScrolled=!0,c())};var l=n.onCustomEvent(r.CHAT.SCROLL_TO_BOTTOM,function(t){t.boxId==e.box.value.getKey()&&e.refreshScrollbar(!0,function(){s.scrollBottom(!0),e.$rgDigest()})}),u=n.onCustomEvent(r.CHAT.SCROLL_TO_UNREAD,function(t){t.boxId==e.box.value.getKey()&&c()});e.$on("$destroy",function(){n.removeCustomEvent(r.CHAT.SCROLL_TO_BOTTOM,l),n.removeCustomEvent(r.CHAT.SCROLL_TO_UNREAD,u)})}}}chatBlinker.$inject=["$window","chatHistoryFactory"];function chatBlinker(e,t){return{restrict:"A",link:function(e,n,r){e.box.value.blinkOn===!0&&n.addClass("blink"),e.$on("blinkerEvent",function(r,i){i.toString()===e.box.value.getKey()&&(e.box.value.isMinimized?e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0):e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0),t.updateBox(e.box.value))}),e.$on("blinkerOff",function(r,i){i.toString()===e.box.value.getKey()&&(n.removeClass("blink"),e.box.value.blinkOn=!1,t.updateBox(e.box.value))}),e.$on("focusOn",function(t,r){r&&r.toString()===e.box.value.getKey()?n.addClass("chat-active"):(n.removeClass("chat-active"),e.box.value.isFocused=!1)})}}}chatBlinkerH.$inject=["$window","chatHistoryFactory"];function chatBlinkerH(e,t){return{restrict:"A",link:function(e,n,r){e.$on("blinkerEvent",function(r,i){i.toString()===e.rbox.value.getKey()&&(n.addClass("blink"),n.parent().parent().children().eq(0).addClass("blink"),t.updateBox(e.rbox.value))})}}}chatSelectEmo.$inject=["ChatPacketSenderService"];function chatSelectEmo(e){return{restrict:"A",link:function(e,t,n){e.selectEmoticon=function(t){e.messageText=e.messageText+t.symbol()}}}}chatBindOutsideClick.$inject=["$document","Utils"];function chatBindOutsideClick(e,t){return{restrict:"A",link:function(n,r,i){r.bind("click",function(e){e.stopPropagation()}),e.bind("click",function(){n.showHidden=!1,t.safeDigest(n)})}}}sharedContent.$inject=["Utils"];function sharedContent(e){return{restrict:"A",link:function(t){t.initMessageData=function(){t.messageData={ogData:{},locationData:{}}},t.resetOgInfo=function(){t.messageData.ogData={},t.ogStatus={preview:!1,loading:!1,filterOnProgress:!1}},t.resetMessageLocation=function(){t.messageData.locationData={description:"",lat:"",lng:""}},t.resetMessageText=function(){t.messageText=""},t.resetBottomMenu=function(){t.showBottomMenu=!1},t.resetMessageInput=function(n){t.initMessageData(),t.resetBottomMenu(),t.resetMessageText(),t.resetOgInfo(),t.resetMessageLocation(),n&&e.safeDigest(t)},t.resetMessageInput(!1)}}}angular.module("ringid.chat").directive("openBox",openBox).directive("openChatBox",openChatBox).directive("openTagChatBox",openTagChatBox).directive("makeVisibleChatBox",makeVisibleChatBox).directive("showHiddenBoxes",showHiddenBoxes).directive("closeBox",closeBox).directive("minimizeBox",minimizeBox).directive("maximizeBox",maximizeBox).directive("tagChatEdit",tagChatEdit).directive("chatScrollBottom",chatScrollBottom).directive("chatBlinker",chatBlinker).directive("chatBlinkerH",chatBlinkerH).directive("chatBindOutsideClick",chatBindOutsideClick).directive("sharedContent",sharedContent);function getMessagePacketIdForHistoryRequest(e){var t=e.key;if("status_update"==e.status)try{t=t.split("_")[0]}catch(e){}return t}var doHistoryRequest=function(e,t,n,r,i){var o=CHAT_APP.Constants.GENERAL_CONSTANTS;if(n&&n.nonDomBox){var a,s,c=n.getBottomMessage(),l=n.getTopMessage();l||c?(s=n.messageMinPacketId,a=n.messageMaxPacketId):a=s=i;var u=t.getHistoryRequestMethodByBox(n),d=a==s,g=o.HISTORY_MAX_MESSAGE+2;r&&r!=o.PAGE_DIRECTION.UP||doSendHistoryRequest(e,u,n,o.PAGE_DIRECTION.UP,s,g),d||r&&r!=o.PAGE_DIRECTION.DOWN||doSendHistoryRequest(e,u,n,o.PAGE_DIRECTION.DOWN,a,g)}};function doSendHistoryRequest(e,t,n,r,i,o){var a=n.getKey();e.historyLoading=!0,t.call(this,a,r,i,o).then(function(t){t.sucs&&(e.historyLoading=!1),e.refreshScrollbar()},function(){e.historyLoading=!1,n.hasHistoryMessage=!0,e.refreshScrollbar()}),setTimeout(function(){e.historyLoading||(e.historyLoading=!1,e.refreshScrollbar())},1e4)}chatBoxUi.$inject=["Utils","SystemEvents","ChatFactory","$rootScope","chatRequestProcessor","chatTabSync","StickerFactory","$document"];function chatBoxUi(e,t,n,r,i,o,a,s){var c="templates/chatbox.html";return{restrict:"E",replace:!0,scope:!0,templateUrl:c,link:function(i){setTimeout(a.initStickerData,5e3);var c=CHAT_APP.Constants.GENERAL_CONSTANTS,l=e.onCustomEvent(t.CHAT.BOX_OPENNED,function(r){var a=n.getBoxByUId(r.boxId);a&&a.messages.length<c.HISTORY_MAX_MESSAGE&&setTimeout(function(){a.loadHistoryMessages(),setTimeout(function(){a.bottomScrolled||(a.bottomScrolled=!0,e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:r.boxId}))},500)},500),r.sendToTab&&o.sendData(c.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE,{boxId:r.boxId}),i.$rgDigest(),i.$parent.$rgDigest()});s.on("click",function(e){r.$broadcast("focusOn",null)}),i.$on("$destroy",function(){e.removeCustomEvent(t.CHAT.BOX_OPENNED,l),e.removeCustomEvent(t.CHAT.TAG_LIST_UPDATED,tagListUpdatedFuncRef)})}}}function extraChatBoxes(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/extra-chatboxes.html"}}singleChatBox.$inject=["Utils","$rootScope","SystemEvents","chatTabSync","ChatFactory","chatRequestProcessor"];function singleChatBox(e,t,n,r,i,o){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-chatbox.html",link:function(r,i,a){var s=(CHAT_APP.Constants.GENERAL_CONSTANTS,{}),c=function(i){r.refreshScrollbar(!0),e.safeDigest(r),!i.noScroll&&r.bottomScrolled&&e.triggerCustomEvent(n.CHAT.SCROLL_TO_UNREAD,{boxId:i.boxId}),i.blink&&t.$broadcast("blinkerEvent",i.boxId)},l=function(t){var n=t.boxId.toString();n==r.box.key&&(s[n]||(s[n]={}),s[n][t.type]||(s[n][t.type]=e.debounce(function(e){c(e)},500,!1)),s[n][t.type].call(this,t))},u=e.onCustomEvent(n.CHAT.HISTORY_LOADED,function(t){var n=t.boxId.toString();if(n==r.box.key){var i=CHAT_APP.UTILS.getUUIDPacketId();doHistoryRequest(r,o,r.box.value,null,i),e.safeDigest(r)}}),d=e.onCustomEvent(n.CHAT.TAG_LIST_UPDATED,function(e){e.type="tag_updated",e.noScroll=!0,e.blink=!1,e.boxId=e.tagId,l(e)}),g=e.onCustomEvent(n.CHAT.MESSAGE_PUSHED,function(e){e.type="pushed",e.noScroll=e.noScroll||e.fromLocalHistory||e.fromHistory||e.isEdit||!1,e.blink=!e.fromLocalHistory||!e.fromHistory||!0,l(e)}),m=e.onCustomEvent(n.CHAT.BOX_UPDATED,function(t){t.boxId==r.box.key&&e.safeDigest(r)});r.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.HISTORY_LOADED,u),e.removeCustomEvent(n.CHAT.MESSAGE_RECEIVED,g),e.removeCustomEvent(n.CHAT.BOX_UPDATED,m),e.removeCustomEvent(n.CHAT.TAG_LIST_UPDATED,d)})}}}function chatBoxTopBar(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar.html"}}function chatBoxTopBarMenu(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar-menu.html",link:function(e){var t=e.box.value;e.hideTopbar=!0,setTimeout(function(){e.hideTopbar=!1,e.$rgDigest()},3e3),e.shouldShowLastOnlineBar=function(){return t.offlineStatus&&t.lastSeenBar&&!!t.getUser().lastOnline&&t.getUser().lastOnline()},e.shouldShowFriendSuggestion=function(){return!t.hideSuggestion&!t.isTagChat&&!!t.getUser()&&1!=t.getUser().friendshipStatus()&&!t.offlineStatus},e.shouldShowChatBoxTopbarMenu=function(){return!t.isTagChat&&(e.shouldShowLastOnlineBar()||e.shouldShowFriendSuggestion())}}}}function chatBoxUrlPreview(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-url-preview.html"}}chatBoxBottom.$inject=["Utils","$document"];function chatBoxBottom(e,t){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-bottom.html",link:function(t,n,r){t.toggleMenu=function(){t.showBottomMenu=!t.showBottomMenu,e.safeDigest(t)}}}}function chatBoxLocationInfo(){return{restrict:"E",replace:!0,link:function(e){},templateUrl:"templates/partials/chat/chatbox-location-info.html"}}chatBoxBottomMenu.$inject=["Utils","rgRecorderService"];function chatBoxBottomMenu(e,t){return{restrict:"E",replace:!0,link:function(e,n,r){e.showMediaButton=t.hasUserMediaSupport(),n.on("mouseover",function(){e.$parent.bottomMenuHover=!0}),n.on("mouseleave",function(){e.$parent.bottomMenuHover=!1})},templateUrl:"templates/partials/chat/chatbox-bottom-menu.html"}}chatBoxMiddle.$inject=["$rootScope","Utils"];function chatBoxMiddle(e,t){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-middle.html",link:function(e){}}}chatSingleMessage.$inject=["Utils","$ringbox","SystemEvents","$$mediaMap"];function chatSingleMessage(e,t,n,r){return{restrict:"E",replace:!0,link:function(r,i,o){var a,s=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,function(t){var n=t.message;n.key==r.message.key&&e.safeDigest(r)});r.openRingboxContent=function(n){a=t.open({type:"remote",scopeData:{message:n,viewport:e.viewport},resolve:{data:{}},onBackDropClickClose:!0,templateUrl:"templates/partials/chat/media-preview.html"})},r.getMediaData=function(e){return{data:function(){return{media:e}},promise:e.fetchDetails()}};var c=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,function(e){e.box;a&&a.close()});r.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,s),e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,c)})},templateUrl:"templates/partials/chat/message/single.html"}}function chatFileUploadProgress(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/message/upload-progress.html"}}singleMessageStatus.$inject=["Utils","ChatUtilsFactory"];function singleMessageStatus(e,t){var n=(CHAT_APP.Constants.CHAT_GLOBAL_VALUES,CHAT_APP.SharedHelpers,function(e,t){var n=t?t:"Pending";return"Sent"===n&&(n="Delivered"),n}),r=function(e){return t.getChatVerbalDateFromServerDate(e)};return{restrict:"E",replace:!0,link:function(e,t,i){e.$watch("message.status",function(){e.message.statusText=n(e.box.value.isTagChat,e.message.status),e.message.statusDate=r(e.message.messageDate),e.message.statusUserName=e.message.user.getName()})},templateUrl:"templates/partials/chat/message/status.html"}}chatHistoryLoader.$inject=["chatRequestProcessor","tagChatFactory","ChatFactory"];function chatHistoryLoader(e,t,n){return{restrict:"E",replace:!0,link:function(t,n,r){var i=CHAT_APP.Constants.GENERAL_CONSTANTS;t.historyLoading=!1,n.on("click",function(){var n=CHAT_APP.UTILS.getUUIDPacketId();t.freezeScrollbar(),doHistoryRequest(t,e,t.box.value,i.PAGE_DIRECTION.UP,n)})},templateUrl:"templates/partials/chat/history-loader-view.html"}}function singlePageChatUI(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}}function chatSinglePageTop(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/top.html"}}function chatSinglePageLeft(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/left.html"}}function chatSinglePageRight(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/right.html"}}function chatLeftSingleBox(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/left-single-box.html"}}function chatRightSingleBox(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/right-single-box.html"}}function chatMessageBox(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/message-box.html"}}function chatBoxTopBarStatus(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar-status.html",link:function(e,t){}}}angular.module("ringid.chat").directive("chatBoxUi",chatBoxUi).directive("chatBoxTopBar",chatBoxTopBar).directive("chatBoxMiddle",chatBoxMiddle).directive("chatBoxBottom",chatBoxBottom).directive("extraChatBoxes",extraChatBoxes).directive("chatBoxUrlPreview",chatBoxUrlPreview).directive("chatBoxTopBarStatus",chatBoxTopBarStatus).directive("chatBoxTopBarMenu",chatBoxTopBarMenu).directive("chatBoxBottomMenu",chatBoxBottomMenu).directive("chatBoxLocationInfo",chatBoxLocationInfo).directive("chatSingleMessage",chatSingleMessage).directive("chatFileUploadProgress",chatFileUploadProgress).directive("singleMessageStatus",singleMessageStatus).directive("chatHistoryLoader",chatHistoryLoader).directive("singleChatBox",singleChatBox).directive("chatSinglePageTop",chatSinglePageTop).directive("chatSinglePageLeft",chatSinglePageLeft).directive("chatLeftSingleBox",chatLeftSingleBox).directive("chatSinglePageRight",chatSinglePageRight).directive("chatRightSingleBox",chatRightSingleBox).directive("chatMessageBox",chatMessageBox).directive("singlePageChatUI",singlePageChatUI);var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("chatFocus",chatFocusDirective),chatFocusDirective.$inject=["fileUploadService","chatHistoryFactory","$document","$rootScope","Utils","Auth","ChatHelper","SystemEvents","settings","ChatSeenSend","ChatPacketSenderService","chatTabSync","Ringalert","ChatConnector","ChatUtilsFactory","rgScrollbarService"];function chatFocusDirective(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E){var p=CHAT_APP.Constants,T=(p.CHAT_GLOBAL_VALUES,p.GENERAL_CONSTANTS),h=CHAT_APP.SharedHelpers;return{controller:["$scope","ChatSeenSend","ChatHelper","Auth","rgScrollbarService","ChatUtilsFactory","SystemEvents",function(e,t,n,r,o,a,s){e.onViewedCalled=function(i){var o=e.box.value,a=e.box.value.isTagChat,s=[{key:i.key,value:i}],c=function(e){for(var t=[],n=0,i=e.length;n<i;n++)e[n].value.user.getKey()!==r.loginData.uId&&"Deleted"!==e[n].value.status&&"Played"!==e[n].value.status&&"Viewed"!==e[n].value.status&&"status_update"!==e[n].value.status&&1!=e[n].value.seenSent&&t.push(e[n]);return t};if(angular.isArray(s)&&s.length>0){if(s=c(s),s.length<1)return;var l=t.sendSeenPacket(o,s);l&&l.then(function(){e.$rgDigest()}),a||n.startTimerOthers(e,s)}},e.showUnreadMessages=function(){var t=e.box.value;n.decreaseUnreadCount(t),i.triggerCustomEvent(s.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.key,topAlign:!0})}}],link:function(n,m,E){var p=n.box.value.getKey();n.uploadBoxValue=n.box.value.getKey(),n.uploadAction=function(t){var r=i.getUniqueID("ring"),a=function(t){if(e.removeScope(n),t.sucs){var o=n.box.value,a=(o.isTagChat,o.offlineStatus,{url:t.url,caption:t.caption,width:t.iw,height:t.ih}),s=c.imBase+t.url;o.removeMessage(r),i.safeDigest(n),u.sendMessage(o,s,T.MESSAGE_TYPES.IMAGE,{mediaData:a}),n.resetMessageInput(),i.safeDigest(n)}},s=function(e){g.show({mg:"Image Upload Failed, please try again"},"error"),A.removeMessage(r),n.$rgDigest()};t.uploadFile.fetchMeta(function(c){var l={key:r,uploadProgress:t.uploadFile.getProgress,uploading:!0,message:" ",mediaUrl:t.uploadFile.getPreview(),messageDate:h.getChatServerCurrentTime(),messageType:T.MESSAGE_TYPES.IMAGE,packetId:r,sessionId:i.getToken,timeout:0,status:0,userId:o.currentUser().getKey(),getMessageTime:function(){return f.getChatVerbalDateFromServerDate(l.messageDate)},fileUploadObject:t.uploadFile};n.box.value.pushDummyMessage(l,o.currentUser(),!0),e.setScopeForDigest(n),i.safeDigest(n),t.uploadFile.initUpload().then(function(e){l.uploading=!1,a(e)},function(e){l.uploading=!1,s(e)})})};var _=i.onCustomEvent(s.CHAT.BOX_CAM_UPLOAD,function(e){n.box.value.getKey()==e.boxId&&n.uploadAction(e)}),I=n.box.value.getMessages(),A=n.box.value,v=n.box.value.isTagChat,S=function(e){for(var t=[],n=0,r=e.length;n<r;n++)switch(e[n].value.messageType){case 2:case 3:case 4:case 5:case 6:t.push(e[n])}return t},C=function(e){for(var t=[],n=0,r=e.length;n<r;n++)e[n].value.user.getKey()!==o.loginData.uId&&"Deleted"!==e[n].value.status&&"Played"!==e[n].value.status&&"Viewed"!==e[n].value.status&&"status_update"!==e[n].value.status&&1!=e[n].value.seenSent&&t.push(e[n]);return t},D=function(e){for(var n=[],r=0,i=e.length;r<i;r++)"Unread"!=e[r].value.status||e[r].value.timeout&&0!=e[r].value.timeout||(e[r].value.status="Received",n.push(e[r].value));t.updateMessages(n,A.getKey())},M=function(e){t.removeUnreadMessageInfoByBoxId(e)},y=i.onCustomEvent(s.CHAT.TAB_SYNC_NEW_DATA,function(e){if(T.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER==e.type&&e.boxId==A.getKey()&&angular.isArray(I)&&I.length>0){var t;if(t=C(I),t=S(t),t.length<1)return;D(I),M(e.boxId),A.updateUnreadCount(),v||a.startTimerText(n,t)}}),N=i.onCustomEvent(s.CHAT.WAS_FOCUSED,function(e){if(e&&e.box){var t=e.box,r=e.filteredMessages;t.getKey()==A.getKey()&&(t.isTagChat||a.startTimerText(n,r),d.sendData(T.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:t.getKey()}))}}),b=i.onCustomEvent(s.CHAT.DO_START_SECRET_TIMER,function(e){e&&e.boxId==p&&(e.others?a.startTimerOthers(n,e.messages):a.startTimerText(n,e.messages))}),O=function(e){e.stopPropagation();var t=n.box.value.getKey(),o=n.box.value,s=!1;o.unreadCount>0&&(M(t),o.updateUnreadCount(),s=!0),n.bottomMenuHover||n.bottomMenuButtonHover||(n.showBottomMenu=!1,s=!0),s&&i.safeDigest(n);for(var c=0;c<n.boxes.length;c++)n.boxes[c].value.isFocused=!1;if(o.isMinimized===!0?o.isFocused=!1:o.isFocused=!0,n.$broadcast("blinkerOff",t),r.$broadcast("focusOn",t),angular.isArray(I)&&I.length>0){var u;if(u=C(I),u=S(u),u.length<1)return;D(I),l.sendSeenPacket(o,u),v||a.startTimerText(n,u),d.sendData(T.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:o.getKey()})}};m.on("click",O),n.$on("$destroy",function(){i.removeCustomEvent(s.CHAT.BOX_CAM_UPLOAD,_),i.removeCustomEvent(s.CHAT.DO_START_SECRET_TIMER,b),i.removeCustomEvent(s.WAS_FOCUSED,N),i.removeCustomEvent(s.CHAT.TAB_SYNC_NEW_DATA,y)})}}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}var ChatRequests=CHAT_APP.ChatRequests;chatMessageDirective.$inject=["Auth","$compile","chatHistoryFactory","$interval","ChatHelper","Utils","userFactory","userService","SystemEvents"];function chatMessageDirective(e,t,n,r,i,o,a,s,c){return{restrict:"A",scope:!0,link:function(r,l,u){var d=r.$eval(u.messageBox);d=d.value;var g,m,f=r.$eval(u.messageMsg),E=function(){return!d.isConsicutive(f.key)};if(r.message.takeDecisionForShowingMessageUserAvator=E,r.message.showAvator=E(),f.user.isCurrentUser()){if(l.addClass("cm-box-r"),"status_update"!==f.status){g=angular.element('<img ng-show="message.showAvator" title="'+f.user.getName()+'" class="chat-img-r chat-img" src="'+f.user.avatar("thumb")+'" />');var p=t(g)(r);l.append(p)}}else if(l.addClass("cm-box"),"status_update"!==f.status){g=angular.element('<img ng-show="message.showAvator" title="'+f.user.getName()+'" class="chat-img-l chat-img" src="'+f.user.avatar("thumb")+'" />');var p=t(g)(r);l.prepend(p)}var T=function(){var e=Math.floor(f.messageDate/864e5);return d.previousDate!=e&&(d.previousDate=e,!0)};r.message.takeDecisionForShowingDate=T,r.message.showDate=T(),m=angular.element('<div class="line" ng-show="message.showDate"><div class="line-m">{{ message.messageDate | date }}</div></div><div ng-show="message.showDate" class="clear"></div>');var h=t(m)(r);l.prepend(h),r.$on("timeoutDelete",function(t,a,s){if(a===f.key)if(s>0)r.message.timeout=s;else{var l=f.user.getKey();if(l==e.loginData.uId){switch(r.message.timeout=0,r.message.secretTimedOut=!0,r.message.messageType){case 2:case 3:case 4:case 5:case 6:r.message.status="Deleted";break;case 8:r.message.status="Played";case 7:case 9:case 10:r.message.status="Viewed"}n.updateMessage(r.message,d.getKey())}else i.deleteMessageFromOwn(d,f),o.triggerCustomEvent(c.CHAT.SINGLE_MESSAGE_TIMEOUT,{box:d})}});var _=[],I=[];I.push(r.message.userId),"status_update"==r.message.status&&angular.extend(I,r.message.usersToChange),I.forEach(function(e){var t=a.getUser(e);if(!t||!t.hasDetails()){var n=s.register(e,o.debounce(function(){"status_update"==r.message.status&&r.message.refreshStatusMessageText(),r.$rgDigest()},300,!1));_.push(n)}}),r.$on("$destroy",function(){_.forEach(function(e){s.unregister(e)})})}}}chatEditMessage.$inject=["$rootScope"];function chatEditMessage(e){return{restrict:"EA",link:function(t,n,r){var i=CHAT_APP.SharedHelpers;CHAT_APP.Constants.CHAT_GLOBAL_VALUES;n.on("click",function(i){e.$broadcast("editMessageEvent",r.editMessage,t.message),n.parent().parent().parent().addClass("editing-highlight")});var o=function(e){var t=i.getClientTimeFromServerTime(e),n=Math.floor(Date.now()),r=n-t,o=36e5;return!(r>o)};t.message.canEdit=function(){return t.message.user.isCurrentUser()&&o(t.message.messageDate)&&[4,6,7,8,9,10].indexOf(t.message.messageType)===-1&&!(t.message.timeout>0||1==t.message.secretTimedOut)&&["Deleted","status_update","Viewed","Played"].indexOf(t.message.status)===-1}}}}chatRetryMessage.$inject=["ChatPacketSenderService"];function chatRetryMessage(e){return{restrict:"EA",link:function(t,n,r){n.on("click",function(n){e.retryMessage(t.box.value,t.message,t.messageData)})}}}chatDeleteMessage.$inject=["Storage","Utils","Auth","ChatConnector","ChatHelper","tagChatFactory"];function chatDeleteMessage(e,t,n,r,i,o){return{restrict:"EA",link:function(e,t,a){e.message.canDelete=function(){return["status_update"].indexOf(e.message.status)===-1},t.on("click",function(t){if(i.deleteMessageFromOwn(e.box.value,e.message),e.message.user.getKey().toString()===n.loginData.uId.toString())if(e.box.value.isTagChat){var a=e.box.value.getKey(),s=(o.getTag(a),[{packetId:e.message.key}]),c=ChatRequests.getTagChatMultipleMsgDeleteObject(a,s);r.send(c)}else if(1!=e.message.secretTimedOut||e.message.timeout>0){e.box.value.sendTabUpdate(e.message);var l=e.box.value.getKey(),s=[{packetId:e.message.key}],c=ChatRequests.getFriendChatMultipleMsgDeleteObject(l,s);r.send(c)}})}}}chatMessageReact.$inject=["Api","userFactory"];function chatMessageReact(e,t){return{restrict:"A",link:function(n,r,i){var o=n.$eval(i.chatMessageReact),a=["status_pending","status_delivered","status_seen","status_sent"],s=function(){"status_update"==o.status?r.addClass("status_update"):o.user.isCurrentUser()?r.addClass("status_received"):a[o.status]&&r.addClass(a[o.status])};angular.isObject(o.user)?s():e.user.getUserDetailsByUId({uId:o.user}).then(function(e){e&&(o.user=t.create(e),s(),Utils.safeDigest(n))})}}}sendMessageDirective.$inject=["ChatFactory","$timeout","ChatConnector","tagChatFactory","tagChatManager","$$connector","OPERATION_TYPES","ChatPacketSenderService","ChatHelper","Utils","SystemEvents","Ringalert"];function sendMessageDirective(e,t,n,r,i,o,a,s,c,l,u,d){return{restrict:"A",link:function(e,t,n){var r=CHAT_APP.Constants.GENERAL_CONSTANTS;CHAT_APP.Constants.AUTH_SERVER_ACTIONS;e.messageText="";var i=function(e){var t=0,n={startPos:0,endPos:0,selectionLength:0};if(document.selection){e.focus();var r=document.selection.createRange();r.moveStart("character",-e.value.length),t=r.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart,n.startPos=e.selectionStart,n.endPos=e.selectionEnd,n.selectionLength=Math.abs(e.selectionStart-e.selectionEnd));return n},o=function(e,t,n){e.value=e.value;var r=e.value;if(null!==e){if(e.createTextRange){var i=e.createTextRange();return e.value=r.slice(0,t.startPos)+n+r.slice(t.endPos),i.move("character",t.startPos+n.length),i.select(),!0}return e.selectionStart||0===e.selectionStart?(e.focus(),e.value=r.slice(0,t.startPos)+n+r.slice(t.endPos),e.setSelectionRange(t.startPos+n.length,t.startPos+n.length),!0):(e.focus(),!1)}};e.selectedLocation=function(){l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.key}),l.getUserLocation().then(function(t){t.sucs?(e.messageData.locationData=t,t.lat&&9999!=t.lat&&s.sendMessage(e.box.value,"",r.MESSAGE_TYPES.LOCATION_SHARE,e.messageData),e.$rgDigest()):d.show({mg:"Please Enable Browser Location Tracking."},"error"),e.resetMessageInput(!0)})},e.selectEmoticonChat=function(n){if(n.isSticker()||n.isLargeEmoticon()){e.resetMessageInput();s.sendMessage(e.box.value,n.srcWithoutBase(),6);l.triggerCustomEvent(u.CHAT.MESSAGE_SUBMITTED,{boxId:e.box.value.getKey()}),e.messageText="",l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()})}else e.messageText=e.messageText+""+n.symbol(),t[0].focus()};var a=function(){t.on("keyup",function(n){var r=function(){var t=function(){e.box.value.isTyping()===!1&&(s.sendTypingPacket(e.box.value),e.box.value.setTypingBool(!0),setTimeout(function(){e.box.value.setTypingBool(!1),l.triggerCustomEvent(u.CHAT.BOX_UPDATED,{boxId:e.box.key})},5e3))};e.box.value.isTagChat?t():e.box.value.offlineStatus===!1&&t()};if(13==n.which&&n.ctrlKey){var a=t[0],c=i(a);o(a,c,"\n"),e.messageText=a.value}if(13!==n.which||13==n.which&&n.ctrlKey)r();else{t.attr("messageKey")&&(e.box.value.editMessageKey=t.attr("messageKey"),t.removeAttr("messageKey"),e.box.value.editMessageDate=t.attr("messageDate"),t.removeAttr("messageDate"),t.removeClass("editing"),t.removeClass("editing-highlight"));var d=s.getMessageType(e.messageData);""!==e.messageText&&(e.messageText=e.messageText.replace(/^\s+|\s+$/g,""),e.messageText=e.messageText.replace(/\n\n+/g,"\n\n"),e.box.value.editMessageKey||l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.key}),s.sendMessage(e.box.value,e.messageText,d,e.messageData),e.resetMessageInput(!0),l.triggerCustomEvent(u.CHAT.MESSAGE_SUBMITTED,{boxId:e.box.key}))}})},c=function(){t.off("keyup")};a(),e.$on("$destroy",c),e.box.value.isFocused===!0&&t[0].focus(),e.$on("editMessageEvent",function(n,i,o){if(e.box.value.getKey()==i){var a=o.messageType;switch(a){case r.MESSAGE_TYPES.TEXT:e.messageText=o.text;break;case r.MESSAGE_TYPES.LOCATION_SHARE:e.locationData=o.locationInfo;break;case r.MESSAGE_TYPES.LINK_SHARE:angular.fromJson(o.text);e.messageText=o.ogData.message||o.ogData.description}t.addClass("editing"),t.attr("messageKey",o.key),t.attr("messageDate",o.messageDate),l.safeDigest(e),t[0].focus()}})}}}chatImage.$inject=["Utils","SystemEvents"];function chatImage(e,t){return{restrict:"A",link:function(n,r,i){r[0].onload=function(){n.message.scroll&&e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:i.boxid})},r[0].src=i.chatimgsrc}}}chatApp.directive("messageDirective",chatMessageDirective),chatApp.directive("editMessage",chatEditMessage),chatApp.directive("retryMessage",chatRetryMessage),chatApp.directive("deleteMessage",chatDeleteMessage),chatApp.directive("chatMessageReact",chatMessageReact),chatApp.directive("sendMessageDirective",sendMessageDirective),chatApp.directive("chatImage",chatImage);var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("setTimeout",["ChatFactory","$compile","$document",function(e,t,n){return{restrict:"EA",template:'<a><span class="img_sprite w-h-22px icon-timer-s"></span></a>',link:function(e,r,i){var o,a=function(){e.showTimeout=!0,e.closeSettingPopup(),n.bind("click",s);var i=angular.element("<set-timeout-bar ></set-timeout-bar>");o=t(i)(e),r.parent().parent().parent().next().prepend(o)},s=function(){e.showTimeout=!1,n.unbind("click",s),o&&o.remove()};e.closeTimeoutPopup=function(){s()},e.showTimeout=!1,r.on("click",function(t){e.showTimeout?s():a(),t.stopPropagation()})}}}]).directive("setTimeoutBar",["ChatFactory","$compile",function(e,t){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="enable-secret-chat">Enable Secret Chat:</span><div class="switchnew"><input class="float-left" ng-model="box.value.secretChat" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n<a href="#" ng-click="showValueBox($event)" class="img_sprite timeout-sec icon-time"><p>sec</p><span>{{ timeout>4 ? timeout : 5}}</span></a></div></div>',link:function(e,n,r){var i;e.timeout=e.box.value.timeout,e.showTimeoutBox=!1,e.cancel=function(t){e.closeTimeoutPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.showValueBox=function(r){if(e.showTimeoutBox)e.hideValueBox();else{e.showTimeoutBox=!0;var o=angular.element("<set-timeout-Value ></set-timeout-Value>");i=t(o)(e),n.children(0).append(i)}r&&(r.preventDefault(),r.stopPropagation())},e.hideValueBox=function(t){e.showTimeoutBox=!1,i&&i.remove(),t&&(t.preventDefault(),t.stopPropagation())},n.on("click",function(e){e.stopPropagation()})}}}]).directive("setTimeoutValue",["ChatFactory",function(e){return{restrict:"EA",templateUrl:"templates/partials/chat-timeout-value-box.html",link:function(e,t,n){e.selectTimeout=function(t,n){e.box.value.timeout=e.timeout=n,e.hideValueBox(t)}}}}]);var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("setting",["ChatFactory","$compile","$document",function(e,t,n){return{restrict:"EA",template:'<a><span class="img_sprite icon-g-settings"></span></a>',link:function(e,r,i){var o,a=function(){e.showSetting=!0,e.closeTimeoutPopup(),n.bind("click",s);var i=angular.element("<setting-bar ></setting-bar>");o=t(i)(e),r.parent().parent().parent().next().prepend(o)},s=function(){e.showSetting=!1,n.unbind("click",s),o&&o.remove()};e.closeSettingPopup=function(){s()},e.showSetting=!1,r.on("click",function(t){e.showSetting?s():a(),t.stopPropagation()})}}}]).directive("settingBar",["ChatFactory","$compile","profileFactory","tagChatFactory","ChatUtilsFactory","Auth","ChatConnector","PLATFORM","Ringalert",function(e,t,n,r,i,o,a,s,c){
return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="secret-visible">Timer:</span><div class="switch-secret-visible"><input class="float-left" ng-model="box.value.isSecretVisible" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n</div></div>',link:function(e,t,n){var r=(CHAT_APP.SharedHelpers,CHAT_APP.UTILS.getUUIDPacketId,o.currentUser());r.getUtId();e.cancel=function(t){e.closeSettingPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.blockUnblock=function(e){},t.on("click",function(e){e.stopPropagation()})}}}]),angular.module("ringid.chat").directive("rgTagChatList",function(){return{restrict:"E",templateUrl:"templates/partials/tag-chat/tag-chat-list.html"}}),function(e,t){"use strict";e.module("ringid.sticker",["ringid.config"])}(angular,window),angular.module("ringid.sticker").factory("StickerHelper",StickerHelper),StickerHelper.$inject=["STICKER_IMAGE_TYPE","$$stickerMap"];function StickerHelper(e,t){var n=function(n,r,i){var o={type:e.STICKER,imageList:[]},a=n.imagesList;if(angular.isArray(a)){var s=a[0].sCtId,c=i[s];o.collectionId=c.getCollectionId(),o.categoryId=s,angular.forEach(a,function(n){o.imageList.push({name:n.imUrl,type:e.STICKER,id:n.imId}),r[n.sCtId]=t.create(o)})}return r};return{parseCategoryStickerData:n}}angular.module("ringid.sticker").controller("StickerPopupController",StickerPopupController),StickerPopupController.$inject=["$boxInstance","localData","$scope","StickerFactory"];function StickerPopupController(e,t,n,r){n.stickerCategories=r.getStickerCategories(),n.stickerCollections=r.getStickerCollections(),t&&t.stickerKey&&(n.sticker=r.getStickerCategoryObject(t.stickerKey),n.$rgDigest()),n.addSticker=function(e){r.addMySticker(e.getKey()),n.$rgDigest()},n.removeSticker=function(e){r.removeMySticker(e.getKey()),n.$rgDigest()},n.isInstalled=function(e){return r.isDownloaded(e)},n.close=function(t){e.close(),t&&(t.preventDefault(),t.stopPropagation())}}angular.module("ringid.sticker").factory("StickerCategoryModel",StickerCategoryModel),StickerCategoryModel.$inject=["settings"];function StickerCategoryModel(e){return{keyString:"sCtId",getKeyString:function(){return StickerCategoryModel.keyString},create:function(t){var n={sCtId:0,sctName:"",sClId:0,cgBnrImg:"",rnk:1,dtlImg:"",thmColor:"",txtColor:"",cgNw:0,icn:"",prz:0,free:0,dcpn:""},r=function(e){var t=angular.extend({},n,e);return t};return angular.isObject(t)&&(n=r(t)),{getCategoryId:function(){return n.sCtId},setCategoryId:function(e){n.sCtId=e},getCollectionId:function(){return n.sClId},setCollectionId:function(e){n.sClId=e},getKey:function(){return this.getCategoryId()},setKey:function(e){this.setCategoryId(e)},getName:function(){return n.sctName},setName:function(e){n.sctName=e},getTextColor:function(){return n.txtColor},setTextColor:function(e){n.txtColor=e},getBannerImage:function(){return n.bnrImg},setBannerImage:function(e){n.cgBnrImg=e},getRank:function(){return n.rnk},setRank:function(e){n.rnk=e},getDetailImage:function(){return n.dtlImg},getDetailImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getDetailImage();return t},setDetailImage:function(e){n.dtlImg=e},getNewCategory:function(){return n.cgNw},setNewCategory:function(e){n.cgNw=e},getIconImage:function(){return n.icn},setIconImage:function(e){n.icn=e},getIconImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getIconImage();return t},getCaptionImageUrl:function(t){var n=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/";return t?n+"ca.png":n+"c.png"},getPrice:function(){return n.prz},setPrice:function(e){n.prz=e},isFree:function(){return n.free},setIsFree:function(e){n.free=e},getDescription:function(){return n.dcpn},setDescription:function(e){n.dcpn=e},getThumbColor:function(){return n.thmColor},setThumbColor:function(e){n.thmColor=e}}}}}angular.module("ringid.sticker").factory("StickerCollectionModel",StickerCollectionModel),StickerCollectionModel.$inject=["settings","$$stackedMap"];function StickerCollectionModel(e,t){return{create:function(t){var n={sClId:0,name:"",txtColor:"",bnrImg:"",thmColor:"",categories:[]},r=function(e){var t=angular.extend({},n,e);return t};return angular.isObject(t)&&(n=r(t)),{getId:function(){return n.sClId},setId:function(e){n.sClId=e},getKey:function(){return this.getId()},setKey:function(e){this.setId(e)},getName:function(){return n.name},setName:function(e){n.name=e},getTextColor:function(){return n.txtColor},setTextColor:function(e){n.txtColor=e},getBannerImage:function(){return n.bnrImg},setBannerImage:function(e){n.bnrImg=e},getBannerImageUrl:function(){var t=e.stickerBase+this.getId()+"/"+this.getBannerImage();return t},getThumbColor:function(){return n.thmColor},setThumbColor:function(e){n.thmColor=e},addCategories:function(e){n.categories.push(e)},removeCategories:function(e){n.categories.splice(e,1)},getCategories:function(){return n.categories}}}}}angular.module("ringid.sticker").service("stickerHttpService",stickerHttpService),stickerHttpService.$inject=["$ringhttp","$$connector","settings","OPERATION_TYPES"];function stickerHttpService(e,t,n,r){var i=r.STICKER,o=r.SYSTEM.REQUEST_TYPE,a=this;a.go=function(t,n,r){return n=n||"get",r=r||[],e[n](t,r)},a.getAll=function(){var e=n.stickerApi+"all=1";return a.go(e)},a.getStickerCategoriesByCollectionId=function(e){var t=n.stickerApi+"collectionId="+e;return a.go(t)},a.getStickersByCatId=function(e){var t=n.stickerApi+"categoryId="+e;return a.go(t)},a.getMyStickers=function(){var e={actn:i.GET_MY_STICKER};return t.request(e,o.REQUEST)},a.addSticker=function(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.ADD_JT_VALUE};return t.request(n,o.UPDATE)},a.removeSticker=function(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.REMOVE_JT_VALUE};return t.request(n,o.UPDATE)}}angular.module("ringid.sticker").factory("StickerFactory",StickerFactory).factory("$$stickerMap",$$stickerMap).factory("$$stickerImageMap",$$stickerImageMap),$$stickerImageMap.$inject=["settings","STICKER_IMAGE_TYPE"];function $$stickerImageMap(e,t){return{create:function(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};return{getKey:function(){return o.id},src:function(){return o.src},symbol:function(){return o.symbol},getName:function(){return o.name},srcWithoutBase:function(){return o.src.replace(e.stickerBase,"")},isEmoticon:function(){return o.isEmoticon},isLargeEmoticon:function(){return o.isLargeEmoticon},isSticker:function(){return o.isSticker}}}}}$$stickerMap.$inject=["$$stackedMap","$$stickerImageMap","settings"];function $$stickerMap(e,t,n){return{create:function(r,i){for(var o,a=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",s={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+a+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":a+"ca.png",installed:i||!1},c=0;c<r.imageList.length;c++)o=t.create(r.imageList[c],s.type,a),s.imageListMap.add(o.getKey(),o);return{sortBy:function(){return s.categoryId},isInstalled:function(){return s.installed},setInstalled:function(e){s.installed=e},isEmoticon:function(){return s.isEmoticon},isLargeEmoticon:function(){return s.isLargeEmoticon},isSticker:function(){return s.isSticker},getKey:function(){return s.categoryId},getImages:function(){return s.imageListMap},getType:function(){return s.type},link:function(){return s.regularUrl},hoverLink:function(){return s.hoverUrl}}}}}StickerFactory.$inject=["$$stackedMap","$$stickerMap","stickerHttpService","StickerEmoticonFactory","StickerHelper","StickerCategoryModel","StickerCollectionModel","STICKER_IMAGE_TYPE","$$q","Storage"];function StickerFactory(e,t,n,r,i,o,a,s,c,l){var u="stickerData",d="myStickers",g={},m={},f={free:[],new:[],top:[]},E={},p={},T=r.getAllEmoticons(),h=t.create(T,!0),_=!1,I=function(e){var t=c.defer();return m[e]||n.getStickersByCatId(e).success(function(e){e&&e.sucs===!0&&(i.parseCategoryStickerData(e,m,g),t.resolve(e))}).error(function(e){t.reject(e)}),t.promise};function A(e){try{var t=e.getKey();n.getStickerCategoriesByCollectionId(t).success(function(t){if(t&&t.sucs===!0&&t.categoriesList){var n=t.categoriesList;angular.isArray(n)&&angular.forEach(n,function(t){var n=t[o.getKeyString()],r=g[n];r||(r=o.create(t),g[r.getKey()]=r),e.addCategories(r.getKey())})}}).error(function(e){})}catch(e){}}function v(e){try{angular.forEach(e.freeCategoriesList,function(e){var t=o.create(e);g[t.getKey()]=t,f.free.push(t.getKey())})}catch(e){}try{angular.forEach(e.topCategoriesList,function(e){var t=o.create(e);g[t.getKey()]=t,f.top.push(t.getKey())})}catch(e){}try{angular.forEach(e.stNewCategoriesList,function(e){var t=o.create(e);g[t.getKey()]=t,f.new.push(t.getKey())})}catch(e){}try{angular.forEach(e.stickerCollectionsList,function(e){var t=a.create(e);E[t.getKey()]=t,A(t)})}catch(e){}}function S(){n.getAll().success(function(e){try{e&&e.sucs===!0&&(D(e),v(e),y())}catch(e){}}).error(function(e){})}function C(){try{return l.getData(u)}catch(e){return!1}}function D(e){l.setData(u,e)}function M(){l.setData(d,p)}function y(){p=l.getData(d),_&&p||(p={},n.getMyStickers().then(function(e){e.sucs===!0&&(angular.forEach(e.catIds,function(e){p[e]=1,m[e]&&m[e].setInstalled(!0)}),M())}))}function N(e){try{v(e)}catch(e){}}function b(e){try{return g[e]}catch(e){return{}}}return{initStickerData:function(e){if(e===!0)S();else{var t=C();angular.isObject(t)?(N(t),y()):S()}},getNoOfMyStickers:function(){return p?Object.keys(p).length:0},getStickerCategories:function(e){return e?f[e]:f},getStickerCollections:function(){return E},getMyStickerCatIds:function(){return p?Object.keys(p):[]},getStickerMapByCatId:function(e){var t=c.defer();return m[e]?t.resolve(m[e]):I(e).then(function(){t.resolve(m[e])},function(e){t.reject(e)}),t.promise},isDownloaded:function(e){return!!p[e]},getStickerCategoryObject:function(e){return b(e)},getEmoticonMap:function(){return h},getMyStickers:function(){return n.getMyStickers()},addMySticker:function(e){try{p[e]=1,M(),m[e]&&m[e].setInstalled(!0)}catch(e){}n.addSticker({catId:e}).then(function(t){t.sucs!==!0&&(p[e]=0,m[e].setInstalled(!1))},function(e){})},removeMySticker:function(e){try{delete p[e],M(),m[e]&&m[e].setInstalled(!1)}catch(e){}n.removeSticker({catId:e}).then(function(t){t.sucs!==!0&&(p[e]=1,m[e].setInstalled(!0))},function(e){})}}}angular.module("ringid.sticker").directive("rgStickerCategory",rgStickerCategory),rgStickerCategory.$inject=["StickerFactory"];function rgStickerCategory(e){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category.html",scope:{categories:"=categories"},link:function(t){t.getStickerCategory=e.getStickerCategoryObject,t.showPreview=function(e){return function(){return{stickerKey:e}}},t.isInstalled=function(t){return e.isDownloaded(t)},t.addSticker=function(n){e.addMySticker(n),t.$rgDigest()},t.removeSticker=function(n){e.removeMySticker(n),t.$rgDigest()}}}}angular.module("ringid.sticker").directive("rgStickerCategoryList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category-list.html",scope:{categories:"=categories"}}}),angular.module("ringid.sticker").directive("rgStickerCollectionList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-collection-list.html",scope:{collections:"="},link:function(e){e.currentCollectionIdToShow=0,e.shouldShowCollectionCategories=function(t){return e.currentCollectionIdToShow==t},e.showCollectionCategories=function(t){e.displayingCollections=!e.displayingCollections,e.currentCollectionIdToShow=t,e.$rgDigest()},e.displayingCollections=!0}}}),function(e,t){"use strict";e.module("ringid.controllers",["ringid.config"])}(angular,window),angular.module("ringid.controllers").controller("AlbumlistController",AlbumlistController),AlbumlistController.$inject=["APP_CONSTANTS","$scope","Media","Ringalert","OPERATION_TYPES","$$connector","$ringbox","fileUploadService"];function AlbumlistController(e,t,n,r,i,o,a,s){var c,l,u=i.SYSTEM.MEDIA,d=[],g=e;t.selectedAlbum=null,t.albumName="",t.media=t.params.media,t.selectAlbum=f,t.createAlbumPopup=m,t.existsInAlbum=function(e){return t.selectedAlbum?t.selectedAlbum.getId()===e||d.indexOf(e)>-1:d.indexOf(e)>-1},t.addToAlbum=function(){t.media&&t.selectedAlbum?t.selectedAlbum.addNewContent(t.media):t.selectedAlbum&&s.setUploadAlbum(t.selectedAlbum.getId()),t.close()},t.getAlbums=function(){return n.getAlbums(!0,c)};function m(){var e=a.open({type:"remote",resolve:{localData:{mdaT:"audio"===c?g.NEWS_FEED_MEDIA_TYPE_AUDIO:g.NEWS_FEED_MEDIA_TYPE_VIDEO}},scope:!1,controller:"AlbumCreateController",templateUrl:"templates/popups/create-album-popup.html"});e.result.then(function(e){e&&(t.selectedAlbum=e,t.$rgDigest())})}function f(e){switch(e.action){case"select":if(t.selectedAlbum&&t.selectedAlbum.getKey()===e.albumMap.getKey())break;d.indexOf(e.albumMap.getKey())>-1?t.selectedAlbum=null:t.selectedAlbum=e.albumMap}t.$rgDigest()}function E(){n.init(),l=o.subscribe(function(){setTimeout(function(){t.$rgDigest()},500)},{action:[u.ACTION_MEDIA_ALBUM_LIST]}),t.media?(c=t.media.isAudio()?"audio":"video",n.makeApiCall("mediaInAlbums",{strmURL:t.media.getStreamUrlOnly()}).then(function(e){e.sucs===!0&&(d=e.albIds,t.$rgDigest())})):c=t.params.mediaType}E(),t.$on("$destroy",function(){o.unsubscribe(l)})}angular.module("ringid.controllers").controller("AlbumCreateController",AlbumCreateController),AlbumCreateController.$inject=["$scope","Media","APP_CONSTANTS","$boxInstance","localData"];function AlbumCreateController(e,t,n,r,i){e.albumName="",e.createAlbum=function(){e.albumName.length>0&&t.createAlbum({albn:e.albumName,mdaT:i.mdaT},!0).then(function(e){e&&r.close(e)})}}angular.module("ringid.controllers").controller("RingBoxAlbumlistController",RingBoxAlbumlistController),RingBoxAlbumlistController.$inject=["$scope","$boxInstance","$controller","localData"];function RingBoxAlbumlistController(e,t,n,r){e.close=t.close,e.params=r,n("AlbumlistController",{$scope:e})}angular.module("ringid.controllers").controller("RingBoxConfirmController",RingBoxConfirmController),RingBoxConfirmController.$inject=["$scope","$boxInstance","localData"];function RingBoxConfirmController(e,t,n){e.close=r,e.params=n;function r(e){t.close(e)}}angular.module("ringid.controllers").controller("SingleImageController",SingleImageController),SingleImageController.$inject=["$scope","$routeParams","$controller","Auth"];function SingleImageController(e,t,n,r){e.params={},e.params.imgId=t.imageId,e.isReady=!1,e.currentUser=r.currentUser(),n("ImagePopupController",{$scope:e}),e.showCommentBox=!0}!function(e,t){"use strict";e.module("ringid.media",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.media").directive("rgMedia",rgMedia),rgMedia.$inject=["$window","$document","Media","$routeParams"];function rgMedia(e,t,n,r){i.$inject=["profileFactory","Auth","fileUploadService","SystemEvents","$rootScope","$scope","Media","$location","$attrs","Storage","OPERATION_TYPES","$$connector","Utils","userFactory","$$mediaAlbumMap","$$stackedMap","mapFilterFilter","$ringbox"];function i(e,t,n,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h){var _,I=d.SYSTEM.MEDIA,A=e.getProfile(r.uId||0);a.profilePage=l.inProfile,a.showMediaPreview=!1,a.activeAlbum=null,a.state=s.state,a.selectedPlaylist=p.createNew(),a.getAlbums=S,a.deleteMedia=C,a.toggleAlbumPreview=D,a.getMediaData=y,a.selectMedia=M,a.loadMoreContent=N,a.musicTab=!0,a.showAlbumContents=!1,r.albumId&&(a.showAlbumContents=!0,a.$rgDigest()),a.showDesiredTab=function(e){switch(e){case"music":a.musicTab=!0;break;case"video":a.musicTab=!1}a.$rgDigest()};function v(e,t){"false"!==a.profilePage&&("album"===t?a.state.albumsLoading=e:a.state.contentsLoading=e,a.$rgDigest())}function S(e){return"true"===a.profilePage?s.getAlbums(A.isCurrentUser(),e):s.getAlbums(!0,e)}function C(e){var t="Are you sure you want to delete?",n=h.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(t){t&&s.deleteMedia(e)})}function D(e,t){if("false"===a.profilePage){var n,r=[];switch(r.push(e.getName()),r.push(e.getContentCount()),u.setData("albumname",r),t){case"audio":n="media/"+t+"/"+e.getALbumUtId()+"/"+e.getKey(),c.path(n);break;case"video":n="media/"+t+"/"+e.getALbumUtId()+"/"+e.getKey(),c.path(n);break;default:n="media",c.path(n)}}else e?window.location=e.link(A):window.location=m.getRingRoute("USER_PROFILE",{uId:A.getUId(),utId:A.getUtId(),subpage:"media"})}function M(e,t){t?a.selectedPlaylist.add(e.getKey(),e):a.selectedPlaylist.remove(e.getKey())}function y(e,t){var n;return n=e?a.activeAlbum.getContents().all():a.selectedPlaylist.all(),t=t||n[0].value,{data:function(){return{media:t,playlist:n,popupForm:"profile"}},promise:t.fetchDetails(A)}}function N(e){(e||!a.state.contentsLoading&&a.activeAlbum&&a.activeAlbum.getContents().length()<a.activeAlbum.getContentCount())&&(v(!0),s.fetchAlbumContents({albId:a.activeAlbum.getKey(),utId:A.getUtId(),st:a.activeAlbum.getContents().length()}))}function b(){_=g.subscribe(function(e){switch(e.actn){case I.ACTION_MEDIA_ALBUM_LIST:e.utId===A.getUtId()&&setTimeout(function(){a.showMediaPreview||(a.activeAlbum=s.getAlbum(r.albumId),a.activeAlbum&&N(!0)),v(!1,"album")},2e3);break;case I.ACTION_MEDIA_ALBUM_CONTENT_LIST:s.processResponse(e),setTimeout(function(){v(!1)},1e3)}},{action:[I.ACTION_MEDIA_ALBUM_LIST,I.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),r.albumId?(a.showMediaPreview=!1,a.activeAlbum=s.getAlbum(r.albumId),a.activeAlbum&&N(!0),v(!0)):a.showMediaPreview=!0,A.isCurrentUser()||(s.fetchAllAlbums(A.getUtId()),v(!0,"album")),s.init()&&v(!0,"album")}b(),"false"===a.profilePage?a.limitItem=4:a.limitItem="Infinity",a.$on("$destroy",function(){g.unsubscribe(_),s.resetMediaAlbums()})}var o=function(n,r,i){function o(){n.showMediaPreview||e.innerHeight+e.scrollY>=t[0].body.offsetHeight&&n.loadMoreContent(!0)}e.addEventListener("scroll",o),n.$on("$destroy",function(){e.removeEventListener("scroll",o)})};return{restrict:"E",controller:i,link:o,templateUrl:function(e,t){return t.templatepath}}}angular.module("ringid.media").directive("rgMediaSearch",rgMediaSearch),rgMediaSearch.$inject=["$document","Media","$routeParams"];function rgMediaSearch(e,t,n){r.$inject=["$$stackedMap","$$mediaMap","Storage","OPERATION_TYPES","Auth","$scope","Media","userFactory","$$mediaAlbumMap","$location","rgDropdownService","$ringbox","Ringalert"];function r(e,t,n,r,i,o,a,s,c,l,u,d,g){var m=[];n.setData("albumname",m),o.medias=e.createNew(!0,"desc"),o.popupmedias=e.createNew(!0,"desc");r.SYSTEM.MEDIA;o.recentMediaDropdown="templates/dropdowns/recent-media-dropdown.html",o.searchedMedia=e.createNew(),o.trendingArr=[],o.nodatafound=!1,o.noaudiofound=!1,o.activeNav="recent";var f=i.currentUser();o.utId=f.getUtId(),a.fetchAllAlbums();function E(){for(var e=n.getData("mediaRecent"),r=0;r<e.length;r++){var i=t(e[r]);o.medias.save(i.getKey(),i)}}E(),o.getRecentMediaData=function(e){return{data:function(){return{media:e,playlist:o.medias.all()}},promise:e.fetchDetails()}},o.getTaggedMedia=function(e){a.getTaggedMedia(e)},o.goToMyAlbums=function(e){var t="media/"+e;l.path(t)},o.selectAlbum=function(e){return{data:function(){return{media:e}}}},o.actionRecentMediaDropdown=function(e){switch(e.action){case"addtoalbum":d.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:e.data.obj}},templateUrl:"templates/dropdowns/popup-album-dropdown.html"});break;case"sendtofriend":break;case"shareatringid":var t=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:e.data.obj},onBackDropClickClose:!0,templateUrl:"templates/home/share-media.html"});t.result.then(function(){o.$rgDigest()});break;case"shareatfb":break;case"download":g.show("Currently download option is available in ringID desktop and mobile app version only","info")}},o.$on("$destroy",function(){a.resetMediaAlbums()})}var i=function(e,t){t.bind("click",function(){})};return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/media-search.html"}}angular.module("ringid.media").directive("rgMediaSearchDirective",rgMediaSearchDirective),rgMediaSearchDirective.$inject=["$document","Media"];function rgMediaSearchDirective(e,t){n.$inject=["$rootScope","OPERATION_TYPES","$scope","Media","$location","rgScrollbarService","GlobalEvents"];function n(e,t,n,r,i,o,a){var s=t.SYSTEM.MEDIA;n.showDropdown=!1,n.stoploader=!1,n.showTrending=!1,n.searchResult=[],n.trendingArr=[],n.doSearch=function(){n.searchResult=[],n.stoploader=!1,n.searchParam?(n.showTrending=!1,r.fetchSearchResult(n.searchParam).then(c),n.showDropdown=!0):(n.showDropdown=!1,n.showTrending=!0)},n.doContentSearch=function(t){var r;switch(n.showDropdown=!1,t.sugt){case 1:r="/media/songs/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 2:r="/media/albums/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 3:r="/media/tags/"+t.sk,i.path(encodeURI(r)),e.$rgDigest()}},n.fetchTrendingKeyword=function(){return n.showDropdown=!0,n.trendingArr.length>0?(n.showTrending=!0,void n.$rgDigest()):void r.getSearchTrends().then(function(e){if(e.sucs===!0){for(var t=0;t<e.sgstn.length;t++){switch(e.sgstn[t].sugt){case 1:e.sgstn[t].searchtype="songs";break;case 2:e.sgstn[t].searchtype="albums";break;case 3:e.sgstn[t].searchtype="tags"}n.trendingArr.push(e.sgstn[t])}n.showTrending=!0}n.$rgDigest()})},n.hideDropdown=function(){n.showDropdown=!1,n.showTrending=!1,n.searchParam="",n.searchResult=[]},n.$on("$destroy",function(){n.trendingArr=[],n.searchResult=[]});function c(e){var t;switch(e.actn){case s.ACTION_MEDIA_SEARCH_RESULT:if(e.sucs===!0)for(n.showDropdown=!0,t=0;t<e.sgstn.length;t++)n.searchResult.push(e.sgstn[t]);else n.stoploader=!0;o.recalculate(n)}n.$rgDigest()}}var r=function(e,t){t.bind("click",function(){});var n=t.find("input");e.activeId=0,e.setActiveId=function(t){e.activeId=t},n.on("keydown",function(t){13===t.keyCode&&e.searchParam&&e.doContentSearch({sk:e.searchParam,sugt:1})}),t.on("keydown",function(t){if(13===t.keyCode){if(e.searchResult.length){var n=e.searchResult[e.activeId];e.doContentSearch({sk:n.sk,sugt:n.sugt})}}else 38===t.keyCode?(e.activeId=Math.max(e.activeId-1,0),e.$rgDigest()):40===t.keyCode&&(e.activeId=Math.min(e.activeId+1,e.searchResult.length-1),e.$rgDigest())})};return{restrict:"E",controller:n,link:r,templateUrl:"templates/mediasearch/media-search-directive.html"}}angular.module("ringid.media").directive("rgTabNav",rgTabNav),rgTabNav.$inject=["$routeParams"];function rgTabNav(e,t,n){r.$inject=["$scope","$location"];function r(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()==e}}var i=function(e,t){};return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/media.tabnav.dir.html"}}angular.module("ringid.media").directive("rgMediaSlider",rgMediaSlider),rgMediaSlider.$inject=["$document","Media","SystemEvents"];function rgMediaSlider(e,t,n){r.$inject=["$scope","Media","$$mediaAlbumMap","$$stackedMap","Storage"];function r(e,t,r,i,o){e.sliderImages=i.createNew();var a,s;t.fetchSliderImage({mdaT:1}).then(function(t){if(t.sucs===!0)for(var i=0;i<t.mediaAlbumList.length;i++)a=r.createAlbum(t.mediaAlbumList[i]),e.sliderImages.save(a.getKey(),a);e.$broadcast(n.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()}),t.fetchSliderImage({mdaT:2}).then(function(t){if(t.sucs===!0)for(var i=0;i<t.mediaAlbumList.length;i++)s=r.createAlbum(t.mediaAlbumList[i]),e.sliderImages.save(s.getKey(),s);e.$broadcast(n.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()},function(e){},function(e){}),e.setAlbumName=function(e){var t=[];t.push(e.name),t.push(e.count),o.setData("albumname",t)},e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}var i=function(e,t,r){e.showLeftArrow=!1,e.showRightArrow=!0;var i,o=t[0].querySelector(".media-slider"),a=t[0].querySelector(".photobanner"),s=1,c=!0,l=0,u=o.clientWidth;e.imageWidth=u/2,e.$rgDigest(),e.$on(n.COMMON.WINDOW_RESIZED,function(t){i&&clearTimeout(i),i=setTimeout(function(){l=1,a.style.display="none",e.$parent.$rgDigest(),c=!0,u=o.clientWidth,e.imageWidth=u/2,a.style.width=e.sliderImages.length()*e.imageWidth+"px",a.style.marginLeft="-"+(s-l)*e.imageWidth+"px",a.style.display="",e.$parent.$rgDigest()},500)}),e.$on(n.MEDIA.SLIDER_IMAGE_LOADED,function(t,n){a.style.display="none",e.$parent.$rgDigest(),a.style.width=e.sliderImages.length()*e.imageWidth+"px",a.style.display="",e.$parent.$rgDigest()}),e.right=function(){c&&(a.style.width=e.sliderImages.length()*e.imageWidth+"px",c=!1),a.style.marginLeft="-"+s*e.imageWidth+"px",s++,l=0,s>1&&(e.showLeftArrow=!0),s===e.sliderImages.length()-1&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){s--,l=0,1===s&&(e.showLeftArrow=!1),s<e.sliderImages.length()-1&&(e.showRightArrow=!0),a.style.marginLeft="-"+(s-1)*e.imageWidth+"px",e.$parent.$rgDigest()}};return{restrict:"E",controller:r,link:i,templateUrl:"templates/mediasearch/media-slider-directive.html"}}angular.module("ringid.media").controller("mSearchResultController",mSearchResultController),mSearchResultController.$inject=["Auth","Storage","userFactory","$routeParams","$$mediaAlbumMap","$$stackedMap","$$mediaMap","$scope","Media","$location","$$connector","OPERATION_TYPES"];function mSearchResultController(e,t,n,r,i,o,a,s,c,l,u,d){var g=[];t.setData("albumname",g),s.stype=r.stype,s.searchkey=decodeURI(r.sk);var m,f=d.SYSTEM.MEDIA;s.loadMoreSongs=!1,s.loadMoreAlbums=!1,s.showSearchTitle=!0;var E=[],p=[];s.searchedTagArr=[];var T=o.createNew(),h=o.createNew();switch(s.searchedSongs=function(){return T},s.searchedAlbums=function(){return h},r.stype){case"songs":m=1;break;case"albums":m=2;break;case"tags":m=3;break;default:m=1}s.showSearchDropdown=!1;e.currentUser();if(s.searchsongsection=!1,s.searchalbumsection=!1,s.searchtagsection=!1,s.noresultsection=!1,"tag"!==s.stype){var _={sk:s.searchkey,sugt:m};c.fetchContent(_)}switch(s.stype){case"songs":s.searchsongsection=!0;break;case"albums":s.searchalbumsection=!0;break;case"tags":s.searchtagsection=!0;break;case"tag":s.searchsongsection=!0,s.showSearchTitle=!1,isNaN(s.searchkey)||c.getTaggedMedia(parseInt(s.searchkey))}s.searchedTags=c.getSearchedTagArr(),s.cntntidarray=c.getContentIdArray,s.albumidarray=c.getAlbumIdArray,s.noresultfound=!1,s.loadMoreSuggestedSongs=function(){s.loadMoreSongs=!0;var e={sk:s.searchkey,sugt:m,pvtid:E.pop(),scl:2};c.fetchContent(e),c.resetContentIdArray(),s.$rgDigest()},s.loadMoreSuggestedAlbums=function(){s.loadMoreAlbums=!0;var e={sk:s.searchkey,sugt:m,pvtid:p.pop(),scl:2};c.fetchContent(e),c.resetAlbumIdArray(),s.$rgDigest()},s.getTaggedMedia=function(e){var t="media/tag/"+e.htid;l.path(encodeURI(t))},s.goToAlbum=function(e){var n;switch(g.push(e.name),g.push(e.mc),t.setData("albumname",g),e.type){case"audio":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;case"video":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;default:n="media",l.path(n)}},s.getMediaData=function(e){return{data:function(){return{media:e,playlist:[{key:e.getKey(),value:e}]}},promise:e.fetchDetails()}};var I=u.subscribe(A,{action:[f.ACTION_SPECIFIC_MEDIA_RESULT,f.ACTION_GET_TAGGED_MEDIA_SONGS]});function A(e){switch(s.loadMoreSongs=!1,s.loadMoreAlbums=!1,e.actn){case f.ACTION_SPECIFIC_MEDIA_RESULT:s.noresultfound=!1;var t;if(e.sucs===!0){10===e.tr?t=e.mdaLst.length-1:(t=e.mdaLst.length,s.noresultfound=!0);for(var n=0;n<t;n++)1===e.mdaLst[n].sugt&&(E.push(e.mdaLst[n].cntntId),e.mdaLst[n].viewtime=(new Date).getTime(),_=a(e.mdaLst[n]),T.save(_.getKey(),_)),2===e.mdaLst[n].sugt&&(p.push(e.mdaLst[n].albId),_=i.createAlbum(e.mdaLst[n]),h.save(_.getKey(),_)),3===e.mdaLst[n].sugt&&s.searchedTagArr.push(e.mdaLst[n])}else s.noresultfound=!0;break;case f.ACTION_GET_TAGGED_MEDIA_SONGS:if(s.noresultfound=!1,e.sucs===!0)for(n=0;n<e.mdaLst.length;n++)_=a(e.mdaLst[n]),T.save(_.getKey(),_);else s.noresultfound=!0}s.$rgDigest()}s.$on("$destroy",function(){u.unsubscribe(I),T.reset(),h.reset()})}angular.module("ringid.media").controller("allAlbumTypeController",allAlbumTypeController),allAlbumTypeController.$inject=["$$stackedMap","$$mediaMap","$$mediaAlbumMap","Storage","userFactory","Auth","$routeParams","OPERATION_TYPES","$scope","Media","$location","$$connector","Ringalert"];function allAlbumTypeController(e,t,n,r,i,o,a,s,c,l,u,d,g){c.albumName=r.getData("albumname")[0],c.mediaCount=r.getData("albumname")[1],c.albumtype=a.albumtype,c.utid=a.utid,c.albumid=a.albumid,c.songsArray=[],c.songs=e.createNew(),c.selectedPlaylist=e.createNew(),c.myAlbumsMap=e.createNew();var m=s.SYSTEM.MEDIA;c.userallalbum=!1,c.showSearchDropdown=!1,c.stoploader=!1,c.loadMoreSong=!1;var f;if(!a.utid&&!a.albumid){var E=o.currentUser();c.utid=E.getUtId(),"audio"===a.albumtype?f=1:"video"===a.albumtype?f=2:u.path("media"),l.fetchAllAlbums(c.utid,c.albumtype),c.userallalbum=!0}isNaN(c.utid)&&isNaN(c.albumid)&&u.path("media"),c.goToAlbum=function(e){var t,n=[];switch(n.push(e.name),n.push(e.mc),r.setData("albumname",n),e.type){case"audio":t="media/"+e.type+"/"+e.utid+"/"+e.albumid,u.path(t);break;case"video":t="media/"+e.type+"/"+e.utid+"/"+e.albumid,u.path(t);break;default:t="media",u.path(t)}},c.loadMoreMedia=function(e){c.loadMoreSong=!0,l.fetchAlbumContents({albId:c.albumid,utId:c.utid,st:e})},c.utid&&c.albumid&&(l.fetchAlbumContents({albId:c.albumid,utId:c.utid}),c.albumMap=n.createAlbum({albn:c.albumName,albId:c.albumid,utId:c.utid})),c.selectMedia=p;function p(e,t){t?c.selectedPlaylist.add(e.getKey(),e):c.selectedPlaylist.remove(e.getKey())}c.getMediaData=T;function T(e,t){var n;return n=e?c.songs.all():c.selectedPlaylist.all(),t=t||n[0].value,{data:function(){return{media:t,playlist:n}},promise:t.fetchDetails()}}c.$on("$destroy",function(){d.unsubscribe(h)});var h=d.subscribe(_,{action:[m.ACTION_MEDIA_ALBUM_CONTENT_LIST,m.ACTION_MEDIA_ALBUM_LIST]});function _(e){var r;switch(e.actn){case m.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(e.sucs===!0){for(r=0;r<e.mdaCntntLst.length;r++){e.mdaCntntLst[r].utId=c.utid;var i=t(e.mdaCntntLst[r]);c.songs.save(i.getKey(),i)}c.loadMoreSong=!1}else c.loadMoreSong=!1,c.stoploader=!0;break;case m.ACTION_MEDIA_ALBUM_LIST:if(e.sucs===!0){for(r=0;r<e.mediaAlbumList.length;r++)if(e.mediaAlbumList[r].mdaT===f){var o=n.createAlbum(e.mediaAlbumList[r]);c.myAlbumsMap.save(o.getKey(),o)}}else c.stoploader=!0}c.$rgDigest()}}angular.module("ringid.media").controller("MediaPostController",MediaPostController),MediaPostController.$inject=["$scope","$location","RING_ROUTES"];function MediaPostController(e,t,n){e.setFeed=r;function r(r){r&&r.sucs===!0&&(t.path(n.MEDIA_FEEDS),e.$rgDigest())}}!function(e,t){"use strict";e.module("ringid.newsportal",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),function(){"use strict";angular.module("ringid.newsportal").controller("portalFollowingController",e),e.$inject=["$scope","SystemEvents","$$stackedMap","$$newsPortalMap","portalHttpService","$ringbox","rgDropdownService","MESSAGES"];function e(e,t,n,r,i,o,a,s){e.portalFollowMap=n.createNew();var c,l;e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="pages/dropdowns/portal-follow-action-dropdown.html",i.getPortalFollowingList().then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.portalFollowMap.save(c.getKey(),c);l=e.portalFollowMap.length()}else e.isEmptyFollow=!0;e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e
}},promise:i.getPortalCatList(e.getKey())}},e.loadMoreFollowingPortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getPortalFollowingList(l).then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.portalFollowMap.save(c.getKey(),c);l=e.portalFollowMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.$rgDigest(),e.actionFollowingDropdown=function(t){switch(t.action){case"edit":a.close(t.event),e.$rgDigest();var n=o.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal.value},remoteData:function(){return i.getPortalCatList(t.data.portal.value.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":a.close(t.event),e.$rgDigest();var r=s.NEWSPORTAL.C_UNFOLLOW,n=o.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(n){n&&i.unFollowPortal(t.data.portal.value.getKey()).then(function(t){t.sucs===!0&&(e.portalFollowMap.remove(t.id),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()),e.$rgDigest()})})}},e.$on(t.PORTAL.UNFOLLOW_PORTAL,function(t,n){e.portalFollowMap.remove(n.id),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()}),e.$on("$destroy",function(){e.portalFollowMap.reset()})}}(),angular.module("ringid.newsportal").controller("portalDiscoverController",portalDiscoverController),portalDiscoverController.$inject=["$scope","SystemEvents","$$newsPortalMap","$$stackedMap","portalHttpService"];function portalDiscoverController(e,t,n,r,i){e.portalDiscoverMap=r.createNew(),e.searchResultMap=r.createNew();var o,a;e.searching=!1,e.nodata=!1,e.loadmore=!0,e.showloadmore=!1,e.selected=null,i.getPortalDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.portalDiscoverMap.save(o.getKey(),o);a=e.portalDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getDiscoverPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.getSearchPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.loadMorePortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getPortalDiscoverList(a).then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.portalDiscoverMap.save(o.getKey(),o);a=e.portalDiscoverMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.doSearch=function(){e.searchParam?(e.searching=!0,e.nodata=!1,e.searchResultMap.reset(),e.$rgDigest(),i.searchNewsPortal(e.searchParam).then(function(t){if(t.sucs===!0)for(var r=0;r<t.searchedcontaclist.length;r++)o=n.create(t.searchedcontaclist[r].npDTO),e.searchResultMap.save(o.getKey(),o);else e.nodata=!0;e.$rgDigest()})):(e.searching=!1,e.nodata=!1,e.$rgDigest())},e.$on(t.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r);var r=setTimeout(function(){e.searchResultMap.length()>0?(e.searchResultMap.remove(n.id),0==e.searchResultMap.length()&&(e.searchParam="",e.searching=!1,e.$rgDigest())):e.portalDiscoverMap.remove(n.id),e.selected=null,e.$rgDigest()},1e3);e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset(),e.searchResultMap.reset()})}!function(){"use strict";angular.module("ringid.newsportal").controller("portalSaveController",e),e.$inject=["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory"];function e(e,t,n,r,i){var o="newsportal_saved",a=r.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal_saved";e.pagekey=a,e.params={actn:r.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0,svd:!0},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}}(),angular.module("ringid.newsportal").controller("portalFollowController",portalFollowController),portalFollowController.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","portalHttpService","SystemEvents","$ringbox"];function portalFollowController(e,t,n,r,i,o,a,s){e.portalName=r.target.getFullName(),e.portalId=r.target.getKey();for(var c=[],l=[],u=[],d=[],g=0,m=0;m<n.nCatList.length;m++)c.push(n.nCatList[m]),d.push(n.nCatList[m].id),n.nCatList[m].subsc&&l.push(n.nCatList[m].id);if(n.nCatList.length==l.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=c,0==l.length){e.selectall=!0;for(var f=0;f<e.categoryList.length;f++)e.categoryList[f].subsc=e.selectall;l=d,e.$rgDigest()}e.selectPortalCat=function(e){var t=l.indexOf(e.id),n=u.indexOf(e.id);e.subsc?(n!==-1&&u.splice(n,1),t===-1&&l.push(e.id)):(t!==-1&&l.splice(t,1),n===-1&&u.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.portalId,l,u,g).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.PORTAL.DONE_FOLLOW_PORTAL,n),0===l.length&&t.$broadcast(a.PORTAL.UNFOLLOW_PORTAL,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){e.selectall?(g=2,l=d,u=[],e.$rgDigest()):(g=1,l=[],u=d,e.$rgDigest());for(var t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){c=[]})}angular.module("ringid.newsportal").controller("portalFollowController",portalFollowController),portalFollowController.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","portalHttpService","SystemEvents","$ringbox"];function portalFollowController(e,t,n,r,i,o,a,s){e.portalName=r.target.getFullName(),e.portalId=r.target.getKey();for(var c=[],l=[],u=[],d=[],g=0,m=0;m<n.nCatList.length;m++)c.push(n.nCatList[m]),d.push(n.nCatList[m].id),n.nCatList[m].subsc&&l.push(n.nCatList[m].id);if(n.nCatList.length==l.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=c,0==l.length){e.selectall=!0;for(var f=0;f<e.categoryList.length;f++)e.categoryList[f].subsc=e.selectall;l=d,e.$rgDigest()}e.selectPortalCat=function(e){var t=l.indexOf(e.id),n=u.indexOf(e.id);e.subsc?(n!==-1&&u.splice(n,1),t===-1&&l.push(e.id)):(t!==-1&&l.splice(t,1),n===-1&&u.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.portalId,l,u,g).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.PORTAL.DONE_FOLLOW_PORTAL,n),0===l.length&&t.$broadcast(a.PORTAL.UNFOLLOW_PORTAL,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){e.selectall?(g=2,l=d,u=[],e.$rgDigest()):(g=1,l=[],u=d,e.$rgDigest());for(var t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){c=[]})}angular.module("ringid.feed").controller("PortalProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","portalHttpService","$$newsPortalMap","SystemEvents","$ringbox",function(e,t,n,r,i,o,a,s,c,l){var u,d,g=r.uid,m=g;u="newsportal",d=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="pages/dropdowns/portal-cover-follow-action-dropdown.html",m=d+"."+g+".3",e.pagekey=m,e.action=d,e.params={actn:d,fndId:g,pType:3},e.forAdd=u,e.sortBy="at",a.getPortalShortDetails(g).then(function(t){t.sucs===!0&&(t.userDetails.npDTO.utId=t.userDetails.utId,t.userDetails.npDTO.prIm=t.userDetails.prIm,e.portalMap=s.create(t.userDetails.npDTO)),e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:a.getPortalCatList(e.getKey())}},e.actionFollowingDropdown=function(t){switch(t.action){case"edit":i.close(t.event),e.$rgDigest();l.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal},remoteData:function(){return a.getPortalCatList(t.data.portal.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":i.close(t.event),e.$rgDigest(),a.unFollowPortal(t.data.portal.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.PORTAL.UNFOLLOW_PORTAL,t),e.portalMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.portalMap.setIfSubscribed(!0),e.$rgDigest()}),t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("PortalFeedSubController",["$$feedMap","$scope","$controller","localData","$routeParams","feedFactory","Auth","SystemEvents","$location","$boxInstance","remoteData",function(e,t,n,r,i,o,a,s,c,l,u){t.feed=r.target,t.feed.setNewsPortalDescription(u.npFeedInfo.nDctn),t.$rgDigest(),t.singleFeed=!0,t.ogData={},t.currentUser=a.currentUser(),t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.imageShowMoreLength=t.feed.getTotalImage()-1,t.showCommentBox=!0,n("FeedSubController",{$scope:t}),t.$rgDigest(),l.hideLoader()}]),angular.module("ringid.newsportal").directive("rgPortalTabNav",rgPortalTabNav),rgPortalTabNav.$inject=[];function rgPortalTabNav(){e.$inject=["$scope","$location"];function e(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()==e}}var t=function(e,t){};return{restrict:"E",controller:e,link:t,templateUrl:"pages/newsportal/portal.tabnav.directive.html"}}angular.module("ringid.newsportal").directive("rgPortalSlider",rgPortalSlider),rgPortalSlider.$inject=["$document","SystemEvents","Utils"];function rgPortalSlider(e,t,n){r.$inject=["$scope","$$stackedMap","Storage","$$newsPortalMap","portalHttpService","SystemEvents","Utils"];function r(e,t,n,r,i,o,a){e.sliderImages=t.createNew(),e.showLeftArrow=!1,e.showRightArrow=!1;var s;i.getPortalDiscoverList().then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)s=r.create(t.npList[n]),e.sliderImages.save(s.getKey(),s);e.showRightArrow=!0}e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:i.getPortalCatList(e.getKey())}},e.$on(o.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){var r=e.sliderImages.get(n.id);r&&r.setIfSubscribed(!0),e.$rgDigest()}),e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}var i=function(e,r,i){var o,a=r[0].querySelector(".news_banner_wrap"),s=r[0].querySelector(".news_banner_con"),c=1,l=!0,u=0;function d(){var t=a.clientWidth;n.viewport.x>=1600&&(e.imageWidth=t/4,e.$parent.$rgDigest()),n.viewport.x>=1270&&n.viewport.x<1600&&(e.imageWidth=t/3,e.$parent.$rgDigest()),n.viewport.x>980&&n.viewport.x<1270&&(e.imageWidth=t/2,e.$parent.$rgDigest())}d(),e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(t){o&&clearTimeout(o),o=setTimeout(function(){u=1,s.style.display="none",e.$parent.$rgDigest(),l=!0,d(),s.style.width=e.sliderImages.length()*e.imageWidth+"px",s.style.marginLeft="-"+((c-u)*e.imageWidth+5*c)+"px",s.style.display="",e.$parent.$rgDigest()},500)}),e.$on(t.MEDIA.SLIDER_IMAGE_LOADED,function(t,n){s.style.display="none",e.$parent.$rgDigest(),s.style.width=e.sliderImages.length()*e.imageWidth+"px",s.style.display="",e.$parent.$rgDigest()}),e.right=function(){l&&(s.style.width=e.sliderImages.length()*e.imageWidth+"px",l=!1),s.style.marginLeft="-"+(c*e.imageWidth+5*c)+"px",c++,u=0,c>1&&(e.showLeftArrow=!0),c===e.sliderImages.length()-4&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){c--,u=0,1===c&&(e.showLeftArrow=!1),c<e.sliderImages.length()-1&&(e.showRightArrow=!0),s.style.marginLeft="-"+((c-1)*e.imageWidth+5*c)+"px",e.$parent.$rgDigest()}};return{restrict:"E",controller:r,link:i,templateUrl:"pages/newsportal/portal-slider-directive.html"}}angular.module("ringid.newsportal").directive("rgDiscoverPortal",rgDiscoverPortal),rgDiscoverPortal.$inject=[];function rgDiscoverPortal(){e.$inject=["$scope","$$stackedMap","$$newsPortalMap","portalHttpService","SystemEvents","feedFactory","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){e.portalDiscoverMap=t.createNew();var s,c;e.nodata=!1,e.selected=null,e.params={actn:a.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},r.getPortalDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)s=n.create(t.npList[r]),e.portalDiscoverMap.save(s.getKey(),s);c=e.portalDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:r.getPortalCatList(e.getKey())}},e.$on(i.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r);var r=setTimeout(function(){e.portalDiscoverMap.remove(n.id),e.selected=null,o.initFeedRequest(e.params),e.$rgDigest()},1e3);e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset()})}var t=function(e,t){};return{restrict:"E",controller:e,link:t,templateUrl:"pages/newsportal/discover.portal.directive.html"}}!function(e,t){"use strict";e.module("ringid.business",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.business").controller("FeedBusinessPortalController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="business",a=r.SYSTEM.TYPE_BUSINESS_PAGE_FEED+".business";e.pagekey=a,e.action=r.SYSTEM.TYPE_BUSINESS_PAGE_FEED,e.params={actn:r.SYSTEM.TYPE_BUSINESS_PAGE_FEED,scl:2,lmt:10,tm:0},e.isReady=!0,e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.business").controller("businessFollowController",businessFollowController),businessFollowController.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","businessHttpService","SystemEvents","$ringbox"];function businessFollowController(e,t,n,r,i,o,a,s){e.portalName=r.target.getFullName(),e.businessId=r.target.getKey();for(var c=[],l=[],u=[],d=[],g=0,m=0;m<n.nCatList.length;m++)c.push(n.nCatList[m]),d.push(n.nCatList[m].id),n.nCatList[m].subsc&&l.push(n.nCatList[m].id);if(n.nCatList.length==l.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=c,0==l.length){e.selectall=!0;for(var f=0;f<e.categoryList.length;f++)e.categoryList[f].subsc=e.selectall;l=d,e.$rgDigest()}e.selectPortalCat=function(e){var t=l.indexOf(e.id),n=u.indexOf(e.id);e.subsc?(n!==-1&&u.splice(n,1),t===-1&&l.push(e.id)):(t!==-1&&l.splice(t,1),n===-1&&u.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.businessId,l,u,g).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.BUSINESS.DONE_FOLLOW_BUSINESS,n),0===l.length&&t.$broadcast(a.BUSINESS.UNFOLLOW_BUSINESS,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){e.selectall?(g=2,l=d,u=[],e.$rgDigest()):(g=1,l=[],u=d,e.$rgDigest());for(var t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){c=[]})}angular.module("ringid.business").controller("businessDiscoverController",businessDiscoverController),businessDiscoverController.$inject=["$scope","SystemEvents","$$businessPageMap","$$stackedMap","businessHttpService"];function businessDiscoverController(e,t,n,r,i){e.businessDiscoverMap=r.createNew(),e.searchResultMap=r.createNew();var o,a;e.searching=!1,e.nodata=!1,e.loadmore=!0,e.showloadmore=!1,e.selected=null,i.getBusinessDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.businessDiscoverMap.save(o.getKey(),o);a=e.businessDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getDiscoverBusinessCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getBusinessCatList(e.getKey())}},e.getSearchBusinessCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getBusinessCatList(e.getKey())}},e.loadMorePortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getBusinessDiscoverList(a).then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.businessDiscoverMap.save(o.getKey(),o);a=e.businessDiscoverMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.doSearch=function(){e.searchParam?(e.searching=!0,e.nodata=!1,e.searchResultMap.reset(),e.$rgDigest(),i.searchBusinessPortal(e.searchParam).then(function(t){if(t.sucs===!0)for(var r=0;r<t.searchedcontaclist.length;r++)o=n.create(t.searchedcontaclist[r].npDTO),e.searchResultMap.save(o.getKey(),o);else e.nodata=!0;e.$rgDigest()})):(e.searching=!1,e.nodata=!1,e.$rgDigest())},e.$on(t.BUSINESS.DONE_FOLLOW_BUSINESS,function(t,n){e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r);var r=setTimeout(function(){e.searchResultMap.length()>0?(e.searchResultMap.remove(n.id),0==e.searchResultMap.length()&&(e.searchParam="",e.searching=!1,e.$rgDigest())):e.businessDiscoverMap.remove(n.id),e.selected=null,e.$rgDigest()},1e3);e.$rgDigest()}),e.$on("$destroy",function(){e.businessDiscoverMap.reset(),e.searchResultMap.reset()})}angular.module("ringid.newsportal").controller("businessFollowingController",businessFollowingController),businessFollowingController.$inject=["$scope","SystemEvents","$$stackedMap","$$businessPageMap","businessHttpService","$ringbox","rgDropdownService","MESSAGES"];function businessFollowingController(e,t,n,r,i,o,a,s){e.businessFollowMap=n.createNew();var c,l;e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="pages/dropdowns/portal-follow-action-dropdown.html",i.getBusinessFollowingList().then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.businessFollowMap.save(c.getKey(),c);l=e.businessFollowMap.length()}else e.isEmptyFollow=!0;e.$rgDigest()}),e.getBusinessCatList=function(e){return{data:function(){return{target:e}},promise:i.getBusinessCatList(e.getKey())}},e.loadMoreFollowingBusiness=function(){e.showloadmore=!0,e.$rgDigest(),i.getBusinessFollowingList(l).then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.businessFollowMap.save(c.getKey(),c);l=e.businessFollowMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.$rgDigest(),e.actionFollowingDropdown=function(t){switch(t.action){case"edit":a.close(t.event),e.$rgDigest();var n=o.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"businessFollowController",resolve:{localData:{target:t.data.business.value},remoteData:function(){return i.getBusinessCatList(t.data.business.value.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":a.close(t.event),e.$rgDigest();var r=s.NEWSPORTAL.C_UNFOLLOW,n=o.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(n){n&&i.unFollowBusiness(t.data.business.value.getKey()).then(function(t){t.sucs===!0&&(e.businessFollowMap.remove(t.id),e.businessFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()),e.$rgDigest()})})}},e.$on(t.BUSINESS.UNFOLLOW_BUSINESS,function(t,n){e.businessFollowMap.remove(n.id),e.businessFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()}),e.$on("$destroy",function(){e.businessFollowMap.reset()})}angular.module("ringid.business").controller("businessSaveController",businessSaveController),businessSaveController.$inject=["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory"];function businessSaveController(e,t,n,r,i){var o="business_saved",a=r.SYSTEM.TYPE_BUSINESS_PAGE_FEED+".business_saved";e.pagekey=a,e.params={actn:r.SYSTEM.TYPE_BUSINESS_PAGE_FEED,scl:2,lmt:10,tm:0,svd:!0},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}angular.module("ringid.feed").controller("businessProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","businessHttpService","$$businessPageMap","SystemEvents","$ringbox",function(e,t,n,r,i,o,a,s,c,l){var u,d,g=r.uid,m=g;u="business",d=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="pages/dropdowns/portal-cover-follow-action-dropdown.html",m=d+"."+g+".4",e.pagekey=m,e.action=d,e.params={actn:d,fndId:g,pType:4},e.forAdd=u,e.sortBy="at",a.getBusinessShortDetails(g).then(function(t){t.sucs===!0&&(t.userDetails.npDTO.utId=t.userDetails.utId,t.userDetails.npDTO.prIm=t.userDetails.prIm,e.businessMap=s.create(t.userDetails.npDTO)),e.$rgDigest()}),e.getBusinessCatList=function(e){return{data:function(){return{target:e}},promise:a.getBusinessCatList(e.getKey())}},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.actionFollowingDropdown=function(t){switch(t.action){case"edit":i.close(t.event),e.$rgDigest();l.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal},remoteData:function(){return a.getBusinessCatList(t.data.portal.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":i.close(t.event),e.$rgDigest(),a.unFollowBusiness(t.data.portal.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.BUSINESS.UNFOLLOW_BUSINESS,t),e.businessMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.BUSINESS.DONE_FOLLOW_BUSINESS,function(t,n){e.businessMap.setIfSubscribed(!0),e.$rgDigest()}),t("FeedMainController",{$scope:e})}]),angular.module("ringid.business").controller("businessFeedPopupController",["$$feedMap","$scope","$controller","localData","$routeParams","feedFactory","Auth","SystemEvents","$location","$boxInstance","remoteData",function(e,t,n,r,i,o,a,s,c,l,u){t.feed=r.target,t.feed.setNewsPortalDescription(u.npFeedInfo.nDctn),t.$rgDigest(),t.singleFeed=!0,t.ogData={},t.currentUser=a.currentUser(),t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.imageShowMoreLength=t.feed.getTotalImage()-1,t.showCommentBox=!0,n("FeedSubController",{$scope:t}),t.$rgDigest(),l.hideLoader();try{t.audio=t.feed.getAudios().all()[0].value}catch(e){t.audio=null}try{t.media=t.feed.getMedias().all()[0].value}catch(e){t.media=null}}]),angular.module("ringid.business").directive("rgBusinessTabNav",rgBusinessTabNav),rgBusinessTabNav.$inject=[];function rgBusinessTabNav(){e.$inject=["$scope","$location"];function e(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()==e}}var t=function(e,t){};return{restrict:"E",controller:e,link:t,templateUrl:"pages/business/business.tabnav.directive.html"}}angular.module("ringid.business").directive("rgBusinessSlider",rgBusinessSlider),rgBusinessSlider.$inject=["$document","SystemEvents","Utils"];function rgBusinessSlider(e,t,n){r.$inject=["$scope","$$stackedMap","$$businessPageMap","businessHttpService","SystemEvents","Utils"];function r(e,t,n,r,i,o){e.sliderImages=t.createNew(),e.showLeftArrow=!1,e.showRightArrow=!1;var a;r.getBusinessDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)a=n.create(t.npList[r]),e.sliderImages.save(a.getKey(),a);e.showRightArrow=!0}e.$rgDigest()}),e.getCatList=function(e){return{data:function(){return{target:e}},promise:r.getBusinessCatList(e.getKey())}},e.$on(i.BUSINESS.DONE_FOLLOW_BUSINESS,function(t,n){var r=e.sliderImages.get(n.id);r&&r.setIfSubscribed(!0),e.$rgDigest()}),e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}var i=function(e,r,i){var o,a=r[0].querySelector(".news_banner_wrap"),s=r[0].querySelector(".news_banner_con"),c=1,l=!0,u=0;function d(){var t=a.clientWidth;n.viewport.x>=1600&&(e.imageWidth=t/4,e.$parent.$rgDigest()),n.viewport.x>=1270&&n.viewport.x<1600&&(e.imageWidth=t/3,e.$parent.$rgDigest()),n.viewport.x>980&&n.viewport.x<1270&&(e.imageWidth=t/2,e.$parent.$rgDigest())}d(),e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(t){o&&clearTimeout(o),o=setTimeout(function(){u=1,s.style.display="none",e.$parent.$rgDigest(),l=!0,d(),s.style.width=e.sliderImages.length()*e.imageWidth+"px",s.style.marginLeft="-"+((c-u)*e.imageWidth+5*c)+"px",s.style.display="",e.$parent.$rgDigest()},500)}),e.$on(t.MEDIA.SLIDER_IMAGE_LOADED,function(t,n){s.style.display="none",e.$parent.$rgDigest(),s.style.width=e.sliderImages.length()*e.imageWidth+"px",s.style.display="",e.$parent.$rgDigest()}),e.right=function(){l&&(s.style.width=e.sliderImages.length()*e.imageWidth+"px",l=!1),s.style.marginLeft="-"+(c*e.imageWidth+5*c)+"px",c++,u=0,c>1&&(e.showLeftArrow=!0),c===e.sliderImages.length()-4&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){c--,u=0,1===c&&(e.showLeftArrow=!1),c<e.sliderImages.length()-1&&(e.showRightArrow=!0),s.style.marginLeft="-"+((c-1)*e.imageWidth+5*c)+"px",e.$parent.$rgDigest()}};return{restrict:"E",controller:r,link:i,templateUrl:"pages/business/business-slider-directive.html"}}angular.module("ringid.business").directive("rgDiscoverBusiness",rgDiscoverBusiness),rgDiscoverBusiness.$inject=[];function rgDiscoverBusiness(){e.$inject=["$scope","$$stackedMap","$$businessPageMap","businessHttpService","SystemEvents","feedFactory","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){e.businessDiscoverMap=t.createNew();var s,c;e.nodata=!1,e.selected=null,e.params={actn:a.SYSTEM.TYPE_BUSINESS_PAGE_FEED,scl:2,lmt:10,tm:0},r.getBusinessDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)s=n.create(t.npList[r]),e.businessDiscoverMap.save(s.getKey(),s);c=e.businessDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:r.getBusinessCatList(e.getKey())}},e.$on(i.BUSINESS.DONE_FOLLOW_BUSINESS,function(t,n){e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r);var r=setTimeout(function(){e.businessDiscoverMap.remove(n.id),e.selected=null,o.initFeedRequest(e.params),e.$rgDigest()},1e3);e.$rgDigest()}),e.$on("$destroy",function(){e.businessDiscoverMap.reset()})}var t=function(e,t){};return{restrict:"E",controller:e,link:t,templateUrl:"pages/business/discover.business.directive.html"}}!function(e,t){"use strict";e.module("ringid.profile",["ringid.config","ringid.digits","ringid.global_services","ringid.auth","ringid.media","ui.bootstrap","angular-svg-round-progress"])}(angular,window),angular.module("ringid.profile").service("profileHttpService",profileHttpService),profileHttpService.$inject=["$$connector","OPERATION_TYPES","Utils"];function profileHttpService(e,t,n){var r=this,i=t.SYSTEM.PROFILE,o=t.SYSTEM.REQUEST_TYPE;r.basicAndPrivacy=function(t,n){var r;return r=n?{actn:i.TYPE_ACTION_CURRENT_USER_BASICINFO}:{actn:i.TYPE_ACTION_OTHER_USER_BASICINFO,utId:t},e.request(r,o.REQUEST)},r.getUserDetails=function(t,n){var r={actn:i.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!n};return angular.extend(r,t),e.request(r,o.REQUEST,!0)},r.fetchPresenceAndMood=function(t){var n={actn:i.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:t};return e.request(n,o.REQUEST)},r.changeMood=function(t){var n={actn:i.TYPE_ACTION_USER_MOOD,mood:t};return e.request(n,o.AUTHENTICATION)},r.getMutualFriends=function(t){var n={actn:i.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:t};return e.request(n,o.REQUEST)},r.getUserProfileData=function(t){var n;return n=t?{actn:i.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS,utId:t}:{actn:i.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS},e.send(n,o.REQUEST)},r.updateProfile=function(t,n,r,a){1!==a&&(a=a.getTime());var s={actn:i.TYPE_ACTION_MODIFY_USER_PROFILE,nOfHd:7,fn:n.fn.utf8Encode(),hc:n.hc?n.hc.utf8Encode():" ",cc:n.cc?n.cc.utf8Encode():" ",gr:n.gr,am:n.am.utf8Encode(),bDay:r?r.getTime():1,mDay:a};return e.request(s,o.UPDATE)},r.updateProfilePrivacy=function(){var t={actn:i.TYPE_ACTION_MODIFY_PRIVACY_SETTINGS,pvc:[3,3,3,3,3]};return e.request(t,o.UPDATE)},r.submitNewEducation=function(t){var n={actn:i.TYPE_ACTION_ADD_EDUCATION,request_type:o.UPDATE,edu:{af:1,cntn:t.cntn?t.cntn.utf8Encode():"",desc:t.desc?t.desc.utf8Encode():"",dgr:t.dgr?t.dgr.utf8Encode():"",grtd:t.grtd,iss:t.iss,scl:t.scl.utf8Encode(),ft:t.ft?t.ft:1,tt:t.tt?t.tt:1,ut:0}};return e.request(n,o.UPDATE)},r.deleteEducation=function(t){var n={actn:i.TYPE_ACTION_REMOVE_EDUCATION,id:t};return e.request(n,o.UPDATE)},r.updateEducationById=function(t){var n={actn:i.TYPE_ACTION_UPDATE_EDUCATION,edu:{id:t.id,scl:t.scl.utf8Encode(),ft:t.ft?t.ft:1,tt:t.tt?t.tt:1,desc:t.desc?t.desc.utf8Encode():"",af:t.af,grtd:t.grtd,iss:t.iss,cntn:t.cntn?t.cntn.utf8Encode():"",dgr:t.dgr?t.dgr.utf8Encode():""}};return e.request(n,o.UPDATE)},r.getAllSkill=function(){var t={actn:230};return e.request(t,o.REQUEST)},r.submitNewSkill=function(t){var n={actn:i.TYPE_ACTION_ADD_SKILL,skill:{skl:t.skl.utf8Encode(),desc:t.desc.utf8Encode()}};return e.request(n,o.UPDATE)},r.updateSkill=function(t){var n={actn:i.TYPE_ACTION_UPDATE_SKILL,skill:{id:t.id,skl:t.skl.utf8Encode(),desc:t.desc.utf8Encode()}};return e.request(n,o.UPDATE)},r.deleteSkill=function(t){var n={actn:i.TYPE_ACTION_REMOVE_SKILL,id:t};return e.request(n,o.UPDATE)},r.submitNewWork=function(t){var n={actn:i.TYPE_ACTION_ADD_WORK,request_type:o.UPDATE,wrk:{pstn:t.pstn?t.pstn.utf8Encode():"",desc:t.desc?t.desc.utf8Encode():"",cnm:t.cnm.utf8Encode(),tt:t.tt||1,ft:t.ft||1}};return e.request(n,o.UPDATE)},r.updateWork=function(t){var n={actn:i.TYPE_ACTION_UPDATE_WORK,wrk:{id:t.id,pstn:t.pstn.utf8Encode(),cnm:t.cnm.utf8Encode(),desc:t.desc.utf8Encode(),tt:t.tt||1,ft:t.ft||1}};return e.request(n,o.UPDATE)},r.deleteWork=function(t){var n={actn:i.TYPE_ACTION_REMOVE_WORK,id:t};return e.request(n,o.UPDATE)},r.changeProfilePicture=function(t){var n={actn:i.TYPE_CHANGE_PROFILE_PIC,type:1,imT:2,pimX:t.pimX,pimY:t.pimY,ih:t.ih,iw:t.iw,iurl:t.iurl};return e.request(n,o.UPDATE)},r.changeCoverPicture=function(t){var n={actn:i.TYPE_CHANGE_COVER_PIC,type:1,imT:3,cimX:t.cimX,cimY:t.cimY,ih:t.ih,iw:t.iw,iurl:t.iurl};return e.request(n,o.UPDATE)},r.changePassword=function(t,n){var r={actn:i.CHANGE_PASSWORD,oPw:t,nPw:n};return e.request(r,o.UPDATE)},r.sendCode=function(t){var n={actn:i.SEND_VERIFICATION_CODE_TO_MAIL,el:t.email};return e.request(n,o.REQUEST)},r.verifyCode=function(t){var n={actn:i.SEND_VERIFICATION_CODE_TO_MAIL,el:t.email,vc:t.code};return e.request(n,o.REQUEST)},r.changePrivacy=function(t){var n={actn:t.utId,sn:t.sn,sv:t.sv};return t.hasOwnProperty("utId")&&(n.utId=t.utId),e.request(n,o.UPDATE,!0)},r.saveCallPvcEdit=function(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)},r.saveChatPvcEdit=function(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)},r.saveFeedPvcEdit=function(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)},r.addSocialAccount=function(t){var r={actn:i.ADD_SOCIAL_NETWORK,it:t.access_token,smid:t.id,wk:n.getUniqueID()};return"facebook"===t.platform?r.smt=4:"twitter"===t.platform&&(r.smt=5),e.request(r,o.AUTHENTICATION)},r.saveAchatSetting=function(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE)},r.saveAinfndreqSettings=function(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE)},r.saveAfamSettings=function(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE)},r.saveAafSetting=function(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE)}}angular.module("ringid.profile").directive("rgImgReposition",rgImgReposition),rgImgReposition.$inject=["imageQuality","fileUploadService","$document","APP_CONSTANTS","GlobalEvents"];function rgImgReposition(e,t,n,r,i){var o=function(e,t,n,r){if(3===arguments.length||r){if(n<e)return e;if(n>t)return t}return n};function a(e,n){var a,s,c,l,u=n[0].clientWidth,d=n[0].clientHeight,g="profilephoto"===e.imgType?r.PROFILE_PIC_CROP_WIDTH:r.COVER_PIC_CROP_WIDTH,m="profilephoto"===e.imgType?r.PROFILE_PIC_CROP_WIDTH:r.COVER_PIC_CROP_HEIGHT,f=1,E="",p=1,T=!1,h={bound:!0},_={width:0,height:0};e.selectFromAlbum=t.selectFromAlbum;function I(e){u=n[0].clientWidth;var t=Math.ceil(r.COVER_PIC_CROP_HEIGHT*u/r.COVER_PIC_CROP_WIDTH);
n[0].style.height=t+"px",d=t}"coverphoto"===e.imgType&&(I(!0),i.bindHandler("window","resize",I)),e.$watch("enabled",function(e,t){e?D():A(!1)});function A(t){t||e.enabled?(n.bind("mousedown",v),n.bind("mouseup",C)):(n.unbind("mousedown",v),n.unbind("mouseup",C)),e.$rgDigest()}function v(t){e.enabled&&(1===t.which&&(c=t.clientX,l=t.clientY,T=!0),n.bind("mousemove",S))}function S(t){var r,i,g;e.enabled&&T&&(r=e.elemStyle.backgroundPosition.match(/(-?\d+).*?\s(-?\d+)/)||[],i=t.clientX,g=t.clientY,a=parseInt(r[1])||0,s=parseInt(r[2])||0,a=o(u-_.width,0,a+i-c,h.bound),s=o(d-_.height,0,s+g-l,h.bound),n.css({backgroundPosition:a+"px "+s+"px"}))}function C(r){e.enabled&&T&&(void 0!==a&&void 0!==s&&(e.elemStyle.backgroundPosition=a+"px "+s+"px",t.setReposition({cimX:Math.ceil(Math.abs(a)/p)||0,cimY:Math.ceil(Math.abs(s)/p)||0},e.imgType)),T=!1,a=void 0,s=void 0,n.unbind("mousemove",S))}var D=function(){var t=e.elemStyle.backgroundImage;if(E=(t.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1]){var n=new Image;n.onload=M,n.src=E}};function M(){e.toggleResizeShow()(e.imgType,!1);var n=this;_.width=n.width,_.height=n.height,_.width/g<=_.height/m?(p=u/_.width,_.width=u,_.height=Math.floor(_.height*p),f=n.width/g,t.setReposition({iw:Math.ceil(n.width),ih:Math.ceil(m*f)},e.imgType)):(p=d/_.height,_.height=d,_.width=Math.floor(_.width*p),f=n.height/m,t.setReposition({ih:Math.ceil(n.height),iw:Math.ceil(g*f)},e.imgType)),A(!0)}function y(){"coverphoto"===e.imgType&&i.unbindHandler("window","resize",I),e.enabled&&(n.unbind("mousedown",v),n.unbind("mouseup",C))}e.$on("$destroy",y)}return{restrict:"A",replace:!1,scope:{elemStyle:"=",enabled:"=",imgType:"@",toggleResizeShow:"&"},link:a}}angular.module("ringid.profile").directive("rgProfile",rgProfile);function rgProfile(){e.$inject=["$ringbox","$scope","Notification","Storage","friendsFactory","$routeParams","Auth","profileFactory","fileUploadService","imageQuality","AlbumFactory","SystemEvents","Utils","Ringalert","languageConstant","$rootScope","rgDropdownService","GlobalEvents"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T){t.viewport=g.viewport;var h,_,I=o.uId;t.isOwner=a.currentUser().getKey()===I,t.consType=f.get(),t.profilePicDragEnable=!1,t.coverPicDragEnable=!1,t.processing=!1,t.profileDdControl={showOnHover:!0,enableCoverReposition:!0,enableProfileReposition:!0},t.showCoverDD=!1,t.coverPhotoStyle={backgroundSize:"cover"},t.profilePhotoStyle={backgroundSize:"cover"},t.link=g.getRingRoute("USER_PROFILE",{uId:I}),t.profileObj=s.getProfile(I),t.profileObj&&g.setPageTitle(t.profileObj.getName(),!0),void 0===o.subpage?t.subPage="post":(t.subPage=o.subpage,"about"===t.subPage&&(t.activeNav="basic")),t.subPageLink="templates/profile/profile."+t.subPage+".html",s.init(t.profileObj).then(function(){A("coverphoto"),A("profilephoto")});var A=function(e){"profilephoto"===e?(t.profilePhotoStyle.backgroundImage="url("+t.profileObj.avatar("thumb")+")",t.profilePhotoStyle.backgroundPosition="50% 50%",t.profilePhotoStyle.backgroundImage.indexOf("prof.png")>-1?t.profileDdControl.enableProfileReposition=!1:t.profileDdControl.enableProfileReposition=!0):(t.coverPhotoStyle.backgroundImage="url("+t.profileObj.getCover()+")",t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage.indexOf("default_cover")>-1?t.profileDdControl.enableCoverReposition=!1:t.profileDdControl.enableCoverReposition=!0),t.$rgDigest()};A("coverphoto"),A("profilephoto"),t.frndAction=function(e){p.close(e.event),e.friend.isLoading()||(i.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())},t.repositionExisting=!1,t.coverDdHtml="templates/dropdowns/coverphoto-dropdown.html",t.coverDdAction=function(e){switch(p.close(e.event),e.action){case"coverphoto":t.repositionExisting=!1,t.toggleResizeShow("coverphoto",!0),t.uploadAction(e);break;case"toggleReposition":t.repositionExisting=!0,t.toggleResizeShow("coverphoto",!0),t.uploadAction({action:"coverphoto",uploadFile:c.queueFile("coverphoto",t.profileObj.getCover("original"))});break;case"popupData":return c.uploadType="coverphoto",function(){return{popupType:"coverphoto"}}}t.$rgDigest()},t.profileDdHtml="templates/dropdowns/profilephoto-dropdown.html",t.frndActionTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==0 && !ddControl.isCurrentUser()" rg-click="ddAction()({ action: \'addfriend\', friend: ddControl, event:$event})" href="#"><span class="icon-addf pro-f"></span><span class="txt">{{consType.add_friend}}</span></a><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event:$event})" href="#"> <span class="img_sprite w-h-13 icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.friendshipStatus()==2" rg-click="ddAction()({ action: \'accept\', friend: ddControl, event:$event})" href="#"><span class="icon-incoming pro-f"></span><span class="txt">{{consType.accept}}</span></a><a  ng-if="ddControl.friendshipStatus()==3" rg-click="ddAction()({ action: \'remove\', friend: ddControl, event:$event})" href="#"><span class="friend-ico cancel-req"></span><span class="txt">Cancel Request</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" href="#"><span class="img_sprite w-h-13 icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" href="#"><span class="img_sprite w-h-13 icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a><a  ng-if="!ddControl.isCurrentUser()" rg-report spam-type="user" spam-id="ddControl.getUtId()"><span class="report-ico"></span><span>Report</span></a></div>',t.profileDdAction=function(e){switch(p.close(e.event),e.action){case"profilephoto":t.repositionExisting=!1,t.toggleResizeShow("profilephoto",!0),t.uploadAction(e);break;case"toggleReposition":t.toggleResizeShow("profilephoto",!0),t.repositionExisting=!0,t.uploadAction({action:"profilephoto",uploadFile:c.queueFile("profilephoto",t.profileObj.avatar("original"))});break;case"popupData":return c.uploadType="profilephoto",function(){return{popupType:"profilephoto"}}}t.$rgDigest()},t.toggleResizeShow=function(e,n){"coverphoto"===e?t.cvResizeProgressShow=n||!1:t.ppResizeProgressShow=n||!1,t.$rgDigest()},t.$on(d.IMAGE.DO_REPOSITION,function(n,r){t.toggleResizeShow(c.uploadType,!0),t.uploadAction({action:c.uploadType,uploadFile:c.queueFile(c.uploadType,r.image)}),e.closeAll()}),t.uploadAction=function(e){var n;"coverphoto"===e.action?(h=e.uploadFile,n=h):(_=e.uploadFile,n=_),n&&(E.$broadcast(d.LOADING,!0),n.fetchMeta(function(r){E.$broadcast(d.LOADING,!1),r.success?"coverphoto"===e.action?t.toggleCoverPhotoReposition(n.getPreview()):t.toggleProfilePhotoReposition(n.getPreview()):(t.toggleResizeShow(e.action,!1),m.show(r.message,"error")),t.$rgDigest()})),t.$rgDigest()},t.uploadPicture=function(e,n){var r;"coverphoto"===e?(t.cvUploadProgressShow=!0,t.coverPicDragEnable=!1,r=h):"profilephoto"===e&&(t.ppUploadProgressShow=!0,t.profilePicDragEnable=!1,r=_),E.$broadcast(d.LOADING,!0),r.initUpload().then(function(n){t.cvUploadProgressShow=!1,t.ppUploadProgressShow=!1,n.sucs===!0?"profilephoto"===e?s.changeProfilePicture(n).then(function(){E.$broadcast(d.LOADING,!1),E.$rgDigest(),A(e)}):"coverphoto"===e&&s.changeCoverPicture(n).then(function(){E.$broadcast(d.LOADING,!1),E.$rgDigest(),A(e)}):(A(e),E.$broadcast(d.LOADING,!1))},function(t){A(e)}),n&&n.stopPropagation(),t.$rgDigest()},t.toggleCoverPhotoReposition=function(e,n){var r,i="",o=t.profileObj.getCoverXY();t.coverPicDragEnable?(t.coverPicDragEnable=!1,A("coverphoto")):(e?i=e:(e=t.profileObj.getCover(),r=e.slice(e.lastIndexOf("/")+1,e.length),i=e.replace(r,r.replace("crp",""))),t.repositionExisting?t.coverPhotoStyle.backgroundPosition=-o.x+"px "+-o.y+"px":t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage="url("+i+")",t.coverPicDragEnable=!0,t.$rgDigest()),n&&n.stopPropagation()},t.$watch("profilePicDragEnable",function(e){e||t.ppUploadProgressShow||A("profilephoto")}),t.$watch("coverPicDragEnable",function(e){e||t.cvUploadProgressShow||A("coverphoto")}),t.toggleProfilePhotoReposition=function(e,n){var r,i,o="",a=t.profileObj.getAvatarXY();t.profilePicDragEnable?(t.profilePicDragEnable=!1,A("profilephoto")):(e?o=e:(e=t.profileObj.avatar("original"),r=e.slice(e.lastIndexOf("/")+1,e.length),o=e.replace(r,r.replace(i,""))),t.repositionExisting?t.profilePhotoStyle.backgroundPosition=-a.x+"px "+-a.y+"px":t.profilePhotoStyle.backgroundPosition="0px 0px",t.profilePhotoStyle.backgroundImage="url("+o+")",t.profilePicDragEnable=!0,t.$rgDigest()),n&&n.stopPropagation()},t.getImageData=function(e){return{data:function(){return{imgId:e}},promise:u.getImageDetails(e)}},t.cvUploadProgressShow=!1,t.cvResizeProgressShow=!1,t.ppResizeProgressShow=!1,t.uploadStyle=function(){return{width:c.progress+"%"}},t.roundProgressBarStyle={dataRoundProgressWidth:"200",dataRoundProgressHeight:"200",dataRoundProgressOuterCircleWidth:"4",dataRoundProgressInnerCircleWidth:"8",dataRoundProgressOuterCircleRadius:"85",dataRoundProgressInnerCircleRadius:"85",dataRoundProgressLabelFont:"24",dataRoundProgressOuterCircleBackgroundColor:"#fff",dataRoundProgressOuterCircleForegroundColor:"#f47727",dataRoundProgressInnerCircleColor:"#fff",dataRoundProgressLabelColor:"#fff"},t.ppUploadProgressShow=!1,t.uploadImageFileSize=function(){return c.currentUploadImageSize},t.getRoundedProgressTextStyle=function(){return{top:"50%",bottom:"auto",left:"50%",transform:"translateY(-50%) translateX(-50%)","font-size":100/3.5+"px",position:"absolute"}},t.roundProgressData=function(){return{label:c.progress+"%",percentage:c.progress,dataLoaded:c.dataLoaded}},t.openRingbox=function(e){return"cover"===e?!t.coverPicDragEnable&&!t.cvResizeProgressShow&&!t.cvUploadProgressShow&&t.profileDdControl.enableCoverReposition:!t.profilePicDragEnable&&!t.ppResizeProgressShow&&!t.ppUploadProgressShow&&t.profileDdControl.enableProfileReposition},t.$on(d.FILE_UPLOAD.PROGRESS_UPDATE,function(){t.$rgDigest()}),t.showMenuItems=!1,t.toggleMenuItem=function(){t.showMenuItems=!t.showMenuItems,t.$rgDigest()},t.closeDropdown=function(){t.showMenuItems=!1,t.$rgDigest()};var v;function S(){v||setTimeout(function(){t.$rgDigest(),v=!1})}function C(){T.bindHandler("window","resize",S)}C();function D(){T.unbindHandler("window","resize",S),"about"===o.subPage&&s.removeProfileData(t.profileObj.getUtId())}t.$on("$destroy",D)}var t=function(e,t){function n(t){e.showCoverDD=!e.showCoverDD,e.$rgDigest()}t.on("mouseenter",n),t.on("mouseleave",n),e.$on("$destroy",function(){t.off("mouseenter",n),t.off("mouseleave",n)})};return{restrict:"E",scope:!0,templateUrl:"templates/profile/profile-header.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileBasic",rgProfileBasic);function rgProfileBasic(){e.$inject=["Storage","$scope","Utils","profileFactory","Ringalert","$rootScope"];function e(e,t,n,r,i,o){t.isEditProfile=!1,t.processing=!1,t.enableEditBasic=a,t.updateMyBasicInfo=c,t.cancelUpdateMyBasicInfo=s;function a(e){e.preventDefault(),t.tmpBasic=angular.copy(t.profileObj.getBasicInfo()),1!==t.tmpBasic.mDay&&"1"!==t.tmpBasic.mDay||(t.tmpBasic.marriageDay=null),1!==t.tmpBasic.birthDay&&"1"!==t.tmpBasic.birthDay||(t.tmpBasic.birthday=null),t.isEditProfile=!0,t.$rgDigest()}function s(){t.isEditProfile=!1,t.$rgDigest()}function c(){t.processing=!0;var a=t.tmpBasic.marriageDay;null==a&&(a=1);var s,c=typeof t.tmpBasic.birthday,l=typeof a;if("string"===c){var u=t.tmpBasic.birthday.split("-"),d=parseInt(u[0])+","+parseInt(u[1])+","+parseInt(u[2]);s=new Date(d)}else if(s=t.tmpBasic.birthday,1!==t.tmpBasic.birthDay&&"1"!==t.tmpBasic.birthDay){var g=n.profileVerbalDate(t.tmpBasic.birthDay);t.tmpBasic.birthday=g}if("string"===l){var m=a.split("-"),f=parseInt(m[0])+","+parseInt(m[1])+","+parseInt(m[2]);a=new Date(f)}r.updateUserProfile(t.uId,t.tmpBasic,s,a).then(function(n){n.sucs===!0?(t.tmpBasic.birthDay=s?s.getTime():"1","object"==typeof s?t.currentUser.setBirthday(t.tmpBasic.birthDay):t.currentUser.setBirthday("1"),"object"===l?t.currentUser.setMarriageday(a.getTime()):t.currentUser.setMarriageday("1"),t.profileObj.getBasicInfo().birthDay=t.tmpBasic.birthDay,t.currentUser.setName(t.tmpBasic.fn),t.currentUser.setHomeCity(t.tmpBasic.hc),t.currentUser.setCurrentCity(t.tmpBasic.cc),t.currentUser.setAboutMe(t.tmpBasic.am),e.updateLoginData("fn",t.tmpBasic.fn),t.currentUser.setGender(t.tmpBasic.gr),i.show("Successfully updated","success"),t.isEditProfile=!1):(t.isEditProfile=!1,i.show(n.mg,"error")),t.processing=!1,o.$rgDigest()})}t.isDatePickerOpen=!1,t.model={},t.open=function(e,n){switch(e.preventDefault(),e.stopPropagation(),n){case"wcalendar":t.model.wcalendarTo=!1;break;case"wcalendarTo":t.model.wcalendar=!1;break;case"ecalendar":t.model.ecalendarTo=!1;break;case"ecalendarTo":t.model.ecalendar=!1;break;case"mcalendar":t.model.mcalendar=!1}t.model[n]=!t.model[n]},t.dateOptions={showWeeks:"false",startingDay:1};var l=new Date;l.setMonth(l.getMonth()+6),t.minDate=new Date,t.maxBirthDate=new Date(l.getFullYear(),l.getMonth(),l.getDate()),t.maxWeddingDate=new Date(l.getFullYear()+20,l.getMonth(),l.getDate())}return{restrict:"E",templateUrl:"templates/profile/profile.about-basic.html",controller:e}}angular.module("ringid.profile").directive("rgProfilePrivacy",rgProfilePrivacy);function rgProfilePrivacy(){e.$inject=["Auth","Storage","$timeout","$scope","friendsFactory","profileFactory","languageConstant"];function e(e,t,n,r,i,o,a){r.isEditProfilePrivacy=!1,r.callPvcEdit=!1,r.chatPvcEdit=!1,r.feedPvcEdit=!1,r.fPrivacyInfo={callPrivacy:0,chatPrivacy:0,feedPrivacy:0},r.enablePrivacyEditMode=s,r.savePvcEdit=c,r.cancelPvcEdit=l,r.profileObj.isCurrentUser()?e.fetchPrivacy().then(function(e){e.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.cla,r.fPrivacyInfo.chatPrivacy=e.chta,r.fPrivacyInfo.feedPrivacy=e.fda),r.$rgDigest()}):(r.access=r.profileObj.getAccess,r.fPrivacyInfo.callPrivacy=r.profileObj.getAccess().cla,r.fPrivacyInfo.chatPrivacy=r.profileObj.getAccess().chta,r.fPrivacyInfo.feedPrivacy=r.profileObj.getAccess().fda,r.fPrivacyInfo.callPrivacy||r.fPrivacyInfo.chatPrivacy||r.fPrivacyInfo.feedPrivacy||r.profileObj.setBlock(1),r.$rgDigest());function s(e){e.preventDefault(),r.isEditProfilePrivacy=!0,r.$rgDigest()}function c(e){var t;r.isEditProfilePrivacy=!1,t=r.profileObj.isCurrentUser()?{actn:216,sv:e.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:e.callPrivacy,sn:6,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.callPrivacy=e.callPrivacy,o.saveCallPvcEdit(t).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.callPrivacy)});var n;n=r.profileObj.isCurrentUser()?{actn:216,sv:e.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:e.chatPrivacy,sn:7,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.chatPrivacy=e.chatPrivacy,o.saveChatPvcEdit(n).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.chatPrivacy=e.chatPrivacy)});var i;i=r.profileObj.isCurrentUser()?{actn:216,sv:e.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:e.feedPrivacy,sn:8,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.feedPrivacy=e.feedPrivacy,o.saveFeedPvcEdit(i).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.feedPrivacy=e.feedPrivacy)}),r.$rgDigest()}function l(){r.isEditProfilePrivacy=!1,r.$rgDigest()}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-privacy.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileEducation",rgProfileEducation);function rgProfileEducation(){e.$inject=["Ringalert","$scope","Utils","profileFactory","$routeParams","rgDropdownService","OPERATION_TYPES","$$connector"];function e(e,t,n,r,i,o,a,s){var c,l,u=a.SYSTEM.PROFILE;t.profileObj.isCurrentUser()?t.isOwner=!0:t.isOwner=!1;r.getUserProfileData({uId:i.uId},t.profileObj.isCurrentUser()),t.getProfileData=r.getProfileData,t.educationlist=[],t.edusclerror=!1,t.edudgrerror=!1,t.educntnerror=!1,t.$watch("eduObjInfo.scl",function(e,n){e&&(t.edusclerror=!1)}),t.$watch("eduObjInfo.dgr",function(e,n){e&&(t.edudgrerror=!1)}),t.$watch("eduObjInfo.cntn",function(e,n){e&&(t.educntnerror=!1)}),t.ddActionHtml="templates/dropdowns/action-dropdown.html",t.actionEduDropdown=function(e){switch(o.close(e.event),e.action){case"edit":g(e.data.index,e.data.obj);break;case"delete":T(e.data.index,e.data.obj)}},t.isaddNewEducation=!1,t.isEditEducation=-1,t.eduObjInfo={},t.addNewEducation=d,t.submitNewEducation=p,t.updateEducation=E,t.cancelAddEducation=m,t.cancelUpdateEducation=f;function d(){c&&(t.educationlist[l]=c),t.isEditEducation=-1,t.eduObjInfo.scl="",t.eduObjInfo.dgr="",t.eduObjInfo.cntn="",t.eduObjInfo.toTimeE="",t.eduObjInfo.fromTimeE="",t.isaddNewEducation=!0,t.$rgDigest()}function g(e,n){l=e,t.eduObjInfo=t.educationlist[e],c=angular.copy(t.educationlist[e]),1===t.eduObjInfo.tt&&(t.eduObjInfo.toTimeE=null),1===t.eduObjInfo.ft&&(t.eduObjInfo.fromTimeE=null),t.isaddNewEducation=!1,t.isEditEducation=e,t.$rgDigest()}function m(){c&&(t.educationlist[l]=c),t.isaddNewEducation=!1,t.isEditEducation=-1,t.$rgDigest()}function f(){t.educationlist[l]=c,t.isEditEducation=-1,t.$rgDigest()}function E(){if(t.eduObjInfo.scl||(t.edusclerror=!0,t.$rgDigest()),t.eduObjInfo.dgr||(t.edudgrerror=!0,t.$rgDigest()),t.eduObjInfo.cntn||(t.educntnerror=!0,t.$rgDigest()),!(t.edusclerror||t.edudgrerror||t.educntnerror)){if(t.processing=!0,t.eduObjInfo.fromTimeE&&t.eduObjInfo.toTimeE){var i,o;if(i=t.eduObjInfo.fromTimeE,o=t.eduObjInfo.toTimeE,"string"==typeof i&&(i=new Date(i)),"string"==typeof o&&(o=new Date(o)),i>o)return e.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.$rgDigest()}t.eduObjInfo.fromTimeE?t.eduObjInfo.ft=new Date(t.eduObjInfo.fromTimeE).getTime():t.eduObjInfo.ft=1,t.eduObjInfo.toTimeE?t.eduObjInfo.tt=new Date(t.eduObjInfo.toTimeE).getTime():t.eduObjInfo.tt=1,r.updateEducation(t.eduObjInfo).then(function(r){r.sucs===!0?(t.eduObjInfo.fromTimeE?t.eduObjInfo.fromTimeE=n.profileVerbalDate(t.eduObjInfo.ft):(t.eduObjInfo.ft=1,t.eduObjInfo.fromTimeE=""),t.eduObjInfo.toTimeE?t.eduObjInfo.toTimeE=n.profileVerbalDate(t.eduObjInfo.tt):(t.eduObjInfo.tt=1,t.eduObjInfo.toTimeE=""),t.isEditEducation=-1,e.show("Successfully updated","success")):(t.isEditEducation=-1,e.show("Request did not process successfully","error")),t.processing=!1,t.$rgDigest()})}}function p(){if(t.eduObjInfo.scl||(t.edusclerror=!0,t.$rgDigest()),t.eduObjInfo.dgr||(t.edudgrerror=!0,t.$rgDigest()),t.eduObjInfo.cntn||(t.educntnerror=!0,t.$rgDigest()),!(t.edusclerror||t.edudgrerror||t.educntnerror)){if(t.processing=!0,t.eduObjInfo.fromTimeE&&t.eduObjInfo.toTimeE&&t.eduObjInfo.fromTimeE>t.eduObjInfo.toTimeE)return e.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.eduObjInfo.fromTimeE?t.eduObjInfo.ft=new Date(n.profileVerbalDate(t.eduObjInfo.fromTimeE)).getTime():t.eduObjInfo.ft=1,t.eduObjInfo.toTimeE?t.eduObjInfo.tt=new Date(n.profileVerbalDate(t.eduObjInfo.toTimeE)).getTime():t.eduObjInfo.tt=1,t.eduObjInfo.ut=(new Date).getTime(),t.eduObjInfo.af=1,t.eduObjInfo.grtd=!1,t.eduObjInfo.iss=!0,r.submitNewEducation(t.eduObjInfo).then(function(n){if(n.sucs===!0){t.eduObjInfo.id=n.id;var r=angular.copy(t.eduObjInfo);t.educationlist.push(r),e.show("Education info added successfully","success"),t.isaddNewEducation=!1,t.isEditEducation=-1}else e.show("Request did not process successfully","error"),t.isaddNewEducation=!1,t.isEditEducation=-1;t.isaddNewEducation=!1,t.isEditEducation=-1,t.processing=!1,t.$rgDigest()})}}function T(n,i){var o=i.id;t.isEditEducation=-1,r.deleteEducation(o).then(function(r){r.sucs===!0?(t.educationlist.splice(n,1),e.show("Successfully deleted","success")):e.show("Request did not process successfully","error"),t.$rgDigest()})}var h={};function _(e){if(e.sucs===!0){for(var r=0;r<e.educationList.length;r++){var i=e.educationList[r];h[i.id]=i}for(var o,a=Object.keys(h),s=[],c=0;c<a.length;c++)o=h[a[c]],o.fromTime=new Date(o.ft),o.toTime=new Date(o.tt),o.fromTimeE=n.profileVerbalDate(o.ft),o.toTimeE=n.profileVerbalDate(o.tt),s.push(o);t.educationlist=s}t.$rgDigest()}var I=s.subscribe(_,{action:[u.TYPE_ACTION_GET_EDUCATION]});t.$on("$destroy",function(){s.unsubscribe(I),t.educationlist=[]})}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-education.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileWork",rgProfileWork);function rgProfileWork(){e.$inject=["$scope","Utils","profileFactory","$routeParams","rgDropdownService","Ringalert","OPERATION_TYPES","$$connector"];function e(e,t,n,r,i,o,a,s){var c=a.SYSTEM.PROFILE;e.profileObj.isCurrentUser()?e.isOwner=!0:e.isOwner=!1,n.getUserProfileData({uId:r.uId},e.profileObj.isCurrentUser()),e.getProfileData=n.getProfileData,e.worklist=[],e.ddActionHtml="templates/dropdowns/action-dropdown.html",e.actionWorkDropdown=f,e.isAddNewWork=!1,e.isEditWork=-1,e.workObjInfo={};var l,u;e.addNewWork=d,e.cancelNewWork=g,e.submitNewWork=m,e.cancelUpdateWork=T,e.updateWork=p,e.workcnmerror=!1,e.workpstnerror=!1,e.$watch("workObjInfo.cnm",function(t,n){t&&(e.workcnmerror=!1)}),e.$watch("workObjInfo.pstn",function(t,n){t&&(e.workpstnerror=!1)}),e.$watch("workObjInfo.status",function(t,n){e.workObjInfo.toTimeE=""});function d(){l&&(e.worklist[u]=l),e.isEditWork=-1,e.workObjInfo.cnm="",e.workObjInfo.pstn="",e.workObjInfo.desc="",e.workObjInfo.fromTimeE="",e.workObjInfo.toTimeE="",e.workObjInfo.ft="",e.workObjInfo.tt="",e.isAddNewWork=!0,e.$rgDigest()}function g(){l&&(e.worklist[u]=l),e.isAddNewWork=!1,e.$rgDigest()}function m(){if(e.workObjInfo.cnm||(e.workcnmerror=!0,e.$rgDigest()),e.workObjInfo.pstn||(e.workpstnerror=!0,e.$rgDigest()),!e.workcnmerror&&!e.workpstnerror){if(e.processing=!0,e.workObjInfo.fromTimeE&&e.workObjInfo.toTimeE&&e.workObjInfo.fromTimeE>e.workObjInfo.toTimeE)return o.show("Your end date can't be earlier than your start date. Please try again","info"),void(e.processing=!1);e.workObjInfo.status===!0?(e.workObjInfo.tt="0",e.workObjInfo.status=!0,e.workObjInfo.date_info="Present"):e.workObjInfo.toTimeE?e.workObjInfo.tt=new Date(e.workObjInfo.toTimeE).getTime():e.workObjInfo.tt=1,e.workObjInfo.fromTimeE?e.workObjInfo.ft=new Date(e.workObjInfo.fromTimeE).getTime():e.workObjInfo.ft=1,n.submitNewWork(e.workObjInfo).then(function(n){if(n.sucs===!0){e.workObjInfo.id=n.id,e.workObjInfo.ft?e.workObjInfo.fromTimeE=t.profileVerbalDate(e.workObjInfo.ft):e.workObjInfo.ft=1,e.workObjInfo.tt?e.workObjInfo.toTimeE=t.profileVerbalDate(e.workObjInfo.tt):e.workObjInfo.tt=1;var r=angular.copy(e.workObjInfo);e.worklist.push(r),o.show("Career info added successfully","success"),e.isAddNewWork=!1,e.isEditWork=-1}else o.show("Request did not process successfully","error"),e.isAddNewWork=!1,e.isEditWork=-1;e.processing=!1,e.$rgDigest()})}}function f(e){switch(e.action){case"edit":E(e.data.index),i.close(e.event);break;case"delete":h(e.data.index,e.data.obj),i.close(e.event)}}function E(t){u=t,e.workObjInfo=e.worklist[t],l=angular.copy(e.worklist[t]),1!==e.workObjInfo.tt&&"0"!==e.workObjInfo.tt&&0!==e.workObjInfo.tt||(e.workObjInfo.toTimeE=null),1===e.workObjInfo.ft&&(e.workObjInfo.fromTimeE=null),e.isAddNewWork=!1,e.isEditWork=t,e.$rgDigest()}function p(){if(e.workObjInfo.cnm||(e.workcnmerror=!0,e.$rgDigest()),e.workObjInfo.pstn||(e.workpstnerror=!0,e.$rgDigest()),!e.workcnmerror&&!e.workpstnerror){if(e.processing=!0,e.workObjInfo.fromTimeE&&e.workObjInfo.toTimeE){var r,i;if(r=e.workObjInfo.fromTimeE,i=e.workObjInfo.toTimeE,"string"==typeof r&&(r=new Date(r)),"string"==typeof i&&(i=new Date(i)),r>i)return o.show("Your end date can't be earlier than your start date. Please try again","info"),void(e.processing=!1);e.$rgDigest()}e.workObjInfo.fromTimeE?e.workObjInfo.ft=new Date(e.workObjInfo.fromTimeE).getTime():e.workObjInfo.ft=1,e.workObjInfo.toTimeE?e.workObjInfo.tt=new Date(e.workObjInfo.toTimeE).getTime():e.workObjInfo.tt=1,e.workObjInfo.status===!0&&(e.workObjInfo.tt="0",e.workObjInfo.status=!0,e.workObjInfo.date_info="Present"),n.updateWork(e.workObjInfo).then(function(n){n.sucs===!0?(e.workObjInfo.ft?e.workObjInfo.fromTimeE=t.profileVerbalDate(e.workObjInfo.ft):e.workObjInfo.ft=1,e.workObjInfo.tt?e.workObjInfo.toTimeE=t.profileVerbalDate(e.workObjInfo.tt):e.workObjInfo.tt=1,e.workObjInfo.status===!0&&(e.workObjInfo.tt=0,e.date_info="Present"),o.show("Updated successfully","success"),e.isEditWork=-1):(e.isEditWork=-1,o.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()})}}function T(){e.worklist[u]=l,e.isEditWork=-1,e.$rgDigest()}function h(t,r){e.isEditWork=-1;var i=r.id;n.deleteWork(i).then(function(n){n.sucs===!0?(e.worklist.splice(t,1),o.show("Successfully deleted","success")):o.show("Request did not process successfully","error"),e.$rgDigest()})}var _={};function I(n){if(n.sucs===!0){for(var r=0;r<n.workList.length;r++){var i=n.workList[r];_[i.id]=i}for(var o,a=Object.keys(_),s=[],c=0;c<a.length;c++)o=_[a[c]],o.fromTime=new Date(o.ft),o.toTime=new Date(o.tt),0===o.tt?(o.status=!0,o.date_info="Present"):o.toTimeE=t.profileVerbalDate(o.tt),o.fromTimeE=t.profileVerbalDate(o.ft),s.push(o);e.worklist=s}e.$rgDigest()}var A=s.subscribe(I,{action:[c.TYPE_ACTION_GET_WORK]});e.$on("$destroy",function(){s.unsubscribe(A),e.worklist=[]})}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-work.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileSkill",rgProfileSkill);function rgProfileSkill(){e.$inject=["$scope","profileFactory","$routeParams","rgDropdownService","Ringalert","$$connector","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){var s=a.SYSTEM.PROFILE;e.skilllist=[],e.profileObj.isCurrentUser()?e.isOwner=!0:e.isOwner=!1,e.skillsklerror=!1,e.skilldescerror=!1,e.$watch("skillObjInfo.skl",function(t,n){t&&(e.skillsklerror=!1)}),e.$watch("skillObjInfo.desc",function(t,n){t&&(e.skilldescerror=!1)}),t.getUserProfileData({uId:n.uId},e.profileObj.isCurrentUser()),e.getProfileData=t.getProfileData;var c,l;e.addNewSkill=u,e.submitNewSkill=d,e.cancelNewSkill=g,e.updateSkill=m,e.cancelUpdateSkill=p,e.skillObjInfo={},e.ddActionHtml="templates/dropdowns/action-dropdown.html",e.actionSkillDropdown=function(e){switch(e.action){case"edit":E(e.data.index);break;case"delete":f(e.data.index,e.data.obj)}r.close(e.event)},e.isAddNewSkill=!1;function u(){c&&(e.skilllist[l]=c),e.isEditSkill=-1,e.skillObjInfo.skl="",e.skillObjInfo.desc="",e.isAddNewSkill=!0,e.$rgDigest()}function d(){e.skillObjInfo.desc||(e.skilldescerror=!0,e.$rgDigest()),e.skillObjInfo.skl||(e.skillsklerror=!0,e.$rgDigest()),e.skillsklerror||e.skilldescerror||(e.processing=!0,t.submitNewSkill(e.skillObjInfo).then(function(t){var n;t.sucs===!0?(e.skillObjInfo.id=t.id,n=angular.copy(e.skillObjInfo),e.skilllist.push(n),i.show("Skill info added successfully","success"),e.isAddNewSkill=!1):(e.isAddNewSkill=!1,i.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()}))}function g(){c&&(e.skilllist[l]=c),e.isAddNewSkill=!1,e.$rgDigest()}function m(){e.skillObjInfo.desc||(e.skilldescerror=!0,e.$rgDigest()),e.skillObjInfo.skl||(e.skillsklerror=!0,e.$rgDigest()),e.skillsklerror||e.skilldescerror||(e.processing=!0,t.updateSkill(e.skillObjInfo).then(function(t){t.sucs===!0?(e.isEditSkill=-1,i.show("Successfully updated","success")):(e.isEditSkill=-1,i.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()}))}function f(n,r){var o=r.id;e.isEditSkill=-1,t.deleteSkill(o).then(function(t){t.sucs===!0?(e.skilllist.splice(n,1),i.show("Successfully deleted","success")):i.show("Request did not process successfully","error"),e.$rgDigest()})}function E(t){l=t,e.skillObjInfo=e.skilllist[t],c=angular.copy(e.skilllist[t]),e.isAddNewSkill=!1,e.isEditSkill=t,e.$rgDigest()}function p(){e.skilllist[l]=c,e.isEditSkill=-1,e.$rgDigest()}var T={};function h(t){if(t.sucs===!0){for(var n=0;n<t.skillList.length;n++){var r=t.skillList[n];T[r.id]=r}for(var i,o=Object.keys(T),a=[],s=0;s<o.length;s++)i=T[o[s]],a.push(i);e.skilllist=a}e.$rgDigest()}var _=o.subscribe(h,{action:[s.TYPE_ACTION_GET_SKILL]});e.$on("$destroy",function(){o.unsubscribe(_),e.skilllist=[]})}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-skill.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfilePassword",rgProfilePassword);function rgProfilePassword(){e.$inject=["$scope","Ringalert","profileFactory"];function e(e,t,n){e.enablePassEdit=r,e.updatePassword=o,e.cancelUpdatePassword=i,e.showMessage=!0,e.showPassEdit=!1,e.IsMatch=!1,e.oldError=!1;function r(t){t.preventDefault(),e.showPassEdit===!1&&(e.showPassEdit=!0,e.showMessage=!1),e.$rgDigest()}function i(){e.showPassEdit=!1,e.showMessage=!0,e.IsMatch=!1,e.$rgDigest()}function o(r){r.newpassword!=r.repassword?e.IsMatch=!0:r.newpassword==r.repassword&&(e.IsMatch=!1,e.oldError=!1,n.changePassword(r.oldpassword,r.newpassword).then(function(n){n.sucs===!0?(r={oldpassword:"",newpassword:"",repassword:""},e.showPassEdit=!1,e.showMessage=!0,t.show("Password Changed Successfully","success")):t.show(n.mg,"info")},function(t){e.oldError=!0})),e.$rgDigest()}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-password.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileRecovery",rgProfileRecovery);function rgProfileRecovery(){e.$inject=["rgDropdownService","Api","$scope","Ringalert","profileFactory","$routeParams","Auth"];function e(e,t,n,r,i,o,a){n.emailVerified=!1,n.phoneVerified=!1,n.isAddEmail=!1,n.isAddPhone=!1,n.addEmail=l,n.isAddCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.cancelAddEmail=u,n.cancelAddPhone=d,n.sendCode=g,n.verifyCode=f,n.verifyThePhoneNum=m,n.verifierEnabled=!1,n.enableVerifier=function(){n.verifierEnabled=!0};var s,c;n.emailValue="Verify Email",n.emailTitle="Click here to verify your Email",n.phoneValue="Verify Phone",n.phoneTitle="Click here to verify your Phone",n.profileObj.isEmailVerified()&&(n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.emailVerified=!0,n.vemail=n.profileObj.getEmail()),n.profileObj.isMobileVerified()&&(n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified.",n.phoneVerified=!0,n.vnumber=n.profileObj.getMobileNumber()),n.cancelVerification=function(){n.isAddCode=!1,n.isAddPhnCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.$rgDigest()},n.resendCodeToMail=function(){i.sendCode({email:s}).then(function(e){e.sucs===!0?(s=e.el,r.show(e.mg,"info")):r.show(e.mg,"info"),n.$rgDigest()})};function l(){n.isAddEmail=!0,n.showAddEmailButton=!1,n.$rgDigest()}function u(){n.isAddEmail=!1,n.showAddEmailButton=!0,n.$rgDigest()}function d(){n.isAddPhone=!1,n.showAddPhoneButton=!0,n.$rgDigest()}function g(e){i.sendCode(e).then(function(t){t.sucs===!0?(s=t.el,n.isAddEmail=!1,n.isAddCode=!0,n.vemail="",n.emailVerified=!1,n.emailTitle="Click here to verify your Email",e.email=""):r.show(t.mg,"info"),n.$rgDigest()})}function m(e){n.verifierEnabled=!1,t.user.verifyPhoneNo(e).then(function(t){t.sucs===!0?(n.phoneNumber=e.mblDc+e.mbl,c=e.mblDc,n.vnumber=n.phoneNumber,n.phoneVerified=!0,n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified."):r.show(t.mg,"error"),n.$rgDigest()})}function f(e){e.email=s,i.verifyCode(e).then(function(t){t.sucs===!0?(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!0,n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.vemail=t.el,e.code="",e.email="",r.show(t.mg,"success")):(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!1,
n.vemail="",r.show(t.mg,"info")),n.$rgDigest()})}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-recovery.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAchat",rgProfileAchat);function rgProfileAchat(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAchat=!1,e.chatsettings={achat:n.getPermission().ancht},e.enableAchatEditMode=r,e.saveAchatSettings=i,e.cancelAchatSettings=o;function r(t){t.preventDefault(),e.isEditAchat=!0,e.$rgDigest()}function i(r){e.isEditAchat=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.achat,sn:10}),e.chatsettings.achat=r.achat,t.saveAchatSetting(i).then(function(t){t.sucs===!0?(e.chatsettings.achat=r.achat,n.setAchatPermission(r.achat)):e.chatsettings.achat=0}),e.$rgDigest()}function o(){e.isEditAchat=!1,e.$rgDigest()}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-achat.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAinfndreq",rgProfileAinfndreq);function rgProfileAinfndreq(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAinfndreq=!1,e.incomingfndreqsettings={ainfndreq:n.getPermission().aifr},e.enableAinfndreqEditMode=r,e.saveAinfndreqSettings=i,e.cancelAinfndreqSettings=o;function r(t){t.preventDefault(),e.isEditAinfndreq=!0,e.$rgDigest()}function i(r){e.isEditAinfndreq=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.ainfndreq,sn:11}),e.incomingfndreqsettings.ainfndreqobj=r.ainfndreqobj,t.saveAinfndreqSettings(i).then(function(t){t.sucs===!0?(e.incomingfndreqsettings.ainfndreq=r.ainfndreq,n.setAinfndreqPermission(r.ainfndreq)):e.incomingfndreqsettings.ainfndreq=0}),e.$rgDigest()}function o(){e.isEditAinfndreq=!1,e.$rgDigest()}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-incoming-frnd-req.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAllowaddme",rgProfileAllowaddme);function rgProfileAllowaddme(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAfam=!1,e.afamsettings={afam:n.getPermission().afam},e.enableAfamEditMode=r,e.saveAfamSettings=i,e.cancelAfamSettings=o;function r(t){t.preventDefault(),e.isEditAfam=!0,e.$rgDigest()}function i(r){e.isEditAfam=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.afam,sn:12}),e.afamsettings.afam=r.afam,t.saveAfamSettings(i).then(function(t){t.sucs===!0?(e.afamsettings.afam=r.afam,n.setAfamPermission(r.afam)):e.afamsettings.afam=0}),e.$rgDigest()}function o(){e.isEditAfam=!1,e.$rgDigest()}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-afam.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAutoaddfrnd",rgProfileAutoaddfrnd);function rgProfileAutoaddfrnd(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAaf=!1,e.aafsettings={aaf:n.getPermission().aaf},e.enableAafEditMode=r,e.saveAafSettings=i,e.cancelAafSettings=o;function r(t){t.preventDefault(),e.isEditAaf=!0,e.$rgDigest()}function i(r){e.isEditAaf=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.aaf,sn:13}),e.aafsettings.aaf=r.aaf,t.saveAafSetting(i).then(function(t){t.sucs===!0?(e.aafsettings.aaf=r.aaf,n.setAafPermission(r.aaf)):e.aafsettings.aaf=0}),e.$rgDigest()}function o(){e.isEditAaf=!1,e.$rgDigest()}}var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-aaf.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgRelocateTemplate",function(){return{restrict:"E",template:'<ng-include src="template"></ng-include>',link:function(e,t,n){var r=n.twocol,i=n.threecol;e.template=i,window.innerWidth>1800||window.innerWidth<1200&&e.template!=i?e.template=i:window.innerWidth>1200&&window.innerWidth<1800&&e.template!=r&&(e.template=r),window.onresize=function(){window.innerWidth>1800||window.innerWidth<1200&&e.template!=i?(e.template=i,e.$apply()):window.innerWidth>1200&&window.innerWidth<1800&&e.template!=r&&(e.template=r,e.$apply())}}}}),angular.module("ringid.profile").service("profileFactory",profileFactory),profileFactory.$inject=["$routeParams","Storage","Auth","$$connector","$$q","Ringalert","profileHttpService","userFactory","OPERATION_TYPES","fileUploadService","Utils"];function profileFactory(e,t,n,r,i,o,a,s,c,l,u){var d=c.SYSTEM.PROFILE,g=n.currentUser(),m={},f={};function E(e,t){var n=e;n.fromTime=new Date(n.ft),n.toTime=new Date(n.tt),n.fromTimeE=u.profileVerbalDate(n.ft),n.toTimeE=u.profileVerbalDate(n.tt),f[t].educationList.push(n)}function p(e,t){var n=e;n.fromTime=new Date(n.ft),n.toTime=new Date(n.tt),0===n.tt?(n.status=!0,n.date_info="Present"):n.toTimeE=u.profileVerbalDate(n.tt),n.fromTimeE=u.profileVerbalDate(n.ft),f[t].workList.push(n)}function T(e,t){var n=e;f[t].skillList.push(n)}function h(e,t,n){if(f.hasOwnProperty(n))switch(e){case"educationList":E(t,n);break;case"workList":p(t,n);break;case"skillList":T(t,n)}}function _(e,t){return f.hasOwnProperty(t)?f[t][e]:[]}function I(e){delete f[e]}var A=function(e){e.actn};r.subscribe(A,{action:[d.ACTION_USERS_PRESENCE_DETAILS_DATA]});function v(e){return g||(g=n.currentUser()),e===g.getKey()?g:m=s.create({uId:e})}function S(e){var t=i.defer();return a.basicAndPrivacy(e.getUtId(),e.isCurrentUser()).then(function(n){n.sucs===!0?(e.isCurrentUser()?g=s.create(angular.extend({},n,{uId:e.getKey()}),!0,!0):(m=s.create(n.userDetails,!0,!1),a.fetchPresenceAndMood(e.getKey()).then(function(e){m.updateUserObj(e)})),t.resolve()):t.reject()}),t.promise}function C(e){a.getMutualFriends(e).then(function(e){e.sucs===!0&&m.updateUserObj({nmf:e.mfIDs.length})},function(){})}function D(e,t){var n;n=t?g:s.create(e),f.hasOwnProperty(n.getUtId())||(f[n.getUtId()]={workList:[],educationList:[],skillList:[]},t?a.getUserProfileData():a.getUserProfileData(n.getUtId()))}function M(e){var n=i.defer();return e||(e={iurl:g.avatar("iurl")}),e=angular.extend({},e,l.getReposition("profilephoto")),a.changeProfilePicture(e).then(function(r){r.sucs===!0?(t.updateLoginData("prIm",e.iurl),t.updateLoginData("prImId",r.imgId),g.setProfileImage(e.iurl,r.imgId),n.resolve(r)):n.reject(r)},function(e){n.reject(e)}),n.promise}function y(e){var t=i.defer();return e||(e={iurl:g.getCover("iurl")}),e=angular.extend({},e,l.getReposition("coverphoto")),a.changeCoverPicture(e).then(function(n){n.sucs?(g.setCover(angular.extend(e,{cImId:n.imgId})),t.resolve()):t.reject()},function(e){t.reject()}),t.promise}return{init:S,getProfile:v,getMutualFriends:C,getUserProfileData:D,changeProfilePicture:M,changeCoverPicture:y,updateUserProfile:a.updateProfile,savePvcEdit:a.updateUserPrivacy,submitNewEducation:a.submitNewEducation,saveAchatSetting:a.saveAchatSetting,saveAinfndreqSettings:a.saveAinfndreqSettings,saveAfamSettings:a.saveAfamSettings,saveAafSetting:a.saveAafSetting,getProfileData:_,setProfileData:h,removeProfileData:I,deleteEducation:a.deleteEducation,getAllEducation:a.getEducationData,updateEducation:a.updateEducationById,submitNewSkill:a.submitNewSkill,updateSkill:a.updateSkill,deleteSkill:a.deleteSkill,submitNewWork:a.submitNewWork,updateWork:a.updateWork,deleteWork:a.deleteWork,changePassword:a.changePassword,verifyCheck:a.verifyCheck,sendCode:a.sendCode,verifyCode:a.verifyCode,changePrivacy:a.changePrivacy,saveCallPvcEdit:a.saveCallPvcEdit,saveChatPvcEdit:a.saveChatPvcEdit,saveFeedPvcEdit:a.saveFeedPvcEdit,moodChange:a.moodChange,addSocialAccount:a.addSocialAccount}}!function(e,t){"use strict";e.module("ringid.circle",["ringid.global_services","ringid.global_directives","ringid.shared"])}(angular,window),angular.module("ringid.circle").controller("CirclePopupController",CirclePopupController),CirclePopupController.$inject=["$scope","$rootScope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","Ringalert","Auth","rgScrollbarService","$location","SystemEvents"];function CirclePopupController(e,t,n,r,i,o,a,s,c,l,u,d){e.circleAddMode=!1,e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleNameSection=!0,e.circleMemberSection=!1,e.circleAdminSection=!1,e.friendDropdown=!1,e.$watch("friendsNameFilter",function(t,n){t?e.friendDropdown=!0:e.friendDropdown=!1}),e.closeFriendDd=function(){e.friendDropdown=!1,e.$rgDigest()},e.friendlistNameFilter="",e.memberfilter="",e.nextPart=function(t){switch(t){case"setname":e.circleNameSection=!0,e.circleMemberSection=!1,e.circleAdminSection=!1,e.$rgDigest();break;case"setmembers":e.circleNameSection=!1,e.circleMemberSection=!0,e.circleAdminSection=!1,e.$rgDigest();break;case"setadmins":e.circleNameSection=!1,e.circleMemberSection=!1,e.circleAdminSection=!0,e.$rgDigest()}},e.$on("$destroy",function(){e.friendlist.reset(),e.selectedMembers=[]}),e.friendlist=i.getFriends("friends"),e.models={errCircleName:!1,errMemberList:!1,errAdminList:!1},a.circleId||(e.circleAddMode=!0),e.editMode=!1,a&&a.circleId?(e.circle=n.getCircle(a.circleId),e.memberList=e.circle.getMembers(),e.adminList=e.circle.getAdmins(),e.isCurrentUserSuperAdmin=e.circle.isSuperAdmin(c.currentUser().getKey()),e.models.popupTitle="Edit Group",e.models.circleName=e.circle.getName(),e.editMode=!0):(e.models.popupTitle="Create New Circle",e.models.circleName="",e.memberList=o.createNew(),e.adminList=o.createNew()),e.addToCircle=f,e.addToAdmin=p,e.removeMember=E,e.removeAdmin=T,e.createCircle=g,e.updateCircle=m,e.close=r.close,e.validateCircle=I,e.loadMoreFriends=_;function g(){for(var t=(e.memberList.keys(),e.adminList.keys(),[]),i=0;i<e.memberList.length();i++)t[i]={admin:"false",uId:e.memberList.all()[i].value.user.uId};for(var o=[],a=0;a<e.adminList.length();a++)o[a]={admin:"true",uId:e.adminList.all()[a].value.user.uId};var s=o.concat(t),l={tg:e.models.circleName,alluser:s,uId:c.currentUser().getUId()};n.createCircle(l).then(function(e){e.sucs===!0&&(r.closeAll(),u.path("/circle/"+e.grpId))})}function m(){if(I()){var t=e.memberList.keys(),r=e.adminList.keys(),i=e.circle.getMemberIds(),o=e.circle.getAdminIds(),a=t.difference(i),c=i.difference(t),l=r.difference(o),u=o.difference(r),d=[];angular.forEach(a,function(e){d.push({admin:!1,uId:e})}),angular.forEach(l,function(e){d.push({admin:!0,uId:e})}),d.length>0&&n.addMembers(d,e.circle);var g=c;g=g.concat(u),g.length>0&&n.removeMembers(g,e.circle),s.show("Circle Updated","success"),e.close()}}function f(t){e.memberList.add(t.getKey(),t),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function E(t){e.memberList.remove(t.getKey()),e.$rgDigest()}function p(t){e.adminList.add(t.getKey(),t),e.memberList.remove(t.getKey()),e.$rgDigest()}function T(t){e.adminList.remove(t.getKey()),e.memberList.add(t.getKey(),t),e.$rgDigest()}function h(t){e.state.loading=t,t||l.recalculate(e),e.$$phase||e.$root.$$phase||e.$digest()}e.$watch("friendName",function(t){t&&t.length>1?(h(!0),i.searchContact({schPm:t},!0).then(function(){e.friendlist=i.getFriends("friends"),h(!1),e.$rgDigest()},function(){h(!1),e.$rgDigest()})):(e.friendlist=i.getFriends("friends").copy(),e.$rgDigest())});function _(){e.state.loading||e.friendlist.length()===i.totalFriends("friends")||(h(!0),i.getContactDetails().then(function(){e.friendlist=i.getFriends("friends"),h(!1)},function(){h(!1)}),setTimeout(function(){e.state.loading=!1},3e3),e.$rgDigest())}function I(){return e.models.circleName.length>60?e.models.errCircleName="Maximum 60 characters":0===e.models.circleName.length?e.models.errCircleName="Name required":e.models.errCircleName="",e.models.errMemberList=e.memberList.length()<1,0===e.models.errCircleName.length&&!e.models.errMemberList}}angular.module("ringid.circle").controller("circleEditPopupController",circleEditPopupController),circleEditPopupController.$inject=["$scope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","remoteData","Ringalert","SystemEvents"];function circleEditPopupController(e,t,n,r,i,o,a,s,c){e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleMemberSection=!1,e.friendDropdown=!1,e.$watch("friendsNameFilter",function(t,n){t?e.friendDropdown=!0:e.friendDropdown=!1}),e.closeFriendDd=function(){e.friendDropdown=!1,e.$rgDigest()},e.friendsNameFilter="",e.memberfilter="",e.$on("$destroy",function(){e.friendlist.reset(),e.selectedMembers=[]}),e.friendlist=r.getFriends("friends").copy(),e.memberList=i.createNew(),e.addToCircle=u,e.removeMember=d,e.updateCircle=l,e.close=n.close;function l(){for(var n=[],r=0;r<e.memberList.length();r++)n[r]={admin:"false",uId:e.memberList.all()[r].value.user.uId};t.addMembers(n,o.target).then(function(n){n.sucs===!0?t.getSingleCircleInfo(o.target,o.circleObj):(s.show(n.mg,"error"),e.$rgDigest()),e.close()})}function u(t){e.memberList.add(t.getUtId(),t),e.selectedMembers.push(t),e.friendlist.remove(t.getUtId()),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function d(t){e.memberList.remove(t.getUtId()),e.$rgDigest()}}angular.module("ringid.circle").controller("CirclePageController",CirclePageController),CirclePageController.$inject=["$scope","$routeParams","$location","circlesManager","friendsFactory","Auth","$ringbox","SystemEvents","$$connector","OPERATION_TYPES","circleHttpService","$timeout","APP_CONSTANTS","Ringalert","rgDropdownService","$rootScope","Utils"];function CirclePageController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){var T=this,h=t.circleId,_=t.subpage;e.loadMoreCircleMember=!1,e.showSearchLoader=!1,e.hideLoadButton=!1,e.currentUserUId=o.currentUser().getUId(),r.getCirclePromise(h).then(function(t){t?(T.circle=t,p.setPageTitle(t.getName(),!0),e.isCurrentUserAdmin=T.circle.isAdmin(),e.isCurrentUserSuperAdmin=T.circle.isSuperAdmin(e.currentUserUId),"members"===_&&(e.showBackKey=0,e.showBack=function(t,n){var r=n.target.getAttribute("data-is-anchor");r||(e.showBackKey=t,n.preventDefault(),n.stopPropagation(),e.$rgDigest())},S()),I()):r.redirectHome()},function(e){r.redirectHome()}),e.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),m.show("Coming soon","info")},T.ddHtml="templates/dropdowns/circle-edit-dropdown.html",T.ddAction=M,T.ddControl={isAdmin:e.isCurrentUserAdmin,isSuperAdmin:e.isCurrentUserSuperAdmin,getCircleData:function(){return f.close(),{circleId:h}}},T.ddMemberHtml="templates/dropdowns/circle-member-dropdown.html",T.ddMemberAction=D,T.removeMember=C,angular.isUndefined(t.subpage)?T.subPage="post":T.subPage=t.subpage,T.subPageLink="templates/home/circle."+T.subPage+".html",T.isCurrentUserAdmin=!1,T.isCurrentUserSuperAdmin=!1,T.getFriendType=function(e){return e.friendshipStatus()},T.circle?(e.isPageReady=!1,e.circleMembers.length||S()):e.isPageReady=!1,T.shouldShowMemberEditMenu=function(e){return!e.isCurrentUser()&&(T.isCurrentUserSuperAdmin||T.isCurrentUserAdmin&&!e.isAdmin(h))&&!T.circle.isSuperAdmin(e.getKey())},T.memberListSubscriptionKey=c.subscribe(r.processCircleMembersData,{action:l.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_LIST}),T.searchListSubscriptionKey=c.subscribe(r.processCircleSearchMembersData,{action:l.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_SEARCH_RESULT}),e.$on(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,function(t,n){e.loadMoreCircleMember=!1,e.showSearchLoader=!1,n.success?e.hideLoadButton=!1:e.hideLoadButton=!0,I(),e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT,function(t,n){e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,function(){v(),e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_REMOVED,function(e,r){r.circleId===t.circleId&&(m.show("Circle has been Removed OR You have been removed from the circle.","error"),d(function(){n.path("/")}))}),e.cMemberSearch=function(){T.searchParam?(e.showSearchLoader=!0,r.getMemberResult(T.searchParam,h)):e.hideLoadButton=!1,e.$rgDigest()},e.loadMoreMembers=function(){if(T.searchParam)e.showSearchLoader=!0,r.getMemberResult(T.searchParam,h);else{var t=20;e.loadMoreCircleMember=!0,r.getCircleMembers(h,null,t)}e.$rgDigest()},e.getCircleId=function(){return{data:function(){return{target:h,circleObj:T.circle}}}},e.$on("$destroy",function(){T.circle&&T.circle.resetMembers(),c.unsubscribe(T.memberListSubscriptionKey),c.unsubscribe(T.searchListSubscriptionKey)});function I(){T.circle&&(e.isPageReady=!0,v(),A()),e.$rgDigest()}function A(){T.isCurrentUserAdmin=e.currentUser.isAdmin(T.circle.getKey()),T.isCurrentUserSuperAdmin=T.circle.isSuperAdmin(o.currentUser().getKey()),T.ddControl.isAdmin=T.isCurrentUserAdmin,T.ddControl.isSuperAdmin=T.isCurrentUserSuperAdmin}function v(){e.circleMembers=T.circle.getAllMembers(),e.$rgDigest()}function S(){r.getCircleMembers(h,0)}function C(e){r.removeMember(e,T.circle)}function D(t){switch(f.close(t.event),t.action){case"remove":r.removeMember(t.member.getKey(),T.circle);break;case"changemember":r.toggleMembership({grpId:T.circle.getKey(),uId:t.member.getKey(),admin:Boolean(t.admin)},T.circle);break;case"addfriend":case"accept":case"reject":t.friend.isLoading()||i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()})}e.$rgDigest()}function M(e){var t="Are you sure you want to "+e.action+" "+T.circle.getName()+"?";f.close(e.event);var n=a.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(t){t&&y(e)})}function y(t){switch(t.action){case"delete":r.deleteCircle(T.circle).then(function(t){t.sucs===!0?n.path("/"):e.$rgDigest()},function(t){e.$rgDigest()});break;case"leave":r.leaveGroup(T.circle).then(function(t){t.sucs===!0&&(n.path("/"),E.$rgDigest()),e.$rgDigest()},function(t){e.$rgDigest()})}}}angular.module("ringid.circle").controller("allCirclePopupController",allCirclePopupController),allCirclePopupController.$inject=["$scope","OPERATION_TYPES","$$connector","circlesManager","rgScrollbarService"];function allCirclePopupController(e,t,n,r,i){var o;r.init(),e.getCircles=a;function a(e){return"true"===e||e===!0?r.getCircles(!0):r.getCircles(!1)}var s=n.subscribe(function(){o||(o=setTimeout(function(){clearTimeout(o),i.recalculate(e),e.$rgDigest()}))},{action:[t.SYSTEM.CIRCLE.TYPE_GROUP_LIST]});e.$on("$destroy",function(){n.unsubscribe(s)})}!function(e,t){"use strict";e.module("ringid",["ngRoute","ringid.config","ui-notification","ringid.language","ringid.connector","ringid.global_services","ringid.global_directives","ringid.auth","ringid.filters","ringid.shared","ringid.utils","ringid.directives","ringid.header","ringid.friend","ringid.directives","ringid.controllers","ringid.feed","ringid.sticker","ringid.profile","ringid.circle","ringid.chat","ringid.newsportal","ringid.business","oc.lazyLoad"])}(angular,window);var app;app=angular.module("ringid").controller("ApplicationController",ApplicationController),ApplicationController.$inject=["SystemEvents","$scope","$rootScope","$$connector","Storage","Auth","OPERATION_TYPES","ChatConnector"];function ApplicationController(e,t,n,r,i,o,a,s){var c=a.SYSTEM.AUTH,l=!0;t.openSignIn=function(){return{data:function(){return{fromPopup:!0}}}},t.activePath=null,t.currentUser=o.currentUser(),t.templatePath="templates/index-login.html",t.isLoggedIn=!1,t.isPending=function(){return l},t.showFriendsBar=!1,t.toggleFriendsBar=function(){t.showFriendsBar=!t.showFriendsBar,t.$rgDigest()};function u(){t.isLoggedIn=o.isLoggedIn(),r.init(),t.isLoggedIn?(t.currentUser=o.currentUser(),t.templatePath="templates/index-dashboard.html",r.resume(),r.keepAlive(),s.sendGlobal("uId",o.currentUser().getKey())):t.templatePath="templates/index-login.html",t.$rgDigest(),setTimeout(function(){l=!1,t.$rgDigest()})}t.$on(e.AUTH.LOGIN,function(){u()}),t.$on("CONNECTION_ERROR",function(){var e=i.getCookie("reloaded");e?r.reset():i.setCookie("reloaded",1)}),t.$on("$locationChangeStart",function(e,t,n){t&&r.notifyRouteChange()});function d(){r.subscribe(o.handleInvalidSession,{action:[c.TYPE_SESSION_VALIDATION,c.TYPE_INVALID_LOGIN_SESSION,c.TYPE_MULTIPLE_SESSION]}),o.ensureLoginState(),t.$rgDigest()}d()}var app;app=angular.module("ringid").run(["$rootScope","$window","$document","$$connector","$ringhttp","settings",function(e,t,n,r,i,o){var a,s,c=angular.element(t);r.init();function l(t){"inactive"!==s&&e.$broadcast("ringInactive",t),s="inactive"}function u(t){"active"!==s&&e.$broadcast("ringActive",t),s="active"}c.on("inactive",l),c.on("active",u);function d(t){this[a?a+"Hidden":"hidden"]&&"inactive"!==s?(e.$broadcast("ringInactive",t),s="inactive"):"active"!==s&&(e.$broadcast("ringActive",t),s="active")}"hidden"in n?a="":angular.forEach(["moz","webkit","ms"],function(e){e+"Hidden"in n[0]&&(a=e)}),angular.isDefined(a)&&""!==a&&n[0].addEventListener(a+"visibilitychange",d),i.get(o.constantServer).success(function(e){var t=angular.fromJson(e);t.sucs===!0&&o.updateUrlBase(t),t=null})}]),angular.module("ringid").config(["$compileProvider","$routeProvider","$locationProvider","$httpProvider","RING_ROUTES","settings",function(e,t,n,r,i,o){r.useApplyAsync(!0),e.debugInfoEnabled(o.debugEnabled),r.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var a=function(e){var t,n,r,i,o,s,c,l="";for(t in e)if(n=e[t],n instanceof Array)for(c=0;c<n.length;++c)o=n[c],r=t+"["+c+"]",s={},s[r]=o,l+=a(s)+"&";else if(n instanceof Object)for(i in n)o=n[i],r=t+"["+i+"]",s={},s[r]=o,l+=a(s)+"&";else void 0!==n&&null!==n&&(l+=encodeURIComponent(t)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l};r.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?a(e):e}],t.when(i.HOME,{templateUrl:"templates/index.html"}).when(i.LOGIN_SOCIAL,{templateUrl:"templates/index.html"}).when(i.SIGNUP_SOCIAL,{templateUrl:"templates/index.html"}).when(i.USER_PROFILE,{templateUrl:"templates/profile/profile.html",resolve:{user:["Api","userFactory","$route","$location","$q","Ringalert","Auth",function(e,t,n,r,i,o,a){var s=i.defer();return a.isPendingAsync().then(function(){var i=t.getUser(n.current.params.uId);i&&i.hasDetails()?s.resolve(i):e.user.getUserDetails({uId:n.current.params.uId}).then(function(e){s.resolve(t.create(e.userDetails))},function(){o.show("User not found","error"),r.path().indexOf("profile")>-1&&r.path("/"),s.reject()})}),s.promise}]}}).when(i.CIRCLE_HOME,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/home/circle.html"}).when(i.SINGLE_FEED,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/index-singlefeed.html"}).when(i.MEDIA_FEEDS,{templateUrl:"templates/home/media.feed.html"}).when(i.WHO_SHARED_FEED,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/index-who-sharedfeed.html"}).when(i.MEDIA_CLOUD,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/media-list.html"}).when(i.MEDIA_CLOUD_MYALBUM,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/my.albums.html"}).when(i.MEDIA_POST,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/media.upload.html",controller:"MediaPostController"}).when(i.MEDIA_CLOUD_ALBUM,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when(i.MEDIA_CLOUD_SEARCH,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/search.result.html",controller:"mSearchResultController"}).when(i.MEDIA_CLOUD_USERMEDIA,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when("/chat",{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}).when(i.CIRCLE,{templateUrl:"templates/circle-partials/all-circle.html",controller:"allCirclePopupController"}).when("/newsportal",{templateUrl:"pages/newsportal/portal-index.html",controller:"FeedNewsportalController"}).when("/newsportal/following",{templateUrl:"pages/newsportal/following.html",controller:"portalFollowingController"}).when("/newsportal/discover",{templateUrl:"pages/newsportal/discover.html",controller:"portalDiscoverController"}).when("/newsportal/saved",{templateUrl:"pages/newsportal/saved.html",controller:"portalSaveController"}).when("/newsportal/:uid",{templateUrl:"pages/newsportal/profilenews.html"}).when("/pages",{templateUrl:"pages/business/business-index.html",controller:"FeedBusinessPortalController"}).when("/pages/discover",{templateUrl:"pages/business/business-discover.html",controller:"businessDiscoverController"}).when("/pages/following",{templateUrl:"pages/business/business-following.html",controller:"businessFollowingController"}).when("/pages/saved",{templateUrl:"pages/business/business-saved.html",controller:"businessSaveController"}).when("/pages/:uid",{templateUrl:"pages/business/business-news.html"}).when("/allnotification",{templateUrl:"templates/partials/all-notification.html"}).when("/allfriendrequest",{templateUrl:"templates/partials/all-friend-request.html"}).when("/medianew",{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediapage.html"}).when(i.FAQ,{redirectTo:function(e,t,n){window.location.href=location.protocol+"//"+location.host+"/faq.xhtml"}}).when(i.API_DASHBOARD,{templateUrl:"app/apidashboard/templates/api.index.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","rgDropdownService","$ringbox","PAGE_TITLES","Utils",function(e,t,n,r,i,o,a){var s=0;e.$on("$routeChangeSuccess",function(e,t){o[t.$$route.originalPath]?a.setPageTitle(o[t.$$route.originalPath],s>0):a.setPageTitle(o.DEFAULT),s++}),e.$on("$routeChangeStart",function(o,a,s){n.isPending()||n.isLoggedIn()||e.doingSilentLogin||"/"===t.url()?(i.closeAll(),r.close(),d(!0)):(t.path("/"),d(!0))}),requestAnimationFrame(function(){});var c=[],l=Object.getPrototypeOf(e),u=[];e.$ignoreScopes=[],l.$coreDigest=l.$digest;function d(t){for(var n=0;n<e.$ignoreScopes.length;n++)u[e.$ignoreScopes[n].$id]&&(e.$ignoreScopes[n].$$childHead=u[e.$ignoreScopes[n].$id]);u=[],t&&(e.$ignoreScopes=[])}l.$rgDigest=function(){if(e.$$phase){if(c.indexOf(this)==-1&&1!=this.$id){c.push(this),c.sort(function(e,t){return e.$id-t.$id});for(var t,n,r,i=[];c.length>1;){t=c.pop();for(var o=c.length-1;o>=0;o--){for(n=c[o],r=t.$parent;r!=n&&null!=r;)r=r.$parent;if(null!=r)break}null==r&&i.push(t)}for(;t=i.pop();)c.push(t)}e.$$postDigest(function(){c.length>0&&c.pop().$rgDigest()})}else{if(1==this.$id&&e.$ignoreScopes.length>0){for(var o=0;o<e.$ignoreScopes.length;o++)u[e.$ignoreScopes[o].$id]=e.$ignoreScopes[o].$$childHead,e.$ignoreScopes[o].$$childHead=null;e.$$postDigest(function(){d()})}this.$coreDigest()}},l.$digest=function(){this.$rgDigest()},l.addIgnore=function(){e.$ignoreScopes.indexOf(this)==-1&&e.$ignoreScopes.push(this)},l.removeIgnore=function(){var t;(t=e.$ignoreScopes.indexOf(this))>-1&&e.$ignoreScopes.splice(t,1)},l.calc=function(){var e,t,n,r=0,i=0;window.performance.now();e=this,t=e;do if(r+=t.$$watchers?t.$$watchers.length:0,i++,!(n=t.$$childHead||t!==e&&t.$$nextSibling))for(;t!==e&&!(n=t.$$nextSibling);)t=t.$parent;while(t=n)}}]);