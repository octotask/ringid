/*! @copywrite Ringid.com  2016-10-09 */
var RingWorker,settingsMessageObject,RingMessageChannel;try{RingMessageChannel=new MessageChannel}catch(e){}!function(e){"use strict";function t(){var e,t=Cookies.get("top");return t?(e=parseInt(t,10)+1,e>255&&(e=1)):e=1,Cookies.set("top",e),e}e._cti=t();try{e.location.origin||(e.location.origin=e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")),RingWorker=new Worker(e.location.origin+"/js/worker/com")}catch(n){RingWorker={addCallback:angular.noop,addEventListener:angular.noop,postMessage:angular.noop}}RingWorker.FNS={},RingWorker.addCallback=function(e,t,n){var r=n||null;this.FNS[e]||(this.FNS[e]=[]),this.FNS[e].push({ctx:r,fn:t})},RingWorker.send=function(e,t,n,r){if(!n||!e)throw new Error("You must sent data and port");this.postMessage({command:"SEND",packetId:t,data:e,flooding:r,port:n,action:e.actn})},RingWorker.addEventListener("message",function(e){var t,n;if(e.data.notifier&&this.FNS[e.data.notifier])for(n=0;n<this.FNS[e.data.notifier].length;n++)t=this.FNS[e.data.notifier][n],t.fn.call(t.ctx,e.data)}),RingWorker.addCallback("debug",function(e){},RingWorker),RingWorker.addEventListener("error",function(e){}),RingWorker.pushMessage=function(e,t){try{t?this.postMessage(e,t):this.postMessage(e)}catch(n){}},settingsMessageObject={command:"SETTINGS",tabId:e._cti,url:"wss://"+e.location.host+"/DataSocket/"+e._cti,aSkey:Cookies.get("sId"),sKey:Cookies.get("sessionID"),CLIENT_DATA_SIZE:460},RingMessageChannel?RingWorker.pushMessage(settingsMessageObject,[RingMessageChannel.port1]):RingWorker.pushMessage(settingsMessageObject)}(window),function(e,t){"use strict";e.emojiSupported=function(){var e,t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d")||"function"!=typeof t.getContext("2d").fillText)&&(e=t.getContext("2d"),e.textBaseline="top",e.font="32px Arial",e.fillText("ðŸ˜ƒ",0,0),0!==e.getImageData(16,16,1,1).data[0])}(),e.eventFix=function(t){var n=t||e.event,r=n.pageX;void 0===r&&(n.pageX=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.pageY=n.clientY+document.body.scrollTop+document.documentElerment.scrollTop)},e.scrollToYOffset=function(t,n){var r=t/(n/15),i=setInterval(function(){e.scrollY<t?e.scrollBy(0,r):clearInterval(i)},15)},Function.prototype.bind||(Function.prototype.bind=function(e){var t,n=Array.prototype.slice.call(arguments,1),r=this,i=function(){};if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return t=function(){return r.apply(this instanceof i?this:e,n.concat(Array.prototype.slice.call(arguments)))},this.prototype&&(i.prototype=this.prototype),t.prototype=new i,t}),String.prototype.format||(String.prototype.format=function(){var e="[object Array]"===Object.prototype.toString.call(arguments[0])?arguments[0]:arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),String.prototype.supplant||(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t})}),String.prototype.repeat||(String.prototype.repeat=function(e){return Array(e+1).join(this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))},String.prototype.getUTF8Length=function(){var e,t,n=0,r=this;for(e=0;e<r.length;e++)t=r.charCodeAt(e),t<=127?n+=1:t<=2047?n+=2:t>=55296&&t<=57343?(n+=4,e++):n+=t<65535?3:4;return n},String.prototype.toCharCodeArray=function(){var e,t=[];for(e=0;e<this.length;e++)t.push(this.charCodeAt(e));return t},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.contains||(Array.prototype.contains=function(e,t){var n,r;if(!t)return this.indexOf(e);for(n=this.length>>>0,r=Number(arguments[1])||0,r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);r<n;r++)if(r in this&&t.call(this,this[r],e))return r;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,n,r,i,o,a;if(void 0===this||null===this)throw new TypeError;if(t=Object(this),n=t.length>>>0,"function"!=typeof e)throw new TypeError;for(r=[],i=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)o in t&&(a=t[o],e.call(i,a,o,t)&&r.push(a));return r}),Array.prototype.keyValues||(Array.prototype.keyValues=function(e){var t,n=[];for(t=0;t<this.length;t++)this[t][e]&&n.push(this[t][e]);return n}),Array.prototype.values||(Array.prototype.values=function(){var e,t=[];for(e=0;e<this.length;e++)t.push(this[e]);return t}),Array.prototype.joinAsDataView=function(){var e,n,r,i,o=this,a=0,s=0;if(!o.length)return new t(new ArrayBuffer(0));for(e=0;e<o.length;e++)o[e]instanceof t&&(s+=o[e].byteLength);if(!s)return new t(new ArrayBuffer(0));for(r=new ArrayBuffer(s),i=new t(r),e=0;e<o.length;e++)if(o[e]instanceof t)for(n=0;n<o[e].byteLength;n++)i.setUint8(a++,o[e].getUint8(n));return i},Array.prototype.difference=function(e){var t={},n=[],r=0;if(!e||!e.length||!this.length)return this;for(;r<e.length;)t[e[r]]=!0,r++;for(r=0;r<this.length;r++)t[this[r]]||n.push(this[r]);return n},t.prototype.copy=function(e,n){var r,i=this,o=e||0,a=n||i.byteLength,s=new ArrayBuffer(a),c=new t(s);for(r=0;r<a;r++)c.setUint8(r,i.getUint8(o++));return c},t.prototype.merge=function(e,n,r,i,o){var a,s,c=i,l=new t(this.buffer,e,n),u=new ArrayBuffer(l.byteLength+(o-c+1)),d=new t(u);for(a=0;a<l.byteLength;a++)d.setUint8(a,l.getUint8(a));for(s=a;s<d.byteLength;s++)d.setUint8(s,r.getUint8(c++));return d},t.prototype.addAttributeInt=function(e,t,n,r){var i=e;switch(this.setUint8(i++,t),this.setUint8(i++,n),n){case 1:this.setUint8(i++,r);break;case 2:this.setUint16(i,r),i+=2;break;case 4:this.setUint32(i,r),i+=4}return i},t.prototype.addAttributeString=function(e,t,n){var r,i=e;for(this.setUint8(i++,t),this.setUint8(i++,n.length),r=0;r<n.length;r++)this.setUint8(i++,n.charCodeAt(r));return i},t.prototype.addAttributeData=function(e,t,n,r,i){var o,a=e,s=i||n.byteLength,c=r||0;for(this.setUint8(a++,t),this.setUint16(a,s),a+=2,o=0;o<s;o++)this.setUint8(a++,n.getUint8(c++));return a},t.prototype.print_r=function(e,t,n){var r,i,o,a=a||0,s=n||this.byteLength,c="Index\t\tBinary\t\tInteger\t\tChar\n",l="";for(i=a;i<s;i++)o=this.getUint8(i),r=String.fromCharCode(o),c+=i+"\t\t \t\t"+o.toString(2)+"\t\t\t\t"+o+"\t\t\t\t"+r+"\n",l+=r;if(!e||"string"==typeof e)return l},t.prototype.printBytes=function(){var e,t=[];for(e=0;e<this.byteLength;e++)t.push(this.getUint8(e));t.push(-1e3)},t.prototype.getString=function(e,t){for(var n,r,i,o=this,a=[],s=t||o.byteLength,c=e;s>0;)o.getUint8(c)<=127?(a.push(o.getUint8(c++)),s--):o.getUint8(c)>=128&&o.getUint8(c)<=223?(a.push((31&o.getUint8(c++))<<6|63&o.getUint8(c++)),s-=2):o.getUint8(c)>=224&&o.getUint8(c)<=239?(a.push((31&o.getUint8(c++))<<12|((63&o.getUint8(c++))<<6|63&o.getUint8(c++))),s-=3):(i=(7&o.getUint8(c++))<<18|((63&o.getUint8(c++))<<12|((63&o.getUint8(c++))<<6|63&o.getUint8(c++))),i-=65536,n=(i>>10)+55296,r=i%1024+56320,a.push(n,r),s-=4);return String.fromCharCode.apply(null,a)},t.prototype.getStringUtf16=function(e,t,n){var r,i,o,a=0|a,s=s||this.byteLength-a,c=!1,l="",u=!1;for("undefined"!=typeof Buffer&&(l=[],u=!0),s<0&&(s+=this.byteLength),n&&(r=this.getUint16(a),65534===r&&(c=!0),a+=2,s-=2),i=a;i<a+s;i+=2)o=this.getUint16(i,c),o>=0&&o<=55295||o>=57344&&o<=65535?u?l.push(o):l+=String.fromCharCode(o):o>=65536&&o<=1114111&&(o-=65536,u?(l.push(((1047552&o)>>10)+55296),l.push((1023&o)+56320)):l+=String.fromCharCode(((1047552&o)>>10)+55296)+String.fromCharCode((1023&o)+56320));return u?l.toString():decodeURIComponent(escape(l))},t.prototype.getIntByByte=function(e,t){var n,r,i=this,o="";switch(t){case 1:return i.getUint8(e);case 2:return i.getUint16(e);case 4:return i.getUint32(e);case 6:case 8:for(n=e;n<e+t;n++)r=i.getUint8(n).toString(2),o+=r.length<8?"0".repeat(8-r.length)+r:r;return parseInt(o,2);default:return i.getUint8(e)}},t.prototype.getSynch=function(e){for(var t=0,n=2130706432;n;)t>>=1,t|=e&n,n>>=8;return t},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n,r,i,o=e,a=t;return void 0===o&&(o=0),void 0===a&&(a=this.byteLength),o=Math.floor(o),a=Math.floor(a),o<0&&(o+=this.byteLength),a<0&&(a+=this.byteLength),o=Math.min(Math.max(0,o),this.byteLength),a=Math.min(Math.max(0,a),this.byteLength),a-o<=0?new ArrayBuffer(0):(n=new ArrayBuffer(a-o),r=new Uint8Array(n),i=new Uint8Array(this,o,a-o),r.set(i),n)}),t.prototype.setUint64=function(e,t){var n,r,i,o=this,a=Number.isInteger(t)?t.toString(2):parseInt(t,10).toString(2);for(a=a.length<64?"0".repeat(64-a.length)+a:a,n=a.match(/.{1,32}/g),r=n.map(function(e){return parseInt(e,2)}),i=0;i<r.length;i++)o.setUint32(e+4*i,r[i])},t.prototype.getBool=function(e){return 1===this.getUint8(e)},e.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,n=(t.parentNode||t.document).querySelectorAll(e),r=-1;n[++r]&&n[r]!==t;);return!!n[r]},e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(e.Element.prototype),e.requestAnimationFrame=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,t.prototype.getUint24=function(e,t){return t?this.getUint8(e)+(this.getUint8(e+1)<<8)+(this.getUint8(e+2)<<16):this.getUint8(e+2)+(this.getUint8(e+1)<<8)+(this.getUint8(e)<<16)},Math.easeIn=function(e,t,n,r){var i=e;return i/=r/2,i<1?n/2*i*i+t:(i--,-(n/2*(i*(i-2-1)))+t)},e.decodeEntities=function(){var e=document.createElement("div");function t(t){var n=t;return n&&"string"==typeof n&&(n=n.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),n=n.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=n,n=e.textContent,e.textContent=""),n}return t}(),"function"!=typeof Object.assign&&!function(){Object.assign=function(e){var t,n,r,i;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(t=Object(e),n=1;n<arguments.length;n++)if(r=arguments[n],void 0!==r&&null!==r)for(i in r)r.hasOwnProperty(i)&&(t[i]=r[i]);return t}}()}(window,DataView),function(e,t){"use strict";e.module("ringid.digits",["ringid.config","ringid.global_services"])}(angular,window),angular.module("ringid.digits").service("digitsService",digitsService),digitsService.$inject=["settings"];function digitsService(e){var t=!1;function n(){t||(Digits.init({consumerKey:e.digitsConsumerKey}),t=!0)}this.initialize=n}angular.module("ringid.digits").directive("rgVerifyPhone",rgVerifyPhone),rgVerifyPhone.$inject=["$ringhttp","settings","$http","Auth","Ringalert","MESSAGES","digitsService","Storage","$compile"];function rgVerifyPhone(e,t,n,r,i,o,a,s,c){function l(e,l){var u=c('<div class="verify-phone"></div>')(e),d=!1;function g(t){var n,a,s,c,l={mbl:"",mblDc:""};if(t.data.phoneNumber&&t.data.phoneNumber.length>1){for(s=t.data.phoneNumber,c=r.getCountryList(),n=0;n<c.length;n++)if(a=s.substr(0,c[n].code.length),c[n].code===a){l.mblDc=c[n].code,l.mbl=s.substr(c[n].code.length);break}e.verify()(l)}else i.show(o.REQUEST_FAILED)}function E(e){}function m(e){var r=u.find("iframe"),i=e.oauth_echo_headers,o={authHeader:i["X-Verify-Credentials-Authorization"],apiUrl:i["X-Auth-Service-Provider"]};r&&(r[0].style.height="100%"),n.post(t.digitsServiceUrl,o).then(g)}function T(){var t="",n=s.getData("country");d=!0,l.append(u),n&&n.hasOwnProperty("code")&&(t=n.code),a.initialize(),Digits.embed({container:".verify-phone",phoneNumber:t,theme:{accent:"F47727"}}).done(m).fail(E),e.$rgDigest()}function f(){d=!1,u&&u.remove()}function p(e){e&&!d?T():!e&&d&&f()}e.$watch("enabled",p),e.$on("$destroy",function(){f()})}return{restrict:"E",scope:{verify:"&",enabled:"="},link:l}}!function(e,t){"use strict";e.module("ringid.config",[])}(angular,window);var server=location.href.split("/")[2],protocol="https://",baseUrl=location.protocol+"//"+location.host,settingDefault={ac:"https://auth.ringid.com/rac/",ims:"https://images.ringid.com/",imsres:"https://imagesres.ringid.com/",stmapi:"https://sticker.ringid.com/",stmres:"https://stickerres.ringid.com/",vodapi:"https://mediacloudapi.ringid.com/",vodres:"https://mediacloud.ringid.com/",apiVersion:144},settings={apiVersion:settingDefault.apiVersion,constantServer:"https://auth.ringid.com/cnstnts?pf=5&v="+settingDefault.apiVersion+"&apt=1",socketProtocol:"wss://",secure:!0,analytics:!0,debugEnabled:!1,html5Mode:!0,httpsUrl:"https://"+server,siteUrl:server,baseUrl:baseUrl,base:location.host,chatImBase:protocol+"image.ringid.com/chatContens/",chatVideoBase:protocol+"image.ringid.com/chatContens/",chatAudioBase:protocol+"image.ringid.com/chatContens/",tagChatImBase:protocol+"image.ringid.com/groupContents/",chatHeartBeatUrl:baseUrl+"/images/ping.jpg",emotionServer:settingDefault.imsres+"/emoticon/d5/",emoticonBase:protocol+server+"/images/emoticon/",chatBackgroundBase:settingDefault.imsres+"chatbg/d2/xhdpi/",stickerApiVersion:4,stickerBase:settingDefault.stmres+"stickermarket/d5/",stickerApiBase:settingDefault.stmapi+"ringmarket/",stickerApi:settingDefault.stmapi+"ringmarket/StickerHandler/?pf=5&v="+settingDefault.apiVersion+"&",stickerV2Api:settingDefault.stmapi+"ringmarket/StickerHandler?",imMediaBase:protocol+"image.ringid.com/ringmarket/ChatImageHandler",digitsServiceUrl:"https://www.ringid.com/DigitsService",digitsConsumerKey:"wnZ1SukFsxdnr22U4PLiS3T9J",twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",ogServiceUrl:protocol+server+"/OGService",sessionTimeout:216e5,FEED_LIMIT:6,FEED_TEXT_LIMIT:65335,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,USERS_PRESENCE_REFRESH_INTERVAL:3,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE"},PLATFORM={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},RING_ROUTES={HOME:"/",SAVED_FEEDS:"/saved-feeds",SAVED_MEDIA_FEEDS:"/saved-media-feeds",SAVED_CIRCLE_FEEDS:"/saved-circle-feeds",SAVED_NEWSPORTAL_FEEDS:"/saved-newsportal-feeds",SAVED_PAGES_FEEDS:"/saved-pages-feeds",SAVED_CELEBRITY_FEEDS:"/saved-celebrity-feeds",CHAT:"/chat/single",CHAT_GROUPS:"/chat/groups",CHAT_ROOMS:"/chat/rooms",MEDIA_FEED:"/mediafeed",MEDIA_PLAYLIST:"/media/playlist",MEDIA_DISCOVER:"/media/discover",MEDIA_FOLLOWING:"/media/following",MEDIA_SAVED:"/media/saved",MEDIA_POST:"/media/upload",MEDIA_CLOUD_MYALBUM:"/media/myalbums/:albumType/:albumId?",NEWSPORTAL_FEED:"/newsportal",NEWSPORTAL_FOLLOWING:"/newsportal/following",NEWSPORTAL_DISCOVER:"/newsportal/discover",NEWSPORTAL_SAVED:"/newsportal/saved",PAGES_FEED:"/pages",PAGES_FOLLOWING:"/pages/following",PAGES_DISCOVER:"/pages/discover",PAGES_SAVED:"/pages/saved",CELEBRITY_FEED:"/celebrity",CELEBRITY_DISCOVER:"/celebrity/discover",CELEBRITY_FOLLOWING:"/celebrity/following",CELEBRITY_SAVED:"/celebrity/saved",NOTIFICATIONS:"/notifications",FRIEND_REQUESTS:"/requests",CIRCLE_FEED:"/circle",CIRCLE_LIST:"/circle/list",CIRCLE_SAVED:"/circle/saved",PROFILE:"/profile/:uId/:subpage?/:albumType?/:albumId?",CIRCLE:"/circle/:circleId/:subpage?",NEWSPORTAL:"/newsportal/:portalid?",PAGE:"/page/:portalid",CELEBRITY:"/celebrity/:portalid",CHAT_GROUP:"/chat/group/:tagId",MEDIA_CLOUD_SEARCH:"/media/:stype/:sk?",MEDIA_CLOUD_USERMEDIA:"/media/:albumtype/:utid/:albumid",MEDIA_PAGE_PROFILE:"/mediapage/:mpageid",STICKER_HOME:"/sticker",FAQ:"/faq.html",CONTACT:"/contact.html",WHO_SHARED_FEED:"/feedshares/:feedId/:commentId?",SINGLE_FEED:"/feed/:feedId/:commentId?/:shared?",SINGLE_IMAGE:"/image/:imageId/:commentId?",SINGLE_MEDIA:"/media/:mediaId/:commentId?",LOGIN_SOCIAL:"/social/:operation/:platform/:token",SIGNUP_SOCIAL:"/social/:operation/:platform/:token",API_DASHBOARD:"/apidashboard"},DEFAULTS_TITLE="ringID: Free Video Calls, Secret Chats, Feeds, Stickers & more",PAGE_TITLES={DEFAULT:DEFAULTS_TITLE};function setUrlBase(e){settings.signupInit=e.ac+"ringid?pf=5&v="+settings.apiVersion+"&",settings.signupSocialInit=e.ac+"comports?pf=5&v="+settings.apiVersion+"&",settings.imBase=e.imsres,settings.imServer=e.ims+"ringmarket/",settings.imCropServer=e.ims+"ipvringmarket/",settings.mediaServer=e.vodapi+"stream/",settings.mediaBase=e.vodres,settings.stickerBase=e.stmres+"stickermarket/d5/",settings.stickerApi=e.stmapi+"ringmarket/StickerHandler/?pf=5&v="+settings.apiVersion+"&"}settings.updateUrlBase=setUrlBase,settings.updateUrlBase(settingDefault),PAGE_TITLES[RING_ROUTES.HOME]=DEFAULTS_TITLE,PAGE_TITLES[RING_ROUTES.CIRCLE]="ringID Circle",PAGE_TITLES[RING_ROUTES.CIRCLE_LIST]="ringID Circles",PAGE_TITLES[RING_ROUTES.SINGLE_FEED]=DEFAULTS_TITLE,PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_POST]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_MYALBUM]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_SEARCH]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_USERMEDIA]="Media Cloud",PAGE_TITLES[RING_ROUTES.NEWSPORTAL]="News Portal",PAGE_TITLES[RING_ROUTES.PAGES]="Pages",PAGE_TITLES[RING_ROUTES.CELEBRITY]="Celebrity",angular.module("ringid.config").constant("settings",settings).constant("PLATFORM",PLATFORM).constant("RING_ROUTES",RING_ROUTES).constant("PAGE_TITLES",PAGE_TITLES).constant("MIN_TIMESTAMP",0xe87c62b0141);var ATTRIBUTE_CODES={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166,ADDED_TIME:168};angular.module("ringid.config").constant("ATTRIBUTE_CODES",ATTRIBUTE_CODES),angular.module("ringid.config").constant("UPLOAD_TYPES",{STATUS:"status",THUMB:"thumb",AVATAR:"avatar",COVER:"cover",CHAT:"chat",TAGCHAT:"tagchat",TAGCHAT_COVER:"tagchatcover",TAGCHAT_AVATAR:"tagchatavatar",COMMENT:"comment"}).constant("REASON_CODES",{NONE:0,PERMISSION_DENIED:1,PASSCODE_SENT_INTERVAL:2,DONT_DISTURB_MODE:3,ALREADY_SHARED:4,NOT_TAG_MEMBER:5,TAG_DOES_NOT_EXIST:6,SMS_SENDING_FAILED:7,EMAIL_SENDING_FAILED:8,FRIEND_OFFLINE:9,NOT_FRIEND:10,USERID_FRIENDID_SAME:11,ALREADY_FRIEND_REQUESTED:12,EXCEPTION_OCCURED:13,DATABASE_ROLL_BACKED:14,CANT_SHARE_OWN_FEED:15,FRIEND_DID_NOT_FOUND:16,SMS_SEND_RETRY_LIMIT_OVER:17,NO_MORE_FEED:18,NOT_FOUND:404}).constant("SystemEvents",{COMMON:{WINDOW_RESIZED:"WINDOW_RESIZED",WINDOW_SCROLLED:"WINDOW_SCROLLED",COLUMN_CHANGED:"COLUMN_CHANGED",LOADING:"LOADING",PONG:"PONG"},MEDIA:{SLIDER_IMAGE_LOADED:"SLIDER_IMAGE_LOADED",DONE_FOLLOW_MEDIA:"DONE_FOLLOW_MEDIA",UNFOLLOW_MEDIA:"UNFOLLOW_MEDIA"},PORTAL:{DONE_FOLLOW_PORTAL:"DONE_FOLLOW_PORTAL",UNFOLLOW_PORTAL:"UNFOLLOW_PORTAL"},BUSINESS:{DONE_FOLLOW_BUSINESS:"DONE_FOLLOW_BUSINESS",UNFOLLOW_BUSINESS:"UNFOLLOW_BUSINESS"},CELEBRITY:{DONE_FOLLOW_CELEBRITY:"DONE_FOLLOW_CELEBRITY",UNFOLLOW_CELEBRITY:"UNFOLLOW_CELEBRITY"},RINGBOX:{UPDATE:"CONTENT_UPDATE"},CIRCLE:{MY_CIRCLE_LIST_FETCH_COMPLETE:"MY_CIRCLE_LOAD_COMPLETE",MY_CIRCLE_LIST_PROCESS_COMPLETE:"MY_CIRCLE_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE:"MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE",MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE:"MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE:"MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE",MY_CIRCLE_MEMBER_REMOVED:"MY_CIRCLE_MEMBER_REMOVED",MY_CIRCLE_REMOVED:"MY_CIRCLE_REMOVED",MY_CIRCLE_UPDATE_MEMBER_COUNT:"MY_CIRCLE_UPDATECOUNT"},FILE_UPLOAD:{PROGRESS_UPDATE:"PROGRESS_UPDATE",QUEUE_START:"QUEUE_START",QUEUE_COMPLETE:"QUEUE_COMPLETE",UPLOADS_POSTED:"UPLOADS_POSTED"},ALBUM:{PHOTOS_SELECTED:"PHOTOS_SELECTED"},IMAGE:{DO_REPOSITION:"DO_REPOSITION",RESIZE:"RESIZE"},FEED:{UPDATED:"UPDATED",CREATED:"CREATED",DELETED:"DELETED",RESET:"RESET",HEIGHT:"HEIGHT",BUSY:"BUSY"},FRIEND:{PENDING_FRIENDS_COUNT_CHANGED:"PENDING_FRIENDS_COUNT_CHANGED",UTID_LIST_RECEIVED:"UTID_LIST_RECEIVED"},AUTH:{LOGIN:"LOGIN",LOGIN_REQUIRED:"LOGIN_REQUIRED",LOGIN_DONE:"LOGIN_DONE"},STICKER:{DO_INIT:"DO_INIT",NEW_STICKER_INFO_UPDATED:"NEW_STICKER_INFO_UPDATED"},CHAT:{REFRESH:"REFRESH",BOX_CAM_UPLOAD:"BOX_CAM_UPLOAD",BOX_OPENNED:"BOX_OPENNED",BOX_UPDATED:"BOX_UPDATED",WAS_FOCUSED:"WAS_FOCUSED",NEW_MESSAGE_PUSHED:"NEW_MESSAGE_PUSHED",MESSAGE_RECEIVED:"MESSAGE_RECEIVED",UNREAD_MESSAGE_INFO_UPDATED:"UNREAD_MESSAGE_INFO_UPDATED",SINGLE_MESSAGE_UPDATED:"SINGLE_MESSAGE_UPDATED",SINGLE_MESSAGE_TIMEOUT:"SINGLE_MESSAGE_TIMEOUT",MESSAGE_SUBMITTED:"MESSAGE_SUBMITTED",MESSAGE_PUSHED:"MESSAGE_PUSHED",DO_START_SECRET_TIMER:"DO_START_SECRET_TIMER",SIMPLE_MESSAGE_TIMEOUT:"SIMPLE_MESSAGE_TIMEOUT",MY_TAG_LIST_RECEIVED:"MY_TAG_LIST_RECEIVED",TAG_LIST_UPDATED:"TAG_LIST_UPDATED",TAG_REGISTERED:"TAG_REGISTERED",TAG_UNREGISTERED:"TAG_UNREGISTERED",TAG_MEMBER_FETCHED:"TAG_MEMBER_FETCHED",TAB_SYNC_NEW_DATA:"TAB_SYNC_NEW_DATA",HISTORY_LOADED:"HISTORY_LOADED",API_HISTROY_PROCESSED:"API_HISTROY_PROCESSED",INITIATED:"INITIATED",ROOM_LIST_UPDATED:"ROOM_LIST_UPDATED",ROOM_UPDATED:"ROOM_UPDATED",CHAT_REGISTER:"CHAT_REGISTER",TAB_SYNC:"TAB_SYNC",SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",CONVERSATION_COUNT_RESETED:"CONVERSATION_COUNT_RESETED",CONVERSATION_RECEIVED:"CONVERSATION_RECEIVED"}}).constant("MESSAGES",{REQUEST_PROCESSED:"Your Request Was Successfully Processed",REQUEST_FAILED:"Your Request Was Failed ! Please Try Later.",RC0:"NONE.",RC1:"PERMISSION_DENIED",RC2:"PASSCODE_SENT_INTERVAL",RC3:"DONT_DISTURB_MODE",RC4:"You have already shared this post.",RC5:"NOT_TAG_MEMBER.",RC6:"TAG_DOES_NOT_EXIST.",RC7:"SMS_SENDING_FAILED.",RC8:"EMAIL_SENDING_FAILED.",RC9:"FRIEND_OFFLINE",RC10:"You are not permitted to share this post",RC11:"USERID_FRIENDID_SAME",RC12:"ALREADY_FRIEND_REQUESTED",RC13:"EXCEPTION_OCCURED",RC14:"DATABASE_ROLL_BACKED",RC15:"You Can't Share Your Own Post",RC16:"FRIEND_DID_NOT_FOUND",RC17:"SMS_SEND_RETRY_LIMIT_OVER",RC18:"NO_MORE_FEED",RC19:"UNKNOWN",RC20:"UNKNOWN",RC21:"LOGGED_IN_FROM_ANOTHER_DEVICE",RC22:"UNKNOWN",RC23:"UNKNOWN",RC26:"USER_EXIST",RC27:"DUPLICATE_DATA",RC33:"THIS_IS_SPECIAL_FRIEND",RC37:"ANONYMOUS_CHAT_PERMISSION_DENIED",RC24:"Wrong Password.",RC38:"Could not find DeviceID!",RC39:"This phone number is not verified.",RC40:"This email is not verified.",RC41:"Your facebook ID is not verified.",RC42:"Your twitter ID is not verified.",RC43:"Could not find Your facebook ID.",RC44:"Could not find Your twitter ID.",RC45:"Wrong RingID!",RC46:"Wrong Phone number!",RC47:"Wrong Email!",RC48:"Device Id required!",RC49:"Password required",RC50:"Login Type required",RC51:"Phone country code required!",RC52:"Phone number required!",RC53:"RingID required!",RC54:"Email required!",RC55:"Version required!",RC56:"Device required!",RC57:"Wrong information",RC60:"Friend limit over!",RC64:"Pending friend limit over!",RC65:"Friend's pending friend limit over",RC66:"Friend's friend limit over",RC79:"You are blocked by authority for spam contents",RC404:"NOT_FOUND",CRCFS1:"Wall post can't be shared",CRCFS2:"Group post can't be shared",CRCFS3:"You already shared this post",FEED_INV:"Please insert some text or upload an image!",FTL_ERROR:"A status can't be longer than {max_limit} characters, but this one is {length} characters long. Please make it a little shorter and try again.",FEED:{ACT_1:"{0} liked this post",ACT_2:"{0} commented on this post",ACT_3:"{0} shared this post",TYPE_0:"{0}",TYPE_11:"{0}",TYPE_11C:"{0} posted",TYPE_11F:"{0} posted",TYPE_12:"{0} updated profile picture",TYPE_13:"{0} updated cover picture",TYPE_2:"{0}",TYPE_2L:"{0} shared a link",TYPE_2C:"{0} posted",TYPE_2CL:"{0} shared a link",TYPE_2F:"{0} posted",TYPE_2FL:"{0} shared a link",TYPE_3:"{0} added {1} photos",TYPE_3C:"{0} posted {1} photos",TYPE_3F:"{0} posted {1} photos",TYPE_4:"{0} created a album",TYPE_50:"{0} added {1} music",TYPE_51:"{0} shared {1}'s music",TYPE_60:"{0} added {1} video||videos",TYPE_62:"{0} shared {1}'s video||videos",TYPE_D:"{0}",C_POSTFIX:" in {0}",F_POSTFIX:" on {0}'s timeline",TYPE_SHARE:"{0} shared {1}'s feed"},NEWSPORTAL:{C_UNFOLLOW:"Are you sure you want to unfollow?"},HIDE_UNHIDE:{FEED_TITLE:"Hide Feed",FEED_SUBTITLE:"You won't see this News Feed",USER_TITLE:"Hide all updates",USER_SUBTITLE:"You won't see from {0} anymore",CIRCLE_TITLE:"Hide all updates",CIRCLE_SUBTITLE:"You won't see from {0} circle anymore"}}).constant("APP_CONSTANTS",{NOT_FRIEND:0,FRIEND:1,INCOMING_FRIEND:2,OUTGOING_FRIEND:3,TYPE_SEARCH_BY_ALL:0,TYPE_SEARCH_BY_NAME:1,TYPE_SEARCH_BY_PHONE:2,TYPE_SEARCH_BY_EMAIL:3,TYPE_SEARCH_BY_RINGID:4,TYPE_SEARCH_BY_LOCATION:5,IMAGE_UPLOAD_LIMIT:40,VIDEO_UPLOAD_LIMIT:5,AUDIO_UPLOAD_LIMIT:5,COVER_PIC_UPLOAD_MAXIMUM_WIDTH:1480,COVER_PIC_UPLOAD_MAXIMUM_HEIGHT:2048,COVER_PIC_UPLOAD_MINIMUM_WIDTH:740,COVER_PIC_UPLOAD_MINIMUM_HEIGHT:280,PROFILE_PIC_UPLOAD_MINIMUM_WIDTH:100,PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT:100,COVER_PIC_CROP_WIDTH:1480,COVER_PIC_CROP_HEIGHT:450,PROFILE_PIC_CROP_WIDTH:200,IMAGE_UPLOAD_MIN_WIDTH:10,IMAGE_UPLOAD_MIN_HEIGHT:10,MEDIA_UPLOAD_SIZE_LIMIT:524288e3,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE",NEWS_FEED_MEDIA_TYPE_AUDIO:1,NEWS_FEED_MEDIA_TYPE_VIDEO:2}).constant("PrivacySet",{PVC1:{icon:"img_sprite post-ico only-i",iconfeed:"img_sprite post-ico-gray only-i",text:"Only me",value:1},PVC2:{icon:"img_sprite post-ico fri-i",iconfeed:"post-ico-gray fri-i",text:"Friends",value:2},PVC3:{icon:"img_sprite post-ico pub-i",iconfeed:"img_sprite post-ico-gray pub-i",text:"Public",value:3}}).constant("SPAM_TYPES",{USER:1,FEED:2,IMAGE:3,MEDIA:4,CHAT_MESSAGE:2}).constant("COMMENT_URL_TYPE",{IMAGE:3,AUDIO:5,VIDEO:6,STICKER:8}).constant("CLIENT_DATA_SIZE",460).constant("AUTH_SERVER_CONFIG",{REQUEST_DELAY:200}).value("DATE_FORMAT","MMM d, y h:mm a").value("STICKER_IMAGE_TYPE",{EMOTICON:1,LARGE_EMOTICON:2,STICKER:3}).constant("DEFAULT_FILES",{AUDIO:"images/default_audio_preview.jpg",VIDEO:"images/default_video_preview.jpg"}).value("STICKER_COLLECTION_CATEGORY_PRE_FETCH_COUNT",5),angular.module("ringid.config").constant("OPERATION_TYPES",{SYSTEM:{REQUEST_TYPE:{KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},FEED_SUPER_TYPES:{TYPE_GENERAL:0,TYPE_SPECIAL:1,TYPE_CELEBRITY:2,TYPE_NEWSPORTAL:3,TYPE_BUSINESS:4,TYPE_MEDIAPAGE:5,TYPE_CIRCLE:6},PROFILE_TYPES:{GENERAL:0,CELEBRITY:2,NEWSPORTAL:3,BUSINESS_PAGE:4,MEDIA_PAGE:5,ALL_SAVED_FEEDS:100},COMMENT_TYPES:{NEWSFEED_COMMENT:1,IMAGE_COMMENT:2,MEDIA_COMMENT:3},TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:114,TYPE_NEWS_FEED:88,TYPE_MY_NEWS_FEED:94,TYPE_FRIEND_NEWSFEED:110,TYPE_GROUP_NEWS_FEED:198,TYPE_MEDIAS_NEWS_FEED:87,TYPE_MEDIAS_TRENDING_FEED:308,TYPE_NEWS_PORTAL_FEED:295,TYPE_BUSINESS_PAGE_FEED:306,TYPE_CELEBRITY_NEWSFEED:288,TYPE_COMMENTS_FOR_STATUS:84,ACTION_SHARE_STATUS:191,ACTION_GET_FULL_COMMENT:137,TYPE_ADD_MULTI_IMAGE:117,TYPE_ADD_STATUS:177,NEWS_FEED_TYPE_IMAGE:1,NEWS_FEED_TYPE_STATUS:2,NEWS_FEED_TYPE_MULTIPLE_IMAGE:3,NEWS_FEED_TYPE_ALBUM:4,NEWS_FEED_TYPE_AUDIO:5,NEWS_FEED_TYPE_VIDEO:6,NEWS_FEED_TYPE_PORTAL:7,TYPE_SINGLE_IMAGE_STATUS:1,TYPE_TEXT_STATUS:2,TYPE_MULTI_IMAGE_STATUS:3,TYPE_DELETE_STATUS:179,TYPE_EDIT_STATUS:178,TYPE_LIKE_STATUS:184,TYPE_UNLIKE_STATUS:186,TYPE_ADD_STATUS_COMMENT:181,TYPE_LIKE_COMMENT:123,TYPE_UNLIKE_COMMENT:125,TYPE_DELETE_STATUS_COMMENT:183,TYPE_EDIT_STATUS_COMMENT:189,TYPE_LIKES_FOR_STATUS:92,TYPE_LIST_LIKES_OF_COMMENT:116,TYPE_TAG_USER_LIST:274,TYPE_WHO_SHARES_LIST:249,ACTION_SHARES_FOR_STATUS:115,ACTION_MEDIA_SHARE_LIST:250,TYPE_UPDATE_ADD_STATUS:377,TYPE_UPDATE_EDIT_STATUS:378,ACTION_UPDATE_SHARE_STATUS:391,TYPE_UPDATE_LIKE_STATUS:384,TYPE_UPDATE_UNLIKE_STATUS:386,TYPE_UPDATE_DELETE_STATUS:379,TYPE_UPDATE_ADD_STATUS_COMMENT:381,TYPE_UPDATE_LIKE_COMMENT:323,TYPE_UPDATE_UNLIKE_COMMENT:325,TYPE_UPDATE_DELETE_STATUS_COMMENT:383,TYPE_UPDATE_EDIT_STATUS_COMMENT:389,ACTION_NEWSFEED_EDIT_HISTORY_LIST:1016,ACTION_NEWSFEED_EDIT_HISTORY_DETAILS:1017,ACTION_COMMENT_EDIT_HISTORY_LIST:1021,TYPE_SAVED_FEED:309,AUTH:{TYPE_INVALID_LOGIN_SESSION:19,TYPE_SIGN_IN:20,TYPE_SIGN_OUT:22,TYPE_SIGN_UP:21,PHN_MAIL_VERIFICATION_CHECK:28,TYPE_SESSION_VALIDATION:76,TYPE_MULTIPLE_SESSION:75,SIGNUP_SEND_CODE_EMAIL:220,SIGNUP_SEND_CODE_PHONE:100,SIGNUP_REGISTER:126,PASSWORD_RECOVER_OPTIONS:222,PASSWORD_RECOVER_SEND_CODE:217,PASSWORD_RECOVER_VERIFY_CODE:218,PASSWORD_RECOVER:219},FRIENDS:{TYPE_CONTACT_UTIDS:29,TYPE_CONTACT_LIST:23,TYPE_PEOPLE_YOU_MAY_KNOW:31,TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:32,TYPE_FRIEND_CONTACT_LIST:107,TYPE_FRIEND_CONTACT_LIST_NEW:211,TYPE_CONTACT_SEARCH:34,ACTION_FRIEND_SEARCH:35,TYPE_ADD_FRIEND:127,TYPE_UPDATE_ADD_FRIEND:327,TYPE_DELETE_FRIEND:128,TYPE_UPDATE_DELETE_FRIEND:328,TYPE_ACCEPT_FRIEND:129,TYPE_UPDATE_ACCEPT_FRIEND:329,TYPE_ACTION_BLOCK_UNBLOCK_FRIEND:243,TYPE_ACTION_CHANGE_FRIEND_ACCESS:244},NOTIFICATION:{TYPE_MY_NOTIFICATIONS:111,TYPE_SINGLE_NOTIFICATION:113,CLEAR_NOTIFICATION_COUNTER:195,MSG_TYPE_UPDATE_PROFILE_IMAGE:1,MSG_TYPE_UPDATE_COVER_IMAGE:2,MSG_TYPE_ADD_FRIEND:3,MSG_TYPE_ACCEPT_FRIEND:4,MSG_TYPE_ADD_GROUP_MEMBER:5,MSG_TYPE_ADD_STATUS_COMMENT:6,MSG_TYPE_LIKE_STATUS:7,MSG_TYPE_LIKE_COMMENT:8,MSG_TYPE_ADD_COMMENT_ON_COMMENT:9,MSG_TYPE_SHARE_STATUS:10,MSG_TYPE_LIKE_IMAGE:11,MSG_TYPE_IMAGE_COMMENT:12,MSG_TYPE_LIKE_IMAGE_COMMENT:13,MSG_TYPE_LIKE_AUDIO_MEDIA:17,MSG_TYPE_AUDIO_MEDIA_COMMENT:18,MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:19,MSG_TYPE_AUDIO_MEDIA_VIEW:20,MSG_TYPE_LIKE_VIDEO_MEDIA:21,MSG_TYPE_VIDEO_MEDIA_COMMENT:22,MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:23,MSG_TYPE_VIDEO_MEDIA_VIEW:24,MSG_TYPE_YOU_HAVE_BEEN_TAGGED:25,MSG_TYPE_UPGRADE_FRIEND_ACCESS:14,MSG_TYPE_ACCEPT_FRIEND_ACCESS:15,MSG_TYPE_DOWNGRADE_FRIEND_ACCESS:16},CIRCLE:{TYPE_CREATE_GROUP:50,TYPE_GROUP_DETAILS:52,TYPE_LEAVE_GROUP:53,TYPE_GROUP_LIST:70,TYPE_GROUP_MEMBERS_LIST:99,TYPE_GROUP_MEMBERS_SEARCH_RESULT:101,TYPE_DELETE_GROUP:152,TYPE_REMOVE_GROUP_MEMBER:154,TYPE_ADD_GROUP_MEMBER:156,TYPE_EDIT_GROUP_MEMBER:158,TYPE_UPDATE_ADD_GROUP:352,TYPE_UPDATE_DELETE_GROUP:352,TYPE_UPDATE_REMOVE_GROUP_MEMBER:354,TYPE_UPDATE_ADD_GROUP_MEMBER:356,TYPE_UPDATE_EDIT_GROUP_MEMBER:358,TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:51},CHAT:{FRIEND_CHAT_REQUEST:175,FRIEND_CHAT_UPDATE:375},TAG_CHAT:{TAG_CHAT_REQUEST_START:134,TAG_CHAT_UPDATE_START:334,TAG_CHAT_REQUEST_ADD_MEMBER:135,TAG_CHAT_UPDATE_ADD_MEMBER:335},PORTAL:{ACTION_NEWSPORTAL_LIST:299,ACTION_NEWSPORTAL_CATEGORIES_LIST:294,ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL:296,ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED:300,ACTION_NEWSPORTAL_BREAKING_FEED:302,ACTION_PAGES_BREAKING_FEED:303,ACTION_CONTACT_SEARCH:34,ACTION_REMOVE_SUGGESTION:33},CELEBRITY:{ACTION_CELEBRITY_LIST:286,ACTION_CELEBRITY_CATEGORY_LIST:285,ACTION_FOLLOW_UNFOLLOW_CELEBRITY:287,CELEBRITY_LIST_TYPE_DISCOVER:1,CELEBRITY_LIST_TYPE_POPULAR:2,
CELEBRITY_LIST_TYPE_FOLLOWING:3,CELEBRITY_LIST_TYPE_ALL:4,CELEBRITY_LIST_TYPE_NONFOLLOWING:5},MEDIA:{ACTION_CHECK_MEDIA_IN_ALBUMS:1006,ACTION_ADD_MEDIA_CONTENT:258,ACTION_UPDATE_MEDIA_CONTENT:259,ACTION_DELETE_MEDIA_CONTENT:260,ACTION_MEDIA_ALBUM_CONTENT_LIST:261,ACTION_MEDIA_CONTENT_DETAILS:262,ACTION_ADD_MEDIA_ALBUM:253,ACTION_UPDATE_MEDIA_ALBUM:254,ACTION_DELETE_MEDIA_ALBUM:255,ACTION_MEDIA_ALBUM_LIST:256,ACTION_MEDIA_ALBUM_DETAILS:257,ACTION_MEDIA_SEARCH_RESULT:277,ACTION_SPECIFIC_MEDIA_RESULT:278,ACTION_GET_TAGGED_MEDIA_SONGS:279,ACTION_GET_MEDIA_SLIDER_IMG:1005,ACTION_GET_HASHTAG_SUGGESTION:280,ACTION_GET_TRENDING_KEYWORDS:281,ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT:272,ACTION_ADD_COMMENT_ON_MEDIA:265,ACTION_LIKE_UNLIKE_MEDIA:264,ACTION_EDIT_COMMENT_ON_MEDIA:266,ACTION_MEDIA_COMMENT_LIST:270,ACTION_MEDIA_LIKE_LIST:269,ACTION_DELETE_COMMENT_ON_MEDIA:267,ACTION_LIKE_UNLIKE_MEDIA_COMMENT:268,ACTION_MEDIACOMMENT_LIKE_LIST:271,ACTION_UPDATE_LIKE_UNLIKE_MEDIA:464,ACTION_UPDATE_ADD_MEDIA_COMMENT:465,ACTION_UPDATE_EDIT_MEDIA_COMMENT:466,ACTION_UPDATE_DELETE_MEDIA_COMMENT:467,ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:468,ACTION_UPDATE_INCREASE_MEDIA_CONTENT_VIEW_COUNT:472},IMAGE:{PROFILE_IMAGE_ALBUM_ID:"profileimages",COVER_IMAGE_ALBUM_ID:"coverimages",FEED_IMAGE_ALBUM_ID:"default",FETCH_ALBUM_LIST:96,TYPE_ALBUM_IMAGES:97,TYPE_COMMENTS_FOR_IMAGE:89,TYPE_LIKES_FOR_IMAGE:93,TYPE_IMAGE_COMMENT_LIKES:196,TYPE_LIKE_IMAGE:185,TYPE_IMAGE_DETAILS:121,TYPE_EDIT_IMAGE_COMMENT:194,TYPE_ADD_IMAGE_COMMENT:180,TYPE_LIKE_UNLIKE_IMAGE_COMMENT:197,TYPE_DELETE_IMAGE_COMMENT:182,DELETE_IMAGE:246,TYPE_UPDATE_ADD_IMAGE_COMMENT:380,TYPE_UPDATE_EDIT_IMAGE_COMMENT:394,TYPE_UPDATE_DELETE_IMAGE_COMMENT:382,TYPE_UPDATE_LIKE_IMAGE:385,TYPE_UPDATE_UNLIKE_IMAGE:387,TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:397},PROFILE:{TYPE_CHANGE_COVER_PIC:103,TYPE_CHANGE_PROFILE_PIC:63,TYPE_REMOVE_PROFILE_IMAGE:43,TYPE_REMOVE_COVER_IMAGE:104,TYPE_ACTION_USER_MOOD:193,TYPE_ACTION_USER_MOOD_PRESENCE:199,FETCH_FRIEND_MUTUAL_FRIEND_LIST:118,CHANGE_PASSWORD:130,ACTION_USERS_PRESENCE_DETAILS:136,ACTION_USERS_PRESENCE_DETAILS_DATA:336,TYPE_ACTION_CURRENT_USER_BASICINFO:21,TYPE_ACTION_OTHER_USER_BASICINFO:95,TYPE_ACTION_GET_USER_DETAILS:204,TYPE_ACTION_LIST_WORK_AND_EDUCATIONS:230,TYPE_ACTION_MODIFY_USER_PROFILE:25,TYPE_ACTION_MODIFY_PRIVACY_SETTINGS:74,TYPE_CHANGE_PRIVACY:216,TYPE_CHANGE_FRIEND_PRIVACY:82,SEND_VERIFICATION_CODE_TO_MAIL:221,SEND_VERIFICATION_CODE_TO_PHONE:212,TYPE_ACTION_ADD_EDUCATION:231,TYPE_ACTION_UPDATE_EDUCATION:232,TYPE_ACTION_REMOVE_EDUCATION:233,TYPE_ACTION_GET_WORK:234,TYPE_ACTION_GET_EDUCATION:235,TYPE_ACTION_GET_SKILL:236,TYPE_ACTION_ADD_SKILL:237,TYPE_ACTION_UPDATE_SKILL:238,TYPE_ACTION_REMOVE_SKILL:239,TYPE_ACTION_ADD_WORK:227,TYPE_ACTION_UPDATE_WORK:228,TYPE_ACTION_REMOVE_WORK:229,ADD_SOCIAL_NETWORK:276},REPORT:{ACTION_SPAM_REASON_LIST:1001,ACTION_REPORT_SPAM:1002},HIDE_UNHIDE:{ACTION_HIDE_UNHIDE_FEED:187,ACTION_HIDE_UNHIDE_USER_FEED:203,ACTION_HIDE_UNHIDE_CIRCLE_FEED:310},FETCH_EMOTION_LIST:273},STICKER:{GET_MY_STICKER:206,ADD_REMOVE_STICKER:207,ADD_JT_VALUE:1,REMOVE_JT_VALUE:3}}),function(e,t){"use strict";e.module("ringid.language",[])}(angular,window),angular.module("ringid.language").factory("languageConstant",languageConstant);function languageConstant(){var e={"default":{add_friend:"Add Friend",remove_friend:"Remove Friend",common_friend:"Common Friend",request_sent:"Request Sent",unfriend:"Unfriend",block:"Block",unblock:"Unblock",edit:"Edit",update:"Update","delete":"Delete",cancel:"Cancel",save:"Save",text_add:"Add",accept:"Accept",remove:"Remove",change:"Change",send:"Send",verify:"verify",add:"Add"}};function t(t){e[t]={}}function n(t){var n=t||"default";return e[n]}return{set:t,get:n}}!function(e,t){"use strict";e.module("ringid.connector",["ngWebSocket","ringid.config"])}(angular,window),angular.module("ringid.connector").factory("$$rgsyncher",rgSynchar),rgSynchar.$inject=["$$stackedMap","$rootScope","Utils"];function rgSynchar(e,t,n){var r=e.createNew();function i(){r.length()>0&&o()}function o(){var e;r.doForAll(function(t){e=t.call(null),e&&!e.$$phase&&e.$digest()})}t.$on("ringActive",i);function a(e){var t=n.getUniqueID();return r.add(t,e),t}function s(e){return r.remove(e)}return{add:a,remove:s,synch:i}}angular.module("ringid.connector").service("mergerService",mergerService),mergerService.$inject=["$$q"];function mergerService(e){var t;function n(){var t=e.defer(),n={};function r(e){var r,i,o,a,s,c={};if(e.seq||e.totalPacket){if(r=e.pckId,n[e.pckId]||(n[e.pckId]=[]),t.notify(e),e.seq?(i=e.seq.lastIndexOf("/"),o=e.seq.substr(0,i),s=parseInt(e.seq.substr(i+1,e.seq.length),10)):(o=e.packetNo,s=parseInt(e.totalPacket,10)),n[e.pckId]["sq"+o])return!0;if(n[e.pckId]["sq"+o]=!0,n[e.pckId].push(e),s===n[e.pckId].length){for(a=0;a<n[e.pckId].length;a++)for(r in n[e.pckId][a])n[e.pckId][a][r]instanceof Array?c[r]=(c[r]||[]).concat(n[e.pckId][a][r]):c[r]=n[e.pckId][a][r];return t.resolve(c),delete n[e.pckId],!1}return!0}return t.resolve(e),!1}return{resolve:r,promise:t.promise}}return t={defer:n}}angular.module("ringid.connector").factory("$$connector",$$connector),$$connector.$inject=["settings","Storage","$rootScope","$websocket","$$stackedMap","ATTRIBUTE_CODES","Utils","$$q","OPERATION_TYPES","CLIENT_DATA_SIZE","mergerService","SystemEvents"];function $$connector(e,t,n,r,i,o,a,s,c,l,u,d){var g,E={},m=i.createNew(),T=[],f=0,p=i.createNew();function _(e){return function(t){var n;if(!t||!t.actn)return!1;if(!angular.isArray(e))return t.actn===e;for(n=0;n<e.length;n++)if(t.actn===e[n])return!0;return!1}}function I(e){var t;return E[e.pckId]===!0||!!E[e.pckId]&&(t=E[e.pckId].resolve.call(E[e.pckId],e),t||(E[e.pckId]=!!t,setTimeout(function(){delete E[e.pckId]},3e3)),!0)}function h(e){var t=!1;return m.length()>0&&m.doForAll(function(n){var r,i=n.filter;i?angular.isFunction(i)&&(r=i.call(null,e),r&&(t=!0,n.fn.call(n,e))):n.fn.call(null,e)}),t}function A(e){var t,n;if(e){if(e.actn===c.SYSTEM.AUTH.TYPE_INVALID_LOGIN_SESSION)return void h(e);e.hasOwnProperty("pckId")&&(t=I(e)),t||(n=h(e),n||T.push(e))}}function C(){return n.unloadWarn?"You have unsaved changes.  Do you want to leave this page and lose your changes?":angular.noop()}window.onbeforeunload=C;function S(){}function v(e,t,n,r){var i;i=e.pckId||a.getUniqueID(),e.pckId=i,n&&(E[i]=n),e&&RingWorker.send(e,i,t,r)}function M(e,t,n,r){var i=n?u.defer():s.defer();return v(e,t,i,r),i.promise}function D(){}function O(e,t,n){v(e,t,!1,n)}function R(e,t,n){return M(e,t,!1,n)}function N(e,t,n){return M(e,t,!0,n)}function P(e,t){var r,i,o=[],s=t||{};if(s.key=s.key||a.getUniqueID(),s.scope=s.scope||n,s.autoApply=!1,s.fn=e||angular.noop,!s.filter&&s.action&&(s.filter=_(s.action)),m.add(s.key,s),s.callWithUnresolved){for(r=0;r<T.length;r++)i=s.filter.call(null,T[r]),i?s.fn.call(null,T[r]):o.push(T[r]);T.length=0,T=o}return s.key}function y(e){m.remove(e)}function b(){}function U(){}function L(){}function F(e){var t=a.getUniqueID();return p.add(t,e),t}function k(e){p.remove(e)}function w(){RingWorker.pushMessage({command:"KEEPALIVE",aSkey:t.getCookie("sId"),uKey:t.getCookie("uId")})}function G(){RingWorker.pushMessage({command:"ROUTE_CHANGE"})}g={init:S,close:D,send:O,request:R,pull:N,subscribe:P,unsubscribe:y,stop:b,resume:U,reset:L,addInterval:F,removeInterval:k,keepAlive:w,notifyRouteChange:G},RingWorker.addCallback("received",function(e){A(e.data)}),RingWorker.addCallback("event",function(e){e.name&&n.$broadcast(e.name)}),RingWorker.addCallback("keepalivesent",function(e){var r;r=Math.ceil(6e4/e.intervel),f++,f>r&&(f=0,n.$broadcast("EVERY_MINUTE",{timeDiff:t.getCookie("stDiff")}))});function B(e){t.setCookie("stDiff",e),n.$broadcast("TIME_DIFFERENCE_CHANGED",{timeDiff:e})}return RingWorker.addCallback("timestamp-changed",function(e){var n,r,i=e.keepAliveTimeObject;r=t.getCookie("stDiff"),n=i.currentTime-i.serverTime,r?Math.abs(parseInt(n,10)-parseInt(r,10))>6e4&&B(n):B(n),a.triggerCustomEvent(d.COMMON.PONG,{timestamp:i.serverTime,diff:n})}),g}!function(e,t){"use strict";e.module("ringid.global_services",["ringid.config","ringid.connector","ringid.utils","ui-notification"])}(angular,window),angular.module("ringid.global_services").factory("$$userMap",userMap).factory("userFactory",userFactory),userMap.$inject=["settings","$$stackedMap","$filter","Utils","Storage","Contacts","$$q","Api","routeService"];function userMap(e,t,n,r,i,o,a,s,c){var l={0:"p",1:"desktop",2:"android",3:"iphone",4:"windows",5:"web"},u={fn:"",uId:0,cnty:"",el:"",gr:"",am:"",mblDc:"",mbl:"",prIm:"images/prof.png",cIm:"images/default_cover.jpg",prImId:0,cImId:0,cimX:0,cimY:0,bDay:"",blc:0,re:"",utId:0,tf:0,nmf:0,chta:0,cla:0,fda:0,cc:"",hc:"",adt:0,iev:0,imnv:0,isnp:0,isbusn:0,isceleb:0,isufhdn:!1,profileLink:"",psnc:0,lot:0,mood:0,apt:0,dt:"",frnS:0,ct:0,nct:0,pimX:0,pimY:0,bv:0,owner:0,basicInfo:!1,privacyInfo:{},lastPresenceCheck:0};function d(e,t,n,r){var i=this,o=!0;i.groups={},i.updateUserObj(e),i.isCurrent=n,i.isProfile=t,i.requestedMutualFriend=!1,i.loading=!1,i.user.psnc=i.isCurrent?2:i.user.psnc,i.user.dvc=i.isCurrent?5:i.user.dvc,e.hasOwnProperty("grpId")&&(i.groups[e.grpId]=e.admin),angular.isObject(e)&&"fetchDetails"in e&&!e.fetchDetails&&(o=!1),!o||i.user.prIm&&i.user.uId&&i.user.utId&&(i.user.nmf||!r)||i.requestUserDetails(!!r),e.psnc&&(i.user.lastPresenceCheck=Date.now())}d.prototype={updateUserObj:g,fetchPresence:E,requestUserDetails:m,getName:T,avatar:f,getProfileImage:se,getKey:p,getUId:et,setUid:_,getUtId:I,equals:h,link:He,getRingNumber:A,navActiveLink:C,toString:S,friendshipStatus:v,friendshipStatusText:M,isLoading:D,commonFriends:O,isCurrentUser:R,sortBy:N,getLiteUser:P,isAdmin:y,setGroupAdmin:b,removeGroupAdmin:U,overwriteInfo:L,haveProfileData:F,getBasicInfo:k,resetCover:w,getCover:G,getCoverXY:B,setCover:$,getAvatarXY:H,setProfileImage:x,setName:Y,setAboutMe:K,setHomeCity:j,setCurrentCity:V,setGender:W,setBirthday:q,setMarriageday:z,getEmail:Q,getMobileDc:X,getMobileNumber:Z,getCountry:J,friendType:ee,setFriendType:te,newFriendType:ne,getLink:re,resetAvatar:ie,avatarXY:oe,getBday:ae,getUserMood:ce,setUserMood:le,getAppType:ue,setAppType:de,getDeviceToken:ge,setDeviceToken:Ee,isBlocked:me,setBlock:Te,isFriend:fe,unFriend:pe,getAccess:_e,canChat:Ie,canSeeFeed:he,setOnlineStatus:Ae,getOnlineStatus:Ce,isOnline:Se,onlineDevice:ve,getPlatform:Me,setPlatform:De,hasLastOnline:Re,lastOnline:Oe,getLastOnlineTime:Ne,getProfileImageId:Pe,getCoverImageId:ye,isEmailVerified:be,isMobileVerified:Ue,isNewsPortalUser:Le,isBusinessPageUser:Fe,isCelebrityPageUser:ke,hide:we,isHidden:Ge,toggleMood:Be,hasDetails:$e,shouldUpdatePresence:xe};function g(e){var t=this,n=e||{};t.user?angular.extend(t.user,n):t.user=angular.extend({},u,n),n.grpId&&(t.groups[n.grpId]=n.admin),""===t.user.prIm&&(t.user.prIm="images/prof.png"),""===t.user.cIm&&(t.user.cIm="images/default_cover.jpg"),0===t.user.frnS&&(t.user.frnS=o.getFrns(t.user.utId).frnS||t.user.frnS),n.mfc&&(t.user.nmf=n.mfc),n.mutualFriends&&(t.user.nmf=n.mutualFriends),n.psnc&&(t.user.lastPresenceCheck=Date.now()),t.user.uId&&(t.user.uId=t.user.uId.toString()),t.user.futId&&(t.user.utId=t.user.futId),""===t.user.profileLink&&(t.profileLink=c.getRoute("PROFILE",{uId:t.user.uId,utId:t.user.utId})),n=null}function E(){var e=this;s.user.fetchUserPresence([this.user.utId]).then(function(t){return 1111===t.rc?void(e.user.psnc=0):(e.user.lastPresenceCheck=Date.now(),r.triggerCustomEvent("PRESENCE_UPDATE",t),void e.updateUserObj(t))})}function m(e){var t,n={},r=this,i=a.defer(),o=i.promise;return this.user.utId&&0!==parseInt(this.user.utId,10)?n.utId=this.user.utId:this.user.uId&&(n.uId=this.user.uId),n.utId||n.uId?(e&&(this.requestedMutualFriend=!0),t=s.user.getUserDetails(n,!!e,this.user.isnp),t.then(function(e){e.sucs&&r.updateUserObj(e.userDetails),i.resolve(e)})):o={sucs:!1,mg:"utId/uId not in request"},a.when(o)}function T(){return this.user.fn}function f(t){var n,r=t,i=this.user.prIm||"";return"iurl"===r?i:"original"===r?e.imBase+i:i.indexOf("prof.png")>0?i:(i=i.replace("profileimages/",""),"original"===r?r="":r||(r="crp"),r=(/\/uploaded\//.test(i)?"":"p")+r,n=i.lastIndexOf("/")+1,i=[e.imBase,i.slice(0,n),r,i.slice(n)].join(""),i.indexOf("prof.png")>0?this.user.prIm:i)}function p(){return this.user.utId||this.user.uId}function _(e){this.user.uId=e}function I(){return this.user.utId}function h(e,t){var n,r=t||"uId";return n=angular.isObject(e)?"uId"===r?e.getKey():e.getUtId():e,this.user[r]===n}function A(){return this.user.uId.toString().replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")}function C(){var e="";return(this.user.uId||this.user.utId)&&(e="/profile/"+this.user.uId+"/post"),e}function S(){return this.user.uId}function v(){var e;return e=0===this.user.frnS?o.getFrns(this.user.utId).frnS||this.user.frnS:this.user.frnS}function M(){var e;return 0===this.user.frnS?e="Add Friend":1===this.user.frnS?e="Friend":2===this.user.frnS?e="Pending":3===this.user.frnS&&(e="Request Sent"),e}function D(e){return"undefined"!=typeof e&&(this.loading=e),this.loading}function O(e,t){var n;return(!this.user.nmf&&!this.requestedMutualFriend||e)&&(n=this.requestUserDetails(!0)),t?n||a.when(this.user.nmf):this.user.nmf}function R(){return this.isCurrent}function N(){return this.user.adt}function P(){return this}function y(e){var t=!1;return this.groups.hasOwnProperty(e)&&(t=this.groups[e]),t}function b(e){this.groups[e]=!0}function U(e){delete this.groups[e]}function L(e){this.user.prIm=e.prIm||this.user.prIm}function F(){return this.isProfile}function k(){var e=this,t=r.profileVerbalDate(e.user.bDay),n=r.profileVerbalDate(e.user.mDay);return{fn:e.user.fn||"",birthDay:e.user.bDay||"",mDay:e.user.mDay||"",birthday:t,marriageDay:n,el:e.user.el||"",hc:e.user.hc.trim()||"",cc:e.user.cc.trim()||"",gr:e.user.gr||"",am:e.user.am.trim()||"",uId:e.user.uId.toString().substring(2)||""}}function w(){0!==this.user.cImId&&(this.user.cImId=0,s.user.removeCover(this.user.cIm)),this.user.cIm="images/default_cover.jpg"}function G(t){var n,r,i=this.user.cIm;return i&&i.length>0?"iurl"!==t&&(t&&"original"===t?i=e.imBase+i:i.indexOf("default")===-1&&(i.indexOf("web")>0?i=e.imBase+i:(n=(/\/uploaded\//.test(i)?"":"p")+(t||"crp"),r=i.lastIndexOf("/")+1,i=[e.imBase,i.slice(0,r),n,i.slice(r)].join("")))):i="images/default_cover.jpg",i}function B(){return{x:this.user.cimX,y:this.user.cimY}}function $(e){this.user.cIm=e.iurl,this.user.cimX=e.cimX,this.user.cimY=e.cimY,this.user.cImId=e.cImId}function H(){return{x:this.user.pimX,y:this.user.pimY}}function x(e,t){this.user.prIm=e,this.user.prImId=t}function Y(e){this.user.fn=e}function K(e){this.user.am=e}function j(e){this.user.hc=e}function V(e){this.user.cc=e}function W(e){this.user.gr=e}function q(e){this.user.bDay=e}function z(e){this.user.mDay=e}function Q(){return this.user.el}function X(){return this.user.mblDc}function Z(){return this.user.mbl}function J(){return this.user.cnty}function ee(){return this.user.ct}function te(e){this.user.ct=e}function ne(){return this.user.nct}function re(e){var t,n="";if(e)for(t in e)e.hasOwnProperty(t)&&(n+=t+'="'+e[t]+'" ');return"<a "+n+' href="'+this.link()+'">'+this.user.fn+"</a>"}function ie(){0!==this.user.prImId&&(this.user.prImId=0,s.user.removeAvatar(this.user.prIm)),this.user.prIm="images/prof.png"}function oe(){return{x:this.user.pimX,y:this.user.pimY}}function ae(){return this.user.bDay}function se(){return this.user.prIm}function ce(){return this.user.mood}function le(e){this.user.mood=e}function ue(){return this.user.apt}function de(e){this.user.apt=e}function ge(){return this.user.dt}function Ee(e){this.user.dt=e}function me(){return 0===this.user.cla&&0===this.user.chta&&0===this.user.fda?this.user.bv=1:this.user.bv=0,this.user.bv}function Te(e){var t;t=1===e?0:1,this.user.cla=t,this.user.chta=t,this.user.fda=t,this.user.bv=e}function fe(){return 1===this.user.frnS}function pe(){this.user.frnS=0}function _e(){return{chta:this.user.chta,cla:this.user.cla,fda:this.user.fda}}function Ie(){var e=!1;return 1===this.user.chta&&(e=!0),e}function he(){var e=!1;return 1===this.user.fda&&(e=!0),e}function Ae(e){this.user.psnc=e}function Ce(){return this.user.psnc}function Se(){return 2===this.user.psnc&&1===this.user.mood}function ve(){return l[this.user.dvc]}function Me(){return this.user.dvc}function De(e){this.user.dvc=e}function Oe(e){var t="";return 0!==this.user.lot&&(this.isOnline()?t="Online now":(t=r.verbalDate(this.user.lot,null,e),e||(t="Last Seen "+t))),t}function Re(){return!!this.user.lot}function Ne(){return this.user.lot}function Pe(){return this.user.prImId}function ye(){return this.user.cImId}function be(){return this.user.iev}function Ue(){return this.user.imnv}function Le(){return this.user.isnp}function Fe(){return this.user.isbusn}function ke(){return this.user.isceleb}function we(e){return this.user.isufhdn=!!e,this.user.isufhdn}function Ge(){return!!this.user.isufhdn}function Be(e){this.user.mood=e?1:2,s.user.changeMood(this.user.mood).then(function(e){e.sucs!==!0&&(this.user.mood=e.mood)})}function $e(){return!!(this.user.prIm&&this.user.uId&&this.user.utId&&this.user.fn)}function He(){return this.profileLink}function xe(){return Date.now()-this.user.lastPresenceCheck>60*e.USERS_PRESENCE_REFRESH_INTERVAL*1e3}function Ye(e,t,n,r){var i=this;d.call(i,e,t,n,r,!0),i.user.isceleb=!0}function Ke(){return this.getName()}function je(){return this.user.celebInfo&&this.user.celebInfo.cat||""}function Ve(){return this.user.celebInfo&&this.user.celebInfo.fcount}function We(){return this.user.celebInfo?this.user.celebInfo.fcount>1?this.user.celebInfo.fcount+" followers":this.user.celebInfo.fcount+" follower":""}function qe(e){this.user.celebInfo.isFollower=e}function ze(){return this.user.celebInfo&&this.user.celebInfo.isFollower}function Qe(){return 1===this.user.prImPr?this.avatar():"../../../images/test/1.png"}function Xe(){return 1===this.user.prImPr&&this.user.prIm!==u.prIm?this.avatar():"../../../images/test/2.png"}function Ze(){return this.user.pType}function Je(){return this.user.ringID}function et(){return this.user.uId}function tt(){return c.getRoute("CELEBRITY",{portalid:this.user.utId})}return Ye.prototype=Object.create(d.prototype),Ye.prototype.getFullName=Ke,Ye.prototype.getCategoryName=je,Ye.prototype.getFollowerCount=Ve,Ye.prototype.getFollowerCountWithText=We,Ye.prototype.isSubscribed=ze,Ye.prototype.setIfSubscribed=qe,Ye.prototype.getProfileImage=Qe,Ye.prototype.getFollowAndSliderImage=Xe,Ye.prototype.getPType=Ze,Ye.prototype.getRingID=Je,Ye.prototype.getProfileLink=tt,Ye.prototype.link=tt,Ye.prototype.constructor=Ye,function(e,t,n,r,i){return i?new Ye(e,t,n,r):new d(e,t,n,r,i)}}userFactory.$inject=["$$userMap","$$stackedMap","$$connector","OPERATION_TYPES","Api","settings","Utils"];function userFactory(e,t,n,r,i,o,a){var s=t.createNew(),c={},l={},u=-1,d=new LRUCache(100),g=r.SYSTEM.PROFILE,E=o.USERS_PRESENCE_REFRESH_INTERVAL,m="ru_",T={getSortIndex:f,create:p,createByUtId:_,createCelebrityUser:h,createByUtIdButDontFetchDetails:I,getUser:A,getByUtId:C,getAllUtIds:S,getUIdByUtId:v,getUtIdByUId:M,trackUserUsage:O,unTrackUserUsage:R,updateLRUUserPresence:N,refreshPesence:b,initPresenceRefresh:y};U();function f(){return"adt"}function p(t,n,r,i){var o,a,u=!!n,d=!!i,g=!!r;return t.futId&&(t.utId=t.futId),angular.isObject(t)?t.uId?(t.uId=t.uId.toString(),o=t.uId,a=l[o]||!1):t.utId?(a=c[t.utId]||!1,a||(o=m+t.utId,a=s.get(o))):a=!1:(o=m+t,a=c[t]||!1||l[t]||!1||s.get(o)),a===!1?(a=e(t,u,g,!1,d),a.getUtId()&&(c[a.getUtId()]=a),a.getUId()&&(l[a.getUId()]=a)):a.updateUserObj(t),o=m+a.getKey(),s.save(o,a),a}function _(t,n,r){return c[t.utId]||(c[t.utId]=e(t,!1,!1,r)),n?c[t.utId].getLiteUser():c[t.utId]}function I(e,t){var n,r={utId:e,fetchDatails:!1},i=T.create(r);return i.hasDetails()?t&&t({fetchedDetails:!1}):i.requestUserDetails().then(function(e){n={sucs:e.sucs,fetchedDetails:!0,rc:e.rc},t&&t(n)}),i}function h(t,n){var r=n||!1;return delete c[t.utId],c[t.utId]||(c[t.utId]=e(t,r,!1,!1,!0)),c[t.utId]}function A(e){var t=m+e;return c[e]||!1||l[e]||!1||s.get(t)}function C(e){return e&&c[e]||!1}function S(){return Object.keys(c)}function v(e){return c[e]&&c[e].getUId()}function M(e){var t;try{t=T.getUser(e)}catch(n){}return t&&t.getUtId()}function D(e,t){var n=d.get(e),r=t?-1:1;n?(n.count+=r,n.count<=0&&d.remove(e)):t||d.put(e,{count:0}),20===d.size&&y()}function O(e){D(e,!1)}function R(e){D(e,!0)}function N(){var e=[];d.forEach(function(t){e.push(t)}),i.user.fetchUserPresence(e)}function P(e){var t=e;e||s.doForAll(function(e){t.push(e.getUtId())}),i.user.fetchUserPresence(t)}function y(){u=0,b()}function b(e){var t,n=Date.now(),r=[];t=n-u,u!==-1&&(e||!u||t>60*E*1e3)&&(s.doForAll(function(e){r.push(e.getUtId())}),r.length>100?N():P(r),u=n)}function U(){n.subscribe(function(e){switch(e.actn){case g.ACTION_USERS_PRESENCE_DETAILS_DATA:p(e),a.triggerCustomEvent("PRESENCE_UPDATE",e)}},{action:[g.ACTION_USERS_PRESENCE_DETAILS_DATA]})}return T}angular.module("ringid.global_services").service("userService",userService),userService.$inject=["userFactory","Utils"];function userService(e,t){var n=this,r={},i={},o={},a={},s=!1;n.register=c,n.trigger=l,n.unregister=u,n.fetchUser=d,n.start=g;function c(e,o,a,s){var c=arguments,l=t.getUniqueID("us"),u=n;return e?(r[e]||(r[e]=[]),i[l]=function(){o.call(a,c),("undefined"==typeof s||s)&&u.unregister(l)},r[e].push(l),n.start()):l=!1,l}function l(e,t){var n=[];r[e]&&(r[e].forEach(function(e){i[e]&&(i[e].call(null,t),i[e]&&n.push(e))}),r[e]=n)}function u(e){i[e]&&delete i[e]}function d(t){o[t]||(o[t]=!0,e.createByUtIdButDontFetchDetails(t,function(){delete o[t],n.start()}),n.start())}function g(){var t,i,o,c;function l(){for(o=Object.keys(r),i=0;i<o.length;i++)t=o[i],a[t]||(a[t]=1),a[t]>3?n.trigger(t,{sucs:!1,timeout:!0}):(c=e.getUser(t),c&&c.hasDetails()?n.trigger(t,{sucs:!0,timeout:!1}):n.fetchUser(t));s=!1}s||(s=!0,setTimeout(l))}}angular.module("ringid.global_services").factory("Utils",UtilsFactory),UtilsFactory.$inject=["$window","$document","RING_ROUTES","$filter","APP_CONSTANTS","$$q","Storage","$rootScope","MESSAGES","SystemEvents","GlobalEvents","$ringhttp","settings","$location"];function UtilsFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,E){var m,T,f,p=500,_={x:0,y:0,yo:0};function I(){var n=e,r=t,i=r[0].documentElement,o=r[0].getElementsByTagName("body")[0];return _.x=n.innerWidth||i.clientWidth||o.clientWidth,_.y=n.innerHeight||i.clientHeight||o.clientHeight,_.yo=n.pageYOffset,_}I();function h(e,t,n,r){var i=1;return(e>n||t>r)&&(i=Math.min(n/e,r/t)),{width:e*i,height:t*i}}function A(t){return(t||"")+(window._cti||"")+e.Math.floor(e.Math.random()*(new e.Date).getTime())}function C(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0),n.data=t,document.dispatchEvent(n)}function S(e,t){function n(e){t.call(this,e.data||{})}return document.addEventListener(e,n),n}function v(e,t){document.removeEventListener(e,t)}function M(e){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function D(){var e,t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*(t+Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)})}function O(){var e,t,n,r;return e=document.createElement("p"),e.style.width="100%",e.style.height="200px",t=document.createElement("div"),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t),n=e.offsetWidth,t.style.overflow="scroll",r=e.offsetWidth,n===r&&(r=t.clientWidth),document.body.removeChild(t),e=t=null,n-r}function R(e){return r("date")(e,"yyyy-MM-dd")}function N(e){var t=e.split(","),n=new Uint8Array(t);return n.buffer}function P(e){var t=new Uint8Array(e);return Array.prototype.join.call(t,",")}function y(t,n,i){var o,a,s,c=e.Math,l=t,u=n||Date.now(),d="",g="",E=new Date;if(isNaN(l)?(o=new Date((l||"").replace(/-/g,"/").replace(/[TZ]/g," ")),l=o.getTime()):o=new Date(l),a=(u-l)/1e3,s=c.floor(a/86400),isNaN(s))return"";switch(!0){case s<1:switch(!0){case a<60:d=c.floor(a)+"s",g="Just now";break;case a<120:d="1m",g="1 minute ago";break;case a<3600:d=c.floor(a/60)+"m",g=c.floor(a/60)+" minutes ago";break;case a<7200:d="1h",g="1 hour ago";break;case a<86400:d=c.floor(a/3600)+"h",g=c.floor(a/3600)+" hours ago";break;default:d=r("date")(l,"h")+"h",g=r("date")(l,"MMM d, h:mm a")}break;case 1===s:d="1d",g="Yesterday at "+r("date")(l,"h:mm a");break;case s<7:d=c.floor(s)+"d",g=r("date")(l,"EEEE 'at' h:mm a");break;case s<30:d=c.floor(s)+"d",g=r("date")(l,"EEEE 'at' h:mm a");break;case s<365:d=c.floor(s/30)+"M",E.getUTCFullYear()===o.getUTCFullYear()&&(g=r("date")(l,"MMMM d 'at' h:mm a")),g=r("date")(l,"MMMM d yyyy 'at' h:mm a");break;case s>365:d=c.floor(s/365)+"y",g=r("date")(l,"MMM d, yyyy");break;default:d=r("date")(l,"d")+"d",g=r("date")(l,"MMM d, yyyy")}return i?d:g}function b(){var e;return _||I(),e=_.x,e<=1270?1:e>1270&&e<1695?2:3}function U(e,t,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||e.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}}function L(e){var t,n,r,i,o,a=";base64,";if(e.indexOf(a)===-1)return t=e.split(","),i=t[0].split(":")[1],o=decodeURIComponent(t[1]),new Blob([o],{type:i});for(t=e.split(a),i=t[0].split(":")[1],o=window.atob(t[1]),r=new Uint8Array(o.length),n=0;n<o.length;++n)r[n]=o.charCodeAt(n);return new Blob([r],{type:i})}function F(e){return r("date")(e,"h:mm a")}function k(e,t,n){var r=n,o="https://maps.googleapis.com/maps/api/staticmap?center={0},{1}&zoom=18&size=640x170&key={3}&markers=color:orange|label:A|{2}|{0},{1}";return r||(r="({0},{1})".format(e,t)),o=o.format(e,t,r,i.GOOGLE_MAP_KEY)}function w(e,t,n,r){var i;return i=e&&t?"https://maps.google.com/maps?q={0},{1}&hl=en;z=18;iwd=1".format(e,t):"http://maps.google.com?q={0}".format(n),r&&(i+="&output=embed"),i}function G(e){var t=o.defer(),n=t.promise,r=a.getData("uLocationInfo");return r&&r.lat?(r.sucs=!0,n=r):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var r,i=n.coords.latitude,o=n.coords.longitude,s={lat:i,lng:o};e?(r=new google.maps.Geocoder,r.geocode({location:s},function(e,n){n===google.maps.GeocoderStatus.OK?(a.setData("uLocationInfo",{lat:i,lng:o,description:e[1].formatted_address}),t.resolve({sucs:!0,lat:i,lng:o,description:e[1].formatted_address})):(a.setData("uLocationInfo",{lat:i,lng:o}),t.resolve({sucs:!0,lat:i,lng:o}))})):(a.setData("uLocationInfo",{lat:i,lng:o}),t.resolve({sucs:!0,lat:i,lng:o}))},function(e){t.resolve({sucs:!1,error:e})}),o.when(n)}function B(){return document.title}function $(e,t){document.title=e,t&&s.$broadcast("PAGE_TITLE_CHANGE",{title:e})}function H(e){return e.mg?e.mg:x(e.rc)}function x(e){return c["RC"+e]?c["RC"+e]:""}function Y(){var e=b(),t=parseInt(a.getCookie("col"),10);return!t||t>e||"/"!==E.path()?e=e>2?2:e:t}function K(){m=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,T=0,f=-1*m}function j(){var e=Math.easeIn(T,m,f,p);T+=25,document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e,T<p&&requestAnimationFrame(j)}function V(e){return d.get(g.ogServiceUrl+"?url="+encodeURIComponent(e))}function W(e){var t=o.defer(),n=new Image;return n.onload=function(){t.resolve({imgUrl:this.src,width:this.width,height:this.height})},n.src=e,setTimeout(function(){t.resolve({width:0,height:0})},3e4),t.promise}function q(e,t){var n=o.defer(),r=[];return t.width||(t.width=0),t.height||(t.height=0),angular.forEach(e,function(i){setTimeout(function(){W(i).then(function(i){var o,a;i.width&&i.width>=t.width&&(o=!0),i.height&&i.height>=t.height&&(a=!0),o&&a&&(r.push(i.imgUrl),r.length===e.length?n.resolve(i.imgUrl):n.notify(i.imgUrl))})})}),setTimeout(function(){0===r.length&&n.resolve([])},2e4),n.promise}function z(e){var t,n,r;for(t=e.length;t;t--)r=Math.floor(Math.random()*t),n=e[t-1],e[t-1]=e[r],e[r]=n;return e}function Q(e){var t=!1;try{t=e[Math.floor(Math.random()*e.length)]}catch(n){t=!1}return t}function X(e){a.setCookie("col",parseInt(e,10))}function Z(e){var t,n=_.x,r=400,i=10,o=410,a=600,s=30,c=n-r-s-i*e;return t=c/e,!(t<o)&&Math.min(t,a)}function J(e){requestAnimationFrame(function(){I(),s.windowHeight=_.y,s.windowWidth=_.x,s.$broadcast(l.COMMON.WINDOW_RESIZED,_)}),e.preventDefault()}u.bindHandler("window","resize",J);function ee(e){requestAnimationFrame(function(){I(),s.windowHeight=_.y,s.windowWidth=_.x,s.$broadcast(l.COMMON.WINDOW_SCROLLED,_)}),e.preventDefault()}return u.bindHandler("window","scroll",ee),{generateUUID:D,tabId:window._cti,viewport:_,viewportsize:I,scrollbarWidth:O(),getUniqueID:A,triggerCustomEvent:C,onCustomEvent:S,removeCustomEvent:v,profileVerbalDate:R,verbalDate:y,getScaledImageSize:h,debounce:U,dataURLToBlob:L,string2ArrayBuffer:N,arrayBuffer2String:P,safeDigest:M,chatVerbalDate:F,getGoogleMapJSUrl:w,getGoogleMapStaticUrl:k,getUserLocation:G,getCurrentPageTitle:B,setPageTitle:$,getReasoneMessage:x,getReasonMessageFromResponse:H,getDefaultColumn:b,feedColumn:Y,animateScroll:j,resetScroll:K,getOGDetails:V,filterImagesByDimentions:q,setFeedColumn:X,calCulateCellWidth:Z,shuffleArray:z,getRandomItem:Q}}angular.module("ringid.global_services").factory("$ringhttp",ringhttp),ringhttp.$inject=["settings","$templateCache"];function ringhttp(e,t){var n=(new Date).getTime(),r={};function i(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.response}return[t,e]}function o(o,a,s,c){var l,u,d=!1,g=0,E=a,m={success:angular.noop,error:angular.noop,abort:angular.noop,progress:angular.noop},T={success:function(e){return m.success=e,T},error:function(e){return m.error=e,T},abort:function(e){return m.abort=e,T},progress:function(e){return m.progress=e,T},abortRequest:function(){l.abort()}};u=/^(http|https):\/\//.test(a)?a:e.baseUrl+(0===a.indexOf("/")?a:"/"+a);try{l=new XMLHttpRequest,d="GET"===o&&/\.html$/.test(u),d&&r.hasOwnProperty(E)?r[E].push(m):d&&t.get(E)?setTimeout(function(){m.success.call(null,t.get(E),l)}):(d&&(u=u+"?time="+n,r[E]=[],r[E].push(m)),l.open(o,u,!0),l.responseType=c||"text",l.onreadystatechange=function(){var e;4===l.readyState&&(200===l.status?(e=i(l),d?(t.put(E,e[0]),r[E].forEach(function(e){e.success.call(null,t.get(E),l)}),delete r[E]):(m.progress.call(null,100),m.success.call(null,e[0]))):m.error.call(null,e))},l.upload.onabort=function(){m.abort.call(null)},l.upload.onprogress=function(e){g=Math.round(e.loaded/e.total*100),g=g>0?g-1:g,m.progress.call(null,g)},l.send(s))}catch(f){}return T}return{get:function(e,t,n){return o("GET",e,t,n)},post:function(e,t,n){return o("POST",e,t,n)}}}angular.module("ringid.global_services").factory("GlobalEvents",GlobalEvents);function GlobalEvents(){var e={};function t(e){var t=!1;return"click"===e.type&&e.target.tagName&&("input"===e.target.tagName.toLowerCase()||"a"===e.target.tagName.toLowerCase()||e.target.parentNode&&e.target.parentNode.tagName&&"a"===e.target.parentNode.tagName.toLowerCase())&&(t=!0),t}function n(n){var r,i,o;if(!t(n))for(o=e[n.type].length-1;o>=0&&(r=e[n.type][o].call(null,n),i=/^function\s+([\w\$]+)\s*\(/.exec(e[n.type][o].toString()),!r);o--);}function r(t,r,i){if(e.hasOwnProperty(r)||(e[r]=[]),e[r].push(i),1===e[r].length)switch(t){case"document":document.addEventListener(r,n);break;case"window":window.addEventListener(r,n);break;default:document.addEventListener(r,n)}}function i(t,r,i){setTimeout(function(){var o=e[r].indexOf(i);if(o>=0&&e[r].splice(o,1),0===e[r].length)switch(t){case"document":document.removeEventListener(r,n);break;case"window":window.removeEventListener(r,n);break;default:document.removeEventListener(r,n)}})}return{bindHandler:r,unbindHandler:i}}angular.module("ringid.global_services").factory("Ringalert",Ringalert),Ringalert.$inject=["$ringbox","Notification","MESSAGES"];function Ringalert(e,t,n){var r={delay:3e3,
positionX:"right",positionY:"top",replaceMessage:!0},i={title:"Warning",message:"Click ok to continue",showOk:!0,showCancel:!0,craac:!1,textOk:"OK",textCancel:"Cancel",okCallback:angular.noop,cencelCallback:angular.noop};function o(e,i){var o,a=i||"info";o=angular.isString(e)?{message:e}:e,o.message=o.message||o.mg,o.message||("success"===a?o.message=n.REQUEST_PROCESSED:"error"===a&&(o.message=n.REQUEST_FAILED));try{t[a](angular.extend({},r,o))}catch(s){}}function a(){t.clearAll()}function s(t){var n,r=t||{};r=angular.extend({},i,r),n=e.open({type:"remote",scope:!1,scopeData:r,templateUrl:r.templateUrl||"templates/popups/ring-alert.html"}),n.result.then(function(e){var t="string"==typeof e?e:e.sucs;"ok"===t&&angular.isFunction(r.okCallback)?r.okCallback.call(null,e):r.cencelCallback.call(null,e)})}return{show:o,clear:a,alert:s}}angular.module("ringid.global_services").factory("$$stackedMap",function(){return{createNew:function(e,t){var n,r,i,o=[],a=this;n=e||!1,r=t||"desc";function s(e){var t=e||"sortBy",n=-1,i=1;"desc"===r&&(n=1,i=-1),o.sort(function(e,r){return r.value[t]()>e.value[t]()?n:e.value[t]()>r.value[t]()?i:0})}function c(e){var t;for(t=0;t<o.length;t++)if(e==o[t].key)return t;return-1}function l(e){var t=c(e);return t!==-1&&t!==o.length-1&&o[t+1].value}function u(e){var t=c(e);return t!==-1&&0!==t&&o[t-1].value}function d(e){o=o.concat(e)}function g(){o=[]}function E(){return o}function m(e){o=e}function T(e,t){return o.push({key:e,value:t}),n!==!1&&s(),!1}function f(e){return l(e)}function p(e){return u(e)}function _(e,t){return!(!o.length||!(e>=0||e<o.length))&&(t?o[e]:o[e].value)}function I(e){var t=c(e);return t>=0&&o[t].value}function h(e,t){var r;r=c(e),r===-1?i.add(e,t):o[r]={key:e,value:t},n!==!1&&s()}function A(e,t){e&&(r=e),s(t)}function C(){var e,t=[];for(e=0;e<o.length;e++)t.push(o[e].key);return t}function S(e,t){var n;return n=c(e),n!==-1&&(o[n].key=t),o[n]}function v(e,t){return"function"==typeof e[t]?e[t]():e[t]}function M(e){var t,n=[];for(t=0;t<o.length;t++)e?n.push(v(o[t].value,e)):n.push(o[t].value);return n}function D(e){var t=!!e;return!!o.length&&(t?o[o.length-1]:o[o.length-1].value)}function O(e){var t=!!e;return!!o.length&&(t?o[0]:o[0].value)}function R(e,t){var n=e,r=t;return r||(r=0),(n>o.length||!n)&&(n=o.length),o.slice(r,n)}function N(e){var t=c(e);return t>-1&&(o.splice(t,1),!0)}function P(){return o.splice(o.length-1,1)[0]}function y(){return o.length}function b(){var e=0;return angular.forEach(o,function(t){e+=t.closedBox?1:0}),e}function U(){var e,t=a.createNew(n,r);for(e=0;e<o.length;e++)t.add(o[e].key,o[e].value);return t}function L(e){o.unshift(e)}function F(){return o.pop()}function k(e){var t;for(t=0;t<o.length;t++)e.call(null,o[t].value)}return i={concat:d,reset:g,all:E,setStack:m,add:T,next:f,previous:p,getByIndex:_,getIndex:c,get:I,save:h,sort:A,keys:C,replaceKey:S,values:M,top:D,bottom:O,sliceBy:R,remove:N,removeTop:P,length:y,nonClosedLength:b,copy:U,addAtFirst:L,removeAndReturnLastElement:F,doForAll:k}}}}),angular.module("ringid.global_services").factory("Auth",AuthFactory),AuthFactory.$inject=["SystemEvents","$rootScope","Storage","Utils","$$q","$ringhttp","settings","OPERATION_TYPES","userFactory","$ringbox","Ringalert","$$connector","Api"];function AuthFactory(e,t,n,r,i,o,a,s,c,l,u,d,g){var E,m=n.getCookie("sessionID"),T=["/templates/dropdowns/notification-dropdown.html","/templates/dropdowns/friend-request-dropdown.html","/templates/partials/emoticon-window.html","/templates/dropdowns/circle-list-dropdown.html","/templates/dropdowns/search-dropdown.html","/templates/partials/hovercards/profile-hover.html","/templates/partials/notification/image-popup.html","/templates/partials/notification/media-popup.html","/templates/partials/notification/feed-popup_with_image.html","/templates/partials/stickers/popups/sticker-market.html"],f=!0,p=!1,_=s.SYSTEM.AUTH,I=s.SYSTEM.REQUEST_TYPE,h={},A=[],C={code:"+880",flagcode:"b880"},S=n.getCookie("sId"),v=n.getCookie("uId"),M=n.getCookie("utId"),D=r.generateUUID();t.$on("ringActive",function(){Cookies.get("sessionID")!==m&&window.location.reload()});function O(e,t,n){var i,o={};switch(e){case"fetchRecoverOptions":o.actn=_.PASSWORD_RECOVER_OPTIONS,o.did=D,o.rb=t.mblDc+t.mbl,o.mbl=t.mbl,o.mblDc=t.mblDc,o.vsn=a.apiVersion,o.wk=r.getUniqueID(),o.lt=2;break;case"recoveryVerifyCode":o.actn=_.PASSWORD_RECOVER_VERIFY_CODE,o.uId=t.uId,o.vc=t.vc,o.wk=r.getUniqueID(),o.lt=1;break;case"recoverySendCode":o.actn=_.PASSWORD_RECOVER_SEND_CODE,o.wk=r.getUniqueID(),n?(o.lt=2,o.rb=t.mblDc+t.mbl,o.mbl=t.mbl,o.mblDc=t.mblDc):(o.lt=3,o.rb=t.email,o.el=t.email.utf8Encode());break;case"resetPassword":o.actn=_.PASSWORD_RECOVER,o.uId=t.uId,o.nPw=t.password,o.wk=r.getUniqueID(),o.lt=1;break;case"isValidSession":o.actn=_.TYPE_SESSION_VALIDATION,o.dvcc=5,o.utId=M,o.did=D;break;case"logout":o.actn=_.TYPE_SIGN_OUT;break;case"validSocialId":i="facebook"===t.platform?a.signupSocialInit+"fb="+t.id+"&lt=4":a.signupSocialInit+"twtr="+t.id+"&lt=5",o=i+"&time="+Date.now();break;case"signupSendCode":o.wk=r.getUniqueID(),o.uId=t.uId,o.did=t.did,o.lt=1,"email"===t.authMethod?(o.el=t.email.utf8Encode(),o.actn=_.SIGNUP_SEND_CODE_EMAIL):(o.actn=_.SIGNUP_SEND_CODE_PHONE,o.mbl=t.mbl,o.mblDc=t.mblDc);break;case"signupVerifyCode":o.wk=r.getUniqueID(),o.uId=t.uId,o.did=t.did,o.lt=1,"email"===t.authMethod?(o.actn=_.SIGNUP_SEND_CODE_EMAIL,o.el=t.email.utf8Encode(),o.evc=t.vc):(o.actn=_.SIGNUP_SEND_CODE_PHONE,o.mbl=t.mbl,o.mblDc=t.mblDc,o.vc=t.vc);break;case"signup":switch(o.actn=_.SIGNUP_REGISTER,o.wk=r.getUniqueID(),o.uId=t.uId,o.did=t.did,o.nm=t.name.utf8Encode(),o.usrPw=t.password,o.lt=1,o.ispc=0,o.mbl=t.mbl,o.mblDc=t.mblDc,t.authMethod){case"email":o.el=t.email.utf8Encode(),o.evc=t.vc;break;case"facebook":o.fb=t.id,o.it=t.access_token,o.lt=4;break;case"twitter":o.twtr=t.id,o.it=t.access_token,o.lt=5;break;default:o.mbl=t.mbl,o.mblDc=t.mblDc,o.vc=t.vc}break;case"login":if(t.hasOwnProperty("silent")&&t.silent===!0)o.actn=_.TYPE_SIGN_IN,o.vsn=a.apiVersion,o.wk=r.getUniqueID(),o.dvc=5,o.tbid=r.tabId;else{switch(o.actn=_.TYPE_SIGN_IN,o.vsn=a.apiVersion,o.usrPw=t.password,o.lt=1,o.sn=a.apiVersion,o.wk=r.getUniqueID(),o.dvc=5,o.tbid=r.tabId,o.did=t.did,t.authMethod){case"ringid":o.lt=1,o.uId=t.silent?t.ringid:"21"+t.ringid;break;case"email":o.lt=3,o.el=t.email.utf8Encode();break;case"facebook":o.uId=t.uId,o.pen=1,o.lt=4,o.apt=1,o.smid=t.id,o.it=t.access_token,delete o.usrPw;break;case"twitter":o.uId=t.uId,delete o.usrPw,o.smid=t.id,o.it=t.access_token,o.lt=5;break;default:o.lt=2,o.mbl=t.mbl,o.mblDc=t.mblDc}t.salt&&t.sId&&(o.salt=t.salt,o.sId=t.sId)}break;default:o=t}return o}function R(e){return E._currentUser=e,e}function N(e){e&&(E.loginData=e,n.setData("loginData",e))}function P(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function y(e){P("uId"),P("utId"),P("sId"),P("authServer"),P("comPort"),P("la"),P("col"),e||(P("sessionID"),m=void 0),P("la")}function b(e,t){n.setCookie("uId",e.uId||"",t),n.setCookie("sId",e.sId||"",t),n.setCookie("utId",e.utId||"",t),t&&n.setCookie("la",(new Date).getTime(),t),e.authServer&&n.setCookie("authServer",e.authServer||"",t),e.comPort&&n.setCookie("comPort",e.comPort||"",t)}function U(e,t){e&&(y(),n.reset()),t?setTimeout(function(){window.location="/?rand="+r.getUniqueID()},e):setTimeout(function(){window.location="/"},e)}function L(e,t,r){var i;try{switch(i={usrPw:t.authEPassword,salt:t.authESalt,sId:t.sId,lt:e.lt},e.lt){case 1:i.uId=t.authEUsername;break;case 2:i.mbl=t.authEUsername,i.mblDc=e.mblDc;break;case 3:i.el=t.authEUsername}n.setData("remInfo",i),n.setCookie("sessionID",n.getCookie("sessionID"),r)}catch(o){}}function F(e,t){var n=i.defer();return o.get(a.signupInit+"did="+D+"&time="+(new Date).getTime()).success(function(r){r.success===!0?(b({uId:r.ringID,authServer:r.authServerIP,comPort:r.comPort}),angular.extend(e,{uId:r.ringID,did:D}),t?n.resolve(e):d.request(O("signupSendCode",e),I.AUTHENTICATION).then(function(e){n.resolve(angular.extend(e,{uId:r.ringID}))},function(e){n.reject(e)})):n.reject(r)}).error(function(){n.reject()}),n.promise}function k(e,t){p=!0,e.did=D,d.request(O("login",e),I.AUTHENTICATION).then(function(r){p=!1,r.sucs===!0?(E._validSession=!0,e.remember?(L(e,r,30),n.setData("remember",!0)):(n.deleteData("remInfo"),n.deleteData("remember")),e.authMethod&&n.setData("activeTab",e.authMethod),de(r,!0),t.resolve(r)):(E._validSession=!1,t.reject(r))},function(n){n.sucs===!1&&1111===n.rc?k(e,t):(E._validSession=!1,p=!1,t.reject({sucs:!1,mg:"Reqeust Failed"}))})}function w(){var e=n.getData("loginData");!e||window.hasOwnProperty("ringLoggedIn")&&!window.ringLoggedIn?ue():de(e)}function G(e){switch(e.actn){case _.TYPE_MULTIPLE_SESSION:p||u.alert({title:"Signed Out!",message:"You are signed in from another device",showCancel:!1,okCallback:function(){ue(!0)}});break;case _.TYPE_INVALID_LOGIN_SESSION:p?ue(!0):E.loginFromLocalData();break;case _.TYPE_SESSION_VALIDATION:p||(E.isLoggedIn()?ue(!0):E.loginFromLocalData())}}function B(){return d.request({actn:_.PHN_MAIL_VERIFICATION_CHECK},I.REQUEST)}function $(){var e,t=i.defer();return f?e=setInterval(function(){f||(clearInterval(e),E._validSession?t.resolve():t.reject())},1e3):t.resolve(),t.promise}function H(){return f}function x(e){return angular.extend(e,{did:D}),d.request(O("signupVerifyCode",e),I.AUTHENTICATION)}function Y(e){var t=i.defer();return angular.extend(e,{did:D}),d.request(O("signup",e),I.AUTHENTICATION).then(function(e){t.resolve(e)},function(){t.reject()}),t.promise}function K(e,t){var n=i.defer();o.get(O("socialData")).success(a).error(r);function r(){n.reject({rc:0,mg:"Request Failed"})}function a(r){r.success===!1&&2===r.rc?(l.open({type:"remote",scope:!1,controller:"SignUpController",resolve:{localData:{socialData:e,credentials:t},remoteData:angular.noop},templateUrl:"templates/welcome/ring-signup-popup.html"}),n.resolve()):n.reject({rc:"dologin",mg:"Already Registered Social ID"})}return n.promise}function j(e,t){var r=i.defer();if(t)angular.extend(e,{did:D}),o.get(O("validSocialId",e)).success(s).error(a);else{switch(e.authMethod){case"email":n.setData("autoFill",e.email);break;case"ringid":n.setData("autoFill",e.ringid);break;case"phone":n.setData("autoFill",e.mbl)}k(e,r)}function a(){r.reject({rc:0,mg:"Request Failed"})}function s(t){t.success===!0||"true"===t.success?(b({uId:t.ringID,authServer:t.authServerIP,comPort:t.comPort}),e.uId=t.ringID,e.authMethod=e.platform,k(e,r)):r.reject({rc:"invalidsocialid",mg:"Unregistered Social ID. Please Register."})}return r.promise}function V(){E.isLoggedIn()&&(t.$broadcast(e.LOADING,!0),d.request(O("logout"),I.AUTHENTICATION).then(function(n){t.$broadcast(e.LOADING,!1),ue(!0)})),setTimeout(function(){ue(!0)},1e3),d.stop()}function W(){var e={remember:!0,silent:!0},t=n.getData("remInfo");!p&&t&&(t.uId||t.el||t.mbl)?(angular.extend(e,t),E.login(e).then(i,r)):ue(!0);function r(){ue(!0)}function i(e){e.sucs?de(e):ue(!0)}}function q(){return E._currentUser}function z(){return!!E._currentUser&&!!n.getCookie("sId")&&!!n.getCookie("sessionID")}function Q(){var e=i.defer();M&&S&&v?d.request(O("isValidSession")).then(n,t):e.reject(E._validSession);function t(){e.reject(E._validSession)}function n(t){t.sucs?(E._validSession=!0,e.resolve(t)):(E._validSession=!1,e.reject(t))}return e.promise}function X(){var e=n.getData("country");return e&&e.country&&(C.code=e.code,C.flagcode=e.flagcode),C}function Z(){return A}function J(){return h}function ee(e){h.ancht=e}function te(e){h.aifr=e}function ne(e){h.afam=e}function re(e){h.aaf=e}function ie(e){return d.request(O("fetchRecoverOptions",e),I.AUTHENTICATION)}function oe(e,t){return d.request(O("recoverySendCode",e,t),I.AUTHENTICATION)}function ae(e){return d.request(O("recoveryVerifyCode",e),I.AUTHENTICATION)}function se(e){return d.request(O("resetPassword",e),I.AUTHENTICATION)}E={_currentUser:null,_validSession:!1,isPendingAsync:$,isPending:H,sendCode:F,updateLocalStorageLoginData:N,verifyCode:x,signup:Y,openSignup:K,login:j,logout:V,clearCookies:y,loginFromLocalData:W,currentUser:q,isLoggedIn:z,isValidSession:Q,reloadHome:U,getCountry:X,getCountryList:Z,getPermission:J,setAchatPermission:ee,setAinfndreqPermission:te,setAfamPermission:ne,setAafPermission:re,ensureLoginState:w,handleInvalidSession:G,fetchPrivacy:B,fetchRecoverOptions:ie,recoverySendCode:oe,recoveryVerifyCode:ae,resetPassword:se};function ce(e){setTimeout(function(){o.get(e)},100)}function le(){var e,t;0===A.length&&g.fetchCountryList().success(i);function r(r){if(r&&r.length>0)for(t=r.toLowerCase(),e=0;e<A.length;e++)if(A[e].country.toLowerCase()===t){C.code=A[e].code,C.flagcode=A[e].flagcode,n.setData("country",A[e]);break}}function i(e){A=e,t=n.getData("country"),t&&t.country?(C.code=t.code,C.flagcode=t.flagcode):o.get(a.baseUrl+"/country").success(r)}}function ue(r){R(null),f=!1,E.clearCookies(!0),n.reset(),l.closeAll(),r?U(1):(le(),t.$broadcast(e.AUTH.LOGIN,!1))}function de(r,i){E.loginData=r,b(r,!!i&&30),R(c.create(r,!0,!0)),n.init(r),le(),setTimeout(function(){T.forEach(ce)},2e3),d.resume(),d.keepAlive(),f=!1,t.$broadcast(e.AUTH.LOGIN,!0),setTimeout(function(){B().then(a,o)});function o(){}function a(e){e.sucs===!0?(E._validSession=!0,h=e):E._validSession=!1}}return E}angular.module("ringid.global_services").factory("chatHistoryFactory",chatHistoryFactory),chatHistoryFactory.$inject=["Storage","Auth","userFactory","SystemEvents","Utils"];function chatHistoryFactory(e,t,n,r,i){var o,a=CHAT_APP.Constants.GENERAL_CONSTANTS,s=CHAT_APP.Constants.CHAT_VERSION_INFO,c={},l={},u={},d=0,g=0;function E(){c=e.getData("chatOpenedBoxes")||{},l=e.getData("chatBoxes")||{}}function m(){return g}function T(){g=0}function f(){var t=e.getData("unreadMessageIds");d=0,g=0,t?Object.keys(t).forEach(function(e){u[e]={},t[e].forEach(function(t){u[e][t]=!0,d++}),g++}):u={}}function p(t){var n,o;t!==!1&&(n=!0),o={},Object.keys(u).forEach(function(e){o[e]=Object.keys(u[e])}),e.setData("unreadMessageIds",o,n),i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)}function _(){c={},l={},C(!1),S(!1),p(!1),h(s,!1)}function I(){var t=e.getData("cgInf");t&&t.version&&t.version===s.version||_(),t?angular.extend(s,t):h()}function h(t,n){var r=n;r!==!1&&(r=!0),t&&angular.extend(s,t),e.setData("cgInf",s,r)}function A(e){var t,r;angular.isObject(e.user)||(e.user=n.create({futId:e.user})),t=e.user;try{t=e.user.getKey()}catch(i){}return r={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:t},e.usersToChange&&(r.usersToChange=e.usersToChange),e.statusType&&(r.statusType=e.statusType),r}function C(t){var n=t;n!==!1&&(n=!0),e.setData("chatBoxes",l,n)}function S(t){var n=t;n!==!1&&(n=!0),e.setData("chatOpenedBoxes",c,n)}function v(e,t,n){var r=e.toString();c||(c={}),c[r]||(c[r]={boxId:r,isTagChat:t,isPublicChat:n}),S()}function M(e,t){var n,r,i;if(l[e]&&(n=l[e].messages))for(i=0,r=n.length;i<r;i++)if(n[i].key===t)return n[i];return!1}function D(e,t){u[e]||(u[e]={},i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)),u[e][t]||(u[e][t]=!0,d++),g=Object.keys(u).length}function O(e,t){u[e]&&u[e][t]&&(delete u[e][t],d--,p())}function R(e){var t;u[e]&&(t=Object.keys(u[e]).length,delete u[e],d-=t,d<0&&(d=0),p(),g=Object.keys(u).length,i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED))}function N(){return u}function P(){return d}function y(e){return u[e]?Object.keys(u[e]).length:0}function b(){I(),E(),f()}return o={init:b,loadChatBoxes:E,loadChatGeneralInfo:I,saveChatGeneralInfo:h,updateChatOpenBoxes:S,updateChatBoxes:C,addUnreadMessageInfo:D,removeUnreadMessageInfo:O,updateUnreadMessageInfos:p,getUnreadMessageInfos:N,getUnreadMessageCount:P,getUnreadConversationCount:m,resetConversationCount:T,getUnreadMessageCountByBoxId:y,removeUnreadMessageInfoByBoxId:R,getMessageByPacketId:M,getChatOpenBoxes:function(){return c},getChatBoxes:function(){return l},addOpenBoxes:v,removeOpenBox:function(e){c[e]&&delete c[e],S()},countOpenBoxes:function(){var e;return e=c?Object.keys(c).length:0},getAllOpenBoxes:function(){var e;return e=!!(c&&Object.keys(c).length>0)&&c},addBox:function(e){var t=e;t={key:t.key,ip:t.ip,rPort:t.rPort,closedBox:t.closedBox,isMinimized:t.isMinimized,isHidden:t.isHidden,isFocused:t.isFocused,blinkOn:t.blinkOn,timeout:t.timeout,secretChat:t.secretChat,nonDomBox:t.nonDomBox,offlineStatus:t.offlineStatus,isTagChat:t.isTagChat,isPublicChat:t.isPublicChat,chatBoxClass:t.chatBoxClass,unreadCount:t.unreadCount,isSecretVisible:t.isSecretVisible,blocked:t.blocked,blockedByUtId:t.blockedByUtId,backgroundImage:t.backgroundImage,messages:[]},l||(l={}),l[t.key]||(l[t.key]=t),C()},updateBox:function(e){var t=e;t={key:t.key,closedBox:t.closedBox,isMinimized:t.isMinimized,isHidden:t.isHidden,isFocused:t.isFocused,blinkOn:t.blinkOn,timeout:t.timeout,secretChat:t.secretChat,nonDomBox:t.nonDomBox,offlineStatus:t.offlineStatus,isTagChat:t.isTagChat,isPublicChat:t.isPublicChat,isSecretVisible:t.isSecretVisible,blocked:t.blocked,blockedByUtId:t.blockedByUtId,chatBoxClass:t.chatBoxClass,unreadCount:t.unreadCount,backgroundImage:t.backgroundImage},l||(l={}),l[t.key]?angular.extend(l[t.key],t):l[t.key]=t,C()},getBox:function(e){return!!l[e]&&l[e]},addMessage:function(e,t){var r,i,o,s=t.toString();if(l[s]){e.user&&e.user.getKey||(e.user=n.create({futId:e.user})),o={key:e.key||e.packetId,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime||"",status:e.status||0,fullName:e.fullName||"",tagName:e.tagName||"",messageDate:e.messageDate,seenSent:e.seenSent||!1,isDeleted:e.isDeleted||!1,messageDateString:e.messageDateString||"",timeout:e.timeout||0,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:e.user.getKey(),userId:e.user.getKey()},e.statusType&&(o.statusType=e.statusType),e.usersToChange&&(o.usersToChange=e.usersToChange),l[s].messages||(l[s].messages=[]),r=0;try{for(i=0;i<l[s].messages.length;i++)if(l[s].messages[i].key===o.key){r=1;break}}catch(c){}0===r&&(l[s].messages.push(o),l[s].messages.sort(function(e,t){return e.messageDate-t.messageDate}),l[s].messages.splice(0,l[s].messages.length-a.HISTORY_MAX_MESSAGE))}C()},removeMessage:function(e,t){var n,r=t.toString(),i=!1;if(l&&l[r])for(n=0;n<l[r].messages.length;n++)l[r].messages[n].key===e&&(l[r].messages.splice(n,1),i=!0);i&&C()},updateMessage:function(e,t){var r,i,o=t.toString();if(l[o])for(angular.isObject(e.user)||(e.user=n.create({futId:e.user})),i={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,isSecretVisible:e.isSecretVisible,tag_chat:e.tag_chat,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:e.user.getKey(),userId:e.user.getKey()},e.usersToChange&&(i.usersToChange=e.usersToChange),e.statusType&&(i.statusType=e.statusType),r=0;r<l[o].messages.length;r++)if(l[o].messages[r].key===i.key){l[o].messages[r]=i;break}C()},updateMessages:function(e,t){var n,r,i,o,a,s,c,u;if(e.length){for(n=t.toString(),r={},i=0,a=e.length;i<a;i++)r[e[i].key]=e[i];if(l)for(s=l[n],o=0;o<s.messages.length;o++)c=s.messages[o],u=r[c.key],u&&(s.messages[o]=A(u));C()}},isInLocalStorageChatMsgMap:function(e,t){try{return!!l[e][t]}catch(n){return!1}},countMessage:function(e){var t;return!!l[e]&&(t=l[e],t.messages?t.messages.length:0)},getMessages:function(e){var t;return l[e]?(t=l[e],t.messages):[]},getMessage:function(e,t){var n;if(l[e]&&l[e].messages)for(n=0;n<l[e].messages.length;n++)if(l[e].messages[n].key===t)return l[e].messages[n];return!1}}}angular.module("ringid.global_services").factory("Storage",StorageFactory),StorageFactory.$inject=[];function StorageFactory(){var e,t,n,r,i=!1;function o(e){try{return t=window[e],n="__storage_test__",t.setItem(n,n),t.removeItem(n),i=!0,window[e]}catch(r){return i=!1,{}}}r=o("localStorage");function a(t){e=t,angular.isDefined(r[e])&&c(e,{})}function s(t){var n=t;switch(t){case"loginData":case"country":case"remInfo":case"stickerData":break;case"chatOpenedBoxes":case"chatBoxes":case"cgInf":case"cts":case"unreadMessageIds":case"uLocationInfo":case"mood":case"utIds":case"incomingUtIds":case"outgoingUtIds":case"suggestionUtIds":case"notikeys":case"notiseen":case"oldNotiCount":case"mediaRecent":case"albumname":case"circledata":case"circleut":case"myStickers":case"recentStickers":n=e+"-"+t}return n}function c(e,t){var n=s(e);i?r.setItem(n,angular.toJson(t)):r[n]=angular.toJson(t)}function l(e){var t,n=s(e);return t=i?angular.fromJson(r.getItem(n)):angular.fromJson(r[n])}function u(e){var t=s(e);i?r.removeItem(t):delete r[t]}function d(t){var n,o,s;function d(){var t,a=[];if(l("chatOpenedBoxes")||c("chatOpenedBoxes",{}),l("chatBoxes")||c("chatBoxes",{}),l("unreadMessageIds")||c("unreadMessageIds",[]),l("mediaRecent")||c("mediaRecent",[]),l("notiseen")||c("notiseen",[]),l("oldNotiCount")||c("oldNotiCount",0),l("uLocationInfo")||c("uLocationInfo",{}),l("mediaRecent")||c("mediaRecent",[]),l("recentStickers")||c("recentStickers",[]),i){for(t=0,o=r.length;t<o;++t)n=r.key(t).match(/(\d+)-([a-z]+)/i),n&&n.length>1&&parseInt(n[1],10)!==e&&a.push(r.key(t));a.forEach(function(e){u(e)})}}t?(s=angular.fromJson(t),a(s.utId),c("loginData",s),d()):Cookies.get("utId")&&(a(Cookies.get("utId")),d())}function g(e,t){setTimeout(function(){c(e,t)},200)}d(l("loginData"));function E(e){d(e)}function m(){u("loginData"),u("remInfo"),u("chatOpenedBoxes"),u("suggestionUtIds")}function T(e,t,n){n?g(e,t):c(e,t)}function f(e){return l(e)}function p(e){u(e)}function _(e,t){var n=l("loginData");n[e]=t,c("loginData",n)}function I(e,t,n){n?Cookies.set(e,t,{expires:n}):Cookies.set(e,t)}function h(e){return Cookies.get(e)}function A(e){return Cookies.remove(e)}return{init:E,reset:m,setData:T,getData:f,deleteData:p,updateLoginData:_,setCookie:I,getCookie:h,removeCookie:A}}angular.module("ringid.global_services").factory("Contacts",ContactsFactory),ContactsFactory.$inject=["settings","$$stackedMap"];function ContactsFactory(e,t){var n={utIds:t.createNew(),incomingUtIds:t.createNew(),outgoingUtIds:t.createNew()},r=t.createNew();function i(){}function o(){}function a(){return n.utIds}function s(){return n.outgoingUtIds}function c(){return n.incomingUtIds}function l(e,t){return r.save(t,n[e].get(t)),n[e].remove(t)}function u(e,t,r){n[e].save(t,r)}function d(e){return n.utIds.get(e)||n.incomingUtIds.get(e)||n.outgoingUtIds.get(e)||r.get(e)||{frnS:0}}return{init:i,initStorage:o,utIds:a,outgoingUtIds:s,incomingUtIds:c,remove:l,add:u,getFrns:d}}angular.module("ringid.global_services").service("routeService",routeService),routeService.$inject=["RING_ROUTES","settings","$route","APP_CONSTANTS"];function routeService(e,t,n,r){var i=this;i.getRoute=g,i.validParam=s,i.validParams=o,i.getRouteByUrlPath=u,i.getUrlPathFromUrl=l,i.extractRouteParams=d;function o(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!s(t,e[t]))return!1;return!0}function a(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function s(e,t){var n=!0;switch(e){case"actn":case"feedId":case"utId":case"albumId":case"circleId":case"cntntId":case"futId":case"mpageid":n=a(t);break;case"tagId":n=a(parseInt(t,10));break;case"futIds":n=angular.isArray(t);break;case"uId":n=/^21\d{8}$/.test(t);break;case"subpage":n=angular.isString(t);break;case"shared":n="shared"===t||""===t;break;case"albumType":n="audio"===t||"video"===t;break;case"wmfc":n=t===!1||t===!0;break;case"mdaT":n=t===r.NEWS_FEED_MEDIA_TYPE_AUDIO||t===r.NEWS_FEED_MEDIA_TYPE_VIDEO}return n}function c(e,t){var n,r=e;for(n in t)t.hasOwnProperty(n)&&s(n,t[n])&&(r=r.replace(new RegExp(":"+n+"\\??"),t[n]));return r=r.replace(/\/:[\w]+\??/g,"")}function l(e){return e.match(/https?:\/\/.*.com\/#?(.*)/)[1]}function u(e){var t,r=e,i=null;for(t in n.routes)if(n.routes[t].regexp&&n.routes[t].regexp.test(r)){i=n.routes[t];break}return i}function d(e,t){var n,r,i,o,a,s=t.keys,c={};if(!t.regexp)return null;if(n=t.regexp.exec(e),!n)return null;for(r=1,i=n.length;r<i;++r)o=s[r-1],a=n[r],o&&a&&(c[o.name]=a);return c}function g(n,r){var i;if(!e[n])return"";switch(i=e[n],n){case"HOME":case"CHAT":case"CHAT_GROUPS":case"CHAT_ROOMS":case"MEDIA_FEED":case"MEDIA_PLAYLIST":case"MEDIA_POST":case"NEWSPORTAL_FEED":case"NEWSPORTAL_FOLLOWING":case"NEWSPORTAL_DISCOVER":case"NEWSPORTAL_SAVED":case"PAGES_FEED":case"PAGES_FOLLOWING":case"PAGES_DISCOVER":case"PAGES_SAVED":case"CELEBRITY_FEED":case"CELEBRITY_FOLLOWING":case"CELEBRITY_DISCOVER":case"CELEBRITY_SAVED":case"NOTIFICATIONS":case"FRIEND_REQUESTS":case"CIRCLE_FEED":case"CIRCLE_LIST":case"CIRCLE_SAVED":case"SAVED_FEEDS":case"SAVED_MEDIA_FEEDS":case"SAVED_CIRCLE_FEEDS":case"SAVED_NEWSPORTAL_FEEDS":case"SAVED_PAGES_FEEDS":case"SAVED_CELEBRITY_FEEDS":break;case"PROFILE":case"CIRCLE":case"NEWSPORTAL":case"PAGE":case"CELEBRITY":case"CHAT_GROUP":case"MEDIA_CLOUD_ALBUM":case"MEDIA_CLOUD_SEARCH":case"MEDIA_CLOUD_USERMEDIA":case"MEDIA_PAGE_PROFILE":case"MEDIA_CLOUD_MYALBUM":case"WHO_SHARED_FEED":case"SINGLE_FEED":case"SINGLE_IMAGE":case"SINGLE_MEDIA":case"LOGIN_SOCIAL":case"SIGNUP_SOCIAL":i=c(i,r)}return t.html5Mode?i:"/#"+i}}angular.module("ringid.global_services").service("apiCall",apiCall),apiCall.$inject=["$$connector"];function apiCall(e){var t=this;t.request=n,t.pull=r,t.send=i;function n(t,n,r){return e.request(t,n,Boolean(r))}function r(t,n,r){return e.pull(t,n,Boolean(r))}function i(t,n,r){return e.send(t,n,Boolean(r)),!0}}angular.module("ringid.global_services").service("userApi",userApi),userApi.$inject=["OPERATION_TYPES","apiCall"];function userApi(e,t){var n=this,r=e.SYSTEM,i=e.SYSTEM.REQUEST_TYPE;n.getUserDetails=s,n.changeCover=o,n.changeAvatar=a;function o(e){var n={actn:r.PROFILE.TYPE_CHANGE_COVER_PIC,pType:0,type:1,imT:3,cimX:e.cimX,cimY:e.cimY,ih:e.ih,iw:e.iw,iurl:e.iurl};return e.hasOwnProperty("issa")&&e.issa&&(n.issa=1,n.imgId=e.imgId),t.request(n,i.UPDATE)}function a(e){var n={actn:r.PROFILE.TYPE_CHANGE_PROFILE_PIC,pType:0,type:1,imT:2,pimX:e.pimX,pimY:e.pimY,ih:e.ih,iw:e.iw,iurl:e.iurl};return e.hasOwnProperty("issa")&&e.issa&&(n.issa=1,n.imgId=e.imgId),t.request(n,i.UPDATE)}function s(e,n,o,a,s,c){var l={actn:r.PROFILE.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!n};return o&&(l.pType=3),a&&(l.pType=4),s&&(l.pType=2),c&&(l.pType=5),angular.extend(l,e),t.request(l,i.REQUEST,!0)}}angular.module("ringid.global_services").service("mediaApi",mediaApi),mediaApi.$inject=["OPERATION_TYPES","apiCall"];function mediaApi(e,t){var n=this,r=e.SYSTEM.MEDIA,i=e.SYSTEM.PORTAL,o=e.SYSTEM.PROFILE_TYPES,a=e.SYSTEM.REQUEST_TYPE;n.albumContents=s,n.albumDetails=c,n.mediaDetails=l,n.fetchAlbums=u,n.hashtagSuggestion=d,n.searchResult=g,n.fetchContent=E,n.createAlbum=m,n.updateAlbum=T,n.deleteAlbum=f,n.addMedia=p,n.updateContent=_,n.deleteContent=I,n.increaseView=h,n.searchTrends=A,n.taggedMedia=C,n.slider=S,n.trendingFeeds=v,n.discoverList=M,n.followingList=D,n.searchPortal=O,n.followPage=R,n.getShortDetails=N,n.followMediaPage=P,n.unFollowMediaPage=y;function s(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId,utId:e.utId,st:e.st||0};return t.send(n,a.REQUEST)}function c(e){var n={actn:r.ACTION_MEDIA_ALBUM_DETAILS,albId:e};return t.request(n,a.REQUEST)}function l(e){var n={actn:r.ACTION_MEDIA_CONTENT_DETAILS,cntntId:e.cntntId,utId:e.utId};return t.request(n,a.REQUEST)}function u(e){var n={actn:r.ACTION_MEDIA_ALBUM_LIST,mdaT:e.mdaT||1,utId:e.utId};return t.send(n,a.REQUEST,!0)}function d(e){return t.pull({actn:r.ACTION_GET_HASHTAG_SUGGESTION,schPm:e.utf8Encode()},a.REQUEST,!0)}function g(e){var n={actn:r.ACTION_MEDIA_SEARCH_RESULT,schPm:e.utf8Encode()};return t.pull(n,a.REQUEST)}function E(e){var n={actn:r.ACTION_SPECIFIC_MEDIA_RESULT,schPm:e.sk.utf8Encode(),sugt:e.sugt,pvtid:e.pvtid||0,scl:e.scl||1};return t.send(n,a.REQUEST)}function m(e){var n={actn:r.ACTION_ADD_MEDIA_ALBUM,imgURL:e.imgURL||"",albn:e.albn.utf8Encode(),mdaT:e.mdaT};return t.request(n,a.UPDATE)}function T(e){var n={actn:r.ACTION_UPDATE_MEDIA_ALBUM,albId:e.albId,imgURL:e.imgURL,mdaT:e.mdaT,albn:e.albn.utf8Encode()};return t.request(n,a.UPDATE)}function f(e){var n={actn:r.ACTION_DELETE_MEDIA_ALBUM,albId:e};return t.request(n,a.UPDATE)}function p(e){var n={actn:r.ACTION_ADD_MEDIA_CONTENT,albId:e.albId,mdaLst:e.mdaLst,mdaT:e.mdaT};return t.request(n,a.UPDATE)}function _(e){var n={actn:r.ACTION_UPDATE_MEDIA_CONTENT,mdaCntntDTO:e};return t.request(n,a.UPDATE)}function I(e){var n={actn:r.ACTION_DELETE_MEDIA_CONTENT,cntntId:e};return t.request(n,a.UPDATE)}function h(e,n){var i={actn:r.ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT,cntntId:e};return n&&(i.nfId=n),t.request(i,a.UPDATE)}function A(){var e={actn:r.ACTION_GET_TRENDING_KEYWORDS};return t.pull(e,a.REQUEST)}function C(e){var n={actn:r.ACTION_GET_TAGGED_MEDIA_SONGS,htid:e,pvtid:0,scl:2};return t.send(n,a.REQUEST)}function S(e){var n={actn:r.ACTION_GET_MEDIA_SLIDER_IMG,mdaT:e.mdaT};return t.pull(n,a.REQUEST,!0)}function v(){var n={actn:e.SYSTEM.TYPE_MEDIAS_TRENDING_FEED,lmt:10,st:0,scl:2,mtf:0};return t.pull(n,a.REQUEST,!0)}function M(e){var n={actn:i.ACTION_NEWSPORTAL_LIST,subscType:1,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,pType:o.MEDIA_PAGE};return t.pull(n,a.REQUEST,!0)}function D(e){var n={actn:i.ACTION_NEWSPORTAL_LIST,subscType:2,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,pType:o.MEDIA_PAGE};return t.pull(n,a.REQUEST,!0)}function O(e){var n={actn:i.ACTION_CONTACT_SEARCH,pType:o.MEDIA_PAGE,schPm:e.utf8Encode()};return t.pull(n,a.REQUEST,!0)}function R(e){var n={actn:i.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:2,pId:e,pType:o.MEDIA_PAGE};return t.request(n,a.UPDATE)}function N(n){var r={actn:e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS,pId:n,pType:o.MEDIA_PAGE};return t.request(r,a.REQUEST,!0)}function P(e){var n={actn:i.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:2,pId:e,pType:o.MEDIA_PAGE};return t.request(n,a.UPDATE)}function y(e){var n={actn:i.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,pId:e,pType:o.MEDIA_PAGE};return t.request(n,a.UPDATE)}}angular.module("ringid.global_services").service("imageApi",imageApi),imageApi.$inject=["OPERATION_TYPES","apiCall"];function imageApi(e,t){var n=this,r=e.SYSTEM.REQUEST_TYPE,i=e.SYSTEM.IMAGE;n.albumList=o,n.albumImages=a,n.remove=s,n.details=l,n.feedImages=c;function o(e){var n={actn:i.FETCH_ALBUM_LIST};return e&&(n.futId=e),t.send(n,r.REQUEST)}function a(e){var n={actn:i.TYPE_ALBUM_IMAGES,st:e.st||0,albId:e.albId};return e.futId&&(n.futId=e.futId),t.send(n,r.REQUEST,!0)}function s(e){return t.request({actn:i.DELETE_IMAGE,imgIds:[e]},r.UPDATE)}function c(n){var i={actn:e.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n};return t.request(i,r.REQUEST)}function l(e){return t.request({actn:i.TYPE_IMAGE_DETAILS,imgId:e},r.REQUEST)}}angular.module("ringid.global_services").factory("Api",ApiFactory),ApiFactory.$inject=["OPERATION_TYPES","apiCall","settings","$ringhttp","userApi","mediaApi","imageApi"];function ApiFactory(e,t,n,r,i,o,a){var s=e.SYSTEM,c=e.SYSTEM.REQUEST_TYPE;function l(e){return t.request({actn:s.PROFILE.TYPE_ACTION_USER_MOOD,mood:e},c.AUTHENTICATION)}function u(e){return t.pull({actn:s.PROFILE.FETCH_FRIEND_MUTUAL_FRIEND_LIST,futId:e.getUtId()},c.REQUEST)}function d(e){var n={actn:s.PROFILE.ACTION_USERS_PRESENCE_DETAILS,futIds:e};return t.request(n,c.REQUEST,!0)}function g(){
return r.get(n.baseUrl+"/resources/countries.json")}function E(e){var n={actn:s.PROFILE.TYPE_REMOVE_PROFILE_IMAGE,prIm:e};return t.request(n,c.UPDATE)}function m(e){var n={actn:s.PROFILE.TYPE_REMOVE_COVER_IMAGE,cIm:e};return t.request(n,c.UPDATE)}function T(e){return t.request({actn:s.PROFILE.SEND_VERIFICATION_CODE_TO_PHONE,mbl:e.mbl,mblDc:e.mblDc,pkd:!0},c.REQUEST)}return{fetchCountryList:g,user:{getUserDetails:i.getUserDetails,changeAvatar:i.changeAvatar,changeCover:i.changeCover,changeMood:l,getMutualFriends:u,fetchUserPresence:d,removeAvatar:E,removeCover:m,verifyPhoneNo:T},media:o,image:a}}!function(e,t){"use strict";e.module("ringid.global_directives",["ngRoute","ringid.config"])}(angular,window),angular.module("ringid.global_directives").directive("rgColumn",rgColumn),rgColumn.$inject=["$document","Utils","SystemEvents","$rootScope"];function rgColumn(e,t,n,r){i.$inject=["$scope"];function i(e){function i(i){t.resetScroll(),t.animateScroll(),t.setFeedColumn(i),e.spans=i,r.$broadcast(n.COMMON.COLUMN_CHANGED,i)}function o(t){e.spans=t,r.$broadcast(n.COMMON.COLUMN_CHANGED,t)}function a(){e.defaultSpan=t.getDefaultColumn(),e.$rgDigest()}e.spans=t.feedColumn(),e.defaultSpan=t.getDefaultColumn(),e.choose=i,e.$watch(t.feedColumn,o),e.$on(n.COMMON.WINDOW_RESIZED,a)}function o(t,n){var r;function i(t){t.preventDefault(),r||(r=angular.element(n.find("div")[0]),e.on("click",o)),r.toggleClass("colshow")}function o(e){var t=n.parent().parent()[0];e.target!==t&&e.target.parentNode!==t&&null!==e.target.parentNode&&e.target.parentNode.parentNode!==t&&"pt-top"!==e.target.className&&a(e)}n.parent().parent().on("click",i);function a(){r.removeClass("colshow")}function s(){n.off("click",i),e.off("click",o),r=void 0}t.$on("$destroy",s)}return{restrict:"A",controller:i,template:'<span></span><span></span><span></span><div class="col-area"><div class="col-area-wrapper"><div class="list-ico width-26 top-l" data-tool="3 Column" ng-click="choose(3)" ng-if="defaultSpan > 2" ng-class="{\'list-act\' : spans == 3 }"><span></span><span></span><span></span></div><div class="list-ico width-17 top-l" data-tool="2 Column" ng-click="choose(2)"  ng-if="defaultSpan > 1" ng-class="{\'list-act\' : spans == 2 }"><span></span><span></span></div><div  class="list-ico width-9 top-l" data-tool="1 Column" ng-click="choose(1)" ng-class="{\'list-act\' : spans == 1 }"><span></span></div></div></div>',link:o}}angular.module("ringid.global_directives").directive("rgImgLoad",rgImgLoad).directive("rgClick",rgClick).directive("rgClickAll",rgClickAll).directive("rgConditionalClick",rgConditionalClick),rgConditionalClick.$inject=[];function rgConditionalClick(){function e(e,t,n){function r(){n.rgConditionalClick()}function i(){t.unbind("click")}angular.isFunction(n.rgConditionalClick)&&(t.bind("click",r),e.$on("$destroy",i))}return e}rgClickAll.$inject=["$parse"];function rgClickAll(e){function t(t,n,r){var i=e(r.rgClickAll);function o(e){i(t,{$event:e}),t.$rgDigest()}function a(){n.unbind("click",o),n.unbind("contextmenu",o)}n.bind("click",o),n.bind("contextmenu",o),t.$on("$destroy",a)}return{restrict:"A",link:t}}rgClick.$inject=["$parse"];function rgClick(e){function t(t,n,r){var i=e(r.rgClick);function o(e){i(t,{$event:e}),t.$rgDigest()}function a(){n.unbind("click",o)}n.bind("click",o),t.$on("$destroy",a)}return{restrict:"A",link:t}}function rgImgLoad(){function e(e,t){function n(){}t.on("load",n)}return{restrict:"A",transclude:!0,link:e}}angular.module("ringid.global_directives").service("rgDropdownService",dropdownService).directive("rgDropdown",rgDropdown),dropdownService.$inject=["GlobalEvents"];function dropdownService(e){var t=this,n=!1,r=!1;function i(e){var n=e.keyCode||e.which;return 27===n&&t.close(e)}function o(){n&&angular.isFunction(n.ddBeforeClose)&&n.ddBeforeClose(),r(),e.unbindHandler("document","click",t.close),e.unbindHandler("document","keydown",i)}function a(){n.ddOpened(),e.bindHandler("document","click",t.close),e.bindHandler("document","keydown",i)}t.open=function(e,t){r&&o(),r=e,n=t,a()},t.close=function(e){return e&&(e.preventDefault(),e.stopPropagation()),r&&o(),r=!1,n=!1,!0}}rgDropdown.$inject=["$ringhttp","settings","$compile","rgDropdownService","languageConstant","Utils","rgScrollbarService","SystemEvents"];function rgDropdown(e,t,n,r,i,o,a,s){function c(t,c){var l,u,d,g=!1,E=!0,m=200,T=0,f=!1,p=!1;t.consType=i.get();function _(e){return"input"!==e.target.tagName.toLowerCase()&&"a"!==e.target.tagName.toLowerCase()&&"a"!==e.target.parentNode.tagName.toLowerCase()}function I(e){_(e)&&(e.preventDefault(),e.stopPropagation()),g=!0}function h(e){g?g=!1:(e.stopPropagation(),f?r.close():(D(e),r.open(R,t)))}function A(e){function t(){u=!1,p||h(e)}u||(u=setTimeout(t,500))}function C(e){d=e}function S(){t.$rgDigest()}c.on("click",h),(t.ddHtml||t.ddTemplate)&&(t.ddTemplate?d=t.ddTemplate:e.get(t.ddHtml).success(C,S));function v(){p=!0,c.off("mouseleave",A)}function M(e){p=!1,A(e),c.on("mouseleave",A)}function D(){var e;for(f=!0,l=n(d)(t),c.append(l),e=0;e<l.length;e++)l[e].addEventListener("click",I);t.ddControl&&t.ddControl.showOnHover&&(c[0].addEventListener("mouseleave",A),l[l.length-1].addEventListener("mouseenter",v),l[l.length-1].addEventListener("mouseleave",M)),t.$rgDigest(),E&&(setTimeout(O),t.$on(s.COMMON.WINDOW_RESIZED,O))}function O(){var e,n,r,i,s,c,u,d=0;if(E&&f){for(i=0;i<l.length;i++)if(l[i].clientHeight)c=l[i],d+=l[i].clientHeight,e=l[i].getBoundingClientRect(),u=o.viewport.y-e.height-e.top;else if(l[i].children)for(s=0;s<l[i].children.length;s++)l[i].children[s].clientHeight>0&&(c=l[i].children[s],d+=l[i].children[s].clientHeight,e=l[i].children[s].getBoundingClientRect(),u=o.viewport.y-e.height-e.top);if(T=T>0?T:d,T<m)return void(E=!1);u-10<0?(r=d+u-10,r=r>m?r:m,c.style.height=r+"px",a.recalculate(t),t.$rgDigest(!0)):d<T&&(n=d+u-10,n=T>n?n:T,c.style.height=n+"px",a.recalculate(t),t.$rgDigest(!0))}}function R(){var e;for(f=!1,g=!1,e=0;e<l.length;e++)l[e].removeEventListener("click",I);t.ddControl&&t.ddControl.showOnHover&&(c[0].removeEventListener("mouseleave",A),l[l.length-1].removeEventListener("mouseenter",v),l[l.length-1].removeEventListener("mouseleave",M)),l.remove(),t.$parent.$rgDigest()}function N(){c[0].removeEventListener("click",h),f&&r.close()}t.$on("$destroy",N)}l.$inject=["$scope"];function l(e){e.action=t;function t(t,n){r.close(t),e.ddAction()(n)}}return{restrict:"AE",link:c,controller:l,scope:{ddHtml:"=",ddControl:"=",ddTemplate:"=",ddAction:"&",ddOpened:"&",ddBeforeClose:"&"}}}angular.module("ringid.global_directives").directive("rgPageTitle",rgPageTitle),rgPageTitle.$inject=["$rootScope","chatHistoryFactory","Utils","SystemEvents"];function rgPageTitle(e,t,n,r){var i,o,a=1e3,s=n.getCurrentPageTitle();function c(){var e,n=t.getUnreadConversationCount();return e=n>0?"("+n+") "+s:s}i=c;function l(){function e(){var e=c();n.setPageTitle(n.getCurrentPageTitle()===e?s:e)}o=setInterval(e,a)}function u(){clearInterval(o),n.setPageTitle(i())}function d(e,t){s=t.title}function g(){n.setPageTitle(i())}return e.$on("ringActive",u),e.$on("ringInactive",l),e.$on("PAGE_TITLE_CHANGE",d),n.onCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED,g),n.onCustomEvent(r.CHAT.CONVERSATION_COUNT_RESETED,g),{}}angular.module("ringid.global_directives").directive("rgUserTrack",rgUserTrack),rgUserTrack.$inject=["userFactory","Utils"];function rgUserTrack(e,t){function n(n,r,i){var o,a,s=i.rgUserTrack;function c(){a=e.getUser(s),a&&a.shouldUpdatePresence()&&setTimeout(function(){a.fetchPresence()},200)}s&&(e.trackUserUsage(s),o=t.debounce(c,500),r.on("mouseover",o),n.$on("$destroy",function(){e.unTrackUserUsage(s),r.off("mouseover",o)}))}return{restrict:"A",link:n}}!function(e,t){"use strict";e.module("ringid.social",[])}(angular,window),angular.module("ringid.social").service("socialUtils",socialUtils);function socialUtils(){var e=this;function t(t,n){var r,i={};for(r in t)t.hasOwnProperty(r)&&(r in n&&"object"==typeof t[r]&&null!==r?i[r]=e.merge(t[r],n[r]):i[r]=t[r]);for(r in n)if(n.hasOwnProperty(r)){if(r in i)continue;i[r]=n[r]}return i}function n(e,t){var n;if(/^(?:[a-z]+:)?\/\//i.test(t))return t;n=[e,t].join("/");function r(e){return e.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/#/g,"#").replace(/:\//g,"://")}return r(n)}function r(e){var t,n,r={};function i(){e&&(n=e.split("="),t=decodeURIComponent(n[0]),r[t]=!angular.isDefined(n[1])||decodeURIComponent(n[1]))}return angular.forEach((e||"").split("&"),i),r}function i(e){function t(e,t,n,r){return r?n.toUpperCase():n}return e.replace(/([:\-_]+(.))/g,t)}e.camelCase=i,e.parseQueryString=r,e.joinUrl=n,e.merge=t}angular.module("ringid.social").constant("socialConfig",{providers:{facebook:{name:"facebook",url:"/auth/facebook",clientId:"477404429103451",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/static-index.html",requiredUrlParams:["access_code"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:680,height:500}},twitter:{twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin+"/static-index.html",type:"1.0",serverUrl:window.location.origin+"/TwiteerLoginService",popupOptions:{width:595,height:745}}}}),angular.module("ringid.social").factory("socialPopup",socialPopup),socialPopup.$inject=["$$q","$interval","$window","socialConfig","socialUtils"];function socialPopup(e,t,n,r,i){var o={};o.url="",o.popupWindow=null,o.open=u,o.eventListener=l,o.pollPopup=c,o.prepareOptions=s,o.stringifyOptions=a;function a(e){var t=[];function n(e,n){t.push(n+"="+e)}return angular.forEach(e,n),t.join(",")}function s(e){var t,r,i;return r=e||{},t=r.width||500,i=r.height||500,angular.extend({width:t,height:i,left:n.screenX+(n.outerWidth-t)/2,top:n.screenY+(n.outerHeight-i)/2.5},r)}function c(){var t,n,r,a=e.defer();function s(){var e,s,c,l;try{t=document.location.host,n=o.popupWindow.location.host,n===t&&(o.popupWindow.location.search||o.popupWindow.location.hash)&&(e=o.popupWindow.location.search.substring(1).replace(/\/$/,""),s=o.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),c=i.parseQueryString(s),l=i.parseQueryString(e),angular.extend(l,c),l.error?a.reject(l):a.resolve(l),clearInterval(r),o.popupWindow.close())}catch(u){}o.popupWindow&&!o.popupWindow.closed&&void 0!==o.popupWindow.closed||clearInterval(r)}return r=setInterval(s,50),a.promise}function l(t){var n=e.defer();function r(e){var r,a,s,c,l;0===e.url.indexOf(t)&&(r=document.createElement("a"),r.href=e.url,(r.search||r.hash)&&(a=r.search.substring(1).replace(/\/$/,""),s=r.hash.substring(1).replace(/\/$/,""),c=i.parseQueryString(s),l=i.parseQueryString(a),angular.extend(l,c),l.error||n.resolve(l),o.popupWindow.close()))}o.popupWindow.addEventListener("loadstart",r),o.popupWindow.addEventListener("loaderror",a),o.popupWindow.addEventListener("onbeforeunload",s);function a(){n.reject({rc:0,mg:"Error Loading Authorization URL"})}function s(){n.reject({rc:0,mg:"Popup closed unexpectedly"})}return n.promise}function u(e,t,i){var a=o.stringifyOptions(o.prepareOptions(i)),s=n.navigator.userAgent,c=r.cordova||s.indexOf("CriOS")>-1?"_blank":t;return o.url=e,o.popupWindow=n.open(e,c,a),n.popup=o.popupWindow,o.popupWindow&&o.popupWindow.focus&&o.popupWindow.focus(),o}return o}angular.module("ringid.social").factory("socialOauth",socialOauthFactory).factory("socialOauth1",socialOauth1Factory).factory("socialOauth2",socialOauth2Factory),socialOauthFactory.$inject=["socialConfig","socialOauth1","socialOauth2"];function socialOauthFactory(e,t,n){var r={};function i(r,i){var o="1.0"===e.providers[r].type?t():n();return o.open(e.providers[r],i)}return r.authenticate=i,r}socialOauth2Factory.$inject=["$$q","$window","socialUtils","socialConfig","Storage","socialPopup","$ringhttp"];function socialOauth2Factory(e,t,n,r,i,o,a){function s(){var t={},r={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"token",responseParams:{token:"token",clientId:"clientId",redirectUri:"redirectUri"}};function s(){var e,t,i=[],o=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];function a(o){e=n.camelCase(o),t=angular.isFunction(r[o])?r[o]():r[e],i.push([o,t])}function s(e){angular.forEach(r[e],a)}function c(e){return e.join("=")}return angular.forEach(o,s,a),i.map(c).join("&")}function c(t,n){var c,l,u,d,g,E=e.defer();angular.extend(r,t),g=r.name+"_state",angular.isFunction(r.state)?i.setData(g,r.state()):angular.isString(r.state)&&i.setData(g,r.state),u=[r.authorizationEndpoint,s(n)].join("?"),d=o.open(u,r.name,r.popupOptions,r.redirectUri),l=setInterval(_,1e3),d.pollPopup().then(p,m);function m(){E.reject({mg:"Popup blocked by Browser. Please unblock."})}function T(e){e.id?E.resolve({platform:r.name,id:e.id,name:e.name,access_token:c}):E.reject()}function f(){E.reject()}function p(e){clearInterval(l),c=e.access_token,a.get("https://graph.facebook.com/me?access_token="+e.access_token).success(T).error(f)}function _(){d.popupWindow.closed&&(clearInterval(l),E.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))}return E.promise}return t.open=c,t}return s}socialOauth1Factory.$inject=["$q","socialConfig","socialUtils","socialPopup","$ringhttp"];function socialOauth1Factory(e,t,n,r,i){function o(){var t={},n={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};t.open=c;function o(e,t){var r;return t.uId=t.uId.toString(),r="?step=3&oauth_token="+e.oauth_token+"&verifier="+e.oauth_verifier+(t.uId&&t.uId.length>2?"&uId="+t.uId:"")+"&time="+(new Date).getTime(),i.get(n.serverUrl+r)}function a(){return i.get(n.serverUrl+"?step=1&callback="+encodeURIComponent(n.redirectUri)+"&time="+Date.now())}function s(e){var t=[];function n(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}return angular.forEach(e,n),t.join("&")}function c(t,i){var c,l,u=e.defer();angular.extend(n,t),l=r.open("",n.name,n.popupOptions,n.redirectUri),c=setInterval(d,1e3),a().success(E).error(g);function d(){l.popupWindow.closed&&(clearInterval(c),u.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))}function g(){u.reject({mg:"exchangeForRequest failed. Server error"})}function E(e){var t,r;function a(e){function t(t){var r,i,o;t.sucs===!0||2===t.rc?(r=t.data.members,i=JSON.parse(r.userDetails),o=JSON.parse(r.accessToken),u.resolve({platform:n.name,id:i.id_str,name:i.name,access_token:o.token,oauthParameters:o.oauthParameters,oauth_token:e.oauth_token,oauth_verifier:e.oauth_verifier})):u.reject({mg:"exchangeForRequest failed"})}function r(){u.reject({mg:"exchangeForRequest failed. Server error"})}clearInterval(c),o(e,i).success(t).error(r)}e.sucs===!0?(t=e.data,r=[n.authorizationEndpoint,s({oauth_token:t.token,callback_url:n.redirectUri})].join("?"),l.popupWindow?(l.popupWindow.location=r,l.pollPopup().then(a)):u.reject({mg:"Popup blocked by Browser. Please unblock."})):u.reject({mg:"exchangeForRequest failed"})}return u.promise}return t}return o}angular.module("ringid.social").provider("$authSocial",authSocial),authSocial.$inject=["socialConfig"];function authSocial(e){function t(t){function n(n){return angular.extend(e.providers[t],n)}this[t]=n}angular.forEach(Object.keys(e.providers),t,this);function n(t){e.providers[t.name]=e.providers[t.name]||{},angular.extend(e.providers[t.name],t)}function r(t){n(t),e.providers[t.name].type="1.0"}function i(t){n(t),e.providers[t.name].type="2.0"}this.oauth1=r,this.oauth2=i;function o(e,t){var n={login:r,authenticate:i};function r(n){var r,i=e.defer();function o(e){i.resolve(e)}function a(e){i.reject(e)}return r?i.resolve(r):t.authenticate(n,"login").then(o,a),i.promise}function i(n,r){var i=e.defer();function o(e){i.resolve(e)}function a(e){i.reject(e)}return t.authenticate(n,r).then(o,a),i.promise}return n}this.$get=["$$q","socialOauth",o]}!function(e,t){"use strict";e.module("ringid.auth",["ringid.config","ringid.digits","ringid.connector","ringid.social"])}(angular,window),angular.module("ringid.auth").directive("rgSlider",rgSlider);function rgSlider(){function e(e,t,n){var r,i,o,a=0,s=!0,c=null,l=[],u=t[0],d=n.navClass||"",g=n.slideClass||"",E=n.descClass||"",m=1e3*parseInt(n.delay,10)||3e3,T=angular.element(u.querySelectorAll("."+g)),f=angular.element(u.querySelectorAll("."+E)),p=u.querySelectorAll("."+d)||{},_=120,I=.6,h=.6,A=.8,C=u.querySelector(".nav-carousel"),S=[],v=C.clientWidth,M=C.clientHeight;i=C.querySelectorAll("img"),i=Array.prototype.slice.call(i),o=Math.floor(i.length/2),U(),D();function D(){for(T.removeClass("active"),T.eq(a).addClass("active"),f.removeClass("active"),f.eq(a).addClass("active"),r=0;r<l.length;r++)l[r].find("li").removeClass("active"),l[r].find("li").eq(a).addClass("active");S[0]&&F(G(a)),s&&(a=a+1===T.length?0:a+1,O())}function O(){function e(){D()}c=setTimeout(e,m)}function R(){clearTimeout(c)}function N(e){var t,n=e.parentNode.childNodes,r=0;for(t=0;t<n.length;t++){if(n[t]===e)return r;1===n[t].nodeType&&r++}return-1}function P(e){e.stopPropagation(),s=!1,R()}function y(e){e.stopPropagation(),s=!0,O()}function b(){a=N(this),R(),D()}function U(){var e,t;for(t=0;t<p.length;t++)e=angular.element(p[t]),l.push(e),e.find("li").on("click",b);T.on("mouseenter",P),T.on("mouseleave",y),f.on("mouseenter",P),f.on("mouseleave",y)}function L(){var e,t,n,s,c,l,u;for(e=i[0].clientWidth,t=i[0].clientHeight,n=1,s=Math.round(v/2)-Math.round(e/2),c=Math.round(M/2)-Math.round(t/2),S[o]={w:e,h:t,o:n,l:s,t:c,z:o,i:0},u=_,l=o,r=o+1;r<i.length;r++)u*=I,e=h*S[r-1].w,t=h*S[r-1].h,n=A*S[r-1].o,s=S[r-1].l+S[r-1].w+u-e,--l,c=Math.round(M/2)-Math.round(t/2),S[r]={w:e,h:t,o:n,l:s,t:c,z:l,i:r};for(u=_,l=o,r=o-1;r>=0;r--)u*=I,e=h*S[r+1].w,t=h*S[r+1].h,n=A*S[r+1].o,s=S[r+1].l-u,--l,c=Math.round(M/2)-Math.round(t/2),S[r]={w:e,h:t,o:n,l:s,t:c,z:l,i:r};function d(){this.crslPos!==o&&(a=this.orgPos,R(),D(),F(this))}for(r=0;r<i.length;r++)i[r].orgPos=r,i[r].crslPos=r,i[r].addEventListener("click",d)}function F(e){k(e),w()}function k(e){for(var t,n=e.crslPos<o?"forward":"backward";e.crslPos!==o;)for("forward"===n?(t=i.pop(),i.unshift(t)):(t=i.shift(),i.push(t)),r=0;r<i.length;r++)i[r].crslPos=r,i[r].className="";e.className="active"}function w(){for(r=0;r<i.length;r++)i[r].style.width=S[r].w+"px",i[r].style.height=S[r].h+"px",i[r].style.opacity=S[r].o,i[r].style.left=S[r].l+"px",i[r].style.top=S[r].t+"px",i[r].style.zIndex=S[r].z,S[r].i=r}function G(e){for(r=0;r<i.length;r++)if(e===i[r].orgPos)return i[r];return!1}i[0].src=i[0].src;function B(){L(),F(i[0]);function e(){C.style.visibility="visible"}setTimeout(e,800)}i[0].addEventListener("load",B),e.$on("$destroy",function(){var e,t;for(T.off("mouseenter",P),T.off("mouseleave",y),f.off("mouseenter",P),f.off("mouseleave",y),e=0;e<p.length;e++)t=angular.element(p[e]),t.find("li").off("click",b)})}return{link:e}}angular.module("ringid.auth").controller("AuthController",AuthController),AuthController.$inject=["rgDropdownService","Storage","Auth","$scope","$$connector","$rootScope","Ringalert","settings","MESSAGES"];function AuthController(e,t,n,r,i,o,a,s,c){r.requestFailed=l,r.activeTab="phone",r.credentials={username:"",authMethod:"phone",uId:"",lt:2,mbl:"",email:"",ringid:"",password:"",remember:Boolean(t.getData("remember")),mblDc:n.getCountry().code,flagcode:n.getCountry().flagcode},r.autofill={email:r.credentials.email,ringid:r.credentials.ringid,mbl:r.credentials.mbl},r.errorMsg="",r.requestSuccess=!1,r.disableForm=!1,r.signinClicked=!1,r.formStyle={left:"0px"},r.activateTab=u,r.setPrefix=d,r.login=g,r.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" > <li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span ng-cloak="true"> {{ item.country }}</span></li></a></ul></div>',r.ddControl={append:!1,countryList:n.getCountryList};function l(e,t,n){e?(r.disableForm=!1,e.sucs===!0||"true"===e.sucs?(r.requestSuccess=!0,r.errorMsg=e.mg||c.REQUEST_PROCESSED):(r.requestSuccess=!1,r.errorMsg=e.hasOwnProperty("rc")&&e.rc>0?c["RC"+e.rc]:e.mg||c.REQUEST_FAILED,s.analytics&&ga("send","event",t+" Message:"+r.errorMsg+" RC:"+e.rc||"UNKNOWN")),n&&a.show(r.errorMsg,"error")):(r.disableForm=!0,r.requestSuccess=!0,r.errorMsg=""),r.$rgDigest()}function u(e){if(!r.disableForm){switch(r.errorMsg="",r.activeTab=e,r.activeTab){case"email":r.credentials.authMethod="email",r.formStyle.left="-800px",r.credentials.lt=3;break;case"ringid":r.credentials.authMethod="ringid",r.formStyle.left="-400px",r.credentials.lt=1;break;case"facebook":r.credentials.authMethod="social",r.formStyle.left="-1200px",r.credentials.lt=4;break;case"twitter":r.credentials.authMethod="social",r.formStyle.left="-1200px",r.credentials.lt=5;break;case"social":r.credentials.authMethod="social",r.formStyle.left="-1200px";break;default:r.credentials.authMethod="phone",r.formStyle.left="0px",r.credentials.lt=2}r.$rgDigest()}}function d(n){n.event&&e.close(n.event),t.setData("country",n.item),r.credentials.mblDc=n.item.code,r.credentials.flagcode=n.item.flagcode,r.$rgDigest()}function g(e,t){if(r.signinClicked=!0,t&&t.preventDefault(),e&&!r.disableForm){switch(r.credentials.authMethod){case"ringid":r.credentials.username=r.credentials.ringid;break;case"email":r.credentials.username=r.credentials.email;break;case"phone":r.credentials.username=r.credentials.mbl}r.requestFailed(!1),n.login(r.credentials).then(i,a)}r.$rgDigest();function i(e){e.sucs===!0||"true"===e.sucs?r.params&&r.params.fromPopup?(r.closeAll(),window.location="/"):o.$rgDigest():r.requestFailed(e,"Signin:"+r.credentials.authMethod)}function a(e){r.requestFailed(e,"Signin:"+r.credentials.authMethod)}}function E(){var e,n=t.getData("activeTab");if(n){switch(e=t.getData("autoFill"),n){case"phone":r.credentials.mbl=e,r.credentials.username=e,r.credentials.lt=2;break;case"email":r.credentials.lt=3,r.credentials.email=e,r.credentials.username=e;break;case"ringid":r.credentials.ringid=e,r.credentials.username=e,r.credentials.lt=1}u(n)}r.$rgDigest()}E()}angular.module("ringid.auth").controller("RingboxAuthController",RingboxAuthController),RingboxAuthController.$inject=["$scope","$boxInstance","$controller","localData"];function RingboxAuthController(e,t,n,r){e.close=t.close,e.closeAll=t.closeAll,e.showLoader=t.showLoader,e.hideLoader=t.hideLoader,e.params=r,n("SignInController",{$scope:e})}angular.module("ringid.auth").controller("SignInController",SignInController),SignInController.$inject=["$authSocial","$controller","$scope","Auth","Ringalert","$rootScope"];function SignInController(e,t,n,r,i,o){angular.extend(this,t("AuthController",{$scope:n})),n.noSignupAllowed=a,n.socialLogin=c;function a(){i.alert({title:"Sign Up",message:"Please sign up from your iOS, Android, Windows enabled device or Desktop prior to logging in from the Web version.",showCancel:!1,okCallback:angular.noop})}function s(t){function i(){ga("send","event","Signin Success. ","Auth Method: "+t),n.params&&n.params.fromPopup?($boxInstance.hideLoader(),window.location="/"):o.$rgDigest()}function a(e){switch(n.params&&n.params.fromPopup&&$boxInstance.hideLoader(),e.rc){case"invalidsocialid":n.requestFailed(e,t+": Unregistered Social ID",!0);break;default:n.requestFailed(e,t+": Something went wrong",!0)}}function s(e){n.params&&n.params.fromPopup&&n.showLoader(),r.login(angular.extend(e,n.credentials),!0).then(i,a)}function c(e){n.params&&n.params.fromPopup&&$boxInstance.hideLoader(),n.requestFailed(e,t+": Authentication Failed",!0)}e.authenticate(t,n.credentials).then(s,c)}function c(e){n.credentials.authMethod=e,s("twitter"===e?e:e)}}angular.module("ringid.auth").controller("SignUpController",SignUpController),SignUpController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","remoteData","localData"];function SignUpController(e,t,n,r,i,o,a){angular.extend(this,n("AuthController",{$scope:t})),t.close=r.close,t.closeAll=r.closeAll,t.newUid="",t.credentials.repassword="",t.credentials.vc="",t.credentials.name="",t.signupStep=1,t.sendCode=s,t.verifyCode=c,t.signup=l,a&&(t.formStyle.left="0px",t.credentials.mbl="",t.credentials.email="",t.credentials.ringid="",t.credentials.password="",a.signupData&&(t.credentials.authMethod=a.signupData.signupType,t.credentials.flagcode=a.signupData.flagcode),a.socialData&&(angular.extend(t.credentials,a.credentials),t.newUid=a.credentials.uId.toString().substr(2),t.credentials.authMethod=a.socialData.platform,t.credentials.id=a.socialData.id,t.credentials.name=a.socialData.name,t.credentials.access_token=a.socialData.access_token,t.signupStep=3,t.formStyle.left="-700px")),o&&(t.newUid=o.uId.toString().substr(2));function s(n,r){function i(e){e.sucs===!0&&(t.credentials.uId=e.uId,t.newUid=e.uId.toString().substr(2),t.signupStep=2,t.formStyle.left="-350px"),t.requestFailed(e,"Signup:sendcode")}function o(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:sendcode")}r.preventDefault(),t.disableForm||(t.requestFailed(!1),e.sendCode(t.credentials).then(i,o))}function c(n,r){function i(e){e.sucs===!0&&(t.signupStep=3,t.formStyle.left="-700px"),t.requestFailed(e,"Signup:verify")}function o(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:verify")}r.preventDefault(),t.disableForm||(t.requestFailed(!1),e.verifyCode(t.credentials).then(i,o))}function l(n,i){function o(e){e.sucs===!0&&(t.login(!0),r.closeAll()),t.requestFailed(e,"Signup:sendCode")}function a(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:signup")}i.preventDefault(),t.disableForm||t.credentials.password!==t.credentials.repassword||(t.requestFailed(!1),e.signup(t.credentials).then(o,a))}}angular.module("ringid.auth").controller("SignUpSelectController",SignUpSelectController),SignUpSelectController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial"];function SignUpSelectController(e,t,n,r,i){angular.extend(this,n("AuthController",{$scope:t})),t.close=r.close,t.closeAll=r.closeAll,t.socialSignup=a,t.signupData=o;function o(n){function r(){return{signupData:{signupType:n,code:"phone"===n?e.getCountry().code:"Email",flagcode:"phone"===n?e.getCountry().flagcode:"remail"}}}return{data:r,promise:e.sendCode(t.credentials)}}function a(n){function o(){function o(i){function o(o){function a(){t.closeAll()}function s(){r.hideLoader(),t.requestFailed(o,n+": Social Login Failed",!0)}"dologin"===o.rc?(t.credentials.authMethod=n,r.showLoader(),e.login(angular.extend(i,t.credentials),!0).then(a,s)):(r.hideLoader(),t.requestFailed(o,n+": Authentication Failed",!0))}e.openSignup(i,t.credentials).then(angular.noop,o)}function a(e){r.hideLoader(),t.requestFailed(e,n+": Authentication Failed",!0)}i.authenticate(n,t.credentials).then(o,a)}function a(e){r.hideLoader(),t.requestFailed(e,n+": Authentication Failed",!0)}r.showLoader(),e.sendCode(t.credentials,!0).then(o,a)}}angular.module("ringid.auth").controller("PasswordRecoverController",PasswordRecoverController),PasswordRecoverController.$inject=["$controller","Auth","$scope","$boxInstance"];function PasswordRecoverController(e,t,n,r){var i;angular.extend(this,e("AuthController",{$scope:n})),n.close=r.close,n.activeTab="email",n.activeForm="sendcode",n.activateTab=c,n.activateTab(n.activeTab),n.credentials.email="",n.credentials.mbl="",n.fetchRecoverOptions=a,n.sendCode=l,n.verifyCode=u,n.resetPassword=s,n.verifierEnabled=!1,n.enableVerifier=o;function o(){n.verifierEnabled=!0}function a(e){function r(e){n.verifierEnabled=!1;function t(e){/^21/.test(e)&&(n.credentials.uId=e)}e.sucs===!0&&(n.activeForm="resetpassword",e.sgtns.forEach(t)),n.requestFailed(e,"Recovery:verify")}function i(e){n.verifierEnabled=!1,n.requestFailed(e,"Recovery:verify")}t.fetchRecoverOptions(e).then(r,i)}function s(e,r){r.preventDefault();function i(e){n.disableForm=!1,n.errorMsg=e.mg,e.sucs===!0&&n.close(),n.requestFailed(e,"Recovery:reset")}function o(e){n.requestFailed(angular.extend(e,{sucs:!1}),"Recovery:reset")}n.disableForm||n.credentials.password!==n.credentials.repassword||(n.requestFailed(!1),t.resetPassword(n.credentials).then(i,o))}function c(e){n.disableForm||"sendcode"!==n.activeForm||(n.activeTab=e,"email"===n.activeTab?(n.credentials.authMethod="email",n.formStyle.left="0px"):(n.credentials.authMethod="phone",n.formStyle.left="-350px"),n.$rgDigest())}function l(e,r,o){function a(e){e.sucs===!0&&(n.activeForm="verifycode",n.credentials.uId=e.uId),n.requestFailed(e,"phone")}function s(e){n.requestFailed(angular.extend(e,{sucs:!1}),"phone")}i=o,r.preventDefault(),n.disableForm||(n.requestFailed(!1),t.recoverySendCode(n.credentials,i).then(a,s))}function u(e,r){r.preventDefault();function i(e){e.sucs===!0&&(n.activeForm="resetpassword"),n.requestFailed(e,"Recovery:verify")}function o(e){n.requestFailed(angular.extend(e,{sucs:!1}),"Recovery:verify")}n.disableForm||(n.requestFailed(!1),t.recoveryVerifyCode(n.credentials).then(i,o))}}!function(e,t){"use strict";e.module("ringid.filters",["ringid.config"])}(angular,window),angular.module("ringid.filters",["ringid.config"]).filter("validProfileImage",validProfileImage).filter("friendListFilter",friendListFilter).filter("mapListFilter",mapListFilter).filter("ymdDateFilter",ymdDateFilter).filter("mediaFilter",mediaFilter).filter("mapFilter",mapFilter).filter("objectFilter",objectFilter).filter("mapOrderBy",mapOrderByFilter).filter("orderObjectBy",orderObjectBy).filter("arrayFilter",arrayFilter).filter("trust",trustFilter),validProfileImage.$inject=["settings"];function validProfileImage(e){return function(t){return t.indexOf("prof.png")>0?t:e.imBase+t}}friendListFilter.$inject=["APP_CONSTANTS"];function friendListFilter(e){return function(t,n){var r,i,o=[];if(t)for(r=n.name.toLowerCase(),i=0;i<t.length;i++)n.showMutual&&t[i].value.friendshipStatus()!==e.FRIEND||(0===r.length||t[i].value.getName().toLowerCase().indexOf(r)>-1)&&o.push(t[i]);return o}}function mapListFilter(){return function(e,t){var n,r=[];if(e)for(n=0;n<e.length;n++)angular.isArray(t)&&t.indexOf(e[n])===-1?r.push(e[n]):t.get(e[n].value.getKey())||r.push(e[n]);return r}}function ymdDateFilter(){return function(e){var t=new Date(e),n=""+(t.getMonth()+1),r=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),[i,n,r].join("-")}}function mediaFilter(){return function(e,t){var n,r=[];if(e)for(n=0;n<e.length;n++)e[n].value.getType()===t&&r.push(e[n]);return r}}function mapFilter(){return function(e,t){var n,r,i=[];if(e)for(r=t.value?t.value.toLowerCase():"",n=0;n<e.length;n++)e[n].value[t.mapApi]().toLowerCase().indexOf(r)>-1&&i.push(e[n]);return i}}function objectFilter(){function e(e,t){return e.toLowerCase().indexOf(t.toLowerCase())>-1}function t(e,t){return t===e}function n(e,t){return angular.isFunction(e[t])?e[t]():e[t]}return function(r,i){var o,a,s,c=[];if(!i.value)return r;if(r&&r.length>0){switch(i.compare){case"string":o=e;break;default:o=t}for(a=0;a<r.length;a++)s=n(r[a],i.prop),o(s,i.value)&&c.push(r[a])}return c}}trustFilter.$inject=["$sce"];function trustFilter(e){return function(t,n){return e.trustAs(n||"html",t)}}function mapOrderByFilter(){return function(e,t,n){var r,i=[],o=n||{},a=t.length,s=o.reverse,c=o.freeze;return c?e:(angular.forEach(e,function(e){i.push(e)}),i.sort(function(e,n){for(r=0;r<a;r++)if(e.value[t[r]]()!==n.value[t[r]]())return e.value[t[r]]()>n.value[t[r]]()?1:-1;return e.value[t[0]]()>n.value[t[0]]()?1:-1}),s&&i.reverse(),i)}}function arrayFilter(){return function(e,t){var n,r=[],i=t.filterArray,o=t.key;return r=e&&i.length>0?e.filter(function(e){for(n=0;n<i.length;n++)if(e.hasOwnProperty(o)&&e[o]===i[n][o])return!1;return!0}):e}}function getValue(e,t,n){return n?e[t]():e[t]}function orderObjectBy(){return function(e,t){var n,r,i,o=angular.isFunction(e[0][t]),a=getValue(e[0],t,o),s=angular.isString(a);return angular.isArray(e)&&0!==e.length?(e.sort(function(e,a){
return n=getValue(e,t,o),r=getValue(a,t,o),s?(n=n.toLowerCase(),r=r.toLowerCase(),i=n>r?1:n<r?-1:0):i=n-r,i}),e):e}}!function(e,t){"use strict";e.module("ringid.shared",["ringid.filters","ringid.auth","ringid.global_services","ringid.config"])}(angular,window),angular.module("ringid.shared").factory("$$stickerMap",stickerMap).factory("$$stickerImageMap",stickerImageMap),stickerImageMap.$inject=["settings","STICKER_IMAGE_TYPE"];function stickerImageMap(e,t){function n(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};function a(){return o.isSticker}function s(){return o.isLargeEmoticon}function c(){return o.isEmoticon}function l(){return o.src.replace(e.stickerBase,"")}function u(){return o.name}function d(){return o.symbol}function g(){return o.src}function E(){return o.id}return{getKey:E,src:g,symbol:d,getName:u,srcWithoutBase:l,isEmoticon:c,isLargeEmoticon:s,isSticker:a}}return{create:n}}stickerMap.$inject=["$$stackedMap","$$stickerImageMap","settings"];function stickerMap(e,t,n){function r(r,i){var o,a,s=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",c={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+s+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":s+"ca.png",installed:i||!1};for(o=0;o<r.imageList.length;o++)a=t.create(r.imageList[o],c.type,s),c.imageListMap.add(a.getKey(),a);function l(){return c.hoverUrl}function u(){return c.regularUrl}function d(){return c.type}function g(){return c.imageListMap}function E(){return c.categoryId}function m(){return c.isSticker}function T(){return c.isLargeEmoticon}function f(){return c.isEmoticon}function p(e){c.installed=e}function _(){return c.installed}function I(){return c.categoryId}return{sortBy:I,isInstalled:_,setInstalled:p,isEmoticon:f,isLargeEmoticon:T,isSticker:m,getKey:E,getImages:g,getType:d,link:u,hoverLink:l}}return{create:r}}angular.module("ringid.shared").factory("circleMap",circleMap),circleMap.$inject=["userFactory","$$stackedMap","settings","routeService"];function circleMap(e,t,n,r){return{create:function(i){var o,a={gNm:"",grpId:0,ists:0,sAd:"",sAdId:0,ut:0,mc:"",mt:"",ishdn:!1,groupMembers:"",memberList:[],members:{},allMembersMap:t.createNew(),adminIds:[],memberIds:[]};angular.isObject(i)&&(a=angular.extend({},a,i)),a.grpId=parseInt(a.grpId,10);function s(){}function c(e){var t=a.adminIds.indexOf(e);t!==-1&&a.adminIds.splice(t,1)}function l(e){var t=a.memberIds.indexOf(e);t!==-1&&a.memberIds.splice(t,1)}function u(){a.mc=a.allMembersMap.length()}function d(e){angular.extend(a,e)}function g(){return'<a class="cir-title" href="'+o.getLink()+'" >'+a.gNm+"</a>"}function E(){return a.gNm}function m(){return a.grpId}function T(e){var t=e||"";return r.getRoute("CIRCLE",{circleId:a.grpId,subpage:t})}function f(e){var t=e||"";return n.baseUrl+r.getRoute("CIRCLE",{circleId:a.grpId,subpage:t})}function p(e){a.mc=e}function _(){return a.mt}function I(){return a.mc}function h(){return a.allMembersMap.length()}function A(){return a.adminIds.slice()}function C(){return a.memberIds.slice()}function S(){return a.allMembersMap}function v(e){a.allMembersMap.remove(e),c(e),l(e),u()}function M(){a.allMembersMap.reset(),a.adminIds=[],a.memberIds=[]}function D(t){var n;function r(t){t.ists||(n=e.create(t),a.allMembersMap.save(n.getKey(),n),t.admin?a.adminIds.indexOf(n.getKey())===-1?a.adminIds.push(n.getKey()):o.promoteToAdmin(n.getKey()):a.memberIds.indexOf(n.getKey())===-1?a.memberIds.push(n.getKey()):o.removeFromAdmin(n.getKey()))}angular.forEach(t,r),s()}function O(){var e,t=a.allMembersMap.copy();for(e=0;e<a.adminIds.length;e++)t.remove(a.adminIds[e]);return t}function R(e){return a.allMembersMap.get(e)}function N(){var e,t=a.allMembersMap.copy();for(e=0;e<a.memberIds.length;e++)t.remove(a.memberIds[e]);return t}function P(e){c(e),a.memberIds.indexOf(e)!==-1&&a.memberIds.push(e),a.allMembersMap.get(e).removeGroupAdmin(a.grpId),s()}function y(e){l(e),a.adminIds.indexOf(e)===-1&&a.adminIds.push(e),a.allMembersMap.get(e).setGroupAdmin(a.grpId),s()}function b(){return a.sAd}function U(e){return a.sAdId===e}function L(){return 0===a.mt}function F(){return 1===a.mt}function k(t,n){var r=e.create(t);a.allMembersMap.save(r.getKey(),r),n?o.promoteToAdmin(r.getKey()):o.removeFromAdmin(r.getKey()),u()}function w(){return a.gNm.toLowerCase()}function G(e){return a.ishdn=!!e,a.ishdn}function B(){return!!a.ishdn}return o={sortBy:w,update:d,addMember:k,isAdmin:F,isMember:L,isSuperAdmin:U,getSuperAdminUId:b,promoteToAdmin:y,removeFromAdmin:P,getAdmins:N,getMember:R,getMembers:O,setMembers:D,resetMembers:M,removeMember:v,getAllMembers:S,getMemberIds:C,getAdminIds:A,getMembersObjectCount:h,getMembersCount:I,getMemberType:_,setMemberCount:p,getLink:f,getLinkOnly:T,getKey:m,getName:E,getAnchor:g,hide:G(),isHidden:B}}}}angular.module("ringid.shared").factory("$$imageMap",$$imageMap),$$imageMap.$inject=["settings","$$stackedMap","userFactory","Utils"];function $$imageMap(e,t,n,r){var i={albId:"",albn:"",cptn:"",nfId:0,ic:0,ih:0,il:0,imT:0,imgId:0,iurl:"",iw:0,nc:0,nl:0,tm:0,user:null};function o(e,t){var n=this,r=e||{};b&&(n._u=t),n.updateImage(r),Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.image.imgId,showReportButton:function(){return n._u&&!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"image"}}})}function a(e){try{return this.image.ih/this.image.iw*e}catch(t){return this.image.ih}}function s(){return"/image/"+this.getKey()}function c(e,t){this.image.nc=e,angular.isDefined(t)&&(this.image.ic=t)}function l(){return this.image.nc}function u(){return this.image.ic}function d(){return{width:this.image.iw,height:this.image.ih}}function g(e){return e&&++this.image.nl||--this.image.nl}function E(){return this.image.imT}function m(e,t){this.image.nl=e,angular.isDefined(t)&&(this.image.il=t)}function T(){return this.image.nl}function f(){return this.image.nl}function p(e,t){return e?(this.image.il=1^this.image.il,t?this.image.nl=t:this.image.nl=0===parseInt(this.image.il,10)?this.image.nl-1:this.image.nl+1,this.image.il):this.image.il}function _(){return this._time}function I(e){this.image.nfId=e}function h(){return this.image.nfId}function A(){return this.key}function C(){return this.image.imgId}function S(){return this.image.cptn}function v(){return this.image.albId}function M(){return this.image.albn}function D(){return this.image.tm}function O(){return this.image.iw}function R(){return this.image.ih}function N(){return this.image.imgId}function P(e,t){return this.image.hasOwnProperty(e)?this.image[e]:t}function y(t){var n,r,i;return"iurl"===t?this.image.iurl:(n=this.image.iurl.lastIndexOf("/")+1,i=/\/uploaded\//.test(this.image.iurl)?"":"p",r=void 0!==t?[e.imBase,this.image.iurl.slice(0,n),i,t,this.image.iurl.slice(n)].join(""):[e.imBase,this.image.iurl.slice(0,n),i,this.image.iurl.slice(n)].join(""))}function b(){return this._u}function U(e){this.image?angular.extend(this.image,e):this.image=angular.extend({},i,e),this.key="im"+this.image.imgId,this.image.tm?this._time=r.verbalDate(this.image.tm):this._time={},!this._u&&this.image.hasOwnProperty("uId")&&(this._u=n.create({uId:this.image.uId,fn:this.image.fn||""}))}function L(){return{ih:this.image.ih,iw:this.image.iw,cptn:this.image.cptn}}return o.prototype={updateImage:U,user:b,src:y,getByProperty:P,sortBy:N,getIh:R,getIw:O,sortByTime:D,getAlbumName:M,getAlbumId:v,getCaption:S,getKey:C,getMapKey:A,getFeedKey:h,setFeedKey:I,time:_,like:p,getLikes:f,getTotalLikes:T,setTotalLikes:m,getImageType:E,incomingLike:g,offset:d,selfComment:u,getTotalComment:l,setTotalComment:c,getUrl:s,getRelativeHeight:a,getAuthData:L},function(e,t){return new o(e,t)}}angular.module("ringid.shared").factory("$$mediaMap",$$mediaMap),$$mediaMap.$inject=["userFactory","Auth","$$stackedMap","settings","APP_CONSTANTS","$$q","Storage","Ringalert","Api","$ringhttp"];function $$mediaMap(e,t,n,r,i,o,a,s,c,l){var u=i,d={ac:0,albId:0,cc:0,ic:0,il:0,lc:0,is:0,ns:0,nfId:0,albn:"",artst:"",cntntId:0,drtn:0,mdaT:1,strmURL:"",thmbURL:"",ttl:"",tih:0,tiw:0,user:null,viewtime:0,utId:"",autoplay:!1,gotDetails:!1};function g(e,t){var n=this;n.updateMedia(e),n.setUser(e,t),Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.media.key,showReportButton:function(){return!n._u.isCurrentUser()},showAddToAlbum:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"media"},getRingboxData:function(){return function(){return{media:n}}},showMediaShareButton:function(){return!!n.getToken()}}})}function E(e){var t,n=new Date,r=!1,i=a.getData("mediaRecent")||[],o={ac:e.mdaCntntDTO.ac,albId:e.mdaCntntDTO.albId,albn:e.mdaCntntDTO.albn,artst:e.mdaCntntDTO.artst,cntntId:e.mdaCntntDTO.cntntId,mdaT:e.mdaCntntDTO.mdaT,drtn:e.mdaCntntDTO.drtn,strmURL:e.mdaCntntDTO.strmURL,thmbURL:e.mdaCntntDTO.thmbURL,ttl:e.mdaCntntDTO.ttl,utId:e.mdaCntntDTO.utId,viewtime:n.getTime()};for(t=0;t<i.length;t++)if(i[t].cntntId===e.mdaCntntDTO.cntntId){r=t;break}r?i[r]=o:(i.length>=6&&i.shift(),i.push(o)),a.setData("mediaRecent",i)}function m(){return this.token}function T(){var e=o.defer(),t=this;function n(n){n.sucs?(t.token=n.id,e.resolve(n.id)):e.reject(!1)}function r(t){e.reject(t)}return t.token?setTimeout(function(){e.resolve(t.token)}):l.get("mediaID?mediaID="+t.getKey()+"&ip="+a.getCookie("authServer")+"&port="+a.getCookie("comPort")).success(n).error(r),e.promise}function f(e){var t,n=o.defer(),r=this;function i(e){e.sucs===!0?(r.updateMedia(e.mdaCntntDTO,!0),E(e),n.resolve(r)):(n.reject(e),s.show(e,"info"))}return r.media.gotDetails?n.resolve(r):(t={cntntId:r.getKey(),utId:e?e.getUtId():r.owner().getUtId()},c.media.mediaDetails(t).then(i)),n.promise}function p(e){var t=this;return c.media.updateContent({id:t.getId(),strmURL:t.getStreamUrlOnly(),albId:t.getAlbumId(),drtn:t.getDuration(),thmbURL:t.getThumbUrlOnly(),artst:t.getArtistName(),ttl:e.ttl,utId:t.getMediaUtId()})}function _(){var e=o.defer(),t=this;function n(n){n.sucs===!0&&t.media.ac++,e.resolve()}return c.media.increaseView(t.media.cntntId).then(n),e.promise}function I(){return{strmURL:this.media.strmURL,tiw:this.media.tiw,tih:this.media.tih,drtn:this.media.drtn,thmbURL:this.media.thmbURL,artst:this.media.artst,ttl:this.media.ttl.utf8Encode()}}function h(){return r.httpsUrl+"/player/embed?id="+this.token}function A(e){var t;return t=e?"height"===e?this.media.tih:this.media.tiw:{width:this.media.tiw,height:this.media.tih}}function C(e){return e?(this.media.is=1^this.media.is,this.media.ns=this.media.is?this.media.ns+1:this.media.ns-1,this.media.is):this.media.is}function S(e,t){this.media.ns=e,angular.isDefined(t)&&(this.media.is=t)}function v(){return this.media.ns}function M(){return this.media.cc}function D(){return this.media.ic}function O(e,t){this.media.cc=e,angular.isDefined(t)&&(this.media.ic=t)}function R(){return this.media.lc}function N(e,t){this.media.lc=e,angular.isDefined(t)&&(this.media.il=t)}function P(){return this.media.lc}function y(e,t){return e?(this.media.il=1^this.media.il,t?this.media.lc=t:this.media.lc=0===this.media.il?this.media.lc-1:this.media.lc+1,this.media.il):this.media.il}function b(){return this.media.il}function U(){return this.media.feedThumb}function L(){var e=this.media.poster;return""===this.media.thmbURL&&(e=1===this.media.mdaT?"images/default_audio_preview.jpg":"images/default_video_preview.jpg"),e}function F(){return this.media.thmbURL}function k(){return this.media.poster}function w(){return this.media.strmURL}function G(){var e,t,n=r.mediaBase+this.media.strmURL;return 2===this.media.mdaT&&(e=this.media.strmURL.match(/media-(\d+)/),e&&2===e.length&&parseInt(e[1],10)>140&&(t=n.lastIndexOf("/")+1,n=[n.slice(0,t),"h",n.slice(t)].join(""))),n}function B(){return this.media.ttl}function $(e){var t,n,r;return e?(n=this.media.drtn/60===0?"00":Math.floor(this.media.drtn/60),r=this.media.drtn%60===0?"00":Math.floor(this.media.drtn%60),n=n<10&&"00"!==n?"0"+n:n,r=r<10&&"00"!==r?"0"+r:r,t=n+":"+r):t=this.media.drtn,t}function H(){return this.media.ac}function x(){var e;return e=this.media.ac>1?"Views : "+this.media.ac:"View : "+this.media.ac}function Y(){return this.media.autoplay}function K(e){this.media.autoplay=e}function j(){return this.media.cntntId}function V(){return this._u}function W(){return this._u}function q(){return this.media.mdaT===u.NEWS_FEED_MEDIA_TYPE_VIDEO}function z(){return this.media.mdaT===u.NEWS_FEED_MEDIA_TYPE_AUDIO}function Q(e){return this.media.nfId=e,this.media.nfId}function X(){return this.media.nfId}function Z(){return this.media.key}function J(){return this.media.artst}function ee(){return this.media.albn}function te(){return this.media.albId}function ne(){return this.media.utId}function re(){return this.media.viewtime}function ie(t,n){var r={};angular.isDefined(n)?this._u=n:(t.utId?this._u=e.getByUtId(t.utId):t.uId?this._u=e.getUser(t.uId):this._u=!1,this._u||(t.uId&&(r.uId=t.uId),t.utId&&(r.utId=t.utId),t.fn&&(r.fn=t.fn),t.prIm&&(r.prIm=t.prIm),this._u=e.create(r)))}function oe(e,t){angular.isObject(e)&&(this.media?angular.extend(this.media,e):this.media=angular.extend({},d,e),this.media.gotDetails=!!t,this.media.key=this.media.cntntId||this.media.id,e.thmbURL&&e.thmbURL.length>1?this.media.poster=r.mediaBase+e.thmbURL:(this.media.poster=this.media.mdaT===u.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_preview.jpg":"images/default_video_preview.jpg",this.media.feedThumb=this.media.poster,this.media.tih=330,this.media.tiw=600))}return g.prototype={updateMedia:oe,setUser:ie,sortBy:re,getMediaUtId:ne,getAlbumId:te,getAlbumName:ee,getArtistName:J,getKey:Z,getFeedKey:X,setFeedKey:Q,isAudio:z,isVideo:q,owner:W,user:V,getId:j,setIsAutoPlay:K,getIsAutoPlay:Y,getViewCount:x,getViewCountOnly:H,getDuration:$,getCaption:B,getStreamUrl:G,getStreamUrlOnly:w,getThumb:k,getThumbUrlOnly:F,getThumbForMedia:L,feedThumb:U,iLiked:b,like:y,getLikes:P,getTotalLikes:R,setTotalLikes:N,setTotalComment:O,selfComment:D,getTotalComment:M,getTotalShare:v,setTotalShare:S,share:C,thumbOffset:A,getEmbedUrl:h,addToAlbumData:I,getAuthData:I,updateDTO:p,increaseView:_,updateRecentMedias:E,fetchDetails:f,getToken:m,setMediaToken:T},function(e,t){return new g(e,t)}}angular.module("ringid.shared").factory("$$newsPortalMap",$$newsPortalMap),$$newsPortalMap.$inject=["settings","routeService"];function $$newsPortalMap(e,t){function n(n){var r={cIm:n.cIm,cImId:n.cImId,cimX:n.cimX,cimY:n.cimY,cntr:n.cntr,nop:n.nop,pId:n.pId,fn:n.fn,nPCatId:n.nPCatId,nPCatName:n.nPCatName,nPslgn:n.nPslgn,prIm:n.prIm,prImId:n.prImId,subCount:n.subCount,subsc:n.subsc,uId:n.uId,utId:n.utId};function i(){return r.pId}function o(){return r.fn}function a(){return r.nPCatId}function s(){return r.nPCatName}function c(){return r.nPslgn}function l(){return r.prIm?e.imBase+r.prIm:"../../../images/test/1.png"}function u(){return r.cIm?e.imBase+r.cIm:"../../../images/default_cover.jpg"}function d(){return r.prIm?e.imBase+r.prIm:"../../../images/test/2.png"}function g(){return r.subCount}function E(){return r.subCount>1?r.subCount+" followers":r.subCount+" follower"}function m(e){r.subsc=e}function T(){return r.subsc}function f(){return r.uId}function p(n){var i;return"following"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL_FOLLOWING")),"discover"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL_DISCOVER")),"saved"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL_SAVED")),"profile"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL",{portalid:r.pId})),i}function _(){return p("profile")}function I(){return l()}function h(){return!1}return{getKey:i,getName:o,getFullName:o,getCategoryId:a,getCategoryName:s,getPortalSlogan:c,getProfileImage:l,getCoverImage:u,getFollowAndSliderImage:d,getSubCount:g,getFollowerCountWithText:E,setIfSubscribed:m,isSubscribed:T,getUid:f,getLink:p,isCurrentUser:h,link:_,avatar:I,isNewsPortal:!0}}return{create:n}}angular.module("ringid.shared").factory("$$mediaPortalMap",$$mediaPortalMap),$$mediaPortalMap.$inject=["settings","routeService"];function $$mediaPortalMap(e,t){function n(n){var r={cIm:n.cIm,cImId:n.cImId,cimX:n.cimX,cimY:n.cimY,cntr:n.cntr,nop:n.nop,pId:n.pId,fn:n.fn,nPCatId:n.nPCatId,nPCatName:n.nPCatName,nPslgn:n.nPslgn,prIm:n.prIm,prImId:n.prImId,subCount:n.subCount,subsc:n.subsc,uId:n.uId,utId:n.utId};function i(){return r.pId}function o(){return r.fn}function a(){return r.nPCatId}function s(){return r.nPCatName}function c(){return r.nPslgn}function l(){return r.prIm?e.imBase+r.prIm:"../../../images/test/1.png"}function u(){return r.cIm?e.imBase+r.cIm:"../../../images/default_cover.jpg"}function d(){return r.prIm?e.imBase+r.prIm:"../../../images/test/2.png"}function g(){return r.subCount}function E(){return r.subCount>1?r.subCount+" followers":r.subCount+" follower"}function m(e){r.subsc=e}function T(){return r.subsc}function f(){return r.uId}function p(n){var i;return"profile"===n&&(i=e.baseUrl+t.getRoute("MEDIA_PAGE_PROFILE",{mpageid:r.pId})),i}function _(){return p("profile")}function I(){return l()}function h(){return!1}return{getKey:i,getFullName:o,getName:o,getCategoryId:a,getCategoryName:s,getPortalSlogan:c,getProfileImage:l,getFollowAndSliderImage:d,getSubCount:g,getFollowerCountWithText:E,setIfSubscribed:m,isSubscribed:T,getUid:f,getLink:p,isCurrentUser:h,link:_,avatar:I,getCoverImage:u}}return{create:n}}angular.module("ringid.shared").factory("$$businessPageMap",$$businessPageMap),$$businessPageMap.$inject=["settings","routeService"];function $$businessPageMap(e,t){function n(n){var r={pId:n.pId,fn:n.fn,nPCatId:n.nPCatId,nPCatName:n.nPCatName,nPslgn:n.nPslgn,prIm:n.prIm,cIm:n.cIm,subCount:n.subCount,subsc:n.subsc,uId:n.uId,utId:n.utId,nop:n.nop};function i(){return r.pId}function o(){return r.fn}function a(){return r.nPCatId}function s(){return r.nPCatName}function c(){return r.nPslgn}function l(){return r.prIm?e.imBase+r.prIm:"../../../images/test/1.png"}function u(){return r.prIm?e.imBase+r.prIm:"../../../images/test/2.png"}function d(){return r.subCount}function g(){return r.subCount>1?r.subCount+" followers":r.subCount+" follower"}function E(e){r.subsc=e}function m(){return r.subsc}function T(){return r.uId}function f(){return t.getRoute("PAGE",{portalid:r.pId})}function p(){return f("profile")}function _(){return l()}function I(){return!1}return{getKey:i,getName:o,getFullName:o,getCategoryId:a,getCategoryName:s,getSlogan:c,getProfileImage:l,getFollowAndSliderImage:u,getSubCount:d,getFollowerCountWithText:g,setIfSubscribed:E,isSubscribed:m,getUid:T,getLink:f,isCurrentUser:I,link:p,avatar:_,isBusinessPage:!0}}return{create:n}}angular.module("ringid.shared").factory("CelebrityMap",CelebrityMap),CelebrityMap.$inject=["userFactory"];function CelebrityMap(e){return{create:e.createCelebrityUser}}angular.module("ringid.shared").factory("$$breakingNewsMap",$$breakingNewsMap),$$breakingNewsMap.$inject=["settings","routeService"];function $$breakingNewsMap(e,t){function n(n){var r={pId:n.pId,id:n.id,nSDctn:n.nSDctn,nTtl:n.nTtl,prIm:n.prIm,pttl:n.pttl,subsc:n.subsc,uId:n.uId,utId:n.utId,subCount:n.subCount};function i(){return r.id}function o(){return r.nSDctn}function a(){return r.nTtl}function s(){return r.pttl}function c(){return r.prIm?e.imBase+r.prIm:"../../../images/test/1.png"}function l(){return r.prIm?e.imBase+r.prIm:"../../../images/test/2.png"}function u(e){r.subsc=e}function d(){return r.subsc}function g(){return r.uId}function E(){return r.utId}function m(){return r.subCount}function T(e){var n;return"newsportal"===e&&(n=t.getRoute("NEWSPORTAL",{portalid:r.pId})),"pages"===e&&(n=t.getRoute("PAGE",{portalid:r.pId})),n}return{getKey:i,getDescription:o,getNewsTitle:a,getPortalTitle:s,getProfileImage:c,getFollowAndSliderImage:l,setIfSubscribed:u,isSubscribed:d,getFollowerCount:m,getUid:g,getUtId:E,getProfileLink:T}}return{create:n}}angular.module("ringid.shared").factory("$$mediaAlbumMap",$$mediaAlbumMap),$$mediaAlbumMap.$inject=["Ringalert","Auth","settings","fileUploadService","$$stackedMap","Api","$$mediaMap","APP_CONSTANTS","Utils","routeService","$$q","userFactory"];function $$mediaAlbumMap(e,t,n,r,i,o,a,s,c,l,u,d){var g=s;function E(e){return parseInt(e.albId,10)||parseInt(e.id,10)}return{createKey:function(e){return E(e)},createAlbum:function(t,s){var E={albn:"",albId:0,mc:0,mdc:0,mdaT:1,sts:0,utId:0,imgURL:"",contents:i.createNew(),uniqueKey:c.getUniqueID(),cover:"",key:0,type:"",owner:null};function m(e){angular.isObject(e)&&(E=angular.extend({},E,e),E.albId=parseInt(e.albId,10)||parseInt(e.id,10),E.key=E.albId,e.imgURL&&e.imgURL.length>1?E.cover=n.imBase+e.imgURL:E.cover=t.mdaT===g.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_preview.jpg":"images/default_video_preview.jpg",E.type=t.mdaT===g.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video")}E.owner=s||d.createByUtId({utId:t.utId}),m(t);function T(e,t,n){var r,i,o,s=t||E.owner;for(i=0,o=e.length;i<o;i++)n&&(e[i].nfId=n),r=a(angular.extend(e[i],{albId:E.key,albn:E.albn}),s),E.contents.save(r.getKey(),r);return E}function f(e){var t=u.defer();function n(n){n.sucs===!0?(E.contents.remove(e.getKey()),E.mc--,t.resolve()):t.reject()}return o.media.deleteContent(e.getId()).then(n,n),t.promise}function p(e){var t=u.defer();o.media.updateAlbum({albId:E.albId,imgURL:E.imgURL,mdaT:E.mdaT,albn:e.utf8Encode()}).then(n,r);function n(n){n.sucs===!0?(E.albn=e,t.resolve()):t.reject()}function r(e){t.reject()}return t.promise}function _(t){var n,i,a="audio"===E.type?"audioFiles":"videoFiles",s={albId:E.albId,mdaLst:[],mdaT:E.mdaT};function c(e){if(e.sucs===!0){for(E.mc+=e.mdaIds.length,n=0,i=e.mdaIds.length;n<i;n++)s.mdaLst[n].cntntId=e.mdaIds[n];T(s.mdaLst)}}if(t){if(E.contents.get(t.getKey()))return void e.show("Content Already Added","warning");s.mdaLst.push(t.addToAlbumData())}else for(n=0,i=r[a].length;n<i;n++)s.mdaLst.push(r[a][n].getAuthData());o.media.addMedia(s).then(c)}function I(){return!(!E.owner||!E.owner.isCurrentUser())}function h(e){var t="";return 0===M()?t:t="true"===e?l.getRoute("PROFILE",{uId:E.owner.getUId(),subpage:"media",albumType:this.getType(),albumId:this.getId()}):l.getRoute("MEDIA_CLOUD_MYALBUM",{albumType:this.getType(),albumId:this.getId()})}function A(){return E.utId}function C(e,t,n,r){return T(e,t,n,r)}function S(e){m(e)}function v(){return E.contents}function M(){return E.mc||E.mdc}function D(){var e=M();return e>1?"audio"===E.type?" Songs":" Videos":"audio"===E.type?" Song":" Video"}function O(){return E.cover}function R(){return E.albn}function N(){return E.albId}function P(){return E.mdaT===g.NEWS_FEED_MEDIA_TYPE_VIDEO}function y(){return E.mdaT===g.NEWS_FEED_MEDIA_TYPE_AUDIO}function b(){return E.type}function U(){return E.key}return{getKey:U,getType:b,isAudio:y,isVideo:P,getId:N,getName:R,getCover:O,getContentCount:M,getContentText:D,getContents:v,updateAlbum:S,pushContent:C,getALbumUtId:A,canEdit:I,link:h,addNewContent:_,deleteContent:f,changeName:p}}}}angular.module("ringid.shared").factory("$$feedMap",$$feedMap),$$feedMap.$inject=["Auth","settings","$$stackedMap","$$imageMap","circleMap","Media","$$mediaAlbumMap","$$mediaMap","userFactory","Utils","TextParser","circlesManager","$sce","EmotionFactory","MESSAGES","OPERATION_TYPES","PrivacySet","routeService","$$newsPortalMap","$$businessPageMap","$$mediaPortalMap","Storage"];function $$feedMap(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I,h,A){var C="nf_",S="tm",v=m.FEED,M=T.SYSTEM,D=M.FEED_SUPER_TYPES,O=A.getCookie("stDiff")?Date.now()+parseInt(A.getCookie("stDiff"),10):Date.now(),R={nfId:0,utId:0,isNew:0,lctn:"",lat:9999,lng:9999,gNm:"",grpId:0,sts:"",stsTags:[],tim:0,imc:0,imT:0,fndId:0,futId:0,whoShare:{},mdaCntntLst:[],type:0,mdLst:[],tm:Date.now(),uat:O,ic:0,il:0,is:0,nc:0,nl:0,ns:0,sc:0,tfc:0,stp:0,fc:0,actvt:0,afn:"",auId:0,ishdn:!1,isuhdn:!1,lnkDmn:"",lnkDsc:"",lnkTtl:"",lnkURL:"",lnlImgURL:"",fTgLst:[]};function N(e){var t,n=["<user-card "];if(angular.isString(e))n.push('user="'+e+'" ');else if(angular.isObject(e))for(t in e)e.hasOwnProperty(t)&&n.push(t+'="'+e[t]+'" ');return n.push("> </user-card>"),n.join("")}function P(e,t){var r,i,o=this;o.key=C+e.nfId,o.updateRaw(e),o.setFeedUser(t),o.feelings={},o._page=!1,o.tagUsers=[],o.shareUsers=[],o.circle={},o.orginal={},o.feedHtml="",o.images=n.createNew(!0,"asc"),o.medias=n.createNew(),o.audios=n.createNew(),o.setImages(),o.initMedias(),o._f.futId?o.friend=c.create({utId:o._f.futId,uId:o._f.fndId,fn:o._f.ffn,ln:o._f.fln}):o.friend=!1,o.initOgData(),o.initLocationData(),o.update(null,!1,!0),o.isSingleContentFeed()&&(i=o.getSingleContent(),o.images.length()||i.setTotalShare(o._f.ns,o._f.is),i.setTotalComment(o._f.nc,o._f.ic),i.setTotalLikes(o._f.nl,o._f.il)),o._f.npFeedInfo&&(r=o._f.npFeedInfo.pInfo||{},r.subsc=o._f.npFeedInfo.subsc,r.utId=o._f.utId,r.uId=o._f.uId,r.prIm=r.prIm||"",o.isNewsPortal()?o._page=_.create(r):o.isBusinessPage()?o._page=I.create(r):o.isMediaPage()&&(o._page=h.create(r))),Object.defineProperty(o,"ddControl",{enumerable:!1,configurable:!1,writable:!0,value:{feedKey:o._f.nfId,showEdit:function(){return o._u.isCurrentUser()&&!o.isProfileCoverFeed()&&!o.isMediaShared()},getKey:function(){return o._f.nfId},feedUser:function(){return o.user()},tagButtonText:function(){return o.tagUsers.length?"Edit Tag":"Add Tag"},showDelete:function(){return o._u.isCurrentUser()||o.friend&&o.friend.isCurrentUser()},showTagButton:function(){return o._u.isCurrentUser()&&!o.isCirclePost()},showReportButton:function(){return!o._u.isCurrentUser()},showUserHide:function(){return!o._u.isCurrentUser()&&(o.isGeneral()||o.isCirclePost())},getHideUnhideText:function(){return o.isHidden()?"Unhide this feed":"Hide this feed"},showCircleHide:function(){return o.isCirclePost()},showSaveUnsave:function(){return!0},getSpamId:function(){return o.isSingleContentFeed()?o.getSingleContent().getKey():o.getKey()},getSpamType:function(){return o.images.length()&&"image"||o.medias.length()&&"media"||o.audios.length()&&"media"||"feed"},isSaved:function(){return o.isSaved()}}})}P.prototype={updateRaw:y,update:b,getKey:U,sortBy:L,getMapKey:F,setFeedKey:k,getFeedKey:U,getPrivacy:w,checkMessageUpdated:G,getTargetWall:B,getTargetCircle:$,setFeedUser:H,user:x,processFeedMessage:Y,updateShareMessage:K,addPostfixMessage:j,getMessageText:V,hasActivityMessage:W,setActivity:q,setFeedTopMessage:z,getActivityMessage:Q,getActivityUser:X,parseStatus:Z,parseMoreText:J,getCroppedHtml:ee,showMore:te,setText:ne,text:re,getStsTags:ie,getDynamicText:oe,getAtTime:ae,setUpdatedTime:se,time:ce,updateTime:le,setTime:ue,getTimestamp:de,incomingLike:ge,like:Ee,setTotalLikes:me,setIdenticalFeed:Te,getTotalLikes:fe,setTotalComment:pe,getTotalComment:_e,selfComment:Ie,getTotalShare:he,getShareUsers:Ae,addShareUser:Ce,share:Se,shares:ve,getWhoShares:Me,getOrginalFeed:De,hasSharedFeed:Oe,getTotalImage:Re,setImages:Ne,getImages:Pe,getImageLayout:ye,hasMedia:be,getAlbum:Ue,initMedias:Le,getMedias:Fe,getAudios:ke,setViewColumn:we,getViewColumn:Ge,getUrl:Be,getWhoShareUrl:$e,hasFeelings:He,getFeelings:xe,setFeelings:Ye,setTagUsers:Ke,updateTagUser:je,hasTagUsers:Ve,getTagUsers:We,validateForUpdateTag:qe,hasMoreTagUsers:ze,getMoreTagUsers:Qe,getTotalTag:Xe,getLocationText:Ze,getLocationShortText:Je,setLocationText:et,resetLocationText:tt,getContentType:nt,hasLocationInfo:rt,getLocationInfo:it,getLocationUrl:ot,getLocationEmbedUrl:at,getLocationStaticEmbedUrl:st,initLocationData:ct,setLocationInfo:lt,getStrmURL:ut,getLinkDomain:dt,getLinkUrl:gt,getLinkTitle:Et,getLinkDescription:mt,getLinkImageUrl:Tt,hasOgData:ft,getOgData:pt,initOgData:_t,setOgData:It,isEmpty:ht,isFeed:!0,isHidden:At,isGeneral:Mt,isSpecial:vt,isSaved:Ct,setSaveUnsave:St,isCelebrity:Dt,isNewsPortal:Ot,isBusinessPage:Rt,isMediaPage:Nt,getSuperType:yt,isTimelinePost:bt,isWallPost:Ut,isCirclePost:Lt,isMediaShared:Ft,isProfileCoverFeed:Pt,isSingleContentFeed:kt,getSingleContent:wt,hasNewsPortalFeed:Gt,hasExternalUrl:Bt,getNewsPortalcatId:$t,getNewsPortalDescription:Ht,setNewsPortalDescription:xt,getNewsPortalShortDescription:Yt,getNewsPortalTitle:Kt,hasNewsPortalUrl:jt,getNewsPortalUrl:Vt,getPortalBaseUrl:Wt,isSavedNewsPortal:qt,setPortalSaveStatus:zt,isPending:Qt,isShareAble:Xt,encodeUtf8Fields:Zt,feedConditionalReplacer:Jt};function y(e,t){var n;this._f?(n=t||!e.tm?this._f.tm:e.tm,angular.extend(this._f,e),this._f.tm=n):this._f=angular.extend({},R,e),9999===this._f.lat&&(this._f.lctn=""),this.ddControl&&(this.ddControl.feedKey=this._f.nfId)}function b(e,t,n){var r,i=this;n||i.updateRaw(e,t),i._f.mdLst&&i._f.mdLst.length&&(i.feelings=E.getEmotion(i._f.mdLst[0],!0)),i.setTagUsers(),r=A.getCookie("stDiff")?parseInt(A.getCookie("stDiff"),10):0,i._f.at||(i._f.at=Date.now()-r),i.setUpdatedTime(r),i.setFeedTopMessage(),i.processFeedMessage(),i.addPostfixMessage(),i.parseStatus()}function U(){return this._f.nfId}function L(){return this._f[S]||this._f.tm}function F(){return this.key}function k(e){this._f.nfId=e}function w(){return f["PVC"+(this._f.fpvc||3)]}function G(){return this.message+this._f.lctn+this.tagUsers.reduce(function(e,t){return e.toString()+t.toString()},"")+this._f.tfc}function B(){return this.friend}function $(){return angular.equals({},this.circle)?this._f.gNm:this.circle}function H(e){var t,n=this;angular.isDefined(e)?n._u=e:(n._f.utId?n._u=c.getByUtId(n._f.utId):n._f.uId?n._u=c.getUser(n._f.uId):n._u=!1,n._u||(t={},n._f.uId&&(t.uId=n._f.uId),n._f.utId&&(t.utId=n._f.utId),n._f.fn&&(t.fn=n._f.fn),n._f.prIm&&(t.prIm=n._f.prIm),n._u=c.create(t,!1,!1,n.isCelebrity())))}function x(e){var t=this;return e?t._u:t.isNewsPortal()||t.isBusinessPage()||t.isMediaPage()?t._page:t._u}function Y(){var e,t,n="",r="",o=this,a=[N({user:"feed.user()",type:o._f.spType})];switch(o.friend?n="F":o.isCirclePost()&&(o.circle=d.getCircle(o._f.grpId),o.circle||(o.circle=i.create({grpId:o._f.grpId,gNm:o._f.gNm})),n="C"),o._f.type){case M.NEWS_FEED_TYPE_IMAGE:1===o.images.length()?(o.message=v["TYPE_1"+o.images.top().getImageType()+n]||v.TYPE_D,o.message=o.feedConditionalReplacer(o.message,[o._u.isCurrentUser()])):o.images.length()>1?(o.message=v["TYPE_3"+n]||v.TYPE_D,o.message=o.feedConditionalReplacer(o.message,[o._u.isCurrentUser()]),a.push(o.getTotalImage())):o.message=v.TYPE_D;break;case M.NEWS_FEED_TYPE_STATUS:o.hasOgData()&&(r="L"),o.message=v["TYPE_2"+n+r];break;case M.NEWS_FEED_TYPE_AUDIO:case M.NEWS_FEED_TYPE_VIDEO:if(!o.medias.length()&&!o.audios.length()){o.message=v.TYPE_D;break}e=o._f.stp||0,o.message=v["TYPE_"+o._f.type+e],t=M.NEWS_FEED_TYPE_AUDIO===o._f.type?1===o.audios.length():1===o.medias.length(),o.message=o.feedConditionalReplacer(o.message,[t]),e||!o.medias.length()&&!o.audios.length()?a.push(N({user:"feed.getSingleContent().user()",type:o.getSuperType(),"class":"share-user"})):a.push(o.medias.length()||o.audios.length());break;default:o.message=v.TYPE_D}o.friend?o.message+=" "+v.F_POSTFIX.format(N({user:"feed.getTargetWall()",type:o.getSuperType(),"class":"wall-user"})):o.isCirclePost()&&(o.message+=" "+v.C_POSTFIX.format('<a class="cir-title" href="'+o.circle.getLink()+'" >'+o.circle.getName()+"</a>")),o.rawmessage=o.message,o.message=o.message.format(a),o.oldMessage=o.message}function K(){var e=this,t=[N({user:"feed.user()",type:e.getSuperType()})];e.message=v.TYPE_SHARE,t.push(N({user:"feed.getOrginalFeed().user()",type:e.getOrginalFeed().getSuperType(),"class":"share-user"})),e.message=e.message.format(t),e.oldMessage=e.message,e.addPostfixMessage()}function j(){var e=this;e.message=e.oldMessage,(e._f.mdLst.length||e.tagUsers.length||e.location)&&("{0}"!==e.rawmessage||e.hasSharedFeed()?e.message+=" &mdash;":e.message+=" is"),e._f.mdLst.length&&(e.message+='<span class="feelings-text">&nbsp;feeling&nbsp;</span><img class="feed_emo" src="'+e.feelings.url+'" />&nbsp;'+e.feelings.nm),e.tagUsers.length&&(e.message+='&nbsp;<feed-tag-more-user tag-feed="feed"></feed-tag-more-user>'),
this._f.lctn&&(e.message+='&nbsp;<location-card feed="feed"></location-card>')}function V(){return this.message}function W(){return this._f.actvt>0&&1!==this._f.fc}function q(e){this._f.actvt=e.actvt||0,this._f.afn=e.afn,this._f.auId=e.auId,this.setFeedTopMessage()}function z(){var t,n,r=this;r._f.actvt>0&&(r.subMessage="",r._f.actvt&&m.FEED["ACT_"+r._f.actvt]&&(t=c.getByUtId(r._f.auId),n="<b>You</b>",t?t.isCurrentUser()||(n='<user-card user="feed.getActivityUser()"></user-card>'):e.currentUser().getUtId()!==r._f.auId&&(t=c.createByUtId({fn:r._f.afn,utId:r._f.auId},!0),n='<user-card user="feed.getActivityUser()"></user-card>'),r._au=t,r.subMessage=m.FEED["ACT_"+r._f.actvt].format(n)),r.subMessage=g.trustAsHtml(r.subMessage))}function Q(){return this.subMessage}function X(){return this._au}function Z(){this.feedHtml=g.trustAsHtml(u.textToHtml(this._f.sts,this._f.stsTags))}function J(e){this._f.sts=e.sts,this.parseStatus()}function ee(e){return g.trustAsHtml(u.textToHtml(e,this._f.stsTags,e.length))}function te(){return!!this._f.sc}function ne(e,t){this._f.sts=e,t&&(this._f.stsTags=t),this.parseStatus()}function re(){return this._f.sts}function ie(){return this._f.stsTags||[]}function oe(){return this.feedHtml}function ae(){return this._f.at}function se(e){this._f.uat=this._f.at+parseInt(e,10),this.vtime=l.verbalDate(this._f.uat)}function ce(){return this.vtime}function le(){this.vtime=l.verbalDate(this._f.at)}function ue(e){this._f.tm=e}function de(){return this._f.tm}function ge(e){return e&&++this._f.nl||--this._f.nl}function Ee(e,t){return e?(this._f.il=1^this._f.il,t?this._f.nl=t:this._f.nl=this._f.il?this._f.nl+1:this._f.nl-1,this.identical&&this.identical.like(e),this._f.il):this._f.il}function me(e,t){this._f.nl=e,angular.isDefined(t)&&(this._f.il=t),this.identical&&this.identical.setTotalLikes(e,t)}function Te(e){this.identical=e}function fe(){return this._f.nl}function pe(e,t){this._f.nc=e,angular.isDefined(t)&&(this._f.ic=t),this.identical&&this.identical.setTotalComment(e.ic)}function _e(){return this._f.nc}function Ie(){return this._f.ic}function he(){return this._f.ns}function Ae(){return this.shareUsers}function Ce(e){return angular.isArray(e)?this.shareUsers=this.shareUsers.concat(e):this.shareUsers.push(e),this.shareUsers}function Se(e,t){return e?(this._f.is=1^this._f.is,t?this._f.ns=t:this._f.ns=this._f.is?this._f.ns+1:this._f.ns-1,this._f.is):this._f.is}function ve(e){this.orginal=e,this.orginal.addShareUser(this._u),this.updateShareMessage()}function Me(){return this._f.whoShare}function De(){return this.orginal}function Oe(){return!angular.equals({},this.orginal)}function Re(){return this._f.imc}function Ne(){var e,t,n,i=0;if(this._f.imageList){try{e=angular.isString(this._f.imageList)?angular.fromJson(this._f.imageList):this._f.imageList}catch(o){}for(t=e.length>3?3:e.length,i=0;i<t;i++)e[i].nfId=this._f.nfId,n=r(e[i],this._u),this.images.add(n.getMapKey(),n)}switch(this.images.length()){case 1:this.imlayout=5;break;case 2:this.imlayout=4;break;default:this.imlayout=this._f.nfId%4}}function Pe(e){return e?this.images:this.images.all()}function ye(){return this.imlayout}function be(){return this.images.length()>0||this.medias.length()>0||this.audios.length()>0}function Ue(){return this.album}function Le(){var e,t;this._f.mdaCntntLst&&this._f.mdaCntntLst.length>0&&(e=this._f.stp>0?null:this._u,t=this._f.mdaCntntLst,this.album=a.createAlbum({albn:t[0].albn,albId:t[0].albId,mc:t.length,mdaT:t[0].mdaT,utId:e?e.getUtId():0}),this.album.pushContent(t,e,this._f.nfId),this.album.isAudio()?this.audios=this.album.getContents():this.album.isVideo()&&(this.medias=this.album.getContents()))}function Fe(){return this.medias}function ke(){return this.audios}function we(e){this.viewColumn=e}function Ge(){return this.viewColumn}function Be(){return p.getRoute("SINGLE_FEED",{feedId:this._f.nfId,shared:this.hasSharedFeed()?"shared":""})}function $e(){var e;return e=this.hasSharedFeed()?this.getOrginalFeed().getKey():this.getKey(),p.getRoute("WHO_SHARED_FEED",{feedId:e})}function He(){return!!this._f.mdLst.length}function xe(){return this.feelings}function Ye(e){e&&e.id?(this.feelings=e,this._f.mdLst[0]=e.id):(this.feelings={},this._f.mdLst=[]),this.addPostfixMessage()}function Ke(e,t){var n,r=e;if(r?this._f.fTgLst=r:r=this._f.fTgLst,this.tagUsers.length=0,r&&r.length)for(n=0;n<r.length;n++)r[n].fn=r[n].nm,this.tagUsers.push(c.createByUtId(r[n]));angular.isDefined(t)&&(this._f.tfc=t)}function je(e){this.setTagUsers(e.fTgLst,e.tfc),this.addPostfixMessage()}function Ve(){return!!this.tagUsers.length}function We(){return this.tagUsers}function qe(){return""!==this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length()}function ze(){return this._f.tfc>this.tagUsers.length}function Qe(){return this._f.tfc-this.tagUsers.length}function Xe(){return this._f.tfc}function Ze(){return this._f.lctn}function Je(){var e,t;return this._f.lctn?(e=this._f.lctn,t=this._f.lctn.split(","),t.length>2&&(e=t[0].replace("(","")),e.length>30&&(e=e.substr(0,30)+"..."),e):""}function et(e){return this._f.lctn=e,this.addPostfixMessage(),e}function tt(){this._f.lctn=""}function nt(e){var t;return t=this.images.length()?"image":this.medias.length()?e?"video":"media":this.audios.length()?e?"audio":"media":"feed"}function rt(e){var t=this;return e?""!==t._f.lctn:!(""===t._f.lctn||t._f.lnkURL||t._f.sts||t.images.length()||t.medias.length()||t.audios.length())}function it(){return this.locationData}function ot(){return g.trustAsResourceUrl(l.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!1))}function at(){return g.trustAsResourceUrl(l.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!0))}function st(){return g.trustAsResourceUrl(l.getGoogleMapStaticUrl(this._f.lat,this._f.lng,this._f.lctn))}function ct(){9999!==this._f.lat?this.locationData={description:this._f.lctn,lat:this._f.lat,lng:this._f.lng}:this.locationData={description:this._f.lctn}}function lt(e){this._f.lctn=e.lctn,this._f.lat=e.lat,this._f.lng=e.lng,this.initLocationData(),this.addPostfixMessage()}function ut(){return this._f.strmURL}function dt(){return this._f.lnkDmn}function gt(){return this._f.lnkURL}function Et(){return this._f.lnkTtl}function mt(){return this._f.lnkDsc}function Tt(){return this._f.lnlImgURL}function ft(){return!!(this._f.lnlImgURL||this._f.lnkTtl||this._f.lnkDsc)}function pt(){return this.ogData}function _t(){var e=this;e.ogData||(e.ogData={}),e.ogData.image=e._f.lnlImgURL,e.ogData.description=e._f.lnkDsc,e.ogData.title=e._f.lnkTtl,e.ogData.url=e._f.lnkURL,e.ogData.lnkDmn=e._f.lnkDmn}function It(e){var t=this;t._f.lnkDsc=e.lnkDsc||e.description||"",t._f.lnkTtl=e.lnkTtl||e.title||"",t._f.lnkURL=e.lnkURL||e.url||"",t._f.lnlImgURL=e.lnlImgURL||e.image||"",t._f.lnkDmn=e.lnkDmn||e.domain||"",t.initOgData()}function ht(e){var t=e||{};return!this.text||t.tagUsers&&this.tagUsers.length}function At(){return!!this._f.ishdn}function Ct(){var e=this;return e._f.svd}function St(e){var t=this;t._f.svd=e}function vt(){return this._f.spType===D.TYPE_SPECIAL||this._f.fc===D.TYPE_SPECIAL}function Mt(){return this._f.spType===D.TYPE_GENERAL}function Dt(){return this._f.spType===D.TYPE_CELEBRITY}function Ot(){return this._f.spType===D.TYPE_NEWSPORTAL}function Rt(){return this._f.spType===D.TYPE_BUSINESS}function Nt(){return this._f.spType===D.TYPE_MEDIAPAGE}function Pt(){var e=this;return 1===e.images.length()&&(2===e.images.top().getImageType()||3===e.images.top().getImageType())}function yt(){return this._f.spType}function bt(){return this.friend&&this.friend.isCurrentUser()}function Ut(){return!!this.friend}function Lt(){return this._f.spType===D.TYPE_CIRCLE}function Ft(){return this._f.stp>0&&(this.audios.length()>0||this.medias.length()>0)}function kt(){return!this.isMediaShared()&&(1===this.images.length()||1===this.medias.length()||1===this.audios.length())}function wt(){return this.images.length()&&this.images.bottom()||this.medias.length()&&this.medias.bottom()||this.audios.length()&&this.audios.bottom()||this}function Gt(){return this.isNewsPortal()&&this._f.npFeedInfo}function Bt(){return this._f.npFeedInfo.exUrlOp}function $t(){return this._f.npFeedInfo.nCatId}function Ht(){return this._f.npFeedInfo.nDctn}function xt(e){this._f.npFeedInfo.nDctn=e}function Yt(){return this._f.npFeedInfo.nSDctn}function Kt(){return this._f.npFeedInfo.nTtl}function jt(){return!!this._f.npFeedInfo.nUrl}function Vt(){return this._f.npFeedInfo.nUrl}function Wt(){var e,t=this._f.npFeedInfo.nUrl;return e=t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0],e=e.split(":")[0]}function qt(){return this._f.npFeedInfo.svd}function zt(e){2===this._f.spType&&(this._f.svd=e),this._f.npFeedInfo&&(this._f.npFeedInfo.svd=e),this._f.grpId>0&&(this._f.svd=e)}function Qt(e){return void 0!==e&&(this.pending=!!e),this.pending}function Xt(e){var t,n=!0,r=this,i=r.isSingleContentFeed()&&!r.images.length(),o=r.getSingleContent();return r._u.isCurrentUser()||i&&o.user().isCurrentUser()?(t="RC15",n=!1):r.friend?(t="CRCFS1",n=!1):r.isCirclePost()?(t="CRCFS2",n=!1):r._f.is&&!i&&(t="CRCFS3",n=!1),e?{sucs:n,rc:t}:n}function Zt(){var e,t,n=["location","lctn","lnkDmn","lnkDsc","lnkTtl","lnkURL","lnlImgURL"];for(e=0;e<n.length;e++)t=n[e],this._f[t]?this._f[t]=this._f[t].utf8Encode():this._f[t]=""}function Jt(e,t){var n=0,r=t||[],i=e.replace(/(\w+)?\|\|(\w+)?/g,function(e,t,i){return void 0!==r[n]?r[n]?t:i:""});return i.replace(/(\s){2,}/g," ")}function en(){return C}function tn(e){S=e}function nn(e){C=e}function rn(){return S}function on(e){return C+e}function an(e,t){return new P(e,t)}return{getPrefix:en,setSortKey:tn,setPrefix:nn,getSortIndex:rn,makeKey:on,create:an}}angular.module("ringid.shared").factory("$$commentMap",["$$stackedMap","settings","$filter","userFactory","Utils","TextParser","$$stickerMap","$sce","COMMENT_URL_TYPE","DEFAULT_FILES",function(e,t,n,r,i,o,a,s,c,l){var u={cmn:"",cmnId:0,deleted:!1,edtd:!1,fn:"",il:0,isNew:1,uType:0,url:"",thumbUrl:"",ln:"",nfId:0,imageId:0,cmntTags:[],tl:0,tm:"",uId:"",prIm:"",pending:!1};function d(e,t){t&&(this._u=t),this.updateComment(e)}function g(e){var t=this;t.comment?angular.extend(t.comment,e):t.comment=angular.extend({},u,e),t.updateTime(),t.setHtml(),t._u||(t._u=r.create({fn:t.comment.fn,ln:t.comment.ln,uId:t.comment.uId,prIm:t.comment.prIm}))}function E(){this.comment.tm||(this.comment.tm=Date.now()),this.vtime=i.verbalDate(this.comment.tm)}function m(){this.html=s.trustAsHtml(o.textToHtml(this.comment.cmn,this.comment.cmntTags))}function T(){return this._u}function f(e){return e===this._u.getKey()}function p(){return this.comment.cmn}function _(e,t){e!==!1&&(this.comment.cmn=e),t&&(this.comment.cmntTags=t),this.setHtml()}function I(e){this.comment.cmn=e,this.setHtml()}function h(){return this.html}function A(e,t){var n=t||!1;return this.comment.hasOwnProperty(e)?this.comment[e]:n}function C(){return this.comment.cmnId}function S(){return this.comment.cmnId}function v(e){this.comment.cmnId=e}function M(){return this.comment.nfId}function D(e){this.comment.nfId=e}function O(){return this.comment.imageId}function R(e){this.comment.imageId=e}function N(){return this.comment.tm}function P(e){this.comment.tm=e,this.updateTime()}function y(){return this.updateTime(),this.vtime}function b(){return this.vtime}function U(e,t){return e?(this.comment.il=1^this.comment.il,t?this.comment.tl=t:this.comment.tl=0===this.comment.il?this.comment.tl-1:this.comment.tl+1,this.comment.il):this.comment.il}function L(){return this.comment.tl}function F(e){this.comment.tl=e}function k(e){return void 0!==e&&(this.comment.pending=!!e),this.comment.pending}function w(){return this._u.isCurrentUser()&&!this.hasSticker()}function G(){return this.comment.edtd}function B(){return this.comment.cmntTags||[]}function $(e){return this._u.isCurrentUser()||e&&e.user().isCurrentUser()}function H(){var e=z.call(this);if("image"===e){if(!this.isPending())return t.imBase+this.comment.url}else{if("audio"===e||"video"===e)return t.mediaBase+this.comment.url;if("sticker"===e)return t.stickerBase+this.comment.url}return this.comment.url}function x(){return this.comment.url}function Y(e,t){this.comment.url=e,this.comment.uType=t||this.comment.uType}function K(){return this.comment.uType>0&&this.comment.url}function j(){return this.comment.uType===c.IMAGE}function V(){return this.comment.uType===c.STICKER}function W(){return this.comment.uType===c.AUDIO}function q(){return this.comment.uType===c.VIDEO}function z(){var e;return e=this.hasImage()?"image":this.hasAudio()?"audio":this.hasVideo()?"video":this.hasSticker()?"sticker":"none"}function Q(){return this.comment.uType}function X(){return this.hasImage()||this.hasSticker()?this.getUrl():this.hasAudio()?this.thmbURL?t.imBase+this.comment.thmbURL:l.AUDIO:this.hasVideo()?this.thmbURL?t.imBase+this.comment.thmbURL:l.VIDEO:""}d.prototype={updateComment:g,updateTime:E,setHtml:m,user:T,isOwner:f,text:p,setComment:_,setText:I,getDynamicText:h,getByProperty:A,sortBy:C,getKey:S,setKey:v,getFeedKey:M,setFeedKey:D,getImageKey:O,setImageKey:R,getTimestamp:N,setTime:P,getTimeUpdate:y,time:b,like:U,setUrl:Y,getRawUrl:x,getUrl:H,hasUrl:K,hasImage:j,hasSticker:V,hasAudio:W,hasVideo:q,getType:z,getRawType:Q,getTotalLikes:L,getPreview:X,incomingLike:F,getTags:B,isPending:k,isEditable:w,isEdited:G,isDeleteAble:$};function Z(){return"tm"}function J(e,t){return new d(e,t)}return{getSortIndex:Z,create:J}}]),angular.module("ringid.shared").factory("$$albumMap",$$albumMap),$$albumMap.$inject=["settings","$$imageMap","$$stackedMap","userFactory"];function $$albumMap(e,t,n,r){var i={albId:"",timg:"",imageList:[],ut:0,albumType:""};function o(e,t){var n=this,r=e||{};n.updateAlbum(r,t)}function a(e,n){var r,i,o,a;for(o=0,i=n.length;o<i;o++)a=angular.extend({},n[o],{albId:e.album.albId}),r=t(a,e._u),e.album.images.save(r.getKey(),r),e.album.ut<n[o].tm&&(e.album.ut=n[o].tm)}function s(){return this.album.images}function c(){return this.album.tm}function l(){return this.album.tn}function u(t){var n=this.album.cvImg.lastIndexOf("/")+1;return[e.imBase,this.album.cvImg.slice(0,n),"p"+t,this.album.cvImg.slice(n)].join("")}function d(){return this.album.albn}function g(e){this.album.images.remove(e)&&(this.album.tn=this.album.tn-1,"profileimages"===this.album.albId&&e===this._u.getProfileImageId()?this._u.resetAvatar():"coverimages"===this.album.albId&&e===this._u.getCoverImageId()&&this._u.resetCover())}function E(){return this.album.albId}function m(e){a(this,e.imageList)}function T(){return this.album.albumType}function f(e,t){if(this.album?angular.extend(this.album,e):this.album=angular.extend({},i,e),t&&(this._u=r.create({uId:t})),0===this.album.albumType.length)switch(this.album.albId){case"coverimages":this.album.albumType="coverphoto";break;case"profileimages":this.album.albumType="profilephoto";break;case"feedimages":default:this.album.albumType="feedphoto"}this.album.images=n.createNew(),this.album.imageList&&this.album.imageList.length>0&&a(this,this.album.imageList)}function p(){return this._u}return o.prototype={updateAlbum:f,pushImages:m,getKey:E,removeImage:g,getName:d,getCoverImage:u,getTotalImageCount:l,getUpdateTime:c,getImages:s,getType:T,owner:p},function(e,t){return new o(e,t)}}angular.module("ringid.shared").factory("$$ringFile",$$ringFile),$$ringFile.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","Utils","$ringhttp","imageQuality","mediaMetadata","UPLOAD_TYPES"];function $$ringFile(e,t,n,r,i,o,a,s,c,l,u){function d(e){var t;return"string"==typeof e||e instanceof String?(t=e.lastIndexOf(".")+1,e.substr(e.lastIndexOf("/")+1,t)):e.name?e.name.substr(0,e.name.lastIndexOf(".")):""}function g(e){var t=this,r="",i={file:{key:e.file.key||a.getUniqueID(),uploadType:e.uploadType,file:e.file,progressVal:Boolean(e.feededit)?100:0},gotMeta:Boolean(e.feededit),uploadComplete:Boolean(e.feededit),editOnly:Boolean(e.feededit),edited:!1,queued:!1,uploadFail:!1,resolveFailed:!1};switch(angular.extend(t,i),t.file.fileType=e.fileType,t.file.previewUrl=n.baseUrl+"/images/default_"+t.file.fileType+"_preview.jpg",t.file.fileName=e.uploadType+e.fileType,e.fileType){case"image":t.file.fileName+=".jpg";break;case"video":t.file.fileName+=".mp4",r=d(t.file.file);break;case"audio":t.file.fileName+=".mp3"}t.file.meta={ttl:r}}function E(e,t,n){var r=this;g.call(r,e),r.resolveFailed=Boolean(n),r.file.responseType="text",r.file.digestMethod=t||!1}g.prototype={getKey:H,getName:w,getType:x,getFileType:Y,cptn:U,feedEdit:F,isEdited:L,getPreview:b,getAuthData:A,setAuthData:C,fetchMeta:h,setPreview:P,getProgress:N,getQueued:D,uploadFailed:O,uploadCompleted:R},E.prototype=Object.create(g.prototype),E.prototype.getFile=G,E.prototype.initUpload=k,E.prototype.cancelUpload=y,E.prototype.setQueued=M,E.prototype.setMeta=v,E.prototype.getMeta=S,E.prototype.setRepositionData=$,E.prototype.getRepositionData=B,E.prototype.callDigest=I,E.prototype.onProgress=m,E.prototype.onLoad=f,E.prototype.onAbort=p,E.prototype.onError=_;function m(e){var t=this;t.file.progressVal=e,t.callDigest()}function T(e){var t,n,r,i=new DataView(e);return i.byteLength?(t=i.getBool(0),t===!1?(r=i.getUint8(1),n={sucs:!1,mg:i.getString(2,r)}):t===!0&&(r=i.getUint8(1),n={sucs:!0,iurl:i.getString(2,r)})):n={sucs:!1,mg:"Failed. Response unreadable"},n}function f(e){var t,r=this;switch(t="text"===r.file.responseType?angular.fromJson(e):T(e),r.file.uploadType+r.file.fileType){case u.STATUS+"video":r.file.meta.thmbURL=t.iurl?t.iurl.substr(0,t.iurl.lastIndexOf("."))+".jpg":"",r.file.previewUrl=t.iurl?n.mediaBase+r.file.meta.thmbURL:"";break;case u.STATUS+"image":r.file.previewUrl=t.iurl?n.imBase+t.iurl.substr(0,t.iurl.lastIndexOf("/")+1)+"pthumb"+t.iurl.substr(t.iurl.lastIndexOf("/")+1):"";break;default:angular.extend(t,r.file.meta||{})}r.file.response=t,r.queued=!1,r.file.response.sucs===!0?(r.uploadComplete=!0,r.file.deferred.resolve(t)):(r.uploadFail=!0,o.show(t.mg||"Failed","error"),r.resolveFailed?r.file.deferred.resolve(r.file.response):r.file.deferred.reject(r.file.response)),r.callDigest()}function p(){this.callDigest(),this.file.deferred.reject()}function _(){var e=this;e.uploadFail||(e.uploadFail=!0,o.show("Upload failed!","error")),e.resolveFailed?e.file.deferred.resolve():e.file.deferred.reject()}function I(){this.file.digestMethod&&this.file.digestMethod(this.file.uploadType)}function h(e){var t=this;switch(t.file.fileType){case"video":case"audio":l.generateMeta(t.file.file,t.file.fileType).then(n,r);break;case"image":c.resizeImage(t.file.file,t.file.uploadType).then(i,a)}t.gotMeta=!0,t.callDigest();function n(n){var r;n.thumb?(t.file.previewUrl=n.previewUrl,r=new E({uploadType:"thumb",fileType:"image",file:n.thumb}),r.initUpload().then(function(e){t.file.meta.thmbURL=e.iurl,i()},function(){i()})):i();function i(){t.file.meta=angular.extend({},t.file.meta,n),e({success:!0}),t.callDigest()}}function r(n){o.show(n,"error"),t.uploadFail=!0,t.file.deferred?t.file.deferred.reject(n):e({success:!1,message:n}),t.callDigest()}function i(n){t.file.file=n.file,t.file.meta.ih=n.ih,t.file.meta.iw=n.iw,t.file.previewUrl=n.previewUrl,e({success:!0}),t.callDigest()}function a(n){t.uploadFail=!0,t.file.deferred?(o.show(n,"error"),t.file.deferred.reject(n)):e({success:!1,message:n}),t.callDigest()}}function A(){var e=this,t={};function n(){t={strmURL:e.file.response.iurl,tiw:e.file.meta.tiw,tih:e.file.meta.tih,drtn:e.file.meta.drtn,thmbURL:e.file.meta.thmbURL,artst:e.file.meta.artst.utf8Encode(),ttl:e.file.meta.ttl.utf8Encode()}}switch(e.file.fileType){case"image":t={ih:e.file.meta.ih,iw:e.file.meta.iw,iurl:e.file.response.iurl,cptn:e.file.meta.ttl.utf8Encode()};break;case"video":case"audio":n();break;default:t=e.file.response}return t}function C(e){var t=this;switch(t.file.fileType){case"image":t.file.meta.ih=e.ih,t.file.meta.iw=e.iw,t.file.meta.ttl=e.cptn;break;case"video":case"audio":n()}function n(){t.file.meta.tiw=e.tiw,t.file.meta.tih=e.tih,t.file.meta.drtn=e.drtn,t.file.meta.thmbURL=e.thmbURL,t.file.meta.artst=e.artst,t.file.meta.ttl=e.ttl,t.file.meta.strmURL=e.strmURL}}function S(){var e=!1;return this.file.hasOwnProperty("meta")&&(e=this.file.meta),e}function v(e){this.file.meta=e}function M(e){this.queued=e||!0}function D(){return this.queued}function O(){return this.uploadFail}function R(){return this.uploadComplete}function N(){return this.file.progressVal}function P(e){this.file.previewUrl=e}function y(){var e=this;e.uploadFail=!0,e.file.xhr&&e.file.xhr.abortRequest(),e.file.deferred&&(e.resolveFailed?e.file.deferred.resolve():e.file.deferred.reject())}function b(){return this.file.previewUrl}function U(e){return arguments.length>0&&(this.file.meta.ttl=e,this.edited=!0),this.file.meta.ttl}function L(){return this.edited}function F(){return this.editOnly}function k(r){var i,o=this,a=new FormData;if(o.file.deferred=e.defer(),o.queued=!0,a.append("sId",t.getCookie("sId")),a.append("uId",t.getCookie("uId")),a.append("authServer",t.getCookie("authServer")),a.append("comPort",t.getCookie("comPort")),a.append("x-app-version",n.apiVersion),Boolean(r))i=n.imCropServer+"CropImageHandler",o.file.responseType="arraybuffer";else switch(o.file.uploadType+o.file.fileType){case u.AVATAR+"image":i=n.imServer+"ImageUploadHandler";break;case u.COVER+"image":i=n.imServer+"CoverImageUploadHandler";break;case u.TAGCHAT+"image":i=n.imServer+"GroupContentHandler";break;case u.TAGCHAT_COVER+"image":i=n.imServer+"RoomChatCoverHandler",o.file.responseType="arraybuffer";break;case u.TAGCHAT_AVATAR+"image":i=n.imServer+"RoomChatProfileHandler";break;case u.CHAT+"image":i=n.imServer+"ChatImageHandler",o.file.responseType="arraybuffer";break;case u.STATUS+"image":i=n.imServer+"AlbumImageUploadHandler";break;case u.STATUS+"audio":i=n.mediaServer+"Mp3UploadHandler",o.file.responseType="arraybuffer";break;case u.STATUS+"video":i=n.mediaServer+"Mp4UploadHandler",o.file.responseType="arraybuffer";break;case u.THUMB+"image":i=n.mediaServer+"ThumbImageHandler",o.file.responseType="arraybuffer",o.gotMeta=!0;break;case u.COMMENT+"image":i=n.imServer+"CommentImageHandler",o.file.responseType="arraybuffer";break;case u.COMMENT+"audio":i=n.imServer+"CommentMp3Handler",o.file.responseType="arraybuffer";break;case u.COMMENT+"video":i=n.imServer+"CommentMp4Handler",o.file.responseType="arraybuffer"}o.gotMeta?c():o.fetchMeta(c);function c(){o.file.uploadType!==u.COVER&&o.file.uploadType!==u.AVATAR||Object.keys(o.file.repositionD).forEach(function(e){a.append(e,o.file.repositionD[e])}),Boolean(r)?a.append("origFile",r):a.append("uploadedFile",o.file.file,o.file.fileName),o.file.xhr=s.post(i,a,o.file.responseType,o).success(o.onLoad.bind(o)).error(o.onError.bind(o)).progress(o.onProgress.bind(o)).abort(o.onAbort.bind(o))}return o.file.deferred.promise}function w(){return this.file.name}function G(){return this.file.file}function B(e){var t,n=this;return t=e&&e===u.AVATAR||n.file.uploadType===u.AVATAR?{pimX:n.file.repositionD.cimX,pimY:n.file.repositionD.cimY}:{cimX:n.file.repositionD.cimX,cimY:n.file.repositionD.cimY}}function $(e){this.file.repositionD=angular.extend({},this.file.repositionD||{},e)}function H(){return this.file.key}function x(){return this.file.uploadType}function Y(){return this.file.fileType}function K(e,t,n){return e.feededit?new g(e):new E(e,t,n)}return K}angular.module("ringid.shared").service("mediaMetadata",mediaMetadata),mediaMetadata.$inject=["$$q","id3Reader"];function mediaMetadata(e,t){var n=this;n.generateMeta=a;function r(e){var t={drtn:Math.floor(e.duration),tiw:e.videoHeight,tih:e.videoWidth,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile};window.URL.revokeObjectURL(e.src),e.deferObj.resolve(t)}function i(){var e=this,n={drtn:Math.floor(e.duration),tiw:0,tih:0,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile,thumb:null,thmbURL:""};function r(t){t.sucs===!0?e.deferObj.resolve({drtn:n.drtn,tiw:n.tiw,tih:n.tiw,artst:t.tags.artist,ttl:t.tags.title,thumb:t.tags.picture,previewUrl:t.tags.previewUrl}):e.deferObj.resolve(n)}t.loadTags(e.fileObj,r,{tags:["album","title","artist","picture"]})}function o(e){this.deferObj.reject(e)}function a(t,n){var a,s=e.defer();return"audio"===n?(a=document.createElement("audio"),a.addEventListener("loadeddata",i),a.fileObj=t):(a=document.createElement("video"),a.addEventListener("loadeddata",function(){var e=this;e.currentTime=e.duration>20?10:e.duration/2;function t(){a.removeEventListener("timeupdate",t),r(e)}a.addEventListener("timeupdate",t)})),a.deferObj=s,a.nameFromFile=t.name,a.addEventListener("onerror",o),a.src=window.URL.createObjectURL(t),s.promise}}angular.module("ringid.shared").service("id3Reader",id3Reader),id3Reader.$inject=["id3Utils","id3v1Reader","id3v2Reader","id4Reader"];function id3Reader(e,t,n,r){var i=this;i.loadTags=v;function o(e,t,n){var r=this;r.data=e,r.dataOffset=t||0,r.dataLength=n||r.data.length}o.prototype={getRawData:a,getByteAt:c,getBytesAt:l,getLength:s,isBitSetAt:u,getSByteAt:d,getShortAt:g,getSShortAt:E,getLongAt:m,getSLongAt:T,getInteger24At:f,getStringAt:p,getStringWithCharsetAt:_,getCharAt:I,toBase64:h,fromBase64:A,loadRange:C};function a(){return this.data}function s(){return this.dataLength}function c(e){return 255&this.data.charCodeAt(e+this.dataOffset)}function l(e,t){var n,r=new Array(t);for(n=0;n<t;n++)r[n]=this.getByteAt(e+n);return r}function u(e,t){var n=this.getByteAt(e);return 0!==(n&1<<t)}function d(e){var t=this.getByteAt(e);return t>127?t-256:t}function g(e,t){var n=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return n<0&&(n+=65536),n}function E(e,t){var n=this.getShortAt(e,t);return n>32767?n-65536:n}function m(e,t){var n,r=this.getByteAt(e),i=this.getByteAt(e+1),o=this.getByteAt(e+2),a=this.getByteAt(e+3);return n=t?(((r<<8)+i<<8)+o<<8)+a:(((a<<8)+o<<8)+i<<8)+r,n<0&&(n+=4294967296),n}function T(e,t){var n=this.getLongAt(e,t);return n>2147483647&&(n-=4294967296),n}function f(e,t){var n,r=this.getByteAt(e),i=this.getByteAt(e+1),o=this.getByteAt(e+2);return n=t?((r<<8)+i<<8)+o:((o<<8)+i<<8)+r,n<0&&(n+=16777216),n}function p(e,t){var n,r,i=[];for(n=e,r=0;n<e+t;n++,r++)i[r]=String.fromCharCode(this.getByteAt(n));return i.join("")}function _(t,n,r){var i,o=this.getBytesAt(t,n);switch(r.toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":i=e.readUTF16String(o,r);break;case"utf-8":i=e.readUTF8String(o);break;default:i=e.readNullTerminatedString(o)}return i}function I(e){return String.fromCharCode(this.getByteAt(e))}function h(){return window.btoa(this.data)}function A(e){this.data=window.atob(e)}function C(e,t){t()}function S(e,t){var n=new FileReader;n.readAsBinaryString(e),n.onerror=r,n.onload=i;function r(){t({sucs:!1})}function i(e){var n=e.target.result;t({sucs:!0,data:new o(n)})}}function v(e,t,n){var r,i=n||{};S(e,o);function o(e){e.sucs?e.data.loadRange([0,7],function(){var n=O(e.data);n.loadData(e.data,function(){try{r=n.readTagsFromData(e.data,i.tags),r.picture&&(r.previewUrl=M(r.picture),r.picture=new Blob([D(r.picture.data)],{type:r.picture.format}),r.picture.name="thumbimage.jpg"),t({sucs:!0,tags:r})}catch(o){t({sucs:!1})}})}):t({sucs:!1})}}function M(e){var t,n,r="";for(n=0;n<e.data.length;n++)r+=String.fromCharCode(e.data[n]);return t="data:"+e.format+";base64,"+window.btoa(r)}function D(e){var t,n=e.length,r=new ArrayBuffer(2*n),i=new Uint8Array(r);for(t=0;t<n;t++)i[t]=e[t];return r}function O(e){return"ftypM4A"===e.getStringAt(4,7)?r:"ID3"===e.getStringAt(0,3)?n:t}}angular.module("ringid.shared").service("id3Utils",id3Utils).service("id3v1Reader",id3v1Reader).service("id3v2Reader",id3v2Reader).service("id4Reader",id4Reader);function id3v1Reader(){var e=this;e.loadData=t,e.readTagsFromData=n;function t(e,t){var n=e.getLength();e.loadRange([n-128-1,n],t)}function n(e){var t,n,r,i=e.getLength()-128,o=e.getStringAt(i,3);return"TAG"===o?(t=e.getStringAt(i+3,30).replace(/\0/g,""),n=e.getStringAt(i+33,30).replace(/\0/g,""),r=e.getStringAt(i+63,30).replace(/\0/g,""),{version:"1.1",title:t,artist:n,album:r}):{}}}function id3v2Reader(){var e,t,n,r=this;r.loadData=l,r.readTagsFromData=u,r.readFrameData={APIC:m,PIC:T,"T*":f,TCON:p,TCO:p,TLEN:_},r.frames={PIC:"Attached picture",TAL:"Album/Movie/Show title",TLE:"Length",TLEN:"Length",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TT2:"Title/Songname/Content description",APIC:"Attached picture",TALB:"Album/Movie/Show title",TIME:"Time",TIT2:"Title/songname/content description",TPE1:"Lead performer(s)/Soloist(s)"},e=["title","artist","album","track"],n={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],picture:["APIC","PIC"]},t=["32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. lable side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];function i(e){var t,r,i=[];for(t=0;t<e.length;t++)r=e[t],i=i.concat(n[r]||[r]);return i}function o(e,t){var n=t.getByteAt(e),r=t.getByteAt(e+1),i=t.getByteAt(e+2),o=t.getByteAt(e+3),a=127&o|(127&i)<<7|(127&r)<<14|(127&n)<<21;return a}function a(e,t){var n={message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encription:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}};return n}function s(t,n,s,c,l){var u,d,g,E,m,T,f,p,_,I,h,A={},C=c.major;for(l=i(l||e);t<n;){switch(d=null,g=s,E=t,m=null,C){case 2:T=g.getStringAt(E,3),f=g.getInteger24At(E+3,!0),p=6;break;case 3:T=g.getStringAt(E,4),f=g.getLongAt(E+4,!0),p=10;break;case 4:T=g.getStringAt(E,4),f=o(E+4,g),p=10}if(""===T)break;t+=p+f,l.indexOf(T)<0||(C>2&&(m=a(g,E+8)),E+=p,m&&m.format.data_length_indicator&&(u=o(E,g),E+=4,f-=4),m&&m.format.unsynchronisation||(T in r.readFrameData?d=r.readFrameData[T]:"T"===T[0]&&(d=r.readFrameData["T*"]),_=d?d(E,f,g,m):void 0,I=T in r.frames?r.frames[T]:"Unknown",h={id:T,size:f,description:I,data:_},T in A?(A[T].id&&(A[T]=[A[T]]),A[T].push(h)):A[T]=h))}return A}function c(e,t){var n,r,i=!1;for("string"==typeof t&&(t=[t]),r=0;r<t.length;r++)if(n=t[r],n in e){i=e[n].data;break}return i}function l(e,t){e.loadRange([0,o(6,e)],t)}function u(e,t){var r,i,a,l,u,d,g,E,m,T,f,p,_=0;if(r=e.getByteAt(_+3),r>4)return{version:">2.4"};i=e.getByteAt(_+4),a=e.isBitSetAt(_+5,7),l=e.isBitSetAt(_+5,6),u=e.isBitSetAt(_+5,5),d=o(_+6,e),_+=10,l&&(g=e.getLongAt(_,!0),_+=g+4),E={version:"2."+r+"."+i,major:r,revision:i,flags:{unsynchronisation:a,extended_header:l,experimental_indicator:u},size:d},T=a?{}:s(_,d-10,e,E,t);for(m in n)n.hasOwnProperty(m)&&(p=c(T,n[m]),p&&(E[m]=p));for(f in T)T.hasOwnProperty(f)&&(E[f]=T[f]);return E}function d(e){var t;switch(e){case 0:t="iso-8859-1";break;case 1:t="utf-16";break;case 2:t="utf-16be";break;case 3:t="utf-8"}return t}function g(e){var t=e/1e3,n=Math.floor(t)%60,r=Math.floor(t/60)%60,i=Math.floor(t/3600);return{seconds:n,minutes:r,hours:i}}function E(e){var t=e.seconds<10?"0"+e.seconds:e.seconds,n=e.hours>0&&e.minutes<10?"0"+e.minutes:e.minutes;return(e.hours>0?e.hours+":":"")+n+":"+t}function m(e,n,r,i,o){var a,s,c,l,u=o||"3",g=e,E=d(r.getByteAt(e));switch(u){case"2":l=r.getStringAt(e+1,3),e+=4;break;case"3":case"4":l=r.getStringWithCharsetAt(e+1,n-(e-g),""),e+=1+l.bytesReadCount}return a=r.getByteAt(e,1),s=t[a],c=r.getStringWithCharsetAt(e+1,n-(e-g),E),e+=1+c.bytesReadCount,{format:l.toString(),type:s,description:c.toString(),data:r.getBytesAt(e,g+n-e)}}function T(e,t,n,i){return r.readFrameData.APIC(e,t,n,i,"2")}function f(e,t,n){var r=d(n.getByteAt(e));return n.getStringWithCharsetAt(e+1,t-1,r).toString()}function p(){
var e=r.readFrameData["T*"].apply(this,arguments);return e.replace(/^\(\d+\)/,"")}function _(){var e=r.readFrameData["T*"].apply(this,arguments);return{text:e,parsed:E(g(parseInt(e,10)))}}}function id4Reader(){var e=this;e.types={0:"uint8",1:"text",13:"jpeg",14:"png",21:"uint8"},e.atom={"Â©alb":["album"],"Â©art":["artist"],"Â©ART":["artist"],aART:["artist"],"Â©day":["year"],"Â©nam":["title"],"Â©gen":["genre"],trkn:["track"],"Â©wrt":["composer"],"Â©too":["encoder"],cprt:["copyright"],covr:["picture"],"Â©grp":["grouping"],keyw:["keyword"],"Â©lyr":["lyrics"],"Â©cmt":["comment"],tmpo:["tempo"],cpil:["compilation"],disk:["disc"]},e.loadData=function(e,n){e.loadRange([0,7],function(){t(e,0,e.getLength(),n)})};function t(n,r,i,o){var a=n.getLongAt(r,!0);if(0==a)return o();var s=n.getStringAt(r+4,4);if(["moov","udta","meta","ilst"].indexOf(s)>-1)"meta"==s&&(r+=4),n.loadRange([r+8,r+8+8],function(){t(n,r+8,a-8,o)});else{var c=s in e.atom;n.loadRange([r+(c?0:a),r+a+8],function(){t(n,r+a,i,o)})}}e.readTagsFromData=function(e){var t={};return n(t,e,0,e.getLength()),t};function n(t,r,i,o,a){a=void 0===a?"":a+"  ";for(var s=i;s<i+o;){var c=r.getLongAt(s,!0);if(0==c)return;var l=r.getStringAt(s+4,4);if(["moov","udta","meta","ilst"].indexOf(l)>-1)return"meta"==l&&(s+=4),void n(t,r,s+8,c-8,a);if(e.atom[l]){var u=r.getInteger24At(s+16+1,!0),d=e.atom[l],g=e.types[u];if("trkn"==l)t[d[0]]=r.getByteAt(s+16+11),t.count=r.getByteAt(s+16+13);else{var E,m=s+16+4+4,T=c-16-4-4;switch(g){case"text":E=r.getStringWithCharsetAt(m,T,"UTF-8");break;case"uint8":E=r.getShortAt(m);break;case"jpeg":case"png":E={format:"image/"+g,data:r.getBytesAt(m,T)}}"comment"===d[0]?t[d[0]]={text:E}:t[d[0]]=E}}s+=c}}}function id3Utils(){var e=this;e.readUTF16String=t,e.readUTF8String=n,e.readNullTerminatedString=r;function t(e,t,n){var r=0,i=1,o=0;n=Math.min(n||e.length,e.length),254==e[0]&&255==e[1]?(t=!0,r=2):255==e[0]&&254==e[1]&&(t=!1,r=2),t&&(i=0,o=1);for(var a=[],s=0;r<n;s++){var c=e[r+i],l=e[r+o],u=(c<<8)+l;if(r+=2,0==u)break;if(c<216||c>=224)a[s]=String.fromCharCode(u);else{var d=e[r+i],g=e[r+o],E=(d<<8)+g;r+=2,a[s]=String.fromCharCode(u,E)}}var m=new String(a.join(""));return m.bytesReadCount=r,m}function n(e,t){var n=0;t=Math.min(t||e.length,e.length),239==e[0]&&187==e[1]&&191==e[2]&&(n=3);for(var r=[],i=0;n<t;i++){var o=e[n++];if(0==o)break;if(o<128)r[i]=String.fromCharCode(o);else if(o>=194&&o<224){var a=e[n++];r[i]=String.fromCharCode(((31&o)<<6)+(63&a))}else if(o>=224&&o<240){var a=e[n++],s=e[n++];r[i]=String.fromCharCode(((255&o)<<12)+((63&a)<<6)+(63&s))}else if(o>=240&&o<245){var a=e[n++],s=e[n++],c=e[n++],l=((7&o)<<18)+((63&a)<<12)+((63&s)<<6)+(63&c)-65536;r[i]=String.fromCharCode((l>>10)+55296,(1023&l)+56320)}}var u=new String(r.join(""));return u.bytesReadCount=n,u}function r(e,t){var n=[];t=t||e.length;for(var r=0;r<t;){var i=e[r++];if(0==i)break;n[r-1]=String.fromCharCode(i)}var o=new String(n.join(""));return o.bytesReadCount=r,o}}angular.module("ringid.shared").service("imageQuality",imageQuality),imageQuality.$inject=["$$q","APP_CONSTANTS","Ringalert","Utils"];function imageQuality(e,t,n,r){var i=this,o=t.COVER_PIC_UPLOAD_MINIMUM_WIDTH,a=t.COVER_PIC_UPLOAD_MINIMUM_HEIGHT,s=t.COVER_PIC_UPLOAD_MAXIMUM_WIDTH,c=t.COVER_PIC_UPLOAD_MAXIMUM_HEIGHT,l=t.PROFILE_PIC_UPLOAD_MINIMUM_WIDTH,u=t.PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT,d=t.IMAGE_UPLOAD_MIN_HEIGHT,g=t.IMAGE_UPLOAD_MIN_WIDTH;i.resizeImage=function(t,n){var i=new Image,E=!1,m=e.defer(),T={ih:0,iw:0,previewUrl:"",file:""},f=window.URL||window.webkitURL;function p(){var e,i,f,p,_=this,I=1,h=_.width,A=_.height;function C(o){e=document.createElement("canvas"),e.width=T.iw,e.height=T.ih,i=e.getContext("2d"),i.drawImage(_,0,0,T.iw,T.ih),o&&(T.imQ=o.qualityIM.quality),T.previewUrl=e.toDataURL("image/jpeg"),T.file=r.dataURLToBlob(T.previewUrl),T.file.name=t.name||n+".jpg",m.resolve(T)}switch(h>s||A>c?h/s>A/c?(I=s/h,T.iw=s,T.ih=Math.floor(I*A)):(I=c/A,T.ih=c,T.iw=Math.floor(I*h)):(T.iw=h,T.ih=A),f=d,p=g,n){case"avatar":(T.iw<l||T.ih<u)&&(f=u,p=l,E=!0);break;case"cover":(T.iw<o||T.ih<a)&&(f=a,p=o,E=!0);break;default:(T.iw<g||T.ih<d)&&(E=!0)}E?m.reject("Image Size below Minimum("+p+"px by "+f+"px) :"+t.name):C(!1)}function _(){m.reject("Image invalid: "+t.name)}return"string"==typeof t?(i.setAttribute("crossOrigin","anonymous"),i.src=t):i.src=f.createObjectURL(t),i.onload=p,i.onerror=_,m.promise}}angular.module("ringid.shared").service("fileUploadService",fileUploadService),fileUploadService.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","Utils","$ringhttp","imageQuality","mediaMetadata","$$ringFile","UPLOAD_TYPES"];function fileUploadService(e,t,n,r,i,o,a,s,c,l,u,d){var g={},E=!1,m=this;m.hashTags=[],m.uploadFiles=[],m.resetUpload=f,m.createUpload=p,m.validateUpload=T,m.queueFile=_,m.uploadQueue=I,m.setScopeForDigest=h,m.removeScope=A;function T(e){var t=!1,n="image",r=new RegExp("audio/mp3*"),i=new RegExp("video/mp4"),o=new RegExp("image/*");return o.test(e.type)?(n="image",t=!0):r.test(e.type)?(n="audio",t=!0):i.test(e.type)&&(n="video",t=!0),{valid:t,fileType:n}}function f(){E=!1,m.hashTags.splice(0),m.uploadFiles.splice(0),C(d.STATUS)}function p(e){return u(e,C)}function _(e){m.uploadFiles.push(u(e,C,!0))}function I(t){var n,o,a,s=[];function c(){a=u(a),m.uploadQueue(a)}function l(){for(E=!1,u(),o=0;o<m.uploadFiles.length;o++)if(!m.uploadFiles[o].uploadCompleted()){E=!0;break}E||(clearInterval(n),r.$broadcast(i.FILE_UPLOAD.QUEUE_COMPLETE),C(d.STATUS))}if(t<m.uploadFiles.length){for(a=t+2<m.uploadFiles.length?t+2:m.uploadFiles.length,o=t;o<a;o++)!m.uploadFiles[o]||m.uploadFiles[o].getQueued()||m.uploadFiles[o].uploadFailed()||s.push(m.uploadFiles[o].initUpload());if(0===s.length)return void m.uploadQueue(a);e.all(s).then(c,c)}else m.uploadFiles.length>0?n=setInterval(l,2e3):l();function u(e){var t,n,r=0,i=-1,o=0;for(n=r,t=m.uploadFiles.length;n<t;n++)m.uploadFiles[n]&&m.uploadFiles[n].uploadFailed()?(m.uploadFiles.splice(n,1),o++,n--,t--):i!==-1||m.uploadFiles[n].getQueued()||m.uploadFiles[n].uploadCompleted()||(i=n);return o>0&&C(d.STATUS),i===-1?e:i}}function h(e,t){g.hasOwnProperty(e)||(g[e]=[]),g[e][t.$id]=t}function A(e,t){g.hasOwnProperty(e)&&(g[e][t.$id]=null)}function C(e){var t,n;for(n in g[e])g[e].hasOwnProperty(n)&&(t=g[e][n],t&&t.$id&&!t.$$destroyed&&t.$rgDigest())}}angular.module("ringid.shared").service("StickerEmoticonService",StickerEmoticonService).factory("StickerEmoticonFactory",StickerEmoticonFactory),StickerEmoticonService.$inject=["STICKER_IMAGE_TYPE","settings"];function StickerEmoticonService(e,t){var n,r,i=this,o=[],a={":D":"awesome.png",":<3":"loved.png","*D*":"excited.png",":)":"happy.png",":-(":"alone.png","(cool)":"cool.png","x=(":"angry.png","o_-":"fresh.png",":>s":"sick.png",":?":"confused.png",";|":"thoughtful.png",":*":"fantastic.png",":=(":"upset.png",">u<":"blah.png","(amused)":"amused.png","(hot)":"hot.png","(-_^)":"motivated.png","(^_^)":"satisfied.png",">=<":"hurt.png",":(s":"ill.png","(cute)":"cute.png","I=)":"relived.png",":O":"shoked.png","(beautiful)":"beautiful.png",":|p":"hyper.png","(pumped)":"pumped.png","%)":"drunk.png","o(":"impatient.png","(restless)":"restless.png",":-)":"emotional.png","(hungry)":"hungry.png","(nostalgic)":"nostalgic.png","(blessed)":"blessed.png","</3":"heartboken.png","(naughty)":"naughty.png","(entertained)":"entertained.png","(broken)":"broken.png","(cold)":"cold.png","(down)":"down.png","(sorry)":"sorry.png","(frustrated)":"frustrated.png",":-s":"scared.png",":@":"fuming.png",NN:"run.png",":'q":"crying.png",":'D":"laughing.png",":'(":"soreness.png","(boiling)":"boiling.png",":x":"xmode.png",":p":"cheeky.png",":=0":"laughing-inside.png","|-O":"yawn.png",":6":"devil.png",":-#":"zipped-lip.png","(clap)":"clap.png","<3":"heart.png","(pink-heart)":"pink-heart.png","(k)":"pink-lip.png","(#)":"sun.png","(*)":"star.png","(g)":"gift.png","(K)":"red-lip.png","(f)":"rose.png"},s=angular.extend({":&lt;3":"loved.png","&lt;/3":"heartboken.png","&gt;=&lt;":"hurt.png","&gt;u&lt;":"blah.png",":&gt;s":"sick.png","&lt;3":"heart.png"},a);i.getEmoImageName=m,i.getAllEmoticons=E,i.getEmoticonUrlMap=g,i.getEmoticonUrlMapWithHtmlEncode=d,i.getEmoticonPattern=u,i.getEmoticonMap=l;function c(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}for(n in s)s.hasOwnProperty(n)&&o.push(c(n));r=new RegExp(o.join("|"),"g");function l(){return s}function u(){return r}function d(){var e={};return angular.forEach(s,function(n,r){e[r]=t.emoticonBase+n}),e}function g(){var e={};return angular.forEach(a,function(n,r){e[r]=t.emoticonBase+n}),e}function E(){var t={type:e.EMOTICON,imageList:[]};return angular.forEach(a,function(n,r){t.imageList.push({name:n,symbol:r,type:e.EMOTICON})}),t}function m(e){try{return a[e]}catch(t){return"default.png"}}}StickerEmoticonFactory.$inject=["StickerEmoticonService","settings"];function StickerEmoticonFactory(e,t){function n(){return e.getAllEmoticons()}function r(t){return e.getEmoImageName(t)}function i(e,n,r){var i=t.stickerBase+e+"/"+n+"/"+r;return i}return{getAllEmoticons:n,getEmoImageName:r,getStickerImageUrl:i,getEmoticonUrlMap:e.getEmoticonUrlMap,getEmoticonUrlMapWithHtmlEncode:e.getEmoticonUrlMapWithHtmlEncode,getEmoticonPattern:e.getEmoticonPattern}}angular.module("ringid.shared").factory("friendsFactory",friendsFactory),friendsFactory.$inject=["$rootScope","SystemEvents","$$q","Contacts","APP_CONSTANTS","Auth","Storage","mapListFilterFilter","$$connector","OPERATION_TYPES","userFactory","friendsHttpService","$$stackedMap","Ringalert","Utils","mapFilterFilter"];function friendsFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T){var f,p=l.SYSTEM.FRIENDS,_=!1,I=i,h=0,A=0,C={totalPacket:0,complete:!1};function S(e,t){var n,r,i,o,a,s,c=[],l=[],d=[];if(t)d=e;else{for(o=0,a=e.length;o<a;o++)r=u.getByUtId(e[o]),r?l.push(r):d.push(e[o]);l.length>0&&M(l,!0)}for(n=new ArrayBuffer(8*d.length),i=new DataView(n),o=0,s=0,a=d.length;o<a;o++)i.setInt32(s,0),s+=4,i.setInt32(s,d[o]),s+=4;for(o=0;o<i.byteLength;o++)c.push(i.getInt8(o));return c}function v(e,t,n){var i=r.remove("utIds",e);t&&f.friends.remove(e),i&&!n||(i=r.remove("incomingUtIds",e),t&&f.incomingFriends.remove(e),i&&!n||(i=r.remove("outgoingUtIds",e),t&&f.outgoingFriends.remove(e)))}function M(e,t){var n,r,i,o;for(i=0,r=e.length;i<r;i++)n=t?e[i]:u.create(e[i]),o=n.friendshipStatus(),e[i].deleted&&1===e[i].deleted||(o===I.FRIEND?3===n.friendType()?f.specialFriends.save(n.getUtId(),n):f.friends.save(n.getUtId(),n):o===I.INCOMING_FRIEND?f.incomingFriends.save(n.getUtId(),n):o===I.OUTGOING_FRIEND&&f.outgoingFriends.save(n.getUtId(),n),t?v(e[i].getUtId(),!1,!0):v(e[i].utId,!1,!0))}function D(e,t){var n=t&&t.mg?t.mg:"Reqeust Failed";E.show(n,"error"),e&&e.reject({sucs:!1,mg:n})}function O(e){var n,i,o;switch(e.actn){case p.TYPE_CONTACT_UTIDS:if(e.sucs===!0){for(f.state.gotUtId=!0,0!==C.totalPacket||C.complete||(C.totalPacket=e.totalPacket),C.totalPacket--,i=0,o=e.utIds.length;i<o;i++)switch(e.utIds[i].value.frnS){case I.FRIEND:r.add("utIds",e.utIds[i].key,e.utIds[i].value);break;case I.INCOMING_FRIEND:r.add("incomingUtIds",e.utIds[i].key,e.utIds[i].value);break;case I.OUTGOING_FRIEND:r.add("outgoingUtIds",e.utIds[i].key,e.utIds[i].value)}0===C.totalPacket&&(C.complete=!0,r.initStorage(),m.triggerCustomEvent(t.FRIEND.UTID_LIST_RECEIVED))}else e.sucs===!1&&1111===e.rc&&d.getContactList();break;case p.TYPE_UPDATE_ADD_FRIEND:e.sucs===!0&&r.add("incomingUtIds",e.utId,{frns:I.INCOMING_FRIEND});break;case p.TYPE_UPDATE_DELETE_FRIEND:e.sucs===!0&&e.utId&&(v(e.utId,!0,!0),n=u.create(e),n.updateUserObj({frnS:I.NOT_FRIEND}));break;case p.TYPE_UPDATE_ACCEPT_FRIEND:e.sucs===!0&&(v(e.utId,!0),f.friends.add(e.utId,u.create(e)))}}function R(e){switch(e){case"specialfriends":return f.specialFriends;case"friendslist":case"friends":return f.friends;case"incoming":return f.incomingFriends;case"outgoing":return f.outgoingFriends;case"userfriends":return f.userFriends;default:return f.friends}}function N(e,t,i){var o=e||10,a=n.defer();0===r.utIds().length()&&0===f.friends.length()?c.subscribe(function(){setTimeout(d,2e3)},{action:[p.TYPE_CONTACT_UTIDS],callWithUnresolved:!0}):d();function l(){var n=f.friends.all();return i&&(angular.isArray(i)&&i.length>0||!angular.isArray(i)&&i.length()>0)&&(n=s(n,i)),t&&t.length>0&&(n=T(n,{mapApi:"getName",value:t})),n.slice(0,e)}function u(){a.resolve(l())}function d(){var e=l();e.length>=o?a.resolve(e):t&&t.length>0?H({schPm:t},!0).then(u,u):r.utIds().length()>0?b("utIds",o-f.friends.length()).then(u,u):u()}return a.promise}function P(){h=0,f.userFriends.reset(),f.userFriends.pivotId=0}function y(e){var t,r,i=n.defer();function o(e){if(h=0===h?e.tf:h,e.sucs===!0){for(A+=e.contactList.length,t=0;t<e.contactList.length;t++)r=u.create(e.contactList[t]),f.userFriends.save(r.getKey(),r),f.userFriends.pivotId=Math.max(f.userFriends.pivotId,r.getKey());i.resolve()}else i.reject(e)}function a(e){i.reject(e||{sucs:!1})}return setTimeout(a,1e4),d.getUserContactsNew(e,A,f.userFriends.pivotId).then(o,a),i.promise}function b(e,t){var i,o,a=[],s=n.defer();switch(i=t||20,o=e||"utIds"){case"friends":case"friendslist":case"utIds":a=S(r.utIds().keys().slice(0,i)),f.state.isFriendsLoading=a.length>0;break;case"userfriends":break;case"incoming":case"incomingUtIds":a=S(r.incomingUtIds().keys().slice(0,i));break;case"outgoing":case"outgoingUtIds":a=S(r.outgoingUtIds().keys().slice(0,i));break;default:a=S(r.utIds().keys().slice(0,i)),f.state.isFriendsLoading=a.length>0}function c(e){e.sucs===!0?(M(e.contacts),s.resolve(e)):s.reject(e)}function l(e){s.reject(e||{sucs:!1})}return a.length>0?d.getContactListDetails({utIDs:a,uo:!1}).then(c,l):s.resolve({sucs:!0}),setTimeout(l,1e4),s.promise}function U(e){var t;return e.length>0&&(t=S(e,!0),t.length>0)&&d.getContactListDetails({utIDs:t,uo:!1})}function L(e,t){switch(e.friend.isLoading(!0),e.action){case"remove":case"unfriend":return w(e,t);case"add":case"addfriend":return F(e,t);case"accept":return k(e,t);case"incoming_reject":case"outgoing_reject":case"reject":return G(e,t);case"block":return e.block=1,e.bv=0,B(e,t);case"unblock":return e.block=0,e.bv=1,B(e,t);default:return e.friend.isLoading(!1),!1}}function F(e,t){var i=!!t&&n.defer(),o=e.friend.getUtId();function a(n){e.friend.isLoading(!1),n.sucs===!0?(r.add("outgoingUtIds",o,{frns:I.OUTGOING_FRIEND}),t&&i.resolve(n),e.friend.updateUserObj(angular.extend({},n,{frns:I.OUTGOING_FRIEND}))):D(i,n)}function s(t){e.friend.isLoading(!1),D(i,t)}return d.sendFriendRequest({utId:e.friend.getUtId()}).then(a,s),!!t&&i.promise}function k(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();function s(n){r.friend.isLoading(!1),n.sucs===!0?(v(a,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),r.friend.updateUserObj(angular.extend({},n,{frnS:I.FRIEND})),f.friends.save(a,r.friend),i&&o.resolve(n)):D(o,n)}function c(e){r.friend.isLoading(!1),D(o,e)}return d.acceptFriendRequest({friendId:r.friend.getKey(),utId:r.friend.getUtId()}).then(s,c),!!i&&o.promise}function w(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();function s(n){r.friend.isLoading(!1),n.sucs===!0?(v(a,!0,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),r.friend.updateUserObj(angular.extend({},n,{frnS:I.NOT_FRIEND})),i&&o.resolve(n)):D(o,n)}function c(e){r.friend.isLoading(!1),D(o,e)}return d.unFriend({utId:r.friend.getUtId()}).then(s,c),!!i&&o.promise}function G(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();function s(n){r.friend.isLoading(!1),n.sucs===!0?(r.friend.updateUserObj(angular.extend({},n,{frnS:I.NOT_FRIEND})),v(a,!0,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),i&&o.resolve(n)):D(o,n)}function c(e){r.friend.isLoading(!1),D(o,e)}return d.unFriend({utId:r.friend.getUtId()}).then(s,c),!!i&&o.promise}function B(e,t){var r=!!t&&n.defer();function i(n){e.friend.isLoading(!1),n.sucs===!0&&e.friend.setBlock(e.block),t&&r.resolve()}function o(){e.friend.isLoading(!1),t&&r.reject()}return d.blockFriend(e).then(i,o),!!t&&r.promise}function $(){var e,t="";for(e=0;e<f.friends.size();e++)t+=",".fFactory.friends[e].getKey();return t}function H(e,t){var r;function i(e){e.sucs===!0?(M(e.searchedcontaclist),r.resolve()):r.reject()}function o(){r.reject()}return t?(r=n.defer(),d.searchContact(e,t).then(i,o),r.promise):d.searchContact(e,!1)}function x(e,t){switch(e){case"utIds":r.utIds().save(t,{frnS:I.FRIEND});break;case"incomingUtIds":r.incomingUtIds().save(t,{frnS:I.INCOMING_FRIEND});break;case"outgoingUtIds":r.outgoingUtIds().save(t,{frnS:I.OUTGOING_FRIEND})}}function Y(){var e=r.incomingUtIds().length()+f.incomingFriends.length();return e>99?"99+":e}function K(){return r.outgoingUtIds().length()+f.outgoingFriends.length()}function j(e){return"userfriends"===e?h:r.utIds().length()+f.friends.length()}function V(){return h}f={state:{gotUtId:!1,noFriends:!1,isFriendsLoading:!1,isUserFriendsLoading:!1,isRequestsLoading:!1},getRequestCount:Y,getPendingCount:K,totalFriends:j,totalUserFriends:V,friends:g.createNew(),specialFriends:g.createNew(),userFriends:g.createNew(),incomingFriends:g.createNew(),outgoingFriends:g.createNew(),process:O,getFriends:R,myFriends:N,resetUserFriends:P,getUserContacts:y,getContactDetails:b,getContactDetailsByUtIds:U,removeFriend:w,friendAction:L,addFriend:F,rejectFriendRequest:G,acceptFriendRequest:k,searchContact:H,initFriends:W,addToUtIdList:x,blockFriend:B,getIds:$,utIDsToByteArray:S},f.userFriends.pivotId=0,c.subscribe(f.process,{action:[p.TYPE_CONTACT_UTIDS,p.TYPE_UPDATE_ADD_FRIEND,p.TYPE_UPDATE_DELETE_FRIEND,p.TYPE_UPDATE_ACCEPT_FRIEND],callWithUnresolved:!0});function W(e){_&&!e||(_=!0,r.init(),d.getContactList())}return f}angular.module("ringid.shared").service("friendsHttpService",friendsHttpService),friendsHttpService.$inject=["$$connector","OPERATION_TYPES","APP_CONSTANTS"];function friendsHttpService(e,t,n){var r=this,i=t.SYSTEM.FRIENDS,o=n,a=t.SYSTEM.REQUEST_TYPE;r.searchContact=function(t,n){var r={actn:n?i.ACTION_FRIEND_SEARCH:i.TYPE_CONTACT_SEARCH,scat:o.TYPE_SEARCH_BY_ALL,schPm:t.schPm.utf8Encode(),st:t.st||0},s=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return s.test(t.schPm)&&(r.scat=o.TYPE_SEARCH_BY_EMAIL),e.pull(r,a.REQUEST,!0)},r.getContactList=function(t){var n={actn:i.TYPE_CONTACT_UTIDS,cut:-1,ut:t||-1};return e.send(n,a.REQUEST)},r.getContactListDetails=function(t){var n={actn:i.TYPE_CONTACT_LIST,uo:t.uo||!1,utIDs:t.utIDs};return e.pull(n,a.REQUEST,!0)},r.getUserContacts=function(t,n){var r={actn:i.TYPE_FRIEND_CONTACT_LIST,utId:t,st:n||0};return e.pull(r,a.REQUEST)},r.getUserContactsNew=function(t,n,r){var o={actn:i.TYPE_FRIEND_CONTACT_LIST_NEW,utId:t,pvtid:r,st:n||0};return e.pull(o,a.REQUEST)},r.unFriend=function(t){var n={actn:i.TYPE_DELETE_FRIEND,utId:t.utId};return e.request(n,a.UPDATE,!0)},r.changeFriendType=function(t){var n={actn:i.TYPE_ACTION_CHANGE_FRIEND_ACCESS,ct:t.ct,utId:t.utId};return e.request(n,a.UPDATE)},r.sendFriendRequest=function(t){var n={actn:i.TYPE_ADD_FRIEND,utId:t.utId};return e.request(n,a.UPDATE,!0)},r.blockFriend=function(t){var n={actn:i.TYPE_ACTION_BLOCK_UNBLOCK_FRIEND,idList:[t.friend.getUtId()],bv:t.bv};return e.request(n,a.REQUEST)},r.saveCallPvcEdit=function(t){var n={actn:t.actn,sn:t.callsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveChatPvcEdit=function(t){var n={actn:t.actn,sn:t.chatsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveFeedPvcEdit=function(t){var n={actn:t.actn,sn:t.feedsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.acceptFriendRequest=function(t){var n={actn:i.TYPE_ACCEPT_FRIEND,utId:t.utId};return e.request(n,a.UPDATE,!0)}}angular.module("ringid.shared").service("circleHttpService",circleHttpService),circleHttpService.$inject=["$$connector","OPERATION_TYPES"];function circleHttpService(e,t){var n=this,r=t.SYSTEM.CIRCLE,i=t.SYSTEM.REQUEST_TYPE;n.getCircleMembers=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_LIST,grpId:t,scl:1,lmt:o||40,pvtid:n||0};return e.send(a,i.REQUEST)},n.createCircle=function(t){var n={actn:r.TYPE_CREATE_GROUP,gNm:t.tg.utf8Encode(),utId:t.utId,groupMembers:t.alluser};return e.request(n,i.UPDATE)},n.getCircles=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.send(t,i.REQUEST)},n.getCircle=function(t){return e.request({actn:r.TYPE_GROUP_DETAILS,grpId:t},i.REQUEST)},n.getCirclesInfo=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.request(t,i.REQUEST)},n.addMembers=function(t){var n={actn:r.TYPE_ADD_GROUP_MEMBER,grpId:parseInt(t.grpId,10),groupMembers:t.members};return e.request(n,i.UPDATE)},n.removeMember=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:parseInt(t.grpId,10),groupMembers:[{utId:t.utId}]};return e.request(n,i.UPDATE)},n.removeMembers=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmins=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:parseInt(t.grpId,10),groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmin=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:parseInt(t.grpId,10),groupMembers:[{admin:t.admin,utId:t.utId}]};return e.request(n,i.UPDATE)},n.leaveCircle=function(t){var n={actn:r.TYPE_LEAVE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.deleteCircle=function(t){var n={actn:r.TYPE_DELETE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.getMemberResult=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_SEARCH_RESULT,grpId:n,schPm:t,st:o||0};return e.send(a,i.REQUEST)}}angular.module("ringid.shared").service("portalHttpService",portalHttpService),portalHttpService.$inject=["OPERATION_TYPES","$$connector"];function portalHttpService(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE_TYPES,a=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getPortalDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,pType:o.NEWSPORTAL};return t.pull(n,i.REQUEST,!0)},n.getPortalFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,pType:o.NEWSPORTAL};return t.pull(n,i.REQUEST,!0)},n.getPortalCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,pId:e,pType:o.NEWSPORTAL};return t.pull(n,i.REQUEST,!0)},n.searchNewsPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:o.NEWSPORTAL,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,a,s){var c={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,pId:e,subscType:s,npSubIds:n,npUnSubIds:a,pType:o.NEWSPORTAL};return t.request(c,i.UPDATE)},n.unFollowPortal=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,pId:e,pType:o.NEWSPORTAL};return t.request(n,i.UPDATE)},n.getPortalShortDetails=function(e){var n={actn:a,isnp:!0,pId:e,pType:o.NEWSPORTAL};return t.request(n,i.REQUEST,!0)},n.getBreakingNews=function(e){var n={actn:e.actn};return t.pull(n,i.REQUEST)}}angular.module("ringid.shared").service("businessHttpService",businessHttpService),businessHttpService.$inject=["OPERATION_TYPES","$$connector"];function businessHttpService(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE_TYPES,a=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getBusinessDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,pType:o.BUSINESS_PAGE};return t.pull(n,i.REQUEST,!0)},n.getBusinessFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,pType:o.BUSINESS_PAGE};return t.pull(n,i.REQUEST,!0)},n.getBusinessCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,pId:e,pType:o.BUSINESS_PAGE};return t.pull(n,i.REQUEST,!0)},n.searchBusinessPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:o.BUSINESS_PAGE,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,a,s){var c={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,pId:e,subscType:s,npSubIds:n,npUnSubIds:a,pType:o.BUSINESS_PAGE};return t.request(c,i.UPDATE)},n.unFollowBusiness=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,pId:e,pType:o.BUSINESS_PAGE};return t.request(n,i.UPDATE)},n.followBusinessPage=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:2,pId:e,pType:o.BUSINESS_PAGE};return t.request(n,i.UPDATE)},n.getBusinessShortDetails=function(e){var n={actn:a,pId:e,pType:o.BUSINESS_PAGE};return t.request(n,i.REQUEST)}}angular.module("ringid.shared").service("CelebrityHttpService",["OPERATION_TYPES","$$connector",function(e,t){var n=this,r=e.SYSTEM.CELEBRITY,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getCelebrityDiscoverList=function(e){var n={actn:r.ACTION_CELEBRITY_LIST,clt:r.CELEBRITY_LIST_TYPE_NONFOLLOWING,lmt:e&&e.lmt?e.lmt:12,st:e&&e.st?e.st:0,issbp:!e||!e.issbp||e.issbp,iserl:!(!e||!e.issbp)&&e.issbp};return t.pull(n,i.REQUEST,!0)},n.removeSuggestion=function(n){var r={actn:e.SYSTEM.PORTAL.ACTION_REMOVE_SUGGESTION,utId:n};return t.request(r,i.REQUEST)},n.getCelebrityCategoryList=function(){var e={actn:r.ACTION_CELEBRITY_CATEGORY_LIST};return t.pull(e,i.REQUEST,!0)},n.triggerFollowUnFollowCelebrity=function(e,n){var o={actn:r.ACTION_FOLLOW_UNFOLLOW_CELEBRITY,utId:e,flw:n};return t.request(o,i.UPDATE)},n.getCelebrityPopularList=function(e){var n={actn:r.ACTION_CELEBRITY_LIST,clt:r.CELEBRITY_LIST_TYPE_POPULAR,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,issbp:!0,iserl:!0};return t.pull(n,i.REQUEST,!0)},n.getCelebrityFollowingList=function(e){var n={actn:r.ACTION_CELEBRITY_LIST,clt:r.CELEBRITY_LIST_TYPE_FOLLOWING,lmt:e&&e.lmt?e.lmt:10,st:e&&e.st?e.st:0,issbp:!e||!e.issbp||e.issbp,iserl:!(!e||!e.issbp)&&e.issbp};return t.pull(n,i.REQUEST,!0)},n.searchCelebrity=function(n){var r={actn:e.SYSTEM.PORTAL.ACTION_CONTACT_SEARCH,pType:2,schPm:n};return t.pull(r,i.REQUEST,!0)},n.getCelebrityShortDetails=function(e){var n={actn:o,utId:e,pType:2};return t.request(n,i.REQUEST)}}]),angular.module("ringid.shared").factory("circlesManager",circlesManager),circlesManager.$inject=["$routeParams","$location","$rootScope","$$connector","OPERATION_TYPES","Storage","$$stackedMap","$$q","circleMap","userFactory","circleHttpService","Notification","SystemEvents","Ringalert","Auth"];function circlesManager(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m){var T,f,p,_=a.createNew(!0,"asc"),I=!1,h=a.createNew(!0,"asc"),A=i.SYSTEM.CIRCLE;function C(e){h.remove(e),n.$broadcast(g.CIRCLE.MY_CIRCLE_REMOVED,{circleId:e})}function S(e,t){var n=e.get(t.grpId);return n?n.update(t):n=c.create(t),e.save(n.getKey(),n),n}function v(e){var t;return e.ists||(t=e.sAdId===m.currentUser().getKey()?S(_,e):S(h,e)),t}function M(e){angular.forEach(e,v)}function D(n){e.circleId&&parseInt(e.circleId,10)===parseInt(n,10)&&t.path("/")}function O(){E.show("Circle does not exist!","warning"),t.path("/")}function R(e){var t,n;function r(e){n.removeMember(e)}if(e.sucs)switch(e.actn){case A.TYPE_UPDATE_EDIT_GROUP_MEMBER:case A.TYPE_UPDATE_ADD_GROUP_MEMBER:t=e.grpId,n=L(t),n&&n.setMembers(e.groupMembers);break;case A.TYPE_UPDATE_DELETE_GROUP:t=e.grpId,n=L(t),n&&(C(n.getKey()),D(e.grpId));break;case A.TYPE_UPDATE_REMOVE_GROUP_MEMBER:t=e.grpId,n=L(t),e.removedMembers&&n&&angular.forEach(e.removedMembers,r);break;case A.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:e.groupList=[{gNm:e.gNm,grpId:e.grpId,mc:e.mc,sAd:e.sAd}],M(e.groupList),y(e.groupMembers)}}function N(e){return e.actn===A.TYPE_UPDATE_EDIT_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_ADD_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_DELETE_GROUP||e.actn===A.TYPE_UPDATE_REMOVE_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND}function P(e){clearTimeout(T),e.sucs&&e.actn===A.TYPE_GROUP_LIST&&(M(e.groupList),n.$broadcast(g.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE))}function y(e){var t,r;if(e.sucs===!0&&angular.isArray(e.groupMembers)&&e.groupMembers.length){for(t=0;t<e.groupMembers.length;t++)f=e.groupMembers[t].id;if(r=L(e.groupMembers[0].grpId),!r)return;r.setMembers(e.groupMembers)}n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:!0})}function b(e){var t;if(p=e.tr,e.sucs===!0&&angular.isArray(e.groupMembers)&&e.groupMembers.length){if(t=L(e.groupMembers[0].grpId),!t)return;t.setMembers(e.groupMembers)}n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:e.sucs})}function U(e,t){function r(e){e.sucs===!0&&(t.setMemberCount(e.mc),n.$broadcast(g.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT))}u.getCircle(e).then(r)}function L(e){return _.get(e)||h.get(e)}function F(e){var t=L(e),n=s.defer();function r(r){r.sucs?(r.grpId=e,r.ists=0,t=v(r),n.resolve(t)):n.reject(!1)}function i(){n.resolve(t)}return t?setTimeout(i):u.getCircle(e).then(r),n.promise}function k(e){return e?_:h}function w(e){var t=s.defer();function r(e){e.sucs===!0&&(u.getCircles(),n.$broadcast(g.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE)),t.resolve(e)}return u.createCircle(e).then(r),t.promise}function G(e,t){var r=s.defer(),i={grpId:t,members:e};function o(i){var o;i.sucs&&(o=L(t),angular.forEach(e,function(e){o.addMember(e.utId,e.admin)}),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)),r.resolve(i)}return u.addMembers(i).then(o),r.promise}function B(e,t,n){0===t&&(f=t),u.getCircleMembers(e,f,n)}function $(e,t){u.getMemberResult(e,t,p)}function H(e){var t=s.defer();function n(n){var r=angular.fromJson(n);r.sucs===!0?(_.remove(e.getKey()),h.remove(e.getKey()),t.resolve(r)):t.reject("Failed")}return u.leaveCircle({grpId:e.getKey()}).then(n),t.promise}function x(e){var t=s.defer();function n(n){n.sucs===!0?(_.remove(e.getKey()),h.remove(e.getKey()),t.resolve(n)):t.reject("Failed")}return u.deleteCircle({grpId:e.getKey()}).then(n),t.promise}function Y(e,t){var r={grpId:t.getKey(),utId:e},i=t.removeMember(e);function o(e){e.sucs!==!0&&(t.addMember(i),E.show(e,"error")),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}u.removeMember(r).then(o)}function K(e,t){var r={grpId:t.getKey(),members:[]};function i(r){r.sucs!==!0&&(angular.forEach(e,function(e){t.addMember(e)}),t.setMemberCount(t.getMembersObjectCount()),E.show(r,"error")),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}function o(e){r.members.push({uId:e}),t.removeMember(e)}angular.forEach(e,o),t.setMemberCount(t.getMembersObjectCount()),u.removeMembers(r).then(i)}function j(e,t){var r;function i(e){e.sucs===!0&&(r=e.groupMembers[0],r.admin?t.promoteToAdmin(r.utId):t.removeFromAdmin(r.utId),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE))}u.addRemoveAdmin(e).then(i)}function V(e){I||(r.subscribe(R,{action:[A.TYPE_UPDATE_DELETE_GROUP,A.TYPE_UPDATE_REMOVE_GROUP_MEMBER,A.TYPE_UPDATE_ADD_GROUP_MEMBER,A.TYPE_UPDATE_EDIT_GROUP_MEMBER]}),r.subscribe(P,{action:[A.TYPE_GROUP_LIST]})),I&&!e||(I=!0,u.getCircles())}return{init:V,processCircleUpdates:R,circleUpdateFilter:N,processCirclesData:P,processCircleMembersData:y,processCircleSearchMembersData:b,getCircle:L,getCirclePromise:F,getCircles:k,createCircle:w,getCircleMembers:B,leaveGroup:H,deleteCircle:x,addMembers:G,removeMember:Y,removeMembers:K,toggleMembership:j,redirectHome:O,getMemberResult:$,getSingleCircleInfo:U}}angular.module("ringid.shared").factory("Media",MediaFactory),MediaFactory.$inject=["mapFilterFilter","Utils","Ringalert","userFactory","Auth","$routeParams","Storage","OPERATION_TYPES","APP_CONSTANTS","$$mediaAlbumMap","$$mediaMap","$$stackedMap","$$q","$$connector","Api"];function MediaFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m){var T={albumsLoading:!1,audio:{loaded:!1,packetCount:-1},video:{loaded:!1,packetCount:-1},contentsLoading:!1},f=!1,p={audio:{list:d.createNew(),loaded:!1,packetCount:-1},video:{list:d.createNew(),loaded:!1,packetCount:-1}},_={audio:{list:d.createNew(),loaded:!1,packetCount:-1},video:{list:d.createNew(),loaded:!1,packetCount:-1}},I=d.createNew(),h=d.createNew(),A=s.SYSTEM.MEDIA,C=s.SYSTEM.REQUEST_TYPE,S=c,v=[],M=[],D=[];function O(e){return e===S.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video"}function R(e,t){e.sucs!==!0||t.loaded?t.loaded=!0:e.sucs===!0?(t.packetCount===-1&&(t.packetCount=parseInt(e.seq.substr(e.seq.lastIndexOf("/")+1),10)),
t.packetCount--,t.loaded=0===t.packetCount):t.loaded=!0}function N(e){var t,n,o,a,s;switch(e.actn){case A.ACTION_MEDIA_ALBUM_LIST:if(i.currentUser().getUtId()===e.utId?(t=i.currentUser(),o=p[O(e.mdaT)]):(t=r.create({utId:e.utId}),o=_[O(e.mdaT)]),e.sucs===!0&&e.mediaAlbumList)for(a=0,s=e.mediaAlbumList.length;a<s;a++)n=o.list.get(e.mediaAlbumList[a].albId||e.mediaAlbumList[a].id),n?n.updateAlbum(e.mediaAlbumList[a].id):n=l.createAlbum(e.mediaAlbumList[a],t),o.list.add(n.getKey(),n);R(e,o)}}function P(e,t){switch(t){case"audio":m.media.fetchAlbums({utId:e,mdaT:S.NEWS_FEED_MEDIA_TYPE_AUDIO});break;case"video":m.media.fetchAlbums({utId:e,mdaT:S.NEWS_FEED_MEDIA_TYPE_VIDEO});break;default:m.media.fetchAlbums({utId:e,mdaT:S.NEWS_FEED_MEDIA_TYPE_VIDEO}),m.media.fetchAlbums({utId:e,mdaT:S.NEWS_FEED_MEDIA_TYPE_AUDIO})}}function y(e,t){var n=parseInt(e,10);return 0!==n&&(p[t].list.get(n)||!1)}E.subscribe(N,{action:[A.ACTION_MEDIA_ALBUM_LIST,A.ACTION_MEDIA_SEARCH_RESULT]});function b(e){return!f&&(f=!0,P(i.currentUser().getUtId(),e),!0)}function U(e,t){switch(e){case"mediaInAlbums":return E.request({actn:A.ACTION_CHECK_MEDIA_IN_ALBUMS,strmURL:t.strmURL},C.REQUEST);default:return!1}}function L(){_.audio.list.reset(),_.video.list.reset(),_.audio.loaded=!1,_.video.loaded=!1,_.audio.packetCount=-1,_.video.packetCount=-1}function F(t,n,r){var o,a,s=g.defer(),c=t===i.currentUser().getUtId()?p[n]:_[n];c.loaded?l():(o=E.subscribe(function(){clearTimeout(a),a=setTimeout(function(){c.loaded&&l()},200)},{action:[A.ACTION_MEDIA_ALBUM_LIST]}),P(t,n));function l(){E.unsubscribe(o),r?s.resolve(e(c.list.all(),{mapApi:"getName",value:r})):s.resolve(c.list.all())}return s.promise}function k(e,t){var n=e?p:_;return n[t].list}function w(){return h}function G(){return I}function B(){return M}function $(){M=[]}function H(){return D}function x(){D=[]}function Y(){return v}function K(){return h.reset()}function j(){return I.reset()}function V(){v=[]}function W(e,n){var r,o;n&&(e.id=t.getUniqueID(),o=g.defer());function a(t){t.sucs===!0?(r=l.createAlbum(angular.extend(e,{id:t.albId}),i.currentUser()),p.list.save(r.getKey(),r),o.resolve(r)):o.reject(!1)}function s(e){o.reject(!1)}return n&&m.media.createAlbum(e).then(a,s),n?o.promise:r}function q(e){function t(t){t.sucs===!0&&p.list.remove(e.getKey())}m.media.deleteAlbum(e.getId()).then(t)}return{init:b,state:T,processResponse:N,getAlbum:y,resetUserAlbums:L,fetchAlbums:F,getAlbums:k,getSearchedSongs:w,getSearchedAlbums:G,getContentIdArray:B,resetContentIdArray:$,getAlbumIdArray:H,resetAlbumIdArray:x,getSearchedTagArr:Y,resetSearchedSongs:K,resetSearchedAlbum:j,resetSearchedTagArr:V,fetchAllAlbums:P,createAlbum:W,deleteAlbum:q,makeApiCall:U}}angular.module("ringid.shared").factory("EmotionFactory",EmotionFactory),EmotionFactory.$inject=["$$connector","settings","OPERATION_TYPES"];function EmotionFactory(e,t,n){var r={},i=n.SYSTEM,o=0,a={};function s(e){return{id:e.id,title:e.nm,nm:e.nm,url:t.emotionServer+e.url,cat:e.cat}}function c(e){var t;if(e.sucs&&e.mdLst.length)for(t=0;t<e.mdLst.length;t++)r[e.mdLst[t].id]=s(e.mdLst[t]),o++;u()}e.subscribe(c,{action:i.FETCH_EMOTION_LIST});function l(){var e,t=[];for(e in r)r.hasOwnProperty(e)&&t.push(r[e]);return t}function u(){var e,t;for(t in a)a.hasOwnProperty(t)&&(e=a[t],e&&e.$id&&!e.$$destroyed&&e.setEmotion.call(e,l()))}function d(){o?u():e.send({actn:i.FETCH_EMOTION_LIST},i.REQUEST_TYPE.REQUEST)}function g(){return o}function E(e,t){var n=angular.isObject(e)?e.id:e;return t?r[n]?r[n]:!!angular.isObject(e)&&s(e):r[n]||!1}function m(e){a[e.$id]=e}function T(e){a[e.$id]&&(a[e.$id]=null)}return{init:d,getEmotions:l,getLength:g,getEmotion:E,setScopeForDigest:m,removeScope:T}}angular.module("ringid.shared").factory("feedFactory",feedFactory),feedFactory.$inject=["$$connector","$$q","$$stackedMap","$$feedMap","Utils","TextParser","OPERATION_TYPES","APP_CONSTANTS","Ringalert","Auth","MIN_TIMESTAMP","$rootScope","SystemEvents"];function feedFactory(e,t,n,r,i,o,a,s,c,l,u,d,g){var E=a.SYSTEM,m=s,T=E.TYPE_NEWS_FEED+".all",f=0,p={},_=[],I=!1,h=[],A={},C={};A[E.TYPE_NEWS_FEED]=fe,A[E.TYPE_MY_NEWS_FEED]=fe,A[E.TYPE_FRIEND_NEWSFEED]=fe,A[E.TYPE_GROUP_NEWS_FEED]=fe,A[E.TYPE_MEDIAS_NEWS_FEED]=fe,A[E.TYPE_NEWS_PORTAL_FEED]=fe,A[E.TYPE_BUSINESS_PAGE_FEED]=fe,A[E.TYPE_CELEBRITY_NEWSFEED]=fe,A[E.TYPE_SAVED_FEED]=fe,A[E.TYPE_UPDATE_ADD_STATUS]=Pe,A[E.ACTION_UPDATE_SHARE_STATUS]=Ne,A[E.TYPE_UPDATE_DELETE_STATUS]=Re,A[E.TYPE_UPDATE_EDIT_STATUS]=Oe,A[E.TYPE_UPDATE_LIKE_STATUS]=Oe,A[E.TYPE_UPDATE_UNLIKE_STATUS]=Oe,A[E.TYPE_UPDATE_ADD_STATUS_COMMENT]=Oe,A[E.TYPE_UPDATE_DELETE_STATUS_COMMENT]=Oe,d.$on("TIME_DIFFERENCE_CHANGED",S),d.$on("EVERY_MINUTE",S);function S(e,t){var n,r=t.timeDiff;n=b(),n.doForAll(function(e){var t=e.time();e.setUpdatedTime(r),C[e.getKey()]&&e.time()!==t&&C[e.getKey()].$rgDigest()})}function v(e,t){C[e]=t}function M(e){C[e]&&delete C[e]}function D(e){I=!!e}function O(){return I}function R(){return _.length}function N(){var e=L();return E.TYPE_NEWS_FEED===e.action&&p.special&&p.special.length()>0}function P(){return p.special&&p.special.all()}return{init:F,addScope:v,removeScope:M,getFeed:be,pushFeed:fe,processIncomingFeed:pe,setpushInIncomingFeed:D,getPushIncomingFeed:O,hasUnprocessedFeed:R,addIgnoreFilter:Ue,removeIgnoreFilter:Le,setFactoryKey:Fe,createFeed:B,process:ke,getFeedFilter:we,noMoreFeed:$e,requestForFeed:He,initFeedRequest:xe,getSingleFeed:Ke,requestForMoreFeed:Ye,getRawFeeds:Ge,getFeeds:Be,addFeed:je,shareFeed:Ve,deleteFeed:We,removeFeed:Ce,removeUsersAllFeed:Se,removeAllCircleFeed:ve,saveUnsaveFeed:qe,updateFeed:Qe,updateFeedNew:ze,reset:k,moreFeedText:Xe,getSingleFeedPageKey:Je,getWhoShareFeedId:et,getTagUsers:Ze,setSortBy:y,getCurrentPageValue:L,hasSpecialFeed:N,getSpecialFeedList:P,synchLike:Me,synchComment:De,getPortalFeedDetails:tt};function y(e){r.setSortKey(e)}function b(){return p.hasOwnProperty(T)?p[T].data:n.createNew()}function U(){return p.hasOwnProperty(T)?p[T].removed:n.createNew()}function L(){var e=[];try{e=T.split(".",3)}catch(t){return!1}return!(e.length<2)&&{action:parseInt(e[0],10),page:e[1],ptype:parseInt(e[2],10)}}function F(e){var t=b();return t.length()<10&&(He(e),!0)}function k(){b().reset(),U().reset(),_.length=0,f=0}function w(){var e,t=r.getSortIndex(),n=b();return"tm"===t?n.length()?n.top().getTimestamp():u:e=n.length()?n.top().getAtTime():u}function G(){var e,t=r.getSortIndex(),n=b();return"tm"===t?n.length()?n.bottom().getTimestamp():Date.now():e=n.length()?n.bottom().getAtTime():Date.now()}function B(e,t){return r.create(e,t)}function $(){return!0}function H(e,t){var n=parseInt(t.page,10);return e.nfId===n||e.whShrLst&&e.whShrLst[0].nfId===n}function x(e,t,n){var r,i=parseInt(t.page,10),o=!0;return"circle_saved"!==t.page||e.svd||(o=!1),r=!i||i===e.grpId,(t.action===n||n===E.TYPE_ADD_STATUS)&&e.spType===E.FEED_SUPER_TYPES.TYPE_CIRCLE&&o&&r}function Y(e,t,n){var r=!1;switch(t.page){case"all_saved_feeds":r=t.action===n;break;case"media_saved":r=t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_MEDIAPAGE;break;case"circle_saved":r=t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_CIRCLE;break;case"newsportal_saved":r=t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_NEWSPORTAL;break;case"business_saved":r=t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_BUSINESS;break;case"celebrity_saved":r=t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_CELEBRITY;break;default:r=!1}return r}function K(e,t,n){return t.action===n}function j(e,t,n){var r=!0;return"newsportal_saved"!==t.page||e.svd||(r=!1),t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_NEWSPORTAL&&r}function V(e,t,n){var r=t||L();return t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_NEWSPORTAL&&parseInt(r.page,10)===e.npFeedInfo.pId}function W(e,t,n){var r=t||L();return t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_MEDIAPAGE&&parseInt(r.page,10)===e.npFeedInfo.pId}function q(e,t,n){var r=!0;return"business_saved"!==t.page||e.svd||(r=!1),t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_BUSINESS&&r}function z(e,t,n){var r=t||L();return t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_BUSINESS&&parseInt(r.page,10)===e.npFeedInfo.pId}function Q(e,t,n){var r=!0;return"celebrity_saved"!==t.page||e.svd||(r=!1),t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_CELEBRITY&&r}function X(e,t,n){return t.action===n&&e.spType===E.FEED_SUPER_TYPES.TYPE_CELEBRITY}function Z(e,t){var n=t||L();return!!(n.page===e.uId||e.fndId&&n.page===e.fndId)||!(!e.orgFd||n.page!==e.orgFd.uId)}function J(e){ee(e)}function ee(e){Ee(e,Z,{processWhoShare:function(e,t,n){var r,i;e.uId===n.page&&e.orgFd&&(i=B(e.orgFd),r=B(e),r.shares(i),t.save(r.getMapKey(),r))}})}function te(e){Ee(e,V)}function ne(e){Ee(e,W)}function re(e){Ee(e,z)}function ie(e){Ee(e,x)}function oe(e){Ee(e,Y)}function ae(e){Ee(e,K)}function se(e){Ee(e,j)}function ce(e){Ee(e,q)}function le(e){Ee(e,Q)}function ue(e){Ee(e,X)}function de(e){Ee(e,$)}function ge(e){var t;p.special||(p.special=n.createNew(r.getSortIndex(),"desc")),t=B(e),p.special.save(t.getMapKey(),t)}function Ee(e,t,n){var i,o,a,s,c,l=n||{},u=t||function(){return!1},d=angular.isArray(e)?e:e.newsFeedList,g=L(),E=b();if(angular.isArray(d))for(s=0;s<d.length;s++)a=d[s],c=a.nfId,0===f?f=c:c<f&&(f=c),1!==a.fc?u(a,g,e.actn||a.actn)&&(a.deleted?E.remove(r.makeKey(a.nfId)):a.whShrLst||a.orgFd?l.processWhoShare&&angular.isFunction(l.processWhoShare)?l.processWhoShare.call(null,a,E,g):(a.orgFd?(i=B(a),(o=he(a.orgFd.nfId))||(o=B(a.orgFd))):(i=B(a.whShrLst[0]),(o=he(a.nfId))||(o=B(a))),i.shares(o),E.save(i.getMapKey(),i),_e(o,i.getKey())):(i=B(a),E.save(i.getMapKey(),i))):ge(d[s])}function me(e){Ee(e,H)}function Te(e){var t=e||L();switch(t.action){case E.TYPE_MY_NEWS_FEED:case E.TYPE_FRIEND_NEWSFEED:return t.ptype===E.PROFILE_TYPES.NEWSPORTAL?V:t.ptype===E.PROFILE_TYPES.BUSINESS_PAGE?z:t.pType===E.PROFILE_TYPES.CELEBRITY?X:t.ptype===E.PROFILE_TYPES.MEDIA_PAGE?W:Z;case E.TYPE_GROUP_NEWS_FEED:return x;case E.TYPE_MEDIAS_NEWS_FEED:return K;case E.TYPE_NEWS_PORTAL_FEED:return j;case E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:return H;case E.TYPE_BUSINESS_PAGE_FEED:return q;case E.TYPE_CELEBRITY_NEWSFEED:return Q;case E.TYPE_NEWS_FEED:default:return $}}function fe(e){var t=L();switch(t.action){case E.TYPE_MY_NEWS_FEED:ee(e);break;case E.TYPE_FRIEND_NEWSFEED:t.ptype===E.PROFILE_TYPES.NEWSPORTAL?te(e):t.ptype===E.PROFILE_TYPES.BUSINESS_PAGE?re(e):t.ptype===E.PROFILE_TYPES.CELEBRITY?ue(e):t.ptype===E.PROFILE_TYPES.MEDIA_PAGE?ne(e):J(e);break;case E.TYPE_GROUP_NEWS_FEED:ie(e);break;case E.TYPE_SAVED_FEED:oe(e);break;case E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:me(e);break;case E.TYPE_NEWS_FEED:de(e);break;case E.TYPE_MEDIAS_NEWS_FEED:ae(e);break;case E.TYPE_NEWS_PORTAL_FEED:se(e);break;case E.TYPE_BUSINESS_PAGE_FEED:ce(e);break;case E.TYPE_CELEBRITY_NEWSFEED:le(e)}}function pe(){for(var e;_.length&&I;)e=_.shift(),e.callback?e.callback.call(null,e,!0):fe([e])}function _e(e,t,n){var r=n||U();e.reference=t,r.save(e.getMapKey(),e)}function Ie(e,t){var n=t||U(),i=r.makeKey(e);return n.get(i)}function he(e){var t=b(),n=r.makeKey(e);return t.get(n)}function Ae(e){var t=b();t.add(e.getMapKey(),e)}function Ce(e,t){var n=t||b();return n.remove(r.makeKey(e))}function Se(e){var t=b();t.doForAll(function(n){n.user().getUtId()===e&&Ce(n.getKey(),t)})}function ve(e){var t=b();t.doForAll(function(n){n.getTargetCircle().getKey()===e&&Ce(n.getKey(),t)})}function Me(e,t,n){var r=be(e);return!(!r||!r.isSingleContentFeed())&&(r.setTotalLikes(n,t),C[e])}function De(e,t,n){var r=C[e];return!(!r||!r.feed.isSingleContentFeed())&&(r.feed.setTotalComment(t,n),r)}function Oe(e){var t=he(e.nfId),n=C[e.nfId];if(!t||!n)return!1;switch(e.actn){case E.TYPE_UPDATE_EDIT_STATUS:t.update(e);break;case E.TYPE_UPDATE_LIKE_STATUS:case E.TYPE_UPDATE_UNLIKE_STATUS:t.setTotalLikes(e.loc),t.setFeedTopMessage();break;case E.TYPE_UPDATE_ADD_STATUS_COMMENT:case E.TYPE_UPDATE_DELETE_STATUS_COMMENT:t.setTotalComment(e.loc),t.setFeedTopMessage()}return n}function Re(e){Ce(e.nfId)}function Ne(e,t,n,r){var i,o,a,s=Te();if(I&&!t)return e.callback=Ne,s.call(null,e.newsFeed)&&_.push(e),!1;if(i=e.newsFeed.orgFd&&e.newsFeed.orgFd.nfId,!i)return!1;if(o=he(i),a=U(),o){if(n)return o.setActivity(e.newsFeed.orgFd),C[o.getKey()];_e(o,e.newsFeed.nfId,a),Ce(o.getKey())}else if(o=Ie(i,a))return Ee([e.newsFeed],s,{processWhoShare:function(e,t,i){var a,s=he(o.reference);return s?parseInt(i.page,10)!==E.TYPE_FRIEND_NEWSFEED&&parseInt(i.page,10)!==E.TYPE_MY_NEWS_FEED&&(o.update(e,!0),n?(o.addShareUser(r),s.updateShareMessage(),s.setActivity(e),C[s.getKey()]):(a=B(e),a.setActivity(e.orgFd),Ce(o.reference),a.shares(o),t.save(a.getMapKey(),a),!1)):(fe([e]),!1)}}),!1;return fe([e.newsFeed])}function Pe(e){var t=Te();I?t.call(null,e,L())&&_.push(e):fe([e])}function ye(e){var t,n=!1,r=angular.isArray(e)?e[0]:e;if(h.length)for(t=0;t<h.length;t++)h[t].action===r.actn&&(n=h[t].callback.call(null,r));return!(!A[r.actn]||n)&&A[r.actn].call(null,r)}function be(e){return he(e)}function Ue(e,t){var n=i.getUniqueID();return h.push({key:n,action:e,callback:t}),n}function Le(e){var t,n=-1;for(t=0;t<h.length;t++)h[t].key===e&&(n=t);return n!==-1?h.splice(n,1):[]}function Fe(e){T=e,p.hasOwnProperty(T)||(p[T]={data:n.createNew(r.getSortIndex(),"desc"),removed:n.createNew(),no_more_feed:!1})}function ke(e){return ye(e)}function we(){return function(e){return!!A[e.actn]}}function Ge(){return b().all()}function Be(){var e=b();return e.all()}function $e(){return!!p.hasOwnProperty(T)&&p[T].no_more_feed}function He(t){var n=m.FEED_LIMIT,r=angular.copy(t||{});switch(r.pvtid=f||0,r.st=Be().length||0,i.feedColumn()){case 1:n=5;break;case 2:n=6;break;case 3:n=9;break;default:n=5}return r.lmt=r.lmt||n,e.send(r,E.REQUEST_TYPE.REQUEST,!0)}function xe(e){var t=angular.copy(e||{});t.scl=2,t.tm=0,He(t)}function Ye(e,t){var n=w(),r=angular.copy(e||{});return r.scl=t||2,r.tm=n||u,He(r)}function Ke(n,r){var i={actn:E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n},o=t.defer(),a=be(n);return a?o.resolve(a):e.request(i,E.REQUEST_TYPE.REQUEST).then(function(e){var t,n,i;e.sucs===!0?(t=angular.isArray(e)?e:e.newsFeedList[0],r&&t.orgFd?t.orgFd&&(a=B(t),i=B(t.orgFd),a.shares(i)):a=B(t),a&&(n=b(),n.save(a.getMapKey(),a)),o.resolve(a)):o.resolve(!1)},function(e){o.reject(e)}),o.promise}function je(n,r,a){var s,l,u,T,f=t.defer(),p=[],_=b(),I=n,h=i.getUniqueID();if(I.stsTags=[],I.text&&(I.text=o.parseUserTag(I.text,I.stsTags)),a?s=I.feed?I.feed:be(I.nfId):(s=B({nfId:h,fpvc:I.fpvc,sts:I.text,lat:I.lat||9999,lng:I.lng||9999,tm:G()+2,grpId:I.group||"",friendId:"",futId:I.friend||"",mdLst:I.mdIds||[],isNew:1,pending:!0,lctn:I.lctn||"",lnkDmn:I.lnkDmn||"",lnkDsc:I.lnkDsc||"",lnkTtl:I.lnkTtl||"",lnkURL:I.lnkURL||"",lnlImgURL:I.lnlImgURL||""},r),_.save(s.getMapKey(),s)),l={},l.spType=E.FEED_SUPER_TYPES.TYPE_GENERAL,I.cntntIDLst&&(l.cntntIDLst=I.cntntIDLst),I.group&&(l.grpId=I.group,l.spType=E.FEED_SUPER_TYPES.TYPE_CIRCLE),I.friend&&(l.futId=parseInt(I.friend,10)),I.lctn&&(l.lctn=I.lctn.utf8Encode()),I.lnkDmn&&(l.lnkDmn=I.lnkDmn.utf8Encode()),I.lnkDsc&&(l.lnkDsc=I.lnkDsc.utf8Encode()),I.lnkTtl&&(l.lnkTtl=I.lnkTtl.utf8Encode()),I.lnkURL&&(l.lnkURL=I.lnkURL.utf8Encode()),I.lnlImgURL&&(l.lnlImgURL=I.lnlImgURL.utf8Encode()),I.stsTags.length&&(l.stsTags=I.stsTags),l.actn=E.TYPE_ADD_STATUS,I.files&&I.files.length>0){for(u=0,T=I.files.length;u<T;u++)p.push(I.files[u].getAuthData("image"!==I.fileType));switch(I.fileType){case"image":l.imageList=p,l.type=E.NEWS_FEED_TYPE_IMAGE;break;case"video":l.mdaCntntDTO={albId:I.albId,htgLst:I.htgLst,mdaLst:p,mdaT:m.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:m.NEWS_FEED_MEDIA_TYPE_VIDEO},l.type=E.NEWS_FEED_TYPE_VIDEO;break;case"audio":l.mdaCntntDTO={albId:I.albId,htgLst:I.htgLst,mdaLst:p,mdaT:m.NEWS_FEED_MEDIA_TYPE_AUDIO,lnkT:m.NEWS_FEED_MEDIA_TYPE_AUDIO},l.type=E.NEWS_FEED_TYPE_AUDIO}}else l.actn=E.TYPE_ADD_STATUS,a?l.type=I.audio?E.NEWS_FEED_TYPE_AUDIO:E.NEWS_FEED_TYPE_VIDEO:l.type=E.NEWS_FEED_TYPE_STATUS;return I.mdIds&&(l.mdIds=I.mdIds),I.tFrndIds&&(l.tFrndIds=I.tFrndIds),l.vldt=I.vldt||"-1",l.lng=I.lng||9999,l.lat=I.lat||9999,l.sts=I.text.utf8Encode(),l.fpvc=I.fpvc||2,e.request(l,E.REQUEST_TYPE.UPDATE).then(function(e){d.$broadcast(g.FILE_UPLOAD.UPLOADS_POSTED),e.sucs?(a?s&&s.share(e.mdaCntntLst[0].is,e.mdaCntntLst[0].ns):(_.remove(s.getMapKey()),fe([e])),f.resolve(e)):(a||(_.remove(s.getMapKey()),c.show(e,"error")),f.reject(e))},function(e){a||(_.remove(s.getMapKey()),c.show(e,"error")),f.reject(e)}),f.promise}function Ve(n){var r,i;return n.addShare?je(n,n.user,!0):(r=t.defer(),n.stsTags=[],n.text&&(n.text=o.parseUserTag(n.text,n.stsTags)),i={actn:E.ACTION_SHARE_STATUS,sfId:n.feed.getKey(),type:2,sts:n.text.utf8Encode()},n.mdIds&&(i.mdIds=n.mdIds),n.tFrndIds&&(i.tFrndIds=n.tFrndIds),n.location&&(n.location.description&&(i.lctn=n.location.description.utf8Encode()),n.location.lat&&(i.lat=n.location.lat,i.lng=n.location.lng)),e.request(i,E.REQUEST_TYPE.UPDATE).then(function(e){e.sucs?(Ne(e,!0,!0,l.currentUser()),n.feed.share(!0),r.resolve(e)):r.reject(e)},function(e){r.reject(e)}),r.promise)}function We(n,r){var i=t.defer(),o=he(r),a=b();return o?(o.user().isCurrentUser(n.getKey())||setTimeout(function(){i.reject("You are not authorized to delete this feed.")},100),Ce(o.getKey(),a),e.request({actn:E.TYPE_DELETE_STATUS,nfId:r},E.REQUEST_TYPE.UPDATE).then(function(e){e.sucs?i.resolve(e):(Ae(o),i.reject(e))},function(e){Ae(o),i.reject(e)}),i.promise):(setTimeout(function(){i.reject("Can't Delete Invalid Feed")}),i.promise)}function qe(t){var n,r;return n=t.isSaved()?2:1,r={actn:E.PORTAL.ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED,optn:n,feedIdList:[t.getKey()]},e.request(r,E.REQUEST_TYPE.UPDATE)}function ze(n,r){var i,a,s,c=t.defer(),l=r,u=[],d=[];if(l.stsTags=[],l.text&&(l.text=o.parseUserTag(l.text,l.stsTags)),s={actn:E.TYPE_EDIT_STATUS,nfId:n.getFeedKey(),sts:l.text.utf8Encode()},l.removedMedia.length>0&&("image"===l.fileType?s.rmviids=l.removedMedia:s.rmvmids=l.removedMedia),l.files&&l.files.length>0){for(i=0,a=l.files.length;i<a;i++)l.files[i].feedEdit()?l.files[i].isEdited()&&("image"===l.fileType?d.push({imgId:l.files[i].getKey(),cptn:l.files[i].cptn()}):d.push({cntntId:l.files[i].getKey(),ttl:l.files[i].cptn()})):u.push(angular.extend({},l.files[i].getAuthData("image"!==l.fileType),{albId:l.albId,htgLst:l.htgLst,mdaT:"audio"===l.fileType?m.NEWS_FEED_MEDIA_TYPE_AUDIO:m.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:"audio"===l.fileType?m.NEWS_FEED_MEDIA_TYPE_AUDIO:m.NEWS_FEED_MEDIA_TYPE_VIDEO}));d.length>0&&("image"===l.fileType?s.edtimglst=d:s.edtmlst=d),u.length>0&&("image"===l.fileType?(s.type=E.NEWS_FEED_TYPE_IMAGE,s.imageList=u):(s.type="audio"===l.fileType?E.NEWS_FEED_TYPE_AUDIO:E.NEWS_FEED_TYPE_VIDEO,s.nmlst=u))}return l.cntntIDLst&&(s.cntntIDLst=l.cntntIDLst),l.lctn?(s.lctn=l.lctn.utf8Encode(),s.lng=l.lng||9999,s.lat=l.lat||9999):n.hasLocationInfo(!0)&&(s.lctn="",s.lng=9999,s.lat=9999),l.lnkDmn&&(s.lnkDmn=l.lnkDmn.utf8Encode()),l.lnkDsc&&(s.lnkDsc=l.lnkDsc.utf8Encode()),l.lnkTtl&&(s.lnkTtl=l.lnkTtl.utf8Encode()),l.lnkURL&&(s.lnkURL=l.lnkURL.utf8Encode()),l.lnlImgURL&&(s.lnlImgURL=l.lnlImgURL.utf8Encode()),l.stsTags.length&&(s.stsTags=l.stsTags),l.mdIds&&(s.mdIds=l.mdIds),l.tFrndIds&&(s.tFrndIds=l.tFrndIds),s.vldt=l.vldt||"-1",s.fpvc=l.fpvc||2,e.request(s,E.REQUEST_TYPE.UPDATE).then(function(e){var t;e.sucs?(n.setText(s.sts,s.stsTags),l.lctn?n.setLocationInfo({lctn:s.lctn,lng:s.lng,lat:s.lat}):n.hasLocationInfo(!0)&&n.setLocationInfo({lctn:"",lng:9999,lat:9999}),c.resolve(e)):c.reject(e),t=C[n.getKey()],t&&t.$rgDigest()},function(e){c.reject(e)}),c.promise}function Qe(n,r,i,a,s,c,l){var u,d,g,m,T,f,p,_,I,h,A=r,S=i,v=a,M=[];return angular.isObject(A)||(A=he(d)),!(!A||!A.user().isCurrentUser(n.getKey()))&&(u=t.defer(),d=A.getKey(),f=A.text(),p=A.getLocationInfo(),_=A.getFeelings(),h=A.getStsTags(),S&&(S=o.parseUserTag(S,M)),g={actn:E.TYPE_EDIT_STATUS,nfId:d,sts:S.utf8Encode()},g.stsTags=M,v=v||{},g.lctn=v.description?v.description.utf8Encode():"",g.lat=v.lat||9999,g.lng=v.lng||9999,m=s&&(!A.hasOgData()||A.getLinkUrl()!==s.url||A.getLinkImageUrl()!==s.image),m&&(g.lnkDmn=s.domain||"",g.lnkDsc=s.description?s.description.utf8Encode():"",g.lnkTtl=s.title?s.title.utf8Encode():"",g.lnkURL=s.url?s.url.utf8Encode():"",g.lnlImgURL=s.image||"",I=A.getOgData()),T=!1,c&&c.id?(g.mdIds=[c.id],T=!0):(g.mdIds=[],T=!0),l&&(l.removed&&(g.rTFrndIds=l.removed),l["new"]&&(g.tFrndIds=l["new"])),A!==!1&&(A.setText(S,M),A.setLocationInfo(v),T&&A.setFeelings(c),m&&A.setOgData(s),e.request(g,E.REQUEST_TYPE.UPDATE).then(function(e){var t;e.sucs===!1?(A.setText(f,h),A.setLocationInfo(p),T&&A.setFeelings(_),m&&A.setOgData(I),u.reject(e)):u.resolve(e),t=C[e.nfId],t&&t.$rgDigest()},function(e){var t;A.setText(f,h),A.setLocationInfo(p),T&&A.setFeelings(_),m&&A.setOgData(I),u.reject(e),t=t[A.getKey()],t&&t.$rgDigest()})),u.promise)}function Xe(n){var r=t.defer(),i={actn:E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n.getKey()};return e.request(i,E.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?r.resolve(e):(c.show(e,"error"),r.reject())},function(e){c.show(e,"error"),r.reject()}),r.promise}function Ze(t){return e.pull({actn:E.TYPE_TAG_USER_LIST,nfId:t.getKey()},E.REQUEST_TYPE.REQUEST)}function Je(e){return E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS+"."+e}function et(e){var t=angular.isArray(e)?e:e.newsFeedList;return!!(t.length>0&&t[0].whShrLst[0])&&t[0].whShrLst[0].nfId}function tt(n){var r,i,o;return r={actn:E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n},i=t.defer(),e.request(r,E.REQUEST_TYPE.REQUEST).then(function(e){e.sucs===!0?(o=e.newsFeedList[0],i.resolve(o)):i.resolve(!1)},function(e){i.reject(e)}),i.promise}}angular.module("ringid.shared").factory("InviteFactory",InviteFactory),InviteFactory.$inject=["$$connector","OPERATION_TYPES","userFactory","Storage","friendsFactory","$$stackedMap","$$q"];function InviteFactory(e,t,n,r,i,o,a){var s,c=[],l=!1,u=t.SYSTEM.FRIENDS,d=t.SYSTEM.REQUEST_TYPE,g={init:p,state:{isRequestsLoading:!1},suggestionFriends:o.createNew(),getSuggestionContactsDetails:T,removeSuggestion:f,allSuggestionFriends:o.createNew(),noOfSuggestions:function(){return g.suggestionFriends.length()}};function E(e){var t;switch(e.actn){case u.TYPE_PEOPLE_YOU_MAY_KNOW:if(e.sucs===!0){for(t=0;t<e.contactIds.length;t++)c.push(e.contactIds[t]);T()}else e.sucs===!1&&1111===e.rc&&m();break;case u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:if(g.state.isRequestsLoading=!1,e.sucs===!0)for(t=0;t<e.contactList.length;t++)c.splice(c.indexOf(e.contactList[t].utId),1),s=n.create(e.contactList[t]),s.isFriend()||g.suggestionFriends.save(s.getUtId(),s);else e.sucs===!1&&1111===e.rc&&T()}}function m(){return e.send({actn:u.TYPE_PEOPLE_YOU_MAY_KNOW},d.REQUEST)}function T(t){var n=t||10;return!g.state.isRequestsLoading&&(g.state.isRequestsLoading=!0,e.send({actn:u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:c.slice(0,n)},d.REQUEST))}function f(t,n){var r=a.defer(),o={actn:33,utId:t};function s(e){e.sucs===!0&&("remove"!==n&&i.addToUtIdList("outgoingUtIds",e.utId),g.suggestionFriends.remove(t),g.suggestionFriends.length()<5&&T(),r.resolve(e))}function c(e){r.reject(e)}return e.request(o,d.REQUEST).then(s,c),r.promise}function p(t){l||e.subscribe(E,{action:[u.TYPE_PEOPLE_YOU_MAY_KNOW,u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),l&&!t||(l=!0,m())}return g}angular.module("ringid.shared").factory("TextParser",TextParser),TextParser.$inject=["StickerEmoticonFactory","StickerEmoticonService","userFactory"];function TextParser(e,t,n){var r,i=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,o=e.getEmoticonPattern(),a=t.getEmoticonMap();function s(e){var t=e;return/^(f|ht)tps?:\/\//i.test(e)||(t="http://"+e),t}function c(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function l(e,t){var n=e,r=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g,l=c(e),u=t;return u||(u=0),"blob:http"===n.substring(0,9)&&(n='<img width="100%" src="'+n+'" />',u=2),0===u&&(n=l,n=n.replace(i,function(e){var t=s(e);return'<a class="feedanchor" target="_blank" href="'+t+'">'+e+"</a>"}),n=n.replace(o,function(e){return'<span class="em_list '+a[e].replace(/\.[A-Za-z]{3}/,"")+'" data-link="'+e+'" title="'+e+'">&nbsp;</span>'}),window.emojiSupported||(n=n.replace(r,function(e){var t,n,r;return t=e.charCodeAt(0),n=e.charCodeAt(1),r=(1024*(t-55296)+(n-56320)+65536).toString(16),'<u class="emo_list U_'+r+'"></u>'}))),n}function u(e,t){var n,r=t,i=0;return angular.isArray(r)||(r=[]),n=e.replace(/##([\d]+)##/g,function(e,t,n){var o;return o=n-i,r.push({pstn:o,utId:parseInt(t,10)}),i+=e.length,""})}function d(e,t,r){var i,o,a,s=[],c="",u=e,d=0,g=r||u.length,E=t||[];if(g>0&&(u=u.substr(0,g)),u||E)if(E&&E.length){for(E.sort(function(e,t){return t.pstn>e.pstn?-1:1}),a=0;a<E.length&&E[a].pstn<=g;a++)o=E[a].pstn-d,i=n.create(E[a]),o>0&&s.push(l(u.substr(d,o))),s.push(i.getLink({"class":"tag",title:i.getName().trim(),"data-link":i.getUtId()})),d=E[a].pstn;o=u.length-d,o>0&&s.push(l(u.substr(d,o))),c=s.join("")}else c=l(u);return c}function g(e){var t=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return!!e&&(t.test(e)||o.test(e))}return r={parseForLE:l,parseUserTag:u,textToHtml:d,hasEmoticon:g}}angular.module("ringid.shared").factory("CommentHttpService",CommentHttpService),CommentHttpService.$inject=["$$connector","OPERATION_TYPES"];function CommentHttpService(e,t){var n,r=t.SYSTEM,i=r.COMMENT_TYPES;n={getComment:o,getComments:a,addComment:s,updateComment:c,deleteComment:l,getEditHistories:u,getUpdateFilter:d};function o(t){var n={};switch(t.type){case"feed":n.cmntT=i.NEWSFEED_COMMENT,n.nfId=t.key;break;case"image":n.cmntT=i.IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.cmntT=i.MEDIA_COMMENT,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.actn=r.ACTION_GET_FULL_COMMENT,n.cmnId=t.commentId,e.request(n,r.REQUEST_TYPE.REQUEST)}function a(t,n,i){var o={};if(!t.key||!t.type)throw new Error("key and type must needed for fetcing comment");switch(t.type){case"feed":o.actn=r.TYPE_COMMENTS_FOR_STATUS,o.nfId=t.key;break;case"image":o.actn=r.IMAGE.TYPE_COMMENTS_FOR_IMAGE,o.imgId=t.key,t.target.getFeedKey()&&(o.nfId=t.target.getFeedKey());break;case"media":o.actn=r.MEDIA.ACTION_MEDIA_COMMENT_LIST,o.cntntId=t.key,t.target.getFeedKey()&&(o.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n?(o.scl=i?i:1,o.tm=n):o.st=t.st||0,e.pull(o,r.REQUEST_TYPE.REQUEST,!0)}function s(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_ADD_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_ADD_IMAGE_COMMENT,n.imgId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;case"media":n.actn=r.MEDIA.ACTION_ADD_COMMENT_ON_MEDIA,n.cntntId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n.cmn=t.text.utf8Encode(),t.cmnTgLst&&t.cmnTgLst.length>0&&(n.cmnTgLst=t.cmnTgLst),n.uType=t.uType||0,t.url&&(n.url=t.url),t.drtn&&(n.drtn=t.drtn),t.thmbURL&&(n.thmbURL=t.thmbURL),e.request(n,r.REQUEST_TYPE.UPDATE,!0)}function c(t,n){var i={};switch(t.type){case"feed":i.actn=r.TYPE_EDIT_STATUS_COMMENT,i.nfId=t.key;break;case"image":i.actn=r.IMAGE.TYPE_EDIT_IMAGE_COMMENT,i.imgId=t.key;break;case"media":i.actn=r.MEDIA.ACTION_EDIT_COMMENT_ON_MEDIA,i.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return i.cmnId=t.commentId,i.cmn=t.text.utf8Encode(),i.cmnTgLst=t.cmnTgLst,n?(i.uType=0,i.url=""):(i.uType=t.uType||0,t.url&&(i.url=t.url),t.drtn&&(i.drtn=t.drtn),t.thmbURL&&(i.thmbURL=t.thmbURL)),e.request(i,r.REQUEST_TYPE.UPDATE)}function l(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_DELETE_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_DELETE_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_DELETE_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,e.request(n,r.REQUEST_TYPE.UPDATE,!0)}function u(t,n,o){var a={};if(!t.key||!t.type)throw new Error("key and type must needed for fetcing comment");switch(a.actn=r.ACTION_COMMENT_EDIT_HISTORY_LIST,t.type){case"feed":a.nfId=t.key,a.cmntT=i.NEWSFEED_COMMENT;break;case"image":a.imgId=t.key,a.cmntT=i.IMAGE_COMMENT,t.target.getFeedKey()&&(a.nfId=t.target.getFeedKey());break;case"media":a.cntntId=t.key,a.cmntT=i.MEDIA_COMMENT,t.target.getFeedKey()&&(a.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return a.cmnId=t.commentId,n?(a.scl=o?o:1,a.tm=n):a.st=t.st||0,e.pull(a,r.REQUEST_TYPE.REQUEST,!0)}function d(e,t){var n,i,o=[r.TYPE_UPDATE_ADD_STATUS_COMMENT,r.TYPE_UPDATE_LIKE_COMMENT,r.TYPE_UPDATE_UNLIKE_COMMENT,r.TYPE_UPDATE_DELETE_STATUS_COMMENT,r.TYPE_UPDATE_EDIT_STATUS_COMMENT],a=[r.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT],s=[r.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT];switch(e){case"feed":n=o,i="nfId";break;case"image":n=a,i="imgId";break;case"media":n=s,i="cntntId";break;default:return[1111111]}return function(e){return n.indexOf(e.actn)!==-1&&e[i]===t}}return n}angular.module("ringid.shared").directive("rgAudio",rgAudio),rgAudio.$inject=["$ringbox","Ringalert"];function rgAudio(e,t){return{restrict:"E",templateUrl:"templates/partials/news_feed/rg-audio.directive.html",scope:{feed:"=",feedCategory:"@",getMediaData:"&",selectAlbum:"&",noDownload:"&",getAudioFirstData:"&"},link:function(n,r,i){n.$rgDigest(),"special"===n.feedCategory?(n.isShowCloseButton=!0,n.targetHTML="templates/partials/notification/media-popup-special.html",n.mediaListPopupHTML="templates/partials/media-list-popup-special.html"):(n.isShowCloseButton=!1,n.targetHTML="templates/partials/notification/media-popup.html",n.mediaListPopupHTML="templates/partials/media-list-popup.html"),n.limit=3,n.showMoreButton=!0,n.getMediasForPopUp=function(t,r){return"single"===i.feedType?(n.limit=t.getAudios().length(),void(n.showMoreButton=!1)):void e.open({type:"remote",scope:!1,controller:"FeedMediaListController",resolve:{localData:{media:t,type:r}},templateUrl:n.mediaListPopupHTML})},n.ddActionHtml="templates/dropdowns/recent-media-dropdown.html",n.actionMediaDropdown=function(r){var i;function o(){r.data.obj.setMediaToken().then(function(e){e&&a(),n.$rgDigest()})}function a(){window.FB&&window.FB.ui({method:"share",href:r.data.obj.getEmbedUrl()},function(){})}switch(r.action){case"addtoalbum":e.open({type:"remote",scope:!1,backDropClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:r.data.obj}},templateUrl:"templates/dropdowns/popup-album-dropdown.html"});break;case"sendtochat":e.open({type:"remote",scope:!1,backDropClose:!0,controller:"SendToChatController",
resolve:{localData:{media:r.data.obj}},templateUrl:"templates/media/send-to-chat.html"});break;case"sendtofriend":break;case"shareatringid":i=e.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:r.data.obj},backDropClose:!0,templateUrl:"templates/home/share-media.html"}),i.result.then(function(){n.$rgDigest()});break;case"shareatfb":o();break;case"download":t.show("Currently download option is available in ringID desktop and mobile app version only","info")}}}}}angular.module("ringid.shared").directive("rgVideo",rgVideo),rgVideo.$inject=["$ringbox","Ringalert"];function rgVideo(e,t){return{restrict:"E",templateUrl:"templates/partials/news_feed/rg-video.directive.html",scope:{feed:"=",feedCategory:"@",getMediaData:"&",selectAlbum:"&",noDownload:"&",getMediaFirstData:"&"},link:function(n,r,i){n.$rgDigest(),"special"===n.feedCategory?(n.isShowCloseButton=!0,n.targetHTML="templates/partials/notification/media-popup-special.html",n.mediaListPopupHTML="templates/partials/media-list-popup-special.html"):(n.isShowCloseButton=!1,n.targetHTML="templates/partials/notification/media-popup.html",n.mediaListPopupHTML="templates/partials/media-list-popup.html"),n.limit=3,n.showMoreButton=!0,n.ddActionHtml="templates/dropdowns/recent-media-dropdown.html",n.getMediasForPopUp=function(t,r){return"single"===i.feedType?(n.limit=t.getMedias().length(),void(n.showMoreButton=!1)):void e.open({type:"remote",scope:!1,controller:"FeedMediaListController",resolve:{localData:{media:t,type:r}},templateUrl:n.mediaListPopupHTML})},n.actionMediaDropdown=function(r){var i;function o(){r.data.obj.setMediaToken().then(function(e){e&&a(),n.$rgDigest()})}function a(){window.FB&&window.FB.ui({method:"share",href:r.data.obj.getEmbedUrl()},function(){})}switch(r.action){case"addtoalbum":e.open({type:"remote",scope:!1,backDropClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:r.data.obj}},templateUrl:"templates/dropdowns/popup-album-dropdown.html"});break;case"sendtochat":e.open({type:"remote",scope:!1,backDropClose:!0,controller:"SendToChatController",resolve:{localData:{media:r.data.obj}},templateUrl:"templates/media/send-to-chat.html"});break;case"sendtofriend":break;case"shareatringid":i=e.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:r.data.obj},backDropClose:!0,templateUrl:"templates/home/share-media.html"}),i.result.then(function(){n.$rgDigest()});break;case"shareatfb":o();break;case"download":t.show("Currently download option is available in ringID desktop and mobile app version only","info")}}}}}angular.module("ringid.shared").directive("rgFriendSuggestions",rgFriendSuggestions),rgFriendSuggestions.$inject=[];function rgFriendSuggestions(){return{restrict:"E",templateUrl:"templates/partials/rg-friend-suggestions.directive.html",link:function(e){e.$rgDigest()}}}angular.module("ringid.shared").directive("rgSavedFeedsTabNav",rgSavedFeedsTabNav),rgSavedFeedsTabNav.$inject=["routeService"];function rgSavedFeedsTabNav(e){t.$inject=["$scope","$location"];function t(t,n){t.path={savedFeeds:e.getRoute("SAVED_FEEDS"),savedMediaFeeds:e.getRoute("SAVED_MEDIA_FEEDS"),savedCircleFeeds:e.getRoute("SAVED_CIRCLE_FEEDS"),savedNewsportalFeeds:e.getRoute("SAVED_NEWSPORTAL_FEEDS"),savedPagesFeeds:e.getRoute("SAVED_PAGES_FEEDS"),savedCelebrityFeeds:e.getRoute("SAVED_CELEBRITY_FEEDS")},t.isCurrentPath=function(e,t){return t?n.path().indexOf(e)>-1:n.path()===e}}return{restrict:"E",controller:t,templateUrl:"templates/saved/saved-feeds.tabnav.directive.html",link:function(e){e.$rgDigest()}}}angular.module("ringid.shared").controller("CommentsController",CommentsController),CommentsController.$inject=["$scope","$$connector","Ringalert","Utils","TextParser","CommentHttpService","Auth","UPLOAD_TYPES","fileUploadService","$$stackedMap","$$commentMap","rgDropdownService","OPERATION_TYPES","rgScrollbarService","feedFactory","SystemEvents","$ringbox","COMMENT_URL_TYPE"];function CommentsController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p){var _,I,h=g.SYSTEM,A=!1;e.comments=l.createNew(!0,"asc"),e.loadingComment=!1,e.canComment=!0,e.haveFile=!1,e.comentFile=null,e.commentEditFile=null,e.removedEditFile=!1,e.commentEditorEnabled=!1,e.commentEditErrorClass="",e.commentKey="",e.commenttext="",e.ddCommentHtml="templates/dropdowns/comment-edit-dropdown.html",e.previousComment=!!e.target.getTotalComment(),e.afterComment=!0,e.models={commentedittext:""},e.currentUser=a.currentUser(),e.openRingboxLike=function(e){return e.getTotalLikes()>0},e.isCommentEditing=function(t){return e.commentEditorEnabled&&t.getKey()===e.commentKey},e.loadMoreComment=L,e.loadPreviousComment=b,e.addComment=$,e.updateComment=H,e.showEditHistory=Y,e.hideScroll=!!e.hideScroll&&"false"!==e.hideScroll,e.showPreviousButton=function(){return e.target.getTotalComment()>e.comments.length()&&e.previousComment&&!e.loadingComment},e.showMoreButton=function(){return e.target.getTotalComment()>e.comments.length()&&e.afterComment&&!e.loadingComment},e.cancelEdit=function(){v(),C()},e.commentContentEdit=function(e){return function(){return e.getDynamicText()}},e.commentEditShowFile=M,e.commentEditGetUrlPreview=D,e.chooseEditFile=R,e.removeEditFile=N,e.clearEditVariables=v,e.commentEditGetType=O,e.actionCommentDropdown=function(e){switch(d.close(e.event),e.action){case"edit":S(e.commentMap);break;case"delete":x(e.commentMap)}};function C(){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function S(t){e.commentEditorEnabled=!0,e.commentKey=t.getKey(),e.models.commentedittext=t.getDynamicText(),e.commentEditFile=null,e.commentEditErrorClass="",C()}function v(){e.commentEditorEnabled=!1,e.commentKey=0,e.models.commentedittext="",e.commentEditFile=null,e.commentEditErrorClass=""}function M(t){return!e.removedEditFile&&e.isCommentEditing(t)&&(e.commentEditFile||t.hasUrl())}function D(t){return e.commentEditFile?e.commentEditFile.getPreview():t.getPreview()}function O(t){return e.commentEditFile?"comment"+e.commentEditFile.getFileType():"comment"+t.getType()}function R(t){t.uploadFile.fetchMeta(function(t){e.$rgDigest()}),e.commentEditFile=t.uploadFile,e.removedEditFile=!1}function N(){e.commentEditFile=!1,e.removedEditFile=!0,e.$rgDigest()}function P(t){e.loadingComment=t,I&&(window.clearTimeout(I),I=void 0)}function y(){_=t.subscribe(function(t){var n;switch(t.actn){case h.TYPE_UPDATE_ADD_STATUS_COMMENT:case h.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT:case h.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT:G({comments:[t]});break;case h.TYPE_UPDATE_EDIT_STATUS_COMMENT:case h.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT:case h.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT:n=e.comments.get(t.cmnId),n&&n.setComment(t.cmn);break;case h.TYPE_UPDATE_LIKE_COMMENT:case h.TYPE_UPDATE_UNLIKE_COMMENT:case h.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:case h.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:n=e.comments.get(t.cmnId),n&&n.incomingLike(t.loc);break;case h.TYPE_UPDATE_DELETE_STATUS_COMMENT:case h.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT:case h.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT:e.comments.remove(t.cmnId)}C()},{filter:o.getUpdateFilter(e.commentType,e.target.getKey())}),e.$on("$destroy",function(){c.removeScope(s.COMMENT,e),_&&t.unsubscribe(_),_=!1})}function b(t){var n,r=!1;e.comments.length()&&(n=e.comments.getByIndex(0),r=n.getTimestamp()),w(r,2,t)}function U(t){t.comments&&(t.comments.length>5&&e.target.getTotalComment()>e.comments.length()+t.comments.length?(t.comments.sort(function(e,t){return e.tm>t.tm?1:-1}),t.comments.splice(0,1),G({comments:t.comments}),e.previousComment=!0):(e.previousComment=!1,G(t)))}function L(){var t,n=!1;parseInt(e.activeCommentId,10)>0&&e.comments.length()&&(t=e.comments.getByIndex(e.comments.length()-1),n=t.getTimestamp()),w(n,1)}function F(t){t.comments&&(t.comments.length>5&&e.target.getTotalComment()>e.comments.length()+t.comments.length?(t.comments.sort(function(e,t){return e.tm<t.tm?1:-1}),t.comments.splice(0,1),G({comments:t.comments}),e.afterComment=!0):(e.afterComment=!1,G(t)))}function k(){var t,n;parseInt(e.activeCommentId,10)>0?(t=e.commentType,n=e.target,"feed"===e.commentType&&e.target.isSingleContentFeed()&&(n=e.target.getSingleContent(),t=e.target.getContentType()),o.getComment({key:n.getKey(),type:t,commentId:parseInt(e.activeCommentId,10)}).then(function(t){t.sucs?(G({comments:[t.cmntDTO]}),L(),setTimeout(function(){b(!0)},500)):(e.activeCommentId=0,w()),C()},function(){w()})):(w(),e.afterComment=!1)}function w(t,n,r){var i,a;(e.target.getTotalComment()&&(2!==n||e.showPreviousButton())&&(1!==n||e.showMoreButton())||r)&&(P(!0),i=e.commentType,a=e.target,"feed"===e.commentType&&e.target.isSingleContentFeed()&&(a=e.target.getSingleContent(),i=e.target.getContentType()),I=setTimeout(P.bind(e,!1),3e3),o.getComments({key:a.getKey(),type:i,st:e.comments.length(),target:a},t,n).then(function(t){t.sucs&&(parseInt(e.activeCommentId,10)?2===n?U(t):F(t):G(t),E.recalculate(e)),P(!1),C(),e.$emit(T.RINGBOX.UPDATE)}),C())}function G(t){var n,r;for(r=0;r<t.comments.length;r++)n=u.create(t.comments[r]),e.comments.save(n.getKey(),n)}e.removeCommentFile=function(){e.haveFile=!1,e.commentFile=null,e.$rgDigest()},e.chooseFile=function(t){t.uploadFile.fetchMeta(function(){e.haveFile=!0,e.$rgDigest()}),e.commentFile=t.uploadFile};function B(t,n){var r,i=0,o=n||e.commentFile;return t?p.STICKER:(o&&(r=o.getFileType(),"image"===r?i=p.IMAGE:"audio"===r?i=p.AUDIO:"video"===r&&(i=p.VIDEO)),i)}e.sendSticker=function(e){$(e)};function $(t){var a,l,d,g=e.commenttext,f=[],p=e.target,_=e.commentType;e.canComment=!1,K(!!t)?(a=r.getUniqueID(),g=t?"":i.parseUserTag(g,f),d=t?t.src():e.commentFile?e.commentFile.getPreview():"",l={cmnId:a,cmn:g,deleted:!1,isNew:!0,edited:!1,cmntTags:f,url:d,uType:B(!!t),pending:!0},e.comments.add(a,u.create(l,e.currentUser)),e.haveFile?(c.setScopeForDigest(s.COMMENT,e),e.commentFile.initUpload().then(function(t){c.removeScope(s.COMMENT,e),t.sucs===!1?(n.show("File Upload Failed! Please try Again Later","error"),e.comments.remove(a),e.canComment=!0,e.commenttext=g,C(),E.recalculate(e)):I(t)})):t?I({iurl:t.srcWithoutBase()}):I(),C(),E.recalculate(e),E.scrollTo(e,".com-"+a)):C();function I(t){o.addComment({key:p.getKey(),type:_,text:g,cmnTgLst:f,target:p,url:t?t.iurl:"",drtn:t?t.drtn:0,thmbURL:t?t.thmbURL:"",uType:l.uType}).then(function(t){var r,i;t.sucs===!0?(e.comments.remove(a),t.pending=!1,t.cmn=t.cmn||l.cmn,r=u.create(t,e.currentUser),e.comments.add(r.getKey(),r),e.target.setTotalComment(t.loc,1),"feed"===e.commentType&&e.target.isSingleContentFeed()?e.target.getSingleContent().setTotalComment(t.loc,1):"feed"!==e.commentType&&(i=m.synchComment(e.target.getFeedKey(),t.loc,1),i&&i.$rgDigest()),e.canComment=!0,e.commenttext="",e.haveFile=!1,e.commentFile=null,C(),e.$emit(T.RINGBOX.UPDATE)):(e.comments.remove(a),e.canComment=!0,n.show(t,"error"),e.commenttext=g,C())},function(t){e.comments.remove(a),e.canComment=!0,n.show(t,"error"),e.commenttext=g,C(),E.recalculate(e)})}}function H(t){var r,a,l,u,d,g,E,m,f=[],p="";if(!t.user().isCurrentUser())return void(e.commentEditorEnabled=!1);r=e.models.commentedittext.trim(),a=e.commentType,l=e.target,m=t.text(),d=t.getRawUrl(),u=t.getRawType(),E=t.getTags(),r=i.parseUserTag(r,f),t.setComment(r,f),e.commentKey="",e.commentEditFile?(p=e.commentEditFile.getPreview(),g=B(!1,e.commentEditFile),t.setUrl(p,g)):(g=u,p=d),t.isPending(!0),j()?e.commentEditFile?(c.setScopeForDigest(s.COMMENT,e),e.commentEditFile.initUpload().then(function(r){c.removeScope(s.COMMENT,e),r.sucs===!1?(n.show("File Upload Failed! Please try Again Later","error"),e.setComment(m,E),t.isPending(!1),t.setUrl(d,u),e.clearEditVariables(),C()):(t.setUrl(r.iurl,g),_(r))})):e.removedEditFile?(r.length<1&&x(t),g=0,t.setUrl("",g),_()):_():n.show("Please write something","error");function _(i){var s;s={key:l.getKey(),type:a,cmnTgLst:f,commentId:t.getKey(),text:r},i&&(s.url=i.iurl||"",s.drtn=i.drtn||0,s.thmbURL=i.thmbURL||""),s.uType=g,o.updateComment(s,e.removedEditFile).then(function(r){r.sucs||(t.setComment(m,E),t.setUrl(d,u),n.show(r,"error")),t.isPending(!1),e.clearEditVariables(),C(),e.$emit(T.RINGBOX.UPDATE)},function(e){t.setComment(m,E),t.setUrl(d,u),n.show(e,"error"),C()})}C()}function x(t){var r=e.commentType,i=e.target;t.isPending(!0),o.deleteComment({key:i.getKey(),type:r,commentId:t.getKey()}).then(function(r){var i;r.sucs?(e.comments.remove(r.cmnId),e.target.setTotalComment(r.loc,r.ic),"feed"===e.commentType&&e.target.isSingleContentFeed()?e.target.getSingleContent().setTotalComment(r.loc,r.ic):"feed"!==e.commentType&&(i=m.synchComment(e.target.getFeedKey(),r.loc,r.ic),i&&i.$rgDigest())):(t.isPending(!1),n.show(r,"error")),C(),e.$emit(T.RINGBOX.UPDATE)},function(e){t.isPending(!1),n.show(e,"error"),C()}),C()}function Y(t){var n=e.commentType,r=e.target;f.open({type:"remote",scope:e,controller:"CommentHistoryController",scrollable:!0,resolve:{localData:t,remoteData:o.getEditHistories({key:r.getKey(),type:n,commentId:t.getKey()})},templateUrl:"templates/partials/comments-edit-history.html"})}function K(t){return e.commenttext.length<1&&!e.haveFile&&!t?(e.commentErrorClass="inputerror",e.canComment=!0,!1):(e.commentErrorClass="",!0)}function j(){return e.models.commentedittext.length<1&&!e.commentEditHaveFile&&!e.removedEditFile?(e.commentErrorClass="inputerror",!1):(e.commentErrorClass="",!0)}e.$watch("showCommentBox",function(t){t&&(_||y(),e.comments.length()||k())}),e.$watch("target.getKey()",function(){A&&(_&&(t.unsubscribe(_),y(),e.comments.reset()),e.comments.length()||k()),A=!0})}angular.module("ringid.shared").controller("CommentHistoryController",CommentHistoryController),CommentHistoryController.$inject=["$scope","remoteData","localData","CommentHttpService","Utils"];function CommentHistoryController(e,t,n,r,i){e.comments=t.list||[],e.comments.forEach(function(t,n){e.comments[n].et=i.verbalDate(t.et)}),e.comment=n}angular.module("ringid.shared").directive("rgComments",rgComments).directive("rgImageComments",rgImageComments);function rgComments(){return{restrict:"E",controller:"CommentsController",link:function(e){e.$rgDigest()},scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@",hideScroll:"@"},template:'<div class="feed_comment"><div rg-scrollbar="scrollbar()" propagate="true" disabled="{{::hideScroll}}" ng-class="!hideScroll ? \'comm-scroll-height\':\'\'"><ul class="media-list"><li class="item bd" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item com-{{::comment.getKey()}}" rg-repeat="comm in comments.all() track by comm.key" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),comment_blink: (comment.getKey() == activeCommentId)}"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><a ng-href="{{comment.user().link()}}"><img ng-src="{{ comment.user().avatar(\'thumb\')}}" alt=""></a></div><div class="comm-p"><p class="unm"><a ng-href="{{comment.user().link()}}" ng-cloak="true">{{comment.user().getName()}}</a></p><p class="comment_text" ng-hide="isCommentEditing(comment)" ng-bind-html="comment.getDynamicText()"></p><div class="photo-view" ng-if="!isCommentEditing(comment) && comment.hasUrl() && comment.hasImage()" rg-image-popup="comment.getUrl()" title="comment.getDynamicText()" style="background-image: url(\'{{comment.getUrl()}}\')"></div><div class="photo-view" ng-if="!isCommentEditing(comment) && comment.hasUrl() && comment.hasSticker()" style="background-image: url(\'{{comment.getUrl()}}\')"></div><div class="media-view" ng-if="(!isCommentEditing(comment) && comment.hasUrl() && (comment.hasAudio() || comment.hasVideo()))" style="background-image: url(\'{{comment.getPreview()}}\')" rg-play-popup="comment.getUrl()" player-id="play-{{comment.getKey()}}" is-video="{{::comment.hasVideo()}}"><div class="m-icn play" ng-class="{\'audio\' : comment.hasAudio(), \'video\' : comment.hasVideo()}"></div></div><div ng-if="isCommentEditing(comment)"><span class="comment" ng-class="commentEditErrorClass"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.$parent.commentEditorEnabled" placeholder="Write your comment..." tag-friend="true" on-escape="cancelEdit" common-file-uploader="comment" file-uploader-ready="chooseEditFile(fl)"></rg-editor><div class="comment-photo-view" ng-show="commentEditShowFile(comment)"><div class="comment-thumb"><div class="thumb-view" style="background-image: url(\'{{commentEditGetUrlPreview(comment)}}\'); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer"></div><div class="m-icn" ng-class="{\'audio\' :  commentEditGetType(comment) == \'commentaudio\', \'video\' :  commentEditGetType(comment) == \'commentvideo\'}"></div></div><span id="closebtn0" class="close-ico tagclose cmnt-pv-close" rg-click="removeEditFile()" inc="0"><div class="up-p"></div></span></div><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></div><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-top-7 feed-m"><span class="time" ng-cloak="true"><i class="img_sprite icon-dt-ico w-h-13"></i>{{comment.time()}}</span> <span ng-if="comment.isEdited()" rg-click="showEditHistory(comment)" class="edit-history">Edited</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class="" style="position: relative"><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li></ul></div><div ng-show="loadingComment" style="text-align:center;margin-top:10px"><div class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div></div><div class="item" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></div><div ng-if="target.getTotalComment() > comments.length()" class="divider"></div><div class="mar-top-10"><div class="comment-w" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write a comment...." tag-friend="true" common-file-uploader="comment" file-uploader-ready="chooseFile(fl)" show-sticker="true" sticker-on-choose="sendSticker(emo)"></rg-editor></div><div class="comment-photo-view" ng-show="haveFile"><div class="comment-thumb"><div class="thumb-view" style="background-image: url(\'{{commentFile.getPreview()}}\'); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer"></div><div class="m-icn" ng-class="{\'audio\' : commentFile.getType() == \'commentaudio\', \'video\' : commentFile.getType() == \'commentvideo\'}"></div></div><span id="closebtn0" class="close-ico tagclose cmnt-pv-close" rg-click="removeCommentFile()" inc="0"><div class="up-p"></div></span></div></div></div></div>'}}function rgImageComments(){return{restrict:"E",controller:"CommentsController",scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@"},template:'<div class="feed-comment-wrapper" style="height:calc(100% - 165px)"><div class="feed_comment" rg-scrollbar="scrollbar()"><ul class="feed-img-l"><li class="item" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item pv-item com-{{::comment.getKey()}}" ng-repeat="comm in comments.all()" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),active: (comment.getKey() == activeCommentId) }"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{::comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{::comment.user().link()}}" ng-cloak="true">{{::comment.user().getName()}}</a></p><p class="txt_justify" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><div class="photo-view" ng-if="!isCommentEditing(comment) && comment.hasUrl() && comment.hasImage()" rg-image-popup="comment.getUrl()" title="comment.getDynamicText()" style="background-image: url(\'{{comment.getUrl()}}\')"></div><div class="photo-view" ng-if="!isCommentEditing(comment) && comment.hasUrl() && comment.hasSticker()" style="background-image: url(\'{{comment.getUrl()}}\')"></div><div class="media-view" ng-if="(!isCommentEditing(comment) && comment.hasUrl() && (comment.hasAudio() || comment.hasVideo()))" style="background-image: url(\'{{comment.getPreview()}}\')" rg-play-popup="comment.getUrl()" player-id="play-{{comment.getKey()}}" is-video="{{::comment.hasVideo()}}"><div class="m-icn play" ng-class="{\'audio\' : comment.hasAudio(), \'video\' : comment.hasVideo()}"></div></div><div ng-if="isCommentEditing(comment)"><span class="comment" ng-class="commentEditErrorClass"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.$parent.commentEditorEnabled" placeholder="Write your comment..." tag-friend="true" on-escape="cancelEdit" common-file-uploader="comment" file-uploader-ready="chooseEditFile(fl)"></rg-editor><div class="comment-photo-view edt-com" ng-show="commentEditShowFile(comment)"><div class="comment-thumb"><div class="thumb-view" style="background-image: url(\'{{commentEditGetUrlPreview(comment)}}\'); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer"></div><div class="m-icn" ng-class="{\'audio\' :  commentEditGetType(comment) == \'commentaudio\', \'video\' :  commentEditGetType(comment) == \'commentvideo\'}"></div></div><span id="closebtn0" class="close-ico tagclose cmnt-pv-close" rg-click="removeEditFile()" inc="0"><div class="up-p"></div></span></div><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></div><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::commentType}}" target="comment" target-parent="target.getKey()" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-left-60"><span class="time" ng-cloak="true"><i class="img_sprite icon-dt-ico w-h-13"></i> {{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class=""><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li><li ng-show="loadingComment" class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></li><li class="item" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></li></ul></div><div class="pv-c-top"><div class="width-100-percent"><div class="pv-pro float-left"><img ng-src="{{::currentUser.avatar(\'thumb\')}}" alt=""></div><div class="comment-w" style="width:80%" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write a comment...." tag-friend="true" common-file-uploader="comment" file-uploader-ready="chooseFile(fl)" show-sticker="true" sticker-on-choose="sendSticker(emo)"></rg-editor></div><div class="comment-photo-view" ng-show="haveFile"><div class="comment-thumb"><div class="thumb-view" style="background-image: url(\'{{commentFile.getPreview()}}\'); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer"></div><div class="m-icn" ng-class="{\'audio\' : commentFile.getType() == \'commentaudio\', \'video\' : commentFile.getType() == \'commentvideo\'}"></div></div><span id="closebtn0" class="close-ico tagclose cmnt-pv-close" rg-click="removeCommentFile()" inc="0"><div class="up-p"></div></span></div></div></div></div></div>'}}angular.module("ringid.shared").factory("LikeHttpService",LikeHttpService).controller("LikeController",LikeController).controller("WhoLikeController",WhoLikeController).directive("rgLikes",rgLikes).directive("rgLikerAnchor",rgLikerAnchor).directive("rgWhoLike",rgWhoLike).directive("rgLikerButton",rgLikerButton),LikeHttpService.$inject=["$$connector","OPERATION_TYPES","ChatConnector"];function LikeHttpService(e,t,n){var r,i=t.SYSTEM,o=CHAT_APP.PublicChatRequests;r={likeUnlike:a,likeUnlikeComment:s,fetchWhoLikes:l,fetchWhoLikesComment:c};function a(t){var r,a={};switch(t.type){case"feed":a.actn=1===t.il?i.TYPE_LIKE_STATUS:i.TYPE_UNLIKE_STATUS;break;case"image":a.actn=i.IMAGE.TYPE_LIKE_IMAGE,a.imgId=t.target.getKey(),a.lkd=t.il;break;case"media":a.actn=i.MEDIA.ACTION_LIKE_UNLIKE_MEDIA,a.cntntId=t.target.getKey(),a.lkd=t.il;break;case"chatMessage":a=t.target.iLike?o.getPublicChatLikeAMessageObject(t.target.boxId,t.target.userId,t.target.key):o.getPublicChatUnlikeAMessageObject(t.target.boxId,t.target.userId,t.target.key);break;default:throw new Error("comment type not familiar")}return"chatMessage"!==t.type?(t.target.getFeedKey()&&(a.nfId=t.target.getFeedKey()),r=e.request(a,i.REQUEST_TYPE.UPDATE)):r=n.request(a),r}function s(t){var n={};switch(t.type){case"feed":n.actn=t.il?i.TYPE_LIKE_COMMENT:i.TYPE_UNLIKE_COMMENT,n.nfId=t.key;break;case"image":n.actn=i.IMAGE.TYPE_LIKE_UNLIKE_IMAGE_COMMENT,n.imgId=t.key,n.lkd=t.il;break;case"media":n.actn=i.MEDIA.ACTION_LIKE_UNLIKE_MEDIA_COMMENT,n.cntntId=t.key,n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.cmnId=t.target.getKey(),e.request(n,i.REQUEST_TYPE.UPDATE)}function c(t){var n={};switch(t.type){case"feed":n.actn=i.TYPE_LIST_LIKES_OF_COMMENT,n.nfId=t.key;break;case"image":n.actn=i.IMAGE.TYPE_IMAGE_COMMENT_LIKES,n.imgId=t.key;break;case"media":n.actn=i.MEDIA.ACTION_MEDIACOMMENT_LIKE_LIST,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.st=t.st||0,n.cmnId=t.target.getKey(),e.pull(n,i.REQUEST_TYPE.REQUEST)}function l(t){var r,a={};switch(t.type){case"feed":a.actn=i.TYPE_LIKES_FOR_STATUS,a.nfId=t.target.getKey();break;case"image":a.actn=i.IMAGE.TYPE_LIKES_FOR_IMAGE,a.imgId=t.target.getKey();break;case"media":a.actn=i.MEDIA.ACTION_MEDIA_LIKE_LIST,a.cntntId=t.target.getKey();break;case"chatMessage":a=o.getPublicChatLikeMemberListRequestObject(t.target.boxId,t.target.key,t.target.getLastLikerId(),5);break;default:throw new Error("comment type not familiar")}return"chatMessage"!==t.type?(t.target.getFeedKey()&&(a.nfId=t.target.getFeedKey()),a.st=t.st||0,r=e.pull(a,i.REQUEST_TYPE.REQUEST)):r=n.request(a),r}return r}WhoLikeController.$inject=["$scope","LikeHttpService","rgScrollbarService","userFactory","friendsFactory","Api","Auth","$$stackedMap"];function WhoLikeController(e,t,n,r,i,o,a,s){e.loading=!0,e.users=s.createNew(),e.listTitle="People who liked this",e.isCurrentUser=function(e){return e.equals(a._currentUser)},e.loadmore=function(){e.loading||l()};function c(t){var n;return n="chatMessage"!==e.likeType?t:{utId:parseInt(t,10)},r.createByUtId(n,!0,!0)}function l(){var r,i="fetchWhoLikes";e.users.length()<e.target.getTotalLikes()&&(r={target:e.target,type:e.likeType,st:e.users.length()},"true"===e.likeComment&&(i="fetchWhoLikesComment",r.parentKey=e.targetOwner(),r.key=e.targetParent()),e.loading=!0,t[i](r).then(function(t){var r,i;if(e.loading=!1,!t.sucs)return void e.$close();for("chatMessage"===e.likeType&&(t.likes=e.target.getWhoLikes()),r=0;r<t.likes.length;r++)i=c(t.likes[r]),e.users.save(i.getKey(),i),i.commonFriends(!0,!0).then(function(){e.$rgDigest()});n.recalculate(e),e.$rgDigest()},function(){e.$close()}))}l(),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:o.user.getMutualFriends(e)}}}LikeController.$inject=["$scope","LikeHttpService","Ringalert","$ringbox","feedFactory","Auth"];function LikeController(e,t,n,r,i,o){e.anchorCallback=angular.noop,e.buttonCallback=angular.noop;function a(t){"chatMessage"!==e.target.likeType?(e.target.like(!0,!!t.loc&&t.loc),n.show(t,"error")):e.target.removeLikeUserId(o.currentUser().getKey()),e.anchorCallback.call(null,e.target.like()),e.buttonCallback.call(null,e.target.like()),e.$rgDigest()}e.LikeUnlike=function(){var n,r,o="likeUnlike";n={target:e.target,type:e.likeType},"true"===e.likeComment&&(o="likeUnlikeComment",n.parentKey=e.targetOwner(),n.key=e.targetParent()),n.il=e.target.like(!0),e.anchorCallback.call(null,n.il),e.buttonCallback.call(null,n.il),r=t[o](n),r&&r.then(function(t){var r;t.sucs?"feed"!==e.likeType&&"true"!==e.likeComment&&t.nfId&&(r=i.synchLike(t.nfId,n.il,t.loc),r&&r.$rgDigest()):a(t)},a),e.$rgDigest()},e.$watch("target",function(t){e.anchorCallback.call(null,t.like()),e.buttonCallback.call(null,t.like(),!0)}),e.showWhoLike=function(){e.target.getTotalLikes()&&r.open({type:"remote",scope:e,controller:"WhoLikeController",templateUrl:"templates/popups/user-list.html"})}}rgLikerButton.$inject=[];function rgLikerButton(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a><i class="img_sprite lc-ico room-love"></i><b>{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</b></a>',link:function(e,t){function n(e,n){e?(t[0].firstChild.className=t[0].firstChild.className.replace("icon-like","").trim(),t[0].firstChild.className=t[0].firstChild.className.replace("icon-like-h","").trim(),t[0].firstChild.className+=" icon-like-h",n||(t[0].firstChild.innerHTML='<span class="like-ani"></span>',window.setTimeout(function(){t&&(t[0].firstChild.innerHTML="")},2e3))):(t[0].firstChild.className=t[0].firstChild.className.replace("icon-like-h","").trim(),t[0].firstChild.className=t[0].firstChild.className.replace("icon-like","").trim(),t[0].firstChild.className+=" icon-like")}e.buttonCallback=n,n(e.target.like(),!0),t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}rgLikerAnchor.$inject=[];function rgLikerAnchor(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</a>',link:function(e,t){t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}rgWhoLike.$inject=[];function rgWhoLike(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes()}}</a>',link:function(e,t){t.bind("click",e.showWhoLike),e.$on("$destroy",function(){t.unbind("click",e.showWhoLike);
})}}}rgLikes.$inject=[];function rgLikes(){return{restrict:"EA",scope:{target:"=",likeType:"@",targetParent:"&",targetOwner:"&",likeComment:"@"},controller:"LikeController",template:"<rg-liker-button></rg-liker-button><rg-who-like></rg-who-like>",link:function(e,t){function n(e){e?t.addClass("active"):t.removeClass("active")}e.anchorCallback=n,n(e.target.like()),e.$watch("target.like()",function(){n(e.target.like()),e.buttonCallback.call(null,e.target.like(),!0)})}}}angular.module("ringid.shared").controller("EmoticonController",EmoticonController).directive("rgEmoticon",rgEmoticon),EmoticonController.$inject=["$scope","$location","StickerFactory"];function EmoticonController(e,t,n){e.openStickerMarket=r;function r(){t.path(e.routes.stickermarket)}e.startAt=0,e.getMyStickers=function(){return e.myStickerCatIds().slice(e.startAt,e.startAt+4)},e.getTopStickers=function(){return n.getStickerCategories("top").slice(0,4)},e.loadPrevious=function(t){e.startAt=e.startAt>0?e.startAt-1:0,t.stopPropagation(),e.$rgDigest()},e.loadNext=function(t){e.startAt=e.startAt+3<e.myStickerCatIds().length-1?e.startAt+1:e.startAt,t.stopPropagation(),e.$rgDigest()},e.myStickerCatIds=n.getMyStickerCatIds,e.getSticker=n.getStickerCategoryObject,e.emoticonMap=n.getEmoticonMap()}rgEmoticon.$inject=["$compile","$timeout","$document","Utils","StickerFactory","rgScrollbarService","$templateCache","$ringhttp","routeService","SystemEvents","GlobalEvents"];function rgEmoticon(e,t,n,r,i,o,a,s,c,l,u){function d(t,n,l){var d,g,E="templates/partials/emoticon-window.html",m=!1,T=300,f="true"===l.showSticker?300:260,p=T>f?T:f;t.emoWindowStyle={height:f+"px",width:T+"px"},t.showsticker="true"===l.showSticker,t.selectedStickerCatId=0,t.closeEmoticonPopup=I,t.routes={stickermarket:c.getRoute("STICKER_HOME")};function _(e){e.preventDefault(),m=!m,m?A(e):I()}n[0].addEventListener("click",_);function I(e){if(e&&"click"===e.type){if(e.target===n[0]||!e.target.parentNode||e.target.parentNode===n[0]||e.target.parentNode.parentNode===n[0]||"pt-top"===e.target.className)return;t()}else t();function t(){d&&d[0].parentNode&&d[0].parentNode.removeChild(d[0]),m=!1,u.unbindHandler("document","click",I),u.unbindHandler("document","scroll",I),u.unbindHandler("document","resize",C)}}function h(r){d=e(r)(t),n.after(d),C(),u.bindHandler("document","click",I),u.bindHandler("document","scroll",I),u.bindHandler("document","resize",C)}function A(e){g=e,a.get(E)?h(a.get(E)):s.get(E).success(function(e){h(e)})}t.selectEmoOrSticker=S,t.selectStickerCatId=M,t.showEmoticons=v,t.emoticon={},t.emoticon.calculatePosition=C;function C(){var e,i,o,a=0;m&&(e=n[0].getBoundingClientRect(),i=r.viewport.x-e.width,o=r.viewport.y,a=Math.floor(e.width/2),g.clientX+p<i&&g.clientY+p<o?(t.emoWindowStyle.top=e.top+(a+15)+"px",t.emoWindowStyle.left=e.left+(a+5)+"px"):g.clientX+p>i&&g.clientY+p>o?(t.emoWindowStyle.top=e.top-f+(a-5)+"px",t.emoWindowStyle.left=e.left-T+(a-5)+"px"):g.clientX+p>i?(t.emoWindowStyle.top=e.top+(a+5)+"px",t.emoWindowStyle.left=e.left-T+(a-5)+"px"):g.clientY+p>o&&(t.emoWindowStyle.top=e.top-f+(a-5)+"px",t.emoWindowStyle.left=e.left+(a+5)+"px"),t.$rgDigest())}function S(e,n){n.stopPropagation(),l.clicked&&t.$eval(l.clicked)(e,n),I(),t.$rgDigest()}function v(e){e.stopPropagation(),t.emoticonMap=i.getEmoticonMap(),t.$rgDigest()}function M(e,n){e.stopPropagation(),t.selectedStickerCatId=n,i.getStickerMapByCatId(n).then(function(e){t.emoticonMap=e,t.$rgDigest()}),o.scrollTop(t),t.$rgDigest()}t.$on("$destroy",function(){I(),n[0].removeEventListener("click",_)})}return{restrict:"A",link:d,controller:EmoticonController}}angular.module("ringid.shared").directive("rgUpload",rgUpload),rgUpload.$inject=["$compile","fileUploadService","UPLOAD_TYPES"];function rgUpload(e,t,n){r.$inject=["$scope","APP_CONSTANTS","Ringalert"];function r(e,n,r){var i=n.MEDIA_UPLOAD_SIZE_LIMIT;e.uploadAny=o;function o(){var n=this,o=t.validateUpload(this.files[0]);o.valid?"image"!==o.fileType&&n.files[0]>i?r.show("Maximum allowed total upload files size 500MB!","warning"):e.uploadAction()({action:e.uploadType,uploadFile:t.createUpload({uploadType:e.uploadType,fileType:o.fileType,file:n.files[0]})}):r.show("Invalid File","warning"),n.value=null,e.$rgDigest()}}function i(t,r,i){var o=i.uploadType,a="",s="";switch(o){case n.COMMENT:a='<div class="cmnt-upld"><input type="file" data-upload-'+o+' name="'+o+'" accept="image/*,video/mp4,audio/mp3" ><span class="img_sprite cmnt-cmra-ico camera-ico"></span></div>',r.append(e(a)(t));break;case n.CHAT:case n.TAGCHAT:a='<span  class="img_sprite icon-camera ico-sty "><input  data-upload-'+o+' name="'+o+'" type="file" style="opacity:0;" accept="image/*" ></span>',r.append(e(a)(t));break;case n.AVATAR:case n.COVER:a='<input  type="file" data-upload-'+o+' name="'+o+'"  accept="image/*" >',r.append(e(a)(t));break;case n.TAGCHAT_COVER:a='<span class="gpc"><span class="img_sprite w25 parent icon-camera"> <input  data-upload-'+o+' name="'+o+'" type="file" style="opacity:0" accept="image/*" ></span><span>Upload Group Photo</span></span>',r.append(e(a)(t))}function c(e){e.stopPropagation()}s=r[0].querySelector("input[data-upload-"+o+"]"),s&&(s.addEventListener("change",t.uploadAny),s.addEventListener("click",c)),t.$on("$destroy",function(){s&&(s.removeEventListener("change",t.uploadAny),s.removeEventListener("click",c))})}return{restrict:"AE",scope:{uploadType:"@",uploadAction:"&"},link:i,controller:r}}angular.module("ringid.shared").directive("rgInvite",rgInvite),rgInvite.$inject=["$$connector","OPERATION_TYPES","InviteFactory","friendsFactory","Api"];function rgInvite(e,t,n,r,i){function o(o,a){var s,c,l,u,d,g,E,m,T=t.SYSTEM.FRIENDS;a[0].style.display="none",o.removeOutGoingFriends=h,o.getSuggestions=I,o.removeSugg=_,o.getMutualFriend=p,o.friendRequestAction=f;function f(){var e=3===E.friendshipStatus()?"remove":"addfriend",t=E;function i(e){v(),M(e.sucs),C(),e.sucs===!0&&n.removeSuggestion(t.getUtId()).then(function(e){e.sucs===!0&&n.suggestionFriends.remove(t.getUtId())})}function o(){M(),C()}S(),r.friendAction({friend:t,action:e},!0).then(i,o),M()}function p(){return{data:function(){return{target:E}},promise:i.user.getMutualFriends(E)}}function _(){n.removeSuggestion(E.getUtId(),"remove"),v()}function I(){return o.removeOutGoingFriends(),n.suggestionFriends.length()<5&&n.getSuggestionContactsDetails(),{data:function(){return{target:n.suggestionFriends}}}}function h(){var e,t,r=[],i=n.suggestionFriends.all(),o=n.suggestionFriends.length();for(e=0;e<o;e++)0!==i[e].value.friendshipStatus()&&r.push(i[e].value.getUtId());for(t=0;t<r.length;t++)n.suggestionFriends.remove(r[t])}function A(){s=a[0].querySelector("[data-invite-name]"),c=a[0].querySelector("[data-invite-link]"),l=a[0].querySelector("[data-invite-avatar]"),u=a[0].querySelector("[data-invite-mutual]"),d=a[0].querySelector("[data-invite-loading]"),a[0].addEventListener("mouseenter",S),a[0].addEventListener("mouseleave",C),a[0].style.display="block",v(),C()}function C(){S(),g=setInterval(v,5e3)}function S(){clearInterval(g)}function v(){E=E?n.suggestionFriends.next(E.getUtId())||n.suggestionFriends.bottom():n.suggestionFriends.bottom(),E?(s.textContent=E.getName(),s.setAttribute("href",E.link()),c.setAttribute("href",E.link()),l.setAttribute("src",E.avatar("thumb")),u.textContent=E.commonFriends()+" mutual friends",E.commonFriends()>0?u.style.display="block":u.style.display="none",M()):a[0].style.display="none"}function M(){E.isLoading()?d.classList.add("f-loading"):d.classList.remove("f-loading")}function D(){e.subscribe(function(){m||(m=setTimeout(function(){A()},1e3))},{action:[T.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),setTimeout(n.init,5e3)}function O(){a[0].removeEventListener("mouseenter",C),a[0].removeEventListener("mouseenter",S)}D(),o.$on("$destroy",O)}return{restrict:"A",templateUrl:"templates/partials/friend-invite.html",link:o}}angular.module("ringid.shared").directive("rgPublicChatRoomList",rgPublicChatRoomList),rgPublicChatRoomList.$inject=["routeService"];function rgPublicChatRoomList(e){return{restrict:"E",templateUrl:"templates/partials/tag-chat/list-page/public-chat-room-list.html",controller:"PublicChatController",link:function(t){t.chatRoomRoute=e.getRoute("CHAT_ROOMS"),t.$rgDigest()}}}angular.module("ringid.shared").directive("rgUserview",rgUserview),rgUserview.$inject=[];function rgUserview(){var e={scope:{hideCurrentuser:"@",hideChat:"@",user:"="},templateUrl:n,controller:t};t.$inject=["$scope","Api"];function t(e,t){e.showUser=r(),e.getMutualFriend=n;function n(e){return{data:function(){return{target:e}},promise:t.user.getMutualFriends(e)}}function r(){return"true"!==e.hideCurrentuser||!e.user.isCurrentUser()}}function n(e,t){return t.templatePath&&t.templatePath.length>0?t.templatePath:"templates/partials/usercards/userview.directive.html"}return e}angular.module("ringid.shared").directive("rgAddfriend",rgAddfriend),rgAddfriend.$inject=[];function rgAddfriend(){var e={scope:{user:"=",hideChat:"@"},templateUrl:"templates/partials/usercards/addfriend.directive.html",controller:t};t.$inject=["$scope","friendsFactory"];function t(e,t){e.contactAction=n;function n(n){n.friend.isLoading()||(t.friendAction(n,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}}return e}angular.module("ringid.shared").directive("rgActiveRoute",rgActiveRoute),rgActiveRoute.$inject=["$location"];function rgActiveRoute(e){var t={restrict:"A",scope:{route:"@",contain:"@",activeClass:"@"},link:n};function n(t,n){var r=t.activeClass||"active";"true"===t.contain&&e.path().indexOf(t.route)>-1||e.path()===t.route?n[0].classList.add(r):e.path()===t.route&&n[0].classList.remove(r)}return t}angular.module("ringid.shared").controller("MenuController",MenuController),MenuController.$inject=["$scope","$location","routeService","Auth"];function MenuController(e,t,n,r){e.isCurrentPath=o,e.avatarStyle=i,e.routes={home:n.getRoute("HOME"),profile:n.getRoute("PROFILE",{uId:e.currentUser.getUId(),subpage:"post"}),mediaFeed:n.getRoute("MEDIA_FEED"),circle:n.getRoute("CIRCLE_FEED"),newsportal:n.getRoute("NEWSPORTAL_FEED"),pages:n.getRoute("PAGES_FEED"),chatGroups:n.getRoute("CHAT_GROUPS"),chatRooms:n.getRoute("CHAT_ROOMS"),stickermarket:n.getRoute("STICKER_HOME"),celebrity:n.getRoute("CELEBRITY_FEED")};function i(){return{"background-image":"url("+r.currentUser().avatar("thumb")+")","background-size":"cover"}}function o(e,n){return n?t.path().indexOf(e)>-1:t.path()===e}}angular.module("ringid.shared").controller("RightbarController",RightbarController),RightbarController.$inject=["$scope"];function RightbarController(e){e.active_menu="friend_list",e.setRightBarContentList=function(t){"group_chat"===t?e.active_menu=t:"public_chat"===t?e.active_menu=t:e.active_menu=t}}angular.module("ringid.shared").controller("allSuggestionController",allSuggestionController),allSuggestionController.$inject=["$scope","$boxInstance","localData","friendsFactory","InviteFactory","OPERATION_TYPES","$$connector","rgScrollbarService","Api","$$stackedMap"];function allSuggestionController(e,t,n,r,i,o,a,s,c,l){var u,d,g=o.SYSTEM.FRIENDS;u=n.target.length(),e.users=l.createNew(),e.listTitle="People you may know",e.state=i.state,e.loadmore=E,t.opened.then(function(){e.users=n.target.copy(),e.$rgDigest()}),e.$watch("state.isRequestsLoading",function(){e.$rgDigest()}),d=a.subscribe(m,{action:[g.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]});function E(){i.getSuggestionContactsDetails(5),e.$rgDigest()}function m(t){t&&(i.noOfSuggestions()>u&&(s.recalculate(e),e.$rgDigest()),u=i.noOfSuggestions())}e.$on("$destroy",function(){a.unsubscribe(d)})}angular.module("ringid.shared").controller("FriendSuggestionsController",FriendSuggestionsController),FriendSuggestionsController.$inject=["$scope","friendsFactory","InviteFactory","$$stackedMap","userFactory","OPERATION_TYPES","$$connector","Api","Ringalert","$timeout"];function FriendSuggestionsController(e,t,n,r,i,o,a,s,c,l){var u,d,g=o.SYSTEM.FRIENDS,E=o.SYSTEM.REQUEST_TYPE,m=[];e.users=r.createNew(),e.contactListAction=p,e.noMoreSuggestion=!1,e.loadingFriendSuggestion=!0;function T(){var e={actn:g.TYPE_PEOPLE_YOU_MAY_KNOW};return a.pull(e,E.REQUEST,!0)}function f(e){var t,n=e||10;return t={actn:g.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:m.slice(0,n)},a.pull(t,E.REQUEST,!0)}e.loadMoreSuggestedFriends=function(){e.loadingFriendSuggestion=!0,0!==m.length?f().then(function(t){if(t.sucs){for(u=0;u<t.contactList.length;u++)m.splice(m.indexOf(t.contactList[u].utId),1),d=i.create(t.contactList[u]),d.isFriend()||e.users.save(d.getUtId(),d);e.loadingFriendSuggestion=!1,e.$rgDigest()}else e.noMoreSuggestion=!0},function(e){c.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")}):e.noMoreSuggestion=!0},e.loadSuggestedFriends=function(){T().then(function(t){if(t.sucs){for(u=0;u<t.contactIds.length;u++)m.push(t.contactIds[u]);l(e.loadMoreSuggestedFriends(),0)}else m=[]},function(e){c.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})},e.loadSuggestedFriends();function p(n){n.friend.isLoading()||(t.friendAction(n,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}}angular.module("ringid.shared").controller("mutualFriendsController",mutualFriendsController),mutualFriendsController.$inject=["$scope","remoteData","friendsFactory","userFactory","rgScrollbarService","$$stackedMap"];function mutualFriendsController(e,t,n,r,i,o){var a,s=t.mfIDs;e.users=o.createNew(),e.listTitle="Mutual Friends",n.getContactDetailsByUtIds(s).then(c);function c(t){var n;if(t.sucs===!0){for(a=0;a<t.contacts.length;a++)n=r.create(t.contacts[a]),e.users.add(n.getKey(),n);e.$rgDigest()}i.recalculate(e),e.$rgDigest()}}angular.module("ringid.shared").directive("rgFeedSharerList",rgFeedSharerList);function rgFeedSharerList(){return{restrict:"E",templateUrl:"templates/partials/news_feed/rg-feed-sharer-list.html",scope:{feeds:"=",isSingleContentFeed:"="},link:function(e){e.$rgDigest()}}}!function(e,t){"use strict";e.module("ringid.ui_editor",[])}(angular,window),angular.module("ringid.ui_editor").constant("EDITOR_DATA",{PATTERN:{DATA_BLOCK:/<a.*?data-link="(.*?)".*?>.*?<\/a>/gi},CHAR:{SPACE:32,LINE_FEED:10,ZERO_WIDTH_SPACE:8203,NON_BREAKING_SPACE:160},KEY:{ENTER:13,BACKSPACE:8,SPACE:32,DELETE:46,ESCAPE:27,LEFT:37,RIGHT:39,UP:38,DOWN:40,CLICK:0,PASTE:-1}}),angular.module("ringid.ui_editor").factory("keys",Keys),Keys.$inject=["$sniffer","EDITOR_DATA"];function Keys(e,t){var n=e.vendorPrefix.toLowerCase(),r=[];return r[t.KEY.ENTER]={fn:"enter",action:"enter",event:"keydown"},r[t.KEY.BACKSPACE]={fn:"backspace",action:"backspace",event:"keydown"},r[t.KEY.SPACE]={fn:"space",action:"space",event:"keydown"},r[t.KEY.DELETE]={fn:"delete",action:"delete",event:"keydown"},r[t.KEY.ESCAPE]={fn:"escape",action:"escape",event:"keydown"},r[t.KEY.LEFT]={fn:"adjust",action:"left",event:"keyup"},r[t.KEY.RIGHT]={fn:"adjust",action:"right",event:"keyup"},r[t.KEY.UP]={fn:"adjust",action:"up",event:"keyup"},r[t.KEY.DOWN]={fn:"adjust",action:"down",event:"keyup"},r[t.KEY.CLICK]={fn:"adjust",action:"click",event:"mouseup"},r[t.KEY.PASTE]={fn:"paste",action:"paste",event:"paste"},"moz"===n&&(r[t.KEY.BACKSPACE]={fn:"backspace",action:"backspace",event:"both"},r[t.KEY.DELETE]={fn:"delete",action:"delete",event:"both"}),r}angular.module("ringid.ui_editor").factory("cursor",Cursor);function Cursor(){var e=!(!navigator.userAgent.match(/Trident/)||!navigator.userAgent.match(/rv[ :]11/)),t={toPosition:n,toElementStart:r,toElmentEnd:i,toElmentBefore:o,toElmentAfter:a,toElementByType:s,deleteContents:c,insertHtml:l,getSelection:u,isIE:d,extendSelection:g,reset:E,getRange:m,getCurrentRange:T,getDirection:f,intersectsNode:p};function n(e,t){var n=this.getSelection(),r=this.getRange(),i=t;i="undefined"!=typeof i&&null!==i?i:e.length||e.childNodes.length,r.setStart(e,i),r.setEnd(e,i),r.collapse(!0),n.removeAllRanges(),n.addRange(r),r.detach(),n=null}function r(e,t){t&&e.focus(),this.toPosition(e,0)}function i(e,t){t&&e.focus(),this.toPosition(e)}function o(e){var t=this.getSelection(),n=this.getRange();n.setStartBefore(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null}function a(e){var t=this.getSelection(),n=this.getRange();n.setStartAfter(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null}function s(e,t,n){var r=t;r="undefined"!=typeof r?r:"end","end"===r&&this.toElmentEnd(e),"start"===r&&this.toElementStart(e),"pos"===r&&this.toPosition(e,n)}function c(e,t,n,r){var i=this.getSelection(),o=this.getRange(),a=e,s=t,c=n,l=r;s="undefined"!=typeof s&&null!==s?s:a.length||a.childNodes.length,c="undefined"!=typeof c?c:a,l="undefined"!=typeof l&&null!==l?l:c.length||c.childNodes.length,a===c&&s===l||(1===a.nodeType?o.setStartBefore(a):o.setStart(a,s),1===c.nodeType?o.setEndAfter(c):o.setEnd(c,l),i.removeAllRanges(),i.addRange(o),document.execCommand("delete",!1),o.detach())}function l(t){var n,r,i,o=this.getCurrentRange();if(this.isIE())o.pasteHTML(t);else if(e){for(n=document.createElement("div"),r=document.createDocumentFragment(),n.innerHTML=t;i=n.firstChild;)r.appendChild(i);o.insertNode(r),n=r=i=null}else document.execCommand("insertHtml",!1,t)}function u(){return this.isIE()?document.selection:window.getSelection()}function d(){return document.selection&&"Control"!==document.selection.type}function g(e,t){var n,r=this.getSelection(),i=this.getRange();return n="undefined"===t||null===t||t,r.extend&&n?void r.extend(e.end,e.endPos):("ltr"===e.direction?(i.setStart(e.start,e.startPos),i.setEnd(e.end,e.endPos)):(i.setStart(e.end,e.endPos),i.setEnd(e.start,e.startPos)),r.removeAllRanges(),r.addRange(i),i.detach(),void(r=null))}function E(){var e=this.getSelection(),t=this.getRange(),n=this.getDirection();"ltr"===n?t.setStart(e.focusNode,e.focusOffset):t.setStart(e.anchorNode,e.anchorOffset),t.collapse(!0),e.removeAllRanges(),e.addRange(t),t.detach(),e=null}function m(){return document.createRange()}function T(){var e=this.getSelection();return this.isIE()?e.createRange():!!e.rangeCount&&e.getRangeAt(0)}function f(){var e=this.getSelection(),t=!1,n=this.getRange();return e&&!e.isCollapsed&&(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),t=n.collapsed,n.detach()),e=null,t?"rtl":"ltr"}function p(e){var t=this.getCurrentRange(),n=null;if(n=t.commonAncestorContainer,t.intersectsNode)return t.intersectsNode(e);for(;n&&n!==e;)n=n.parentNode;return n}return t}angular.module("ringid.ui_editor").factory("modifiers",Modifiers),Modifiers.$inject=["$sniffer","StickerEmoticonService","cursor","helpers","keys","EDITOR_DATA"];function Modifiers(e,t,n,r,i,o){var a=t.getEmoticonMap(),s=e.vendorPrefix.toLowerCase(),c={container:null,event:null,keyCode:0,action:"",selection:null,range:null,previousSelection:{},init:l,setContainer:u,adjust:d,enter:g,escape:E,backspace:m,"delete":T,space:f,addEmoticon:p,addTag:_,paste:I};function l(e,t,o,a,s){var l,u,d,g,E=!0,m=null,T=null;for(this.container=e,this.keyCode=t,this.event=o,this.selection=n.getSelection(),this.range=n.getCurrentRange(),this.action="",m=r.getFirstNode(this.container),T=this.container.lastChild,l=r.getCurrentBoundary(this.selection),l=r.getSafeBoundary(this.selection,l,t,m,T),u=0;u<s.length;u++)g=s[u],g&&(g.event===o.type||"both"===g.event)&&(i[t]&&g.action&&g.action.indexOf(i[t].action)!==-1||g.action===!1)&&g.fn.call(g.context,o,t)===!1&&(E=!1);if(E){for(i[t]&&c[i[t].fn]&&(i[t].event===o.type||"both"===i[t].event)&&(this.action=i[t].action,c[i[t].fn](l)),!i[t]&&"keydown"===o.type&&l&&c.adjust(l,!1),u=0;u<a.length;u++)d=a[u],d&&d.event===o.type&&(i[t]&&d.action===i[t].action||d.action===!1)&&d.fn.call(d.context,o,t);m=T=null}}function u(e,t){this.container=e,t&&n.intersectsNode(e)===!1&&r.setAtEditorEnd(e)}function d(e,t){if(e){if(e.zws&&0===e.candidate.length&&("left"===this.action||"right"===this.action||"click"===this.action))return void(t&&this.event.preventDefault());if(!this.selection.isCollapsed&&"mouseup"===this.event.type&&this.previousSelection&&this.previousSelection.anchorNode===this.selection.anchorNode&&this.previousSelection.anchorOffset===this.selection.anchorOffset&&this.previousSelection.focusOffset===this.selection.focusOffset)return void(this.previousSelection={});if(!t&&this.selection.isCollapsed===!1){if(this.event.ctrlKey||this.event.shiftKey||this.event.metaKey||"click"===this.action)return;return void(e&&"ltr"===e.direction?n.deleteContents(e.start,e.startPos,e.end,e.endPos):e&&"rtl"===e.direction?n.deleteContents(e.end,e.endPos,e.start,e.startPos):n.deleteContents(this.range.startContainer,this.range.startOffset,this.range.endContainer,this.range.endOffset))}r.adjustCursor(this.selection,e),t&&this.event.preventDefault(),this.selection&&this.selection.anchorNode&&(this.previousSelection.anchorNode=this.selection.anchorNode,this.previousSelection.anchorOffset=this.selection.anchorOffset,this.previousSelection.focusOffset=this.selection.focusOffset)}}function g(e){var t,r=!1;e&&!this.selection.isCollapsed&&("ltr"===e.direction?n.deleteContents(e.start,e.startPos,e.end,e.endPos):n.deleteContents(e.end,e.endPos,e.start,e.startPos),this.range=n.getCurrentRange());try{r=document.execCommand("insertBrOnReturn",!1,!0)}catch(i){r=!1}r||(this.event.preventDefault(),this.range.deleteContents(),t=document.createElement("br"),this.range.insertNode(t),this.container.scrollTop=this.container.scrollTop+18,n.toElmentAfter(t),t=null)}function E(){}function m(e){var t,i;if(e){if(i=this.container.innerText||this.container.textContent,2===i.length)return void this.event.preventDefault();if("last"!==e.zwsType||e.start!==e.end||e.startPos!==e.endPos){if(e.zws&&"first"===e.zwsType&&0===e.candidate.length)return void this.event.preventDefault();"ltr"===e.direction?(t=r.getNode(e.start,"prev",e.start.length-e.startPos),n.deleteContents(e.start,e.startPos,e.end,e.endPos)):(t=r.getNode(e.end,"next",e.end.length-e.endPos),n.deleteContents(e.end,e.endPos,e.start,e.startPos)),t.parent&&(t.pos="rtl"===e.direction?t.node.childNodes.length:0),n.toElementByType(t.node,t.type,t.pos),this.event.preventDefault(),t=null}}}function T(e){var t,i;if(e){if(i=this.container.innerText||this.container.textContent,2===i.length)return void this.event.preventDefault();if("first"!==e.zwsType||e.start!==e.end||e.startPos!==e.endPos){if(e.zws&&"last"===e.zwsType&&0===e.candidate.length)return void this.event.preventDefault();this.selection.isCollapsed||"ltr"===e.direction?(t=r.getNode(e.start,"next",e.start.length-e.startPos),n.deleteContents(e.start,e.startPos,e.end,e.endPos)):(t=r.getNode(e.end,"prev",e.end.length-e.endPos),n.deleteContents(e.end,e.endPos,e.start,e.startPos)),t.parent&&(t.pos=this.selection.isCollapsed||"ltr"===e.direction?t.node.childNodes.length:0),n.toElementByType(t.node,t.type,t.pos),this.event.preventDefault(),t=null}}}function f(){var e,t,n="";n=r.findCurrentWord(null,this.container),n&&(n=n.replace(/\u200B|\n/g,"")),a[n]&&(e="ms"===s&&r.isEditorTag(this.range.endContainer)&&3===this.range.endContainer.childNodes[this.range.endOffset].nodeType&&this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE,e&&(t=this.range.endContainer.childNodes[this.range.endOffset-1],this.range.setStart(t,t.length),this.range.setEnd(t,t.length),t=null),this.range.setStart(this.range.startContainer,this.range.endOffset-n.length),this.range.deleteContents(),this.addEmoticon(n,!0),this.event.preventDefault())}function p(e,t){var i,a,s,c,l;this.range=n.getCurrentRange(),a=r.parseText(e),t&&""===a.replace(o.PATTERN.DATA_BLOCK,"")&&(a+=String.fromCharCode(o.CHAR.SPACE)),r.removeClass(this.container),n.insertHtml(a),c=this.container.querySelectorAll(".caret"),c=Array.prototype.slice.call(c),this.selection&&(s=this.selection.focusNode),s&&s.nextSibling&&3===s.nextSibling.nodeType&&1===s.nextSibling.length&&s.nextSibling.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&s.nextSibling.parentNode.removeChild(s.nextSibling),s&&3===s.nodeType&&s.nodeValue.charCodeAt(s.nodeValue.length-1)===o.CHAR.LINE_FEED&&(s.nodeValue=s.nodeValue.replace(/\u200B|\n/g,"")),!s&&c.length>0&&(l=c[c.length-1].nextSibling.nextSibling,l&&3===l.nodeType&&1===l.length&&l.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&l.parentNode.removeChild(l),l=null),c.length>0?(s=c[c.length-1],s.nextSibling&&3===s.nextSibling.nodeType?n.toElementByType(s.nextSibling,"pos",1):n.toElmentAfter(s)):s?(i=r.getNode(s,"next",0),n.toElementByType(i.node,i.type,i.pos)):r.setAtEditorEnd(this.container),this.container.focus(),i=c=s=null}function _(e,t){var i,a,c,l,u,d,g,E,m,T={};E="@"+t,3!==this.range.startContainer.nodeType&&(this.range=n.getCurrentRange()),u=this.range.collapsed?this.range.endOffset:this.range.startOffset,m="ms"===s&&r.isEditorTag(this.range.endContainer)&&3===this.range.endContainer.childNodes[this.range.endOffset].nodeType&&this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE,m&&(u=this.range.endContainer.childNodes[this.range.endOffset-1].nodeValue.length,g=this.range.endContainer.childNodes[this.range.endOffset-1],this.range.setStart(g,0),this.range.setEnd(g,0),g=null),u-E.length<0||(this.range.setStart(this.range.startContainer,u-E.length),this.range.setEnd(this.range.startContainer,u),this.range.deleteContents(),T.className="tag",T.title=e.getName().trim(),T.dataLink=e.getUtId(),T.text=e.getName().trim(),r.removeClass(this.container),c=r.getBlockHTML(T),n.insertHtml(c),d=this.container.querySelectorAll(".caret"),d=Array.prototype.slice.call(d),l=this.selection.focusNode!==this.container&&this.selection.focusNode.nextSibling&&this.selection.focusNode.nextSibling!==this.container.lastChild?this.selection.focusNode.nextSibling:this.selection.focusNode,a=r.examineNode(l,"focus",this.selection),a.node&&"parent"===a.position&&(l=a.node),l&&l.nextSibling&&3===l.nextSibling.nodeType&&1===l.nextSibling.length&&l.nextSibling.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&l.nextSibling.parentNode.removeChild(l.nextSibling),l&&3===l.nodeType&&l.nodeValue.charCodeAt(l.nodeValue.length-1)===o.CHAR.LINE_FEED&&(l.nodeValue=l.nodeValue.replace(/\u200B|\n/g,"")),!l&&d.length>0&&(g=d[d.length-1].nextSibling,g&&3===g.nodeType&&1===g.length&&g.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&g.parentNode.removeChild(g),g=null),d.length>0?n.toElmentAfter(d[d.length-1]):l?(i=r.getNode(l,"next",0),n.toElementByType(i.node,i.type,i.pos)):r.setAtEditorEnd(this.container),this.container.focus(),i=d=l=null)}function I(e){var t,i,o=document.createElement("div");if(e&&r.adjustCursor(this.selection,e),this.event.clipboardData)t=this.event.clipboardData.getData("text/plain");else if(window.clipboardData)try{t=window.clipboardData.getData("Text")}catch(a){throw new Error("clipboard copy error")}o.innerHTML=t,t=o.innerText||o.textContent||"",t=t.replace(/\n/g,"<br />"),t=t.replace(/\s\s+/g," "),t=t.replace(/\u200B/g,""),i=r.parseText(t),n.insertHtml(i),this.container.focus(),this.container.scrollTop=this.container.scrollHeight}return c}angular.module("ringid.ui_editor").factory("helpers",Helpers),Helpers.$inject=["$sniffer","StickerEmoticonService","StickerEmoticonFactory","cursor","keys","EDITOR_DATA"];function Helpers(e,t,n,r,i,o){var a=n.getEmoticonPattern(),s=t.getEmoticonMap(),c=e.vendorPrefix.toLowerCase(),l={examineNode:u,getCurrentBoundary:d,adjustCursor:g,getSafeBoundary:E,parseText:m,removeClass:T,adjustMarkup:f,getBlockHTML:p,getPrevNode:_,getNextNode:I,getNode:h,isEditorTag:A,setAtEditorEnd:C,isEmpty:S,getFirstNode:v,findCurrentWord:M,findPos:D};function u(e,t,n){var r,i=Object.create(null),o="focus"===t?n.focusOffset:n.anchorOffset;return i.position=!1,i.length=0,i.node=null,e?(1===e.nodeType&&"true"===e.getAttribute("data-block")&&(i.node=e,i.position="self"),r=l.getNextNode(e,e.length),r&&1===r.nodeType&&"true"===r.getAttribute("data-block")&&(1===e.nodeType||3===e.nodeType&&o===e.length)&&(i.node=r,i.position="next"),r=l.getPrevNode(e,e.length),r&&1===r.nodeType&&"true"===r.getAttribute("data-block")&&(1===e.nodeType||3===e.nodeType&&0===o)&&(i.node=r,i.position="prev"),r="b"===e.parentNode.nodeName.toLowerCase()?e.parentNode.parentNode:e.parentNode,r&&1===r.nodeType&&"true"===r.getAttribute("data-block")&&(i.node=r,i.position="parent"),i.node&&(i.length=3===i.node.nodeType?i.node.nodeValue.length:0),r=null,i):i}function d(e){var t=r.getDirection(),n=Object.create(null);return e?(n.start=e.anchorNode,n.startPos=e.anchorOffset,n.end=e.focusNode,n.endPos=e.focusOffset,n.direction=t,n):n}function g(e,t){e.isCollapsed?r.toElementByType(t.end,t.type,t.endPos):!e.isCollapsed&&t.isAnchorMoved?r.extendSelection(t,!1):r.extendSelection(t)}function E(e,t,n,r,a){var s,c,u,d,g,E=!1,m=null,T=null,f=[];if(g={enter:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},backspace:{focus:"prev",anchor:"next",dir:"rtl",reverse:!0,both:!0},"delete":{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!0},space:{focus:"next",anchor:"next",dir:"ltr",reverse:!1,both:!1},escape:{},left:{focus:"prev",anchor:"next",dir:"rtl",reverse:!1,both:!1},right:{focus:"next",anchor:"prev",dir:"ltr",reverse:!1,both:!1},up:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},down:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},click:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},paste:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},any:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1}},s=i[n]?i[n].action:"any",""===s||!g[s]||!g[s].hasOwnProperty("focus"))return!1;for(t.isAnchorMoved=!1,t.candidate=[],e.isCollapsed&&!g[s].both||f.push({node:e.anchorNode,type:"anchor",offset:e.anchorOffset}),f.push({node:e.focusNode,type:"focus",offset:e.focusOffset});u=f.pop();)u.node&&(c=g[s][u.type],g[s].reverse&&t.direction!==g[s].dir&&(c="next"===c?"prev":"next"),m=l.examineNode(u.node,u.type,e),"any"===s&&e.isCollapsed&&(m.length===e.focusOffset||"next"===m.position&&e.focusNode.length===e.focusOffset)&&(m.node=null),"backspace"!==s&&"click"!==s||"next"!==m.position||!e.isCollapsed||3!==e.focusNode.nodeType||e.focusNode.length!==e.focusOffset||(m.node=null),m.node&&(T=l.getNode(m.node,c,0),"focus"===u.type?(t.end=T.node,t.endPos=T.pos):(t.start=T.node,t.startPos=T.pos,t.isAnchorMoved=!0),t.type=T.type,E=!0,t.candidate.push(m.node)));return t.zws=!1,t.zwsType="","ltr"===t.direction&&t.start===r&&(0===t.startPos?(e.isCollapsed?(t.endPos=t.startPos=1,t.type=t.type?t.type:"pos"):(t.startPos=1,t.type=t.type?t.type:"pos"),E=!0):1===t.startPos&&"any"!==s&&3===t.start.nodeType&&t.start.nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE&&e.isCollapsed&&(t.zws=!0,t.zwsType="first",E=!0)),"backspace"===s&&e.isCollapsed&&0===t.startPos&&l.getPrevNode(t.start,t.start.length)===r&&(t.zws=!0,t.zwsType="first",E=!0),"rtl"===t.direction&&t.end===r&&0===t.endPos&&(t.endPos=1,t.type=t.type?t.type:"pos",E=!0),l.isEditorTag(t.end)&&0===t.endPos&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",E=!0),l.isEditorTag(t.end)&&t.endPos===t.end.childNodes.length&&t.end.lastChild&&3===t.end.lastChild.nodeType&&t.end.lastChild.nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",E=!0),"ltr"===t.direction&&a&&t.end===a&&(d=t.end.length,d>0&&t.endPos===d?(e.isCollapsed?(t.endPos=t.startPos=d-1,t.type=t.type?t.type:"pos"):(t.endPos=d-1,t.type=t.type?t.type:"pos"),E=!0):t.endPos===d-1&&"any"!==s&&3===t.end.nodeType&&t.end.nodeValue.charCodeAt(d-1)===o.CHAR.ZERO_WIDTH_SPACE&&e.isCollapsed&&(t.zws=!0,t.zwsType="last",E=!0)),"delete"===s&&e.isCollapsed&&t.end.length===t.endPos&&l.getNextNode(t.end,t.endPos)===a&&(t.zws=!0,t.zwsType="last",E=!0),d=t.start.length,"rtl"===t.direction&&t.start===a&&t.startPos===d&&(t.startPos=d-1,t.type=t.type?t.type:"pos",E=!0),m=T=f=u=null,!!E&&t}function m(e){var t={},n=e;return n=n.replace(a,function(e){return t.className="em_list "+s[e].replace(/\.[A-Za-z]{3}/,""),t.title=e,t.dataLink=e,t.text="<b>"+e.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</b>&nbsp;",
l.getBlockHTML(t)})}function T(e){var t,n=e.querySelectorAll(".caret");if(e){for(t=0;t<n.length;t++)n[t].className=n[t].className.replace("caret","").trim();n=null}}function f(e){var t,n=e.querySelectorAll(".em_list");if(e){for(t=0;t<n.length;t++)n[t].innerHTML="<b>"+n[t].getAttribute("data-link")+"</b>&nbsp;";n=null}}function p(e){var t='<a href="#" onclick="return false" class="'+e.className+' caret" title="'+e.title+'" data-link="'+e.dataLink+'" spellcheck="false" data-block="true">'+e.text+"</a>";return t}function _(e,t){var n,r=t;if(r="undefined"!=typeof r&&null!==r?r:0,!e)return e;if(e.length>r)return e;for(n=e.previousSibling;n&&!(n.length>0||1===n.nodeType);)n=n.previousSibling;return n}function I(e,t){var n,r=t;if(r="undefined"!=typeof r&&null!==r?r:0,!e)return e;if(e.length>r)return e;for(n=e.nextSibling;n&&!(n.length>0||1===n.nodeType);)n=n.nextSibling;return n}function h(e,t,n){var r=Object.create(null),i=!1,o=l.isEditorTag(e),a=n,s=t;return e?(r.node=null,s="undefined"!=typeof s&&null!==s?s:"prev",a="undefined"!=typeof a&&null!==a?a:0,e.length>a&&(i=!0),o||(r.node="prev"===s?l.getPrevNode(e,a):l.getNextNode(e,a)),r.node&&("prev"===s&&(r.pos=i?r.node.length-a:r.node.length),"next"===s&&(r.pos=i?r.node.length-a:0),r.type="pos"),r.parent=!1,r.node||(r.node=o?e:e.parentNode,r.pos="next"===s?r.node.childNodes.length:0,r.type="pos",r.parent=!0),r):e}function A(e){return e&&1===e.nodeType&&"true"===e.getAttribute("data-editor")||!1}function C(e){l.isEditorTag(e)&&e.lastChild&&3===e.lastChild.nodeType&&e.lastChild.nodeValue.charCodeAt(e.lastChild.nodeValue.length-1)===o.CHAR.ZERO_WIDTH_SPACE&&(e.focus(),r.toPosition(e.lastChild,e.lastChild.nodeValue.length-1)),r.toElmentEnd(e)}function S(e){var t=e.firstChild;if(0===e.childNodes.length)return!1;for(;t&&!(1===t.nodeType||t.length>0);)t=t.nextSibling;return t}function v(e,t){var n=e.firstChild,r=t;if(0===e.childNodes.length)return!1;for(r="undefined"!=typeof r&&null!==r&&r;n&&(!(1===n.nodeType||n.length>0)||r&&3===n.nodeType&&!(n.length>1)&&n.nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE);)n=n.nextSibling;return n}function M(e,t){var n,i,a=r.getSelection(),s="",u=-1,d="",g=!1,E=l.getFirstNode(t,!0);if(i="ms"===c&&l.isEditorTag(a.focusNode)&&3===a.focusNode.childNodes[a.focusOffset].nodeType&&a.focusNode.childNodes[a.focusOffset].nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE,a&&(3===a.focusNode.nodeType||i)&&(s=i?a.focusNode.childNodes[a.focusOffset-1].nodeValue:a.focusNode.nodeValue.substr(0,a.anchorOffset),s=s.replace(/\s+$/,""),u=e?s.lastIndexOf(e):1,u>=0))for(n=s.length-1;n>=0;n--){if(/\s/.test(s[n])){g=!0;break}if(s[n]===e){d=s[n]+d;break}d=s[n]+d}return null===e?(g||i||E===a.anchorNode||(d=""),E=null,d):(d[0]!==e&&(d=""),d=d.length>1&&(E===a.anchorNode&&a.anchorNode.nodeValue[0]===e||i||t.firstChild===a.anchorNode&&a.anchorNode.nodeValue[1]===e||a.anchorNode.previousSibling&&3===a.anchorNode.previousSibling.nodeType&&a.anchorNode.previousSibling.nodeValue.charCodeAt(a.anchorNode.previousSibling.length-1)===o.CHAR.SPACE||s.charCodeAt(u-1)===o.CHAR.SPACE||s.charCodeAt(u-1)===o.CHAR.NON_BREAKING_SPACE)?d.replace(e,""):"",E=null,d)}function D(e){var t=0,n=0,r=e;if(r.offsetParent)do t+=r.offsetLeft,n+=r.offsetTop;while(r=r.offsetParent);return{x:t,y:n}}return l}angular.module("ringid.ui_editor").provider("$editor",EditorProvider);function EditorProvider(){this.$get=["$compile","$rootScope","keys","helpers","cursor","modifiers","EDITOR_DATA",_get]}function _get(e,t,n,r,i,o,a){var s={};return s.create=function(e){var s=new Editor(e,t,n,r,i,o,a);return s},s}function Editor(e,t,n,r,i,o,a){var s=this;this.content="",this.tagOpen=!1,this.fragment=null,this.dom={},this.processors=[],this.callback=[],this.lastDisable=0,this.maxHeight=0,this.newLine="undefined"==typeof e.newLine||e.newLine,this.maxHeight=e.maxHeight,this.placeholder=e.placeholder||"",this.isDisabled="undefined"!=typeof e.isDisabled&&e.isDisabled,this.emotion=e.emotion?e.emotion:null,this.fileUploader=e.fileUploader?e.fileUploader:null,this.fragment=document.createDocumentFragment(),this.dom.placeholder=document.createElement("span"),this.dom.placeholder.setAttribute("data-placeholder",this.placeholder),this.fragment.appendChild(this.dom.placeholder),this.dom.editor=document.createElement("div"),this.dom.editor.setAttribute("contenteditable","true"),this.dom.editor.setAttribute("spellcheck","true"),this.dom.editor.setAttribute("data-editor","true"),this.dom.editor.setAttribute("class","editor"),this.fragment.appendChild(this.dom.editor),this.emotion&&this.fragment.appendChild(this.emotion),s.fileUploader&&s.fragment.appendChild(s.fileUploader),this.maxHeight>0&&(this.dom.editor.style.maxHeight=this.maxHeight+"px"),this.updateContent=function(){var e,n;e=this.dom.editor.innerHTML.replace(/<br>/g,"\n"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&amp;/g,"&"),e=e.replace(/&nbsp;/g," "),e=e.replace(/\u200B/g,""),e=e.replace(/\n{3,}/g,"\n\n"),e=e.replace(a.PATTERN.DATA_BLOCK,function(e,t){return isNaN(t)?t:"##"+t+"##"}),this.content=e.trim(),n=this.dom.editor.innerHTML.replace(/<br>/g,"\n"),n=n.replace(/&nbsp;/g," "),n=n.replace(/\u200B/g,""),n=n.replace(/\n{3,}/g,"\n\n"),this.dom.placeholder.innerHTML=n,this.onUpdate&&"function"==typeof this.onUpdate&&this.onUpdate.call(null),""!==this.content?t.unloadWarn=!0:t.unloadWarn=!1},this.addEmoticon=function(e){o.setContainer(this.dom.editor,!0),o.addEmoticon(e,!0),this.updateContent()},this.addTag=function(e,t){o.setContainer(this.dom.editor,!0),o.addTag(e,t),this.updateContent()},this.addDelimiter=function(){var e,t,n;e=this.dom.editor.innerText||this.dom.editor.textContent,n=r.getFirstNode(this.dom.editor),e.charCodeAt(0)!==a.CHAR.ZERO_WIDTH_SPACE&&(t=document.createTextNode("â€‹"),n?this.dom.editor.insertBefore(t,n):this.dom.editor.appendChild(t)),e=this.dom.editor.innerText||this.dom.editor.textContent,1!==e.length&&e.charCodeAt(e.length-1)===a.CHAR.ZERO_WIDTH_SPACE||(t=document.createTextNode("â€‹"),this.dom.editor.appendChild(t))},this.getPosition=function(){var e=0,t=0,n=this.dom.editor.getBoundingClientRect(),r=i.getCurrentRange().getClientRects();return e=n.left,t=n.top,r.length>0&&(r=r[0],e=r.left-e,t=r.top-t),{x:e,y:t+12}},this.findWord=function(e){return r.findCurrentWord(e,this.dom.editor)},this.setFocus=function(){r.setAtEditorEnd(this.dom.editor)},this.clear=function(){this.dom.editor.innerHTML="",this.dom.placeholder.innerHTML="",this.updateContent(),this.addDelimiter(),t.unloadWarn=!1},this.setPlaceholderContent=function(e,t){e.ctrlKey||e.shiftKey||e.metaKey||n[t]||""!==this.dom.placeholder.innerHTML||(this.dom.placeholder.innerHTML=String.fromCharCode(t))},this.set=function(e){var t=e;t&&(t=t.replace(/\n/g,"<br />"),t=t.replace(/href="(.*?)"/g,'href="#"'),t=t.replace(/<span/g,'<a href="#" onclick="return false" data-block="true"'),t=t.replace(/<\/span>/g,"</a>"),t=t.replace(/class="tag"/g,'class="tag" onclick="return false" data-block="true"'),t=t.replace(/<a.*?class="feedanchor".*?>(.*?)<\/a>/g,"$1"),this.dom.editor.innerHTML=t,this.updateContent(),this.addDelimiter(),r.adjustMarkup(this.dom.editor))},this.initEvent=function(){this.dom.editor.addEventListener("contextmenu",l),this.dom.editor.addEventListener("mouseup",u),this.dom.editor.addEventListener("keydown",d),this.dom.editor.addEventListener("keyup",g),this.dom.editor.addEventListener("dragover",m),this.dom.editor.addEventListener("drop",T),this.dom.editor.addEventListener("paste",f),this.dom.editor.addEventListener("cut",p),this.dom.editor.addEventListener("blur",E)},this.destroy=function(){this.dom.editor.removeEventListener("contextmenu",l),this.dom.editor.removeEventListener("mouseup",u),this.dom.editor.removeEventListener("keydown",d),this.dom.editor.removeEventListener("keyup",g),this.dom.editor.removeEventListener("dragover",m),this.dom.editor.removeEventListener("drop",T),this.dom.editor.removeEventListener("paste",f),this.dom.editor.removeEventListener("cut",p),this.dom.editor.removeEventListener("blur",E),this.dom=s=null,t.unloadWarn=!1},this.addDelimiter(),this.initEvent(),this.addProcessor("keydown",!1,this.checkDisability,this),this.addProcessor("keydown","enter",this.checkNewLine,this),this.addProcessor("both","enter,up,down",this.checkTag,this),this.addCallback("keyup","delete,backspace",this.checkBR,this),this.addCallback("keyup",!1,this.addDelimiter,this),this.addCallback("keydown",!1,this.setPlaceholderContent,this),this.addCallback("keyup",!1,this.updateContent,this);function c(e){return e===a.KEY.ESCAPE||e===a.KEY.LEFT||e===a.KEY.RIGHT||e===a.KEY.UP||e===a.KEY.DOWN||e===a.KEY.ENTER}function l(e){e.stopPropagation(),s.dom.editor!==o.container&&s.setFocus()}function u(e){o.init(s.dom.editor,0,e,s.callback,s.processors),s.dom.placeholder.className="active",e.stopPropagation()}function d(e){var t=e.which||e.keyCode||e.key;c(t)||e.stopPropagation(),o.init(s.dom.editor,t,e,s.callback,s.processors)}function g(e){var t=e.which||e.keyCode||e.key;c(t)||e.stopPropagation(),o.init(s.dom.editor,t,e,s.callback,s.processors)}function E(e){e.stopPropagation(),e.preventDefault(),s.dom.placeholder.className=""}function m(e){return e.stopPropagation(),e.preventDefault(),!1}function T(e){return e.stopPropagation(),e.preventDefault(),!1}function f(e){e.stopPropagation(),e.preventDefault(),o.init(s.dom.editor,-1,e,s.callback,s.processors),s.updateContent()}function p(e){e.stopPropagation(),s.updateContent()}}Editor.prototype.addProcessor=function(e,t,n,r){this.processors.push({event:e,action:t,fn:n,context:r})},Editor.prototype.addCallback=function(e,t,n,r){this.callback.push({event:e,action:t,fn:n,context:r})},Editor.prototype.showError=function(){this.hideError(),this.dom.editor.className=this.dom.editor.className+" error"},Editor.prototype.hideError=function(){this.dom.editor.className=this.dom.editor.className.replace("error","").trim()},Editor.prototype.enable=function(){this.isDisabled=!1},Editor.prototype.disable=function(){this.isDisabled=!0},Editor.prototype.get=function(){return this.content},Editor.prototype.setNewLineMode=function(e){this.newLine=e},Editor.prototype.getNode=function(){return this.fragment},Editor.prototype.checkDisability=function(e){return!this.isDisabled||(e.preventDefault(),this.lastDisable=(new Date).getTime()/1e3,(new Date).getTime()-this.lastDisable>2e3&&(this.isDisabled=!1),!1)},Editor.prototype.checkTag=function(e){return!this.tagOpen||(e.preventDefault(),!1)},Editor.prototype.checkNewLine=function(e){return!!(this.newLine||e.shiftKey||e.ctrlKey)||(e.preventDefault(),!1)},Editor.prototype.checkBR=function(){this.dom.editor.firstElementChild&&this.dom.editor.firstElementChild===this.dom.editor.lastElementChild&&"br"===this.dom.editor.firstElementChild.nodeName.toLowerCase()&&this.dom.editor.removeChild(this.dom.editor.firstElementChild)},angular.module("ringid.ui_editor").directive("rgEditor",rgEditor),rgEditor.$inject=["$compile","$editor","SystemEvents"];function rgEditor(e,t,n){return{scope:{editorContent:"=",onEnter:"&",onEscape:"&",onEnterArg:"=",isDisabled:"=",focus:"=",editMode:"&",fileUploaderReady:"&",stickerOnChoose:"&"},restrict:"E",link:r};function r(r,i,o){var a,s,c,l;r.filterFriend="",r.editorContent="",s="true"===o.showSticker||o.showSticker===!0?"true":"false",c={newLine:!("false"===o.newLine||o.newLine===!1),placeholder:o.placeholder?o.placeholder:"",isDisabled:"true"===o.isDisabled||o.isDisabled===!0,maxHeight:o.maxHeight?parseInt(o.maxHeight,10):0},o.showEmoji&&(c.emotion=e('<a href="javascript:void(0)"><i class="img_sprite icon-emoticon feeling-ico" rg-emoticon="" clicked="insertEmoji" show-sticker="'+s+'"></i></a>')(r)[0],i.addClass("with_emo")),o.commonFileUploader&&(c.fileUploader=e('<rg-upload upload-type="'+o.commonFileUploader+'" upload-action="chooseFileForRgUpload" > </rg-upload>')(r)[0]),r.chooseFileForRgUpload=function(e){r.fileUploaderReady({fl:e}),a.setFocus()},a=t.create(c),i.append(a.getNode()),a.onUpdate=E,r.insertEmoji=function(e){e.isEmoticon()?a.addEmoticon(e.symbol(),!0):e.isSticker()&&r.stickerOnChoose({emo:e})},r.closeDropdownFriend=function(){l&&(l.remove(),l=void 0),a.tagOpen=!1},r.chooseFriend=function(e){r.filterFriend&&(a.addTag(e,r.filterFriend),r.closeDropdownFriend())};function u(t,n){var o;r.filterFriend=a.findWord("@"),32===n&&(r.filterFriend=""),""===r.filterFriend&&l&&r.closeDropdownFriend(),r.filterFriend&&!l&&(l=e('<rg-friend-dropdown template-url="templates/dropdowns/tag-editor-dropdown.html" tag-items="[]" filter-text="filterFriend" focus-filter="" on-close="closeDropdownFriend" on-select="chooseFriend"></rg-friend-dropdown>')(r),i.after(l),o=a.getPosition(),l.css({position:"absolute",left:o.x+"px",top:o.y+"px"})),l&&(a.tagOpen=!0,document.addEventListener("click",function s(e){l&&e.target!==l[0]&&r.closeDropdownFriend(),document.removeEventListener("click",s)},!1))}function d(e,t){return l&&(e.preventDefault(),l.triggerHandler(e,t)),!0}function g(e){return!(c.newLine===!1&&!e.shiftKey&&!e.ctrlKey)||(r.onEnter()(r.onEnterArg),!1)}function E(){r.editorContent=a.get(),r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}o.onRingbox&&a.addCallback("keydown",!1,function(){r.$emit(n.RINGBOX.UPDATE)}),o.tagFriend&&(a.addCallback("keyup",!1,u,null),a.addCallback("keyup","escape",r.closeDropdownFriend,r),a.addProcessor("keydown","up,down,enter",d,null)),o.onEscape&&a.addCallback("keyup","escape",r.onEscape(),r),o.onEnter&&a.addProcessor("keyup","enter",g),r.$on("cleareditor",function(){a.clear()}),r.$on("seteditor",function(e,t){var n=t||r.editorContent;a.set(n)}),r.$watch("isDisabled",function(e){e?(a.disable(),a.clear()):a.enable()}),o.focus&&r.$watch("focus",function(e){e&&(setTimeout(function(){a.setFocus()},0),o.editMode&&a.set(r.editMode()().toString()))}),r.$on("$destroy",function(){a.destroy(),a=c=l=null})}}!function(e,t){"use strict";e.module("ringid.ui_scrollbar",[])}(angular,window),angular.module("ringid.ui_scrollbar").provider("$scrollbar",ScrollbarProvider);function ScrollbarProvider(){this.findPos=function(e){var t=0,n=0,r=e;if(r.offsetParent)do t+=r.offsetLeft,n+=r.offsetTop;while(r=r.offsetParent);return{x:t,y:n}},this.findPosType=function(e){var t,n=0,r=e;if(r=r.offsetParent)do if(t=getComputedStyle(r,null),"fixed"===t.getPropertyValue("position")){n=1;break}while(r=r.offsetParent);return n},this.tabindex=100,this.$get=["$$q",function(e){var t=this,n={};function r(n,r){var i,o,a,s,c,l,u,d,g,E,m=this,T=!1,f="none",p=0,_=0,I=null,h="undefined"!=typeof InstallTrigger?"DOMMouseScroll":"mousewheel",A="ontouchstart"in window||navigator.msMaxTouchPoints,C=-1,S=!1,v=500;u={scrollbarWidth:8,scrollbarAlways:!1,dragSpeedModifier:5,minThumbHeight:10,clickSpeedModifier:40,keyboardSpeedModifier:20,keyboardEvent:!1,onBottomReached:!1,atBottom:!1,preserveBottom:!1,onScroll:null,propagate:!1},d=angular.extend({},u,r),this.isFreezed=!1,this.freezeInfo={height:"",position:"",scrollHeight:0},this.hasScroll=!1,this.atBottom=d.atBottom,this.scrollHeight=0,this.offsetHeight=0,this.visibleHeight=0,this.cache=[],i=Object.create(null),i.element=n,i.scrollbarContainer=i.element.parentNode,i.wrapper=document.createElement("div"),i.scrollbar=document.createElement("div"),i.scrollbarThumb=document.createElement("div"),i.scrollbar.className="scrollbar",i.scrollbarThumb.className="thumb",i.wrapper.className="ringscroll",i.element.style.overflow="hidden",i.wrapper.setAttribute("style","position:relative;width:auto;overflow:hidden;height:100%;"),i.scrollbar.setAttribute("style","height:100%;right:1px;opacity:0;top:0px;position:absolute;z-index:1;width:"+d.scrollbarWidth+"px"),i.scrollbarThumb.setAttribute("style","right:1px;top:0px;opacity:0;position:absolute;z-index:1;width:"+d.scrollbarWidth+"px"),i.scrollbarContainer.insertBefore(i.wrapper,i.element),i.wrapper.appendChild(i.element),i.wrapper.appendChild(i.scrollbar),i.wrapper.appendChild(i.scrollbarThumb),i.scrollbarContainer.addEventListener("mouseenter",k,!1),i.scrollbarContainer.addEventListener("mouseleave",F,!1),i.scrollbarThumb.addEventListener("mousedown",y,!1),i.scrollbar.addEventListener("click",N,!1),i.element.addEventListener(h,P,!1),d.keyboardEvent&&(i.element.addEventListener("keydown",R),i.element.setAttribute("tabindex",t.tabindex++)),A&&i.element.addEventListener("touchmove",L),this.scroll=function(e,t,n){var r,o;fastdom.read(function(){i.element&&(m.hiddenHeight=m.scrollHeight-m.offsetHeight,m.visibleHeight=m.offsetHeight-_,r=e/m.visibleHeight,o=Math.min(Math.max(e,0),m.visibleHeight),t?(g=0,a=i.element.scrollTop,s=m.hiddenHeight*r-a,c=n,l=o-c,M()):fastdom.write(function(){i.element.scrollTop=m.hiddenHeight*r,i.scrollbarThumb.style.top=o+"px",d.onScroll&&d.onScroll.call(null)}),m.atBottom=!1,o===m.visibleHeight&&(m.atBottom=!0,d.onBottomReached&&angular.isFunction(d.onBottomReached)&&d.onBottomReached()))})},this.reCalculate=function(t){var n,r,o=!!t&&e.defer();return fastdom.read(function(){i&&(m.isFreezed&&(i.wrapper.style.height="100%",i.element.style.position=m.freezeInfo.position,i.element.style.height=m.freezeInfo.height,i.element.style.bottom="initial"),m.scrollHeight=i.element.scrollHeight,m.offsetHeight=i.element.offsetHeight,m.hiddenHeight=m.scrollHeight-m.offsetHeight,_=Math.max(m.offsetHeight/m.scrollHeight*m.offsetHeight,d.minThumbHeight),(isNaN(_)||"Infinity"===_)&&(_=0),m.visibleHeight=m.offsetHeight-_,m.isFreezed&&(i.element.scrollTop=m.scrollHeight-m.freezeInfo.scrollHeight),n=m.visibleHeight/m.hiddenHeight,r=i.element.scrollTop*n,f=_>=m.offsetHeight?"none":"block",m.hasScroll=_<m.offsetHeight,m.atBottom&&d.preserveBottom&&(i.element.scrollTop=m.scrollHeight,r=m.visibleHeight),fastdom.write(function(){i&&(i.scrollbar.style.display=f,i.scrollbarThumb.style.height=_+"px",i.scrollbarThumb.style.display=f,i.scrollbarThumb.style.top=r+"px"),o&&o.resolve(),m.isFreezed=!1}))}),!!o&&o.promise},this.destroy=function(){i.scrollbarContainer.removeEventListener("mouseenter",k),i.scrollbarContainer.removeEventListener("mouseleave",F),i.scrollbarThumb.removeEventListener("mousedown",y),i.scrollbar.removeEventListener("click",N),i.element.removeEventListener(h,P),i.element.removeEventListener("keydown",R),i.element.removeEventListener("touchmove",L),m=i=null},this.getDOM=function(){return i},this.setThumbTimer=function(){O(),I&&clearTimeout(I),I=setTimeout(D,1e3)};function M(){var e,t;g+=30,e=Math.easeIn(g,a,s,v),t=Math.easeIn(g,c,l,v),i.element.scrollTop=e,i.scrollbarThumb.style.top=t+"px",g<v?requestAnimationFrame(M):d.onScroll&&d.onScroll.call(null)}function D(){d.scrollbarAlways||m.isFreezed||(S||(i.scrollbar.style.opacity=0,i.scrollbarThumb.style.opacity=0,T=!1),I=null)}function O(){m.isFreezed||m.reCalculate(),i.scrollbar.style.opacity=1,i.scrollbarThumb.style.opacity=1,T=!0,d.keyboardEvent&&i.element.focus()}function R(e){var t,n,r,o=e.which||e.keyCode||e.key;e.preventDefault(),e.stopPropagation(),38!==o&&40!==o||(t=parseFloat(i.scrollbarThumb.style.top),n=d.keyboardSpeedModifier,38===o&&(n*=-1),r=t+n,m.setThumbTimer(),m.scroll(r))}function N(e){var n,r,o,a=t.findPos(i.scrollbar),s=parseFloat(i.scrollbarThumb.style.top);e.preventDefault(),C===-1&&(C=t.findPosType(i.element)),n=(C?e.clientY:e.pageY)-a.y,r=d.clickSpeedModifier+(parseInt(m.scrollHeight/m.offsetHeight/20,10)*d.clickSpeedModifier,10),n<s&&(r*=-1),o=s+r,m.scroll(o,!0,s)}function P(e){var t,n,r,o=parseFloat(i.scrollbarThumb.style.top);"none"!==f&&(m.atBottom&&d.propagate||e.preventDefault(),T||O(),t=e.wheelDelta?-.025*e.wheelDelta:3*e.detail,n=Math.max(parseInt(2*m.offsetHeight/m.scrollHeight*d.dragSpeedModifier,10),.5),r=o+t*n,m.scroll(r))}function y(e){e.preventDefault(),e.stopPropagation(),T||O(),S=!0,E=e.pageY,o=parseFloat(i.scrollbarThumb.style.top),document.addEventListener("mousemove",b,!1),document.addEventListener("mouseup",U,!1)}function b(e){var t=o+e.pageY-E;m.scroll(t)}function U(e){e.stopPropagation(),S=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",U)}function L(e){var t,n,r=2,o=e.touches[0].clientY,a=parseFloat(i.scrollbarThumb.style.top);e.preventDefault(),n=Math.max(parseInt(2*m.offsetHeight/m.scrollHeight*d.dragSpeedModifier,10),1),t=o<p?a+r*n:a-r*n,m.scroll(t),p=o}function F(){D()}function k(){O()}this.reCalculate()}return r.prototype.scrollBySelector=function(e,t,n,r){var i,o,a,s,c=0,l=null,u=0,d=0,g=0,E=0,m=this.getDOM();i="undefined"!=typeof r&&null!==r?parseInt(r,10):0,l=m.element.querySelector(e),l&&(a=l.offsetTop,o=l.offsetHeight,d=parseFloat(m.scrollbarThumb.style.top),n&&(g=this.visibleHeight),t&&(c=n?-1*o:o),d+m.element.scrollTop<a&&(g=n?0:this.offsetHeight-o,t&&(c=n?o:-1*o)),s=a+c+i-g,E=s/this.hiddenHeight,this.setThumbTimer(),u=E*this.visibleHeight,this.scroll(u,!0,d))},r.prototype.freeze=function(){var e,t,n=this.getDOM();this.hasScroll&&(t=this.scrollHeight-(n.element.scrollTop+this.offsetHeight),""===this.freezeInfo.height&&(e=getComputedStyle(n.element,null),this.freezeInfo.height=e.getPropertyValue("height"),this.freezeInfo.position=e.getPropertyValue("position")),this.freezeInfo.scrollHeight=this.scrollHeight,n.wrapper.style.height=this.offsetHeight+"px",n.element.style.position="absolute",n.element.style.bottom="-"+t+"px",n.element.style.height="auto",this.isFreezed=!0)},r.prototype.scrollByPos=function(e,t){var n,r,i,o=this.getDOM();i="undefined"!=typeof t&&null!==t&&t,i&&(r=parseFloat(o.scrollbarThumb.style.top)),n=parseInt(e,10)*this.visibleHeight/100,this.scroll(n,i,r)},r.prototype.scrollTop=function(e){this.scrollByPos(0,e)},r.prototype.scrollBottom=function(e){this.scrollByPos(100,e)},r.prototype.inViewport=function(e,t){var n,r,i,o,a,s=this.getDOM(),c=[];if(n=this.cache[e]?this.cache[e]:s.element.querySelectorAll(e),0===n.length)return c;for(o=s.element.scrollTop,i=0;i<n.length;i++)r=n[i],a=r.offsetTop,o+this.offsetHeight>=a&&a>o&&c.push(r.getAttribute(t));return this.cache[e]=n,c},n.create=function(e,t){var n=new r(e,t);return n},n}]}angular.module("ringid.ui_scrollbar").factory("rgScrollbarService",rgScrollbarService);function rgScrollbarService(){return{scrollTop:function(e){e.$broadcast("scrollTop")},scrollTo:function(e,t,n,r,i){e.$broadcast("scrollTo",t,n,r,i)},recalculate:function(e){e.$broadcast("recalculate")},hasScroll:function(e){e.$broadcast("hasScroll",e)},freeze:function(e){e.$broadcast("freeze",e)}}}angular.module("ringid.ui_scrollbar").directive("rgScrollbar",rgScrollbar),rgScrollbar.$inject=["$scrollbar"];function rgScrollbar(e){function t(t,n,r){var i,o={};"true"!==r.disabled&&r.disabled!==!0&&(r.thumbHeight&&parseInt(r.thumbHeight,10)>0&&(o.minThumbHeight=parseInt(r.thumbHeight,10)),r.keyboard&&(o.keyboardEvent=!0),r.propagate&&(o.propagate=!0),t.bottomReached&&(o.onBottomReached=t.bottomReached),i=e.create(n[0],o),t.$on("scrollTop",function(e){e.stopPropagation&&e.stopPropagation(),setTimeout(function(){i.scroll(0)},100)}),t.$on("scrollTo",function(e,t,n,r,o){e.stopPropagation&&e.stopPropagation(),"string"==typeof t?i.scrollBySelector(t,n,r,o):i.scrollByPos(t)}),t.$on("recalculate",function(e){e.stopPropagation&&e.stopPropagation(),i.reCalculate()}),t.$on("hasScroll",function(e,t){e.stopPropagation&&e.stopPropagation(),t.scroll=i.hasScroll}),t.$on("freeze",function(e){e.stopPropagation&&e.stopPropagation(),i.freeze()}),t.$on("$destroy",function(){i.destroy(),i=null}))}return{restrict:"A",scope:{bottomReached:"&"},link:t}}!function(e,t){"use strict";e.module("ringid.ui_ringbox",["ringid.ui_player"])}(angular,window),angular.module("ringid.ui_ringbox").provider("$ringbox",ringboxProvider);function ringboxProvider(){var e={boxes:[],template:'<div class="ringbox"><div class="ringbox-overlay"></div><div style="z-index:4; display:block;" class="img_sprite pop-clo w-h-16px cur-p ringbox-close"></div><div class="ringbox-outerContainer"><div class="ringbox-content ringbox-invisible"><div class="ringbox-inner"></div><div class="ringbox-loader"><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div></div></div></div></div>',init:function(){var e=angular.element(this.template);return e},adjustBodyClass:function(e){var t,n=!1,r=document.body;for(t=0;t<this.boxes.length;t++)this.boxes[t].isMinimized||(n=!0);n||e?angular.element(r).addClass("ringbox-opened"):angular.element(r).removeClass("ringbox-opened")},adjustBoxes:function(){var e,t=0;for(e=0;e<this.boxes.length;e++)this.boxes[e].dom.removeClass("rl_"+e),this.boxes[e].dom.removeClass("cl_"+e);for(e=0;e<this.boxes.length;e++)this.boxes[e].dom.addClass("rl_"+e);for(e=0;e<this.boxes.length;e++)!this.boxes[e].isMinimized&&this.boxes[e].withCloseBtn&&this.boxes[e].dom.addClass("cl_"+t++)},getTopBox:function(){var e,t;for(e=this.boxes.length-1;e>=0;e--)if(!this.boxes[e].isMinimized){t=this.boxes[e];break}return t},$get:["$injector","$rootScope","$$q","$templateCache","$controller","$compile","$document","$ringhttp","Notification","SystemEvents","Utils","GlobalEvents",t]};return e;function t(t,n,r,i,o,a,s,c,l,u,d,g){var E={},m=this,T=!1,f=!1,p=!1;E.destroy=function(e,t){try{e.dom.remove(),e.scope.$destroy(),e.deferred.resolve.apply(null,t)}catch(n){throw new Error("undfined instance provided. ignoring...")}},E.close=function(e){var t,n;for(e&&e.stopPropagation&&e.stopPropagation(),t=m.boxes.length-1;t>=0;t--)if(n=m.boxes[t],!n.isMinimized){E.destroy(n,arguments),m.boxes.splice(t,1),m.adjustBodyClass();break}},E.closeAll=function(){var e,t;for(e=m.boxes.length-1;e>=0;e--)t=m.boxes[e],t.isMinimized||(E.destroy(t,arguments),m.boxes.splice(e,1),m.adjustBodyClass())},E.minimize=function(){var e;return e=m.getTopBox(),!e||(e.dom.css({display:"none"}),e.isMinimized=!0,m.adjustBodyClass(),e)},E.maximize=function(e){e&&(e.dom.css({display:"table"}),e.isMinimized=!1,m.adjustBodyClass())},E.open=function(t){var i,s,c,g,h,A,C,S,v,M,D,O,R=r.defer(),N=r.defer(),P={},y=1,b=m.init();if(h={loaderHide:!0,onEscape:!0,animation:!0,backDropClose:!0,scrollable:!1,showCloseBtn:!0},A=angular.extend({},h,t),p)return!1;if(S=angular.element(b[0].querySelector("div.ringbox-content")),v=angular.element(S[0].querySelector("div.ringbox-loader")),M=angular.element(S[0].querySelector("div.ringbox-inner")),D=angular.element(b[0].querySelector("div.ringbox-overlay")),O=angular.element(b[0].querySelector("div.ringbox-close")),S.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"}),A.animation&&S.addClass("animation"),A.showCloseBtn?b.addClass("box-close"):O.css({display:"none"}),i=(A.scope||n).$new(),i.boxIsLoading=!0,angular.forEach(e.options,function(e,t){i[t]=A[t]}),angular.isObject(A.scopeData)&&angular.forEach(A.scopeData,function(e,t){i[t]=A.scopeData[t]}),p=setTimeout(F,200),T=setTimeout(function(){i&&i.boxIsLoading&&(l.error({message:"Something went wrong! Please try again."}),E.close())},2e4),i.$on(u.RINGBOX.UPDATE,function(){k(!0)}),!A.template&&!A.templateUrl)throw new Error("One of template or templateUrl options is required.");s=r.all([_(A)].concat(I(A.resolve))),c={result:R.promise,opened:N.promise,close:E.close,closeAll:E.closeAll,showLoader:U,hideLoader:L,adjustHeight:k,dom:b,scope:i,deferred:R,isMinimized:!1,withCloseBtn:A.showCloseBtn},s.then(function(e){if(i.boxIsLoading=!1,i.$close=E.close,M){if(T&&(clearTimeout(T),T=!1),A.controller){P.$scope=i,P.$boxInstance=c;for(C in A.resolve)A.resolve.hasOwnProperty(C)&&(P[C]=e[y++]);g=o(A.controller,P),A.controllerAs&&(i[A.controllerAs]=g)}M.html(e[0]),a(M.contents())(i),S.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),p&&(clearTimeout(p),p=!1,f=!0,A.loaderHide&&(v.css({display:"none"}),S.removeClass("ringbox-invisible")),F()),A.loaderHide&&L(),i.$rgDigest()}},function(e){R.reject(e),E.close()}),s.then(function(){N.resolve(!0)},function(){N.reject(!1)}),A.scrollable&&(b.addClass("scrollable"),k()),A.backDropClose&&(D.on("click",function w(e){D.off("click",w),E.close(e)}),A.scrollable&&b[0].addEventListener("click",function G(e){e.stopPropagation(),e.target.className.indexOf("ringbox-outerContainer")!==-1&&(b[0].removeEventListener("click",G),E.close())},!1)),O.on("click",function B(e){O.off("click",B),E.close(e)}),A.scrollable&&b.bind("scroll",function(){b[0].scrollHeight-(b[0].offsetHeight+b[0].scrollTop)<100&&(angular.isFunction(i.onScroll)&&i.onScroll(),angular.isFunction(i.loadMore)&&i.loadMore())}),i.$on("$destroy",function(){b=null,S=null,v=null,M=null,c=null,A=null,D=null,O=null,s=null});function U(){S.addClass("ringbox-invisible"),v.css({display:"block"}),M.css({display:"none"}),S.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"})}function L(){setTimeout(function(){v&&(v.css({display:"none"}),M.css({display:"block"}),k(),S.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),S.removeClass("ringbox-invisible"))},300)}function F(){m.adjustBodyClass(!0),document.body.appendChild(b[0]),f&&k(),p=!1}function k(e){var t,n;e&&"none"!==v.css("display")||S&&A.scrollable&&(t=M[0].offsetHeight,n=Math.max(d.viewport.y/2-t/2,40),S.css({"margin-top":n+"px"}),t>d.viewport.y?D.css({right:d.scrollbarWidth+"px"}):D.css({right:"0px"}))}return m.boxes.push(c),m.adjustBoxes(),c};function _(e){var t,n;return e.template?r.when(e.template):(t=angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,i.get(t)?r.when(i.get(t)):(n=r.defer(),c.get(t).success(function(e){i.put(t,e),n.resolve(e)}).error(function(){n.reject()}),n.promise))}function I(e){var n=[];return angular.forEach(e,function(e){angular.isDefined(e.promise)?n.push(e.promise):angular.isFunction(e)?n.push(r.when(t.invoke(e))):(angular.isArray(e)||angular.isObject(e))&&n.push(e)}),n}function h(e){var t,n=e.which||e.keyCode||e.key;t=m.getTopBox(),27===n&&t&&t.close(e)}return g.bindHandler("document","keyup",h),E}}angular.module("ringid.ui_ringbox").directive("rgRingbox",rgRingbox),rgRingbox.$inject=["$ringbox","$player","feedFactory"];function rgRingbox(e,t,n){return{restrict:"EA",scope:{ringboxData:"&",scopeData:"&",onRingBoxOpen:"&",onRingBoxClose:"&",onScroll:"&",ringboxFalsyFunc:"&",ringboxOpen:"&"},link:r};function r(r,i,o){var a;function s(a){var s,c,l,u,d,g,E,m,T,f={},p={},_=[];if(a.preventDefault(),t.isMinimized()&&o.mediaKey)return T=t.getMinimizePlayer(),m=o.mediaKey.split("-"),u=n.getFeed(m[0]),u&&(d=u.audios.get(m[1]),d||(d=u.medias.get(m[1]))),void(d&&(_.push(d),T.updatePlaylist(_,!0)));if(s=o.ringboxType,s||(s="html"),o.ringboxData&&(f=angular.isFunction(r.ringboxData)?r.ringboxData():r.ringboxData),o.scopeData&&(p=angular.isFunction(r.scopeData)?r.scopeData():r.scopeData),l=f.data?f.data:f,g={type:s,scrollable:o.ringboxScrollable&&("true"===o.ringboxScrollable||o.ringboxScrollable===!0),loaderHide:!(o.loaderHide&&("false"===o.loaderHide||o.loaderHide===!1)),scope:!!o.ringboxScope&&r,scopeData:p||{},controller:o.ringboxController||"",resolve:{localData:l,remoteData:f.promise?f:angular.noop},backDropClose:!(o.ringBackdropClose&&("false"===o.ringBackdropClose||o.ringBackdropClose===!1)),animation:!(o.ringboxAnimation&&("false"===o.ringboxAnimation||o.ringboxAnimation===!1)),onEscape:!(o.ringCloseEscape&&("false"===o.ringCloseEscape||o.ringCloseEscape===!1)),showCloseBtn:!(o.showCloseBtn&&("false"===o.showCloseBtn||o.showCloseBtn===!1))},"remote"===s)g.templateUrl=o.ringboxTarget||r.ringboxTarget||o.href||o.src;else if("inline"===s)g.template=o.ringboxTarget||r.ringboxTarget;else if(s="html",c=o.ringboxTarget||r.ringboxTarget){if(g.template=angular.element(document.querySelector(c)),!(g.template.length>0))throw new Error("Opps ! Your Provideed Target element Does Not Exist!");g.template=g.template[0].outerHTML}else g.template=i.html();E=e.open(g),E&&(E.result.then(function(){angular.isDefined(r.onRingBoxClose)&&angular.isFunction(r.onRingBoxClose)&&r.onRingBoxClose()}),E.opened.then(function(){angular.isDefined(r.onRingBoxOpen)&&angular.isFunction(r.onRingBoxOpen)&&r.onRingBoxOpen()}))}function c(e){i.on("click",e),a=r.$on("$destroy",function(){i.off("click",e)})}function l(e){e.preventDefault(),e.stopPropagation(),angular.isFunction(r.ringboxFalsyFunc)&&r.ringboxFalsyFunc();
}o.ringboxOpen?r.$watch("ringboxOpen()",function(e){a&&(i.off("click",s),i.off("click",l),a()),c(e?s:l)}):c(""===o.rgRingbox||"true"===o.rgRingbox||o.rgRingbox===!0?s:l)}}!function(e,t){"use strict";e.module("ringid.ui_player",[])}(angular,window),angular.module("ringid.ui_player").provider("$player",PlayerProvider);function PlayerProvider(){function e(t,n,r){return!!t.matches(n)||t!==r&&(!!t.parentNode&&e(t.parentNode,n,r))}function t(e){var t,n,r,i="";return t=Math.floor(e),n=parseInt(t/3600,10)%24,r=parseInt(t/60,10)%60,t=t<0?0:t%60,n>0&&(i+=n<10?"0"+n:n),i+=(r<10?"0"+r:r)+":"+(t<10?"0"+t:t)}function n(e){var t=0,n=0,r=e;if(r.offsetParent)do t+=r.offsetLeft,n+=r.offsetTop;while(null!==(r=r.offsetParent));return{x:t,y:n}}function r(e,t,n){var r,i=e.className;for(r=0;r<n.length;r++)i=i.replace(n[r],"").trim();for(r=0;r<t.length;r++)i+=" "+t[r].trim();e.className=i}this.dicts={maximize:"Back to normal view",fullScreen:"Full Screen",playlist:"Playlist",auto:"Auto Play"},this.instances=[],this.template='<div class="rg-player" rgrole="rgplayer"><div rgrole="container" class="container"><div rgrole="playinfo" class="play-info"></div><div rgrole="playerror" class="play-error"></div><div rgrole="debug" class="player-debug">Meta Data</div><div rgrole="musicbars" class="music-bars"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><div rgrole="bigplay" class="big-play paused"><span class="img_sprite"></span></div><div rgrole="loader" class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div><div rgrole="poster" class="player-poster"><img class="poster" /></div></div><div rgrole="playlistcontainer" class="playlist-wrapper"></div><div rgrole="control" class="media-control"><div rgrole="controlbg" class="media-control-bg"></div><div rgrole="controllayer" class="media-control-layer"><div class="bar-panel"><div rgrole="barcontainer" class="bar-container"><div class="bar-background"><div rgrole="loaded" class="bar-fill-1"></div><div rgrole="progress" class="bar-fill-2"></div><div rgrole="barhover" class="bar-hover"></div></div><div rgrole="barscrubber" class="bar-scrubber"><div class="bar-scrubber-icon"></div></div><div rgrole="seek" class="seek-time"><div rgrole="timer" class="timer"></div></div></div></div><div class="control-left"><div rgrole="playbtns" class="play-btns stopped"><button rgrole="prev" class="control-btn prev-btn"><i class="img_sprite w-h-13 icon-previous-p"></i></button><button rgrole="start" class="control-btn start-btn"><i class="img_sprite w-h-13"></i></button><button rgrole="next" class="control-btn next-btn"><i class="img_sprite w-h-13 icon-next-p"></i></button></div><div class="volume-bar"><div rgrole="mute" class="img_sprite w-h-13 icon-speaker-fill volume-icon"></div><div rgrole="volumebar" class="volume-warp img_sprite"><div rgrole="volumescrubber" class="img_sprite vol-scrubber"></div></div></div><div rgrole="timerunning" class="time-indicator time-running"></div><div rgrole="timetotal" class="time-indicator time-total"></div></div><div rgrole="controlright" class="control-right"><div rgrole="controltip" class="media-tip"></div><button rgrole="hd" class="control-btn hd">HD</button><button rgrole="fullscreen" class="control-btn full-screen"><i class="img_sprite h-w-20-26 icon-screen-f"></i></button><button rgrole="playlistbtn" class="control-btn playlist-btn"><i class="img_sprite h-w-20-26 w-21 icon-play-list"></i></button><button rgrole="auto" class="control-btn auto"><i class="img_sprite h-w-20-26 icon-auto"></i></button></div></div></div></div>',this.trackTemplate='<a tabindex="-1" rgrole="changetrack" data-rel="data-id" href="#"><span class="list-thumb"><img src="data-thumb" /></span><span class="list-title">data-caption<b>data-duration</b></span></a>',this.pauseAll=function(){var e,t;for(e=this.instances.length-1;e>=0;e--)t=this.instances[e],t.transitionState=t.playingState,"PLAYING"===t.playingState&&t.pause()},this.propagatePlaying=function(){var e,t;for(e=this.instances.length-1;e>=0;e--)t=this.instances[e],"PLAYING"===t.transitionState&&(t.resume(),t.transitionState=t.playingState)},this.createMediaObject=function(e){return"audio"===e?document.createElement("audio"):document.createElement("video")},this.getDefaultThumb=function(e){var t=e;return t&&"images/default_audio_preview.jpg"!==t||(t="images/player-audio.png"),t},this.$get=["$compile","GlobalEvents",function(i,o){var a=this,s={};s.miniPlayerSetting={width:350,height:140,top:0,left:210,maxHeight:250,xLimit:202,yLimit:50},s.destroy=function(e){var t;try{for(t=a.instances.length-1;t>=0;t--)if(a.instances[t]===e){a.instances.splice(t,1);break}e.destroy(),a.propagatePlaying()}catch(n){throw new Error("undfined instance provided. ignoring...")}},s.destroyAll=function(){var e,t;for(e=a.instances.length-1;e>=0;e--)t=a.instances[e],s.destroy(t),a.instances.splice(e,1)},s.isMinimized=function(){var e,t=!1;for(e=a.instances.length-1;e>=0;e--)if(a.instances[e].isMinimized){t=!0;break}return t},s.getMinimizePlayer=function(){var e,t;for(e=a.instances.length-1;e>=0;e--)if(a.instances[e].isMinimized){t=a.instances[e];break}return t},s.addToPlaylist=function(e){var t;for(t=a.instances.length-1;t>=0;t--)if(!a.instances[t].chat&&!a.instances[t].isMinimized){a.instances[t].addToPlaylist(e);break}};function c(s){var c,l,u,d,g,E,m,T,f,p,_,I,h,A,C,S=this,v={},M=[],D={},O={},R={},N=250,P=300,y=0,b=null;T={mouseover:{rgplayer:"showControl",auto:"showTooltip",playlistbtn:"showTooltip",fullscreen:"showTooltip"},mousedown:{barscrubber:"onBarDown",volumescrubber:"onVolDown"},mouseup:{rgplayer:"onBarUp onVolUp",barcontainer:"onBarUp",volumebar:"onVolUp"},mouseleave:{rgplayer:"hideControl"},mousemove:{rgplayer:"onBarMove onVolMove",barcontainer:"onBarMove"},click:{container:"playPause",prev:"playPrev",next:"playNext",start:"playPause",fullscreen:"fullScreen",playlistbtn:"onTogglePlaylist",auto:"onSetAuto",changetrack:"onTrackChange",mute:"muteUnmute"}},p={fullscreen:a.dicts.fullScreen,normalscreen:a.dicts.maximize,playlistbtn:a.dicts.playlist,auto:a.dicts.auto},D.auto=s.auto||!1,D.autoPlay=s.autoPlay||!1,D.showMinMax=s.showMinMax||!1,O.bufferState="BUFFERING",O.screenState="NORMAL",O.volumeState="UNMUTE",O.playlistState=!1,O.controlState=!1,O.providerType="",ge({source:s.source||"",title:s.title,poster:s.poster,mediaType:s.type}),u=.5,d=0,g=!1,M=s.playlist||[],m=D.autoPlay,l=document.getElementById(s.parentId),l.innerHTML=a.template,v.player=l.querySelector('[rgrole="rgplayer"]'),v.playlistWrap=l.querySelector('[rgrole="playlistcontainer"]'),v.debug=v.player.querySelector('[rgrole="debug"]'),v.musicBar=v.player.querySelector('[rgrole="musicbars"]'),v.loader=v.player.querySelector('[rgrole="loader"]'),v.poster=v.player.querySelector('[rgrole="poster"]'),v.barContainer=v.player.querySelector('[rgrole="barcontainer"]'),v.barScrubber=v.player.querySelector('[rgrole="barscrubber"]'),v.barLoaded=v.player.querySelector('[rgrole="loaded"]'),v.barPosition=v.player.querySelector('[rgrole="progress"]'),v.barHover=v.player.querySelector('[rgrole="barhover"]'),v.controlLayer=v.player.querySelector('[rgrole="controllayer"]'),v.controlBG=v.player.querySelector('[rgrole="controlbg"]'),v.controlTip=v.player.querySelector('[rgrole="controltip"]'),v.controlRight=v.player.querySelector('[rgrole="controlright"]'),v.playBtns=v.player.querySelector('[rgrole="playbtns"]'),v.playBtn=v.player.querySelector('[rgrole="start"]'),v.nextBtn=v.player.querySelector('[rgrole="next"]'),v.prevBtn=v.player.querySelector('[rgrole="prev"]'),v.timeRunning=v.player.querySelector('[rgrole="timerunning"]'),v.timeTotal=v.player.querySelector('[rgrole="timetotal"]'),v.playlistBtn=v.player.querySelector('[rgrole="playlistbtn"]'),v.fullScreenBtn=v.player.querySelector('[rgrole="fullscreen"]'),v.auto=v.player.querySelector('[rgrole="auto"]'),v.volumeBar=v.player.querySelector('[rgrole="volumebar"]'),v.volumeScrubber=v.player.querySelector('[rgrole="volumescrubber"]'),v.seekTimer=v.player.querySelector('[rgrole="seek"]'),v.timer=v.player.querySelector('[rgrole="timer"]'),v.player.style.width=s.width?s.width+"px":"100%",v.player.style.height=s.height?s.height+"px":"100%",v.timeRunning.innerHTML="00:00",v.timeTotal.innerHTML="00:00",h=v.volumeBar.clientWidth,A=v.volumeScrubber.clientWidth,C=v.barScrubber.offsetWidth,this.debug=!1,this.canPlay=!0,this.isMinimized=!1,this.playingState=D.autoPlay?"INIT":"STOPPED",this.transitionState=this.playingState,this.debug&&(v.debug.style.display="block"),!R.source&&M.length>0&&ge(),_=v.player.requestFullscreen||v.player.mozRequestFullScreen||v.player.webkitRequestFullScreen||v.player.msRequestFullscreen,I=document.cancelFullscreen||document.exitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen,f={playPause:k,playPrev:w,playNext:G,showControl:x,hideControl:K,onBarDown:Ce,onBarMove:Se,onBarUp:ve,hideTimeInfo:H,onVolDown:Me,onVolMove:De,onVolUp:Oe,onTrackChange:Re,onTogglePlaylist:Ne,fullScreen:j,showTooltip:V,onSetAuto:Pe,muteUnmute:me};function U(){R.mediaType!==O.providerType&&(c&&(Ie(),c.pause(),c.src="",c.load(),v.poster.removeChild(c)),O.providerType=R.mediaType,c=a.createMediaObject(O.providerType),ce(),v.poster.appendChild(c))}function L(e,n){0===R.duration&&n>0&&ae(n),e>n&&ae(e),v.timeRunning.innerHTML=t(e),v.barScrubber.style.left=0===R.duration?"-"+C/2+"px":"calc("+e/R.duration*100+"% - "+C/2+"px)",v.barPosition.style.width=0===R.duration?"0%":e/R.duration*100+"%"}function F(e,t){0===R.duration&&t>0&&ae(t),v.barLoaded.style.width=0===R.duration?"0%":e/R.duration*100+"%"}function k(){if(S.canPlay)return O.playlistState?void Z(!0):"PLAYING"===S.playingState?(m=!1,S.pause(),z(),X(),ie(),Y(),Z(!0),q(),void r(v.playBtns,["paused"],["playing","paused","stopped"])):"PAUSED"===S.playingState?(m=!0,S.resume(),z(),X(),ie(),q(),r(v.playBtns,["playing"],["playing","paused","stopped"]),void("FULL"===O.screenState&&x())):"STOPPED"===S.playingState?(m=!0,S.play(),z(),X(),ie(),Z(!0),q(),void r(v.playBtns,["playing"],["playing","paused","stopped"])):void 0}function w(){0!==d&&pe(--d)}function G(){return d>=M.length-1?void Y():void pe(++d)}function B(){var e=v.player.querySelector('[rgrole="hd"]');R.hd?e.style.display="block":e.style.display="none"}function $(e){var r,i="FULL"===O.screenState?{x:0,y:0}:n(v.barContainer),o=e.pageX-i.x;r=Math.round(o*R.duration/v.barContainer.offsetWidth),r<0&&(r=0),v.timer.innerHTML=t(r),v.seekTimer.style.left=o-v.seekTimer.offsetWidth/2+"px",v.barHover.style.left=o-v.barHover.offsetWidth/2+"px"}function H(){g=!1}function x(){S.error||"PLAYING"===S.playingState&&(v.controlLayer.style.bottom="0px",v.controlBG.style.opacity=1,O.controlState=!0,K())}function Y(){S&&(g=!1,E=!1,S.isMinimized&&"audio"===R.mediaType&&!S.error||(v.controlLayer.style.bottom="-60px",v.controlBG.style.opacity=0,O.controlState=!1,b&&(clearTimeout(b),b=null)))}function K(){b&&(clearTimeout(b),b=null),O.controlState&&(b=setTimeout(Y,5e3))}function j(){if(_)return"NORMAL"===O.screenState?(_.call(v.player),O.screenState="FULL",x(),r(v.player,["full"],[]),r(v.fullScreenBtn,["icon-screen-fe"],["icon-screen-f"]),v.fullScreenBtn.setAttribute("tooltip",a.dicts.maximize),void v.playBtn.focus()):"FULL"===O.screenState?(I.call(document),O.screenState="NORMAL",Y(),r(v.player,[],["full"]),r(v.fullScreenBtn,["icon-screen-f"],["icon-screen-fe"]),v.fullScreenBtn.setAttribute("tooltip",a.dicts.fullScreen),void v.playBtn.focus()):void 0}function V(e,t){var r,i,o="FULL"===O.screenState?{x:0,y:0}:n(v.controlRight),a=e.pageX-o.x,s=p[t];"fullscreen"===t&&"FULL"===O.screenState&&(s=p.normalscreen),s&&(v.controlTip.innerHTML=s,i=v.controlRight.offsetWidth,r=v.controlTip.offsetWidth,a=i<=r/2+a?i-r/2:a,v.controlTip.style.left=a-r/2+"px")}function W(e){var t;t=v.poster.querySelector('[rgrole="poster"] img'),e&&R.poster?(t.src=R.poster,t.style.display="inline-block"):t.style.display="none"}function q(){var e=v.player.querySelector('[rgrole="playinfo"]');""===R.title||"audio"!==R.mediaType||"PLAYING"!==S.playingState?e.style.display="none":(e.innerHTML=R.title,e.style.display="block")}function z(){m&&S.canPlay&&"BUFFERING"===O.bufferState&&("PLAYING"===S.playingState||"INIT"===S.playingState)?v.loader.style.display="block":v.loader.style.display="none"}function Q(){var e=v.player.querySelector('[rgrole="playerror"]');e.innerHTML="Sorry, your browser does not support this media format Or internet connection problem.",S.canPlay?e.style.display="none":(W(!1),e.style.display="block")}function X(){var e=v.player.querySelector('[rgrole="bigplay"]');return S.canPlay?"STOPPED"===S.playingState&&D.auto&&d!==M.length-1?void(e.style.display="none"):"STOPPED"!==S.playingState||m?void("PAUSED"!==S.playingState||m?e.style.display="none":(e.style.display="block",r(e,["paused"],["stopped","paused"]))):(e.style.display="block",void r(e,["stopped"],["stopped","paused"])):void(e.style.display="none")}function Z(e){var t,r=Te();return S.isMinimized&&(t=n(v.barContainer).y-P,t<=10&&(r=r+t-10),v.playlistWrap.style.height=r+"px"),O.playlistState||e?(S.isMinimized?(v.player.style.overflow="hidden",v.playlistWrap.style.display="none",v.player.style.zIndex=1):v.playlistWrap.style.right="-"+N+"px",v.playlistWrap.style.zIndex=999,void(O.playlistState=!1)):O.playlistState?void 0:(S.isMinimized?(v.playlistWrap.style.display="block",v.player.style.overflow="visible",v.player.style.zIndex=4):v.playlistWrap.style.right="0px",v.playlistWrap.style.zIndex=1e4,void(O.playlistState=!0))}function J(e){var t,r,i,o;return i=e.pageX?e.pageX:e.touches[0].pageX,t="FULL"===O.screenState?{x:v.volumeBar.offsetLeft,y:v.volumeBar.offsetTop}:n(v.volumeBar),r=i-t.x,o=Math.max(Math.min(1*r/h,1),0)}function ee(e){var t,n=h-A+2;u=e,t=u*h-A/2,t=Math.max(Math.min(t,n),0),0===t&&(u=0),t===n&&(u=1),u>0&&"MUTE"===O.volumeState&&me(),0===u&&"UNMUTE"===O.volumeState&&me(),S.setVolume(u),v.volumeScrubber.style.left=t+"px"}function te(e){var t,r,i,o;return i=e.pageX?e.pageX:e.touches[0].pageX,t="FULL"===O.screenState?{x:0,y:0}:n(v.barContainer),r=i-t.x,o=Math.round(r*R.duration/v.barContainer.offsetWidth)}function ne(e,t){"STOPPED"!==S.playingState&&S.canPlay&&(t&&S.seek(e),L(e))}function re(e){return e?void r(v.auto,["enbled"],[]):D.auto?(D.auto=!1,void r(v.auto,[],["enbled"])):D.auto?void 0:(D.auto=!0,void r(v.auto,["enbled"],[]))}function ie(){"audio"!==R.mediaType||"PLAYING"!==S.playingState||"PLAYING_BUFFERING"!==O.bufferState||m||S.isMinimized?v.musicBar.style.display="none":v.musicBar.style.display="block"}function oe(){m=!1,O.bufferState="BUFFERING",ae(0),L(0),F(0)}function ae(e){v.timeTotal.innerHTML=t(e),R.duration=e}function se(){v.player.addEventListener("click",$e,!1),v.player.addEventListener("mouseover",$e,!1),v.player.addEventListener("mouseleave",$e,!1),v.player.addEventListener("mousemove",$e,!1),v.player.addEventListener("mousedown",$e,!1),v.player.addEventListener("mouseup",$e,!1),o.bindHandler("document","mozfullscreenchange",Ge),o.bindHandler("document","webkitfullscreenchange",Ge),o.bindHandler("document","MSFullscreenChange",Ge),o.bindHandler("document","fullscreenchange",Ge),o.bindHandler("document","keyup",Be),le(),D.auto&&re(!0)}function ce(){c.addEventListener("loadedmetadata",we),c.addEventListener("timeupdate",ke),c.addEventListener("play",Fe),c.addEventListener("pause",Le),c.addEventListener("ended",Ue),c.addEventListener("stalled",be),c.addEventListener("error",ye)}function le(){var e,n,r,o='<div class="playlist-scrollbar-wrapper"><div rg-scrollbar="true" class="playlist-scrollbar"><ul rgrole="playlist" class="playlist">';if(0!==M.length){for(n=0;n<M.length;n++)e=M[n].getThumb(),e=a.getDefaultThumb(e),r=a.trackTemplate.replace(/data-id/g,n),r=r.replace(/data-thumb/g,e),r=r.replace(/data-caption/g,M[n].getCaption()),r=r.replace(/data-duration/g,t(M[n].getDuration())),R.source===M[n].getStreamUrl()&&(d=n),o+="<li>"+r+"</li>";o+="</ul></div></div>",v.playlistWrap.innerHTML="",v.playlistWrap.appendChild(i(o)(s.scope)[0])}}function ue(){M.length>1?(v.playlistBtn.style.display="block",v.prevBtn.style.display="block",v.nextBtn.style.display="block",v.auto.style.display="block",r(v.playBtns,["playlist"],[])):(v.playlistBtn.style.display="none",v.prevBtn.style.display="none",v.nextBtn.style.display="none",v.auto.style.display="none",r(v.playBtns,[],["playlist"])),v.playlistWrap.style.right="-250px"}function de(){var e,t;if(0===d?r(v.prevBtn,["disabled"],[]):r(v.prevBtn,[],["disabled"]),d===M.length-1?r(v.nextBtn,["disabled"],[]):r(v.nextBtn,[],["disabled"]),M.length>0)for(t=v.playlistWrap.querySelectorAll('[rgrole="playlist"] a'),e=0;e<t.length;e++)e===d?r(t[e],["active"],["active"]):r(t[e],[],["active"])}function ge(e){var t,n;e?(R.source=e.source,R.title=e.title||"",R.hd=!1,R.poster=a.getDefaultThumb(e.poster)||"",R.duration=0,R.mediaType=e.mediaType||"video"):(n=M[d],t=n.getThumb(),t=a.getDefaultThumb(t),R.source=n.getStreamUrl(),R.title=n.getCaption(),R.hd=!1,R.poster=t,R.duration=0,R.mediaType=n.isVideo()?"video":"audio")}function Ee(e){return m="BUFFERING"===O.bufferState,"PLAYING"===e&&(S.playingState="PLAYING",r(v.playBtns,["playing"],["playing","paused","stopped"])),"ENDED"===e||"IDLE"===e?(S.playingState="STOPPED",oe(),z(),X(),q(),ie(),Z(!0),r(v.playBtns,["stopped"],["playing","paused","stopped"]),void(D.auto&&M.length>0?G():Y())):(z(),ie(),void q())}function me(){var e=v.player.querySelector('[rgrole="mute"]');return"UNMUTE"===O.volumeState?(c.muted=!0,r(e,["mute"],[]),void(O.volumeState="MUTE")):"MUTE"===O.volumeState?(c.muted=!1,r(e,[],["mute"]),void(O.volumeState="UNMUTE")):void 0}function Te(){var e,t=58;return e=M.length*t,e>P&&(e=P),e}function fe(){angular.isFunction(s.scope.onChange())&&M.length>0&&s.scope.onChange()(M[d])}function pe(e){"undefined"!=typeof e&&(d=parseInt(e,10),ge()),U(),c.autoplay=!1,oe(),de(),m=!0,S.error=!1,S.load(R.source),Q(),z(),X(),ie(),q(),B(),Z(!0),W(!0),r(l,[R.mediaType],["audio","video"]),fe()}function _e(){var e;S.debug&&(e=c.buffered.length>0?c.buffered.end(c.buffered.length-1):0,v.debug.innerHTML="ready State: "+c.readyState+" <br />Buffered: "+e+" <br />Current time: "+c.currentTime+" <br />Playing State: "+S.playingState+" <br />Buffer State: "+O.bufferState+" <br />Loading State: "+(m?"true":"false"))}function Ie(){c.removeEventListener("loadedmetadata",we),c.removeEventListener("timeupdate",ke),c.removeEventListener("play",Fe),c.removeEventListener("pause",Le),c.removeEventListener("ended",Ue),c.removeEventListener("stalled",be),c.removeEventListener("error",ye)}function he(){v.player.removeEventListener("click",$e),v.player.removeEventListener("mouseover",$e),v.player.removeEventListener("mouseleave",$e),v.player.removeEventListener("mousemove",$e),v.player.removeEventListener("mousedown",$e),v.player.removeEventListener("mouseup",$e),o.unbindHandler("document","mozfullscreenchange",Ge),o.unbindHandler("document","webkitfullscreenchange",Ge),o.unbindHandler("document","MSFullscreenChange",Ge),o.unbindHandler("document","fullscreenchange",Ge),o.unbindHandler("document","keyup",Be)}function Ae(){c.pause(),c.src="",c=v=l=M=T=S=f=null,b&&(clearTimeout(b),b=null)}function Ce(e){0===e.button&&(g=!0,r(v.barContainer,["down"],[]))}function Se(e){var t;$(e),g&&(t=te(e),ne(t,!1))}function ve(e,t){var n;("rgplayer"!==t||g)&&(g=!1,n=te(e),ne(n,!0),r(v.barContainer,[],["down"]))}function Me(e){0===e.button&&(E=!0,r(v.volumeBar,["down"],[]))}function De(e){var t;E&&(t=J(e),ee(t))}function Oe(e,t){var n;("rgplayer"!==t||E)&&(E=!1,n=J(e),ee(n),r(v.volumeBar,[],["down"]))}function Re(e){var t;t=e.target.closest("a").getAttribute("data-rel"),pe(t)}function Ne(){Z()}function Pe(){re()}function ye(){c&&(S.error=c.error.code,S.canPlay=!1,z(),Q(),Y())}function be(){}function Ue(){Ee("ENDED"),"video"===R.mediaType&&W(!1),angular.isFunction(s.scope.onEnded())&&s.scope.onEnded()()}function Le(){Ee("PAUSED"),"video"===R.mediaType&&W(!1)}function Fe(){Ee("PLAYING"),"video"===R.mediaType&&W(!1),angular.isFunction(s.scope.onStart())&&s.scope.onStart()()}function ke(){var e,t,n,r;c&&!g&&(r=c.duration,n=c.currentTime,e=c.buffered.length>0?c.buffered.end(c.buffered.length-1):0,t=n+.05>=e?"BUFFERING":"PLAYING_BUFFERING",(4!==c.readyState||n<.05||0===e)&&(t="BUFFERING"),F(e,r),Ee(t),O.bufferState=t,L(n,r),_e())}function we(){ae(c.duration),D.autoPlay&&S.play()}function Ge(){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;e||"FULL"!==O.screenState||j()}function Be(e){var t=e.which||e.keyCode||e.key;return!S.isMinimized&&(!(!v||document.activeElement!==v.playBtn)||(32===t&&k(),27===t))}function $e(t){var n,r,i,o=t.type,a=T[o],s=Date.now();if(t.preventDefault(),t.stopPropagation(),a){for(n in a)if(e(t.target,'[rgrole="'+n+'"]',v.player))for(i=a[n].split(/\s/),r=0;r<i.length;r++)He(i[r],t,n);"mousemove"===o&&s-y>4e3&&(K(),y=s)}}function He(e,t,n){var r=f[e];r&&r.call(null,t,n)}this.maximize=function(){if(S.isMinimized)return S.isMinimized=!1,v.fullScreenBtn.style.display="block",v.playlistWrap.style.height="calc(100% - 110px)",v.playlistWrap.style.right="-"+N+"px",void(v.playlistWrap.style.display="block")},this.minimize=function(){S.isMinimized=!0,Z(!0),x(),v.fullScreenBtn.style.display="none",v.playlistWrap.style.height=Te()+"px",v.playlistWrap.style.right="5px"},this.updatePlaylist=function(e,t){e&&(M=e,le(),t&&(ue(),pe(0)))},this.updateTrack=function(e){M=[],ge(e),pe()},this.addToPlaylist=function(e){var n,r,i,o,s=v.playlistWrap.querySelector('[rgrole="playlist"]');if(!s)return void S.updatePlaylist(e);if(e&&s)for(i=0;i<e.length;i++)o=document.createElement("li"),n=e[i].getThumb(),n=a.getDefaultThumb(n),r=a.trackTemplate.replace(/data-id/g,i),r=r.replace(/data-thumb/g,n),r=r.replace(/data-caption/g,e[i].getCaption()),r=r.replace(/data-duration/g,t(e[i].getDuration())),o.innerHTML=r,s.appendChild(o)},this.getPlaylistUI=function(){return v.playlistWrap},this.getParentUI=function(){return l},this.getPlayerBoundary=function(){var e=v.player.getBoundingClientRect();return{x:e.x,y:e.y,w:v.player.offsetWidth,h:v.player.offsetHeight}},this.getProvider=function(){return c},this.togglePlay=function(){k()},this.destroy=function(){he(),Ie(),Ae()},se(),ue(),Y(),pe(),ee(u)}return c.prototype.load=function(e){var t;t=this.getProvider(),t.pause(),this.seek(0),t.src=e,t.load()},c.prototype.play=function(){var e;e=this.getProvider(),e.play(),this.playingState="PLAYING"},c.prototype.pause=function(){var e;e=this.getProvider(),e.pause(),this.playingState="PAUSED"},c.prototype.resume=function(){var e;e=this.getProvider(),e.play(),this.playingState="PLAYING"},c.prototype.seek=function(e){var t;t=this.getProvider();try{t.duration&&(t.currentTime=e)}catch(n){throw new Error("provider is not defined. So ignoring...")}},c.prototype.stop=function(){var e;e=this.getProvider(),e.pause(),this.seek(0),this.playingState="STOPPED"},c.prototype.setVolume=function(e){var t;t=this.getProvider(),t.volume=e},s.create=function(e){var t=new c(e);return a.pauseAll(),a.instances.push(t),t},s}]}angular.module("ringid.ui_player").directive("rgMiniPlayer",rgMiniPlayer),rgMiniPlayer.$inject=["$ringbox","$player","GlobalEvents","Utils"];function rgMiniPlayer(e,t,n,r){var i='<div id="mini-player" class="mini-player" player-container="true"><div class="move-player"><div class="min-p-bg"><a class="img_sprite maximize player-max-ico mini-maximize"></a><a class="mini-close"><div class="player-min player-close-ico close-rt img_sprite w-h-13 right-6"></div></a></div></div><div class="resize-player"></div></div>';function o(i,o){var a,s,c,l,u,d,g=o[0].querySelector(".mini-player"),E=g.querySelector(".mini-maximize"),m=g.querySelector(".mini-close"),T=g.querySelector(".move-player"),f=g.querySelector(".resize-player"),p=!1,_=!1,I=!1;g=angular.element(g),m.addEventListener("click",h,!1),E.addEventListener("click",A,!1),T.addEventListener("mousedown",S,!1),T.addEventListener("click",C,!1),f.addEventListener("mousedown",v,!1);function h(t){t.preventDefault(),t.stopPropagation(),e.destroy(i.ringbox),o.remove()}function A(t){t.preventDefault(),t.stopPropagation(),i.ringbox.dom.find("rg-player").append(i.player.getParentUI()),i.player.maximize(i.ringbox),e.maximize(i.ringbox),o.remove(),"PLAYING"===i.player.playingState&&setTimeout(function(){i.player.play()})}function C(){return p?void(p=!1):void i.player.togglePlay()}function S(e){e.preventDefault(),e.stopPropagation(),0===e.button&&(I=!0,l=g[0].offsetLeft-e.clientX,u=g[0].offsetTop-e.clientY,n.bindHandler("document","mousemove",M),n.bindHandler("document","mouseup",D))}function v(e){e.preventDefault(),e.stopPropagation(),_=!0,d=e.clientY,n.bindHandler("document","mousemove",M),n.bindHandler("document","mouseup",D)}function M(e){var t;return p=!0,(I||_)&&fastdom.read(function(){t=I?O("r",e):R("r",e),fastdom.write(function(){t=I?O("w",e):R("w",e)})}),t}function D(e){e.stopPropagation(),I=!1,_=!1,document.body.style.cursor="auto",f.style.cursor="ns-resize",T.style.cursor="move",n.unbindHandler("document","mousemove",M),n.unbindHandler("document","mouseup",D)}function O(e,n){var i=r.viewport.x,o=r.viewport.y;"r"===e?(n.clientX+l>=t.miniPlayerSetting.xLimit&&n.clientX+l<=i-t.miniPlayerSetting.width-t.miniPlayerSetting.xLimit-8&&(a=n.clientX+l),n.clientY+u>=t.miniPlayerSetting.yLimit&&n.clientY+u<=o-t.miniPlayerSetting.height&&(s=n.clientY+u)):(document.body.style.cursor="move",f.style.cursor="move",g.css({top:s+"px",left:a+"px"}))}function R(e,n){"r"===e?(c=g[0].offsetHeight,s=parseInt(g.css("top").replace("px",""),10),d>=n.clientY&&c<t.miniPlayerSetting.maxHeight&&(c+=3,s-=3),d<n.clientY&&c>t.miniPlayerSetting.height&&(c-=3,s+=3),d=n.clientY):(document.body.style.cursor="ns-resize",T.style.cursor="ns-resize",g.css({height:c+"px",top:s+"px"}))}i.$on("$destroy",function(){m.removeEventListener("click",h),E.removeEventListener("click",A),T.removeEventListener("mousedown",S),T.removeEventListener("click",C),f.removeEventListener("click",v),E=m=T=f=null})}return{restrict:"E",template:i,scope:{ringbox:"=",player:"="},link:o}}angular.module("ringid.ui_player").directive("rgPlayer",rgPlayer),rgPlayer.$inject=["$compile","$player","$ringbox","SystemEvents","$sniffer","Utils"];function rgPlayer(e,t,n,r,i,o){function a(a,s,c){var l,u,d=c.id?c.id:"player_1",g=c.width?c.width:"100%",E=c.height?c.height:"100%",m=!("false"===c.auto||c.auto===!1),T=c.url?c.url:"",f=c.title?c.title:"",p="true"===c.isVideo||c.isVideo===!1?"video":"audio",_=c.poster?c.poster:"",I=!("false"===c.autoPlay||c.autoPlay===!1),h="true"===c.chat||c.chat===!0,A=null,C=null,S=i.vendorPrefix.toLowerCase();_&&"default_audio_preview"!==_||(_="images/player-audio.png"),u='<div title="" id="player_'+d+'" class="player '+p+'"></div>',s.append(u),setTimeout(function(){A=t.create({source:T,title:f,playlist:a.playlist,auto:m,type:p,parentId:"player_"+d,autoPlay:I,chatVersion:h,width:g,height:E,poster:_,scope:a}),C=s[0].closest(".ringbox-inner").querySelector(".player-size"),C&&(C.addEventListener("click",v,!1),A.error&&(C.style.display="none"))});function v(r){var i,s,c,l,u;r.preventDefault(),r.stopPropagation(),u=A.getParentUI(),i=u.getBoundingClientRect(),A.minimize(),a.ringbox=n.minimize(),a.player=A,s=e('<rg-mini-player player="player" ringbox="ringbox"></rg-miniplayer>')(a),c=angular.element(s[0].querySelector("[player-container]")),l="left .5s ease-out, top .5s ease-out, width .5s ease-out, height .5s ease-out",c[0].style[S+"Transition"]=l,c[0].style.transition=l,c.on(S+"TransitionEnd",d),c.on("transitionend",d),requestAnimationFrame(function(){c.css({left:i.left+"px",top:i.top+"px",width:i.width+"px",height:i.height+"px"}),c.append(A.getParentUI()),document.body.appendChild(s[0]),requestAnimationFrame(function(){c.css({left:t.miniPlayerSetting.left+"px",top:o.viewport.y-t.miniPlayerSetting.height+"px",width:t.miniPlayerSetting.width+"px",height:t.miniPlayerSetting.height+"px"})}),"PLAYING"===A.playingState&&A.play()});function d(){c[0].style[S+"Transition"]="inherit",c[0].style.transition="inherit",c.off(S+"TransitionEnd",d),c.off("transitionend",d)}}l=o.onCustomEvent(r.MEDIA.LOAD_TRENDING_MEDIA,function(e){var t=[];t.push(e),A.updatePlaylist(t,!0)}),a.$on("$destroy",function(){t.destroy(A),C&&C.removeEventListener("click",v),o.removeCustomEvent(r.MEDIA.LOAD_TRENDING_MEDIA,l),C=null})}return{restrict:"E",scope:{onChange:"&",onStart:"&",onEnded:"&",playlist:"="},link:a}}!function(e,t){"use strict";e.module("ringid.utils",["ringid.config","ringid.global_services"])}(angular,window),angular.module("ringid.utils").directive("ogImageSrc",ogImageSrc).directive("rgUrlOgPreview",rgUrlOgPreview),ogImageSrc.$inject=["SystemEvents"];function ogImageSrc(e){return{restrict:"A",link:function(t,n,r){n[0].onload=function(){t.feedKey?t.$emit(e.FEED.HEIGHT,t.feedKey):t.$emit(e.RINGBOX.UPDATE)},n[0].src=r.ogImageSrc}}}rgUrlOgPreview.$inject=["$ringhttp","$templateCache","$compile","Utils"];function rgUrlOgPreview(e,t,n,r){return{restrict:"E",replace:!0,scope:{onClick:"&",ogData:"=",showPreview:"=",loadingData:"=",editMode:"@",feedKey:"@"},templateUrl:"",link:function(t,r,i){var o="templates/partials/url-og-preview.html";i.template&&(o=i.template),e.get(o).success(function(e){r.append(n(e)(t)),t.$rgDigest()})},controller:["$scope","$sce","settings",function(e,t,n){e.selectedOgImageIndex=0,e.onClick=o,e.onImageCloseClick=f,e.onDetailCloseClick=p,e.selectPreviousImage=T,e.selectNextImage=m,e.shouldShowNextButton=_,e.shouldShowPreviousButton=I,e.isYoutubeUrl=O,e.getYoutubeUrl=N,e.filterOnProgress=!1,e.ogData.title=decodeEntities(e.ogData.title),e.ogData.description=decodeEntities(e.ogData.description),e.shouldShowNextPreviousButtonContainer=h,e.shouldShowImageCloseButton=A,e.init=function(){e.ogData&&e.ogData.url&&(E(),P(e.ogData.url),e.ogData.url&&(/^https?:\/\//.test(e.ogData.url)||(e.ogData.url="http://"+e.ogData.url)),e.ogData.image&&(/^https?:\/\//.test(e.ogData.image)||(e.ogData.image="http://"+e.ogData.image),n.secure&&/^http:/.test(e.ogData.image)&&(e.ogData.image=n.httpsUrl+"/ImageProxy.png?url="+e.ogData.image.replace(/http:\/\//,""))),e.ogData.images&&e.ogData.images.length>0&&y())},e.$watch("ogData",function(){e.init()});function i(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){r.safeDigest(e)}}function o(){var t;e.ogData&&!e.ogData.images&&(t=e.ogData.url,t&&window.open(t,"_blank"))}function a(){e.ogData.images&&(e.ogData.image=e.ogData.images[e.selectedOgImageIndex])}function s(){e.ogData.image=""}function c(){e.ogData.title=""}function l(){e.ogData.description=""}function u(){e.ogData.url=""}function d(){e.ogData.lnkDmn=""}function g(t,n){e.ogData.meta[t]=n}function E(){e.ogData.meta={youtube:!1,youtube_id:""}}function m(){e.selectedOgImageIndex<e.ogData.images.length-1&&(e.selectedOgImageIndex+=1),a(),i()}function T(){e.selectedOgImageIndex>0&&(e.selectedOgImageIndex-=1),a(),i()}function f(e){e.preventDefault(),e.stopPropagation(),s(),i()}function p(e){e.preventDefault(),e.stopPropagation(),c(),l(),u(),d(),i()}function _(){return!!e.ogData.images&&e.selectedOgImageIndex<e.ogData.images.length-1}function I(){return e.selectedOgImageIndex>0}function h(){return!!e.editMode&&!!e.ogData.image&&!!e.ogData.filteredImages&&e.ogData.filteredImages.length>1}function A(){return!!e.editMode&&!e.filterOnProgress&&!!e.ogData.image}function C(){e.filterOnProgress=!0}function S(){e.filterOnProgress=!1}function v(t){e.ogData.filteredImages||(e.ogData.filteredImages=[]),e.ogData.filteredImages.push(t)}function M(){e.ogData.filteredImages=[]}function D(t){e.ogData.image=t}function O(){return!e.ogData.meta&&e.ogData.url&&(E(),P(e.ogData.url)),!!e.ogData.meta&&e.ogData.meta.youtube}function R(){return e.ogData.meta.youtube_id}function N(){return t.trustAsResourceUrl("https://www.youtube.com/embed/"+R()+"?autoplay=0&autohide=1&border=0&wmode=opaque&enablejsapi=1");
}function P(e){var t,n=/((http|https):\/{2})+((www\.)?youtube\.com)([?&]?([^=]+)=([^&]*))?/im;e&&(t=e.match(n),t&&t[3]&&t[7]?(g("youtube",!0),g("youtube_id",t[7])):g("youtube",!1))}function y(){var t;M(),C(),t=e.ogData.images,r.filterImagesByDimentions(t,{width:200}).then(function(t){e.ogData.image||D(t),v(t),e.filterOnProgress&&S(),i()},function(){},function(t){v(t),e.ogData.image||D(t),i()})}}]}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){}ringUtilsModule.directive("rgUrlOgFetcher",rgUrlOgFetcher),rgUrlOgFetcher.$inject=[];function rgUrlOgFetcher(){return{restrict:"E",scope:{fetchedOgInfo:"=",editorContent:"=",showPreview:"=",filterOnProgress:"=",loadingData:"="},link:function(e){e.fetchedOgInfo=e.fetchedOgInfo||{},e.filterOnProgress&&(e.filterOnProgress=!1)},controller:["$scope","$rootScope","$timeout","Utils","settings",function(e,t,n,r,i){var o,a={},s="";o=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im;function c(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){r.safeDigest(e)}}e.$watch("editorContent",r.debounce(function(e,t){l(e,t),c()},500));function l(t,n){var i,a,s,l,p;if(S(t,n)){if(t&&o.test(t)){if(i=t.match(o),a=i[1]){if(p=i[5]?i[5]:"",/^https?:\/\//.test(a)||(a="http://"+a),!u(a))return;s=g(a),s?(E(s),_(),C()):(T(),C(),c(),r.getOGDetails(a).success(function(e){l=e,f(),l&&l.sucs?(d(a,l),l.lnkDmn=p,l.url=a,l=A(l,a),E(l),_()):(m(),I()),C(),c()}).error(function(){m(),h(),I(),f(),C(),c()}))}}else m(),I();e.$parent.$rgDigest()}}function u(t){return(!e.fetchedOgInfo||s!==t)&&(s=t,!0)}function d(e,t){a[e]=t}function g(e){return a[e]}function E(t){e.fetchedOgInfo=t}function m(){e.fetchedOgInfo={}}function T(){e.loadingData=!0}function f(){e.loadingData=!1}function p(){return e.loadingData}function _(){e.showPreview=!0}function I(){e.showPreview=!1}function h(){s=""}function A(e,t){var n,r,o=angular.extend({},e);if(o.url||(o.url=t),o.title||(o.title=o.lnkDmn),e.images)for(n=e.images.length,r=0;r<n;r++)i.secure&&/^http:/.test(e.images[r])&&(e.images[r]=i.httpsUrl+"/ImageProxy.png?url="+e.images[r].replace(/http:\/\//,""));return o.title=decodeEntities(o.title),o.description=decodeEntities(o.description),o}function C(){n(function(){t.$broadcast("statusHeightChange")})}function S(){return!p()&&((!e.fetchedOgInfo||!(e.fetchedOgInfo.image||e.fetchedOgInfo.title||e.fetchedOgInfo.description))&&(h(),!0))}}]}}angular.module("ringid.utils").directive("rgLoaderView",rgLoaderView).directive("rgLoaderView1",rgLoaderView1).directive("rgLoaderView2",rgLoaderView2).directive("rgLoaderView3",rgLoaderView3);function rgLoaderView(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view.html"}}function rgLoaderView1(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view1.html"}}function rgLoaderView2(){return{restrict:"E",scope:{isLoading:"="},templateUrl:"templates/partials/loading_view2.html"}}function rgLoaderView3(){return{restrict:"E",scope:{isLoading:"="},templateUrl:"templates/partials/loading_view3.html"}}angular.module("ringid.utils").directive("rgCompile",["$compile",function(e){return function(t,n,r){t.$watch(function(){return t.$eval(r.rgCompile)},function(r){n.html(r),e(n.contents())(t)})}}]);var app;app=angular.module("ringid.utils"),app.directive("rgMouseover",rgMouseover),rgMouseover.$inject=["$parse"];function rgMouseover(e){function t(t,n,r){var i=e(r.rgMouseover);function o(e){try{i(t,{$event:e})}catch(n){}}n.bind("mouseover",o),t.$on("$destroy",function(){n.unbind("mouseover",o)})}return t}app.directive("rgKeyUp",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(r){}}t.bind("keyup",r),e.$on("$destroy",function(){t.unbind("keyup",r)})}}),app.directive("rgKeyPress",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(r){}}t.bind("keypress",r),e.$on("$destroy",function(){t.unbind("keypress",r)})}}),app.directive("rgFocus",function(){return function(e,t,n){e.$watch(n.rgFocus,function(e){e?t[0].focus():t[0].blur()})}}),angular.module("ringid.utils").directive("midWidth",midWidth),midWidth.$inject=["Utils","SystemEvents"];function midWidth(e,t){return function(n,r){function i(t){var n=e.calCulateCellWidth(t);r.removeClass("cols-1 cols-2 cols-3"),r.addClass("cols-"+t),n?r.css({width:n*t+10*t-20+"px"}):r.css({width:"415px"})}n.$on(t.COMMON.COLUMN_CHANGED,function(e,t){i(t)}),n.$on(t.COMMON.WINDOW_RESIZED,function(){i(e.feedColumn())}),n.$on("$routeChangeSuccess",function(){i(e.feedColumn())}),i(e.feedColumn())}}!function(e,t){"use strict";e.module("ringid.directives",["ringid.config","ringid.connector","ringid.global_services"])}(angular,window),angular.module("ringid.directives").directive("rgBottomReached",rgBottomReached),rgBottomReached.$inject=["GlobalEvents"];function rgBottomReached(e){var t={restrict:"EA",scope:{enabled:"@",loadMore:"&"},link:n};function n(t){var n;t.$watch("enabled",function(t){"true"===t?e.bindHandler("document","scroll",r):e.unbindHandler("document","scroll",r)});function r(){clearTimeout(n),n=setTimeout(e,100);function e(){window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&t.loadMore()}}t.$on("$destroy",function(){e.unbindHandler("document","scroll",r)})}return t}function loadTemplate(e,t,n,r,i){r.get(e).success(function(e){n.append(i(e)(t)),t.$rgDigest()})}angular.module("ringid.directives").directive("rgTemplate",["$ringhttp","$compile",function(e,t){return{restrict:"AE",link:function(n,r,i){loadTemplate(i.templateUrl,n,r,e,t)}}}]).directive("userSearchInput",[function(){return{scope:{searchKey:"="},restrict:"AE",templateUrl:"templates/partials/usercards/search-input.html"}}]).directive("userInfoView1",[function(){return{restrict:"AE",templateUrl:"templates/partials/usercards/user-info-view-1.html",link:function(e,t,n){n.userActionsTpl&&(e.userActionsTpl=n.userActionsTpl),e.getMemberObject=function(e){return e.value},e.getUserObject=function(e){return e.value.getUser()},e.$watch(function(){return e.member.value.getUser()},function(){e.$rgDigest()})}}}]).directive("userMemberType",["$ringhttp","$compile",function(e,t){return{restrict:"AE",link:function(n,r,i){var o="templates/partials/usercards/member-type.html";i.templateUrl&&(o=i.templateUrl),loadTemplate(o,n,r,e,t)}}}]).directive("userActions",["$ringhttp","$compile",function(e,t){return{restrict:"AE",link:function(n,r,i){var o="templates/partials/usercards/user-actions.html";i.templateUrl&&(o=i.templateUrl),loadTemplate(o,n,r,e,t)}}}]).directive("friendOnlineStatus",["$ringhttp","$compile",function(e,t){return{restrict:"AE",replace:!0,scope:{user:"="},link:function(n,r,i){var o="templates/partials/friend-online-status.html";i.templateUrl&&(o=i.templateUrl),loadTemplate(o,n,r,e,t)}}}]).directive("userFriendshipType",["$ringhttp","$compile","rgDropdownService","Ringalert","friendsFactory","APP_CONSTANTS",function(e,t,n,r,i,o){return{restrict:"AE",link:function(a,s,c){var l=a.member.value,u=l.isCurrentUser(),d="templates/partials/usercards/user-friendship-type.html";function g(){return l&&l.getUser()?l.getUser().friendshipStatus():-1}function E(){var e=g();switch(e){case o.NOT_FRIEND:a.actionObject={action:"addfriend"},a.friendTypeText="Add Friend",a.friendTypeClass="add-fnd";break;case o.FRIEND:a.friendTypeText="Friend",a.friendTypeClass="fnd";break;case o.INCOMING_FRIEND:a.actionObject={action:"accept"},a.friendTypeText="Accept",a.friendTypeClass="accept";break;case o.OUTGOING_FRIEND:a.actionObject={action:"reject"},a.friendTypeText="Cancel Request",a.friendTypeClass="cancel-req";break;default:a.friendTypeClass=""}}function m(e){var t;n.close(e),t=l.getUser().friendshipStatus(),t!==o.FRIEND&&(l.getUser().isLoading()||(a.actionObject.event=e,a.actionObject.friend=a.member.getUser(),i.friendAction(a.actionObject,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()}))),a.$rgDigest()}u||(a.friendTypeText="",a.friendTypeClass="",a.memberAction=m,a.actionObject={},c.templateUrl&&(d=c.templateUrl),loadTemplate(d,a,s,e,t),a.$watch(g,function(){E()}),a.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),r.show("Coming soon","info")})}}}]);var app=angular.module("ringid.directives");app.directive("rgWizard",function(){return{restrict:"E",templateUrl:"templates/partials/wizard/base.html",link:function(e){function t(){var t;return e.steps.forEach(function(n){n.id===e.currentStep&&(t=n)}),t}function n(){return e.rgWizardData.onFinish}function r(t){return e.rgWizardData.steps[t]}e.rgWizardData&&(e.nextButtonText="Next",e.doneButtonText="Done",e.showNextButton=!0,e.showDoneButton=!0,e.hideSteps=e.rgWizardData.hideSteps||!1,e.steps=e.rgWizardData.steps,e.totalSteps=e.steps.length,e.totalSteps&&(e.currentStep=e.steps[0].id,e.isFinishStep=function(t){return t===e.steps[e.totalSteps-1].id},e.onFinish=n(),e.refreshStepParams=function(){var n=t();e.disableNextButton=!n.showNextButton(),e.isFinishStep(e.currentStep)?e.nextButtonText="Done":e.nextButtonText="Next",e.$rgDigest()},e.goToStep=function(t){var n=r(t),i=n.showNextButton();t>=0&&t<e.totalSteps&&i&&(e.currentStep=t,e.refreshStepParams())},e.goNextStep=function(){e.isFinishStep(e.currentStep)?(n().call(),e.$rgDigest()):e.currentStep<e.totalSteps-1&&(e.currentStep+=1,e.refreshStepParams())},e.goPrevStep=function(){e.currentStep>0&&(e.currentStep-=1,e.refreshStepParams())},e.$watch(function(){var e=t();return e.showNextButton()},function(){e.refreshStepParams()}),e.refreshStepParams()))}}}),app.directive("rgWizardStepList",function(){return{restrict:"E",templateUrl:"templates/partials/wizard/steps.html",link:function(e){!e.rgWizardData}}}),angular.module("ringid.directives").directive("rgRoundProgress",roundProgress);function roundProgress(){var e;function t(e){var t,n,r,i,o,a,s,c,l,u,d;return 1===e.length&&(t=e[0],i=document.createElement("canvas"),{pre:function(e){var g=(window.outerWidth-20)/1920;n=+(e.roundProgressBarStyle.dataRoundProgressWidth||"200")*g,r=+(e.roundProgressBarStyle.dataRoundProgressHeight||"200")*g,i.setAttribute("width",n),i.setAttribute("height",r),i.setAttribute("data-round-progress-model",t.getAttribute("data-round-progress-model")),t.parentNode.replaceChild(i,t),o=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleWidth||"4")*g,a=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleWidth||"8")*g,l=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleRadius||"85")*g,u=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleRadius||"85")*g,d=+(e.roundProgressBarStyle.dataRoundProgressLabelFont||"24")*g+"px Arial",s=e.roundProgressBarStyle.dataRoundProgressOuterCircleForegroundColor||"#13A8E8",c=e.roundProgressBarStyle.dataRoundProgressLabelColor||"#fff"},post:function(e){var t,g,E,m,T,f,p=i.getAttribute("data-round-progress-model");e.$watch(p,function(e,p){t=i.getContext("2d"),t.clearRect(0,0,n,r),g=n/2,E=r/2,t.beginPath(),t.arc(g,E,parseInt(u,10),0,2*Math.PI,!1),t.lineWidth=parseInt(a,10),t.strokeStyle="rgba(255,255,255,0.5)",t.globalCompositeOperation="source-over",t.stroke(),t.font=d,t.textAlign="center",t.textBaseline="middle",t.fillStyle=c,t.fillText(e.label+"%",g,E),m=-(Math.PI/2),T=2*Math.PI*e.percentage-Math.PI/2,f=!1,t.beginPath(),t.arc(g,E,parseInt(l,10),m,T,f),t.lineWidth=parseInt(o,10),t.strokeStyle=s,t.stroke()},!0)}})}return e={compile:t,replace:!0}}angular.module("ringid.directives").directive("rgLoading",rgLoading),rgLoading.$inject=["$rootScope","SystemEvents"];function rgLoading(e,t){function n(n,r){e.$on(t.AUTH.LOGIN,function(){r[0].style.display="none",n.$rgDigest()}),e.$on(t.LOADING,function(e,t){t?r[0].style.display="block":r[0].style.display="none"}),r[0].style.display="none"}return{restrict:"E",template:'<a class="glo-l ng-cloak"> <span class="load-circle"><span class="ld-cir1 glo-cir"></span><span class="ld-cir2 glo-cir"></span><span class="ld-cir3 glo-cir"></span><span class="ld-cir4 glo-cir"></span><span class="ld-cir5 glo-cir"></span><span class="ld-cir6 glo-cir"></span><span class="ld-cir7 glo-cir"></span><span class="ld-cir8 glo-cir"></span><span class="ld-cir9 glo-cir"></span><span class="ld-cir10 glo-cir"></span><span class="ld-cir11 glo-cir"></span><span class="ld-cir12 glo-cir"></span></span><span class="glo-type">Processing...</span></a>',scope:{rgLoadingObj:"="},link:n}}angular.module("ringid.directives").directive("rgGlobalLoader",rgGlobalLoader);function rgGlobalLoader(){return{restrict:"E",template:'<div id="global-loader" class="rgbubbling"><span id="rgbubbling_1"></span><span id="rgbubbling_2"></span><span id="rgbubbling_3"></span></div>'}}angular.module("ringid.directives").directive("rgEmotion",rgEmotionDirective).directive("rgEmotionDropdown",rgEmotionDropdown),rgEmotionDirective.$inject=["$compile","$document","EmotionFactory"];function rgEmotionDirective(e,t,n){function r(r,i){var o;r.active=!1,r.emotionFilterText="",r.initEMotionList=c,r.choose=s,i.on("click",u),t.on("click",d),r.close=l;function a(){r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}function s(e,t){r.onSelect({item:e}),r.emotionFilterText="",r.initEMotionList("none",t),r.active=!1,a()}function c(t){n.init(),o||(o=e('<rg-emotion-dropdown filter-text="emotionFilterText" focus-filter="active" on-close="close" on-select="choose"></rg-emotion-dropdown>')(r),i.after(o)),o.css("display",t)}function l(e){r.active&&(r.initEMotionList("none",e),r.active=!1),a()}function u(e){e.preventDefault(),r.active?r.initEMotionList("none",e):r.initEMotionList("block",e),r.active=!r.active,a()}function d(e){e.target!==i[0]&&e.target.parentNode&&e.target.parentNode!==i[0]&&e.target.parentNode.parentNode!==i[0]&&"pt-top"!==e.target.className&&r.close(e)}r.$on("$destroy",function(){i.off("click",u),t.off("click",d),o=void 0})}return{restrict:"A",scope:{onSelect:"&"},link:r}}rgEmotionDropdown.$inject=["EmotionFactory","rgScrollbarService"];function rgEmotionDropdown(e,t){function n(e){e.stopPropagation()}return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&onClose"},templateUrl:"templates/dropdowns/emotion-dropdown.html",compile:function(){return{pre:function(n,r){var i=!1;n.emotions={},n.emotions[0]=e.getEmotions(),n.setEmotion=function(e){n.emotions[0]=e,n.$rgDigest()},e.setScopeForDigest(n),n.updateModel=function(e){n.filterText=e.target.value,n.$parent.$rgDigest()},n.loading=!!n.emotions.length,n.choose=angular.isFunction(n.onSelect)?n.onSelect():angular.noop,n.close=angular.isFunction(n.onClose)?n.onClose():angular.noop,n.processKeyup=o,n.activeId=0,n.setActiveId=a,r.bind("keydown",s),r.bind("mouseleave",c);function o(e){var r;return i?void e.preventDefault():(38===e.keyCode||40===e.keyCode?(r=this.selectionStart,this.value=(38===e.keyCode?1:-1)+parseInt(this.value,10),this.selectionStart=r,this.selectionEnd=r,i=!0,setTimeout(function(){i=!1},1),e.preventDefault()):n.updateModel(e),void t.scrollTo(n.$parent,".active",!1,!1,90))}function a(e){n.activeId=e}function s(e,t){var r=t||e.which||e.keyCode||e.key;13===r?n.emotions[0].length&&(n.choose(n.emotions[0][n.activeId],e),n.filterText=""):38===r?n.activeId=Math.max(n.activeId-1,0):40===r?n.activeId=Math.min(n.activeId+1,n.emotions[0].length-1):n.updateModel(e),n.$rgDigest()}function c(){n.activeId=0}n.$on("$destroy",function(){e.removeScope(n),r.unbind("keydown",s),r.unbind("mouseleave",c)})},post:function(e,t){t.on("click",n),e.$on("$destroy",function(){t.off("click",n)}),e.$rgDigest()}}}}}angular.module("ringid.directives").directive("rgPhotos",rgPhotos),rgPhotos.$inject=["Utils"];function rgPhotos(e){t.$inject=["rgScrollbarService","$scope","$rootScope","$routeParams","userFactory","$$stackedMap","SystemEvents","$ringbox","Ringalert","$$connector","OPERATION_TYPES","Api","$$albumMap"];function t(e,t,n,r,i,o,a,s,c,l,u,d,g){var E,m,T,f,p=u.SYSTEM.IMAGE;t.profileObj=i.getUser(r.uId),t.showAlbumPreview=!0,t.activeAlbum=null,t.state={imagesLoading:!1,albumsLoading:!1,noMoreImage:!1},t.albums=o.createNew(),t.loadMoreImage=h,t.deleteImage=C,t.getImageData=A,t.toggleAlbumPreview=S,t.selectPhoto=v;function _(e,t){clearTimeout(E),E=setTimeout(I,100,e,t)}function I(n,r){"album"===r?t.state.albumsLoading=n:(t.state.imagesLoading=n,e.recalculate(t)),t.$rgDigest()}function h(){var e,n,r;!t.activeAlbum||t.state.imagesLoading||t.state.albumsLoading||(n=t.activeAlbum.getImages().length(),r=t.activeAlbum.getTotalImageCount(),n<r?(_(!0,"image"),e={st:n,albId:t.activeAlbum.getKey()},t.profileObj.isCurrentUser()||(e.futId=T),d.image.albumImages(e)):t.state.noMoreImage=!0)}function A(e){return function(){return{image:e,album:t.activeAlbum,popupFrom:"profile"}}}function C(e){var n="Are you sure you want to delete?",r=s.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"});r.result.then(function(n){function r(n){n.sucs===!0?t.activeAlbum.removeImage(e.getKey()):c.show("Image delete failed","error"),t.$rgDigest()}n&&d.image.remove(e.getKey()).then(r)})}function S(e){e?(t.state.noMoreImage=!1,t.activeAlbum=e,t.showAlbumPreview=!1,t.activeAlbum.getImages().length()<20&&t.loadMoreImage()):(t.showAlbumPreview=!0,t.activeAlbum=null),t.$rgDigest()}function v(e){"true"===t.forSelection&&n.$broadcast(a.IMAGE.DO_REPOSITION,{image:e.src(),iurl:e.src("iurl"),albumType:t.activeAlbum.getType()})}function M(){var e,n,r;m=t.profileObj.getUId(),T=t.profileObj.getUtId();function i(i){switch(i.actn){case p.TYPE_ALBUM_IMAGES:t.activeAlbum&&(i.sucs===!0?(t.activeAlbum.pushImages(i),_(!1,"image")):i.sucs===!1&&1111===i.rc&&t.loadMoreImage());break;case p.FETCH_ALBUM_LIST:if(i.sucs===!0){for(e=0,r=i.albumList.length;e<r;e++)n=new g(i.albumList[e],m),t.albums.save(n.getKey(),n);_(!1,"album")}else i.sucs===!1&&1111===i.rc?d.image.albumList(T):_(!1,"album")}}f=l.subscribe(i,{action:[p.TYPE_ALBUM_IMAGES,p.FETCH_ALBUM_LIST]}),_(!0,"album"),d.image.albumList(T)}M(),t.$on("$destroy",function(){t.albums.reset(),l.unsubscribe(f)})}function n(t,n){!t.hasOwnProperty("forSelection")||t.forSelection!==!0&&"true"!==t.forSelection||(n[0].children[0].children[0].style.overflow="hidden",n[0].children[0].children[0].style.maxHeight=e.viewportsize().y-200+"px"),t.$rgDigest()}return{restrict:"E",controller:t,link:n,templateUrl:"templates/profile/photos.directive.html",scope:{forSelection:"@",$close:"&boxClose"}}}angular.module("ringid.directives").directive("rgHref",rgHref),rgHref.$inject=["$location","$route","$rootScope"];function rgHref(e,t,n){function r(r,i){var o=/#/g.exec(r);o=o?r.substr(o.index+1):r,e.path()===o&&"true"===i.reloadpage&&t.reload(),n.$coreDigest()}function i(e,t,n){var i;n.$observe("rgHref",function(e){return i&&t.unbind("click",r),e?(i=angular.bind(null,r,e,n),t.attr("href",e),void t.bind("click",i)):void t.removeAttr("href")}),e.$on("$destroy",function(){i&&t.unbind("click",i)})}return i}angular.module("ringid.directives").directive("rgFriendDropdown",rgFriendDropdown),rgFriendDropdown.$inject=["friendsFactory","$filter","$$q","Utils"];function rgFriendDropdown(e,t,n,r){return{scope:{filterText:"=",focusFilter:"=",onSelect:"&",onClose:"&",tagItems:"="},templateUrl:function(e,t){return t.templateUrl||"templates/dropdowns/tag-friend-dropdown.html"},compile:function(){return{pre:function(t,n){var i,o=!1,a=!1;t.users=[],t.$watch("filterText",r.debounce(l,1e3)),t.loading=!!t.users.length,t.choose=u,t.close=angular.isFunction(t.onClose)?t.onClose():angular.noop,t.processKeyup=d,t.activeId=0,t.setActiveId=g,n.bind("keydown",E),n.bind("mouseleave",m);function s(e){t.users=e,t.loading=!1,o=!1,t.activeId>=t.users.length&&(t.activeId=0),t.$rgDigest()}function c(){i=e.myFriends(10,t.filterText,t.tagItems),i.then(s),t.loading=!0,o=!0}function l(e,t){o=!1,c()}function u(e,n){t.onSelect()(e.value||e,n),t.$rgDigest()}function d(e){var t;return a?void e.preventDefault():void(38!==e.keyCode&&40!==e.keyCode||(t=this.selectionStart,this.value=(38===e.keyCode?1:-1)+parseInt(this.value,10),this.selectionStart=t,this.selectionEnd=t,a=!0,setTimeout(function(){a=!1},1),e.preventDefault()))}function g(e){t.activeId=e}function E(e,n){var r=n||e.which||e.keyCode||e.key;13===r?t.users.length&&(t.choose(t.users[t.activeId],e),t.filterText=""):38===r?t.activeId=Math.max(t.activeId-1,0):40===r&&(t.activeId=Math.min(t.activeId+1,t.users.length-1)),t.$rgDigest()}function m(){t.activeId=0}t.$on("$destroy",function(){n.unbind("keydown",E),n.unbind("mouseleave",m)})},post:function(e,t){t.on("click",function(e){e.stopPropagation()}),e.$rgDigest()}}}}}angular.module("ringid.directives").directive("rgHovercard",rgHovercard),rgHovercard.$inject=["$ringhttp","$templateCache","$compile"];function rgHovercard(e,t,n){function r(t,r,i){var o;function a(e){var a,s=!1;function c(){s&&o&&(o.off("mouseenter",l),o.off("mouseleave",u),o.remove(),o=void 0),s=!1}function l(){s=!1}function u(){s=!0,c()}function d(){s||(o||(o=angular.element('<div class="fr-menu"></div>'),o.html(e),r.after(o)),i.onHoverStart&&"function"==typeof t[i.onHoverStart]&&t[i.onHoverStart](),n(o)(t),o.css({display:"block"}),o.on("mouseleave",u),o.on("mouseenter",l),t.$rgDigest())}function g(){s=!0,window.setTimeout(c,500),window.clearTimeout(a),a=!1,r.off("mouseleave",g)}function E(e){a||(a=window.setTimeout(d.bind(this,e),1200)),r.on("mouseleave",g)}r.on("mouseenter",E),t.$on("$destroy",function(){g(),r.off("mouseenter",d),r.off("mouseleave",g)})}"false"!==i.rgHovercard&&e.get(i.hoverTemplateUrl).success(function(e){a(e)})}return{scope:!0,link:r}}angular.module("ringid.directives").directive("rgImg",rgImg).directive("rgImgChange",rgImgChange).directive("rgImageUrl",rgImageUrl).directive("rgPlayPopup",rgPlayPopup).directive("rgImagePopup",rgImagePopup),rgPlayPopup.$inject=["$ringbox"];function rgPlayPopup(e){return{scope:{rgPlayPopup:"=",isVideo:"@",playerId:"@"},link:function(t,n){t.$watch("rgPlayPopup",function(e){e&&(n.off("click",r),n.on("click",r),t.$on("$destroy",function(){n.off("click",r)}))});function r(){e.open({type:"remote",scope:t,templateUrl:"templates/media-viewer.html"})}}}}rgImagePopup.$inject=["$ringbox"];function rgImagePopup(e){return{scope:{rgImagePopup:"=",title:"="},link:function(t,n){t.$watch("rgImagePopup",function(e){e&&(n.off("click",r),n.on("click",r),t.$on("$destroy",function(){n.off("click",r)}))});function r(){e.open({type:"remote",scope:t,templateUrl:"templates/image-viewer.html"})}}}}rgImageUrl.$inject=["SystemEvents"];function rgImageUrl(e){return{require:"^rgImgChange",link:function(t,n,r,i){function o(){i.setPopupStyle(n[0].height,n[0].width),t.$emit(e.RINGBOX.UPDATE)}n[0].onload=o,n[0].src=t.rgImagePopup,t.$on("$destroy",function(){n[0].onload=null})}}}function rgImgChange(){e.$inject=["$element"];function e(e){this.setPopupStyle=function(t,n){e[0].style.height=t+"px",e[0].style.width=n+"px"}}return{restrict:"A",controller:e}}rgImg.$inject=["$compile","Utils","GlobalEvents","SystemEvents"];function rgImg(e,t,n,r){function i(i,o,a,s){var c=500,l=500,u=0,d=0,g=300,E=60,m=0,T=0,f=0,p=0,_=e('<img src="'+i.rgImgObj.src()+'" />')(i);m=t.viewport.x-40-g-E,T=t.viewport.y-40-E,u=m-l>l?m-l:l,d=T-c>c?T-c:c,o.append(_),n.bindHandler("document","keyup",I);function I(e){var t=e.keyCode||e.which;return 37===t?i.onImageChange({direction:"prev"}):39===t&&i.onImageChange({direction:"next"}),!1}a.$observe("rgImg",h);function h(e){_[0].setAttribute("src",""),_[0].setAttribute("src",e),A(i.rgImgObj.getIh(),i.rgImgObj.getIw())}function A(e,t){e>T||t>m?t/m>=e/T?(f=m,p=Math.floor(m/t*e)):(p=T,f=Math.floor(T/e*t)):(p=e,f=t),_[0].style.width=f+"px",_[0].style.height=p+"px",f<u&&(f=u),p<d&&(p=d),f<u&&(f=u),p<d&&(p=d),f=f+g+E,p+=E,"false"===a.commentsection&&(f-=300),s.setPopupStyle(p,f),i.$emit(r.RINGBOX.UPDATE),i.$on("$destroy",function(){n.unbindHandler("document","keyup",I)})}}return{restrict:"A",require:"^rgImgChange",scope:{rgImgObj:"=",onImageChange:"&"},link:i}}angular.module("ringid.directives").directive("rgSrc",rgSrc);function rgSrc(){function e(e,t,n){function r(e){null===e||void 0===e?t.removeAttr("src"):t.attr("src",e)}n.rgSrc&&e.$watch(n.rgSrc,r)}return{restrict:"A",link:e}}angular.module("ringid.directives").directive("rgRepeat",rgRepeat),rgRepeat.$inject=["$parse","$rootScope","$animate","SystemEvents"];function rgRepeat(e,t,n,r){function i(){return function(i,o,a,s,c){var l,u,d,g,E=a.rgRepeat,m=E.match(/^\s*(.+)\s+in\s+(.*?)\s+track\s+by\s+(.+)\s*$/),T=Object.create(null);if(!m)throw new Error("Expected expression in form of '_item_ in _collection track by _key_'");d=document.createComment(" end rgRepeat: "+E+" "),l=m[2],g=e(m[3]),u=m[1],i.$watchCollection(l,f);function f(e){var a,s,l,E,m,f,p,_,I,h=e.length,A=o[0],C=Object.create(null);t.$$postDigest(function(){for(a=0;a<e.length;a++)l=e[a],T[l.$TrackID]&&(f=T[l.$TrackID],f.childHead&&(f.scope.$$childHead=f.childHead))});function S(e){var t=d.cloneNode(!1);e[e.length++]=t,n.enter(e,null,angular.element(A)),A=t,f.clone=e,f.startNode=e[0]}for(a=0;a<h;a++)l=e[a],p={},p[u]=l,m=g(i,p),T[m]?(f=T[m],delete T[m]):(E=i.$new(),E[u]=l,f={},f.clone=null,f.scope=E),e[a].$TrackID=m,C[m]=f;for(m in T)if(T[m]){for(f=T[m],s=0;s<f.clone.length;s++)A.parentNode.removeChild(f.clone[s]);f.scope.$destroy()}for(a=0;a<h;a++)l=e[a],m=l.$TrackID,f=C[m],f.scope.$index=a,I=f.clone,I?(_=A,f.startNode!==_&&n.move(f.clone,null,angular.element(A)),A=f.clone[f.clone.length-1],f.childHead=f.scope.$$childHead,f.scope.$$childHead=null):c(f.scope,S);i.target&&i.target.getMapKey&&i.$emit(r.FEED.HEIGHT,i.target.getMapKey()),T=C}}}return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:i}}angular.module("ringid.directives").factory("ReportHttpService",ReportHttpService).controller("ReportController",ReportController).directive("rgReport",rgReport),ReportHttpService.$inject=["$$connector","$$q","OPERATION_TYPES","SPAM_TYPES"];function ReportHttpService(e,t,n,r){var i,o=n.SYSTEM.REPORT,a={};i={getSpamReasonList:s,reportSpam:c};function s(i){var s,c=t.defer();if(!i||"string"!=typeof i)throw new Error("PARAMS_ERROR spamType Must be string");return s=r[i.toUpperCase()],a[s]?setTimeout(function(){c.resolve(a[s])}):e.pull({actn:o.ACTION_SPAM_REASON_LIST,spmt:s},n.SYSTEM.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?(a[s]=e.rsnLst,c.resolve(a[s])):c.reject(e)},function(e){c.reject(e)}),c.promise}function c(t){var i;if(!t.spmt||!t.spmid||!t.rsnid)throw new Error("PARAMS_ERROR");return i={actn:o.ACTION_REPORT_SPAM,spmt:r[t.spmt],spmid:t.spmid,rsnid:t.rsnid},e.request(i,n.SYSTEM.REQUEST_TYPE.UPDATE)}return i}ReportController.$inject=["$scope","remoteData","ReportHttpService","Ringalert","ChatMessageMap","ChatFactory"];function ReportController(e,t,n,r,i,o){e.title="Let us know why that's bothers you !",e.spamList=t,e.reason=e.spamList[0].id;function a(){n.reportSpam({spmt:e.spamType.toUpperCase(),spmid:e.spamId,rsnid:e.reason}).then(function(t){var n;e.$close(),t.sucs?(n={title:"Done!",message:t.mg,showCancel:!1},r.alert(n)):r.show(t,"error")})}function s(){var t,n,i="",a="Unable to submit report, Please try agian later",s="Report successfully submitted. Your report will be reviewed soon";return e.spamList.forEach(function(t){t.id===parseInt(e.reason,10)&&(i=t.rsn)}),t=o.getBoxByUtId(e.boxId),n=t.getMessage(e.spamId),i&&t&&n?void n.doReport(i).then(function(){e.$close(),t&&t.removeMessage(e.spamId),setTimeout(function(){r.alert({title:"Done!",message:s,showCancel:!1})},200)},function(){e.$close(),setTimeout(function(){r.show(a,"error")},200)}):void r.show(a,"error")}e.report=function(){return e.reason?void("chat_message"!==e.spamType?a():s()):void(e.error="Please choose one reason")}}rgReport.$inject=["$ringbox","ReportHttpService","rgDropdownService"];function rgReport(e,t,n){return{restrict:"EA",scope:{spamId:"=",boxId:"@",spamType:"@"},link:function(r,i){function o(i){n.close(i),e.open({type:"remote",scope:r,controller:"ReportController",resolve:{remoteData:t.getSpamReasonList(r.spamType)},templateUrl:"templates/popups/rg-report.html"})}i.on("click",o),r.$on("$destroy",function(){i.off("click",o)})}}}angular.module("ringid.directives").directive("rgStopEvent",rgStopEvent);function rgStopEvent(){function e(e,t){var n;n=t.on("click",function(e){e.stopPropagation(),e.preventDefault()}),e.$on("$destroy",function(){t.off("click",n)})}return{restrict:"A",link:e}}angular.module("ringid.directives").factory("HideUnhideHttpService",HideUnhideHttpService).controller("HideUnhideController",HideUnhideController),HideUnhideHttpService.$inject=["$$connector","$$q","OPERATION_TYPES"];function HideUnhideHttpService(e,t,n){var r,i=n.SYSTEM.HIDE_UNHIDE;r={hideUnhide:o};function o(t,r,o){var a={};if(!angular.isArray(t)||!r||!angular.isDefined(o))throw new Error("PARAMS_ERROR: INVALID type or val and targetIds must be array");if("feed"===r)a.actn=i.ACTION_HIDE_UNHIDE_FEED,a.feedIdList=t;else if("user"===r)a.actn=i.ACTION_HIDE_UNHIDE_USER_FEED,a.utIDLst=t;else{if("circle"!==r)throw new Error("PARAMS_ERROR: INVALID type :="+r);a.actn=i.ACTION_HIDE_UNHIDE_CIRCLE_FEED,a.IDLst=t}return a.hid=!!o,e.request(a,n.SYSTEM.REQUEST_TYPE.UPDATE)}return r}HideUnhideController.$inject=["$scope","HideUnhideHttpService","MESSAGES"];function HideUnhideController(e,t,n){e.title=n.HIDE_UNHIDE.FEED_TITLE,e.subTitle=n.HIDE_UNHIDE.FEED_SUBTITLE,e.hideUnhide=function(n){return t.hideUnhide([e.targetKey],e.hideType,n)}}!function(e,t){"use strict";e.module("ringid.notification",["ringid.config","ringid.directives"])}(angular,window),angular.module("ringid.notification").factory("$$notiMap",$$notiMap),$$notiMap.$inject=["OPERATION_TYPES","Utils","settings","routeService"];function $$notiMap(e,t,n,r){var i=e.SYSTEM.NOTIFICATION,o={acId:0,cmnId:0,fndId:0,fndN:"",id:0,imgId:0,loc:0,mt:0,nfId:0,ut:0,nt:0,prIm:0,message:"",updateTime:"",popupType:"",groupId:0,user:null,seen:!1,valid:!0,mayMerge:1,othersCounter:0};function a(e){var t="",n={message:"",popupType:"",mayMerge:1};function r(){var t="",n=e.uIdList.length-1;return n>1?t=" and "+n+" others ":1===n&&(t=" and "+n+" other "),t}switch(e.mt){case i.MSG_TYPE_UPDATE_PROFILE_IMAGE:n.message=" changed profile photo",n.popupType="image",n.mayMerge=2;break;case i.MSG_TYPE_UPDATE_COVER_IMAGE:n.message=" changed cover photo",n.popupType="image",n.mayMerge=2;break;case i.MSG_TYPE_LIKE_IMAGE:n.message=r()+" liked your photo",n.popupType="image";break;case i.MSG_TYPE_IMAGE_COMMENT:n.message=r()+" commented on your photo",n.popupType="image";break;case i.MSG_TYPE_LIKE_IMAGE_COMMENT:n.message=r()+" liked your comment",n.popupType="image";break;case i.MSG_TYPE_ADD_FRIEND:n.message=" wants to be friends with you",n.popupType="profile";break;case i.MSG_TYPE_ACCEPT_FRIEND:n.message=" has accepted your friend request",n.popupType="profile";break;case i.MSG_TYPE_ADD_GROUP_MEMBER:n.message=" has added you in a circle "+t,n.popupType="group",n.mayMerge=0;break;case i.MSG_TYPE_ADD_STATUS_COMMENT:n.message=r()+" commented on your post",
n.popupType="feed";break;case i.MSG_TYPE_LIKE_STATUS:n.message=r()+" liked your post",n.popupType="feed";break;case i.MSG_TYPE_LIKE_COMMENT:n.message=r()+" liked your comment",n.popupType="feed";break;case i.MSG_TYPE_SHARE_STATUS:n.message=r()+" shared your post",n.popupType="feed";break;case i.MSG_TYPE_LIKE_AUDIO_MEDIA:n.message=r()+" liked your music",n.popupType="media";break;case i.MSG_TYPE_AUDIO_MEDIA_COMMENT:n.message=r()+" commented on your music",n.popupType="media";break;case i.MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:n.message=r()+" liked your comment",n.popupType="media";break;case i.MSG_TYPE_AUDIO_MEDIA_VIEW:n.message=r()+" viewed your music",n.popupType="media";break;case i.MSG_TYPE_LIKE_VIDEO_MEDIA:n.message=r()+" liked your video",n.popupType="media";break;case i.MSG_TYPE_VIDEO_MEDIA_COMMENT:n.message=r()+" commented on your video",n.popupType="media";break;case i.MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:n.message=r()+" liked your comment",n.popupType="media";break;case i.MSG_TYPE_VIDEO_MEDIA_VIEW:n.message=r()+" viewed you video",n.popupType="media";break;case i.MSG_TYPE_YOU_HAVE_BEEN_TAGGED:n.message=" tagged you in a status",n.popupType="feed";break;default:n.popupType="nomatch",n.mayMerge=0}return n}function s(e){this.updateNoti(e)}function c(e){var n;angular.isObject(e)?(this.noti?angular.extend(this.noti,e):(this.noti=angular.extend({},o,e),this.noti.uIdList=[]),this.noti.updateTime=t.verbalDate(this.noti.ut)||this.noti.ut,this.noti.fndId&&this.noti.uIdList.push(this.noti.fndId),n=a(this.noti),this.noti.message=n.message,this.noti.popupType=n.popupType,this.noti.mayMerge=n.mayMerge,""===this.noti.message&&(this.noti.valid=!1)):this.noti.valid=!1}function l(){return this.noti.valid}function u(){return this.noti.ut}function d(){return this.noti.fndN}function g(e){return this.noti.uIdList.indexOf(e)>-1}function E(e){var t;if(e&&e.length)for(t=0;t<e.length;t++)this.noti.uIdList.indexOf(e[t])===-1&&this.noti.uIdList.push(e[t]);return this.noti.uIdList}function m(){return this.noti.fndId}function T(){var e,t;return this.noti.user?e=this.noti.user.avatar("thumb"):this.noti.prIm?(t=this.noti.prIm.lastIndexOf("/")+1,e=[n.imBase,this.noti.prIm.slice(0,t),"pthumb",this.noti.prIm.slice(t)].join("")):e="images/prof.png",e}function f(){return this.noti.message}function p(e){return e?this.noti.ut:this.noti.updateTime}function _(){this.noti.updateTime=t.verbalDate(this.noti.ut)}function I(){return this.noti.id}function h(){return this.noti.popupType}function A(){return this.noti.mt}function C(){return this.noti.nt}function S(){return this.noti.acId}function v(){return this.noti.nfId}function M(){var e="",t={};switch(this.noti.popupType){case"image":t.mediaId=this.noti.imgId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=r.getRoute("SINGLE_IMAGE",t);break;case"media":t.mediaId=this.noti.imgId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=r.getRoute("SINGLE_MEDIA",t);break;case"profile":e=r.getRoute("PROFILE",{uId:this.noti.fndId});break;case"group":e=r.getRoute("CIRCLE",{circleId:this.noti.acId});break;case"feed":t.feedId=this.noti.nfId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=r.getRoute("SINGLE_FEED",t);break;default:e=""}return e}function D(){return this.noti.imgId}function O(){return this.noti.cmnId}function R(){return this.noti.seen}function N(e){this.noti.seen=e}function P(){return this.noti.mayMerge}function y(e){var t;this.noti.othersCounter+=e||0,t=a(this.noti),this.noti.message=t.message}function b(){var e="";switch(this.noti.popupType){case"image":e="templates/partials/notification/image-popup.html";break;case"media":e="templates/partials/notification/media-popup.html";break;case"feed":e="templates/partials/notification/feed-popup_with_image.html";break;default:e=""}return e}function U(){return"image"===this.noti.popupType&&"RingBoxImageController"||"feed"===this.noti.popupType&&"NotiPopupController"||"media"===this.noti.popupType&&"RingBoxMediaController"}function L(){return"feed"===this.noti.popupType||"image"===this.noti.popupType||"media"===this.noti.popupType}return s.prototype={updateNoti:c,isValid:l,sortBy:u,getName:d,isInUidList:g,uIdList:E,getUid:m,getUserAvatar:T,getMessage:f,getTime:p,updateNotiTime:_,getKey:I,getPopupType:h,getMessageType:A,getNotiType:C,getActivityId:S,getNewsFeedId:v,getLink:M,getImgId:D,getCommentId:O,getSeenStatus:R,updateSeenStatus:N,canMerge:P,setNotiMessage:y,getRingboxTemplate:b,getControllerName:U,showRingbox:L},function(e){return new s(e)}}angular.module("ringid.notification").service("notificationHttpService",notificationHttpService),notificationHttpService.$inject=["$$connector","settings","OPERATION_TYPES"];function notificationHttpService(e,t,n){var r=this,i=n.SYSTEM.NOTIFICATION,o=n.SYSTEM.REQUEST_TYPE;r.requestNotification=s,r.clearNotiCount=a,r.getNotificationDetails=c,r.getImageAlbumDetails=l;function a(){var t=new Date,n={actn:i.CLEAR_NOTIFICATION_COUNTER,ut:t.getTime()};return e.request(n,o.REQUEST)}function s(t){var n={actn:i.TYPE_MY_NOTIFICATIONS};return t&&t.from_index>0&&(n=angular.extend({},n,t)),e.send(n,o.REQUEST)}function c(t){var r={actn:n.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:t.activityId};return e.request(r,o.REQUEST)}function l(t){var r={actn:n.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,request_type:o.REQUEST,imgId:t.imgId};return e.request(r,o.REQUEST)}}angular.module("ringid.notification").factory("NotificationFactory",NotificationFactory),NotificationFactory.$inject=["$$connector","$$q","Storage","notificationHttpService","$$stackedMap","$$notiMap","OPERATION_TYPES"];function NotificationFactory(e,t,n,r,i,o,a){var s=i.createNew(!0,"desc"),c=a.SYSTEM.NOTIFICATION,l=0,u=0,d=!1,g=-1,E={loading:!1,noMoreData:!1};function m(e){var t,r,i,a,d,m,T,f=!0;function p(e){function n(){e.value.getTime(!0)<t.getTime(!0)?(u=u>0?u-1:0,t.uIdList(e.value.uIdList()),t.setNotiMessage(),s.remove(e.value.getKey())):(f=!1,e.value.uIdList(t.uIdList()),e.value.setNotiMessage())}if(e.value.getMessageType()===t.getMessageType())if(1===e.value.canMerge())switch(e.value.getPopupType()){case"feed":e.value.getNewsFeedId()===t.getNewsFeedId()&&n(e.value.isInUidList(t.getUid())?!1:!0);break;case"image":case"media":e.value.getImgId()===t.getImgId()&&n(e.value.isInUidList(t.getUid())?!1:!0)}else 2===e.value.canMerge()&&e.value.getUid()===t.getUid()&&n(!1)}switch(e.actn){case c.TYPE_MY_NOTIFICATIONS:if(e.sucs===!0){for(m=[],l+=e.nList.length,a=parseInt(n.getData("oldNotiCount"),10),a>e.tn?(u=e.tn,n.setData("oldNotiCount",0)):u=e.tn-a,r=0;r<e.nList.length;r++)if(f=!0,t=o(e.nList[r]),t.isValid()&&(s.all().forEach(p),m.push(e.nList[r].ut),d=n.getData("notiseen"),f)){for(i=0;i<d.length;i++)d[i]===e.nList[r].id&&t.updateSeenStatus(!0);s.save(t.getKey(),t)}T=m.sort(),g=T[0]||g}else e.sucs===!1&&1111!==e.rc&&(E.noMoreData=!0);E.loading=!1;break;case c.TYPE_SINGLE_NOTIFICATION:l++,f=!0,t=o(e),t.isValid()&&(s.all().forEach(p),f&&s.save(t.getKey(),t),u++)}}function T(){d||(d=!0,e.subscribe(m,{action:[c.TYPE_MY_NOTIFICATIONS,c.TYPE_SINGLE_NOTIFICATION]}),f())}function f(e){var t,n=e||10;E.noMoreData||E.loading||(t={from_index:l>0?l:0,to_index:l>0?l+n:n,scl:2,ut:g},E.loading=!0,r.requestNotification(t))}function p(){return u>99?"99+":u}function _(){var e,t;for(u>0&&(n.setData("oldNotiCount",u+parseInt(n.getData("oldNotiCount"),10)),u=0),e=0;e<s.length();e++)t=Date.now()-s.all()[e].value.sortBy(),t<36e5&&s.all()[e].value.updateNotiTime()}function I(e){return s.get(e)}function h(){return s}return{init:T,state:E,fetchNotification:f,getNotifications:h,getNotification:I,clearCounter:_,getNotiCount:p}}angular.module("ringid.notification").controller("NotiController",NotiController),NotiController.$inject=["NotificationFactory","$location","Auth","rgDropdownService","Ringalert","circlesManager","Storage","$scope","rgScrollbarService","$$connector","notificationHttpService","SystemEvents","Api","routeService","OPERATION_TYPES"];function NotiController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m){var T,f,p=10,_=m.SYSTEM.NOTIFICATION;s.state=e.state,s.notifications=e.getNotifications(),s.routes={notifications:E.getRoute("NOTIFICATIONS")},s.loadMoreNotification=A,s.getRingboxData=I,s.notificationAction=h,S();function I(e){switch(e.value.getPopupType()){case"image":return h({action:"image",noti:e.value,nfId:e.value.getNewsFeedId(),imgId:e.value.getImgId(),templateType:"image"});case"media":return h({action:"media",noti:e.value,nfId:e.value.getNewsFeedId(),mediaId:e.value.getImgId(),templateType:"media"});case"feed":return h({action:"ringbox",nfId:e.value.getNewsFeedId(),noti:e.value,templateType:"feed_with_text"});default:return!1}}function h(e){var r,s,c=a.getData("notiseen");switch(c||(c=[],a.setData("notiseen",c)),c.indexOf(e.noti.getKey())===-1&&(c.push(e.noti.getKey()),e.noti.updateSeenStatus(!0),c.length>150&&c.shift()),a.setData("notiseen",c),e.action){case"redirect":s=o.getCircle(e.circleId),s?(r=e.link.slice(1),t.path(r)):i.show("Circle does not exist!","error");break;case"ringbox":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,templateType:e.templateType}},promise:u.getNotificationDetails({activityId:e.nfId})};case"media":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,mediaId:e.mediaId,popupFrom:"notification",templateType:e.templateType}},promise:g.media.mediaDetails({cntntId:e.mediaId,utId:n.currentUser().getUtId()})};case"image":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,imgId:e.imgId,popupFrom:"notification",templateType:e.templateType}},promise:g.image.details(e.imgId)}}return!1}function A(){s.state.loading||s.state.noMoreData||(e.fetchNotification(p),s.$rgDigest(),T||setTimeout(C,1e4))}function C(){T=!1,clearTimeout(T),s.state.loading=!1,c.recalculate(s),s.$rgDigest(!0)}function S(){t.path()===s.routes.notification&&(p=50),0===s.notifications.length()?e.init():s.notifications.length()<p&&A(),f=l.subscribe(C,{action:[_.TYPE_MY_NOTIFICATIONS,_.TYPE_SINGLE_NOTIFICATION]})}s.$on("$destroy",function(){l.unsubscribe(f)})}angular.module("ringid.notification").controller("NotiPopupController",NotiPopupController),NotiPopupController.$inject=["$$connector","OPERATION_TYPES","Auth","$scope","localData","remoteData","NotificationFactory","$$feedMap","feedFactory","rgDropdownService","Ringalert","MESSAGES"];function NotiPopupController(e,t,n,r,i,o,a,s,c,l,u,d){var g,E,m=!0;r.currentUser=n.currentUser(),r.feed={},r.focused=!1,r.showCommentBox=!0,r.showFeedFullContent=!0,r.nocontent=!1,r.ddHtml="templates/dropdowns/feed-edit-dropdown.html",r.getMediaData=T,i&&i.notiKey&&(r.key=i.notiKey,r.noti=i.noti,r.templateType=i.templateType),r.boxIsLoading=!1,o.sucs===!1?(r.nocontent=!0,u.show("Content not found","error"),r.$close()):(g=angular.fromJson(o.newsFeedList),m&&g[0]&&g[0].orgFd?(r.feed=s.create(g[0]),E=s.create(g[0].orgFd),r.feed.shares(E)):r.feed=s.create(o.newsFeedList[0]),r.keyid=r.feed&&r.feed.getKey()),(r.feed.hasMedia()||r.feed.hasSharedFeed()&&r.feed.getOrginalFeed().getImages().length)&&(r.templateType="feed_with_image"),r.noti.getCommentId()>0&&(r.activeCommentId=r.noti.getCommentId());function T(e,t){var n;return n=t||r.feed,{data:function(){var t;return t=n.getAlbum().getContents().all(),t=t.map(function(e){return e.value}),{media:e,playlist:t,feedTime:n.time()}},promise:e.fetchDetails()}}r.shareMenuDisabled=!!r.shareMenuDisabled&&r.shareMenuDisabled,r.toggleCommentBox=f,r.toggleShareBox=p,r.getImageData=_;function f(e){e.stopPropagation(),r.showCommentBox=!r.showCommentBox,r.showCommentBox&&(r.showShareBox=!1)}function p(e){var t=r.feed.hasSharedFeed()?r.feed.getOrginalFeed():r.feed,n=t.isShareAble(!0);e.stopPropagation(),n.sucs?(r.showShareBox=!r.showShareBox,r.showShareBox&&(r.showCommentBox=!1)):u.show(d[n.rc],"warning")}function _(e,t){return function(){return{image:e,feed:t}}}}angular.module("ringid.notification").controller("ImageController",["$routeParams","$scope","Auth","$$imageMap","$$stackedMap","Api","$$connector","OPERATION_TYPES",function(e,t,n,r,i,o,a,s){var c,l,u,d=i.createNew(),g=!1,E=s.SYSTEM.IMAGE;t.showCommentBox=!0,t.nextImg=!1,t.prevImg=!1,t.changeImage=p,t.openRingboxLike=T,t.actionImageDropdown=angular.noop,t.showOption=m,t.ddTemplate='<div class="ng-cloak action pad-204 feed-drop_top"><i class="drop-sprite curve-a p-ab curve-b-ico bottom11"></i><div class="ac-top-line" ng-if="ddControl.showReportButton()"><a class="pad-8-14" rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()"> <i class="drop-sprite media-report-mar w-h-13 report-ico feed-font"></i>Report</a></div></div>';function m(){return t.image.ddControl.showReportButton()}function T(){return t.image&&t.image.getLikes()>0}function f(){var e,n,r;g||(n=t.params.album.getImages().length(),r=t.params.album.getTotalImageCount(),n<r?(e={st:n,albId:t.params.album.getKey()},t.params.album.owner().isCurrentUser()||(e.futId=t.params.album.owner().getUtId()),o.image.albumImages(e)):g=!0)}function p(e){var n=!1;"next"===e?(t.image=d.next(t.image.getKey())||d.bottom(),n=d.next(t.image.getKey())):(t.image=d.previous(t.image.getKey())||d.top(),n=d.previous(t.image.getKey())),n&&"profile"===t.params.popupFrom&&f(),h(e),t.$rgDigest()}function _(e){var n,i,a,s;function c(e){if(e.sucs===!0){for(n=e.newsFeedList[0].imageList,a=n.length,s=0;s<a;s++)n[s].nfId=e.nfId,1===a&&(n[s].ic=e.newsFeedList[0].ic,n[s].nc=e.newsFeedList[0].nc,n[s].il=e.newsFeedList[0].il,n[s].nl=e.newsFeedList[0].nl),n[s].imgId===t.image.getKey()?(t.image.updateImage(n[s]),d.save(t.image.getKey(),t.image)):(i=r(n[s],t.feed.user()),d.save(i.getKey(),i));I()}}e?o.image.feedImages(e).then(c):(d=t.params.album.getImages(),I())}function I(){d.length()>1&&(t.nextImg=!!d.next(t.image.getKey())||!!d.bottom(),t.prevImg=!!d.previous(t.image.getKey())||!!d.top()),t.$rgDigest()}function h(e){var n,r=new Image;clearTimeout(c),n="next"===e?d.next(t.image.getKey()):d.previous(t.image.getKey()),n&&setTimeout(function(){r.src=n?n.src():""},100)}function A(){u=a.subscribe(function(e){t.image&&t.image.getKey()===e.imgId&&(t.image.setTotalComment(e.loc),t.$rgDigest())},{action:[E.TYPE_UPDATE_ADD_IMAGE_COMMENT,E.TYPE_UPDATE_DELETE_IMAGE_COMMENT]});function e(e){e.sucs===!0&&(t.params.album.pushImages(e),_())}t.params.image?t.image=t.params.image:t.params.imgId&&(t.remoteData?t.image=r(t.remoteData):o.image.details(t.params.imgId).then(function(e){t.image=e,t.$rgDigest()})),t.params.feed&&(t.feed=t.params.feed,_(t.feed.getKey())),"profile"===t.params.popupFrom&&(_(),l=a.subscribe(e,{action:[E.TYPE_ALBUM_IMAGES]})),t.$rgDigest()}A(),t.$on("$destroy",function(){u&&a.unsubscribe(u),a.unsubscribe(l)})}]),angular.module("ringid.notification").controller("MediaController",MediaController),MediaController.$inject=["APP_CONSTANTS","fileUploadService","$routeParams","$scope","Auth","rgDropdownService","Media","$$connector","OPERATION_TYPES","Ringalert","feedFactory","$ringbox","$$mediaMap"];function MediaController(e,t,n,r,i,o,a,s,c,l,u,d,g){var E,m=c.SYSTEM.MEDIA;r.currentUser=i.currentUser(),r.showCommentBox=!0,r.changeMedia=A;function T(){window.FB&&window.FB.ui({method:"share",href:r.media.getEmbedUrl()},function(e){})}r.actionImageDropdown=_,r.shareMedia=C,r.selectAlbum=h,r.showOptionMenu=I,r.ddTemplate='<div class="ng-cloak action pad-2-2 vp-position"><i class="drop-sprite curve-a p-ab curve-b-ico bottom11"></i><div class="ac-top-line dis_ib bs-box w-100-per" ng-if="ddControl.showReportButton()"><a class="pad-8-14" rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()"><i class="drop-sprite w-h-13 report-ico feed-font"></i>Report</a></div><div class="ac-top-line dis_ib bs-box w-100-per" ng-if="ddControl.showAddToAlbum()"><a class="pad-8-14" rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true"ringbox-type="remote" ringbox-target="templates/dropdowns/popup-album-dropdown.html" ringbox-data="ddControl.getRingboxData()"><i class="drop-sprite w-h-13 add-album-ico feed-font"></i>Add to Album</a></div> <div class="ac-top-line dis_ib bs-box w-100-per" ng-if="ddControl.showMediaShareButton()"> <a class="pad-8-14" href="javascript:void(0);"  rg-click="ddAction()({event: $event, action:\'shareToFb\' })" ><i class="drop-sprite w-h-13 fb-share-ico feed-font"></i>Share in Facebook</a></div> </div>',r.params&&"notification"===r.params.popupFrom?r.remoteData&&r.remoteData.sucs?(r.media=g(r.remoteData.mdaCntntDTO),r.album=a.getAlbum(r.media.getAlbumId())):(l.show("Content not found","error"),r.$close()):(r.media=r.params.media,r.playlist=r.params.playlist),r.media&&!r.media.owner().hasDetails()&&r.media.owner().requestUserDetails().then(function(){r.$rgDigest()});function f(){r.media.setMediaToken().then(function(){r.$rgDigest()})}function p(){r.media.increaseView().then(function(){r.$rgDigest()},function(){r.$rgDigest()}),f()}function _(e){"shareToFb"===e.action&&T()}function I(){return r.media.ddControl.showReportButton()||r.media.ddControl.showAddToAlbum()||r.media.ddControl.showMediaShareButton()}function h(e){return{data:function(){return{media:e}}}}function A(e){r.media=e,r.media.fetchDetails(),p(),r.$rgDigest()}function C(){var e=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:r.media},backDropClose:!0,templateUrl:"templates/home/share-media.html"});e.result.then(function(){r.$rgDigest()})}E=s.subscribe(function(e){r.media&&r.media.getKey()===e.cntntId&&r.media.setTotalComment(e.loc)},{action:[m.ACTION_UPDATE_ADD_MEDIA_COMMENT,m.ACTION_UPDATE_DELETE_MEDIA_COMMENT]}),r.$on("$destroy",function(){E&&s.unsubscribe(E)})}angular.module("ringid.notification").controller("RingBoxImageController",RingBoxImageController),RingBoxImageController.$inject=["$scope","$boxInstance","$controller","localData","remoteData"];function RingBoxImageController(e,t,n,r,i){e.close=t.close,r&&r.imgId&&(e.templateType=r.templateType),e.params=r,e.remoteData=i,r.noti&&r.noti.getCommentId()>0&&(e.activeCommentId=r.noti.getCommentId()),n("ImageController",{$scope:e})}angular.module("ringid.notification").controller("RingBoxMediaController",RingBoxMediaController),RingBoxMediaController.$inject=["$scope","$boxInstance","$controller","localData","remoteData"];function RingBoxMediaController(e,t,n,r,i){e.close=o,r&&r.mediaId&&(e.templateType=r.templateType),e.params=r,e.remoteData=i,n("MediaController",{$scope:e}),e.destroyPlayer=angular.noop;function o(){e.destroyPlayer(),t.close()}}!function(e,t){"use strict";e.module("ringid.friend",["ringid.config","ringid.shared"])}(angular,window),angular.module("ringid.friend").directive("rgFriends",rgFriends),FriendsController.$inject=["$scope","$attrs","rgScrollbarService","friendsFactory","Contacts","userFactory","$$stackedMap","rgDropdownService","$$connector","OPERATION_TYPES","Ringalert","Api","$routeParams"];function FriendsController(e,t,n,r,i,o,a,s,c,l,u,d,g){var E,m,T=l.SYSTEM.FRIENDS,f=0,p=!0,_=[];e.isOwner=!1,e.showMutual=!1,e.showPending=!1,e.friendName="",e.state={loading:!1,noData:!1},e.friends=r.getFriends(e.rgFriendsType),e.totalFriends=r.totalFriends,e.getPendingCount=r.getPendingCount,e.toggleShowMutual=h,e.toggleShowPending=A,e.loadMoreFriends=M,e.getMutualFriend=D,e.searchContact=v,e.showComingSoon=I;function I(e){e.preventDefault(),e.stopPropagation(),u.show("Coming soon","info")}function h(t){e.showMutual=!!t,e.showMutual&&C(),e.$rgDigest()}function A(t){e.showPending=!!t,e.showPending?(e.friends=r.getFriends("outgoing"),S(!0),r.getContactDetails("outgoing").then(function(){S(!1)},function(){S(!1)})):e.friends=r.getFriends(e.rgFriendsType),e.$rgDigest()}function C(){var t,n;function i(r){if(r.sucs===!0)for(n=0;n<r.contacts.length;n++)t=o.create(r.contacts[n]),e.friends.save(t.getKey(),t);S(!1)}function a(e){e.sucs===!1&&1111===e.rc?C():S(!1)}_.length>0&&(S(!0),r.getContactDetailsByUtIds(_.splice(0,10),!0).then(i,a))}function S(t){e.state.loading=!!t,t||n.recalculate(e),e.state.loading||(e.state.noData=0===e.friends.length()&&0===i.utIds().length()),e.$rgDigest()}function v(){("friends"===e.rgFriendsType||"friendslist"===e.rgFriendsType)&&e.friendName&&e.friendName.length>0&&(S(!0),r.searchContact({schPm:e.friendName},!0).then(function(){S(!1)},function(){S(!1)}))}function M(t){var n,i;e.showMutual?C():e.showPending?(S(!0),r.getContactDetails("outgoing").then(function(){S(!1)},function(){S(!1)})):(t||!e.state.loading&&e.friends.length()!==e.totalFriends(e.rgFriendsType))&&(S(!0),"userfriends"===e.rgFriendsType?(n=r.getUserContacts,i=e.profileObj.getUtId()):n=r.getContactDetails,n(i).then(a,s));function a(){e.friends.length()<20&&e.friends.length()<e.totalFriends(e.rgFriendsType)?(S(!1),M()):S(!1),o.refreshPesence(!0)}function s(n){n.sucs===!1&&1111===n.rc?M(t):"friendslist"===e.rgFriendsType&&f<5?(f++,setTimeout(function(){M(t)},2e3)):S(!1)}}function D(e){return{data:function(){return{target:e}},promise:d.user.getMutualFriends(e)}}function O(){e.ddTemplate='<div class="action pad-204 friend-ac z-in-110"><i class="drop-sprite curve-a curve-t-ico p-ab top11"></i><div class="ac-top-line"><a class="pad-8-14" ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event: $event})" href="#"  ng-cloak="true"> <i class="drop-sprite w-h-13 remove-member-ico feed-font"></i>{{consType.unfriend}}</a></div><div class="ac-top-line"  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" ><a class="pad-8-14" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" href="#"  ng-cloak="true"><i class="drop-sprite w-h-13 block-ico feed-font"></i>{{consType.block}}</a></div><div class="ac-top-line"  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" ><a class="pad-8-14" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" href="#"  ng-cloak="true"><i class="drop-sprite w-h-13 unblock-ico feed-font"></i>{{consType.unblock}}</a></div></div>',e.ddAction=N,e.showBackKey=0,e.showBack=R}function R(t,n){var r=n.target.getAttribute("data-is-anchor");r||(e.showBackKey=t,n.preventDefault(),n.stopPropagation(),e.$rgDigest())}function N(t){t.friend.isLoading()||(r.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),s.close(t.event))}function P(){switch(m=c.subscribe(function(t){switch(t.actn){case T.TYPE_CONTACT_UTIDS:"friends"!==e.rgFriendsType&&"friendslist"!==e.rgFriendsType||!p||(p=!1,setTimeout(function(){i.utIds().length()>0&&e.friends.length()<20&&M(!0),e.state.noData=0===e.friends.length()&&0===i.utIds().length()},1e3));break;default:S(!1)}},{action:[T.TYPE_CONTACT_UTIDS,T.TYPE_UPDATE_ADD_FRIEND,T.TYPE_UPDATE_DELETE_FRIEND],callWithUnresolved:!0}),e.rgFriendsType){case"friendslist":e.specialFriends=r.getFriends("specialfriends");break;case"friends":r.initFriends(),e.isOwner=!0,e.pendingRequests=r.getFriends("outgoing"),O(),E=setTimeout(e.toggleLoading,6e4);break;case"userfriends":O(),e.totalUserFriends=r.totalUserFriends,e.profileObj=o.getUser(g.uId),M(!0),d.user.getMutualFriends(e.profileObj).then(function(t){t.sucs===!0&&(e.profileObj.updateUserObj({nmf:t.mfIDs.length}),_=t.mfIDs,e.$rgDigest())}),E=setTimeout(e.toggleLoading,6e4)}}P(),e.$on("$destroy",function(){clearTimeout(E),"userfriends"===e.rgFriendsType&&r.resetUserFriends(),c.unsubscribe(m)})}rgFriends.$inject=["friendsFactory","$ringhttp","$compile","$routeParams","$window","$document","Contacts","APP_CONSTANTS","Utils"];function rgFriends(e,t,n,r,i,o,a,s,c){function l(r,l,u){var d,g,E,m;r.stopOrdering=!1,t.get(u.rgFriendsTpl).success(function(e){l.append(n(e)(r)),r.$rgDigest()}),u.shareData&&(r.shareData=u.shareData);function T(){i.innerHeight+i.scrollY>=o[0].body.offsetHeight&&r.loadMoreFriends()}"friends"!==r.rgFriendsType&&"userfriends"!==r.rgFriendsType||angular.element(i).on("scroll",T),m=c.onCustomEvent("PRESENCE_UPDATE",function(){r.$rgDigest(!0)});function f(){r.stopOrdering=!1}function p(){r.stopOrdering=!0}g=c.debounce(p,500),E=c.debounce(f,500),l.on("mouseover",g),l.on("mouseleave",E),r.$on("$destroy",function(){var t;switch(r.rgFriendsType){case"friends":for(d=e.outgoingFriends.keys(),t=0;t<d.length;t++)a.add("outgoingUtIds",d[t],{frnS:s.INCOMING_FRIEND});e.outgoingFriends.reset();break;case"userFriends":angular.element(i).off("scroll",T)}c.removeCustomEvent("PRESENCE_UPDATE",m),l.off("mouseover",g),l.off("mouseleave",E)})}return{restrict:"AE",scope:{rgFriendsType:"@",boxClose:"&"},controller:FriendsController,link:l}}angular.module("ringid.friend").directive("rgRequests",rgRequests),rgRequests.$inject=["friendsFactory","$compile","$routeParams","$window","$document","$ringhttp","routeService"];function rgRequests(e,t,n,r,i,o,a){s.$inject=["$scope","Api","rgScrollbarService","Contacts","OPERATION_TYPES","$$connector","userFactory","Ringalert","SystemEvents"];function s(t,n,r,i,o,s,c,l,u){var d,g=o.SYSTEM.FRIENDS,E=parseInt(t.loadCount,10);t.state={loading:!1},t.routes={requests:a.getRoute("FRIEND_REQUESTS")},t.requests=e.getFriends("incoming"),t.getRequestCount=e.getRequestCount,t.statusText=f,t.noMoreRequest=m,t.loadMoreRequests=_;function m(){return!e.state.gotUtId||e.state.gotUtId&&0===i.incomingUtIds().length()}function T(){return 0===i.incomingUtIds().length()&&0===t.requests.length()}function f(){var n="";return!t.state.loading&&e.state.gotUtId&&(T()?n="No friend request yet.":m()&&(n="No More Friend Request")),n}function p(e){t.state.loading=e,e||(r.recalculate(t),t.$emit(u.FEED.HEIGHT)),t.$rgDigest()}function _(n){(n||!m()&&!t.state.loading)&&(p(!0),e.getContactDetails("incoming",E).then(r,i));function r(){p(!1)}function i(e){e.sucs===!1&&1111===e.rc?_(!0):p(!1)}}function I(){E>20&&t.$emit(u.FEED.HEIGHT),i.incomingUtIds().length()>0&&t.requests.length()<E?_(!0):p(!1),d=s.subscribe(function(e){switch(e.actn){case g.TYPE_CONTACT_UTIDS:i.incomingUtIds().length()>0&&t.requests.length()<E&&_(!0);break;default:p(!1)}},{action:[g.TYPE_CONTACT_UTIDS,g.TYPE_UPDATE_ADD_FRIEND,g.TYPE_UPDATE_DELETE_FRIEND]})}I(),t.$on("$destroy",function(){s.unsubscribe(d)})}function c(e,n,r){var i=r.templateUrl?r.templateUrl:"templates/dropdowns/friend-request-dropdown.html";o.get(i).success(function(r){n.append(t(r)(e)),e.$rgDigest()})}return{restrict:"AE",scope:{loadOnScroll:"@",loadCount:"@",templateUrl:"@"},link:c,controller:s}}!function(e,t){"use strict";e.module("ringid.header",["ringid.config","ringid.auth","ringid.shared","ringid.notification","ringid.friend","ringid.chat"])}(angular,window),angular.module("ringid.header").controller("HeaderController",HeaderController),HeaderController.$inject=["$scope","$rootScope","$location","$$connector","OPERATION_TYPES","routeService","friendsFactory","NotificationFactory","Auth","rgScrollbarService","chatHistoryFactory","Utils","SystemEvents","ConversationsFactory","StickerFactory"];function HeaderController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m){var T,f,p,_=this,I=i.SYSTEM,h=C();_.getActiveMenu=S,_.logout={ddHtml:"templates/dropdowns/logout-dropdown.html",ddControl:{currentUser:c.currentUser(),routes:{accountSetting:o.getRoute("PROFILE",{uId:c.currentUser().getUId(),utId:c.currentUser().getUtId(),subpage:"about"}),stickerMarket:o.getRoute("STICKER_HOME"),chatGroups:o.getRoute("CHAT_GROUPS"),chatRooms:o.getRoute("CHAT_ROOMS"),faq:o.getRoute("FAQ"),contact:o.getRoute("CONTACT"),savedFeeds:o.getRoute("SAVED_FEEDS")},getNewStickerCount:m.getNewStickerCount},ddAction:function(){c.logout()},ddOpened:function(){C("logout")},ddBeforeClose:function(){C("")}},_.freq={ddTemplate:'<rg-requests load-on-scroll="true" load-count="10" ></rg-requests>',ddOpened:function(){C("friend_request")},ddBeforeClose:function(){C("")}},_.requestCount=a.getRequestCount,setTimeout(a.initFriends,2e3),_.chatHistory={ddHtml:"templates/partials/chat/chat-history-dropdown.html",ddOpened:function(){var e=0,t=20,n=1,r=0;u.resetConversationCount(),E.sendGetConversationRequest(e,t,n,r),C("chat_history"),d.triggerCustomEvent(g.CHAT.CONVERSATION_COUNT_RESETED)},ddBeforeClose:function(){C("")}},_.unreadChatConversationCount=u.getUnreadConversationCount,f=d.onCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){e.$rgDigest()}),p=d.onCustomEvent(g.STICKER.NEW_STICKER_INFO_UPDATED,function(){e.$rgDigest()}),_.noti={ddHtml:"templates/dropdowns/notification-dropdown.html",ddOpened:function(){s.clearCounter(),C("notification")},ddBeforeClose:function(){C("")}},_.notiCount=s.getNotiCount,T=r.subscribe(function(){e.$rgDigest(!0)},{action:[I.FRIENDS.TYPE_UPDATE_ADD_FRIEND,I.FRIENDS.TYPE_UPDATE_DELETE_FRIEND,I.NOTIFICATION.TYPE_MY_NOTIFICATIONS,I.NOTIFICATION.TYPE_SINGLE_NOTIFICATION]}),setTimeout(function(){s.init()},5e3),e.hideColumn=!1;function A(){var t=n.path();"/"===t?e.hideColumn=!1:e.hideColumn=!0}t.$on("$routeChangeStart",function(){A()}),A();function C(t){h=t&&""!==t?t:"/"===n.path()?"home":"none",e.$rgDigest()}function S(){return h}_.defaultSpan=d.getDefaultColumn,t.$on("$routeChangeStart",function(){C(),r.unsubscribe(T)}),e.$on(g.COMMON.WINDOW_RESIZED,function(){e.$rgDigest()}),e.$on(g.FRIEND.PENDING_FRIENDS_COUNT_CHANGED,function(){e.$rgDigest()}),e.$on("$destroy",function(){d.removeCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED,f),d.removeCustomEvent(g.STICKER.NEW_STICKER_INFO_UPDATED,p)})}angular.module("ringid.header").service("rgSearchService",searchService).directive("rgSearch",rgSearch),searchService.$inject=["GlobalEvents"];function searchService(e){var t=this,n=!1,r=!1;t.close=i,t.open=o;function i(){r&&(n.searchText="",r.style.display="none",n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))}function o(i,o){r=i,n=o,r.style.display="block",e.bindHandler("document","click",t.close)}}rgSearch.$inject=["rgSearchService"];function rgSearch(e){function t(t,n){var r=n.find("input");t.template=n[0].querySelector("#search-dropdown"),t.template.style.display="none",r.on("keypress",i),t.doTheSearch=a,n.on("click",o),t.$on("$destroy",function(){n.off("click",o)});function i(e){13===e.keyCode&&e.preventDefault()}function o(e){e.target.tagName&&"a"!==e.target.tagName.toLowerCase()&&e.target.parentNode&&e.target.parentNode.tagName&&"a"!==e.target.parentNode.tagName.toLowerCase()&&(e.stopPropagation(),e.preventDefault())}function a(){t.searchText.length>0?t.doSearch():e.close()}}n.$inject=["$scope","$$stackedMap","userFactory","friendsFactory","friendsHttpService","$timeout","rgScrollbarService"];function n(t,n,r,i,o,a,s){var c,l=0,u="";t.searchText="",t.gotAllResult=!1,t.showLoadbar=!1,t.noResult=!0,t.listData=n.createNew(),t.resetSearch=d,t.doSearch=m;function d(){l=0,t.noResult=!1,t.gotAllResult=!1,t.listData.reset(),t.$rgDigest()}function g(){u!==t.searchText&&(t.resetSearch(),l=0)}function E(){t.noResult=0===t.listData.length(),t.gotAllResult=t.listData.length()>0,t.showLoadbar=!1,t.$rgDigest()}function m(n){g(),(n||!t.showLoadbar&&!t.gotAllResult)&&(clearTimeout(c),t.showLoadbar=!0,t.showDropdown||e.open(t.template,t),u=t.searchText,o.searchContact({schPm:t.searchText,st:t.listData.length()}).then(T,T),c=setTimeout(E,8e3),t.$rgDigest())}function T(e){var n,i,o;if(clearTimeout(c),e.sucs===!0){for(n=0,i=e.searchedcontaclist.length;n<i;n++)o=r.create(e.searchedcontaclist[n]),o&&t.listData.save(o.getKey(),o);e.searchedcontaclist.length>0&&s.recalculate(t),t.showLoadbar=!1,t.noResult=0===t.listData.length(),t.$rgDigest()}else l++,l<3?m(!0):(clearTimeout(c),E())}}return{restrict:"E",scope:{placeholder:"@"},templateUrl:"templates/dropdowns/search-dropdown.html",link:t,controller:n}}!function(e,t){"use strict";e.module("ringid.postbox",[])}(angular,window),angular.module("ringid.postbox").controller("RingBoxFeedController",RingBoxFeedController),RingBoxFeedController.$inject=["$scope","$boxInstance","$controller","localData","remoteData"];function RingBoxFeedController(e,t,n,r,i){e.close=e.$close,e.feedMap=r.feed,i&&(i.newsFeedList?e.params.feed.parseMoreText(i.newsFeedList[0]):e.params.feed.parseMoreText(i))}angular.module("ringid.postbox").directive("rgPostbox",postbox);
function postbox(){return{scope:{forAdd:"@",feedMap:"=",setFeed:"&"},controller:postboxController,templateUrl:templateFunc}}templateFunc.$inject=["$attrs"];function templateFunc(e){return e.template?e.template:"templates/feed/postbox.html"}postboxController.$inject=["fileUploadService","$rootScope","$scope","feedFactory","userFactory","Auth","$timeout","$routeParams","$$stackedMap","arrayFilterFilter","$filter","SystemEvents","OPERATION_TYPES","rgDropdownService","Api","PrivacySet","MESSAGES","settings","Media","$$q","friendsFactory","APP_CONSTANTS","UPLOAD_TYPES"];function postboxController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I,h,A,C){var S,v,M,D,O,R,N,P={privacy:!1,location:!1,emotion:!1,friendTags:!1},y=A;n.uploadFiles=e.uploadFiles,n.shouldShow=w,n.shouldDisable=G,n.cancel=b,n.setPrivacy=B,n.getValidityValues=$,n.addFeed=H,n.selectedTimeout=x,n.selectedLocation=Y,n.chooseEmotion=K,n.hashTags=e.hashTags,n.fetchHashTags=j,n.selectHashTag=V,n.removeHashTag=W,n.shouldShowHashTag=q,n.friendTags=c.createNew(),n.toggleShowFriendTag=z,n.fetchFriends=Q,n.selectFriendTag=X,n.removeFriendTag=Z,n.getAlbums=J,n.selectAlbum=ee,k(),n.$on("$destory",te),n.$on(d.FILE_UPLOAD.QUEUE_START,function(){n.inputDisabled=!0,n.$rgDigest()}),n.$on(d.FILE_UPLOAD.QUEUE_COMPLETE,function(){n.inputDisabled=!1,n.$rgDigest()});function b(){e.resetUpload(),n.$parent&&n.$parent.$close&&n.$parent.$close({sucs:!1})}function U(t){var r,i;switch(n.editMode=!0,n.removedMedia=[],n.editorEnabled=!0,n.feedText=t.text(),n.editorContent=t.text(),n.feedText=t.text(),n.uploadSpec.type=t.getContentType(!0),n.uploadSpec.type){case"image":t.getImages(!0).doForAll(o);break;case"audio":t.getAudios(!0).doForAll(o),a();break;case"video":t.getMedias(!0).doForAll(o),a()}if(t.hasTagUsers())for(r=t.getTagUsers(),i=0;i<r.length;i++)n.friendTags.save(r[i].getKey(),r[i]);n.feedLocation=angular.copy(t.getLocationInfo()),n.ogData=angular.copy(t.getOgData()),n.validity=-1,n.ogData.image&&(n.ogData.images=[n.ogData.image]),n.ogShowPreview=t.hasOgData(),n.emotions=t.hasFeelings()?[t.getFeelings()]:[],n.sentRequest=!1,n.getFeedHtml=F,n.focus=!0;function o(t){var r;r=e.createUpload({uploadType:C.STATUS,feededit:!0,fileType:n.uploadSpec.type,file:"image"===n.uploadSpec.type?t.src("iurl"):t.getStreamUrlOnly(),key:t.getKey()}),r.setAuthData(t.getAuthData()),r.setPreview("image"===n.uploadSpec.type?t.src("300"):t.getThumb()),n.uploadFiles.push(r)}function a(){S=t.getAlbum(),n.albumName=S.getName()}}function L(t){t?U(t):(n.editMode=!1,n.emotions=[],e.resetUpload(),n.friendTags.reset(),n.feedText="",n.validity=-1,n.feedLocation={},n.ogData={}),n.ogDataLoading=!1,n.filterOnProgress=!1,n.ogShowPreview=!1,n.inputDisabled=!1,n.errorMessage="",n.$rgDigest()}function F(){return n.feedMap.getDynamicText()}function k(){var t;switch(M=!1,S=!1,n.albumName="",N={},v=(new Date).getTime(),n.privacySet=T,n.uploadSpec={type:"image"},e.setScopeForDigest(C.STATUS,n),n.feedMap?L(n.feedMap):L(),n.forAdd){case"circle":case"friend":n.showPrivacy=!1,D=!1;break;default:D=!0,n.showPrivacy=!0,n.privacy=T.PVC3}for("friend"===n.forAdd?N.friend=i.getUtIdByUId(s.uId):"circle"===n.forAdd&&(N.group=s.circleId),n.privacyTemplate='<div class="ng-cloak action feed-ac z-in-110 post-ac"><i class="drop-sprite curve-a curve-t-ico p-ab top11"></i><div class="ac-top-line ac-post-c" ><a class="pad-8-14" rg-click="ddAction()({event: $event, privacy:ddControl.PVC1.value})" href="#"><i class="img_sprite h-w-14-13 only-i feed-font"></i>{{::ddControl.PVC1.text}}</a></div><div class="ac-top-line ac-post-c"><a class="pad-8-14" rg-click="ddAction()({event: $event, privacy:ddControl.PVC2.value})" href="#"><i class="img_sprite h-w-14-13 fri-i feed-font"></i>{{::ddControl.PVC2.text}} </a></div><div class="ac-top-line ac-post-c"><a class="pad-8-14" rg-click="ddAction()({event: $event, privacy:ddControl.PVC3.value})" href="#"><i class="img_sprite h-w-14-13 pub-i feed-font"></i>{{::ddControl.PVC3.text}}</a></div></div>',n.showTimeout=!1,n.validity=-1,N.vlDtvldt=n.validity,n.selectOptions=[],n.selectOptions[0]={value:-1,title:"Unlimited"},t=1;t<=30;t++)n.selectOptions[t]={value:t,title:t+" Day"};R=r.getCurrentPageValue(),n.showAddTag=R.action!==g.SYSTEM.TYPE_GROUP_NEWS_FEED,n.$rgDigest()}function w(e){var t;switch(e){case"mediaupload":case"addtoalbum":t=("audio"===n.uploadSpec.type||"video"===n.uploadSpec.type)&&n.uploadFiles.length>0;break;case"gotupload":t=n.uploadFiles.length>0;break;case"friendtag":t=M;break;case"friendtagbutton":t=D;break;default:t=!1}return t}function G(e){var t;switch(e){case"input":t=n.inputDisabled||n.ogDataLoading||n.filterOnProgress;break;case"location":t=!1;break;case"link":t=n.uploadFiles.length>0||!!n.feedLocation.lat;break;case"mediaupload":t=!!n.ogData.url;break;default:t=!1}return t}function B(e){P.privacy=!0,n.privacy=T["PVC"+e.privacy],E.close(e.event),n.$rgDigest()}function $(){return new Array(30)}function H(){var t,i,a,s={vldt:n.validity};n.inputDisabled=!0,s=angular.extend({},N,{text:n.feedText,vldt:n.validity,files:e.uploadFiles,removedMedia:n.removedMedia,fileType:n.uploadSpec.type}),n.privacy&&(s.fpvc=n.privacy.value),n.feedLocation.description&&(s.lctn=n.feedLocation.description,s.lat=n.feedLocation.lat,s.lng=n.feedLocation.lng),n.ogData.url&&!n.feedLocation.description&&(s.lnkDmn=n.ogData.lnkDmn||n.ogData.url||"",s.lnkDsc=n.ogData.description||"",s.lnkTtl=n.ogData.title||"",s.lnkURL=n.ogData.url||"",s.lnlImgURL=n.ogData.image||""),n.emotions.length&&(s.mdIds=[n.emotions[0].id],n.emotions.length=0),n.friendTags.length()>0&&(s.tFrndIds=[],n.friendTags.doForAll(function(e){s.tFrndIds.push(e.getUtId())})),t=n.feedText,""!==s.text&&s.lnkURL&&(i=s.text.replace("https","").replace("http",""),a=s.lnkURL.replace("https","").replace("http",""),"/"===i[i.length-1]&&(i=i.slice(0,-1)),"/"===a[a.length-1]&&(a=a.slice(0,-1)),i===a&&(s.text=""));function c(){return!!s.lnkURL||s.files.length>0||!!s.mdIds&&s.mdIds.length>0||!!s.lctn||!!s.tFrndIds&&s.tFrndIds.length>0}function l(){var e,t,r,i=!0;return n.errorMessage="",""!==s.text?(t=s.text.length,r=s.text.getUTF8Length(),r>p.FEED_TEXT_LIMIT&&(e=Math.floor(t*p.FEED_TEXT_LIMIT/r),n.errorMessage=f.FTL_ERROR.supplant({length:t,max_limit:e}),i=!1)):c()||(i=!1,n.errorMessage=f.FEED_INV),i}function u(){v=O,r.addFeed(s,o.currentUser()).then(function(e){n.setFeed()(e),n.$parent.$rgDigest()},function(){n.setFeed()(),n.feedText=t,n.$broadcast("seteditor",t),n.$parent.$rgDigest()}),L(),n.setFeed()(),n.$broadcast("cleareditor"),n.$parent.$rgDigest()}function d(){v=O,r.updateFeedNew(n.feedMap,s).then(function(e){e.sucs===!0?n.$parent.$close({sucs:!0}):n.$parent.$close({sucs:!1})},function(){n.$parent.$close({sucs:!1})})}function g(){var e=n.editMode?d:u;O=Date.now(),O-v<200?setTimeout(e,200):e()}l()?"image"!==n.uploadSpec.type?(s.htgLst=n.hashTags,S?(s.albId=S.getId(),g()):n.albumName.length>0?_.createAlbum({albn:n.albumName,mdaT:"audio"===n.uploadSpec.type?y.NEWS_FEED_MEDIA_TYPE_AUDIO:y.NEWS_FEED_MEDIA_TYPE_VIDEO},!0).then(function(e){s.albId=e.getId(),g()}):(s.albId=-1,g())):g():(n.inputDisabled=!1,n.ogShowPreview=!1,n.$rgDigest())}function x(e){n.validity=e,n.$rgDigest()}function Y(e){P.location=!0,n.feedLocation=e||{},n.$rgDigest()}function K(e){P.emotion=!0,n.emotions.length=0,n.emotions.push(e),n.$rgDigest()}function j(e){var t=I.defer();function r(r){var i;r.sucs===!0?(i=u("filter")(l(r.sgstn,{filterArray:n.hashTags,key:"sk"}),{sk:e}),t.resolve(i.slice(0,5))):t.resolve([])}return m.media.hashtagSuggestion(e).then(r,function(){t.reject()}),t.promise}function V(e){"string"==typeof e||e instanceof String?n.hashTags.push({sk:e,ukey:0}):n.hashTags.push(e),n.$rgDigest()}function W(e,t){t.preventDefault(),e?n.hashTags.splice(e,1):n.hashTags.splice(n.hashTags.length-1,1),n.$rgDigest()}function q(){return n.uloadFiles.length>0&&"image"!==n.uploadSpec.type}function z(){M=!M,M&&n.$broadcast("focusSelector","friendtag"),n.$rgDigest()}function Q(e){return h.myFriends(5,e,n.friendTags)}function X(e){P.friendTag=!0,n.friendTags.save(e.value.getKey(),e.value),n.$rgDigest()}function Z(e,t){t.stopPropagation(),P.friendTag=!0,e?n.friendTags.remove(e.value.getKey()):n.friendTags.removeTop(),n.$rgDigest()}function J(e){return _.fetchAlbums(o.currentUser().getUtId(),n.uploadSpec.type,e)}function ee(e){"string"==typeof e||e instanceof String?(n.albumName=e,S=!1):(n.albumName=e.value.getName(),S=e.value),n.$rgDigest()}function te(){e.removeScope(C.STATUS,n)}}angular.module("ringid.postbox").directive("rgStatusUploads",rgStatusUploads),rgStatusUploads.$inject=["$compile","fileUploadService"];function rgStatusUploads(e,t){n.$inject=["Auth","$scope","mediaMetadata","imageQuality","APP_CONSTANTS","SystemEvents","Ringalert","$$q","$rootScope"];function n(e,n,r,i,o,a,s,c,l){var u=o.MEDIA_UPLOAD_SIZE_LIMIT,d={image:o.IMAGE_UPLOAD_LIMIT,audio:o.AUDIO_UPLOAD_LIMIT,video:o.VIDEO_UPLOAD_LIMIT},g=0;n.uploadFiles=t.uploadFiles,n.uploadProgress=t.uploadProgress,n.disableUpload=m,n.upload=E;function E(){var e,r,i=this,o=0,c=t.validateUpload(this.files[0]);if(c.valid)if(n.uploadSpec.type=c.fileType,i.files.length+n.uploadFiles.length>d[c.fileType])s.show("Maximum upload limit "+d[c.fileType],"warning");else{for(r=0;r<i.files.length;r++)o+=i.files[r].size;if("image"!==c.fileType&&o+g>u)s.show("Maximum allowed total upload files size 500MB!","warning");else{for(g+=o,e=t.uploadFiles.length,r=0;r<i.files.length;r++)t.queueFile({uploadType:"status",fileType:c.fileType,file:i.files[r]});l.$broadcast(a.FILE_UPLOAD.QUEUE_START),t.uploadQueue(e)}}else s.show("Invalid File","warning");i.value=null,n.$rgDigest()}n.$on(a.FILE_UPLOAD.UPLOADS_POSTED,T);function m(e){return!n.uploadEnabled||n.uploadFiles.length>0&&n.uploadSpec.type!==e}function T(){t.resetUpload(),g=0,n.$rgDigest()}}function r(e,t){var n,r,i;n=t[0].querySelector("input[data-upload-image]"),i=t[0].querySelector("input[data-upload-audio]"),r=t[0].querySelector("input[data-upload-video]"),n&&n.addEventListener("change",e.upload),i&&i.addEventListener("change",e.upload),r&&r.addEventListener("change",e.upload),e.$on("$destroy",function(){n.removeEventListener("change",e.upload),i.removeEventListener("change",e.upload),r.removeEventListener("change",e.upload)})}return{restrict:"AE",scope:{editMode:"=",uploadSpec:"=",uploadEnabled:"=",uploadAction:"&"},templateUrl:"templates/feed/postbox/status-upload-directive.html",link:r,controller:n}}angular.module("ringid.postbox").directive("rgUploadPreview",uploadPreview),uploadPreview.$inject=["fileUploadService","SystemEvents"];function uploadPreview(e,t){n.$inject=["$scope"];function n(n){var r=3,i=3,o=160;n.uploadFiles=e.uploadFiles,n.getMedia=l,n.loadPrevious=g,n.loadNext=E,n.removeMedia=u,n.calculateMargin=c,n.whichClass=s;function a(){n.previewStartAt=0,n.$rgDigest()}a(),n.$on(t.FILE_UPLOAD.UPLOADS_POSTED,a);function s(e){var t=n.previewStartAt>0?i:0;return e>=t&&e<t+3?"rg-show":"rg-hide"}function c(e){var t=n.previewStartAt>0&&0===e?1:0;return{"margin-left":i*t*o*-1+"px"}}function l(e){return e?n.uploadFiles:n.uploadFiles.slice(n.previewStartAt>0&&n.previewStartAt-r>0?n.previewStartAt-r:0,n.previewStartAt+3+r)}function u(e){n.editMode&&n.uploadFiles[e].feedEdit()&&n.removedMedia.push(n.uploadFiles[e].getKey()),n.uploadFiles[e].getQueued()&&n.uploadFiles[e].cancelUpload(),setTimeout(function(){n.uploadFiles.splice(e,1),0===n.uploadFiles.length?a():(n.previewStartAt=n.previewStartAt>0?n.previewStartAt-1:n.previewStartAt,n.$rgDigest())})}function d(){n.$rgDigest()}function g(){n.previewStartAt=n.previewStartAt-r>0?n.previewStartAt-r:0,setTimeout(d,1e3)}function E(){var e=n.uploadFiles.length-n.previewStartAt-r;n.previewStartAt=r<e?r:n.previewStartAt+e,i=n.previewStartAt>r?r:n.previewStartAt,setTimeout(d,1e3)}}return{restrict:"E",templateUrl:"templates/feed/postbox/upload-preview-directive.html",controller:n}}angular.module("ringid.shared").service("rgSelectorService",selectorService).directive("rgSelector",selector),selectorService.$inject=["GlobalEvents"];function selectorService(e){var t,n=this,r=!1,i=!1;n.close=s,n.open=a;function o(){r.resetSelector()}function a(n,a){i||t||(t=!0,i=n,r=a,i.style.display="block",e.bindHandler("document","click",o))}function s(){i&&t&&(t=!1,i.style.display="none",i=!1,r=!1,e.unbindHandler("document","click",o))}}selector.$inject=["$compile","fileUploadService","Media","rgSelectorService","SystemEvents"];function selector(e,t,n,r,i){function o(e,t){var n,o,a;e.$rgDigest(),e.selectedIndex=-1,e.itemList=[],e.filterText=e.initInput||"",e.resetSelector=s,e.select=u,e.mouseoverSelect=c,a=t[0].querySelector("input[data-selector-input]"),o=t[0].querySelector("div[data-selector-dropdown]"),t[0].addEventListener("click",g),a.addEventListener("keyup",m),a.addEventListener("keydown",E),a.addEventListener("click",g),o.style.display="none",e.$on(i.FILE_UPLOAD.UPLOADS_POSTED,function(){e.resetSelector(!0)});function s(t){e.selectedIndex=-1,t||(a.value=e.initInput||"",e.filterText=a.value),r.close(),e.$rgDigest()}function c(t){e.selectedIndex=t,e.$rgDigest()}function l(t){t?e.selectedIndex=e.selectedIndex>-1?e.selectedIndex-1:e.itemList.length-1:e.selectedIndex=e.selectedIndex+1>=e.itemList.length?-1:e.selectedIndex+1,e.$rgDigest()}function u(t,n){g(n),e.selectItem()(t),s(),a.focus()}function d(t){void 0!==e.initInput&&null!==e.initInput&&e.selectItem()(t)}function g(e){e.preventDefault(),e.stopPropagation()}function E(t){var n=t.keyCode||t.which,r=a.value.trim();return 8!==n||0!==r.length||(g(t),d(r),e.removeItem()(!1,t),!1)}function m(t){var i=t.keyCode||t.which,o=a.value.trim();switch(i){case 38:e.itemList.length>0&&(g(t),l(!0));break;case 40:e.itemList.length>0&&(g(t),l(!1));break;case 37:case 39:break;case 27:case 13:case 10:"true"===e.selectAny?o.length>0&&(e.selectedIndex>-1?e.select(e.itemList[e.selectedIndex],t):e.select(o,t)):e.selectedIndex>-1&&e.select(e.itemList[e.selectedIndex],t);break;case 8:if(0===o.length){r.close();break}default:o.length>0?(1===o.length&&f(t),clearTimeout(n),n=setTimeout(T,500)):(clearTimeout(n),r.close())}}function T(){var t=a.value.trim();0===e.itemList.length&&s(!0),d(t),e.loading=!0,e.fetchItems()(t).then(function(t){e.loading=!1,t.length>0&&a.value.trim().length>0?("true"===e.selectAny?e.selectedIndex=-1:e.selectedIndex=0,e.itemList=t,r.open(o,e),e.$rgDigest()):s(!0),e.$rgDigest()},function(){e.loading=!1,s(!0)})}function f(){o.style.left=a.offsetLeft+"px"}e.$on("focusSelector",function(t,n){e.identifier&&e.identifier===n&&setTimeout(function(){a.focus()},100)}),e.$on("$destroy",function(){a.removeEventListener("keyup",m),a.removeEventListener("keydown",E),a.removeEventListener("click",g)})}a.$inject=["$element","$attrs"];function a(e,t){return t.templateUrl}return{restrict:"E",link:o,scope:{identifier:"@",placeholder:"@",selectAny:"@",initInput:"=",templateUrl:"@",selectedItems:"=",fetchItems:"&",selectItem:"&",removeItem:"&"},templateUrl:a}}!function(e,t){"use strict";e.module("ringid.feed",["ngWebSocket","ringid.utils","ringid.config","ringid.connector","ringid.directives","ringid.postbox"])}(angular,window),angular.module("ringid.feed").directive("rgFeedSubscriber",rgFeedSubscriber),rgFeedSubscriber.$inject=["$$connector","feedFactory","$window","$$rgsyncher","OPERATION_TYPES","REASON_CODES","$rootScope"];function rgFeedSubscriber(e,t,n,r,i,o,a){return function(n){var i,s,c=n.$parent,l=!1,u=!1;function d(e){var n;l||(l=!0,c.addIgnore(),setTimeout(function(){a.$broadcast("FIRST_FEED_RECEIVED")},1e3)),!e.sucs&&e.rc>0&&e.rc===o.NO_MORE_FEED?c.setNoMoreFeed(!0):1111===e.rc?c.feeds.length||t.initFeedRequest(c.params):n=t.process(e),n?n.$rgDigest():(c.feeds=t.getFeeds(),c.busy&&(c.busy=!1,c.clearRequestTimer()),u===!1&&(u=!0,requestAnimationFrame(function(){c.$rgDigest(),u=!1})))}i=e.subscribe(d,{filter:t.getFeedFilter(),callWithUnresolved:!0}),s=r.add(function(){t.requestForFeed(c.params,1)}),c.$on("$destroy",function(){e.unsubscribe(i),t.reset(),r.remove(s),l&&c.removeIgnore()})}}angular.module("ringid.feed").directive("feedImage",feedImage),feedImage.$inject=["Utils","SystemEvents","$compile"];function feedImage(e,t,n){var r,i,o,a,s;function c(e,t){return t*e.height/e.width}function l(e,t){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="RingBoxImageController" ringbox-type="remote" ringbox-animation="true" ringbox-target="templates/partials/notification/'+(t||"image-popup.html")+'" ringbox-data="getImageData(feedimages['+e+'].value, feed)"></div>'}function u(e,t,n){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="'+n+'" ringbox-type="remote" ringbox-animation="true" ringbox-target="'+t+'"loader-hide = "false"ringbox-scrollable="true" ringbox-data="getFeedInfo(feed)"></div>'}function d(e){return'<a ng-href="{{feed.getNewsPortalUrl()}}" target="_blank" class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+"].value.src(600)}}')\"></a>"}return r={layout_0:'<div class="grid">'+l(0)+'</div><div class="grid">'+l(1)+l(2)+"</div>",layout_2:'<div class="grid">'+l(0)+l(1)+'</div><div class="grid">'+l(2)+"</div>",layout_4:'<div class="grid">'+l(0)+l(1)+"</div>",layout_5:l(0)},r.layout_1=r.layout_0,r.layout_3=r.layout_2,r.layout_6=r.layout_5,i={layout_0:'<div class="grid">'+l(0,"image-popup-special.html")+'</div><div class="grid">'+l(1,"image-popup-special.html")+l(2,"image-popup-special.html")+"</div>",layout_2:'<div class="grid">'+l(0,"image-popup-special.html")+l(1,"image-popup-special.html")+'</div><div class="grid">'+l(2,"image-popup-special.html")+"</div>",layout_4:'<div class="grid">'+l(0,"image-popup-special.html")+l(1,"image-popup-special.html")+"</div>",layout_5:l(0,"image-popup-special.html")},i.layout_1=i.layout_0,i.layout_3=i.layout_2,i.layout_6=i.layout_5,o={layout_0:'<div class="grid">'+u(0,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+'</div><div class="grid">'+u(1,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+u(2,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+"</div>",layout_2:'<div class="grid">'+u(0,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+u(1,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+'</div><div class="grid">'+u(2,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+"</div>",layout_4:'<div class="grid">'+u(0,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+u(1,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+"</div>",layout_5:u(0,"templates/newsportal/portal-feed-popup.html","PortalFeedPopUpController")},o.layout_1=o.layout_0,o.layout_3=o.layout_2,o.layout_6=o.layout_5,a={layout_0:'<div class="grid">'+u(0,"templates/business/business-feed-popup.html","businessFeedPopupController")+'</div><div class="grid">'+u(1,"templates/business/business-feed-popup.html","businessFeedPopupController")+u(2,"templates/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_2:'<div class="grid">'+u(0,"templates/business/business-feed-popup.html","businessFeedPopupController")+u(1,"templates/business/business-feed-popup.html","businessFeedPopupController")+'</div><div class="grid">'+u(2,"templates/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_4:'<div class="grid">'+u(0,"templates/business/business-feed-popup.html","businessFeedPopupController")+u(1,"templates/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_5:u(0,"templates/business/business-feed-popup.html","businessFeedPopupController")},a.layout_1=a.layout_0,a.layout_3=a.layout_2,a.layout_6=a.layout_5,s={layout_0:'<div class="grid">'+d(0)+'</div><div class="grid">'+d(1)+d(2)+"</div>",layout_2:'<div class="grid">'+d(0)+d(1)+'</div><div class="grid">'+d(2)+"</div>",layout_4:'<div class="grid">'+d(0)+d(1)+"</div>",layout_5:d(0)},s.layout_1=s.layout_0,s.layout_3=s.layout_2,s.layout_6=s.layout_5,{restrict:"A",scope:!0,link:function(e,t,l){var u,d;"shared"===l.feedImage&&(e.feed=e.feed.getOrginalFeed()),e.layout_id=e.feed.getImageLayout(),e.feedimages=e.feed.getImages(),5===e.layout_id&&(e.feedimages[0].value.offset().width<600&&e.feedimages[0].value.offset().height<400?e.layout_id=6:c(e.feedimages[0].value.offset(),600)<400&&(e.layout_id=6),t.css({height:e.feedimages[0].value.offset().height+"px"})),t.addClass("img-layout-"+e.layout_id),e.feedimages.length&&(u=l.popupTemplate?i:r,"true"===l.portal&&"false"===l.exUrl&&(u=o),"true"===l.portal&&"true"===l.exUrl&&(u=s),"true"===l.pages&&"false"===l.exUrl&&(u=a),"true"===l.pages&&"true"===l.exUrl&&(u=s),d=n(u["layout_"+e.layout_id])(e),e.feed.getTotalImage()>3&&(d[1].lastChild.innerHTML='<div class="img-bg-opa"></div><div class="img-bg-counter">+'+(e.feed.getTotalImage()-3)+"</div>"),t.html(""),t.append(d))}}}angular.module("ringid.feed").directive("rgMoreFeed",rgMoreFeed),rgMoreFeed.$inject=["feedFactory","SystemEvents","$ringbox"];function rgMoreFeed(e,t,n){return{restrict:"A",link:function(r,i,o){var a,s=r.$eval(o.rgMoreFeed),c=0,l=s.getDynamicText().toString(),u=s.showMore(),d=s.text();function g(){var e=d;r.showFeedFullContent?e=l:(d.length>250&&(e=d.substr(0,d.indexOf(" ",249)),u=!0),e&&e.split(/\r\n|\n\r/).length>10&&(u=!0,e=e.split(/\r\n|\n\r/,10).join("\n\r")),e=u?s.getCroppedHtml(e):l),e?(i.html(e),r.editorEnabled?i.addClass("ng-hide"):i.removeClass("ng-hide")):i.addClass("ng-hide"),E()}function E(){u&&(a=angular.element('<span style="display:inline-block;margin-left:5px;" class="showpointer showmore"> Show More</span>'),i.append(a),a.bind("click",T),r.$on("$destroy",function(){a&&(a.unbind("click"),a=null)}))}function m(){l=s.getDynamicText().toString(),u=s.showMore(),a&&(a.unbind("click"),a=null),g()}g(),r.$on(t.FEED.UPDATED,function(e,t){t.id===s.getKey()&&m()}),r.$on(t.FEED.RESET,function(e,t){t.getKey()===s.getKey()&&(s=t,m())}),r.$watch("feed.text()",function(){c>0&&m(),c++});function T(){s.showMore()?n.open({type:"remote",scope:!1,scrollable:!0,controller:"PopupSingleFeedController",backDropClose:!0,resolve:{remoteData:function(){return e.moreFeedText(s)}},templateUrl:"templates/home/popup-feed.html"}):(i.html(l),a.unbind("click"),a=null)}}}}angular.module("ringid.feed").directive("rgFeedHide",rgFeedHide),rgFeedHide.$inject=["rgDropdownService","feedFactory","Ringalert","MESSAGES","userFactory"];function rgFeedHide(e,t,n,r,i){return{restrict:"EA",scope:{targetKey:"=",hideType:"@"},controller:"HideUnhideController",link:function(o,a){function s(a){var s,c,l=r.HIDE_UNHIDE;return e.close(a),s=c=t.getFeed(o.targetKey),!!c&&("user"===o.hideType?(s=c.user(),o.targetKey=s.getUtId(),o.title=l.USER_TITLE,o.subTitle=l.USER_SUBTITLE.format(s.getName())):"profile"===o.hideType?(s=i.getByUtId(o.targetKey),o.hideType="user",o.title=l.USER_TITLE,o.subTitle=l.USER_SUBTITLE.format(s.getName())):"circle"===o.hideType&&(s=c.getTargetCircle(),o.targetKey=s.getKey(),o.title=l.CIRCLE_TITLE,o.subTitle=l.CIRCLE_SUBTITLE.format(s.getName())),n.alert({title:o.title,message:o.subTitle,okCallback:function(){o.hideUnhide(!s.isHidden()).then(function(e){var r,i;if(e.sucs){for("user"===o.hideType?(i=t.removeUsersAllFeed,s.hide(!0)):"circle"===o.hideType?(i=t.removeAllCircleFeed,s.hide(!0)):i=t.removeFeed,r=0;r<e.sucsIDLst.length;r++)i.call(null,e.sucsIDLst[r]);o.$emit("FEED_LIST_CHANGED")}else n.show(e,"error")})}}),!0)}a.on("click",s),o.$on("$destroy",function(){a.off("click",s)})}}}angular.module("ringid.feed").directive("rgIncomingFeed",rgIncomingFeed),rgIncomingFeed.$inject=["feedFactory","$window","Utils","OPERATION_TYPES"];function rgIncomingFeed(e,t,n,r){return{restrict:"A",link:function(i,o){var a,s=angular.element(t),c=e.getCurrentPageValue(),l=0,u=r.SYSTEM;switch(c.action){case u.TYPE_MY_NEWS_FEED:case u.TYPE_FRIEND_NEWSFEED:l=492;break;case u.TYPE_GROUP_NEWS_FEED:l=250;break;case u.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:case u.TYPE_NEWS_FEED:default:l=0}function d(){var e,t,r=n.viewport.yo;l>0&&(t=l+75,e=t-r,e>0&&(e<75?o.css("top","75px"):o.css("top",e+"px")))}function g(){e.hasUnprocessedFeed()?o.hasClass("active")||o.addClass("active"):o.removeClass("active")}function E(){n.viewport.yo>500?e.setpushInIncomingFeed(!0):e.hasUnprocessedFeed()&&a>n.viewport.yo?(e.processIncomingFeed(),e.setpushInIncomingFeed(!1),g()):e.setpushInIncomingFeed(!1),o.hasClass("active")&&d(),a=n.viewport.yo}i.$watch(e.hasUnprocessedFeed,function(e,t){e>t&&g()});function m(){e.processIncomingFeed(),e.setpushInIncomingFeed(!1),g(),n.resetScroll(),n.animateScroll(),i.setFeed(),i.$rgDigest()}o.on("click",m),s.bind("scroll",E);function T(){s.unbind("scroll",E),o.off("click",m)}g(),i.$on("$destroy",T)}}}angular.module("ringid.feed").directive("feedTimeoutSelect",feedTimeoutSelect).directive("feedTimoutOption",feedTimoutOption).directive("feedTimeoutMenu",feedTimeoutMenu);function feedTimoutOption(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed-timeout-option.html",link:function(e){e.$rgDigest()},controller:["$scope",function(e){e.rows=[1,9,17],e.cols=[0,1,2,3,4,5,6,7],e.lastCols=[25,26,27,28,29,30],e.select=function(t){angular.isFunction(e.onSelect)&&e.onSelect({item:t}),e.close(),e.$parent.$rgDigest()}}]}}function feedTimeoutSelect(){return function(e,t,n){function r(t){t.stopPropagation(),e.select(n.feedTimeoutSelect)}t.on("click",r),e.$on("$destroy",function(){t.off("click",r)})}}feedTimeoutMenu.$inject=["$document","$compile"];function feedTimeoutMenu(e,t){return{restrict:"A",scope:{onSelect:"&ringOnOptionSelect",value:"=selectedValue"},link:function(n,r){var i,o=!1;n.close=function(){i&&i.remove(),i=null,o=!1,e.off("click",s)};function a(e){parseInt(e,10)>-1?r.addClass("active"):r.removeClass("active")}n.$watch("value",a);function s(e){e.target!==r[0]&&e.target.parentNode!==r[0]&&e.target.parentNode.parentNode!==r[0]&&"pt-top"!==e.target.className&&n.close()}function c(){return o?void n.close():(i||(i=t(angular.element("<feed-timout-option></feed-timout-option>"))(n)),r.after(i),o=!0,void e.on("click",s))}r.on("click",c),n.$on("$destroy",function(){r.off("click",c),e.off("click",s)})}}}angular.module("ringid.feed").directive("feedRepeat",feedRepeat),feedRepeat.$inject=["$parse","$compile","$templateCache","$http","Utils","$rootScope","SystemEvents","$sniffer","feedFactory"];function feedRepeat(e,t,n,r,i,o,a,s,c){function l(){return function(e,l,u,d,g){var E,m,T,f,p,_,I,h,A=u.feedRepeat,C=A.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),S=[],v=3,M=i.feedColumn(),D=Object.create(null),O=[],R=!1,N=document.querySelector("div.middle"),P=i.viewport.y,y=P/2,b=0,U=0,L=s.vendorPrefix.toLowerCase(),F=!("moz"===L||"ms"===L),k=!1,w=!0,G=0,B="",$=[],H=!1,x=!1,Y=!1,K=Object.create(null),j=!1;for(m=C[2],T=C[1],E=0;E<v;E++)f={},h=document.createElement("div"),h.className="cell cell-id"+E,h.appendChild(document.createComment("cell: "+E)),f.element=h,p=document.createElement("div"),p.innerHTML='<div class="rf-box"><div class="rf-top"><div class="rf-cir"><span class="icon-logo-circle"></span></div><div class="rf-line"></div></div><div class="rc-feed"> </div><div class="rc-feed rc2"> </div><div class="rc-feed rc3"> </div><div class="rf-ics"></div></div>',p.style.display="none",h.appendChild(p),f.loader=p,S[E]=f,e.showPostBox()&&u.postbox&&0===E?(V(),j=!0):(H=!0,W()),p=null;for(e.showSpecialFeed()&&r.get("templates/partials/special-feed.html",{cache:n}).then(function(e){B=e.data}),E=0;E<v;E++)l[0].appendChild(S[E].element);function V(){var n=t('<rg-postbox set-feed="setFeed" for-add="{{::forAdd}}" ></rg-postbox')(e),r=S[0].element;r.insertBefore(n[0],r.firstChild.nextSibling),H=!0,W(),J()}function W(){requestAnimationFrame(function(){te(e[m])})}function q(e){x===e||Y||(requestAnimationFrame(function(){for(E=0;E<M;E++)S&&S[E].loader&&(S[E].loader.style.display=e?"block":"none");Y=!1}),Y=!0,x=e)}function z(){for(E=0;E<v;E++)E<M?S[E].display||(S[E].element.style.display="block",S[E].display=!0):S[E].display!==!1&&(S[E].element.style.display="none",S[E].display=!1)}function Q(){te(e[m]),X(!1),k=!1,q(k),z()}N.style.height=P+"px",z(),k=!0,q(k),_=-1*P*4,I=4*P,document.documentElement.scrollTop=0,document.body.parentNode.scrollTop=0,document.body.scrollTop=0;function X(t){H&&S&&requestAnimationFrame(function(){var n,r,o,a,s,c,u,d,g=[139,0,0],m=[],T=[],f=[0,0,0],p=[0,0,0];if(U=l[0].scrollHeight,n=U-2*i.viewport.y,i.viewport.yo>n&&t&&(e.loadMoreData(),e.busy===k||e.noMoreFeed||(k=e.busy,q(k))),!(R||Math.abs(i.viewport.yo-b)<y)){for(b=i.viewport.yo,j||(g[0]=0),E=0;E<$.length;E++)a=$[E],o=a.key,K[o]&&(s=K[o],s&&(c=s.height,r=s.cell,g[r]+=c,g[r]>=_+b&&g[r]<=b+P+I?s.clone.RG_HIDDEN&&m.push(s.clone):(g[r]<_+b&&(f[r]+=c),g[r]>=_+b&&g[r]>b+P+I&&(p[r]+=c),s.clone.RG_HIDDEN||T.push(s.clone))));for(E=0;E<O.length;E++)a=O[E],o=a.key,D[o]&&(s=D[o],s&&(c=s.height,r=s.cell,g[r]+=c,g[r]>=_+b&&g[r]<=b+P+I?s.clone.RG_HIDDEN&&m.push(s.clone):(g[r]<_+b&&(f[r]+=c),g[r]>=_+b&&g[r]>b+P+I&&(p[r]+=c),s.clone.RG_HIDDEN||T.push(s.clone))));for(a=null,s=null,u=Math.max(Math.max.apply(null,g),P),N.style.height=u+y+"px",d=0;d<S.length;d++)S[d].element.style.paddingTop=f[d]+"px";for(d=0;d<m.length;d++)m[d].style.display="block",m[d].RG_HIDDEN=!1;for(d=0;d<T.length;d++)T[d].style.display="none",T[d].RG_HIDDEN=!0}})}window.addEventListener("scroll",X),e.$on(a.COMMON.COLUMN_CHANGED,function(e,t){M=t,Q()}),e.$on(a.COMMON.WINDOW_RESIZED,function(){te(e[m]),z()}),e.$watchCollection(m,te),e.$on("$destroy",function(){D=O=h=S=f=K=$=N=B=x=null,window.removeEventListener("scroll",X)}),e.$on(a.FEED.HEIGHT,function(e,t){e.stopPropagation(),D&&D[t]&&Z(D[t])}),e.$on(a.FEED.BUSY,function(e,t){k=t,q(k)});function Z(e){fastdom.defer(2,function(){e&&(e.height=e.clone.offsetHeight+12)})}function J(){requestAnimationFrame(function(){e.$rgDigest()})}function ee(){this.removeEventListener(L+"TransitionEnd",ee),this.removeEventListener("transitionend",ee),this.parentNode.removeChild(this)}function te(n){var r,i,a,s,l,u,d,m,f=n.length,p=[],_=Object.create(null),I=0,h=[];R=!0;function A(e){d.insertBefore(e[0],u.nextSibling),u=e[0],!F||w||G<10?u.style.opacity=1:h.push(u),l.clone=u,p[l.cell]=u,l.serialElm=l.clone.querySelector("[feed-serial]"),G++,Z(l)}if(H&&S){if(0===n.length&&w)return void(e.noMoreFeed&&J());for(o.$$postDigest(function(){if(D)for(E=0;E<n.length;E++)r=n[E],s=r.key,D[s]&&(l=D[s],l&&l.childHead&&(l.scope.$$childHead=l.childHead))}),c.hasSpecialFeed()&&($=c.getSpecialFeedList(),I=$.length),E=0;E<f;E++){if(a=(E+I)%M,r=n[E],s=r.key,D[s]){if(l=D[s],!l)continue;l.cell=a,delete D[s]}else i=e.$new(),i[T]=r,l={},l.clone=null,l.cell=a,l.scope=i,l.height=110,l.key=s,l.serial=-1;_[s]=l}for(E=0;E<M;E++)p[E]||(p[E]=j&&0===E&&S[E].element.firstElementChild?S[E].element.firstElementChild:S[E].element.firstChild);for(s in D)if(D[s]){if(l=D[s],!l)continue;l.serial&&l.serial>0?l.clone.style.opacity=0:l.clone.parentNode.removeChild(l.clone),l.clone.RG_DELETE=!0,l.clone.addEventListener(L+"TransitionEnd",ee),l.clone.addEventListener("transitionend",ee),l.scope.$destroy()}if(B&&I>0)for(E=0;E<I;E++){if(r=$[E],s=r.key,a=E%M,u=p[a],d=u.parentNode,K[s]){if(l=K[s],!l)continue;m=l.clone,l.cell=a,m!==u.nextSibling&&d.insertBefore(m,u.nextSibling),p[l.cell]=m}else i=e.$new(),i[T]=r.value,m=t(B)(i),d.insertBefore(m[0],u.nextSibling),u=m[0],u.style.opacity=1,l={},l.clone=m[0],l.cell=a,l.scope=i,l.height=110,l.key=s,l.serial=E,l.serialElm=l.clone.querySelector("[feed-serial]"),p[a]=u,K[s]=l,Z(l);l.serialElm&&(l.serialElm.innerHTML=E+1)}for(E=0;E<f;E++)if(r=n[E],s=r.key,l=_[s]){if(l.scope.$index=E,u=p[l.cell],d=u.parentNode,m=l.clone){do u=u.nextSibling;while(u&&u.RG_DELETE);m!==u&&d.insertBefore(m,u),p[l.cell]=m,l.childHead=l.scope.$$childHead,l.scope.$$childHead=null}else 0===E&&(w=!0),g(l.scope,A);l.serial!==E+I&&l.serialElm&&(l.serialElm.innerHTML=I+E+1,l.serial=E+I)}h.length>0&&fastdom.defer(2,function(){if(h){for(E=0;E<h.length;E++)h[E].style.opacity=1;
h=null}}),e.busy!==k&&(k=e.busy,q(k),k=null),D=_,O=n,R=!1,_=null,w=!1,l=null,m=null,d=null,u=null,p=null,i=null,n.length<=10&&J()}}}}return{restrict:"A",transclude:!0,priority:1e3,terminal:!0,compile:l}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedLocationViewItem",feedLocationViewItem);function feedLocationViewItem(){return{restrict:"E",scope:{onHover:"&",onSelect:"&",location:"="},templateUrl:"templates/partials/feed_location/item.html",link:function(e,t){function n(t){t.stopPropagation(),e.onSelect&&e.onSelect({location:e.location})}t.on("click",n);function r(){e.onHover({location:e.location})}e.onHover&&t.on("mouseover",r),e.$on("$destroy",function(){t.off("click",n),t.off("mouseover",r)})}}}feedApp.directive("feedLocationView",feedLocationView),feedLocationView.$inject=["Utils","Ringalert"];function feedLocationView(e,t){function n(e){e.stopPropagation()}return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed_location/view.html",compile:function(){return{pre:function(e,t){e.initLocation(t)},post:function(e,t){e.$rgDigest(),t.on("click",n),e.$on("$destroy",function(){t.off("click",n)})}}},controller:["$scope",function(n){var r,i,o,a,s,c={};n.keyword="",n.showLocationMap=!0,n.suggestedLocations=[],n.loadingData=!1,n.selfLocation={},n.onLocationItemSelect=l,n.shareUserLocation=u,n.onLocationItemHover=g,n.initLocation=d;function l(e){var t;if(angular.isFunction(n.onItemSelect)){try{t={description:e.terms[0].value}}catch(r){t={description:e.description}}t.lat=9999,t.lng=9999,e.geometry&&e.geometry.location&&(t.lat=e.geometry.location.lat(),t.lng=e.geometry.location.lng()),n.onItemSelect({location:t}),n.$parent.$rgDigest()}n.close()}function u(){e.getUserLocation().then(function(e){e.sucs?(n.onItemSelect({location:e}),n.$rgDigest(),n.close()):t.show({mg:"Unable to detect user location"},"error")})}function d(t){s=t.find("input")[0],o=new google.maps.places.PlacesService(s),a=new google.maps.places.AutocompleteService,s.focus(),e.getUserLocation(!0).then(function(e){n.selfLocation=e,A(e.sucs?{lat:e.lat,lng:e.lng,description:e.description}:{lat:23.772493,lng:90.4098315,description:"IPvision Ltd."})}),n.keyword=n.value?n.value.description:""}function g(e){try{C(e.place_id),p()}catch(t){}}function E(e){o.getDetails({placeId:e},function(t,n){n===google.maps.places.PlacesServiceStatus.OK&&(angular.extend(c[e],t),c[e]=t),I()})}function m(e,t){return t!==google.maps.places.PlacesServiceStatus.OK?void f():(_(),angular.forEach(e,function(e){var t=e.place_id;c[t]?angular.extend(c[t],e):(E(t),c[t]=e),n.suggestedLocations.push(c[t])}),n.suggestedLocations.length>0&&f(),void I())}function T(){n.loadingData=!0}function f(){n.loadingData=!1}function p(){n.showLocationMap=!0}function _(){n.suggestedLocations=[]}function I(){n.$rgDigest()}function h(e){return new google.maps.LatLng(e.lat,e.lng)}function A(e){var t=h(e);i=new google.maps.Map(document.getElementById("feed-location-map"),{center:t,zoom:13}),e.description&&a.getPlacePredictions({input:e.description,rankBy:google.maps.places.RankBy.DISTANCE},m)}function C(e){var t=c[e];t&&(r&&r.setMap(null),i.setCenter(t.geometry.location),r=new google.maps.Marker({map:i,place:{placeId:e,location:t.geometry.location}}))}function S(e){_(),T(),I(),a.getPlacePredictions({input:e},m)}function v(e){var t=e.target.value;t&&t.length>3?S(t):(_(),I()),n.keyword=e.target.value}n.processKeyup=e.debounce(v,500)}]}}function feedLocationPreview(){return{replace:!0,template:'<span ng-if="!!feed.getLocationInfo().lat" ><a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote"ringbox-target="templates/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }"><img height="170px" width="100%" ng-src="{{ ::feed.getLocationStaticEmbedUrl() }}" alt="location-hover" /></a>'}}feedApp.directive("feedLocationPreview",feedLocationPreview);var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedLocationMenu",feedLocationMenu),feedLocationMenu.$inject=["$document","$compile","Utils"];function feedLocationMenu(e,t,n){return{restrict:"A",scope:{onItemSelect:"&feedLocationMenuOnSelect",value:"=selectedValue",viewWidth:"@",viewHeight:"@",autoAdjust:"@"},link:function(r,i,o){var a,s,c=!1,l=20;r.viewDirection="right",o.feedLocationMenuDirection&&(r.viewDirection=o.feedLocationMenuDirection,s=!0),r.viewWidth=r.viewWidth||600,r.viewHeight=r.viewHeight||466,r.close=function(){a&&a.remove(),a=null,c=!1,e.off("click",u)},r.$watch("value",function(e){e.description?i.addClass("active"):i.removeClass("active")});function u(e){e.target!==i[0]&&e.target.parentNode!==i[0]&&e.target.parentNode.parentNode!==i[0]&&"pt-top"!==e.target.className&&(r.close(),"false"!==r.autoAdjust&&d(event))}function d(e){var t=n.viewportsize();window.eventFix(e),!s&&e.pageY+r.viewHeight+l>t.y&&window.scrollToYOffset(e.pageY-t.y/2,500),e.pageX+r.viewWidth+l>t.x-200&&(r.viewDirection+=" left")}function g(n){return c?void r.close():("false"!==r.autoAdjust&&d(n),a||(a=t(angular.element("<feed-location-view></feed-location-view>"))(r)),i.after(a),c=!0,void e.on("click",u))}i.on("click",g),r.$on("$destroy",function(){a&&a.remove(),i.off("click",g),e.off("click",u)}),r.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedTop",rgNewsFeedTop),rgNewsFeedTop.$inject=["$templateCache"];function rgNewsFeedTop(e){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",template:e.get("top.html")}}angular.module("ringid.feed").directive("rgNewsFeedBottom",rgNewsFeedBottom),rgNewsFeedBottom.$inject=["$templateCache"];function rgNewsFeedBottom(e){return{restrict:"E",template:e.get("bottom.html")}}angular.module("ringid.feed").directive("rgNewsFeedDetails",rgNewsFeedDetails);function rgNewsFeedDetails(){return{restrict:"E",templateUrl:"templates/partials/news_feed/details.html",link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedSharedFeed",rgNewsFeedSharedFeed);function rgNewsFeedSharedFeed(){return{restrict:"E",templateUrl:"templates/partials/news_feed/shared_feed.html"}}angular.module("ringid.feed").directive("rgNewsFeedMenu",rgNewsFeedMenu),rgNewsFeedMenu.$inject=["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert"];function rgNewsFeedMenu(e,t,n,r,i){return{restrict:"E",template:n.get("menu.html"),link:function(n,o){var a=null,s=null,c=o[0].querySelector("[data-events]"),l=o[0].closest("[data-feed-bottom]");function u(e){var t,o;if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){if(e.stopPropagation(),t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0),!o.sucs)return void i.show(r[o.rc],"warning");d()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),g()),n.$rgDigest()}c.addEventListener("click",u),n.$rgDigest();function d(){return n.showCommentBox&&(l.removeChild(a),n.showCommentBox=!1),n.showShareBox?n.showShareBox?(l.removeChild(s),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey()):(s=s||e("<feed-inline-share-view></feed-inline-share-view>")(n)[0],l.appendChild(s),n.showShareBox=!0,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}function g(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox"comment-type = "feed" hide-scroll="{{::singleFeed}}" comment-order = "asc"></rg-comments>',n.showShareBox&&(l.removeChild(s),n.showShareBox=!1),n.showCommentBox?(l.removeChild(a),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,a=a||e(r)(n)[0],l.appendChild(a),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}n.closeShareBox=function(){n.showShareBox=!0,d(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,g(),n.$rgDigest()},n.$on("$destroy",function(){c.removeEventListener("click",u),c=null,l=null,a=null,s=null})}}}angular.module("ringid.feed").directive("rgPortalNewsFeedMenu",["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert","$ringbox",function(e,t,n,r,i,o){return{restrict:"E",template:n.get("menu.html"),link:function(n,a){var s=null,c=null,l=a[0].querySelector("[data-events]"),u=a[0].closest("[data-feed-bottom]");n.$rgDigest();function d(e){var t,o;if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){if(e.stopPropagation(),t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0),!o.sucs)return void i.show(r[o.rc],"warning");g()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),E()),n.$rgDigest()}l.addEventListener("click",d);function g(){var e;return n.showCommentBox&&(u.removeChild(s),n.showCommentBox=!1),n.showShareBox?n.showShareBox?(u.removeChild(c),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey()):(e=o.open({type:"remote",scope:!1,controller:"feedNewsPortalShareController",scopeData:{feed:n.feed},backDropClose:!0,templateUrl:"templates/newsportal/portal-share-news.html"}),void e.result.then(function(){n.$rgDigest()}))}function E(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox"comment-type = "feed" comment-order = "asc"></rg-comments>',n.showCommentBox?(u.removeChild(s),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,s=s||e(r)(n)[0],u.appendChild(s),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}n.closeShareBox=function(){n.showShareBox=!0,g(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,E(),n.$rgDigest()},n.$on("$destroy",function(){l.removeEventListener("click",d),l=null,u=null,s=null,c=null})}}}]),angular.module("ringid.feed").directive("locationCard",function(){return{restrict:"E",replace:!0,scope:{feed:"="},template:'<span class="location">at&nbsp;<a ng-href="{{ ::feed.getLocationUrl() }}"rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html"scope-data="{url : feed.getLocationEmbedUrl() }">{{::feed.getLocationShortText()}}</a></span>'}}).directive("userCard",["OPERATION_TYPES",function(e){return{restrict:"E",replace:!0,controller:["$scope","Api","friendsFactory","settings","userFactory","SystemEvents","Ringalert","$rootScope","portalHttpService","businessHttpService",function(e,t,n,r,i,o,a,s,c,l){e.portalSubscriber=!0,e.businessSubscriber=!0,e.celebritySubscriber=!0,e.mediaSubscriber=!0,e.getUserDetail=function(){e.showMfc=!1,t.user.getUserDetails({utId:e.user.getUtId()},!0,e.user.isNewsPortalUser(),e.user.isBusinessPageUser(),e.user.isCelebrityPageUser()).then(function(t){t.sucs&&(e.mfc=t.userDetails.mfc,e.showMfc=!0,e.user.setUid(t.userDetails.uId),t.userDetails.npDTO&&(e.portalCategory=t.userDetails.npDTO.nPCatName,e.portalSubscriber=t.userDetails.npDTO.subsc),e.$rgDigest())})},e.getPortalDetail=function(){c.getPortalShortDetails(e.user.getKey()).then(function(t){t.sucs===!0&&(e.portalCategory=t.userDetails.npDTO.nPCatName,e.follower=t.userDetails.npDTO.subCount,e.portalSubscriber=t.userDetails.npDTO.subsc),e.$rgDigest()})},e.getBusinessDetail=function(){l.getBusinessShortDetails(e.user.getKey()).then(function(t){t.sucs===!0&&(e.businessCategory=t.userDetails.npDTO.nPCatName,e.follower=t.userDetails.npDTO.subCount,e.businessSubscriber=t.userDetails.npDTO.subsc),e.$rgDigest()})},e.getCelebrityDetail=function(){t.user.getUserDetails({utId:e.user.getUtId()},!1,!1,!1,!0).then(function(t){t.sucs&&(i.createCelebrityUser(t.userDetails),t.userDetails.celebInfo&&(e.celebCategory=t.userDetails.celebInfo.cat.join(" | "),e.followerCount=t.userDetails.celebInfo.fcount,e.followerCountWithText=e.followerCount>1?e.followerCount+" followers":e.followerCount+" follower",e.celebritySubscriber=t.userDetails.celebInfo.isFollower),e.$rgDigest())})},e.getMusicProfileDetail=function(){t.media.getShortDetails(e.user.getKey()).then(function(t){t.sucs===!0&&(e.mediaSlogan=t.userDetails.npDTO.nPslgn,e.follower=t.userDetails.npDTO.subCount,e.mediaSubscriber=t.userDetails.npDTO.subsc),e.$rgDigest()})},e.followPage=function(n){"business"===n&&l.followBusinessPage(e.user.getKey()).then(function(t){t.sucs?(e.businessSubscriber=!0,s.$broadcast(o.BUSINESS.DONE_FOLLOW_BUSINESS,t),e.$rgDigest()):a.show("Operation failed","error")},function(e){a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")}),"media"===n&&t.media.followPage(e.user.getKey()).then(function(t){t.sucs===!0?(e.mediaSubscriber=!0,s.$broadcast(o.MEDIA.DONE_FOLLOW_MEDIA,t),e.$rgDigest()):a.show("Operation failed","error")},function(e){a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")}),"celebrity"===n&&(e.celebritySubscriber=!0,e.$rgDigest())},e.unFollowPage=function(n){"portal"===n&&(e.portalSubscriber=!1,c.unFollowPortal(e.user.getKey()).then(function(t){t.sucs?(e.portalSubscriber=!1,s.$broadcast(o.PORTAL.UNFOLLOW_PORTAL,t),e.$rgDigest()):a.show("Operation failed","error")},function(e){a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})),"business"===n&&l.unFollowBusiness(e.user.getKey()).then(function(t){t.sucs?(e.businessSubscriber=!1,s.$broadcast(o.BUSINESS.UNFOLLOW_BUSINESS,t),e.$rgDigest()):a.show("Operation failed","error")},function(e){a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")}),"media"===n&&t.media.unFollowMediaPage(e.user.getKey()).then(function(t){t.sucs?(e.mediaSubscriber=!1,s.$broadcast(o.MEDIA.UNFOLLOW_MEDIA,t),e.$rgDigest()):a.show("Operation failed","error")},function(e){a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")}),"celebrity"===n&&(e.celebritySubscriber=!1,e.$rgDigest())},e.getPortalCatList=function(t){return{data:function(){return{target:e.user,index:t}},promise:c.getPortalCatList(e.user.getKey())}},e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:t.user.getMutualFriends(e)}},e.contactListAction=function(t){t.friend.isLoading()||(n.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}}],scope:{user:"="},template:function(t,n){var r=n.type&&parseInt(n.type,10)||0,i=e.SYSTEM.FEED_SUPER_TYPES;return r===i.TYPE_NEWSPORTAL?'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="true"on-hover-start="getPortalDetail" hover-template-url="templates/partials/hovercards/portal-profile-hover.html">{{::user.getName()}}</a></span>':r===i.TYPE_BUSINESS?'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="true"on-hover-start="getBusinessDetail" hover-template-url="templates/partials/hovercards/business-profile-hover.html">{{::user.getName()}}</a></span>':r===i.TYPE_CELEBRITY?'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="true"on-hover-start="getCelebrityDetail" hover-template-url="templates/partials/hovercards/celebrity-profile-hover.html">{{::user.getName()}}</a></span>':r===i.TYPE_MEDIAPAGE?'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="true"on-hover-start="getMusicProfileDetail" hover-template-url="templates/partials/hovercards/music-profile-hover.html">{{::user.getName()}}</a></span>':'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="{{::!user.isCurrentUser()}}"on-hover-start="getUserDetail" hover-template-url="templates/partials/hovercards/profile-hover.html">{{::user.getName()}}</a></span>'}}}]).directive("feedMessage",feedMessage).directive("feedTagMoreUser",feedTagMoreUser),feedMessage.$inject=["$compile"];function feedMessage(e){return{restrict:"A",scope:{feed:"=feedMessage"},link:function(t,n){t.$watch("feed.checkMessageUpdated()",function(){n.html(t.feed.getMessageText()),e(n.contents())(t)})}}}feedTagMoreUser.$inject=[];function feedTagMoreUser(){return{restrict:"E",scope:{feed:"=tagFeed"},controller:["$scope","feedFactory",function(e,t){var n;e.getTagUsers=function(e){return{data:function(){return{target:e}},promise:t.getTagUsers(e)}},e.tooltip="",e.feed.getTotalTag()>2&&(n=e.feed.getTagUsers(),n.length>1&&(e.tooltip+=n[1].getName(),n[2]&&(e.tooltip+="\n"+n[2].getName(),e.feed.getTotalTag()>3&&(e.tooltip+="\nand "+(e.feed.getTotalTag()-3)+" others"))))}],template:'<span class="">with&nbsp;</span><span class="tag-people"><user-card user="feed.getTagUsers()[0]"></user-card></span><span ng-if="::feed.getTotalTag() > 1">&nbsp;and&nbsp;<span class="tag-people" ng-if="::feed.getTotalTag() == 2"><user-card user="feed.getTagUsers()[1]"></user-card></span><span class="" ng-if="::feed.getTotalTag() > 2"><a rg-ringbox="true" ringbox-controller="feedTagUserListController" ringbox-type="remote"ringbox-target="templates/home/tag-user-list.html"ringbox-data="getTagUsers(feed)" class="tag-f-msg" data-tooltip="{{::tooltip}}">{{::feed.getTotalTag() -1}} others peoples</a></span></span>'}}angular.module("ringid.feed").directive("rgSingleFeedHeader",rgSingleFeedHeader).directive("rgSingleFeedBody",rgSingleFeedBody).directive("rgSingleFeedMenu",rgSingleFeedMenu);function rgSingleFeedBody(){return{restrict:"E",templateUrl:"templates/partials/single_feed/body.html"}}function rgSingleFeedHeader(){return{restrict:"E",templateUrl:"templates/partials/single_feed/header.html"}}function rgSingleFeedMenu(){return{restrict:"E",templateUrl:"templates/partials/single_feed/menu.html"}}angular.module("ringid.feed").directive("rgSingleFeedDetails",rgSingleFeedDetails);function rgSingleFeedDetails(){return{restrict:"E",templateUrl:"templates/partials/single_feed/details.html"}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedInlineShareView",feedInlineShareView),feedInlineShareView.$inject=[];function feedInlineShareView(){return{restrict:"E",templateUrl:"templates/partials/news_feed/inline-share.html",controller:"feedInlineShareController",link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").controller("FeedMainController",["$scope","$timeout","feedFactory","$rootScope","SystemEvents",function(e,t,n,r,i){var o,a,s;n.reset(),e.noMoreFeed=!1;function c(){return!0}e.showPostBox=e.showPostBox||c,e.showSpecialFeed=e.showSpecialFeed||c,e.feeds=n.getFeeds(),n.setFactoryKey(e.pagekey),n.setSortBy(e.sortBy||"tm"),e.busy=!0,e.setFeed=function(t){e.feeds=n.getFeeds(),t&&e.$rgDigest()},e.forAdd=e.forAdd||"my",e.getFeeds=function(){return e.feeds&&0!==e.feeds.length||e.setFeed(),e.feeds},e.loadMoreData=function(){s=e.feeds.length,e.busy!==!1||e.noMoreFeed||(e.busy=!0,n.requestForMoreFeed(e.params),e.clearRequestTimer(),a=setTimeout(function(){e.busy&&s===e.feeds.length&&(e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy))},6e3))},e.clearRequestTimer=function(e){a&&clearTimeout(a),a=e},e.$on("FEED_LIST_CHANGED",function(t){t.stopPropagation&&t.stopPropagation(),e.$rgDigest()}),e.setNoMoreFeed=function(t){e.noMoreFeed=t,n.noMoreFeed(t),e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy)},e.noDataYet=function(){return e.noMoreFeed&&0===e.feeds.length},e.getFeedInfo=function(e){return{data:function(){return{target:e}},promise:n.getPortalFeedDetails(e.getKey())}},n.initFeedRequest(e.params),e.$on("$destroy",function(){o&&(clearInterval(o),o=null)}),e.$on(i.COMMON.COLUMN_CHANGED,function(){e.$rgDigest()})}]),angular.module("ringid.feed").controller("SingleFeedSubController",["$$feedMap","$scope","$controller","$routeParams","feedFactory","Auth","SystemEvents","Utils","$location",function(e,t,n,r,i,o,a,s,c){t.feedId=parseInt(r.feedId||0,10),t.shared=!!r.shared,t.activeCommentId=parseInt(r.commentId||0,10),t.isReady=!1,t.noData=!1,t.pagekey=i.getSingleFeedPageKey(t.feedId),i.setFactoryKey(t.pagekey),t.singleFeed=!0,t.hideSerial=!0,t.showFeedFullContent=!0,t.ogData={},t.currentUser=o.currentUser(),l(),t.setFeed=function(e){e?c.path("/"):l()},t.skipSaveScope=!0,t.getFeedInfo=function(e){return{data:function(){return{target:e}}}},n("FeedSubController",{$scope:t});function l(){i.getSingleFeed(t.feedId,t.shared).then(function(e){e?(t.feed=e,t.isReady=!0,u()):(t.feed=!1,t.isReady=!0,t.noData=!0),t.$rgDigest()})}function u(){t.feed&&(t.serial=t.feed.serial,t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.shareMenuDisabled=t.feed.isCirclePost(),t.ogData=t.feed.getOgData(),t.ogShowPreview=t.feed.hasOgData(),t.showCommentBox=!0,n("FeedSubController",{$scope:t}),s.safeDigest(t),t.$broadcast(a.FEED.RESET,t.feed))}}]),angular.module("ringid.feed").controller("FeedSubController",FeedSubController),FeedSubController.$inject=["rgDropdownService","$rootScope","$scope","$location","feedFactory","Ringalert","MESSAGES","SystemEvents","$ringbox","fileUploadService"];function FeedSubController(e,t,n,r,i,o,a,s,c,l){var u,d;n.showdroparrow=0,n.showCommentBox=!1,n.showShareBox=!1,n.showCommentView=!0,n.showShareForm=!1,u=n.feed&&n.feed.value?n.feed.value:n.feed,u&&u.isSingleContentFeed()?(u.getMedias().length()||u.getAudios().length()?n.likeType="media":u.getImages(!0).length()&&(n.likeType="image"),n.likeTarget=u.getSingleContent()):(n.likeType="feed",n.likeTarget=u),n.shareMenuDisabled=!!n.shareMenuDisabled&&n.shareMenuDisabled,n.toggleCommentBox=function(e){e.stopPropagation(),n.showCommentBox=!n.showCommentBox,n.showCommentBox&&(n.showShareBox=!1)},n.ddTemplate='<div class="ng-cloak action pad-204 feed-ac r-m-10 z-in-5 top-23"><i class="drop-sprite curve-a curve-t-ico p-ab top11"></i><div class="ac-top-line" ng-if="ddControl.showEdit()"><a class="pad-8-14" rg-click="ddAction()({event: $event, action:\'edit\', feedKey: ddControl.getKey()})" href="#"><i class="drop-sprite w-h-13 edit-ico feed-font"></i>Edit</a></div><div class="ac-top-line" ng-if="ddControl.showReportButton()"><a class="pad-8-14" rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()"><i class="drop-sprite w-h-13 report-ico feed-font"></i>Report</a></div><div class="ac-top-line drop-h" ><a class="pad-8-14" rg-feed-hide hide-type="feed" target-key="ddControl.getKey()"  ng-cloak="true"><i class="drop-sprite w-h-13 hide-feed-ico feed-font"></i>{{ddControl.getHideUnhideText()}}</a></div><div class="ac-top-line drop-h" ng-if="ddControl.showUserHide()"><a class="pad-8-14" rg-feed-hide hide-type="user" target-key="ddControl.getKey()" ><i class="drop-sprite w-h-13 hide-up-user-ico feed-font"></i>Hide updates from this user</a></div><div class="ac-top-line drop-h" ng-if="ddControl.showCircleHide()"><a class="pad-8-14" rg-feed-hide hide-type="circle" target-key="ddControl.getKey()" ><i class="drop-sprite w-h-13 report-ico feed-font"></i>Hide updates from this circle</a></div><div class="ac-top-line"><a class="pad-8-14" rg-click="ddAction()({event: $event, action:\'save\'})" href="#" class="border-0"  ng-cloak="true"><i ng-class="ddControl.isSaved() ? \'delete-ico\' : \'save-ico\'" class="drop-sprite save-ico w-h-13 feed-font"></i>{{ddControl.isSaved()? \'Unsave\':\'Save\'}}</a></div><div class="ac-top-line" ng-if="ddControl.showTagButton()"><a class="pad-8-14" rg-click="ddAction()({event: $event, action:\'edittag\', feedKey: ddControl.getKey()})" href="#" class="border-0"  ng-cloak="true"><i class="drop-sprite w-h-13 add-tag-ico feed-font"></i>{{ddControl.tagButtonText()}}</a></div><div class="ac-top-line"  ng-if="ddControl.showDelete()"><a class="pad-8-14" rg-click="ddAction()({event: $event, action:\'delete\', feedKey: ddControl.getKey()})" href="#" class="border-0"><i class="drop-sprite w-h-13 delete-ico feed-font"></i>Delete</a></div></div>',n.actionFeedDropdown=function(t){switch(e.close(t.event),t.event.preventDefault(),t.action){case"edit":n.enableEditor(n.feed.getKey());break;case"edittag":E();break;case"delete":n.deleteFeed(n.feed.getKey());break;case"save":n.saveUnsave()}},n.noDownload=function(e){e.preventDefault(),o.show("Currently download option is available in ringID desktop and mobile app version only.")},n.selectAlbum=function(e){return{data:function(){return{media:e}}}},n.enableEditor=function(){var e,t,r={};e=n.feed,r.localData={feed:e},e.showMore()?r.remoteData=i.moreFeedText(e):r.remoteData=!1,t=c.open({type:"remote",scope:!1,controller:"RingBoxFeedController",backDropClose:!1,scrollable:!0,resolve:r,template:'<rg-postbox feed-map="feedMap" for-add="{{::forAdd}}" ></rg-postbox>'}),t.result.then(function(e){l.resetUpload(),e&&e.sucs&&n.$rgDigest()})},n.deleteFeed=function(e){var t,r="Are you sure you want to delete?";t=c.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"}),t.result.then(function(t){t&&i.deleteFeed(n.currentUser,e).then(function(e){n.setFeed(!0),o.show(e,"success")},function(e){n.setFeed(!0),o.show(e,"error")})})},n.saveUnsave=function(){i.saveUnsaveFeed(n.feed).then(function(e){e.sucs===!0&&(n.feed.setSaveUnsave(1===e.optn),n.$rgDigest())})},n.getShareData=function(){return function(){return{keyid:n.keyid,feed:n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed}}},n.getImageData=function(e,t){return function(){return{image:e,feed:t}}},n.getMediaData=function(e,t){return{data:function(){var n;return n=t.getAlbum().getContents().all(),n=n.map(function(e){return e.value}),{media:e,playlist:n,feedTime:t.time()}},promise:e.fetchDetails()}},n.getMediaFirstData=function(e){var t,r=e||n.feed;return t=r.getMedias().top(),!!t&&n.getMediaData(t,r)},n.getAudioFirstData=function(e){var t,r=e||n.feed;return t=r.getAudios().top(),!!t&&n.getMediaData(t,r)},n.goToFeed=g,n.isShareAble=function(e){var t=e.hasSharedFeed()?e.getOrginalFeed():e;return t.isShareAble()};function g(e){e&&r.path(e)}function E(){var e=c.open({type:"remote",scope:!1,controller:"feedEditTagController",resolve:{localData:{feed:n.feed},remoteData:function(){return n.feed.hasTagUsers()?i.getTagUsers(n.feed):{}}},templateUrl:"templates/home/feed-tag-user-edit.html"});e.result.then(function(e){e&&(n.feed=e),n.$rgDigest()})}n.openRingBoxLike=function(){return n.feed.getTotalLikes()>0},n.openRingboxShare=function(){return n.feed.hasSharedFeed()?n.feed.getOrginalFeed().getTotalShare()>0:n.feed.getTotalShare()>0},n.whoShareFalsyFunc=function(){n.openRingboxShare()&&o.show("Oops! This feature is coming soon","info")},n.skipSaveScope||(d=n.feed.value?n.feed.value.getKey():n.feed.getKey(),i.addScope(d,n),n.$on("$destroy",function(){i.removeScope(n.feed.getKey())}))}angular.module("ringid.feed").controller("PopupSingleFeedController",PopupSingleFeedController),PopupSingleFeedController.$inject=["$scope","remoteData","$boxInstance","$controller","$$feedMap"];function PopupSingleFeedController(e,t,n,r,i){e.feed=i.create(t.newsFeedList[0]),e.hideSerial=!0,e.showCommentBox=!0,e.showFeedFullContent=!0,r("FeedSubController",{$scope:e})}angular.module("ringid.feed").controller("FeedWhoShareController",FeedWhoShareController),FeedWhoShareController.$inject=["$$connector","$scope","$$feedMap","feedFactory","OPERATION_TYPES","$rootScope","SystemEvents","Utils"];function FeedWhoShareController(e,t,n,r,i,o,a,s){var c,l,u,d,g,E,m,T=i.SYSTEM;t.feeds=[],t.message="",t.boxIsLoading=!t.params.boxIsLoading,t.params&&(m=t.params.feed?t.params.feed:r.getFeed(t.params.keyid)),t.showMessage=!1,t.shareMenuDisabled=!0,t.singleFeed=!0,t.hideSerial=!0,t.busy=!1,t.isSingleContentFeed=!1,t.boxHeight=o.windowHeight-20,E=s.debounce(function(){t.$emit(a.RINGBOX.UPDATE)},500),c=e.subscribe(function(e){return t.boxIsLoading=!1,t.isReady=!0,t.busy=!1,e.sucs?(e.newsFeedList&&e.newsFeedList.length&&f(e.newsFeedList),E(),void t.$rgDigest()):void t.$close()},{action:T.TYPE_WHO_SHARES_LIST}),l=e.subscribe(function(e){return t.boxIsLoading=!1,t.isReady=!0,t.busy=!1,e.sucs?(e.shares&&e.shares.length&&f(e.shares),E(),void t.$rgDigest()):void t.$close()},{action:T.ACTION_MEDIA_SHARE_LIST});function f(e){var r,i;for(g=0,i=e.length;g<i;g++)r=n.create(e[g]),m&&r.getKey()===m.getKey()&&r.setIdenticalFeed(m),t.feeds.push(r)}function p(){t.boxIsLoading=!0,t.feeds.length<t.params.feed.getTotalShare()&&!t.busy&&(t.params.feed.isMediaShared()&&t.params.feed.isSingleContentFeed()?(t.isSingleContentFeed=!0,e.send({actn:T.ACTION_MEDIA_SHARE_LIST,nfId:t.params.feed.getKey(),cntntId:t.params.feed.getSingleContent().getKey(),lmt:10,scl:2,pvtid:0},T.REQUEST_TYPE.REQUEST)):e.send({actn:T.TYPE_WHO_SHARES_LIST,nfId:t.params.feed.getKey(),st:t.feeds.length},T.REQUEST_TYPE.REQUEST),t.busy=!0,setTimeout(function(){t.busy=t.busy||!1,t.$rgDigest()},3e3),t.$rgDigest())}t.loadMore=p,t.loadMore(),t.$on("$destroy",function(){r.removeIgnoreFilter(u),r.removeIgnoreFilter(d),e.unsubscribe(c),e.unsubscribe(l)}),t.skipSaveScope=!0}angular.module("ringid.feed").controller("FeedSingleWhoShareController",FeedSingleWhoShareController),FeedSingleWhoShareController.$inject=["$controller","$scope","$routeParams","feedFactory"];function FeedSingleWhoShareController(e,t,n,r){t.viewType="singleWhoShareFeed",t.isReady=!1,t.$close=angular.noop,t.feedId=n.feedId,t.pagekey=r.getSingleFeedPageKey(t.feedId),t.params={},r.getSingleFeed(t.feedId).then(function(n){n?(t.params.feed=n,t.feed=n,t.feed.hasActivityMessage=function(){return!1},t.params.boxIsLoading=!1,i(),e("FeedWhoShareController",{$scope:t})):(t.params.boxIsLoading=!1,t.noData=!0)});function i(){t.feed&&(t.serial=!1,t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length)}t.$on("WINDOW_SCROLLED",function(){t.loadMore()})}angular.module("ringid.feed").controller("FeedRingboxWhoShareController",FeedRingboxWhoShareController),FeedRingboxWhoShareController.$inject=["$controller","$scope","localData"];function FeedRingboxWhoShareController(e,t,n){t.viewType="ringbox",t.params=n,e("FeedWhoShareController",{$scope:t})}angular.module("ringid.feed").controller("feedShareController",feedShareController),feedShareController.$inject=["$scope","Auth","feedFactory","$rootScope","Ringalert","Utils","friendsFactory","$$stackedMap"];function feedShareController(e,t,n,r,i,o,a,s){e.feed=e.params.feed,e.afterShareCallback=e.afterShareCallback||e.params.afterShareCallback,e.updateFeedLocation=p,e.resetFeedLocation=f,e.currentUser=t.currentUser(),e.showFriendTag=!1,e.toggleShowFriendTag=S,e.friendTags=s.createNew(),e.fetchFriends=v,e.selectFriendTag=M,e.removeFriendTag=D,f(),m(),E(),u(),g(),e.shareFeed=c;function c(){var t=h();l(),d(),E(),n.shareFeed(t).then(function(t){g(),m(),u(),E(),f(),_(),A(),I(t),e.media?(e.media.share(!0),e.$close()):e.popup?e.$close():e.$parent.$rgDigest()},function(t){g(),u(),C(t),e.$parent.$rgDigest()}),e.$rgDigest()}function l(){e.inputDisabled=!0}function u(){e.inputDisabled=!1}function d(){e.boxIsLoading=!0}function g(){e.boxIsLoading=!1}function E(){e.errorMessage=""}function m(){e.feedText=""}function T(t){e.feedLocation=t}function f(){e.feedLocation=""}function p(t){T(t),e.$rgDigest()}function _(){r.$broadcast("FEED_LIST_CHANGED"),e.$broadcast("cleareditor")}function I(e){i.show(e,"success")}function h(){var t=e.media?null:e.feed,n=e.media,r={text:e.feedText,feed:t&&t.hasSharedFeed()?t.getOrginalFeed():t,location:e.feedLocation};return e.emotions.length&&(r.mdIds=[e.emotions[0].id],e.emotions.length=0),e.friendTags.length()>0&&(r.tFrndIds=[],e.friendTags.doForAll(function(e){r.tFrndIds.push(e.getUtId())}),e.friendTags.reset()),(n||t&&t.isSingleContentFeed()&&(t.getMedias().length()||t.getAudios().length()))&&(n=n||t.getSingleContent(),r.audio=n.isAudio(),r.cntntIDLst=[n.getKey()],r.addShare=!0,r.user=e.currentUser),r}function A(){e.afterShareCallback&&e.afterShareCallback()}function C(t){var n=o.getReasonMessageFromResponse(t);""===n&&(n="Unable To Share Status. Please Try Again Later"),e.errorMessage=n}function S(){e.showFriendTag=!e.showFriendTag,e.showFriendTag&&e.$broadcast("focusSelector","friendtag"),e.$rgDigest()}function v(t){return a.myFriends(5,t,e.friendTags)}function M(t){e.friendTags.save(t.value.getKey(),t.value),e.$rgDigest();
}function D(t,n){n.stopPropagation(),t?e.friendTags.remove(t.value.getKey()):e.friendTags.removeTop(),e.$rgDigest()}e.emotions=[],e.chooseEmotion=function(t){e.emotions.length=0,e.emotions.push(t)}}angular.module("ringid.feed").controller("feedRingboxShareController",feedRingboxShareController),feedRingboxShareController.$inject=["$scope","$boxInstance","$controller","localData"];function feedRingboxShareController(e,t,n,r){e.params={feed:r.feed,afterShareCallback:e.$close,showSharePostBox:!0},n("feedShareController",{$scope:e})}angular.module("ringid.feed").controller("feedMediaShareController",feedMediaShareController).controller("feedNewsPortalShareController",feedNewsPortalShareController).controller("feedInlineShareController",feedInlineShareController),feedInlineShareController.$inject=["$scope","$controller"];function feedInlineShareController(e,t){e.params={feed:e.feed,afterShareCallback:e.closeShareBox,showSharePostBox:!0},t("feedShareController",{$scope:e})}feedMediaShareController.$inject=["$scope"];function feedMediaShareController(e){e.params={feed:null},e.afterShareCallback=angular.noop,e.closeShareBox=function(){e.$close()},e.autoAdjustScroll="false"}feedNewsPortalShareController.$inject=["$scope"];function feedNewsPortalShareController(e){e.closeShareBox=function(){e.$close()},e.afterShareCallback=angular.noop,e.autoAdjustScroll="false",e.popup=!0}angular.module("ringid.feed").controller("FeedEditController",FeedEditController),FeedEditController.$inject=["Auth","SystemEvents","$scope","localData","remoteData","feedFactory","Ringalert"];function FeedEditController(e,t,n,r,i,o,a){var s=r.feed;n.emotions=[],n.editorEnabled=!1,n.errorImageEdit=!1,n.feedLocation={},n.ogData=n.ogData||{},n.filterOnProgress=!1,n.ogDataLoading=!1,n.ogShowPreview=!1,n.previousFeedLocation="",n.feedEditChooseEmotion=d,n.cancelEdit=m,n.updateFeed=E,n.selectedFeedLocation=u,n.resetFeedLocation=l,n.getFeedHtml=c,i&&(i.newsFeedList?s.parseMoreText(i.newsFeedList[0]):s.parseMoreText(i)),n.editorEnabled=!0,n.feedText=s.text(),n.feedLocation=angular.copy(s.getLocationInfo()),n.ogData=angular.copy(s.getOgData()),n.ogData.image&&(n.ogData.images=[n.ogData.image]),n.ogShowPreview=s.hasOgData(),n.emotions=s.hasFeelings()?[s.getFeelings()]:[];function c(){return s.getDynamicText()}function l(){n.feedLocation={}}function u(e){n.feedLocation=e,n.$rgDigest()}function d(e){n.emotions.length=0,n.emotions.push(e),n.$rgDigest()}function g(){return!(n.feedText||n.feedLocation.description||n.ogData.url||n.feelings&&n.feelings.id||n.feed.hasMedia()||n.feed.hasTagUsers())}n.sentRequest=!1;function E(){n.feedText=n.feedText.trim(),n.emotions.length?(n.feelings=n.emotions[0],n.emotions.length=0):n.feelings=!1,g()?(n.errorImageEdit=!0,n.editorEnabled=!0):(n.sentRequest=!0,o.updateFeed(e.currentUser(),s,n.feedText,n.feedLocation,n.ogData,n.feelings).then(function(e){e.sucs?n.$close({sucs:!0}):(n.sentRequest=!1,a.show(e,"error"),n.$rgDigest())},function(e){a.show(e,"error"),n.$rgDigest()})),n.$rgDigest()}function m(){n.$close({sucs:!1})}n.contentHightChanged=function(){n.$emit(t.RINGBOX.UPDATE)}}angular.module("ringid.feed").controller("FeedDashboardController",["$scope","$controller","OPERATION_TYPES",function(e,t,n){e.pagekey=n.SYSTEM.TYPE_NEWS_FEED+".all",e.action=n.SYSTEM.TYPE_NEWS_FEED,e.params={actn:n.SYSTEM.TYPE_NEWS_FEED},e.forAdd="my",t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedProfileController",["$scope","$controller","$routeParams","OPERATION_TYPES","profileFactory",function(e,t,n,r,i){var o,a,s,c=i.getProfile(n.uId);c.isCurrentUser()?(o="my",s=r.SYSTEM.TYPE_MY_NEWS_FEED):(o="friend",s=r.SYSTEM.TYPE_FRIEND_NEWSFEED),a=s+"."+c.getUId(),e.pagekey=a,e.action=s,e.params={actn:s,futId:c.getUtId()},e.forAdd=o,e.sortBy="at",t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedCircleController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="circle",o=n.circleId||0,a=r.SYSTEM.TYPE_GROUP_NEWS_FEED+"."+o;e.pagekey=a,e.action=r.SYSTEM.TYPE_GROUP_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_GROUP_NEWS_FEED,grpId:o},e.forAdd=i,e.shareMenuDisabled=!0,0===o&&(e.showPostBox=function(){return!1}),t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedMediasController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="my",a=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED+".medias";e.pagekey=a,e.action=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,pvtid:0,st:0,mtf:0},e.a_f_m="f",e.setTrending=function(t){var n=e.a_f_m;e.params.mtf=t,1===t?e.a_f_m="t":e.a_f_m="f",n!==e.a_f_m&&(i.reset(),i.initFeedRequest(e.params),e.$rgDigest())},e.forAdd=o,e.sortBy="at",e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedNewsportalController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="newsportal",o=r.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal";e.pagekey=o,e.action=r.SYSTEM.TYPE_NEWS_PORTAL_FEED,e.params={actn:r.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},e.isReady=!0,e.forAdd=i,e.sortBy="at",e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("feedTagUserListController",feedTagUserListController),feedTagUserListController.$inject=["$scope","remoteData","userFactory","Api"];function feedTagUserListController(e,t,n,r){var i,o,a=t.fTgLst;if(e.usersUtIds=[],e.users=[],i=a.length)for(e.total=i,o=0;o<a.length;o++)a[o].fn=a[o].nm,e.users.push(n.createByUtId(a[o],!0));e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:r.user.getMutualFriends(e)}}}angular.module("ringid.feed").filter("filterUserByName",filterUserByName).controller("feedEditTagController",feedEditTagController);function filterUserByName(){return function(e,t){var n,r,i=[];if(e)for(n=new RegExp(t,"i"),r=0;r<e.length;r++)e[r].getName().match(n)&&i.push(e[r]);return i}}feedEditTagController.$inject=["$scope","localData","remoteData","$$connector","feedFactory","OPERATION_TYPES","userFactory","$filter","friendsFactory","Ringalert","Auth"];function feedEditTagController(e,t,n,r,i,o,a,s,c,l,u){var d,g=t.feed,E=!1,m=[],T=[],f=u.currentUser(),p=[];e.users=[],e.filterText="",e.loading=!0,e.currentType="a";function _(){e.users=s("filterUserByName")(p,e.filterText)}function I(){E||(c.searchContact({schPm:e.filterText},!0),e.loading=!0,E=!0)}e.$watch("filterText",function(t,n){_(),e.users.length<5&&t.length>n.length?(E=!1,I()):(E=!1,e.loading=!1)}),e.$watch(c.friends.length(),function(){h(),e.loading=!1,E=!1});function h(){var t;return"a"!==e.currentType?void _():(c.friends.doForAll(function(e){var t=e.getLiteUser();p.contains(t,function(e,t){return e.equals(t,"utId")})===-1&&m.contains(t,function(e,t){return e.equals(t,"utId")})===-1&&p.push(t)}),t=m.filter(function(e){return p.contains(e,function(e,t){return e.equals(t,"utId")})===-1}),p=p.concat(t),void _())}if(n&&n.fTgLst&&n.fTgLst.length){for(d=0;d<n.fTgLst.length;d++)n.fTgLst[d].fn=n.fTgLst[d].nm,m.contains(n.fTgLst[d].utId,function(e,t){return e.equals(t,"utId")})===-1&&(m.push(a.createByUtId(n.fTgLst[d],!0)),T.push(m[d]));h()}e.loading=!1,g.hasTagUsers()||h(),e.toggle=function(t){e.currentType!==t&&(e.currentType=t,"a"===t?(p=[],h()):(p=m,_()))},e.checked=function(e){return m.indexOf(e)>-1},e.loadMore=function(){e.filterText.length?I():(c.getContactDetails(),e.loading=!0)},e.addRemoveTag=function(t,n){var r=m.indexOf(n);r>-1?m.splice(r,1):(m.push(n),e.users.length-m.length<5&&e.loadMore())},e.saveTagUser=function(){var t,n,r=T.difference(m),o=m.difference(T),a={},s={};if(!r.length&&!o.length)return void l.show("Please Make Your Changes Before Submit","warning");if(0===o.length&&r.length===T.length&&!g.validateForUpdateTag())return void l.show("You can't submit an empty feed","warning");if(r.length)for(n=0;n<r.length;n++)a[r[n].getUtId()]=!0;if(o.length)for(n=0;n<o.length;n++)s[o[n].getUtId()]=!0;t={removed:Object.keys(a),"new":Object.keys(s)},i.updateFeed(f,g,g.text(),g.getLocationInfo(),!1,g.getFeelings(),t).then(function(t){g.updateTagUser(t),e.$close(g)},function(e){l.show(e,"error")})},e.$on("$destroy",function(){})}angular.module("ringid.feed").controller("FeedMediaListController",FeedMediaListController),FeedMediaListController.$inject=["$scope","$boxInstance","$controller","localData"];function FeedMediaListController(e,t,n,r){e.mediaFeed=r.media,e.getMediaDataPopUp=function(e,t){return{data:function(){var n;return n=t.getAlbum().getContents().all(),n=n.map(function(e){return e.value}),{media:e,playlist:n,feedTime:t.time()}},promise:e.fetchDetails()}}}angular.module("ringid.feed").controller("FeedSaveController",FeedSaveController),FeedSaveController.$inject=["$scope","$controller","OPERATION_TYPES"];function FeedSaveController(e,t,n){var r="all_saved_feeds",i=n.SYSTEM.TYPE_SAVED_FEED+".all_saved_feeds";e.pagekey=i,e.params={actn:n.SYSTEM.TYPE_SAVED_FEED,pType:n.SYSTEM.PROFILE_TYPES.ALL_SAVED_FEEDS,scl:2,lmt:10,tm:0,svd:!0},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=r,e.shareMenuDisabled=!0,e.sortBy="stm",e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}angular.module("ringid.feed").directive("rgCommonFeedTop",rgCommonFeedTop),rgCommonFeedTop.$inject=[];function rgCommonFeedTop(){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgCommonFeedBottom",rgCommonFeedBottom),rgCommonFeedBottom.$inject=[];function rgCommonFeedBottom(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgCommonFeedDetails",rgCommonFeedDetails);function rgCommonFeedDetails(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}!function(e,t){"use strict";e.module("ringid.chat",["ringid.config","ringid.sticker","ngWebSocket","ringid.utils","ringid.connector","angularAudioRecorder"])}(angular,window),function(e){e.CHAT_APP={GLOBALS:{uId:-1,appVersion:-1,oIpPort:{}},Constants:{},PacketFormats:{},AuthPacketSender:{},AuthRequests:{},AuthResponses:{},ChatPacketSender:{},Helpers:{},ResponseHelpers:{},SharedHelpers:{},ChatPacketParser:{},PacketSendFlow:{},ChatSessionPacketSender:{},ChatOnlinePacketSender:{},ChatOfflinePacketSender:{},MODELS:{SESSION_OBJECT:{}},CHAT_CLOCK:{},REQUEST_CACHE:{},RESPONSE_CACHE:{},CHAT_SESSION:{},BROKEN_PACKET_CACHE:{},UTILS:{},ChatConnector:{},AuthConnector:{},getCurrentUserId:function(){return CHAT_APP.GLOBALS.utId},getCurrentUserUId:function(){return CHAT_APP.GLOBALS.uId},getCurrentUserName:function(){return CHAT_APP.GLOBALS.name},getCurrentUserProfileImage:function(){return CHAT_APP.GLOBALS.profileImage},getAppVersion:function(){return CHAT_APP.GLOBALS.appVersion},getOfflineIp:function(){return CHAT_APP.GLOBALS.oIpPort.ip},getOfflinePort:function(){return CHAT_APP.GLOBALS.oIpPort.port},setOfflineIp:function(e){CHAT_APP.GLOBALS.oIpPort.ip=e},setOfflinePort:function(e){CHAT_APP.GLOBALS.oIpPort.port=e},Init:function(){}}}(window),function(e){var t={FRIEND_CHAT_REGISTER:1,FRIEND_CHAT_UNREGISTER:2,FRIEND_CHAT_REGISTER_CONFIRMATION:3,FRIEND_CHAT_IDLE:4,FRIEND_CHAT_TYPING:5,FRIEND_CHAT_MSG:6,FRIEND_CHAT_MSG_EDIT:7,FRIEND_CHAT_BROKEN_MSG:8,FRIEND_CHAT_BROKEN_MSG_EDIT:9,FRIEND_CHAT_MULTIPLE_MSG:10,FRIEND_CHAT_DELIVERED:15,FRIEND_CHAT_SENT:16,FRIEND_CHAT_SEEN:17,FRIEND_CHAT_SEEN_CONFIRMATION:18,FRIEND_CHAT_MULTIPLE_MSG_DELETE:19,FRIEND_CHAT_MSG_DELETE_CONFIRMATION:20,FRIEND_CHAT_BROKEN:24,FRIEND_CHAT_BROKEN_CONFIRMATION:25,FRIEND_CHAT_BLOCK:27,FRIEND_CHAT_UNBLOCK:28,FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION:29},n={TAG_CHAT_TAG_REGISTER:41,TAG_CHAT_TAG_UNREGISTER:42,TAG_CHAT_TAG_REGISTER_CONFIRMATION:43,TAG_CHAT_TAG_INFORMATION:46,TAG_CHAT_TAG_INFORMATION_CONFIRMATION:47,TAG_CHAT_TAG_MEMBER_ADD:51,TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION:52,TAG_CHAT_MEMBER_REMOVE_LEAVE:53,TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION:54,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE:55,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION:56,TAG_CHAT_IDLE:61,TAG_CHAT_TYPING:62,TAG_CHAT_MSG:63,TAG_CHAT_MSG_EDIT:64,TAG_CHAT_BROKEN_MSG:65,TAG_CHAT_BROKEN_MSG_EDIT:66,TAG_CHAT_MULTIPLE_MSG:67,TAG_CHAT_DELIVERED:68,TAG_CHAT_SENT:69,TAG_CHAT_SEEN:70,TAG_CHAT_SEEN_CONFIRMATION:71,TAG_CHAT_MULTIPLE_MSG_DELETE:72,TAG_CHAT_MSG_DELETE_CONFIRMATION:73,TAG_CHAT_GENERAL_BROKEN_PACKET:74,TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION:75,TAG_CHAT_GET_MESSAGE_SEEN_LIST_REQUEST:76,TAG_CHAT_MESSAGE_SEEN_LIST:77,TAG_CHAT_MESSAGE_SEEN_LIST_CONFIRMATION:78},r={OFFLINE_FRIEND_INFORMATION:91,OFFLINE_FRIEND_INFORMATION_CONFIRMATION:92,OFFLINE_GET_REQUEST:93,OFFLINE_GET_REQUEST_CONFIRMATION:94,OFFLINE_FRIEND_UNREAD_MESSAGE:95,OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:96,OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST:97,OFFLINE_FRIEND_HISTORY_MESSAGE:98,OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION:99,OFFLINE_GET_FRIEND_MESSAGE_STATUS:100,OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION:101,GET_UNREAD_COUNT:121,GET_CONVERSATION_REQUEST:102,MESSAGE_CONVERSATION_LIST:103,OFFLINE_TAG_INFORMATION_ACTIVITY:104,OFFLINE_MY_TAG_LIST:105,OFFLINE_TAG_UNREAD_MESSAGE:106,OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:107,OFFLINE_TAG_CREATE_TAG:108,OFFLINE_TAG_CREATE_TAG_CONFIRMATION:109,OFFLINE_TAG_HISTORY_MESSAGE_REQUEST:110,OFFLINE_TAG_HISTORY_MESSAGE:111,OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS:112,OFFLINE_TAG_INFORMATION_WITH_MEMBERS:113,OFFLINE_TAG_CONFIRMATION:117,OFFLINE_BROKEN_HISTORY_PACKET:118,OFFLINE_BROKEN_PACKET:119,OFFLINE_BROKEN_PACKET_CONFIRMATION:120},i=1e3,o={PUBLIC_CHAT_REGISTER:i+1,PUBLIC_CHAT_UNREGISTER:i+2,PUBLIC_CHAT_REGISTER_CONFIRMATION:i+3,PUBLIC_CHAT_CHAT_IDEL:i+4,PUBLIC_CHAT_CHAT_MESSAGE_TYPING:i+5,PUBLIC_CHAT_CHAT_MESSAGE:i+6,PUBLIC_CHAT_CHAT_MESSAGE_EDIT:i+7,PUBLIC_CHAT_CHAT_MESSAGE_BROKEN:i+8,PUBLIC_CHAT_CHAT_MESSAGE_BROKEN_EDIT:i+9,PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED:i+10,PUBLIC_CHAT_CHAT_MESSAGE_SENT:i+11,PUBLIC_CHAT_GET_MEMBER_LIST:i+12,PUBLIC_CHAT_MEMBER_LIST_CONFIRMATION:i+13,PUBLIC_CHAT_MEMBER_LIST:i+14,PUBLIC_CHAT_MEMBER_COUNT_CHANGE:i+15,PUBLIC_CHAT_MEMBER_COUNT_CHANGE_CONFIRMATION:i+16,PUBLIC_CHAT_DELETE_MESSAGE:i+34,PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION:i+35,PUBLIC_CHAT_LIKE_A_MESSAGE:i+36,PUBLIC_CHAT_UNLIKE_A_MESSAGE:i+37,PUBLIC_CHAT_LIKE_UNLIKE_MESSAGE_CONFIRMATION:i+38,PUBLIC_CHAT_REPORT_A_MESSAGE:i+39,PUBLIC_CHAT_REPORT_A_MESSAGE_CONFIRMATION:i+40,PUBLIC_CHAT_LIKE_MEMBER_LIST_REQUEST:i+41,PUBLIC_CHAT_LIKE_MEMBER_LIST:i+42},a={PUBLIC_CHAT_ROOM_LIST_REQUEST:i+17,PUBLIC_CHAT_ROOM_LIST_SEARCH_REQUEST:i+18,PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION:i+19,PUBLIC_CHAT_ROOM_LIST:i+20,PUBLIC_CHAT_GET_ROOM_IPPORT:i+21,PUBLIC_CHAT_ROOM_IPPORT_CONFIRMATION:i+22,PUBLIC_CHAT_ROOM_INFORMATION_REQUEST:i+23,PUBLIC_CHAT_ROOM_INFORMATION:i+24,PUBLIC_CHAT_GET_HISTORY:i+25,PUBLIC_CHAT_GET_HISTORY_CONFIRMATION:i+26,PUBLIC_CHAT_HISTORY_MESSAGE_LIST:i+27,PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY_REQUEST:i+28,PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY:i+29,PUBLIC_CHAT_BROKEN_PACKET:i+30,PUBLIC_CHAT_BROKEN_CONFIRMATION:i+31,PUBLIC_CHAT_SHADOW_IDS_INFO_REQUEST:i+32,PUBLIC_CHAT_SHADOW_IDS_INFO_RESPONSE:i+33,PUBLIC_CHAT_CATEGORY_LIST_REQUEST:i+43,PUBLIC_CHAT_CATEGORY_LIST:i+44},s=Object.assign({},t,n,r,o,a),c={},l={PACKET_IP_SIZE:4,PACKET_PORT_SIZE:2,PACKET_DYNAMIC_ATTRIBUTE:-1,PACKET_RAW_BYTE_ATTRIBUTE:-2,ONE_BYTE_SIZE:1,TWO_BYTE_SIZE:2,FOUR_BYTE_SIZE:4,EIGHT_BYTE_SIZE:8,PACKET_MAX_SIZE:512,TAG_ID_NO_OF_TIME_DIGIT:10,TAG_ID_NO_OF_USER_ID_DIGIT:6,OFFLINE_PACKET_TYPE_START:91,ATTRIBUTE_TYPE:{INTEGER:1,STRING:2,BYTE:3}},u={LOCAL_CHAT:!1,LOCAL_CHAT_REG_IP:"192.168.1.125",LOCAL_CHAT_REG_PORT:1500,LOCAL_CHAT_OFFLINE_IP:"192.168.1.125",LOCAL_CHAT_OFFLINE_PORT:1200,API_VERSION:3,API_VERSION_PORT_OFFSET:0,AUTH_UID_LIST_LIMIT:15,ACTUAL_TAG_REGISTER_TIMEOUT:180,TAG_REGISTER_TIMEOUT:160,API_FETCH_RETRY_COUNT:5,API_FETCH_RETRY_DELAY:3e3,RETRY_COUNT:5,AUTH_REQUEST_TIMEOUT:2e3,REQUEST_TIMEOUT:15e3,BOX_WAITING_TIME:180,UDP_SERVER_KEEP_ALIVE_INTERVAL:1e4,REQUEST_CACHE_VALIDITY:15e3,RESPONSE_CACHE_VALIDITY:4e3,BROKEN_CACHE_VALIDITY:3e5,TEMP_MESSAGE_CACHE_VALIDITY:12e4,SESSION_TYPES:{FRIEND:1,TAG:2,ROOM:3},REQUEST_TYPES:{FRIEND:1,TAG:2,ROOM:3},MEMBER_STATUS:{MEMBER:1,ADMIN:2,OWNER:3,REMOVED:4,LEAVE:5},MEMBER_MOODS:{ONLINE:1,AWAY:2,OFFLINE:3,DO_NOT_DISTURB:4},REGISTRATION_TYPES:{CREATE:1,ONLY_REGISTER:2,CHAT_INVITE:3},MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,TEXT:2,EMOTICON_MESSAGE:3,LOCATION_SHARE:4,LINK_SHARE:5,STICKER:6,IMAGE:7,AUDIO:8,VIDEO:9,CAMERA_IMAGE:10,FILE_STREAM:11,CONTACT_SHARE:12,FILE_STREAM_MANIFEST:13,HISTORY_RE_FETCH:14,RING_MEDIA_MESSAGE:15,GROUP_ACTIVITY:20,TYPING:101},STATUS_MESSAGE_TYPES:{TAG_MEMBER_ADD:1,TAG_MEMBER_DELETE:2,TAG_MEMBER_LEAVE:3,TAG_MEMBER_STATUS_CHANGE_OWNER:4,TAG_MEMBER_STATUS_CHANGE_ADMIN:5,TAG_MEMBER_STATUS_CHANGE_MEMBER:6,TAG_NAME_CHANGE:7,TAG_PICTURE_CHANGE:8,TAG_INFO_UPDATED:9,TAG_ADMIN_ADD:10},PAGE_DIRECTION:{UP:1,DOWN:2},PAGE_LIMIT:10,ONLINE_STATUS:{OFFLINE:1,ONLINE:2,AWAY:3},ONLINE_MOOD:{ALIVE:1,DONT_DISTURB:2,BUSY:3,INVISIBLE:4},SECRET_VISIBILITY:{NON_VISIBLE:0,VISIBLE:1},TAG_ACTIVITY_TYPE:{DELETED:0,ADDED:1,LEAVE:2,TAG_RENAME:3,MEMBER_TYPE_CHANGE:4,TAG_URL_RENAME:5,TAG_CREATED:6},USER_PRESENCE:{OFFLINE:1,ONLINE:2,AWAY:3},HISTORY_MAX_MESSAGE:10,TAB_SYNC_MAX_TIME:18e4,TAB_SYNC_ACTIONS:{AUTH_REQUEST:0,CHAT_REQUEST:1,GENERAL_INFO_UPDATE:3,CHAT_BOX_INFO_UPDATE:4,SECRET_CHAT_TIMER:5,CHAT_HISTORY_REFRESH:6,CHAT_MSESSAGE_UPDATE:7},MAX_TASK_RETRY_COUNT:15,SHARED_WORKER_PATH:"js/worker/chat/shared.js",CHAT_WORKER_PATH:"/js/worker/chat/chat.worker.js"},d={KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},g={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_USER_MOOD_PRESENCE:199,GET_OFFLINE_IP_PORT:83},E={},m={DEBUG:0,AUTH_REQUEST_RESPONSE:1,CHAT_REQUEST_RESPONSE:2,CHAT_DATA_RECEIVED:3,AUTH_DATA_RECEIVED:4,EXCEPTION:5,CHAT_TIMER_UPDATE:6,RE_INIT:7,FORWARD_TO_AUTH:8},T={serverTimeDiff:0,serverTime:0,offlineUpdateTime:0},f={version:"3.0"},p={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},_={OFFLINE:1,ONLINE:2},I={MESSAGE_SENDING:{ONLINE_IP_PORT_REQUEST:0,FIRST_ONLINE:1,PRESENCE_REFRESH:2,SECOND_ONLINE:3,ONLINE_IP_PORT_REFRESH:4,THIRD_ONLINE:5,ONLINE_SUCCESS:6,ONLINE_FAILED:7,FIRST_OFFLINE:101,OFFLINE_IP_PORT_REFRESH:102,SECOND_OFFLINE:102,OFFLINE_FAILED:104,OFFLINE_SUCCESS:105,SUCCESS:201,FAILED:202}},h={PERMISSION_DENIED:1},A={},C={};E[g.RECEIVED_F2F_CHAT]=g.START_TAG_CHAT,E[g.RECEIVED_TAG_CHAT]=g.START_TAG_CHAT,C[t.FRIEND_CHAT_REGISTER]=t.FRIEND_CHAT_REGISTER_CONFIRMATION,C[t.FRIEND_CHAT_MSG]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],C[t.FRIEND_CHAT_MSG_EDIT]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],C[t.FRIEND_CHAT_BROKEN_MSG]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],C[t.FRIEND_CHAT_BROKEN_MSG_EDIT]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],C[t.FRIEND_CHAT_DELIVERED]=[t.FRIEND_CHAT_SEEN,t.FRIEND_CHAT_SEEN_CONFIRMATION],C[t.FRIEND_CHAT_SEEN]=t.FRIEND_CHAT_SEEN_CONFIRMATION,C[t.FRIEND_CHAT_BROKEN]=t.FRIEND_CHAT_BROKEN_CONFIRMATION,C[t.FRIEND_CHAT_MULTIPLE_MSG_DELETE]=t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,C[r.OFFLINE_FRIEND_INFORMATION]=r.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,C[r.OFFLINE_FRIEND_UNREAD_MESSAGE]=r.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,C[r.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]=r.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,C[r.OFFLINE_FRIEND_HISTORY_MESSAGE]=r.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,C[r.OFFLINE_GET_FRIEND_MESSAGE_STATUS]=r.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,C[n.TAG_CHAT_TAG_REGISTER]=n.TAG_CHAT_TAG_REGISTER_CONFIRMATION,C[n.TAG_CHAT_TAG_INFORMATION]=n.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,C[n.TAG_CHAT_TAG_MEMBER_ADD]=n.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,C[n.TAG_CHAT_MULTIPLE_MSG_DELETE]=n.TAG_CHAT_MSG_DELETE_CONFIRMATION,C[n.TAG_CHAT_MEMBER_REMOVE_LEAVE]=n.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,C[n.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]=n.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,C[n.TAG_CHAT_GENERAL_BROKEN_PACKET]=n.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,C[n.TAG_CHAT_MSG]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],C[n.TAG_CHAT_MSG_EDIT]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],C[n.TAG_CHAT_BROKEN_MSG]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],C[n.TAG_CHAT_BROKEN_MSG_EDIT]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],C[n.TAG_CHAT_DELIVERED]=[n.TAG_CHAT_SEEN,n.TAG_CHAT_SEEN_CONFIRMATION],C[n.TAG_CHAT_SEEN]=n.TAG_CHAT_SEEN_CONFIRMATION,C[n.TAG_CHAT_GET_MESSAGE_SEEN_LIST_REQUEST]=[n.TAG_CHAT_MESSAGE_SEEN_LIST_CONFIRMATION,n.TAG_CHAT_MESSAGE_SEEN_LIST],C[r.OFFLINE_TAG_CREATE_TAG]=r.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,C[r.OFFLINE_GET_REQUEST]=r.OFFLINE_GET_REQUEST_CONFIRMATION,C[r.OFFLINE_TAG_UNREAD_MESSAGE]=r.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,C[r.OFFLINE_BROKEN_PACKET]=r.OFFLINE_BROKEN_PACKET_CONFIRMATION,C[r.OFFLINE_BROKEN_HISTORY_PACKET]=r.OFFLINE_BROKEN_PACKET_CONFIRMATION,C[r.GET_CONVERSATION_REQUEST]=r.OFFLINE_GET_REQUEST_CONFIRMATION,C[r.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]=r.OFFLINE_TAG_CONFIRMATION,C[r.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]=r.OFFLINE_TAG_CONFIRMATION,C[o.PUBLIC_CHAT_REGISTER]=o.PUBLIC_CHAT_REGISTER_CONFIRMATION,C[o.PUBLIC_CHAT_CHAT_MESSAGE]=[o.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED,o.PUBLIC_CHAT_CHAT_MESSAGE_SENT],C[o.PUBLIC_CHAT_CHAT_MESSAGE_EDIT]=[o.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED,o.PUBLIC_CHAT_CHAT_MESSAGE_SENT],C[o.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN]=[o.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED,o.PUBLIC_CHAT_CHAT_MESSAGE_SENT],C[o.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN_EDIT]=[o.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED,o.PUBLIC_CHAT_CHAT_MESSAGE_SENT],C[o.PUBLIC_CHAT_GET_MEMBER_LIST]=o.PUBLIC_CHAT_MEMBER_LIST_CONFIRMATION,C[o.PUBLIC_CHAT_MEMBER_COUNT_CHANGE]=o.PUBLIC_CHAT_MEMBER_COUNT_CHANGE_CONFIRMATION,C[o.PUBLIC_CHAT_DELETE_MESSAGE]=o.PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION,C[o.PUBLIC_CHAT_LIKE_A_MESSAGE]=o.PUBLIC_CHAT_LIKE_UNLIKE_MESSAGE_CONFIRMATION,C[o.PUBLIC_CHAT_UNLIKE_A_MESSAGE]=o.PUBLIC_CHAT_LIKE_UNLIKE_MESSAGE_CONFIRMATION,C[o.PUBLIC_CHAT_REPORT_A_MESSAGE]=o.PUBLIC_CHAT_REPORT_A_MESSAGE_CONFIRMATION,C[o.PUBLIC_CHAT_LIKE_MEMBER_LIST_REQUEST]=o.PUBLIC_CHAT_LIKE_MEMBER_LIST,C[a.PUBLIC_CHAT_ROOM_LIST_REQUEST]=a.PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION,C[a.PUBLIC_CHAT_ROOM_LIST_SEARCH_REQUEST]=a.PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION,C[a.PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY_REQUEST]=a.PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION,C[a.PUBLIC_CHAT_GET_ROOM_IPPORT]=a.PUBLIC_CHAT_ROOM_IPPORT_CONFIRMATION,C[a.PUBLIC_CHAT_ROOM_INFORMATION_REQUEST]=a.PUBLIC_CHAT_ROOM_INFORMATION,C[a.PUBLIC_CHAT_GET_HISTORY]=a.PUBLIC_CHAT_GET_HISTORY_CONFIRMATION,C[a.PUBLIC_CHAT_BROKEN_PACKET]=a.PUBLIC_CHAT_BROKEN_CONFIRMATION,C[a.PUBLIC_CHAT_CATEGORY_LIST_REQUEST]=a.PUBLIC_CHAT_CATEGORY_LIST,function(){var t,n,i,o,s,l,d,g=e.angular&&angular.isObject||e.isObject,E=Object.keys(I.MESSAGE_SENDING);for(i in u)if(u.hasOwnProperty(i)&&(o=u[i],g(o))){u[i+"_VALUE"]=[];for(s in o)o.hasOwnProperty(s)&&(l=o[s],u[i+"_VALUE"][l]=s)}for(t=0,n=E.length;t<n;t++){d=I.MESSAGE_SENDING[E[t]];try{A[d].NAME=E[t]}catch(m){A[d]={},A[d].NAME=E[t]}}Object.keys(r).forEach(function(e){c[r[e]]=!0}),Object.keys(a).forEach(function(e){c[a[e]]=!0})}(),e.CHAT_APP.Constants={FRIEND_CHAT_PACKET_TYPE:t,TAG_CHAT_PACKET_TYPE:n,PUBLIC_CHAT_ONLINE_PACKET_TYPE:o,PUBLIC_CHAT_OFFLINE_PACKET_TYPE:a,OFFLINE_PACKET_TYPE:r,OFFLINE_PACKETS:c,PUBLIC_CHAT_OFFSET:i,PACKET_TYPES:s,CONFIRMATION_MAP:C,GENERAL_CONSTANTS:u,PACKET_CONSTANTS:l,WORKER_NOTIFIER_TYPES:m,AUTH_SERVER_ACTIONS:g,AUTH_SERVER_REQUEST_UPDATE_MAP:E,CHAT_STATES:I,CHAT_STATE_INFO:A,CHAT_GLOBAL_VALUES:T,AUTH_REQUEST_TYPE:d,PLATFORM:p,CHAT_VERSION_INFO:f,RESPONSE_REASON_CODES:h,CHAT_SERVER_TYPES:_}}(window),function(e){var t=e.CHAT_APP.Constants,n=t.GENERAL_CONSTANTS;function r(t){return(t||"")+(e._cti||"")+e.Math.floor(e.Math.random()*(new e.Date).getTime())}function i(t,n){var r,i=CHAT_APP.SharedHelpers.getChatServerCurrentTime(),o=e.CHAT_APP.getCurrentUserId();return r=n||t?t:i,r||Logger.debug("alert","Invalid Timestamp","CHAT"),PacketIDGenerator.create(o,r,n)}function o(e,t,n,r,i){var o=0,a=i;function s(){!o||o<r&&!t.call(null,o)?(a>=i&&(e.call(),o++,a=0),a+=200,setTimeout(s,200)):t.call(null,o)||n.call()}s()}function a(e){var t=CHAT_APP.SharedHelpers.getChatServerCurrentTime();return t-e<n.ACTUAL_TAG_REGISTER_TIMEOUT}function s(){var e=this,t={},n={},i={},o=null;function a(e,i,o){var a=r("ctr");return t[a]=e,n[a]={delay:i,count:i,maxIteration:o},a}function s(e){delete t[e],delete n[e],Logger.debug("debug","TIMER DELETED FOR ID "+e,"CHAT_TIMER_DEBUG")}function c(e,t){var n;return i[e]||(i[e]={}),n=r("ccl"),i[e][n]=t,n}function l(e,t){delete i[e][t]}e.setTimeout=function(t,n){var r,i=0;return n>999&&(r=e.hasTimer(),i=a(t,n,1),r||e.start(),Logger.debug("debug","TIMEOUT SET FOR ID "+i,"CHAT_TIMER_DEBUG")),i},e.setInterval=function(t,n,r){var i,o=0;return n>999&&(i=e.hasTimer(),o=a(t,n,r||-1),i||e.start(),Logger.debug("debug","INTERVAL SET FOR ID "+o,"CHAT_TIMER_DEBUG")),o},e.clearTimeout=function(e){s(e)},e.clearInterval=function(e){s(e)},e.hasTimer=function(){return Object.keys(n).length>0},e.on=function(e,t){return c(e,t)},e.off=function(e,t){l(e,t)},e.trigger=function(e,t){var n;i[e]&&(n=Object.keys(i[e]),n.forEach(function(n){i[e][n].call(this,t)}))},e.stop=function(){clearInterval(o)},e.start=function(){o=setInterval(function(){var e,r,i,o;for(e=Object.keys(n),o=0;o<e.length;o++)r=e[o],i=n[r],i&&(0===i.maxIteration?s(r):0===i.count||i.maxIteration===-1?(t[r].call(),i.maxIteration!==-1&&(i.count=i.delay)):(i.count--,i.maxIteration!==-1&&i.maxIteration--))},1e3)}}e.CHAT_APP.UTILS={hasChatSession:a,getUUIDPacketId:i,callXTimeAfterYIntervalStopOnSuccess:o,getUniqueId:r,ChatClock:s}}(window),function(e){var t=e.CHAT_APP,n=t.Constants,r=n.CHAT_GLOBAL_VALUES,i=n.PUBLIC_CHAT_OFFSET;function o(){var e=Date.now()-r.serverTimeDiff;return e}function a(e){var t=e+r.serverTimeDiff;return t}function s(e){return e.packetType>i}e.CHAT_APP.SharedHelpers={getChatServerCurrentTime:o,getClientTimeFromServerTime:a,isPublicChatPacket:s}}(window),function(e){var t,n=e.CHAT_APP.Constants,r={},i=n.PACKET_CONSTANTS;t={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,LAST_ONLINE_TIME:26,NO_OF_ITEMS:27,BLOCK_UNBLOCK_DATE:28,MESSAGE_STATUS:29,IS_ADD_TO_DB:30,TAG_NAME_LENGTH:31,TAG_NAME:32,TAG_PICTURE_URL_LENGTH:33,TAG_PICTURE_URL:34,TAG_MEMBER_TYPE:35,TAG_MEMBER_ADDED_BY:36,TAG_NO_OF_MEMBERS:37,TAG_NO_OF_BROKEN_PKT:38,TAG_INFORMATION_UPDATE_FLAG:39,TAG_INFORMATION_TAG_NO_OF_MEMBERS:40,REGISTRATION_TYPE:41,PAGE_DIRECTION:42,PAGE_LIMIT:43,ACTIVITY_TYPE:45,ACTIVITY_VALUE_LENGTH:46,ACTIVITY_VALUE:47,CHANGED_BY_USER_ID:48,FRIEND_APP_TYPE:60,FRIEND_DEVICE_TOKEN_LENGTH:61,FRIEND_DEVICE_TOKEN:62,IS_SECRET_VISIBLE:63,APP_VERSION:64,FRIEND_PLATFORM:65,IS_VOIP_CALL:66,NO_OF_IDS:67,MEMBER_URL_LENGTH:68,MEMBER_URL:69,PAGING_STATE_LENGTH:70,PAGING_STATE:71,ADDTIME:72,START_INDEX:73,SERVER_IP_LENGTH:74,SERVER_IP:75,SERVER_REGISTER_PORT:76,MONTH:77,YEAR:78,RING_ID:79,RAW_DATA_BYTE:80,CONVERSATION_TYPE:81,FRIEND_GROUP_ID:82,UNREAD_COUNT:83,ROOM_ID_LENGTH:100,ROOM_ID:101,ROOM_NAME_LENGTH:102,ROOM_NAME:103,ROOM_URL_LENGTH:104,ROOM_URL:105,SEARCH_NAME_LENGTH:106,SEARCH_NAME:107,NO_OF_ROOM:108,NO_OF_MEMBER:109,SHADOW_ID:110,MESSENGER_OWNERID:111,CATEGORY_LENGTH:112,CATEGORY:113,COUNTRY_LENGTH:114,COUNTRY:115,LAST_CATEGORY_LENGTH:116,LAST_CATEGORY:117,TOTAL_ITEMS:118,ORIGINAL_PACKETID_LENGTH:119,ORIGINAL_PACKETID:120,REPORT_MESSAGE_LENGTH:121,REPORT_MESSAGE:122,PUBLIC_CHAT_LAST_LIKER_ID:123,LIKE_COUNT:124,I_LIKE:125,I_REPORT:126},r[t.PACKET_TYPE]={ATTRIBUTE_NAME:"PACKET_TYPE",VAR_NAME:"packetType",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.USER_ID]={ATTRIBUTE_NAME:"USER_ID",VAR_NAME:"userId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.FRIEND_ID]={ATTRIBUTE_NAME:"FRIEND_ID",VAR_NAME:"friendId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.PACKET_ID_LENGTH]={ATTRIBUTE_NAME:"PACKET_ID_LENGTH",VAR_NAME:"packetIdLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.PACKET_ID]={ATTRIBUTE_NAME:"PACKET_ID",VAR_NAME:"packetId",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.PLATFORM]={ATTRIBUTE_NAME:"PLATFORM",VAR_NAME:"platform",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.CHAT_BINDING_PORT]={ATTRIBUTE_NAME:"CHAT_BINDING_PORT",VAR_NAME:"chatBindingPort",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:4},r[t.TAG_ID]={ATTRIBUTE_NAME:"TAG_ID",VAR_NAME:"tagId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.ONLINE_STATUS]={ATTRIBUTE_NAME:"ONLINE_STATUS",VAR_NAME:"onlineStatus",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.USER_MOOD]={ATTRIBUTE_NAME:"USER_MOOD",VAR_NAME:"userMood",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.MESSAGE_TYPE]={ATTRIBUTE_NAME:"MESSAGE_TYPE",VAR_NAME:"messageType",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.TIMEOUT]={ATTRIBUTE_NAME:"TIMEOUT",VAR_NAME:"timeout",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.LATITUDE]={ATTRIBUTE_NAME:"LATITUDE",VAR_NAME:"latitude",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:4},r[t.LONGITUDE]={ATTRIBUTE_NAME:"LONGITUDE",VAR_NAME:"longitude",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:4},r[t.MESSAGE_LENGTH]={ATTRIBUTE_NAME:"MESSAGE_LENGTH",VAR_NAME:"messageLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.MESSAGE]={ATTRIBUTE_NAME:"MESSAGE",VAR_NAME:"message",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.MESSAGE_DATE]={ATTRIBUTE_NAME:"MESSAGE_DATE",VAR_NAME:"messageDate",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.NO_OF_MESSAGE]={ATTRIBUTE_NAME:"NO_OF_MESSAGE",VAR_NAME:"messagesLength",VAR_CONTAINER_NAME:"messages",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.FULL_NAME_LENGTH]={ATTRIBUTE_NAME:"FULL_NAME_LENGTH",VAR_NAME:"fullNameLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.FULL_NAME]={ATTRIBUTE_NAME:"FULL_NAME",VAR_NAME:"fullName",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.NO_OF_PACKET]={ATTRIBUTE_NAME:"NO_OF_PACKET",VAR_NAME:"packetsLength",VAR_CONTAINER_NAME:"packets",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.SEQUENCE_NO]={ATTRIBUTE_NAME:"SEQUENCE_NO",VAR_NAME:"sequenceNo",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.NO_OF_MEMBERS]={ATTRIBUTE_NAME:"NO_OF_MEMBERS",VAR_NAME:"membersLength",VAR_CONTAINER_NAME:"members",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.UPDATE_TIME]={ATTRIBUTE_NAME:"UPDATE_TIME",VAR_NAME:"updateTime",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.SERVER_DATE]={ATTRIBUTE_NAME:"SERVER_DATE",VAR_NAME:"serverDate",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.LAST_ONLINE_TIME]={ATTRIBUTE_NAME:"LAST_ONLINE_TIME",VAR_NAME:"lastOnlineTime",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.NO_OF_ITEMS]={ATTRIBUTE_NAME:"NO_OF_ITEMS",VAR_NAME:"noOfItems",VAR_CONTAINER_NAME:"items",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.BLOCK_UNBLOCK_DATE]={ATTRIBUTE_NAME:"BLOCK_UNBLOCK_DATE",VAR_NAME:"blockUnblockDate",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.MESSAGE_STATUS]={ATTRIBUTE_NAME:"MESSAGE_STATUS",VAR_NAME:"status",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.IS_ADD_TO_DB]={ATTRIBUTE_NAME:"IS_ADD_TO_DB",VAR_NAME:"isAddToDb",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.TAG_NAME_LENGTH]={ATTRIBUTE_NAME:"TAG_NAME_LENGTH",VAR_NAME:"tagNameLength",
VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.TAG_NAME]={ATTRIBUTE_NAME:"TAG_NAME",VAR_NAME:"tagName",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.TAG_PICTURE_URL_LENGTH]={ATTRIBUTE_NAME:"TAG_PICTURE_URL_LENGTH",VAR_NAME:"tagPictureUrlLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.TAG_PICTURE_URL]={ATTRIBUTE_NAME:"TAG_PICTURE_URL",VAR_NAME:"tagPictureUrl",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.TAG_MEMBER_TYPE]={ATTRIBUTE_NAME:"TAG_MEMBER_TYPE",VAR_NAME:"status",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.TAG_MEMBER_ADDED_BY]={ATTRIBUTE_NAME:"TAG_MEMBER_ADDED_BY",VAR_NAME:"addedBy",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersLength",VAR_CONTAINER_NAME:"tagMembers",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.TAG_NO_OF_BROKEN_PKT]={ATTRIBUTE_NAME:"TAG_NO_OF_BROKEN_PKT",VAR_NAME:"brokenPacketsLength",VAR_CONTAINER_NAME:"brokenPackets",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.TAG_INFORMATION_UPDATE_FLAG]={ATTRIBUTE_NAME:"TAG_INFORMATION_UPDATE_FLAG",VAR_NAME:"updateFlag",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.TAG_INFORMATION_TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_INFORMATION_TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersCount",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.REGISTRATION_TYPE]={ATTRIBUTE_NAME:"REGISTRATION_TYPE",VAR_NAME:"registrationType",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.PAGE_DIRECTION]={ATTRIBUTE_NAME:"PAGE_DIRECTION",VAR_NAME:"pageDirection",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.PAGE_LIMIT]={ATTRIBUTE_NAME:"PAGE_LIMIT",VAR_NAME:"pageLimit",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.ACTIVITY_TYPE]={ATTRIBUTE_NAME:"ACTIVITY_TYPE",VAR_NAME:"activityType",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1,CONDITIONAL:!0},r[t.ACTIVITY_VALUE_LENGTH]={ATTRIBUTE_NAME:"ACTIVITY_VALUE_LENGTH",VAR_NAME:"activityValueLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.ACTIVITY_VALUE]={ATTRIBUTE_NAME:"ACTIVITY_VALUE",VAR_NAME:"activityValue",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.CHANGED_BY_USER_ID]={ATTRIBUTE_NAME:"CHANGED_BY_USER_ID",VAR_NAME:"changedByUserId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.FRIEND_APP_TYPE]={ATTRIBUTE_NAME:"FRIEND_APP_TYPE",VAR_NAME:"friendAppType",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.FRIEND_DEVICE_TOKEN_LENGTH]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN_LENGTH",VAR_NAME:"friendDeviceTokenLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.FRIEND_DEVICE_TOKEN]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN",VAR_NAME:"friendDeviceToken",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.IS_SECRET_VISIBLE]={ATTRIBUTE_NAME:"IS_SECRET_VISIBLE",VAR_NAME:"isSecretVisible",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.APP_VERSION]={ATTRIBUTE_NAME:"APP_VERSION",VAR_NAME:"appVersion",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.FRIEND_PLATFORM]={ATTRIBUTE_NAME:"FRIEND_PLATFORM",VAR_NAME:"friendPlatform",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.IS_VOIP_CALL]={ATTRIBUTE_NAME:"IS_VOIP_CALL",VAR_NAME:"isVoidIpCall",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.NO_OF_IDS]={ATTRIBUTE_NAME:"NO_OF_IDS",VAR_NAME:"noOfIds",VAR_CONTAINER_NAME:"ids",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.MEMBER_URL_LENGTH]={ATTRIBUTE_NAME:"MEMBER_URL_LENGTH",VAR_NAME:"memberUrlLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.MEMBER_URL]={ATTRIBUTE_NAME:"MEMBER_URL",VAR_NAME:"memberUrl",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.PAGING_STATE_LENGTH]={ATTRIBUTE_NAME:"PAGING_STATE_LENGTH",VAR_NAME:"pagingStateLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.PAGING_STATE]={ATTRIBUTE_NAME:"PAGING_STATE",VAR_NAME:"pagingState",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.ADDTIME]={ATTRIBUTE_NAME:"ADDTIME",VAR_NAME:"addtime",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.START_INDEX]={ATTRIBUTE_NAME:"START_INDEX",VAR_NAME:"startIndex",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.SERVER_IP_LENGTH]={ATTRIBUTE_NAME:"SERVER_IP_LENGTH",VAR_NAME:"serverIpLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.SERVER_IP]={ATTRIBUTE_NAME:"SERVER_IP",VAR_NAME:"serverIp",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.SERVER_REGISTER_PORT]={ATTRIBUTE_NAME:"SERVER_REGISTER_PORT",VAR_NAME:"serverRegisterPort",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:4},r[t.MONTH]={ATTRIBUTE_NAME:"MONTH",VAR_NAME:"month",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.YEAR]={ATTRIBUTE_NAME:"YEAR",VAR_NAME:"year",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.RING_ID]={ATTRIBUTE_NAME:"RING_ID",VAR_NAME:"ringId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.RAW_DATA_BYTE]={ATTRIBUTE_NAME:"RAW_DATA_BYTE",VAR_NAME:"bytes",VAR_TYPE:i.ATTRIBUTE_TYPE.BYTE,SIZE:-2},r[t.CONVERSATION_TYPE]={ATTRIBUTE_NAME:"CONVERSATION_TYPE",VAR_NAME:"conversationType",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.FRIEND_GROUP_ID]={ATTRIBUTE_NAME:"FRIEND_GROUP_ID",VAR_NAME:"friendGroupId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.UNREAD_COUNT]={ATTRIBUTE_NAME:"UNREAD_COUNT",VAR_NAME:"unreadCount",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.ROOM_ID_LENGTH]={ATTRIBUTE_NAME:"ROOM_ID_LENGTH",VAR_NAME:"roomIdLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.ROOM_ID]={ATTRIBUTE_NAME:"ROOM_ID",VAR_NAME:"roomId",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.ROOM_NAME_LENGTH]={ATTRIBUTE_NAME:"ROOM_NAME_LENGTH",VAR_NAME:"roomNameLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.ROOM_NAME]={ATTRIBUTE_NAME:"ROOM_NAME",VAR_NAME:"roomName",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.ROOM_URL_LENGTH]={ATTRIBUTE_NAME:"ROOM_URL_LENGTH",VAR_NAME:"roomUrlLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.ROOM_URL]={ATTRIBUTE_NAME:"ROOM_URL",VAR_NAME:"roomUrl",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.SEARCH_NAME_LENGTH]={ATTRIBUTE_NAME:"SEARCH_NAME_LENGTH",VAR_NAME:"searchNameLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.SEARCH_NAME]={ATTRIBUTE_NAME:"SEARCH_NAME",VAR_NAME:"searchName",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.NO_OF_ROOM]={ATTRIBUTE_NAME:"NO_OF_ROOM",VAR_NAME:"noOfRoom",VAR_CONTAINER_NAME:"rooms",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.NO_OF_MEMBER]={ATTRIBUTE_NAME:"NO_OF_MEMBER",VAR_NAME:"noOfMember",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.SHADOW_ID]={ATTRIBUTE_NAME:"SHADOW_ID",VAR_NAME:"shadowId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.MESSENGER_OWNERID]={ATTRIBUTE_NAME:"MESSENGER_OWNERID",VAR_NAME:"messengerOwnerid",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.CATEGORY_LENGTH]={ATTRIBUTE_NAME:"CATEGORY_LENGTH",VAR_NAME:"categoryLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.CATEGORY]={ATTRIBUTE_NAME:"CATEGORY",VAR_NAME:"category",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.COUNTRY_LENGTH]={ATTRIBUTE_NAME:"COUNTRY_LENGTH",VAR_NAME:"countryLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.COUNTRY]={ATTRIBUTE_NAME:"COUNTRY",VAR_NAME:"country",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.LAST_CATEGORY_LENGTH]={ATTRIBUTE_NAME:"LAST_CATEGORY_LENGTH",VAR_NAME:"lastCategoryLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.LAST_CATEGORY]={ATTRIBUTE_NAME:"LAST_CATEGORY",VAR_NAME:"lastCategory",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.TOTAL_ITEMS]={ATTRIBUTE_NAME:"TOTAL_ITEMS",VAR_NAME:"totalItems",VAR_CONTAINER_NAME:"items",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.ORIGINAL_PACKETID_LENGTH]={ATTRIBUTE_NAME:"ORIGINAL_PACKETID_LENGTH",VAR_NAME:"originalPacketidLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.ORIGINAL_PACKETID]={ATTRIBUTE_NAME:"ORIGINAL_PACKETID",VAR_NAME:"originalPacketid",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.REPORT_MESSAGE_LENGTH]={ATTRIBUTE_NAME:"REPORT_MESSAGE_LENGTH",VAR_NAME:"reportMessageLength",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.REPORT_MESSAGE]={ATTRIBUTE_NAME:"REPORT_MESSAGE",VAR_NAME:"reportMessage",VAR_TYPE:i.ATTRIBUTE_TYPE.STRING,SIZE:-1},r[t.PUBLIC_CHAT_LAST_LIKER_ID]={ATTRIBUTE_NAME:"PUBLIC_CHAT_LAST_LIKER_ID",VAR_NAME:"publicChatLastLikerId",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},r[t.LIKE_COUNT]={ATTRIBUTE_NAME:"LIKE_COUNT",VAR_NAME:"likeCount",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:2},r[t.I_LIKE]={ATTRIBUTE_NAME:"I_LIKE",VAR_NAME:"iLike",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.I_REPORT]={ATTRIBUTE_NAME:"I_REPORT",VAR_NAME:"iReport",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:1},r[t.SEEN_TIME]={ATTRIBUTE_NAME:"SEEN_TIME",VAR_NAME:"seenTime",VAR_TYPE:i.ATTRIBUTE_TYPE.INTEGER,SIZE:8},e.CHAT_APP.PacketFormats.CHAT_PACKET_ATTRIBUTE=t,e.CHAT_APP.PacketFormats.CHAT_PACKET_ATTRIBUTE_INFO=r}(window),function(e){var t=e.CHAT_APP.Constants,n=t.FRIEND_CHAT_PACKET_TYPE,r=t.TAG_CHAT_PACKET_TYPE,i=t.OFFLINE_PACKET_TYPE,o={},a=e.CHAT_APP.PacketFormats.CHAT_PACKET_ATTRIBUTE;o[n.FRIEND_CHAT_REGISTER]={PACKET_NAME:"FRIEND_CHAT_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},o[n.FRIEND_CHAT_UNREGISTER]={PACKET_NAME:"FRIEND_CHAT_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM,a.ONLINE_STATUS,a.USER_MOOD]},o[n.FRIEND_CHAT_REGISTER_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.CHAT_BINDING_PORT,a.SERVER_DATE]},o[n.FRIEND_CHAT_IDLE]={PACKET_NAME:"FRIEND_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PLATFORM]},o[n.FRIEND_CHAT_TYPING]={PACKET_NAME:"FRIEND_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PLATFORM]},o[n.FRIEND_CHAT_MSG]={PACKET_NAME:"FRIEND_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},o[n.FRIEND_CHAT_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},o[n.FRIEND_CHAT_BROKEN_MSG]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},o[n.FRIEND_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},o[n.FRIEND_CHAT_MULTIPLE_MSG]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE]]},o[n.FRIEND_CHAT_DELIVERED]={PACKET_NAME:"FRIEND_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},o[n.FRIEND_CHAT_SENT]={PACKET_NAME:"FRIEND_CHAT_SENT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[n.FRIEND_CHAT_SEEN]={PACKET_NAME:"FRIEND_CHAT_SEEN",BROKEN_CONTAINER:"messages",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_DATE,a.MESSAGE_STATUS],a.PLATFORM]},o[n.FRIEND_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[n.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID],a.PLATFORM]},o[n.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[n.FRIEND_CHAT_BROKEN]={PACKET_NAME:"FRIEND_CHAT_BROKEN",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},o[n.FRIEND_CHAT_BROKEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BROKEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},o[n.FRIEND_CHAT_BLOCK]={PACKET_NAME:"FRIEND_CHAT_BLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.BLOCK_UNBLOCK_DATE,a.IS_ADD_TO_DB]},o[n.FRIEND_CHAT_UNBLOCK]={PACKET_NAME:"FRIEND_CHAT_UNBLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.BLOCK_UNBLOCK_DATE]},o[n.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_TAG_REGISTER]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},o[r.TAG_CHAT_TAG_UNREGISTER]={PACKET_NAME:"TAG_CHAT_TAG_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ONLINE_STATUS,a.USER_MOOD]},o[r.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.CHAT_BINDING_PORT,a.SERVER_DATE]},o[r.TAG_CHAT_TAG_INFORMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ACTIVITY_TYPE,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL]},o[r.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_TAG_MEMBER_ADD]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.RING_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE]]},o[r.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_MEMBER_REMOVE_LEAVE]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID]]},o[r.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.TAG_MEMBER_TYPE]]},o[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_IDLE]={PACKET_NAME:"TAG_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PLATFORM]},o[r.TAG_CHAT_TYPING]={PACKET_NAME:"TAG_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PLATFORM]},o[r.TAG_CHAT_MSG]={PACKET_NAME:"TAG_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},o[r.TAG_CHAT_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},o[r.TAG_CHAT_BROKEN_MSG]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},o[r.TAG_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},o[r.TAG_CHAT_MULTIPLE_MSG]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},o[r.TAG_CHAT_DELIVERED]={PACKET_NAME:"TAG_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_SENT]={PACKET_NAME:"TAG_CHAT_SENT",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_SEEN]={PACKET_NAME:"TAG_CHAT_SEEN",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},o[r.TAG_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},o[r.TAG_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[r.TAG_CHAT_GENERAL_BROKEN_PACKET]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},o[r.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},o[r.TAG_CHAT_GET_MESSAGE_SEEN_LIST_REQUEST]={PACKET_NAME:"TAG_CHAT_GET_MESSAGE_SEEN_LIST_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ORIGINAL_PACKETID_LENGTH,a.ORIGINAL_PACKETID]},o[r.TAG_CHAT_MESSAGE_SEEN_LIST]={PACKET_NAME:"TAG_CHAT_MESSAGE_SEEN_LIST",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ORIGINAL_PACKETID_LENGTH,a.ORIGINAL_PACKETID,a.NO_OF_MEMBERS,[a.USER_ID,a.SEEN_TIME]]},o[r.TAG_CHAT_MESSAGE_SEEN_LIST_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MESSAGE_SEEN_LIST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[i.OFFLINE_FRIEND_INFORMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.FRIEND_PLATFORM,a.ONLINE_STATUS,a.FRIEND_APP_TYPE,a.FRIEND_DEVICE_TOKEN_LENGTH,a.FRIEND_DEVICE_TOKEN,a.USER_MOOD,a.IS_VOIP_CALL,a.PLATFORM]},o[i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},o[i.OFFLINE_GET_REQUEST]={PACKET_NAME:"OFFLINE_GET_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.UPDATE_TIME,a.BLOCK_UNBLOCK_DATE,a.APP_VERSION,a.PLATFORM]},o[i.OFFLINE_GET_REQUEST_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_REQUEST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SERVER_DATE]},o[i.OFFLINE_FRIEND_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE]]},o[i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},o[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PAGE_DIRECTION,a.PAGE_LIMIT,a.PLATFORM]},o[i.OFFLINE_FRIEND_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.MESSAGE_STATUS],a.PAGE_DIRECTION]},o[i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID,a.PACKET_ID_LENGTH,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID],a.PLATFORM]},o[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},o[i.GET_UNREAD_COUNT]={PACKET_NAME:"GET_UNREAD_COUNT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},o[i.GET_CONVERSATION_REQUEST]={PACKET_NAME:"GET_CONVERSATION_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.START_INDEX,a.PAGE_LIMIT,a.CONVERSATION_TYPE,a.FRIEND_GROUP_ID,a.PLATFORM]},o[i.MESSAGE_CONVERSATION_LIST]={PACKET_NAME:"MESSAGE_CONVERSATION_LIST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.PACKET_TYPE,a.USER_ID,a.FRIEND_GROUP_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.UNREAD_COUNT]]},o[i.OFFLINE_TAG_INFORMATION_ACTIVITY]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_ACTIVITY",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.ACTIVITY_TYPE,a.USER_ID,a.ACTIVITY_VALUE_LENGTH,a.ACTIVITY_VALUE,a.TAG_MEMBER_TYPE,a.CHANGED_BY_USER_ID,a.UPDATE_TIME]]},o[i.OFFLINE_MY_TAG_LIST]={PACKET_NAME:"OFFLINE_MY_TAG_LIST",BROKEN_CONTAINER:"items",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.TAG_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_MEMBER_ADDED_BY,a.TAG_INFORMATION_TAG_NO_OF_MEMBERS]]},o[i.OFFLINE_TAG_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]]},o[i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},o[i.OFFLINE_TAG_CREATE_TAG]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.RING_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE],a.PLATFORM]},o[i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PAGE_DIRECTION,a.PAGE_LIMIT,a.APP_VERSION,a.PLATFORM]},o[i.OFFLINE_TAG_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE],a.PAGE_DIRECTION]},o[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},o[i.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.RING_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE,a.TAG_MEMBER_ADDED_BY]]},o[i.OFFLINE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},o[i.OFFLINE_BROKEN_HISTORY_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_HISTORY_PACKET",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},o[i.OFFLINE_BROKEN_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE,a.USER_ID,a.PLATFORM]},o[i.OFFLINE_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"OFFLINE_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},e.CHAT_APP.PacketFormats.FRIEND_TAG_CHAT_PACKET_INFO=o}(window),function(e){var t=e.CHAT_APP.Constants,n=t.PUBLIC_CHAT_ONLINE_PACKET_TYPE,r=t.PUBLIC_CHAT_OFFLINE_PACKET_TYPE,i={},o=e.CHAT_APP.PacketFormats.CHAT_PACKET_ATTRIBUTE;i[n.PUBLIC_CHAT_REGISTER]={PACKET_NAME:"PUBLIC_CHAT_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL,o.PLATFORM]},i[n.PUBLIC_CHAT_UNREGISTER]={PACKET_NAME:"PUBLIC_CHAT_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_REGISTER_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.CHAT_BINDING_PORT,o.SHADOW_ID]},i[n.PUBLIC_CHAT_CHAT_IDEL]={PACKET_NAME:"PUBLIC_CHAT_CHAT_IDEL",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PLATFORM]},i[n.PUBLIC_CHAT_CHAT_MESSAGE_TYPING]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PLATFORM,o.FULL_NAME_LENGTH,o.FULL_NAME]},i[n.PUBLIC_CHAT_CHAT_MESSAGE]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSAGE_TYPE,o.MESSAGE_LENGTH,o.MESSAGE,o.MESSAGE_DATE,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]},i[n.PUBLIC_CHAT_CHAT_MESSAGE_EDIT]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSAGE_TYPE,o.MESSAGE_LENGTH,o.MESSAGE,o.MESSAGE_DATE,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]},i[n.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE_BROKEN",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_PACKET,o.SEQUENCE_NO,o.MESSAGE_TYPE,o.MESSAGE_LENGTH,o.MESSAGE,o.MESSAGE_DATE,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]},i[n.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN_EDIT]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE_BROKEN_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_PACKET,o.SEQUENCE_NO,o.MESSAGE_TYPE,o.MESSAGE_LENGTH,o.MESSAGE,o.MESSAGE_DATE,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]},i[n.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_CHAT_MESSAGE_SENT]={PACKET_NAME:"PUBLIC_CHAT_CHAT_MESSAGE_SENT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_GET_MEMBER_LIST]={PACKET_NAME:"PUBLIC_CHAT_GET_MEMBER_LIST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.PAGING_STATE_LENGTH,o.PAGING_STATE,o.PAGE_LIMIT]},i[n.PUBLIC_CHAT_MEMBER_LIST_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_MEMBER_LIST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_MEMBER_LIST]={PACKET_NAME:"PUBLIC_CHAT_MEMBER_LIST",CONFIRMATION:!1,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.PAGING_STATE_LENGTH,o.PAGING_STATE,o.NO_OF_MEMBERS,[o.USER_ID,o.SHADOW_ID,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL,o.ADDTIME]]},i[n.PUBLIC_CHAT_MEMBER_COUNT_CHANGE]={PACKET_NAME:"PUBLIC_CHAT_MEMBER_COUNT_CHANGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_MEMBERS]},i[n.PUBLIC_CHAT_MEMBER_COUNT_CHANGE_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_MEMBER_COUNT_CHANGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_DELETE_MESSAGE]={PACKET_NAME:"PUBLIC_CHAT_DELETE_MESSAGE",CONFIRMATION:!1,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_PACKET,[o.PACKET_ID_LENGTH,o.PACKET_ID]]},i[n.PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[r.PUBLIC_CHAT_ROOM_LIST_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_ROOM_LIST_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.START_INDEX,o.PAGE_LIMIT,o.PLATFORM]},i[r.PUBLIC_CHAT_ROOM_LIST_SEARCH_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_ROOM_LIST_SEARCH_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.START_INDEX,o.PAGE_LIMIT,o.SEARCH_NAME_LENGTH,o.SEARCH_NAME,o.COUNTRY_LENGTH,o.COUNTRY,o.CATEGORY_LENGTH,o.CATEGORY,o.PLATFORM]
},i[r.PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[r.PUBLIC_CHAT_ROOM_LIST]={PACKET_NAME:"PUBLIC_CHAT_ROOM_LIST",CONFIRMATION:!1,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_ROOM,[o.ROOM_ID_LENGTH,o.ROOM_ID,o.ROOM_NAME_LENGTH,o.ROOM_NAME,o.ROOM_URL_LENGTH,o.ROOM_URL]]},i[r.PUBLIC_CHAT_GET_ROOM_IPPORT]={PACKET_NAME:"PUBLIC_CHAT_GET_ROOM_IPPORT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.PLATFORM]},i[r.PUBLIC_CHAT_ROOM_IPPORT_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_ROOM_IPPORT_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.SERVER_IP_LENGTH,o.SERVER_IP,o.SERVER_REGISTER_PORT,o.NO_OF_MEMBER]},i[r.PUBLIC_CHAT_ROOM_INFORMATION_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_ROOM_INFORMATION_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.PLATFORM]},i[r.PUBLIC_CHAT_ROOM_INFORMATION]={PACKET_NAME:"PUBLIC_CHAT_ROOM_INFORMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.ROOM_NAME_LENGTH,o.ROOM_NAME,o.ROOM_URL_LENGTH,o.ROOM_URL]},i[r.PUBLIC_CHAT_GET_HISTORY]={PACKET_NAME:"PUBLIC_CHAT_GET_HISTORY",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MONTH,o.YEAR,o.PAGE_DIRECTION,o.PAGE_LIMIT,o.PLATFORM,o.APP_VERSION]},i[r.PUBLIC_CHAT_GET_HISTORY_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_GET_HISTORY_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[r.PUBLIC_CHAT_HISTORY_MESSAGE_LIST]={PACKET_NAME:"PUBLIC_CHAT_HISTORY_MESSAGE_LIST",CONFIRMATION:!0,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_MESSAGE,[o.PACKET_TYPE,o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSAGE_TYPE,o.MESSAGE_LENGTH,o.MESSAGE,o.MESSAGE_DATE,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL,o.LIKE_COUNT,o.I_LIKE,o.I_REPORT]]},i[r.PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.START_INDEX,o.PAGE_LIMIT,o.PLATFORM]},i[r.PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY]={PACKET_NAME:"PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY",CONFIRMATION:!0,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_ROOM,[o.ROOM_ID_LENGTH,o.ROOM_ID,o.ROOM_NAME_LENGTH,o.ROOM_NAME,o.ROOM_URL_LENGTH,o.ROOM_URL,o.NO_OF_MEMBER,o.NO_OF_MESSAGE,[o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSAGE_TYPE,o.MESSAGE_LENGTH,o.MESSAGE,o.MESSAGE_DATE,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]]]},i[r.PUBLIC_CHAT_BROKEN_PACKET]={PACKET_NAME:"PUBLIC_CHAT_BROKEN_PACKET",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_PACKET,o.SEQUENCE_NO,o.RAW_DATA_BYTE]},i[r.PUBLIC_CHAT_BROKEN_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_BROKEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.SEQUENCE_NO]},i[r.PUBLIC_CHAT_SHADOW_IDS_INFO_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_SHADOW_IDS_INFO_REQUEST",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_IDS,[o.USER_ID],o.PLATFORM]},i[r.PUBLIC_CHAT_SHADOW_IDS_INFO_RESPONSE]={PACKET_NAME:"PUBLIC_CHAT_SHADOW_IDS_INFO_RESPONSE",CONFIRMATION:!1,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_IDS,[o.ROOM_ID_LENGTH,o.ROOM_ID,o.USER_ID,o.SHADOW_ID,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]]},i[n.PUBLIC_CHAT_DELETE_MESSAGE]={PACKET_NAME:"PUBLIC_CHAT_DELETE_MESSAGE",CONFIRMATION:!1,BROKEN:!0,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.NO_OF_PACKET,[o.PACKET_ID_LENGTH,o.PACKET_ID]]},i[n.PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_LIKE_A_MESSAGE]={PACKET_NAME:"PUBLIC_CHAT_LIKE_A_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSENGER_OWNERID,o.ORIGINAL_PACKETID_LENGTH,o.ORIGINAL_PACKETID]},i[n.PUBLIC_CHAT_UNLIKE_A_MESSAGE]={PACKET_NAME:"PUBLIC_CHAT_UNLIKE_A_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSENGER_OWNERID,o.ORIGINAL_PACKETID_LENGTH,o.ORIGINAL_PACKETID]},i[n.PUBLIC_CHAT_LIKE_UNLIKE_MESSAGE_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_LIKE_UNLIKE_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_REPORT_A_MESSAGE]={PACKET_NAME:"PUBLIC_CHAT_REPORT_A_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.MESSENGER_OWNERID,o.ORIGINAL_PACKETID_LENGTH,o.ORIGINAL_PACKETID,o.REPORT_MESSAGE_LENGTH,o.REPORT_MESSAGE]},i[n.PUBLIC_CHAT_REPORT_A_MESSAGE_CONFIRMATION]={PACKET_NAME:"PUBLIC_CHAT_REPORT_A_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID]},i[n.PUBLIC_CHAT_LIKE_MEMBER_LIST_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_LIKE_MEMBER_LIST_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.ORIGINAL_PACKETID_LENGTH,o.ORIGINAL_PACKETID,o.PUBLIC_CHAT_LAST_LIKER_ID,o.PAGE_LIMIT]},i[n.PUBLIC_CHAT_LIKE_MEMBER_LIST]={PACKET_NAME:"PUBLIC_CHAT_LIKE_MEMBER_LIST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.ROOM_ID_LENGTH,o.ROOM_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.TOTAL_ITEMS,[o.USER_ID,o.FULL_NAME_LENGTH,o.FULL_NAME,o.MEMBER_URL_LENGTH,o.MEMBER_URL]]},i[n.PUBLIC_CHAT_CATEGORY_LIST_REQUEST]={PACKET_NAME:"PUBLIC_CHAT_CATEGORY_LIST_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.USER_ID,o.PACKET_ID_LENGTH,o.PACKET_ID,o.LAST_CATEGORY_LENGTH,o.LAST_CATEGORY,o.PAGE_LIMIT,o.PLATFORM]},i[n.PUBLIC_CHAT_CATEGORY_LIST]={PACKET_NAME:"PUBLIC_CHAT_CATEGORY_LIST",CONFIRMATION:!1,BROKEN:!1,FORMAT:[o.PACKET_TYPE,o.PACKET_ID_LENGTH,o.PACKET_ID,o.TOTAL_ITEMS,[o.CATEGORY_LENGTH,o.CATEGORY]]},e.CHAT_APP.PacketFormats.PUBLIC_CHAT_PACKET_INFO=i}(window),function(e){var t=e.CHAT_APP.PacketFormats.FRIEND_TAG_CHAT_PACKET_INFO,n=e.CHAT_APP.PacketFormats.PUBLIC_CHAT_PACKET_INFO;e.CHAT_APP.PacketFormats.CHAT_PACKET_INFO=Object.assign({},t,n)}(window),function(e){"use strict";function t(){var t=e.CHAT_APP.Constants.PACKET_TYPES,n=e.CHAT_APP.Constants.PLATFORM.WEB,r=e.CHAT_APP.getAppVersion,i=e.CHAT_APP.getCurrentUserId,o=e.CHAT_APP.UTILS.getUUIDPacketId;this.getFriendChatRegisterObject=function(e,r){var a={packetType:t.FRIEND_CHAT_REGISTER,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatUnregisterObject=function(e,r,a,s){var c={packetType:t.FRIEND_CHAT_UNREGISTER,userId:i(),friendId:e,platform:n,onlineStatus:r,userMood:a,packetId:s||o()};return c},this.getFriendChatRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.FRIEND_CHAT_REGISTER_CONFIRMATION,friendId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getFriendChatIdleObject=function(e){var r={packetType:t.FRIEND_CHAT_IDLE,userId:i(),friendId:e,platform:n};return r},this.getFriendChatTypingObject=function(e){var r={packetType:t.FRIEND_CHAT_TYPING,userId:i(),friendId:e,platform:n};return r},this.getFriendChatMsgObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatMsgEditObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG_EDIT,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatBrokenMsgObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatBrokenMsgEditObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG_EDIT,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatMultipleMsgObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_MULTIPLE_MSG,userId:i(),friendId:e,messages:n,packetId:r||o()};return a},this.getFriendChatDeliveredObject=function(e,r){var a={packetType:t.FRIEND_CHAT_DELIVERED,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatSentObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SENT,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatSeenObject=function(e,r,a){var s={packetType:t.FRIEND_CHAT_SEEN,userId:i(),friendId:e,messages:r,platform:n,packetId:a||o()};return s},this.getFriendChatSeenConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SEEN_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatMultipleMsgDeleteObject=function(e,r,a){var s={packetType:t.FRIEND_CHAT_MULTIPLE_MSG_DELETE,userId:i(),friendId:e,packets:r,packetId:a||o(),platform:n};return s},this.getFriendChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatBrokenObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BROKEN,userId:i(),friendId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getFriendChatBrokenConfirmationObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_BROKEN_CONFIRMATION,userId:i(),friendId:e,sequenceNo:n,packetId:r||o()};return a},this.getFriendChatBlockObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BLOCK,userId:i(),friendId:e,blockUnblockDate:n,isAddToDb:r,packetId:a||o()};return s},this.getFriendChatUnblockObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_UNBLOCK,userId:i(),friendId:e,blockUnblockDate:n,packetId:r||o()};return a},this.getFriendChatBlockUnblockConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getTagChatTagRegisterObject=function(e,r){var a={packetType:t.TAG_CHAT_TAG_REGISTER,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getTagChatTagUnregisterObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_TAG_UNREGISTER,userId:i(),tagId:e,onlineStatus:n,userMood:r,packetId:a||o()};return s},this.getTagChatTagRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.TAG_CHAT_TAG_REGISTER_CONFIRMATION,tagId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getTagChatTagInformationObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_TAG_INFORMATION,userId:i(),tagId:e,activityType:n,tagName:r,tagPictureUrl:a,packetId:s||o()};return c},this.getTagChatTagInformationConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberAddObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_ADD,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberAddConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatMemberRemoveLeaveObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatMemberRemoveLeaveConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberTypeChangeObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberTypeChangeConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatIdleObject=function(e){var r={packetType:t.TAG_CHAT_IDLE,userId:i(),tagId:e,platform:n};return r},this.getTagChatTypingObject=function(e){var r={packetType:t.TAG_CHAT_TYPING,userId:i(),tagId:e,platform:n};return r},this.getTagChatMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatMsgEditObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG_EDIT,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatBrokenMsgObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatBrokenMsgEditObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG_EDIT,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatMultipleMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MULTIPLE_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatDeliveredObject=function(e,n,r){var a={packetType:t.TAG_CHAT_DELIVERED,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSentObject=function(e,n){var r={packetType:t.TAG_CHAT_SENT,tagId:e,packetId:n||o()};return r},this.getTagChatSeenObject=function(e,n,r){var a={packetType:t.TAG_CHAT_SEEN,userId:i(),tagId:e,packets:n,packetId:r||o()};return a},this.getTagChatSeenConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_SEEN_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatMultipleMsgDeleteObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MULTIPLE_MSG_DELETE,userId:i(),tagId:e,packets:n,packetId:r||o()};return a},this.getTagChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatGeneralBrokenPacketObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET,userId:i(),tagId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getTagChatGeneralBrokenPacketConfirmationObject=function(e,n,r){var a={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,userId:i(),tagId:e,sequenceNo:n,packetId:r||o()};return a},this.getTagChatGetMessageSeenListRequestObject=a;function a(e,n,r){var a={packetType:t.TAG_CHAT_GET_MESSAGE_SEEN_LIST_REQUEST,userId:i(),tagId:e,originalPacketid:n,packetId:r||o()};return a}this.getTagChatMessageSeenListObject=s;function s(e,n,r,i){var a={packetType:t.TAG_CHAT_MESSAGE_SEEN_LIST,tagId:e,originalPacketid:n,members:r,packetId:i||o()};return a}this.getTagChatMessageSeenListConfirmationObject=c;function c(e,n){var r={packetType:t.TAG_CHAT_MESSAGE_SEEN_LIST_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r}this.getOfflineFriendInformationObject=function(e,r,a,s,c,l,u,d,g){var E={packetType:t.OFFLINE_FRIEND_INFORMATION,userId:i(),friendId:e,fullName:r,onlineStatus:a,friendPlatform:s,friendAppType:c,friendDeviceToken:l,userMood:u,packetId:g||o(),isVoipCall:d,platform:n};return E},this.getOfflineFriendInformationConfirmationObject=function(e,r){var i={packetType:t.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,friendId:e,platform:n,packetId:r||o()};return i},this.getOfflineGetRequestObject=function(e,a,s){var c={packetType:t.OFFLINE_GET_REQUEST,userId:i(),updateTime:e,blockUnblockDate:a,appVersion:r(),platform:n,packetId:s||o()};return c},this.getOfflineGetRequestConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_GET_REQUEST_CONFIRMATION,serverDate:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineFriendHistoryMessageRequestObject=function(e,r,a,s){var c={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,userId:i(),friendId:e,pageDirection:r,pageLimit:a,platform:n,packetId:s||o()};return c},this.getOfflineFriendHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE,friendId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineFriendHistoryMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,friendId:e,packetId:n||o()};return r},this.getOfflineGetFriendMessageStatusObject=function(e,r,a){var s={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS,userId:i(),friendId:e,packets:r,platform:n,packetId:a||o()};return s},this.getOfflineGetFriendMessageStatusConfirmationObject=function(e,n,r){var i={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,friendId:e,packets:n,packetId:r||o()};return i},this.getUnreadCountObject=function(e,r,a,s,c){var l={packetType:t.GET_CONVERSATION_REQUEST,userId:i(),start:e,limit:r,conversationType:a,friendGroupId:s,packetId:c||o(),platform:n};return l},this.getConversationRequestObject=function(e,r,a,s,c){var l={packetType:t.GET_CONVERSATION_REQUEST,userId:i(),startIndex:e,pageLimit:r,conversationType:a,friendGroupId:s,packetId:c||o(),platform:n};return l},this.getMessageConversationListObject=function(){var e={packetType:t.MESSAGE_CONVERSATION_LIST};return e},this.getOfflineTagInformationActivityObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_INFORMATION_ACTIVITY,tagId:e,noOfItems:n,items:r,packetId:i||o()};return a},this.getOfflineMyTagListObject=function(e,n,r){var i={packetType:t.OFFLINE_MY_TAG_LIST,noOfItems:e,items:n,packetId:r||o()};return i},this.getOfflineTagUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineTagUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineTagCreateTagObject=function(e,r,a,s,c){var l={packetType:t.OFFLINE_TAG_CREATE_TAG,userId:i(),tagId:e,tagName:r,tagPictureUrl:a,tagMembers:s,platform:n,packetId:c||o()};return l},this.getOfflineTagCreateTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineTagHistoryMessageRequestObject=function(e,a,s,c){var l={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,userId:i(),tagId:e,pageDirection:a,pageLimit:s,appVersion:r(),platform:n,packetId:c||o()};return l},this.getOfflineTagHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE,tagId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineGetTagInformationWithMembersObject=function(e,r){var a={packetType:t.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getOfflineTagInformationWithMembersObject=function(e,n,r,i,a){var s={packetType:t.OFFLINE_TAG_INFORMATION_WITH_MEMBERS,tagId:e,tagName:n,tagPictureUrl:r,tagMembers:i,packetId:a||o()};return s},this.getOfflineTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineBrokenHistoryPacketObject=function(e,n,r){var i={packetType:t.OFFLINE_BROKEN_HISTORY_PACKET,sequenceNo:e,bytes:n,packetId:r||o()};return i},this.getOfflineBrokenPacketObject=function(e,r,a){var s={packetType:t.OFFLINE_BROKEN_PACKET,sequenceNo:e,bytes:r,userId:i(),platform:n,packetId:a||o()};return s},this.getOfflineBrokenPacketConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_BROKEN_PACKET_CONFIRMATION,userId:i(),sequenceNo:e,packetId:n||o()};return r}}e.CHAT_APP.ChatRequests=new t}(window),function(e){"use strict";function t(){var t=e.CHAT_APP.Constants.PACKET_TYPES,n=e.CHAT_APP.Constants.PLATFORM.WEB,r=e.CHAT_APP.getAppVersion,i=e.CHAT_APP.getCurrentUserId,o=e.CHAT_APP.UTILS.getUUIDPacketId;this.getPublicChatRegisterObject=function(e,r,a,s){var c={packetType:t.PUBLIC_CHAT_REGISTER,userId:i(),roomId:e,fullName:r,memberUrl:a,platform:n,packetId:s||o()};return c},this.getPublicChatUnregisterObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_UNREGISTER,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.PUBLIC_CHAT_REGISTER_CONFIRMATION,roomId:e,chatBindingPort:n,shadowId:r,packetId:i||o()};return a},this.getPublicChatChatIdelObject=function(e){var r={packetType:t.PUBLIC_CHAT_CHAT_IDEL,userId:i(),roomId:e,platform:n};return r},this.getPublicChatChatMessageTypingObject=function(e,r){var o={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE_TYPING,userId:i(),roomId:e,platform:n,fullName:r};return o},this.getPublicChatChatMessageObject=function(e,n,r,a,s,c,l){var u={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE,userId:i(),roomId:e,messageType:n,message:r,messageDate:a,fullName:s,memberUrl:c,packetId:l||o()};return u},this.getPublicChatChatMessageEditObject=function(e,n,r,a,s,c,l){var u={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE_EDIT,userId:i(),roomId:e,messageType:n,message:r,messageDate:a,fullName:s,memberUrl:c,packetId:l||o()};return u},this.getPublicChatChatMessageBrokenObject=function(e,n,r,a,s,c,l,u){var d={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN,userId:i(),roomId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,fullName:c,memberUrl:l,packetId:u||o()};return d},this.getPublicChatChatMessageBrokenEditObject=function(e,n,r,a,s,c,l,u){var d={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN_EDIT,userId:i(),roomId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,fullName:c,memberUrl:l,packetId:u||o()};return d},this.getPublicChatChatMessageDeliveredObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatChatMessageSentObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_CHAT_MESSAGE_SENT,roomId:e,packetId:n||o()};return r},this.getPublicChatGetMemberListObject=function(e,n,r,a){var s={packetType:t.PUBLIC_CHAT_GET_MEMBER_LIST,userId:i(),roomId:e,pagingState:n,pageLimit:r,packetId:a||o()};return s},this.getPublicChatMemberListConfirmationObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_MEMBER_LIST_CONFIRMATION,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatMemberListObject=function(e,n,r,i){var a={packetType:t.PUBLIC_CHAT_MEMBER_LIST,roomId:e,pagingState:n,members:r,packetId:i||o()};return a},this.getPublicChatMemberCountChangeObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_MEMBER_COUNT_CHANGE,roomId:e,packetId:n||o()};return r},this.getPublicChatMemberCountChangeConfirmationObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_MEMBER_COUNT_CHANGE_CONFIRMATION,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatRoomListRequestObject=function(e,r,a){var s={packetType:t.PUBLIC_CHAT_ROOM_LIST_REQUEST,userId:i(),startIndex:e,pageLimit:r,platform:n,packetId:a||o()};return s},this.getPublicChatRoomListSearchRequestObject=function(e,r,a,s,c,l){var u={packetType:t.PUBLIC_CHAT_ROOM_LIST_SEARCH_REQUEST,userId:i(),startIndex:e,pageLimit:r,searchName:a,country:s,category:c,platform:n,packetId:l||o()};return u},this.getPublicChatRoomListRequestConfirmationObject=function(e){var n={packetType:t.PUBLIC_CHAT_ROOM_LIST_REQUEST_CONFIRMATION,packetId:e||o()};return n},this.getPublicChatRoomListObject=function(e,n,r){var i={packetType:t.PUBLIC_CHAT_ROOM_LIST,noOfRoom:e,rooms:n,packetId:r||o()};return i},this.getPublicChatGetRoomIpportObject=function(e,r){var a={packetType:t.PUBLIC_CHAT_GET_ROOM_IPPORT,userId:i(),roomId:e,platform:n,packetId:r||o()};return a},this.getPublicChatRoomIpportConfirmationObject=function(e,n,r,i,a){var s={packetType:t.PUBLIC_CHAT_ROOM_IPPORT_CONFIRMATION,roomId:e,serverIp:n,serverRegisterPort:r,noOfMember:i,packetId:a||o()};return s},this.getPublicChatRoomInformationRequestObject=function(e,r){var a={packetType:t.PUBLIC_CHAT_ROOM_INFORMATION_REQUEST,userId:i(),roomId:e,platform:n,packetId:r||o()};return a},this.getPublicChatRoomInformationObject=function(e,n,r,i){var a={packetType:t.PUBLIC_CHAT_ROOM_INFORMATION,roomId:e,roomName:n,roomUrl:r,packetId:i||o()};return a},this.getPublicChatGetHistoryObject=function(e,a,s,c,l,u){var d={packetType:t.PUBLIC_CHAT_GET_HISTORY,userId:i(),roomId:e,month:a,year:s,pageDirection:c,pageLimit:l,platform:n,appVersion:r(),packetId:u||o()};return d},this.getPublicChatGetHistoryConfirmationObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_GET_HISTORY_CONFIRMATION,roomId:e,packetId:n||o()};return r},this.getPublicChatHistoryMessageListObject=function(e,n,r){var i={packetType:t.PUBLIC_CHAT_HISTORY_MESSAGE_LIST,roomId:e,messages:n,packetId:r||o()};return i},this.getPublicChatRoomListWithHistoryRequestObject=function(e,r,a){var s={packetType:t.PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY_REQUEST,userId:i(),startIndex:e,pageLimit:r,platform:n,packetId:a||o()};return s},this.getPublicChatRoomListWithHistoryObject=function(e,n,r){var i={packetType:t.PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY,noOfRoom:e,rooms:n,packetId:r||o()};return i},this.getPublicChatBrokenPacketObject=function(e,n,r,i){var a={packetType:t.PUBLIC_CHAT_BROKEN_PACKET,roomId:e,sequenceNo:n,bytes:r,packetId:i||o()};return a},this.getPublicChatBrokenConfirmationObject=function(e,n,r){var a={packetType:t.PUBLIC_CHAT_BROKEN_CONFIRMATION,userId:i(),roomId:e,sequenceNo:n,packetId:r||o()};return a},this.getPublicChatShadowIdsInfoRequestObject=function(e,r,a){var s={packetType:t.PUBLIC_CHAT_SHADOW_IDS_INFO_REQUEST,userId:i(),noOfIds:e,ids:r,platform:n,packetId:a||o()};return s},this.getPublicChatShadowIdsInfoResponseObject=function(e,n,r){var i={packetType:t.PUBLIC_CHAT_SHADOW_IDS_INFO_RESPONSE,noOfIds:e,ids:n,packetId:r||o()};return i},this.getPublicChatDeleteMessageObject=function(e,n,r){var a={packetType:t.PUBLIC_CHAT_DELETE_MESSAGE,userId:i(),roomId:e,packets:n,packetId:r||o()};return a},this.getPublicChatDeleteMessageConfirmationObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatLikeAMessageObject=function(e,n,r,a){var s={packetType:t.PUBLIC_CHAT_LIKE_A_MESSAGE,userId:i(),roomId:e,messengerOwnerid:n,originalPacketid:r,packetId:a||o()};return s},this.getPublicChatUnlikeAMessageObject=function(e,n,r,a){var s={packetType:t.PUBLIC_CHAT_UNLIKE_A_MESSAGE,userId:i(),roomId:e,messengerOwnerid:n,originalPacketid:r,packetId:a||o()};return s},this.getPublicChatLikeUnlikeMessageConfirmationObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_LIKE_UNLIKE_MESSAGE_CONFIRMATION,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatReportAMessageObject=a;function a(e,n,r,a,s){var c={packetType:t.PUBLIC_CHAT_REPORT_A_MESSAGE,userId:i(),roomId:e,messengerOwnerid:n,originalPacketid:r,reportMessage:a,packetId:s||o()};return c}this.getPublicChatReportAMessageConfirmationObject=function(e,n){var r={packetType:t.PUBLIC_CHAT_REPORT_A_MESSAGE_CONFIRMATION,userId:i(),roomId:e,packetId:n||o()};return r},this.getPublicChatLikeMemberListRequestObject=s;function s(e,n,r,a,s){var c={packetType:t.PUBLIC_CHAT_LIKE_MEMBER_LIST_REQUEST,userId:i(),roomId:e,originalPacketid:n,publicChatLastLikerId:r,pageLimit:a,packetId:s||o()};return c}this.getPublicChatLikeMemberListObject=function(e,n,r,i){var a={packetType:t.PUBLIC_CHAT_LIKE_MEMBER_LIST,roomId:e,totalItems:n,items:r,packetId:i||o()};return a},this.getPublicChatCategoryListRequestObject=function(e,r,a){var s={packetType:t.PUBLIC_CHAT_CATEGORY_LIST_REQUEST,userId:i(),lastCategory:e,pageLimit:r,platform:n,packetId:a||o()};return s},this.getPublicChatCategoryListObject=function(e,n,r){var i={packetType:t.PUBLIC_CHAT_CATEGORY_LIST,totalItems:e,items:n,packetId:r||o()};return i}}e.CHAT_APP.PublicChatRequests=new t}(window),function(e){"use strict";var t=e.CHAT_APP,n=t.Constants.AUTH_REQUEST_TYPE,r=t.getCurrentUserId;function i(){var e=t.Constants.AUTH_SERVER_ACTIONS;this.getTagChatRegisterIpPort=function(t,n,r){var i={actn:e.START_TAG_CHAT,tid:t,futIds:n};return r&&(i.pckId=r),i},this.getFriendChatRegisterIpPort=function(t,n){var i={actn:e.START_F2F_CHAT,futId:parseInt(t,10),uId:r()};return n&&(i.pckId=n),i},this.getTagChatMembersAddObject=function(t,n,r,i,o){var a={actn:e.ADD_TAG_CHAT_MEMBERS,tid:t,futIds:n,chIp:r,chRp:i};return o&&(a.pckId=o),a},this.getOfflineIpPort=function(t){var r={actn:e.GET_OFFLINE_IP_PORT,requestType:n.REQUEST};return t&&(r.pckId=t),r},this.getFriendPresenceObject=function(t){var n={actn:e.GET_USER_MOOD_PRESENCE,futId:t};return n}}e.CHAT_APP.AuthRequests=new i}(window),function(e){var t=0,n=1e3,r=o(),i=122192928e9;function o(){return Date.UTC(1582,9,15)}function a(e){var t=s(e),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}}function s(e){return e-r}function c(){return(new Date).getTime()}function l(e){for(var r,i,o=0;o++<n;){if(r=e,r>t){t=r,i=r;break}if(r<=t){t+=1,i=t;break}}return i}function u(e,t,n){var r,i,o=e;try{o=parseInt(o,10)}catch(s){return""}return r=n?t:l(t||c),i=a(r),i.hi=4096|i.hi,g(i.low,i.mid,i.hi,o)}function d(e,t,n){var r,i=n?n:"0",o=String(e);for(r=t-o.length;r>0;r>>>=1,i+=i)1&r&&(o=i+o);return o}function g(e,t,n,r){var i;return i=d(e.toString(16),8)+"-"+d(t.toString(16),4)+"-"+d(n.toString(16),4)+"-"+d((0).toString(16),4)+"-"+d(r.toString(16),12)}function E(e){var t,n,r=e.split("-"),o=[r[2].substring(1),r[1],r[0]].join("");return t=parseInt(o,16),t-=i,n=Math.floor(t/1e4)}function m(){}m.prototype.create=u,m.prototype.getTimestamp=E,window.PacketIDGenerator=e||new m}(window.PacketIDGenerator);var ChatApp,CHAT_LANG,TAG_CHAT_LANG={STATUS_MESSAGES:{SELF_ADD_MEMBER:"You added {new_member_name} as Group {new_member_type}.",SELF_ADD_MULTIPLE_MEMBER:"You added {new_member_name} and {rest_count} as Group {new_member_type}.",SELF_REMOVE_MEMBER:"You removed {old_member_name} from the group.",SELF_REMOVE_MULTIPLE_MEMBER:"You removed {old_member_name} and {rest_count} from the group.",OTHER_ADD_MEMBER:"{member_name} added {new_member_name} as Group {new_member_type}.",OTHER_ADD_MULTIPLE_MEMBER:"{member_name} added {new_member_name} and {rest_count} as Group {new_member_type}.",OTHER_REMOVE_MEMBER:"{member_name} removed {old_member_name} from the group.",OTHER_REMOVE_MULTIPLE_MEMBER:"{member_name} removed {old_member_name} and {rest_count} from the group.",SELF_LEAVE_GROUP:"You left this conversation.",OTHER_LEAVE_GROUP:"{member_name} left this conservation.",SELF_RENAME_GROUP:"You named the group {group_name}.",OTHER_RENAME_GROUP:"{member_name} named the group {group_name}.",SELF_CHANGE_GROUP_PIC:"You changed the group photo.",OTHER_CHANGE_GROUP_PIC:"{member_name} changed the group photo.",SELF_UPDATE_GROUP_INFO:"You named the group {group_name} and changed the group photo.",OTHER_UPDATE_GROUP_INFO:"{member_name} named the group {group_name} and changed the group photo.",SELF_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} Group Admin.",OTHER_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} as Admin.",SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} and {rest_count} as Group admin.",SELF_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} from Admin.",OTHER_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} from Group Admin.",
SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} and {rest_count} from Group Admin.",SELF_REMOVED_FROM_ADMIN_BY_SELF:"You removed yourself from Admin",OTHER_REMOVED_FROM_ADMIN_BY_SELF:"{admin_name} removed himself/herself from Admin",SELF_USER_ADDED_AS_OWNER:"{member_name} made you owner.",OTHER_USER_ADDED_AS_OWNER:"{member_name} made {admin_name} Owner. ",SELF_NOT_GROUP_MEMBER:"You are no longer member of this group"},DEFAULT_FAILURE_MESSAGE:"Request has not been processed successfully. Please try again",DEFAULT_SUCCESS_MESSAGE:"Request has been processed successfully."};CHAT_LANG={MESSAGE_DELETE_TEXT:"This message has been deleted"},ChatApp=angular.module("ringid.chat"),ChatApp.constant("CHAT_LANG",{TAG:TAG_CHAT_LANG,CHAT:CHAT_LANG}),ChatApp=angular.module("ringid.chat"),ChatApp.constant("CHAT_LANG",{TAG:TAG_CHAT_LANG,CHAT:CHAT_LANG});var app=angular.module("ringid.chat");ChatMessageMap.$inject=["$$stackedMap","$interval","$websocket","$rootScope","$sce","Auth","ChatConnector","userFactory","Utils","tagChatFactory","chatHistoryFactory","settings","tagChatHelper","tagChatStorage","ChatUtilsFactory","rgScrollbarService","chatTabSync","$$mediaMap"],app.factory("ChatMessageMap",ChatMessageMap);function ChatMessageMap(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p){var _=CHAT_APP.Constants,I=CHAT_APP.PublicChatRequests,h=_.PACKET_TYPES,A=_.GENERAL_CONSTANTS;function C(e,t){var n,r,l;e.userId=t,r=S(e),l=s.create({utId:t,fetchDatails:!1}),e.memberUrl&&0===l.getProfileImageId()&&(l.setProfileImage(e.memberUrl),l.setName(e.fullName)),n={locationInfo:{},ogData:{},seenUserIds:{},deliveredUserIds:{},likeUserIds:{},user:l,parsedMessageText:"",sortBy:d,like:P,doReport:b,getLastLikerId:y,isOwner:u,getTextPartition:E,setTextPartition:T,getMessageTime:f,seenUsersCount:_,getSeenUserIds:h,deliveredUsersCount:C,addSeenUserId:M,addDeliveredUserId:D,addLikeUserId:O,removeLikeUserId:R,updateLocationInfo:w,updateLinkShareInfo:G,updateMediaInfo:B,updateRingMediaInfo:$,getSafeMapJsUrl:H,refreshStatusMessageText:x,getSenderImageUrl:N,getSenderName:F,getShortMessageText:k,getWhoLikes:U,getTotalLikes:L},e.usersToChange&&(n.usersToChange=e.usersToChange),e.statusType&&(n.statusType=e.statusType),angular.extend(n,r),v(n),n.parsedMessageText=i.trustAsHtml(n.parsedMessageText);function u(){return String(n.user.getKey())===String(o.currentUser().getKey())}function d(){return e.messageDate}function E(){return n.parsedMessageText}function T(){n.parsedMessageText=m.parseForLE(n.text),n.parsedMessageText=i.trustAsHtml(n.parsedMessageText)}function f(){return e.hrtime}function _(){return Object.keys(n.seenUserIds).length}function h(){return Object.keys(n.seenUserIds)}function C(){return Object.keys(n.deliveredUserIds).length}function M(e,t){n.seenUserIds[e]=t||Date.now()}function D(e){n.deliveredUserIds[e]=!0}function O(e){n.likeUserIds[parseInt(e,10)]=!0,n.likeCount=Object.keys(n.likeUserIds).length}function R(e){delete n.likeUserIds[parseInt(e,10)],n.likeCount=Object.keys(n.likeUserIds).length}function N(){return n.user.avatar("thumb")}function P(e,t){return e?(n.iLike=1^n.iLike,t?n.likeCount=t:n.likeCount=n.iLike?n.likeCount+1:n.likeCount-1,n.iLike):n.iLike}function y(){var e=Object.keys(n.likeUserIds);return e&&0!==e.length?Math.max.apply(null,e):0}function b(e){var t=I.getPublicChatReportAMessageObject(n.boxId,n.userId,n.key,e);return a.request(t)}function U(){return Object.keys(n.likeUserIds)}function L(){return n.likeCount}function F(){return n.user.hasDetails()?n.user.getName():n.fullName}function k(){var e;return e=n.statusType?"Activity message.":n.messageType===A.MESSAGE_TYPES.TEXT?n.text:"Media message."}function w(){var e,t,r;try{e=angular.fromJson(n.text),t=e.la,r=e.lo,n.locationInfo={lat:t,"long":r,description:e.loc},n.plainText=e.loc}catch(i){}}function G(){var e;n.ogData={};try{e=angular.fromJson(n.text),n.ogData={lnkDmn:e.u,description:e.d,title:e.t,url:e.u,image:e.i,message:e.m},n.plainText=e.m}catch(t){}}function B(){var e,t,r;try{e=angular.fromJson(n.text),n.mediaInfo={url:e.u,caption:e.c,width:e.w,height:e.h},n.mediaInfo.width?(t=c.getScaledImageSize(n.mediaInfo.width,n.mediaInfo.height,c.viewport.x,c.viewport.y),r=c.getScaledImageSize(n.mediaInfo.width,n.mediaInfo.height,150,300),n.mediaInfo.width=t.width,n.mediaInfo.height=t.height,n.mediaInfo.thumbWidth=r.width,n.mediaInfo.thumbHeight=r.height):(n.mediaInfo.width="400",n.mediaInfo.height="auto",n.mediaInfo.thumbWidth="150",n.mediaInfo.thumbHeight="auto"),n.plainText=e.c}catch(i){}}function $(){var e;try{e=angular.fromJson(n.text),n.ringMediaObject=p(e)}catch(t){}}function H(){return i.trustAsResourceUrl(n.mapJsEmbededUrl)}function x(){n.parsedMessageText=g.getTagChatStatusMessage(e),n.parsedMessageText=i.trustAsHtml(n.parsedMessageText)}return n}function S(e){var t,n=e.key||e.packetId,r=e.messageDate||(new Date).getTime();return t={boxId:e.boxId,key:n.toString(),packetId:n.toString(),text:e.message||e.mg||e.text,hrtime:m.getChatVerbalDateFromServerDate(r),status:e.status||0,fullName:e.fullName,tagName:e.tagName||"",messageDate:r,isDeleted:!1,uploading:!1,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat||!1,public_chat:e.public_chat||!1,seenSent:e.seenSent||!1,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,lastUpdateTime:(new Date).getTime(),userId:e.userId,platform:5,likeCount:e.likeCount||0,iLike:e.iLike||!1,iReport:e.iReport||!1,scroll:e.scroll},e.tag_chat?(t.packetType=e.packetType||h.TAG_CHAT_MSG,t.brokenPacketType=e.brokenPacketType):e.public_chat?(t.packetType=e.packetType||h.PUBLIC_CHAT_CHAT_MESSAGE,t.brokenPacketType=e.brokenPacketType):(t.packetType=e.packetType||h.FRIEND_CHAT_MSG,t.brokenPacketType=e.brokenPacketType),t.statusText=e.status||"Pending",t}function v(e){var t,n;if("status_update"!==e.status)if(e.secretTimedOut!==!0&&"Deleted"===e.status)e.messageType=2,e.parsedMessageText=m.parseForLE(e.text);else switch(e.messageType){case A.MESSAGE_TYPES.DELETE_MESSAGE:e.text="This msg has been deleted",e.setTextPartition();break;case A.MESSAGE_TYPES.TEXT:case A.MESSAGE_TYPES.EMOTICON_MESSAGE:e.parsedMessageText=m.parseForLE(e.text);break;case A.MESSAGE_TYPES.LOCATION_SHARE:e.updateLocationInfo(),t=e.locationInfo.lat,n=e.locationInfo["long"],0!==t&&0!==n?(e.mapStaticUrl=c.getGoogleMapStaticUrl(t,n),e.mapJsUrl=c.getGoogleMapJSUrl(t,n),e.mapJsEmbededUrl=c.getGoogleMapJSUrl(t,n,"",!0)):e.parsedMessageText=m.parseForLE(e.text);break;case A.MESSAGE_TYPES.LINK_SHARE:e.updateLinkShareInfo();break;case A.MESSAGE_TYPES.STICKER:e.stickerUrl=d.stickerBase+e.text;break;case A.MESSAGE_TYPES.IMAGE:case A.MESSAGE_TYPES.CAMERA_IMAGE:e.updateMediaInfo();try{e.mediaUrl=d.imBase+e.mediaInfo.url}catch(r){e.mediaUrl=""}e.parsedMessageText="";break;case A.MESSAGE_TYPES.AUDIO:e.updateMediaInfo(),e.isVideo=!1;try{e.mediaUrl=d.mediaBase+e.mediaInfo.url}catch(r){e.mediaUrl=""}break;case A.MESSAGE_TYPES.VIDEO:e.updateMediaInfo(),e.isVideo=!0;try{e.mediaUrl=d.mediaBase+e.mediaInfo.url}catch(r){e.mediaUrl=""}break;case A.MESSAGE_TYPES.RING_MEDIA_MESSAGE:e.updateRingMediaInfo();try{e.plainText=e.ringMediaObject.getCaption(),e.thumbURL=e.ringMediaObject.getThumbForMedia(),e.albumName=e.ringMediaObject.getAlbumName(),e.artistName=e.ringMediaObject.getArtistName(),e.durationText=e.ringMediaObject.getDuration(!0)}catch(r){e.thumbURL=""}break;default:return}else if(e.parsedMessageText=g.getTagChatStatusMessage(e),!e.parsedMessageText)return}return{create:C,getBasicMessageObject:S,processMessage:v}}var app=angular.module("ringid.chat");ChatConversationModel.$inject=[],app.factory("ChatConversationModel",ChatConversationModel);function ChatConversationModel(){function e(e){var t;t={packetType:e.packetType,conversationId:e.friendGroupId.toString(),lastMessaeUserId:e.userId,lastMessageType:e.messageType,lastMessage:e.message,lastMessaeDate:e.messageDate,unreadCount:e.unreadCount,sortBy:n};function n(){return t.lastMessaeDate}return t}return{create:e}}var app=angular.module("ringid.chat");ChatMap.$inject=["$$stackedMap","$interval","$websocket","$rootScope","$sce","Auth","ChatConnector","userFactory","Utils","tagChatFactory","ChatRoomFactory","chatHistoryFactory","settings","tagChatHelper","tagChatStorage","ChatMessageMap","ChatUtilsFactory","rgScrollbarService","chatTabSync","$$mediaMap","SystemEvents"],app.factory("ChatMap",ChatMap);function ChatMap(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I,h){var A=CHAT_APP.Constants,C=A.GENERAL_CONSTANTS,S=CHAT_APP.SharedHelpers;return{create:function(n,a,E){var m,p,I=!1,A=!1,v={},M="",D=n,O=e.createNew(!0,"asc");if(!D)return{};D=String(D),m={messages:O.all(),isTagChat:a,isPublicChat:E,boxTitle:"",unreadCount:0,messageMaxPacketId:"",messageMinPacketId:"",messageMaxDate:0,messageMinDate:0,latestSeenMessageDate:0,hasHistoryMessage:!1,getBackgroundImage:y,getBackgroundImageType:b,getTitleString:U,updateUnreadCount:L,getProfileLink:F,checkWaitingTimePassed:k,pushMessage:R,pushDummyMessage:N,sendTabUpdate:w,startTimer:K,updateBoxMessageMinMaxPacketId:P,loadHistoryMessages:x,loadSingleHistoryMessage:H,isConsicutive:j,getTypingText:Y,getKey:V,getTagItem:W,getRoomItem:q,getUser:z,getTitle:Q,setTitle:X,isSamePacketId:Z,getMessages:J,getMessage:ee,getBottomMessage:te,getTopMessage:ne,removeMessage:re,updateMessageStatus:ie,isBlocked:oe,isTyping:ae,setTypingBool:se,isFriendTyping:ce,showTypingText:le,hideTypingText:ue,setFriendTypingBool:de},p=a?l.getTag(D):E?u.get(D):s.create({futId:D});function R(e,t,n){var r,i;if("object"!=typeof t){if(e.type&&101===e.type)return void(I=!0);if(0===e.type&&0===e.status)return r=O.get(O.packetId),void(r.isDeleted=!0);e.boxId=D,i=T.create(e,String(t)),e.userId=String(t),e.userId!==i.userId&&i.userId!==i.user.getUId()||(O.save(i.key,i),e.fromLocalHistory||P(i),E||d.addMessage(i,D),c.triggerCustomEvent(h.CHAT.MESSAGE_PUSHED,{boxId:D,fromLocalHistory:e.fromLocalHistory||!1,fromHistory:e.fromHistory||!1,msg_status:i.statusText.toLowerCase(),isEdit:e.isEdit,blink:o.currentUser().getKey().toString()!==e.userId.toString(),noScroll:"Pending"===i.statusText}),n&&w(i))}}function N(e,t){var n=e.key||e.packetId,r=S.getChatServerCurrentTime(),a=[],l={key:n,text:e.message||e.mg||e.text,hrtime:f.getChatVerbalDateFromServerDate(r),status:e.status||0,messageType:e.messageType,uploading:e.uploading,uploadProgress:e.uploadProgress,messageDate:r,isDeleted:!1,messageDateString:e.messageDateString||"",mediaUrl:e.mediaUrl,mediaInfo:{thumbWidth:150,thumbHeight:80},timeout:e.timeout,isSecretVisible:e.isSecretVisible,user:angular.isObject(t)?t:s.getUser(e.userId),userId:angular.isObject(t)?t.getKey():e.userId,lastUpdateTime:(new Date).getTime(),sortBy:function(){return e.messageDate},getTextPartition:function(){return a},setTextPartition:function(){a=f.parseForLE(l.text),a=i.trustAsHtml(a)}};a=f.parseForLE(l.text),a=i.trustAsHtml(a),O.save(l.key,l),c.triggerCustomEvent(h.CHAT.MESSAGE_PUSHED,{boxId:D,fromLocalHistory:!1,fromHistory:!1,msg_status:l.status,blink:o.currentUser().getKey().toString()!==l.userId.toString()})}function P(e){var t=m,n=e.key||e.packetId;if("status_update"===e.status)try{n=n.split("_")[0]}catch(r){}t.messageMaxDate<e.messageDate&&(t.messageMaxDate=e.messageDate,t.messageMaxPacketId=n),(!t.messageMinDate||t.messageMinDate>=e.messageDate)&&(t.messageMinDate=e.messageDate,t.messageMinPacketId=n)}function y(){var e,t=m,n=b();return e="color"===n?t.backgroundImage:"image"===n?"url("+g.chatBackgroundBase+"bg_0"+t.backgroundImage+".jpg)":"#dadada1"}function b(){var e=m;return e.backgroundImage&&""!==e.backgroundImage?e.backgroundImage&&"#"===e.backgroundImage[0]?"color":"image":"no-image"}function U(){var e=m,t=e.getTitle();return e.isTagChat||t||(t=e.getKey()),!e.isPublicChat&&e.unreadCount>0&&(t=t+" ("+e.unreadCount+")"),t}function L(){var e=m;e.unreadCount=d.getUnreadMessageCountByBoxId(D)}function F(){var e,t=m;return e=t.isTagChat?t.getTagItem().link():t.isPublicChat?t.getRoomItem().link():"/profile/"+z().getUId()}function k(){var e,t=Math.floor(Date.now()/1e3);return e=t-this.lastCommunicationTime>this.waitingTime}function w(e){_.sendData(C.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:D,messageId:e.key})}function G(e,t){r.$broadcast("timeoutDelete",e.key,t)}function B(e){var n=e.timeout;e.timerStartFlag=!0,B(e),t(function(){G(e,n--)},1e3,n+1)}function $(e,t){var n;return P(t),t.fromLocalHistory=!0,0===t.status&&S.getChatServerCurrentTime()-t.messageDate>12e4&&(t.status="Failed",n=!0),"Seen"===t.stauts&&t.messageDate>e.latestSeenMessageDate&&(e.latestSeenMessageDate=t.messageDate),e.pushMessage(t,t.user||t.userId),n}function H(e){var t=m,n=d.getMessage(D,e);n&&$(t,n)}function x(){var e,t,n,r=m,i=!1;if(e=d.getMessages(D))for(t=0;t<e.length;t++)n=e[t],i=$(r,n);i&&d.updateMessages(e,D)}function Y(){var e,t,n,r,i,o=m.getKey();return M="is typing",a||E?(e=a?l.getTag(o):u.get(o),t=Object.keys(v),r=" is typing",v.length>3&&(t=v.slice(0,3),r=" and "+(v.length-3)+" others are typing"),n=[],t.forEach(function(t){i=e.getMember(t),i&&n.push(i.getName())}),M=n.length>0?n.join(",")+r:""):M=m.getUser().getName()+" "+M,M}function K(){var e,t=m,n=t.getMessages();if(angular.isArray(n)&&n.length>0)for(e=0;e<O.length;e++)if(O[e].value.timeout>0&&t.isMinimized===!1&&t.isHidden===!1&&!O[e].value.timerStartFlag)switch(O[e].value.messageType){case 2:case 3:case 4:case 5:case 6:B(O[e].value)}}function j(e){var t=O.get(e),n=O.previous(e);return!(!n||"status_update"===n.status||n.user.getKey()!==t.user.getKey())}function V(){return D.toString()}function W(){return p||(p=l.getTag(m.getKey())),p}function q(){return p||(p=u.get(D)),p}function z(){return p}function Q(){return a?this.boxTitle=W().getTagName():E?this.boxTitle=q().getName():this.boxTitle=z().getName(),this.boxTitle}function X(e){this.boxTitle=e}function Z(e){return!!O.get(e.toString())}function J(){return O.all()}function ee(e){return O.get(e.toString())}function te(){return O.bottom()}function ne(){return O.top()}function re(e){O.remove(e.toString())}function ie(e,t){var n=O.get(e);return!!n&&(n.status=t,n)}function oe(){var e=m;return!e.isTagChat&&!e.isPublicChat&&e.blocked}function ae(){return I}function se(e){I=e}function ce(){return A}function le(e){v[e]=!0,I=A=!0}function ue(e){delete v[e],I=A=!1}function de(e){A=e}return m}}}var app=angular.module("ringid.chat");app.factory("ChatRoomModel",ChatRoomModel),ChatRoomModel.$inject=["$$stackedMap","settings"];function ChatRoomModel(e,t){function n(e,t,n,i){var o=new r;return o.update(e,t,n,i),o}function r(){this.room={id:0,name:"",url:"",noOfMembers:0,members:e.createNew(!0,"asc"),messages:e.createNew(!0,"asc")}}return r.prototype={update:function(e,n,r,i){this.setId(e),this.setName(n),this.setUrl(t.imBase+r),this.setNoOfMembers(i)},getId:function(){return this.room.id},setId:function(e){this.room.id=e},sortBy:function(){return this.room.name},getName:function(){return this.room.name},setName:function(e){this.room.name=e},getUrl:function(){return this.room.url},setUrl:function(e){this.room.url=e},setNoOfMembers:function(e){this.room.noOfMembers=e},getNoOfMember:function(){return this.room.noOfMembers},addMessage:function(e){this.room.messages.save(e.key,e)},removeMessage:function(e){this.room.messages.remove(e)},getMessage:function(e){return this.room.messages.get(e)},getMessages:function(){return this.room.messages},addMember:function(e){this.room.members.save(e.getUId(),e)},removeMember:function(e){this.room.members.remove(e)},getMember:function(e){return this.room.members.get(e)},getMembers:function(){return this.room.members}},{create:n}}var app=angular.module("ringid.chat");app.factory("ChatRoomCategoryModel",ChatRoomCategoryModel);function ChatRoomCategoryModel(){function e(e){var t=new ChatRoomCategoryModel;return t.update(e),t}function t(){this.room={name:""}}return t.prototype={update:function(e){this.setName(e)},sortBy:function(){return this.room.name},getName:function(){return this.room.name},setName:function(e){this.room.name=e}},{create:e}}var tagChatApp=angular.module("ringid.chat");tagChatApp.factory("tagChatModels",tagChatModels),tagChatModels.$inject=["$$stackedMap","userFactory","userService","Utils","Auth","settings","SystemEvents","routeService"];function tagChatModels(e,t,n,r,i,o,a,s){var c=CHAT_APP.Constants.GENERAL_CONSTANTS;function l(){var t=this,n={id:0,name:"Group",pictureUrl:"",userId:0,packetId:0,memberCount:0,serverDate:0,serverDateDiff:0,members:e.createNew(),messages:e.createNew(),objectLock:!1,ownerUserId:0,creationTime:0};this.getTagId=function(){return n.id},this.setTagId=function(e){n.id=String(e),n.creationTime=e.toString().substr(0,c.TAG_ID_NO_OF_TIME_DIGIT)},this.getTagCreationTime=function(){return n.creationTime},this.getUserId=function(){return n.userId},this.setUserId=function(e){n.userId=e},this.getPacketId=function(){return n.packetId},this.setPacketId=function(e){n.packetId=e},this.renewPacketId=function(){t.setPacketId(r.getUniqueID("tgrc"))},this.getTagName=function(){return n.name},this.setTagName=function(e){n.name=e},this.setPictureUrl=function(e){n.pictureUrl=e},this.getPictureUrl=function(){return n.pictureUrl.trim()},this.getPictureFullUrl=function(){var e;return e=""!==String(this.getPictureUrl())?o.imBase+this.getPictureUrl():"images/default_cover.jpg"},this.setServerDate=function(e){n.serverDate=e,t.setServerDateDiff(e-parseInt((new Date).getTime(),10))},this.getServerDate=function(){return n.serverDate},this.setServerDateDiff=function(e){n.serverDateDiff=e},this.getServerDateDiff=function(){return n.serverDateDiff},this.getMembersCount=function(){return n.memberCount},this.setMembersCount=function(e){n.memberCount=e},this.isTagSafeToShow=function(){return n.memberCount>0&&this.isUserMember(i.currentUser().getKey())},this.initMembers=function(){n.members=e.createNew()},this.addMember=function(e){n.members||(n.members=t.initMembers()),e.isOwner()&&(n.ownerUserId=e.getId()),n.members.save(e.getId(),e)},this.updateMember=function(e){this.addMember(e)},this.removeMember=function(e){e instanceof u?n.members.remove(e.getId()):n.members.remove(e)},this.membersLength=function(){return n.members?n.members.length():0},this.getMember=function(e){return n.members.get(e)},this.getMemberObjects=function(){return n.members.values()},this.getMemberUserIds=function(){var e=[];return n.member.all().forEach(function(t){e.push(t.getUserId())}),e},this.getMemberUtIds=function(){return n.members.keys()},this.getMembersObjectMap=function(){return n.members},this.setMembersObjectMap=function(e){n.members=e},this.initMemberObjects=function(){var e,t,r=n.members.all();for(e=0;e<n.members.length();e++)t=r[e].value,t.initUserObjects()},this.unregisterMemberObjectsListener=function(){var e,t,r=n.members.all();for(e=0;e<n.members.length();e++)t=r[e].value,t.unregisterUserObjectsListener()},this.getSerializedMembers=function(){var e,t,r=n.members.all(),i=[];for(e=0;e<r.length;e++)t=r[e].value,i.push(t.serialize());return i},this.isUserMember=function(e){var t,r;return n.members?(r=n.members.get(e),t=!!r&&!r.isLeaved()):t=!1,t},this.isCurrentUserStatusAdmin=function(e){var t=!!n.members&&n.members.get(e);return!!t&&t.isAdmin()},this.isCurrentUserStatusMember=function(e){var t=!!n.members&&n.members.get(e);return!!t&&t.isMember()},this.setObjectLock=function(){n.objectLock=!0},this.removeObjectLock=function(){n.objectLock=!1},this.hasObjectLock=function(){return n.objectLock},this.setOwnerUserId=function(e){n.ownerUserId=e},this.getOwnerUserId=function(){return n.ownerUserId},this.initMessages=function(){n.messages=e.createNew()},this.addMessage=function(e){n.messages||(n.messages=t.initMessages()),n.messages.save(e.getPacketId(),e)},this.removeMessage=function(e){e instanceof d?n.messages.remove(e.getId()):n.messages.remove(e)},this.messagesLength=function(){return n.messages?n.messages.length():0},this.getMessage=function(e){return n.messages.get(e)},this.getMessageObjects=function(){return n.messages.values()},this.getMessageUserIds=function(){return n.messages.keys()},this.getMessagesObjectMap=function(){return n.messages},this.setMessagesObjectMap=function(e){n.messages=e},this.debug=function(){return n},this.link=function(){return s.getRoute("CHAT_GROUP",{tagId:this.getTagId()})}}l.prototype.copy=function(){var e=new l;return e.setTagId(this.getTagId()),e.setTagName(this.getTagName()),e.setPictureUrl(this.getPictureUrl()),e.setUserId(this.getUserId()),e.setPacketId(this.getPacketId()),e.setChatBindingPort(this.getChatBindingPort()),e.setChatIp(this.getChatIp()),e.setChatRegisterPort(this.getChatRegisterPort()),e.setServerDate(this.getServerDate()),e.setMembersObjectMap(this.getMembersObjectMap().copy()),e},l.prototype.update=function(e){e.getTagName()&&this.setTagName(e.getTagName()),e.getPictureUrl()&&this.setPictureUrl(e.getPictureUrl()),e.getUserId()&&this.setUserId(e.getUserId()),e.getPacketId()&&this.setPacketId(e.getPacketId()),e.getServerDate()&&this.setServerDate(e.getServerDate())},l.prototype.sortBy=function(){return this.getTagCreationTime()};function u(){var e=this,s={tagId:0,utId:0,userId:0,fullName:"",status:0,statusValue:"",addedBy:0,user:{},addedByUser:{},userRegisterKey:null,addedByUserRegisterKey:null};this.initWithUserMapObject=function(t){e.setId(t.getUtId()),e.setFullName(t.getName()),e.setUserObj(t)},this.setTagId=function(e){s.tagId=e},this.getTagId=function(){return s.tagId},this.setId=function(e){s.utId=e},this.getId=function(){return s.utId},this.getRingId=function(){return s.userId.toString().replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")},this.setUserId=function(e){s.userId=e},this.getUserId=function(){return s.userId},this.getKey=function(){return s.utId},this.getUser=function(){return t.getUser(s.utId)},this.setFullName=function(e){s.fullName=e},this.getFullName=function(){return s.fullName},this.getPictureUrl=function(){var t;return t=e.getUser().getUserAvatar?o.imBase+e.getUser().getUserAvatar():"images/prof.png"},this.getName=function(){var t;return t=""!==s.fullName?s.fullName:e.getUser()?e.getUser().getName():s.userId},this.getStatus=function(){return s.status},this.getStatusValue=function(){var e;return e=s.status===c.MEMBER_STATUS.ADMIN?"admin":s.status===c.MEMBER_STATUS.MEMBER?"member":"owner"},this.setStatus=function(e){s.status=e},this.setAddedBy=function(e){s.addedBy=e},this.getAddedBy=function(){return s.addedBy},this.getAddedByUser=function(){return t.getUser(s.addedBy)},this.getAddedByUserName=function(){return!!e.getAddedByUser()&&e.getAddedByUser().getName()},this.setAddedByUserObj=function(e){s.addedByUser=e},this.setUserObj=function(e){s.user=e},this.unregisterUserObjectsListener=function(){n.unregister(s.userRegisterKey),s.userRegisterKey=null,n.unregister(s.addedByUserRegisterKey),s.addedByUserRegisterKey=null},this.createUserObject=function(){var n=t.create({futId:e.getId(),fn:e.getFullName(),prIm:e.getPictureUrl(),uId:e.getRingId()});this.setUserObj(n)},this.initUserObjects=function(){var t,i=e.getUser();s.userRegisterKey||i&&i.hasDetails()||(this.createUserObject(),s.userRegisterKey=n.register(s.utId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:s.userId,utId:s.utId,tagId:s.tagId})})),t=e.getAddedByUser(),s.addedByUserRegisterKey||t&&t.hasDetails()||(s.addedByUserRegisterKey=n.register(s.addedBy,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:s.addedBy,tagId:s.tagId})}))},this.isCurrentUser=function(){return e.getId()===i.currentUser().getUtId()},this.isAdmin=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.ADMIN},this.isMember=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.MEMBER},this.isOwner=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.OWNER},this.isRemoved=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.REMOVED},this.isLeaved=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.LEAVE},this.makeAdmin=function(){s.status=c.MEMBER_STATUS.ADMIN},this.makeMember=function(){s.status=c.MEMBER_STATUS.MEMBER},this.makeOwner=function(){s.status=c.MEMBER_STATUS.OWNER},this.serialize=function(){return{userId:e.getId(),ringId:e.getRingId(),fullName:e.getName().utf8Encode(),status:e.getStatus(),addedBy:e.getAddedBy()}}}function d(){var e=this,i={tagId:0,text:"",hrtime:"",status:"",messageDate:"",isDeleted:!1,messageDateString:"",timeout:0,userId:0,fullName:"",type:0,packetId:0,user:{},seenPacketSent:!1,deliveredPacketSent:!1,statusType:"",seenUsers:[],deliveredUsers:[],usersToChange:{},usersToChangeName:{},tagName:"",allStatusUserFetched:!1,statusUsersFetchCount:0,userRegisterKey:null};this.getTagId=function(){return i.tagId},this.setTagId=function(e){i.tagId=e},this.getHumanReadableTime=function(){return i.hrtime},this.setHumanReadableTime=function(e){i.hrtime=e},this.setFullName=function(e){i.fullName=e.substring(0,127)},this.getFullName=function(){return i.fullName},this.getPacketId=function(){return i.packetId},this.setPacketId=function(e){i.packetId=e},this.getMessageText=function(){return i.text},this.setMessageText=function(e){i.text=e},this.setStatus=function(e){i.status=e},this.getStatus=function(){return i.status},this.setMessageDate=function(e){i.messageDate=e},this.getMessageDate=function(){return i.messageDate},this.markAsDeleted=function(){i.isDeleted=!0},this.unMarkFromDeleted=function(){i.isDeleted=!1},this.getIsDeleted=function(){return i.isDeleted},this.setMessageDateString=function(e){i.messageDateString=e},this.setTimeout=function(e){i.timeout=e},this.setUserId=function(e){i.userId=e},this.getMessageDateString=function(){return i.messageDateString},this.getTimeout=function(){return i.timeout},this.getUserId=function(){return i.userId},this.getUser=function(){return t.getUser(i.userId)},this.getMessageType=function(){return i.type},this.setMessageType=function(e){i.type=e},this.initUserObjects=function(){var t=e.getUser();i.userRegisterKey||t&&t.hasDetails()||(i.userRegisterKey=n.register(i.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:i.userId,tagId:i.tagId})}))},this.unregisterUserObjectsListener=function(){n.unregister(i.userRegisterKey),i.userRegisterKey=null},this.getSeenPacketSent=function(){return i.seenPacketSent},this.getDeliveredPacketSent=function(){return i.deliveredPacketSent},this.setSeenPacketSent=function(e){i.seenPacketSent=e},this.setDeliveredPacketSent=function(e){i.deliveredPacketSent=e},this.addSeenUserId=function(e){i.seenUsers.push(e)},this.addDeliveredUserId=function(e){i.deliveredUsers.push(e)},this.setUsersToChange=function(e){i.usersToChange=e},this.getUsersToChange=function(){return i.usersToChange},this.setUsersToChangeName=function(e){i.usersToChangeName=e},this.getUsersToChange=function(){return i.usersToChangeName},this.setStatusType=function(e){i.statusType=e},this.getStatusType=function(){return i.statusType},this.getTagName=function(){return i.tagName},this.setTagName=function(e){i.tagName=e},this.serialize=function(){return{tagId:e.getTagId(),userId:e.getUserId(),user:e.getUserId(),packetId:e.getPacketId(),fullName:e.getFullName().utf8Encode(),status:e.getStatus(),statusType:e.getStatusType(),type:e.getMessageType(),hrtime:e.getHumanReadableTime(),messageDate:e.getMessageDate(),isDeleted:i.isDeleted,timeout:e.getTimeout(),text:e.getMessageText().utf8Encode(),seenPacketSent:e.getSeenPacketSent(),deliveredPacketSent:e.getDeliveredPacketSent(),usersToChange:Object.keys(i.usersToChange),allStatusUserFetched:i.allStatusUserFetched,messageType:e.getMessageType(),tag_chat:!0,tagName:e.getTagName()}}}return d.prototype.update=function(e){e.getFullName()&&this.setFullName(e.getFullName()),e.getStatus()&&this.setStatus(e.getStatus()),e.getStatusType()&&this.setStatusType(e.getStatusType()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getMessageDate()&&this.setMessageDate(e.getMessageDate()),e.getMessageText()&&this.setMessageText(e.getMessageText()),e.getUsersToChange()&&this.setUsersToChange(e.getUsersToChange()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getSeenPacketSent()&&this.setSeenPacketSent(e.getSeenPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getTimeout()&&this.setTimeout(e.getTimeout()),e.getIsDeleted()&&this.markAsDeleted(),e.getHumanReadableTime()||this.setHumanReadableTime(e.getHumanReadableTime())},{TagObject:l,TagMember:u,TagMessage:d}}var chatApp;chatApp=angular.module("ringid.chat"),chatApp.factory("ChatResponses",ChatResponses),ChatResponses.$inject=["$rootScope","chatHistoryFactory","SystemEvents","Auth","tagChatFactory","ChatFactory","tagChatManager","Utils","userFactory","ConversationsFactory","ChatResponseProcessor","ChatSeenSend","ChatHelper","ChatConnector"];function ChatResponses(e,t,n,r,i,o,a,s,c,l,u,d,g,E){var m=window.CHAT_APP,T=m.Constants.PACKET_TYPES,f=m.Constants,p=f.GENERAL_CONSTANTS,_=f.CHAT_GLOBAL_VALUES,I=m.ChatRequests,h={};function A(e){return h[e]}function C(e){switch(e){case p.MESSAGE_TYPES.DELETE_MESSAGE:case p.MESSAGE_TYPES.TEXT:case p.MESSAGE_TYPES.EMOTICON_MESSAGE:case p.MESSAGE_TYPES.LOCATION_SHARE:case p.MESSAGE_TYPES.LINK_SHARE:case p.MESSAGE_TYPES.STICKER:case p.MESSAGE_TYPES.IMAGE:case p.MESSAGE_TYPES.CAMERA_IMAGE:case p.MESSAGE_TYPES.AUDIO:case p.MESSAGE_TYPES.VIDEO:case p.MESSAGE_TYPES.RING_MEDIA_MESSAGE:return!0;default:return!1}}function S(e){var t=e.packetType,n=A(t);if(!n)return!1;try{n.processor.call(this,e)}catch(r){}return!0}function v(e){e.userId,e.friendId,e.packetId}function M(e){var t=e.userId,r=(e.friendId,e.onlineStatus,e.userMood,e.packetId,o.getBoxByUtId(t));t===r.getKey()&&o.closeChatBox(r.getKey()),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t})}function D(e){var t=e.friendId,n=(e.chatBindingPort,e.serverDate),r=(e.packetId,o.getBoxByUtId(t));_.serverTime=n,_.serverTimeDiff=Date.now()-n,r||(r=o.createNonDomBox(t,!1,!1))}function O(e){var t=e.userId,r=(e.friendId,o.getBoxByUtId(t));r&&(r.setFriendTypingBool(!1),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:r.getKey()}))}function R(e){var t,i;e.userId,e.friendId;t=String(e.userId)===String(r.currentUser().getKey())?e.friendId:e.userId,i=o.getBoxByUtId(t),i&&(i.setFriendTypingBool(!0),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t}),setTimeout(function(){i.setFriendTypingBool(!1),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t})},3e3))}function N(e){var i,a,l,g,E,m,T,f=e.userId,g=e.friendId,_=e.messageType,I=e.timeout,h=(e.message,e.messageDate),A=(e.isSecretVisible,e.packetId);C(_)&&(i=e.boxId,a=r.currentUser().getKey(),i||(i=f),String(i)===String(a)&&(i=g),i=i.toString(),t.isInLocalStorageChatMsgMap(i,A)||(E=o.getBoxByUtId(i),_===p.MESSAGE_TYPES.DELETE_MESSAGE?u.doOnMessageTypeDeleteMessage(i,f,A,e,E):e.messageType>p.MESSAGE_TYPES.BLANK_MESSAGE&&(E?e.fromHistory||E.nonDomBox||(E.nonDomBox=!0,E.closedBox=!1,s.triggerCustomEvent(n.CHAT.REFRESH,{boxId:i})):o.openChatBox(i),E=o.getBoxByUtId(i),E.setFriendTypingBool(!1),e.fromHistory&&e.fromOffline||(E&&(!E.isFocused||!E.scrollbarAtBottom)&&E.latestSeenMessageDate<=h&&e.userId!==a?(e.status="Unread",l="unread"):e.status=e.status||"Received"),e.fromHistory?"Unread"!==String(e.status)&&(e.seenSent=!0):l="bottom",e.tag_chat=!1,g=E.getKey(),"Edited"!==String(e.status)&&E.isSamePacketId(A)||(e.user=c.create({futId:f,fetchDatails:!1}),"Unread"===String(e.status)&&(o.increaseUnreadMessageCount(i,e.packetId),E.updateUnreadCount()),E.pushMessage(e,f),e.fromHistory||E.isFocused&&E.scrollbarAtBottom&&(m=p.MESSAGE_TYPES,T=[{key:e.packetId,value:E.getMessage(e.packetId)}],[m.IMAGE,m.AUDIO,m.VIDEO,m.CAMERA_IMAGE,m.RING_MEDIA_MESSAGE].indexOf(_)===-1&&(d.sendSeenPacket(E,T),I>0&&s.triggerCustomEvent(n.CHAT.WAS_FOCUSED,{box:E,filteredMessages:T}))),t.updateBox(E)))))}function P(e){e.userId,e.friendId,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;e.status="Edited",
N(e)}function y(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;N(e)}function b(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;P(e)}function U(e){e.userId,e.friendId,e.messages,e.packetId}function L(e){var t,r=e.userId,i=e.friendId,o=e.packetId,a=u.getFriendBoxId(r,i),c=u.getFriendBox(a);t=c.getMessage(o),t&&(u.updateMessageStatusToDelivered(a,t),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:t}),c.sendTabUpdate(t))}function F(e){var t,r=e.userId,i=e.friendId,o=e.packetId,a=u.getFriendBoxId(r,i),c=u.getFriendBox(a);t=c.getMessage(o),t&&(u.updateMessageStatusToDelivered(c.getKey(),t),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:t}),c.sendTabUpdate(t))}function k(e){var r,i,o,a=e.userId,c=e.friendId,l=(e.messages,e.packetId,u.getFriendBoxId(a,c)),d=u.getFriendBox(l);for(r=0;r<e.messages.length;r++)i=d.getMessage(e.messages[r].packetId),i&&(o=!1,e.messages[r].status===p.MESSAGE_STATUS.DELETED||(e.messages[r].status===p.MESSAGE_STATUS.SEEN?(i.status="Seen",s.triggerCustomEvent(n.CHAT.DO_START_SECRET_TIMER,{boxId:l,others:!1,messages:[{key:e.messages[r].packetId,value:i}]}),o=!0):e.messages[r].status===p.MESSAGE_STATUS.VIEWED&&(i.status="Viewed",s.triggerCustomEvent(n.CHAT.DO_START_SECRET_TIMER,{boxId:l,others:!0,messages:[{key:e.messages[r].packetId,value:i}]}),o=!0)),o&&(t.updateMessage(i,d.getKey()),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:i}),d.sendTabUpdate(i)))}function w(e){e.userId,e.friendId,e.packetId}function G(e){var i,o,a,c=e.userId,l=e.friendId,d=e.packets,g=(e.packetId,u.getFriendBoxId(c,l)),E=u.getFriendBox(g);for(i=0;i<d.length;i++)o=d[i].packetId,a=E.getMessage(o),a&&(String(c)!==String(r.currentUser().getKey())?(a.messageType=p.MESSAGE_TYPES.DELETE_MESSAGE,a.text="This message has been deleted",a.setTextPartition(),a.status="Deleted"):E.removeMessage(o),t.updateMessage(a,E.getKey()),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:a}),E.sendTabUpdate(a))}function B(e){var t=e.userId,n=e.friendId;e.packetId,u.getFriendBoxId(t,n)}function $(e){e.userId,e.friendId,e.sequenceNo,e.rawDataByte,e.packetId}function H(e){e.userId,e.friendId,e.sequenceNo,e.packetId}function x(e){e.userId,e.friendId,e.blockUnblockDate,e.isAddToDb,e.packetId}function Y(e){e.userId,e.friendId,e.blockUnblockDate,e.packetId}function K(e){e.userId,e.friendId,e.packetId}function j(e){e.userId,e.tagId,e.packetId}function V(e){e.userId,e.tagId,e.onlineStatus,e.userMood,e.packetId}function W(e){var t=e.tagId,n=(e.chatBindingPort,e.serverDate),r=(e.packetId,o.getBoxByUtId(t));_.serverTime=n,_.serverTimeDiff=Date.now()-n,r||(r=o.createNonDomBox(t,!0,!1))}function q(e){var t=(e.userId,e.tagId);e.activityType,e.tagName,e.tagPictureUrl,e.packetId;u.processTagInformation(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function z(e){e.userId,e.tagId,e.packetId}function Q(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;u.processTagMemberAddUpdate(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function X(e){e.userId,e.tagId,e.packetId}function Z(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;u.processTagMemberRemoveLeave(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function J(e){var t=e.userId,i=e.tagId;e.packetId;t===r.currentUser().getKey()&&u.doTagUnregisterTask(i),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:i})}function ee(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;u.processTagMemberStatusChange(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function te(e){e.userId,e.tagId,e.packetId}function ne(e){var t=(e.userId,e.tagId),r=o.getBoxByUtId(t);r&&(r.setFriendTypingBool(!1),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t}))}function re(e){var t,r,a=e.userId,c=e.tagId;t=o.getBoxByUtId(c),t&&(r=i.getTag(c),r&&(t.showTypingText(a),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c}),setTimeout(function(){t.hideTypingText(),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c})},3e3)))}function ie(e){var l,g,m,T,f=e.userId,_=e.tagId,h=e.messageType,A=(e.message,e.messageDate),S=e.packetId,v=i.getTag(_),M=o.getBoxByUtId(_);C(h)&&(_=_.toString(),!e.fromHistory&&t.isInLocalStorageChatMsgMap(_,S)||(v||(l=I.getOfflineGetTagInformationWithMembersObject(_),E.send(l),v=i.getOrCreateTag(_)),h===p.MESSAGE_TYPES.DELETE_MESSAGE?u.doOnMessageTypeDeleteMessage(_,f,S,e,M):h>p.MESSAGE_TYPES.BLANK_MESSAGE&&(M=a.openTagChatBoxIfClosed(_,M),e.fromHistory||(g="bottom"),e.fromHistory&&e.fromOffline||(M&&(!M.isFocused||!M.scrollbarAtBottom)&&M.latestSeenMessageDate<=A&&e.userId!==r.currentUser().getKey()?(e.status="Unread",g="unread"):e.status=e.status||"Received"),e.tag_chat=!0,M.isSamePacketId(S)||(e.user=c.create({futId:f,fetchDatails:!1}),!e.fromHistory&&v&&v.isTagSafeToShow()&&(M.nonDomBox||(M.nonDomBox=!0,M.closedBox=!1,s.triggerCustomEvent(n.CHAT.REFRESH,{boxId:_}))),e.fromHistory?("Unread"!==String(e.status)&&(e.seenSent=!0),t.removeUnreadMessageInfo(_,S),M.updateUnreadCount()):"Unread"===String(e.status)&&(o.increaseUnreadMessageCount(_,S),M.updateUnreadCount()),M.pushMessage(e,f),e.fromHistory||M.isFocused&&M.scrollbarAtBottom&&(m=p.MESSAGE_TYPES,T=[{key:e.packetId,value:M.getMessage(e.packetId)}],[m.IMAGE,m.AUDIO,m.VIDEO,m.CAMERA_IMAGE,m.RING_MEDIA_MESSAGE].indexOf(h)===-1&&d.sendSeenPacket(M,T)),t.updateBox(M)))))}function oe(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId;e.status="Edited",ie(e)}function ae(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function se(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function ce(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId}function le(e){var r=(e.userId,e.friendId,e.tagId),i=e.packetId,o=u.getTagChatBox(r),a=o.getMessage(i);a&&("Seen"!==a.status&&(a.status="Delivered"),t.updateMessage(a,o.getKey()),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:r})),t.updateBox(o)}function ue(e){var r=e.tagId,i=e.packetId,o=u.getTagChatBox(r),a=o.updateMessageStatus(i,"Sent");a&&(t.updateMessage(a,o.getKey()),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:r})),t.updateBox(o)}function de(e){var r,i=(e.userId,e.tagId),o=(e.packetId,e.packets),a=u.getTagChatBox(i);a&&(o.forEach(function(e){r=a.updateMessageStatus(e.packetId,"Seen"),r&&t.updateMessage(r,a.getKey())}),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:i}),t.updateBox(a))}function ge(e){e.tagId,e.packetId}function Ee(e){var t,r=e.userId,i=e.tagId,o=e.packets,a=(e.packetId,u.getTagChatBox(i));if(angular.isArray(o)){for(t=0;t<o.length;t++)u.doOnMessageTypeDeleteMessage(i,r,o[t].packetId,null,a);s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:i})}}function me(e){e.userId,e.tagId,e.packetId}function Te(e){e.userId,e.tagId,e.sequenceNo,e.rawDataByte,e.packetId}function fe(e){e.userId,e.tagId,e.sequenceNo,e.packetId}function pe(e){var t,n=e.tagId,r=e.originalPacketid,i=o.getBoxByUtId(n),a=e.members;i&&(t=i.getMessage(r),t&&a.forEach(function(e){t.addSeenUserId(e.userId,e.seenTime)}))}function _e(e){e.userId,e.friendId,e.fullName,e.onlineStatus,e.friendAppType,e.friendDeviceToken,e.userMood,e.packetId}function Ie(e){e.friendId,e.packetId}function he(e){e.userId,e.updateTime,e.blockUnblockDate,e.packetId}function Ae(e){var t=e.serverDate;e.packetId;_.serverTime=t,_.serverTimeDiff=Date.now()-t}function Ce(e){var t,n,r=e.messages;e.packetId;for(t=0;t<r.length;t++)n=r[t],n.messageType!==p.MESSAGE_TYPES.DELETE_MESSAGE?n.status="Unread":n.status="Deleted",n.fromOffline=!0,n.fromHistory=!1,N(n)}function Se(e){e.userId,e.packets,e.packetId}function ve(e){e.userId,e.friendId,e.pageDirection,e.pageLimit,e.packetId}function Me(e){var t,i,a,c,l=e.friendId,d=e.messages,g=e.pageDirection,E=(e.packetId,r.currentUser().getKey()),m=[],T=o.getBoxByUtId(l);if(T||(T=o.createNonDomBox(l,!1,!1)),d.length||g===p.PAGE_DIRECTION.DOWN){for(i=!1,a=!1,t=0;t<d.length;t++)c=d[t],c.messageType===p.MESSAGE_TYPES.DELETE_MESSAGE&&String(c.userId)===String(E)?T.updateBoxMessageMinMaxPacketId(c):c.messageType!==p.MESSAGE_TYPES.HISTORY_RE_FETCH&&(i=!0,c.userId.toString()===String(E)?(c.status=u.getMessageStatus(c.status)||"Delivered",c.friendId=l):(c.status===p.MESSAGE_STATUS.DELETED?c.status="Deleted":c.status="Received",c.friendId=E),c.boxId=l,c.fromOffline=!0,c.fromHistory=!0,N(c)),m.push(c.packetId);i&&(T.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:l,noScroll:!0}),s.triggerCustomEvent(n.CHAT.API_HISTROY_PROCESSED,{boxId:l}))}else T.hasHistoryMessage=!1}function De(e){e.friendId,e.packetId}function Oe(e){e.userId,e.friendId,e.packets,e.packetId}function Re(e){e.friendId,e.packets,e.packetId}function Ne(e){e.friendId,e.packets,e.packetId}function Pe(e){e.friendId,e.packets,e.packetId}function ye(e){var t=e.items;t.forEach(function(e){l.saveConvesation(e)}),s.triggerCustomEvent(n.CHAT.CONVERSATION_RECEIVED,{})}function be(e){var t=e.tagId,n=(e.noOfItems,e.items),r=e.packetId;n.forEach(function(e){u.processAGroupActivity(t,r,e)})}function Ue(e){var t,r;e.noOfItems,e.items,e.packetId;for(t=0;t<e.items.length;t++)r=i.createNewTag(e.items[t]),i.addTagObject(r);s.triggerCustomEvent(n.CHAT.MY_TAG_LIST_RECEIVED,{tagId:r.getTagId()})}function Le(e){var t,n;e.messages,e.packetId;for(t=0;t<e.messages.length;t++)n=e.messages[t],n.messageType!==p.MESSAGE_TYPES.DELETE_MESSAGE?n.status="Unread":n.status="Deleted",n.fromUnread=!0,n.fromOffline=!0,n.messageType===p.MESSAGE_TYPES.GROUP_ACTIVITY?u.processGroupActivityMessage(n):ie(n)}function Fe(e){e.userId,e.packets,e.packetId}function ke(e){e.userId,e.tagId,e.tagName,e.tagPictureUrl,e.tagMembers,e.packetId}function we(e){e.tagId,e.packetId}function Ge(e){e.userId,e.tagId,e.pageDirection,e.pageLimit,e.packetId}function Be(e){var t,i,o,a,c=e.tagId,l=e.messages,d=e.pageDirection,g=(e.packetId,r.currentUser().getKey()),E=u.getTagChatBox(c);if(l.length||d===p.PAGE_DIRECTION.DOWN){for(i=!1,o=0;o<l.length;o++)a=l[o],a.tagId=c,a.fromHistory=!0,a.fromOffline=!0,a.messageType===p.MESSAGE_TYPES.GROUP_ACTIVITY?(t=!0,u.processGroupActivityMessage(a)):a.messageType===p.MESSAGE_TYPES.DELETE_MESSAGE&&String(a.userId)===String(g)?E.updateBoxMessageMinMaxPacketId(a):a.messageType!==p.MESSAGE_TYPES.HISTORY_RE_FETCH&&(t=!0,a.status===p.MESSAGE_STATUS.DELETED?a.status="Deleted":String(a.userId)===String(r.currentUser().getKey())?a.status="Seen":a.status="Received",ie(a));t&&(E.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c,noScroll:!0}),s.triggerCustomEvent(n.CHAT.API_HISTROY_PROCESSED,{boxId:c}))}else E.hasHistoryMessage=!1}function $e(e){e.userId,e.tagId,e.packetId}function He(e){var t=e.tagId,r=(e.tagName,e.tagPictureUrl,e.tagMembers),o=(e.packetId,i.getOrCreateTag(t,e));e.tagMembersCount=r.length,u.addMembersToTagObject(o,e.tagMembers),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function xe(e){e.tagId,e.packetId}function Ye(e){e.sequenceNo,e.rawDataByte,e.packetId}function Ke(e){e.sequenceNo,e.rawDataByte,e.userId,e.packetId}function je(e){e.userId,e.sequenceNo,e.packetId}return h[T.FRIEND_CHAT_REGISTER]={processor:v},h[T.FRIEND_CHAT_UNREGISTER]={processor:M},h[T.FRIEND_CHAT_REGISTER_CONFIRMATION]={processor:D},h[T.FRIEND_CHAT_IDLE]={processor:O},h[T.FRIEND_CHAT_TYPING]={processor:R},h[T.FRIEND_CHAT_MSG]={processor:N},h[T.FRIEND_CHAT_MSG_EDIT]={processor:P},h[T.FRIEND_CHAT_BROKEN_MSG]={processor:y},h[T.FRIEND_CHAT_BROKEN_MSG_EDIT]={processor:b},h[T.FRIEND_CHAT_MULTIPLE_MSG]={processor:U},h[T.FRIEND_CHAT_DELIVERED]={processor:L},h[T.FRIEND_CHAT_SENT]={processor:F},h[T.FRIEND_CHAT_SEEN]={processor:k},h[T.FRIEND_CHAT_SEEN_CONFIRMATION]={processor:w},h[T.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={processor:G},h[T.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={processor:B},h[T.FRIEND_CHAT_BROKEN]={processor:$},h[T.FRIEND_CHAT_BROKEN_CONFIRMATION]={processor:H},h[T.FRIEND_CHAT_BLOCK]={processor:x},h[T.FRIEND_CHAT_UNBLOCK]={processor:Y},h[T.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={processor:K},h[T.TAG_CHAT_TAG_REGISTER]={processor:j},h[T.TAG_CHAT_TAG_UNREGISTER]={processor:V},h[T.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={processor:W},h[T.TAG_CHAT_TAG_INFORMATION]={processor:q},h[T.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={processor:z},h[T.TAG_CHAT_TAG_MEMBER_ADD]={processor:Q},h[T.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={processor:X},h[T.TAG_CHAT_MEMBER_REMOVE_LEAVE]={processor:Z},h[T.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={processor:J},h[T.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={processor:ee},h[T.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={processor:te},h[T.TAG_CHAT_IDLE]={processor:ne},h[T.TAG_CHAT_TYPING]={processor:re},h[T.TAG_CHAT_MSG]={processor:ie},h[T.TAG_CHAT_MSG_EDIT]={processor:oe},h[T.TAG_CHAT_BROKEN_MSG]={processor:ae},h[T.TAG_CHAT_BROKEN_MSG_EDIT]={processor:se},h[T.TAG_CHAT_MULTIPLE_MSG]={processor:ce},h[T.TAG_CHAT_DELIVERED]={processor:le},h[T.TAG_CHAT_SENT]={processor:ue},h[T.TAG_CHAT_SEEN]={processor:de},h[T.TAG_CHAT_SEEN_CONFIRMATION]={processor:ge},h[T.TAG_CHAT_MULTIPLE_MSG_DELETE]={processor:Ee},h[T.TAG_CHAT_MSG_DELETE_CONFIRMATION]={processor:me},h[T.TAG_CHAT_GENERAL_BROKEN_PACKET]={processor:Te},h[T.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={processor:fe},h[T.TAG_CHAT_MESSAGE_SEEN_LIST]={processor:pe},h[T.OFFLINE_FRIEND_INFORMATION]={processor:_e},h[T.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={processor:Ie},h[T.OFFLINE_GET_REQUEST]={processor:he},h[T.OFFLINE_GET_REQUEST_CONFIRMATION]={processor:Ae},h[T.OFFLINE_FRIEND_UNREAD_MESSAGE]={processor:Ce},h[T.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={processor:Se},h[T.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={processor:ve},h[T.OFFLINE_FRIEND_HISTORY_MESSAGE]={processor:Me},h[T.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={processor:De},h[T.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={processor:Oe},h[T.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={processor:Re},h[T.GET_UNREAD_COUNT]={processor:Ne},h[T.GET_CONVERSATION_REQUEST]={processor:Pe},h[T.MESSAGE_CONVERSATION_LIST]={processor:ye},h[T.OFFLINE_TAG_INFORMATION_ACTIVITY]={processor:be},h[T.OFFLINE_MY_TAG_LIST]={processor:Ue},h[T.OFFLINE_TAG_UNREAD_MESSAGE]={processor:Le},h[T.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={processor:Fe},h[T.OFFLINE_TAG_CREATE_TAG]={processor:ke},h[T.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={processor:we},h[T.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={processor:Ge},h[T.OFFLINE_TAG_HISTORY_MESSAGE]={processor:Be},h[T.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={processor:$e},h[T.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={processor:He},h[T.OFFLINE_TAG_CONFIRMATION]={processor:xe},h[T.OFFLINE_BROKEN_HISTORY_PACKET]={processor:Ye},h[T.OFFLINE_BROKEN_PACKET]={processor:Ke},h[T.OFFLINE_BROKEN_PACKET_CONFIRMATION]={processor:je},{processUpdates:S}}var chatApp;chatApp=angular.module("ringid.chat"),chatApp.factory("PublicChatResponses",PublicChatResponses),PublicChatResponses.$inject=["$rootScope","chatHistoryFactory","SystemEvents","Auth","ChatRoomFactory","ChatFactory","tagChatManager","Utils","userFactory","ChatResponseProcessor","ChatRoomCategoryFactory"];function PublicChatResponses(e,t,n,r,i,o,a,s,c,l,u){var d=window.CHAT_APP,g=d.Constants.PACKET_TYPES,E=d.Constants,m=E.GENERAL_CONSTANTS,T={};function f(e){return T[e]}function p(e){var t=e.packetType,n=f(t);if(!n)return!1;try{n.processor.call(this,e)}catch(r){}return!0}function _(e){var t=e.roomId,n=o.getBoxByUtId(t);n||(n=o.createNonDomBox(t,!1,!0))}function I(e){var t=e.roomId,r=o.getBoxByUtId(t);r&&(r.setFriendTypingBool(!1),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t}))}function h(e){var t,r,i=e.userId,a=e.roomId,l=e.fullName;r=o.getBoxByUtId(a),r&&(t=c.create({futId:i}),t.hasDetails()||t.setName(l),r.showTypingText(i),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:a}),setTimeout(function(){r.hideTypingText(),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:a})},3e3))}function A(e){var t,r,a=e.userId,u=e.roomId,d=e.messageType,g=e.fullName,E=e.memberUrl,T=e.packetId;t=i.get(u),t&&(r=o.getBoxByUtId(u),r&&(d===m.MESSAGE_TYPES.DELETE_MESSAGE?l.doOnMessageTypeDeleteMessage(u,a,T,e,r):d>m.MESSAGE_TYPES.BLANK_MESSAGE&&(e.status=e.status||"Received",e.public_chat=!0,r.isSamePacketId(T)||(e.user=c.create({futId:a,fetchDatails:!1}),e.user.hasDetails()||(e.user.setName(g),e.user.setProfileImage(E)),e.fromHistory||r.nonDomBox||(r.nonDomBox=!0,s.triggerCustomEvent(n.CHAT.REFRESH,{boxId:u})),r.pushMessage(e,a)))))}function C(e){e.status="Edited",A(e)}function S(e){var t=e.roomId,r=e.packetId,i=o.getBoxByUtId(t);i&&(i.updateMessageStatus(r,"Delivered"),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t}))}function v(e){var t=e.roomId,r=e.packetId,i=o.getBoxByUtId(t);i&&(i.updateMessageStatus(r,"Sent"),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t}))}function M(e){var t,r=e.roomId,o=e.members,a=i.get(r);a&&(o&&o.forEach(function(e){t=i.getUserMapObjectFromRawUserObject(e),a.addMember(t)}),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:r}))}function D(e){var t,r=e.roomId,o=e.membersLength;t=i.get(r),t&&(t.setNoOfMembers(o),s.triggerCustomEvent(n.CHAT.ROOM_UPDATED,{roomId:r}))}function O(e){var t=e.rooms;0===t.length?i.setNoMoreRooms():t.forEach(function(e){i.addOrUpdate(e.roomId,e)}),s.triggerCustomEvent(n.CHAT.ROOM_LIST_UPDATED)}function R(e){var t=e.roomId;i.addOrUpdate(t,e),s.triggerCustomEvent(n.CHAT.ROOM_UPDATED,{roomId:t})}function N(e){var t,i,a,c=e.roomId,l=e.messages,u=r.currentUser().getKey(),d=o.getBoxByUtId(c);if(d)if(l.length){for(i=0;i<l.length;i++)a=l[i],a.iReport||(a.roomId=c,a.fromHistory=!0,a.fromOffline=!0,a.messageType===m.MESSAGE_TYPES.HISTORY_RE_FETCH||a.messageType===m.MESSAGE_TYPES.DELETE_MESSAGE&&String(a.userId)===String(u)||(t=!0,a.status===m.MESSAGE_STATUS.DELETED?a.status="Deleted":String(a.userId)===String(r.currentUser().getKey())?a.status="Seen":a.status="Received",A(a)));t&&(d.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c,noScroll:!0}),s.triggerCustomEvent(n.CHAT.API_HISTROY_PROCESSED,{boxId:c}))}else d.hasHistoryMessage=!1}function P(e){var t=e.rooms;0===t.length?i.setNoMoreRooms():t.forEach(function(e){i.addOrUpdate(e.roomId,e)}),s.triggerCustomEvent(n.CHAT.ROOM_LIST_UPDATED)}function y(e){var t,r=e.userId,i=e.roomId,a=e.packets,c=o.getBoxByUtId(i);if(c&&angular.isArray(a)){for(t=0;t<a.length;t++)l.doOnMessageTypeDeleteMessage(i,r,a[t].packetId,null,c);s.triggerCustomEvent(n.CHAT.ROOM_UPDATED,{roomId:i})}}function b(e){var t,r=e.roomId,a=e.messengerOwnerid,c=e.originalPacketid,l=o.getBoxByUtId(r),u=i.get(r);u&&l&&(t=l.getMessage(c),t&&(t.addLikeUserId(a),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:{key:c}})))}function U(e){var t,r=e.roomId,a=e.messengerOwnerid,c=e.originalPacketid,l=o.getBoxByUtId(r),u=i.get(r);u&&l&&(t=l.getMessage(c),t&&(t.removeLikeUserId(a),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:{key:c}})))}function L(e){var t=e.roomId,r=e.originalPacketid,a=o.getBoxByUtId(t),c=i.get(t);c&&a&&(a.removeMessage(r),s.triggerCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,{message:{key:r}}))}function F(e){var t,n=e.roomId,r=e.items,a=e.originalPacketid,s=o.getBoxByUtId(n),l=i.get(n);l&&s&&a&&(t=s.getMessage(a),a&&r.forEach(function(e){t.addLikeUserId(parseInt(e.userId,10)),c.create({futId:parseInt(e.userId,10),fn:e.fullName,prIm:e.memberUrl})}))}function k(e){var t=e.items;t.forEach(function(e){u.add(e)})}return T[g.PUBLIC_CHAT_REGISTER_CONFIRMATION]={processor:_},T[g.PUBLIC_CHAT_CHAT_IDEL]={processor:I},T[g.PUBLIC_CHAT_CHAT_MESSAGE_TYPING]={processor:h},T[g.PUBLIC_CHAT_CHAT_MESSAGE]={processor:A},T[g.PUBLIC_CHAT_CHAT_MESSAGE_EDIT]={processor:C},T[g.PUBLIC_CHAT_CHAT_MESSAGE_DELIVERED]={processor:S},T[g.PUBLIC_CHAT_CHAT_MESSAGE_SENT]={processor:v},T[g.PUBLIC_CHAT_MEMBER_LIST]={processor:M},T[g.PUBLIC_CHAT_MEMBER_COUNT_CHANGE]={processor:D},T[g.PUBLIC_CHAT_ROOM_LIST]={processor:O},T[g.PUBLIC_CHAT_ROOM_INFORMATION]={processor:R},T[g.PUBLIC_CHAT_HISTORY_MESSAGE_LIST]={processor:N},T[g.PUBLIC_CHAT_ROOM_LIST_WITH_HISTORY]={processor:P},T[g.PUBLIC_CHAT_DELETE_MESSAGE]={processor:y},T[g.PUBLIC_CHAT_DELETE_MESSAGE_CONFIRMATION]={processor:function(){}},T[g.PUBLIC_CHAT_LIKE_A_MESSAGE]={processor:b},T[g.PUBLIC_CHAT_UNLIKE_A_MESSAGE]={processor:U},T[g.PUBLIC_CHAT_REPORT_A_MESSAGE]={processor:L},T[g.PUBLIC_CHAT_LIKE_MEMBER_LIST]={processor:F},T[g.PUBLIC_CHAT_CATEGORY_LIST]={processor:k},{processUpdates:p}}angular.module("ringid.chat").factory("ChatAuthResponses",ChatAuthResponses),ChatAuthResponses.$inject=["$rootScope","tagChatFactory","ChatFactory","ChatPacketSenderService","userFactory","friendsFactory","chatRequestProcessor","chatHistoryFactory","ChatWorkerCommands","Auth","ChatConnector","SystemEvents","Utils","Storage"];function ChatAuthResponses(e,t,n,r,i,o,a,s,c,l,u,d,g,E){var m=CHAT_APP.Constants,T=m.GENERAL_CONSTANTS.SESSION_TYPES,f=m.RESPONSE_REASON_CODES,p=CHAT_APP.Constants.AUTH_SERVER_ACTIONS,_=m.GENERAL_CONSTANTS.USER_PRESENCE,I=CHAT_APP.ChatRequests,h=function(e){var t=n.getBoxByUtId(e);return t||(t=n.createNonDomBox(e,!1,!1)),t},A={};function C(e){return A[e]}function S(e){var t,n;if(1111===e.rc)return!1;if(t=e.actn,n=C(t),!n)return!1;try{n.processor.call(this,e)}catch(r){}return!0}function v(e){var r,i,o=e.tid,a=t.getTag(o);a?a=t.getOrCreateTag(o):(r=n.getBoxByUtId(o),r||(r=n.createNonDomBox(o,!0,!1)),i=I.getOfflineGetTagInformationWithMembersObject(o),u.request(i).then(function(e){e.sucs&&(a=t.getTag(o),a&&c.startChatSession(o,T.TAG,a.getMemberUtIds()))}))}function M(e){var r,i,o=e.tid,a=t.getTag(o);e.sucs&&(a?(a=t.getOrCreateTag(o),c.startChatSession(o,T.TAG,a.getMemberUtIds()),e.futIds&&angular.forEach(e.utIds,function(e){a.addMember(t.createNewTagMember(a.getTagId(),{utId:e},!0))})):(r=n.getBoxByUtId(o),r||(r=n.createNonDomBox(o,!0,!1)),i=I.getOfflineGetTagInformationWithMembersObject(o),u.request(i,10).then(function(e){e.sucs&&(a=t.getTag(o))})))}function D(e){var t,n,r,o=e.futId,c=o;c&&String(c)!==String(l.currentUser().getUtId())&&(t=h(c),t.platform=e.dvc,n=i.create({futId:e.futId,fn:e.nm}),r=n.getOnlineStatus(),n.setOnlineStatus(e.psnc),e.mood&&n.setUserMood(e.mood),e.dt&&n.setDeviceToken(e.dt),e.apt&&n.setAppType(e.apt),e.dvc&&n.setPlatform(e.dvc),r!==n.getOnlineStatus()&&a.sendFriendInformation(n),e.sucs===!0&&e.psnc===_.ONLINE?t.offlineStatus=!1:e.rc===f.PERMISSION_DENIED?(t.blocked=!0,t.blockedByUtId=e.bb):t.offlineStatus=!0,s.updateBox(t),g.triggerCustomEvent(d.CHAT.BOX_UPDATED,{boxId:c}))}function O(e){D(e)}function R(){}function N(e){var t,n=e.futId;e.futId&&(t=i.getUser(e.fId),t&&(e.psnc&&t.setOnlineStatus(e.psnc),e.mood&&t.setUserMood(e.mood),e.dvc&&t.setPlatform(e.dvc)),g.triggerCustomEvent(d.CHAT.BOX_UPDATED,{boxId:n}))}function P(e){var t=E.getData("loginData");e.oIP&&e.oPrt&&(CHAT_APP.setOfflineIp(e.oIP),CHAT_APP.setOfflinePort(e.oPrt),t.oIP=e.oIP,t.oPrt=e.oPrt,E.setData("loginData",t),e.fromWorker||u.sendGlobal("oIpPort",{ip:e.oIP,port:e.oPrt}))}return A[p.GET_OFFLINE_IP_PORT]={processor:P},A[p.START_F2F_CHAT]={processor:O},A[p.GET_USER_MOOD_PRESENCE]={processor:N},A[p.START_TAG_CHAT]={processor:R},A[p.RECEIVED_TAG_CHAT]={processor:v},A[p.ADD_TAG_CHAT_MEMBERS]={processor:M},A[p.RECEIVED_F2F_CHAT]={processor:D},{processUpdates:S}}angular.module("ringid.chat").controller("ChatController",ChatController),ChatController.$inject=["$scope","$rootScope","ChatFactory","ChatHelper","chatRequestProcessor","ChatUtilsFactory","ChatResponses","PublicChatResponses","ChatAuthResponses","settings","SystemEvents","friendsFactory","ChatPacketSenderService","chatTabSync","Utils","userFactory","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","$location","ChatConnector","ChatWorkerCommands"];function ChatController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I,h,A,C,S){var v,M,D,O,R,N,P,y=CHAT_APP.Constants,b=y.GENERAL_CONSTANTS,U=b.SESSION_TYPES,L=CHAT_APP.SharedHelpers.isPublicChatPacket;e.boxes=n.getBoxes(),e.$on("chatDataReceived",function(e,t){L(t.jsonData)?s.processUpdates(t.jsonData):a.processUpdates(t.jsonData)}),e.$on("authDataReceived",function(e,t){c.processUpdates(t.jsonData)}),D=m.onCustomEvent(u.COMMON.PONG,function(e){CHAT_APP.Constants.CHAT_GLOBAL_VALUES.serverTime=e.timestamp,CHAT_APP.Constants.CHAT_GLOBAL_VALUES.serverTimeDiff=e.diff,T.refreshPesence()}),e.domBoxLength=function(){for(O=0,R=0;R<e.boxes.length;R++)e.boxes[R].value.nonDomBox===!0&&O++;return O>10&&(O=10),O},e.availableNo=n.getNumberOfAvailableChatBox(),e.getProfileLink=l.baseUrl+"/profile/2110010128/",e.goToPage=function(e,t){A.path(t),e.stopPropagation()},e.contactListAction=function(t){t.friend.isLoading()||(d.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.$on(u.COMMON.WINDOW_RESIZED,function(t,r){e.availableNo=n.getNumberOfAvailableChatBox(r.x),m.safeDigest(e)}),N=m.onCustomEvent(u.CHAT.TAB_SYNC_NEW_DATA,function(e){e.type===b.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE?(n.refreshBox(e.boxId),m.triggerCustomEvent(u.CHAT.BOX_UPDATED,{boxId:e.boxId})):e.type===b.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE&&(f.loadChatBoxes(),n.openAndAddMessage(e.boxId,e.msg))});function F(){e.$on("NET_SUCCESS",function(){i.getUnreadMessagesMultipleTimes()}),window.addEventListener("online",function(){window.navigator.onLine&&i.getUnreadMessagesMultipleTimes()})}function k(){o.hasOfflineIpPort()?i.getUnreadMessagesMultipleTimes():g.doUpdateOfflineIpPort().then(function(){i.getUnreadMessagesMultipleTimes()})}function w(){var e=f.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t){var r,i=e[t];i.isTagChat||(n.openChatBox(i.boxId),r=n.getBoxByUtId(i.boxId),P=f.getBox(i.boxId),angular.extend(r,P),S.startChatSession(i.boxId,U.FRIEND))})}function G(){var e=f.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t){var n=e[t];n.isTagChat&&h.openPreviouslyOpenedBoxes(n.boxId)})}function B(){try{C.initiate(),f.init(),E.init(),k(),F(),v=m.onCustomEvent(u.FRIEND.UTID_LIST_RECEIVED,function(){w()}),M=m.onCustomEvent(u.CHAT.MY_TAG_LIST_RECEIVED,function(){G()}),m.triggerCustomEvent(u.CHAT.INITIATED)}catch(e){}}function $(){t.$on("FIRST_FEED_RECEIVED",function(){n.isChatAppInitiated()||(n.setChatAppInit(),B())}),setTimeout(function(){n.isChatAppInitiated()||(n.setChatAppInit(),B())},6e3)}I.isLoggedIn()?$():e.$on(u.AUTH.LOGIN,function(e,t){t===!0&&$()}),e.$on("$destroy",function(){m.removeCustomEvent(u.CHAT.TAB_SYNC_NEW_DATA,N),m.removeCustomEvent(u.FRIEND.UTID_LIST_RECEIVED,v),m.removeCustomEvent(u.CHAT.MY_TAG_LIST_RECEIVED,M),m.removeCustomEvent(u.COMMON.PONG,D)})}angular.module("ringid.chat").controller("PublicChatController",PublicChatController),PublicChatController.$inject=["$scope","ChatConnector","Utils","SystemEvents","ChatFactory","ChatRoomFactory","Storage","Auth"];function PublicChatController(e,t,n,r,i,o,a,s){var c,l,u;e.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" > <li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span ng-cloak="true"> {{ item.country }}</span></li></a></ul></div>',e.startIndex=0,e.pageLimit=10,e.loading=!0,e.searchParams={roomName:"",category:"",country:"",flagcode:""},e.ddControl={append:!1,countryList:s.getCountryList},e.ddAction=m,e.rooms=o.getRooms(),e.loadMoreRooms=g,e.searchRoom=E,e.hasMoreRooms=o.hasMoreRooms;function d(){var n,r=CHAT_APP.PublicChatRequests;n=""===e.searchParams.roomName?r.getPublicChatRoomListWithHistoryRequestObject(e.startIndex,e.pageLimit):r.getPublicChatRoomListSearchRequestObject(e.startIndex,e.pageLimit,e.searchParams.roomName,e.searchParams.country,e.searchParams.category),e.loading=!0,e.$rgDigest(),t.request(n).then(function(){e.rooms=o.getRooms(),e.loading=!1,e.$rgDigest()},function(){e.loading=!1,e.$rgDigest()})}function g(){e.startIndex=e.rooms.length,d()}function E(){d()}function m(t){e.searchParams.country=t.item.code,e.searchParams.flagcode=t.item.flagcode,e.$rgDigest()}function T(){d(),u=n.onCustomEvent(r.CHAT.ROOM_LIST_UPDATED,function(){e.$rgDigest()}),l=n.onCustomEvent(r.CHAT.ROOM_UPDATED,function(){e.$rgDigest()})}i.isChatAppInitiated()?T():c=n.onCustomEvent(r.CHAT.INITIATED,function(){T()}),e.getPopularMemberMessages=f;function f(e){var t={},n=[];return e.getMessages().all().forEach(function(e){t[e.value.user.getKey()]=e.value}),Object.keys(t).forEach(function(e){n.push(t[e])}),n}e.$on("$destroy",function(){c&&n.removeCustomEvent(r.CHAT.INITIATED,c),u&&n.removeCustomEvent(r.CHAT.ROOM_LIST_UPDATED,u),l&&n.removeCustomEvent(r.CHAT.ROOM_UPDATED,l)})}angular.module("ringid.chat").controller("ChatHistoryController",ChatHistoryController),ChatHistoryController.$inject=["$scope","$rootScope","ChatFactory","Storage","Auth","Api","tagChatFactory","userFactory","Utils","chatHistoryFactory","ConversationsFactory","$$stackedMap","SystemEvents","rgScrollbarService"];function ChatHistoryController(e,t,n,r,i,o,a,s,c,l,u,d,g,E){var m,T,f,p,_,I=CHAT_APP.Constants,h=I.GENERAL_CONSTANTS,A=CHAT_APP.SharedHelpers;e.selectedLeftBox={key:0,messages:[]},e.boxes=d.createNew(!0),e.recentMessages=d.createNew(!0),e.ready=t.chatHistoryReady||!1,e.selectLeftBox=function(t){e.selectedLeftBox=t},e.bottomReached=c.debounce(function(){var e=0,t=5,n=1,r=0;e=u.getTotalConvesationCount(),u.sendGetConversationRequest(e,t,n,r)},500);function C(e){var t=A.getClientTimeFromServerTime(e),n=c.verbalDate(t);return n}e.getMessageTime=C;function S(t,n){n&&(t.user=s.create({utId:n}),t.user.requestUserDetails().then(function(){e.$rgDigest()}))}function v(e){var t;return t=e.statusType?"Activity message":e.messageType===h.MESSAGE_TYPES.TEXT?e.text:"Received media message."}function M(e){var t;return t=e.statusType?"Activity message":e.lastMessageType===h.MESSAGE_TYPES.TEXT?e.lastMessage:"Received media message."}function D(e){var t;return t="Unread"===String(e.status)||"Received"===String(e.status)&&!e.seenSent}function O(e){var t=angular.copy(e);return t.date=C(t.messageDate),t.isUnread=function(){return D(t)},t.messageText=function(){return v(t)},t.user.getKey&&S(t,t.user),t.isSelf=function(){return String(e.userId)===String(i.currentUser().getKey())},t}function R(e){var t=!1;return e.messages&&e.messages.length>0&&(e.messages.sort(function(e,t){return e.messageDate>t.messageDate?1:e.messageDate<t.messageDate?-1:0}),t=e.messages[e.messages.length-1]),t}function N(t){var n,r=l.getChatBoxes(),i=r[t],o=e.boxes.get(t);o&&(o.messages=i.messages,n=R(o),n&&(o.lastMessage=O(n)))}function P(e){var t,n,r,i={};return r={message:e.lastMessage,messageDate:e.lastMessaeDate,messageType:e.lastMessageType,date:C(e.lastMessaeDate),messageText:function(){return M(e)},user:s.create({utId:e.lastMessaeUserId,fetchDatails:!1})},i.unreadCount=e.unreadCount,i.lastMessage=r,i.sortBy=function(){return this.lastMessage.messageDate},6===e.packetType?i.isTagChat=!1:i.isTagChat=!0,i.isTagChat?(t=e.conversationId,i.lastMessage=r,n=a.getTag(t),i.getTitle=function(){return n=a.getTag(t),n?n.getTagName():""},i.getCover=function(){return n=a.getTag(t),n?n.getPictureFullUrl():""},i.shouldVisible=function(){return n=a.getTag(t),!!n&&n.isTagSafeToShow()}):(S(i,e.conversationId),i.getTitle=function(){return i.user.getName()},i.getCover=function(){return i.user.avatar("thumb")},i.shouldVisible=function(){return!0}),i}function y(){var t=u.getAllConversations();t&&angular.forEach(t,function(t){var n=P(t.value);n.lastMessage&&e.boxes.save(t.key,n)})}e.initBoxMessages=function(t){var n;t.messages&&angular.forEach(t.messages,function(t){n=O(t),e.recentMessages.add(n.key,n)})},e.initRecentMessages=function(){},e.clearRecentMessages=function(){e.recentMessages.clear()},e.openChatBox=function(e,t,r){c.triggerCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED),t?n.openTagChatBox(e):r||n.openChatBox(e)},e.initRecentMessages(),t.chatHistoryReady||setTimeout(function(){e.ready=!0,t.chatHistoryReady=!0,e.$rgDigest(),E.recalculate(e)},5e3),T=c.onCustomEvent(g.CHAT.MY_TAG_LIST_RECEIVED,function(){
c.safeDigest(e)}),f=c.onCustomEvent(g.CHAT.TAG_LIST_UPDATED,function(){c.safeDigest(e)}),p=c.onCustomEvent(g.CHAT.MESSAGE_RECEIVED,function(t){N(t.boxId),c.safeDigest(e)}),_=c.onCustomEvent(g.CHAT.MESSAGE_SUBMITTED,function(t){N(t.boxId),c.safeDigest(e)}),m=c.onCustomEvent(g.CHAT.CONVERSATION_RECEIVED,function(){y(),e.$rgDigest()}),e.$on("$destroy",function(){c.removeCustomEvent(g.CHAT.MY_TAG_LIST_RECEIVED,T),c.removeCustomEvent(g.CHAT.TAG_LIST_UPDATED,f),c.removeCustomEvent(g.CHAT.MESSAGE_SUBMITTED,_),c.removeCustomEvent(g.CHAT.MESSAGE_RECEIVED,p),c.removeCustomEvent(g.CHAT.CONVERSATION_RECEIVED,m)})}angular.module("ringid.chat").controller("ChatMediaUploadController",ChatMediaUploadController),ChatMediaUploadController.$inject=["$scope","fileUploadService","Utils","$boxInstance","localData","SystemEvents","UPLOAD_TYPES"];function ChatMediaUploadController(e,t,n,r,i,o,a){e.navSection=0,e.sendMedia=function(){var s;e.capturedMedia&&i.boxId&&(s=t.createUpload({uploadType:a.CHAT,fileType:"image",file:n.dataURLToBlob(e.capturedMedia)}),n.triggerCustomEvent(o.CHAT.BOX_CAM_UPLOAD,{uploadFile:s,boxId:i.boxId}),r.close())}}angular.module("ringid.chat").controller("TagChatController",TagChatController),TagChatController.$inject=["$scope","$templateCache","$timeout","settings","$$connector","routeService","Auth","Ringalert","rgDropdownService","ChatFactory","Utils","tagChatStorage","friendsFactory","tagChatFactory","tagChatManager","chatRequestProcessor","ChatHelper","SystemEvents"];function TagChatController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p){var _,I,h=this,A=a.currentUser();h.hasTag=0,h.chatRoute=o.getRoute("CHAT_GROUPS"),h.memberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html",h.memberDDActions=M,h.getTagDDControl=C,h.allTags=E.getTags(),h.ready=h.allTags.length()>0,h.groupFilter="groups",h.debug=!1,h.isCurrentUserOwner=function(e){return String(e.getOwnerUserId())===String(A.getKey())},h.isCurrentUserMember=function(e){return e.isUserMember(A.getKey())},h.allTags=E.getTags(),h.changeGroupFilter=function(e){h.groupFilter=e||"groups"},h.showGroupLogs=function(){return"logs"===h.groupFilter},h.showGroups=function(){return"groups"===h.groupFilter},h.getTagPictureImageByMemberAvatars=S,h.getLastMessageOnATag=v,h.imageBase=r.imBase,h.getUserAvatar=function(e){var t;return t=e&&e.avatar()?e.avatar():"images/prof.png"},h.getLastMessageText=function(e){return 2===e.messageType?e.text:[6,7,8,9].indexOf(e.messageType)!==-1&&"Media"},e.shouldShow=function(){return h.ready},setTimeout(function(){h.ready=!0,h.timedout=!0},6e4),e.showSingleMemberAlert=function(){s.show({mg:"Please add a member before leaving the group."},"info")},I=u.onCustomEvent(p.CHAT.MY_TAG_LIST_RECEIVED,function(){h.allTags=E.getTags(),h.ready=!0,e.$rgDigest()}),_=u.onCustomEvent(p.CHAT.TAG_LIST_UPDATED,function(){h.allTags=E.getTags(),h.ready=!0,e.$rgDigest()});function C(e){return{tagId:e.getTagId(),isOwner:h.isCurrentUserOwner(e)}}function S(e){var t,n,r,i=[],o=e.getMembersObjectMap().all(),a=0;for(n=0;n<o.length&&a<3;n++)t=o[n].value,r=t.getPictureUrl(),""!==r&&(i.push(r),a++);return i}function v(e){var t=d.getLastMessageByTag(e.getTagId());return!!t&&t.value}function M(t){var n,r;switch(t.action){case"edit":case"view":c.close(),r=function(){return{tagId:t.tagId}};break;case"delete":c.close(),n=E.getTag(t.tagId),n.setObjectLock(),m.leaveFromTag(t.tagId,A.getKey()).then(function(){n.removeObjectLock(),e.$rgDigest()},function(t){n.removeObjectLock(),s.show(t,"error"),e.$rgDigest()}),e.$rgDigest()}return r}e.$on("$destroy",function(){u.removeCustomEvent(p.CHAT.TAG_LIST_UPDATED,_),u.removeCustomEvent(p.CHAT.MY_TAG_LIST_RECEIVED,I)})}!function(){"use strict";angular.module("ringid.chat").controller("TagChatMemberPageController",e),e.$inject=["$timeout","$scope","$$stackedMap","Auth","fileUploadService","UPLOAD_TYPES","tagChatFactory","tagChatManager","friendsFactory","$routeParams","Ringalert","Utils","settings","profileFactory","rgScrollbarService","CHAT_LANG","$location","ChatConnector","SystemEvents","rgDropdownService"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I){var h,A,C,S,v,M=r.currentUser(),D=this,O=r.currentUser().getKey(),R=T.TAG,N=CHAT_APP.ChatRequests,P=l.tagId;P&&parseInt(P,10)||f.path("/"),t.tag=a.getTag(P),t.memberDDHtml="templates/partials/tag-chat/list-page/member-actions-dropdown.html",t.memberDDActions=q,t.getDDControl=$,t.selectNewOwner=Y,t.isCurrentUserOwner=L,t.canRemoveMember=w,t.canChangeType=G,t.hasUserActions=B,t.getUserTypeToChange=F,t.leaveTag=j,t.isPageReady=!1,t.uploading=!1,D.hasTag=0,t.models={pictureUrl:"/images/default_cover.jpg",pictureFileName:""},t.uploadAction=function(e){switch(e.action){case o.TAGCHAT_COVER:e.uploadFile.fetchMeta(function(){t.models.pictureUrl=e.uploadFile.getPreview(),t.uploading=!0,d.safeDigest(t),e.uploadFile.initUpload().then(function(e){t.uploading=!1,t.models.pictureFileName=e.iurl,t.models.pictureUrl=g.imBase+e.iurl,d.safeDigest(t),s.updateTagInformation(t.tag,t.tag.getTagName(),t.models.pictureFileName).then(function(){},function(){u.show(R.DEFAULT_FAILURE_MESSAGE,"error"),d.safeDigest(t)})},function(){t.uploading=!1})});break;case o.TAGCHAT_AVATAR:}},t.tag?(t.isPageReady=!0,U()):h=d.onCustomEvent(_.CHAT.MY_TAG_LIST_RECEIVED,function(){v=N.getOfflineGetTagInformationWithMembersObject(P),p.request(v).then(function(e){e.sucs&&(t.tag=a.getTag(P),t.isPageReady=!0,U())})}),t.showBack=b;function y(e){f.path()==="/chat/group/"+e&&f.path("/chat/groups")}function b(e,n){var r=n.target.getAttribute("data-is-anchor");r||(t.showBackKey=e,n.preventDefault(),n.stopPropagation(),t.$rgDigest())}function U(){t.memberAdminList=t.tag.getMembersObjectMap(),t.tag.initMemberObjects(),t.models.pictureUrl=t.tag.getPictureFullUrl()}function L(){return!!t.tag&&t.tag.getOwnerUserId()===M.getKey()}function F(e){return e.isOwner()||e.isAdmin()?{text:"Remove from admin",type:"member"}:{text:"Add as admin",type:"admin"}}function k(e){if(t.tag&&!L(t.tag)){if(A=e.getAddedBy()===O,t.tag.isCurrentUserStatusAdmin(O)&&e.isAdmin()&&!A)return!1;if(t.tag.isCurrentUserStatusMember(O)&&!A&&(e.isAdmin()||e.isMember()&&!A))return!1}return!0}function w(e){return e.getId()!==O&&!e.isOwner()&&k(e)}function G(e){return e.getId()!==O&&!t.tag.isCurrentUserStatusMember(O)&&k(e)}function B(e){return G(e)||w(e)}function $(e){var n=e.isAdmin()?"member":"admin";return{tagId:t.tag.getTagId(),aMember:e,canRemoveMember:w,memberTypeToChange:n}}function H(e){var t=a.getTag(e);t&&t.removeObjectLock()}function x(e,t,n,r){t.setStatus(r),n.makeOwner(),e.removeObjectLock()}function Y(){var e,n,i,o,a=t.newOwnerTagMember,c=t.tag;t.newOwnerTagMember=!1,e=a.getStatus(),a.makeOwner(),n=c.getMember(r.currentUser().getKey()),n.makeMember(),i=[a.serialize(),n.serialize()],o=[a,n],c.setObjectLock(),s.changeTagMemberStatus(c.getTagId(),i,o).then(function(){s.leaveFromTag(c.getTagId()).then(function(){c.removeObjectLock(),y(c.getTagId())},function(){u.show(R.DEFAULT_FAILURE_MESSAGE,"error"),x(c,a,n,e)})},function(){u.show(R.DEFAULT_FAILURE_MESSAGE,"error"),x(c,a,n,e)}),d.safeDigest(t)}function K(e){t.tag.setObjectLock(),s.removeTagMembers(t.tag,[e.serialize()],[e]).then(function(){H(t.tag.getTagId()),t.$rgDigest()},function(){H(t.tag.getTagId()),t.$rgDigest(),u.show(R.DEFAULT_FAILURE_MESSAGE,"error")}),t.$rgDigest()}function j(){var e=t.tag.getMember(r.currentUser().getKey());t.tag.setObjectLock(),s.removeTagMember(t.tag.getTagId(),[e.serialize()],[e]).then(function(e){H(t.tag.getTagId()),u.show(e,"info"),y(t.tag.getTagId())},function(){H(t.tag.getTagId()),t.$rgDigest(),u.show(R.DEFAULT_FAILURE_MESSAGE,"error")}),t.$rgDigest()}function V(e,t){"admin"===t?e.makeAdmin():e.makeMember()}function W(e,n){var r=e.getStatusValue();V(e,n),t.tag.setObjectLock(),s.changeTagMemberStatus(t.tag.getTagId(),[e.serialize()],[e]).then(function(){H(t.tag.getTagId()),t.$rgDigest()},function(){H(t.tag.getTagId()),V(e,r),u.show(R.DEFAULT_FAILURE_MESSAGE,"error"),t.$rgDigest()}),t.$rgDigest()}function q(e){switch(I.close(e.event),e.action){case"type_change":W(e.member,e.type);break;case"remove":K(e.member)}}S=d.onCustomEvent(_.CHAT.TAG_LIST_UPDATED,function(){t.$rgDigest()}),C=d.onCustomEvent("TAG_MEMBER_FETCHED",function(e){e.tagId===P&&t.$rgDigest()}),t.$on("$destroy",function(){d.removeCustomEvent(_.CHAT.MY_TAG_LIST_RECEIVED,h),d.removeCustomEvent(_.CHAT.TAG_MEMBER_FETCHED,C),d.removeCustomEvent(_.CHAT.TAG_LIST_UPDATED,S)})}}(),function(){"use strict";angular.module("ringid.chat").controller("TagChatMemberPagePopupController",e),e.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","ChatFactory","chatHistoryFactory","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","$location","profileFactory","rgScrollbarService","CHAT_LANG","SystemEvents"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I){var h,A,C,S,v,M=_.TAG,D=CHAT_APP.Constants.GENERAL_CONSTANTS,O=i.currentUser().getKey();t.state={loading:!1,noData:!1},t.ob={friendName:""},t.addToTag=K,t.removeMember=V,t.createChatTag=$,t.updateChatTag=x,t.loadMoreFriends=B,t.cancel=J,t.validateTag=ee,t.newOwnerTagMember=!1,t.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:c.generateNewTagId(),errCircleName:!1,errMemberList:!1,errAdminList:!1},t.uploading=!1,t.selectNewOwner=Z,t.setNewOwner=q,t.isMemberSelected=W,t.canRemoveMember=k,t.canChangeType=w,t.canUpdateTagInfo=G,t.editMode=!1,t.memberfilter="",t.rgWizardData={steps:[{id:0,title:"Group Name",template:"templates/partials/tag-chat/list-page/popups/step1.html",showNextButton:function(){return t.models.tagName.length>2}},{id:1,title:"Select Member",template:"templates/partials/tag-chat/list-page/popups/step2.html",showNextButton:function(){return""!==t.models.tagName&&t.memberList.length()>=1}},{id:2,title:"Select Admin",template:"templates/partials/tag-chat/list-page/popups/step3.html",showNextButton:function(){return""!==t.models.tagName&&t.memberList.length()+t.adminList.length()>=1}}],onFinish:function(){t.editMode?x():$()}},t.friends=u.getFriends("friends"),t.getPicturePreviewUrl=N,t.contactListAction=P,t.uploadAction=y,d.wizardSteps&&(S=[],d.wizardSteps.forEach(function(e){S.push(t.rgWizardData.steps[e])}),t.rgWizardData.steps=S,t.rgWizardData.hideSteps=!0),d.initialStepId&&(t.rgWizardData.initialStepId=d.initialStepId),d&&d.tagId?(t.tag=c.getTag(d.tagId),C=t.tag.getMembersObjectMap(),C?(t.memberAdminList=C.copy(),b(),t.tag.initMemberObjects(),angular.forEach(t.memberAdminList.all(),function(e){e.value.isMember()?t.memberList.add(e.key,e.value):t.adminList.add(e.key,e.value)})):b(),t.models.tagName=t.tag.getTagName(),t.models.popupTitle="Update Group chat",t.models.pictureUrl=t.tag.getPictureFullUrl(),t.models.pictureFileName=t.tag.getPictureUrl(),d.action&&(t.action=d.action),t.editMode=!0,d.extra&&d.extra.onlyAddMember&&(t.currentMemberList=t.memberAdminList)):b(),v=E.onCustomEvent("TAG_MEMBER_FETCHED",function(){t.$rgDigest()}),t.$watch("ob.friendName",function(e){e&&e.length>1&&(Y(!0),u.searchContact({schPm:e},!0).then(function(){t.friends=u.getFriends("friends"),Y(!1)},function(){Y(!1)}))});function R(e){T.path()==="/chat/group/"+e&&T.path("/chat/groups")}function N(){return m.tagChatImBase+t.models.pictureUrl}function P(e){e.friend.isLoading()||(u.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())}function y(e){e.uploadFile.fetchMeta(function(){t.models.pictureUrl=e.uploadFile.getPreview(),t.uploading=!0,E.safeDigest(t),e.uploadFile.initUpload().then(function(e){t.uploading=!1,t.models.pictureFileName=e.iurl,t.models.pictureUrl=m.imBase+e.url,E.safeDigest(t)},function(e){t.uploading=!1})})}function b(){t.memberList=r.createNew(),t.currentMemberList=r.createNew(),t.adminList=r.createNew()}function U(e){return!!e&&e.getOwnerUserId()===i.currentUser().getKey()}function L(){return!0}function F(e){if(t.tag&&!U(t.tag)){if(h=e.getAddedBy()===O,t.tag.isCurrentUserStatusAdmin(O)&&e.isAdmin()&&!h)return!1;if(t.tag.isCurrentUserStatusMember(O)&&!h&&(e.isAdmin()||e.isMember()&&!h))return!1}return!0}function k(e){return e.getId()!==O&&!e.isOwner()&&F(e)}function w(e){return(e.getId()!==O||!e.isMember())&&F(e)}function G(){return!t.editMode||!t.tag.isCurrentUserStatusMember(O)}function B(){t.state.loading||t.friends.length()===u.totalFriends("friends")||(Y(!0),u.getContactDetails().then(function(){t.friends=u.getFriends("friends"),Y(!1)},function(){Y(!1)}),setTimeout(function(){t.state.loading=!1},3e3))}function $(){var e,r,i;return ee()?(e=t.models.tagName,r=t.models.tagId,i=t.models.pictureFileName,l.createTagNew({tagName:e,adminList:t.adminList.values(),memberList:t.memberList.values(),tagId:r,tagPictureUrl:i}).then(function(e){e.sucs&&g.show("Group Created.","success")},function(){g.show(M.DEFAULT_FAILURE_MESSAGE,"error")}),void n.close()):void E.safeDigest(t)}function H(){var e=c.getTag(t.tag.getTagId());e&&e.removeObjectLock()}function x(){var e,r,i,o=[],a=[];return ee()?(e=c.getTag(t.tag.getTagId()),r=t.models.tagName,i=t.models.pictureFileName,o=t.memberList.keys(),a=t.adminList.keys(),t.tag.setObjectLock(),l.updateTag(e,r,i,o,a).then(function(){H(t.tag.getTagId()),E.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()})},function(){H(t.tag.getTagId()),g.show(M.DEFAULT_FAILURE_MESSAGE,"error")},function(n){n.sucs&&(H(t.tag.getTagId()),E.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()}))}),t.editMode=!1,E.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()}),void n.close()):void E.safeDigest(t)}function Y(n){e(function(){t.state.loading=n,n||p.recalculate(t)})}function K(e,n){var r,i;return t.memberList.length()+t.adminList.length()>t.friends.length()-10&&B(),i=t.tag?t.tag.getTagId():t.models.tagId,r=c.createNewTagMember(i,{status:"member"===n?D.MEMBER_STATUS.MEMBER:D.MEMBER_STATUS.ADMIN,addedBy:O,fullName:e.getName(),userId:e.getUId(),utId:e.getKey()},!1),L(r)?(t.tag&&r.setTagId(t.tag.getTagId()),r.initWithUserMapObject(e),"admin"===n?t.adminList.add(r.getId(),r):t.memberList.add(r.getId(),r),t.friendsNameFilter="",void t.$rgDigest()):void g.show("Permission Denied","error")}t.selectMemberAsAdmin=j;function j(e){t.memberList.remove(e.getId()),t.adminList.add(e.getId(),e),e.makeAdmin(),t.$rgDigest()}function V(e){k(e)?(e.isAdmin()?(t.adminList.remove(e.getId()),e.makeMember(),t.memberList.add(e.getId(),e)):t.memberList.remove(e.getId()),t.$rgDigest()):g.show("Permission Denied","error")}function W(e){return t.newOwnerTagMember&&e.getId()===t.newOwnerTagMember.getId()}function q(e){t.newOwnerTagMember=e,E.safeDigest(t)}function z(e,n,r){e.setStatus(r),n.makeOwner(),t.tag.removeObjectLock()}function Q(){var e=a.getBoxByUtId(t.tag.getTagId());e&&(a.closeChatBox(t.tag.getTagId()),s.removeOpenBox(t.tag.getTagId()),t.tag&&t.tag.initMessages(),e.isFullScreen&&(document.body.className=document.body.className.replace("ringbox-opened","")),E.triggerCustomEvent(I.CHAT.REFRESH))}function X(e,n,r){"leave"===t.action?l.leaveFromTag(t.tag.getTagId()).then(function(e){t.tag.removeObjectLock(),g.show(e,"info"),R(t.tag.getTagId()),Q()},function(){g.show(M.DEFAULT_FAILURE_MESSAGE,"error"),z(e,n,r)}):(t.tag.removeObjectLock(),t.$rgDigest())}function Z(){var e=t.newOwnerTagMember,r=t.tag,o=e.getStatus(),a=r.getMember(i.currentUser().getKey()),s=[e.serialize(),a.serialize()],c=[e,a];t.newOwnerTagMember=!1,e.makeOwner(),a.makeMember(),r.setObjectLock(),l.changeTagMemberStatus(r.getTagId(),s,c).then(function(){X()},function(){g.show(M.DEFAULT_FAILURE_MESSAGE,"error"),z(e,a,o)}),E.safeDigest(t),n.close()}function J(){t.newOwnerTagMember=!1,n.close(),E.safeDigest(t)}function ee(){var e;return t.models.tagName.length>100?t.models.errTagName="Maximum 100 alpha numeric characters":t.models.errTagName="",t.models.errMemberList=t.memberList.length()+t.adminList.length()<1,e=!t.models.errMemberList&&!t.models.errTagName}A=E.onCustomEvent(I.FRIEND.UTID_LIST_RECEIVED,function(){t.$rgDigest()}),t.$on("$destroy",function(){E.removeCustomEvent(I.FRIEND.UTID_LIST_RECEIVED,A),E.removeCustomEvent("TAG_MEMBER_FETCHED",v),t.selectedMembers=[]})}}(),angular.module("ringid.chat").controller("TagChatDebugInfoController",TagChatDebugInfoController),TagChatDebugInfoController.$inject=["$scope","$boxInstance","Auth","ChatFactory","tagChatFactory","tagChatManager","friendsFactory","localData"];function TagChatDebugInfoController(e,t,n,r,i,o,a,s){e.currentUserUId=n.currentUser().getKey(),e.registerTag=c,e.unregisterTag=l,s&&s.tagId&&(e.tag=i.getTag(s.tagId),e.tagDebugInfo={},e.tagDebugInfo.isTagRegistered=i.isTagRegistered(s.tagId),e.chatBox=r.getBoxByUId(s.tagId));function c(){o.registerTag(e.tag.getTagId())}function l(){}}var chatApp;chatApp=angular.module("ringid.chat"),chatApp.factory("ChatUtilsFactory",ChatUtilsFactory),ChatUtilsFactory.$inject=["Auth","Utils","TextParser"];function ChatUtilsFactory(e,t,n){function r(e){var t=n.parseForLE(e,0);return t}function i(){var t=e.loginData,n={ip:"",port:""};return t&&(n.ip=t.oIP,n.port=t.oPrt),n}function o(){var e=i();return!(!e||!e.ip||!e.port)}function a(e){var n=CHAT_APP.SharedHelpers.getClientTimeFromServerTime(e);return t.chatVerbalDate(n)}return{parseForLE:r,getOfflineIpPort:i,hasOfflineIpPort:o,getChatVerbalDateFromServerDate:a}}angular.module("ringid.chat").service("rgRecorderService",rgRecorderService);function __getUserMedia(){var e,t;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(t="new",e=navigator.mediaDevices.getUserMedia):(t="old",e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),{gum:e,version:t}}function rgRecorder(e){var t,n,r=this,i="old",o=null,a={recordedImage:{width:0,height:0,image:""},recordedVideo:{width:0,height:0,video:""},mediaPreview:{width:400,height:400},mediaStream:"",mediaObject:"",isStreaming:!1,text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser"}};angular.extend(a,e),t=function(){},n=function(){},this._callbacks={streamReady:t,error:n};function s(){var e=__getUserMedia();o=e.gum,i=e.version}function c(){r.getMediaObject().readyState>3?r.onCanPlay():r.getMediaObject().addEventListener("canplay",r.onCanPlay,!1)}function l(e){var t=document.createElement("video"),n=window.URL||window.webkitURL;return t.src=n.createObjectURL(e),t.autoplay=!0,t}function u(e){a.mediaStream=e,a.mediaObject=l(e),c()}function d(e){var t;t="DevicesNotFoundError"===e.name||"OverconstrainedError"===e.name?a.text.WEBCAM_DISCONNECTED:"PermissionDeniedError"===e.name?a.text.PERMISSION_DENINED:a.text.GUM_NOT_SUPPORTED,r.triggerEvent("error",{text:t})}r.on=function(e,t){r._callbacks[e]=t},r.triggerEvent=function(e,t){r._callbacks[e]&&r._callbacks[e].call(r,t)},r.getProps=function(){return a},r.getMediaPreview=function(){return a.mediaPreview},r.getMediaObject=function(){return a.mediaObject},r.getStream=function(){return a.mediaStream},r.setStream=function(e){a.mediaStream=e},r.isStreaming=function(e){var t;return e?a.isStreaming=e:t=a.isStreaming,t},r.startRecording=function(){r.getStream().record()},r.stopRecording=function(){var e,t=r.getStream();t.getTracks?(e=t.getTracks(),e.forEach(function(e){e.stop()})):t.stop()},r.getRecordedMedia=function(e){r.getStream().getRecordedData(e)},r.captureImage=function(){var e,t=r.getMediaObject(),n=document.createElement("canvas"),i=n.getContext("2d");return t.width&&t.height?(n.width=t.width,n.height=t.height,i.drawImage(t,0,0,t.width,t.height),e=n.toDataURL("image/jpeg")):e=!1,e},r.onCanPlay=function(){var e,t,n=r.getMediaObject(),i=r.getMediaPreview();r.isStreaming()||(e=i.width,t=n.videoHeight/(n.videoWidth/i.width),isNaN(t)&&(t=e/(4/3)),n.setAttribute("width",i.width),n.setAttribute("height",t),r.isStreaming(!0),r.triggerEvent("streamReady",{stream:r.getStream(),media:n}))},r.openMedia=function(e){if(o)try{"old"===i?o.call(navigator,e,u,d):o.call(navigator.mediaDevices,e).then(u)["catch"](d)}catch(t){}else r.triggerEvent("error",{text:a.text.GUM_NOT_SUPPORTED})},r.destroy=function(){var e=r.getMediaObject();e&&e.removeEventListener("canplay",r.onCanPlay),r.getStream()&&(r.stopRecording(),r.setStream(null))};function g(){s()}g()}function rgRecorderService(){var e=!1,t=!1;this.getRecorderInstance=function(e){return new rgRecorder(e)},this.hasUserMediaSupport=function(){return e||(t=!!__getUserMedia().gum,e=!0),t}}var ChatWorker;angular.module("ringid.chat").factory("ChatConnector",ChatConnector),ChatConnector.$inject=["$rootScope","$q","Auth","ChatUtilsFactory","settings"];function _updateGobal(e,t){CHAT_APP.GLOBALS[e]=t}function ChatConnector(e,t,n,r,i){var o,a=CHAT_APP.Constants,s=a.WORKER_NOTIFIER_TYPES,c=a.GENERAL_CONSTANTS,l=!1,u=0,d={};ChatWorker=new Worker(window.location.origin+c.CHAT_WORKER_PATH);function g(e,t){var n="";try{o=CHAT_APP.PacketFormats.CHAT_PACKET_INFO[e.packetType].PACKET_NAME,n=CHAT_APP.PacketFormats.CHAT_PACKET_INFO[e.packetType].CONFIRMATION?"{1}({0}, {2})".format(e.packetType,o,t.toUpperCase()):"{1}({0}, {2})".format(e.packetType,o,t.toUpperCase())}catch(r){}}function E(e,t,n){var r=n;d[e]||(d[e]=[]),r=r||null,d[e]={ctx:r,fn:t,ct:Date.now()}}function m(){var e,t,o;if(!l){if(RingMessageChannel&&!RingMessageChannel.port2){if(u+=1,u<4)return void setTimeout(m,500);RingMessageChannel=null}e={command:"SETTINGS",url:i.socketProtocol+window.location.host+"/ChatSocket/"+window._cti,tabId:window._cti,salt:Cookies.get("sId"),sKey:Cookies.get("sessionID"),appVersion:i.apiVersion,CLIENT_DATA_SIZE:512};try{o=n.currentUser().getUId(),t=n.currentUser().getUtId(),o&&(e.uId=o,e.utId=t,e.name=n.currentUser().getName(),e.profileImage=n.currentUser().getProfileImage()),e.oIpPort=r.getOfflineIpPort()}catch(a){}try{RingMessageChannel?ChatWorker.postMessage(e,[RingMessageChannel.port2]):(ChatWorker.postMessage(e),RingWorker.addCallback("forward_to_chat",function(e){e.command="FROM_AUTH_WORKER",ChatWorker.postMessage(e)}))}catch(a){}_updateGobal("uId",o),_updateGobal("utId",t),_updateGobal("appVersion",i.apiVersion),l=!0}}function T(e){var t=e.data;t.command="FROM_CHAT_WORKER",RingWorker.pushMessage(e.data)}return ChatWorker.addEventListener("error",function(e){}),ChatWorker.addEventListener("message",function(t){var n,r,i;switch(t.data.notifier){case s.DEBUG:try{}catch(o){}break;case s.CHAT_DATA_RECEIVED:t.data.object&&e.$broadcast("chatDataReceived",{jsonData:t.data.object});break;case s.AUTH_DATA_RECEIVED:t.data.object&&e.$broadcast("authDataReceived",{jsonData:t.data.object});break;case s.CHAT_REQUEST_RESPONSE:n=t.data.object.packetId,r=t.data.object,i=d[n],n&&i&&(r.notify?i.fn.notify.call(i.ctx,r):r.sucs?i.fn.resolve.call(i.ctx,r):r.error?i.fn.resolve.call(i.ctx,r):r.sucs||i.fn.resolve.call(i.ctx,r)),delete d[n];break;case s.AUTH_REQUEST_RESPONSE:break;case s.RE_INIT:m();break;case s.EXCEPTION:try{}catch(o){}break;case s.FORWARD_TO_AUTH:try{T(t)}catch(o){}}}),{initiate:m,sendCommand:function(e,t){var n={command:e,tabId:window._cti},r=angular.extend({},t,n);ChatWorker.postMessage(r)},sendGlobal:function(e,t){var n;_updateGobal(e,t),n={command:"UPDATE_GLOBALS",tabId:window._cti},n[e]=t,ChatWorker.postMessage(n)},rawSend:function(e){ChatWorker.postMessage({command:"RAW_SEND",tabId:window._cti,object:e})},send:function(e,t){g(e,"send"),ChatWorker.postMessage({command:"SEND",tabId:window._cti,object:e,retryCount:t})},request:function(e,n){var i;return g(e,"request"),i=t.defer(),e.packetId||(e.packetId=r.getUUIDPacketId()),E(e.packetId,i,this),ChatWorker.postMessage({command:"REQUEST",tabId:window._cti,object:e,retryCount:n}),i.promise}}}angular.module("ringid.chat").factory("ConversationsFactory",ConversationsFactory),ConversationsFactory.$inject=["Auth","$$stackedMap","ChatConversationModel","ChatUtilsFactory","ChatPacketSenderService","chatRequestProcessor"];function ConversationsFactory(e,t,n,r,i,o){var a=t.createNew(!0,"desc");function s(t){var r,i=e.currentUser().getKey();i.toString()!==t.friendGroupId.toString()&&(r=n.create(t),a.save(r.conversationId,r))}function c(e){return a.get(e.toString())}function l(){return a.all()}function u(e){a.remove(e)}function d(){return a.top()}function g(){return a.bottom()}function E(){a.sort()}function m(){var e=a.length();return e}function T(e,t,n,a){r.hasOfflineIpPort()?o.getConversationRequest(e,t,n,a):i.doUpdateOfflineIpPort().then(function(){o.getConversationRequest(e,t,n,a)})}return{saveConvesation:s,getConversation:c,getAllConversations:l,removeConversation:u,getTopConversation:d,getBottomConversation:g,sortConversation:E,sendGetConversationRequest:T,getTotalConvesationCount:m}}angular.module("ringid.chat").factory("ChatExceptions",ChatExceptions),ChatExceptions.$inject=[];function ChatExceptions(){function e(e,t){}return{ChatPacketException:e}}angular.module("ringid.chat").factory("ChatFactory",ChatFactory),ChatFactory.$inject=["settings","Storage","$$stackedMap","ChatMap","Auth","Utils","ChatConnector","chatHistoryFactory","userFactory","friendsFactory","tagChatFactory","$interval","SystemEvents","OPERATION_TYPES","$rootScope"];function ChatFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m){var T=null,f=!1,p=n.createNew();function _(){return T||(T=new CHAT_APP.UTILS.ChatClock),T}function I(e){var t,n;return t=e?e-400-165:o.viewport.x-400-165,n=parseInt(t/310,10)}function h(e){var t={key:e,isMinimized:!1,isHidden:!1,isFocused:!1,blinkOn:!1,timeout:5,secretChat:!1,nonDomBox:!1,closedBox:!1,offlineStatus:!1,blocked:!1,blockedByUtId:[],isSecretVisible:!0,singlePage:!1,lastSeenBar:!0,unreadCount:0,bottomScrolled:!1,animationClass:"chat-open-animation",chatBoxClass:"chat-body-opened chat-open-animation"};return t}function A(e,t,n,i){var o,a,s,l=e.toString(),u=i,d=!t&&!n;return i||(u={}),s=p.get(l),s!==!1?a=s:s=r.create(l,t,n),d&&(o=c.create({futId:l}),o.fetchPresence()),a=h(l),a.isFocused=!0,a.nonDomBox=!0,a.isTagChat=t,a.isPublicChat=n,a.isFriendChat=d,a.lastLogin=s.getUser()&&s.getUser().lastOnline?s.getUser().lastOnline():"",a.offlineStatus=t||n?null:o.isOnline(),angular.extend(a,u),angular.extend(s,a),s.isMinimized=!1,s.chatBoxClass="chat-body-opened chat-open-animation",s}function C(e,t,n,r){var i=A(e,t,n,r);return p.save(e,i),s.addBox(i),i}function S(e,t,n){var r,i=e.toString(),a=p.get(i);return a===!1?(r=s.getBox(i),a=C(i,t,n,r),n||s.addOpenBoxes(i,t,n)):(a.isFocused=!0,a.nonDomBox=!0,a.blinkOn=!1,a.chatBoxClass="chat-body-opened",a.isMinimized=!1,s.updateBox(a)),o.triggerCustomEvent(g.CHAT.REFRESH),a}function v(e){S(e,!1,!1)}function M(e){var t=S(e,!0,!1);return t}function D(e){var t=S(e,!1,!0);return t}function O(e,t,n){var i=e.toString(),o=r.create(i,t,n),a=h(i);return a.closedBox=!0,a.isTagChat=t,a=angular.extend(o,a),p.save(i,a),s.addBox(a),o}function R(e){var t=e.toString(),n=p.get(t);n!==!1&&(p.remove(t),n.isFocused=!0,p.save(t,n),m.$broadcast("focusOn",t))}function N(e){var t,n=e.toString(),r=p.get(n);s.removeOpenBox(n),r.isTagChat&&(t=u.getTag(n),t&&t.initMessages()),p.remove(n)}function P(e){var t=e.toString(),n=p.get(t);n.isMinimized=!1,n.isFocused=!1,n.closedBox=!0,n.animationClass="chat-closing-animation",n.chatBoxClass="chat-body-opened "+n.animationClass,s.updateBox(n)}function y(e){var t=e.toString(),n=p.get(t);n.isMinimized=!0,n.isFocused=!1,n.animationClass="chat-minimize-animation",n.chatBoxClass="chat-body-opened "+n.animationClass,s.updateBox(n)}function b(e){var t=e.toString(),n=p.get(t);n.isMinimized=!1,n.isFocused=!0,n.closedBox=!1,n.animationClass="chat-maximize-animation",n.chatBoxClass="chat-body-opened "+n.animationClass,s.updateBox(n)}function U(e,t){var n=e.toString(),r=p.get(n);r.isMinimized=!1,r.isFocused=!0,t?r.animationClass="chat-fullscreen-close-animation":r.animationClass="chat-fullscreen-open-animation",r.chatBoxClass="chat-body-opened "+r.animationClass}function L(e){var t=e.toString(),n=p.get(t);n.chatBoxClass=n.chatBoxClass.replace(n.animationClass,"")}function F(e){var t,n=s.getBox(e),r=p.get(e);s.loadChatBoxes(),r?n.closedBox?p.remove(e):(angular.extend(r,n),r.loadHistoryMessages()):n.closedBox||(t=A(e,n.isTagChat,n.isPublicChat,n),p.save(e,t),t.loadHistoryMessages())}function k(e,t){var n,r;t&&(n=p.get(e),n?(n.nonDomBox=!0,n.loadSingleHistoryMessage(t)):(n.isTagChat?(r=u.getTag(e),r.isTagSafeToShow()&&M(e)):n.isPublicChat?D(e):v(e),n=C(e,n.isTagChat,n.isPublicChat),n.loadHistoryMessages()),o.triggerCustomEvent(g.CHAT.NEW_MESSAGE_PUSHED,{boxId:e,scroll:"bottom"}))}function w(){return p.all()}function G(){return p.nonClosedLength()}function B(e){return p.get(e)}function $(e,t){s.addUnreadMessageInfo(e,t),s.updateUnreadMessageInfos()}function H(e,t){s.removeUnreadMessageInfo(e,t),s.updateUnreadMessageInfos()}function x(){return s.getUnreadMessageCount()}function Y(){return s.getUnreadConversationCount()}function K(){f=!0}function j(){return f}return{isChatAppInitiated:j,setChatAppInit:K,openChatBox:v,openTagChatBox:M,openPublicChatBox:D,createNonDomBox:O,makeVisibleChatBox:R,doCloseChatBox:N,closeBox:P,refreshBox:F,minimizeBox:y,maximizeBox:b,fullscreenBox:U,onBoxAnimationEnd:L,openAndAddMessage:k,getBoxes:w,getBoxByUtId:B,getNumberOfAvailableChatBox:I,getNonClosedLength:G,increaseUnreadMessageCount:$,decreaseUnreadMessageCount:H,getUnreadMessageCount:x,getUnreadConversationCount:Y,getChatClock:_}}angular.module("ringid.chat").factory("ChatHelper",ChatHelper),ChatHelper.$inject=["SystemEvents","ChatFactory","OPERATION_TYPES","ChatConnector","ChatWorkerCommands","Auth","$interval","Utils","chatHistoryFactory"];function ChatHelper(e,t,n,r,i,o,a,s,c){return{sendChatSeenConfirmation:p,startTimerText:T,startTimerOthers:f,decreaseUnreadCount:l,increaseUnreadCount:d,deleteMessageFromOwn:g};function l(t,n){t.isPublicChat||(n?t.unreadCount-n>0?t.unreadCount-=n:t.unreadCount-n<0?t.unreadCount=0:t.unreadCount=0:u(t),c.updateBox(t),c.removeUnreadMessageInfoByBoxId(t.getKey()),s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()}))}function u(e){e.unreadCount=0}function d(e,t){e&&!e.isPublicChat&&e.isFocused===!1&&(e.unreadCount+=t)}function g(t,n){var r,i,o;if(t&&n.key){for(t.removeMessage(n.key),c.removeMessage(n.key,t.getKey()),r=t.getMessages(),i=0,o=r.length;i<o;i++)r[i].value.showDate=r[i].value.takeDecisionForShowingDate(),r[i].value.showAvator=r[i].value.takeDecisionForShowingMessageUserAvator();s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}}function E(e,t,n){t.$broadcast("timeoutDelete",e.key,n)}function m(e,t,n){a(function(){E(e,t,n--)},1e3,n+1)}function T(e,t){var n,r,i,o;if(!(t.length<1))for(n=0,r=t.length;n<r;n++)if(t[n].value.timeout>0&&!t[n].value.timerStartFlag)switch(t[n].value.messageType){case 2:case 3:case 4:case 5:case 6:o=t[n].value.timeout,i=t[n].value,t[n].value.timerStartFlag=!0,m(i,e,o)}}function f(e,t){var n,r;if(t[0].value&&t[0].value.timeout>0&&!t[0].value.timerStartFlag)switch(t[0].value.messageType){case 7:case 8:case 9:case 10:n=t[0].value.timeout,r=t[0].value,t[0].value.timerStartFlag=!0,m(r,e,n)}}function p(e,t,n,i,o){var a=CHAT_APP.ChatRequests.getFriendChatSeenConfirmationObject(i,o);r.send(a)}}angular.module("ringid.chat").service("ChatPacketSenderService",ChatPacketSenderService),ChatPacketSenderService.$inject=["Auth","Utils","ChatFactory","tagChatFactory","ChatUtilsFactory","$q","TextParser","chatHistoryFactory","chatTabSync","ChatConnector","ChatWorkerCommands","SystemEvents","$$connector"];function ChatPacketSenderService(e,t,n,r,i,o,a,s,c,l,u,d,g){var E=this,m=CHAT_APP.Constants,T=CHAT_APP.SharedHelpers,f=m.GENERAL_CONSTANTS,p=m.PACKET_TYPES,_=m.PLATFORM,I=CHAT_APP.UTILS.getUUIDPacketId;function h(e,t){var n,r;return t&&t.url&&(n=e.message,r={u:t.url,d:t.description,t:t.title,i:t.image,m:n},e.message=angular.toJson(r)),e}function A(e,t){var n;return t&&t.lat&&(e.la=t.lat,e.lo=t.lng,e.loc=t.description,n={lo:e.lo,la:e.la,loc:e.loc},e.message=angular.toJson(n)),e}function C(e,t){var n;return t&&t.url&&(n={u:t.url,c:t.caption,w:t.width,h:t.height},e.message=angular.toJson(n),
e.mediaUrl=t.url,e.plainText=t.caption),e}function S(e,t){var n;return t.media.media&&(n={u:t.url,c:t.caption,w:t.width,h:t.height},n=t.media.media,e.message=angular.toJson(n),e.mediaUrl=t.media.media.prIm,e.plainText=t.media.media.ttl),e}function v(t,n,r){var i,o,a,s,c,l=!1,u=e.currentUser(),d=e.currentUser().getKey(),g=T.getChatServerCurrentTime(),E=t.isTagChat,m=t.isPublicChat;return t.editMessageKey?(o=t.editMessageKey,t.editMessageKey=void 0,g=parseInt(t.editMessageDate,10),t.editMessageDate=void 0,l=!0,E?(s=p.TAG_CHAT_MSG_EDIT,c=p.TAG_CHAT_BROKEN_MSG_EDIT):m?(s=p.PUBLIC_CHAT_CHAT_MESSAGE_EDIT,c=p.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN_EDIT):(s=p.FRIEND_CHAT_MSG_EDIT,c=p.FRIEND_CHAT_BROKEN_MSG_EDIT)):(o=I(g,!0),E?(s=p.TAG_CHAT_MSG,c=p.TAG_CHAT_BROKEN_MSG):m?(s=p.PUBLIC_CHAT_CHAT_MESSAGE,c=p.PUBLIC_CHAT_CHAT_MESSAGE_BROKEN):(s=p.FRIEND_CHAT_MSG,c=p.FRIEND_CHAT_BROKEN_MSG)),i={isEdit:l,tag_chat:!1,packetType:s,brokenPacketType:c,fullName:u.getName(),memberUrl:u.getProfileImage()||"",userId:d,messageType:r,messageDate:g,message:n,key:o,packetId:o,isSecretVisible:t.isSecretVisible?1:0,timeout:0,platform:_.WEB},E?(a=t.getKey(),i.tag_chat=!0,i.tagId=a):m?(i.tag_chat=!1,i.public_chat=!0,i.roomId=t.getKey()):(i.friendId=t.getUser().getKey(),i.friendUtId=t.getUser().getUtId(),t.secretChat?i.timeout=t.timeout:i.timeout=0),i}function M(e,t){switch(a.hasEmoticon(e.message)&&(e.messageType=3),e.messageType){case f.MESSAGE_TYPES.LOCATION_SHARE:A(e,t.locationData);break;case f.MESSAGE_TYPES.LINK_SHARE:h(e,t.ogData);break;case f.MESSAGE_TYPES.IMAGE:case f.MESSAGE_TYPES.CAMERA_IMAGE:case f.MESSAGE_TYPES.VIDEO:C(e,t.mediaData);break;case f.MESSAGE_TYPES.RING_MEDIA_MESSAGE:S(e,t)}}function D(e,n,r){var i=e.getMessage(n.packetId);i&&(i.status=r,s.updateMessage(i,e.getKey()),t.triggerCustomEvent(d.CHAT.BOX_UPDATED,{boxId:e.getKey()}))}function O(t,n){var r=e.currentUser();t.pushMessage(n,r.getKey(),!0)}function R(e,t,n,r){var i=v(e,t,n,r);return M(i,r),i}function N(e){var t,r,i=e.boxId,o=e.packetId;i&&o&&(t=n.getBoxByUtId(i),t?D(t,{packetId:o},"Failed"):(r=s.getMessage(i,o),r.status="Failed",s.updateMessage(r,i)))}function P(e,t,n,r){var i=R(e,t,n,r);y(e,i)}function y(e,t){return O(e,t),t.message=t.message.utf8Encode(),setTimeout(function(){l.request(t).then(function(t){t.sucs||(t.boxId=e.getKey(),N(t))})}),t}function b(e,t){var n,r;t.tag_chat?t.tagId=e.getKey():t.friendId=e.getKey(),r={ogData:t.ogData,locationData:t.locationInfo,mediaData:t.mediaInfo},n=R(e,t.text,t.messageType,r),n.message=n.message.utf8Encode(),n.packetId=t.packetId,n.key=t.packetId,t.status="Pending",setTimeout(function(){l.request(n).then(function(t){t.sucs||(t.boxId=e.getKey(),N(t))})})}function U(t){var n;n=t.isTagChat?CHAT_APP.ChatRequests.getTagChatTypingObject(t.getKey()):t.isPublicChat?CHAT_APP.PublicChatRequests.getPublicChatChatMessageTypingObject(t.getKey(),e.currentUser().getName()):CHAT_APP.ChatRequests.getFriendChatTypingObject(t.getKey()),l.rawSend(n)}function L(e){var t,n=0,r=0;t=e.isTagChat?CHAT_APP.ChatRequests.getFriendChatUnregisterObject(e.getKey(),n,r):e.isPublicChat?CHAT_APP.ChatRequests.getPublicChatUnregisterObject(e.getKey()):CHAT_APP.ChatRequests.getTagChatTagUnregisterObject(e.getKey(),n,r),l.send(t)}function F(e){var t=f.MESSAGE_TYPES.TEXT;return e.locationData.lat?t=f.MESSAGE_TYPES.LOCATION_SHARE:e.ogData.url&&(t=f.MESSAGE_TYPES.LINK_SHARE),t}function k(){var e=CHAT_APP.AuthRequests.getOfflineIpPort();return g.request(e,e.requestType)}E.sendMessage=P,E.retryMessage=b,E.sendTypingPacket=U,E.sendChatUnRegisterPacket=L,E.getSendMessageObject=R,E.pushMessageToBox=O,E.getMessageType=F,E.doSendMessage=y,E.doUpdateOfflineIpPort=k}angular.module("ringid.chat").factory("ChatSeenSend",ChatSeenSend),ChatSeenSend.$inject=["ChatWorkerCommands","ChatFactory","chatHistoryFactory","Utils","Auth","tagChatFactory","tagChatManager","ChatHelper","tagChatHelper","$q","ChatUtilsFactory","ChatConnector"];function ChatSeenSend(e,t,n,r,i,o,a,s,c,l,u,d){var g=CHAT_APP.Constants,E=CHAT_APP.ChatRequests,m=g.GENERAL_CONSTANTS,T=g.FRIEND_CHAT_PACKET_TYPE,f=CHAT_APP.SharedHelpers;function p(e,t,n){var r,i,o;for(r=E.getFriendChatSeenObject(e,t),r.brokenPacketType=T.FRIEND_CHAT_SEEN,o=f.getChatServerCurrentTime(),i=0;i<t.length;i++)r.messages[i].packetId=t[i].key,r.messages[i].messageDate=o,r.messages[i].status=C(t[i].messageType);d.request(r).then(function(r){r.sucs&&(I(e,t),n.resolve("success"))},function(){n.reject("failed")})}function _(e,t){var n,r,i=l.defer(),o=i.promise;return t.length<1?o="":(n=A(t),r=e.getKey(),e.isTagChat?(h(r,n),o=i.resolve({sucs:!0})):e.isPublicChat?o=i.resolve({sucs:!0}):p(r,n,i)),l.when(o)}function I(e,r){var i,o,a=t.getBoxByUtId(e),s=[];for(i=0;i<r.length;i++)a&&(o=a.getMessage(r[i].key),o&&(o.seenSent=!0,o.status="Received",s.push(o)));n.updateMessages(s,e)}function h(e,t){var n,r,i,a=o.getTag(e);if(a){for(n=0;n<t.length;n++)r=t[n].key,i=E.getTagChatSeenObject(e,[{packetId:r}]),d.send(i);I(e,t)}}function A(e){var t,n=[];for(t=0;t<e.length;t++)n.push({key:e[t].key,messageType:e[t].value.messageType,senderId:e[t].value.user.getKey()});return n}function C(e){var t=0;switch(e){case 2:case 3:case 4:case 5:case 6:t=m.MESSAGE_STATUS.SEEN;break;case 7:case 8:case 9:case 10:case 15:t=m.MESSAGE_STATUS.VIEWED}return t}return{sendSeenPacket:_}}var chatApp=angular.module("ringid.chat");chatApp.factory("chatTabSync",chatTabSync);function CrossTab(){var e,t,n,r={};function i(){var e="CrossTab not supported",t=[];throw localStorage||t.push("localStorage not available"),window.addEventListener||t.push("addEventListener not available"),t.length>0&&(e+=": "+t.join(", ")),new Error(e)}function o(){return(new Date).getTime()}function a(n){var i;if(n&&"__CROSSTAB"===n.key){try{i=n.newValue?JSON.parse(n.newValue):{}}catch(o){i={}}i&&i.id&&i.id!==CrossTab.id&&(n.newValue===e&&n.oldValue===t||(e=n.newValue,t=n.oldValue,r.message&&r.message.call(this,i.data)))}}function s(e,t){var r={id:n,data:t,timestamp:o()};localStorage.setItem(e,JSON.stringify(r))}function c(){window.removeEventListener("beforeunload",l,!1),window.addEventListener("unload",l,!1)}function l(){}function u(e,t,n){var r=n||"0",i=e.toString();return i.length>=t?i:new Array(t-i.length+1).join(r)+i}function d(){return o().toString()+u(2147483647*Math.random()|0,10)}function g(e){var t;CrossTab.supported||i(),t={data:e,origin:n},s("__CROSSTAB",t)}this.on=function(e,t){r[e]=t},this.setId=function(e){n=e},this.getId=function(){return n},this.broadcast=g,this.init=function(){CrossTab.supported=!!localStorage&&window.addEventListener,CrossTab.supported?(n=d(),window.addEventListener("storage",a,!1),window.addEventListener("beforeunload",l,!1),window.addEventListener("DOMContentLoaded",c,!1)):CrossTab.broadcast=i}}chatTabSync.$inject=["Storage","Utils","SystemEvents"];function chatTabSync(e,t,n){var r,i,o,a,s=CHAT_APP.Constants.GENERAL_CONSTANTS,c=!!window.SharedWorker,l=!!window.localStorage;function u(e,t){try{i.port.postMessage({origin:r,data:angular.extend(t,{type:e})})}catch(n){}}function d(e,t){try{o.broadcast(angular.extend(t,{type:e}))}catch(n){}}function g(){r=t.getUniqueID("t"),i=new SharedWorker(s.SHARED_WORKER_PATH),i.port.addEventListener("message",function(e){var i=e.data;i.origin!==r&&t.triggerCustomEvent(n.CHAT.TAB_SYNC_NEW_DATA,i.data)},!1),i.port.start()}function E(){o=new CrossTab,o.init(),r=o.getId(),o.on("message",function(e){e.origin!==r&&t.triggerCustomEvent(n.CHAT.TAB_SYNC_NEW_DATA,e.data)})}function m(e,t){a&&a.call(this,e,t)}function T(){c?(g(),a=u):l?(E(),a=d):a=function(){}}return{init:T,sendData:m}}var chatApp=angular.module("ringid.chat");chatApp.service("ChatWorkerCommands",ChatWorkerCommands),ChatWorkerCommands.$inject=["ChatConnector"];function ChatWorkerCommands(e){function t(e){return!!e}this.startChatSession=n;function n(n,r,i){t(r)&&e.sendCommand("START_CHAT_SESSION",{id:n,type:r,utIds:i})}this.endChatSession=r;function r(n,r){t(r)&&e.sendCommand("END_CHAT_SESSION",{id:n,type:r})}this.sendAuthRequest=i;function i(t,n){e.sendCommand("SEND_AUTH_REQUSET",{object:t,type:n||"send"})}this.sendTagChatMemberAddAuthRequest=o;function o(t){e.sendCommand("SEND_TAG_CHAT_MEMBER_ADD_AUTH_REQUEST",{object:t,type:"send"})}this.doGetChatHistoryMessages=a;function a(t,n,r,i,o){e.sendCommand("FETCH_HISTORY_MESSAGE",{id:t,type:i,pageDirection:n,limit:r,packetId:o})}}var app=angular.module("ringid.chat");app.factory("ChatRoomFactory",ChatRoomFactory),ChatRoomFactory.$inject=["$$stackedMap","ChatRoomModel","ChatMessageMap","userFactory"];function ChatRoomFactory(e,t,n,r){var i=e.createNew("asc",!0),o=!1;function a(e){var n;n=t.create(e.roomId,e.roomName,e.roomUrl,e.noOfMember),e.messages&&l(n,e.messages),i.save(e.roomId,n)}function s(e,t){var n=t;return n||(n=i.get(e.roomId)),n?(n.update(e.roomId,e.roomName,e.roomUrl,e.noOfMember),n):{}}function c(e,t){var n=i.get(e);n||a(t)}function l(e,t){var r;t.forEach(function(t){t.public_chat=!0,r=n.create(t,t.userId),e.addMessage(r)})}function u(e){i["delete"](e)}function d(e){return i.get(e)}function g(){return i.all()}function E(){o=!0}function m(){return!o}function T(e){var t=r.create({futId:e.userId});t.hasDetails()||(t.setName(e.fullName),t.setProfileImage(e.memberUrl))}return{add:a,update:s,addOrUpdate:c,remove:u,get:d,getRooms:g,hasMoreRooms:m,setNoMoreRooms:E,addMessages:l,getUserMapObjectFromRawUserObject:T}}var app=angular.module("ringid.chat");app.factory("ChatRoomCategoryFactory",ChatRoomCategoryFactory),ChatRoomCategoryFactory.$inject=["$$stackedMap","ChatRoomCategoryModel"];function ChatRoomCategoryFactory(e,t){var n=e.createNew("asc",!0),r=!1;function i(e){var r;r=t.create(e.roomName),n.save(e.name,r)}function o(e,t){var r=t;return r||(r=n.get(e.name)),r?(r.update(e.roomName),r):{}}function a(e,t){var r=n.get(e);r||i(t)}function s(e){n["delete"](e)}function c(e){return n.get(e)}function l(){return n.all()}function u(){r=!0}function d(){return!r}return{add:i,update:o,addOrUpdate:a,remove:s,get:c,getRoomCategories:l,hasMoreRooms:d,setNoMoreRooms:u}}angular.module("ringid.chat").factory("tagChatFactory",tagChatFactory),tagChatFactory.$inject=["$$stackedMap","$$connector","userFactory","friendsFactory","Auth","Utils","tagChatModels"];function tagChatFactory(e,t,n,r,i,o,a){var s=CHAT_APP.Constants,c=CHAT_APP.SharedHelpers,l=s.GENERAL_CONSTANTS,u=s.PACKET_CONSTANTS,d={},g=e.createNew(!0),E=!0;return{createNewTag:_,createNewTagMember:I,createNewTagMessage:h,createTagStatusMessage:A,addTagObject:S,removeTagObject:p,getTags:T,getTag:f,generateNewTagId:m,getOrCreateTag:v,getOrCreateMessage:D,updateTag:M,getTagLastMessageObject:C,setTagChatInitiator:O,resetTagChatInitiator:R,isTagChatInitiator:N,startProcessingRequest:E};function m(){var e=i.currentUser().getUId().toString(),t=(new Date).getTime().toString(),n=t.substr(0,u.TAG_ID_NO_OF_TIME_DIGIT);return n+=e.substr(e.length-u.TAG_ID_NO_OF_USER_ID_DIGIT)}function T(){return g}function f(e){return g.get(e)}function p(e){return g.remove(e)}function _(e,t){var n=t;return n||(n=new a.TagObject),e.tagId?n.setTagId(e.tagId):n.setTagId(m()),e.packetId&&n.setPacketId(e.packetId),e.userId&&n.setUserId(e.userId),e.tagName&&n.setTagName(e.tagName),e.tagPictureUrl&&n.setPictureUrl(e.tagPictureUrl),e.serverDate&&n.setServerDate(e.serverDate),e.tagMembersCount&&n.setMembersCount(e.tagMembersCount),e.tagMembersLength&&n.setMembersCount(e.tagMembersLength),n}function I(e,t){var n=new a.TagMember;return e&&n.setTagId(e),t&&(t.utId&&n.setId(t.utId),t.userId&&n.setUserId(t.userId),t.fullName&&n.setFullName(t.fullName),t.addedBy&&n.setAddedBy(t.addedBy),t.status?n.setStatus(t.status):n.setStatus(l.MEMBER_STATUS.MEMBER)),n}function h(e,t){var n=new a.TagMessage;return e&&n.setTagId(e),t&&(t.userId&&n.setUserId(t.userId),t.user&&n.setUserId(t.user),t.fullName&&n.setFullName(t.fullName),t.message&&n.setMessageText(t.message),t.hrtime&&n.setHumanReadableTime(t.hrtime),t.messageDate&&n.setMessageDate(t.messageDate),t.isDeleted&&n.markAsDeleted(t.isDeleted),t.messageDateString&&n.setMessageDateString(t.messageDateString),t.timeout&&n.setTimeout(t.timeout),t.messageType&&n.setMessageType(t.messageType),t.status&&n.setStatus(t.status),t.packetId&&n.setPacketId(t.packetId),t.usersToChange&&n.setUsersToChange(t.usersToChange),t.usersToChangeName&&n.setUsersToChangeName(t.usersToChangeName),t.statusType&&n.setStatusType(t.statusType),t.tagName&&n.setTagName(t.tagName)),n}function A(e,t,r,i,o,a){var s,l,u,d,g,E,m={},T=f(t);if(T){if(s=a.messageDate?a.messageDate:c.getChatServerCurrentTime(),l=n.getUser(r),u="",l&&""!==l.getName()&&(u=l.getName()),m={message:"",fullName:u,status:"status_update",statusType:i,tagName:a?a.tagName:"",messageDate:s,messageType:2,tag_chat:!0,userId:r,user:r,packetId:e},m.usersToChange={},o.length>0)for(d=0;d<o.length;d++)g=o[d],m.usersToChange[g.userId]=!0;return E=h(t,m)}return!1}function C(e){var t={key:e.key,text:e.text,messageType:e.messageType,messageDate:e.messageDate};return t}function S(e){var t,n;return e instanceof a.TagObject?(t=g.get(e.getTagId()),t?t.update(e):g.add(e.getTagId(),e)):n=!1,n}function v(e,t){var n,r=t;return r||(r={tagId:e}),n=f(e),n=n?_(r,n):_(r),g.save(e,n),n}function M(e,t,n){var r=n;return r||(r=f(e)),r=_(t,r),g.save(e,r),r}function D(e,t){var n,r,i,o=t,a={tagId:e};return o||(o={tagId:e}),n=f(e),n||(n=_(a),g.save(e,n)),i=h(e,o,!0),r=n.getMessage(o.packetId),r?r.update(i):(r=i,n.addMessage(r)),r}function O(e){d[e]=!0,setTimeout(function(){d[e]=!1},l.API_FETCH_RETRY_DELAY)}function R(e){d[e]=!1}function N(e){return!!d[e]}}angular.module("ringid.chat").factory("tagChatHelper",tagChatHelper),tagChatHelper.$inject=["CHAT_LANG","Auth","tagChatFactory","userFactory"];function tagChatHelper(e,t,n,r){var i=CHAT_APP.Constants,o=i.GENERAL_CONSTANTS,a=e.TAG;return{getTagChatStatusMessage:l,getTagEmptyMessageObject:u};function s(e){var t;return e===o.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD?t="member":e===o.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD&&(t="admin"),t}function c(e,t){var n,i,o=e.getMember(t);return o?n=o.getName():(i=r.getUser(t),n=i&&""!==i.getName()?i.getName():t),n}function l(e){var i,l,u,d,g,E,m,T,f,p=t.currentUser(),_="",I="",h="",A=e.fullName,C=e.tagName,S=[],v=0,M={},D=a.STATUS_MESSAGES;if(u=e.tagId,E=n.getOrCreateTag(u),f=p.getKey()===e.userId.toString(),E){switch(A||(A=c(E,e.userId)),e.usersToChange.length>0&&(i=e.usersToChange.length-1,e.usersToChange.forEach(function(e){d=r.getUser(e),d&&""!==d.getName()?(S.push(d.getName()),v++):(g=c(E,e),S.push(g))}),v===e.usersToChange.length&&(e.allStatusUserFetched=!0),I=S.length>0?S[0]:e.usersToChange[0],h=S.slice(1).join(", ").replace('"',"'")),M={},D=a.STATUS_MESSAGES,e.statusType){case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:case o.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:T=s(e.statusType),M.member_name=A,M.new_member_name=I===p.getName()?"you":I,M.new_member_type=T,M.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(h,i),m=f?i?D.SELF_ADD_MULTIPLE_MEMBER:D.SELF_ADD_MEMBER:i?D.OTHER_ADD_MULTIPLE_MEMBER:D.OTHER_ADD_MEMBER;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE:M.member_name=A,M.old_member_name=I===p.getName()?"you":I,M.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(h,i),m=f?i?D.SELF_REMOVE_MULTIPLE_MEMBER:I===A?D.SELF_LEAVE_GROUP:D.SELF_REMOVE_MEMBER:i?D.OTHER_REMOVE_MULTIPLE_MEMBER:I===A?D.OTHER_LEAVE_GROUP:D.OTHER_REMOVE_MEMBER;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_LEAVE:M.member_name=A,m=f?D.SELF_LEAVE_GROUP:D.OTHER_LEAVE_GROUP;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:M.member_name=A,M.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(h,i),I!==p.getName()?M.old_member_name=I:M.old_member_name="you",m=f?i?D.SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:D.SELF_MEMBER_CHANGE_TO_ADMIN:i?D.OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:D.OTHER_MEMBER_CHANGE_TO_ADMIN;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:M.admin_name=A,I!==p.getName()?M.old_admin_name=I:M.old_admin_name="you",M.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(h,i),m=f?i?D.SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:I===A?D.SELF_REMOVED_FROM_ADMIN_BY_SELF:D.SELF_ADMIN_CHANGE_TO_MEMBER:i?D.OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:I===A?D.OTHER_REMOVED_FROM_ADMIN_BY_SELF:D.OTHER_ADMIN_CHANGE_TO_MEMBER;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER:M.member_name=A,M.admin_name=I,m=I!==p.getName()?D.OTHER_USER_ADDED_AS_OWNER:D.SELF_USER_ADDED_AS_OWNER;break;case o.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:M.member_name=A,M.group_name=C,m=f?D.SELF_UPDATE_GROUP_INFO:D.OTHER_UPDATE_GROUP_INFO;break;case o.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE:M.member_name=A,M.group_name=C,m=f?D.SELF_RENAME_GROUP:D.OTHER_RENAME_GROUP;break;case o.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE:M.member_name=A,M.group_name=C,m=f?D.SELF_CHANGE_GROUP_PIC:D.OTHER_CHANGE_GROUP_PIC}m&&(_=m.supplant(M)),l=_}else l=null;return l}function u(e){var r,i,a=t.currentUser();return r={tagId:e,userId:a.getKey(),fullName:a.getName(),message:" ",messageDate:(new Date).getTime(),messageType:o.MESSAGE_TYPES.BLANK_MESSAGE,packetId:CHAT_APP.UTILS.getUUIDPacketId()},i=n.createNewTagMessage(e,r)}}angular.module("ringid.chat").factory("tagChatManager",tagChatManager),tagChatManager.$inject=["$$connector","$q","$timeout","Auth","CHAT_LANG","tagChatFactory","ChatWorkerCommands","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","ChatUtilsFactory","ChatConnector","SystemEvents"];function tagChatManager(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I){var h=CHAT_APP.Constants,A=CHAT_APP.SharedHelpers,C=h.GENERAL_CONSTANTS,S=h.OFFLINE_PACKET_TYPE,v=CHAT_APP.AuthRequests,M=CHAT_APP.ChatRequests,D=CHAT_APP.UTILS.callXTimeAfterYIntervalStopOnSuccess;function O(e){var n,i,s,c,l=r.currentUser(),u=t.defer();return e.tagMembersCount=e.memberList.length+e.adminList.length+1,n=o.createNewTag(e),i={userId:l.getUId(),utId:l.getKey(),addedBy:l.getKey(),status:C.MEMBER_STATUS.OWNER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s),e.memberList.forEach(function(e){n.addMember(e)}),e.adminList.forEach(function(e){n.addMember(e)}),n.setObjectLock(),o.addTagObject(n),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:n.getTagId()}),c=M.getOfflineTagCreateTagObject(n.getTagId(),n.getTagName(),n.getPictureUrl(),n.getSerializedMembers()),c.brokenPacketType=S.OFFLINE_BROKEN_PACKET,_.request(c).then(function(e){n.removeObjectLock(),e.sucs?(u.resolve(e),a.startChatSession(n.getTagId(),C.SESSION_TYPES.TAG,n.getMemberUtIds())):e.error?u.error(e):u.reject(e)}),u.promise}function R(e){var n,i,s,c,l,u,d,E,m,T,f=r.currentUser(),p=t.defer();for(e.tagMembersCount=e.memberUIds.length+e.adminUIds.length+1,n=o.createNewTag(e),i={userId:f.getKey(),ringId:f.getUId(),addedBy:f.getKey(),status:C.MEMBER_STATUS.OWNER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s),l=0;l<e.memberUIds.length;l++)u=e.memberUIds[l],i={userId:u,addedBy:f.getKey(),status:C.MEMBER_STATUS.MEMBER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s);for(d=0;d<e.adminUIds.length;d++)E=e.adminUIds[d],c={userId:E,addedBy:f.getKey(),status:C.MEMBER_STATUS.ADMIN},m=o.createNewTagMember(n.getTagId(),c,!0),n.addMember(m);return n.setObjectLock(),o.addTagObject(n),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:n.getTagId()}),e.uIds=e.adminUIds.concat(e.memberUIds),T=M.getOfflineTagCreateTagObject(n.getTagId(),n.getTagName(),n.getPictureUrl(),n.getSerializedMembers()),T.brokenPacketType=S.OFFLINE_BROKEN_PACKET,_.request(T).then(function(e){n.removeObjectLock(),e.sucs?(p.resolve(e),a.startChatSession(n.getTagId(),C.SESSION_TYPES.TAG,n.getMemberUtIds())):e.error?p.error(e):p.reject(e)}),p.promise}function N(e,t,n){var i,a,s,c,l,u,g,E,m,T,f=r.currentUser(),p=[],_=[],I=[],h=[],A=[],S=[],v={},M={},D={};for(i=e.getMembersObjectMap().copy(),a=i,s=a.all(),angular.forEach(t,function(e){v[e]=!0}),angular.forEach(n,function(e){M[e]=!0}),T=0;T<s.length;T++)c=s[T].value,D[c.getId()]=!0,c.isOwner()||(M[c.getId()]||v[c.getId()]?(l=!1,c.isAdmin()?v[c.getId()]&&(c.makeMember(),l=!0):c.isMember()&&M[c.getId()]&&(c.makeAdmin(),l=!0),l&&(_.push(c.serialize()),S.push(c))):(p.push(c.serialize()),A.push(c)));return angular.forEach(t,function(t){D[t]||t===f.getKey()||(u=d.getUser(t),g=o.createNewTagMember(e.getTagId(),{utId:u.getUtId(),userId:u.getUId(),addedBy:f.getKey(),fullName:u.getName(),status:C.MEMBER_STATUS.MEMBER},!0),h.push(g),I.push(g.serialize()))}),angular.forEach(n,function(t){D[t]||t===f.getKey()||(E=d.getUser(t),m=o.createNewTagMember(e.getTagId(),{utId:E.getUtId(),userId:E.getUId(),addedBy:f.getKey(),fullName:E.getName(),status:C.MEMBER_STATUS.ADMIN},!0),h.push(m),I.push(m.serialize()))}),{serializedMemberAdminsToRemove:p,serializedMemberAdminsToStatusChange:_,serializedNewMemberAdminsToAdd:I,membersAdminToAddOnSuccess:h,membersAdminToRemoveOnSuccess:A,membersAdminToUpdateOnSuccess:S}}function P(e,n,i){var o,c,l,u=r.currentUser(),d=t.defer();return n.length>0?(c=M.getTagChatTagMemberAddObject(e.getTagId(),n),o=A.getChatServerCurrentTime(),_.request(c).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.addMember(t)}),e.setMembersCount(e.getMembersCount()+i.length),s.showTagMembersAddStatusMessage(e.getTagId(),u.getKey(),n,o,!1,t.packetId),l=n.keyValues("userId"),c=v.getTagChatMembersAddObject(e.getTagId(),l),a.sendTagChatMemberAddAuthRequest(c),d.resolve({sucs:!0,mg:"Member( "+i.length+" ) Added in "+e.getTagName()}))},function(){d.reject({sucs:!1,mg:"Unable to send tag new member add packet to chat server."})})):d.resolve({sucs:!1}),d.promise}function y(e,n,i){var o,a,c=r.currentUser(),l=t.defer();return n.length>0?(a=A.getChatServerCurrentTime(),o=M.getTagChatMemberRemoveLeaveObject(e.getTagId(),n),_.request(o).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.removeMember(t)}),e.setMembersCount(e.getMembersCount()-i.length),s.showTagMembersRemoveStatusMessage(e.getTagId(),c.getKey(),n,a,t.packetId),l.resolve({sucs:!0,mg:"Member( "+i.length+" ) Removed from "+e.getTagName()}))},function(){l.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."})})):l.resolve({sucs:!1}),l.promise}function b(e,n,i){var o,a,c=r.currentUser(),l=t.defer();return o=A.getChatServerCurrentTime(),n.length>0?(a=M.getTagChatTagMemberTypeChangeObject(e.getTagId(),n),_.request(a).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.updateMember(t)}),s.showMemberTypeChangeStatusMessage(e.getTagId(),c.getKey(),n,o,!1,t.packetId),l.resolve({sucs:!0,mg:"Member( "+i.length+" ) Status Updated for "+e.getTagName()}))},function(){l.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."})})):l.resolve({sucs:!1}),l.promise}function U(e,n,i){var o,a,c,l=r.currentUser(),u=t.defer(),d=e.getTagName(),g=e.getPictureUrl(),E=e.getTagName()!==n,m=e.getPictureUrl()!==i,T=E||m;return T?(o=s.getTagInfoChangeStatusMessage(e.getTagId(),{tagName:n||"",tagPictureUrl:i||""}),E&&(e.setTagName(n),c=C.TAG_ACTIVITY_TYPE.TAG_RENAME,a=M.getTagChatTagInformationObject(e.getTagId(),c,n,g),_.request(a).then(function(t){t.sucs&&(s.showTagInfoChangeStatusMessage(e.getTagId(),l.getKey(),{statusMessageType:o,tagName:n},!1),m||u.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(){E&&e.setTagName(d),u.reject({sucs:!1,mg:"Unable to send tag info tag name change packet to chat server."})})),m&&(e.setPictureUrl(i),c=C.TAG_ACTIVITY_TYPE.TAG_URL_RENAME,a=M.getTagChatTagInformationObject(e.getTagId(),c,d,i),_.request(a).then(function(t){t.sucs&&(s.showTagInfoChangeStatusMessage(e.getTagId(),l.getKey(),{statusMessageType:o,tagName:n},!1),u.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(){m&&e.setPictureUrl(g),u.reject({sucs:!1,mg:"Unable to send tag info tag picture url packet to chat server."})}))):u.resolve({sucs:!1}),u.promise}function L(e,n,r,i,o){var a,s,c,l,u,d,E,m,T=t.defer();return a=N(e,i,o),s=a.serializedNewMemberAdminsToAdd,c=a.membersAdminToAddOnSuccess,l=a.serializedMemberAdminsToRemove,u=a.membersAdminToRemoveOnSuccess,d=a.serializedMemberAdminsToStatusChange,E=a.membersAdminToUpdateOnSuccess,m=0,P(e,s,c).then(function(e){e.sucs&&(m++,T.notify(e))},T.reject),y(e,l,u).then(function(e){e.sucs&&(m++,T.notify(e))},T.reject),b(e,d,E).then(function(e){e.sucs&&(m++,T.notify(e))},T.reject),U(e,n,r).then(function(e){e.sucs&&(m++,T.notify(e))},T.reject),setTimeout(function(){m?T.resolve({sucs:!0}):T.reject({sucs:!1})},18e3),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()}),T.promise}function F(e){var t=o.getTag(e),n=t.getMember(r.currentUser().getKey());return k(e,[n.serialize()],[n])}function k(e,n,i){var a,s,c,l,u,d=r.currentUser(),E=t.defer(),m=o.getTag(e);return a=M.getTagChatMemberRemoveLeaveObject(e,n),_.request(a).then(function(t){if(t.sucs){for(m=o.getTag(e),s="Member( "+i.length+" ) Removed from "+m.getTagName(),c=!1,l=0;l<i.length&&(u=i[l],u.getId()===d.getKey()&&(s="You left from `"+m.getTagName()+"` chat group.",o.removeTagObject(e),c=!0,E.resolve({sucs:!0,mg:s})),!c);l++)m.removeMember(u);c||E.resolve({sucs:!0,mg:s})}},function(){E.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."})}),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e}),E.promise}function w(e,n,r){var i,a=t.defer(),s=o.getTag(e);return i=M.getTagChatTagMemberTypeChangeObject(e,n),_.request(i).then(function(e){e.sucs&&(angular.forEach(r,function(e){s.updateMember(e)}),a.resolve({sucs:!0,mg:"Member( "+n.length+" ) Status Updated for "+s.getTagName()}))},function(){a.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."})}),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e}),a.promise}function G(e){D(function(){var t,n=o.getTag(e);n&&n.isTagSafeToShow()&&(t=l.getBoxByUtId(e),B(e,t))},function(){var t=o.getTag(e);return!(!t||!t.isTagSafeToShow())},function(){},5,5e3)}function B(e,t){var n,r=t;return r||(n=o.getOrCreateTag(e),n.isTagSafeToShow()?(l.openTagChatBox(e),r=l.getBoxByUtId(e),r.setTitle(n.getTagName())):r=l.createNonDomBox(e,!0,!1),r.setTitle(n.getTagName())),r}return{createTag:R,createTagNew:O,updateTag:L,leaveFromTag:F,removeTagMembers:y,removeTagMember:k,changeTagMemberStatus:w,updateTagInformation:U,openTagChatBoxIfClosed:B,openPreviouslyOpenedBoxes:G}}angular.module("ringid.chat").factory("tagChatStorage",tagChatStorage),tagChatStorage.$inject=["Storage","Auth","Utils"];function tagChatStorage(e,t,n){var r={packets:{}};function i(){return"tagc-store-"+t.currentUser().getKey()}function o(t){e.setData(i(),angular.toJson(t))}function a(e,t){r.packets[e]=n.arrayBuffer2String(t.buffer.slice(6)),o(r)}function s(e){return n.string2ArrayBuffer(r.packets[e])}function c(){return r.packets}return t.isLoggedIn(),{savePacket:a,getPacket:s,getAllPackets:c}}angular.module("ringid.chat").factory("tagChatUI",tagChatUI),tagChatUI.$inject=["ChatFactory","Utils","chatHistoryFactory","tagChatFactory"];function tagChatUI(e,t,n,r){var i=CHAT_APP.Constants,o=i.GENERAL_CONSTANTS;return{getTagInfoChangeStatusMessage:l,showTagInfoChangeStatusMessage:u,showMemberTypeChangeStatusMessage:c,showTagMembersAddStatusMessage:d,showTagMembersRemoveStatusMessage:g};function a(e){var t;return t="admin"===e?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:"member"===e?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER}function s(e){var t,n,r,i={};for(r=0;r<e.length;r++)t=e[r],n=angular.isString(t.status)?a(t.status):t.status,i[n]||(i[n]=[]),i[n].push(t);return i}function c(t,i,a,c,l,u){var d,g,E,m,T,f=e.getBoxByUtId(t),p=s(a),_=u,I={};c&&(_=CHAT_APP.UTILS.getUUIDPacketId(c,!0),I.messageDate=c),d=1;for(m in p)if(p.hasOwnProperty(m)){if(d||(_=_+"_"+d),E="",m=parseInt(m,10),E=m===o.MEMBER_STATUS.ADMIN?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:m===o.MEMBER_STATUS.MEMBER?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER,g=r.createTagStatusMessage(_,t,i,E,p[m],I),!g)continue;T=g.serialize(),f?(T.fromHistory=l,f.pushMessage(T,i)):n.addMessage(T,t)}}function l(e,t,n){var i,a=n;return a||(a=r.getTag(e)),i=0,a&&(t.tagName&&t.tagPictureUrl&&a.getTagName()!==t.tagName&&a.getPictureUrl()!==t.tagPictureUrl.trim()?i=o.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:(t.tagName&&a.getTagName()!==t.tagName&&(i=o.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE),t.tagPictureUrl&&a.getPictureUrl()!==t.tagPictureUrl.trim()&&(i=o.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE))),i}function u(t,i,o,a,s,c){var u,d,g,E,m=c,T=s;if(m||(m=r.getTag(t)),T||(T=CHAT_APP.UTILS.getUUIDPacketId()),u=o.statusMessageType,u||(u=l(t,o,m)),o.messageDate&&(T=CHAT_APP.UTILS.getUUIDPacketId(o.messageDate,!0)),0!==u){if(d=e.getBoxByUtId(t),E=r.createTagStatusMessage(T,t,i,u,[],o),!E)return;g=E.serialize(),d?(g.fromHistory=a,d.pushMessage(g,i)):n.addMessage(g,t)}}function d(t,i,a,c,l,u,d){var g,E,m,T,f,p,_,I,h=d;h||(h=r.getTag(t)),g=e.getBoxByUtId(t),E=s(a),_={},c&&(_.messageDate=c);for(m in E)if(E.hasOwnProperty(m)){if(T=u+"_"+m,f="",m=parseInt(m,10),m===o.MEMBER_STATUS.ADMIN?f=o.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:m===o.MEMBER_STATUS.MEMBER?f=o.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:m===o.MEMBER_STATUS.OWNER&&(f=o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER),p=r.createTagStatusMessage(T,t,i,f,E[m],_),!p)continue;I=p.serialize(),g?(I.fromHistory=l,g.pushMessage(I,i)):n.addMessage(I,t)}}function g(t,i,a,s,c,l,u){var d,g,E,m,T,f,p=u,_=l;for(p||(p=r.getTag(t)),_||(_=CHAT_APP.UTILS.getUUIDPacketId(s,!0)),d=e.getBoxByUtId(t),g=0;g<a.length;g++)E=p.getMember(a[g].userId),E&&(a[g].fullName=E.getName());m={},s&&(m.messageDate=s,_=CHAT_APP.UTILS.getUUIDPacketId(s,!0)),f=r.createTagStatusMessage(_,t,i,o.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE,a,m),f&&(T=f.serialize(),d?(T.fromHistory=c,d.pushMessage(T,i)):n.addMessage(T,t))}}angular.module("ringid.chat").factory("chatRequestProcessor",chatRequestProcessor),chatRequestProcessor.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","CHAT_LANG","ChatUtilsFactory","ChatConnector"];function chatRequestProcessor(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p){var _=window.CHAT_APP,I=_.Constants,h=I.CHAT_GLOBAL_VALUES,A=_.ChatRequests,C=_.PublicChatRequests,S=_.SharedHelpers;function v(){var e=h.offlineUpdateTime,t=S.getChatServerCurrentTime(),n=A.getOfflineGetRequestObject(e,0);p.request(n).then(function(e){e.sucs&&(h.offlineUpdateTime=t)})}function M(e,t,n,r){var i=_.UTILS.getUUIDPacketId(),o=A.getConversationRequestObject(e,t,n,r,i);p.request(o).then(function(e){})}function D(){var e=_.UTILS.getUUIDPacketId(),t=A.getUnreadCountObject(e);p.request(t).then(function(e){})}function O(e,t,n,r){var i=n||_.UTILS.getUUIDPacketId(),o=r||10,a=A.getOfflineTagHistoryMessageRequestObject(e,t,o,i);return p.request(a)}function R(e,t,n,r,i,o){var a=n||_.UTILS.getUUIDPacketId(),s=r||10,c=C.getPublicChatGetHistoryObject(e,i,o,t,s,a);return p.request(c)}function N(e,t,n,r){var i=n||_.UTILS.getUUIDPacketId(),o=r||10,a=A.getOfflineFriendHistoryMessageRequestObject(e,t,o,i);return p.request(a)}function P(e,t){var n=A.getOfflineTagUnreadMessageConfirmationObject(t);p.send(n)}function y(e,t,n){var r=A.getOfflineFriendUnreadMessageConfirmationObject(n,t);p.send(r)}function b(e){var t;return t=e.isTagChat?O:e.isPublicChat?R:N}function U(e){var t=A.getOfflineFriendInformationObject(e.getUtId(),e.getName(),e.getOnlineStatus(),e.getPlatform(),e.getAppType()||1,e.getDeviceToken(),e.getUserMood(),0);p.send(t)}return{getUnreadMessagesMultipleTimes:v,getConversationRequest:M,getUnreadCount:D,getTagHistoryMessagesMultipleTimes:O,getFriendHistoryMessagesMultipleTimes:N,getPublicChatHistoryMessagesMultipleTimes:R,getHistoryRequestMethodByBox:b,sendTagUnreadMessageConfirmation:P,sendFriendUnreadMessageOfflineConfirmation:y,
sendFriendInformation:U}}var chatApp=angular.module("ringid.chat");chatApp.factory("ChatResponseProcessor",ChatResponseProcessor),ChatResponseProcessor.$inject=["tagChatFactory","Auth","ChatFactory","chatHistoryFactory","CHAT_LANG","Utils","tagChatUI"];function ChatResponseProcessor(e,t,n,r,i,o,a){var s=window.CHAT_APP.Constants,c=s.GENERAL_CONSTANTS;function l(e,t,i,o){var a=n.getBoxByUtId(e);return a||(n.createNonDomBox(e,i,o),a=n.getBoxByUtId(e),a.nonDomBox=t||!1,r.updateBox(a)),a}function u(){}function d(e){var t=c.MESSAGE_STATUS_VALUE[e];return t&&(t=t.charAt(0)+t.substr(1).toLowerCase()),t}function g(e,o,a,s,l){var u,d=l,g=!1;d||(d=n.getBoxByUtId(e)),o===t.currentUser().getKey()?(d&&d.removeMessage(a),r.removeMessage(a,e)):(u=d?d.getMessage(a):r.getMessage(e,a),u||(u=s,g=!0),u.messageType=c.MESSAGE_TYPES.DELETE_MESSAGE,u.message=i.CHAT.MESSAGE_DELETE_TEXT,u.status="Deleted",d?g&&d.pushMessage(u,o):r.updateMessage(u,e))}function E(e,n){var r;return r=e===t.currentUser().getKey()?n:e}function m(e,t){return l(e,t,!1)}function T(e,t){t&&("Seen"!==t.status&&"Deleted"!==t.status&&"Viewed"!==t.status&&"Played"!==t.status&&(t.status="Delivered",t.statusText="Delivered"),r.updateMessage(t,e))}function f(e){u(e)}function p(t,n,r){var i,o=r;return o||(o=e.getTag(t)),i=l(t,n,!0),o&&i.setTitle(o.getTagName()),i}function _(e){u(e)}function I(t){var n,r=t.userId,i=t.tagId,o=t.tagMembers,s=t.packetId,c=t.messageDate||null;n=e.getOrCreateTag(i),a.showTagMembersAddStatusMessage(i,r,o,c,t.fromHistory,s,n),n&&!t.fromHistory&&R(n,o,r)}function h(t){var n,r,i=t.userId,o=t.tagId,s=t.tagMembers,c=t.packetId,l=t.messageDate||null;delete t.packetId,n=e.getOrCreateTag(o),a.showTagMembersRemoveStatusMessage(o,i,s,l,t.fromHistory,c,n),t.fromHistory||(r=N(n,s),r&&(O(o),_(o)))}function A(t){var n,r=t.tagId,i=e.getTag(r);i?(a.showTagInfoChangeStatusMessage(r,t.userId,t,t.fromHistory),t.fromHistory||(n=e.updateTag(r,t,i))):t.fromHistory||(n=e.createNewTag(t),e.addTagObject(n))}function C(t){var n,r=t.userId,i=t.tagId,o=t.tagMembers,s=t.packetId,c=t.messageDate||null;n=e.getOrCreateTag(i),a.showMemberTypeChangeStatusMessage(i,r,o,c,t.fromHistory,s),t.fromHistory||P(n,o)}function S(e){var t=p(e.tagId);t.updateBoxMessageMinMaxPacketId(e)}function v(e){var t=p(e.tagId);t.updateBoxMessageMinMaxPacketId(e)}function M(e,t,n){if(n.changedByUserId===n.userId&&n.status===c.MEMBER_STATUS.OWNER)return void v({tagId:e});switch(n.activityType){case c.TAG_ACTIVITY_TYPE.DELETED:h({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case c.TAG_ACTIVITY_TYPE.ADDED:I({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status,fullName:n.activityValue}],fromHistory:n.fromHistory});break;case c.TAG_ACTIVITY_TYPE.LEAVE:h({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case c.TAG_ACTIVITY_TYPE.TAG_RENAME:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,fromHistory:n.fromHistory,statusMessageType:c.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE});break;case c.TAG_ACTIVITY_TYPE.MEMBER_TYPE_CHANGE:C({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status}],fromHistory:n.fromHistory});break;case c.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagPictureUrl:n.activityValue,fromHistory:n.fromHistory,statusMessageType:c.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE});break;case c.TAG_ACTIVITY_TYPE.TAG_CREATED:S({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,tagMembers:[],fromHistory:n.fromHistory})}}function D(e){var t,n,r=e.packetType,i=e.tagId,o=e.packetId,a=e.messageDate;try{n=angular.fromJson(e.message)}catch(s){return}t={changedByUserId:e.userId,userId:n.mId,status:n.mT,activityValue:n.n,activityType:r,activityDate:a,fromHistory:e.fromHistory||!1},M(i,o,t)}function O(e){var t=n.getBoxByUtId(e);t&&(n.closeChatBox(t.getKey()),r.removeOpenBox(t.getKey()))}function R(t,n,r){var i,o,a;for(i=0;i<n.length;i++)o=n[i],r&&(o.addedBy=r),o.utId=o.userId,o.userId=o.ringId,a=e.createNewTagMember(t.getTagId(),o,!1),a.isRemoved()||a.isLeaved()||t.addMember(a)}function N(e,t){var n,r,i=!1;for(n=0;n<t.length;n++)r=e.getMember(t[n].userId),r&&(i=r.isCurrentUser(),e.removeMember(r));return i}function P(e,t){var n,r,i;for(n=0;n<t.length;n++)r=t[n],e&&(i=e.getMember(r.userId),i&&i.setStatus(r.status))}return{doFriendUnregisterTask:f,getFriendBoxId:E,getFriendBox:m,updateMessageStatusToDelivered:T,doOnMessageTypeDeleteMessage:g,getMessageStatus:d,doTagUnregisterTask:_,getTagChatBox:p,processAGroupActivity:M,processGroupActivityMessage:D,addMembersToTagObject:R,removeMembersFromTagObject:N,updateMemberStatusInTagObject:P,processTagMemberAddUpdate:I,processTagMemberRemoveLeave:h,processTagInformation:A,processTagMemberStatusChange:C}}angular.module("ringid.chat").directive("rgImageCapture",rgImageCapture),rgImageCapture.$inject=["Utils","rgRecorderService"];function rgImageCapture(e,t){return{link:function(n){var r,i,o={CAPTURE:"Capture",RETAKE:"ReTake"};n.name="rgImageCapture",n.videoId=e.getUniqueID("rgRec"),n.showLoader=!0,n.media=null,n.errorText="",n.connected=!1,n.captureText=o.CAPTURE;function a(){return document.querySelector("#"+n.videoId)}r={text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser. Please use upgraded browser."}},i=t.getRecorderInstance(r),i.on("streamReady",function(e){n.showLoader=!1,n.connected=!0,n.$rgDigest();try{a().appendChild(e.media),n.media=e.media,e.media.play()}catch(t){}}),i.on("error",function(e){n.errorText=e.text,n.showLoader=!1,n.connected=!1,n.$rgDigest()}),n.connect=function(){n.showLoader=!0,n.connected=!1,i.openMedia({video:!0,audio:!1})},setTimeout(function(){n.connect()},500),n.doCapture=function(){var e;n.captureText===o.CAPTURE?(e=i.captureImage(),e&&(n.capturedMedia=e,n.captureText=o.RETAKE),n.media&&n.media.pause()):(n.capturedMedia=null,n.captureText=o.CAPTURE,n.media.play()),n.$rgDigest()},n.$on("$destroy",function(){i.destroy()})},templateUrl:"templates/partials/recorder/image.html"}}openBox.$inject=["ChatFactory","tagChatFactory","ChatRoomFactory","rgDropdownService","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"];function openBox(e,t,n,r,i,o,a,s,c){return{link:function(n,l,u){n.name="openBox";function d(l){var d,g,E,m=CHAT_APP.Constants.GENERAL_CONSTANTS,T=m.SESSION_TYPES,f=!!u.boxId&&u.boxId,p=!1,_=!1;f&&String(u.openChatBox)!==String(o.currentUser().getUtId())&&("true"===String(u.isTagChat)?_=!0:"true"===String(u.isPublicChat)&&(p=!0),i.safeDigest(n),r.close(l),g=!1,_?(d=t.getTag(f),d&&d.isTagSafeToShow()&&(g=!0,d=t.getTag(f),s.startChatSession(f,T.TAG,d.getMemberUtIds()),e.openTagChatBox(f))):p?(s.startChatSession(f,T.ROOM),e.openPublicChatBox(f)):(s.startChatSession(f,T.FRIEND),e.openChatBox(f)),E=e.getBoxByUtId(f),E&&(a.decreaseUnreadCount(E),g&&E.setTitle(d.getTagName())),i.safeDigest(n),c.$broadcast("focusOn",f),l.preventDefault(),l.stopPropagation())}l.on("click",d),n.$on("$destroy",function(){l.off("click",d)})}}}openChatBox.$inject=["ChatFactory","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope","ChatPacketSenderService"];function openChatBox(e,t,n,r,i,o,a){return{scope:{boxClose:"&"},link:function(s,c,l){s.name="openChatBox";function u(c){var u,d,g=l.openChatBox,E=CHAT_APP.Constants.GENERAL_CONSTANTS,m=E.SESSION_TYPES;g&&String(g)!==String(n.currentUser().getUtId())&&(t.safeDigest(s),e.openChatBox(g,!0),u=e.getBoxByUtId(g),1===u.getUser().friendshipStatus()?i.startChatSession(g,m.FRIEND):(d=n.getPermission(),1===d.ancht?i.startChatSession(g,m.FRIEND):(u=e.getBoxByUtId(g),u.blocked=!0)),u&&r.decreaseUnreadCount(u),l.shareData&&(s.boxClose(),a.sendMessage(u,"",15,JSON.parse(l.shareData))),o.$broadcast("focusOn",g),c.preventDefault(),c.stopPropagation())}c.on("click",u),s.$on("$destroy",function(){c.off("click",u)})}}}openTagChatBox.$inject=["ChatFactory","tagChatFactory","tagChatManager","Auth","$rootScope","ChatHelper","ChatWorkerCommands","ChatPacketSenderService"];function openTagChatBox(e,t,n,r,i,o,a,s){return{scope:{boxClose:"&"},link:function(n,c,l){n.name="openTagChatBox";function u(c){var u,d,g=CHAT_APP.Constants.GENERAL_CONSTANTS,E=g.SESSION_TYPES,m=l.openTagChatBox;m<=0||String(l.openChatBox)!==String(r.currentUser().getUtId())&&(u=t.getTag(m),d=e.openTagChatBox(m,!0),d.setTitle(u.getTagName()),l.shareData&&n.boxClose(),u&&u.isTagSafeToShow()&&u&&a.startChatSession(m,E.TAG,u.getMemberUtIds()),d&&o.decreaseUnreadCount(d),l.shareData&&(n.boxClose(),s.sendMessage(d,"",15,JSON.parse(l.shareData))),i.$broadcast("focusOn",m),c.preventDefault(),c.stopPropagation())}c.on("click",u),n.$on("$destroy",function(){c.off("click",u)})}}}makeVisibleChatBox.$inject=["ChatFactory"];function makeVisibleChatBox(e){return{link:function(t,n,r){t.name="makeVisibleChatBox";function i(i){t.rbox.value.isFocused=!0,e.makeVisibleChatBox(r.makeVisibleChatBox),n.parent().parent().children().eq(0).removeClass("blink"),i.preventDefault()}n.on("click",i),t.$on("$destroy",function(){n.off("click",i)})}}}showHiddenBoxes.$inject=["ChatFactory"];function showHiddenBoxes(e){return{link:function(t,n,r){t.name="showHiddenBoxes";function i(){e.openChatBox(r.openChatBox)}n.on("click",i),t.$on("$destroy",function(){n.off("click",i)})}}}function doCloseBox(e,t){t.doCloseChatBox(e.box.value.getKey()),e.box.value.isFullScreen&&e.box.value.closeFullScreen(),e.hideBoxSettings(),e.$parent.$digest()}closeBox.$inject=["ChatFactory"];function closeBox(e){return{restrict:"A",link:function(t,n){t.name="closeBox";function r(n){n.preventDefault(),n.stopPropagation(),t.box.value.isFullScreen||t.box.value.isMinimized?doCloseBox(t,e):(e.closeBox(t.box.value.getKey()),t.addAnimationEndCallbacks(doCloseBox,[t,e]),t.$parent.$rgDigest())}n.on("click",r),t.$on("$destroy",function(){n.off("click",r)})}}}minimizeBox.$inject=["ChatFactory","$rootScope"];function minimizeBox(e,t){return{restrict:"A",link:function(n,r){var i,o,a,s=n.box.value;n.name="minimizeBox";function c(){e.minimizeBox(s.getKey()),s.isMinimized=!1,n.addAnimationEndCallbacks(function(){s.isMinimized=!0,s.chatBoxClass=s.chatBoxClass.replace("chat-body-opened","chat-body")}),s.closeFullScreen(),n.hideBoxSettings()}function l(e){s.blinkOn&&!s.isMinimized?(a="blinkerOff",i="focusOn",o=s.getKey()):s.blinkOn&&s.isMinimized?(c(),a="blinkerOff",i="focusOn",o=s.getKey()):s.blinkOn||s.isMinimized?!s.blinkOn&&s.isMinimized&&(c(),i="focusOn",o=s.getKey()):(c(),i="focusOn",o=null),t.$broadcast(i,o),a&&n.$broadcast(a,s.getKey()),n.$digest(),e.stopPropagation()}r.on("click",l),n.$on("$destroy",function(){r.off("click",l)})}}}maximizeBox.$inject=["ChatFactory","$rootScope"];function maximizeBox(e,t){return{restrict:"A",link:function(n,r){n.name="maximizeBox";function i(r){n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey()),n.box.value.isMinimized&&e.maximizeBox(n.box.value.getKey()),n.$digest(),r.stopPropagation()}r.on("click",i),n.$on("$destroy",function(){r.off("click",i)})}}}fullScreenBox.$inject=["ChatFactory","$rootScope"];function fullScreenBox(e,t){return{scope:!1,restrict:"A",link:function(n,r){var i=n.box.value;n.name="fullScreenBox",i.toggleFullScreen=o;function o(){var t=i.isFullScreen;i.isFullScreen?c():(a(),n.setBoxBoundingRect(),n.$rgDigest(),n.addAnimationEndCallbacks(l,[])),e.fullscreenBox(i.getKey(),t),n.$parent.$rgDigest()}i.closeFullScreen=c,i.doFullScreen=l;function a(){document.body.className=document.body.className.trim()+" ringbox-opened"}function s(){document.body.className=document.body.className.replace("ringbox-opened","").trim()}function c(){s(),i.isFullScreen=!1,n.closeEmoticonPopup()}function l(){i.isFullScreen=!0,n.closeEmoticonPopup(),t.$broadcast("focusOn",i.getKey())}function u(e){e.preventDefault(),e.stopPropagation(),o()}r.on("click",u),n.$on("$destroy",function(){r.off("click",u)})}}}chatBoxBackgroundChooser.$inject=[];function chatBoxBackgroundChooser(){return{scope:!1,restrict:"A",link:function(e,t){e.name="chatBoxBackgroundChooser";function n(){e.box.value.showBoxBackgroundChooser=!e.box.value.showBoxBackgroundChooser,e.$parent.$rgDigest()}e.box.value.hideBoxBackgroundChooser=r;function r(){e.box.value.showBoxBackgroundChooser=!1}function i(e){e.preventDefault(),e.stopPropagation(),n()}t.on("click",i),e.$on("$destroy",function(){t.off("click",i)})}}}tagChatEdit.$inject=["ChatFactory","rgDropdownService"];function tagChatEdit(e,t){return{restrict:"A",link:function(e,t){e.name="tagChatEdit";function n(t){e.showDropdown=!e.showDropdown,t.stopPropagation()}t.on("click",n),e.$on("$destroy",function(){t.off("click",n)})},controller:["$scope","tagChatFactory","tagChatManager","Auth","Ringalert","$compile",function(e,n,r,i,o){e.showDropdown=!1,e.hasTagObjectLock=function(e){var t=n.getTag(e);return!!t&&t.hasObjectLock()},e.getTagDDControl=function(e){var t=n.getTag(e),r=t.getMember(i.loginData.utId);return{tagId:e,isOwner:!!r&&r.isOwner()}},e.tagMemberDDActions=a,e.tagMemberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html";function a(e){var a,s;switch(e.action){case"edit":case"view":t.close(e.event),a=function(){return{tagId:e.tagId}};break;case"delete":t.close(e.event),s=n.getTag(e.tagId),s.setObjectLock(),r.leaveFromTag(e.tagId,i.currentUser().getKey()).then(function(e){s.removeObjectLock(),o.show(e,"info")},function(e){s.removeObjectLock(),o.show(e,"error")})}return a}}]}}chatScrollBottom.$inject=["$scrollbar","Utils","SystemEvents","ChatHelper"];function chatScrollBottom(e,t,n,r){return{restrict:"A",link:function(i,o){var a,s,c={minThumbHeight:20,preserveBottom:!0,atBottom:!0,onScroll:u},l=e.create(o[0],c);i.name="chatScrollBottom";function u(){i.box.value.scrollbarAtBottom=l.atBottom}i.$on("ScrollToBottom",function(e,t){String(t)===String(i.box.value.getKey())&&(o[0].scrollTop=o[0].scrollHeight,e.preventDefault())}),i.bottomReached=function(){r.decreaseUnreadCount(i.box.value),i.$rgDigest()};function d(){i.refreshScrollbar(!0,function(){var e=o[0].querySelector(".status-unread-container");e?l.scrollBySelector(".status-unread-container",!0,!1,-2):l.scrollBottom(!0),e=null,i.$rgDigest()})}i.scrollbarFreezed=!1,i.freezeScrollbar=function(){i.scrollbarFreezed=!0,l.freeze()},i.refreshScrollbar=function(e,t){(i.scrollbarFreezed||e)&&(i.scrollbarFreezed=!1,l.reCalculate(!0).then(function(){i.scroll=l.hasScroll,t&&t.call(this)})),i.bottomScrolled||(i.bottomScrolled=!0,d())},a=t.onCustomEvent(n.CHAT.SCROLL_TO_BOTTOM,function(e){String(e.boxId)===String(i.box.value.getKey())&&i.refreshScrollbar(!0,function(){e.topAlign?l.scrollBySelector(".status-unread-container",!0,!0):l.scrollBottom(!0),i.$rgDigest()})}),s=t.onCustomEvent(n.CHAT.SCROLL_TO_UNREAD,function(e){String(e.boxId)===String(i.box.value.getKey())&&d()}),i.$on("$destroy",function(){t.removeCustomEvent(n.CHAT.SCROLL_TO_BOTTOM,a),t.removeCustomEvent(n.CHAT.SCROLL_TO_UNREAD,s),l.destroy()})}}}chatBlinker.$inject=["$window","chatHistoryFactory"];function chatBlinker(e,t){return{restrict:"A",link:function(e,n){e.name="chatBlinker",e.box.value.blinkOn===!0&&n.addClass("blink"),e.$on("blinkerEvent",function(r,i){i.toString()===e.box.value.getKey()&&(e.box.value.isMinimized?e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0):e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0),t.updateBox(e.box.value))}),e.$on("blinkerOff",function(r,i){i.toString()===e.box.value.getKey()&&(n.removeClass("blink"),e.box.value.blinkOn=!1,t.updateBox(e.box.value))}),e.$on("focusOn",function(t,r){r&&r.toString()===e.box.value.getKey()?n.addClass("chat-active"):(n.removeClass("chat-active"),e.box.value.isFocused=!1),e.$rgDigest()})}}}chatBlinkerH.$inject=["$window","chatHistoryFactory"];function chatBlinkerH(e,t){return{restrict:"A",link:function(e,n){e.name="chatBlinkH",e.$on("blinkerEvent",function(r,i){i.toString()===e.rbox.value.getKey()&&(n.addClass("blink"),n.parent().parent().children().eq(0).addClass("blink"),t.updateBox(e.rbox.value))})}}}chatSelectEmo.$inject=[];function chatSelectEmo(){return{restrict:"A",link:function(e){e.name="chatSelectEmo",e.selectEmoticon=function(t){e.messageText=e.messageText+t.symbol()}}}}chatBindOutsideClick.$inject=["$document","Utils"];function chatBindOutsideClick(e,t){return{restrict:"A",link:function(n,r){n.name="chatBindOutsideClick",r.bind("click",function(e){e.stopPropagation()}),e.bind("click",function(){n.showHidden=!1,t.safeDigest(n)})}}}sharedContent.$inject=["Utils"];function sharedContent(e){return{restrict:"A",link:function(t){t.name="sharedContent",t.initMessageData=function(){t.messageData={ogData:{},locationData:{}}},t.resetOgInfo=function(){t.messageData.ogData={},t.ogStatus={preview:!1,loading:!1,filterOnProgress:!1}},t.resetMessageLocation=function(){t.messageData.locationData={description:"",lat:"",lng:""}},t.resetMessageText=function(){t.messageText=""},t.resetBottomMenu=function(){t.showBottomMenu=!1},t.resetMessageInput=function(n){t.initMessageData(),t.resetBottomMenu(),t.resetMessageText(),t.resetOgInfo(),t.resetMessageLocation(),n&&e.safeDigest(t)},t.resetMessageInput(!1)}}}function loadTemplate(e,t,n,r,i){r.get(e).success(function(e){n.append(i(e)(t)),t.$rgDigest()})}setTimeoutValue.$inject=[];function setTimeoutValue(){return{restrict:"EA",template:'<div class="ptchat-box"><div class="pt-topchatbox">Message expiration time <span class="img_sprite cur-p w-h-16 chat-close-p-ico" ng-click="hideValueBox($event)"></span></div><div class="pt-middle"><table><tbody><tr><td ng-click="selectTimeout($event,5)" ng-class="{\'active\': timeout<=5}">5</td><td ng-click="selectTimeout($event,10)" ng-class="{\'active\': timeout==10}">10</td><td ng-click="selectTimeout($event,15)" ng-class="{\'active\': timeout==15}">15</td><td ng-click="selectTimeout($event,20)" ng-class="{\'active\': timeout==20}">20</td><td ng-click="selectTimeout($event,25)" ng-class="{\'active\': timeout==25}">25</td><td ng-click="selectTimeout($event,30)" ng-class="{\'active\': timeout==30}">30</td><td ng-click="selectTimeout($event,35)" ng-class="{\'active\': timeout==35}">35</td><td ng-click="selectTimeout($event,40)" ng-class="{\'active\': timeout==40}">40</td><td ng-click="selectTimeout($event,45)" ng-class="{\'active\': timeout==45}">45</td><td ng-click="selectTimeout($event,50)" ng-class="{\'active\': timeout==50}">50</td></tr><tr><td ng-click="selectTimeout($event,55)" ng-class="{\'active\': timeout==55}">55</td><td ng-click="selectTimeout($event,60)" ng-class="{\'active\': timeout==60}">60</td><td ng-click="selectTimeout($event,65)" ng-class="{\'active\': timeout==65}">65</td><td ng-click="selectTimeout($event,70)" ng-class="{\'active\': timeout==70}">70</td><td ng-click="selectTimeout($event,75)" ng-class="{\'active\': timeout==75}">75</td><td ng-click="selectTimeout($event,80)" ng-class="{\'active\': timeout==80}">80</td><td ng-click="selectTimeout($event,85)" ng-class="{\'active\': timeout==85}">85</td><td ng-click="selectTimeout($event,90)" ng-class="{\'active\': timeout==90}">90</td><td ng-click="selectTimeout($event,95)" ng-class="{\'active\': timeout==95}">95</td><td ng-click="selectTimeout($event,100)" ng-class="{\'active\': timeout==100}">100</td></tr><tr><td ng-click="selectTimeout($event,105)" ng-class="{\'active\': timeout==105}">105</td><td ng-click="selectTimeout($event,110)" ng-class="{\'active\': timeout==110}">110</td><td ng-click="selectTimeout($event,115)" ng-class="{\'active\': timeout==115}">115</td><td ng-click="selectTimeout($event,120)" ng-class="{\'active\': timeout==120}">120</td></tr></tbody></table></div></div>',link:function(e){e.name="setTimeoutValiue",e.selectTimeout=function(t,n){e.box.value.timeout=e.timeout=n,e.hideValueBox(t),e.$digest()}}}}chatBoxSettings.$inject=["$ringhttp","$compile","GlobalEvents","ChatFactory","chatHistoryFactory","tagChatFactory","tagChatManager","Ringalert","CHAT_LANG","$rootScope","Auth"];function chatBoxSettings(e,t,n,r,i,o,a,s,c,l,u){return{restrict:"A",link:function(o,d){var g,E,m="templates/partials/chat/chat-box-top-settings-menu.html",T=c.TAG;o.name="chatBoxSettings",o.activeMenu="options",loadTemplate(m,o,d.parent().parent(),e,t),o.shouldShowBoxSettingsView=!1,o.toggleBoxSettings=function(){o.shouldShowBoxSettingsView=!o.shouldShowBoxSettingsView},o.hideBoxSettings=f;function f(){o.shouldShowBoxSettingsView=!1,o.activeMenu="options",o.hideValueBox(),o.$rgDigest()}function p(e){e.stopPropagation(),e.preventDefault(),o.toggleBoxSettings(),o.hideValueBox(),l.$broadcast("focusOn",o.box.value.getKey()),o.$rgDigest()}d.on("click",p),n.bindHandler("document","click",_);function _(){f(),o.hideValueBox(),o.$rgDigest()}o.timeout=o.box.value.timeout,o.showTimeoutBox=!1,o.close=function(e){e.preventDefault(),e.stopPropagation(),o.toggleBoxSettings(),o.activeMenu="options",o.$rgDigest()};function I(e){e&&(e.preventDefault(),e.stopPropagation())}o.showValueBox=function(e){o.showTimeoutBox?o.hideValueBox():(o.shouldShowBoxSettingsView=!1,o.showTimeoutBox=!0,g=angular.element("<set-timeout-Value ></set-timeout-Value>"),E=t(g)(o),d.children(0).append(E)),l.$broadcast("focusOn",o.box.value.getKey()),I(e)},o.hideValueBox=function(e){o.showTimeoutBox=!1,E&&E.remove(),I(e)},o.showMenu=function(e,t){I(e),o.activeMenu=t,o.hideValueBox(),o.$rgDigest()},o.isCurrentUserOwner=h;function h(){var e=o.box.value.getTagItem();return!!e&&e.getOwnerUserId()===u.currentUser().getKey()}function A(e){a.leaveFromTag(e).then(function(e){e.sucs||s.show(T.DEFAULT_FAILURE_MESSAGE,"error")},function(){s.show(T.DEFAULT_FAILURE_MESSAGE,"error")}),doCloseBox(o,r),o.$rgDigest()}function C(){}function S(e,t){t.image===-1?delete e.backgroundImage:e.backgroundImage=t.image,i.updateBox(e)}o.doAction=function(e,t,n){switch(I(e),t){case"leave_group":A(o.box.value.getKey());break;case"toggle_block":C(o.box.value.getKey());break;case"set_background":S(o.box.value,n)}o.$rgDigest()},o.$on("$destroy",function(){d.off("click",p),n.unbindHandler("document","click",_)})}}}fullScreenStickerChooser.$inject=["$ringhttp","$compile","StickerFactory","routeService","Utils","SystemEvents","Storage","Ringalert","rgScrollbarService"];function fullScreenStickerChooser(e,t,n,r,i,o,a,s,c){return{restrict:"A",controller:"EmoticonController",link:function(l,u){var d,g="templates/partials/chat/full-screen-sticker-chooser.html",E=10,m=5;loadTemplate(g,l,u,e,t),l.name="fullScreenStickerChooser",l.loading=!0,l.laodMoreLoading=!1,l.selectedStickerCatId=0,l.selectedCategory=null,l.displayDownloaded=!1,l.activeTab="my_stickers",l.routes={stickermarket:r.getRoute("STICKER_HOME")},l.recentStickers=new LRUCache(4),l.isMySticker=n.isMySticker,l.getStickerCategories=n.getStickerCategories,l.myStickerCategories=[],l.toggleDisplayDownloaded=function(){l.displayDownloaded=!l.displayDownloaded,l.getStickerCategories("all").length<20&&p()},l.selectStickerCatId=function(e,t,r){e.stopPropagation(),l.selectedStickerCatId=t,n.getStickerMapByCatId(t).then(function(e){l.stickerMap=e,l.activeCategory=n.getStickerCategoryObject(e.getKey()),l.$rgDigest()}),l.$rgDigest(),r||(l.recentStickers.set(parseInt(t,10),!0),T())};function T(){var e=[];l.recentStickers.forEach(function(t){e.push(t)}),a.setData("recentStickers",e)}l.getBottomMenuStickerIds=f;function f(){var e=[];return l.recentStickers.forEach(function(t){e.push(t)}),e.reverse()}function p(){var e,t;l.noMoreData||(l.laodMoreLoading=!0,e=n.getStickerCategories("all").length,t=n.getMoreAllCategories(e-1),t.then(function(e){e.noMoreData&&(l.noMoreData=!0),l.loadMoreLoading=!1,c.recalculate(l),l.$rgDigest()}))}function _(){E+=m,S()}function I(){var e,t=a.getData("recentStickers")||[],r=n.getMyStickerCatIds(),i=n.getAllCategoryIds(),o=t;if(r.forEach(function(e){o.indexOf(e)===-1&&o.push(e)}),o.length<4)for(e=0;e<=i.length&&(o.indexOf(i[e])!==-1||(o.push(i[e]),4!==o.length));e++);o.forEach(function(e){l.recentStickers.put(e,!0)}),T()}l.sendStickerToChatOpenBox=h;function h(e,t,n){l.isMySticker(e.getKey())?l.selectEmoOrSticker(t,n):s.show("Please download the sticker first")}l.onMouseHoverOnAllCategoryList=A;function A(e){l.interestedCategory=e,l.$rgDigest()}l.addSticker=C;function C(e){n.addMySticker(e.getKey()),S(),l.$rgDigest()}l.refreshMyStickers=S;function S(){l.myStickerCategories=[],n.getMyStickerCategoryObjects(0,E).then(function(e){l.myStickerCategories=e,l.$rgDigest()},function(){},function(e){l.myStickerCategories=e,l.$rgDigest()})}l.getStickerCategoriesByTab=v;function v(){return"my_stickers"===l.activeTab?l.myStickerCategories:l.getStickerCategories("all")}l.loadMoreByTab=M;function M(){"my_stickers"===l.activeTab?_():p()}l.setActiveTab=D;function D(e){l.activeTab=e,l.$rgDigest()}function O(){n.getDefaultStickerMap().then(function(e){e&&(l.stickerMap=e,l.selectedStickerCatId=e.getKey(),l.activeCategory=n.getStickerCategoryObject(e.getKey()),l.loading=!1,I(),p(),S(),l.$rgDigest())})}n.isStickerDataFetched()?O():d=i.onCustomEvent(o.STICKER.DO_INIT,function(){O()}),l.$on("$destory",function(){d&&i.removeCustomEvent(o.STICKER.DO_INIT,d)})}}}angular.module("ringid.chat").directive("openBox",openBox).directive("openChatBox",openChatBox).directive("openTagChatBox",openTagChatBox).directive("makeVisibleChatBox",makeVisibleChatBox).directive("showHiddenBoxes",showHiddenBoxes).directive("closeBox",closeBox).directive("minimizeBox",minimizeBox).directive("maximizeBox",maximizeBox).directive("tagChatEdit",tagChatEdit).directive("chatScrollBottom",chatScrollBottom).directive("chatBlinker",chatBlinker).directive("chatBlinkerH",chatBlinkerH).directive("chatBindOutsideClick",chatBindOutsideClick).directive("sharedContent",sharedContent).directive("chatBoxBackgroundChooser",chatBoxBackgroundChooser).directive("chatBoxSettings",chatBoxSettings).directive("setTimeoutValue",setTimeoutValue).directive("fullScreenStickerChooser",fullScreenStickerChooser).directive("fullScreenBox",fullScreenBox);function getMessagePacketIdForHistoryRequest(e){var t=e.key;if("status_update"===String(e.status))try{t=t.split("_")[0]}catch(n){}return t}function getMessageMonthAndYear(e,t){var n,r=new Date,i=e.getMessage(t);return i&&(r=new Date(i.messageDate)),n={year:r.getFullYear(),month:r.getMonth()}}function doHistoryRequest(e,t,n,r,i){var o,a,s,c,l,u,d,g,E,m=CHAT_APP.Constants.GENERAL_CONSTANTS,T=new Date;n&&n.nonDomBox&&(a=n.messageMinPacketId,o=n.messageMaxPacketId,o?d=getMessageMonthAndYear(n,o):o=i,a?g=getMessageMonthAndYear(n,a):a=i,!n.isPublicChat||d&&g||(u=T.getMonth(),l=T.getFullYear()),s=t.getHistoryRequestMethodByBox(n),c=String(o)===String(a),E=m.HISTORY_MAX_MESSAGE+2,r&&r!==m.PAGE_DIRECTION.UP||(g&&(u=g.month,l=g.year),doSendHistoryRequest(e,s,n,m.PAGE_DIRECTION.UP,a,E,u,l)),c||r||r&&r!==m.PAGE_DIRECTION.DOWN||(d&&(u=d.month,l=d.year),doSendHistoryRequest(e,s,n,m.PAGE_DIRECTION.DOWN,o,E,u,l)))}function doSendHistoryRequest(e,t,n,r,i,o,a,s){var c=n.getKey();e.historyLoading=!0,e.$rgDigest(),t.call(this,c,r,i,o,a,s).then(function(t){e&&(t.sucs&&(e.historyLoading=!1),e.refreshScrollbar&&e.refreshScrollbar(),e.$rgDigest())},function(){e&&(e.historyLoading=!1,n.hasHistoryMessage=!0,e.refreshScrollbar(),e.$rgDigest())}),setTimeout(function(){e&&!e.historyLoading&&(e.historyLoading=!1,e.refreshScrollbar(),e.$rgDigest())},1e4)}function scrollChatBoxToBottom(e,t,n,r,i){setTimeout(function(){n.bottomScrolled||(n.bottomScrolled=r,e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:n.getKey()}))},i)}chatBoxUi.$inject=["Utils","SystemEvents","ChatFactory","$rootScope","chatRequestProcessor","chatTabSync","StickerFactory","GlobalEvents"];function chatBoxUi(e,t,n,r,i,o,a,s){var c="templates/chatbox.html";return{restrict:"E",replace:!0,scope:!0,templateUrl:c,link:function(n){var i;n.name="chatBoxUi",setTimeout(a.initStickerData,5e3);function o(){r.$broadcast("focusOn",null)}s.bindHandler("document","click",o),i=e.onCustomEvent(t.CHAT.REFRESH,function(){n.$rgDigest()}),n.$on("$destroy",function(){e.removeCustomEvent(t.CHAT.REFRESH,i),s.unbindHandler("document","click",o)})}}}function extraChatBoxes(){return{restrict:"E",replace:!0,template:'<div ng-if="domBoxLength() > availableNo" class="extra-chat-box"><a class="extra-chat-box-no" chat-bind-outside-click="asd" ng-click="showHidden = !!showHidden === false ? true: false; c = domBoxLength() - availableNo; b = 60 + c * 32;" ng-cloak="true">{{domBoxLength() - availableNo}}</a><div class="show-hidded-boxes" ng-show="showHidden" ng-style="{\'bottom\': b + \'px\'}"><div class="extra-chat-box-names" ng-repeat="rbox in boxes| filter : {value : {nonDomBox : true }} | limitTo : -(domBoxLength() - availableNo) : -availableNo" chat-blinker-h="asd" chat-r-focus="{{ rbox.value.getKey()}}" make-visible-chat-box="{{ rbox.value.getKey()}}" ng-cloak="true">{{rbox.value.getTitle() ? (rbox.value.getTitle() | limitTo:15) : rbox.value.getKey()}}</div></div></div>'}}singleChatBox.$inject=["Utils","$rootScope","SystemEvents","chatTabSync","ChatFactory","chatRequestProcessor"];function singleChatBox(e,t,n,r,i,o){return{restrict:"E",replace:!0,template:'<div class="single-box-container" id="box-{{ box.value.getKey() }}" shared-content=""><chat-box-top-bar></chat-box-top-bar><div class="clear"></div><div class="chatbox-mid-border" ng-hide="box.value.isMinimized"><chat-box-top-bar-menu></chat-box-top-bar-menu><chat-box-middle></chat-box-middle><div ng-if="box.value.unreadCount > 0 && scroll==true" class="unread-button" ng-click="showUnreadMessages()" ng-cloak="true"><div class="chat-unread-down"></div>{{ box.value.unreadCount }} new Messages</div><chat-box-url-preview></chat-box-url-preview><div class="clear"></div><chat-box-bottom></chat-box-bottom><div class="clear"></div><div class="bottom-blocked" ng-if="!box.value.isTagChat && !box.value.isPublicChat && box.value.blocked">Chat Permission is denied</div></div><style ng-if="!!box.value.dimension">.chat-fullscreen-open-animation #box-{{ box.value.getKey() }}.single-box-container{            left : {{ box.value.dimension.left - 5  }}px;            width:300px;            height:400px;            -webkit-animation-duration: .4s;            -moz-animation-duration: .4s;            -ms-animation-duration: .4s;            -o-animation-duration: .4s;            animation-duration: .4s;            -webkit-animation-name: chat_box_fullscreen_open_{{ box.value.getKey() }};                    animation-name: chat_box_fullscreen_open_{{ box.value.getKey() }};        }        .chat-fullscreen-close-animation #box-{{ box.value.getKey() }}.single-box-container{            left: calc(50% - 300px);            width:600px;            height:calc(100% - 80px);            -webkit-animation-duration: .4s;            -moz-animation-duration: .4s;            -ms-animation-duration: .4s;            -o-animation-duration: .4s;            animation-duration: .4s;            -webkit-animation-name: chat_box_fullscreen_close_{{ box.value.getKey() }};                    animation-name: chat_box_fullscreen_close_{{ box.value.getKey() }};        }        @-webkit-keyframes chat_box_fullscreen_open_{{ box.value.getKey() }}{          0% {            height: 400px;            width: 300px;            left : {{ box.value.dimension.left - 5 }}px;          }          100% {            height: calc(100% - 80px);            width: 600px;            left: calc(50% - 300px);          }        }        @-webkit-keyframes chat_box_fullscreen_close_{{ box.value.getKey() }}{            0% {                height: calc(100% - 80px);                width: 600px;                left: calc(50% - 300px);            }            100% {                height: 400px;                width: 300px;                left : {{ box.value.dimension.left - 5 }}px;            }        }</style></div>',
link:function(a,s){var c,l,u,d,g,E,m,T,f=CHAT_APP.Constants.GENERAL_CONSTANTS,p={},_=!1,I=a.box.value,h=[];a.box.value.isFriendChat&&(l=a.$watch(function(){return!!I&&!I.getUser().isOnline()},function(e){I.offlineStatus=e})),a.name="singleChatBox",a.chatBoxLeft=e.viewport.x/2-300,a.addAnimationEndCallbacks=A;function A(e,t,n){h.push(function(){e.apply(n,t)})}function C(){m=angular.element(s[0].closest(".chatbox-wrapper")),m.on("webkitAnimationEnd animationend",M)}function S(){m&&m.off("webkitAnimationEnd animationend",M)}a.setBoxBoundingRect=v;function v(){I.dimension=s[0].getBoundingClientRect()}function M(){i.onBoxAnimationEnd(I.getKey()),h.forEach(function(e){e.call(this)}),h=[],a.$rgDigest()}A(v),C();function D(r){a&&(a.refreshScrollbar(!0),a.$rgDigest(),!r.noScroll&&a.bottomScrolled&&e.triggerCustomEvent(n.CHAT.SCROLL_TO_UNREAD,{boxId:r.boxId}),r.blink&&t.$broadcast("blinkerEvent",r.boxId))}function O(t){var n=t.boxId.toString();String(n)===String(I.getKey())&&(p[n]||(p[n]={}),p[n][t.type]||(p[n][t.type]=e.debounce(function(e){D(e)},500,!1)),p[n][t.type].call(this,t))}E=e.onCustomEvent(n.CHAT.API_HISTROY_PROCESSED,R);function R(t){var r=t.boxId;String(r)===String(I.getKey())&&(scrollChatBoxToBottom(e,n,I,!0,0),e.removeCustomEvent(n.CHAT.API_HISTROY_PROCESSED,E))}I.isTagChat?u=e.onCustomEvent(n.CHAT.TAG_LIST_UPDATED,function(e){e.type="tag_updated",e.noScroll=!0,e.blink=!1,e.boxId=e.tagId,O(e)}):I.isPublicChat&&(d=e.onCustomEvent(n.CHAT.ROOM_UPDATED,function(e){e.type="room_updated",e.noScroll=!0,e.blink=!1,e.boxId=e.roomId,O(e)})),T=e.onCustomEvent(n.CHAT.MESSAGE_PUSHED,function(e){e.type="pushed",I.scrollbarAtBottom||(e.noScroll=!0),e.noScroll=e.noScroll||e.fromLocalHistory||e.fromHistory||e.isEdit||!1,e.blink=e.blink&&!e.fromHistory&&!e.fromLocalHistory,O(e)}),g=e.onCustomEvent(n.CHAT.BOX_UPDATED,function(t){String(t.boxId)===String(I.getKey())&&e.safeDigest(a)}),I.loadHistoryMessages(),I.messages.length>=f.HISTORY_MAX_MESSAGE&&(_=!0),I.messages.length<f.HISTORY_MAX_MESSAGE?(c=CHAT_APP.UTILS.getUUIDPacketId(),doHistoryRequest(a,o,I,null,c)):(doHistoryRequest(a,o,I,f.PAGE_DIRECTION.DOWN,c),I.hasHistoryMessage=!0,_=!0),scrollChatBoxToBottom(e,n,I,_,10),r.sendData(f.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE,{boxId:I.getKey()}),a.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.API_HISTROY_PROCESSED,E),e.removeCustomEvent(n.CHAT.MESSAGE_PUSHED,T),e.removeCustomEvent(n.CHAT.BOX_UPDATED,g),u&&e.removeCustomEvent(n.CHAT.TAG_LIST_UPDATED,u),d&&e.removeCustomEvent(n.CHAT.ROOM_UPDATED,d),l&&l(),S()})}}}function chatBoxTopBar(){return{restrict:"E",replace:!0,template:'<div class="chat-top-bar" ng-class="{\'chat-active\' : box.value.isFocused == true}" maximize-box chat-blinker><span class="online-status-indicator" ng-class="{\'online-status-image\' : box.value.offlineStatus === false , \'offline-status-image\' : box.value.offlineStatus === true }"></span> <span class="chat-name" title="{{ box.value.getTitleString() }}" ng-if="!box.value.isMinimized && !box.value.isPublicChat" ng-click="goToPage($event, box.value.getProfileLink())" ng-cloak="true">{{ box.value.getTitleString() }} </span><span class="chat-name" title="{{ box.value.getTitleString() }}" ng-if="box.value.isMinimized || box.value.isPublicChat" ng-cloak="true">{{ box.value.getTitleString() }}</span><div class="chat-top-sty"><a data-tooltip-post="Close" href="javascript:void(0);" close-box><span class="img_sprite w-h-16 chat-close-ico"></span></a> <a data-tooltip-post="Restore Down" class="normar-hide" href="javascript:void(0);" ng-show="box.value.isFullScreen" full-screen-box><span class="img_sprite w-h-16 max-ico"></span></a> <a class="max-hide" href="javascript:void(0);" ng-if="!box.value.isFullScreen && !box.value.isMinimized" data-tooltip-post="Fullscreen" full-screen-box><span class="img_sprite w-h-16 chat-normal-ico"></span></a> <a ng-show="!box.value.isMinimized" href="javascript:void(0);" ng-if="!box.value.isFullScreen" data-tooltip-post="Minimize" minimize-box><span class="img_sprite w-h-16 mini-ico"></span></a> <a ng-show="!!box.value.isMinimized" href="javascript:void(0);" ng-if="!box.value.isFullscreen" data-tooltip-post="Maximize" miximize-box><span class="img_sprite w-h-16 max-ico-sm"></span></a> <a ng-show="!box.value.isMinimized" href="javascript:void(0);" data-tooltip-post="Settings" chat-box-settings><span class="img_sprite w-h-16 settings-ico chat-font"></span></a> <a data-tooltip-post="Set Timer Time" ng-show="!!box.value.secretChat && !box.value.isMinimized" href="javascript:void(0);" ng-click="showValueBox($event)" class="img_sprite timeout-sec timeout-wrap icon-time"><p>sec</p><span ng-cloak="true">{{ timeout>4 ? timeout : 5}}</span></a></div></div>'}}function chatBoxTopBarMenu(){return{restrict:"E",replace:!0,template:'<div ng-if="!hideTopbar && shouldShowChatBoxTopbarMenu()" class="chat-pop not-f-seen-pop t-a-c z-1 pad-top-3 animation fade-in"><div class="d-in-b l-h-p2 pad-9 f-12 m-t-2" ng-if="shouldShowLastOnlineBar()" ng-cloak="true">{{ box.value.getUser().lastOnline()}} <span class="img_sprite cur-p w-h-16 chat-close-p-ico" ng-click="box.value.lastSeenBar = false;            box.value.hideSuggestion = true"></span></div><div class="clear"></div><div class="d-in-b f-12 m-t-2 w-100-per" ng-if="shouldShowFriendSuggestion()"><div ng-switch on="box.value.getUser().friendshipStatus()"><span class="d-in-b pad-3 f-12 m-t-2" ng-cloak="true">You and {{box.value.getTitleString()}} aren\'t connected on ringID.</span><br><div class="butt border-gray-orange mar-right-5 mar-bottom-7 fl-right" ng-switch-when="0"><a class="btn-p-5-8" ng-class="{ \'f-loading\' : box.value.getUser().isLoading()}" ng-click="contactListAction({friend: box.value.getUser(), action:\'addfriend\'})"><i class="friend-ico addfnd btn-m-r-0"></i> <span class="butt-text">Add Friend</span></a></div><div class="butt border-gray-orange float-right btn-m-l-8" ng-switch-when="2"><a class="btn-p-5-8" ng-class="{ \'f-loading\' : box.value.getUser().isLoading()}" ng-click="contactListAction({friend: box.value.getUser(), action: \'accept\'})"><i class="friend-ico fnd btn-m-r-0"></i> <span class="butt-text">Accept</span></a></div><a class="friend-btn float-right" ng-switch-when="3" href="javascript:void(0);">Request sent</a> <span class="img_sprite w-h-16 chat-close-p-ico cur-p top-3" ng-click="box.value.hideSuggestion = true"></span></div></div></div>',link:function(e){var t=e.box.value;e.hideTopbar=!0,e.hideOnlineBar=!1,e.hideSuggestion=!1,e.name="chatBoxTopBarMenu";function n(){e.hideTopbar=!1,e.$rgDigest()}function r(){e.hideOnlineBar=!0,e.$rgDigest()}function i(t){n(),e.$rgDigest(),setTimeout(r,1e3*t)}setTimeout(function(){i(10)},3e3),e.shouldShowLastOnlineBar=function(){return!e.hideOnlineBar&&!e.shouldShowFriendSuggestion()&&t.offlineStatus&&t.lastSeenBar&&!!t.getUser().lastOnline&&t.getUser().lastOnline()},e.shouldShowFriendSuggestion=function(){return!t.hideSuggestion&&t.isFriendChat&&!!t.getUser()&&1!==t.getUser().friendshipStatus()},e.shouldShowChatBoxTopbarMenu=function(){return t.isFriendChat&&(e.shouldShowLastOnlineBar()||e.shouldShowFriendSuggestion())}}}}function chatBoxUrlPreview(){return{restrict:"E",replace:!0,template:'<div class="single-preview-container"><div class="chat-preview" ng-if="messageText != \'\' && (ogStatus.preview || ogStatus.filterOnProgress || ogStatus.loading)"><rg-url-og-preview template="templates/partials/chat/url-og-preview.html" og-data="messageData.ogData" edit-mode="true" show-preview="ogStatus.preview" filter-on-progress="ogStatus.filterOnProgress" loading-data="ogStatus.loading"></rg-url-og-preview></div></div>'}}chatBoxBottom.$inject=["Utils","$document"];function chatBoxBottom(e){return{restrict:"E",replace:!0,template:'<div class="chat-bottom" ng-hide="box.value.isMinimized || box.value.blocked"><div class="emo-area-chat"><a class="imo-icon" href="javascript:void(0)"><i class="img_sprite icon-emoticon ico-sty" rg-emoticon show-sticker="true" clicked="selectEmoticonChat"></i></a></div><span class="chat-ic-sty chat-area" chat-select-emo="noneed"><textarea rows="3" cols="" ng-model="messageText" send-message-directive="noneed" name="chat" placeholder="Type your message..."></textarea><div style="max-width: 250px"><rg-url-og-fetcher data-fetched-og-info="messageData.ogData" editor-content="messageText" show-preview="ogStatus.preview" loading-data="ogStatus.loading" filter-on-progress="ogStatus.filterOnProgress"></rg-url-og-fetcher></div></span><div ng-show="showBottomMenu" class="emo-area-chat-container"><chat-box-bottom-menu></chat-box-bottom-menu></div><div class="emo-area-chat left-border"><a class="imo-icon" href="javascript:void(0)"><i class="chat-btn-right" data-ng-mouseenter="bottomMenuButtonHover=true" data-ng-mouseleave="bottomMenuButtonHover=false" data-ng-click="toggleMenu()"></i></a></div></div>',link:function(t){t.name="chatBoxBottom",t.toggleMenu=function(){t.showBottomMenu=!t.showBottomMenu,e.safeDigest(t)}}}}function chatBoxLocationInfo(){return{restrict:"E",replace:!0,link:function(){},template:'<div class="chatbox-location-info-wrapper" ng-show="messageData.locationData.description"><span class="float-right showpointer icon-close f-8" ng-click="resetMessageLocation()"></span><div class="chat-box-bottom-info" ng-cloak="true">{{ messageData.locationData.description }}</div></div>'}}chatBoxBottomMenu.$inject=["Utils","rgRecorderService"];function chatBoxBottomMenu(e,t){return{restrict:"E",replace:!0,link:function(e,n){e.name="chatBoxBottomMenu",e.showMediaButton=t.hasUserMediaSupport();function r(){e.$parent.bottomMenuHover=!0}function i(){e.$parent.bottomMenuHover=!1}n.on("mouseover",r),n.on("mouseleave",i),e.$on("$destroy",function(){n.off("mouseover",r),n.off("mouseleave",i)})},template:'<div class="bottom-right-menu animation fade-in"><div class="bottom-right-menu-item"><a data-tooltip-post="Add Photos" href="javascript:void(0)" class="p-ab" data-ng-click="toggleMenu()"><div rg-upload upload-type="chat" upload-action="uploadAction"></div></a></div><div class="bottom-right-menu-item" ng-if="showMediaButton"><a data-ng-click="resetBottomMenu()" data-tooltip-post="Capture Image" rg-ringbox="true" ringbox-controller="ChatMediaUploadController" ringbox-target="templates/partials/chat/media-upload.html" ringbox-type="remote" ringbox-data="{boxId : box.key}"><span class="chat-video-ico"></span></a></div><div class="bottom-right-menu-item"><a data-tooltip-post="Share Location" rg-click="selectedLocation();" class="p-ab" href="javascript:void(0)"><span class="chat-location-ico"></span></a></div></div>'}}chatBoxMiddle.$inject=["$rootScope","Utils"];function chatBoxMiddle(){return{restrict:"E",replace:!0,template:'<div class="chat-middle" ng-class="{bottomPad: (ogStatus.preview || ogStatus.filterOnProgress || ogStatus.loading), bg: !!box.value.getBackgroundImageType() !== \'no-image\' }" ng-style="{ \'background\': box.value.getBackgroundImage()  }" ng-hide="box.value.isMinimized" chat-scroll-bottom="df"><div class="clear"></div><chat-history-loader></chat-history-loader><div class="clear"></div><div message-directive="noneed" message-box="box" message-msg="message" ng-class="{\'c-right\': (!message.showAvator && message.user.isCurrentUser() && message.status !== \'status_update\'),                        \'c-left\':(!message.showAvator && !message.user.isCurrentUser() && message.status !== \'status_update\'),                        \'status-unread-container\' : message.status == \'Unread\' }" ng-repeat="message in box.value.getMessages()" ng-init="message = message.value"><chat-single-message></chat-single-message></div><div class="clear"></div><div class="typing-h-mar" ng-if="box.value.isFriendTyping()" ng-cloak="true"><div class="chat-box-typing"><div class="log-loader type-load">{{ box.value.getTypingText()}}</div></div></div><div class="clear"></div></div>',link:function(e){e.name="chatBoxMiddle"}}}chatSingleMessage.$inject=["Utils","$ringbox","SystemEvents","$$mediaMap"];function chatSingleMessage(e,t,n){return{restrict:"E",replace:!0,link:function(r){var i,o,a;r.name="chatSingleMessageDirectiveLinkFunction";function s(t){var n=t.message;String(n.key)===String(r.message.key)&&e.safeDigest(r)}i=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,s),r.openRingboxContent=function(n){o=t.open({type:"remote",scopeData:{message:n,viewport:e.viewport},resolve:{data:{}},backDropClose:!0,template:'<style></style><div><div ng-if="message.messageType == 8 || message.messageType == 9"><rg-player id="chat-media-{{ message.key }}" is-video="{{::message.isVideo}}" auto-play="true" auto="false" width="640" height="480" duration="{{message.mediaInfo.height}}" url="{{::message.mediaUrl}}"></rg-player></div><div class="chat-pic large" ng-if="message.messageType == 7 || message.messageType == 10"><img style="max-width:100%;max-height:90vh" ng-style="{\'width\': message.mediaInfo.width + \'px\', \'height\': message.mediaInfo.height + \'px\'}" ng-src="{{ message.mediaUrl }}" alt=""></div></div>'})},r.getMediaData=function(e){return{data:function(){return{media:e}},promise:e.fetchDetails()}},a=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,function(){o&&o.close()}),r.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,i),e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,a)})},template:"<div class=\"chat-message-container\" title=\"{{ message.user.getName() }}\" chat-message-react=\"message\" ng-class=\"{ 'chat-r icon-c-left cm-sty' : (  message.showAvator  &&  message.user.isCurrentUser() && message.status !== 'status_update' ),                    'chat-c chat-bgy'           : ( !message.showAvator  &&  message.user.isCurrentUser() && message.status !== 'status_update' ),                    'chat-l  icon-c-right'      : (  message.showAvator  && !message.user.isCurrentUser() && message.status !== 'status_update' ),                    'chat-c chat-bgw'           : ( !message.showAvator  && !message.user.isCurrentUser() && message.status !== 'status_update' ),                    'status-Unread'             :    message.status == 'Unread'"+'                  }"><div ng-if="message.status != \'status_update\'"><a ng-show="message.status == \'Failed\'" retry-message="noneed" data-tooltip-post=" Retry " class="retry"></a><div class="t-set" ng-if="(message.timeout > 0 && message.isSecretVisible)"><div class="timer-l"><p ng-cloak="true">{{message.timeout}}</p><h3>sec</h3></div></div><span class="e-d"><a data-tooltip-post="Delete" delete-message="noneed" ng-show="message.canDelete()" class="msgDeleteIcon"><span class="img_sprite w-h-13 icon-delete-p"></span> </a><a data-tooltip-post="Edit" edit-message="{{::box.value.getKey()}}" ng-show="message.canEdit()" class="msgDeleteIcon"><span class="img_sprite w-h-13 icon-edit-p"></span></a></span><div ng-if="message.messageType == 2 || message.messageType == 3 || message.messageType == 0"><p ng-bind-html="message.getTextPartition()"></p></div><div class="chat-pic sticker" ng-if="message.messageType == 6"><img width="150" ng-src="{{ message.stickerUrl}}" alt=""><div class="clear"></div></div><div class="chat-pic" ng-if="message.messageType == 7 || message.messageType == 10" style="width: {{::message.mediaInfo.thumbWidth}}px;height:{{::message.mediaInfo.thumbHeight}}px"><p ng-bind="message.plainText"></p><img ng-class="{\'p-chat-img\' : message.uploading}" width="{{ ::message.mediaInfo.thumbWidth }}" height="{{ ::message.mediaInfo.thumbHeight }}" ng-src="{{ (message.timeout > 0 || message.secretTimedOut) && settings.baseUrl + \'images/image-preview.jpg\' || message.mediaUrl}}" alt=""><div class="clear"></div><a ng-click="onViewedCalled(message);openRingboxContent(message)" class="view-play-anchor"></a> <i ng-if="!message.uploading"><img src="images/chat_preview.png"></i><chat-file-upload-progress></chat-file-upload-progress></div><div class="chat-pic location" ng-if="message.messageType == 4"><p ng-cloak="true">{{ message.plainText }}</p><a ng-href="{{ ::message.mapJsUrl }}" rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html" scope-data="{url :  message.getSafeMapJsUrl() }">&nbsp;</a><img width="150" ng-src="{{ message.mapStaticUrl}}" alt=""><div class="clear"></div></div><div class="chat-pic" ng-if="message.messageType == 5 && !!message.ogData"><p ng-bind="message.plainText"></p><rg-url-og-preview template="templates/partials/chat/url-og-preview.html" og-data="message.ogData" show-preview="true" loading-data="false"></rg-url-og-preview></div><div class="chat-pic video" ng-if="message.messageType == 8 || message.messageType == 9"><img width="150" src="images/video-preview.jpg" alt=""><div class="clear"></div><a href="javascript:void(0);" ng-click="onViewedCalled(message)" rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/chat/media-preview.html" scope-data="{message : message}"></a> <i ng-if="!message.uploading"><img src="images/chat_preview.png"></i></div><div class="chat-pic feed-media" ng-if="message.messageType == 15"><div class="cursor" href="javascript:void(0);" ng-click="onViewedCalled(message)" rg-ringbox="true" ringbox-type="remote" ring-backdrop-close="false" ringbox-controller="RingBoxMediaController" show-close-btn="false" ringbox-target="templates/partials/notification/media-popup.html" ringbox-data="getMediaData(message.ringMediaObject)" scope-data="{message : message}"><p ng-bind="message.plainText"></p><img ng-class="{\'p-chat-img\' : message.uploading}" width="150" ng-src="{{ (message.timeout > 0 || message.secretTimedOut) && settings.baseUrl + \'images/image-preview.jpg\' || message.thumbURL}}" alt=""><p ng-bind="message.albumName"></p><p ng-bind="message.artistName" ng-show="message.artistName!=\'\'"></p><p ng-bind="message.durationText"></p></div><div class="clear"></div></div><div class="clear"></div><single-message-status></single-message-status><div class="dis_ib fl-left" ng-if="message.public_chat"><div class="chat-like" rg-likes="" target="message" like-type="chatMessage"></div><div data-tooltip-post="Report" rg-report spam-type="chat_message" spam-id="message.key" box-id="{{ ::message.boxId }}" class="img_sprite room-report cur-p m-l-5"></div></div></div><div ng-if="message.status == \'status_update\'"><p ng-bind-html="message.getTextPartition()"></p><div class="clear"></div></div></div>'}}function chatFileUploadProgress(){return{restrict:"E",replace:!0,template:'<div ng-show="message.uploading"><div class="status-photo-view-chat"><div ng-show="message.uploadProgress !== 100" class="progress-bar-placement-chat"><div class="chatPercent" style="width:150px" ng-cloak="true">{{message.uploadProgress() }}%</div><div class="progress-bar"><div class="uploaded" ng-style="{\'width\': message.uploadProgress()*1.62 + \'%\'}"></div></div></div></div></div>'}}SeenUserListController.$inject=["$scope","$boxInstance","Api","$$stackedMap","friendsFactory","Auth","userFactory","ChatConnector"];function SeenUserListController(e,t,n,r,i,o,a,s){var c=CHAT_APP.ChatRequests;e.loading=!0,e.users=r.createNew(),e.contactListAction=function(t){t.friend.isLoading()||(i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.isCurrentUser=function(e){return e.equals(o._currentUser)},e.loadmore=function(){e.loading||d()};function l(){var t=e.message.getSeenUserIds();t.forEach(function(t){e.users.save(t,u(t))})}function u(e){var t={utId:parseInt(e,10)};return a.createByUtId(t,!0,!0)}function d(){var t=c.getTagChatGetMessageSeenListRequestObject(e.box.value.getKey(),e.message.key);e.loading=!0,s.request(t).then(function(t){t.sucs?(e.loading=!1,l(),e.$rgDigest()):(e.loading=!1,l(),e.$rgDigest())})}l(),d(),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:n.user.getMutualFriends(e)}}}singleMessageStatus.$inject=["Utils","ChatUtilsFactory","$ringbox"];function singleMessageStatus(e,t,n){function r(e,t){var n=t?t:"Pending";return"Sent"===n&&(n="Delivered"),n}function i(e){return t.getChatVerbalDateFromServerDate(e)}return{restrict:"E",replace:!0,link:function(e){var t;e.name="chatSingleMessageStatus",e.$watch("message.status",function(){e.message.statusText=r(e.box.value.isTagChat,e.message.status),e.message.statusDate=i(e.message.messageDate),e.message.statusUserName=e.message.user.getName()}),e.showSeenUserList=function(){e.box.value.isTagChat&&(t=n.open({type:"remote",scope:e,resolve:{data:{}},controller:"SeenUserListController",template:'<div style="width:360px"><div class="modal-header"><h3 class="ng-binding">Seen Users</h3></div><div class="fnd-search-scroll-wrapper"><ul class="fnd-search" rg-scrollbar="scrollbar()" bottom-reached="loadmore()"><li ng-repeat="item in users.all() track by $index" ng-init="item = item.value"><div class="left" style="width: 56%"><div class="pic"><a ng-href="{{item.link()}}"><img rg-src="item.avatar(\'thumb\')"></a></div><p class="name"><a ng-href="{{item.link()}}" ng-cloak="true">{{item.getName()}}</a></p></div><div class="right-f" ng-if="!item.isCurrentUser()"><div class="butt border-gray-orange float-right btn-m-l-8" ng-show="item.friendshipStatus() === 0"><a class="btn-p-5-8" ng-class="{\'f-loading\' : item.isLoading()}" rg-click="contactListAction({friend: item, action:\'addfriend\'})"><i class="friend-ico addfnd btn-m-r-0"></i> <span class="butt-text">Add Friend</span></a></div><div class="butt border-gray-orange float-right btn-m-l-8" ng-show="item.friendshipStatus() === 1"><a class="btn-p-5-8" ng-class="{\'f-loading\' : user.isLoading()}"><i class="friend-ico fnd btn-m-r-0"></i> <span class="butt-text">Friend</span></a></div><div class="butt bg-orange-white-i float-right btn-m-l-8" ng-show="item.friendshipStatus() === 2"><a class="btn-p-5-8" ng-class="{\'f-loading\' : item.isLoading()}" rg-click="contactListAction({friend: item, action: \'accept\'})"><i class="friend-ico accept btn-m-r-0"></i> <span class="butt-text">Accept</span></a></div><div class="butt border-gray-orange float-right btn-m-l-8" ng-show="item.friendshipStatus() === 2"><a class="btn-p-5-8" ng-class="{\'f-loading\' : item.isLoading()}" rg-click="contactListAction({friend: item, action: \'reject\'})"><i class="friend-ico reject btn-m-r-0"></i> <span class="butt-text">Reject</span></a></div><div class="butt border-gray-orange float-right btn-m-l-8" ng-show="item.friendshipStatus() === 3"><a class="btn-p-5-8" ng-class="{\'f-loading\' : item.isLoading()}" rg-click="contactListAction({friend: item, action: \'reject\'})"><i class="friend-ico cancel-req btn-m-r-0"></i> <span class="butt-text">Cancel Request</span></a></div><div class="clear"></div><p class="mar-top-10" ng-show="item.commonFriends() > 0"><a class="mitualfnd" rg-ringbox="true" ringbox-controller="mutualFriendsController" ringbox-target="templates/home/mutual-friends.html" ringbox-type="remote" ringbox-data="getMutualFriend(item)" ng-cloak="true">{{item.commonFriends()}} mutual friends</a></p><p ng-show="item.commonFriends() < 1">0 mutual friend</p></div><div class="right-f" ng-if="item.isCurrentUser()"><p>It\'s you</p></div><div class="clear"></div></li><rg-loader-view1 is-loading="loading"></rg-loader-view1></ul></div></div>'}))},e.$on("$destroy",function(){t&&t.close()})},template:'<div class="t-chat"><p rg-click="showSeenUserList()" ng-cloak="true"><span title="{{ message.statusUserName }}" ng-cloak="true">{{ message.statusUserName }}</span> {{ message.statusDate }} <a data-tooltip-post=" {{message.statusText}} " class="{{message.statusText}}"><div ng-if="message.statusText == \'Pending\'" class="chat-ani"></div></a></p></div>'}}chatHistoryLoader.$inject=["chatRequestProcessor"];function chatHistoryLoader(e){return{restrict:"E",replace:!0,link:function(t,n){var r=CHAT_APP.Constants.GENERAL_CONSTANTS;t.name="chatHistoryLoader",t.historyLoading=!1,n.on("click",function(n){var i=CHAT_APP.UTILS.getUUIDPacketId();n.preventDefault(),n.stopPropagation(),t.freezeScrollbar(),doHistoryRequest(t,e,t.box.value,r.PAGE_DIRECTION.UP,i)})},template:'<div class="history-btn-container"><div ng-if="box.value.hasHistoryMessage"><button ng-if="!historyLoading" class="c-button bg-pad-his">Previous Messages...</button><rg-loader-view2 is-loading="historyLoading"></rg-loader-view2></div></div>'}}function singlePageChatUI(){return{restrict:"E",replace:!0,template:'<div class="music-mid-bg mid-width"><div class="middle"><div class="c-h-container"><chat-single-page-top></chat-single-page-top><div class="clear"></div><div class="c-h-middle"><chat-single-page-left></chat-single-page-left><chat-single-page-right></chat-single-page-right><div class="clear"></div></div></div></div></div>',controller:"ChatHistoryController"}}function chatSinglePageTop(){return{restrict:"E",replace:!0,template:'<div class="c-h-top"><div class="c-h-left float-left"><ul class="c-h-nav"><li class="float-right"></li><li class="float-left"><a href="#">Recent</a></li><li class="float-left"></li></ul></div><div class="c-h-right float-left"><div class="hover-cart-area width-200 float-left ch-user-name"><a class="c-h-u" href="javacript:void(0);" ng-cloak="true">{{ selectedLeftBox.boxTitle}}</a></div><ul class="c-h-nav c-h-nav1"></ul></div></div>'}}function chatSinglePageLeft(){return{restrict:"E",replace:!0,template:'<div class="c-h-left float-left"><div class="c-h-seacrh"><form method="get" action="" class="ng-pristine ng-valid"><i class="icon-search search-c-h"></i><input type="text" class="right-searchbar" ng-model="historySearch.key" placeholder="Search..."></form><div class="clear"></div></div><div class="c-h-l-height" style="height:730px"><ul class="c-h-result" rg-scrollbar="true"><div data-ng-repeat="singleBox in boxes.all() track by singleBox.key " ng-class="singleBox.value.unreadCount() > 0 ? \'unseen\' : \'seen\'"><chat-left-single-box ng-show="singleBox.value.shouldVisible()" ng-click="selectLeftBox(singleBox.value)" singlebox="singleBox.value"></chat-left-single-box></div></ul></div></div>'}}function chatSinglePageRight(){return{restrict:"E",replace:!0,template:'<div class="c-h-right float-left"><div class="c-h-l-height" style="height:630px"><ul class="cr-h" rg-scrollbar="true"><div data-ng-repeat="aMessage in selectedLeftBox.messages"><chat-right-single-box amessage="aMessage"></chat-right-single-box></div><div class="clear"></div></ul></div></div>'}}function chatLeftSingleBox(){return{restrict:"E",replace:!0,template:'<li ng-class="{ active : ( singleBox.value.key == selectedLeftBox.key) }"><a href="javascript:void(0);" title="{{ singleBox.value.getTitle() }}"><img class="float-left c-h-image" ng-src="{{ aBoxObject.value.getCover() }}"><h3 ng-cloak="true" ng-cloak="true" ng-cloak="true">{{ singleBox.value.getTitle() }}<span style="font-size:9pt;text-align: right;float: right" class="time" ng-cloak="true"><i class="img_sprite icon-dt-ico w-h-13"></i>{{ singleBox.value.lastMessage.date }}</span></h3><p ng-cloak="true">{{ singleBox.value.lastMessage.user.getName() }}: {{ singleBox.value.lastMessage.messageText() }}</p></a></li>'}}function chatRightSingleBox(){return{restrict:"E",replace:!0,template:'<li><img class="float-left c-h-image" src="images/prof.png"><div class="m-content float-left"><div class="hover-cart-area"><a class="c-h-u" href="javacript:void(0);" ng-cloak="true">{{ aMessage.user.getName() || aMessage.userId }}</a><user-card></user-card></div><p ng-cloak="true">{{ aMessage.text }}</p><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i> {{ getMessageTime(aMessage) }}</span></div><div class="clear"></div></li>'}}function chatMessageBox(){return{restrict:"E",replace:!0,template:'<div class="chat-box-ch" style="border:15px solid #eee;margin:20px 0 0 0;text-align: left"><form enctype="multipart/form-data"><div style="padding:10px"><div class="float-left" style="position:relative"><div class="thumbnail"><div class="icon-logo-circle pss-logo"><a><img class="responsive-all" ng-src="{{ currentUser.avatar(\'thumb\')}}"></a></div></div></div><div class="post-t float-right"><div class="style-1"><textarea style="width:100%;height: 50px;resize: none"></textarea></div><div class="clear"></div></div></div><div class="clear"></div><div class="status-photo-box c-h-bottom"><rg-upload upload-type="status" upload-action="" upload-enabled="!ogData.url"></rg-upload><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Emoticon" href="javascript:void(0)" class="p-ab"><span class="emo-ico" rg-emoticon show-sticker="false" attached="#post-box-id"></span></a></div><div class="post-b-ico m-l-10"><a data-tooltip-post="Tag Friends" rg-tag-friend="{{::showAddTag}}" tag-items="tagList" on-select="addTag(item)" class="p-ab"><span class="tag-f-ico"></span></a></div><div class="post-b-ico m-l-10"><a data-tooltip-post="Feed Duration" feed-timeout-menu="" ring-on-option-select="selectedTimeout(item)" selected-value="validity" class="p-ab"><span class="timmer-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Location" feed-location-menu="" feed-location-menu-on-select="selectedLocation(location)" selected-value="feedLocation" class="p-ab"><span class="location-ico"></span></a></div><div class="float-right"><input type="button" ng-disabled="shouldDisableInput()" rg-click="addFeed()" rg-click-noapply="true" class="c-button float-right" value="Reply" style="margin-right:10px;margin-top:3px"></div></div></form></div>'}}function chatBoxTopBarStatus(){return{restrict:"E",replace:!0,template:'<div ng-show="!!box.value.statusBar" class="last-seen-pop chat-pop"><div class="d-in-b pad-9 f-12 m-t-2" ng-cloak="true">{{ box.value.status.messsage }} <span class="img_sprite w-h-16 chat-normal-ico" ng-click="box.value.statusBar = false"></span></div></div>',link:function(){}}}angular.module("ringid.chat").directive("chatBoxUi",chatBoxUi).directive("chatBoxTopBar",chatBoxTopBar).directive("chatBoxMiddle",chatBoxMiddle).directive("chatBoxBottom",chatBoxBottom).directive("extraChatBoxes",extraChatBoxes).directive("chatBoxUrlPreview",chatBoxUrlPreview).directive("chatBoxTopBarStatus",chatBoxTopBarStatus).directive("chatBoxTopBarMenu",chatBoxTopBarMenu).directive("chatBoxBottomMenu",chatBoxBottomMenu).directive("chatBoxLocationInfo",chatBoxLocationInfo).directive("chatSingleMessage",chatSingleMessage).directive("chatFileUploadProgress",chatFileUploadProgress).controller("SeenUserListController",SeenUserListController).directive("singleMessageStatus",singleMessageStatus).directive("chatHistoryLoader",chatHistoryLoader).directive("singleChatBox",singleChatBox).directive("chatSinglePageTop",chatSinglePageTop).directive("chatSinglePageLeft",chatSinglePageLeft).directive("chatLeftSingleBox",chatLeftSingleBox).directive("chatSinglePageRight",chatSinglePageRight).directive("chatRightSingleBox",chatRightSingleBox).directive("chatMessageBox",chatMessageBox).directive("singlePageChatUI",singlePageChatUI);var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("chatFocus",chatFocusDirective),chatFocusDirective.$inject=["fileUploadService","UPLOAD_TYPES","chatHistoryFactory","$document","$rootScope","Utils","Auth","ChatHelper","SystemEvents","settings","ChatSeenSend","ChatPacketSenderService","chatTabSync","Ringalert","ChatConnector","ChatUtilsFactory"],chatFocusDirectiveControllerFunction.$inject=["$scope","ChatSeenSend","ChatHelper","Auth","rgScrollbarService","ChatUtilsFactory","SystemEvents","Utils"];function chatFocusDirectiveControllerFunction(e,t,n,r,i,o,a,s){e.onViewedCalled=function(i){var o,a=e.box.value,s=e.box.value.isTagChat,c=e.box.value.isPublicChat,l=[{key:i.key,value:i}];function u(e){var t,n,i=[];for(t=0,n=e.length;t<n;t++)e[t].value.user.getKey()!==r.loginData.utId&&"Deleted"!==e[t].value.status&&"Played"!==e[t].value.status&&"Viewed"!==e[t].value.status&&"status_update"!==e[t].value.status&&"true"!==String(e[t].value.seenSent)&&i.push(e[t]);return i}if(angular.isArray(l)&&l.length>0){if(l=u(l),l.length<1)return;o=t.sendSeenPacket(a,l),o&&o.then(function(){e.$rgDigest()}),s||c||n.startTimerOthers(e,l);
}},e.showUnreadMessages=function(){var t=e.box.value;n.decreaseUnreadCount(t),s.triggerCustomEvent(a.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey(),topAlign:!0})}}function chatFocusDirective(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T){var f=CHAT_APP.Constants,p=f.GENERAL_CONSTANTS,_=CHAT_APP.SharedHelpers;return{controller:chatFocusDirectiveControllerFunction,link:function(r,m){var f,I,h,A,C,S,v,M,D,O=r.box.value.getKey();r.name="chatFocusDirective",r.uploadBoxValue=r.box.value.getKey(),r.uploadAction=function(n){var i=o.getUniqueID("ring");r.resetBottomMenu();function s(n){var a,s;e.removeScope(t.CHAT,r),n.sucs&&(D=r.box.value,v=D.isTagChat,M=D.isPublicChat,a={url:n.iurl,caption:n.caption,width:n.iw,height:n.ih},s=l.imBase+n.iurl,D.removeMessage(i),o.safeDigest(r),d.sendMessage(D,s,p.MESSAGE_TYPES.IMAGE,{mediaData:a}),r.resetMessageInput(),o.safeDigest(r))}function u(){E.show({mg:"Image Upload Failed, please try again"},"error"),D.removeMessage(i),r.$rgDigest()}n.uploadFile.fetchMeta(function(l){var d;return l.success?(d={key:i,uploadProgress:n.uploadFile.getProgress.bind(n.uploadFile),uploading:!0,message:" ",mediaUrl:n.uploadFile.getPreview(),fileMeta:n.uploadFile.getMeta(),messageDate:_.getChatServerCurrentTime(),messageType:p.MESSAGE_TYPES.IMAGE,packetId:i,sessionId:o.getToken,timeout:0,status:0,userId:a.currentUser().getKey(),getMessageTime:function(){return T.getChatVerbalDateFromServerDate(d.messageDate)},fileUploadObject:n.uploadFile},r.box.value.pushDummyMessage(d,a.currentUser(),!0),o.triggerCustomEvent(c.CHAT.SCROLL_TO_BOTTOM,{boxId:r.box.value.getKey()}),e.setScopeForDigest(t.CHAT,r),o.safeDigest(r),void n.uploadFile.initUpload().then(function(e){d.uploading=!1,s(e)},function(e){d.uploading=!1,u(e)})):void E.show("Unable to upload the photo, please try again","info")})},f=o.onCustomEvent(c.CHAT.BOX_CAM_UPLOAD,function(e){String(r.box.value.getKey())===String(e.boxId)&&r.uploadAction(e)}),S=r.box.value.getMessages(),D=r.box.value,v=r.box.value.isTagChat,M=r.box.value.isPublicChat;function R(e){var t,n,r=[];for(t=0,n=e.length;t<n;t++)switch(e[t].value.messageType){case 2:case 3:case 4:case 5:case 6:r.push(e[t])}return r}function N(e){var t,n,r=[];for(t=0,n=e.length;t<n;t++)String(e[t].value.user.getKey())!==String(a.loginData.utId)&&"Deleted"!==String(e[t].value.status)&&"Played"!==String(e[t].value.status)&&"Viewed"!==String(e[t].value.status)&&"status_update"!==String(e[t].value.status)&&Boolean(e[t].value.seenSent)!==!0&&r.push(e[t]);return r}function P(e){var t,r,i=[];for(t=0,r=e.length;t<r;t++)"Unread"!==String(e[t].value.status)||e[t].value.timeout&&0!==e[t].value.timeout||(e[t].value.status="Received",i.push(e[t].value));n.updateMessages(i,D.getKey())}function y(e){n.removeUnreadMessageInfoByBoxId(e)}C=o.onCustomEvent(c.CHAT.TAB_SYNC_NEW_DATA,function(e){var t;if(p.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER===e.type&&String(e.boxId)===String(D.getKey())&&angular.isArray(S)&&S.length>0){if(t=N(S),t=R(t),t.length<1)return;P(S),y(e.boxId),D.updateUnreadCount(),v||M||s.startTimerText(r,t)}}),A=o.onCustomEvent(c.CHAT.WAS_FOCUSED,function(e){var t,n;e&&e.box&&(t=e.box,n=e.filteredMessages,String(t.getKey())===String(D.getKey())&&(t.isTagChat||s.startTimerText(r,n),g.sendData(p.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:t.getKey()})))}),h=o.onCustomEvent(c.CHAT.DO_START_SECRET_TIMER,function(e){e&&String(e.boxId)===String(O)&&(e.others?s.startTimerOthers(r,e.messages):s.startTimerText(r,e.messages))}),I=function(e){var t,n,a;for(e.stopPropagation(),O=r.box.value.getKey(),D=r.box.value,t=!1,D.unreadCount>0&&(y(O),D.updateUnreadCount(),t=!0),r.bottomMenuHover||r.bottomMenuButtonHover||(r.showBottomMenu=!1,t=!0),t&&o.safeDigest(r),n=0;n<r.boxes.length;n++)r.boxes[n].value.isFocused=!1;if(D.isMinimized===!0?D.isFocused=!1:D.isFocused=!0,r.$broadcast("blinkerOff",O),i.$broadcast("focusOn",O),angular.isArray(S)&&S.length>0){if(a=N(S),a=R(a),a.length<1)return;P(S),u.sendSeenPacket(D,a),v||M||s.startTimerText(r,a),g.sendData(p.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:D.getKey()})}},m.on("click",I),r.$on("$destroy",function(){o.removeCustomEvent(c.CHAT.BOX_CAM_UPLOAD,f),o.removeCustomEvent(c.CHAT.DO_START_SECRET_TIMER,h),o.removeCustomEvent(c.CHAT.WAS_FOCUSED,A),o.removeCustomEvent(c.CHAT.TAB_SYNC_NEW_DATA,C)})}}}var chatApp,ChatRequests,PublicChatRequests;chatApp=angular.module("ringid.chat"),ChatRequests=CHAT_APP.ChatRequests,PublicChatRequests=CHAT_APP.PublicChatRequests,chatMessageDirective.$inject=["Auth","$compile","chatHistoryFactory","$interval","ChatHelper","Utils","userFactory","userService","SystemEvents"];function chatMessageDirective(e,t,n,r,i,o,a,s,c){return{restrict:"A",scope:!0,link:function(r,l,u){var d,g,E,m,T,f=r.$eval(u.messageBox),p=r.$eval(u.messageMsg),_=[],I=[];r.name="chatMessageDirective",f=f.value;function h(){var e;return e=!f.isConsicutive(p.key)}r.message.takeDecisionForShowingMessageUserAvator=h,r.message.showAvator=h(),p.user.isCurrentUser()?(l.addClass("cm-box-r"),"status_update"!==p.status&&(T='<img ng-show="message.showAvator" title="',T+=p.user.getName(),T+='" class="chat-img-r chat-img" src="'+p.user.avatar("thumb")+'" />',d=angular.element(T),g=t(d)(r),l.append(g))):(l.addClass("cm-box"),"status_update"!==p.status&&(T='<img ng-show="message.showAvator" title="',T+=p.user.getName(),T+='" class="chat-img-l chat-img" src="'+p.user.avatar("thumb")+'" />',d=angular.element(T),g=t(d)(r),l.prepend(g)));function A(){var e,t=Math.floor(p.messageDate/864e5);return f.previousDate!==t?(f.previousDate=t,e=!0):e=!1,e}r.message.takeDecisionForShowingDate=A,r.message.showDate=A(),E=angular.element('<div class="line" ng-show="message.showDate"><div class="line-m">{{ message.messageDate | date }}</div></div><div ng-show="message.showDate" class="clear"></div>'),m=t(E)(r),l.prepend(m),r.$on("timeoutDelete",function(t,a,s){var l;if(a===p.key)if(s>0)r.message.timeout=s;else if(l=p.user.getKey(),String(l)===String(e.loginData.utId)){switch(r.message.timeout=0,r.message.secretTimedOut=!0,r.message.messageType){case 2:case 3:case 4:case 5:case 6:r.message.status="Deleted";break;case 8:r.message.status="Played";break;case 7:case 9:case 10:r.message.status="Viewed"}n.updateMessage(r.message,f.getKey())}else i.deleteMessageFromOwn(f,p),o.triggerCustomEvent(c.CHAT.SINGLE_MESSAGE_TIMEOUT,{box:f})}),I.push(r.message.userId),"status_update"===String(r.message.status)&&angular.extend(I,r.message.usersToChange),I.forEach(function(e){var t,n=a.getUser(e);n&&n.hasDetails()||(t=s.register(e,o.debounce(function(){"status_update"===String(r.message.status)&&r.message.refreshStatusMessageText(),r.$rgDigest()},300,!1)),_.push(t))}),r.$on("$destroy",function(){_.forEach(function(e){s.unregister(e)})})}}}chatEditMessage.$inject=["$rootScope"];function chatEditMessage(e){return{restrict:"EA",link:function(t,n,r){var i=CHAT_APP.SharedHelpers;t.name="chatEditMessage",n.on("click",function(){e.$broadcast("editMessageEvent",r.editMessage,t.message),n.parent().parent().parent().addClass("editing-highlight")});function o(e){var t,n=i.getClientTimeFromServerTime(e),r=Math.floor(Date.now()),o=r-n,a=36e5;return t=!(o>a)}t.message.canEdit=function(){return t.message.user.isCurrentUser()&&o(t.message.messageDate)&&[4,6,7,8,9,10].indexOf(t.message.messageType)===-1&&!(t.message.timeout>0||Boolean(t.message.secretTimedOut)===!0)&&["Deleted","status_update","Viewed","Played"].indexOf(t.message.status)===-1}}}}chatRetryMessage.$inject=["ChatPacketSenderService"];function chatRetryMessage(e){return{restrict:"EA",link:function(t,n){t.name="chatRetryMessage";function r(){e.retryMessage(t.box.value,t.message,t.messageData)}n.on("click",r),t.$on("$destroy",function(){n.off("click",r)})}}}chatDeleteMessage.$inject=["Storage","Utils","Auth","ChatConnector","ChatHelper"];function chatDeleteMessage(e,t,n,r,i){return{restrict:"EA",link:function(e,t){e.name="chatDeleteMessage",e.message.canDelete=function(){return!(e.box.value.isPublicChat&&!e.message.isOwner())&&["status_update"].indexOf(e.message.status)===-1};function o(){var t,o,a,s;i.deleteMessageFromOwn(e.box.value,e.message),e.message.user.getKey().toString()===n.loginData.utId.toString()&&0!==e.message.status&&"Pending"!==e.message.statusText&&(t=e.box.value.getKey(),o=[{packetId:e.message.key}],e.box.value.isTagChat?a=ChatRequests.getTagChatMultipleMsgDeleteObject:e.box.value.isPublicChat?a=PublicChatRequests.getPublicChatDeleteMessageObject:(Boolean(e.message.secretTimedOut)!==!0||e.message.timeout>0)&&(e.box.value.sendTabUpdate(e.message),a=ChatRequests.getFriendChatMultipleMsgDeleteObject),a&&(s=a.call(this,t,o),r.send(s)))}t.on("click",o),e.$on("$destroy",function(){t.off("click",o)})}}}chatMessageReact.$inject=[];function chatMessageReact(){return{restrict:"A",link:function(e,t,n){var r=e.$eval(n.chatMessageReact),i=["status_pending","status_delivered","status_seen","status_sent"];e.name="chatMessageReact";function o(){"status_update"===String(r.status)?t.addClass("status_update"):r.user.isCurrentUser()?t.addClass("status_received"):i[r.status]&&t.addClass(i[r.status])}o()}}}sendMessageDirective.$inject=["ChatFactory","$timeout","ChatConnector","tagChatFactory","tagChatManager","$$connector","OPERATION_TYPES","ChatPacketSenderService","ChatHelper","Utils","SystemEvents","Ringalert"];function sendMessageDirective(e,t,n,r,i,o,a,s,c,l,u,d){return{restrict:"A",link:function(e,t){var n=CHAT_APP.Constants.GENERAL_CONSTANTS;e.name="sendMessageDirective",e.messageText="";function r(e){var t,n=0,r={startPos:0,endPos:0,selectionLength:0};return document.selection?(e.focus(),t=document.selection.createRange(),t.moveStart("character",-e.value.length),n=t.text.length,r.selectionLength=n):(e.selectionStart||"0"===String(e.selectionStart))&&(n=e.selectionStart,r.startPos=e.selectionStart,r.endPos=e.selectionEnd,r.selectionLength=Math.abs(e.selectionStart-e.selectionEnd)),r}function i(e,t,n){var r,i,o=e.value;return e.value=e.value,null!==e&&(e.createTextRange?(i=e.createTextRange(),e.value=o.slice(0,t.startPos)+n+o.slice(t.endPos),i.move("character",t.startPos+n.length),i.select(),r=!0):e.selectionStart||0===e.selectionStart?(e.focus(),e.value=o.slice(0,t.startPos)+n+o.slice(t.endPos),e.setSelectionRange(t.startPos+n.length,t.startPos+n.length),r=!0):(e.focus(),r=!1)),r}e.selectedLocation=function(){l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()}),l.getUserLocation().then(function(t){t.sucs?(e.messageData.locationData=t,t.lat&&9999!==t.lat&&s.sendMessage(e.box.value,"",n.MESSAGE_TYPES.LOCATION_SHARE,e.messageData),e.$rgDigest()):d.show({mg:"Please Enable Browser Location Tracking."},"error"),e.resetMessageInput(!0)})},e.selectEmoticonChat=function(n){n.isSticker()||n.isLargeEmoticon()?(e.resetMessageInput(),s.sendMessage(e.box.value,n.srcWithoutBase(),6),l.triggerCustomEvent(u.CHAT.MESSAGE_SUBMITTED,{boxId:e.box.value.getKey()}),e.messageText="",l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()})):(e.messageText=e.messageText+""+n.symbol(),t[0].focus())};function o(n){var o,a,c;13===n.which&&n.ctrlKey&&(a=t[0],c=r(a),i(a,c,"\n"),e.messageText=a.value),13!==n.which||13===n.which&&n.ctrlKey?E():(t.attr("messageKey")&&(e.box.value.editMessageKey=t.attr("messageKey"),t.removeAttr("messageKey"),e.box.value.editMessageDate=t.attr("messageDate"),t.removeAttr("messageDate"),t.removeClass("editing"),t.removeClass("editing-highlight")),o=s.getMessageType(e.messageData),""!==e.messageText&&(e.messageText=e.messageText.replace(/^\s+|\s+$/g,""),e.messageText=e.messageText.replace(/\n\n+/g,"\n\n"),e.box.value.editMessageKey||l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()}),s.sendMessage(e.box.value,e.messageText,o,e.messageData),e.resetMessageInput(!0),l.triggerCustomEvent(u.CHAT.MESSAGE_SUBMITTED,{boxId:e.box.value.getKey()})))}function a(){}function c(e){13!==e.which||13===e.which&&e.ctrlKey||(e.preventDefault(),e.stopPropagation())}function g(){e.box.value.isTyping()===!1&&(s.sendTypingPacket(e.box.value),e.box.value.setTypingBool(!0),setTimeout(function(){e.box.value.setTypingBool(!1),l.triggerCustomEvent(u.CHAT.BOX_UPDATED,{boxId:e.box.value.getKey()})},5e3))}function E(){e.box.value.isTagChat||e.box.value.isPublicChat?g():e.box.value.offlineStatus===!1&&g()}t.on("keyup",a),t.on("keypress",c),t.on("keydown",o),e.$on("$destroy",function(){t.off("keyup",a),t.off("keypress",c),t.off("keydown",o)}),e.box.value.isFocused===!0&&t[0].focus(),e.$on("editMessageEvent",function(r,i,o){if(String(e.box.value.getKey())===String(i)){switch(o.messageType){case n.MESSAGE_TYPES.TEXT:e.messageText=o.text;break;case n.MESSAGE_TYPES.LOCATION_SHARE:e.locationData=o.locationInfo;break;case n.MESSAGE_TYPES.LINK_SHARE:e.messageText=o.ogData.message||o.ogData.description}t.addClass("editing"),t.attr("messageKey",o.key),t.attr("messageDate",o.messageDate),l.safeDigest(e),t[0].focus()}})}}}chatImage.$inject=["Utils","SystemEvents"];function chatImage(e,t){return{restrict:"A",link:function(n,r,i){n.name="chatImage",r[0].onload=function(){n.message.scroll&&e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:i.boxid})},r[0].src=i.chatimgsrc}}}chatApp.directive("messageDirective",chatMessageDirective),chatApp.directive("editMessage",chatEditMessage),chatApp.directive("retryMessage",chatRetryMessage),chatApp.directive("deleteMessage",chatDeleteMessage),chatApp.directive("chatMessageReact",chatMessageReact),chatApp.directive("sendMessageDirective",sendMessageDirective),chatApp.directive("chatImage",chatImage);var chatApp;chatApp=angular.module("ringid.chat"),chatApp.directive("setTimeout",["ChatFactory","$compile","$document",function(e,t,n){return{restrict:"EA",template:'<a><span class="img_sprite w-h-16 timmer-ico"></span></a>',link:function(e,r){var i,o;e.name="setTimeoutDirective";function a(){e.showTimeout=!0,e.closeSettingPopup(),n.bind("click",s),o=angular.element("<set-timeout-bar ></set-timeout-bar>"),i=t(o)(e),r.parent().next().prepend(i)}function s(){e.showTimeout=!1,n.unbind("click",s),i&&i.remove()}e.closeTimeoutPopup=s,e.showTimeout=!1;function c(t){e.showTimeout?s():a(),t.stopPropagation()}r.on("click",c),e.$on("$destroy",function(){r.off("click",c)})}}}]).directive("setTimeoutBar",["ChatFactory","$compile",function(e,t){return{restrict:"EA",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="enable-secret-chat">Enable Secret Chat:</span><div class="switchnew">\n<input class="float-left" ng-model="box.value.secretChat" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n<a href="#" ng-click="showValueBox($event)" class="img_sprite timeout-sec icon-time"><p>sec</p><span>{{ timeout>4 ? timeout : 5}}</span></a></div></div>',link:function(e,n){var r,i;e.name="setTimeoutBarDirective",e.timeout=e.box.value.timeout,e.showTimeoutBox=!1,e.cancel=function(t){e.closeTimeoutPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.showValueBox=function(o){e.showTimeoutBox?e.hideValueBox():(e.showTimeoutBox=!0,i=angular.element("<set-timeout-Value ></set-timeout-Value>"),r=t(i)(e),n.children(0).append(r)),o&&(o.preventDefault(),o.stopPropagation())},e.hideValueBox=function(t){e.showTimeoutBox=!1,r&&r.remove(),t&&(t.preventDefault(),t.stopPropagation())};function o(e){e.stopPropagation()}n.on("click",o),e.$on("$destroy",function(){n.off("click",o)})}}}]);var chatApp;chatApp=angular.module("ringid.chat"),chatApp.directive("setting",["ChatFactory","$compile","$document",function(e,t,n){return{restrict:"EA",template:'<a><span class="img_sprite icon-g-settings"></span></a>',link:function(e,r){var i,o,a=function(){e.showSetting=!0,e.closeTimeoutPopup(),n.bind("click",s),o=angular.element("<setting-bar ></setting-bar>"),i=t(o)(e),r.parent().parent().parent().next().prepend(i)},s=function l(){e.showSetting=!1,n.unbind("click",l),i&&i.remove()};e.closeSettingPopup=s,e.showSetting=!1,e.name="setting";function c(t){e.showSetting?s():a(),t.stopPropagation()}r.on("click",c),e.$on("$destroy",c)}}}]).directive("settingBar",["ChatFactory","$compile","profileFactory","tagChatFactory","ChatUtilsFactory","Auth","ChatConnector","PLATFORM",function(e,t,n,r,i,o){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="secret-visible">Timer:</span><div class="switch-secret-visible"><input class="float-left" ng-model="box.value.isSecretVisible" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-16 correct-sec icon-close-b"></a>\n</div></div>',link:function(e,t){var n=(CHAT_APP.SharedHelpers,CHAT_APP.UTILS.getUUIDPacketId,o.currentUser());n.getUtId();e.name="settingsbar";e.cancel=function(t){e.closeSettingPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.blockUnblock=function(e){};function r(e){e.stopPropagation()}t.on("click",r),e.$on("$destroy",function(){t.off("click",r)})}}}]),angular.module("ringid.chat").directive("rgTagChatList",function(){return{restrict:"E",scope:{boxClose:"&"},templateUrl:function(e,t){return t.templatePath},link:function(e,t,n){n.shareData&&(e.shareData=n.shareData),e.$rgDigest()}}}),function(e,t){"use strict";e.module("ringid.sticker",["ringid.config"])}(angular,window),angular.module("ringid.sticker").factory("StickerHelper",StickerHelper),StickerHelper.$inject=["STICKER_IMAGE_TYPE","$$stickerMap"];function StickerHelper(e,t){var n=function(n,r,i){var o,a,s,c;return o={type:e.STICKER,imageList:[]},a=n.imagesList,angular.isArray(a)&&(s=a[0].sCtId,c=i[s],c&&(o.collectionId=c.getCollectionId(),o.categoryId=s,angular.forEach(a,function(n){o.imageList.push({name:n.imUrl,type:e.STICKER,id:n.imId}),r[n.sCtId]=t.create(o)}))),r};return{parseCategoryStickerData:n}}angular.module("ringid.sticker").controller("StickerPageController",StickerPageController),StickerPageController.$inject=["$scope","$routeParams","$location","StickerFactory","Utils","SystemEvents","routeService"];function StickerPageController(e,t,n,r,i,o,a){var s,c,l=2,u=0,d=10,g=5,E=[];e.pageStickers=[],e.popularCategories=[],e.newCategories=[],e.allCategories=[],e.myStickers=[],e.allCollections={},e.languages=[],e.loading=!0,e.type=e.type||t.type||"home",e.typeId=t.id,e.getCollectionCategoryObjects=_,e.setCategoryType=I,e.addSticker=H,e.removeSticker=x,e.isInstalled=Y,e.loadMoreItems=k,e.loadMoreButtonHide=!0,e.goTo=w,e.goBack=G;function m(){e.allCategories=r.getRandomStickerCategories(4),e.allCategories.length>1?(e.loadMoreButtonHide=!1,c=r.getMyStickerCatIds().length,C()):e.$rgDigest()}setTimeout(function(){e.loading=!1},6e4),m(),r.isStickerDataFetched()||(s=i.onCustomEvent(o.STICKER.DO_INIT,function(){m()})),e.isHomeTab=T;function T(){return"home"===e.type||"collections"===e.type||"languages"===e.type}e.isCategoryTab=f;function f(){return"language"===e.type||"collection"===e.type||"details"===e.type}e.isLanguageTab=p;function p(){return"single"===e.type}function _(e){var t=r.getCollectionCategoryObjects(e);return t}function I(t){e.type=t}function h(t,n){var i={};if(parseInt(t,10)>0)n||(i.sticker=r.getStickerCategoryObject(e.typeId),i.title="Stickers Details");else switch(t){case"popular":n?R():(i.stickers=r.getStickerCategories(t),i.title="Popular Stickers");break;case"new":n?N():(i.stickers=r.getStickerCategories(t),i.title="New Stickers");break;case"all":n?P():(i.stickers=r.getStickerCategories(t),i.title="All Stickers");break;case"mystickers":n?b():(i.stickers=[],r.getMyStickerCategoryObjects(u,d).then(function(t){e.pageStickers=t,c===t.length&&(e.loadMoreButtonHide=!0),e.$rgDigest()},null,function(t){e.pageStickers=t,e.pageBanner||(e.pageBanner=$(e.pageStickers)),e.$rgDigest()}),i.title="My Stickers")}return i}function A(){!e.loadMoreButtonHide&&"mystickers"!==e.typeId&&e.pageStickers&&e.pageStickers.length<d&&k()}function C(t){var n;switch(e.type){case"home":v();break;case"collections":t?U():M();break;case"languages":t?L():D();break;case"details":n=h(e.typeId,t),t||(e.pageStickers=n.stickers,e.pageTitle=n.title,e.pageBanner=$(e.pageStickers),A());break;case"single":n=h(e.typeId,t),t||(e.pageSticker=n.sticker,e.pageTitle=n.title,A());break;case"collection":e.typeId=parseInt(e.typeId,10),t?y(e.typeId):(e.pageCollection=r.getCollection(e.typeId),e.pageCollection&&(e.pageStickers=e.getCollectionCategoryObjects(e.pageCollection)),A()),e.pageTitle=e.pageCollection.getName(),e.pageBanner=$(e.pageStickers);break;case"language":e.typeId=e.typeId,t?F(e.typeId):(e.pageCollection=r.getLanguageCollection(e.typeId),e.pageCollection&&(e.pageStickers=e.getCollectionCategoryObjects(e.pageCollection)),e.pageTitle=e.pageCollection.getName(),e.pageBanner=$(e.pageStickers),A())}e.loading=!1,e.$rgDigest()}function S(){e.myStickerCategories=[],r.getMyStickerCategoryObjects(0,d).then(function(t){e.myStickerCategories=t,e.$rgDigest()},function(){},function(t){e.myStickerCategories=t,e.$rgDigest()})}function v(){e.popularCategories=angular.copy(r.getStickerCategories("popular")),e.newCategories=angular.copy(r.getStickerCategories("new")),e.allCategories=angular.copy(r.getStickerCategories("all")),S(),i.shuffleArray(e.newCategories).splice(0,l),i.shuffleArray(e.popularCategories).splice(0,l)}function M(){e.allCollections=r.getCollections()}function D(){e.allLanguages=r.getStickerByLanguageList()}function O(t){t.then(function(t){t.noMoreData&&(e.loadMoreButtonHide=!0),C()})}function R(){var t=r.getStickerCategories(e.typeId).length,n=r.getMorePopularCategories(t-1);O(n)}function N(){var t=r.getStickerCategories(e.typeId).length,n=r.getMoreNewCategories(t-1);O(n)}function P(){var t=r.getStickerCategories(e.typeId).length,n=r.getMoreAllCategories(t-1);O(n)}function y(){var t=r.getMoreStickerByCollectionId(e.allCollections.length-1);O(t)}function b(){d+=g,C()}function U(){var t=r.getMoreCollections(e.allCollections.length-1);O(t)}function L(){var t=r.getMoreLanguages(e.allLanguages.length-1);O(t)}function F(){var t=r.getMoreCategoriesByLanguage(e.typeId,e.pageStickers.length-1);O(t)}function k(){e.loading=!0,e.$rgDigest(),C(!0)}function w(t){var r,i;e.popup?(E.push(e.currentState),e.currentState=t,i=a.getRouteByUrlPath(t),r=a.extractRouteParams(t,i),e.type=r.type||"home",e.typeId=r.id,C()):n.path(t)}function G(){return e.popup?w(E.pop()):history.back(-1),!1}function B(t){var n,r;for(n=0,r=e.pageStickers.length;n<r;n++)if(e.pageStickers[n].getKey()===t){e.pageStickers.splice(n,1);break}}function $(e){var t=i.getRandomItem(e);return t?t.getBannerImageUrl():""}function H(t){r.addMySticker(t.getKey()).then(function(){S(),e.$rgDigest()}),S(),e.$rgDigest()}function x(t){r.removeMySticker(t.getKey()).then(function(){S(),e.$rgDigest()}),"mystickers"===e.typeId&&B(t.getKey()),S(),e.$rgDigest()}function Y(e){return r.isDownloaded(e)}e.$on("$destroy",function(){s&&i.removeCustomEvent(o.STICKER.DO_INIT,s)})}angular.module("ringid.sticker").controller("StickerPopupController",StickerPopupController),StickerPopupController.$inject=["$boxInstance","$controller","localData","$scope","StickerFactory"];function StickerPopupController(e,t,n,r){r.close=i;function i(t){e.close(),t&&(t.preventDefault(),t.stopPropagation())}r.popup=!0,r.type="home",r.currentState="/sticker",t("StickerPageController",{$scope:r})}angular.module("ringid.sticker").factory("StickerCategoryModel",StickerCategoryModel),StickerCategoryModel.$inject=["settings"];function StickerCategoryModel(e){return{keyString:"sCtId",getKeyString:function(){return StickerCategoryModel.keyString},create:function(t){var n={sCtId:0,sctName:"",sClId:0,cgBnrImg:"",rnk:1,dtlImg:"details.png",thmColor:"",txtColor:"",cgNw:0,icn:"icon.png",bnrImg:"banner.png",prz:0,free:0,dcpn:""};function r(e){var t=angular.extend({},n,e);return t}return angular.isObject(t)&&(n=r(t)),{getCategoryId:function(){return n.sCtId},setCategoryId:function(e){n.sCtId=e},getCollectionId:function(){return n.sClId},setCollectionId:function(e){n.sClId=e},getKey:function(){return this.getCategoryId()},setKey:function(e){this.setCategoryId(e)},getName:function(){return n.sctName||n.sCtName},setName:function(e){n.sctName=e},getTextColor:function(){return n.txtColor},setTextColor:function(e){n.txtColor=e},getBannerImage:function(){return n.bnrImg},setBannerImage:function(e){n.cgBnrImg=e},getBannerImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getBannerImage();return t},getRank:function(){return n.rnk},setRank:function(e){n.rnk=e},getDetailImage:function(){return n.dtlImg},getDetailImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getDetailImage();return t},setDetailImage:function(e){n.dtlImg=e},getNewCategory:function(){return n.cgNw},setNewCategory:function(e){n.cgNw=e},getIconImage:function(){return n.icn},setIconImage:function(e){n.icn=e},getIconImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getIconImage();return t},getCaptionImageUrl:function(t){var n=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/";return n+=t?"ca.png":"c.png"},getPrice:function(){return n.prz},setPrice:function(e){n.prz=e},isFree:function(){return n.free},setIsFree:function(e){n.free=e},getDescription:function(){return n.dcpn},setDescription:function(e){n.dcpn=e},getThumbColor:function(){return n.thmColor},setThumbColor:function(e){n.thmColor=e}}}}}angular.module("ringid.sticker").factory("StickerCollectionModel",StickerCollectionModel),StickerCollectionModel.$inject=["settings"];function StickerCollectionModel(e){return{create:function(t){var n={sClId:0,name:"",txtColor:"",bnrImg:"banner.png",thmColor:"",catIds:[],categories:[]};function r(e){var t=angular.extend({},n,e);return t}return angular.isObject(t)&&(n=r(t)),{getId:function(){return n.sClId},setId:function(e){n.sClId=e},getKey:function(){return this.getId()||this.getName().toLowerCase()},setKey:function(e){this.setId(e)},getName:function(){return n.name},setName:function(e){n.name=e},getTextColor:function(){return n.txtColor},setTextColor:function(e){n.txtColor=e},getBannerImage:function(){return n.bnrImg},setBannerImage:function(e){n.bnrImg=e},getBannerImageUrl:function(){var t=e.stickerBase+this.getId()+"/"+this.getBannerImage();return t},getThumbColor:function(){return n.thmColor},setThumbColor:function(e){n.thmColor=e},addCategories:function(e){n.categories.push(e)},removeCategories:function(e){n.categories.splice(e,1)},getCategories:function(){return n.categories},getCatIds:function(){return n.catIds}}}}}angular.module("ringid.sticker").service("stickerHttpService",stickerHttpService),stickerHttpService.$inject=["$ringhttp","$$connector","settings","OPERATION_TYPES"];function stickerHttpService(e,t,n,r){var i=r.STICKER,o=r.SYSTEM.REQUEST_TYPE,a=this;a.go=s;function s(t,n,r){return e[n||"get"](t,r||[])}a.getAll=c;function c(){var e=n.stickerApi+"all=1";return a.go(e)}a.getStickerCategoriesByCollectionId=l;function l(e){var t=n.stickerApi+"collectionId="+e;return a.go(t)}a.getStickersByCatId=u;function u(e){var t=n.stickerApi+"categoryId="+e;return a.go(t)}a.getMyStickers=d;function d(){var e={actn:i.GET_MY_STICKER};return t.request(e,o.REQUEST)}a.getStickerCategoryNames=g;function g(e){var t=JSON.stringify(e),r=n.stickerApiBase+"StickerName?catIds="+t;return a.go(r)}a.addSticker=E;function E(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.ADD_JT_VALUE};return t.request(n,o.UPDATE)}a.removeSticker=m;function m(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.REMOVE_JT_VALUE};return t.request(n,o.UPDATE)}}angular.module("ringid.sticker").service("stickerHttpServiceV2",stickerHttpServiceV2),stickerHttpServiceV2.$inject=["$ringhttp","$$connector","settings","Auth"];function stickerHttpServiceV2(e,t,n,r){var i=this,o=5,a=5,s={FREE:1,ALL:2,NEW:3,POPULAR:5,COLLECTION:10,COLLECTION_BY_ID:11,LANGUAGE:20,LANGUAGE_BY:21};i.go=c;function c(t,n,r){return e[n||"get"](t,r||[])}i.getNewStickerCounterUrl=l;function l(){return n.stickerV2Api.replace("StickerHandler?","NewStickerCounter")}i.getAddMyStickerUrl=u;function u(){return n.stickerV2Api.replace("StickerHandler?","StickerDownload")}i.getAll=d;function d(e,t){var r,s=e,c=t;return s||(s=a),c||(c=o),r=n.stickerV2Api+"sum&lmt="+s+"&cLmt="+c,i.go(r)}function g(e,t,r,i,s,c){var l,u=r,d=i,g=t;return e?(g||(g=0),u||(u=a),d||(d=o),l=n.stickerV2Api+"lm&frm="+g+"&lmt="+u+"&cLmt="+d+"&type="+e,s&&(l+="&cId="+s),c&&(l+="&lng="+c),l):l}i.getMoreItems=E;function E(e,t,n,r,o,a){var s=g(e,t,n,r,o,a);return i.go(s)}i.getMoreFreeCategories=m;function m(e,t,n){return E(s.FREE,e,t,n)}i.getMoreAllCategories=T;function T(e,t,n){return E(s.ALL,e,t,n)}i.getMoreNewCategories=f;function f(e,t,n){return E(s.NEW,e,t,n)}i.getMorePopularCategories=p;function p(e,t,n){return E(s.POPULAR,e,t,n)}i.getMoreCollections=_;function _(e,t,n){return E(s.COLLECTION,e,t,n)}i.getMoreCategoriesByCollectionId=I;function I(e,t,n){return E(s.COLLECTION_BY_ID,t,n,null,e)}i.getMoreLanguages=h;function h(e,t,n){return E(s.LANGUAGE,e,t,n)}i.getMoreCategoriesByLanguage=A;function A(e,t,n){return E(s.LANGUAGE_BY,t,n,null,null,e)}i.addSticker=C;function C(e){var t=u(),n={utID:r.currentUser().getUtId(),authIP:Cookies.get("authServer"),authPort:Cookies.get("comPort"),sID:Cookies.get("sId"),sCatID:e};return i.go(t,"post",JSON.stringify(n))}i.getNewStickerInfos=S;function S(){var e=l();return i.go(e)}}angular.module("ringid.sticker").factory("StickerFactory",StickerFactory).factory("$$stickerMap",$$stickerMapDefination).factory("$$stickerImageMap",$$stickerImageMapDefnation),$$stickerImageMapDefnation.$inject=["settings","STICKER_IMAGE_TYPE"];function $$stickerImageMapDefnation(e,t){return{create:function(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};return{getKey:function(){return o.id},src:function(){return o.src},symbol:function(){return o.symbol},getName:function(){return o.name},srcWithoutBase:function(){return o.src.replace(e.stickerBase,"")},isEmoticon:function(){return o.isEmoticon},isLargeEmoticon:function(){return o.isLargeEmoticon},isSticker:function(){return o.isSticker}}}}}$$stickerMapDefination.$inject=["$$stackedMap","$$stickerImageMap","settings"];function $$stickerMapDefination(e,t,n){return{create:function(r,i){var o,a,s,c;for(o=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",c={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+o+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":o+"ca.png",installed:i||!1},s=0;s<r.imageList.length;s++)a=t.create(r.imageList[s],c.type,o),c.imageListMap.add(a.getKey(),a);return{sortBy:function(){return c.categoryId},isInstalled:function(){return c.installed},setInstalled:function(e){c.installed=e},isEmoticon:function(){return c.isEmoticon},isLargeEmoticon:function(){return c.isLargeEmoticon},isSticker:function(){return c.isSticker},getKey:function(){return c.categoryId},getImages:function(){return c.imageListMap},getType:function(){return c.type},link:function(){return c.regularUrl},hoverLink:function(){return c.hoverUrl}}}}}StickerFactory.$inject=["$$stackedMap","$$stickerMap","stickerHttpService","stickerHttpServiceV2","StickerEmoticonFactory","StickerHelper","StickerCategoryModel","StickerCollectionModel","STICKER_IMAGE_TYPE","$$q","Storage","settings","SystemEvents","Utils"];function StickerFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,E){var m,T="stickerData",f="myStickers",p="newStickerInfo",_={},I={},h={free:[],"new":[],top:[],all:[],popular:[]},A={},C={},S={},v=i.getAllEmoticons(),M=t.create(v,!0),D={},O={},R=d.stickerApiVersion,N=!1,P=!1;function y(e){var t=l.defer();return I[e]||n.getStickersByCatId(e).success(function(e){e&&e.sucs===!0&&(o.parseCategoryStickerData(e,I,_),
t.resolve(e))}).error(function(e){t.reject(e)}),t.promise}function b(e){var t,n=e.getCatIds();try{angular.isArray(n)&&angular.forEach(n,function(n){t=_[n],t&&e.addCategories(t.getKey())})}catch(r){}}function U(e,t,n){var i,o;r.getMoreCategoriesByCollectionId(e,t,n).success(function(e){e.sucs&&(A[e.col.sClId]||(o=s.create(e.col),A[o.getKey()]=o),angular.forEach(e.catList,function(e){i=a.create(e),_[i.getKey()]=i}),b(o))})}function L(e){var t={fCat:"free",allCat:"all",nCat:"new",pCat:"popular"},n={};return angular.forEach(t,function(t,r){angular.forEach(e[r],function(e){n[e]||(n[e]=[]),n[e].push(t)})}),n}function F(e,t){return t[e]}function k(e){var t,n,r,i=L(e);try{angular.forEach(e.catList,function(e){t=a.create(e),_[t.getKey()]=t,r=F(t.getKey(),i),angular.forEach(r,function(e){h[e].push(t)})})}catch(o){}try{angular.forEach(e.colList,function(e){n=s.create(e),A[n.getKey()]=n,b(n)})}catch(o){}try{angular.forEach(e.langLst,function(e){n=s.create(e),C[n.getKey()]=n,b(n)})}catch(o){}Z()}function w(){r.getAll().success(function(e){try{e&&e.sucs===!0&&(B(e),k(e),V(),E.triggerCustomEvent(g.STICKER.DO_INIT))}catch(t){}})}function G(){try{return u.getData(T)}catch(e){return!1}}function B(e){e.apiVersion=R,u.setData(T,e)}function $(e){u.setData(p,e)}function H(){u.setData(f,S)}function x(){S=u.getData(f)||{}}function Y(){D=u.getData(p)||{}}function K(e){e&&e.ids&&(e.ids.forEach(function(e){O[e]=!0}),m=e.nc)}function j(){Y(),K(D),r.getNewStickerInfos().success(function(e){try{e&&e.nc&&($(e),K(e),E.triggerCustomEvent(g.STICKER.NEW_STICKER_INFO_UPDATED))}catch(t){}})}function V(){var e;x(),P&&S||n.getMyStickers().then(function(t){t.sucs===!0&&n.getStickerCategoryNames(t.catIds).success(function(t){t.sucs===!0&&(S={},angular.forEach(t.catList,function(t){parseInt(t.sClId,10)>0&&parseInt(t.sCtId,10)>0&&(e=a.create(t),_[e.getKey()]=e,S[e.getKey()]=1)}),H())})})}function W(e){var t,r=l.defer(),i=parseInt(e,10),o=r.promise;return _[i]?o=_[i]:n.getStickerCategoryNames([i]).success(function(e){e.sucs===!0&&e.catList.length>0&&(t=a.create(e.catList[0]),_[t.getKey()]=t,o=r.resolve(t))}).error(function(){o=r.reject({})}),l.when(o)}function q(e){try{k(e)}catch(t){}}function z(e){try{return _[e]}catch(t){return{}}}function Q(e){return E.shuffleArray(Object.keys(_)).splice(0,e)}function X(e){var t=[],n=Q(e);return n.forEach(function(e){t.push(_[e])}),t}function Z(){N=!0}function J(){return N}function ee(e){var t=e.getCategories(),n=[];return t.forEach(function(e){n.push(_[e])}),n}function te(){var e=Object.keys(A),t=[];return e.forEach(function(e){t.push(A[e])}),t}function ne(){var e=Object.keys(C),t=[];return e.forEach(function(e){t.push(C[e])}),t}function re(e){var t,n=[];return e||(t=Object.keys(_),t.forEach(function(e){n.push(_[e])})),n}function ie(){return Object.keys(_)}function oe(e){var t=l.defer();return I[e]?t.resolve(I[e]):y(e).then(function(){t.resolve(I[e])},function(e){t.reject(e)}),t.promise}function ae(e,t){var n=l.defer(),r=e,i=t,o=Object.keys(S),a=n.promise,s=[];return r||(r=0),i||(i=10),o=o.sort().slice(r,r+i),o.forEach(function(e){W(e).then(function(){s.push(_[e]),n.notify(s),s.length===o.length&&(a=n.resolve(s))})}),l.when(a)}function se(){return S?Object.keys(S):[]}function ce(){var e,t=se();return e=0!==t.length?t[0]:h.free[0].getKey(),oe(e)}function le(e){var t=l.defer(),i=parseInt(e,10);try{S[i]=1,H(),I[i]&&I[i].setInstalled(!0)}catch(o){}return n.addSticker({catId:i}).then(function(e){e.sucs||(I[i]&&I[i].setInstalled(!1),delete S[i],t.resolve({sucs:!1})),r.addSticker(parseInt(i,10)),t.resolve({sucs:!0})},function(){delete S[i],I[i]&&I[i].setInstalled(!1),t.resolve({sucs:!1})}),t.promise}function ue(e){var t=l.defer(),r=S[e];try{delete S[e],H(),I[e]&&I[e].setInstalled(!1)}catch(i){}return n.removeSticker({catId:parseInt(e,10)}).then(function(n){n.sucs!==!0&&(S[e]=1,I[e]=r,I[e].setInstalled(!0),t.resolve({sucs:!1})),r=null,t.resolve({sucs:!0})},function(){S[e]=1,I[e]&&(I[e]=r,I[e].setInstalled(!0)),r=null,t.resolve({sucs:!1})}),t.promise}function de(e){var t;e===!0?w():(t=G(),angular.isObject(t)&&t.apiVersion===R?(q(t),V(),E.triggerCustomEvent(g.STICKER.DO_INIT)):w()),j()}function ge(){return S?Object.keys(S).length:0}function Ee(e){return e?h[e]:h}function me(){return A}function Te(e){return C[e]}function fe(e){return A[e]}function pe(e){return!!S[e]}function _e(e){return z(e)}function Ie(){return M}function he(){return n.getMyStickers()}function Ae(e,t,n){var r=l.defer();return e.apply(null,t).success(function(e){var t=!e.sucs;e.sucs&&(k(e),e[n]&&e[n].length<5&&(t=!0)),r.resolve({sucs:e.sucs,noMoreData:t})}),r.promise}function Ce(e){var t=r.getMoreCollections;return Ae(t,[e],"colList")}function Se(e){var t=r.getMoreLanguages;return Ae(t,[e],"langLst")}function ve(e){r.getMoreCategories(e)}function Me(e){var t=r.getMorePopularCategories;return Ae(t,[e],"pCat")}function De(e){var t=r.getMoreNewCategories;return Ae(t,[e],"nCat")}function Oe(e){var t=r.getMoreAllCategories;return Ae(t,[e],"allCat")}function Re(e,t){var n=r.getMoreCategoriesByLanguage;return Ae(n,[e,t],"catList")}function Ne(e){var t=r.getMoreCategoriesByCollectionId;return Ae(t,[e],"catList")}function Pe(e){return!!S[e]}function ye(){return m}function be(e){return!!O[e]}return{initStickerData:de,getStickerCategories:Ee,getStickerCollections:me,getLanguageCollection:Te,getCollection:fe,getStickerMapByCatId:oe,isDownloaded:pe,getStickerCategoryObject:_e,getEmoticonMap:Ie,getDefaultStickerMap:ce,loadCollectionCategories:U,getRandomStickerCategories:X,getRandomStickerCategoryIds:Q,setStickerDataFetched:Z,isStickerDataFetched:J,getCollections:te,getCollectionCategoryObjects:ee,getStickerByLanguageList:ne,getAllCategories:re,getAllCategoryIds:ie,isMySticker:Pe,getNoOfMyStickers:ge,getMyStickerCatIds:se,getMyStickers:he,getMyStickerCategoryObjects:ae,addMySticker:le,removeMySticker:ue,getMoreStickerByCollectionId:Ne,getMoreCollections:Ce,getMoreCategories:ve,getMoreLanguages:Se,getMorePopularCategories:Me,getMoreNewCategories:De,getMoreAllCategories:Oe,getMoreCategoriesByLanguage:Re,getNewStickerCount:ye,isNewSticker:be}}angular.module("ringid.sticker").directive("rgStickerCategory",rgStickerCategory),rgStickerCategory.$inject=["StickerFactory"];function rgStickerCategory(e){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category.html",scope:{categories:"=categories"},link:function(t){t.getStickerCategory=e.getStickerCategoryObject,t.showPreview=n;function n(e){return function(){return{stickerKey:e}}}t.isInstalled=r;function r(t){return e.isDownloaded(t)}t.addSticker=i;function i(n){e.addMySticker(n),t.$rgDigest()}t.removeSticker=o;function o(n){e.removeMySticker(n),t.$rgDigest()}}}}angular.module("ringid.sticker").directive("rgStickerCategoryList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category-list.html",scope:{categories:"=categories"}}});var app=angular.module("ringid.sticker");app.directive("rgStickerPageCategoryList",rgStickerCategoryList),rgStickerCategoryList.$inject=["StickerFactory"];function rgStickerCategoryList(e){return{restrict:"EA",templateUrl:"templates/sticker/sticker-page-category-list.html",scope:{categoryName:"@",categorySlug:"@",categoryItems:"=",showIcon:"@",goTo:"&"},link:function(t){t.isNewSticker=e.isNewSticker}}}app.directive("rgStickerCategoryDetails",rgStickerCategoryDetails);function rgStickerCategoryDetails(){return{restrict:"EA",templateUrl:"templates/sticker/category.html"}}app.directive("rgStickerCategoryDetail",rgStickerCategoryDetail);function rgStickerCategoryDetail(){return{restrict:"EA",templateUrl:"templates/sticker/detail.html"}}app.directive("rgStickerTabs",rgStickerTabs);function rgStickerTabs(){return{restrict:"EA",templateUrl:"templates/sticker/tabs.template.html"}}angular.module("ringid.sticker").directive("rgStickerCollectionList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-collection-list.html",scope:{collections:"="},link:function(e){e.currentCollectionIdToShow=0,e.shouldShowCollectionCategories=t;function t(t){return e.currentCollectionIdToShow===t}e.showCollectionCategories=n;function n(t){e.displayingCollections=!e.displayingCollections,e.currentCollectionIdToShow=t,e.$rgDigest()}e.displayingCollections=!0}}}),function(e,t){"use strict";e.module("ringid.controllers",["ringid.config"])}(angular,window),angular.module("ringid.controllers").controller("AlbumlistController",AlbumlistController),AlbumlistController.$inject=["APP_CONSTANTS","$scope","Media","Ringalert","OPERATION_TYPES","$$connector","$ringbox","fileUploadService"];function AlbumlistController(e,t,n,r,i,o,a,s){var c,l,u=i.SYSTEM.MEDIA,d=[],g=e;t.selectedAlbum=null,t.albumName="",t.media=t.params.media,t.selectAlbum=m,t.createAlbumPopup=E,t.existsInAlbum=function(e){return t.selectedAlbum?t.selectedAlbum.getId()===e||d.indexOf(e)>-1:d.indexOf(e)>-1},t.addToAlbum=function(){t.media&&t.selectedAlbum?t.selectedAlbum.addNewContent(t.media):t.selectedAlbum&&s.setUploadAlbum(t.selectedAlbum.getId()),t.close()},t.getAlbums=function(){return n.getAlbums(!0,c)};function E(){var e=a.open({type:"remote",resolve:{localData:{mdaT:"audio"===c?g.NEWS_FEED_MEDIA_TYPE_AUDIO:g.NEWS_FEED_MEDIA_TYPE_VIDEO}},scope:!1,controller:"AlbumCreateController",templateUrl:"templates/popups/create-album-popup.html"});e.result.then(function(e){e&&(t.selectedAlbum=e,t.$rgDigest())})}function m(e){switch(e.action){case"select":if(t.selectedAlbum&&t.selectedAlbum.getKey()===e.albumMap.getKey())break;d.indexOf(e.albumMap.getKey())>-1?t.selectedAlbum=null:t.selectedAlbum=e.albumMap}t.$rgDigest()}function T(){n.init(),l=o.subscribe(function(){setTimeout(function(){t.$rgDigest()},500)},{action:[u.ACTION_MEDIA_ALBUM_LIST]}),t.media?(c=t.media.isAudio()?"audio":"video",n.makeApiCall("mediaInAlbums",{strmURL:t.media.getStreamUrlOnly()}).then(function(e){e.sucs===!0&&(d=e.albIds,t.$rgDigest())})):c=t.params.mediaType}T(),t.$on("$destroy",function(){o.unsubscribe(l)})}angular.module("ringid.controllers").controller("AlbumCreateController",AlbumCreateController),AlbumCreateController.$inject=["$scope","Media","APP_CONSTANTS","$boxInstance","localData"];function AlbumCreateController(e,t,n,r,i){e.albumName="",e.createAlbum=function(){e.albumName.length>0&&t.createAlbum({albn:e.albumName,mdaT:i.mdaT},!0).then(function(e){e&&r.close(e)})}}angular.module("ringid.controllers").controller("RingBoxAlbumlistController",RingBoxAlbumlistController),RingBoxAlbumlistController.$inject=["$scope","$boxInstance","$controller","localData"];function RingBoxAlbumlistController(e,t,n,r){e.close=t.close,e.params=r,n("AlbumlistController",{$scope:e})}angular.module("ringid.controllers").controller("RingBoxConfirmController",RingBoxConfirmController),RingBoxConfirmController.$inject=["$scope","$boxInstance","localData"];function RingBoxConfirmController(e,t,n){e.close=r,e.params=n;function r(e){t.close(e)}}angular.module("ringid.controllers").controller("SingleImageController",SingleImageController),SingleImageController.$inject=["$scope","$routeParams","$controller","Auth"];function SingleImageController(e,t,n,r){e.params={},e.params.imgId=t.imageId,e.isReady=!1,e.currentUser=r.currentUser(),n("ImagePopupController",{$scope:e}),e.showCommentBox=!0}!function(e,t){"use strict";e.module("ringid.media",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.media").directive("rgMedia",rgMedia),rgMedia.$inject=["$window","$document","Media","$routeParams"];function rgMedia(e,t,n,r){i.$inject=["profileFactory","$scope","$location","OPERATION_TYPES","APP_CONSTANTS","$ringbox","$$connector","routeService","userFactory","$$mediaAlbumMap","$$stackedMap","Api","$controller","$attrs"];function i(e,t,i,o,a,s,c,l,u,d,g,E,m,T){var f,p,_=!1,I=o.SYSTEM.MEDIA;m("MediaPlayController",{$scope:t}),t.showAlbumContents=!1,t.forProfile="true"===T.forProfile,t.limitItem=10,t.state={albumsLoading:!1,contentsLoading:!1},t.albumMap=null,t.albums=[],t.forProfile?t.routes={profileMedia:l.getRoute("PROFILE",{subpage:"media"}),audio:l.getRoute("PROFILE",{uId:r.uId,subpage:"media",albumType:"audio"}),video:l.getRoute("PROFILE",{uId:r.uId,subpage:"media",albumType:"video"})}:t.routes={cloudMyAlbums:l.getRoute("MEDIA_CLOUD_MYALBUM",{albumType:r.albumType}),audio:l.getRoute("MEDIA_CLOUD_MYALBUM",{subpage:"media",albumType:"audio"}),video:l.getRoute("MEDIA_CLOUD_MYALBUM",{subpage:"media",albumType:"video"})},t.loadMoreContent=D,t.statusText=v,t.increaseLimit=h,t.mediaAction=S;function h(){t.limitItem+=10}function A(){t.$rgDigest()}function C(e){var t;t=s.open({type:"remote",scope:!1,controller:"MediaEditController",resolve:{localData:{mediaCaption:e.getCaption()}},templateUrl:"templates/popups/edit-medianame-popup.html"}),t.result.then(function(t){t&&t!==e.getCaption()&&t.length>0&&e.updateDTO({ttl:t}).then(A,A)})}function S(e,t,n){switch(e){case"edit":C(t);break;case"remove":n.deleteContent(t).then(A,A)}}function v(){var e="";return t.state.albumsLoading||("audio"===r.albumType?0===t.albums.length&&(e=p.isCurrentUser()?"You don't have any music album":"User doesn't have any music album"):0===t.albums.length&&(e=p.isCurrentUser()?"You don't have any video album":"User doesn't have any video album")),e}function M(e,n){"album"===n?t.state.albumsLoading=e:t.state.contentsLoading=e,t.$rgDigest()}function D(){M(!0),E.media.albumContents({albId:t.albumMap.getKey(),utId:p.getUtId(),st:t.albumMap.getContents().length()})}function O(e){t.albums=e,M(!1,"album")}function R(e){e.sucs===!0&&e.mdaAlbmDTO?(t.albumMap=d.createAlbum(angular.extend(e.mdaAlbmDTO,{albId:e.albId}),p),D(!0)):e.sucs===!0?(t.albumMap=d.createAlbum({albId:e.albId},p),D(!0)):M(!1)}function N(e){switch(e.actn){case I.ACTION_MEDIA_ALBUM_CONTENT_LIST:e.sucs===!0?e.utId===p.getUtId()&&e.sucs===!0&&e.mdaCntntLst&&(t.albumMap.pushContent(e.mdaCntntLst),clearTimeout(_),_=setTimeout(M,500,!1)):M(!1)}}function P(){p=e.getProfile(r.uId),r.albumId?(f=c.subscribe(N,{action:[I.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),t.showAlbumContents=!0,t.albumMap=n.getAlbum(r.albumId,r.albumType),t.albumMap?D(!0):E.media.albumDetails(r.albumId).then(R,M),M(!0)):(n.fetchAlbums(p.getUtId(),r.albumType).then(O),M(!0,"album"))}P(),t.$on("$destroy",function(){c.unsubscribe(f),p.isCurrentUser()||n.resetUserAlbums()})}return{restrict:"E",controller:i,templateUrl:function(e,t){return t.templatepath}}}angular.module("ringid.media").directive("rgMediaSearch",rgMediaSearch),rgMediaSearch.$inject=[];function rgMediaSearch(){e.$inject=["$$stackedMap","$$mediaMap","Storage","OPERATION_TYPES","Auth","$scope","Media","userFactory","$$mediaAlbumMap","$location","rgDropdownService","$ringbox","Ringalert","Api","$player","SystemEvents","Utils"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f){var p,_=[];n.setData("albumname",_),o.medias=e.createNew(!0,"desc"),o.popupmedias=e.createNew(!0,"desc"),o.recentMediaDropdown="templates/dropdowns/recent-media-dropdown.html",o.searchedMedia=e.createNew(),o.trendingArr=[],o.nodatafound=!1,o.noaudiofound=!1,o.activeNav="recent",p=i.currentUser(),o.utId=p.getUtId(),a.fetchAllAlbums();function I(){var e,r,i;for(e=n.getData("mediaRecent"),r=0;r<e.length;r++)i=t(e[r]),o.medias.save(i.getKey(),i)}I(),o.getRecentMediaData=function(e){return{data:function(){return{media:e,playlist:o.medias.values()}},promise:e.fetchDetails()}},o.getTaggedMedia=E.media.taggedMedia,o.goToMyAlbums=function(e){var t="media/"+e;l.path(t)},o.selectAlbum=function(e){return{data:function(){return{media:e}}}},o.isMinimized=function(){return!m.isMinimized()},o.falsyMethod=function(e){f.triggerCustomEvent(T.MEDIA.LOAD_TRENDING_MEDIA,e),o.$rgDigest()},o.actionRecentMediaDropdown=function(e){var t;function n(){e.data.obj.setMediaToken().then(function(e){e&&r(),o.$rgDigest()})}function r(){window.FB&&window.FB.ui({method:"share",href:e.data.obj.getEmbedUrl()},function(){})}switch(e.action){case"addtoalbum":d.open({type:"remote",scope:!1,backDropClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:e.data.obj}},templateUrl:"templates/dropdowns/popup-album-dropdown.html"});break;case"sendtochat":d.open({type:"remote",scope:!1,backDropClose:!0,controller:"SendToChatController",resolve:{localData:{media:e.data.obj}},templateUrl:"templates/media/send-to-chat.html"});break;case"sendtofriend":break;case"shareatringid":t=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:e.data.obj},backDropClose:!0,templateUrl:"templates/home/share-media.html"}),t.result.then(function(){o.$rgDigest()});break;case"shareatfb":n();break;case"download":g.show("Currently download option is available in ringID desktop and mobile app version only","info")}}}function t(e,t){t.bind("click",function(){})}return{restrict:"E",controller:e,link:t,templateUrl:"templates/partials/media-search.html"}}angular.module("ringid.media").directive("rgMediaSearchDirective",rgMediaSearchDirective),searchDirectiveController.$inject=["$rootScope","OPERATION_TYPES","$scope","Media","$location","rgScrollbarService","GlobalEvents","Api"];function searchDirectiveController(e,t,n,r,i,o,a,s){var c=t.SYSTEM.MEDIA;n.showDropdown=!1,n.stoploader=!1,n.showTrending=!1,n.mouseoverTrendList=!1,n.searchResult=[],n.trendingArr=[],n.doSearch=function(){n.searchResult=[],n.stoploader=!1,n.searchParam?(n.showTrending=!1,s.media.searchResult(n.searchParam).then(u),n.showDropdown=!0):(n.showDropdown=!1,n.showTrending=!0)},n.doContentSearch=function(t){var r;switch(n.showDropdown=!1,t.sugt){case 1:r="/media/all/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 2:r="/media/all/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 3:r="/media/all/"+t.sk,i.path(encodeURI(r)),e.$rgDigest()}},n.fetchTrendingKeyword=function(){return n.showDropdown=!0,n.trendingArr.length>0?(n.showTrending=!0,void n.$rgDigest()):void s.media.searchTrends().then(function(e){var t;if(e.sucs===!0){for(t=0;t<e.sgstn.length;t++){switch(e.sgstn[t].sugt){case 1:e.sgstn[t].searchtype="songs";break;case 2:e.sgstn[t].searchtype="albums";break;case 3:e.sgstn[t].searchtype="tags"}n.trendingArr.push(e.sgstn[t])}n.showTrending=!0}n.$rgDigest()})},n.hideDropdown=l;function l(){n.mouseoverTrendList||(n.showDropdown=!1,n.showTrending=!1,n.searchParam="",n.searchResult=[])}n.$on("$destroy",function(){n.trendingArr=[],n.searchResult=[],a.unbindHandler("document","click",l)}),a.bindHandler("document","click",l);function u(e){var t;switch(e.actn){case c.ACTION_MEDIA_SEARCH_RESULT:if(e.sucs===!0)for(n.showDropdown=!0,t=0;t<e.sgstn.length;t++)n.searchResult.push(e.sgstn[t]);else n.stoploader=!0;o.recalculate(n)}n.$rgDigest()}}rgMediaSearchDirective.$inject=[];function rgMediaSearchDirective(){function e(e,t){var n;n=t.find("input"),e.activeId=0,e.setActiveId=function(t){e.activeId=t},n.on("keydown",function(t){13===t.keyCode&&e.searchParam&&e.doContentSearch({sk:e.searchParam,sugt:1})}),t.on("keydown",function(t){var n;13===t.keyCode?e.searchResult.length&&(n=e.searchResult[e.activeId],e.doContentSearch({sk:n.sk,sugt:n.sugt})):38===t.keyCode?(e.activeId=Math.max(e.activeId-1,0),e.$rgDigest()):40===t.keyCode&&(e.activeId=Math.min(e.activeId+1,e.searchResult.length-1),e.$rgDigest())})}return{restrict:"E",controller:searchDirectiveController,link:e,templateUrl:"templates/mediasearch/media-search-directive.html"}}angular.module("ringid.media").directive("rgTabNav",rgTabNav),rgTabNav.$inject=[];function rgTabNav(){e.$inject=["$scope","$location","routeService","$routeParams"];function e(e,t,n,r){e.routeName={mediaFeed:n.getRoute("MEDIA_FEED"),mediaPost:n.getRoute("MEDIA_POST"),album:n.getRoute("MEDIA_CLOUD_USERMEDIA",{albumtype:r.albumtype}),playlist:n.getRoute("MEDIA_PLAYLIST"),myalbum:n.getRoute("MEDIA_CLOUD_MYALBUM",{albumType:r.albumType||"audio"}),discover:n.getRoute("MEDIA_DISCOVER"),following:n.getRoute("MEDIA_FOLLOWING"),saved:n.getRoute("MEDIA_SAVED")}}function t(e){e.$rgDigest()}return{restrict:"E",controller:e,link:t,templateUrl:"templates/media/media.tabnav.dir.html"}}angular.module("ringid.media").directive("rgMediaSlider",rgMediaSlider),rgMediaSlider.$inject=["$document","SystemEvents"];function rgMediaSlider(e,t){n.$inject=["$scope","Api","$$mediaAlbumMap","$$stackedMap","Storage"];function n(e,n,r,i,o){var a,s,c,l;e.sliderImages=i.createNew(),n.media.slider({mdaT:1}).then(function(n){if(n.sucs===!0)for(c=0;c<n.mediaAlbumList.length;c++)a=r.createAlbum(n.mediaAlbumList[c]),e.sliderImages.save(a.getKey(),a);e.$broadcast(t.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()}),n.media.slider({mdaT:2}).then(function(n){if(n.sucs===!0)for(l=0;l<n.mediaAlbumList.length;l++)s=r.createAlbum(n.mediaAlbumList[l]),e.sliderImages.save(s.getKey(),s);e.$broadcast(t.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()}),e.setAlbumName=function(e){var t=[];t.push(e.name),t.push(e.count),o.setData("albumname",t)},e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}function r(e,n){var r,i,o,a,s=1,c=!0,l=0;e.showLeftArrow=!1,e.showRightArrow=!0,r=n[0].querySelector(".media-slider"),i=n[0].querySelector(".photobanner"),o=r.clientWidth,e.imageWidth=o/2,e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(){a&&clearTimeout(a),a=setTimeout(function(){l=1,i.style.display="none",e.$parent.$rgDigest(),c=!0,o=r.clientWidth,e.imageWidth=o/2,i.style.width=e.sliderImages.length()*e.imageWidth+"px",i.style.marginLeft="-"+(s-l)*e.imageWidth+"px",i.style.display="",e.$parent.$rgDigest()},500)}),e.$on(t.MEDIA.SLIDER_IMAGE_LOADED,function(){i.style.display="none",e.$parent.$rgDigest(),i.style.width=e.sliderImages.length()*e.imageWidth+"px",i.style.display="",e.$parent.$rgDigest()}),e.right=function(){c&&(i.style.width=e.sliderImages.length()*e.imageWidth+"px",c=!1),i.style.marginLeft="-"+s*e.imageWidth+"px",s++,l=0,s>1&&(e.showLeftArrow=!0),s===e.sliderImages.length()-1&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){s--,l=0,1===s&&(e.showLeftArrow=!1),s<e.sliderImages.length()-1&&(e.showRightArrow=!0),i.style.marginLeft="-"+(s-1)*e.imageWidth+"px",e.$parent.$rgDigest()}}return{restrict:"E",controller:n,link:r,templateUrl:"templates/mediasearch/media-slider-directive.html"}}angular.module("ringid.media").directive("rgMediaTrendSlider",rgMediaTrendSlider),rgMediaTrendSlider.$inject=["Api","$$mediaAlbumMap","$$stackedMap","$$feedMap","SystemEvents","Utils","$player"];function rgMediaTrendSlider(e,t,n,r,i,o,a){function s(t,s){var c,l,u,d,g=1,E=0,m=20;c=s[0].querySelector(".news_banner_wrap"),l=s[0].querySelector(".news_banner_con"),t.sliderFeeds=n.createNew(),t.showLeftArrow=!1,t.showRightArrow=!1,t.isMinimized=function(){return!a.isMinimized()},t.falsyMethod=function(e){o.triggerCustomEvent(i.MEDIA.LOAD_TRENDING_MEDIA,e),t.$rgDigest()},e.media.trendingFeeds().then(function(e){var n;if(e.sucs===!0)for(d=0;d<e.newsFeedList.length;d++)n=r.create(e.newsFeedList[d]),t.sliderFeeds.save(n.getKey(),n);t.sliderFeeds.length()>t.numberOfSlides&&(t.showRightArrow=!0,E=(t.sliderFeeds.length()+1)*m,l.style.width=(t.sliderFeeds.length()+1)*t.liWidth+E+"px"),t.$rgDigest()}),t.getMediaData=function(e,t){return{data:function(){return{media:e,playlist:t.getAlbum().getContents().values(),feedTime:t.time()}},promise:e.fetchDetails()}},t.setAlbumName=function(e){var t=[];t.push(e.name),t.push(e.count),Storage.setData("albumname",t)},t.$rgDigest(),t.$on("$destroy",function(){t.sliderFeeds.reset()});function T(){var e=c.clientWidth;o.viewport.x>=1600&&(t.numberOfSlides=3,t.liWidth=e/t.numberOfSlides-m,t.$parent.$rgDigest()),o.viewport.x>=1280&&o.viewport.x<1600&&(t.numberOfSlides=2,t.liWidth=e/t.numberOfSlides-m,t.$parent.$rgDigest()),o.viewport.x<1280&&(t.numberOfSlides=1,t.liWidth=e/t.numberOfSlides-m,t.$parent.$rgDigest())}T(),t.$rgDigest();function f(){l.style.marginLeft="0px",g=1,t.showLeftArrow=!1}t.$on(i.COMMON.WINDOW_RESIZED,function(){u&&clearTimeout(u),u=setTimeout(function(){l.style.display="none",t.$parent.$rgDigest(),T(),l.style.width=t.sliderFeeds.length()*t.liWidth+E+"px",f(),t.sliderFeeds.length()>t.numberOfSlides&&(t.showRightArrow=!0),l.style.display="",t.$parent.$rgDigest()},500)}),t.right=function(){l.style.marginLeft="-"+(g*t.liWidth+g*m)+"px",g++,g>1&&(t.showLeftArrow=!0),g-1===t.sliderFeeds.length()-t.numberOfSlides&&(t.showRightArrow=!1),t.$parent.$rgDigest()},t.left=function(){g--,l.style.marginLeft="-"+((g-1)*t.liWidth+(g-1)*m)+"px",1===g&&(t.showLeftArrow=!1),g<t.sliderFeeds.length()-1&&(t.showRightArrow=!0),t.$parent.$rgDigest()}}return{restrict:"E",link:s,templateUrl:"templates/mediasearch/media-trend-slider.html"}}angular.module("ringid.media").directive("rgAlbumview",rgAlbumview);function rgAlbumview(){var e={restrict:"E",scope:{album:"=",forProfile:"@"},controller:t,templateUrl:function(e,t){return t.templatePath}};t.$inject=["$scope","Media","$ringbox"];function t(e,t,n){e.ddAction=r,e.ddTemplate='<div class="action pad-204 r-m-10 z-in-5 top-20 w-165"><i class="drop-sprite curve-a curve-t-ico p-ab top11"></i><div rg-click="ddAction()({type: \'edit\'})" class="ac-top-line pad-8-14"><i class="drop-sprite w-h-13 edit-ico feed-font"></i>Edit Album Name</div><div rg-click="ddAction()({type: \'delete\'})"class="ac-top-line pad-8-14"><i class="drop-sprite w-h-13 hide-feed-ico feed-font"></i>Remove Album</div></div>';function r(e){switch(e.type){case"edit":i();break;case"delete":o()}}function i(){var t;t=n.open({type:"remote",scope:!1,controller:"AlbumEditController",resolve:{localData:{albumName:e.album.getName()}},templateUrl:"templates/popups/edit-albumname-popup.html"}),t.result.then(function(t){t&&t!==e.album.getName()&&t.length>0&&e.album.changeName(t).then(function(){e.$rgDigest(!0)},function(){e.$rgDigest(!0)})})}function o(){var r,i;r="Are you sure you want to delete?",i=n.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"}),i.result.then(function(n){n&&(t.deleteAlbum(e.album),e.$rgDigest(!0))})}}return e}angular.module("ringid.media").directive("rgMediaview",rgMediaview);function rgMediaview(){var e={restrict:"E",scope:{album:"=",media:"=",mediaAction:"&",select:"&"},controller:t,templateUrl:function(e,t){return t.templatePath}};t.$inject=["$scope","$player","Utils","SystemEvents"];function t(e,t,n,r){e.getMediaData=o,e.ddControl={showOnHover:!0},e.ddHtml="templates/dropdowns/media-dropdown.html",e.ddAction=i,e.isMinimized=function(){return!t.isMinimized()},e.falsyMethod=function(t){n.triggerCustomEvent(r.MEDIA.LOAD_TRENDING_MEDIA,t),e.$rgDigest()};function i(t){e.mediaAction({action:t.action,media:e.media,album:e.album})}function o(){return{data:function(){return{media:e.media,playlist:e.album.getContents().values(),popupForm:"profile"}},promise:e.media.fetchDetails()}}}return e}angular.module("ringid.media").controller("AlbumEditController",AlbumEditController),AlbumEditController.$inject=["$scope","$boxInstance","localData"];function AlbumEditController(e,t,n){e.cancel=r,e.save=i,e.albumName=n.albumName;function r(){t.close(!1)}function i(){t.close(e.albumName)}}angular.module("ringid.media").controller("MediaEditController",MediaEditController),MediaEditController.$inject=["$scope","$boxInstance","localData"];function MediaEditController(e,t,n){e.cancel=r,e.save=i,e.mediaCaption=n.mediaCaption;function r(){t.close(!1)}function i(){t.close(e.mediaCaption)}}angular.module("ringid.media").controller("mSearchResultController",mSearchResultController),mSearchResultController.$inject=["Auth","Storage","userFactory","$routeParams","$$mediaAlbumMap","$$stackedMap","$$mediaMap","$scope","Media","$location","$$connector","OPERATION_TYPES","Api"];function mSearchResultController(e,t,n,r,i,o,a,s,c,l,u,d,g){var E,m,T,f,p=[],_=[],I=[],h=o.createNew(),A=o.createNew();switch(t.setData("albumname",p),s.stype=r.stype,s.searchkey=decodeURI(r.sk),m=d.SYSTEM.MEDIA,s.loadMoreSongs=!1,s.loadMoreAlbums=!1,s.showSearchTitle=!0,s.allTabSearch=!1,s.songsTabSearch=!1,s.albumsTabSearch=!1,s.tagsTabSearch=!1,s.hideSearchTabs=!1,s.searchedTagArr=[],s.searchedSongs=function(){return h},s.searchedAlbums=function(){return A},r.stype){case"all":E=0,s.allTabSearch=!0;break;case"songs":E=1,s.songsTabSearch=!0;break;case"albums":E=2,s.albumsTabSearch=!0;break;case"tags":E=3,s.tagsTabSearch=!0;break;default:E=1}switch(s.showSearchDropdown=!1,s.allresultsection=!1,s.searchsongsection=!1,s.searchalbumsection=!1,s.searchtagsection=!1,s.noresultsection=!1,"tag"!==s.stype&&(s.hideSearchTabs=!0,T={sk:s.searchkey,sugt:E},g.media.fetchContent(T)),s.stype){case"all":s.allresultsection=!0;break;case"songs":s.searchsongsection=!0;break;case"albums":s.searchalbumsection=!0;break;case"tags":s.searchtagsection=!0;break;case"tag":s.searchsongsection=!0,s.showSearchTitle=!1,isNaN(s.searchkey)||g.media.taggedMedia(parseInt(s.searchkey,10))}s.searchedTags=c.getSearchedTagArr(),s.cntntidarray=c.getContentIdArray,s.albumidarray=c.getAlbumIdArray,s.noresultfound=!1,s.loadMoreSuggestedSongs=function(){var e;s.loadMoreSongs=!0,e={sk:s.searchkey,sugt:E,pvtid:_.pop(),scl:2},g.media.fetchContent(e),c.resetContentIdArray(),s.$rgDigest()},s.loadMoreSuggestedAlbums=function(){var e;s.loadMoreAlbums=!0,e={sk:s.searchkey,sugt:E,pvtid:I.pop(),scl:2},g.media.fetchContent(e),c.resetAlbumIdArray(),s.$rgDigest()},s.getTaggedMedia=function(e){var t;t="media/tag/"+e.htid,l.path(encodeURI(t))},s.goToAlbum=function(e){var n;switch(p.push(e.name),p.push(e.mc),t.setData("albumname",p),e.type){case"audio":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;case"video":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;default:n="media",l.path(n)}},s.getMediaData=function(e){return{data:function(){var t=[];return t.push(e),{media:e,playlist:t}},promise:e.fetchDetails()}},f=u.subscribe(C,{action:[m.ACTION_SPECIFIC_MEDIA_RESULT,m.ACTION_GET_TAGGED_MEDIA_SONGS]});function C(e){var t,n;switch(s.loadMoreSongs=!1,s.loadMoreAlbums=!1,e.actn){case m.ACTION_SPECIFIC_MEDIA_RESULT:if(s.noresultfound=!1,e.sucs===!0)for(10===e.tr?n=e.mdaLst.length-1:(n=e.mdaLst.length,s.noresultfound=!0),t=0;t<n;t++)1===e.mdaLst[t].sugt&&(_.push(e.mdaLst[t].cntntId),e.mdaLst[t].viewtime=(new Date).getTime(),T=a(e.mdaLst[t]),h.save(T.getKey(),T)),2===e.mdaLst[t].sugt&&(I.push(e.mdaLst[t].albId),T=i.createAlbum(e.mdaLst[t]),A.save(T.getKey(),T)),3===e.mdaLst[t].sugt&&s.searchedTagArr.push(e.mdaLst[t]);else s.noresultfound=!0;break;case m.ACTION_GET_TAGGED_MEDIA_SONGS:if(s.noresultfound=!1,e.sucs===!0)for(t=0;t<e.mdaLst.length;t++)T=a(e.mdaLst[t]),h.save(T.getKey(),T);else s.noresultfound=!0}s.$rgDigest()}s.$on("$destroy",function(){u.unsubscribe(f),h.reset(),A.reset()})}angular.module("ringid.media").controller("MediaPlayController",MediaPlayController),MediaPlayController.$inject=["$scope","$$stackedMap"];function MediaPlayController(e,t){e.selectedPlaylist=t.createNew(),e.selectMedia=n,e.getMediaData=r;function n(t,n){n?e.selectedPlaylist.save(t.getKey(),t):e.selectedPlaylist.remove(t.getKey())}function r(t,n){var r,i;return r=t?e.albumMap.getContents().values():e.selectedPlaylist.values(),i=n||r[0],{data:function(){return{media:i,playlist:r}},promise:i.fetchDetails()}}}angular.module("ringid.media").controller("mediaDiscoverController",mediaDiscoverController),mediaDiscoverController.$inject=["$rootScope","$scope","SystemEvents","$$mediaPortalMap","$$stackedMap","Ringalert","Api"];function mediaDiscoverController(e,t,n,r,i,o,a){var s,c,l,u=0,d=15;t.mediaDiscoverMap=i.createNew(),t.searchResultMap=i.createNew(),t.searching=!1,t.nodata=!1,t.loadmore=!0,t.showloadmore=!1,t.selected=null;function g(){c&&JSON.stringify(c)!==JSON.stringify({})&&t.mediaDiscoverMap.length()>1&&t.mediaDiscoverMap.save(c.key,c.value)}t.loadMoreMediaPage=function(e){t.showloadmore=!0,d=e||15,a.media.discoverList({st:u,lmt:d}).then(function(e){if(e.sucs===!0){for(g(),l=0;l<e.npList.length;l++)s=r.create(e.npList[l]),t.mediaDiscoverMap.save(s.getKey(),s);u+d>t.mediaDiscoverMap.length()?t.loadmore=!1:(c=t.mediaDiscoverMap.removeAndReturnLastElement(),u+=d),t.showloadmore=!1,
t.$rgDigest()}else g(),t.loadmore=!1,t.showloadmore=!1;t.$rgDigest()},function(e){o.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})},t.followPage=function(t,r){a.media.followPage(t.getKey()).then(function(t){t.sucs===!0&&(t.index=r,e.$broadcast(n.PORTAL.DONE_FOLLOW_PORTAL,t))})},t.loadMoreMediaPage(d+1),t.$rgDigest(),t.doSearch=function(){t.searchParam?(t.searching=!0,t.nodata=!1,t.searchResultMap.reset(),t.$rgDigest(),a.media.searchPortal(t.searchParam).then(function(e){var n;if(e.sucs===!0)for(n=0;n<e.searchedcontaclist.length;n++)s=r.create(e.searchedcontaclist[n].npDTO),t.searchResultMap.save(s.getKey(),s);else t.nodata=!0;t.$rgDigest()})):(t.searching=!1,t.nodata=!1,t.$rgDigest())};function E(e,t,n){var r=e.get(t);r&&r.setIfSubscribed(n)}t.$on(n.PORTAL.DONE_FOLLOW_PORTAL,function(e,n){t.searchResultMap.length()>0?(E(t.searchResultMap,n.pId,!0),t.$rgDigest(),0===t.searchResultMap.length()&&(t.searchParam="",t.searching=!1,t.$rgDigest())):(E(t.mediaDiscoverMap,n.pId,!0),t.$rgDigest())}),t.$on("$destroy",function(){t.mediaDiscoverMap.reset(),t.searchResultMap.reset()})}angular.module("ringid.media").controller("AlbumContentsController",AlbumContentsController),AlbumContentsController.$inject=["$$stackedMap","$$mediaAlbumMap","userFactory","$routeParams","OPERATION_TYPES","$scope","Media","$$connector","Api","$controller"];function AlbumContentsController(e,t,n,r,i,o,a,s,c,l){var u,d=i.SYSTEM.MEDIA,g=parseInt(r.utid,10),E=parseInt(r.albumid,10);o.stoploader=!1,o.loadMoreSong=!1,l("MediaPlayController",{$scope:o});function m(){u=s.subscribe(T,{action:[d.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),c.media.albumDetails(E).then(function(e){e.sucs===!0&&(e.mdaAlbmDTO?o.albumMap=t.createAlbum({albn:e.mdaAlbmDTO.albn,albId:E,mdaT:e.mdaAlbmDTO.mdaT,utId:g}):o.albumMap=t.createAlbum({albId:E,utId:g}),c.media.albumContents({albId:E,utId:g}))})}m();function T(e){switch(e.actn){case d.ACTION_MEDIA_ALBUM_CONTENT_LIST:e.sucs===!0?(o.albumMap.pushContent(e.mdaCntntLst),o.loadMoreSong=!1,o.stoploader=!0):o.loadMoreSong=!1}o.$rgDigest(!0)}o.loadMoreMedia=function(e){o.loadMoreSong=!0,c.media.albumContents({albId:E,utId:g,st:e})},o.$on("$destroy",function(){s.unsubscribe(u)})}angular.module("ringid.feed").controller("MediaProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","$$mediaPortalMap","Api","SystemEvents",function(e,t,n,r,i,o,a,s,c){var l,u,d=parseInt(r.mpageid,10),g=d;l="media",u=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="templates/dropdowns/celebrity-cover-unfollow-action-dropdown.html",g=u+"."+d+".5",e.pagekey=g,e.action=u,e.params={actn:u,pId:d,pType:o.SYSTEM.PROFILE_TYPES.MEDIA_PAGE},e.forAdd=l,e.sortBy="at",s.media.getShortDetails(d).then(function(n){n.sucs===!0&&(e.mediaMap=a.create(n.userDetails.npDTO),t("FeedMainController",{$scope:e})),e.$rgDigest()}),e.followPage=function(t){s.media.followMediaPage(t.getKey()).then(function(t){t.sucs===!0&&(e.mediaMap.setIfSubscribed(!0),e.$rgDigest())})},e.actionFollowingDropdown=function(t){switch(t.action){case"unfollow":i.close(t.event),e.$rgDigest(),s.media.unFollowMediaPage(t.data.media.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.MEDIA.UNFOLLOW_MEDIA,t),e.mediaMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.MEDIA.DONE_FOLLOW_MEDIA,function(){e.mediaMap.setIfSubscribed(!0),e.$rgDigest()})}]),angular.module("ringid.media").controller("MediaFollowingController",["$scope","SystemEvents","$$stackedMap","$ringbox","$$mediaPortalMap","rgDropdownService","MESSAGES","Ringalert","Api",function(e,t,n,r,i,o,a,s,c){var l,u,d=0,g=10,E={};e.mediaFollowMap=n.createNew(),e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="templates/dropdowns/celebrity-unfollow-action-dropdown.html";function m(){E&&JSON.stringify(E)!==JSON.stringify({})&&e.mediaFollowMap.length()>1&&e.mediaFollowMap.save(E.key,E.value)}function T(){var t=e.mediaFollowMap.length();t<1?e.isEmptyFollow=!0:m(),e.loadmore=!1,e.showloadmore=!1}e.loadMoreFollowingMediaPages=function(t){e.showloadmore=!0,g=t||10,c.media.followingList({st:d,lmt:g}).then(function(t){if(t.sucs===!0){for(m(),u=0;u<t.npList.length;u++)l=i.create(t.npList[u]),e.mediaFollowMap.save(l.getKey(),l);d+g>e.mediaFollowMap.length()?e.loadmore=!1:(E=e.mediaFollowMap.removeAndReturnLastElement(),d+=g),e.showloadmore=!1,e.$rgDigest()}else T();e.$rgDigest()},function(e){s.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})},e.loadMoreFollowingMediaPages(g+1),e.$rgDigest(),e.actionFollowingDropdown=function(t){var n,i;switch(t.action){case"unfollow":o.close(t.event),e.$rgDigest(),n=a.NEWSPORTAL.C_UNFOLLOW,i=r.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"}),i.result.then(function(e){e&&c.media.unFollowMediaPage(t.data.media.value.getKey()).then(function(e){e.sucs&&f(null,e)})},function(){s.show("Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})}};function f(t,n){e.mediaFollowMap.remove(n.pId),e.mediaFollowMap.length()<1&&(e.isEmptyFollow=!0),e.$rgDigest()}e.$on(t.MEDIA.UNFOLLOW_MEDIA,f),e.$on("$destroy",function(){e.mediaFollowMap.reset()})}]),angular.module("ringid.media").controller("MediaSaveController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="media_saved",o=r.SYSTEM.TYPE_SAVED_FEED+".media_saved";e.pagekey=o,e.params={actn:r.SYSTEM.TYPE_SAVED_FEED,pType:r.SYSTEM.PROFILE_TYPES.MEDIA_PAGE,scl:2,lmt:10,tm:0,svd:!0},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=i,e.shareMenuDisabled=!0,e.sortBy="stm",e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.media").controller("MediaPostController",MediaPostController),MediaPostController.$inject=["$scope","$location","RING_ROUTES"];function MediaPostController(e,t,n){e.setFeed=r;function r(r){r&&r.sucs===!0&&(t.path(n.MEDIA_FEEDS),e.$rgDigest())}}angular.module("ringid.shared").controller("SendToChatController",SendToChatController),SendToChatController.$inject=["$scope","$boxInstance","localData"];function SendToChatController(e,t,n){e.active_menu="send_to_friend",e.data=n,e.close=t.close,e.$rgDigest(),e.setSendToChatList=function(t){e.active_menu=t,e.$rgDigest()}}!function(e,t){"use strict";e.module("ringid.newsportal",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.newsportal").controller("portalFollowingController",portalFollowingController),portalFollowingController.$inject=["$scope","SystemEvents","$$stackedMap","$$newsPortalMap","portalHttpService","$ringbox","rgDropdownService","MESSAGES","Ringalert"];function portalFollowingController(e,t,n,r,i,o,a,s,c){var l,u=0,d=10,g={};e.portalFollowMap=n.createNew(),e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="templates/dropdowns/portal-follow-action-dropdown.html",e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:i.getPortalCatList(e.getKey())}};function E(){g&&JSON.stringify(g)!==JSON.stringify({})&&e.portalFollowMap.length()>1&&e.portalFollowMap.save(g.key,g.value)}function m(){var t=e.portalFollowMap.length();t<1?e.isEmptyFollow=!0:E(),e.loadmore=!1,e.showloadmore=!1}e.loadMoreFollowingPortal=function(t){e.showloadmore=!0,d=t||10,i.getPortalFollowingList({st:u,lmt:d}).then(function(t){var n;if(t.sucs===!0){for(E(),n=0;n<t.npList.length;n++)l=r.create(t.npList[n]),e.portalFollowMap.save(l.getKey(),l);u+d>e.portalFollowMap.length()?e.loadmore=!1:(g=e.portalFollowMap.removeAndReturnLastElement(),u+=d),e.showloadmore=!1,e.$rgDigest()}else m();e.$rgDigest()},function(e){c.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})},e.loadMoreFollowingPortal(d+1),e.$rgDigest(),e.actionFollowingDropdown=function(t){var n,r;switch(t.action){case"edit":a.close(t.event),e.$rgDigest(),n=o.open({type:"remote",scope:!1,backDropClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal.value},remoteData:function(){return i.getPortalCatList(t.data.portal.value.getKey())}},templateUrl:"templates/newsportal/portal-follow.popup.html"});break;case"unfollow":a.close(t.event),e.$rgDigest(),r=s.NEWSPORTAL.C_UNFOLLOW,n=o.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"}),n.result.then(function(e){e&&i.unFollowPortal(t.data.portal.value.getKey()).then(function(e){e.sucs&&T(null,e)})})}};function T(t,n){e.portalFollowMap.remove(n.pId),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0),e.$rgDigest()}e.$on(t.PORTAL.UNFOLLOW_PORTAL,T),e.$on("$destroy",function(){e.portalFollowMap.reset()})}angular.module("ringid.newsportal").controller("portalDiscoverController",portalDiscoverController),portalDiscoverController.$inject=["$scope","SystemEvents","$$newsPortalMap","$$stackedMap","portalHttpService","Ringalert"];function portalDiscoverController(e,t,n,r,i,o){var a,s,c=0,l=15;e.portalDiscoverMap=r.createNew(),e.searchResultMap=r.createNew(),e.searching=!1,e.nodata=!1,e.loadmore=!0,e.showloadmore=!1,e.selected=null,e.getDiscoverPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.getSearchPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}};function u(){s&&JSON.stringify(s)!==JSON.stringify({})&&e.portalDiscoverMap.length()>1&&e.portalDiscoverMap.save(s.key,s.value)}e.loadMorePortal=function(t){e.showloadmore=!0,l=t||15,i.getPortalDiscoverList({st:c,lmt:l}).then(function(t){var r;if(t.sucs===!0){for(u(),r=0;r<t.npList.length;r++)a=n.create(t.npList[r]),e.portalDiscoverMap.save(a.getKey(),a);c+l>e.portalDiscoverMap.length()?e.loadmore=!1:(s=e.portalDiscoverMap.removeAndReturnLastElement(),c+=l),e.showloadmore=!1,e.$rgDigest()}else u(),e.loadmore=!1,e.showloadmore=!1;e.$rgDigest()},function(e){o.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})},e.loadMorePortal(l+1),e.$rgDigest(),e.doSearch=function(){e.searchParam?(e.searching=!0,e.nodata=!1,e.searchResultMap.reset(),e.$rgDigest(),i.searchNewsPortal(e.searchParam).then(function(t){var r;if(t.sucs===!0)for(r=0;r<t.searchedcontaclist.length;r++)a=n.create(t.searchedcontaclist[r].npDTO),e.searchResultMap.save(a.getKey(),a);else e.nodata=!0;e.$rgDigest()})):(e.searching=!1,e.nodata=!1,e.$rgDigest())};function d(e,t,n){var r=e.get(t);r&&r.setIfSubscribed(n)}e.$on(t.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.searchResultMap.length()>0?(d(e.searchResultMap,n.pId,!0),e.$rgDigest(),0===e.searchResultMap.length()&&(e.searchParam="",e.searching=!1,e.$rgDigest())):(d(e.portalDiscoverMap,n.pId,!0),e.$rgDigest())}),e.$on("$destroy",function(){e.portalDiscoverMap.reset(),e.searchResultMap.reset()})}angular.module("ringid.newsportal").controller("portalSaveController",portalSaveController),portalSaveController.$inject=["$scope","$controller","OPERATION_TYPES"];function portalSaveController(e,t,n){var r="newsportal_saved",i=n.SYSTEM.TYPE_SAVED_FEED+".newsportal_saved";e.pagekey=i,e.params={actn:n.SYSTEM.TYPE_SAVED_FEED,pType:n.SYSTEM.PROFILE_TYPES.NEWSPORTAL,scl:2,lmt:10,tm:0,svd:!0},e.forAdd=r,e.sortBy="stm",e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}angular.module("ringid.newsportal").controller("portalFollowController",portalFollowController),portalFollowController.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","portalHttpService","SystemEvents","$ringbox","Ringalert"];function portalFollowController(e,t,n,r,i,o,a,s,c){var l,u,d=[],g=[],E=[],m=[],T=0;for(e.portalName=r.target.getFullName(),e.portalId=r.target.getKey(),e.loadMoreDoneFollow=!1,l=0;l<n.nCatList.length;l++)d.push(n.nCatList[l]),m.push(n.nCatList[l].id),n.nCatList[l].subsc&&g.push(n.nCatList[l].id);if(n.nCatList.length===g.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=d,0===g.length){for(e.selectall=!0,u=0;u<e.categoryList.length;u++)e.categoryList[u].subsc=e.selectall;g=m,e.$rgDigest()}e.selectPortalCat=function(e){var t=g.indexOf(e.id),n=E.indexOf(e.id);e.subsc?(n!==-1&&E.splice(n,1),t===-1&&g.push(e.id)):(t!==-1&&g.splice(t,1),n===-1&&E.push(e.id))},e.doneFollow=function(){e.loadMoreDoneFollow=!0,o.doneFollowing(e.portalId,g,E,T).then(function(n){e.loadMoreDoneFollow=!1,n.sucs===!0?(n.index=r.index,t.$broadcast(a.PORTAL.DONE_FOLLOW_PORTAL,n),0===g.length&&t.$broadcast(a.PORTAL.UNFOLLOW_PORTAL,n),s.close()):s.close(),e.$rgDigest()},function(t){e.loadMoreDoneFollow=!1,c.show(t.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error")})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){var t;for(e.selectall?(T=2,g=m,E=[],e.$rgDigest()):(T=1,g=[],E=m,e.$rgDigest()),t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){d=[]})}angular.module("ringid.feed").controller("PortalProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","portalHttpService","$$newsPortalMap","SystemEvents","$ringbox",function(e,t,n,r,i,o,a,s,c,l){var u,d,g=parseInt(r.portalid,10),E=g;u="newsportal",d=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="templates/dropdowns/portal-cover-follow-action-dropdown.html",E=d+"."+g+".3",e.pagekey=E,e.action=d,e.params={actn:d,pId:g,pType:o.SYSTEM.PROFILE_TYPES.NEWSPORTAL},e.forAdd=u,e.sortBy="at",a.getPortalShortDetails(g).then(function(n){n.sucs===!0&&(e.portalMap=s.create(n.userDetails.npDTO),t("FeedMainController",{$scope:e})),e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:a.getPortalCatList(e.getKey())}},e.actionFollowingDropdown=function(t){switch(t.action){case"edit":i.close(t.event),e.$rgDigest(),l.open({type:"remote",scope:!1,backDropClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal},remoteData:function(){return a.getPortalCatList(t.data.portal.getKey())}},templateUrl:"templates/newsportal/portal-follow.popup.html"});break;case"unfollow":i.close(t.event),e.$rgDigest(),a.unFollowPortal(t.data.portal.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.PORTAL.UNFOLLOW_PORTAL,t),e.portalMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.PORTAL.DONE_FOLLOW_PORTAL,function(){e.portalMap.setIfSubscribed(!0),e.$rgDigest()})}]),angular.module("ringid.feed").controller("PortalFeedPopUpController",["$$feedMap","$scope","$controller","localData","$routeParams","remoteData","feedFactory","Auth","SystemEvents","$location","$boxInstance","Utils",function(e,t,n,r,i,o,a,s,c,l,u,d){t.feed=e.create(o),t.$rgDigest(),t.feed.getImages().length>0&&(t.imageSize=d.getScaledImageSize(t.feed.getImages()[0].value.getIw(),t.feed.getImages()[0].value.getIh(),520,420)),t.$rgDigest(),t.singleFeed=!0,t.ogData={},t.currentUser=s.currentUser(),t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.imageShowMoreLength=t.feed.getTotalImage()-1,t.showCommentBox=!0,n("FeedSubController",{$scope:t}),t.$rgDigest(),u.hideLoader()}]),angular.module("ringid.newsportal").directive("rgPortalTabNav",rgPortalTabNav),rgPortalTabNav.$inject=[];function rgPortalTabNav(){e.$inject=["$scope","$location"];function e(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()===e}}return{restrict:"E",controller:e,templateUrl:"templates/newsportal/portal.tabnav.directive.html"}}angular.module("ringid.newsportal").directive("rgPortalSlider",rgPortalSlider),rgPortalSlider.$inject=["$document","SystemEvents","Utils","$$stackedMap","$$breakingNewsMap","portalHttpService","feedFactory","OPERATION_TYPES"];function rgPortalSlider(e,t,n,r,i,o,a,s){function c(e,c,l){var u,d,g,E,m,T=1,f=0,p=20;u=c[0].querySelector(".media-slider"),d=c[0].querySelector(".photobanner"),e.sliderElements=r.createNew(),e.showLeftArrow=!1,e.showRightArrow=!1,e.sliderType=l.type,"newsportal"===e.sliderType&&(e.param={actn:s.SYSTEM.PORTAL.ACTION_NEWSPORTAL_BREAKING_FEED},e.popupController="PortalFeedPopUpController",e.popupTemplate="templates/newsportal/portal-feed-popup.html",e.$rgDigest()),"pages"===e.sliderType&&(e.param={actn:s.SYSTEM.PORTAL.ACTION_PAGES_BREAKING_FEED},e.popupController="businessFeedPopupController",e.popupTemplate="templates/business/business-feed-popup.html",e.$rgDigest()),o.getBreakingNews(e.param).then(function(t){if(t.sucs===!0){for(m=0;m<t.brNPFeeds.length;m++)E=i.create(t.brNPFeeds[m]),e.sliderElements.save(E.getKey(),E);e.sliderElements.length()>e.numberOfSlides&&(e.showRightArrow=!0,f=(e.sliderElements.length()+1)*p,d.style.width=(e.sliderElements.length()+1)*e.slideWidth+f+"px")}e.$rgDigest()}),e.getFeedInfo=function(e){return{data:function(){return{target:e}},promise:a.getPortalFeedDetails(e.getKey())}},e.$on(t.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){var r=e.sliderElements.get(n.id);r&&r.setIfSubscribed(!0),e.$rgDigest()}),e.$rgDigest(),e.$on("$destroy",function(){e.sliderElements.reset()});function _(){var t=u.clientWidth;n.viewport.x>=1600&&(e.numberOfSlides=3,e.slideWidth=t/e.numberOfSlides-p,e.$parent.$rgDigest()),n.viewport.x>=1280&&n.viewport.x<1600&&(e.numberOfSlides=2,e.slideWidth=t/e.numberOfSlides-p,e.$parent.$rgDigest()),n.viewport.x<1280&&(e.numberOfSlides=1,e.slideWidth=t/e.numberOfSlides-p,e.$parent.$rgDigest())}_(),e.$rgDigest();function I(){d.style.marginLeft="0px",T=1,e.showLeftArrow=!1}e.$on(t.COMMON.WINDOW_RESIZED,function(){g&&clearTimeout(g),g=setTimeout(function(){e.$parent.$rgDigest(),_(),d.style.width=e.sliderElements.length()*e.slideWidth+f+"px",I(),e.sliderElements.length()>e.numberOfSlides&&(e.showRightArrow=!0),d.style.display="",e.$parent.$rgDigest()},500)}),e.right=function(){d.style.marginLeft="-"+(T*e.slideWidth+T*p)+"px",T++,T>1&&(e.showLeftArrow=!0),T-1===e.sliderElements.length()-e.numberOfSlides&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){T--,d.style.marginLeft="-"+((T-1)*e.slideWidth+(T-1)*p)+"px",1===T&&(e.showLeftArrow=!1),T<e.sliderElements.length()-1&&(e.showRightArrow=!0),e.$parent.$rgDigest()}}return{restrict:"E",link:c,templateUrl:"templates/newsportal/portal-slider-directive.html"}}angular.module("ringid.newsportal").directive("rgDiscoverPortal",rgDiscoverPortal),rgDiscoverPortal.$inject=[];function rgDiscoverPortal(){e.$inject=["$scope","$$stackedMap","$$newsPortalMap","portalHttpService","SystemEvents","feedFactory","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){var s;e.portalDiscoverMap=t.createNew(),e.nodata=!1,e.selected=null,e.params={actn:a.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},e.isCalled=!1;function c(){e.message="feed"===e.tabName?"There is no news to display":"You don't have any following list",e.portalDiscoverMap.length()>0&&(e.message+="feed"===e.tabName?". You may be interested in following news providers":". Below are some news provider suggestions you may subscribe")}r.getPortalDiscoverList().then(function(t){var r;if(t.sucs===!0){for(r=0;r<t.npList.length;r++)s=n.create(t.npList[r]),e.portalDiscoverMap.save(s.getKey(),s);e.portalDiscoverMap.length()}t.sucs===!1&&(1202===t.rc||1205===t.rc||1208===t.rc),e.isCalled=!0,c(),e.$rgDigest()},function(){}),e.getCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:r.getPortalCatList(e.getKey())}},e.$on(i.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.portalDiscoverMap.get(n.pId).setIfSubscribed(!0),o.initFeedRequest(e.params),e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset()})}return{restrict:"E",controller:e,templateUrl:"templates/newsportal/discover.portal.directive.html",link:function(e,t,n){e.tabName=n.tabName,e.$rgDigest()}}}angular.module("ringid.newsportal").directive("rgBreakingNews",rgBreakingNews),rgBreakingNews.$inject=[];function rgBreakingNews(){e.$inject=["$scope","portalHttpService"];function e(e,t){t.getBreakingNews().then(function(t){var n;if(e.newsItems=[],t.sucs===!0)for(n=0;n<t.brNPFeeds.length;n++)e.newsItems.push(t.brNPFeeds[n]);e.$rgDigest()})}function t(e){var t;e.resetInterval=i,e.startInterval=o,e.activeId=0,e.next=function(){e.activeId<e.newsItems.length-1?e.activeId++:e.activeId=0},e.prev=function(){e.activeId>0?e.activeId--:e.activeId=e.newsItems.length-1};function n(){t=setInterval(r,5e3)}function r(){e.next(),e.$rgDigest()}function i(){t&&clearInterval(t)}function o(){n()}n()}return{restrict:"E",controller:e,link:t,templateUrl:"templates/newsportal/breaking-news.directive.html"}}!function(e,t){"use strict";e.module("ringid.profile",["ringid.config","ringid.digits","ringid.global_services","ringid.auth","ringid.media","ui.bootstrap","angular-svg-round-progress"])}(angular,window),angular.module("ringid.profile").service("profileHttpService",profileHttpService),profileHttpService.$inject=["$$connector","OPERATION_TYPES","Utils"];function profileHttpService(e,t,n){var r=this,i=t.SYSTEM.PROFILE,o=t.SYSTEM.REQUEST_TYPE;function a(t,n){var r;return r=n?{actn:i.TYPE_ACTION_CURRENT_USER_BASICINFO}:{actn:i.TYPE_ACTION_OTHER_USER_BASICINFO,utId:t},e.request(r,o.REQUEST)}function s(t,n){var r={actn:i.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!n};return angular.extend(r,t),e.request(r,o.REQUEST,!0)}function c(t){var n={actn:i.TYPE_ACTION_USER_MOOD_PRESENCE,futId:t};return e.request(n,o.REQUEST)}function l(t){var n={actn:i.TYPE_ACTION_USER_MOOD,mood:t};return e.request(n,o.AUTHENTICATION)}function u(t){var n={actn:i.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:t};return e.request(n,o.REQUEST)}function d(t){var n;return n=t?{actn:i.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS,utId:t}:{actn:i.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS},e.send(n,o.REQUEST)}function g(t,n,r,a){var s,c=a;return 1!==c&&(c=c.getTime()),s={actn:i.TYPE_ACTION_MODIFY_USER_PROFILE,nOfHd:7,fn:n.fn.utf8Encode(),hc:n.hc?n.hc.utf8Encode():" ",cc:n.cc?n.cc.utf8Encode():" ",gr:n.gr,am:n.am.utf8Encode(),bDay:r?r.getTime():1,mDay:c},e.request(s,o.UPDATE)}function E(){var t={actn:i.TYPE_ACTION_MODIFY_PRIVACY_SETTINGS,pvc:[3,3,3,3,3]};return e.request(t,o.UPDATE)}function m(t){var n={actn:i.TYPE_ACTION_ADD_EDUCATION,request_type:o.UPDATE,edu:{af:1,cntn:t.cntn?t.cntn.utf8Encode():"",desc:t.desc?t.desc.utf8Encode():"",dgr:t.dgr?t.dgr.utf8Encode():"",grtd:t.grtd,iss:t.iss,scl:t.scl.utf8Encode(),ft:t.ft?t.ft:1,tt:t.tt?t.tt:1,ut:0}};return e.request(n,o.UPDATE)}function T(t){var n={actn:i.TYPE_ACTION_REMOVE_EDUCATION,id:t};return e.request(n,o.UPDATE)}function f(t){var n={actn:i.TYPE_ACTION_UPDATE_EDUCATION,edu:{id:t.id,scl:t.scl.utf8Encode(),ft:t.ft?t.ft:1,tt:t.tt?t.tt:1,desc:t.desc?t.desc.utf8Encode():"",af:t.af,grtd:t.grtd,iss:t.iss,cntn:t.cntn?t.cntn.utf8Encode():"",dgr:t.dgr?t.dgr.utf8Encode():""}};return e.request(n,o.UPDATE)}function p(){var t={actn:230};return e.request(t,o.REQUEST)}function _(t){var n={actn:i.TYPE_ACTION_ADD_SKILL,skill:{skl:t.skl.utf8Encode(),desc:t.desc.utf8Encode()}};return e.request(n,o.UPDATE)}function I(t){var n={actn:i.TYPE_ACTION_UPDATE_SKILL,skill:{id:t.id,skl:t.skl.utf8Encode(),desc:t.desc.utf8Encode()}};return e.request(n,o.UPDATE)}function h(t){var n={actn:i.TYPE_ACTION_REMOVE_SKILL,id:t};return e.request(n,o.UPDATE)}function A(t){var n={actn:i.TYPE_ACTION_ADD_WORK,request_type:o.UPDATE,wrk:{pstn:t.pstn?t.pstn.utf8Encode():"",desc:t.desc?t.desc.utf8Encode():"",cnm:t.cnm.utf8Encode(),tt:t.tt||1,ft:t.ft||1}};return e.request(n,o.UPDATE)}function C(t){var n={actn:i.TYPE_ACTION_UPDATE_WORK,wrk:{id:t.id,pstn:t.pstn.utf8Encode(),cnm:t.cnm.utf8Encode(),desc:t.desc.utf8Encode(),tt:t.tt||1,ft:t.ft||1}};return e.request(n,o.UPDATE)}function S(t){var n={actn:i.TYPE_ACTION_REMOVE_WORK,id:t};return e.request(n,o.UPDATE)}function v(t,n){var r={actn:i.CHANGE_PASSWORD,oPw:t,nPw:n};return e.request(r,o.UPDATE)}function M(t){var n={actn:i.SEND_VERIFICATION_CODE_TO_MAIL,el:t.email};return e.request(n,o.REQUEST)}function D(t){var n={actn:i.SEND_VERIFICATION_CODE_TO_MAIL,el:t.email,vc:t.code};return e.request(n,o.REQUEST)}function O(t){var n={actn:t.utId,sn:t.sn,sv:t.sv};return t.hasOwnProperty("utId")&&(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function R(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function N(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function P(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function y(t){var r={actn:i.ADD_SOCIAL_NETWORK,it:t.access_token,smid:t.id,wk:n.getUniqueID()};return"facebook"===t.platform?r.smt=4:"twitter"===t.platform&&(r.smt=5),e.request(r,o.AUTHENTICATION)}function b(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}function U(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}function L(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}function F(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}r.basicAndPrivacy=a,r.getUserDetails=s,r.fetchPresenceAndMood=c,r.changeMood=l,r.getMutualFriends=u,r.getUserProfileData=d,r.updateProfile=g,r.updateProfilePrivacy=E,r.submitNewEducation=m,r.deleteEducation=T,r.updateEducationById=f,r.getAllSkill=p,r.submitNewSkill=_,r.updateSkill=I,r.deleteSkill=h,r.submitNewWork=A,r.updateWork=C,r.deleteWork=S,r.changePassword=v,r.sendCode=M,r.verifyCode=D,r.changePrivacy=O,r.saveCallPvcEdit=R,r.saveChatPvcEdit=N,r.saveFeedPvcEdit=P,r.addSocialAccount=y,r.saveAchatSetting=b,r.saveAinfndreqSettings=U,r.saveAfamSettings=L,r.saveAafSetting=F}angular.module("ringid.profile").directive("rgImgReposition",rgImgReposition),rgImgReposition.$inject=["imageQuality","$document","APP_CONSTANTS","GlobalEvents","SystemEvents"];function rgImgReposition(e,t,n,r,i){function o(e,t,n,r){if(3===arguments.length||r){if(n<e)return e;if(n>t)return t}return n}function a(e,t){var r,a,s,c,l=t[0].clientWidth,u=t[0].clientHeight,d="avatar"===e.imgType?n.PROFILE_PIC_CROP_WIDTH:n.COVER_PIC_CROP_WIDTH,g="avatar"===e.imgType?n.PROFILE_PIC_CROP_WIDTH:n.COVER_PIC_CROP_HEIGHT,E=1,m="",T=1,f=!1,p={bound:!0},_={width:0,height:0};function I(){var e;l=t[0].clientWidth,e=Math.ceil(n.COVER_PIC_CROP_HEIGHT*l/n.COVER_PIC_CROP_WIDTH),t[0].style.height=e+"px",u=e}"cover"===e.imgType&&(I(!0),e.$on(i.COMMON.WINDOW_RESIZED,I)),e.$watch("enabled",function(e){e?v():h(!1)});function h(n){n||e.enabled?(t.bind("mousedown",A),t.bind("mouseup",S)):(t.unbind("mousedown",A),t.unbind("mouseup",S)),e.$rgDigest()}function A(n){e.enabled&&(1===n.which&&(s=n.clientX,c=n.clientY,f=!0),t.bind("mousemove",C))}function C(n){var i,d,g;e.enabled&&f&&(i=e.elemStyle.backgroundPosition.match(/(-?\d+).*?\s(-?\d+)/)||[],d=n.clientX,g=n.clientY,r=parseInt(i[1],10)||0,a=parseInt(i[2],10)||0,r=o(l-_.width,0,r+d-s,p.bound),a=o(u-_.height,0,a+g-c,p.bound),t.css({backgroundPosition:r+"px "+a+"px"}))}function S(){e.enabled&&f&&(void 0!==r&&void 0!==a&&(e.elemStyle.backgroundPosition=r+"px "+a+"px",e.uploadFile.setRepositionData({cimX:Math.ceil(Math.abs(r)/T)||0,cimY:Math.ceil(Math.abs(a)/T)||0},e.imgType)),f=!1,r=void 0,a=void 0,t.unbind("mousemove",C))}function v(){var t,n=e.elemStyle.backgroundImage;m=(n.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],m&&(t=new Image,t.onload=M,t.src=m)}function M(){var t=this;e.toggleResizeShow()(e.imgType,!1),_.width=t.width,_.height=t.height,_.width/d<=_.height/g?(T=l/_.width,_.width=l,_.height=Math.floor(_.height*T),E=t.width/d,e.uploadFile.setRepositionData({iw:Math.ceil(t.width),ih:Math.ceil(g*E)},e.imgType)):(T=u/_.height,_.height=u,_.width=Math.floor(_.width*T),E=t.height/g,e.uploadFile.setRepositionData({ih:Math.ceil(t.height),iw:Math.ceil(d*E)},e.imgType)),h(!0)}function D(){e.enabled&&(t.unbind("mousedown",A),t.unbind("mouseup",S))}e.$on("$destroy",D)}return{restrict:"A",replace:!1,scope:{elemStyle:"=",enabled:"=",uploadFile:"=",imgType:"@",toggleResizeShow:"&"},link:a}}angular.module("ringid.profile").directive("rgProfile",rgProfile);function rgProfile(){e.$inject=["$ringbox","$scope","Notification","Storage","friendsFactory","routeService","$routeParams","Auth","profileFactory","fileUploadService","imageQuality","Api","UPLOAD_TYPES","SystemEvents","Utils","Ringalert","languageConstant","$rootScope","rgDropdownService","GlobalEvents"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f,p,_,I){var h=a.uId,A=!1,C="",S="";t.upload={avatar:g.AVATAR,cover:g.COVER},t.profileUpload=null,t.coverUpload=null,t.viewport=m.viewport,t.isOwner=s.currentUser().getUId()===h,t.consType=f.get(),t.profilePicDragEnable=!1,t.coverPicDragEnable=!1,t.processing=!1,t.profileDdControl={showOnHover:!0,enableCoverReposition:!0,enableProfileReposition:!0},t.showCoverDD=!1,t.coverPhotoStyle={backgroundSize:"cover"},t.profilePhotoStyle={backgroundSize:"cover"},t.routes={friends:o.getRoute("PROFILE",{uId:a.uId,subpage:"friends"}),photos:o.getRoute("PROFILE",{uId:a.uId,subpage:"photos"}),media:o.getRoute("PROFILE",{uId:a.uId,subpage:"media",albumType:a.albumType||"audio"}),post:o.getRoute("PROFILE",{uId:a.uId}),about:o.getRoute("PROFILE",{uId:a.uId,subpage:"about"})},t.profileObj=c.getProfile(h),t.frndAction=R,t.toggleResizeShow=y,t.uploadAction=b,t.uploadPicture=U,t.toggleCoverPhotoReposition=L,t.toggleProfilePhotoReposition=F,t.getImageData=k,t.coverDdHtml="templates/dropdowns/coverphoto-dropdown.html",t.coverDdAction=N,t.profileDdHtml="templates/dropdowns/profilephoto-dropdown.html",t.profileActionHtml="templates/dropdowns/friend-action-dropdown.html",t.profileDdAction=P,t.cvUploadProgressShow=!1,t.cvResizeProgressShow=!1,t.ppResizeProgressShow=!1,t.uploadStyle=w,t.roundProgressBarStyle={dataRoundProgressWidth:"200",dataRoundProgressHeight:"200",dataRoundProgressOuterCircleWidth:"4",dataRoundProgressInnerCircleWidth:"8",dataRoundProgressOuterCircleRadius:"85",dataRoundProgressInnerCircleRadius:"85",dataRoundProgressLabelFont:"24",dataRoundProgressOuterCircleBackgroundColor:"#fff",dataRoundProgressOuterCircleForegroundColor:"#f47727",dataRoundProgressInnerCircleColor:"#fff",dataRoundProgressLabelColor:"#fff"},t.ppUploadProgressShow=!1,t.uploadImageFileSize=G,t.getRoundedProgressTextStyle=B,t.roundProgressData=$,t.openRingbox=H,t.showMenuItems=!1,t.toggleMenuItem=v;function v(){t.showMenuItems=!t.showMenuItems,x()}t.closeDropdown=M;function M(){t.showMenuItems=!1,x()}function D(){t.profileObj&&m.setPageTitle(t.profileObj.getName(),!0),void 0===a.subpage?t.subPage="post":(t.subPage=a.subpage,"about"===t.subPage&&(t.activeNav="basic")),t.subPageLink="templates/profile/profile."+t.subPage+".html",c.init(t.profileObj).then(function(){O(g.COVER),O(g.AVATAR)}),O(g.COVER),O(g.AVATAR),t.$on(E.IMAGE.DO_REPOSITION,function(n,r){C=r.albumType===S?r.iurl:"",t.toggleResizeShow(S,!0),t.uploadAction({action:S,uploadFile:l.createUpload({uploadType:S,file:r.image,fileType:"image"},x)}),e.closeAll()}),t.$watch("profilePicDragEnable",function(e){e||t.ppUploadProgressShow||O(g.AVATAR)}),t.$watch("coverPicDragEnable",function(e){e||t.cvUploadProgressShow||O(g.COVER)}),t.$on(E.FILE_UPLOAD.PROGRESS_UPDATE,function(){x()}),I.bindHandler("window","resize",x)}D();function O(e){e===g.AVATAR?(t.profilePhotoStyle.backgroundImage="url("+t.profileObj.avatar("thumb")+")",t.profilePhotoStyle.backgroundPosition="50% 50%",t.profilePhotoStyle.backgroundImage.indexOf("prof.png")>-1?t.profileDdControl.enableProfileReposition=!1:t.profileDdControl.enableProfileReposition=!0):(t.coverPhotoStyle.backgroundImage="url("+t.profileObj.getCover()+")",t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage.indexOf("default_cover")>-1?t.profileDdControl.enableCoverReposition=!1:t.profileDdControl.enableCoverReposition=!0),x()}function R(e){_.close(e.event),e.friend.isLoading()||(i.friendAction(e,!0).then(function(){x()},function(){x()}),x())}function N(e){switch(_.close(e.event),
e.action){case g.COVER:C="",A=!1,t.toggleResizeShow(g.COVER,!0),t.uploadAction(e);break;case"toggleReposition":C=t.profileObj.getCover("iurl"),A=!0,t.toggleResizeShow(g.COVER,!0),t.uploadAction({action:g.COVER,uploadFile:l.createUpload({uploadType:g.COVER,fileType:"image",file:t.profileObj.getCover("original")},x)});break;case"popupData":return S=g.COVER,function(){return{popupType:S}}}return!0}function P(e){switch(_.close(e.event),e.action){case g.AVATAR:C="",A=!1,t.toggleResizeShow(g.AVATAR,!0),t.uploadAction(e);break;case"toggleReposition":C=t.profileObj.avatar("iurl"),A=!0,t.toggleResizeShow(g.AVATAR,!0),t.uploadAction({action:g.AVATAR,uploadFile:l.createUpload({uploadType:g.AVATAR,fileType:"image",file:t.profileObj.avatar("original")},x)});break;case"popupData":return S=g.AVATAR,function(){return{popupType:S}}}return!0}function y(e,n){e===g.COVER?t.cvResizeProgressShow=n||!1:t.ppResizeProgressShow=n||!1,x()}function b(e){p.$broadcast(E.LOADING,!0),e.action===g.COVER?(t.coverUpload=e.uploadFile,t.coverUpload.fetchMeta(n)):(t.profileUpload=e.uploadFile,t.profileUpload.fetchMeta(n));function n(n){p.$broadcast(E.LOADING,!1),n.success?e.action===g.COVER?t.toggleCoverPhotoReposition(t.coverUpload.getPreview()):t.toggleProfilePhotoReposition(t.profileUpload.getPreview()):(t.toggleResizeShow(e.action,!1),T.show(n.message,"error")),x()}x()}function U(e,n){S=e,l.setScopeForDigest(S,t),S===g.COVER?(t.cvUploadProgressShow=!0,t.coverPicDragEnable=!1,t.coverUpload.initUpload(C).then(i,o)):S===g.AVATAR&&(t.ppUploadProgressShow=!0,t.profilePicDragEnable=!1,t.profileUpload.initUpload(C).then(i,o)),p.$broadcast(E.LOADING,!0),n&&n.stopPropagation(),x();function i(n){var i;l.removeScope(S,t),t.cvUploadProgressShow=!1,t.ppUploadProgressShow=!1,n.sucs===!0?S===g.AVATAR?(i=Boolean(C)?angular.extend({issa:Boolean(C),imgId:t.profileObj.getProfileImageId()},n,t.profileUpload.getRepositionData()):angular.extend(n,t.profileUpload.getRepositionData()),d.user.changeAvatar(i).then(o,a)):(i=angular.extend({issa:Boolean(C),imgId:t.profileObj.getCoverImageId()},n,t.coverUpload.getRepositionData()),d.user.changeCover(i).then(o,a)):(O(e),p.$broadcast(E.LOADING,!1));function o(i){i.sucs===!0?(p.$broadcast(E.LOADING,!1),S===g.AVATAR?(r.updateLoginData("prIm",n.iurl),r.updateLoginData("prImId",i.imgId),t.profileObj.setProfileImage(n.iurl,i.imgId),p.$rgDigest(!0)):t.profileObj.setCover(angular.extend(n,{cImId:i.imgId})),O(e)):a(i)}function a(t){T.show(t.mg||"Request Failed","error"),p.$broadcast(E.LOADING,!1),O(e)}}function o(){l.removeScope(S,t),O(e)}}function L(e,n){var r,i="",o=e||!1,a=t.profileObj.getCoverXY();t.coverPicDragEnable?(t.coverPicDragEnable=!1,O(g.COVER)):(o?i=o:(o=t.profileObj.getCover(),r=o.slice(o.lastIndexOf("/")+1,o.length),i=o.replace(r,r.replace("crp",""))),A?t.coverPhotoStyle.backgroundPosition=-a.x+"px "+-a.y+"px":t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage="url("+i+")",t.coverPicDragEnable=!0,x()),n&&n.stopPropagation()}function F(e,n){var r,i,o="",a=e||!1,s=t.profileObj.getAvatarXY();t.profilePicDragEnable?(t.profilePicDragEnable=!1,O(g.AVATAR)):(a?o=a:(a=t.profileObj.avatar("iurl"),r=a.slice(a.lastIndexOf("/")+1,a.length),o=a.replace(r,r.replace(i,""))),A?t.profilePhotoStyle.backgroundPosition=-s.x+"px "+-s.y+"px":t.profilePhotoStyle.backgroundPosition="0px 0px",t.profilePhotoStyle.backgroundImage="url("+o+")",t.profilePicDragEnable=!0,x()),n&&n.stopPropagation()}function k(e){return{data:function(){return{imgId:e}},promise:d.image.details(e)}}function w(e){return e===g.COVER?{width:(t.coverUpload?t.coverUpload.getProgress():"0")+"%"}:{width:(t.profileUpload?t.profileUpload.getProgress():"0")+"%"}}function G(){return l.currentUploadImageSize}function B(){return{top:"50%",bottom:"auto",left:"50%",transform:"translateY(-50%) translateX(-50%)","font-size":100/3.5+"px",position:"absolute"}}function $(){return{label:t.profileUpload.getProgress()+"%",percentage:t.profileUpload.getProgress(),dataLoaded:l.dataLoaded}}function H(e){return e===g.COVER?!t.coverPicDragEnable&&!t.cvResizeProgressShow&&!t.cvUploadProgressShow&&t.profileDdControl.enableCoverReposition:!t.profilePicDragEnable&&!t.ppResizeProgressShow&&!t.ppUploadProgressShow&&t.profileDdControl.enableProfileReposition}function x(){t.$rgDigest(!0)}function Y(){I.unbindHandler("window","resize",x),l.removeScope(g.AVATAR,t),l.removeScope(g.COVER,t),"about"===a.subPage&&c.removeProfileData(t.profileObj.getUtId())}t.$on("$destroy",Y)}function t(e,t){function n(t){t.stopPropagation(),e.showCoverDD=!e.showCoverDD,e.$rgDigest()}t.on("mouseenter",n),t.on("mouseleave",n),e.$on("$destroy",function(){t.off("mouseenter",n),t.off("mouseleave",n)})}return{restrict:"E",scope:!0,templateUrl:"templates/profile/profile-header.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileBasic",rgProfileBasic);function rgProfileBasic(){e.$inject=["Storage","$scope","Utils","profileFactory","Ringalert","$rootScope"];function e(e,t,n,r,i,o){var a,s,c,l=/[!@#$%^&*~`()_+\-=\[\]{};':"\\|,.<>\/?]/gi;t.isEditProfile=!1,t.processing=!1,t.nameError=!1,t.$watch("tmpBasic.fn",function(e){e&&(a=e.match(l)||[],s=e.replace(/\s/g,""),s.length===a.length?t.nameError=!0:t.nameError=!1),t.$rgDigest()}),t.enableEditBasic=u,t.updateMyBasicInfo=g,t.cancelUpdateMyBasicInfo=d;function u(e){e.preventDefault(),t.tmpBasic=angular.copy(t.profileObj.getBasicInfo()),1!==t.tmpBasic.mDay&&"1"!==t.tmpBasic.mDay||(t.tmpBasic.marriageDay=null),1!==t.tmpBasic.birthDay&&"1"!==t.tmpBasic.birthDay||(t.tmpBasic.birthday=null),t.isEditProfile=!0,t.$rgDigest()}function d(){t.isEditProfile=!1,t.$rgDigest()}function g(){var c,u,d,g,E,m,T,f,p;return a=t.tmpBasic.fn.match(l)||[],s=t.tmpBasic.fn.replace(/\s/g,""),s.length===a.length?void(t.nameError=!0):(t.processing=!0,c=t.tmpBasic.marriageDay,null==c&&(c=1),d=typeof t.tmpBasic.birthday,g=typeof c,"string"===d?(E=t.tmpBasic.birthday.split("-"),m=parseInt(E[0],10)+","+parseInt(E[1],10)+","+parseInt(E[2],10),u=new Date(m)):(u=t.tmpBasic.birthday,1!==t.tmpBasic.birthDay&&"1"!==t.tmpBasic.birthDay&&(T=n.profileVerbalDate(t.tmpBasic.birthDay),t.tmpBasic.birthday=T)),"string"===g&&(f=c.split("-"),p=parseInt(f[0],10)+","+parseInt(f[1],10)+","+parseInt(f[2],10),c=new Date(p)),void r.updateUserProfile(t.uId,t.tmpBasic,u,c).then(function(n){n.sucs===!0?(t.tmpBasic.birthDay=u?u.getTime():"1","object"==typeof u?t.currentUser.setBirthday(t.tmpBasic.birthDay):t.currentUser.setBirthday("1"),"object"===g?t.currentUser.setMarriageday(c.getTime()):t.currentUser.setMarriageday("1"),t.profileObj.getBasicInfo().birthDay=t.tmpBasic.birthDay,t.currentUser.setName(t.tmpBasic.fn),t.currentUser.setHomeCity(t.tmpBasic.hc),t.currentUser.setCurrentCity(t.tmpBasic.cc),t.currentUser.setAboutMe(t.tmpBasic.am),e.updateLoginData("fn",t.tmpBasic.fn),t.currentUser.setGender(t.tmpBasic.gr),i.show("Successfully updated","success"),t.isEditProfile=!1):(t.isEditProfile=!1,i.show(n.mg,"error")),t.processing=!1,o.$rgDigest()}))}t.isDatePickerOpen=!1,t.model={},t.open=function(e,n){switch(e.preventDefault(),e.stopPropagation(),n){case"wcalendar":t.model.wcalendarTo=!1;break;case"wcalendarTo":t.model.wcalendar=!1;break;case"ecalendar":t.model.ecalendarTo=!1;break;case"ecalendarTo":t.model.ecalendar=!1;break;case"mcalendar":t.model.mcalendar=!1}t.model[n]=!t.model[n]},t.dateOptions={showWeeks:"false",startingDay:1},c=new Date,c.setMonth(c.getMonth()+6),t.minDate=new Date,t.maxBirthDate=new Date(c.getFullYear(),c.getMonth(),c.getDate()),t.maxWeddingDate=new Date(c.getFullYear()+20,c.getMonth(),c.getDate())}return{restrict:"E",templateUrl:"templates/profile/profile.about-basic.html",controller:e}}angular.module("ringid.profile").directive("rgProfilePrivacy",rgProfilePrivacy);function rgProfilePrivacy(){e.$inject=["Auth","Storage","$timeout","$scope","friendsFactory","profileFactory"];function e(e,t,n,r,i,o){r.isEditProfilePrivacy=!1,r.callPvcEdit=!1,r.chatPvcEdit=!1,r.feedPvcEdit=!1,r.fPrivacyInfo={callPrivacy:0,chatPrivacy:0,feedPrivacy:0},r.enablePrivacyEditMode=a,r.savePvcEdit=s,r.cancelPvcEdit=c,r.profileObj.isCurrentUser()?e.fetchPrivacy().then(function(e){e.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.cla,r.fPrivacyInfo.chatPrivacy=e.chta,r.fPrivacyInfo.feedPrivacy=e.fda),r.$rgDigest()}):(r.access=r.profileObj.getAccess,r.fPrivacyInfo.callPrivacy=r.profileObj.getAccess().cla,r.fPrivacyInfo.chatPrivacy=r.profileObj.getAccess().chta,r.fPrivacyInfo.feedPrivacy=r.profileObj.getAccess().fda,r.fPrivacyInfo.callPrivacy||r.fPrivacyInfo.chatPrivacy||r.fPrivacyInfo.feedPrivacy||r.profileObj.setBlock(1),r.$rgDigest());function a(e){e.preventDefault(),r.isEditProfilePrivacy=!0,r.$rgDigest()}function s(e){var t,n,i;r.isEditProfilePrivacy=!1,t=r.profileObj.isCurrentUser()?{actn:216,sv:e.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:e.callPrivacy,sn:6,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.callPrivacy=e.callPrivacy,o.saveCallPvcEdit(t).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.callPrivacy)}),n=r.profileObj.isCurrentUser()?{actn:216,sv:e.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:e.chatPrivacy,sn:7,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.chatPrivacy=e.chatPrivacy,o.saveChatPvcEdit(n).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.chatPrivacy=e.chatPrivacy)}),i=r.profileObj.isCurrentUser()?{actn:216,sv:e.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:e.feedPrivacy,sn:8,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.feedPrivacy=e.feedPrivacy,o.saveFeedPvcEdit(i).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.feedPrivacy=e.feedPrivacy)}),r.$rgDigest()}function c(){r.isEditProfilePrivacy=!1,r.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-privacy.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileEducation",rgProfileEducation);function rgProfileEducation(){e.$inject=["Ringalert","$scope","Utils","profileFactory","$routeParams","rgDropdownService","OPERATION_TYPES","$$connector"];function e(e,t,n,r,i,o,a,s){var c,l,u,d=a.SYSTEM.PROFILE,g={};t.profileObj.isCurrentUser()?t.isOwner=!0:t.isOwner=!1,t.getProfileData=r.getProfileData,t.educationlist=[],t.edusclerror=!1,t.edudgrerror=!1,t.educntnerror=!1,t.$watch("eduObjInfo.scl",function(e){e&&(t.edusclerror=!1)}),t.$watch("eduObjInfo.dgr",function(e){e&&(t.edudgrerror=!1)}),t.$watch("eduObjInfo.cntn",function(e){e&&(t.educntnerror=!1)}),t.ddActionHtml="templates/dropdowns/action-dropdown.html",t.actionEduDropdown=function(e){switch(o.close(e.event),e.action){case"edit":m(e.data.index,e.data.obj);break;case"delete":I(e.data.index,e.data.obj)}},t.isaddNewEducation=!1,t.isEditEducation=-1,t.eduObjInfo={},t.addNewEducation=E,t.submitNewEducation=_,t.updateEducation=p,t.cancelAddEducation=T,t.cancelUpdateEducation=f;function E(){c&&(t.educationlist[l]=c),t.isEditEducation=-1,t.eduObjInfo.scl="",t.eduObjInfo.dgr="",t.eduObjInfo.cntn="",t.eduObjInfo.toTimeE="",t.eduObjInfo.fromTimeE="",t.isaddNewEducation=!0,t.$rgDigest()}function m(e){l=e,t.eduObjInfo=t.educationlist[e],c=angular.copy(t.educationlist[e]),1===t.eduObjInfo.tt&&(t.eduObjInfo.toTimeE=null),1===t.eduObjInfo.ft&&(t.eduObjInfo.fromTimeE=null),t.isaddNewEducation=!0,t.isEditEducation=e,t.$rgDigest()}function T(){c&&(t.educationlist[l]=c),t.isaddNewEducation=!1,t.isEditEducation=-1,t.$rgDigest()}function f(){t.educationlist[l]=c,t.isEditEducation=-1,t.isaddNewEducation=!1,t.$rgDigest()}function p(){var i,o;if(t.eduObjInfo.scl||(t.edusclerror=!0,t.$rgDigest()),t.eduObjInfo.dgr||(t.edudgrerror=!0,t.$rgDigest()),t.eduObjInfo.cntn||(t.educntnerror=!0,t.$rgDigest()),!(t.edusclerror||t.edudgrerror||t.educntnerror)){if(t.processing=!0,t.eduObjInfo.fromTimeE&&t.eduObjInfo.toTimeE){if(i=t.eduObjInfo.fromTimeE,o=t.eduObjInfo.toTimeE,"string"==typeof i&&(i=new Date(i)),"string"==typeof o&&(o=new Date(o)),i>o)return e.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.$rgDigest()}t.eduObjInfo.fromTimeE?t.eduObjInfo.ft=new Date(t.eduObjInfo.fromTimeE).getTime():t.eduObjInfo.ft=1,t.eduObjInfo.toTimeE?t.eduObjInfo.tt=new Date(t.eduObjInfo.toTimeE).getTime():t.eduObjInfo.tt=1,r.updateEducation(t.eduObjInfo).then(function(r){r.sucs===!0?(t.eduObjInfo.fromTimeE?t.eduObjInfo.fromTimeE=n.profileVerbalDate(t.eduObjInfo.ft):(t.eduObjInfo.ft=1,t.eduObjInfo.fromTimeE=""),t.eduObjInfo.toTimeE?t.eduObjInfo.toTimeE=n.profileVerbalDate(t.eduObjInfo.tt):(t.eduObjInfo.tt=1,t.eduObjInfo.toTimeE=""),t.isEditEducation=-1,t.isaddNewEducation=!1,e.show("Successfully updated","success")):(t.isEditEducation=-1,t.isaddNewEducation=!1,e.show("Request did not process successfully","error")),t.processing=!1,t.$rgDigest()})}}function _(){if(t.eduObjInfo.scl||(t.edusclerror=!0,t.$rgDigest()),t.eduObjInfo.dgr||(t.edudgrerror=!0,t.$rgDigest()),t.eduObjInfo.cntn||(t.educntnerror=!0,t.$rgDigest()),!(t.edusclerror||t.edudgrerror||t.educntnerror)){if(t.processing=!0,t.eduObjInfo.fromTimeE&&t.eduObjInfo.toTimeE&&t.eduObjInfo.fromTimeE>t.eduObjInfo.toTimeE)return e.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.eduObjInfo.fromTimeE?t.eduObjInfo.ft=new Date(n.profileVerbalDate(t.eduObjInfo.fromTimeE)).getTime():t.eduObjInfo.ft=1,t.eduObjInfo.toTimeE?t.eduObjInfo.tt=new Date(n.profileVerbalDate(t.eduObjInfo.toTimeE)).getTime():t.eduObjInfo.tt=1,t.eduObjInfo.ut=(new Date).getTime(),t.eduObjInfo.af=1,t.eduObjInfo.grtd=!1,t.eduObjInfo.iss=!0,r.submitNewEducation(t.eduObjInfo).then(function(n){var r;n.sucs===!0?(t.eduObjInfo.id=n.id,r=angular.copy(t.eduObjInfo),t.educationlist.push(r),e.show("Education info added successfully","success"),t.isaddNewEducation=!1,t.isEditEducation=-1):(e.show("Request did not process successfully","error"),t.isaddNewEducation=!1,t.isEditEducation=-1),t.isaddNewEducation=!1,t.isEditEducation=-1,t.processing=!1,t.$rgDigest()})}}function I(n,i){var o=i.id;t.isEditEducation=-1,r.deleteEducation(o).then(function(r){r.sucs===!0?(t.educationlist.splice(n,1),e.show("Successfully deleted","success")):e.show("Request did not process successfully","error"),t.$rgDigest()})}function h(e){var r,i,o,a,s,c=[];if(e.sucs===!0){for(r=0;r<e.educationList.length;r++)s=e.educationList[r],g[s.id]=s;for(i=Object.keys(g),a=0;a<i.length;a++)o=g[i[a]],o.fromTime=new Date(o.ft),o.toTime=new Date(o.tt),o.fromTimeE=n.profileVerbalDate(o.ft),o.toTimeE=n.profileVerbalDate(o.tt),c.push(o);t.educationlist=c}t.$rgDigest()}u=s.subscribe(h,{action:[d.TYPE_ACTION_GET_EDUCATION]}),t.$on("$destroy",function(){s.unsubscribe(u),t.educationlist=[]})}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-education.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileWork",rgProfileWork);function rgProfileWork(){e.$inject=["$scope","Utils","profileFactory","$routeParams","rgDropdownService","Ringalert","OPERATION_TYPES","$$connector"];function e(e,t,n,r,i,o,a,s){var c,l,u,d=a.SYSTEM.PROFILE,g={};e.profileObj.isCurrentUser()?e.isOwner=!0:e.isOwner=!1,e.getProfileData=n.getProfileData,e.worklist=[],e.ddActionHtml="templates/dropdowns/action-dropdown.html",e.actionWorkDropdown=f,e.isAddNewWork=!1,e.isEditWork=-1,e.workObjInfo={},e.addNewWork=E,e.cancelNewWork=m,e.submitNewWork=T,e.cancelUpdateWork=I,e.updateWork=_,e.workcnmerror=!1,e.workpstnerror=!1,e.$watch("workObjInfo.cnm",function(t){t&&(e.workcnmerror=!1)}),e.$watch("workObjInfo.pstn",function(t){t&&(e.workpstnerror=!1)}),e.$watch("workObjInfo.status",function(){e.workObjInfo.toTimeE=""});function E(){c&&(e.worklist[l]=c),e.isEditWork=-1,e.workObjInfo.cnm="",e.workObjInfo.pstn="",e.workObjInfo.desc="",e.workObjInfo.fromTimeE="",e.workObjInfo.toTimeE="",e.workObjInfo.ft="",e.workObjInfo.tt="",e.isAddNewWork=!0,e.$rgDigest()}function m(){c&&(e.worklist[l]=c),e.isAddNewWork=!1,e.$rgDigest()}function T(){var r;if(e.workObjInfo.cnm||(e.workcnmerror=!0,e.$rgDigest()),e.workObjInfo.pstn||(e.workpstnerror=!0,e.$rgDigest()),!e.workcnmerror&&!e.workpstnerror){if(e.processing=!0,e.workObjInfo.fromTimeE&&e.workObjInfo.toTimeE&&e.workObjInfo.fromTimeE>e.workObjInfo.toTimeE)return o.show("Your end date can't be earlier than your start date. Please try again","info"),void(e.processing=!1);e.workObjInfo.status===!0?(e.workObjInfo.tt="0",e.workObjInfo.status=!0,e.workObjInfo.date_info="Present"):e.workObjInfo.toTimeE?e.workObjInfo.tt=new Date(e.workObjInfo.toTimeE).getTime():e.workObjInfo.tt=1,e.workObjInfo.fromTimeE?e.workObjInfo.ft=new Date(e.workObjInfo.fromTimeE).getTime():e.workObjInfo.ft=1,n.submitNewWork(e.workObjInfo).then(function(n){n.sucs===!0?(e.workObjInfo.id=n.id,e.workObjInfo.ft?e.workObjInfo.fromTimeE=t.profileVerbalDate(e.workObjInfo.ft):e.workObjInfo.ft=1,e.workObjInfo.tt?e.workObjInfo.toTimeE=t.profileVerbalDate(e.workObjInfo.tt):e.workObjInfo.tt=1,r=angular.copy(e.workObjInfo),e.worklist.push(r),o.show("Career info added successfully","success"),e.isAddNewWork=!1,e.isEditWork=-1):(o.show("Request did not process successfully","error"),e.isAddNewWork=!1,e.isEditWork=-1),e.processing=!1,e.$rgDigest()})}}function f(e){switch(e.action){case"edit":p(e.data.index),i.close(e.event);break;case"delete":h(e.data.index,e.data.obj),i.close(e.event)}}function p(t){l=t,e.workObjInfo=e.worklist[t],c=angular.copy(e.worklist[t]),1!==e.workObjInfo.tt&&"0"!==e.workObjInfo.tt&&0!==e.workObjInfo.tt||(e.workObjInfo.toTimeE=null),1===e.workObjInfo.ft&&(e.workObjInfo.fromTimeE=null),e.isAddNewWork=!0,e.isEditWork=t,e.$rgDigest()}function _(){var r,i;if(e.workObjInfo.cnm||(e.workcnmerror=!0,e.$rgDigest()),e.workObjInfo.pstn||(e.workpstnerror=!0,e.$rgDigest()),!e.workcnmerror&&!e.workpstnerror){if(e.processing=!0,e.workObjInfo.fromTimeE&&e.workObjInfo.toTimeE){if(r=e.workObjInfo.fromTimeE,i=e.workObjInfo.toTimeE,"string"==typeof r&&(r=new Date(r)),"string"==typeof i&&(i=new Date(i)),r>i)return o.show("Your end date can't be earlier than your start date. Please try again","info"),void(e.processing=!1);e.$rgDigest()}e.workObjInfo.fromTimeE?e.workObjInfo.ft=new Date(e.workObjInfo.fromTimeE).getTime():e.workObjInfo.ft=1,e.workObjInfo.toTimeE?e.workObjInfo.tt=new Date(e.workObjInfo.toTimeE).getTime():e.workObjInfo.tt=1,e.workObjInfo.status===!0&&(e.workObjInfo.tt="0",e.workObjInfo.status=!0,e.workObjInfo.date_info="Present"),n.updateWork(e.workObjInfo).then(function(n){n.sucs===!0?(e.workObjInfo.ft?e.workObjInfo.fromTimeE=t.profileVerbalDate(e.workObjInfo.ft):e.workObjInfo.ft=1,e.workObjInfo.tt?e.workObjInfo.toTimeE=t.profileVerbalDate(e.workObjInfo.tt):e.workObjInfo.tt=1,e.workObjInfo.status===!0&&(e.workObjInfo.tt=0,e.date_info="Present"),o.show("Updated successfully","success"),e.isEditWork=-1,e.isAddNewWork=!1):(e.isEditWork=-1,e.isAddNewWork=!1,o.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()})}}function I(){e.worklist[l]=c,e.isEditWork=-1,e.isAddNewWork=!1,e.$rgDigest()}function h(t,r){var i=r.id;e.isEditWork=-1,n.deleteWork(i).then(function(n){n.sucs===!0?(e.worklist.splice(t,1),o.show("Successfully deleted","success")):o.show("Request did not process successfully","error"),e.$rgDigest()})}function A(n){var r,i,o,a,s,c=[];if(n.sucs===!0){for(r=0;r<n.workList.length;r++)i=n.workList[r],g[i.id]=i;for(o=Object.keys(g),s=0;s<o.length;s++)a=g[o[s]],a.fromTime=new Date(a.ft),a.toTime=new Date(a.tt),0===a.tt?(a.status=!0,a.date_info="Present"):a.toTimeE=t.profileVerbalDate(a.tt),a.fromTimeE=t.profileVerbalDate(a.ft),c.push(a);e.worklist=c}e.$rgDigest()}u=s.subscribe(A,{action:[d.TYPE_ACTION_GET_WORK]}),e.$on("$destroy",function(){s.unsubscribe(u),e.worklist=[]})}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-work.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileSkill",rgProfileSkill);function rgProfileSkill(){e.$inject=["$scope","profileFactory","$routeParams","rgDropdownService","Ringalert","$$connector","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){var s,c,l,u=a.SYSTEM.PROFILE,d={};e.skilllist=[],e.profileObj.isCurrentUser()?e.isOwner=!0:e.isOwner=!1,e.skillsklerror=!1,e.skilldescerror=!1,e.$watch("skillObjInfo.skl",function(t){t&&(e.skillsklerror=!1)}),e.$watch("skillObjInfo.desc",function(t){t&&(e.skilldescerror=!1)}),t.getUserProfileData({uId:n.uId},e.profileObj.isCurrentUser()),e.getProfileData=t.getProfileData,e.addNewSkill=g,e.submitNewSkill=E,e.cancelNewSkill=m,e.updateSkill=T,e.cancelUpdateSkill=_,e.skillObjInfo={},e.ddActionHtml="templates/dropdowns/action-dropdown.html",e.actionSkillDropdown=function(e){switch(e.action){case"edit":p(e.data.index);break;case"delete":f(e.data.index,e.data.obj)}r.close(e.event)},e.isAddNewSkill=!1;function g(){s&&(e.skilllist[c]=s),e.isEditSkill=-1,e.skillObjInfo.skl="",e.skillObjInfo.desc="",e.isAddNewSkill=!0,e.$rgDigest()}function E(){e.skillObjInfo.desc||(e.skilldescerror=!0,e.$rgDigest()),e.skillObjInfo.skl||(e.skillsklerror=!0,e.$rgDigest()),e.skillsklerror||e.skilldescerror||(e.processing=!0,t.submitNewSkill(e.skillObjInfo).then(function(t){var n;t.sucs===!0?(e.skillObjInfo.id=t.id,n=angular.copy(e.skillObjInfo),e.skilllist.push(n),i.show("Skill info added successfully","success"),e.isAddNewSkill=!1):(e.isAddNewSkill=!1,i.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()}))}function m(){s&&(e.skilllist[c]=s),e.isAddNewSkill=!1,e.$rgDigest()}function T(){e.skillObjInfo.desc||(e.skilldescerror=!0,e.$rgDigest()),e.skillObjInfo.skl||(e.skillsklerror=!0,e.$rgDigest()),e.skillsklerror||e.skilldescerror||(e.processing=!0,t.updateSkill(e.skillObjInfo).then(function(t){t.sucs===!0?(e.isEditSkill=-1,e.isAddNewSkill=!1,i.show("Successfully updated","success")):(e.isEditSkill=-1,e.isAddNewSkill=!1,i.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()}))}function f(n,r){var o=r.id;e.isEditSkill=-1,t.deleteSkill(o).then(function(t){t.sucs===!0?(e.skilllist.splice(n,1),i.show("Successfully deleted","success")):i.show("Request did not process successfully","error"),e.$rgDigest()})}function p(t){c=t,e.skillObjInfo=e.skilllist[t],s=angular.copy(e.skilllist[t]),e.isAddNewSkill=!0,e.isEditSkill=t,e.$rgDigest()}function _(){e.skilllist[c]=s,e.isEditSkill=-1,e.isAddNewSkill=!1,e.$rgDigest()}function I(t){var n,r,i,o,a,s=[];if(t.sucs===!0){for(n=0;n<t.skillList.length;n++)r=t.skillList[n],d[r.id]=r;for(i=Object.keys(d),a=0;a<i.length;a++)o=d[i[a]],s.push(o);e.skilllist=s}e.$rgDigest()}l=o.subscribe(I,{action:[u.TYPE_ACTION_GET_SKILL]}),e.$on("$destroy",function(){o.unsubscribe(l),e.skilllist=[]})}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-skill.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfilePassword",rgProfilePassword);function rgProfilePassword(){e.$inject=["$scope","Ringalert","profileFactory"];function e(e,t,n){e.enablePassEdit=r,e.updatePassword=o,e.cancelUpdatePassword=i,e.showMessage=!0,e.showPassEdit=!1,e.IsMatch=!1,e.oldError=!1,e.failMessage="",e.changepass={};function r(t){t.preventDefault(),e.showPassEdit===!1&&(e.showPassEdit=!0,e.showMessage=!1),e.$rgDigest()}function i(){e.changepass={oldpassword:"",newpassword:"",repassword:""},e.showPassEdit=!1,e.showMessage=!0,e.IsMatch=!1,e.oldError=!1,e.$rgDigest()}function o(){e.changepass.newpassword!==e.changepass.repassword?e.IsMatch=!0:e.changepass.newpassword===e.changepass.repassword&&(e.IsMatch=!1,e.oldError=!1,n.changePassword(e.changepass.oldpassword,e.changepass.newpassword).then(function(n){n.sucs===!0?(e.changepass={oldpassword:"",newpassword:"",repassword:""},e.showPassEdit=!1,e.showMessage=!0,t.show("Password Changed Successfully","success")):(e.failMessage=n.mg,e.oldError=!0,e.$rgDigest())},function(){})),e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-password.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileRecovery",rgProfileRecovery);function rgProfileRecovery(){e.$inject=["rgDropdownService","Api","$scope","Ringalert","profileFactory"];function e(e,t,n,r,i){var o;n.emailVerified=!1,n.phoneVerified=!1,n.isAddEmail=!1,n.isAddPhone=!1,n.addEmail=a,n.isAddCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.cancelAddEmail=s,n.cancelAddPhone=c,n.sendCode=l,n.verifyCode=d,n.verifyThePhoneNum=u,n.verifierEnabled=!1,n.enableVerifier=function(){n.verifierEnabled=!0},n.emailValue="Verify Email",n.emailTitle="Click here to verify your Email",n.phoneValue="Verify Phone",n.phoneTitle="Click here to verify your Phone",n.profileObj.isEmailVerified()&&(n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.emailVerified=!0,n.vemail=n.profileObj.getEmail()),n.profileObj.isMobileVerified()&&(n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified.",n.phoneVerified=!0,n.vnumber=n.profileObj.getMobileNumber()),n.cancelVerification=function(){n.isAddCode=!1,n.isAddPhnCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.$rgDigest()},n.resendCodeToMail=function(){i.sendCode({email:o}).then(function(e){e.sucs===!0?(o=e.el,r.show(e.mg,"info")):r.show(e.mg,"info"),n.$rgDigest()})};function a(){n.isAddEmail=!0,n.showAddEmailButton=!1,n.$rgDigest()}function s(){n.isAddEmail=!1,n.showAddEmailButton=!0,n.$rgDigest()}function c(){n.isAddPhone=!1,n.showAddPhoneButton=!0,n.$rgDigest()}function l(e){i.sendCode(e).then(function(t){t.sucs===!0?(o=t.el,n.isAddEmail=!1,n.isAddCode=!0,n.vemail="",n.emailVerified=!1,n.emailTitle="Click here to verify your Email",e.email=""):r.show(t.mg,"info"),n.$rgDigest()})}function u(e){n.verifierEnabled=!1,t.user.verifyPhoneNo(e).then(function(t){t.sucs===!0?(n.phoneNumber=e.mblDc+e.mbl,n.vnumber=n.phoneNumber,n.phoneVerified=!0,n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified."):r.show(t.mg,"error"),n.$rgDigest()})}function d(e){e.email=o,i.verifyCode(e).then(function(t){t.sucs===!0?(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!0,n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.vemail=t.el,e.code="",e.email="",r.show(t.mg,"success")):(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!1,n.vemail="",r.show(t.mg,"info")),n.$rgDigest()})}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-recovery.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAchat",rgProfileAchat);function rgProfileAchat(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditSetting=!1,e.settings={achat:n.getPermission().ancht,ainfndreq:n.getPermission().aifr,afam:n.getPermission().afam,aaf:n.getPermission().aaf},e.enableSettingsEditMode=r,e.saveSettings=i,e.cancelSettings=o;function r(t){t.preventDefault(),e.isEditSetting=!0,e.$rgDigest()}function i(r){var i,o,a,s;e.isEditSetting=!1,e.profileObj.isCurrentUser()&&(i={sv:r.achat,sn:10},o={sv:r.ainfndreq,sn:11},a={sv:r.afam,sn:12},s={sv:r.aaf,sn:13}),e.settings.achat=r.achat,e.settings.ainfndreqobj=r.ainfndreq,e.settings.afam=r.afam,e.settings.aaf=r.aaf,t.saveAchatSetting(i).then(function(t){t.sucs===!0?(e.settings.achat=r.achat,n.setAchatPermission(r.achat)):e.settings.achat=0}),e.$rgDigest(),t.saveAinfndreqSettings(o).then(function(t){t.sucs===!0?(e.settings.ainfndreq=r.ainfndreq,n.setAinfndreqPermission(r.ainfndreq)):e.settings.ainfndreq=0}),e.$rgDigest(),t.saveAfamSettings(a).then(function(t){t.sucs===!0?(e.settings.afam=r.afam,n.setAfamPermission(r.afam)):e.settings.afam=0}),e.$rgDigest(),t.saveAafSetting(s).then(function(t){t.sucs===!0?(e.settings.aaf=r.aaf,n.setAafPermission(r.aaf)):e.settings.aaf=0}),e.$rgDigest()}function o(){e.isEditSetting=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-achat.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAinfndreq",rgProfileAinfndreq);function rgProfileAinfndreq(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAinfndreq=!1,e.incomingfndreqsettings={ainfndreq:n.getPermission().aifr},e.enableAinfndreqEditMode=r,e.saveAinfndreqSettings=i,e.cancelAinfndreqSettings=o;function r(t){t.preventDefault(),e.isEditAinfndreq=!0,e.$rgDigest()}function i(r){var i;e.isEditAinfndreq=!1,e.profileObj.isCurrentUser()&&(i={sv:r.ainfndreq,sn:11}),e.incomingfndreqsettings.ainfndreqobj=r.ainfndreqobj,t.saveAinfndreqSettings(i).then(function(t){t.sucs===!0?(e.incomingfndreqsettings.ainfndreq=r.ainfndreq,n.setAinfndreqPermission(r.ainfndreq)):e.incomingfndreqsettings.ainfndreq=0}),e.$rgDigest()}function o(){e.isEditAinfndreq=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-incoming-frnd-req.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAllowaddme",rgProfileAllowaddme);function rgProfileAllowaddme(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAfam=!1,e.afamsettings={afam:n.getPermission().afam},e.enableAfamEditMode=r,e.saveAfamSettings=i,e.cancelAfamSettings=o;function r(t){t.preventDefault(),e.isEditAfam=!0,e.$rgDigest()}function i(r){var i;e.isEditAfam=!1,e.profileObj.isCurrentUser()&&(i={sv:r.afam,sn:12}),e.afamsettings.afam=r.afam,t.saveAfamSettings(i).then(function(t){t.sucs===!0?(e.afamsettings.afam=r.afam,n.setAfamPermission(r.afam)):e.afamsettings.afam=0}),e.$rgDigest()}function o(){e.isEditAfam=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-afam.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAutoaddfrnd",rgProfileAutoaddfrnd);function rgProfileAutoaddfrnd(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAaf=!1,e.aafsettings={aaf:n.getPermission().aaf},e.enableAafEditMode=r,e.saveAafSettings=i,e.cancelAafSettings=o;function r(t){t.preventDefault(),e.isEditAaf=!0,e.$rgDigest()}function i(r){var i;e.isEditAaf=!1,e.profileObj.isCurrentUser()&&(i={sv:r.aaf,sn:13}),e.aafsettings.aaf=r.aaf,t.saveAafSetting(i).then(function(t){t.sucs===!0?(e.aafsettings.aaf=r.aaf,n.setAafPermission(r.aaf)):e.aafsettings.aaf=0}),e.$rgDigest()}function o(){e.isEditAaf=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-aaf.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgRelocateTemplate",function(){return{restrict:"E",template:'<ng-include src="template"></ng-include>',link:function(e,t,n){var r=n.twocol,i=n.threecol;e.template=i,window.innerWidth>1800||window.innerWidth<1200&&e.template!==i?e.template=i:window.innerWidth>1200&&window.innerWidth<1800&&e.template!==r&&(e.template=r),window.onresize=function(){window.innerWidth>1800||window.innerWidth<1200&&e.template!==i?(e.template=i,e.$apply()):window.innerWidth>1200&&window.innerWidth<1800&&e.template!==r&&(e.template=r,e.$apply())}}}}),angular.module("ringid.profile").service("profileFactory",profileFactory),profileFactory.$inject=["$routeParams","Storage","Auth","$$connector","$$q","Ringalert","profileHttpService","userFactory","Utils"];function profileFactory(e,t,n,r,i,o,a,s){var c=n.currentUser(),l={},u={};function d(e,t,n){if(u.hasOwnProperty(n))switch(e){case"educationList":break;case"workList":break;case"skillList":}}function g(e,t){return u.hasOwnProperty(t)?u[t][e]:[]}function E(e){delete u[e]}function m(e){return c||(c=n.currentUser()),e&&e!==c.getUId()?l=s.create({uId:e}):c}function T(e){var t=i.defer();return a.basicAndPrivacy(e.getUtId(),e.isCurrentUser()).then(function(n){n.sucs===!0?(e.updateUserObj(n.userDetails||n),e.isCurrentUser()?c=e:(l=e,a.fetchPresenceAndMood(e.getUtId()).then(function(e){l.updateUserObj(e)})),t.resolve()):t.reject()}),t.promise}function f(e,t){var n;n=t?c:s.create(e),t?a.getUserProfileData():a.getUserProfileData(n.getUtId())}return{init:T,getProfile:m,getUserProfileData:f,updateUserProfile:a.updateProfile,savePvcEdit:a.updateUserPrivacy,submitNewEducation:a.submitNewEducation,saveAchatSetting:a.saveAchatSetting,saveAinfndreqSettings:a.saveAinfndreqSettings,
saveAfamSettings:a.saveAfamSettings,saveAafSetting:a.saveAafSetting,getProfileData:g,setProfileData:d,removeProfileData:E,deleteEducation:a.deleteEducation,getAllEducation:a.getEducationData,updateEducation:a.updateEducationById,submitNewSkill:a.submitNewSkill,updateSkill:a.updateSkill,deleteSkill:a.deleteSkill,submitNewWork:a.submitNewWork,updateWork:a.updateWork,deleteWork:a.deleteWork,changePassword:a.changePassword,verifyCheck:a.verifyCheck,sendCode:a.sendCode,verifyCode:a.verifyCode,changePrivacy:a.changePrivacy,saveCallPvcEdit:a.saveCallPvcEdit,saveChatPvcEdit:a.saveChatPvcEdit,saveFeedPvcEdit:a.saveFeedPvcEdit,moodChange:a.moodChange,addSocialAccount:a.addSocialAccount}}!function(e,t){"use strict";e.module("ringid.circle",["ringid.global_services","ringid.global_directives","ringid.shared"])}(angular,window),angular.module("ringid.circle").controller("CirclePopupController",CirclePopupController),CirclePopupController.$inject=["$scope","$rootScope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","Ringalert","Auth","rgScrollbarService","$location"];function CirclePopupController(e,t,n,r,i,o,a,s,c,l,u){e.circleAddMode=!1,e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleNameSection=!0,e.circleMemberSection=!1,e.circleAdminSection=!1,e.friendDropdown=!1;function d(t){t?e.friendDropdown=!0:e.friendDropdown=!1}e.$watch("friendsNameFilter",d),e.closeFriendDd=g;function g(){e.friendDropdown=!1,e.$rgDigest()}e.friendlistNameFilter="",e.memberfilter="",e.nextPart=E;function E(t){switch(t){case"setname":e.circleNameSection=!0,e.circleMemberSection=!1,e.circleAdminSection=!1,e.$rgDigest();break;case"setmembers":e.circleNameSection=!1,e.circleMemberSection=!0,e.circleAdminSection=!1,e.$rgDigest();break;case"setadmins":e.circleNameSection=!1,e.circleMemberSection=!1,e.circleAdminSection=!0,e.$rgDigest()}}function m(){e.friendlist.reset(),e.selectedMembers=[]}e.$on("$destroy",m),e.friendlist=i.getFriends("friends"),e.models={errCircleName:!1,errMemberList:!1,errAdminList:!1},a.circleId||(e.circleAddMode=!0),e.editMode=!1,a&&a.circleId?(e.circle=n.getCircle(a.circleId),e.memberList=e.circle.getMembers(),e.adminList=e.circle.getAdmins(),e.isCurrentUserSuperAdmin=e.circle.isSuperAdmin(c.currentUser().getKey()),e.models.popupTitle="Edit Group",e.models.circleName=e.circle.getName(),e.editMode=!0):(e.models.popupTitle="Create New Circle",e.models.circleName="",e.memberList=o.createNew(),e.adminList=o.createNew()),e.addToCircle=p,e.addToAdmin=I,e.removeMember=_,e.removeAdmin=h,e.createCircle=T,e.updateCircle=f,e.close=r.close,e.loadMoreFriends=S;function T(){var t,i=[];e.memberList.doForAll(function(e){i.push({admin:!1,utId:e.getUtId()})}),e.adminList.doForAll(function(e){i.push({admin:!0,utId:e.getUtId()})}),t={tg:e.models.circleName,alluser:i,utId:c.currentUser().getUtId()};function o(e){e.sucs===!0&&(r.closeAll(),u.path("/circle/"+e.grpId))}n.createCircle(t).then(o)}function f(){var t,r,i,o,a,c,l,u,d,g;t=e.memberList.keys(),r=e.adminList.keys(),i=e.circle.getMemberIds(),o=e.circle.getAdminIds(),a=t.difference(i),c=i.difference(t),l=r.difference(o),u=o.difference(r),g=[];function E(e){g.push({admin:!1,uId:e})}angular.forEach(a,E);function m(e){g.push({admin:!0,uId:e})}angular.forEach(l,m),g.length>0&&n.addMembers(g,e.circle),d=c,d=d.concat(u),d.length>0&&n.removeMembers(d,e.circle),s.show("Circle Updated","success"),e.close()}function p(t){e.memberList.add(t.getKey(),t),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function _(t){e.memberList.remove(t.getKey()),e.$rgDigest()}function I(t){e.adminList.add(t.getKey(),t),e.memberList.remove(t.getKey()),e.$rgDigest()}function h(t){e.adminList.remove(t.getKey()),e.memberList.add(t.getKey(),t),e.$rgDigest()}function A(t){e.state.loading=t,t||l.recalculate(e),e.$$phase||e.$root.$$phase||e.$digest()}function C(t){function n(){e.friendlist=i.getFriends("friends"),A(!1),e.$rgDigest()}function r(){A(!1),e.$rgDigest()}t&&t.length>1?(A(!0),i.searchContact({schPm:t},!0).then(n,r)):(e.friendlist=i.getFriends("friends").copy(),e.$rgDigest())}e.$watch("friendName",C);function S(){function t(){e.friendlist=i.getFriends("friends"),A(!1)}function n(){A(!1)}function r(){e.state.loading=!1}e.state.loading||e.friendlist.length()===i.totalFriends("friends")||(A(!0),i.getContactDetails().then(t,n),setTimeout(r,3e3),e.$rgDigest())}}angular.module("ringid.circle").controller("circleEditPopupController",circleEditPopupController),circleEditPopupController.$inject=["$scope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","remoteData","Ringalert"];function circleEditPopupController(e,t,n,r,i,o,a,s){e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleMemberSection=!1,e.friendDropdown=!1;function c(t){t?e.friendDropdown=!0:e.friendDropdown=!1}e.$watch("friendsNameFilter",c),e.closeFriendDd=l;function l(){e.friendDropdown=!1,e.$rgDigest()}e.friendsNameFilter="",e.memberfilter="",e.$on("$destroy",function(){e.friendlist.reset(),e.selectedMembers=[]}),e.friendlist=r.getFriends("friends").copy(),e.friendTags=i.createNew();function u(t){return r.myFriends(5,t,e.friendTags)}e.fetchFriends=u,e.memberList=i.createNew(),e.addToCircle=g,e.removeMember=E,e.updateCircle=d,e.close=n.close;function d(){var n=[];e.memberList.doForAll(function(e){n.push({admin:!1,utId:e.getKey()})}),t.addMembers(n,o.target).then(function(n){n.sucs===!0?t.getSingleCircleInfo(o.target,o.circleObj):(s.show(n.mg,"error"),e.$rgDigest()),e.close()})}function g(t){e.memberList.add(t.value.getKey(),t.value),e.friendTags.save(t.value.getKey(),t.value),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function E(t,n){n.stopPropagation(),t?e.memberList.remove(t.value.getKey()):e.memberList.removeTop(),e.$rgDigest()}}angular.module("ringid.circle").controller("CirclePageController",CirclePageController),CirclePageController.$inject=["$scope","$routeParams","$location","circlesManager","friendsFactory","Auth","$ringbox","SystemEvents","$$connector","OPERATION_TYPES","circleHttpService","$timeout","APP_CONSTANTS","Ringalert","rgDropdownService","$rootScope","Utils"];function CirclePageController(e,t,n,r,i,o,a,s,c,l,u,d,g,E,m,T,f){var p,_,I=this;p=t.circleId,_=t.subpage,e.loadMoreCircleMember=!1,e.showSearchLoader=!1,e.hideLoadButton=!1,e.currentUserUId=o.currentUser().getKey(),r.getCirclePromise(p).then(function(t){t?(I.circle=t,f.setPageTitle(t.getName(),!0),e.isCurrentUserAdmin=I.circle.isAdmin(),e.isCurrentUserSuperAdmin=I.circle.isSuperAdmin(e.currentUserUId),"members"===_&&(e.showBackKey=0,e.showBack=function(t,n){var r=n.target.getAttribute("data-is-anchor");r||(e.showBackKey=t,n.preventDefault(),n.stopPropagation(),e.$rgDigest())},S()),h()):r.redirectHome()},function(){r.redirectHome()}),e.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),E.show("Coming soon","info")},I.ddHtml="templates/dropdowns/circle-edit-dropdown.html",I.ddAction=D,I.ddControl={isAdmin:e.isCurrentUserAdmin,isSuperAdmin:e.isCurrentUserSuperAdmin,getCircleData:function(){return m.close(),{circleId:p}}},I.ddMemberHtml="templates/dropdowns/circle-member-dropdown.html",I.ddMemberAction=M,I.removeMember=v,angular.isUndefined(t.subpage)?I.subPage="post":I.subPage=t.subpage,I.subPageLink="templates/home/circle."+I.subPage+".html",I.isCurrentUserAdmin=!1,I.isCurrentUserSuperAdmin=!1,I.getFriendType=function(e){return e.friendshipStatus()},I.circle?(e.isPageReady=!1,e.circleMembers.length||S()):e.isPageReady=!1,I.shouldShowMemberEditMenu=function(e){return!e.isCurrentUser()&&(I.isCurrentUserSuperAdmin||I.isCurrentUserAdmin&&!e.isAdmin(p))&&!I.circle.isSuperAdmin(e.getKey())},I.memberListSubscriptionKey=c.subscribe(r.processCircleMembersData,{action:l.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_LIST}),I.searchListSubscriptionKey=c.subscribe(r.processCircleSearchMembersData,{action:l.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_SEARCH_RESULT}),e.$on(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,function(t,n){e.loadMoreCircleMember=!1,e.showSearchLoader=!1,n.success?e.hideLoadButton=!1:e.hideLoadButton=!0,h(),e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT,function(){e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,function(){C(),e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_REMOVED,function(e,r){r.circleId===t.circleId&&(E.show("Circle has been Removed OR You have been removed from the circle.","error"),d(function(){n.path("/")}))}),e.cMemberSearch=function(){I.searchParam?(e.showSearchLoader=!0,r.getMemberResult(I.searchParam,p)):e.hideLoadButton=!1,e.$rgDigest()},e.loadMoreMembers=function(){var t;I.searchParam?(e.showSearchLoader=!0,r.getMemberResult(I.searchParam,p)):(t=20,e.loadMoreCircleMember=!0,r.getCircleMembers(p,null,t)),e.$rgDigest()},e.getCircleId=function(){return{data:function(){return{target:p,circleObj:I.circle,members:e.circleMembers}}}},e.$on("$destroy",function(){I.circle&&I.circle.resetMembers(),c.unsubscribe(I.memberListSubscriptionKey),c.unsubscribe(I.searchListSubscriptionKey)});function h(){I.circle&&(e.isPageReady=!0,C(),A()),e.$rgDigest()}function A(){I.isCurrentUserAdmin=e.currentUser.isAdmin(I.circle.getKey()),I.isCurrentUserSuperAdmin=I.circle.isSuperAdmin(o.currentUser().getKey()),I.ddControl.isAdmin=I.isCurrentUserAdmin,I.ddControl.isSuperAdmin=I.isCurrentUserSuperAdmin}function C(){e.circleMembers=I.circle.getAllMembers(),e.$rgDigest()}function S(){r.getCircleMembers(p,0)}function v(e){r.removeMember(e,I.circle)}function M(t){switch(m.close(t.event),t.action){case"remove":r.removeMember(t.member.getKey(),I.circle);break;case"changemember":r.toggleMembership({grpId:I.circle.getKey(),utId:t.member.getKey(),admin:Boolean(t.admin)},I.circle);break;case"addfriend":case"accept":case"reject":t.friend.isLoading()||i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()})}e.$rgDigest()}function D(e){var t,n;n="Are you sure you want to "+e.action+" "+I.circle.getName()+"?",m.close(e.event),t=a.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"}),t.result.then(function(t){t&&O(e)})}function O(t){switch(t.action){case"delete":r.deleteCircle(I.circle).then(function(t){t.sucs===!0?(n.path("/circle/list"),T.$rgDigest()):e.$rgDigest()},function(){e.$rgDigest()});break;case"leave":r.leaveGroup(I.circle).then(function(t){t.sucs===!0&&(n.path("/"),T.$rgDigest()),e.$rgDigest()},function(){e.$rgDigest()})}}}angular.module("ringid.circle").controller("AllCirclePopupController",AllCirclePopupController),AllCirclePopupController.$inject=["$scope","OPERATION_TYPES","$$connector","circlesManager","rgScrollbarService"];function AllCirclePopupController(e,t,n,r,i){var o,a;r.init(),e.getCircles=s;function s(e){return r.getCircles("true"===e||e===!0)}a=n.subscribe(function(){o||(o=setTimeout(function(){o=!1,i.recalculate(e),e.$rgDigest()}))},{action:[t.SYSTEM.CIRCLE.TYPE_GROUP_LIST]}),e.$on("$destroy",function(){n.unsubscribe(a)})}angular.module("ringid.circle").controller("CircleSaveController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="circle_saved",o=r.SYSTEM.TYPE_SAVED_FEED+".circle_saved";e.pagekey=o,e.params={actn:r.SYSTEM.TYPE_SAVED_FEED,pType:6,st:0,scl:2,lmt:10},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=i,e.shareMenuDisabled=!0,e.sortBy="stm",e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.circle").directive("rgCircleTabNav",rgCircleTabNav),rgCircleTabNav.$inject=["routeService"];function rgCircleTabNav(e){t.$inject=["$scope","$location"];function t(t,n){t.routes={circle:e.getRoute("CIRCLE_FEED"),myCircle:e.getRoute("CIRCLE_LIST"),saved:e.getRoute("CIRCLE_SAVED")},t.isCurrentPath=function(e,t){return t?n.path().indexOf(e)>-1:n.path()===e}}return{restrict:"E",controller:t,templateUrl:"templates/circle/circle.tabnav.directive.html"}}!function(e,t){"use strict";e.module("ringid",["ngRoute","ringid.config","ui-notification","ringid.language","ringid.connector","ringid.global_services","ringid.global_directives","ringid.auth","ringid.filters","ringid.shared","ringid.utils","ringid.directives","ringid.ui_editor","ringid.ui_scrollbar","ringid.ui_ringbox","ringid.ui_player","ringid.header","ringid.friend","ringid.directives","ringid.controllers","ringid.feed","ringid.sticker","ringid.profile","ringid.circle","ringid.chat","ringid.newsportal"])}(angular,window);var app;app=angular.module("ringid").controller("ApplicationController",ApplicationController),ApplicationController.$inject=["SystemEvents","$scope","$rootScope","$$connector","Storage","Auth","OPERATION_TYPES","ChatConnector","routeService"];function ApplicationController(e,t,n,r,i,o,a,s,c){var l=a.SYSTEM.AUTH,u=!0;t.routes={home:c.getRoute("HOME")},t.openSignIn=E,t.activePath=null,t.currentUser=o.currentUser(),t.templatePath="templates/index-login.html",t.isLoggedIn=!1,t.isPending=g,t.showFriendsBar=!1,t.toggleFriendsBar=d,t.isOffline=!1;function d(){t.showFriendsBar=!t.showFriendsBar,t.$rgDigest()}function g(){return u}function E(){return{data:function(){return{fromPopup:!0}}}}function m(){t.isLoggedIn=o.isLoggedIn(),r.init(),t.isLoggedIn?(t.currentUser=o.currentUser(),t.templatePath="templates/index-dashboard.html",r.resume(),r.keepAlive(),s.sendGlobal("uId",o.currentUser().getUId())):t.templatePath="templates/index-login.html",setTimeout(function(){u=!1,t.$rgDigest()})}t.$on(e.AUTH.LOGIN,function(){m()}),t.$on("CONNECTION_ERROR",function(){var e=i.getCookie("reloaded");e?r.reset():i.setCookie("reloaded",1)}),t.$on("$locationChangeStart",function(e,t){t&&r.notifyRouteChange()});function T(){r.subscribe(o.handleInvalidSession,{action:[l.TYPE_SESSION_VALIDATION,l.TYPE_INVALID_LOGIN_SESSION,l.TYPE_MULTIPLE_SESSION]}),o.ensureLoginState(),t.$rgDigest()}T(),t.send=function(e,t){var n,i=t||a.SYSTEM.REQUEST_TYPE.REQUEST;angular.isString(n)&&(n=angular.fromJson(e)),r.send(n,i)}}var app;app=angular.module("ringid").run(["$rootScope","$window","$document","$$connector","$ringhttp","settings",function(e,t,n,r,i,o){var a,s,c=angular.element(t);r.init();function l(t){"inactive"!==s&&e.$broadcast("ringInactive",t),s="inactive"}function u(t){"active"!==s&&e.$broadcast("ringActive",t),s="active"}c.on("inactive",l),c.on("active",u);function d(t){this[a?a+"Hidden":"hidden"]&&"inactive"!==s?(e.$broadcast("ringInactive",t),s="inactive"):"active"!==s&&(e.$broadcast("ringActive",t),s="active")}"hidden"in n?a="":angular.forEach(["moz","webkit","ms"],function(e){e+"Hidden"in n[0]&&(a=e)}),angular.isDefined(a)&&""!==a&&n[0].addEventListener(a+"visibilitychange",d),i.get(o.constantServer).success(function(e){var t=angular.fromJson(e);t.sucs===!0&&o.updateUrlBase(t),t=null})}]);var app=angular.module("ringid");app.config(appConfig),appConfig.$inject=["$compileProvider","$routeProvider","$locationProvider","$httpProvider","RING_ROUTES","settings","$provide"];function appConfig(e,t,n,r,i,o,a){r.useApplyAsync(!0),e.debugInfoEnabled(o.debugEnabled),r.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";function s(e){var t,n,r,i,o,a,c,l="";for(t in e)if(e.hasOwnProperty(t))if(n=e[t],n instanceof Array)for(c=0;c<n.length;++c)o=n[c],r=t+"["+c+"]",a={},a[r]=o,l+=s(a)+"&";else if(n instanceof Object)for(i in n)n.hasOwnProperty(i)&&(o=n[i],r=t+"["+i+"]",a={},a[r]=o,l+=s(a)+"&");else void 0!==n&&null!==n&&(l+=encodeURIComponent(t)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l}r.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?s(e):e}],t.when(i.HOME,{templateUrl:"templates/index.html"}).when(i.LOGIN_SOCIAL,{templateUrl:"templates/index.html"}).when(i.SIGNUP_SOCIAL,{templateUrl:"templates/index.html"}).when(i.PROFILE,{templateUrl:"templates/profile/profile.html",resolve:{user:["Api","userFactory","$route","$location","$q","Ringalert",function(e,t,n,r,i,o){var a,s=i.defer();return a=t.getUser(n.current.params.uId),a&&a.hasDetails()?s.resolve(a):e.user.getUserDetails({uId:n.current.params.uId}).then(function(e){s.resolve(t.create(e.userDetails))},function(){o.show("User not found","error"),r.path().indexOf("profile")>-1&&r.path("/"),s.reject()}),s.promise}]}}).when(i.SINGLE_FEED,{templateUrl:"templates/index-singlefeed.html"}).when(i.MEDIA_FEED,{templateUrl:"templates/media/media.feed.html"}).when(i.MEDIA_DISCOVER,{templateUrl:"templates/mediasearch/media.discover.html",controller:"mediaDiscoverController"}).when(i.MEDIA_PAGE_PROFILE,{templateUrl:"templates/mediasearch/media.profile.html",controller:"MediaProfileController"}).when(i.MEDIA_FOLLOWING,{templateUrl:"templates/mediasearch/media.following.html",controller:"MediaFollowingController"}).when(i.WHO_SHARED_FEED,{templateUrl:"templates/index-who-sharedfeed.html"}).when(i.MEDIA_CLOUD_MYALBUM,{templateUrl:"templates/mediasearch/my.albums.html"}).when(i.MEDIA_PLAYLIST,{templateUrl:"templates/media-list.html"}).when(i.MEDIA_SAVED,{templateUrl:"templates/mediasearch/media-saved.html"}).when(i.MEDIA_POST,{templateUrl:"templates/mediasearch/media.upload.html",controller:"MediaPostController"}).when(i.MEDIA_CLOUD_SEARCH,{templateUrl:"templates/mediasearch/search.result.html",controller:"mSearchResultController"}).when(i.MEDIA_CLOUD_USERMEDIA,{templateUrl:"templates/media/album-contents.html",controller:"AlbumContentsController"}).when(i.CHAT_ROOMS,{controller:"PublicChatController",templateUrl:"templates/chat_room/chat_room.html"}).when(i.CHAT,{templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}).when(i.CHAT_GROUPS,{templateUrl:"templates/partials/tag-chat/list-page/tag-list.html",controller:"TagChatController",controllerAs:"tcc"}).when(i.CHAT_GROUP,{templateUrl:"templates/partials/tag-chat/list-page/home.html",controller:"TagChatMemberPageController",controllerAs:"tcc"}).when(i.SAVED_FEEDS,{templateUrl:"templates/saved/saved-feeds.html"}).when(i.SAVED_MEDIA_FEEDS,{templateUrl:"templates/saved/saved-media-feeds.html"}).when(i.SAVED_CIRCLE_FEEDS,{templateUrl:"templates/saved/saved-circle-feeds.html"}).when(i.SAVED_NEWSPORTAL_FEEDS,{templateUrl:"templates/saved/saved-newsportal-feeds.html"}).when(i.SAVED_PAGES_FEEDS,{templateUrl:"templates/saved/saved-business-feeds.html"}).when(i.SAVED_CELEBRITY_FEEDS,{templateUrl:"templates/saved/saved-celebrity-feeds.html"}).when(i.NEWSPORTAL_FEED,{templateUrl:"templates/newsportal/portal-index.html"}).when(i.NEWSPORTAL_FOLLOWING,{templateUrl:"templates/newsportal/following.html",controller:"portalFollowingController"}).when(i.NEWSPORTAL_DISCOVER,{templateUrl:"templates/newsportal/discover.html",controller:"portalDiscoverController"}).when(i.NEWSPORTAL_SAVED,{templateUrl:"templates/newsportal/saved.html"}).when(i.NEWSPORTAL,{templateUrl:"templates/newsportal/profilenews.html"}).when(i.STICKER_HOME,{templateUrl:"templates/sticker/home.html",controller:"StickerPageController"}).when("/sticker/category/:type?/:id?",{templateUrl:"templates/sticker/home.html",controller:"StickerPageController"}).when("/sticker/details/:type?/:id?",{templateUrl:"templates/sticker/category.html",controller:"StickerPageController"}).when("/sticker/detail/:type/:id",{templateUrl:"templates/sticker/detail.html",controller:"StickerPageController"}).when(i.NOTIFICATIONS,{templateUrl:"templates/partials/all-notification.html",controller:"NotiController"}).when(i.FRIEND_REQUESTS,{templateUrl:"templates/partials/all-friend-request.html"}).when("/medianew",{templateUrl:"templates/mediapage.html"}).when(i.CIRCLE_FEED,{templateUrl:"templates/circle/circle-index.html"}).when(i.CIRCLE_LIST,{templateUrl:"templates/circle/all-circle.html",controller:"AllCirclePopupController"}).when(i.CIRCLE_SAVED,{templateUrl:"templates/circle/circle-saved.html"}).when(i.CIRCLE,{templateUrl:"templates/home/circle.html"}).otherwise({redirectTo:"/"}),n.html5Mode(o.html5Mode)}app.run(appRun),appRun.$inject=["$rootScope","$location","Auth","rgDropdownService","rgSearchService","$ringbox","PAGE_TITLES","Utils","$sniffer"];function appRun(e,t,n,r,i,o,a,s,c){var l,u=0,d=[],g={},E=Object.getPrototypeOf(e),m=[],T="unknown",f=c.vendorPrefix.toLowerCase();e.$on("$routeChangeSuccess",function(e,t){t.$$route&&a[t.$$route.originalPath]?s.setPageTitle(a[t.$$route.originalPath],u>0):s.setPageTitle(a.DEFAULT),u++}),e.$on("$routeChangeStart",function(){n.isPending()||n.isLoggedIn()||e.doingSilentLogin||"/"===t.url()?(o.closeAll(),r.close(),i.close(),p(!0)):(t.path("/"),p(!0))}),requestAnimationFrame(function(){}),e.$ignoreScopes=[],E.$coreDigest=E.$digest;function p(t){for(l=0;l<e.$ignoreScopes.length;l++)m[e.$ignoreScopes[l].$id]&&(e.$ignoreScopes[l].$$childHead=m[e.$ignoreScopes[l].$id]);m=[],t&&(e.$ignoreScopes=[])}E.$rgDigest=function(t){var n,r,i,o,a=[],c=t||!1,l=this;if(e.$$phase){if(d.indexOf(this)===-1&&1!==this.$id){for(d.push(this),d.sort(function(e,t){return e.$id-t.$id});d.length>1;){for(r=d.pop(),n=d.length-1;n>=0;n--){for(i=d[n],o=r.$parent;o!==i&&null!==o;)o=o.$parent;if(null!==o)break}null==o&&a.push(r)}for(;r=a.pop();)d.push(r)}e.$$postDigest(function(){d.length>0&&d.pop().$rgDigest()})}else{if(1===parseInt(this.$id,10)&&e.$ignoreScopes.length>0){for(n=0;n<e.$ignoreScopes.length;n++)m[e.$ignoreScopes[n].$id]=e.$ignoreScopes[n].$$childHead,e.$ignoreScopes[n].$$childHead=null;e.$$postDigest(function(){p()})}c&&!g[this.$id]&&(g[this.$id]=s.debounce(function(){l&&(l.$coreDigest(),delete g[l.$id],l=null)},200)),c?g[this.$id].call():this.$coreDigest()}},E.$digest=function(){this.$rgDigest()},E.addIgnore=function(){e.$ignoreScopes.indexOf(this)===-1&&e.$ignoreScopes.push(this)},E.removeIgnore=function(){var t;(t=e.$ignoreScopes.indexOf(this))>-1&&e.$ignoreScopes.splice(t,1)},navigator.appVersion.indexOf("Win")!==-1&&(T="win"),navigator.appVersion.indexOf("Mac")!==-1&&(T="mac"),navigator.appVersion.indexOf("X11")!==-1&&(T="unix"),navigator.appVersion.indexOf("Linux")!==-1&&(T="linux"),angular.element(document.body).addClass(T+" "+f)}