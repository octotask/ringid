/*! Ringid.com 2016-05-19 */
var RingWorker;!function(a){"use strict";function b(){var a,b=Cookies.get("top");return b?(a=parseInt(b)+1,a>255&&(a=1)):a=1,Cookies.set("top",a),a}a._cti=b();try{a.location.origin||(a.location.origin=a.location.protocol+"//"+a.location.hostname+(a.location.port?":"+a.location.port:"")),RingWorker=new Worker(a.location.origin+"/js/worker/com")}catch(c){RingWorker={addCallback:angular.noop,addEventListener:angular.noop,postMessage:angular.noop}}RingWorker.FNS={},RingWorker.addCallback=function(a,b,c){this.FNS[a]||(this.FNS[a]=[]),c=c||null,this.FNS[a].push({ctx:c,fn:b})},RingWorker.send=function(a,b,c,d){if(!c||!a)throw new Error("You must sent data and port");this.postMessage({command:"SEND",packetId:b,data:a,flooding:d,port:c,action:a.actn})},RingWorker.addEventListener("message",function(a){var b,c;if(a.data.notifier&&this.FNS[a.data.notifier])for(c=0;c<this.FNS[a.data.notifier].length;c++)b=this.FNS[a.data.notifier][c],b.fn.call(b.ctx,a.data)}),RingWorker.addCallback("debug",function(a){},RingWorker),RingWorker.addEventListener("error",function(a){}),RingWorker.pushMessage=function(a){this.postMessage(a)},RingWorker.pushMessage({command:"SETTINGS",url:"wss://"+a.location.host+"/DataSocket/"+a._cti,tabId:a._cti,aSkey:Cookies.get("sId"),sKey:Cookies.get("sessionID"),CLIENT_DATA_SIZE:460})}(window),function(a,b){"use strict";a.emojiSupported=function(){var a=document.createElement("canvas");if(!a.getContext||!a.getContext("2d")||"function"!=typeof a.getContext("2d").fillText)return!1;var b=a.getContext("2d");return b.textBaseline="top",b.font="32px Arial",b.fillText("\ud83d\ude03",0,0),0!==b.getImageData(16,16,1,1).data[0]}(),a.eventFix=function(b){b=b||a.event;var c=b.pageX,d=b.pageY;void 0===c&&(c=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=b.clientY+document.body.scrollTop+document.documentElerment.scrollTop)},a.scrollToYOffset=function(b,c){var d=b/(c/15),e=setInterval(function(){a.scrollY<b?a.scrollBy(0,d):clearInterval(e)},15)},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(d.prototype=this.prototype),e.prototype=new d,e}),String.prototype.format||(String.prototype.format=function(){var a="[object Array]"===Object.prototype.toString.call(arguments[0])?arguments[0]:arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}),String.prototype.supplant||(String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return"string"==typeof d||"number"==typeof d?d:b})}),String.prototype.repeat||(String.prototype.repeat=function(a){return Array(a+1).join(this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))},String.prototype.toCharCodeArray=function(){for(var a=[],b=0;b<this.length;b++)a.push(this.charCodeAt(b));return a},Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),Array.prototype.contains||(Array.prototype.contains=function(a,b){if(!b)return this.indexOf(a);var c=this.length>>>0,d=Number(arguments[1])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if(d in this&&b.call(this,this[d],a))return d;return-1}),Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments.length>=2?arguments[1]:void 0,f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.keyValues||(Array.prototype.keyValues=function(a){var b,c=[];for(b=0;b<this.length;b++)this[b][a]&&c.push(this[b][a]);return c}),Array.prototype.values||(Array.prototype.values=function(){var a,b=[];for(a=0;a<this.length;a++)b.push(this[a]);return b}),Array.prototype.joinAsDataView=function(){var a,c,d=this,e=0,f=0;if(!d.length)return new b(new ArrayBuffer(0));for(var g=0;g<d.length;g++)d[g]instanceof b&&(f+=d[g].byteLength);if(!f)return new b(new ArrayBuffer(0));a=new ArrayBuffer(f),c=new b(a);for(var g=0;g<d.length;g++)if(d[g]instanceof b)for(var h=0;h<d[g].byteLength;h++)c.setUint8(e++,d[g].getUint8(h));return c},Array.prototype.difference=function(a){if(!a||!a.length||!this.length)return this;for(var b={},c=[],d=0;d<a.length;)b[a[d]]=!0,d++;for(d=0;d<this.length;d++)b[this[d]]||c.push(this[d]);return c},b.prototype.copy=function(a,c){return new b(this.buffer,a,c)},b.prototype.merge=function(a,c,d,e,f){var g,h,i=new b(this.buffer,a,c),j=new ArrayBuffer(i.byteLength+(f-e+1)),k=new b(j);for(g=0;g<i.byteLength;g++)k.setUint8(g,i.getUint8(g));for(h=g;h<k.byteLength;h++)k.setUint8(h,d.getUint8(e++));return k},b.prototype.addAttributeInt=function(a,b,c,d){switch(this.setUint8(a++,b),this.setUint8(a++,c),c){case 1:this.setUint8(a++,d);break;case 2:this.setUint16(a,d),a+=2;break;case 4:this.setUint32(a,d),a+=4}return a},b.prototype.addAttributeString=function(a,b,c){this.setUint8(a++,b),this.setUint8(a++,c.length);for(var d=0;d<c.length;d++)this.setUint8(a++,c.charCodeAt(d));return a},b.prototype.addAttributeData=function(a,b,c,d,e){d=d||0,e=e||c.byteLength,this.setUint8(a++,b),this.setUint16(a,e),a+=2;for(var f=0;e>f;f++)this.setUint8(a++,c.getUint8(d++));return a},b.prototype.print_r=function(a,b,c){b=b||0,c=c||this.byteLength;for(var d,e,f="Index		Binary		Integer		Char\n",g="",h=b;c>h;h++)e=this.getUint8(h),d=String.fromCharCode(e),f+=h+"		 		"+e.toString(2)+"				"+e+"				"+d+"\n",g+=d;return a&&"string"!=typeof a?void 0:g},b.prototype.printBytes=function(){for(var a=[],b=0;b<this.byteLength;b++)a.push(this.getUint8(b));a.push(-1e3)},b.prototype.getString=function(a,b){var c,d,e,f,g=this,h=[];for(b=b||g.byteLength;b>0;)c=g.getUint8(a),g.getUint8(a)<=127?(h.push(g.getUint8(a++)),b--):g.getUint8(a)>=128&&g.getUint8(a)<=223?(h.push((31&g.getUint8(a++))<<6|63&g.getUint8(a++)),b-=2):g.getUint8(a)>=224&&g.getUint8(a)<=239?(h.push((31&g.getUint8(a++))<<12|((63&g.getUint8(a++))<<6|63&g.getUint8(a++))),b-=3):(f=(7&g.getUint8(a++))<<18|((63&g.getUint8(a++))<<12|((63&g.getUint8(a++))<<6|63&g.getUint8(a++))),f-=65536,d=(f>>10)+55296,e=f%1024+56320,h.push(d,e),b-=4);return String.fromCharCode.apply(null,h)},b.prototype.getStringUtf16=function(a,b,c){b=0|b,a=a||this.byteLength-b;var d=!1,e="",f=!1;if("undefined"!=typeof Buffer&&(e=[],f=!0),0>a&&(a+=this.byteLength),c){var g=this.getUint16(b);65534===g&&(d=!0),b+=2,a-=2}for(var h=b;b+a>h;h+=2){var i=this.getUint16(h,d);i>=0&&55295>=i||i>=57344&&65535>=i?f?e.push(i):e+=String.fromCharCode(i):i>=65536&&1114111>=i&&(i-=65536,f?(e.push(((1047552&i)>>10)+55296),e.push((1023&i)+56320)):e+=String.fromCharCode(((1047552&i)>>10)+55296)+String.fromCharCode((1023&i)+56320))}return f?e.toString():decodeURIComponent(escape(e))},b.prototype.getIntByByte=function(a,b){var c=this;switch(b){case 1:return c.getUint8(a);case 2:return c.getUint16(a);case 4:return c.getUint32(a);case 6:case 8:var d,e,f="";for(d=a;a+b>d;d++)e=c.getUint8(d).toString(2),f+=e.length<8?"0".repeat(8-e.length)+e:e;return parseInt(f,2);default:return c.getUint8(a)}},b.prototype.getSynch=function(a){for(var b=0,c=2130706432;c;)b>>=1,b|=a&c,c>>=8;return b},Number.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){if(void 0===a&&(a=0),void 0===b&&(b=this.byteLength),a=Math.floor(a),b=Math.floor(b),0>a&&(a+=this.byteLength),0>b&&(b+=this.byteLength),a=Math.min(Math.max(0,a),this.byteLength),b=Math.min(Math.max(0,b),this.byteLength),0>=b-a)return new ArrayBuffer(0);var c=new ArrayBuffer(b-a),d=new Uint8Array(c),e=new Uint8Array(this,a,b-a);return d.set(e),c}),b.prototype.setUint64=function(a,b){var c=this,d=Number.isInteger(b)?b.toString(2):parseInt(b).toString(2);d=d.length<64?"0".repeat(64-d.length)+d:d;for(var e=d.match(/.{1,32}/g),f=e.map(function(a){return parseInt(a,2)}),g=0;g<f.length;g++)c.setUint32(a+4*g,f[g])},b.prototype.getBool=function(a){return 1===this.getUint8(a)},a.Element&&function(a){a.matches=a.matches||a.matchesSelector||a.webkitMatchesSelector||a.msMatchesSelector||function(a){for(var b=this,c=(b.parentNode||b.document).querySelectorAll(a),d=-1;c[++d]&&c[d]!=b;);return!!c[d]}}(a.Element.prototype),a.Element&&function(a){a.closest=a.closest||function(a){for(var b=this;b.matches&&!b.matches(a);)b=b.parentNode;return b.matches?b:null}}(a.Element.prototype),a.requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame,b.prototype.getUint24=function(a,b){return b?this.getUint8(a)+(this.getUint8(a+1)<<8)+(this.getUint8(a+2)<<16):this.getUint8(a+2)+(this.getUint8(a+1)<<8)+(this.getUint8(a)<<16)},Math.easeIn=function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},a.decodeEntities=function(){function a(a){return a&&"string"==typeof a&&(a=a.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),a=a.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),b.innerHTML=a,a=b.textContent,b.textContent=""),a}var b=document.createElement("div");return a}()}(window,DataView),function(){"use strict";angular.module("ringid.config",[])}(),function(){"use strict";var a=angular.module("ringid.config"),b={MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,TEXT:2,EMOTICON_MESSAGE:3,LOCATION_SHARE:4,LINK_SHARE:5,STICKER:6,IMAGE:7,AUDIO:8,VIDEO:9,CAMERA_IMAGE:10,TYPING:101},USER_PRESENCE:{OFFLINE:1,ONLINE:2,AWAY:3},HISTORY_MAX_MESSAGE:20,TAB_SYNC_MAX_TIME:18e4,TAB_SYNC_ACTIONS:{AUTH_REQUEST:0,CHAT_REQUEST:1,GENERAL_INFO_UPDATE:3,CHAT_BOX_INFO_UPDATE:4,SECRET_CHAT_TIMER:5,CHAT_HISTORY_REFRESH:6,CHAT_MSESSAGE_UPDATE:7},SHARED_WORKER_PATH:"js/worker/chat/shared.js"},c={serverTimeDiff:0,offlineUpdateTime:0},d={version:"1.5"},e={MESSAGE_SENDING:{ONLINE_IP_PORT_REQUEST:0,FIRST_ONLINE:1,PRESENCE_REFRESH:2,SECOND_ONLINE:3,ONLINE_IP_PORT_REFRESH:4,THIRD_ONLINE:5,ONLINE_SUCCESS:6,ONLINE_FAILED:7,FIRST_OFFLINE:101,OFFLINE_IP_PORT_REFRESH:102,SECOND_OFFLINE:102,OFFLINE_FAILED:104,OFFLINE_SUCCESS:105,SUCCESS:201,FAILED:202}},f={SEND_MESSAGE:[e.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,e.MESSAGE_SENDING.FIRST_ONLINE,e.MESSAGE_SENDING.PRESENCE_REFRESH,e.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,e.MESSAGE_SENDING.ONLINE_FAILED,e.MESSAGE_SENDING.FIRST_OFFLINE,e.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]},g={};g[e.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST]={NEXT:[e.MESSAGE_SENDING.FIRST_OFFLINE]},g[e.MESSAGE_SENDING.FIRST_OFFLINE]={NEXT:[e.MESSAGE_SENDING.ONLINE_SUCCESS,e.MESSAGE_SENDING.PRESENCE_REFRESH]},g[e.MESSAGE_SENDING.PRESENCE_REFRESH]={NEXT:[e.MESSAGE_SENDING.ONLINE_SUCCESS,e.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH]},g[e.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH]={NEXT:[e.MESSAGE_SENDING.ONLINE_SUCCESS,e.MESSAGE_SENDING.ONLINE_FAILED]},g[e.MESSAGE_SENDING.ONLINE_FAILED]={NEXT:[e.MESSAGE_SENDING.FIRST_OFFLINE]},g[e.MESSAGE_SENDING.OFFLINE_SUCCESS]={NEXT:[e.MESSAGE_SENDING.SUCCESS]},g[e.MESSAGE_SENDING.FIRST_OFFLINE]={NEXT:[e.MESSAGE_SENDING.OFFLINE_SUCCESS,e.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]},g[e.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]={NEXT:[e.MESSAGE_SENDING.OFFLINE_SUCCESS,e.MESSAGE_SENDING.OFFLINE_FAILED]},g[e.MESSAGE_SENDING.OFFLINE_FAILED]={NEXT:[e.MESSAGE_SENDING.FAILED]},g[e.MESSAGE_SENDING.OFFLINE_SUCCESS]={NEXT:[e.MESSAGE_SENDING.SUCCESS]};for(var h=Object.keys(e.MESSAGE_SENDING),i=0,j=h.length;j>i;i++){var k=e.MESSAGE_SENDING[h[i]];try{g[k].NAME=h[i]}catch(l){g[k]={},g[k].NAME=h[i]}}var m={CHAT_REGISTER:1,CHAT_FRIEND_UNREGISTERED:2,CHAT_REGISTER_CONFIRMATION:3,CHAT_GROUP_UNREGISTER:4,CHAT_FRIEND:5,CHAT_DELIVERED:6,CHAT_SEEN:7,CHAT_SENT:8,CHAT_TYPING:9,CHAT_IDEL:10,CHAT_GROUP_REGISTER:12,CHAT_GROUP_REG_CONFIRMATION:13,CHAT_GROUP:14,CHAT_GROUP_DELIVERED:15,CHAT_GROUP_SEEN:16,CHAT_GROUP_SENT:17,CHAT_GROUP_TYPING:18,CHAT_GROUP_IDEL:19,CHAT_FRIEND_OFFLINE:20,CHAT_GROUP_OFFLINE:21,CHAT_GET_OFFLINE:22,CHAT_OFFLINE_CONFIRMATION:23,FRIEND_CHAT_DELETE:24,FRIEND_CHAT_DELETE_CONFIRMATION:25,FRIEND_INFORMATION:28,FRIEND_INFORMATION_CONFIRMATION:29,GROUP_CHAT_DELETE:26,GROUP_CHAT_DELETE_CONFIRMATION:27,FILE_TOTAL_SEQUENCE:30,FILE_TOTAL_SEQUENCE_CONFIRMATION:31,FILE_STREAM_SEND:32,FILE_STREAM_SEND_CONFIRMATION:33},n={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,IS_SECRET_VISIBLE:26,MESSAGE_STATUS:27,BLOCK_UNBLOCK_UPDATE_DATE:28},o={REGISTER_PKT:{PACKET_NAME:"REGISTER_PKT",PACKET_TYPE:1,FORMAT:[1,2,3,4,5,6]},FRIEND_UNREGISTER_PKT:{PACKET_NAME:"FRIEND_UNREGISTER_PKT",PACKET_TYPE:2,FORMAT:[1,2,3,4,5,9,10]},REGISTER_CONFIRM_PKT:{PACKET_NAME:"REGISTER_CONFIRM_PKT",PACKET_TYPE:3,FORMAT:[1,3,4,5,7,25]},CHAT_MSG:{PACKET_NAME:"CHAT_MSG",PACKET_TYPE:6,FORMAT:[1,2,3,4,5,11,12,15,16,17,26]},CHAT_MSG_OFFLINE:{PACKET_NAME:"CHAT_MSG_OFFLINE",PACKET_TYPE:6,FORMAT:[1,2,3,4,5,11,12,15,16,17,26,6]},DELIVER_PKT:{PACKET_NAME:"DELIVER_PKT",PACKET_TYPE:15,FORMAT:[1,2,3,4,5]},DELIVER_PKT_OFFLINE:{PACKET_NAME:"DELIVER_PKT_OFFLINE",PACKET_TYPE:15,FORMAT:[1,2,3,4,5,6]},SEEN_PKT:{PACKET_NAME:"SEEN_PKT",PACKET_TYPE:17,FORMAT:[1,2,3,4,5,18,4,5,17,27]},SEEN_PKT_CONFIRM:{PACKET_NAME:"SEEN_PKT_CONFIRM",PACKET_TYPE:18,FORMAT:[1,2,3,4,5]},SENT_PKT:{PACKET_NAME:"SENT_PKT",PACKET_TYPE:16,FORMAT:[1,2,3,4,5]},SEEN_PKT_OFFLINE:{PACKET_NAME:"SEEN_PKT_OFFLINE",PACKET_TYPE:17,FORMAT:[1,2,3,4,5,18,4,5,17,27,6]},TYPING_PKT:{PACKET_NAME:"TYPING_PKT",PACKET_TYPE:5,FORMAT:[1,2,3,6]},IDLE_PKT:{PACKET_NAME:"IDLE_PKT",PACKET_TYPE:4,FORMAT:[1,2,3,6]},DELETE_PKT:{PACKET_NAME:"DELETE_PKT",PACKET_TYPE:19,FORMAT:[1,2,3,4,5,18,4,5]},DELETE_PKT_OFFLINE:{PACKET_NAME:"DELETE_PKT_OFFLINE",PACKET_TYPE:19,FORMAT:[1,2,3,4,5,18,4,5,6]},DELETE_CONFIRM_PKT:{PACKET_NAME:"DELETE_CONFIRM_PKT",PACKET_TYPE:20,FORMAT:[1,2,3,4,5]},DELETE_CONFIRM_PKT_OFFLINE:{PACKET_NAME:"DELETE_CONFIRM_PKT_OFFLINE",PACKET_TYPE:20,FORMAT:[1,2,3,4,5,6]},OFFLINE_REGISTER_PKT:{PACKET_NAME:"OFFLINE_REGISTER_PKT",PACKET_TYPE:93,FORMAT:[1,2,4,5,24,28,6]},OFFLINE_CONFIRM_PKT:{PACKET_NAME:"OFFLINE_CONFIRM_PKT",PACKET_TYPE:94,FORMAT:[1,4,5,17]},FRIEND_OFFLINE_PKT:{PACKET_NAME:"FRIEND_OFFLINE_PKT",PACKET_TYPE:95,FORMAT:[1,4,5,18,1,2,4,5,11,12,15,16,17,26]},FRIEND_OFFLINE_CONFIRM_PKT:{PACKET_NAME:"FRIEND_OFFLINE_CONFIRM_PKT",PACKET_TYPE:96,FORMAT:[1,2,4,5,18,4,5,6]}},p={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_OFFLINE_IP_PORT:83};a.constant("CHAT_PACKET_TYPE",m),a.constant("CHAT_PACKET_ATTRIBUTE",n),a.constant("CHAT_PACKET_FORMAT",o),a.constant("CHAT_GENERAL_CONSTANTS",b),a.constant("CHAT_FLOWS",f),a.constant("CHAT_STATE_INFO",g),a.constant("CHAT_STATES",e),a.value("CHAT_GLOBAL_VALUES",c),a.value("CHAT_GENERAL_INFOS",d),a.constant("AUTH_SERVER_ACTIONS",p)}(),function(){"use strict";function a(a){f.signupInit=a.ac+"ringid?",f.signupSocialInit=a.ac+"comports?",f.imBase=a.imsres,f.imServer=a.ims+"ringmarket/",f.mediaServer=a.vodapi+"/stream/",f.mediaBase=a.vodres,f.stickerBase=a.stmres+"stickermarket/d5/",f.stickerApi=a.stmapi+"ringmarket/StickerHandler/"}var b=location.href.split("/")[2],c="https://",d=location.protocol+"//"+location.host,e={ac:"https://auth.ringid.com/rac/",ims:"https://images.ringid.com/",imsres:"https://imagesres.ringid.com/",stmapi:"https://sticker.ringid.com/",stmres:"https://stickerres.ringid.com/",vodapi:"https://vod.ringid.com/",vodres:"https://vodres.ringid.com/",apiVersion:140},f={apiVersion:e.apiVersion,constantServer:"https://auth.ringid.com/cnstnts?pf=2&v="+e.apiVersion+"&apt=1",socketProtocol:"wss://",secure:!0,analytics:!0,debugEnabled:!1,httpsUrl:"https://"+b,siteUrl:b,baseUrl:d,base:location.host,chatImBase:c+"image.ringid.com/chatContens/",chatVideoBase:c+"image.ringid.com/chatContens/",chatAudioBase:c+"image.ringid.com/chatContens/",tagChatImBase:c+"image.ringid.com/groupContents/",chatHeartBeatUrl:d+"/images/ping.jpg",emotionServer:e.imsres+"/emoticon/d5/",emoticonBase:c+b+"/images/emoticon/",stickerBase:e.stmres+"stickermarket/d5/",stickerApi:e.stmapi+"ringmarket/StickerHandler/",imMediaBase:c+"image.ringid.com/ringmarket/ChatImageHandler",twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",ogServiceUrl:c+b+"/OGService",sessionTimeout:216e5,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE"};f.updateUrlBase=a,f.updateUrlBase(e);var g={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},h={HOME:"/",USER_PROFILE:"/profile/:uId/:subpage?/:albumId?",CIRCLE_HOME:"/circle/:circleId/:subpage?",WHO_SHARED_FEED:"/feed_shares/:feedId/:commentId?",SINGLE_FEED:"/feed/:feedId/:commentId?/:shared?",SINGLE_IMAGE:"/image/:imageId/:commentId?",SINGLE_MEDIA:"/media/:mediaId/:commentId?",MEDIA_POST:"/media/upload",MEDIA_FEEDS:"/medias",LOGIN_SOCIAL:"/social/:operation/:platform/:token",SIGNUP_SOCIAL:"/social/:operation/:platform/:token",FAQ:"/faq",API_DASHBOARD:"/apidashboard"};angular.module("ringid.config").constant("settings",f).constant("PLATFORM",g).constant("RING_ROUTES",h).constant("MIN_TIMESTAMP",0xe87c62b0141)}(),function(){"use strict";var a={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166,ADDED_TIME:168};angular.module("ringid.config").constant("ATTRIBUTE_CODES",a)}(),function(){"use strict";angular.module("ringid.config").constant("REASON_CODES",{NONE:0,PERMISSION_DENIED:1,PASSCODE_SENT_INTERVAL:2,DONT_DISTURB_MODE:3,ALREADY_SHARED:4,NOT_TAG_MEMBER:5,TAG_DOES_NOT_EXIST:6,SMS_SENDING_FAILED:7,EMAIL_SENDING_FAILED:8,FRIEND_OFFLINE:9,NOT_FRIEND:10,USERID_FRIENDID_SAME:11,ALREADY_FRIEND_REQUESTED:12,EXCEPTION_OCCURED:13,DATABASE_ROLL_BACKED:14,CANT_SHARE_OWN_FEED:15,FRIEND_DID_NOT_FOUND:16,SMS_SEND_RETRY_LIMIT_OVER:17,NO_MORE_FEED:18,NOT_FOUND:404}).constant("SystemEvents",{COMMON:{WINDOW_RESIZED:"WINDOW_RESIZED",COLUMN_CHANGED:"COLUMN_CHANGED",LOADING:"LOADING"},CIRCLE:{MY_CIRCLE_LIST_FETCH_COMPLETE:"MY_CIRCLE_LOAD_COMPLETE",MY_CIRCLE_LIST_PROCESS_COMPLETE:"MY_CIRCLE_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE:"MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE",MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE:"MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE:"MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE",MY_CIRCLE_MEMBER_REMOVED:"MY_CIRCLE_MEMBER_REMOVED",MY_CIRCLE_REMOVED:"MY_CIRCLE_REMOVED",MY_CIRCLE_UPDATE_MEMBER_COUNT:"MY_CIRCLE_UPDATECOUNT"},FILE_UPLOAD:{PROGRESS_UPDATE:"PROGRESS_UPDATE",QUEUE_START:"QUEUE_START",QUEUE_COMPLETE:"QUEUE_COMPLETE",UPLOADS_POSTED:"UPLOADS_POSTED"},ALBUM:{PHOTOS_SELECTED:"PHOTOS_SELECTED"},IMAGE:{DO_REPOSITION:"DO_REPOSITION",RESIZE:"RESIZE"},FEED:{UPDATED:"UPDATED",CREATED:"CREATED",DELETED:"DELETED",RESET:"RESET",HEIGHT:"HEIGHT",BUSY:"BUSY"},AUTH:{LOGIN:"LOGIN",LOGIN_REQUIRED:"LOGIN_REQUIRED",LOGIN_DONE:"LOGIN_DONE"},CHAT:{CHAT_REGISTER:"CHAT_REGISTER",MESSAGE_RECEIVED:"MESSAGE_RECEIVED",MESSAGE_SUBMITTED:"MESSAGE_SUBMITTED",TAB_SYNC:"TAB_SYNC",TAB_SYNC_NEW_DATA:"TAB_SYNC_NEW_DATA",UNREAD_MESSAGE_INFO_UPDATED:"UNREAD_MESSAGE_INFO_UPDATED"}}).constant("MESSAGES",{REQUEST_PROCESSED:"Your Request Was Successfully Processed",REQUEST_FAILED:"Your Request Was Failed ! Please Try Later.",RC0:"NONE.",RC1:"PERMISSION_DENIED",RC2:"PASSCODE_SENT_INTERVAL",RC3:"DONT_DISTURB_MODE",RC4:"You have already shared this post.",RC5:"NOT_TAG_MEMBER.",RC6:"TAG_DOES_NOT_EXIST.",RC7:"SMS_SENDING_FAILED.",RC8:"EMAIL_SENDING_FAILED.",RC9:"FRIEND_OFFLINE",RC10:"You are not permitted to share this post",RC11:"USERID_FRIENDID_SAME",RC12:"ALREADY_FRIEND_REQUESTED",RC13:"EXCEPTION_OCCURED",RC14:"DATABASE_ROLL_BACKED",RC15:"You Can't Share Your Own Post",RC16:"FRIEND_DID_NOT_FOUND",RC17:"SMS_SEND_RETRY_LIMIT_OVER",RC18:"NO_MORE_FEED",RC19:"UNKNOWN",RC20:"UNKNOWN",RC21:"LOGGED_IN_FROM_ANOTHER_DEVICE",RC22:"UNKNOWN",RC23:"UNKNOWN",RC26:"USER_EXIST",RC27:"DUPLICATE_DATA",RC33:"THIS_IS_SPECIAL_FRIEND",RC37:"ANONYMOUS_CHAT_PERMISSION_DENIED",RC24:"Wrong Password.",RC38:"Could not find DeviceID!",RC39:"This phone number is not verified.",RC40:"This email is not verified.",RC41:"Your facebook ID is not verified.",RC42:"Your twitter ID is not verified.",RC43:"Could not find Your facebook ID.",RC44:"Could not find Your twitter ID.",RC45:"Wrong RingID!",RC46:"Wrong Phone number!",RC47:"Wrong Email!",RC48:"Device Id required!",RC49:"Password required",RC50:"Login Type required",RC51:"Phone country code required!",RC52:"Phone number required!",RC53:"RingID required!",RC54:"Email required!",RC55:"Version required!",RC56:"Device required!",RC57:"Wrong information",RC404:"NOT_FOUND",CRCFS1:"Wall post cann't be shared",CRCFS2:"Group post cann't be shared",CRCFS3:"You already shared this post",FEED:{ACT_1:"{0} liked this post",ACT_2:"{0} commented on this post",ACT_3:"{0} shared this post",TYPE_0:"{0}",TYPE_11:"{0}",TYPE_11C:"{0} posted",TYPE_11F:"{0} posted",TYPE_12:"{0} have||has updated profile picture",TYPE_13:"{0} have||has updated cover picture",TYPE_2:"{0}",TYPE_2L:"{0} shared a link",TYPE_2C:"{0} posted",TYPE_2CL:"{0} shared a link",TYPE_2F:"{0} posted",TYPE_2FL:"{0} shared a link",TYPE_3:"{0} have||has added {1} photos",TYPE_4:"{0} created a album",TYPE_50:"{0} added {1} music",TYPE_51:"{0} shared {1}'s music",TYPE_60:"{0} added {1} video",TYPE_62:"{0} shared {1}'s video",TYPE_D:"{0}",C_POSTFIX:" in {0}",F_POSTFIX:" on {0}'s timeline",TYPE_SHARE:"{0} shared {1}'s feed"}}).constant("APP_CONSTANTS",{NOT_FRIEND:0,FRIEND:1,INCOMING_FRIEND:2,OUTGOING_FRIEND:3,TYPE_SEARCH_BY_ALL:0,TYPE_SEARCH_BY_NAME:1,TYPE_SEARCH_BY_PHONE:2,TYPE_SEARCH_BY_EMAIL:3,TYPE_SEARCH_BY_RINGID:4,TYPE_SEARCH_BY_LOCATION:5,IMAGE_UPLOAD_LIMIT:40,VIDEO_UPLOAD_LIMIT:5,AUDIO_UPLOAD_LIMIT:5,COVER_PIC_UPLOAD_MAXIMUM_WIDTH:1480,COVER_PIC_UPLOAD_MAXIMUM_HEIGHT:2048,COVER_PIC_UPLOAD_MINIMUM_WIDTH:740,COVER_PIC_UPLOAD_MINIMUM_HEIGHT:280,PROFILE_PIC_UPLOAD_MINIMUM_WIDTH:100,PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT:100,COVER_PIC_CROP_WIDTH:1480,COVER_PIC_CROP_HEIGHT:450,PROFILE_PIC_CROP_WIDTH:200,IMAGE_UPLOAD_MIN_WIDTH:10,IMAGE_UPLOAD_MIN_HEIGHT:10,MEDIA_UPLOAD_SIZE_LIMIT:524288e3,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE",NEWS_FEED_MEDIA_TYPE_AUDIO:1,NEWS_FEED_MEDIA_TYPE_VIDEO:2}).constant("PrivacySet",{PVC1:{icon:"post-ico only-i",iconfeed:"post-ico-gray only-i",text:"Only me",value:1},PVC2:{icon:"post-ico fri-i",iconfeed:"post-ico-gray fri-i",text:"Friends",value:2},PVC3:{icon:"post-ico pub-i",iconfeed:"post-ico-gray pub-i",text:"Public",value:3}}).constant("CLIENT_DATA_SIZE",460).constant("AUTH_SERVER_CONFIG",{REQUEST_DELAY:200}).value("DATE_FORMAT","MMM d, y h:mm a")}(),function(){"use strict";angular.module("ringid.config").constant("OPERATION_TYPES",{SYSTEM:{REQUEST_TYPE:{KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:114,TYPE_NEWS_FEED:88,TYPE_MY_NEWS_FEED:94,TYPE_FRIEND_NEWSFEED:110,TYPE_GROUP_NEWS_FEED:198,TYPE_MEDIAS_NEWS_FEED:87,TYPE_COMMENTS_FOR_STATUS:84,ACTION_SHARE_STATUS:191,ACTION_GET_FULL_COMMENT:137,TYPE_ADD_MULTI_IMAGE:117,TYPE_ADD_STATUS:177,NEWS_FEED_TYPE_IMAGE:1,NEWS_FEED_TYPE_STATUS:2,NEWS_FEED_TYPE_MULTIPLE_IMAGE:3,NEWS_FEED_TYPE_ALBUM:4,NEWS_FEED_TYPE_AUDIO:5,NEWS_FEED_TYPE_VIDEO:6,TYPE_SINGLE_IMAGE_STATUS:1,TYPE_TEXT_STATUS:2,TYPE_MULTI_IMAGE_STATUS:3,TYPE_DELETE_STATUS:179,TYPE_EDIT_STATUS:178,TYPE_LIKE_STATUS:184,TYPE_UNLIKE_STATUS:186,TYPE_ADD_STATUS_COMMENT:181,TYPE_LIKE_COMMENT:123,TYPE_UNLIKE_COMMENT:125,TYPE_DELETE_STATUS_COMMENT:183,TYPE_EDIT_STATUS_COMMENT:189,TYPE_LIKES_FOR_STATUS:92,TYPE_LIST_LIKES_OF_COMMENT:116,TYPE_TAG_USER_LIST:274,TYPE_WHO_SHARES_LIST:249,TYPE_UPDATE_ADD_STATUS:377,TYPE_UPDATE_EDIT_STATUS:378,ACTION_UPDATE_SHARE_STATUS:391,TYPE_UPDATE_LIKE_STATUS:384,TYPE_UPDATE_UNLIKE_STATUS:386,TYPE_UPDATE_DELETE_STATUS:379,TYPE_UPDATE_ADD_STATUS_COMMENT:381,TYPE_UPDATE_LIKE_COMMENT:323,TYPE_UPDATE_UNLIKE_COMMENT:325,TYPE_UPDATE_DELETE_STATUS_COMMENT:383,TYPE_UPDATE_EDIT_STATUS_COMMENT:389,ALBUM:{TYPE_UPLOAD_ALBUM_IMAGE:85,TYPE_UPDATE_UPLOAD_ALBUM_IMAGE:90,TYPE_DELETE_ALBUM_IMAGE:176,TYPE_UPDATE_DELETE_ALBUM_IMAGE:376},AUTH:{TYPE_INVALID_LOGIN_SESSION:19,TYPE_SIGN_IN:20,TYPE_SIGN_OUT:22,TYPE_SIGN_UP:21,PHN_MAIL_VERIFICATION_CHECK:28,TYPE_SESSION_VALIDATION:76,TYPE_MULTIPLE_SESSION:75,SIGNUP_SEND_CODE_EMAIL:220,SIGNUP_SEND_CODE_PHONE:100,SIGNUP_REGISTER:126,PASSWORD_RECOVER_SEND_CODE:217,PASSWORD_RECOVER_VERIFY_CODE:218,PASSWORD_RECOVER:219},FRIENDS:{TYPE_CONTACT_UTIDS:29,TYPE_CONTACT_LIST:23,TYPE_PEOPLE_YOU_MAY_KNOW:31,TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:32,TYPE_FRIEND_CONTACT_LIST:107,TYPE_CONTACT_SEARCH:34,ACTION_FRIEND_SEARCH:35,TYPE_ADD_FRIEND:127,TYPE_UPDATE_ADD_FRIEND:327,TYPE_DELETE_FRIEND:128,TYPE_UPDATE_DELETE_FRIEND:328,TYPE_ACCEPT_FRIEND:129,TYPE_UPDATE_ACCEPT_FRIEND:329,TYPE_ACTION_BLOCK_UNBLOCK_FRIEND:243,TYPE_ACTION_CHANGE_FRIEND_ACCESS:244},NOTIFICATION:{TYPE_MY_NOTIFICATIONS:111,TYPE_SINGLE_NOTIFICATION:113,CLEAR_NOTIFICATION_COUNTER:195,MSG_TYPE_UPDATE_PROFILE_IMAGE:1,MSG_TYPE_UPDATE_COVER_IMAGE:2,MSG_TYPE_ADD_FRIEND:3,MSG_TYPE_ACCEPT_FRIEND:4,MSG_TYPE_ADD_GROUP_MEMBER:5,MSG_TYPE_ADD_STATUS_COMMENT:6,MSG_TYPE_LIKE_STATUS:7,MSG_TYPE_LIKE_COMMENT:8,MSG_TYPE_ADD_COMMENT_ON_COMMENT:9,MSG_TYPE_SHARE_STATUS:10,MSG_TYPE_LIKE_IMAGE:11,MSG_TYPE_IMAGE_COMMENT:12,MSG_TYPE_LIKE_IMAGE_COMMENT:13,MSG_TYPE_LIKE_AUDIO_MEDIA:17,MSG_TYPE_AUDIO_MEDIA_COMMENT:18,MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:19,MSG_TYPE_AUDIO_MEDIA_VIEW:20,MSG_TYPE_LIKE_VIDEO_MEDIA:21,MSG_TYPE_VIDEO_MEDIA_COMMENT:22,MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:23,MSG_TYPE_VIDEO_MEDIA_VIEW:24,MSG_TYPE_YOU_HAVE_BEEN_TAGGED:25,MSG_TYPE_UPGRADE_FRIEND_ACCESS:14,MSG_TYPE_ACCEPT_FRIEND_ACCESS:15,MSG_TYPE_DOWNGRADE_FRIEND_ACCESS:16},CIRCLE:{TYPE_CREATE_GROUP:50,TYPE_GROUP_DETAILS:52,TYPE_LEAVE_GROUP:53,TYPE_GROUP_LIST:70,TYPE_GROUP_MEMBERS_LIST:99,TYPE_GROUP_MEMBERS_SEARCH_RESULT:101,TYPE_DELETE_GROUP:152,TYPE_REMOVE_GROUP_MEMBER:154,TYPE_ADD_GROUP_MEMBER:156,TYPE_EDIT_GROUP_MEMBER:158,TYPE_UPDATE_ADD_GROUP:352,TYPE_UPDATE_DELETE_GROUP:352,TYPE_UPDATE_REMOVE_GROUP_MEMBER:354,TYPE_UPDATE_ADD_GROUP_MEMBER:356,TYPE_UPDATE_EDIT_GROUP_MEMBER:358,TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:51},CHAT:{FRIEND_CHAT_REQUEST:175,FRIEND_CHAT_UPDATE:375},TAG_CHAT:{TAG_CHAT_REQUEST_START:134,TAG_CHAT_UPDATE_START:334,TAG_CHAT_REQUEST_ADD_MEMBER:135,TAG_CHAT_UPDATE_ADD_MEMBER:335},MEDIA:{ACTION_ADD_MEDIA_CONTENT:258,ACTION_UPDATE_MEDIA_CONTENT:259,ACTION_DELETE_MEDIA_CONTENT:260,ACTION_MEDIA_ALBUM_CONTENT_LIST:261,ACTION_MEDIA_CONTENT_DETAILS:262,ACTION_ADD_MEDIA_ALBUM:253,ACTION_UPDATE_MEDIA_ALBUM:254,ACTION_DELETE_MEDIA_ALBUM:255,ACTION_MEDIA_ALBUM_LIST:256,ACTION_MEDIA_ALBUM_DETAILS:257,ACTION_MEDIA_SEARCH_RESULT:277,ACTION_SPECIFIC_MEDIA_RESULT:278,ACTION_GET_TAGGED_MEDIA_SONGS:279,ACTION_GET_HASHTAG_SUGGESTION:280,ACTION_GET_TRENDING_KEYWORDS:281,ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT:272,ACTION_ADD_COMMENT_ON_MEDIA:265,ACTION_LIKE_UNLIKE_MEDIA:264,ACTION_EDIT_COMMENT_ON_MEDIA:266,ACTION_MEDIA_COMMENT_LIST:270,ACTION_MEDIA_LIKE_LIST:269,ACTION_DELETE_COMMENT_ON_MEDIA:267,ACTION_LIKE_UNLIKE_MEDIA_COMMENT:268,ACTION_MEDIACOMMENT_LIKE_LIST:271,ACTION_UPDATE_LIKE_UNLIKE_MEDIA:464,ACTION_UPDATE_ADD_MEDIA_COMMENT:465,ACTION_UPDATE_EDIT_MEDIA_COMMENT:466,ACTION_UPDATE_DELETE_MEDIA_COMMENT:467,ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:468,ACTION_UPDATE_INCREASE_MEDIA_CONTENT_VIEW_COUNT:472},IMAGE:{PROFILE_IMAGE_ALBUM_ID:"profileimages",COVER_IMAGE_ALBUM_ID:"coverimages",FEED_IMAGE_ALBUM_ID:"default",TYPE_FRIEND_ALBUM_IMAGES:109,FETCH_ALBUM_LIST:96,FETCH_FRIEND_ALBUM_LIST:108,TYPE_ALBUM_IMAGES:97,TYPE_COMMENTS_FOR_IMAGE:89,TYPE_LIKES_FOR_IMAGE:93,TYPE_IMAGE_COMMENT_LIKES:196,TYPE_LIKE_IMAGE:185,TYPE_UNLIKE_IMAGE:187,TYPE_IMAGE_DETAILS:121,TYPE_EDIT_IMAGE_COMMENT:194,TYPE_ADD_IMAGE_COMMENT:180,TYPE_LIKE_UNLIKE_IMAGE_COMMENT:197,TYPE_DELETE_IMAGE_COMMENT:182,DELETE_IMAGE:246,TYPE_UPDATE_ADD_IMAGE_COMMENT:380,TYPE_UPDATE_EDIT_IMAGE_COMMENT:394,TYPE_UPDATE_DELETE_IMAGE_COMMENT:382,TYPE_UPDATE_LIKE_IMAGE:385,TYPE_UPDATE_UNLIKE_IMAGE:387,TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:397},PROFILE:{TYPE_CHANGE_COVER_PIC:103,TYPE_CHANGE_PROFILE_PIC:63,TYPE_REMOVE_PROFILE_IMAGE:43,TYPE_REMOVE_COVER_IMAGE:104,TYPE_ACTION_USER_MOOD:193,TYPE_ACTION_USER_MOOD_PRESENCE:199,FETCH_FRIEND_MUTUAL_FRIEND_LIST:118,CHANGE_PASSWORD:130,ACTION_USERS_PRESENCE_DETAILS:136,ACTION_USERS_PRESENCE_DETAILS_DATA:336,TYPE_ACTION_CURRENT_USER_BASICINFO:21,TYPE_ACTION_OTHER_USER_BASICINFO:95,TYPE_ACTION_GET_USER_DETAILS:204,TYPE_ACTION_LIST_WORK_AND_EDUCATIONS:230,TYPE_ACTION_MODIFY_USER_PROFILE:25,TYPE_ACTION_MODIFY_PRIVACY_SETTINGS:74,TYPE_CHANGE_PRIVACY:216,TYPE_CHANGE_FRIEND_PRIVACY:82,SEND_VERIFICATION_CODE_TO_MAIL:221,SEND_VERIFICATION_CODE_TO_PHONE:212,TYPE_ACTION_ADD_EDUCATION:231,TYPE_ACTION_UPDATE_EDUCATION:232,TYPE_ACTION_REMOVE_EDUCATION:233,TYPE_ACTION_GET_WORK:234,TYPE_ACTION_GET_EDUCATION:235,TYPE_ACTION_GET_SKILL:236,TYPE_ACTION_ADD_SKILL:237,TYPE_ACTION_UPDATE_SKILL:238,TYPE_ACTION_REMOVE_SKILL:239,TYPE_ACTION_ADD_WORK:227,TYPE_ACTION_UPDATE_WORK:228,TYPE_ACTION_REMOVE_WORK:229,ADD_SOCIAL_NETWORK:276},FETCH_EMOTION_LIST:273},STICKER:{GET_MY_STICKER:206,ADD_REMOVE_STICKER:207,ADD_JT_VALUE:1,REMOVE_JT_VALUE:3}})}(),function(){"use strict";angular.module("ringid.langugae.default",[]).constant("DF_KEY_VALUES",{add_friend:"Add Friend",remove_friend:"Remove Friend",common_friend:"Common Friend",request_sent:"Request Sent",unfriend:"Unfriend",block:"Block",unblock:"UnBlock",edit:"Edit",update:"Update","delete":"Delete",cancel:"Cancel",save:"Save",text_add:"Add",accept:"Accept",remove:"Remove",change:"Change",send:"Send",verify:"verify",add:"Add"})}(),function(){"use strict";angular.module("ringid.language",["ringid.langugae.default"]).factory("languageConstant",["DF_KEY_VALUES",function(a){var b={"default":a};return{set:function(a){b[a]={};
},get:function(a,c){return a=a||"default",b[a]}}}])}(),function(){"use strict";angular.module("ringid.sticker",["ringid.config"]).value("STICKER_IMAGE_TYPE",{EMOTICON:1,LARGE_EMOTICON:2,STICKER:3}).value("STICKER_COLLECTION_CATEGORY_PRE_FETCH_COUNT",5)}(),function(){"use strict";function a(a,b){var c=function(c,d,e){var f={type:a.STICKER,imageList:[]},g=c.imagesList;if(angular.isArray(g)){var h=g[0].sCtId,i=e[h];f.collectionId=i.getCollectionId(),f.categoryId=h,angular.forEach(g,function(c){f.imageList.push({name:c.imUrl,type:a.STICKER,id:c.imId}),d[c.sCtId]=b.create(f)})}return d};return{parseCategoryStickerData:c}}angular.module("ringid.sticker").factory("StickerHelper",a),a.$inject=["STICKER_IMAGE_TYPE","$$stickerMap"]}(),function(){"use strict";function a(a,b,c,d){c.stickerCategories=d.getStickerCategories(),c.stickerCollections=d.getStickerCollections(),b&&b.stickerKey&&(c.sticker=d.getStickerCategoryObject(b.stickerKey),c.$rgDigest()),c.addSticker=function(a){d.addMySticker(a.getKey()),c.$rgDigest()},c.removeSticker=function(a){d.removeMySticker(a.getKey()),c.$rgDigest()},c.isInstalled=function(a){return d.isDownloaded(a)},c.close=function(b){a.close(),b&&(b.preventDefault(),b.stopPropagation())}}angular.module("ringid.sticker").controller("StickerPopupController",a),a.$inject=["$boxInstance","localData","$scope","StickerFactory"]}(),function(){"use strict";function a(b){return{keyString:"sCtId",getKeyString:function(){return a.keyString},create:function(a){var c={sCtId:0,sctName:"",sClId:0,cgBnrImg:"",rnk:1,dtlImg:"",thmColor:"",txtColor:"",cgNw:0,icn:"",prz:0,free:0,dcpn:""},d=function(a){var b=angular.extend({},c,a);return b};return angular.isObject(a)&&(c=d(a)),{getCategoryId:function(){return c.sCtId},setCategoryId:function(a){c.sCtId=a},getCollectionId:function(){return c.sClId},setCollectionId:function(a){c.sClId=a},getKey:function(){return this.getCategoryId()},setKey:function(a){this.setCategoryId(a)},getName:function(){return c.sctName},setName:function(a){c.sctName=a},getTextColor:function(){return c.txtColor},setTextColor:function(a){c.txtColor=a},getBannerImage:function(){return c.bnrImg},setBannerImage:function(a){c.cgBnrImg=a},getRank:function(){return c.rnk},setRank:function(a){c.rnk=a},getDetailImage:function(){return c.dtlImg},getDetailImageUrl:function(){var a=b.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getDetailImage();return a},setDetailImage:function(a){c.dtlImg=a},getNewCategory:function(){return c.cgNw},setNewCategory:function(a){c.cgNw=a},getIconImage:function(){return c.icn},setIconImage:function(a){c.icn=a},getIconImageUrl:function(){var a=b.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getIconImage();return a},getCaptionImageUrl:function(a){var c=b.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/";return a?c+"ca.png":c+"c.png"},getPrice:function(){return c.prz},setPrice:function(a){c.prz=a},isFree:function(){return c.free},setIsFree:function(a){c.free=a},getDescription:function(){return c.dcpn},setDescription:function(a){c.dcpn=a},getThumbColor:function(){return c.thmColor},setThumbColor:function(a){c.thmColor=a}}}}}angular.module("ringid.sticker").factory("StickerCategoryModel",a),a.$inject=["settings"]}(),function(){"use strict";function a(a,b){return{create:function(b){var c={sClId:0,name:"",txtColor:"",bnrImg:"",thmColor:"",categories:[]},d=function(a){var b=angular.extend({},c,a);return b};return angular.isObject(b)&&(c=d(b)),{getId:function(){return c.sClId},setId:function(a){c.sClId=a},getKey:function(){return this.getId()},setKey:function(a){this.setId(a)},getName:function(){return c.name},setName:function(a){c.name=a},getTextColor:function(){return c.txtColor},setTextColor:function(a){c.txtColor=a},getBannerImage:function(){return c.bnrImg},setBannerImage:function(a){c.bnrImg=a},getBannerImageUrl:function(){var b=a.stickerBase+this.getId()+"/"+this.getBannerImage();return b},getThumbColor:function(){return c.thmColor},setThumbColor:function(a){c.thmColor=a},addCategories:function(a){c.categories.push(a)},removeCategories:function(a){c.categories.splice(a,1)},getCategories:function(){return c.categories}}}}}angular.module("ringid.sticker").factory("StickerCollectionModel",a),a.$inject=["settings","$$stackedMap"]}(),function(){"use strict";function a(a,b,c,d){var e=d.STICKER,f=d.SYSTEM.REQUEST_TYPE,g=this;g.go=function(b,c,d){return c=c||"get",d=d||[],a[c](b,d)},g.getAll=function(){var a=c.stickerApi+"?all=1";return g.go(a)},g.getStickerCategoriesByCollectionId=function(a){var b=c.stickerApi+"?collectionId="+a;return g.go(b)},g.getStickersByCatId=function(a){var b=c.stickerApi+"?categoryId="+a;return g.go(b)},g.getMyStickers=function(){var a={actn:e.GET_MY_STICKER};return b.request(a,f.REQUEST)},g.addSticker=function(a){var c={actn:e.ADD_REMOVE_STICKER,catId:a.catId,jt:e.ADD_JT_VALUE};return b.request(c,f.UPDATE)},g.removeSticker=function(a){var c={actn:e.ADD_REMOVE_STICKER,catId:a.catId,jt:e.REMOVE_JT_VALUE};return b.request(c,f.UPDATE)}}angular.module("ringid.sticker").service("stickerHttpService",a),a.$inject=["$ringhttp","$$connector","settings","OPERATION_TYPES"]}(),function(){"use strict";function a(a,b){function c(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var d=this,e={":D":"awesome.png",":<3":"loved.png","*D*":"excited.png",":)":"happy.png",":-(":"alone.png","(cool)":"cool.png","x=(":"angry.png","o_-":"fresh.png",":>s":"sick.png",":?":"confused.png",";|":"thoughtful.png",":*":"fantastic.png",":=(":"upset.png",">u<":"blah.png","(amused)":"amused.png","(hot)":"hot.png","(-_^)":"motivated.png","(^_^)":"satisfied.png",">=<":"hurt.png",":(s":"ill.png","(cute)":"cute.png","I=)":"relived.png",":O":"shoked.png","(beautiful)":"beautiful.png",":|p":"hyper.png","(pumped)":"pumped.png","%)":"drunk.png","o(":"impatient.png","(restless)":"restless.png",":-)":"emotional.png","(hungry)":"hungry.png","(nostalgic)":"nostalgic.png","(blessed)":"blessed.png","</3":"heartboken.png","(naughty)":"naughty.png","(entertained)":"entertained.png","(broken)":"broken.png","(cold)":"cold.png","(down)":"down.png","(sorry)":"sorry.png","(frustrated)":"frustrated.png",":-s":"scared.png",":@":"fuming.png",NN:"run.png",":'q":"crying.png",":'D":"laughing.png",":'(":"soreness.png","(boiling)":"boiling.png",":x":"xmode.png",":p":"cheeky.png",":=0":"laughing-inside.png","|-O":"yawn.png",":6":"devil.png",":-#":"zipped-lip.png","(clap)":"clap.png","<3":"heart.png","(pink-heart)":"pink-heart.png","(k)":"pink-lip.png","(#)":"sun.png","(*)":"star.png","(g)":"gift.png","(K)":"red-lip.png","(f)":"rose.png"},f=angular.extend({":&lt;3":"loved.png","&lt;/3":"heartboken.png","&gt;=&lt;":"hurt.png","&gt;u&lt;":"blah.png",":&gt;s":"sick.png","&lt;3":"heart.png"},e),g=[];for(var h in f)f.hasOwnProperty(h)&&g.push(c(h));var i=new RegExp(g.join("|"),"g");d.getEmoImageName=function(a){try{return e[a]}catch(b){return"default.png"}},d.getAllEmoticons=function(){var b={type:a.EMOTICON,imageList:[]};return angular.forEach(e,function(c,d){b.imageList.push({name:c,symbol:d,type:a.EMOTICON})}),b},d.getEmoticonUrlMap=function(){var a={};return angular.forEach(e,function(c,d){a[d]=b.emoticonBase+c}),a},d.getEmoticonUrlMapWithHtmlEncode=function(){var a={};return angular.forEach(f,function(c,d){a[d]=b.emoticonBase+c}),a},d.getEmoticonPattern=function(){return i},d.getEmoticonMap=function(){return f}}function b(a){function b(){return a.getAllEmoticons()}function c(b){return a.getEmoImageName(b)}function d(a,b,c){var d=settings.stickerBase+a+"/"+b+"/"+c;return d}return{getAllEmoticons:b,getEmoImageName:c,getStickerImageUrl:d,getEmoticonUrlMap:a.getEmoticonUrlMap,getEmoticonUrlMapWithHtmlEncode:a.getEmoticonUrlMapWithHtmlEncode,getEmoticonPattern:a.getEmoticonPattern}}angular.module("ringid.sticker").service("StickerEmoticonService",a).factory("StickerEmoticonFactory",b),a.$inject=["STICKER_IMAGE_TYPE","settings"],b.$inject=["StickerEmoticonService"]}(),function(){"use strict";function a(a,b){return{create:function(c,d,e){var f={id:c.id||0,name:c.name||"",symbol:c.symbol||c.name,type:c.type||0,src:1===d?a.emoticonBase+c.name:e+c.name,isEmoticon:d===b.EMOTICON,isLargeEmoticon:d===b.LARGE_EMOTICON,isSticker:d===b.STICKER};return{getKey:function(){return f.id},src:function(){return f.src},symbol:function(){return f.symbol},getName:function(){return f.name},srcWithoutBase:function(){return f.src.replace(a.stickerBase,"")},isEmoticon:function(){return f.isEmoticon},isLargeEmoticon:function(){return f.isLargeEmoticon},isSticker:function(){return f.isSticker}}}}}function b(a,b,c){return{create:function(d,e){for(var f,g=c.stickerBase+d.collectionId+"/"+d.categoryId+"/",h={categoryId:d.categoryId||0,collectionId:d.collectionId||0,imageListMap:a.createNew(),type:d.type||0,isEmoticon:1===d.type,isLargeEmoticon:2===d.type,isSticker:3===d.type,regularUrl:1===d.type?"/images/emoticon/c.png":+g+"c.png",hoverUrl:1===d.type?"/images/emoticon/ca.png":g+"ca.png",installed:e||!1},i=0;i<d.imageList.length;i++)f=b.create(d.imageList[i],h.type,g),h.imageListMap.add(f.getKey(),f);return{sortBy:function(){return h.categoryId},isInstalled:function(){return h.installed},setInstalled:function(a){h.installed=a},isEmoticon:function(){return h.isEmoticon},isLargeEmoticon:function(){return h.isLargeEmoticon},isSticker:function(){return h.isSticker},getKey:function(){return h.categoryId},getImages:function(){return h.imageListMap},getType:function(){return h.type},link:function(){return h.regularUrl},hoverLink:function(){return h.hoverUrl}}}}}function c(a,b,c,d,e,f,g,h,i,j){function k(a){try{var b=a.getKey();c.getStickerCategoriesByCollectionId(b).success(function(b){if(b&&b.sucs===!0&&b.categoriesList){var c=b.categoriesList;angular.isArray(c)&&angular.forEach(c,function(b){var c=b[f.getKeyString()],d=v[c];d||(d=f.create(b),v[d.getKey()]=d),a.addCategories(d.getKey())})}}).error(function(a){})}catch(d){}}function l(a){try{angular.forEach(a.freeCategoriesList,function(a){var b=f.create(a);v[b.getKey()]=b,x.free.push(b.getKey())})}catch(b){}try{angular.forEach(a.topCategoriesList,function(a){var b=f.create(a);v[b.getKey()]=b,x.top.push(b.getKey())})}catch(b){}try{angular.forEach(a.stNewCategoriesList,function(a){var b=f.create(a);v[b.getKey()]=b,x["new"].push(b.getKey())})}catch(b){}try{angular.forEach(a.stickerCollectionsList,function(a){var b=g.create(a);y[b.getKey()]=b,k(b)})}catch(b){}}function m(){c.getAll().success(function(a){try{a&&a.sucs===!0&&(o(a),l(a),q())}catch(b){}}).error(function(a){})}function n(){try{return j.getData(t)}catch(a){return!1}}function o(a){j.setData(t,a)}function p(){j.setData(u,z)}function q(){z=j.getData(u),C&&z||(z={},c.getMyStickers().then(function(a){a.sucs===!0&&(angular.forEach(a.catIds,function(a){z[a]=1,w[a]&&w[a].setInstalled(!0)}),p())}))}function r(a){try{l(a)}catch(b){}}function s(a){try{return v[a]}catch(b){return{}}}var t="stickerData",u="myStickers",v={},w={},x={free:[],"new":[],top:[]},y={},z={},A=d.getAllEmoticons(),B=b.create(A,!0),C=!1,D=function(a){var b=i.defer();return w[a]||c.getStickersByCatId(a).success(function(a){a&&a.sucs===!0&&(e.parseCategoryStickerData(a,w,v),b.resolve(a))}).error(function(a){b.reject(a)}),b.promise};return{initStickerData:function(a){if(a===!0)m();else{var b=n();angular.isObject(b)?(r(b),q()):m()}},getNoOfMyStickers:function(){return z?Object.keys(z).length:0},getStickerCategories:function(a){return a?x[a]:x},getStickerCollections:function(){return y},getMyStickerCatIds:function(){return z?Object.keys(z):[]},getStickerMapByCatId:function(a){var b=i.defer();return w[a]?b.resolve(w[a]):D(a).then(function(){b.resolve(w[a])},function(a){b.reject(a)}),b.promise},isDownloaded:function(a){return!!z[a]},getStickerCategoryObject:function(a){return s(a)},getEmoticonMap:function(){return B},getMyStickers:function(){return c.getMyStickers()},addMySticker:function(a){try{z[a]=1,p(),w[a]&&w[a].setInstalled(!0)}catch(b){}c.addSticker({catId:a}).then(function(b){b.sucs!==!0&&(z[a]=0,w[a].setInstalled(!1))},function(a){})},removeMySticker:function(a){try{delete z[a],p(),w[a]&&w[a].setInstalled(!1)}catch(b){}c.removeSticker({catId:a}).then(function(b){b.sucs!==!0&&(z[a]=1,w[a].setInstalled(!0))},function(a){})}}}angular.module("ringid.sticker").factory("StickerFactory",c).factory("$$stickerMap",b).factory("$$stickerImageMap",a),a.$inject=["settings","STICKER_IMAGE_TYPE"],b.$inject=["$$stackedMap","$$stickerImageMap","settings"],c.$inject=["$$stackedMap","$$stickerMap","stickerHttpService","StickerEmoticonFactory","StickerHelper","StickerCategoryModel","StickerCollectionModel","STICKER_IMAGE_TYPE","$$q","Storage"]}(),function(){"use strict";function a(a){return{restrict:"E",templateUrl:"pages/partials/stickers/sticker-category.html",scope:{categories:"=categories"},link:function(b){b.getStickerCategory=a.getStickerCategoryObject,b.showPreview=function(a){return function(){return{stickerKey:a}}},b.isInstalled=function(b){return a.isDownloaded(b)},b.addSticker=function(c){a.addMySticker(c),b.$rgDigest()},b.removeSticker=function(c){a.removeMySticker(c),b.$rgDigest()}}}}angular.module("ringid.sticker").directive("rgStickerCategory",a),a.$inject=["StickerFactory"]}(),function(){"use strict";angular.module("ringid.sticker").directive("rgStickerCategoryList",function(){return{restrict:"E",templateUrl:"pages/partials/stickers/sticker-category-list.html",scope:{categories:"=categories"}}})}(),function(){"use strict";angular.module("ringid.sticker").directive("rgStickerCollectionList",function(){return{restrict:"E",templateUrl:"pages/partials/stickers/sticker-collection-list.html",scope:{collections:"="},link:function(a){a.currentCollectionIdToShow=0,a.shouldShowCollectionCategories=function(b){return a.currentCollectionIdToShow==b},a.showCollectionCategories=function(b){a.displayingCollections=!a.displayingCollections,a.currentCollectionIdToShow=b,a.$rgDigest()},a.displayingCollections=!0}}})}(),function(){"use strict";angular.module("ringid.utils",["ringid.config","rg.custom.compiler.directive","ringid.sticker"])}(),function(){"use strict";angular.module("rg.custom.compiler.directive",[],["$compileProvider",function(a){a.directive("rgCompile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.rgCompile)},function(d){c.html(d),a(c.contents())(b)})}}])}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){S.viewport||(S.viewport=W());var a=S.viewport.x;return 1280>a?1:a>=1280&&1800>=a?2:a>1800?3:void 0}function q(){var a=p(),b=parseInt(m.getCookie("col"));return!b||b>a?a=a>2?2:a:b}function r(a){var b=S.viewport.x;return 1===a&&b>=1280?600:b>=768&&799>=b?329:b>=800&&979>=b?361:b>=980&&1279>=b?541:b>=1280&&1349>=b?423:b>=1350&&1399>=b?458:b>=1400&&1499>=b?475:b>=1500&&1649>=b?510:b>=1650&&1799>=b?560:1920>=b?487:2650>=b?487:500}function s(){var a=q();return a=parseInt(a),1===a?600:r(a)}function t(a){return k.get(d.ogServiceUrl+"?url="+encodeURIComponent(a))}function u(a){return a.mg?a.mg:v(a.rc)}function v(a){return j["RC"+a]?j["RC"+a]:""}function w(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function x(a){var b=l.defer(),c=new Image;return c.onload=function(){b.resolve({imgUrl:this.src,width:this.width,height:this.height})},c.src=a,setTimeout(function(){b.resolve({width:0,height:0})},3e4),b.promise}function y(a){var b,c,d,e=";base64,";if(-1==a.indexOf(e))return b=a.split(","),c=b[0].split(":")[1],d=decodeURIComponent(b[1]),new Blob([d],{type:c});b=a.split(e),c=b[0].split(":")[1],d=window.atob(b[1]);for(var f=new Uint8Array(d.length),g=0;g<d.length;++g)f[g]=d.charCodeAt(g);return new Blob([f],{type:c})}function z(a,b){var c=l.defer(),d=[];return b.width||(b.width=0),b.height||(b.height=0),angular.forEach(a,function(e){setTimeout(function(){x(e).then(function(e){var f,g;e.width&&e.width>=b.width&&(f=!0),e.height&&e.height>=b.height&&(g=!0),f&&g&&(d.push(e.imgUrl),d.length==a.length?c.resolve(e.imgUrl):c.notify(e.imgUrl))})})}),setTimeout(function(){0==d.length&&c.resolve([])},2e4),c.promise}function A(a,b,c,d,e){var f=0,g=function(){!f||d>f&&!b.call(null,f)?(a.call(),f++,setTimeout(g,e)):b.call(null,f)||c.call()};g()}function B(a,b){var c=document.createEvent("Event");c.initEvent(a,!0,!0),c.data=b,document.dispatchEvent(c)}function C(a,b){var c=function(a){b.call(this,a.data)};return document.addEventListener(a,c),c}function D(a,b){document.removeEventListener(a,b)}function E(){var a;if(a=window.getSelection(),a.getRangeAt)return a.getRangeAt(0);if(document.selection&&document.selection.createRange){var b=document.createRange();return b.setStart(selection.anchorNode,selection.anchorOffset),b.setEnd(selection.focusNode,selection.focusOffset),b}return null}function F(a){var b=a.split(","),c=new Uint8Array(b);return c.buffer}function G(a){var b=new Uint8Array(a);return Array.prototype.join.call(b,",")}function H(a){a.$parent&&1!==a.$parent.$id?a.$parent.$rgDigest():a.$rgDigest()}function I(){var a=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(a+=performance.now());var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}function J(){P=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,Q=0,R=-1*P}function K(){Q+=25;var a=Math.easeIn(Q,P,R,da);document.documentElement.scrollTop=a,document.body.parentNode.scrollTop=a,document.body.scrollTop=a,da>Q&&requestAnimationFrame(K)}function L(){var a=document.createElement("p");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.visibility="hidden",b.style.width="200px",b.style.height="150px",b.style.overflow="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;return c==d&&(d=b.clientWidth),document.body.removeChild(b),a=b=null,c-d}function M(a){var b=l.defer(),c=b.promise,d=m.getData("uLocationInfo");return d&&d.lat?(d.sucs=!0,c=d):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(c){var d=c.coords.latitude,e=c.coords.longitude,f={lat:d,lng:e};if(a){var g=new google.maps.Geocoder;g.geocode({location:f},function(a,c){c===google.maps.GeocoderStatus.OK?(m.setData("uLocationInfo",{lat:d,lng:e,description:a[1].formatted_address}),b.resolve({sucs:!0,lat:d,lng:e,description:a[1].formatted_address})):(m.setData("uLocationInfo",{lat:d,lng:e}),b.resolve({sucs:!0,lat:d,lng:e}))})}else m.setData("uLocationInfo",{lat:d,lng:e}),b.resolve({sucs:!0,lat:d,lng:e})},function(a){b.resolve({sucs:!1,error:a})}),l.when(c)}function N(a,b){if(!i[a])return"";var c=i[a];switch(a){case"HOME":case"FAQ":break;case"SINGLE_FEED":b.feedId&&(c=c.replace(":feedId",b.feedId));var d=b.shared?"shared":"";c=c.replace(":shared?",d);var e;d?(e=b.commentId||0,c=c.replace(":commentId?",e)):(e=b.commentId||"",c=c.replace(":commentId?/",e));break;case"WHO_SHARED_FEED":b.feedId&&(c=c.replace(":feedId",b.feedId));var e=b.commentId||"";c=c.replace(":commentId?",e);break;case"SINGLE_IMAGE":b.imageId&&(c=c.replace(":imageId",b.imageId));var e=b.commentId||"";c=c.replace(":commentId?",e);break;case"SINGLE_MEDIA":b.mediaId&&(c=c.replace(":mediaId",b.mediaId));var e=b.commentId||"";c=c.replace(":commentId?",e);break;case"USER_PROFILE":b.uId&&(c=c.replace(":uId",b.uId)),c=b.utId?c.replace(":utId",b.utId):c.replace("/:utId",""),c=b.albumId?c.replace(":albumId?",b.albumId):c.replace("/:albumId?","");break;case"CIRCLE_HOME":b.circleId&&(c=c.replace(":circleId",b.circleId))}return c=b.subpage?c.replace(":subpage?",b.subpage):c.replace("/:subpage?",""),"/#"+c}function O(){requestAnimationFrame(function(){var a=S.viewportsize();n.windowHeight=a.y,n.windowWidth=a.x,S.viewport.x=a.x,S.viewport.y=a.y,S.viewport.yo=a.yo,S.setFeedCellWidth(),n.$broadcast(o.COMMON.WINDOW_RESIZED,S.viewport)})}var P,Q,R,S={},T=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/gi,U=g.getEmoticonPattern(),V=h.getEmoticonMap(),W=function(){var c=a,d=b,e=d[0].documentElement,f=d[0].getElementsByTagName("body")[0],g=c.innerWidth||e.clientWidth||f.clientWidth,h=c.innerHeight||e.clientHeight||f.clientHeight,i=c.pageYOffset;return{x:g,y:h,yo:i}},X=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Y=function(a){return/^(f|ht)tps?:\/\//i.test(a)||(a="http://"+a),a},Z=function(a,b){a=X(a);var c=a,d=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return b||(b=0),"blob:http"===c.substring(0,9)&&(c='<img width="100%" src="'+c+'" />',b=2),0===b&&(c=c.replace(T,function(a){var b=Y(a);return'<a class="feedanchor" target="_blank" href="'+b+'"> '+a+"</a>"})),c=c.replace(U,function(a){return'<span class="em_list '+V[a].replace(/\.[A-Za-z]{3}/,"")+'" data-link="'+a+'" title="'+a+'">&nbsp;</span>'}),window.emojiSupported||(c=c.replace(d,function(a){var b,c,d;return b=a.charCodeAt(0),c=a.charCodeAt(1),d=(1024*(b-55296)+(c-56320)+65536).toString(16),'<u class="emo_list U_'+d+'"></u>'})),1===b&&(c=a),c},$=function(b){return b||(b=""),b+(window._cti||"")+a.Math.floor(a.Math.random()*(new a.Date).getTime())},_=function(a){var b=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return a?b.test(a)||U.test(a):!1},aa=function(a,b,d){d||(d="({0},{1})".format(a,b));var e="https://maps.googleapis.com/maps/api/staticmap?center={0},{1}&zoom=18&size=640x170&key={3}&markers=color:orange|label:A|{2}|{0},{1}";return e=e.format(a,b,d,c.GOOGLE_MAP_KEY)},ba=function(a,b,c,d){var e;return e=a&&b?"https://maps.google.com/maps?q={0},{1}&hl=en;z=18;iwd=1".format(a,b):"http://maps.google.com?q={0}".format(c),d&&(e+="&output=embed"),e},ca=function(a,b){var c=l.defer(),d=!1;return A(function(){var e=a.apply(this,b);e.then?e.then(function(a){d=!0,c.resolve(a)},function(a){d=!0,c.reject(a)}):c.reject({sucs:!1,rc:"Invalid"})},function(){return d},function(){d||c.reject({timeout:!0,sucs:!1})},5,3e3),c.promise},da=500;S={generateUUID:I,getRingRoute:N,getOGDetails:t,getReasoneMessage:v,getReasonMessageFromResponse:u,debounce:w,tabId:window._cti,animateScroll:K,resetScroll:J,viewport:W(),viewportsize:W,scrollbarWidth:L(),feedCellWidth:s(),string2ArrayBuffer:F,arrayBuffer2String:G,setFeedCellWidth:function(){S.feedCellWidth=s()},hasSocket:function(){return!0},parseForLE:function(a,b){return Z(a,b)},init:function(){},feedColumn:q,getDefaultColumn:p,setFeedColumn:function(a){m.setCookie("col",parseInt(a))},getUniqueID:function(a){return $(a)},getRandomString:function(a){for(var b="",c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",d=a;d>0;--d)b+=c[Math.round(Math.random()*(c.length-1))];return b},getToken:"234",chatVerbalDate:function(a){return e("date")(a,"h:mm a")},profileVerbalDate:function(a){return e("date")(a,"yyyy-MM-dd")},verbalDate:function(b,c){var d,f,g,h=a.Math,i=new Date;if(c=c||Date.now(),isNaN(b)?(d=new Date((b||"").replace(/-/g,"/").replace(/[TZ]/g," ")),b=d.getTime()):d=new Date(b),f=(c-b)/1e3,g=h.floor(f/86400),isNaN(g))return"";switch(!0){case 1>g:switch(!0){case 60>f:return"just now";case 120>f:return"1 minute ago";case 3600>f:return h.floor(f/60)+" minutes ago";case 7200>f:return"1 hour ago";case 86400>f:return h.floor(f/3600)+" hours ago";default:return e("date")(b,"MMM d, h:mm a")}break;case 1===g:return"yesterday at "+e("date")(b,"h:mm a");case 7>g:return e("date")(b,"EEEE 'at' h:mm a");case 365>g:return i.getUTCFullYear()===d.getUTCFullYear()?e("date")(b,"MMMM d 'at' h:mm a"):e("date")(b,"MMMM d yyyy 'at' h:mm a");default:return e("date")(b,"MMM d, yyyy")}},getUserLocation:M,getImageUrlDimension:x,filterImagesByDimentions:z,dataURLToBlob:y,callXTimeAfterYIntervalStopOnSuccess:A,requestMultipleTime:ca,triggerCustomEvent:B,onCustomEvent:C,removeCustomEvent:D,getSelection:E,getGoogleMapStaticUrl:aa,getGoogleMapJSUrl:ba,hasEmoticon:_,safeDigest:H};var ea=angular.element(a);return ea.bind("resize",O),S}var b;b=angular.module("ringid.utils"),b.factory("utilsFactory",a),a.$inject=["$window","$document","APP_CONSTANTS","settings","$filter","Storage","StickerEmoticonFactory","StickerEmoticonService","RING_ROUTES","MESSAGES","$ringhttp","$$q","Storage","$rootScope","SystemEvents"]}(),function(){"use strict";function a(a,b){return function(c,d,e){var f=angular.element(b);f.bind("scroll",function(){requestAnimationFrame(function(){var b=a.viewportsize();a.viewport.x=b.x,a.viewport.y=b.y,a.viewport.yo=b.yo})})}}var b;b=angular.module("ringid.utils"),b.directive("rgKeyUp",function(){return function(a,b,c){function d(b){try{a[c.rgKeyUp](b),a.$rgDigest()}catch(d){}}b.bind("keyup",d),a.$on("$destroy",function(){b.unbind("keyup",d)})}}),b.directive("rgKeyPress",function(){return function(a,b,c){function d(b){try{a[c.rgKeyUp](b),a.$rgDigest()}catch(d){}}b.bind("keypress",d),a.$on("$destroy",function(){b.unbind("keypress",d)})}}),b.directive("rgScroll",a),a.$inject=["utilsFactory","$window"]}(),function(){"use strict";function a(a,b,c){var d=a.createNew(),e=function(){d.length()>0&&f()},f=function(){var a;d.doForAll(function(b){a=b.call(null),a&&!a.$$phase&&a.$digest()})};return b.$on("ringActive",e),{add:function(a){var b=c.getUniqueID();return d.add(b,a),b},remove:function(a){return d.remove(a)},synch:e}}angular.module("ringid.syncher",["ringid.utils"]).factory("$$rgsyncher",a),a.$inject=["$$stackedMap","$rootScope","utilsFactory"]}(),function(a,b){"use strict";angular.module("ringid.connector",["ngWebSocket","ringid.utils","ringid.config","ringid.syncher"])}(DataView,String),function(){"use strict";function a(a){var b={defer:function(){var b=a.defer(),c={};return{resolve:function(a){var d,e,f,g;if(a.seq||a.totalPacket){if(d=a.pckId,c[a.pckId]||(c[a.pckId]=[]),b.notify(a),a.seq?(e=a.seq.lastIndexOf("/"),f=a.seq.substr(0,e),g=a.seq.substr(e+1,a.seq.length)):(f=a.packetNo,g=a.totalPacket),c[a.pckId]["sq"+f])return!0;if(c[a.pckId]["sq"+f]=!0,c[a.pckId].push(a),g!=c[a.pckId].length)return!0;for(var h={},i=0;i<c[a.pckId].length;i++)for(d in c[a.pckId][i])c[a.pckId][i][d]instanceof Array?h[d]=(h[d]||[]).concat(c[a.pckId][i][d]):h[d]=c[a.pckId][i][d];b.resolve(h),delete c[a.pckId]}else b.resolve(a)},promise:b.promise}}};return b}angular.module("ringid.connector").service("mergerService",a),a.$inject=["$$q"]}(),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i,j,k){function l(a){return function(b){if(!b||!b.actn)return!1;if(!angular.isArray(a))return b.actn===a;for(var c=0;c<a.length;c++)if(b.actn===a[c])return!0;return!1}}function m(a){if(t[a.pckId]===!0)return!0;if(t[a.pckId]){var b=t[a.pckId].resolve.call(t[a.pckId],a);return b||(t[a.pckId]=!!b,setTimeout(function(){delete t[a.pckId]},3e3)),!0}return!1}function n(a){var b=!1;return w.length()>0&&w.doForAll(function(c){var d,e=c.filter;e?angular.isFunction(e)&&(d=e.call(null,a),d&&(b=!0,c.fn.call(c,a))):c.fn.call(null,a)}),b}function o(a){if(a){var b,c;if(a.actn===i.SYSTEM.AUTH.TYPE_INVALID_LOGIN_SESSION)return void n(a);a.hasOwnProperty("pckId")&&(b=m(a)),b||(c=n(a),c||x.push(a))}}function p(){window.onbeforeunload=function(){return c.unloadWarn?"You have unsaved changes.  Do you want to leave this page and lose your changes?":void 0}}function q(a,b,c,d){var e;return e=a.pckId||g.getUniqueID(),a.pckId=e,c&&(t[e]=c),a?RingWorker.send(a,e,b,d):void 0}function r(a,b,c,d){var e,f=c?k.defer():h.defer();return e=q(a,b,f,d),f.promise}var s,t=(b.getCookie("sessionID"),b.getCookie("uId"),{}),u=!1,v=(Date.now(),!1),w=e.createNew(),x=[],y=e.createNew();return s={init:p,close:function(){},send:function(a,b,c){q(a,b,!1,c)},request:function(a,b,c){return r(a,b,!1,c)},pull:function(a,b,c){return r(a,b,!0,c)},subscribe:function(a,b){var d,e,f=[];if(b=b||{},b.key=b.key||g.getUniqueID(),b.scope=b.scope||c,b.autoApply=!1,b.fn=a||angular.noop,!b.filter&&b.action&&(b.filter=l(b.action)),w.add(b.key,b),b.callWithUnresolved){for(d=0;d<x.length;d++)e=b.filter.call(null,x[d]),e?b.fn.call(null,x[d]):f.push(x[d]);x.length=0,x=f}return b.key},unsubscribe:function(a){w.remove(a)},stop:function(){u=!0},resume:function(){u=!1},reset:function(){},addInterval:function(a){var b=g.getUniqueID();return y.add(b,a),b},removeInterval:function(a){y.remove(a)},keepAlive:function(){v=!0,RingWorker.pushMessage({command:"KEEPALIVE",aSkey:b.getCookie("sId"),uKey:b.getCookie("uId")})},notifyRouteChange:function(){RingWorker.pushMessage({command:"ROUTE_CHANGE"})}},c.$on("ringInactive",function(a){}),c.$on("$locationChangeStart",function(a){}),RingWorker.addCallback("received",function(a){o(a.data)}),RingWorker.addCallback("event",function(a){a.name&&c.$broadcast(a.name)}),s}angular.module("ringid.connector").factory("$$connector",b),b.$inject=["settings","Storage","$rootScope","$websocket","$$stackedMap","ATTRIBUTE_CODES","utilsFactory","$$q","OPERATION_TYPES","CLIENT_DATA_SIZE","mergerService"]}(DataView),function(){"use strict";angular.module("ringid.global.services",["ringid.config","ringid.connector","ringid.common.services","ringid.common.factories","ringid.common.directives","ringid.utils","ui-notification"])}(),function(){"use strict";function a(a,b){function c(c,g,h,i){var j=!1,k={success:function(){},error:function(){},abort:function(){},progress:function(){}},l=g;g=/^(http|https):\/\//.test(g)?g:a.baseUrl+(0===g.indexOf("/")?g:"/"+g);var m={success:function(a){return k.success=a,m},error:function(a){return k.error=a,m},abort:function(a){return k.abort=a,m},progress:function(a){return k.progress=a,m},abortRequest:function(){n.abort()}};try{var n=new XMLHttpRequest;j="GET"===c&&/\.html$/.test(g),j&&e.hasOwnProperty(l)?e[l].push(k):j&&b.get(l)?setTimeout(function(){k.success.apply(k,[b.get(l),n])}):(j&&(g=g+"?time="+d,e[l]=[],e[l].push(k)),n.open(c,g,!0),n.responseType=i||"text",n.onreadystatechange=function(){var a;4===n.readyState&&(a=f(n),200===n.status?j?(b.put(l,a[0]),e[l].forEach(function(a){a.success.apply(a,[b.get(l),n])}),delete e[l]):(k.progress.apply(k,[100]),k.success.apply(k,a)):k.error.apply(k,a))},n.upload.onabort=function(){k.abort.apply(k)},n.upload.onprogress=function(a){k.progress.apply(k,[Math.round(a.loaded/a.total*100)-1])},n.send(h))}catch(o){}return m}var d=(new Date).getTime(),e={},f=function(a){var b;try{b=JSON.parse(a.responseText)}catch(c){b=a.response}return[b,a]};return{get:function(a,b,d){return c("GET",a,b,d)},post:function(a,b,d){return c("POST",a,b,d)},getTemplatePromise:function(a,b,c){}}}angular.module("ringid.global.services").factory("$ringhttp",a),a.$inject=["settings","$templateCache"]}(),function(){"use strict";function a(a){var b=[],c=function(a){if(3!==a.which&&0!==b.length){for(var c=0,d=b.length;d>c;c++)b[c].call(null,a);a.preventDefault()}};return{bindHandler:function(d,e,f){b.push(f),1===b.length&&a.bind("click",c)},unbindHandler:function(d,e,f){
setTimeout(function(){b.splice(b.indexOf(f),1),0===b.length&&a.unbind("click",c)})}}}angular.module("ringid.global.services").factory("GlobalEvents",a),a.$inject=["$document"]}(),function(){"use strict";function a(a,b,c){var d={delay:3e3,positionX:"right",positionY:"top",replaceMessage:!0},e={title:"Warning",message:"Click ok to continue",showOk:!0,showCancel:!0,craac:!1,textOk:"OK",textCancel:"Cancel",okCallback:angular.noop,cencelCallback:angular.noop};return{show:function(a,e){e=e||"info",angular.isString(a)&&(a={message:a}),a.message=a.message||a.mg,a.message||("success"===e?a.message=c.REQUEST_PROCESSED:"error"===e&&(a.message=c.REQUEST_FAILED));try{b[e](angular.extend({},d,a))}catch(f){}},clear:function(){b.clearAll()},alert:function(b){b=b||{},b=angular.extend({},e,b);var c=a.open({type:"remote",scope:!1,scopeData:b,templateUrl:"pages/popups/ring-alert.html"});c.result.then(function(a){"ok"===a&&angular.isFunction(b.okCallback)?b.okCallback.call(null):b.cencelCallback.call(null)})}}}angular.module("ringid.global.services").factory("Ringalert",a),a.$inject=["$ringbox","Notification","MESSAGES"]}(),function(){"use strict";angular.module("ringid.global.services").factory("$$stackedMap",function(){return{createNew:function(a,b){function c(a){a=a||"sortBy";var c=-1,d=1;"desc"===b&&(c=1,d=-1),g.sort(function(b,e){return e.value[a]()>b.value[a]()?c:b.value[a]()>e.value[a]()?d:0})}function d(a){for(var b=0;b<g.length;b++)if(a==g[b].key)return b;return-1}function e(a){var b=d(a);return-1===b||b===g.length-1?!1:g[b+1].value}function f(a){var b=d(a);return-1===b||0===b?!1:g[b-1].value}var g=[],h=this;a=a||!1,b=b||"desc";var i={concat:function(a){g=g.concat(a)},reset:function(){g=[]},all:function(){return g},setStack:function(a){g=a},add:function(b,d){return g.push({key:b,value:d}),a!==!1&&c(),!1},next:function(a){return e(a)},previous:function(a){return f(a)},getByIndex:function(a,b){return g.length&&(a>=0||a<g.length)?b?g[a]:g[a].value:!1},getIndex:function(a){return d(a)},get:function(a){var b=d(a);return b>=0?g[b].value:!1},save:function(b,e){var f;f=d(b),-1===f?i.add(b,e):g[f]={key:b,value:e},a!==!1&&c()},sort:function(a,d){a&&(b=a),c(d)},keys:function(){for(var a=[],b=0;b<g.length;b++)a.push(g[b].key);return a},values:function(){for(var a=[],b=0;b<g.length;b++)a.push(g[b].value);return a},top:function(a){return g.length?(a=!!a,a?g[g.length-1]:g[g.length-1].value):!1},bottom:function(a){return g.length?(a=!!a,a?g[0]:g[0].value):!1},sliceBy:function(a,b){return b||(b=0),(a>g.length||!a)&&(a=g.length),g.slice(b,a)},remove:function(a){var b=d(a);return b>-1?(g.splice(b,1),!0):!1},removeTop:function(){return g.splice(g.length-1,1)[0]},length:function(){return g.length},nonClosedLength:function(){var a=0;return angular.forEach(g,function(b,c){a+=b.closedBox?1:0}),a},copy:function(){for(var c=h.createNew(a,b),d=0;d<g.length;d++)c.add(g[d].key,g[d].value);return c},doForAll:function(a){for(var b=0;b<g.length;b++)a.call(null,g[b].value)}};return i}}})}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c){var e={};switch(a){case"recoveryVerifyCode":e.actn=H.PASSWORD_RECOVER_VERIFY_CODE,e.uId=b.uId,e.vc=b.vc,e.wk=d.getUniqueID(),e.lt=1;break;case"recoverySendCode":e.actn=H.PASSWORD_RECOVER_SEND_CODE,e.wk=d.getUniqueID(),c?(e.lt=2,e.rb=b.mblDc+b.mbl,e.mbl=b.mbl,e.mblDc=b.mblDc):(e.lt=3,e.rb=b.email,e.el=b.email.utf8Encode());break;case"resetPassword":e.actn=H.PASSWORD_RECOVER,e.uId=b.uId,e.nPw=b.password,e.wk=d.getUniqueID(),e.lt=1;break;case"isValidSession":e.actn=H.TYPE_SESSION_VALIDATION,e.dvcc=5,e.utId=O,e.did=P;break;case"logout":e.actn=H.TYPE_SIGN_OUT;break;case"validSocialId":var f="facebook"===b.platform?g.signupSocialInit+"fb="+b.id+"&lt=4":g.signupSocialInit+"twtr="+b.id+"&lt=5";e=f+"&time="+(new Date).getTime();break;case"signupSendCode":e.wk=d.getUniqueID(),e.uId=b.uId,e.did=b.did,e.lt=1,"email"===b.authMethod?(e.el=b.email.utf8Encode(),e.actn=H.SIGNUP_SEND_CODE_EMAIL):(e.actn=H.SIGNUP_SEND_CODE_PHONE,e.mbl=b.mbl,e.mblDc=b.mblDc);break;case"signupVerifyCode":e.wk=d.getUniqueID(),e.uId=b.uId,e.did=b.did,e.lt=1,"email"===b.authMethod?(e.actn=H.SIGNUP_SEND_CODE_EMAIL,e.el=b.email.utf8Encode(),e.evc=b.vc):(e.actn=H.SIGNUP_SEND_CODE_PHONE,e.mbl=b.mbl,e.mblDc=b.mblDc,e.vc=b.vc);break;case"signup":switch(e.actn=H.SIGNUP_REGISTER,e.wk=d.getUniqueID(),e.uId=b.uId,e.did=b.did,e.nm=b.name.utf8Encode(),e.usrPw=b.password,e.lt=1,e.ispc=0,e.mbl=b.mbl,e.mblDc=b.mblDc,b.authMethod){case"email":e.el=b.email.utf8Encode(),e.evc=b.vc;break;case"facebook":e.fb=b.id,e.it=b.access_token,e.lt=4;break;case"twitter":e.twtr=b.id,e.it=b.access_token,e.lt=5;break;default:e.mbl=b.mbl,e.mblDc=b.mblDc,e.vc=b.vc}break;case"login":if(b.hasOwnProperty("silent")&&b.silent===!0)return e.actn=H.TYPE_SIGN_IN,e.vsn=g.apiVersion,e.wk=d.getUniqueID(),e.dvc=5,e.tbid=d.tabId,e;switch(e.actn=H.TYPE_SIGN_IN,e.vsn=g.apiVersion,e.usrPw=b.password,e.lt=1,e.sn=g.apiVersion,e.wk=d.getUniqueID(),e.dvc=5,e.tbid=d.tabId,e.did=b.did,b.authMethod){case"ringid":e.lt=1,e.uId=b.silent?b.ringid:"21"+b.ringid;break;case"email":e.lt=3,e.el=b.email.utf8Encode();break;case"facebook":e.uId=b.uId,e.pen=1,e.lt=4,e.apt=1,e.smid=b.id,e.it=b.access_token,delete e.usrPw;break;case"twitter":e.uId=b.uId,delete e.usrPw,e.smid=b.id,e.it=b.access_token,e.lt=5;break;default:e.lt=2,e.mbl=b.mbl,e.mblDc=b.mblDc}b.salt&&b.sId&&(e.salt=b.salt,e.sId=b.sId);break;default:e=b}return e}function q(a){return U._currentUser=a,a}function r(a){a&&(U.loginData=a,c.setData("loginData",a))}function s(a,b,d){try{var e={usrPw:b.authEPassword,salt:b.authESalt,sId:b.sId,lt:a.lt};switch(a.lt){case 1:e.uId=b.authEUsername;break;case 2:e.mbl=b.authEUsername,e.mblDc=a.mblDc;break;case 3:e.el=b.authEUsername}c.setData("remInfo",e);var f=c.getCookie("sessionID");c.setCookie("sessionID",f,d)}catch(g){}}function t(a,b){var c=e.defer();return f.get(g.signupInit+"did="+P+"&time="+(new Date).getTime()).success(function(d){d.success===!0?(S({uId:d.ringID,authServer:d.authServerIP,comPort:d.comPort}),a=angular.extend(a,{uId:d.ringID,did:P}),b?c.resolve(a):m.request(p("signupSendCode",a),I.AUTHENTICATION).then(function(a){c.resolve(angular.extend(a,{uId:d.ringID}))},function(a){c.reject(a)})):c.reject(d)}).error(function(){c.reject()}),c.promise}function u(a,b){G=!0,a.did=P,m.request(p("login",a),I.AUTHENTICATION).then(function(d){G=!1,d.sucs===!0?(U._validSession=!0,a.remember?(s(a,d,30),c.setData("remember",!0)):(c.deleteData("remInfo"),c.deleteData("remember")),a.authMethod&&c.setData("activeTab",a.authMethod),B(d,!0),b.resolve(d)):(U._validSession=!1,b.reject(d))},function(c){c.sucs===!1&&1111===c.rc?u(a,b):(U._validSession=!1,G=!1,b.reject({sucs:!1,mg:"Reqeust Failed"}))})}function v(){var a=c.getData("loginData");!a||window.hasOwnProperty("ringLoggedIn")&&!window.ringLoggedIn?A():B(a)}function w(a){switch(a.actn){case H.TYPE_MULTIPLE_SESSION:G||k.alert({title:"Signed Out!",message:"You are signed in from another device",showCancel:!1,okCallback:function(){A(!0)}});break;case H.TYPE_INVALID_LOGIN_SESSION:G||(D=!0,U.loginFromLocalData());break;case H.TYPE_SESSION_VALIDATION:G||(E=!0,U.isLoggedIn()?A(!0):U.loginFromLocalData())}}function x(){return m.request({actn:H.PHN_MAIL_VERIFICATION_CHECK},I.REQUEST)}function y(a){setTimeout(function(){f.get(a).success(function(){})},100)}function z(){0===K.length&&l.getList().success(function(a){K=a;var b=c.getData("country");b&&b.country?(L.code=b.code,L.flagcode=b.flagcode):f.get(g.baseUrl+"/country").success(function(a){if(a&&a.length>0){a=a.toLowerCase();for(var b=0;b<K.length;b++)if(K[b].country.toLowerCase()===a){L.code=K[b].code,L.flagcode=K[b].flagcode,c.setData("country",K[b]);break}}})})}function A(d){q(null),F=!1,U.clearCookies(!0),c.reset(),j.closeAll(),n.close(),d?T(1):(z(),b.$broadcast(a.AUTH.LOGIN,!1))}function B(d,e){U.loginData=d,S(d,e?30:!1),q(i.create(d,!0,!0)),c.init(d),setTimeout(function(){V.forEach(y)},2e3),m.resume(),m.keepAlive(),F=!1,b.$broadcast(a.AUTH.LOGIN,!0),setTimeout(function(){x().then(function(c){F=!1,c.sucs===!0?(U._validSession=!0,J=c,b.$broadcast(a.AUTH.LOGIN,!0)):(U._validSession=!1,U.loginFromLocalData())},function(){F=!1,U.loginFromLocalData()})})}var C=c.getCookie("sessionID"),D=!1,E=!1,F=!0,G=!1,H=h.SYSTEM.AUTH,I=h.SYSTEM.REQUEST_TYPE,J={},K=[],L={code:"+880",flagcode:"b880"},M=c.getCookie("sId"),N=c.getCookie("uId"),O=c.getCookie("utId"),P=d.generateUUID();b.$on("ringActive",function(){Cookies.get("sessionID")!==C&&window.location.reload()});var Q=function(a){document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},R=function(a){Q("uId"),Q("utId"),Q("sId"),Q("authServer"),Q("comPort"),Q("la"),Q("col"),a||(Q("sessionID"),C=void 0),Q("la")},S=function(a,b){c.setCookie("uId",a.uId||"",b),c.setCookie("sId",a.sId||"",b),c.setCookie("utId",a.utId||"",b),b&&c.setCookie("la",(new Date).getTime(),b),a.authServer&&c.setCookie("authServer",a.authServer||"",b),a.comPort&&c.setCookie("comPort",a.comPort||"",b)},T=function(a,b){a&&(R(),c.reset()),b?setTimeout(function(){window.location="/?rand="+d.getUniqueID()},a):setTimeout(function(){window.location="/"},a)},U={_currentUser:null,_validSession:!1,isPendingAsync:function(){var a,b=e.defer();return F?a=setInterval(function(){F||(clearInterval(a),U._validSession?b.resolve():b.reject())},1e3):b.resolve(),b.promise},isPending:function(){return F},sendCode:t,updateLocalStorageLoginData:r,verifyCode:function(a){return a=angular.extend({},a,{did:P}),m.request(p("signupVerifyCode",a),I.AUTHENTICATION)},signup:function(a){var b=e.defer();return angular.extend(a,{did:P}),m.request(p("signup",a),I.AUTHENTICATION).then(function(a){b.resolve(a)},function(){b.reject()}),b.promise},openSignup:function(a,b){var c=e.defer();return f.get(p("socialData")).success(function(d){d.success===!1&&2===d.rc?(j.open({type:"remote",scope:!1,controller:"SignUpController",resolve:{localData:{socialData:a,credentials:b},remoteData:angular.noop},templateUrl:"pages/welcome/ring-signup-popup.html"}),c.resolve()):c.reject({rc:"dologin",mg:"Already Registered Social ID"})}).error(function(){c.reject({rc:0,mg:"Request Failed"})}),c.promise},login:function(a,b){var d=e.defer();if(b)angular.extend(a,{did:P}),f.get(p("validSocialId",a)).success(function(b){b.success===!0||"true"===b.success?(S({uId:b.ringID,authServer:b.authServerIP,comPort:b.comPort}),a.uId=b.ringID,a.authMethod=a.platform,u(a,d)):d.reject({rc:"invalidsocialid",mg:"Unregistered Social ID. Please Register."})}).error(function(){d.reject({rc:0,mg:"Request Failed"})});else{switch(a.authMethod){case"email":c.setData("autoFill",a.email);break;case"ringid":c.setData("autoFill",a.ringid);break;case"phone":c.setData("autoFill",a.mbl)}u(a,d)}return d.promise},logout:function(c){U.isLoggedIn()&&(b.$broadcast(a.LOADING,!0),m.request(p("logout"),I.AUTHENTICATION).then(function(c){b.$broadcast(a.LOADING,!1),A(!0)})),setTimeout(function(){A(!0)},1e3),m.stop()},clearCookies:function(a){R(a)},loginFromLocalData:function(){var a=c.getData("remInfo");if(!G&&a&&(a.uId||a.el||a.mbl)){var b={remember:!0,silent:!0};angular.extend(b,a),U.login(b).then(function(a){a.sucs?B(a):A()},function(){A()})}else A()},currentUser:function(){return U._currentUser},isLoggedIn:function(){return!!U._currentUser&&!!c.getCookie("sId")&&!!c.getCookie("sessionID")},isValidSession:function(){var a=e.defer();return O&&M&&N?m.request(p("isValidSession")).then(function(b){b.sucs?(U._validSession=!0,a.resolve(b)):(U._validSession=!1,a.reject(b))},function(){a.reject(U._validSession)}):a.reject(U._validSession),a.promise},reloadHome:T,getCountry:function(){var a=c.getData("country");return a&&a.country&&(L.code=a.code,L.flagcode=a.flagcode),L},getCountryList:function(){return K},getPermission:function(){return J},setAchatPermission:function(a){J.ancht=a},setAinfndreqPermission:function(a){J.aifr=a},setAfamPermission:function(a){J.afam=a},setAafPermission:function(a){J.aaf=a},ensureLoginState:v,handleInvalidSession:w,fetchPrivacy:x,recoverySendCode:function(a,b){return m.request(p("recoverySendCode",a,b),I.AUTHENTICATION)},recoveryVerifyCode:function(a){return m.request(p("recoveryVerifyCode",a),I.AUTHENTICATION)},resetPassword:function(a){return m.request(p("resetPassword",a),I.AUTHENTICATION)}},V=["/pages/dropdowns/notification-dropdown.html","/pages/dropdowns/friend-request-dropdown.html","/pages/partials/emoticon-window.html","/pages/dropdowns/circle-list-dropdown.html","/pages/dropdowns/search-dropdown.html","/pages/partials/hovercards/profile-hover.html","/pages/partials/notification/image-popup.html","/pages/partials/notification/media-popup.html","/pages/partials/notification/feed-popup_with_image.html","/pages/partials/stickers/popups/sticker-market.html"];return U}angular.module("ringid.global.services").factory("Auth",a),a.$inject=["SystemEvents","$rootScope","Storage","utilsFactory","$q","$ringhttp","settings","OPERATION_TYPES","userFactory","$ringbox","Ringalert","countryListService","$$connector","rgDropdownService","$ocLazyLoad"]}(),function(){"use strict";angular.module("ringid.global.services").factory("chatHistoryFactory",["Storage","Auth","userFactory","CHAT_GENERAL_CONSTANTS","CHAT_GENERAL_INFOS","SystemEvents","utilsFactory",function(a,b,c,d,e,f,g){var h={},i={},j={},k=0,l=function(){h=a.getData("chatOpenedBoxes")||{},i=a.getData("chatBoxes")||{}},m=function(){var b=a.getData("unreadMessageIds");k=0,b?Object.keys(b).forEach(function(a,c){j[a]={},b[a].forEach(function(b,c){j[a][b]=!0,k++})}):j={}},n=function(b){b!==!1&&(b=!0);var c={};Object.keys(j).forEach(function(a,b){c[a]=Object.keys(j[a])}),a.setData("unreadMessageIds",c,b),g.triggerCustomEvent(f.CHAT.UNREAD_MESSAGE_INFO_UPDATED)},o=function(){h={},i={},s(!1),t(!1),n(!1),q(e,!1)},p=function(){var b=a.getData("cgInf");b&&b.version&&b.version==e.version||o(),b?angular.extend(e,b):q()},q=function(b,c){c!==!1&&(c=!0),b&&angular.extend(e,b),a.setData("cgInf",e,c)},r=function(a){a.user||(a.user=c.create(a.user));var b={key:a.key,packetId:a.packetId||a.key,packetType:a.packetType||6,brokenPacketType:a.brokenPacketType||8,platform:a.platform||5,text:a.text||a.message||a.mg,hrtime:a.hrtime,status:a.status||0,seenSent:a.seenSent||!1,messageDate:a.messageDate,isDeleted:a.isDeleted,latitude:a.latitude,longitude:a.longitude,messageDateString:a.messageDateString||"",timeout:a.timeout,messageType:a.messageType,tag_chat:a.tag_chat,isSecretVisible:a.isSecretVisible,secretTimedOut:a.secretTimedOut?a.secretTimedOut:!1,user:a.user.getKey()};return a.usersToChange&&(b.usersToChange=a.usersToChange),a.statusType&&(b.statusType=a.statusType),b},s=function(b){b!==!1&&(b=!0),a.setData("chatBoxes",i,b)},t=function(b){b!==!1&&(b=!0),a.setData("chatOpenedBoxes",h,b)},u=function(a,b){h||(h={}),h[a]||(h[a]={boxId:a,isTagChat:b}),t()},v=function(a,b){if(i[a]){var c=i[a].messages;if(c)for(var d=0,e=c.length;e>d;d++)if(c[d].key==b)return c[d]}return!1},w=function(a,b){j[a]||(j[a]={}),j[a][b]||(j[a][b]=!0,k++)},x=function(a,b){j[a]&&j[a][b]&&(delete j[a][b],k--,n())},y=function(a){i[a];if(j[a]){var b=Object.keys(j[a]).length;delete j[a],k-=b,0>k&&(k=0),n()}},z=function(){return j},A=function(){return k},B=function(a){return j[a]?Object.keys(j[a]).length:0},C=function(){p(),l(),m()},D={init:C,loadChatBoxes:l,loadChatGeneralInfo:p,saveChatGeneralInfo:q,updateChatOpenBoxes:t,updateChatBoxes:s,addUnreadMessageInfo:w,removeUnreadMessageInfo:x,updateUnreadMessageInfos:n,getUnreadMessageInfos:z,getUnreadMessageCount:A,getUnreadMessageCountByBoxId:B,removeUnreadMessageInfoByBoxId:y,getMessageByPacketId:v,getChatOpenBoxes:function(){return h},getChatBoxes:function(){return i},addOpenBox:u,removeOpenBox:function(a){h[a]&&delete h[a],t()},countOpenBoxes:function(){return h?Object.keys(h).length:0},getAllOpenBoxes:function(){return h&&Object.keys(h).length>0?h:!1},addBox:function(a){u(a.key,a.isTagChat);var a={key:a.key,ip:a.ip,rPort:a.rPort,closedBox:a.closedBox,isMinimized:a.isMinimized,isHidden:a.isHidden,isFocused:a.isFocused,blinkOn:a.blinkOn,timeout:a.timeout,secretChat:a.secretChat,nonDomBox:a.nonDomBox,offlineStatus:a.offlineStatus,isTagChat:a.isTagChat,chatBoxClass:a.chatBoxClass,unreadCount:a.unreadCount,isSecretVisible:a.isSecretVisible,blocked:a.blocked,messages:[]};i||(i={}),i[a.key]||(i[a.key]=a),s()},updateBox:function(a){var a={key:a.key,ip:a.ip,rPort:a.rPort,closedBox:a.closedBox,isMinimized:a.isMinimized,isHidden:a.isHidden,isFocused:a.isFocused,blinkOn:a.blinkOn,timeout:a.timeout,secretChat:a.secretChat,nonDomBox:a.nonDomBox,offlineStatus:a.offlineStatus,isTagChat:a.isTagChat,isSecretVisible:a.isSecretVisible,blocked:a.blocked,chatBoxClass:a.chatBoxClass,unreadCount:a.unreadCount};i||(i={}),i[a.key]?angular.extend(i[a.key],a):i[a.key]=a,s()},getBox:function(a){return i[a]?i[a]:!1},addMessage:function(a,b){if(i[b]){a.user&&a.user.getKey||(a.user=c.create(a.user));var e={key:a.key||a.packetId,packetId:a.packetId||a.key,packetType:a.packetType||6,brokenPacketType:a.brokenPacketType||8,platform:a.platform||5,text:a.text||a.message||a.mg,hrtime:a.hrtime||"",status:a.status||0,fullName:a.fullName||"",tagName:a.tagName||"",messageDate:a.messageDate,seenSent:a.seenSent||!1,isDeleted:a.isDeleted||!1,messageDateString:a.messageDateString||"",timeout:a.timeout||0,messageType:a.messageType,tag_chat:a.tag_chat,isSecretVisible:a.isSecretVisible,secretTimedOut:a.secretTimedOut?a.secretTimedOut:!1,user:a.user.getKey(),userId:a.user.getKey()};!a.user,a.statusType&&(e.statusType=a.statusType),a.usersToChange&&(e.usersToChange=a.usersToChange),i[b].messages||(i[b].messages=[]);var f=0;try{for(var g=0;g<i[b].messages.length;g++)if(i[b].messages[g].key===e.key){f=1;break}}catch(h){}if(0===f){if(D.countMessage(b)>=d.HISTORY_MAX_MESSAGE){i[b].messages.shift()}i[b].messages.push(e)}}s()},removeMessage:function(a,b){var c=!1;if(i&&i[b])for(var d=0;d<i[b].messages.length;d++)i[b].messages[d].key===a&&(i[b].messages.splice(d,1),c=!0);c&&s()},updateMessage:function(a,d){b.loginData.uId;if(i[d]){angular.isObject(a.user)||(a.user=c.create(a.user));var e={key:a.key,packetId:a.packetId||a.key,packetType:a.packetType||6,brokenPacketType:a.brokenPacketType||8,platform:a.platform||5,text:a.text||a.message||a.mg,hrtime:a.hrtime,status:a.status||0,seenSent:a.seenSent||!1,messageDate:a.messageDate,isDeleted:a.isDeleted,latitude:a.latitude,longitude:a.longitude,messageDateString:a.messageDateString||"",timeout:a.timeout,messageType:a.messageType,isSecretVisible:a.isSecretVisible,tag_chat:a.tag_chat,secretTimedOut:a.secretTimedOut?a.secretTimedOut:!1,user:a.user.getKey()};a.usersToChange&&(e.usersToChange=a.usersToChange),a.statusType&&(e.statusType=a.statusType);for(var f=0;f<i[d].messages.length;f++)if(i[d].messages[f].key==e.key){i[d].messages[f]=e;break}}s()},updateMessages:function(a,b){if(a.length){for(var c={},d=0,e=a.length;e>d;d++)c[a[d].key]=a[d];if(i)for(var f=i[b],g=0;g<f.messages.length;g++){var h=f.messages[g],j=c[h.key];j&&(f.messages[g]=r(j))}s()}},isInLocalStorageChatMsgMap:function(a,b){try{return!!i[a][b]}catch(c){return!1}},countMessage:function(a){b.loginData.uId;if(i[a]){var c=i[a];return c.messages?c.messages.length:0}return!1},getMessages:function(a){if(i[a]){var b=i[a];return b.messages}return[]},getMessage:function(a,b){if(i[a]&&i[a].messages)for(var c=0;c<i[a].messages.length;c++)if(i[a].messages[c].key==b)return i[a].messages[c];return!1}};return D}])}(),function(){"use strict";function a(){function a(a){function e(){if(i("contacts")||h("contacts",{}),i("chatOpenedBoxes")||h("chatOpenedBoxes",{}),i("chatBoxes")||h("chatBoxes",{}),i("unreadMessageIds")||h("unreadMessageIds",[]),i("mediaRecent")||h("mediaRecent",[]),i("notiseen")||h("notiseen",[]),i("oldNotiCount")||h("oldNotiCount",0),i("uLocationInfo")||h("uLocationInfo",{}),d){for(var a=[],e=0,f=c.length;f>e;++e)g=c.key(e).match(/(\d+)-([a-z]+)/i),g&&g.length>1&&g[1]!=b&&a.push(c.key(e));a.forEach(function(a){j(a)})}}var g;a?(a=angular.fromJson(a),f(a.utId),h("loginData",a),e()):Cookies.get("utId")&&(f(Cookies.get("utId")),e())}var b,c,d=!1,e=function(a){try{var b=window[a],c="__storage_test__";return b.setItem(c,c),b.removeItem(c),d=!0,window[a]}catch(e){return d=!1,{}}};c=e("localStorage");var f=function(a){b=a,angular.isDefined(c[b])&&h(b,{})},g=function(a){switch(a){case"loginData":case"country":case"remInfo":case"stickerData":break;case"chatOpenedBoxes":case"chatBoxes":case"cgInf":case"cts":case"unreadMessageIds":case"uLocationInfo":case"mood":case"utIds":case"incomingUtIds":case"outgoingUtIds":case"suggestionUtIds":case"contacts":case"notikeys":case"notiseen":case"oldNotiCount":case"mediaRecent":case"albumname":case"circledata":case"circleut":case"myStickers":a=b+"-"+a}return a},h=function(a,b){a=g(a),d?c.setItem(a,angular.toJson(b)):c[a]=angular.toJson(b)},i=function(a){return a=g(a),d?angular.fromJson(c.getItem(a)):angular.fromJson(c[a])},j=function(a){a=g(a),d?c.removeItem(a):delete c[a]},k=function(a,b){setTimeout(function(){h(a,b)},200)};return a(i("loginData")),{init:function(b){a(b)},reset:function(){j("loginData"),j("remInfo"),j("contacts"),j("chatOpenedBoxes"),j("suggestionUtIds")},setData:function(a,b,c){c?k(a,b):h(a,b)},getData:function(a){return i(a)},deleteData:function(a){j(a)},setContact:function(a,b){if(a){var c=i("contacts")||{};c.hasOwnProperty(a)?c[a]=angular.extend({},c[a],b):c[a]=b,h("contacts",c)}},getContact:function(a){var b=i.contacts;return b&&b[a]?b[a]:null},updateLoginData:function(a,b){var c=i("loginData");c[a]=b,h("loginData",c)},setCookie:function(a,b,c){c?Cookies.set(a,b,{expires:c}):Cookies.set(a,b)},getCookie:function(a){return Cookies.get(a)},removeCookie:function(a){return Cookies.remove(a)}}}angular.module("ringid.global.services").factory("Storage",a),a.$inject=[]}(),angular.module("ringid.global.services").provider("$ringbox",function(){var a={boxes:[],boxeScopes:[],boxeDeferred:[],template:'<div class="ringbox"><div class="ringbox-overlay"></div><div class="ringbox-outerContainer"><div class="ringbox-content ringbox-invisible"><div class="ringbox-inner"></div><div class="ringbox-loader"><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div></div></div></div>',init:function(){var a=angular.element(this.template);return this.boxes.push(a),a},adjustBoxes:function(){for(var a=0;a<this.boxes.length;a++)this.boxes[a].removeClass("rl_"+a);for(var a=0;a<this.boxes.length;a++)this.boxes[a].addClass("rl_"+a)},$get:["$injector","$rootScope","$$q","$templateCache","$controller","$compile","$document","$player","$ringhttp","$sniffer","Notification","SystemEvents","utilsFactory",function(b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){if(a.template)return d.when(a.template);var b=angular.isFunction(a.templateUrl)?a.templateUrl():a.templateUrl;if(e.get(b))return d.when(e.get(b));var c=d.defer();return j.get(b).success(function(a){e.put(b,a),c.resolve(a)}).error(function(){c.reject()}),c.promise}function p(a){var c=[];return angular.forEach(a,function(a){angular.isDefined(a.promise)?c.push(a.promise):angular.isFunction(a)?c.push(d.when(b.invoke(a))):(angular.isArray(a)||angular.isObject(a))&&c.push(a)}),c}var q={},r=this,s=k.vendorPrefix.toLowerCase();q.minimizedBox={dom:null,scope:null,deferred:null},q.clear=function(a,b,c){0==r.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened","").trim()),a&&a.$destroy(),b&&b.resolve.apply(null,c),i.miniPlayer.player||0!=r.boxes.length||i.destroyAll()},q.close=function(a){a&&a.stopPropagation&&a.stopPropagation(),r.boxes.length>0&&(r.boxes.pop().remove(),q.clear(r.boxeScopes.pop(),r.boxeDeferred.pop(),arguments))},q.closeAll=function(){for(var a=r.boxes.length-1;a>=0;a--)r.boxes.pop().remove(),q.clear(r.boxeScopes.pop(),r.boxeDeferred.pop(),arguments)};var t=function(){q.minimizedBox.dom[0].style.display="none",i.showMiniPlayer(),0==r.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened",""))};return q.removeMinimize=function(){q.minimizedBox.dom&&q.minimizedBox.dom.remove(),q.minimizedBox.scope&&q.minimizedBox.scope.$destroy()},q.minimize=function(){if(r.boxes.length>0){q.minimizedBox.dom=r.boxes.pop(),q.minimizedBox.scope=r.boxeScopes.pop(),q.minimizedBox.deferred=r.boxeDeferred.pop();var a=q.minimizedBox.dom[0].querySelector(".ringbox-content"),b=a.offsetLeft+(a.offsetWidth-335)/2-200,c=window.innerHeight-(a.offsetTop+(a.offsetHeight-150)/2)-120,d="translate(-"+b+"px,"+c+"px) scale(0.35,0.24)";q.minimizedBox.dom[0].querySelector(".pv-profile").style.display="none",a.style.webkitTransition="transform 0.5s",a.style.MozTransition="transform 0.5s",a.style.msTransition="transform 0.5s",a.style.OTransition="transform 0.5s",a.style.transition="transform 0.5s",a.style.webkitTransform=d,a.style.MozTransform=d,a.style.msTransform=d,a.style.OTransform=d,a.style.transform=d,a.addEventListener(s+"TransitionEnd",t),a.addEventListener("transitionend",t)}},q.maximize=function(a,b){if(q.minimizedBox.dom){var c=q.minimizedBox.dom[0].querySelector(".ringbox-content");q.minimizedBox.dom[0].querySelector("div.ringbox-overlay");q.minimizedBox.dom[0].querySelector(".pv-profile").style.display="block",q.minimizedBox.dom[0].style.display="table",a.appendChild(b),c.style.webkitTransform="initial",c.style.MozTransform="initial",c.style.msTransform="initial",c.style.OTransform="initial",c.style.transform="initial",r.boxes.push(q.minimizedBox.dom),r.boxeScopes.push(q.minimizedBox.scope),r.boxeDeferred.push(q.minimizedBox.deferred),1==r.boxes.length&&(document.body.className=document.body.className.trim()+" ringbox-opened"),q.minimizedBox={dom:null,scope:null,deferred:null},c.removeEventListener(s+"TransitionEnd",t),c.removeEventListener("transitionend",t)}},q.open=function(b){var e=d.defer(),j=d.defer(),k=!1,s=!1,t=r.init(),u=angular.element(t[0].querySelector("div.ringbox-content")),v=angular.element(u[0].querySelector("div.ringbox-loader")),w=angular.element(u[0].querySelector("div.ringbox-inner")),x=angular.element(t[0].querySelector("div.ringbox-overlay"));u.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"}),b.animation&&u.addClass("animation"),r.adjustBoxes(),b=angular.extend({},b);var y=(b.scope||c).$new();y.boxIsLoading=!0,angular.forEach(a.options,function(a,c){y[c]=b[c]}),angular.isObject(b.scopeData)&&angular.forEach(b.scopeData,function(a,c){y[c]=b.scopeData[c]}),r.boxeScopes.push(y),r.boxeDeferred.push(e);var z=function(){u.addClass("ringbox-invisible"),v.css({display:"block"}),w.css({display:"none"}),u.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"})},A=function(){setTimeout(function(){v.css({display:"none"}),w.css({display:"inline-block"}),C(),u.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),u.removeClass("ringbox-invisible")},300)},B=function(){document.body.appendChild(t[0]),document.body.className=document.body.className.replace("ringbox-opened",""),document.body.className=document.body.className.trim()+" ringbox-opened",s=!1};b.templateUrl&&(b.templateUrl.indexOf("image-popup.html")||b.templateUrl.indexOf("media-popup.html"))?s=setTimeout(B,200):B(),y.$on(m.FEED.HEIGHT,function(a,b){C(!0)});var C=function(a){if((!a||"none"==v.css("display"))&&u&&b.scrollable){var c,d=w[0].offsetHeight;c=Math.max(n.viewport.y/2-d/2,40),u.css({"margin-top":c+"px"}),d>n.viewport.y?x.css({right:n.scrollbarWidth+"px"}):x.css({right:"0px"})}};if(!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var D=d.all([o(b)].concat(p(b.resolve))),E={result:e.promise,opened:j.promise,close:q.close,closeAll:q.closeAll,showLoader:z,hideLoader:A,adjustHeight:C};return D.then(function(a){if(y.boxIsLoading=!1,y.$close=q.close,w){k&&clearTimeout(k);var c,d={},e=1;if(b.controller){d.$scope=y,d.$boxInstance=E;for(var h in b.resolve)b.resolve.hasOwnProperty(h)&&(d[h]=a[e++]);c=f(b.controller,d),b.controllerAs&&(y[b.controllerAs]=c)}w.html(a[0]),g(w.contents())(y),s&&(clearTimeout(s),v.css({display:"none"}),u.removeClass("ringbox-invisible"),B()),u.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),A(),y.$parent.$rgDigest()}},function(a){e.reject(a),q.close()}),D.then(function(){j.resolve(!0)},function(){j.reject(!1)}),b.scrollable&&(t.addClass("scrollable"),C()),b.onBackDropClickClose&&(x.on("click",function F(a){x.off("click",F),q.close(a)}),b.scrollable&&t[0].addEventListener("click",function G(a){a.stopPropagation(),-1!=a.target.className.indexOf("ringbox-outerContainer")&&(t[0].removeEventListener("click",G),q.close())},!1)),b.onEscape&&h.bind("keyup",function H(a){var b=a.which||a.keyCode||a.key;if(32!=b&&a.stopImmediatePropagation(),27==b){if(i.escapeKey)return void(i.escapeKey=!1);h.unbind("keyup",H),q.close()}return!1}),b.scrollable&&t.bind("scroll",function(a){t[0].scrollHeight-(t[0].offsetHeight+t[0].scrollTop)<100&&(angular.isFunction(y.onScroll)&&y.onScroll(),angular.isFunction(y.loadMore)&&y.loadMore())}),y.$on("$destroy",function(){t=null,u=null,v=null,w=null,E=null,b=null,x=null,D=null}),k=setTimeout(function(){y&&y.boxIsLoading&&(l.error({message:"Something went wrong! Please try again."}),q.close())},2e4),E},q}]};return a}).directive("rgRingbox",["$ringbox",function(a){return{restrict:"EA",scope:{ringboxData:"&",scopeData:"&",onRingBoxOpen:"&",onRingBoxClose:"&",onScroll:"&",ringboxFalsyFunc:"&",ringboxOpen:"&"},link:function(b,c,d){function e(e){e.preventDefault();var f,g,h={},i={};f=d.ringboxType,f||(f="html"),d.ringboxData&&(h=angular.isFunction(b.ringboxData)?b.ringboxData():b.ringboxData),d.scopeData&&(i=angular.isFunction(b.scopeData)?b.scopeData():b.scopeData);var j=h.data?h.data:h,k={type:f,scrollable:d.ringboxScrollable&&("true"==d.ringboxScrollable||1==d.ringboxScrollable),scope:d.ringboxScope?b:!1,scopeData:i||{},controller:d.ringboxController||"",resolve:{localData:j,remoteData:h.promise?h:angular.noop},onBackDropClickClose:!d.ringBackdropClose||"false"!=d.ringBackdropClose&&0!=d.ringBackdropClose,animation:!d.ringboxAnimation||"false"!=d.ringboxAnimation&&0!=d.ringboxAnimation,onEscape:!d.ringCloseEscape||"false"!=d.ringCloseEscape&&0!=d.ringCloseEscape};if("remote"===f)k.templateUrl=d.ringboxTarget||b.ringboxTarget||d.href||d.src;else if("video"===f);else if("inline"===f)k.template=d.ringboxTarget||b.ringboxTarget;else if(f="html",g=d.ringboxTarget||b.ringboxTarget){if(k.template=angular.element(document.querySelector(g)),!(k.template.length>0))throw new Error("Opps ! Your Provideed Target element Does Not Exist!");k.template=k.template[0].outerHTML}else k.template=c.html();var l=a.open(k);l.result.then(function(a){angular.isDefined(b.onRingBoxClose)&&angular.isFunction(b.onRingBoxClose)&&b.onRingBoxClose()}),l.opened.then(function(){angular.isDefined(b.onRingBoxOpen)&&angular.isFunction(b.onRingBoxOpen)&&b.onRingBoxOpen()})}function f(a){c.on("click",a),h=b.$on("$destroy",function(){c.off("click",a)})}function g(a){a.preventDefault(),a.stopPropagation(),angular.isFunction(b.ringboxFalsyFunc)&&b.ringboxFalsyFunc()}var h;d.ringboxOpen?b.$watch("ringboxOpen()",function(a){h&&(c.off("click",e),c.off("click",g),h()),f(a?e:g)}):f(""===d.rgRingbox||"true"===d.rgRingbox||d.rgRingbox===!0?e:g)}}}]),function(){"use strict";angular.module("ringid.global.directives",["ringid.common.factories","ringid.global.services","ringid.config"])}(),function(){"use strict";function a(){return function(a,b,c){angular.isFunction(c.rgConditionalClick)&&(b.bind("click",function(a){c.rgConditionalClick()}),a.$on("$destroy",function(){b.unbind("click")}))}}function b(a){return{restrict:"A",link:function(b,c,d){function e(a){f(b,{$event:a}),b.$rgDigest()}var f=a(d.rgClick);d.rgClickNoapply;c.bind("click",e),b.$on("$destroy",function(){c.unbind("click",e)})}}}function c(){return{restrict:"A",transclude:!0,link:function(a,b,c){b.on("load",function(){})}}}angular.module("ringid.global.directives").directive("rgImgLoad",c).directive("rgClick",b).directive("rgConditionalClick",a),a.$inject=[],
b.$inject=["$parse"]}(),function(){"use strict";function a(){function a(a,b,c){function d(c){var d;fastdom.read(function(){v&&(s=b[0].scrollHeight-b[0].offsetHeight,t=b[0].offsetHeight-u,d=c/t,c=Math.min(Math.max(c,0),t),fastdom.write(function(){b[0].scrollTop=s*d,w[0].style.top=c+"px"}),c==t&&angular.isFunction(a.bottomReached)&&a.bottomReached())})}function e(){var a,c,d;fastdom.read(function(){b&&(d=b[0].scrollHeight,r=b[0].offsetHeight,q=d,s=q-r,t=r-u,u=Math.max(r/q*r,k.minThumbHeight),a=t/s,c=b[0].scrollTop*a,(isNaN(u)||"Infinity"==u)&&(u=0),o=u>=r?"none":"block",fastdom.write(function(){v[0]&&(v[0].style.display=o,w[0].style.height=u+"px",w[0].style.display=o,w[0].style.top=c+"px")}))})}function f(){k.scrollbarAlways||m||(v.css("opacity",0),w.css("opacity",0),n=!1)}function g(){e(),n=!0,v.css("opacity",1),w.css("opacity",1)}function h(a){if("none"!=o){a.preventDefault(),n||g();var b=parseFloat(w.css("top")),c=a.wheelDelta?-1/40*a.wheelDelta:3*a.detail,e=Math.max(parseInt(2*r/q*k.dragSpeedModifier),1),f=b+c*e;d(f)}}function i(a){a.preventDefault(),a.stopPropagation(),n||g(),m=!0;var b=a.pageY,c=parseFloat(w.css("top"));x.on("mousemove",function(a){var e=c+a.pageY-b;d(e)}),x.on("mouseup",function(a){a.stopPropagation(),m=!1,x.off("mousemove"),x.off("mouseup")})}function j(a){a.preventDefault();var b=a.touches[0].clientY,c=parseFloat(w.css("top")),e=2,f=Math.max(parseInt(2*r/q*k.dragSpeedModifier),1),g=p>b?c+e*f:c-e*f;d(g),p=b}var k={scrollbarWidth:8,scrollbarAlways:!1,dragSpeedModifier:5,minThumbHeight:10};if(c.thumbHeight&&parseInt(c.thumbHeight)>0&&(k.minThumbHeight=parseInt(c.thumbHeight)),"true"!=c.disabled&&1!=c.disabled){var l=null,m=!1,n=!1,o="none",p=0,q=0,r=0,s=0,t=0,u=0,v=angular.element(document.createElement("div")),w=angular.element(document.createElement("div")),x=angular.element(document);b.wrap('<div class="ringscroll" style="position:relative;width:auto;overflow:hidden;height:100%;"></div>'),b.css({overflow:"hidden"}),l=b.parent(),l.append(v[0]),l.append(w[0]),v.addClass("scrollbar"),w.addClass("thumb"),fastdom.write(function(){v&&(v[0].style.width=k.scrollbarWidth+"px",v[0].style.height="100%",v[0].style.right="1px",v[0].style.top="px",v[0].style.position="absolute",v[0].style.zIndex=1,w[0].style.width=k.scrollbarWidth+"px",w[0].style.right="1px",w[0].style.top="px",w[0].style.position="absolute",w[0].style.zIndex=1)});var y="undefined"!=typeof InstallTrigger?"DOMMouseScroll":"mousewheel";b.on(y,h),w.on("mousedown",i);var z="ontouchstart"in window||navigator.msMaxTouchPoints;z&&b.on("touchmove",j),l.on("mouseenter",g),l.on("mouseleave",f),a.$on("scrollTop",function(a){a.stopPropagation&&a.stopPropagation(),setTimeout(function(){d(0)},100)}),a.$on("scrollTo",function(a,c,e){switch(a.stopPropagation&&a.stopPropagation(),typeof c){case"string":var f=b[0].querySelector(c);if(c=0,f){var g=e&&"bottom"==e?f.offsetHeight:0;c=parseInt(100*(f.offsetTop+g)/q)}break;case"number":c=parseInt(c);break;default:c=parseInt(c)}var h=c*t/100;setTimeout(function(){d(h)},10)}),a.$on("recalculate",function(a){a.stopPropagation&&a.stopPropagation(),e()}),a.$on("hasScroll",function(a,b){a.stopPropagation&&a.stopPropagation(),b.scroll="none"!=o}),a.$on("$destroy",function(){b.off(y,h),b.off("touchmove",j),w.off("mousedown",i),l.off("mouseenter",g),l.off("mouseleave",f),l=null,v=null,w=null})}}return{restrict:"A",scope:{bottomReached:"&"},link:a}}function b(){return{scrollTop:function(a){a.$broadcast("scrollTop")},scrollTo:function(a,b,c){a.$broadcast("scrollTo",b,c)},recalculate:function(a){a.$broadcast("recalculate")},hasScroll:function(a){a.$broadcast("hasScroll",a)}}}angular.module("ringid.global.directives").directive("rgScrollbar",a).factory("rgScrollbarService",b)}(),function(){"use strict";function a(a){function b(){e&&angular.isFunction(e.ddBeforeClose)&&e.ddBeforeClose(),f(),a.unbindHandler("document","click",d.close)}function c(){e.ddOpened(),a.bindHandler("document","click",d.close)}var d=this,e=!1,f=!1;d.open=function(a,d){f&&b(),f=a,e=d,c()},d.close=function(a){a&&(a.preventDefault(),a.stopPropagation()),f&&b(),f=!1,e=!1}}function b(a,b,c,d,e,f,g){function h(b,f){function g(a){a.stopPropagation()}function h(a){p?d.close():(l(a),d.open(m,b)),g(a)}function i(a){setTimeout(function(){q||h(a)},500)}function j(a){q=!0,f.off("mouseleave",i)}function k(a){q=!1,i(a),f.on("mouseleave",i)}function l(a){p=!0,n=c(o)(b),b.ddControl&&b.ddControl.hasOwnProperty("append")&&!b.ddControl.append?f.after(n):f.append(n);for(var d=0;d<n.length;d++)n[d].addEventListener("click",g);b.ddControl&&b.ddControl.showOnHover&&(f[0].addEventListener("mouseleave",i),n[n.length-1].addEventListener("mouseenter",j),n[n.length-1].addEventListener("mouseleave",k)),b.$rgDigest()}function m(){var a;for(p=!1,a=0;a<n.length;a++)n[a].removeEventListener("click",g);for(b.ddControl&&b.ddControl.showOnHover&&(f[0].removeEventListener("mouseleave",i),n[n.length-1].removeEventListener("mouseenter",j),n[n.length-1].removeEventListener("mouseleave",k)),a=0;a<n.length;a++)n[a].parentNode.removeChild(n[a]);b.$parent.$rgDigest()}var n,o,p=!1,q=!1;b.consType=e.get(),f.on("click",h),(b.ddHtml||b.ddTemplate)&&(b.ddTemplate?o=b.ddTemplate:a.get(b.ddHtml).success(function(a){o=a}).error(function(){b.$rgDigest()})),b.$on("$destory",function(){f[0].removeEventListener("click",h),m()})}return{restrict:"AE",link:h,scope:{ddHtml:"=",ddControl:"=",ddTemplate:"=",ddAction:"&",ddOpened:"&",ddBeforeClose:"&"}}}angular.module("ringid.global.directives").service("rgDropdownService",a).directive("rgDropdown",b),a.$inject=["GlobalEvents"],b.$inject=["$ringhttp","settings","$compile","rgDropdownService","languageConstant","utilsFactory","rgScrollbarService"]}(),function(){"use strict";function a(a,b,c,d){var e,f=1e3,g=document.title,h=function(){var a=b.getUnreadMessageCount();return a>0?"("+a+") "+g:g},i=h;return{link:function(){a.$on("ringActive",function(){clearInterval(e),document.title=i()}),a.$on("ringInactive",function(){e=setInterval(function(){var a=h();document.title=document.title===a?g:a},f)}),c.onCustomEvent(d.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){document.title=i()})}}}angular.module("ringid.global.directives").directive("rgPageTitle",a),a.$inject=["$rootScope","chatHistoryFactory","utilsFactory","SystemEvents"]}(),function(a){"use strict";function b(b,e,f){function g(a){var b={drtn:Math.floor(a.duration),tiw:a.videoHeight,tih:a.videoWidth,artst:"",ttl:a.nameFromFile.substr(0,a.nameFromFile.lastIndexOf("."))||a.nameFromFile};window.URL.revokeObjectURL(a.src),a.deferObj.resolve(b)}function h(b){var e,f=new a(b),g={tag:null,value:null},h={id:f.getString(0,3),type:f.getString(0,1),size:f.getUint24(3)};if(!(h.id in c))return!1;if(g.tag=c[h.id],"T"===h.type)e=f.getUint8(7),g.value=f.getString(7,f.byteLength-7);else if("PIC"===h.id){e=f.getUint8(6);var i={type:null,mime:"image/"+f.getString(7,3).toLowerCase(),description:null,data:null};i.type=d[f.getUint8(11)]||"other";for(var j=11,k=0,l=j;;l++)if(0===f.getUint8(l)){k=l-j;break}i.description=0===k?null:f.getString(j,k),g.value=new Blob(new Uint8Array(b.slice(j+1)),{type:i.mime})}return g.tag?g:!1}function i(b,e,f){if(f=f||0,e=e||4,3>e)return h(b);var g,i=new a(b),j={tag:null,value:null},k={id:i.getString(0,4),type:i.getString(0,1),size:i.getSynch(i.getUint32(4)),flags:[i.getUint8(8),i.getUint8(9)]};if(0!==k.flags[0]||!(k.id in c))return!1;if(j.tag=c[k.id],"T"===k.type)if(g=i.getUint8(10),0===g||3===g)j.value=i.getString(11,i.byteLength-11);else if(1===g)j.value=i.getStringUtf16(-11,11,!0);else{if(2!==g)return!1;j.value=i.getStringUtf16(-11,11)}else if("APIC"===k.id){g=i.getUint8(10);for(var l={type:null,mime:null,description:null,data:null},m=11,n=0,o=m;;o++)if(0===i.getUint8(o)){n=o-m;break}l.mime=i.getString(m,n),l.type=d[i.getUint8(m+n+1)]||"other",m+=n+2,n=0;for(var o=m;;o++)if(0===i.getUint8(o)){n=o-m;break}l.description=0===n?null:i.getString(m,n),j.value=new Blob(new Uint8Array(b.slice(m+1)),{type:l.mime})}return j.tag?j:!1}function j(b,c){var d,e,f=new a(b),g={},h=0,j=10,k=f.byteLength-128;if("TAG"===f.getString(k,3)&&(k+=3,c.ttl=f.getString(k,30).trim()||null,k+=30,c.artst=f.getString(k,30).trim()||null),d=f.getUint8(3),e=f.getUint8(5),h+=f.getSynch(f.getUint32(6)),h>f.byteLength||"ID3"!==f.getString(0,3)||d>4||0!==(128&e));else for(0!==(64&e)&&(j+=f.getSynch(f.getUint32(11)));h>j;){for(var l,m,n,o=!0,p=0;3>p;p++)n=f.getUint8(j+p),(65>n||n>90)&&(48>n||n>57)&&(o=!1);if(!o)break;m=3>d?b.slice(j,j+6+f.getUint24(j+3)):b.slice(j,j+10+f.getSynch(f.getUint32(j+4))),l=i(m,d),l&&(g[l.tag]=l.value),j+=m.byteLength}c.ttl=g.title||c.ttl||"",c.artst=g.artist||g["original-artist"]||c.artst||""}function k(){var a=this,b={drtn:Math.floor(a.duration),tiw:0,tih:0,artst:"",ttl:a.nameFromFile.substr(0,a.nameFromFile.lastIndexOf("."))||a.nameFromFile,thmbURL:""},c=new FileReader;c.onload=function(){j(this.result,b),a.deferObj.resolve(b)},c.readAsArrayBuffer(a.fileObj)}function l(a){this.deferObj.reject()}var m=this;m.generateMeta=function(a,c){var d,e=b.defer();return"audio"===c?(d=document.createElement("audio"),d.addEventListener("loadeddata",k),d.fileObj=a):(d=document.createElement("video"),d.addEventListener("loadeddata",function(){function a(){d.removeEventListener("timeupdate",a),g(b)}var b=this;b.currentTime=b.duration>20?10:b.duration/2,d.addEventListener("timeupdate",a)})),d.deferObj=e,d.nameFromFile=a.name,d.addEventListener("onerror",l),d.src=window.URL.createObjectURL(a),e.promise}}var c={TIT2:"title",TOPE:"original-artist",TPE1:"artist",TOA:"original-artist",TP1:"artist",TT2:"title",APIC:"image",PIC:"image"},d=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"];angular.module("ringid.common.media_metadata_service",["ringid.utils"]).service("mediaMetadata",b),b.$inject=["$$q","Ringalert","utilsFactory"]}(DataView),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a){var b,c,d,e=new DataView(a);return e.byteLength?(b=e.getBool(0),b===!1?(d=e.getUint8(1),c={sucs:!1,mg:e.getString(2,d)}):b===!0&&(d=e.getUint8(1),c={sucs:!0,url:e.getString(2,d)})):c={sucs:!1,mg:"Failed. Response unreadable"},c}function l(l,m,n){function p(a){w.progressVal=a,"coverphoto"!==w.uploadType&&"profilephoto"!==w.uploadType||(o.progress=w.progressVal),d.$broadcast(e.FILE_UPLOAD.PROGRESS_UPDATE),n()}function q(a){var b;switch(w.uploadType){case"chatimage":b=k(a),b.sucs===!0&&(b.url=b.url),o.uploadProgress=!1,angular.extend(b,w.meta||{});break;case"tagchatimage":b=angular.fromJson(a),b.sucs===!0&&(b.url=b.iurl),o.uploadProgress=!1,angular.extend(b,w.meta||{});break;case"video":b=k(a),w.meta.thmbURL=b.url?b.url.substr(0,b.url.lastIndexOf("."))+".jpg":"",w.previewUrl=b.url?c.mediaBase+w.meta.thmbURL:"";break;case"audio":b=k(a);break;case"coverphoto":case"profilephoto":b=angular.fromJson(a),b.ih=w.meta.ih,b.iw=w.meta.iw,o.uploadProgress=!1;break;case"image":b=angular.fromJson(a),w.previewUrl=b.iurl?c.imBase+b.iurl.substr(0,b.iurl.lastIndexOf("/")+1)+"pthumb"+b.iurl.substr(b.iurl.lastIndexOf("/")+1):"";break;case"thumb":b=k(a);break;default:b=angular.fromJson(a)}w.response=angular.extend({},w.response,b),b.sucs===!0?w.uploadComplete=!0:w.uploadFail=!0,w.queued=!1,b.sucs!==!0&&f.show(b.mg||"Failed","error"),u.resolve(b)}function r(){n(),u.reject()}function s(a){a&&a.mg&&f.show(a.mg,"error"),u.reject()}function t(a){switch(w.fileType){case"video":case"audio":j.generateMeta(w.file,w.fileType).then(function(b){w.meta=angular.extend({},b,w.meta),a({success:!0}),n()},function(b){f(b,"error"),w.uploadFail=!0,u?u.reject(b):a({success:!1,message:b}),n()});break;case"image":i.resizeImage(w.file,w.uploadType).then(function(b){w.file=b.file,w.meta.ih=b.ih,w.meta.iw=b.iw,w.previewUrl=b.previewUrl,a({success:!0}),n()},function(b){w.uploadFail=!0,u?(f.show(b,"error"),u.reject(b)):a({success:!1,message:b}),n()})}w.gotMeta=!0,n()}var u,v="",w={uniqueId:g.getUniqueID(),uploadType:l,file:m||null,fileName:m.name&&m.name.substr(0,m.name.lastIndexOf("."))||"uploadFile",fileType:(m.name&&m.type?m.type.substr(0,m.type.indexOf("/")):void 0)||"image",response:{url:""},meta:{ttl:"status"!==l&&"image"!==l&&m.name?m.name.substr(0,m.name.lastIndexOf("."))||m.name:""},gotMeta:!1,previewUrl:"",progressVal:0,queued:!1,uploadComplete:!1,uploadFail:!1};switch(l){case"audio":w.fileName+=".mp3";break;case"video":w.fileName+=".mp4";break;default:w.meta.ttl=w.fileName,w.fileName+=".jpg"}return w.previewUrl=c.baseUrl+"/images/default_"+w.fileType+"_image.jpg","profilephoto"!==l&&"coverphoto"!==l||(w.repositionD={ih:0,iw:0,cimX:0,cimY:0}),{getKey:function(){return w.uniqueId},setRepositionData:function(a){w.repositionD=angular.extend({},w.repositionD||{},a)},getRepositionData:function(){return"profilephoto"===w.uploadType?{pimX:w.repositionD.cimX,pimY:w.repositionD.cimY}:{cimX:w.repositionD.cimX,cimY:w.repositionD.cimY}},getFile:function(){return w.file},getName:function(){return w.file.name},fetchMeta:t,initUpload:function(){function d(){"coverphoto"!==w.uploadType&&"profilephoto"!==w.uploadType||Object.keys(w.repositionD).forEach(function(a){e.append(a,w.repositionD[a])}),e.append("file",w.file,w.fileName),w.xhr=h.post(v,e,f).success(q).error(s).progress(p).abort(r)}var e=new FormData,f="text";switch(u=a.defer(),w.queued=!0,e.append("sId",b.getCookie("sId")),e.append("uId",b.getCookie("uId")),e.append("authServer",b.getCookie("authServer")),e.append("comPort",b.getCookie("comPort")),e.append("x-app-version",c.apiVersion),w.uploadType){case"profilephoto":v=c.imServer+"ImageUploadHandler";break;case"coverphoto":v=c.imServer+"CoverImageUploadHandler";break;case"tagchatimage":v=c.imServer+"GroupContentHandler";break;case"chatimage":v=c.imServer+"ChatImageHandler",f="arraybuffer";break;case"image":v=c.imServer+"AlbumImageUploadHandler";break;case"video":v=c.mediaServer+"Mp4UploadHandler",f="arraybuffer";break;case"audio":v=c.mediaServer+"Mp3UploadHandler",f="arraybuffer";break;case"thumb":v=c.mediaServer+"ThumbImageHandler",f="arraybuffer",w.gotMeta=!0}return w.gotMeta?d():t(d),u.promise},cptn:function(a){return arguments.length?w.meta.ttl=a:w.meta.ttl||w.file.name},getPreview:function(){return w.previewUrl},cancelUpload:function(){w.uploadFail=!0,w.xhr?w.xhr.abortRequest():w.deferred&&w.deferred.reject()},setPreview:function(a){w.previewUrl=a},getProgress:function(){return w.progressVal},uploadCompleted:function(){return w.uploadComplete},uploadFailed:function(){return w.uploadFail},getQueued:function(){return w.queued},setQueued:function(a){w.queued=a||!0},setMeta:function(a){w.meta=a},getMeta:function(){return w.hasOwnProperty("meta")?w.meta:!1},getAuthData:function(a){var b={};switch(w.fileType){case"image":b={ih:w.meta.ih,iw:w.meta.iw,iurl:w.response.iurl,cptn:w.meta.ttl.utf8Encode()};break;case"video":case"audio":if(b={strmURL:w.response.url,tiw:w.meta.tiw,tih:w.meta.tih,drtn:w.meta.drtn,thmbURL:w.meta.thmbURL,artst:w.meta.artst.utf8Encode(),ttl:w.meta.ttl.utf8Encode()},a){for(var c=0;c<o.tagList.length;c++)o.tagList[c].sk=o.tagList[c].sk.utf8Encode();b.htgLst=o.tagList}break;default:b=w.response}return b}}}function m(){var a;for(var b in n)n.hasOwnProperty(b)&&(a=n[b],a&&a.$id&&!a.$$destroyed&&a.$rgDigest())}var n={},o=this,p=-1;o.resetUpload=function(){o.progress=0,o.tagList=[],o.uploadProgress=!1,o.profileImageFile=null,o.coverImageFile=null,o.imageFiles=[],o.videoFiles=[],o.audioFiles=[],o.chatImageFiles={},o.selectFromAlbum=!1},o.resetUpload(),o.createUploadFile=function(a,b){return new l(a,b,m)},o.setUploadAlbum=function(a){p=a},o.getUploadAlbum=function(){return p},o.queueFile=function(a,b){switch(a){case"profilephoto":return o.progress=0,o.profileImageFile=new l(a,b,m),o.profileImageFile;case"coverphoto":return o.progress=0,o.coverImageFile=new l(a,b,m),o.coverImageFile;case"tagchatimage":case"chatimage":return new l(a,b,m);case"image":o.imageFiles.push(new l(a,b,m));break;case"video":o.videoFiles.push(new l(a,b,m));break;case"audio":o.audioFiles.push(new l(a,b,m))}m()},o.setReposition=function(a,b){"coverphoto"===b?o.coverImageFile.setRepositionData(a):"profilephoto"===b&&o.profileImageFile.setRepositionData(a)},o.getReposition=function(a){return"coverphoto"===a?o.coverImageFile.getRepositionData():"profilephoto"===a?o.profileImageFile.getRepositionData():{}},o.uploadQueue=function(b,c){function f(a){for(var b=a?0:c,d=0,e=b,f=o[i].length;f>e;e++)o[i][e]&&o[i][e].uploadFailed()&&(o[i].splice(e,1),d++,e--,f--);return d>0&&m(),d}var g,h=[],i=b+"Files";if(c<o[i].length){g=c+2<o[i].length?c+2:o[i].length;for(var j=c;g>j;j++)!o[i][j]||o[i][j].getQueued()||o[i][j].uploadFailed()||h.push(o[i][j].initUpload());if(0===h.length)return void o.uploadQueue(b,g);a.all(h).then(function(){f(),o.uploadQueue(b,g)},function(a){g-=f(),o.uploadQueue(b,g)})}else var k=setInterval(function(){o.uploadProgress=!1,f(!0);for(var a=0;a<o[i].length;a++)if(!o[i][a].uploadCompleted()){o.uploadProgress=!0;break}o.uploadProgress||(clearInterval(k),d.$broadcast(e.FILE_UPLOAD.QUEUE_COMPLETE,b),m())},2e3)},o.setScopeForDigest=function(a){n[a.$id]=a},o.removeScope=function(a){n[a.$id]&&(n[a.$id]=null)}}angular.module("ringid.common.file_upload_service",["ringid.utils"]).service("fileUploadService",a),a.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","utilsFactory","$ringhttp","imageQuality","mediaMetadata"]}(),function(){"use strict";function a(a,b,c,d){var e=this,f=b.COVER_PIC_UPLOAD_MINIMUM_WIDTH,g=b.COVER_PIC_UPLOAD_MINIMUM_HEIGHT,h=b.COVER_PIC_UPLOAD_MAXIMUM_WIDTH,i=b.COVER_PIC_UPLOAD_MAXIMUM_HEIGHT,j=b.PROFILE_PIC_UPLOAD_MINIMUM_WIDTH,k=b.PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT,l=b.IMAGE_UPLOAD_MIN_HEIGHT,m=b.IMAGE_UPLOAD_MIN_WIDTH;e.resizeImage=function(b,c){function e(){function a(a){e=document.createElement("canvas"),e.width=r.iw,e.height=r.ih,n=e.getContext("2d"),n.drawImage(o,0,0,r.iw,r.ih),a&&(r.imQ=a.qualityIM.quality),r.previewUrl=e.toDataURL("image/jpeg"),r.file=d.dataURLToBlob(r.previewUrl),r.file.name=b.name||c+".jpg",q.resolve(r)}var e,n,o=this,s=1,t=o.width,u=o.height;t>h||u>i?t/h>u/i?(s=h/t,r.iw=h,r.ih=Math.floor(s*u)):(s=i/u,r.ih=i,r.iw=Math.floor(s*t)):(r.iw=t,r.ih=u);var v=l,w=m;switch(c){case"profilephoto":(r.iw<j||r.ih<k)&&(v=k,w=j,p=!0);break;case"coverphoto":(r.iw<f||r.ih<g)&&(v=g,w=f,p=!0);break;case"image":case"status":case"chatimage":case"tagchatimage":(r.iw<m||r.ih<l)&&(p=!0)}p?q.reject("Image Size below Minimum("+w+"px by "+v+"px) :"+b.name):a(!1)}function n(){q.reject("Image invalid: "+b.name)}var o=new Image,p=!1,q=a.defer(),r={ih:0,iw:0,previewUrl:"",file:""},s=window.URL||window.webkitURL;return"string"==typeof b?(o.setAttribute("crossOrigin","anonymous"),o.src=b):o.src=s.createObjectURL(b),o.onload=e,o.onerror=n,q.promise}}angular.module("ringid.common.image_quality_service",["ringid.common.file_upload_service","ringid.utils"]).service("imageQuality",a),a.$inject=["$$q","APP_CONSTANTS","Ringalert","utilsFactory"]}(),function(){"use strict";function a(a,b){return{getList:function(c){return a.get(b.baseUrl+"/resources/countries.json")}}}angular.module("ringid.common.services",["ringid.common.media_metadata_service","ringid.common.file_upload_service","ringid.common.image_quality_service","ringid.config","ngWebSocket"]).factory("countryListService",a),a.$inject=["$ringhttp","settings"]}(),function(){"use strict";function a(a,b,c,d){var e=this,f=d.SYSTEM.REQUEST_TYPE,g=d.SYSTEM.IMAGE;e.fetchAlbumList=function(a){var b={};a?(b.actn=g.FETCH_FRIEND_ALBUM_LIST,b.fndId=a):b.actn=g.FETCH_ALBUM_LIST,c.send(b,f.REQUEST)},e.getAlbumImages=function(a){var b={};a.fndId?(b.actn=g.TYPE_FRIEND_ALBUM_IMAGES,b.fndId=a.fndId):b.actn=g.TYPE_ALBUM_IMAGES,b.st=a.st||0,b.albId=a.albId,c.send(b,f.REQUEST,!0)},e.deleteImage=function(a){return c.request({actn:g.DELETE_IMAGE,imgIds:[a]},f.UPDATE)},e.getImageDetails=function(a){return c.request({actn:g.TYPE_IMAGE_DETAILS,imgId:a},f.REQUEST)},e.getProfilePicORCoverPicImageDetails=function(b){var c=a.defer();return e.go({actn:g.GET_CP_OR_PP_DETAIL,type:b.type}).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},e.getFeedImages=function(a){var b={actn:d.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:a};return c.request(b,f.REQUEST)}}angular.module("ringid.common.services").service("imageHttpService",a),a.$inject=["$$q","settings","$$connector","OPERATION_TYPES"]}(),function(){"use strict";angular.module("ringid.common.imagepopup_controller",["ringid.config","ringid.common.imagemap_factory"]).controller("ImagePopupController",["$routeParams","$scope","Auth","$$imageMap","$$stackedMap","AlbumFactory","$$connector","OPERATION_TYPES",function(a,b,c,d,e,f,g,h){function i(){return b.image&&b.image.getLikes()>0}function j(c){"next"===c?"profile"===b.params.popupFrom?q.previous(b.image.getKey())?b.image=q.next(b.image.getKey())||q.bottom():f.loadMoreImage(b.image.getAlbumId(),a.uId):b.image=q.next(b.image.getKey())||q.bottom():b.image=q.previous(b.image.getKey())||q.top(),m(c),b.$rgDigest()}function k(c){if(c)f.getFeedImages(c).then(function(a){if(a.sucs===!0){for(var c,e=a.newsFeedList[0].imageList,f=0,g=e.length;g>f;f++)e[f].nfId=a.nfId,e[f].imgId===b.image.getKey()?(b.image.updateImage(e[f]),q.save(b.image.getKey(),b.image)):(c=d(e[f]),q.save(c.getKey(),c));l()}});else{var e=f.getAlbums(a.uId);q=e.get(b.image.getAlbumId()).getImages(),l()}}function l(){q.length()>1&&(b.nextImg=!!q.next(b.image.getKey())||!!q.bottom(),b.prevImg=!!q.previous(b.image.getKey())||!!q.top()),b.$rgDigest()}function m(a){var c,d=new Image;c="next"===a?q.next(b.image.getKey()):q.previous(b.image.getKey()),setTimeout(function(){d.src=c?c.src():""},200)}function n(){p=g.subscribe(function(a){b.image&&b.image.getKey()===a.imgId&&(b.image.setTotalComment(a.loc),b.$rgDigest())},{action:[r.TYPE_UPDATE_ADD_IMAGE_COMMENT,r.TYPE_UPDATE_DELETE_IMAGE_COMMENT]}),o=g.subscribe(function(c){c.sucs===!0&&(q=f.getAlbums(a.uId).get(b.image.getAlbumId()).getImages(),b.image=q.next(b.image.getKey())||q.bottom(),b.$rgDigest())},{action:[r.TYPE_ALBUM_IMAGES,r.TYPE_FRIEND_ALBUM_IMAGES]}),b.params.image?b.image=b.params.image:b.params.imgId&&(b.remoteData?b.image=b.remoteData:f.getImageDetails(b.params.imgId).then(function(a){b.image=a,b.$rgDigest()})),b.params.feed&&(b.feed=b.params.feed,k(b.feed.getKey())),"profile"===b.params.popupFrom&&k(),b.$rgDigest()}var o,p,q=e.createNew(),r=h.SYSTEM.IMAGE;b.showCommentBox=!0,b.nextImg=!1,b.prevImg=!1,b.changeImage=j,b.openRingboxLike=i,n(),b.$on("$destroy",function(){p&&g.unsubscribe(p),g.unsubscribe(o)})}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(){d.media.increaseView().then(function(){d.$rgDigest()},function(){d.$rgDigest()})}function n(a){return{data:function(){return{media:a}}}}function o(a){d.media=a,d.media.fetchDetails(),m(),d.$rgDigest()}var p,q=i.SYSTEM.MEDIA;d.currentUser=e.currentUser(),d.showCommentBox=!0,d.changeMedia=o,d.params&&"notification"===d.params.popupFrom?(d.media=d.remoteData,d.album=g.getAlbum(d.media.getAlbumId())):(d.media=d.params.media,d.playlist=d.params.playlist),d.selectAlbum=n,d.shareMedia=function(){var a=l.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:d.media},onBackDropClickClose:!0,templateUrl:"pages/home/share-media.html"});a.result.then(function(){d.$rgDigest()})},p=h.subscribe(function(a){d.media&&d.media.getKey()===a.cntntId&&d.media.setTotalComment(a.loc)},{action:[q.ACTION_UPDATE_ADD_MEDIA_COMMENT,q.ACTION_UPDATE_DELETE_MEDIA_COMMENT]}),d.$on("$destroy",function(){p&&h.unsubscribe(p)})}angular.module("ringid.common.media_controller",["ringid.config"]).controller("MediaController",a),a.$inject=["APP_CONSTANTS","fileUploadService","$routeParams","$scope","Auth","rgDropdownService","Media","$$connector","OPERATION_TYPES","Ringalert","feedFactory","$ringbox"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){var a=g.open({type:"remote",resolve:{localData:{mdaT:"audio"===l?o.NEWS_FEED_MEDIA_TYPE_AUDIO:o.NEWS_FEED_MEDIA_TYPE_VIDEO}},scope:!1,controller:"AlbumCreateController",templateUrl:"pages/popups/create-album-popup.html"});a.result.then(function(a){a&&(b.selectedAlbum=a,b.$rgDigest())})}function j(a){switch(a.action){case"select":if(b.selectedAlbum&&b.selectedAlbum.getKey()===a.albumMap.getKey())break;b.selectedAlbum=a.albumMap}b.$rgDigest()}function k(){c.init(),m=f.subscribe(function(){setTimeout(function(){b.$rgDigest()},500)},{action:[n.ACTION_MEDIA_ALBUM_LIST]})}var l,m,n=e.SYSTEM.MEDIA,o=a;b.selectedAlbum="",b.albumName="",b.media=b.params.media,b.selectAlbum=j,b.createAlbumPopup=i,l=b.media?b.media.isAudio()?"audio":"video":b.params.mediaType,b.addToAlbum=function(){b.media?b.selectedAlbum.addNewContent(b.media):h.setUploadAlbum(b.selectedAlbum.getId()),b.close()},b.getAlbums=function(){return c.getAlbums(!0,l)},k(),b.$on("$destroy",function(){f.unsubscribe(m)})}angular.module("ringid.common.albumlist_controller",["ringid.config"]).controller("AlbumlistController",a),a.$inject=["APP_CONSTANTS","$scope","Media","Ringalert","OPERATION_TYPES","$$connector","$ringbox","fileUploadService"]}(),function(){"use strict";function a(a,b,c,d,e){a.albumName="",a.createAlbum=function(){a.albumName.length>0&&b.createAlbum({albn:a.albumName,mdaT:e.mdaT},!0).then(function(a){a&&d.close(a)})}}angular.module("ringid.common.albumcreate_controller",["ringid.config"]).controller("AlbumCreateController",a),a.$inject=["$scope","Media","APP_CONSTANTS","$boxInstance","localData"]}(),function(){"use strict";function a(a,b,c,d,e,f){a.close=b.close,d&&d.imgId&&(a.templateType=d.templateType),a.params=d,a.remoteData=e,d.noti&&d.noti.getCommentId()>0&&(a.activeCommentId=d.noti.getCommentId()),c("ImagePopupController",{$scope:a})}angular.module("ringid.common.ringbox_imagepopup_controller",["ringid.common.imagepopup_controller"]).controller("RingBoxImagePopupController",a),a.$inject=["$scope","$boxInstance","$controller","localData","remoteData","feedFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){a.destroyPlayer(),b.close()}a.close=g,d&&d.mediaId&&(a.templateType=d.templateType),a.params=d,a.remoteData=e,c("MediaController",{$scope:a}),a.destroyPlayer=angular.noop}angular.module("ringid.common.ringbox_media_controller",["ringid.common.media_controller"]).controller("RingBoxMediaController",a),a.$inject=["$scope","$boxInstance","$controller","localData","remoteData","Media"]}(),function(){"use strict";function a(a,b,c,d){a.close=b.close,a.params=d,c("AlbumlistController",{$scope:a})}angular.module("ringid.common.ringbox_albumlist_controller",["ringid.common.albumlist_controller"]).controller("RingBoxAlbumlistController",a),a.$inject=["$scope","$boxInstance","$controller","localData"]}(),function(){"use strict";function a(a,b,c){function d(a){b.close(a)}a.close=d,a.params=c}angular.module("ringid.common.ringbox_confirm_controller",[]).controller("RingBoxConfirmController",a),a.$inject=["$scope","$boxInstance","localData"]}(),function(){"use strict";function a(a,b,c,d){a.params={},a.params.imgId=b.imageId,a.isReady=!1,a.currentUser=d.currentUser(),c("ImagePopupController",{$scope:a}),a.showCommentBox=!0}angular.module("ringid.common.singleimage_controller",["ringid.common.imagepopup_controller"]).controller("SingleImageController",a),a.$inject=["$scope","$routeParams","$controller","Auth"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(b){b&&(e.noOfSuggestions()>k&&(h.recalculate(a),a.$rgDigest()),k=e.noOfSuggestions())}a.users=[];var j=f.SYSTEM.FRIENDS;a.state=e.state,b.opened.then(function(){a.users=c.target.all(),a.$rgDigest()});var k=c.target.length();a.$watch("state.isRequestsLoading",function(b,c){a.$rgDigest()}),a.contactListAction=function(b){b.friend.isLoading()||(d.friendAction(b,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()}),a.$rgDigest())},a.loadmorefriend=function(){e.getSuggestionContactsDetails(5),a.$rgDigest()},a.getMutualFriend=function(a){return{data:function(){return{target:a}},promise:e.getMutualFriend(a)}};var l=g.subscribe(i,{action:[j.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]});a.$on("$destroy",function(){g.unsubscribe(l)})}angular.module("ringid.common.all_suggestions_controller",[]).controller("allSuggestionController",a),a.$inject=["$scope","$boxInstance","localData","friendsFactory","InviteFactory","OPERATION_TYPES","$$connector","rgScrollbarService"]}(),function(){"use strict";function a(a,b,c,d,e,f){var g=b.mfIDs;a.mutualfriends=[],a.state=e.state,c.getContactDetailsByUtIds(g).then(function(b){if(a.mutualfriends=[],b.sucs===!0){for(var c=0;c<b.contacts.length;c++)a.mutualfriends.push(d.create(b.contacts[c]));a.$rgDigest()}f.recalculate(a),a.$rgDigest()}),a.getMutualFriend=function(a){return{data:function(){return{target:a}},promise:e.getMutualFriend(a)}}}angular.module("ringid.common.mutualfriends_controller",[]).controller("mutualFriendsController",a),a.$inject=["$scope","remoteData","friendsFactory","userFactory","InviteFactory","rgScrollbarService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){var b=c.path();"/"===b?a.hideColumn=!1:/\/circle\/\d+(\/post|$)/.test(b)?a.hideColumn=!1:/\/profile\/\d+(\/post|$)/.test(b)?a.hideColumn=!1:a.hideColumn=!0}function o(b){s=b&&""!==b?b:"/"===c.path()?"home":"none",a.$rgDigest()}function p(){return s}var q=this,r=f.SYSTEM,s=o();q.getActiveMenu=p,q.logout={ddHtml:"pages/dropdowns/logout-dropdown.html",ddControl:i,ddAction:function(){d.close(),i.logout()},ddOpened:function(){o("logout")},ddBeforeClose:function(){o("")}},q.freq={ddTemplate:'<rg-requests load-on-scroll="true" load-count="10" ></rg-requests>',ddOpened:function(){o("friend_request")},ddBeforeClose:function(){o("")}},q.requestCount=g.getRequestCount,q.chatHistory={ddHtml:"pages/partials/chat/chat-history-dropdown.html",ddOpened:function(){o("chat_history")},ddBeforeClose:function(){o("")}},q.unreadChatCount=k.getUnreadMessageCount,l.onCustomEvent(m.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){a.$rgDigest()}),q.noti={ddTemplate:'<rg-notification load-count="10" template-url="pages/dropdowns/notification-dropdown.html"></rg-notification>',ddOpened:function(){o("notification"),h.clearCounter()},ddBeforeClose:function(){o("")}},q.notiCount=h.getNotiCount;var t=e.subscribe(function(){setTimeout(function(){a.$rgDigest()},200)},{action:[r.FRIENDS.TYPE_ACCEPT_FRIEND,r.FRIENDS.TYPE_UPDATE_ADD_FRIEND,r.FRIENDS.TYPE_UPDATE_DELETE_FRIEND,r.FRIENDS.TYPE_DELETE_FRIEND,r.NOTIFICATION.TYPE_MY_NOTIFICATIONS,r.NOTIFICATION.TYPE_SINGLE_NOTIFICATION]});a.hideColumn=!1,b.$on("$routeChangeStart",function(a){n()}),n(),q.defaultSpan=l.getDefaultColumn,b.$on("$routeChangeStart",function(){o(),e.unsubscribe(t)}),a.$on(m.COMMON.WINDOW_RESIZED,function(){a.$rgDigest()})}angular.module("ringid.common.header_controller",["ringid.auth","ringid.media","ringid.friend.friends_factory","ringid.notification","ringid.profile","ringid.config"]).controller("HeaderController",a),a.$inject=["$scope","$rootScope","$location","rgDropdownService","$$connector","OPERATION_TYPES","friendsFactory","NotificationFactory","Auth","rgScrollbarService","ChatFactory","utilsFactory","SystemEvents"]}(angular),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){a.$rgDigest()}var j,k,l=g.SYSTEM.CIRCLE;j=e.subscribe(i,{action:l.TYPE_GROUP_LIST}),k=e.subscribe(i,{filter:c.circleUpdateFilter}),a.initCircles=function(){return c.init(),{data:function(){return{}}}},a.isCurrentPath=function(a,c){return c?b.path().indexOf(a)>-1:b.path()==a};c.getCircles("true").all(),c.getCircles().all();a.$on("$destroy",function(){e.unsubscribe(j),e.unsubscribe(k)})}angular.module("ringid.common.menu_controller",["ringid.circle","ringid.friend.friends_factory"]).controller("MenuController",a),a.$inject=["$scope","$location","circlesManager","rgScrollbarService","$$connector","circleHttpService","OPERATION_TYPES","$timeout"]}(),
function(){"use strict";angular.module("ringid.common.controllers",["ringid.common.header_controller","ringid.common.menu_controller","ringid.common.mutualfriends_controller","ringid.common.all_suggestions_controller","ringid.common.imagepopup_controller","ringid.common.media_controller","ringid.common.albumlist_controller","ringid.common.albumcreate_controller","ringid.common.ringbox_confirm_controller","ringid.common.ringbox_imagepopup_controller","ringid.common.ringbox_media_controller","ringid.common.ringbox_albumlist_controller","ringid.common.singleimage_controller"])}(),function(){"use strict";function a(a){return function(b){return b.indexOf("prof.png")>0?b:a.imBase+b}}function b(){return function(a,b){if(a){for(var c=0;c<a.length;c++)b.get(a[c].key);return a}}}function c(a){return function(b,c){if(b){for(var d=[],e=c.name.toLowerCase(),f=0;f<b.length;f++)c.showMutual&&b[f].value.friendshipStatus()!==a.FRIEND||(0===e.length||b[f].value.getName().toLowerCase().indexOf(e)>-1)&&d.push(b[f]);return d}}}function d(){return function(a,b){if(a){for(var c=[],d=0;d<a.length;d++)b.get(a[d].value.getKey())||c.push(a[d]);return c}}}function e(){return function(a){var b=new Date(a),c=""+(b.getMonth()+1),d=""+b.getDate(),e=b.getFullYear();return c.length<2&&(c="0"+c),d.length<2&&(d="0"+d),[e,c,d].join("-")}}function f(){return function(a,b){if(a){for(var c=[],d=0;d<a.length;d++)a[d].value.getType()===b&&c.push(a[d]);return c}}}function g(){return function(a,b){if(a){for(var c=[],d=b.value?b.value.toLowerCase():"",e=0;e<a.length;e++)a[e].value[b.mapApi]().toLowerCase().indexOf(d)>-1&&c.push(a[e]);return c}}}function h(){function a(a,b){return a.indexOf(b)>-1}function b(a,b){return b===a}return function(c,d){var e,f=[];if(c&&c.length>0){switch(d.compare){case"string":e=a;break;default:e=b}for(var g=0;g<c.length;g++)e(c[g][d.prop],d.value)&&f.push(c[g]);return f}}}angular.module("ringid.filters",["ringid.config"]).filter("validProfileImage",a).filter("friendListFilter",c).filter("mapListFilter",d).filter("stackMapFilter",b).filter("ymdDateFilter",e).filter("mediaFilter",f).filter("mapFilter",g).filter("objectFilter",h),a.$inject=["settings"],c.$inject=["APP_CONSTANTS"]}(),function(){"use strict";function a(a,b,c,d){var e={utIds:b.createNew(),incomingUtIds:b.createNew(),outgoingUtIds:b.createNew()},f=b.createNew();return{init:function(){},initStorage:function(){},utIds:function(){return e.utIds},outgoingUtIds:function(){return e.outgoingUtIds},incomingUtIds:function(){return e.incomingUtIds},remove:function(a,b){return f.save(b,e[a].get(b)),e[a].remove(b)},add:function(a,b,c){e[a].save(b,c)},getFrns:function(a){return e.utIds.get(a)||e.incomingUtIds.get(a)||e.outgoingUtIds.get(a)||f.get(a)||{frnS:0}}}}angular.module("ringid.common.contacts_factory",["ringid.config"]).factory("Contacts",a),a.$inject=["settings","$$stackedMap","utilsFactory","Storage"]}(),function(){"use strict";angular.module("ringid.common.user_factory",["ringid.config","ringid.common.contacts_factory"]).factory("$$userMap",["profileHttpService","settings","$$stackedMap","$filter","utilsFactory","Storage","Contacts","$$q",function(a,b,c,d,e,f,g,h){function i(a,b,c,d){this.groups={},this.updateUserObj(a),this.isCurrent=c,this.isProfile=b,this.requestedMutualFriend=!1,this.loading=!1,this.user.psnc=this.isCurrent?2:this.user.psnc,this.user.dvc=this.isCurrent?5:this.user.dvc,a.hasOwnProperty("grpId")&&(this.groups[a.grpId]=a.admin),a=null,this.user.prIm&&this.user.uId&&this.user.utId&&(this.user.nmf||!d)||this.requestUserDetails(!!d)}var j={0:"p",1:"desktop",2:"android",3:"iphone",4:"windows",5:"web"},k={fn:"",uId:0,cnty:"",el:"",gr:"",am:"",mblDc:"",mbl:"",prIm:"images/prof.png",cIm:"images/default_cover.jpg",prImId:0,cImId:0,cimX:0,cimY:0,bDay:"",blc:0,re:"",utId:0,tf:0,nmf:0,chta:0,cla:0,fda:0,cc:"",hc:"",adt:0,iev:0,imnv:0,psnc:0,lot:0,mood:0,apt:0,dt:"",frnS:0,ct:0,nct:0,pimX:0,pimY:0,bv:0,owner:0,basicInfo:!1,privacyInfo:{}};return i.prototype={updateUserObj:function(a){var a=a||{};this.user?angular.extend(this.user,a):this.user=angular.extend({},k,a),a.grpId&&(this.groups[a.grpId]=a.admin),""===this.user.prIm&&(this.user.prIm="images/prof.png"),""===this.user.cIm&&(this.user.cIm="images/default_cover.jpg"),0===this.user.frnS&&(this.user.frnS=g.getFrns(this.user.utId).frnS||this.user.frnS),a.mfc&&(this.user.nmf=a.mfc),a.mutualFriends&&(this.user.nmf=a.mutualFriends),a=null},requestUserDetails:function(b){var c,d={},e=this;return this.user.utId?d.utId=this.user.utId:this.user.uId&&(d.uId=this.user.uId),d.utId||d.uId?(b&&(this.requestedMutualFriend=!0),c=a.getUserDetails(d,!!b),c.then(function(a){a.sucs&&e.updateUserObj(a.userDetails)}),c):void 0},getName:function(){return this.user.fn},avatar:function(a){var c=this.user.prIm||"";if("iurl"===a)return c;if("original"===a)return b.imBase+c;if(c.indexOf("prof.png")>0)return c;c=c.replace("profileimages/",""),"original"===a?a="":a||(a="crp"),a=(/\/uploaded\//.test(c)?"":"p")+a;var d=c.lastIndexOf("/")+1;return c=[b.imBase,c.slice(0,d),a,c.slice(d)].join(""),c.indexOf("prof.png")>0?this.user.prIm:c},getKey:function(){return this.user.uId||this.user.utId},getUId:function(){return this.user.uId},setUid:function(a){this.user.uId=a},getUtId:function(){return+this.user.utId},equals:function(a,b){return b||(b="uId"),angular.isObject(a)&&(a="uId"===b?a.getKey():a.getUtId()),this.user[b]===a},link:function(){return this.user.uId||3!==this.user.ct?b.baseUrl+e.getRingRoute("USER_PROFILE",{uId:this.user.uId,utId:this.user.utId})+(1===this.user.frnS||this.isCurrent?"":"/about"):""},getRingNumber:function(){return this.user.uId.replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")},navActiveLink:function(){if(this.user.uId||this.user.utId){var a="/profile/"+this.user.uId+"/post";return a}return""},toString:function(){return this.user.uId},friendshipStatus:function(){return 0===this.user.frnS?g.getFrns(this.user.utId).frnS||this.user.frnS:this.user.frnS},isLoading:function(a){return"undefined"==typeof a?this.user.loading:(this.user.loading=a,this.user.loading)},commonFriends:function(a,b){var c;return(!this.user.nmf&&!this.requestedMutualFriend||a)&&(c=this.requestUserDetails(!0)),b?c||h.when(this.user.nmf):this.user.nmf},isCurrentUser:function(){return this.isCurrent},sortBy:function(){return this.user.adt},getLiteUser:function(){return this},isAdmin:function(a){return this.groups.hasOwnProperty(a)?this.groups[a]:!1},setGroupAdmin:function(a){this.groups[a]=!0},removeGroupAdmin:function(a){delete this.groups[a]},overwriteInfo:function(a){this.user.prIm=a.prIm||this.user.prIm},haveProfileData:function(){return this.isProfile},getBasicInfo:function(){var a=e.profileVerbalDate(this.user.bDay),b=e.profileVerbalDate(this.user.mDay);return{fn:this.user.fn||"",birthDay:this.user.bDay||"",mDay:this.user.mDay||"",birthday:a,marriageDay:b,el:this.user.el||"",hc:this.user.hc.trim()||"",cc:this.user.cc.trim()||"",gr:this.user.gr||"",am:this.user.am.trim()||"",uId:this.user.uId.toString().substring(2)||""}},setBasicInfo:function(a){},resetCover:function(){this.user.cIm="images/default_cover.jpg"},getCover:function(a){var c,d,e=this.user.cIm;return"iurl"===a?e:a&&"original"===a?b.imBase+e:e?e.indexOf("default")>0?e:e.indexOf("web")>0?b.imBase+e:(c=(/\/uploaded\//.test(e)?"":"p")+(a||"crp"),d=e.lastIndexOf("/")+1,e=[b.imBase,e.slice(0,d),c,e.slice(d)].join("")):"images/default_cover.jpg"},getCoverXY:function(){return{x:this.user.cimX,y:this.user.cimY}},setCover:function(a){this.user.cIm=a.iurl,this.user.cimX=a.cimX,this.user.cimY=a.cimY,this.user.cImId=a.cImId},getAvatarXY:function(){return{x:this.user.pimX,y:this.user.pimY}},setProfileImage:function(a,b){this.user.prIm=a,this.user.prImId=b},setName:function(a){this.user.fn=a},setAboutMe:function(a){this.user.am=a},setHomeCity:function(a){this.user.hc=a},setCurrentCity:function(a){this.user.cc=a},setGender:function(a){this.user.gr=a},setBirthday:function(a){this.user.bDay=a},setMarriageday:function(a){this.user.mDay=a},getEmail:function(){return this.user.el},getMobileDc:function(){return this.user.mblDc},getMobileNumber:function(){return this.user.mbl},getCountry:function(){return this.user.cnty},friendType:function(){return this.user.ct},setFriendType:function(a){this.user.ct=a},newFriendType:function(){return this.user.nct},getLink:function(a){var b="";if(a)for(var c in a)a.hasOwnProperty(c)&&(b+=c+'="'+a[c]+'" ');return"<a "+b+' href="'+this.link()+'">'+this.user.fn+"</a>"},resetAvatar:function(){this.user.prIm="images/prof.png"},avatarXY:function(){return{x:this.user.pimX,y:this.user.pimY}},getBday:function(){return this.user.bDay},getUserMood:function(){return this.user.mood},setUserMood:function(a){this.user.mood=a},getAppType:function(){return this.user.apt},setAppType:function(a){this.user.apt=a},getDeviceToken:function(){return this.user.dt},setDeviceToken:function(a){this.user.dt=a},isBlocked:function(){return 0===this.user.cla&&0===this.user.chta&&0===this.user.fda?this.user.bv=1:this.user.bv=0,this.user.bv},setBlock:function(a){if(1===a)var b=0;else var b=1;this.user.cla=b,this.user.chta=b,this.user.fda=b,this.user.bv=a},isFriend:function(){return 1===this.user.frnS},unFriend:function(){this.user.frnS=0},getAccess:function(){return{chta:this.user.chta,cla:this.user.cla,fda:this.user.fda}},canChat:function(){return 1===this.user.chta},canSeeFeed:function(){return 1===this.user.fda},setOnlineStatus:function(a){this.user.psnc=a},getOnlineStatus:function(){return this.user.psnc},isOnline:function(){return 2===this.user.psnc&&1===this.user.mood},onlineDevice:function(){return j[this.user.dvc]},getPlatform:function(){return this.user.dvc},setPlatform:function(a){this.user.dvc=a},lastOnline:function(){return 0===this.user.lot?!1:e.verbalDate(this.user.lot)},getProfileImageId:function(){return this.user.prImId},getCoverImageId:function(){return this.user.cImId},isEmailVerified:function(){return this.user.iev},isMobileVerified:function(){return this.user.iev},toggleMood:function(b){this.user.mood=b?1:2,a.changeMood(this.user.mood).then(function(a){a.sucs!==!0&&(this.user.mood=a.mood)})}},function(a,b,c,d,e){return new i(a,b,c,d,e)}}]).factory("userFactory",["$$userMap","$$stackedMap",function(a,b){var c=b.createNew(),d={},e="ru_",f={getSortIndex:function(){return"adt"},create:function(b,f,g){f=!!f,g=!!g;var h,i;return angular.isObject(b)?b.uId?(h=b.uId,h=e+h,i=c.get(h)):b.utId?(i=d[b.utId],i||(i=!1)):i=!1:(h=e+b,i=c.get(h)),i===!1?b.utId&&d[b.utId]?(i=d[b.utId],h=e+b.uId,c.save(h,i),i.updateUserObj(b)):(i=a(b,f,g),i.getUtId()&&(d[i.getUtId()]=i)):i.updateUserObj(b),c.save(h,i),i},createByUtId:function(b,c,e){return d[b.utId]||(d[b.utId]=a(b,!1,!1,e)),c?d[b.utId].getLiteUser():d[b.utId]},getUser:function(a){return a=e+a,c.get(a)},getByUtId:function(a){return a&&d[a]||!1},getAllUtIds:function(){return Object.keys(d)},getUIdByUtId:function(a){return d[a]&&d[a].getUId()},getUtIdByUId:function(a){var b;try{b=f.getUser(a)}catch(c){}return b&&b.getUtId()}};return f}])}(),function(){angular.module("ringid.common.comment_factory",["ringid.config"]).factory("$$commentMap",["$$stackedMap","settings","$filter","DATE_FORMAT","userFactory","utilsFactory","$$stickerMap","$sce",function(a,b,c,d,e,f,g,h){function i(a,b){b&&(this._u=b),this.updateComment(a)}var j={cmn:"",cmnId:0,deleted:!1,edited:!1,fn:"",il:0,isNew:1,ln:"",nfId:0,imageId:0,tl:0,tm:"",uId:"",prIm:"",pending:!1};return i.prototype={updateComment:function(a){this.comment?angular.extend(this.comment,a):this.comment=angular.extend({},j,a),this.updateTime(),this.setHtml(),this._u||(this._u=e.create({fn:this.comment.fn,ln:this.comment.ln,uId:this.comment.uId,prIm:this.comment.prIm}))},updateTime:function(){this.comment.tm||(this.comment.tm=Date.now()),this.vtime=f.verbalDate(this.comment.tm)},setHtml:function(){this.html=h.trustAsHtml(f.parseForLE(this.comment.cmn))},user:function(){return this._u},isOwner:function(a){return a===this._u.getKey()},text:function(){return this.comment.cmn},setComment:function(a){this.comment.cmn=a,this.setHtml()},setText:function(a){comment.cmn=a,this.setHtml()},getDynamicText:function(){return this.html},getByProperty:function(a,b){return b=b||!1,this.comment.hasOwnProperty(a)?this.comment[a]:b},sortBy:function(){return this.comment.cmnId},getKey:function(){return this.comment.cmnId},setKey:function(a){this.comment.cmnId=a},getFeedKey:function(){return this.comment.nfId},setFeedKey:function(a){this.comment.nfId=a},getImageKey:function(){return this.comment.imageId},setImageKey:function(a){this.comment.imageId=a},getTimestamp:function(){return this.comment.tm},setTime:function(a){this.comment.tm=a,this.updateTime()},getTimeUpdate:function(){return this.updateTime(),this.vtime},time:function(){return this.vtime},like:function(a,b){return a?(this.comment.il=1^this.comment.il,b?this.comment.tl=b:this.comment.tl=0==this.comment.il?this.comment.tl-1:this.comment.tl+1,this.comment.il):this.comment.il},getTotalLikes:function(){return this.comment.tl},incomingLike:function(a){this.comment.tl=a},isPending:function(a){return void 0!==a&&(this.comment.pending=!!a),this.comment.pending},isEditable:function(){return this._u.isCurrentUser()&&0===this.like()}},{getSortIndex:function(){return"tm"},create:function(a,b){return new i(a,b)}}}])}(),function(){"use strict";function a(a,b,c,d){function e(a,b){a=a||{},b&&(this._u=b),this.updateImage(a)}var f={albId:"",albn:"",cptn:"",nfId:0,ic:0,ih:0,il:0,imT:0,imgId:0,iurl:"",iw:0,nc:0,nl:0,tm:0,user:null};return e.prototype={updateImage:function(a,b){this.image?angular.extend(this.image,a):this.image=angular.extend({},f,a),a=null,this.key="im"+this.image.imgId,this.image.tm?this._time=d.verbalDate(this.image.tm):this._time={},!this._u&&this.image.hasOwnProperty("uId")&&(this._u=c.create({uId:this.image.uId,fn:this.image.fn||""}))},user:function(){return this._u},src:function(b){if("iurl"===b)return this.image.iurl;var c=this.image.iurl.lastIndexOf("/")+1,d=/\/uploaded\//.test(this.image.iurl)?"":"p";return void 0!==b?[a.imBase,this.image.iurl.slice(0,c),d,b,this.image.iurl.slice(c)].join(""):[a.imBase,this.image.iurl.slice(0,c),d,this.image.iurl.slice(c)].join("")},getByProperty:function(a,b){return b=b||!1,this.image.hasOwnProperty(a)?user[a]:b},sortBy:function(){return this.image.imgId},getIh:function(){return this.image.ih},getIw:function(){return this.image.iw},sortByTime:function(){return this.image.tm},getAlbumName:function(){return this.image.albn},getAlbumId:function(){return this.image.albId},getCaption:function(){return this.image.cptn},getKey:function(){return this.image.imgId},getMapKey:function(){return this.key},getFeedKey:function(){return this.image.nfId},setFeedKey:function(a){this.image.nfId=a},time:function(){return this._time},like:function(a,b){return a?(this.image.il=1^this.image.il,b?this.image.nl=b:this.image.nl=0==this.image.il?this.image.nl-1:this.image.nl+1,this.image.il):this.image.il},getLikes:function(){return this.image.nl},getTotalLikes:function(){return this.image.nl},getImageType:function(){return this.image.imT},incomingLike:function(a){return a&&++this.image.nl||--this.image.nl},offset:function(){return{width:this.image.iw,height:this.image.ih}},selfComment:function(){return this.image.ic},getTotalComment:function(){return this.image.nc},setTotalComment:function(a,b){this.image.nc=a,angular.isDefined(b)&&(this.image.ic=b)},getUrl:function(){return"/image/"+this.getKey()},getRelativeHeight:function(a){try{return this.image.ih/this.image.iw*a}catch(b){return this.image.ih}}},function(a,b){return new e(a,b)}}angular.module("ringid.common.imagemap_factory",["ringid.config","ringid.utils","ringid.common.comment_factory","ringid.common.user_factory"]).factory("$$imageMap",a),a.$inject=["settings","$$stackedMap","userFactory","utilsFactory"]}(),function(){"use strict";function a(a,b,c,d){function e(e,f){function g(a){for(var c,d=0,e=a.imageList.length;e>d;d++)c=angular.extend({},a.imageList[d],{albId:j.albId}),h=b(c,i),j.images.save(h.getKey(),h),j.ut<a.imageList[d].tm&&(j.ut=a.imageList[d].tm)}var h,i,j={albId:e.albId,timg:e.timg,images:c.createNew(),ut:0};return i=d.getProfile(f),j=angular.extend({},j,e),e.imageList&&e.imageList.length>0&&g(e),{getKey:function(){return j.albId},pushImages:function(a){g(a)},removeImage:function(a){j.images.remove(a)&&(j.tn=j.tn-1)},getName:function(){return j.albn},getCoverImage:function(b){var c=j.cvImg.lastIndexOf("/")+1;return b="p"+b,[a.imBase,j.cvImg.slice(0,c),b,j.cvImg.slice(c)].join("")},getTotalImageCount:function(){return j.tn},getUpdateTime:function(){return j.tm},getImages:function(){return j.images}}}return function(a,b){return new e(a,b)}}function b(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){var c,e,f;switch(a.actn){case p.TYPE_ALBUM_IMAGES:a.sucs===!0?q.get(a.albId)?q.get(a.albId).pushImages(a):(c=new d(a),q.save(c.getKey(),c)):a.sucs===!1&&1111===a.rc;break;case p.TYPE_FRIEND_ALBUM_IMAGES:a.sucs===!0&&(r.get(a.albId)?r.get(a.albId).pushImages(a):(c=new d(a),r.save(c.getKey(),c)));break;case p.FETCH_FRIEND_ALBUM_LIST:if(a.sucs===!0)for(e=0,f=a.albumList.length;f>e;e++)c=new d(a.albumList[e],b),r.save(c.getKey(),c);break;case p.FETCH_ALBUM_LIST:if(a.sucs===!0)for(e=0,f=a.albumList.length;f>e;e++)c=new d(a.albumList[e],b),q.save(c.getKey(),c)}}function m(a,b){var d=!1,e=0;if(c.currentUser().getKey()===b){if(e=q.get(a)?q.get(a).getImages().length():0,0!==e&&e>=q.get(a).getTotalImageCount())return}else if(d=b,e=r.get(a)?r.get(a).getImages().length():0,0!==e&&e>=r.get(a).getTotalImageCount())return;i.getAlbumImages({fndId:d,albId:a,st:e})}function n(a){var b=!1;c.currentUser().getKey()!==a&&(b=a),i.fetchAlbumList(b)}var o={imagesLoading:!1,albumsLoading:!1},p=h.SYSTEM.IMAGE,q=f.createNew(),r=f.createNew();return{processResponse:l,state:o,resetAlbums:function(a){a?q.reset():r.reset()},deleteImage:function(a){return i.deleteImage(a.getKey())},getAlbums:function(a){return c.currentUser().getKey()===a?q:r},loadMoreImage:m,fetchAllAlbums:n,getFeedImages:i.getFeedImages,getImageDetails:function(b,c){var d=a.defer();return i.getImageDetails(b).then(function(a){a.sucs===!0?(c&&!a.nfId&&(a.nfId=c),d.resolve(e(a))):k.show(a,"error")},function(a){d.reject()}),d.promise}}}angular.module("ringid.common.album_factory",["ringid.config","ringid.common.imagemap_factory","ringid.utils","ringid.connector","ringid.common.services","ringid.profile"]).factory("$$albumMap",a).factory("AlbumFactory",b),a.$inject=["settings","$$imageMap","$$stackedMap","profileFactory"],b.$inject=["$$q","settings","Auth","$$albumMap","$$imageMap","$$stackedMap","$$connector","OPERATION_TYPES","imageHttpService","profileFactory","Ringalert"]}(),function(){"use strict";angular.module("ringid.common.emotion_factory",[]).factory("EmotionFactory",["$$connector","settings","OPERATION_TYPES",function(a,b,c){function d(a){return{id:a.id,title:a.nm,nm:a.nm,url:b.emotionServer+a.url,cat:a.cat}}function e(a){var b;if(a.sucs&&a.mdLst.length)for(b=0;b<a.mdLst.length;b++)i[a.mdLst[b].id]=d(a.mdLst[b]),k++;g()}function f(){var a=[];for(var b in i)i.hasOwnProperty(b)&&a.push(i[b]);return a}function g(){var a;for(var b in l)a=l[b],a&&a.$id&&!a.$$destroyed&&a.setEmotion.call(a,f())}function h(){k?g():a.send({actn:j.FETCH_EMOTION_LIST},j.REQUEST_TYPE.REQUEST)}var i={},j=c.SYSTEM,k=0,l={};a.subscribe(e,{action:j.FETCH_EMOTION_LIST});return{init:h,getEmotions:f,getLength:function(){return k},getEmotion:function(a,b){var c=angular.isObject(a)?a.id:a;return b?i[c]?i[c]:angular.isObject(a)?d(a):!1:i[c]||!1},setScopeForDigest:function(a){l[a.$id]=a},removeScope:function(a){l[a.$id]&&(l[a.$id]=null)}}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a){var b;switch(a.actn){case t.TYPE_PEOPLE_YOU_MAY_KNOW:if(a.sucs===!0){for(b=0;b<a.contactIds.length;b++)r.push(a.contactIds[b]);m()}else a.sucs===!1&&1111===a.rc&&l();break;case t.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:if(w.state.isRequestsLoading=!1,a.sucs===!0)for(b=0;b<a.contactList.length;b++)r.splice(r.indexOf(a.contactList[b].utId),1),q=d.create(a.contactList[b]),q.isFriend()||w.suggestionFriends.save(q.getUtId(),q);else a.sucs===!1&&1111===a.rc&&m()}}function l(){return b.send({actn:t.TYPE_PEOPLE_YOU_MAY_KNOW},u.REQUEST)}function m(a){return a=a||10,w.state.isRequestsLoading?void 0:(w.state.isRequestsLoading=!0,b.send({actn:t.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:r.slice(0,a)},u.REQUEST))}function n(a){var c={actn:v.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:a.getUId()};return b.pull(c,u.REQUEST)}function o(a,c){var d=h.defer(),e={actn:33,utId:a};return b.request(e,u.REQUEST).then(function(b){b.sucs===!0&&("remove"!==c&&f.addToUtIdList("outgoingUtIds",b.utId),w.suggestionFriends.remove(a),w.suggestionFriends.length()<5&&m(),d.resolve(b))},function(a){d.reject(a)}),d.promise}function p(a){s||b.subscribe(k,{action:[t.TYPE_PEOPLE_YOU_MAY_KNOW,t.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),s&&!a||(s=!0,l())}var q,r=[],s=!1,t=c.SYSTEM.FRIENDS,u=c.SYSTEM.REQUEST_TYPE,v=c.SYSTEM.PROFILE,w={init:p,state:{isRequestsLoading:!1},suggestionFriends:g.createNew(),getSuggestionContactsDetails:m,removeSuggestion:o,getMutualFriend:n,allSuggestionFriends:g.createNew(),noOfSuggestions:function(){return w.suggestionFriends.length()}};return w}angular.module("ringid.common.invite_factory",["ringid.config","ringid.common.user_factory","ringid.utils","ringid.connector"]).factory("InviteFactory",a),a.$inject=["$timeout","$$connector","OPERATION_TYPES","userFactory","Storage","friendsFactory","$$stackedMap","$$q","Auth","$rootScope"]}(),function(){"use strict";angular.module("ringid.common.factories",["ringid.common.user_factory","ringid.common.imagemap_factory","ringid.common.album_factory","ringid.common.comment_factory","ringid.common.emotion_factory","ringid.common.invite_factory"])}(),angular.module("ringid.common.rground_progress_directive",[]).directive("rgRoundProgress",[function(){var a=function(a,b,c){if(1===a.length){var d,e,f,g,h,i,j,k,l,m,n,o=a[0],p=document.createElement("canvas");return{pre:function(a,b,c,q){var r=(window.outerWidth-20)/1920;d=+(a.roundProgressBarStyle.dataRoundProgressWidth||"200")*r,e=+(a.roundProgressBarStyle.dataRoundProgressHeight||"200")*r,p.setAttribute("width",d),p.setAttribute("height",e),p.setAttribute("data-round-progress-model",o.getAttribute("data-round-progress-model")),o.parentNode.replaceChild(p,o),f=+(a.roundProgressBarStyle.dataRoundProgressOuterCircleWidth||"4")*r,g=+(a.roundProgressBarStyle.dataRoundProgressInnerCircleWidth||"8")*r,l=+(a.roundProgressBarStyle.dataRoundProgressOuterCircleRadius||"85")*r,m=+(a.roundProgressBarStyle.dataRoundProgressInnerCircleRadius||"85")*r,n=+(a.roundProgressBarStyle.dataRoundProgressLabelFont||"24")*r+"px Arial",h=a.roundProgressBarStyle.dataRoundProgressOuterCircleBackgroundColor||"#505769",i=a.roundProgressBarStyle.dataRoundProgressOuterCircleForegroundColor||"#13A8E8",j=a.roundProgressBarStyle.dataRoundProgressInnerCircleColor||"#505769",k=a.roundProgressBarStyle.dataRoundProgressLabelColor||"#fff"},post:function(a,b,c,h){var j=p.getAttribute("data-round-progress-model");a.$watch(j,function(a,b){var c=p.getContext("2d");c.clearRect(0,0,d,e);var h=d/2,j=e/2;c.beginPath(),c.arc(h,j,parseInt(m),0,2*Math.PI,!1),c.lineWidth=parseInt(g),c.strokeStyle="rgba(255,255,255,0.5)",c.globalCompositeOperation="source-over",c.stroke(),c.font=n,c.textAlign="center",c.textBaseline="middle",c.fillStyle=k,c.fillText(a.label+"%",h,j);var o=-(Math.PI/2),q=2*Math.PI*a.percentage-Math.PI/2,r=!1;c.beginPath(),c.arc(h,j,parseInt(l),o,q,r),c.lineWidth=parseInt(f),c.strokeStyle=i,c.stroke()},!0)}}}},b={compile:a,replace:!0};return b}]),function(){"use strict";function a(a){return{restrict:"A",link:function(b,c,d){c[0].onload=function(){b.$emit(a.FEED.HEIGHT,b.feedKey)},c[0].src=d.ogImageSrc}}}function b(a,b,c,d){return{restrict:"E",replace:!0,scope:{onClick:"&",ogData:"=",showPreview:"=",loadingData:"=",editMode:"@",feedKey:"@"},templateUrl:"",link:function(b,d,e){var f="pages/partials/url-og-preview.html";e.template&&(f=e.template),a.get(f).success(function(a){d.append(c(a)(b)),b.$rgDigest()})},controller:["$scope","$sce","settings",function(a,b,c){function e(){try{a.$parent.$parent?a.$parent.$parent.$rgDigest():a.$parent.$rgDigest()}catch(b){d.safeDigest(a)}}function f(){if(a.ogData&&!a.ogData.images){var b=a.ogData.url;b&&window.open(b,"_blank")}}function g(){a.ogData.images&&(a.ogData.image=a.ogData.images[a.selectedOgImageIndex])}function h(){a.ogData.image=""}function i(){a.ogData.title=""}function j(){a.ogData.description=""}function k(){a.ogData.url=""}function l(){a.ogData.lnkDmn=""}function m(b,c){a.ogData.meta[b]=c}function n(b,c){a.ogData.meta={youtube:!1,youtube_id:""}}function o(){a.selectedOgImageIndex<a.ogData.images.length-1&&(a.selectedOgImageIndex+=1),g(),e()}function p(){a.selectedOgImageIndex>0&&(a.selectedOgImageIndex-=1),g(),e()}function q(a){a.preventDefault(),a.stopPropagation(),h(),e()}function r(a){a.preventDefault(),a.stopPropagation(),i(),j(),k(),l(),e()}function s(){return!!a.ogData.images&&a.selectedOgImageIndex<a.ogData.images.length-1}function t(){return a.selectedOgImageIndex>0}function u(){return!!a.editMode&&!!a.ogData.image&&a.ogData.filteredImages.length>1}function v(){return!!a.editMode&&!a.filterOnProgress&&!!a.ogData.image}function w(){a.filterOnProgress=!0}function x(){a.filterOnProgress=!1}function y(b){a.ogData.filteredImages.push(b)}function z(b){a.ogData.filteredImages=[]}function A(b){a.ogData.image=b}function B(){return!a.ogData.meta&&a.ogData.url&&(n(),E(a.ogData.url)),!!a.ogData.meta&&a.ogData.meta.youtube}function C(){return a.ogData.meta.youtube_id}function D(){return b.trustAsResourceUrl("https://www.youtube.com/embed/"+C()+"?autoplay=0&autohide=1&border=0&wmode=opaque&enablejsapi=1")}function E(a){var b=/((http|https):\/{2})+((www\.)?youtube\.com)([?&]?([^=]+)=([^&]*))?/im;if(a){var c=a.match(b);c&&c[3]&&c[7]?(m("youtube",!0),m("youtube_id",c[7])):m("youtube",!1)}}function F(){z(),w();var b=a.ogData.images;d.filterImagesByDimentions(b,{width:200}).then(function(b){a.ogData.image||A(b),y(b),a.filterOnProgress&&x(),e()},function(){},function(b){y(b),a.ogData.image||A(b),e()})}a.selectedOgImageIndex=0,a.onClick=f,a.onImageCloseClick=q,a.onDetailCloseClick=r,a.selectPreviousImage=p,a.selectNextImage=o,a.shouldShowNextButton=s,a.shouldShowPreviousButton=t,a.isYoutubeUrl=B,a.getYoutubeUrl=D,a.filterOnProgress=!1,a.ogData.title=decodeEntities(a.ogData.title),a.ogData.description=decodeEntities(a.ogData.description),a.shouldShowNextPreviousButtonContainer=u,a.shouldShowImageCloseButton=v,a.init=function(){a.ogData&&a.ogData.url&&(n(),E(a.ogData.url),a.ogData.url&&(/^https?:\/\//.test(a.ogData.url)||(a.ogData.url="http://"+a.ogData.url)),a.ogData.image&&(/^https?:\/\//.test(a.ogData.image)||(a.ogData.image="http://"+a.ogData.image),c.secure&&/^http:/.test(a.ogData.image)&&(a.ogData.image=c.httpsUrl+"/ImageProxy.png?url="+a.ogData.image.replace(/http:\/\//,""))),a.ogData.images&&a.ogData.images.length>0&&F())},a.$watch("ogData",function(){a.init()})}]}}var c;try{c=angular.module("ringid.utils")}catch(d){return}c.directive("ogImageSrc",a),c.directive("rgUrlOgPreview",b),a.$inject=["SystemEvents"],b.$inject=["$ringhttp","$templateCache","$compile","utilsFactory"]}(),function(){"use strict";function a(a){return{restrict:"E",scope:{fetchedOgInfo:"=",editorContent:"=",showPreview:"=",filterOnProgress:"=",loadingData:"="},link:function(a,b,c){a.fetchedOgInfo=a.fetchedOgInfo||{},a.filterOnProgress&&(a.filterOnProgress=!1)},controller:["$scope","$rootScope","$timeout","utilsFactory","settings",function(a,b,c,d,e){function f(){try{a.$parent.$parent?a.$parent.$parent.$rgDigest():a.$parent.$rgDigest()}catch(b){d.safeDigest(a)}}function g(b,c){if(u(b,c)){if(b&&v.test(b)){var e=b.match(v),g=e[1];if(g){var o=e[5]?e[5]:"";if(/^https?:\/\//.test(g)||(g="http://"+g),!h(g))return;var w=j(g);w?(k(w),p(),t()):(m(),t(),f(),d.getOGDetails(g).success(function(a){n(),a&&a.sucs?(i(g,a),a.lnkDmn=o,a.url=g,a=s(a,g),k(a),p()):(l(),q()),t(),f()}).error(function(a){l(),r(),q(),n(),t(),f()}))}}else l(),q();a.$parent.$rgDigest()}}function h(b){return a.fetchedOgInfo&&x==b?!1:(x=b,!0)}function i(a,b){w[a]=b}function j(a){w[a]}function k(b){a.fetchedOgInfo=b}function l(){a.fetchedOgInfo={}}function m(){a.loadingData=!0}function n(){a.loadingData=!1}function o(){return a.loadingData}function p(){a.showPreview=!0}function q(){a.showPreview=!1}function r(){x=""}function s(a,b){var c=angular.extend({},a);if(c.url||(c.url=b),c.title||(c.title=c.lnkDmn),a.images)for(var d=a.images.length,f=0;d>f;f++)e.secure&&/^http:/.test(a.images[f])&&(a.images[f]=e.httpsUrl+"/ImageProxy.png?url="+a.images[f].replace(/http:\/\//,""));return c.title=decodeEntities(c.title),c.description=decodeEntities(c.description),c}function t(){c(function(){b.$broadcast("statusHeightChange")})}function u(b,c){return o()?!1:a.fetchedOgInfo&&(a.fetchedOgInfo.image||a.fetchedOgInfo.title||a.fetchedOgInfo.description)?!1:(r(),!0)}var v=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,w={},x="";a.$watch("editorContent",d.debounce(function(a,b){g(a,b),f()},500))}]}}var b;try{b=angular.module("ringid.utils")}catch(c){return}b.directive("rgUrlOgFetcher",a),a.$inject=["$compile"]}(),function(){"use strict";function a(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"pages/partials/loading_view.html"}}function b(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"pages/partials/loading_view1.html"}}function c(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"pages/partials/loading_view2.html"}}var d;try{d=angular.module("ringid.utils")}catch(e){return}d.directive("rgLoaderView",a),d.directive("rgLoaderView1",b),d.directive("rgLoaderView2",c)}(),function(){"use strict";function a(){this.dicts={maximize:"Back to normal view",minimize:"Go to small view",fullScreen:"Full Screen",playlist:"Playlist",auto:"Auto Play"},this.instances=[],this.template='<div class="rg-player"><div class="container"><div class="play-info"></div><div class="play-error"></div> <div class="music-bars"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><div class="big-play"><span class="icon-player"></span></div><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div><div class="player-poster"><img class="poster" /></div></div><div class="playlist-wrapper"></div><div class="media-control"><div class="media-tip"></div><div class="media-control-bg"></div><div class="media-control-layer"><div class="bar-panel"><div class="bar-container"><div class="bar-background"><div class="bar-fill-1"></div><div class="bar-fill-2"></div><div class="bar-hover"></div></div><div class="bar-scrubber"><div class="bar-scrubber-icon"></div></div><div class="seek-time"><div class="timer"></div></div></div></div><div class="control-left"><div class="play-btns"><button class="icon-previous-p control-btn prev-btn"></button><button class="icon-play-p control-btn start-btn"></button><button class="icon-next-p control-btn next-btn"></button></div><div class="volume-bar"><div class="icon-speaker-fill volume-icon unmute"></div><div class="volume-bar-container volume-bar-hide"><div data-rel="0" class="bar fill"></div><div data-rel="1" class="bar fill"></div><div data-rel="2" class="bar fill"></div><div data-rel="3" class="bar fill"></div><div data-rel="4" class="bar"></div><div data-rel="5" class="bar"></div><div data-rel="6" class="bar"></div><div data-rel="7" class="bar"></div><div data-rel="8" class="bar"></div><div data-rel="9" class="bar"></div></div></div><div class="time-indicator time-running"></div><div class="time-indicator time-total"></div></div><div class="control-right"><button class="control-btn hd">HD</button><button class="icon-minimize control-btn minimize" tooltip="'+this.dicts.minimize+'"></button><button class="icon-screen-f control-btn full-screen" tooltip="'+this.dicts.fullScreen+'"></button><button class="icon-play-list control-btn playlist-btn" tooltip="'+this.dicts.playlist+'"></button><button class="control-btn auto" tooltip="'+this.dicts.auto+'">AUTO</button></div></div></div></div>',
this.trackTemplate='<a rel="data-rel" href="#"><span class="list-thumb"><img src="data-thumb" /></span><span class="list-title">data-caption<b>data-duration</b></span></a>',this.secToTime=function(a){a=Math.floor(a);var b=parseInt(a/3600)%24,c=parseInt(a/60)%60,a=0>a?0:a%60,d="";return b>0&&(d+=10>b?"0"+b:b),d+=(10>c?"0"+c:c)+":"+(10>a?"0"+a:a)},this.findPos=function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}},this.destroy=function(a){try{a.removeEvent(),a.provider.pause(),a.provider.src="",a.dom=null,delete a.provider}catch(b){}},this.addRemoveClass=function(a,b,c){var d;for(d=0;d<c.length;d++)a.className=a.className.replace(c[d],"").trim();for(d=0;d<b.length;d++)a.className+=" "+b[d]},this.createMediaObject=function(a){return"audio"==a?document.createElement("audio"):document.createElement("video")},this.getDefaultThumb=function(a){return a&&"images/default_audio_image.jpg"!=a||(a="images/player-audio.png"),a},this.$get=["$compile","$document",function(a,b){var c=this,d={};return d.escapeKey=!1,d.miniPlayer={dom:{container:null,move:null,resize:null,maximize:null,close:null},parent:null,player:null},d.wh=window.innerHeight,d.destroy=function(){c.instances.length>0&&c.destroy(c.instances.pop())},d.destroyAll=function(){for(var a=c.instances.length-1;a>=0;a--)c.destroy(c.instances.pop())},d.toggleMinMax=function(){for(var a,b=c.instances.length-1;b>=0;b--)if(!c.instances[b].chat){a=c.instances[b];break}a.minimize()},d.showMiniPlayer=function(){d.miniPlayer.player&&(d.miniPlayer.dom.container.appendChild(d.miniPlayer.player.parent),d.miniPlayer.dom.container.style.display="block","PLAYING"==d.miniPlayer.player.playingState&&setTimeout(function(){d.miniPlayer.player.provider.play()}))},d.closeMiniPlayer=function(){d.miniPlayer.player&&(d.ringboxRemove(),d.destroy(),d.miniPlayer.dom.container.parentNode.removeChild(d.miniPlayer.dom.container),d.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},d.miniPlayer.player=null)},d.addToPlaylist=function(a){for(var b=c.instances.length-1;b>=0;b--)if(!c.instances[b].chat){c.instances[b].AddToPlaylist(a);break}},d.player=function(b){function e(){var a=document.mozFullScreen||document.webkitIsFullScreen;a||"FULL"!=N.screenState||N.fullScreen()}function f(a){var b=a.which||a.keyCode||a.key;d.miniPlayer.player||32===b&&N.playPause()}function g(a){a.stopPropagation(),N.playPause()}function h(a){a.stopPropagation(),N.playNext()}function i(a){a.stopPropagation(),N.playPrev()}function j(a){a.stopPropagation(),N.muteUnmute()}function k(a){a.stopPropagation(),N.fullScreen()}function l(a){a.stopPropagation(),N.minimize()}function m(a){N.timeInfo(a),N.isMouseDown&&N.setPosition(a,!1)}function n(a){N.isMouseDown=!0,c.addRemoveClass(N.dom.barContainer,["down"],[])}function o(a){N.isMouseDown=!1,N.setPosition(a,!0),c.addRemoveClass(N.dom.barContainer,[],["down"])}function p(a){N.isMouseDown=!1,c.addRemoveClass(N.dom.barContainer,[],["down"])}function q(a){return a.stopPropagation(),N.playlistState?void N.showPlaylist(!1):void N.playPause()}function r(a){a.stopPropagation(),N.showControl(!0)}function s(a){a.stopPropagation(),N.showControl(!1)}function t(a){a.stopPropagation(),d.miniPlayer.player&&N.maximize(),N.showPlaylist()}function u(a){a.stopPropagation(),N.setAuto()}function v(a){a.stopPropagation(),N.showTootip(a,this.getAttribute("tooltip"))}function w(a){a.stopPropagation(),N.dom.controlTip.style.display="none"}function x(a){a.stopPropagation(),N.showTootip(a,this.getAttribute("tooltip"))}function y(a){a.stopPropagation(),N.dom.controlTip.style.display="none"}function z(a){a.stopPropagation(),N.showTootip(a,this.getAttribute("tooltip"))}function A(a){a.stopPropagation(),N.dom.controlTip.style.display="none"}function B(a){a.stopPropagation(),N.showTootip(a,this.getAttribute("tooltip"))}function C(a){a.stopPropagation(),N.dom.controlTip.style.display="none"}function D(a){a.stopPropagation();var b=parseInt(this.getAttribute("data-rel"));N.changeVolume(b)}function E(a){S=!0,R&&fastdom.read(function(){d.miniPlayer.dom.resize&&(document.body.style.cursor="move",d.miniPlayer.dom.resize.style.cursor="move",N.dom.container.style.cursor="move",fastdom.write(function(){a.clientX+O>=200&&a.clientX+O<=X-U-210&&(d.miniPlayer.dom.container.style.left=a.clientX+O+"px"),a.clientY+P>=50&&a.clientY+P<=W-V&&(d.miniPlayer.dom.container.style.top=a.clientY+P+"px")}))})}function F(a){a.stopPropagation(),R=!1,document.body.style.cursor="default",d.miniPlayer.dom.resize.style.cursor="ns-resize",N.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",F)}function G(a){a.preventDefault(),a.stopPropagation(),R=!0,X=window.innerWidth,W=window.innerHeight,O=d.miniPlayer.dom.container.offsetLeft-a.clientX,P=d.miniPlayer.dom.container.offsetTop-a.clientY,document.addEventListener("mousemove",E,!1),document.addEventListener("mouseup",F,!1)}function H(a){return S?void(S=!1):void N.playPause()}function I(a){T&&fastdom.read(function(){if(d.miniPlayer.dom.container){var b=d.miniPlayer.dom.container.offsetHeight,c=parseInt(d.miniPlayer.dom.container.style.top.replace("px",""));fastdom.write(function(){document.body.style.cursor="ns-resize",d.miniPlayer.dom.move.style.cursor="ns-resize",N.dom.container.style.cursor="ns-resize",Q>=a.clientY&&250>b&&(b+=3,c-=3,d.miniPlayer.dom.container.style.height=b+"px",d.miniPlayer.dom.container.style.top=c+"px",Q=a.clientY),Q<a.clientY&&b>120&&(b-=3,c+=3,d.miniPlayer.dom.container.style.height=b+"px",d.miniPlayer.dom.container.style.top=c+"px",Q=a.clientY)})}})}function J(a){a.stopPropagation(),T=!1,document.body.style.cursor="default",d.miniPlayer.dom.move.style.cursor="move",N.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",J)}function K(a){a.preventDefault(),a.stopPropagation(),T=!0,X=window.innerWidth,W=window.innerHeight,Q=a.clientY,document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",J,!1)}function L(a){a.preventDefault(),a.stopPropagation(),N.maximize()}function M(a){a.preventDefault(),a.stopPropagation(),d.closeMiniPlayer()}d.ringboxRemove=b.ringboxRemove?b.ringboxRemove:function(){},b.chatVersion||d.closeMiniPlayer();var N={};N.source=b.source||"",N.autoPlay=b.autoPlay||!1,N.showMinMax=b.showMinMax||!1,N.auto=b.auto||!1,N.parent=document.getElementById(b.parentId),N.poster=b.poster||"",N.mediaType=b.type||"video",N.dom={},N.playingState=this.autoPlay?"INIT":"STOPPED",N.screenState="NORMAL",N.volumeState="UNMUTE",N.volume=5,N.duration=0,N.currentTrack=0,N.playlist=b.playlist||[],N.title=b.title||"",N.playlistState=!1,N.hd=!1,N.isMouseDown=!1,N.isLoading=N.autoPlay,N.isFirefox=!!navigator.userAgent.match(/firefox/i),N.canPlay=!0,N.chat=!!b.chatVersion,N.provider=c.createMediaObject(N.mediaType),N.parent.innerHTML=c.template,N.dom.player=N.parent.querySelector(".rg-player"),N.dom.container=N.parent.querySelector(".container"),N.dom.playlistWrap=N.parent.querySelector(".playlist-wrapper"),N.dom.control=N.parent.querySelector(".media-control"),N.dom.bigBlay=N.dom.container.querySelector(".big-play"),N.dom.bigBlayIcon=N.dom.bigBlay.querySelector("span"),N.dom.playError=N.dom.container.querySelector(".play-error"),N.dom.playInfo=N.dom.container.querySelector(".play-info"),N.dom.musicBar=N.dom.container.querySelector(".music-bars"),N.dom.loader=N.dom.container.querySelector(".loader"),N.dom.poster=N.dom.container.querySelector(".player-poster"),N.dom.posterImg=N.dom.poster.querySelector(".poster"),N.dom.barContainer=N.dom.control.querySelector(".bar-container"),N.dom.barScrubber=N.dom.control.querySelector(".bar-scrubber"),N.dom.barLoaded=N.dom.control.querySelector(".bar-fill-1"),N.dom.barPosition=N.dom.control.querySelector(".bar-fill-2"),N.dom.barHover=N.dom.control.querySelector(".bar-hover"),N.dom.controlLayer=N.dom.control.querySelector(".media-control-layer"),N.dom.controlBG=N.dom.control.querySelector(".media-control-bg"),N.dom.controlTip=N.dom.control.querySelector(".media-tip"),N.dom.playBtn=N.dom.control.querySelector(".start-btn"),N.dom.nextBtn=N.dom.control.querySelector(".next-btn"),N.dom.prevBtn=N.dom.control.querySelector(".prev-btn"),N.dom.timeRunning=N.dom.control.querySelector(".time-running"),N.dom.timeTotal=N.dom.control.querySelector(".time-total"),N.dom.hd=N.dom.control.querySelector(".hd"),N.dom.playlistBtn=N.dom.control.querySelector(".playlist-btn"),N.dom.minimize=N.dom.control.querySelector(".minimize"),N.dom.auto=N.dom.control.querySelector(".auto"),N.dom.volumeIcon=N.dom.control.querySelector(".volume-icon"),N.dom.volumeBarContainer=N.dom.control.querySelector(".volume-bar-container"),N.dom.volumeBars=N.dom.volumeBarContainer.querySelectorAll(".bar"),N.dom.fullScreenBtn=N.dom.control.querySelector(".full-screen"),N.dom.seekTimer=N.dom.control.querySelector(".seek-time"),N.dom.timer=N.dom.control.querySelector(".timer"),N.dom.playlist=null,N.dom.player.style.width=b.width?b.width+"px":"100%",N.dom.player.style.height=b.height?b.height+"px":"100%",N.dom.timeRunning.innerHTML="00:00",N.dom.timeTotal.innerHTML="00:00",!b.chatVersion&&N.showMinMax||(N.dom.minimize.style.display="none"),N.dom.poster.appendChild(N.provider),d.miniPlayer.parent=N.parent.parentNode;var O,P,Q,R=!1,S=!1,T=!1,U=350,V=120,W=window.innerHeight,X=window.innerWidth;return N.initEvent=function(){N.dom.playBtn.addEventListener("click",g,!1),N.dom.nextBtn.addEventListener("click",h,!1),N.dom.prevBtn.addEventListener("click",i,!1),N.dom.volumeIcon.addEventListener("click",j,!1),N.dom.fullScreenBtn.addEventListener("click",k,!1),N.dom.minimize.addEventListener("click",l,!1),N.dom.barContainer.addEventListener("mousemove",m,!1),N.dom.barContainer.addEventListener("mousedown",n,!1),N.dom.barContainer.addEventListener("mouseup",o,!1),N.dom.barContainer.addEventListener("mouseleave",p,!1),N.dom.container.addEventListener("click",q,!1),N.dom.player.addEventListener("mouseover",r,!1),N.dom.player.addEventListener("mouseleave",s,!1),N.dom.playlistBtn.addEventListener("click",t,!1),N.dom.auto.addEventListener("click",u,!1);for(var a=0;a<N.dom.volumeBars.length;a++)N.dom.volumeBars[a].addEventListener("click",D);N.dom.auto.addEventListener("mouseover",v,!1),N.dom.auto.addEventListener("mouseleave",w,!1),N.dom.minimize.addEventListener("mouseover",x,!1),N.dom.minimize.addEventListener("mouseleave",y,!1),N.dom.fullScreenBtn.addEventListener("mouseover",z,!1),N.dom.fullScreenBtn.addEventListener("mouseleave",A,!1),N.dom.playlistBtn.addEventListener("mouseover",B,!1),N.dom.playlistBtn.addEventListener("mouseleave",C,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("fullscreenchange",e,!1),document.addEventListener("keyup",f,!1),N.setMediaEvent(),N.createPlaylist(),N.showPoster(!0),N.auto&&N.setAuto(!0)},N.setMediaEvent=function(){N.provider.addEventListener("loadedmetadata",function(a,b){N.initTime(N.provider.duration),N.autoPlay&&N.play()}),N.provider.addEventListener("progress",function(){var a=N.provider.buffered.length>0?N.provider.buffered.end(N.provider.buffered.length-1):0,b=N.provider.currentTime+.05>=a?"BUFFERING":"PLAYING_BUFFERING";N.showBuffered(a,N.provider.duration),N.stateChanged(b)}),N.provider.addEventListener("timeupdate",function(){N.provider&&!N.isMouseDown&&N.showPosition(N.provider.currentTime,N.provider.duration)}),N.provider.addEventListener("play",function(){N.stateChanged("PLAYING"),"video"==N.mediaType&&N.showPoster(!1),angular.isFunction(b.scope.onStart())&&b.scope.onStart()()}),N.provider.addEventListener("pause",function(){N.stateChanged("PAUSED"),"video"==N.mediaType&&N.showPoster(!1)}),N.provider.addEventListener("ended",function(){N.stateChanged("ENDED"),"video"==N.mediaType&&N.showPoster(!1),angular.isFunction(b.scope.onEnded())&&b.scope.onEnded()()}),N.provider.addEventListener("stalled",function(){!N.provider}),N.provider.addEventListener("error",function(){N.provider&&(N.error=N.provider.error.code,N.canPlay=!1,N.showError())})},N.removeEvent=function(){N.dom.playBtn.removeEventListener("click",g),N.dom.nextBtn.removeEventListener("click",h),N.dom.prevBtn.removeEventListener("click",i),N.dom.volumeIcon.removeEventListener("click",j),N.dom.fullScreenBtn.removeEventListener("click",k),N.dom.minimize.removeEventListener("click",l),N.dom.barContainer.removeEventListener("mousemove",m),N.dom.barContainer.removeEventListener("mousedown",n),N.dom.barContainer.removeEventListener("mouseup",o),N.dom.barContainer.removeEventListener("mouseleave",p),N.dom.container.removeEventListener("click",q),N.dom.player.removeEventListener("mouseover",r),N.dom.player.removeEventListener("mouseleave",s),N.dom.playlistBtn.removeEventListener("click",t),N.dom.auto.removeEventListener("click",u);for(var a=0;a<N.dom.volumeBars.length;a++)N.dom.volumeBars[a].removeEventListener("click",D);N.dom.auto.removeEventListener("mouseover",v),N.dom.auto.removeEventListener("mouseleave",w),N.dom.minimize.removeEventListener("mouseover",x),N.dom.minimize.removeEventListener("mouseleave",y),N.dom.fullScreenBtn.removeEventListener("mouseover",z),N.dom.fullScreenBtn.removeEventListener("mouseleave",A),N.dom.playlistBtn.removeEventListener("mouseover",B),N.dom.playlistBtn.removeEventListener("mouseleave",C),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("fullscreenchange",e),document.removeEventListener("keyup",f)},N.maximize=function(){return d.miniPlayer.player?(b.ringboxMaximize(d.miniPlayer.parent,N.parent),"PLAYING"==N.playingState&&setTimeout(function(){N.provider.play()}),d.miniPlayer.dom.move.removeEventListener("mousedown",G),d.miniPlayer.dom.move.removeEventListener("click",H),d.miniPlayer.dom.resize.removeEventListener("mousedown",K),d.miniPlayer.dom.close.removeEventListener("click",M),d.miniPlayer.dom.maximize.removeEventListener("click",L),d.miniPlayer.dom.container.parentNode.removeChild(d.miniPlayer.dom.container),d.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},d.miniPlayer.player=null,c.addRemoveClass(N.dom.minimize,["icon-minimize"],["icon-maximize"]),N.dom.fullScreenBtn.style.display="block",void N.dom.minimize.setAttribute("tooltip",c.dicts.minimize)):void 0},N.minimize=function(){if(d.miniPlayer.player)return void N.maximize();var a=document.createElement("div"),e=document.createElement("a"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("a");h.setAttribute("class","mini-close"),h.innerHTML='<div class="icon-close pop-close"></div>',e.setAttribute("class","maximize icon-maximize"),e.setAttribute("style","position: absolute;right: 22px;top: 5px;color: #fff;"),f.setAttribute("class","move-player"),f.appendChild(e),f.appendChild(h),a.setAttribute("id","mini-player"),a.setAttribute("class","mini-player"),g.setAttribute("class","resize-player"),a.style.display="none",a.appendChild(f),a.appendChild(g),document.body.appendChild(a),N.showPlaylist(!0),N.showControl(!0),d.miniPlayer.dom.container=a,d.miniPlayer.dom.resize=g,d.miniPlayer.dom.move=f,d.miniPlayer.dom.close=h,d.miniPlayer.dom.maximize=e,d.miniPlayer.player=N,N.dom.minimize.setAttribute("tooltip",c.dicts.maximize),b.ringboxMinimize(),W="FULL"==N.screenState?d.wh:window.innerHeight,a.style.top=W-V+"px",c.addRemoveClass(N.dom.minimize,["icon-maximize"],["icon-minimize"]),N.dom.fullScreenBtn.style.display="none",h.addEventListener("click",M,!1),e.addEventListener("click",L,!1),f.addEventListener("mousedown",G,!1),f.addEventListener("click",H,!1),g.addEventListener("mousedown",K,!1),h=e=g=f=a=null},N.playPause=function(){return N.canPlay?"PLAYING"==N.playingState?(N.pause(),N.showLoader(),N.showBigPlay(),N.showControl(!1),N.showPlaylist(!0),void N.showInfo(!0)):"PAUSED"==N.playingState?(N.resume(),N.showLoader(),N.showBigPlay(),void N.showInfo()):"STOPPED"==N.playingState?(N.play(),N.showLoader(),N.showBigPlay(),N.showPlaylist(!0),void N.showInfo()):void 0:void 0},N.muteUnmute=function(){return"UNMUTE"==N.volumeState?(N.setVolume(0),c.addRemoveClass(N.dom.volumeIcon,["icon-speaker-m"],["icon-speaker-fill"]),void(N.volumeState="MUTE")):"MUTE"==N.volumeState?(N.setVolume(N.volume),c.addRemoveClass(N.dom.volumeIcon,["icon-speaker-fill"],["icon-speaker-m"]),void(N.volumeState="UNMUTE")):void 0},N.initTime=function(a){N.dom.timeTotal.innerHTML=c.secToTime(a),N.duration=a},N.showPosition=function(a,b){0==N.duration&&b>0&&N.initTime(b),a>b&&N.initTime(a),N.dom.timeRunning.innerHTML=c.secToTime(a),N.dom.barScrubber.style.left=0==N.duration?"-"+N.dom.barScrubber.offsetWidth/2+"px":"calc("+a/N.duration*100+"% - "+N.dom.barScrubber.offsetWidth/2+"px)",N.dom.barPosition.style.width=0==N.duration?"0%":a/N.duration*100+"%"},N.showBuffered=function(a,b){0==N.duration&&b>0&&N.initTime(b),N.dom.barLoaded.style.width=0==N.duration?"0%":a/N.duration*100+"%"},N.timeInfo=function(a){var b="FULL"==N.screenState?{x:0,y:0}:c.findPos(N.dom.barContainer),d=a.pageX-b.x,e=Math.round(d*N.duration/N.dom.barContainer.offsetWidth);0>e&&(e=0),N.dom.timer.innerHTML=c.secToTime(e),N.dom.seekTimer.style.left=d-N.dom.seekTimer.offsetWidth/2+"px",N.dom.barHover.style.left=d-N.dom.barHover.offsetWidth/2+"px"},N.showTootip=function(a,b){var d="FULL"==N.screenState?{x:0,y:0}:c.findPos(N.dom.barContainer),e=a.pageX-d.x;N.dom.controlTip.innerHTML=b,N.dom.controlTip.style.display="block";var f=N.dom.barContainer.offsetWidth,g=N.dom.controlTip.offsetWidth;e=g/2+e>=f?f-g/2:e,N.dom.controlTip.style.left=e-g/2+"px"},N.setPosition=function(a,b){if("STOPPED"!=N.playingState&&N.canPlay){var d="FULL"==N.screenState?{x:0,y:0}:c.findPos(N.dom.barContainer),e=a.pageX-d.x,f=Math.round(e*N.duration/N.dom.barContainer.offsetWidth);b&&N.seek(f),N.showPosition(f)}},N.changeVolume=function(a){var b;for(b=0;b<N.dom.volumeBars.length;b++)c.addRemoveClass(N.dom.volumeBars[b],[],["fill"]);for(b=0;a>=b;b++)c.addRemoveClass(N.dom.volumeBars[b],["fill"],[]);return N.volume=a+1,"MUTE"==N.volumeState?void N.muteUnmute():void N.setVolume(N.volume)},N.showHD=function(){N.hd?N.dom.hd.style.display="inline-block":N.dom.hd.style.display="none"},N.showPoster=function(a){""!=N.poster&&(a?(N.dom.posterImg.src=N.poster,N.dom.posterImg.style.display="inline-block"):N.dom.posterImg.style.display="none")},N.showInfo=function(a){if(""==N.title||"audio"!=N.mediaType||a?N.dom.playInfo.style.display="none":(N.dom.playInfo.innerHTML=N.title,N.dom.playInfo.style.display="block"),N.playlist.length>0){var b=N.playlist[N.currentTrack].value.getThumb();b=c.getDefaultThumb(b),N.poster=b,"audio"==N.mediaType&&N.showPoster(!0)}},N.showLoader=function(){N.isLoading&&N.canPlay?N.dom.loader.style.display="block":N.dom.loader.style.display="none",N.showMusicBar(),N.showBigPlay()},N.showError=function(){N.dom.playError.innerHTML="Sorry, your browser does not support this media format.",N.showLoader(),N.canPlay?N.dom.playError.style.display="none":(N.showPoster(!1),N.dom.playError.style.display="block")},N.showBigPlay=function(a){return N.canPlay?(a?c.addRemoveClass(N.dom.bigBlayIcon,["icon-reload-p"],[]):c.addRemoveClass(N.dom.bigBlayIcon,[],["icon-reload-p"]),"PAUSED"!=N.playingState&&"STOPPED"!=N.playingState||N.isLoading?N.dom.bigBlay.style.display="none":N.dom.bigBlay.style.display="block",void N.showMusicBar()):void(N.dom.bigBlay.style.display="none")},N.initPlaylist=function(){N.playlist.length>1?(N.dom.playlistBtn.style.display="inline-block",N.dom.prevBtn.style.display="inline-block",N.dom.nextBtn.style.display="inline-block",N.dom.auto.style.display="inline-block"):(N.dom.playlistBtn.style.display="none",N.dom.prevBtn.style.display="none",N.dom.nextBtn.style.display="none",N.dom.auto.style.display="none"),N.dom.playlistWrap.style.right="-250px"},N.showPlaylist=function(a){return N.playlistState||a?(N.dom.playlistWrap.style.right="-250px",N.dom.playlistWrap.style.zIndex=999,void(N.playlistState=!1)):N.playlistState?void 0:(N.dom.playlistWrap.style.right="0",N.dom.playlistWrap.style.zIndex=1e4,void(N.playlistState=!0))},N.createPlaylist=function(){if(!(N.playlist.length<2)){for(var d,e,f='<div class="playlist-scrollbar-wrapper"><div rg-scrollbar="true" class="playlist-scrollbar"><ul class="playlist">',g=0;g<N.playlist.length;g++)d=N.playlist[g].value.getThumb(),d=c.getDefaultThumb(d),e=c.trackTemplate.replace(/data-rel/g,g),e=e.replace(/data-thumb/g,d),e=e.replace(/data-caption/g,N.playlist[g].value.getCaption()),e=e.replace(/data-duration/g,c.secToTime(N.playlist[g].value.getDuration())),N.source==N.playlist[g].value.getStreamUrl()&&(N.currentTrack=g),f+="<li>"+e+"</li>";f+="</ul></div></div>",N.dom.playlistWrap.innerHTML="",N.dom.playlistWrap.appendChild(a(f)(b.scope)[0]),N.dom.playlistUL=N.dom.playlistWrap.querySelector(".playlist"),N.dom.playlist=N.dom.playlistWrap.querySelectorAll("ul.playlist > li > a"),b.scope.$parent.$rgDigest();for(var g=0;g<N.dom.playlist.length;g++)N.dom.playlist[g].addEventListener("click",function(a){a.preventDefault(),N.currentTrack=this.getAttribute("rel"),N.title=N.playlist[N.currentTrack].value.getCaption(),N.load(N.playlist[N.currentTrack].value.getStreamUrl())})}},N.updatePlaylist=function(a){a&&(N.playlist=a,N.createPlaylist())},N.AddToPlaylist=function(a){var b,d;if(!N.dom.playlistUL)return void N.updatePlaylist(a);if(a&&N.dom.playlistUL)for(var e=0;e<a.length;e++){var f=document.createElement("li");b=a[e].value.getThumb(),b=c.getDefaultThumb(b),d=c.trackTemplate.replace(/data-rel/g,e),d=d.replace(/data-thumb/g,b),d=d.replace(/data-caption/g,a[e].value.getCaption()),d=d.replace(/data-duration/g,c.secToTime(a[e].value.getDuration())),f.innerHTML=d,N.dom.playlistUL.appendChild(f)}},N.setTrack=function(){if(!(N.playlist.length<2)){0==N.currentTrack?c.addRemoveClass(N.dom.prevBtn,["disabled"],[]):c.addRemoveClass(N.dom.prevBtn,[],["disabled"]),N.currentTrack==N.playlist.length-1?c.addRemoveClass(N.dom.nextBtn,["disabled"],[]):c.addRemoveClass(N.dom.nextBtn,[],["disabled"]);for(var a=0;a<N.dom.playlist.length;a++)a==N.currentTrack?c.addRemoveClass(N.dom.playlist[a],["active"],["active"]):c.addRemoveClass(N.dom.playlist[a],[],["active"]);N.showInfo()}},N.setAuto=function(a){return a?void c.addRemoveClass(N.dom.auto,["enbled"],[]):N.auto?(N.auto=!1,void c.addRemoveClass(N.dom.auto,[],["enbled"])):N.auto?void 0:(N.auto=!0,void c.addRemoveClass(N.dom.auto,["enbled"],[]))},N.showMusicBar=function(){"audio"!=N.mediaType||"PLAYING"!=N.playingState||N.isLoading?N.dom.musicBar.style.display="none":N.dom.musicBar.style.display="block"},N.showControl=function(a){return d.miniPlayer.player?void(N.dom.controlLayer.style.bottom="0px"):void("PLAYING"==N.playingState&&a?(N.dom.controlLayer.style.bottom="0px",N.dom.controlBG.style.opacity=1):(N.dom.controlLayer.style.bottom="-60px",N.dom.controlBG.style.opacity=0))},N.stateChanged=function(a){"BUFFERING"==a?N.isLoading=!0:N.isLoading=!1,N.showLoader(),"PLAYING"==a&&(N.playingState="PLAYING",N.showBigPlay(),c.addRemoveClass(N.dom.playBtn,["icon-pause-p"],["icon-play-p"])),"ENDED"!=a&&"IDLE"!=a||(N.playingState="STOPPED",N.showBigPlay(!0),N.showPlaylist(!0),c.addRemoveClass(N.dom.playBtn,["icon-play-p"],["icon-pause-p"]),N.initTime(0),N.showPosition(0),N.showInfo(!0),N.auto&&N.playlist.length>0&&N.playNext())},N.reset=function(){N.isLoading=!0,N.initTime(0),N.showPosition(0),N.showBuffered(0),N.showLoader(),N.showInfo()},N.fullScreen=function(){if("NORMAL"==N.screenState){if(N.dom.player.requestFullscreen)N.dom.player.requestFullscreen();else if(N.dom.player.mozRequestFullScreen)N.dom.player.mozRequestFullScreen();else{if(!N.dom.player.webkitRequestFullScreen)return!1;N.dom.player.webkitRequestFullScreen()}return N.screenState="FULL",N.showControl(!0),c.addRemoveClass(N.dom.player,["full"],[]),c.addRemoveClass(N.dom.fullScreenBtn,["icon-screen-fe"],["icon-screen-f"]),d.miniPlayer.dom.container&&c.addRemoveClass(d.miniPlayer.dom.container,["full"],[]),N.dom.fullScreenBtn.setAttribute("tooltip",c.dicts.maximize),!0}return"FULL"==N.screenState?(document.cancelFullscreen?document.cancelFullscreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),c.addRemoveClass(N.dom.player,[],["full"]),c.addRemoveClass(N.dom.fullScreenBtn,["icon-screen-f"],["icon-screen-fe"]),d.miniPlayer.dom.container&&c.addRemoveClass(d.miniPlayer.dom.container,[],["full"]),N.showControl(!1),N.screenState="NORMAL",d.escapeKey=!0,N.dom.fullScreenBtn.setAttribute("tooltip",c.dicts.fullScreen),!0):void 0},N.playNext=function(){N.currentTrack!=N.playlist.length-1&&(N.currentTrack++,N.title=N.playlist[N.currentTrack].value.getCaption(),N.load(N.playlist[N.currentTrack].value.getStreamUrl()),b.onNext&&b.onNext.apply(b.scope))},N.playPrev=function(){0!=N.currentTrack&&(N.currentTrack--,N.title=N.playlist[N.currentTrack].value.getCaption(),N.load(N.playlist[N.currentTrack].value.getStreamUrl()),b.onNext&&b.onNext.apply(b.scope))},N.getPlaylistUI=function(){return N.dom.playlistWrap},N.getNextUI=function(){return N.dom.nextBtn},N.getPrevUI=function(){return N.dom.prevBtn},N.load=function(a){N.reset(),N.setTrack(),N.provider.pause(),N.seek(0),N.provider.src=a,N.source=a,angular.isFunction(b.scope.onChange())&&N.playlist.length>0&&b.scope.onChange()(N.playlist[N.currentTrack].value)},N.play=function(){N.provider.play(),N.playingState="PLAYING",c.addRemoveClass(N.dom.playBtn,["icon-pause-p"],["icon-play-p"])},N.pause=function(){N.provider.pause(),N.playingState="PAUSED",c.addRemoveClass(N.dom.playBtn,["icon-play-p"],["icon-pause-p"])},N.resume=function(){N.provider.play(),N.playingState="PLAYING",c.addRemoveClass(N.dom.playBtn,["icon-pause-p"],["icon-play-p"])},N.seek=function(a){try{N.provider.currentTime=a}catch(b){}},N.stop=function(){N.provider.pause(),N.seek(0),N.playingState="STOPPED",c.addRemoveClass(N.dom.playBtn,["icon-play-p"],["icon-pause-p"])},N.setVolume=function(a){N.provider.volume=a/10},N.initEvent(),N.showControl(),N.showLoader(),N.showBigPlay(),N.showError(),N.showInfo(),N.showMusicBar(),N.initPlaylist(),N.showHD(),N.playingState="STOPPED",N.provider.autoPlay=!1,N.load(b.source),N.setVolume(N.volume),c.instances.push(N),N},d}]}function b(a,b,c){function d(a,d,e){var f=e.id?e.id:"player_1",g=e.width?e.width:"100%",h=e.height?e.height:"100%",i="false"!=e.auto&&0!=e.auto,j=e.url?e.url:"",k=e.title?e.title:"",l="true"==e.isVideo||0==e.isVideo?"video":"audio",m=e.poster?e.poster:"audio"==l?"images/player-audio.png":"",n="false"!=e.autoPlay&&0!=e.autoPlay,o="true"==e.chat||1==e.chat,p=null,q=null;m&&"default_audio_image.jpg"!=m||(m="images/player-audio.png");var r='<div id="player_'+f+'" class="player '+l+'"></div>';d.append(r),setTimeout(function(){p=b.player({source:j,title:k,playlist:a.playlist,auto:i,type:l,parentId:"player_"+f,autoPlay:n,chatVersion:o,width:g,height:h,poster:m,ringboxMinimize:c.minimize,ringboxMaximize:c.maximize,ringboxRemove:c.removeMinimize,scope:a}),q=d[0].closest(".ringbox-inner").querySelector(".player-size"),q.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),p.minimize()},!1)}),a.$on("$destroy",function(){q=null})}return{restrict:"E",scope:{onChange:"&",onStart:"&",onEnded:"&",playlist:"="},link:d}}angular.module("ringid.common.rgplayer_directive",[]).provider("$player",a).directive("rgPlayer",b),b.$inject=["$compile","$player","$ringbox"]}(),function(){"use strict";function a(a,b){return{restrict:"E",template:'<a class="glo-l ng-cloak"> <span class="load-circle"><span class="ld-cir1 glo-cir"></span><span class="ld-cir2 glo-cir"></span><span class="ld-cir3 glo-cir"></span><span class="ld-cir4 glo-cir"></span><span class="ld-cir5 glo-cir"></span><span class="ld-cir6 glo-cir"></span><span class="ld-cir7 glo-cir"></span><span class="ld-cir8 glo-cir"></span><span class="ld-cir9 glo-cir"></span><span class="ld-cir10 glo-cir"></span><span class="ld-cir11 glo-cir"></span><span class="ld-cir12 glo-cir"></span></span><span class="glo-type">Processing...</span></a>',scope:{rgLoadingObj:"="},link:function(c,d){a.$on(b.AUTH.LOGIN,function(){d[0].style.display="none",c.$rgDigest()}),a.$on(b.LOADING,function(a,b){b?d[0].style.display="block":d[0].style.display="none"}),d[0].style.display="none"}}}angular.module("ringid.common.rgloading_directive",[]).directive("rgLoading",a),a.$inject=["$rootScope","SystemEvents"]}(),function(){"use strict";function a(){var a,b;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(b="new",a=navigator.mediaDevices.getUserMedia):(b="old",a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),{gum:a,version:b}}function b(b){var c=this,d="old",e=null,f={recordedImage:{width:0,height:0,image:""},recordedVideo:{width:0,height:0,video:""},mediaPreview:{width:400,height:400},mediaStream:"",mediaObject:"",isStreaming:!1,text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser"}};angular.extend(f,b);var g=function(){},h=function(){};this._callbacks={streamReady:g,error:h};var i=function(){var b=a();e=b.gum,d=b.version},j=function(){c.getMediaObject().readyState>3?c.onCanPlay():c.getMediaObject().addEventListener("canplay",c.onCanPlay,!1)},k=function(a){var b=document.createElement("video"),c=window.URL||window.webkitURL;return b.src=c.createObjectURL(a),b.autoplay=!0,b},l=function(a){f.mediaStream=a,f.mediaObject=k(a),j()},m=function(a){var b;b="DevicesNotFoundError"==a.name||"OverconstrainedError"==a.name?f.text.WEBCAM_DISCONNECTED:"PermissionDeniedError"==a.name?f.text.PERMISSION_DENINED:f.text.GUM_NOT_SUPPORTED,c.triggerEvent("error",{text:b})};c.on=function(a,b){c._callbacks[a]=b},c.triggerEvent=function(a,b){c._callbacks[a]&&c._callbacks[a].call(c,b)},c.getProps=function(){return f},c.getMediaPreview=function(){return f.mediaPreview},c.getMediaObject=function(){return f.mediaObject},c.getStream=function(){return f.mediaStream},c.setStream=function(a){f.mediaStream=a},c.isStreaming=function(a){return a?void(f.isStreaming=a):f.isStreaming},c.startRecording=function(){c.getStream().record()},c.stopRecording=function(){var a=c.getStream();if(a.getTracks){var b=a.getTracks();b.forEach(function(a){a.stop()})}else a.stop()},c.getRecordedMedia=function(a){c.getStream().getRecordedData(a)},c.captureImage=function(){var a=c.getMediaObject(),b=document.createElement("canvas"),d=b.getContext("2d");return a.width&&a.height?(b.width=a.width,b.height=a.height,d.drawImage(a,0,0,a.width,a.height),b.toDataURL("image/jpeg")):!1},c.onCanPlay=function(a){var b=c.getMediaObject(),d=c.getMediaPreview();if(!c.isStreaming()){var e=b.videoHeight/(b.videoWidth/d.width);isNaN(e)&&(e=width/(4/3)),b.setAttribute("width",d.width),b.setAttribute("height",e),c.isStreaming(!0),c.triggerEvent("streamReady",{stream:c.getStream(),media:b})}},c.openMedia=function(a){if(e)try{"old"==d?e.call(navigator,a,l,m):e.call(navigator.mediaDevices,a).then(l)["catch"](m)}catch(b){}else c.triggerEvent("error",{text:f.text.GUM_NOT_SUPPORTED})},c.destroy=function(){var a=c.getMediaObject();a&&a.removeEventListener("canplay",c.onCanPlay),c.getStream()&&(c.stopRecording(),c.setStream(null))};var n=function(){i()};n()}function c(){var c=!1,d=!1;this.getRecorderInstance=function(a){return new b(a)},this.hasUserMediaSupport=function(){return c||(d=!!a().gum,c=!0),d}}function d(a,b){return{link:function(c,d,e){var f={CAPTURE:"Capture",RETAKE:"ReTake"};c.videoId=a.getUniqueID("rgRec"),c.showLoader=!0,c.media=null,c.errorText="",c.connected=!1,c.captureText=f.CAPTURE;var g=function(){return document.querySelector("#"+c.videoId)},h={text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser. Please use upgraded browser."
}},i=b.getRecorderInstance(h);i.on("streamReady",function(a){c.showLoader=!1,c.connected=!0,c.$rgDigest();try{g().appendChild(a.media),c.media=a.media,a.media.play()}catch(b){}}),i.on("error",function(a){c.errorText=a.text,c.showLoader=!1,c.connected=!1,c.$rgDigest()}),c.connect=function(){c.showLoader=!0,c.connected=!1,i.openMedia({video:!0,audio:!1})},setTimeout(function(){c.connect()},500),c.doCapture=function(){if(c.captureText==f.CAPTURE){var a=i.captureImage();a&&(c.capturedMedia=a,c.captureText=f.RETAKE),c.media&&c.media.pause()}else c.capturedMedia=null,c.captureText=f.CAPTURE,c.media.play();c.$rgDigest()},c.$on("$destroy",function(){i.destroy()})},templateUrl:"pages/partials/recorder/image.html"}}angular.module("ringid.common.rgRecorder",[]).directive("rgImageCapture",d).service("rgRecorderService",c),d.$inject=["utilsFactory","rgRecorderService"]}(),function(){"use strict";function a(){return{restrict:"E",template:'<div id="global-loader" class="rgbubbling"><span id="rgbubbling_1"></span><span id="rgbubbling_2"></span><span id="rgbubbling_3"></span></div>'}}angular.module("ringid.common.rg_global_loader_directive",[]).directive("rgGlobalLoader",a)}(),function(){"use strict";angular.module("ringid.media",["ringid.filters","ringid.profile","ringid.config","ringid.common.controllers"])}(),function(){"use strict";function a(a,b){var c=this,d=a.SYSTEM.MEDIA,e=a.SYSTEM.REQUEST_TYPE;c.fetchMediaAlbums=function(a){var c={actn:d.ACTION_MEDIA_ALBUM_LIST,mdaT:a.mdaT||1,utId:a.utId};b.send(c,e.REQUEST,!0)},c.fetchHashtagSuggestion=function(a){return b.pull({actn:d.ACTION_GET_HASHTAG_SUGGESTION,schPm:a.utf8Encode()},e.REQUEST)},c.fetchSearchResult=function(a){var c={actn:d.ACTION_MEDIA_SEARCH_RESULT,schPm:a.utf8Encode()};return b.pull(c,e.REQUEST)},c.fetchContent=function(a){var c={actn:d.ACTION_SPECIFIC_MEDIA_RESULT,schPm:a.sk.utf8Encode(),sugt:a.sugt,pvtid:a.pvtid||0,scl:a.scl||1};return b.send(c,e.REQUEST)},c.fetchAlbumDetails=function(a){var c={actn:d.ACTION_MEDIA_ALBUM_DETAILS,albId:a};return b.request(c,e.REQUEST)},c.addMediaAlbum=function(a){var c={actn:d.ACTION_ADD_MEDIA_ALBUM,imgURL:a.imgURL||"",albn:a.albn.utf8Encode(),mdaT:a.mdaT};return b.request(c,e.UPDATE)},c.updateMediaAlbum=function(a){var c={actn:d.ACTION_UPDATE_MEDIA_ALBUM,albId:a.albId,imgURL:a.imgURL,mdaT:a.mdaT,albn:a.albn.utf8Encode()};return b.request(c,e.UPDATE)},c.deleteAlbum=function(a){var c={actn:d.ACTION_DELETE_MEDIA_ALBUM,albId:a};return b.request(c,e.UPDATE)},c.fetchAlbumContents=function(a){var c={actn:d.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:a.albId,utId:a.utId,st:a.st||0};b.send(c,e.REQUEST)},c.fetchAlbumContentsForpopup=function(a){var c={actn:d.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:a.albId||a.id,utId:a.utId,st:a.st||0};return b.pull(c,e.REQUEST)},c.fetchContentDetails=function(a){var c={actn:d.ACTION_MEDIA_CONTENT_DETAILS,cntntId:a.cntntId,utId:a.utId};return b.request(c,e.REQUEST)},c.addMediaToAlbum=function(a){var c={actn:d.ACTION_ADD_MEDIA_CONTENT,albId:a.albId,mdaLst:a.mdaLst,mdaT:a.mdaT};return b.request(c,e.UPDATE)},c.updateMediaAlbum=function(a){var c={actn:d.ACTION_UPDATE_MEDIA_CONTENT,mdaCntntDTO:a.mdaCntntDTO};return b.request(c,e.UPDATE)},c.deleteAlbumContent=function(a){var c={actn:d.ACTION_DELETE_MEDIA_CONTENT,cntntId:a};return b.request(c,e.UPDATE)},c.increaseViewCount=function(a,c){var f={actn:d.ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT,cntntId:a};return c&&(f.nfId=c),b.request(f,e.UPDATE)},c.getSearchTrends=function(){var a={actn:281};return b.pull(a,e.REQUEST)},c.getTaggedMedia=function(a){var c={actn:d.ACTION_GET_TAGGED_MEDIA_SONGS,htid:a,pvtid:0,scl:2};return b.send(c,e.REQUEST)}}angular.module("ringid.media").service("mediaHttpService",a),a.$inject=["OPERATION_TYPES","$$connector"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a,b){this.updateMedia(a),this.setUser(a,b),a=null}function l(a){var b,c=new Date,d=!1,e={ac:a.mdaCntntDTO.ac,albId:a.mdaCntntDTO.albId,albn:a.mdaCntntDTO.albn,artst:a.mdaCntntDTO.artst,cntntId:a.mdaCntntDTO.cntntId,mdaT:a.mdaCntntDTO.mdaT,drtn:a.mdaCntntDTO.drtn,strmURL:a.mdaCntntDTO.strmURL,thmbURL:a.mdaCntntDTO.thmbURL,ttl:a.mdaCntntDTO.ttl,utId:a.utId,viewtime:c.getTime()},f=i.getData("mediaRecent")||[];for(b=0;b<f.length;b++)if(f[b].cntntId===a.mdaCntntDTO.cntntId){d=b;break}d?f[d]=e:(f.length>=6&&f.shift(),f.push(e)),i.setData("mediaRecent",f)}var m=f,n={ac:0,albId:0,cc:0,ic:0,il:0,lc:0,is:0,ns:0,nfId:0,albn:"",artst:"",cntntId:0,drtn:0,mdaT:1,strmURL:"",thmbURL:"",ttl:"",tih:0,tiw:0,user:null,viewtime:0,utId:"",autoplay:!1,gotDetails:!1};return k.prototype={updateMedia:function(a,b){angular.isObject(a)&&(this.media?angular.extend(this.media,a):this.media=angular.extend({},n,a),this.media.gotDetails=!!b,this.media.key=this.media.cntntId||this.media.id,a.thmbURL&&a.thmbURL.length>1?this.media.poster=e.mediaBase+a.thmbURL:(this.media.poster=this.media.mdaT===m.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",this.media.feedThumb=this.media.poster,this.media.tih=330,this.media.tiw=600)),a=null},setUser:function(a,c){if(angular.isDefined(c))this._u=c;else if(a.utId?this._u=b.getByUtId(a.utId):a.uId?this._u=b.getUser(a.uId):this._u=!1,!this._u){var d={};a.uId&&(d.uId=a.uId),a.utId&&(d.utId=a.utId),a.fn&&(d.fn=a.fn),a.prIm&&(d.prIm=a.prIm),this._u=b.create(d)}},sortBy:function(){return this.media.viewtime},getMediaUtId:function(){return this.media.utId},getAlbumId:function(){return this.media.albId},getAlbumName:function(){return this.media.albn},getArtistName:function(){return this.media.artst},getKey:function(){return this.media.key},getFeedKey:function(){return this.media.nfId},setFeedKey:function(a){return this.media.nfId=a},isAudio:function(){return this.media.mdaT===m.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return this.media.mdaT===m.NEWS_FEED_MEDIA_TYPE_VIDEO},owner:function(){return this._u},user:function(){return this._u},getId:function(){return this.media.cntntId},setIsAutoPlay:function(a){this.media.autoplay=a},getIsAutoPlay:function(){return this.media.autoplay},getViewCount:function(){return this.media.ac>1?"Views : "+this.media.ac:"View : "+this.media.ac},getViewCountOnly:function(){return this.media.ac},getDuration:function(a){if(a){var b=this.media.drtn/60===0?"00":Math.floor(this.media.drtn/60),c=this.media.drtn%60===0?"00":Math.floor(this.media.drtn%60);return b=10>b&&"00"!==b?"0"+b:b,c=10>c&&"00"!==c?"0"+c:c,b+":"+c}return this.media.drtn},getCaption:function(){return this.media.ttl},getStreamUrl:function(){var a=e.mediaBase+this.media.strmURL;if(2===this.media.mdaT){var b=this.media.strmURL.match(/media-(\d+)/);if(b&&2===b.length&&parseInt(b[1])>140){var c=a.lastIndexOf("/")+1;a=[a.slice(0,c),"h",a.slice(c)].join("")}}return a},getStreamUrlOnly:function(){return this.media.strmURL},getThumb:function(){return this.media.poster},getThumbUrlOnly:function(){return this.media.thmbURL},getThumbForMedia:function(){return""===this.media.thmbURL?1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg":this.media.poster},getThumbForMediaOnly:function(){return""===this.media.thmbURL?1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg":this.media.poster},feedThumb:function(){return this.media.feedThumb},iLiked:function(){return this.media.il},like:function(a,b){return a?(this.media.il=1^this.media.il,b?this.media.lc=b:this.media.lc=0===this.media.il?this.media.lc-1:this.media.lc+1,this.media.il):this.media.il},getLikes:function(){return this.media.lc},getTotalLikes:function(){return this.media.lc},setTotalComment:function(a,b){this.media.cc=a,angular.isDefined(b)&&(this.media.ic=b)},selfComment:function(){return this.media.ic},getTotalComment:function(){return this.media.cc},getTotalShare:function(){return this.media.ns},setTotalShare:function(a){this.media.ns=a},share:function(a){return a?(this.media.is=1^this.media.is,this.media.ns=this.media.is?this.media.ns+1:this.media.ns-1,this.media.is):this.media.is},thumbOffset:function(a){return a?"height"===a?this.media.tih:this.media.tiw:{width:this.media.tiw,height:this.media.tih}},addToAlbumData:function(){return{strmURL:this.media.strmURL,tiw:this.media.tiw,tih:this.media.tih,drtn:this.media.drtn,thmbURL:this.media.thmbURL,artst:this.media.artst,ttl:this.media.ttl.utf8Encode()}},increaseView:function(){var a=h.defer(),b=this;return g.increaseViewCount(b.media.cntntId).then(function(c){c.sucs===!0&&b.media.ac++,a.resolve()}),a.promise},updateRecentMedias:l,fetchDetails:function(a){var b=h.defer(),c=this;if(c.media.gotDetails)b.resolve(c);else{var d={cntntId:c.getKey(),utId:a?a.getUtId():c.owner().getUtId()};g.fetchContentDetails(d).then(function(a){a.sucs===!0?(c.updateMedia(a.mdaCntntDTO,!0),l(a),b.resolve(c)):(b.reject(a),j.show(a,"info"))})}return b.promise}},function(a,b){return new k(a,b)}}angular.module("ringid.media").factory("$$mediaMap",a),a.$inject=["utilsFactory","userFactory","Auth","$$stackedMap","settings","APP_CONSTANTS","mediaHttpService","$$q","Storage","Ringalert"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a){return parseInt(a.id)||parseInt(a.albId)}var k=g;return{createKey:function(a){return j(a)},createAlbum:function(b,g){function l(a,b,c){var d;b=b||m.owner;for(var e=0,g=a.length;g>e;e++)c&&(a[e].nfId=c),d=f(angular.extend(a[e],{albId:m.id}),b),m.contents.save(d.getKey(),d);return m}var m={albn:"",albId:0,mc:0,mdc:0,mdaT:1,sts:0,utId:0,imgURL:"",contents:e.createNew(),uniqueKey:i.getUniqueID(),cover:"",key:0,type:"",owner:0},n=function(a){angular.isObject(a)&&(m=angular.extend({},m,a),m.albId=parseInt(a.id)||parseInt(a.albId),m.owner=g,m.key=j(a),a.imgURL&&a.imgURL.length>1?m.cover=c.imBase+a.imgURL:m.cover=b.mdaT===k.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",m.type=b.mdaT===k.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video")};return n(b),{getKey:function(){return m.key},getType:function(){return m.type},isAudio:function(){return m.mdaT===k.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return m.mdaT===k.NEWS_FEED_MEDIA_TYPE_VIDEO},getId:function(){return m.albId},getName:function(){return m.albn},getCover:function(){return m.cover},getContentCount:function(){return m.mc||m.mdc},getContents:function(){return m.contents},updateAlbum:function(a){n(a)},pushContent:function(a,b,c,d){return l(a,b,c,d)},getALbumUtId:function(){return m.utId},link:function(a,b){if(a.getUId()||a.getUtId()){var d=i.getRingRoute("USER_PROFILE",{uId:a.getUId(),utId:a.getUtId(),subpage:"media",albumId:m.albId});return b?d.replace("#",""):c.baseUrl+d}return""},addNewContent:function(b){var c,e,f="audio"===m.type?"audioFiles":"videoFiles",g={albId:m.albId,mdaLst:[],mdaT:m.mdaT};if(b){if(m.contents.get(b.getKey()))return void a.show("Content Already Added","warning");g.mdaLst.push(b.addToAlbumData())}else for(c=0,e=d[f].length;e>c;c++)g.mdaLst.push(d[f][c].getAuthData());h.addMediaToAlbum(g).then(function(a){if(a.sucs===!0){for(m.mc+=a.mdaIds.length,c=0,e=a.mdaIds.length;e>c;c++)g.mdaLst[c].cntntId=a.mdaIds[c];l(g.mdaLst)}})},deleteContent:function(a){h.deleteAlbumContent(a.getId()).then(function(b){b.sucs===!0&&(m.contents.remove(a.getKey()),m.mc--)})},fetchContentDetails:function(){function a(a,b){setTimeout(function(){h.likeList(a.getId()).then(function(a){})},b)}for(var b=m.contents.all(),c=0,d=b.length;d>c;c++)a(b[c].value,200*c+200)}}}}}angular.module("ringid.media").factory("$$mediaAlbumMap",a),a.$inject=["Ringalert","Auth","settings","fileUploadService","$$stackedMap","$$mediaMap","APP_CONSTANTS","mediaHttpService","utilsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a){var b,c,f,g;switch(a.actn){case G.ACTION_MEDIA_ALBUM_LIST:if(a.sucs===!0&&a.mediaAlbumList)for(w=e.currentUser().getUtId()===a.utId?e.currentUser():d.create({utId:a.utId}),c=0,f=a.mediaAlbumList.length;f>c;c++)g=a.mediaAlbumList[c].albId||a.mediaAlbumList[c].id,b=A.get(g)||B.get(g),b?b.updateAlbum(a.mediaAlbumList[c]):b=l.createAlbum(a.mediaAlbumList[c],w),w&&w.isCurrentUser()?A.save(b.getKey(),b):B.save(b.getKey(),b);break;case G.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(a.sucs===!0&&a.mdaCntntLst){var h=l.createKey(a);b=A.get(h)||B.get(h),b&&b.pushContent(a.mdaCntntLst)}}}function t(a,b){switch(F=a||(e.currentUser()?e.currentUser().getUtId():!1),b){case"audio":k.fetchMediaAlbums({utId:F,mdaT:H.NEWS_FEED_MEDIA_TYPE_AUDIO});break;case"video":setTimeout(function(){k.fetchMediaAlbums({utId:F,mdaT:H.NEWS_FEED_MEDIA_TYPE_VIDEO})},500);break;default:k.fetchMediaAlbums({utId:F,mdaT:H.NEWS_FEED_MEDIA_TYPE_AUDIO}),setTimeout(function(){k.fetchMediaAlbums({utId:F,mdaT:H.NEWS_FEED_MEDIA_TYPE_VIDEO})},500)}}function u(a){return a=parseInt(a),A.get(a)||B.get(a)||C.get(a)}function v(){return z?!1:(z=!0,t(),!0)}var w,x,y={albumsLoading:!1,contentsLoading:!1,noresultfound:!1},z=!1,A=n.createNew(),B=n.createNew(),C=n.createNew(),D=n.createNew(),E=n.createNew(),F=0,G=i.SYSTEM.MEDIA,H=j,I=[],J=[],K=[];return x=p.subscribe(s,{action:[G.ACTION_MEDIA_ALBUM_LIST,G.ACTION_MEDIA_SEARCH_RESULT]}),{init:v,state:y,processResponse:s,getAlbum:u,resetMediaAlbums:function(){B.reset()},getUserAlbums:function(b){return b?a(B.all(),{mapApi:"getType",value:b,compare:"regex"}):B},getAlbums:function(b,c){var d=b?A:B;return c?a(d.all(),{mapApi:"getType",value:c,compare:"regex"}):d},getSearchedSongs:function(){return E},getSearchedAlbums:function(){return D},getContentIdArray:function(){return J},resetContentIdArray:function(){J=[]},getAlbumIdArray:function(){return K},resetAlbumIdArray:function(){K=[]},getSearchedTagArr:function(){return I},resetSearchedSongs:function(){return E.reset()},resetSearchedAlbum:function(){return D.reset()},resetSearchedTagArr:function(){I=[]},fetchAllAlbums:t,createAlbum:function(a,c){var d,f;return c&&(a.id=b.getUniqueID(),f=o.defer()),c&&k.addMediaAlbum(a).then(function(b){b.sucs===!0?(d=l.createAlbum(angular.extend(a,{id:b.albId}),e.currentUser()),A.save(d.getKey(),d),f.resolve(d)):f.reject(!1)},function(){f.reject(!1)}),c?f.promise:d},deleteAlbum:function(a){k.deleteAlbum(a.getId()).then(function(b){b.sucs===!0&&A.remove(a.getKey())})},fetchAlbumContents:k.fetchAlbumContents,fetchAlbumContentsForpopup:k.fetchAlbumContentsForpopup,getSearchTrends:function(){return k.getSearchTrends()},getTaggedMedia:function(a){k.getTaggedMedia(a)},fetchSearchResult:function(a){return k.fetchSearchResult(a)},fetchHashtagSuggestion:k.fetchHashtagSuggestion,fetchContent:function(a){return y.noresultfound=!1,k.fetchContent(a)},fetchContentDetails:function(a,b,d){var e,f=o.defer(),g={cntntId:a,utId:d};return k.fetchContentDetails(g).then(function(a){a.sucs===!0?(e=m(a.mdaCntntDTO),e.updateRecentMedias(a),f.resolve(e)):(f.reject(a),c.show(a,"info"))}),f.promise}}}angular.module("ringid.media").factory("Media",a),a.$inject=["mapFilterFilter","utilsFactory","Ringalert","userFactory","Auth","$routeParams","Storage","profileFactory","OPERATION_TYPES","APP_CONSTANTS","mediaHttpService","$$mediaAlbumMap","$$mediaMap","$$stackedMap","$$q","$$connector","SystemEvents","$rootScope"]}(),function(){"use strict";function a(a,b,c,d){function e(a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a,b){"false"!==g.profilePage&&("album"===b?g.state.albumsLoading=a:g.state.contentsLoading=a,g.$rgDigest())}function u(a){return"true"===g.profilePage?h.getAlbums(D.isCurrentUser(),a):h.getAlbums(!0,a)}function v(a){var b="Are you sure you want to delete?",c=s.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:b}},templateUrl:"pages/partials/ringbox-confirm.html"});c.result.then(function(b){b&&h.deleteMedia(a)})}function w(a,b){if("false"===g.profilePage){var c,d=[];switch(d.push(a.getName()),d.push(a.getContentCount()),k.setData("albumname",d),b){case"audio":c="media/"+b+"/"+a.getALbumUtId()+"/"+a.getKey(),i.path(c);break;case"video":c="media/"+b+"/"+a.getALbumUtId()+"/"+a.getKey(),i.path(c);break;default:c="media",i.path(c)}}else a?window.location=a.link(D):window.location=n.getRingRoute("USER_PROFILE",{uId:D.getUId(),utId:D.getUtId(),subpage:"media"})}function x(a,b){b?g.selectedPlaylist.add(a.getKey(),a):g.selectedPlaylist.remove(a.getKey())}function y(a,b){var c;return c=a?g.activeAlbum.getContents().all():g.selectedPlaylist.all(),b=b||c[0].value,{data:function(){return{media:b,playlist:c,popupForm:"profile"}},promise:b.fetchDetails(D)}}function z(a){(a||!g.state.contentsLoading&&g.activeAlbum&&g.activeAlbum.getContents().length()<g.activeAlbum.getContentCount())&&(t(!0),h.fetchAlbumContents({albId:g.activeAlbum.getKey(),utId:D.getUtId(),st:g.activeAlbum.getContents().length()}))}function A(){B=m.subscribe(function(a){switch(a.actn){case C.ACTION_MEDIA_ALBUM_LIST:a.utId===D.getUtId()&&setTimeout(function(){g.showMediaPreview||(g.activeAlbum=h.getAlbum(d.albumId),g.activeAlbum&&z(!0)),t(!1,"album")},1e3);break;case C.ACTION_MEDIA_ALBUM_CONTENT_LIST:h.processResponse(a),setTimeout(function(){t(!1)},1e3)}},{action:[C.ACTION_MEDIA_ALBUM_LIST,C.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),d.albumId?(g.showMediaPreview=!1,g.activeAlbum=h.getAlbum(d.albumId),g.activeAlbum&&z(!0),t(!0)):g.showMediaPreview=!0,D.isCurrentUser()||(h.fetchAllAlbums(D.getUtId()),t(!0,"album")),h.init()&&t(!0,"album")}var B,C=l.SYSTEM.MEDIA,D=a.getProfile(d.uId);g.profilePage=j.inProfile,g.showMediaPreview=!1,g.activeAlbum=null,g.state=h.state,g.selectedPlaylist=q.createNew(),g.getAlbums=u,g.deleteMedia=v,g.toggleAlbumPreview=w,g.getMediaData=y,g.selectMedia=x,g.loadMoreContent=z,g.musicTab=!0,g.showAlbumContents=!1,d.albumId&&(g.showAlbumContents=!0,g.$rgDigest()),g.showDesiredTab=function(a){switch(a){case"music":g.musicTab=!0;break;case"video":g.musicTab=!1}g.$rgDigest()},A(),"false"===g.profilePage?g.limitItem=4:g.limitItem="Infinity",g.$on("$destroy",function(){m.unsubscribe(B),h.resetMediaAlbums()})}e.$inject=["profileFactory","Auth","fileUploadService","SystemEvents","$rootScope","$scope","Media","$location","$attrs","Storage","OPERATION_TYPES","$$connector","utilsFactory","userFactory","$$mediaAlbumMap","$$stackedMap","mapFilterFilter","$ringbox"];var f=function(c,d,e){function f(){c.showMediaPreview||a.innerHeight+a.scrollY>=b[0].body.offsetHeight&&c.loadMoreContent(!0)}a.addEventListener("scroll",f),c.$on("$destroy",function(){a.removeEventListener("scroll",f)})};return{restrict:"E",controller:e,link:f,templateUrl:function(a,b){return b.templatepath}}}angular.module("ringid.media").directive("rgMedia",a),a.$inject=["$window","$document","Media","$routeParams"]}(),function(){"use strict";function a(a,b,c){function d(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){for(var a=c.getData("mediaRecent"),d=0;d<a.length;d++){var e=b(a[d]);f.medias.save(e.getKey(),e)}}var o=[];c.setData("albumname",o),f.medias=a.createNew(!0,"desc"),f.popupmedias=a.createNew(!0,"desc");d.SYSTEM.MEDIA;f.recentMediaDropdown="pages/dropdowns/recent-media-dropdown.html",f.searchedMedia=a.createNew(),f.trendingArr=[],f.nodatafound=!1,f.noaudiofound=!1,f.activeNav="recent";var p=e.currentUser();f.utId=p.getUtId(),g.fetchAllAlbums(),n(),f.getRecentMediaData=function(a){return{data:function(){return{media:a,playlist:f.medias.all()}},promise:a.fetchDetails()}},f.getTaggedMedia=function(a){g.getTaggedMedia(a)},f.goToMyAlbums=function(a){var b="media/"+a;j.path(b)},f.selectAlbum=function(a){return{data:function(){return{media:a}}}},f.actionRecentMediaDropdown=function(a){switch(a.action){case"addtoalbum":l.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:a.data.obj}},templateUrl:"pages/dropdowns/popup-album-dropdown.html"});break;case"sendtofriend":break;case"shareatringid":var b=l.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:a.data.obj},onBackDropClickClose:!0,templateUrl:"pages/home/share-media.html"});b.result.then(function(){f.$rgDigest()});break;case"shareatfb":break;case"download":m.show("Currently download option is available in ringID desktop and mobile app version only","info")}},f.$on("$destroy",function(){g.resetMediaAlbums()})}d.$inject=["$$stackedMap","$$mediaMap","Storage","OPERATION_TYPES","Auth","$scope","Media","userFactory","$$mediaAlbumMap","$location","rgDropdownService","$ringbox","Ringalert"];var e=function(a,b){b.bind("click",function(){})};return{restrict:"E",controller:d,link:e,templateUrl:"pages/partials/media-search.html"}}angular.module("ringid.media").directive("rgMediaSearch",a),a.$inject=["$document","Media","$routeParams"]}(),function(){"use strict";function a(a,b,c){function d(a,b){a.isCurrentPath=function(a,c){return c?b.path().indexOf(a)>-1:b.path()==a}}d.$inject=["$scope","$location"];var e=function(a,b){};return{restrict:"E",controller:d,link:e,templateUrl:"pages/partials/media.tabnav.dir.html"}}angular.module("ringid.media").directive("rgTabNav",a),a.$inject=["$routeParams"]}(),function(){"use strict";function a(a,b){function c(a,b,c,d,e,f,g){function h(a){var b;switch(a.actn){case i.ACTION_MEDIA_SEARCH_RESULT:if(a.sucs===!0)for(c.showDropdown=!0,b=0;b<a.sgstn.length;b++)c.searchResult.push(a.sgstn[b]);else c.stoploader=!0;f.recalculate(c)}c.$rgDigest()}var i=b.SYSTEM.MEDIA;c.showDropdown=!1,c.stoploader=!1,c.showTrending=!1,c.searchResult=[],c.trendingArr=[],c.doSearch=function(){c.searchResult=[],c.stoploader=!1,c.searchParam?(c.showTrending=!1,d.fetchSearchResult(c.searchParam).then(h),c.showDropdown=!0):(c.showDropdown=!1,c.showTrending=!0)},c.doContentSearch=function(b){var d;switch(c.showDropdown=!1,b.sugt){case 1:d="media/songs/"+b.sk,e.path(encodeURI(d)),a.$rgDigest();break;case 2:d="media/albums/"+b.sk,e.path(encodeURI(d)),a.$rgDigest();break;case 3:d="media/tags/"+b.sk,e.path(encodeURI(d)),a.$rgDigest()}},c.fetchTrendingKeyword=function(){return c.showDropdown=!0,c.trendingArr.length>0?(c.showTrending=!0,void c.$rgDigest()):void d.getSearchTrends().then(function(a){if(a.sucs===!0){for(var b=0;b<a.sgstn.length;b++){switch(a.sgstn[b].sugt){case 1:a.sgstn[b].searchtype="songs";break;case 2:a.sgstn[b].searchtype="albums";break;case 3:a.sgstn[b].searchtype="tags"}c.trendingArr.push(a.sgstn[b])}c.showTrending=!0}c.$rgDigest()})},c.hideDropdown=function(){c.showDropdown=!1,c.showTrending=!1,c.searchParam="",c.searchResult=[]},c.$on("$destroy",function(){c.trendingArr=[],c.searchResult=[]})}c.$inject=["$rootScope","OPERATION_TYPES","$scope","Media","$location","rgScrollbarService","GlobalEvents"];var d=function(a,b){b.bind("click",function(){});b.find("input");a.activeId=0,a.setActiveId=function(b){a.activeId=b},b.on("keydown",function(b){if(13===b.keyCode){if(a.searchResult.length){var c=a.searchResult[a.activeId];a.doContentSearch({sk:c.sk,sugt:c.sugt})}}else 38===b.keyCode?(a.activeId=Math.max(a.activeId-1,0),a.$rgDigest()):40===b.keyCode&&(a.activeId=Math.min(a.activeId+1,a.searchResult.length-1),a.$rgDigest())})};return{restrict:"E",controller:c,link:d,templateUrl:"pages/mediasearch/media-search-directive.html"}}angular.module("ringid.media").directive("rgMediaSearchDirective",a),a.$inject=["$document","Media"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){switch(h.loadMoreSongs=!1,h.loadMoreAlbums=!1,a.actn){case p.ACTION_SPECIFIC_MEDIA_RESULT:h.noresultfound=!1;var b;if(a.sucs===!0){10===a.tr?b=a.mdaLst.length-1:(b=a.mdaLst.length,h.noresultfound=!0);for(var c=0;b>c;c++)1===a.mdaLst[c].sugt&&(q.push(a.mdaLst[c].cntntId),a.mdaLst[c].viewtime=(new Date).getTime(),u=g(a.mdaLst[c]),s.save(u.getKey(),u)),2===a.mdaLst[c].sugt&&(r.push(a.mdaLst[c].albId),u=e.createAlbum(a.mdaLst[c]),t.save(u.getKey(),u)),3===a.mdaLst[c].sugt&&h.searchedTagArr.push(a.mdaLst[c])}else h.noresultfound=!0;break;case p.ACTION_GET_TAGGED_MEDIA_SONGS:if(h.noresultfound=!1,a.sucs===!0)for(c=0;c<a.mdaLst.length;c++)u=g(a.mdaLst[c]),s.save(u.getKey(),u);else h.noresultfound=!0}h.$rgDigest()}var n=[];b.setData("albumname",n),h.stype=d.stype,h.searchkey=decodeURI(d.sk);var o,p=l.SYSTEM.MEDIA;h.loadMoreSongs=!1,h.loadMoreAlbums=!1,h.showSearchTitle=!0;var q=[],r=[];h.searchedTagArr=[];var s=f.createNew(),t=f.createNew();switch(h.searchedSongs=function(){return s},h.searchedAlbums=function(){return t},d.stype){case"songs":o=1;break;case"albums":o=2;break;case"tags":o=3;break;default:o=1}h.showSearchDropdown=!1;a.currentUser();if(h.searchsongsection=!1,h.searchalbumsection=!1,h.searchtagsection=!1,h.noresultsection=!1,"tag"!==h.stype){var u={sk:h.searchkey,sugt:o};i.fetchContent(u)}switch(h.stype){case"songs":h.searchsongsection=!0;break;case"albums":h.searchalbumsection=!0;break;case"tags":h.searchtagsection=!0;break;case"tag":h.searchsongsection=!0,h.showSearchTitle=!1,isNaN(h.searchkey)||i.getTaggedMedia(parseInt(h.searchkey))}h.searchedTags=i.getSearchedTagArr(),h.cntntidarray=i.getContentIdArray,h.albumidarray=i.getAlbumIdArray,h.noresultfound=!1,h.loadMoreSuggestedSongs=function(){h.loadMoreSongs=!0;var a={sk:h.searchkey,sugt:o,pvtid:q.pop(),scl:2};i.fetchContent(a),i.resetContentIdArray(),h.$rgDigest()},h.loadMoreSuggestedAlbums=function(){h.loadMoreAlbums=!0;var a={sk:h.searchkey,sugt:o,pvtid:r.pop(),scl:2};i.fetchContent(a),i.resetAlbumIdArray(),h.$rgDigest()},h.getTaggedMedia=function(a){var b="media/tag/"+a.htid;j.path(encodeURI(b))},h.goToAlbum=function(a){var c;switch(n.push(a.name),n.push(a.mc),b.setData("albumname",n),a.type){case"audio":c="media/"+a.type+"/"+a.utid+"/"+a.albumid,j.path(c);break;case"video":c="media/"+a.type+"/"+a.utid+"/"+a.albumid,j.path(c);break;default:c="media",j.path(c)}},h.getMediaData=function(a){return{data:function(){return{media:a,playlist:[{key:a.getKey(),value:a}]}},promise:a.fetchDetails()}};var v=k.subscribe(m,{action:[p.ACTION_SPECIFIC_MEDIA_RESULT,p.ACTION_GET_TAGGED_MEDIA_SONGS]});h.$on("$destroy",function(){k.unsubscribe(v),s.reset(),t.reset()})}angular.module("ringid.media").controller("mSearchResultController",a),a.$inject=["Auth","Storage","userFactory","$routeParams","$$mediaAlbumMap","$$stackedMap","$$mediaMap","$scope","Media","$location","$$connector","OPERATION_TYPES"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){b?i.selectedPlaylist.add(a.getKey(),a):i.selectedPlaylist.remove(a.getKey())}function p(a,b){var c;return c=a?i.songs.all():i.selectedPlaylist.all(),b=b||c[0].value,{data:function(){return{media:b,playlist:c}},promise:b.fetchDetails()}}function q(a){var d;switch(a.actn){case r.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(a.sucs===!0){for(d=0;d<a.mdaCntntLst.length;d++){a.mdaCntntLst[d].utId=i.utid;var e=b(a.mdaCntntLst[d]);i.songs.save(e.getKey(),e)}i.loadMoreSong=!1}else i.loadMoreSong=!1,i.stoploader=!0;break;case r.ACTION_MEDIA_ALBUM_LIST:if(a.sucs===!0){for(d=0;d<a.mediaAlbumList.length;d++)if(a.mediaAlbumList[d].mdaT===s){var f=c.createAlbum(a.mediaAlbumList[d]);i.myAlbumsMap.save(f.getKey(),f)}}else i.stoploader=!0}i.$rgDigest()}i.albumName=d.getData("albumname")[0],i.mediaCount=d.getData("albumname")[1],i.albumtype=g.albumtype,i.utid=g.utid,i.albumid=g.albumid,i.songsArray=[],i.songs=a.createNew(),i.selectedPlaylist=a.createNew(),i.myAlbumsMap=a.createNew();var r=h.SYSTEM.MEDIA;i.userallalbum=!1,i.showSearchDropdown=!1,i.stoploader=!1,i.loadMoreSong=!1;var s;if(!g.utid&&!g.albumid){var t=f.currentUser();i.utid=t.getUtId(),"audio"===g.albumtype?s=1:"video"===g.albumtype?s=2:k.path("media"),j.fetchAllAlbums(i.utid,i.albumtype),i.userallalbum=!0}isNaN(i.utid)&&isNaN(i.albumid)&&k.path("media"),i.goToAlbum=function(a){var b,c=[];switch(c.push(a.name),c.push(a.mc),d.setData("albumname",c),a.type){case"audio":b="media/"+a.type+"/"+a.utid+"/"+a.albumid,k.path(b);break;case"video":b="media/"+a.type+"/"+a.utid+"/"+a.albumid,k.path(b);break;default:b="media",k.path(b)}},i.loadMoreMedia=function(a){i.loadMoreSong=!0,j.fetchAlbumContents({albId:i.albumid,utId:i.utid,st:a})},i.utid&&i.albumid&&(j.fetchAlbumContents({albId:i.albumid,utId:i.utid}),i.albumMap=c.createAlbum({albn:i.albumName,albId:i.albumid,utId:i.utid})),i.selectMedia=o,i.getMediaData=p,i.$on("$destroy",function(){l.unsubscribe(u)});var u=l.subscribe(q,{action:[r.ACTION_MEDIA_ALBUM_CONTENT_LIST,r.ACTION_MEDIA_ALBUM_LIST]})}angular.module("ringid.media").controller("allAlbumTypeController",a),a.$inject=["$$stackedMap","$$mediaMap","$$mediaAlbumMap","Storage","userFactory","Auth","$routeParams","OPERATION_TYPES","$scope","Media","$location","$$connector","$ringbox","Ringalert"]}(),function(){"use strict";function a(a,b,c,d,e){function f(d){d&&d.sucs===!0&&(b.path(c.MEDIA_FEEDS),a.$rgDigest())}a.setFeed=f}angular.module("ringid.media").controller("MediaPostController",a),a.$inject=["$scope","$location","RING_ROUTES","utilsFactory","Ringalert"]}(),function(){"use strict";angular.module("ringid.social",[])}(),function(){"use strict";angular.module("ringid.social").service("socialUtils",function(){var a=this;a.camelCase=function(a){return a.replace(/([\:\-\_]+(.))/g,function(a,b,c,d){return d?c.toUpperCase():c})},a.parseQueryString=function(a){var b,c,d={};return angular.forEach((a||"").split("&"),function(a){a&&(c=a.split("="),b=decodeURIComponent(c[0]),d[b]=angular.isDefined(c[1])?decodeURIComponent(c[1]):!0)}),d},a.joinUrl=function(a,b){if(/^(?:[a-z]+:)?\/\//i.test(b))return b;var c=[a,b].join("/"),d=function(a){return a.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return d(c)},a.merge=function(b,c){var d={};for(var e in b)b.hasOwnProperty(e)&&(e in c&&"object"==typeof b[e]&&null!==e?d[e]=a.merge(b[e],c[e]):d[e]=b[e]);for(e in c)if(c.hasOwnProperty(e)){if(e in d)continue;d[e]=c[e]}return d}})}(),function(){"use strict";angular.module("ringid.social").constant("socialConfig",{providers:{facebook:{name:"facebook",url:"/auth/facebook",clientId:"477404429103451",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/static-index.html",requiredUrlParams:["access_code"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:680,height:500}},twitter:{twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin+"/static-index.html",type:"1.0",serverUrl:window.location.origin+"/TwiteerLoginService",popupOptions:{width:595,height:745}}}})}(),function(){"use strict";function a(a,b,c,d,e,f){var g={};return g.url="",g.popupWindow=null,g.open=function(a,b,e){g.url=a;var f=g.stringifyOptions(g.prepareOptions(e)),h=c.navigator.userAgent,i=d.cordova||h.indexOf("CriOS")>-1?"_blank":b;return g.popupWindow=c.open(a,i,f),c.popup=g.popupWindow,g.popupWindow&&g.popupWindow.focus&&g.popupWindow.focus(),g},g.eventListener=function(b){var c=a.defer();return g.popupWindow.addEventListener("loadstart",function(a){if(0===a.url.indexOf(b)){var d=document.createElement("a");if(d.href=a.url,d.search||d.hash){var f=d.search.substring(1).replace(/\/$/,""),h=d.hash.substring(1).replace(/\/$/,""),i=e.parseQueryString(h),j=e.parseQueryString(f);angular.extend(j,i),j.error||c.resolve(j),g.popupWindow.close()}}}),g.popupWindow.addEventListener("loaderror",function(){c.reject({rc:0,mg:"Error Loading Authorization URL"})}),g.popupWindow.addEventListener("onbeforeunload",function(){c.reject({rc:0,mg:"Popup closed unexpectedly"})}),c.promise},g.pollPopup=function(){var c=a.defer(),d=b(function(){try{var a=document.location.host,f=g.popupWindow.location.host;if(f===a&&(g.popupWindow.location.search||g.popupWindow.location.hash)){var h=g.popupWindow.location.search.substring(1).replace(/\/$/,""),i=g.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),j=e.parseQueryString(i),k=e.parseQueryString(h);angular.extend(k,j),k.error?c.reject(k):c.resolve(k),b.cancel(d),g.popupWindow.close()}}catch(l){}g.popupWindow&&!g.popupWindow.closed&&void 0!==g.popupWindow.closed||b.cancel(d)},50);return c.promise},g.prepareOptions=function(a){a=a||{};var b=a.width||500,d=a.height||500;
return angular.extend({width:b,height:d,left:c.screenX+(c.outerWidth-b)/2,top:c.screenY+(c.outerHeight-d)/2.5},a)},g.stringifyOptions=function(a){var b=[];return angular.forEach(a,function(a,c){b.push(c+"="+a)}),b.join(",")},g}angular.module("ringid.social").factory("socialPopup",a),a.$inject=["$$q","$interval","$window","socialConfig","socialUtils","utilsFactory"]}(),function(){"use strict";function a(a,b,c){var d={};return d.authenticate=function(d,e){var f="1.0"===a.providers[d].type?new b:new c;return f.open(a.providers[d],e)},d}function b(a,b,c,d,e,f,g,h){return function(){function b(){var a=[],b=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return angular.forEach(b,function(b){angular.forEach(f[b],function(b){var d=c.camelCase(b),e=angular.isFunction(f[b])?f[b]():f[d];a.push([b,e])})}),a.map(function(a){return a.join("=")}).join("&")}var d={},f={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"token",responseParams:{token:"token",clientId:"clientId",redirectUri:"redirectUri"}};return d.open=function(c,d){var i=a.defer();f=angular.extend({},c,f);var j,k,l=f.name+"_state";angular.isFunction(f.state)?e.setData(l,f.state()):angular.isString(f.state)&&e.setData(l,f.state),j=[f.authorizationEndpoint,b(d)].join("?"),k=g.open(j,f.name,f.popupOptions,f.redirectUri);var m=setInterval(function(){k.popupWindow.closed&&(clearInterval(m),i.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return k.pollPopup().then(function(a){clearInterval(m),h.get("https://graph.facebook.com/me?access_token="+a.access_token).success(function(b){b.id?i.resolve({platform:f.name,id:b.id,name:b.name,access_token:a.access_token}):i.reject()}).error(function(){i.reject()})},function(){i.reject({mg:"Popup blocked by Browser. Please unblock."})}),i.promise},d}}function c(a,b,c,d,e){return function(){function b(a,b){b.uId=b.uId.toString();var c="?step=3&oauth_token="+a.oauth_token+"&verifier="+a.oauth_verifier+(b.uId&&b.uId.length>2?"&uId="+b.uId:"")+"&time="+(new Date).getTime();return e.get(h.serverUrl+c)}function c(){return e.get(h.serverUrl+"?step=1&callback="+encodeURIComponent(h.redirectUri)+"&time="+Date.now())}function f(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")}var g={},h={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return g.open=function(e,g){var i,j=a.defer();angular.extend(h,e),i=d.open("",h.name,h.popupOptions,h.redirectUri);var k=setInterval(function(){i.popupWindow.closed&&(clearInterval(k),j.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return c().success(function(a){if(a.sucs===!0){var c=a.data,d=[h.authorizationEndpoint,f({oauth_token:c.token,callback_url:h.redirectUri})].join("?");i.popupWindow?(i.popupWindow.location=d,i.pollPopup().then(function(a){clearInterval(k),b(a,g).success(function(b){if(b.sucs===!0||2===b.rc){var c=b.data.members,d=JSON.parse(c.userDetails),e=JSON.parse(c.accessToken);j.resolve({platform:h.name,id:d.id_str,name:d.name,access_token:e.token,oauthParameters:e.oauthParameters,oauth_token:a.oauth_token,oauth_verifier:a.oauth_verifier})}else j.reject({mg:"exchangeForRequest failed"})}).error(function(){j.reject({mg:"exchangeForRequest failed. Server error"})})})):j.reject({mg:"Popup blocked by Browser. Please unblock."})}else j.reject({mg:"exchangeForRequest failed"})}).error(function(){j.reject({mg:"exchangeForRequest failed. Server error"})}),j.promise},g}}angular.module("ringid.social").factory("socialOauth",a).factory("socialOauth1",c).factory("socialOauth2",b),a.$inject=["socialConfig","socialOauth1","socialOauth2"],b.$inject=["$$q","$window","socialUtils","socialConfig","Storage","utilsFactory","socialPopup","$ringhttp"],c.$inject=["$q","socialConfig","socialUtils","socialPopup","$ringhttp"]}(),function(){"use strict";angular.module("ringid.social").provider("$authSocial",["socialConfig",function(a){angular.forEach(Object.keys(a.providers),function(b){this[b]=function(c){return angular.extend(a.providers[b],c)}},this);var b=function(b){a.providers[b.name]=a.providers[b.name]||{},angular.extend(a.providers[b.name],b)};this.oauth1=function(c){b(c),a.providers[c.name].type="1.0"},this.oauth2=function(c){b(c),a.providers[c.name].type="2.0"},this.$get=["$$q","socialOauth",function(a,b){var c={};return c.login=function(c){var d,e=a.defer();return d?e.resolve(d):b.authenticate(c,"login").then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},c.authenticate=function(c,d){var e=a.defer();return b.authenticate(c,d).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},c}]}])}(),function(){"use strict";angular.module("ringid.auth",["ringid.config","ringid.connector","ringid.common.services","ringid.common.factories","ringid.utils","ringid.social"])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a,b,c){d.disableForm=!1,i.analytics&&ga("send","event",location.hostname+":"+b,c+" Message:"+a.mg||"UNKNOWN"),h.show(a.mg||"Request Failed","error"),d.$rgDigest()}function k(a,b,c,e){var f={signup:{success:{label:"Signup Success",value:"Auth Method: "+d.credentials.authMethod},fail:{label:"Signup Failed",value:"Auth Method: "+d.credentials.authMethod}},signin:{success:{label:"Signin Success",value:"Auth Method: "+d.credentials.authMethod},fail:{label:"Signin Failed",value:"Auth Method: "+d.credentials.authMethod}},recovery:{success:{label:"Recovery Success",value:"Auth Method: "+d.credentials.authMethod},fail:{label:"Recovery Failed",value:"Auth Method: "+d.credentials.authMethod}}};a?(d.disableForm=!1,a.sucs===!0||"true"===a.sucs?(i.analytics&&ga("send","event",location.hostname+":"+f[c].success.label+" :"+b,f[c].success.value+" Message:"+a.mg||"UNKNOWN RC:"+a.rc||"UNKNOWN"),d.requestSuccess=!0):(i.analytics&&ga("send","event",location.hostname+":"+f[c].fail.label+" :"+b,f[c].fail.value+" Message:"+a.mg||"UNKNOWN RC:"+a.rc||"UNKNOWN"),d.requestSuccess=!1),e?a.hasOwnProperty("sucs")&&a.sucs!==!0?d.errorMsg=a.mg||"Request Failed":d.errorMsg=a.mg||"":d.errorMsg=p[c][b]||a.mg):(d.disableForm=!0,d.requestSuccess=!0,d.errorMsg=""),d.$rgDigest()}function l(a){if(!d.disableForm){switch(d.errorMsg="",d.activeTab=a,d.activeTab){case"email":d.credentials.authMethod="email",d.formStyle.left="-800px",d.credentials.lt=3;break;case"ringid":d.credentials.authMethod="ringid",d.formStyle.left="-400px",d.credentials.lt=1;break;case"facebook":d.credentials.authMethod="social",d.formStyle.left="-1200px",d.credentials.lt=4;break;case"twitter":d.credentials.authMethod="social",d.formStyle.left="-1200px",d.credentials.lt=5;break;case"social":d.credentials.authMethod="social",d.formStyle.left="-1200px";break;default:d.credentials.authMethod="phone",d.formStyle.left="0px",d.credentials.lt=2}d.$rgDigest()}}function m(c){c.event&&a.close(c.event),b.setData("country",c.item),d.credentials.mblDc=c.item.code,d.credentials.flagcode=c.item.flagcode,d.$rgDigest()}function n(a,b){if(b&&b.preventDefault(),a){switch(d.credentials.authMethod){case"ringid":d.credentials.username=d.credentials.ringid;break;case"email":d.credentials.username=d.credentials.email;break;case"phone":d.credentials.username=d.credentials.mbl}d.requestFailed(!1),c.login(d.credentials).then(function(a){a.sucs===!0||"true"===a.sucs?d.params&&d.params.fromPopup?(d.closeAll(),window.location="/"):g.$rgDigest():d.requestFailed(a,d.credentials.authMethod,"signin")},function(a){d.requestFailed(a,d.credentials.authMethod,"signin")})}}function o(){var a=b.getData("activeTab");if(a){var c=b.getData("autoFill");switch(a){case"phone":d.credentials.mbl=c,d.credentials.username=c,d.credentials.lt=2;break;case"email":d.credentials.lt=3,d.credentials.email=c,d.credentials.username=c;break;case"ringid":d.credentials.ringid=c,d.credentials.username=c,d.credentials.lt=1}l(a)}d.$rgDigest()}d.socialRequestFailed=j,d.requestFailed=k,d.activeTab="phone",d.credentials={username:"",authMethod:"phone",uId:"",lt:2,mbl:"",email:"",ringid:"",password:"",remember:!!b.getData("remember"),mblDc:c.getCountry().code,flagcode:c.getCountry().flagcode},d.autofill={email:d.credentials.email,ringid:d.credentials.ringid,mbl:d.credentials.mbl},d.errorMsg="",d.requestSuccess=!1,d.disableForm=!1,d.formStyle={left:"0px"},d.activateTab=l,d.setPrefix=m,d.login=n,d.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" ><li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',d.ddControl={append:!1,countryList:c.getCountryList};var p={signin:{email:"Login failed. Make sure you're entering your verified email and correct password.",phone:"Login failed. Make sure you're entering your verified phone and correct password.",ringid:"Login failed. Make sure you're entering correct ringID and password.",other:"Sorry, we are unable to complete your request. Please try again later."},signup:{sendcode:"Verification code has been sent to your email. Please check your spam folder also.",verify:"",signup:""},recovery:{email:"Sorry! we did not find your email. Make sure you're entering your verified email.",phone:"Sorry! we did not find your phone number. Make sure you're entering your verified phone number."}};o()}angular.module("ringid.auth").controller("AuthController",a),a.$inject=["rgDropdownService","Storage","Auth","$scope","$$connector","countryListService","$rootScope","Ringalert","settings"]}(),function(){"use strict";function a(a,b,c,d){a.close=b.close,a.closeAll=b.closeAll,a.showLoader=b.showLoader,a.hideLoader=b.hideLoader,a.params=d,c("SignInController",{$scope:a})}angular.module("ringid.auth").controller("RingboxAuthController",a),a.$inject=["$scope","$boxInstance","$controller","localData"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(b){a.authenticate(b,c.credentials).then(function(a){c.params&&c.params.fromPopup&&c.showLoader(),d.login(angular.extend(a,c.credentials),!0).then(function(){ga("send","event","Signin Success. ","Auth Method: "+b),c.params&&c.params.fromPopup?(boxInstance.hideLoader(),c.closeAll(),window.location="/"):(c.close(),f.$rgDigest())},function(a){switch(c.params&&c.params.fromPopup&&boxInstance.hideLoader(),a.rc){case"invalidsocialid":c.socialRequestFailed(a,b,"Unregistered Social ID");break;default:c.socialRequestFailed(a,b,"Something went wrong")}})},function(a){c.params&&c.params.fromPopup&&boxInstance.hideLoader(),c.socialRequestFailed(a,b,"Authentication Failed")})}angular.extend(this,b("AuthController",{$scope:c})),c.noSignupAllowed=function(){e.alert({title:"Sign Up",message:"Please sign up from your iOS, Android, Windows enabled device or Desktop prior to logging in from the Web version.",showCancel:!1,okCallback:angular.noop})},c.socialLogin=function(a){c.credentials.authMethod=a,g("twitter"===a?a:a)}}angular.module("ringid.auth").controller("SignInController",a),a.$inject=["$authSocial","$controller","$scope","Auth","Ringalert","$rootScope"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){b.preventDefault(),d.disableForm||(d.requestFailed(!1),c.sendCode(d.credentials).then(function(a){a.sucs===!0&&(d.credentials.uId=a.uId,d.newUid=a.uId.toString().substr(2),d.signupStep=2,d.formStyle.left="-350px"),d.requestFailed(a,"sendcode","signup")},function(a){d.requestFailed(angular.extend(a,{sucs:!1}),"sendcode","signup")}))}function m(a,b){b.preventDefault(),d.disableForm||(d.requestFailed(!1),c.verifyCode(d.credentials).then(function(a){a.sucs===!0&&(d.signupStep=3,d.formStyle.left="-700px"),d.requestFailed(a,"verify","signup")},function(a){d.requestFailed(angular.extend(a,{sucs:!1}),"verify","signup")}))}function n(a,e){e.preventDefault(),d.disableForm||d.credentials.password!==d.credentials.repassword||(d.requestFailed(!1),c.signup(d.credentials).then(function(a){a.sucs===!0&&(d.login(!0),b.show("Registraion succesful. You can login now","success"),f.closeAll()),d.requestFailed(a,"sendCode","signup")},function(a){d.requestFailed(angular.extend(a,{sucs:!1}),"signup","signup")}))}angular.extend(this,e("AuthController",{$scope:d})),d.close=f.close,d.closeAll=f.closeAll,d.newUid="",d.credentials.repassword="",d.credentials.vc="",d.credentials.name="",d.signupStep=1,d.sendCode=l,d.verifyCode=m,d.signup=n,i&&(d.formStyle.left="0px",d.credentials.mbl="",d.credentials.email="",d.credentials.ringid="",d.credentials.password="",i.signupData&&(d.credentials.authMethod=i.signupData.signupType,d.credentials.flagcode=i.signupData.flagcode),i.socialData&&(angular.extend(d.credentials,i.credentials),d.newUid=i.credentials.uId.toString().substr(2),d.credentials.authMethod=i.socialData.platform,d.credentials.id=i.socialData.id,d.credentials.name=i.socialData.name,d.credentials.access_token=i.socialData.access_token,d.signupStep=3,d.formStyle.left="-700px")),h&&(d.newUid=h.uId.toString().substr(2))}angular.module("ringid.auth").controller("SignUpController",a),a.$inject=["countryListService","Ringalert","Auth","$scope","$controller","$boxInstance","$authSocial","remoteData","localData","Storage","rgDropdownService"]}(),function(){"use strict";function a(a,b,c,d,e,f){angular.extend(this,c("AuthController",{$scope:b})),b.close=d.close,b.closeAll=d.closeAll,b.socialSignup=function(c){d.showLoader(),a.sendCode(b.credentials,!0).then(function(){e.authenticate(c,b.credentials).then(function(e){ga("send","event","Signup Success. ","Auth Method: "+c+" Social Authorization done"),a.openSignup(e,b.credentials).then(angular.noop,function(g){"dologin"===g.rc?(f.show("Existing User! Login in as "+e.name,"warning"),b.credentials.authMethod=c,d.showLoader(),a.login(angular.extend(e,b.credentials),!0).then(function(){ga("send","event","Signin Success. ","Auth Method: "+c),b.closeAll()},function(a){d.hideLoader(),b.socialRequestFailed(a,c,"Social Login Failed")})):(d.hideLoader(),b.socialRequestFailed(g,c,"Authentication Failed"))})},function(a){d.hideLoader(),b.socialRequestFailed(a,c,"Authentication Failed")})},function(a){d.hideLoader(),b.socialRequestFailed(a,c,"Authentication Failed")})},b.signupData=function(c){return{data:function(){return{signupData:{signupType:c,code:"phone"===c?a.getCountry().code:"Email",flagcode:"phone"===c?a.getCountry().flagcode:"remail"}}},promise:a.sendCode(b.credentials)}}}angular.module("ringid.auth").controller("SignUpSelectController",a),a.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","Ringalert"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a,d,e){j=e,d.preventDefault(),c.disableForm||(c.requestFailed(!1),b.recoverySendCode(c.credentials,j).then(function(a){a.sucs===!0&&(c.activeForm="verifycode",c.credentials.uId=a.uId),c.requestFailed(a,j?"phone":"email","recovery",!0)},function(a){c.requestFailed(angular.extend(a,{sucs:!1}),j?"phone":"email","recovery")}))}function g(a,d){d.preventDefault(),c.disableForm||(c.requestFailed(!1),b.recoveryVerifyCode(c.credentials).then(function(a){a.sucs===!0&&(c.activeForm="resetpassword"),c.requestFailed(a,"verify","recovery",!0)},function(a){c.requestFailed(angular.extend(a,{sucs:!1}),"verify","recovery",!0)}))}function h(a,d){d.preventDefault(),c.disableForm||c.credentials.password!==c.credentials.repassword||(c.requestFailed(!1),b.resetPassword(c.credentials).then(function(a){c.disableForm=!1,c.errorMsg=a.mg,a.sucs===!0&&(e.show("Reset succesful. You can login now","success"),c.close()),c.requestFailed(a,"reset","recovery",!0)},function(a){c.requestFailed(angular.extend(a,{sucs:!1}),"reset","recovery",!0)}))}function i(a){c.disableForm||"sendcode"!==c.activeForm||(c.activeTab=a,"email"===c.activeTab?(c.credentials.authMethod="email",c.formStyle.left="0px"):(c.credentials.authMethod="phone",c.formStyle.left="-350px"),c.$rgDigest())}angular.extend(this,a("AuthController",{$scope:c})),c.close=d.close;var j;c.activeTab="email",c.activeForm="sendcode",c.activateTab=i,c.activateTab(c.activeTab),c.credentials.email="",c.credentials.mbl="",c.sendCode=f,c.verifyCode=g,c.resetPassword=h}angular.module("ringid.auth").controller("PasswordRecoverController",a),a.$inject=["$controller","Auth","$scope","$boxInstance","Ringalert"]}(),function(){"use strict";angular.module("ringid.notification",["ringid.config","ringid.utils"])}(),function(){"use strict";function a(a,b,c,d){function e(b){function c(){var a=b.uIdList.length-1;return a>1?" and "+a+" others ":1===a?" and "+a+" other ":""}var d="",e={message:"",popupType:"",mayMerge:1};switch(b.mt){case g.MSG_TYPE_UPDATE_PROFILE_IMAGE:e.message=" changed profile photo",e.popupType="image",e.mayMerge=2;break;case g.MSG_TYPE_UPDATE_COVER_IMAGE:e.message=" changed cover photo",e.popupType="image",e.mayMerge=2;break;case g.MSG_TYPE_LIKE_IMAGE:e.message=c()+" liked your photo",e.popupType="image";break;case g.MSG_TYPE_IMAGE_COMMENT:e.message=c()+" commented on your photo",e.popupType="image";break;case g.MSG_TYPE_LIKE_IMAGE_COMMENT:e.message=c()+" liked your comment",e.popupType="image";break;case g.MSG_TYPE_ADD_FRIEND:e.message=" wants to be friends with you",e.popupType="profile";break;case g.MSG_TYPE_ACCEPT_FRIEND:e.message=" has accepted your friend request",e.popupType="profile";break;case g.MSG_TYPE_ADD_GROUP_MEMBER:d=a.getCircle(b.acId)?a.getCircle(b.acId).getName():"",e.message=" has added you in a group "+d,e.popupType="group",e.mayMerge=0;break;case g.MSG_TYPE_ADD_STATUS_COMMENT:e.message=c()+" commented on your post",e.popupType="feed";break;case g.MSG_TYPE_LIKE_STATUS:e.message=c()+" liked your post",e.popupType="feed";break;case g.MSG_TYPE_LIKE_COMMENT:e.message=c()+" liked your comment",e.popupType="feed";break;case g.MSG_TYPE_SHARE_STATUS:e.message=c()+" shared your post",e.popupType="feed";break;case g.MSG_TYPE_LIKE_AUDIO_MEDIA:e.message=c()+" liked your music",e.popupType="media";break;case g.MSG_TYPE_AUDIO_MEDIA_COMMENT:e.message=c()+" commented on your music",e.popupType="media";break;case g.MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:e.message=c()+" liked your comment",e.popupType="media";break;case g.MSG_TYPE_AUDIO_MEDIA_VIEW:e.message=c()+" viewed your music",e.popupType="media";break;case g.MSG_TYPE_LIKE_VIDEO_MEDIA:e.message=c()+" liked your video",e.popupType="media";break;case g.MSG_TYPE_VIDEO_MEDIA_COMMENT:e.message=c()+" commented on your video",e.popupType="media";break;case g.MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:e.message=c()+" liked your comment",e.popupType="media";break;case g.MSG_TYPE_VIDEO_MEDIA_VIEW:e.message=c()+" viewed you video",e.popupType="media";break;case g.MSG_TYPE_YOU_HAVE_BEEN_TAGGED:e.message=" tagged you in a status",e.popupType="feed";break;default:e.popupType="nomatch",e.mayMerge=0}return e}function f(a){this.updateNoti(a),a=null}var g=b.SYSTEM.NOTIFICATION,h={acId:0,cmnId:0,fndId:0,fndN:"",id:0,imgId:0,loc:0,mt:0,nfId:0,ut:0,nt:0,prIm:0,message:"",updateTime:"",popupType:"",groupId:0,user:null,seen:!1,mayMerge:1,othersCounter:0};return f.prototype={updateNoti:function(a){var b;angular.isObject(a)&&(this.noti?angular.extend(this.noti,a):(this.noti=angular.extend({},h,a),this.noti.uIdList=[]),this.noti.updateTime=c.verbalDate(this.noti.ut)||this.noti.ut,b=e(this.noti),this.noti.message=b.message,this.noti.popupType=b.popupType,this.noti.mayMerge=b.mayMerge,this.noti.fndId&&this.noti.uIdList.push(this.noti.fndId)),a=null},sortBy:function(){return this.noti.ut},getName:function(){return this.noti.fndN},isInUidList:function(a){return this.noti.uIdList.indexOf(a)>-1},uIdList:function(a){if(!a||!a.length)return this.noti.uIdList;for(var b=0;b<a.length;b++)-1===this.noti.uIdList.indexOf(a[b])&&this.noti.uIdList.push(a[b])},getUid:function(){return this.noti.fndId},getUserAvatar:function(){if(this.noti.user)return this.noti.user.avatar("thumb");if(this.noti.prIm){var a=this.noti.prIm.lastIndexOf("/")+1;return[d.imBase,this.noti.prIm.slice(0,a),"pthumb",this.noti.prIm.slice(a)].join("")}return"images/prof.png"},getMessage:function(){return this.noti.message},getTime:function(a){return a?this.noti.ut:this.noti.updateTime},updateNotiTime:function(){this.noti.updateTime=c.verbalDate(this.noti.ut)},getKey:function(){return this.noti.id},getPopupType:function(){return this.noti.popupType},getMessageType:function(){return this.noti.mt},getNotiType:function(){return this.noti.nt},getActivityId:function(){return this.noti.acId},getNewsFeedId:function(){return this.noti.nfId},getLink:function(){var a="",b={};switch(this.noti.popupType){case"image":b.mediaId=this.noti.imgId,this.noti.cmnId&&(b.commentId=this.noti.cmnId),a=c.getRingRoute("SINGLE_IMAGE",b);break;case"media":b.mediaId=this.noti.imgId,this.noti.cmnId&&(b.commentId=this.noti.cmnId),a=c.getRingRoute("SINGLE_MEDIA",b);break;case"profile":a=c.getRingRoute("USER_PROFILE",{uId:this.noti.fndId});break;case"group":a=c.getRingRoute("CIRCLE_HOME",{circleId:this.noti.acId});break;case"feed":b.feedId=this.noti.nfId,this.noti.cmnId&&(b.commentId=this.noti.cmnId),a=c.getRingRoute("SINGLE_FEED",b);break;default:a=""}return a},getImgId:function(){return this.noti.imgId},getCommentId:function(){return this.noti.cmnId},getSeenStatus:function(){return this.noti.seen},updateSeenStatus:function(a){this.noti.seen=a},canMerge:function(){return this.noti.mayMerge},setNotiMessage:function(a){this.noti.othersCounter+=a;var b=e(this.noti);this.noti.message=b.message},getRingboxTemplate:function(){var a="";switch(this.noti.popupType){case"image":a="pages/partials/notification/image-popup.html";break;case"media":a="pages/partials/notification/media-popup.html";break;case"feed":a="pages/partials/notification/feed-popup_with_image.html";break;default:a=""}return a},getControllerName:function(){return"image"===this.noti.popupType&&"RingBoxImagePopupController"||"feed"===this.noti.popupType&&"NotiPopupController"||"media"===this.noti.popupType&&"RingBoxMediaController"},showRingbox:function(){return"feed"===this.noti.popupType||"image"===this.noti.popupType||"media"===this.noti.popupType}},function(a){return new f(a)}}angular.module("ringid.notification").factory("$$notiMap",a),a.$inject=["circlesManager","OPERATION_TYPES","utilsFactory","settings"]}(),function(){"use strict";function a(a,b,c){var d=this,e=c.SYSTEM.NOTIFICATION,f=c.SYSTEM.REQUEST_TYPE;d.requestNotification=function(b){var c={actn:e.TYPE_MY_NOTIFICATIONS};b&&b.from_index>0&&(c=angular.extend({},c,b)),a.send(c,f.REQUEST)},d.clearNotiCount=function(){var b=new Date,c=b.getTime(),d={actn:e.CLEAR_NOTIFICATION_COUNTER,ut:c};return a.request(d,f.REQUEST)},d.getNotificationDetails=function(b){var d={actn:c.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:b.activityId};return a.request(d,f.REQUEST)},d.getImageAlbumDetails=function(b){var d={actn:c.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,request_type:f.REQUEST,imgId:b.imgId};return a.request(d,f.REQUEST)}}angular.module("ringid.notification").service("notificationHttpService",a),a.$inject=["$$connector","settings","OPERATION_TYPES"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(b){m&&!b||(m=!0,a.subscribe(s,{action:[n.TYPE_MY_NOTIFICATIONS,n.TYPE_SINGLE_NOTIFICATION]}),t())}var l=e.createNew(!0,"desc"),m=!1,n=g.SYSTEM.NOTIFICATION,o=0,p=0,q=-1,r={loading:!1,noMoreData:!1},s=function(a){function b(a){function b(b){a.value.getTime(!0)<d.getTime(!0)?(p=p>0?p-1:0,d.uIdList(a.value.uIdList()),d.setNotiMessage(),l.remove(a.value.getKey())):(e=!1,a.value.uIdList(d.uIdList()),a.value.setNotiMessage())}if(a.value.getMessageType()===d.getMessageType())if(1===a.value.canMerge())switch(a.value.getPopupType()){case"feed":a.value.getNewsFeedId()===d.getNewsFeedId()&&b(a.value.isInUidList(d.getUid())?!1:!0);break;case"image":case"media":a.value.getImgId()===d.getImgId()&&b(a.value.isInUidList(d.getUid())?!1:!0)}else 2===a.value.canMerge()&&a.value.getUid()===d.getUid()&&b(!1)}var d,e=!0;switch(a.actn){case n.TYPE_MY_NOTIFICATIONS:if(a.sucs===!0||"true"===a.sucs){var g=[];o+=a.nList.length;var h=parseInt(c.getData("oldNotiCount"));p=h>a.tn?a.tn:a.tn-h;for(var i=0;i<a.nList.length;i++){e=!0,d=f(a.nList[i]),l.all().forEach(b),g.push(a.nList[i].ut);var j=c.getData("notiseen");if(e){for(var k=0;k<j.length;k++)j[k]===a.nList[i].id&&d.updateSeenStatus(!0);l.save(d.getKey(),d)}}var m=g.sort();q=m[0]||q}else a.sucs===!1&&1111===a.rc?t():r.noMoreData=!0;break;case n.TYPE_SINGLE_NOTIFICATION:o++,e=!0,d=f(a),l.all().forEach(b),e&&l.save(d.getKey(),d),p++}},t=function(a){a=a||10;var b={from_index:o>0?o:0,to_index:o>0?o+a:a,scl:2,ut:q};d.requestNotification(b)};return{init:k,state:r,loadMoreNoti:t,process:s,getNotifications:function(){return l},getNotification:function(a){return l.get(a)},clearCounter:function(){p>0&&(c.setData("oldNotiCount",p+parseInt(c.getData("oldNotiCount"))),p=0);for(var a=0;a<l.length();a++){var b=Date.now()-l.all()[a].value.sortBy();36e5>b&&l.all()[a].value.updateNotiTime()}},getNotiCount:function(){return p>99?"99+":p}}}angular.module("ringid.notification").factory("NotificationFactory",a),a.$inject=["$$connector","$q","Storage","notificationHttpService","$$stackedMap","$$notiMap","OPERATION_TYPES","$rootScope","SystemEvents","Auth"]}(),function(){"use strict";function a(a,b,c,d){function e(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){switch(a.value.getPopupType()){case"image":return q({action:"image",noti:a.value,nfId:a.value.getNewsFeedId(),imgId:a.value.getImgId(),templateType:"image"});case"media":return q({action:"media",noti:a.value,nfId:a.value.getNewsFeedId(),mediaId:a.value.getImgId(),templateType:"media"});case"feed":return q({action:"ringbox",nfId:a.value.getNewsFeedId(),noti:a.value,templateType:"feed_with_text"})}}function q(a){var g=i.getData("notiseen");switch(g||(g=[],i.setData("notiseen",g)),-1===g.indexOf(a.noti.getKey())&&(g.push(a.noti.getKey()),a.noti.updateSeenStatus(!0),g.length>150&&g.shift()),i.setData("notiseen",g),a.action){case"redirect":var j=c.getCircle(a.circleId);if(j){var k=a.link.slice(1);b.path(k)}else h.show("Circle does not exist!","error");break;case"ringbox":return{data:function(){return{notiKey:a.noti.getKey(),noti:a.noti,templateType:a.templateType}},promise:n.getNotificationDetails({activityId:a.nfId})};case"media":return{data:function(){return{notiKey:a.noti.getKey(),noti:a.noti,mediaId:a.mediaId,popupFrom:"notification",templateType:a.templateType}},promise:f.fetchContentDetails(a.mediaId,!0,e.currentUser().getUtId())};case"image":return{data:function(){return{notiKey:a.noti.getKey(),noti:a.noti,imgId:a.imgId,popupFrom:"notification",templateType:a.templateType}},promise:d.getImageDetails(a.imgId,a.nfId)}}}function r(a){j.state.loading=a,a||(k.recalculate(j),j.$emit(o.FEED.HEIGHT)),j.$rgDigest()}function s(){j.state.loading||j.state.noMoreData||(r(!0),a.loadMoreNoti(u))}var t,u=parseInt(j.loadCount),v=l.SYSTEM.NOTIFICATION;j.state=a.state,j.notifications=a.getNotifications(),j.loadMoreNotification=s,j.getRingboxData=p,j.notificationAction=a.notificationAction,u>20&&j.$emit(o.FEED.HEIGHT),j.notifications.length()<u&&s();var w=m.subscribe(function(){t||(t=setTimeout(function(){t=null,r(!1)},200))},{action:[v.TYPE_MY_NOTIFICATIONS,v.TYPE_SINGLE_NOTIFICATION]});j.$on("$destroy",function(){m.unsubscribe(w)})}function f(a,b,e){var f=e.templateUrl?e.templateUrl:"pages/dropdowns/notification-dropdown.html";c.get(f).success(function(c){b.append(d(c)(a)),a.$rgDigest()})}return e.$inject=["NotificationFactory","$location","circlesManager","AlbumFactory","Auth","Media","rgDropdownService","Ringalert","Storage","$scope","rgScrollbarService","OPERATION_TYPES","$$connector","notificationHttpService","SystemEvents"],{restrict:"AE",controller:e,scope:{loadCount:"@",templateUrl:"@"},link:f}}angular.module("ringid.notification").directive("rgNotification",a),a.$inject=["$window","$document","$ringhttp","$compile"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b){return b||(b=d.feed),{data:function(){return{media:a,album:b.getAlbum(),feedTime:b.time()}},promise:a.fetchDetails()}}var n=(b.SYSTEM,b.SYSTEM.NOTIFICATION,!0);if(d.currentUser=c.currentUser(),d.feed={},d.focused=!1,d.showCommentBox=!0,d.nocontent=!1,d.ddHtml="pages/dropdowns/feed-edit-dropdown.html",d.getMediaData=m,e&&e.notiKey&&(d.key=e.notiKey,d.noti=e.noti,d.templateType=e.templateType),d.boxIsLoading=!1,f.sucs===!1)return d.nocontent=!0,k.show(f,"error"),d.$close(),!1;var o=angular.fromJson(f.newsFeedList);if(n&&o[0]&&o[0].orgFd){d.feed=h.create(o[0]);var p=h.create(o[0].orgFd);d.feed.shares(p)}else d.feed=h.create(f.newsFeedList[0]);d.keyid=d.feed&&d.feed.getKey(),(d.feed.hasMedia()||d.feed.hasSharedFeed()&&d.feed.getOrginalFeed().getImages().length)&&(d.templateType="feed_with_image"),d.noti.getCommentId()>0&&(d.activeCommentId=d.noti.getCommentId()),d.shareMenuDisabled=d.shareMenuDisabled?d.shareMenuDisabled:!1;d.toggleCommentBox=function(a){a.stopPropagation(),d.showCommentBox=!d.showCommentBox,d.showCommentBox&&(d.showShareBox=!1)},d.toggleShareBox=function(a){a.stopPropagation();var b=d.feed.hasSharedFeed()?d.feed.getOrginalFeed():d.feed,c=b.isShareAble(!0);c.sucs?(d.showShareBox=!d.showShareBox,d.showShareBox&&(d.showCommentBox=!1)):k.show(l[c.rc],"warning")},d.getImageData=function(a,b){return function(){return{image:a,feed:b}}}}angular.module("ringid.notification").controller("NotiPopupController",a),a.$inject=["$$connector","OPERATION_TYPES","Auth","$scope","localData","remoteData","NotificationFactory","$$feedMap","feedFactory","rgDropdownService","Ringalert","MESSAGES"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){switch(a){case"utIds":d.utIds().save(b,{frnS:r.FRIEND});break;case"incomingUtIds":d.incomingUtIds().save(b,{frnS:r.INCOMING_FRIEND});break;case"outgoingUtIds":d.outgoingUtIds().save(b,{frnS:r.OUTGOING_FRIEND})}}function o(a){q&&!a||(q=!0,d.init(),k.getContactList())}var p=i.SYSTEM.FRIENDS,q=!1,r=e,s=0,t=0,u={totalPacket:0,complete:!1},v=function(a,b){var c,d,e,h=[],i=[],j=[];if(b)j=a;else{for(c=0,d=a.length;d>c;c++)a[c]!==f.currentUser().getUtId()&&(g.getContact(a[c])?i.push(g.getContact(a[c])):j.push(a[c]));i.lenght>0&&x(i)}var k=new ArrayBuffer(8*j.length),l=new DataView(k);for(c=0,e=0,d=j.length;d>c;c++)l.setInt32(e,0),e+=4,l.setInt32(e,j[c]),e+=4;for(c=0;c<l.byteLength;c++)h.push(l.getInt8(c));return h},w=function(a,b,c){var e=d.remove("utIds",a);b&&N.friends.remove(a),e&&!c||(e=d.remove("incomingUtIds",a),b&&N.incomingFriends.remove(a),e&&!c||(e=d.remove("outgoingUtIds",a),b&&N.outgoingFriends.remove(a)))},x=function(a){for(var b,c,d=0,e=a.length;e>d;d++)b=j.create(a[d]),c=b.friendshipStatus(),c===r.FRIEND?N.friends.save(b.getUtId(),b):c===r.INCOMING_FRIEND?N.incomingFriends.save(b.getUtId(),b):c===r.OUTGOING_FRIEND&&N.outgoingFriends.save(b.getUtId(),b),w(a[d].utId,!1,!0)},y=function(a,b){var c=b&&b.mg?b.mg:"Reqeust Failed";m.show(c,"error"),a&&a.reject({sucs:!1,mg:c})},z=function(a){var b,c,e;switch(a.actn){case p.TYPE_CONTACT_UTIDS:if(a.sucs===!0){for(0!==u.totalPacket||u.complete||(u.totalPacket=a.totalPacket),u.totalPacket--,c=0,e=a.utIds.length;e>c;c++)switch(a.utIds[c].value.frnS){case r.FRIEND:d.add("utIds",a.utIds[c].key,a.utIds[c].value);break;case r.INCOMING_FRIEND:d.add("incomingUtIds",a.utIds[c].key,a.utIds[c].value);break;case r.OUTGOING_FRIEND:d.add("outgoingUtIds",a.utIds[c].key,a.utIds[c].value)}0===u.totalPacket&&(u.complete=!0,d.initStorage())}else a.sucs===!1&&1111===a.rc&&k.getContactList();break;case p.TYPE_UPDATE_ADD_FRIEND:a.sucs===!0&&d.add("incomingUtIds",a.utId,{frns:r.INCOMING_FRIEND});break;case p.TYPE_UPDATE_DELETE_FRIEND:a.sucs===!0&&a.utId&&(w(a.utId,!0,!0),b=j.create(a),b.updateUserObj({frnS:r.NOT_FRIEND}));break;case p.TYPE_UPDATE_ACCEPT_FRIEND:a.sucs===!0&&(w(a.utId,!0),N.friends.add(a.utId,j.create(a)))}},A=function(a){switch(a){case"friendslist":case"friends":return N.friends;case"incoming":
return N.incomingFriends;case"outgoing":return N.outgoingFriends;case"userfriends":return N.userFriends}},B=function(){s=0,N.userFriends.reset()},C=function(a){var b,d=c.defer();return k.getUserContacts(a,t).then(function(a){if(s=0===s?a.tf:s,a.sucs===!0){t+=a.contactList.length;for(var c=0;c<a.contactList.length;c++)b=j.create(a.contactList[c]),N.userFriends.save(b.getKey(),b);d.resolve()}else d.reject(a)},function(a){d.reject(a)}),d.promise},D=function(a,b){var e,f=[],h=c.defer();switch(b=b?b:20,a=a?a:"utIds"){case"friends":case"friendslist":case"utIds":f=v(d.utIds().keys().slice(0,b)),N.state.isFriendsLoading=f.length>0;break;case"userfriends":break;case"incoming":case"incomingUtIds":f=v(d.incomingUtIds().keys().slice(0,b));break;case"outgoing":case"outgoingUtIds":f=v(d.outgoingUtIds().keys().slice(0,b))}return f.length>0?k.getContactListDetails({utIDs:f,uo:!1}).then(function(a){if(a.sucs===!0){for(e=0;e<a.contacts.length;e++)g.setContact(a.contacts[e].utId,a.contacts[e]);x(a.contacts),h.resolve(a)}else h.reject(a)},function(a){h.reject(a)}):h.reject({sucs:!1}),h.promise},E=function(a){if(a.length>0){var b=v(a,!0);if(b.length>0)return k.getContactListDetails({utIDs:b,uo:!1})}},F=function(a,b){switch(a.friend.isLoading(!0),a.action){case"remove":case"unfriend":return I(a,b);case"add":case"addfriend":return G(a,b);case"accept":return H(a,b);case"incoming_reject":case"outgoing_reject":case"reject":return J(a,b);case"block":return a.block=1,a.bv=0,K(a,b);case"unblock":return a.block=0,a.bv=1,K(a,b);default:return a.friend.isLoading(!1),!1}},G=function(a,b){var e=b?c.defer():!1,f=a.friend.getUtId();return k.sendFriendRequest({uId:a.friend.getKey()}).then(function(c){a.friend.isLoading(!1),c.sucs===!0?(d.add("outgoingUtIds",f,{frns:r.OUTGOING_FRIEND}),b&&e.resolve(c),a.friend.updateUserObj(angular.extend({},c,{frns:r.OUTGOING_FRIEND}))):y(e,c)},function(b){a.friend.isLoading(!1),y(e,b)}),b?e.promise:void 0},H=function(a,b){var d=b?c.defer():!1,e=a.friend.getUtId();return k.acceptFriendRequest({friendId:a.friend.getKey(),utId:a.friend.getUtId()}).then(function(c){a.friend.isLoading(!1),c.sucs===!0?(w(e,!0),a.friend.updateUserObj(angular.extend({},c,{frnS:r.FRIEND})),N.friends.save(e,a.friend),b&&d.resolve(c)):y(d,c)},function(b){a.friend.isLoading(!1),y(d,b)}),b?d.promise:void 0},I=function(a,b){var d=b?c.defer():!1,e=a.friend.getUtId();return k.unFriend({friendId:a.friend.getKey()}).then(function(c){a.friend.isLoading(!1),c.sucs===!0?(w(e,!0,!0),a.friend.updateUserObj(angular.extend({},c,{frnS:r.NOT_FRIEND})),b&&d.resolve(c)):y(d,c)},function(b){a.friend.isLoading(!1),y(d,b)}),b?d.promise:void 0},J=function(a,b){var d=b?c.defer():!1,e=a.friend.getUtId();return k.unFriend({friendId:a.friend.getKey()}).then(function(c){a.friend.isLoading(!1),c.sucs===!0?(a.friend.updateUserObj(angular.extend({},c,{frnS:r.NOT_FRIEND})),w(e,!0,!0),b&&d.resolve(c)):y(d,c)},function(b){a.friend.isLoading(!1),y(d,b)}),b?d.promise:void 0},K=function(a,b){var d=b?c.defer():!1;return k.blockFriend(a).then(function(c){a.friend.isLoading(!1),c.sucs===!0&&a.friend.setBlock(a.block),b&&d.resolve()},function(){a.friend.isLoading(!1),b&&d.reject()}),b?d.promise:void 0},L=function(){for(var a="",b=0;b<N.friends.size();b++)a+=",".fFactory.friends[b].getKey();return a},M=function(a,b){if(b){var d=c.defer();return k.searchContact(a,b).then(function(a){a.sucs?d.resolve():d.reject()},function(){d.reject()},function(a){if(a.sucs===!0){for(var b=0;b<a.searchedcontaclist.length;b++)g.setContact(a.searchedcontaclist[b].utId,a.searchedcontaclist[b]);x(a.searchedcontaclist)}else d.reject()}),d.promise}return k.searchContact(a,!1)},N={state:{noFriends:!1,isFriendsLoading:!1,isUserFriendsLoading:!1,isRequestsLoading:!1},getRequestCount:function(){var a=d.incomingUtIds().length()+N.incomingFriends.length();return a>99?"99+":a},getPendingCount:function(){return d.outgoingUtIds().length()+N.outgoingFriends.length()},totalFriends:function(a){return"userfriends"===a?s:d.utIds().length()+N.friends.length()},totalUserFriends:function(){return s},friends:l.createNew(),userFriends:l.createNew(),incomingFriends:l.createNew(),outgoingFriends:l.createNew(),process:z,getFriends:A,resetUserFriends:B,getUserContacts:C,getContactDetails:D,getContactDetailsByUtIds:E,removeFriend:I,friendAction:F,addFriend:G,rejectFriendRequest:J,acceptFriendRequest:H,searchContact:M,initFriends:o,addToUtIdList:n,blockFriend:K,getIds:L,getCurrentUser:function(){return f.currentUser},utIDsToByteArray:v};return h.subscribe(N.process,{action:[p.TYPE_CONTACT_UTIDS,p.TYPE_UPDATE_ADD_FRIEND,p.TYPE_UPDATE_DELETE_FRIEND,p.TYPE_UPDATE_ACCEPT_FRIEND],callWithUnresolved:!0}),N}angular.module("ringid.friend.friends_factory",["ringid.auth","ringid.common.contacts_factory","ringid.common.user_factory","ringid.common.services","ringid.common.factories"]).factory("friendsFactory",a),a.$inject=["$rootScope","SystemEvents","$$q","Contacts","APP_CONSTANTS","Auth","Storage","$$connector","OPERATION_TYPES","userFactory","friendsHttpService","$$stackedMap","Ringalert"]}(),function(){"use strict";function a(a,b,c){var d=this,e=b.SYSTEM.FRIENDS,f=c,g=b.SYSTEM.REQUEST_TYPE;d.searchContact=function(b,c){var d={actn:c?e.ACTION_FRIEND_SEARCH:e.TYPE_CONTACT_SEARCH,scat:f.TYPE_SEARCH_BY_ALL,schPm:b.schPm.utf8Encode(),st:b.st||0},h=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return h.test(b.schPm)&&(d.scat=f.TYPE_SEARCH_BY_EMAIL),a.pull(d,g.REQUEST,!0)},d.getContactList=function(b){var c={actn:e.TYPE_CONTACT_UTIDS,cut:-1,ut:b||-1};return a.send(c,g.REQUEST)},d.getContactListDetails=function(b){var c={actn:e.TYPE_CONTACT_LIST,uo:b.uo||!1,utIDs:b.utIDs};return a.pull(c,g.REQUEST,!0)},d.getUserContacts=function(b,c){var d={actn:e.TYPE_FRIEND_CONTACT_LIST,utId:b,st:c||0};return a.pull(d,g.REQUEST)},d.unFriend=function(b){var c={actn:e.TYPE_DELETE_FRIEND,uId:b.friendId};return a.request(c,g.UPDATE,!0)},d.changeFriendType=function(b){var c={actn:e.TYPE_ACTION_CHANGE_FRIEND_ACCESS,ct:b.ct,utId:b.utId};return a.request(c,g.UPDATE)},d.sendFriendRequest=function(b){var c={actn:e.TYPE_ADD_FRIEND,uId:b.uId};return a.request(c,g.UPDATE,!0)},d.blockFriend=function(b){var c={actn:e.TYPE_ACTION_BLOCK_UNBLOCK_FRIEND,idList:[b.friend.getUtId()],bv:b.bv};return a.request(c,g.REQUEST)},d.saveCallPvcEdit=function(b){var c={actn:b.actn,sn:b.callsn,sv:b.sv,utId:b.friend.getUtId()};return a.request(c,g.UPDATE)},d.saveChatPvcEdit=function(b){var c={actn:b.actn,sn:b.chatsn,sv:b.sv,utId:b.friend.getUtId()};return a.request(c,g.UPDATE)},d.saveFeedPvcEdit=function(b){var c={actn:b.actn,sn:b.feedsn,sv:b.sv,utId:b.friend.getUtId()};return a.request(c,g.UPDATE)},d.acceptFriendRequest=function(b){var c={actn:e.TYPE_ACCEPT_FRIEND,utId:b.utId};return a.request(c,g.UPDATE,!0)}}angular.module("ringid.friend.friends_factory").service("friendsHttpService",a),a.$inject=["$$connector","OPERATION_TYPES","APP_CONSTANTS"]}(),function(){"use strict";angular.module("ringid.friend",["ringid.config","ringid.friend.friends_factory"])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(b,c,e,f,g,h,i,j,k,l,m,n,o){function p(a){b.showMutual=!!a,b.showMutual&&r(),b.$rgDigest()}function q(c){b.showPending=!!c,b.showPending?(b.friends=a.getFriends("outgoing"),s(!0),a.getContactDetails("outgoing").then(function(){s(!1)},function(){s(!1)})):b.friends=a.getFriends(b.rgFriendsType),b.$rgDigest()}function r(){var c;C.length>0&&(s(!0),a.getContactDetailsByUtIds(C.splice(0,10),!0).then(function(a){if(a.sucs===!0)for(var d=0;d<a.contacts.length;d++)c=j.create(a.contacts[d]),b.friends.save(c.getKey(),c);s(!1)},function(a){a.sucs===!1&&1111===a.rc?r():s(!1)}))}function s(a){b.state.loading=!!a,a||h.recalculate(b),b.state.loading||(b.state.noData=0===b.friends.length()),b.$rgDigest()}function t(){("friends"===b.rgFriendsType||"friendslist"===b.rgFriendsType)&&b.friendName&&b.friendName.length>0&&(s(!0),a.searchContact({schPm:b.friendName},!0).then(function(){s(!1)},function(){s(!1)}))}function u(c){var d,e;b.showMutual?r():b.showPending?(s(!0),a.getContactDetails("outgoing").then(function(){s(!1)},function(){s(!1)})):(c||!b.state.loading&&b.friends.length()!==b.totalFriends(b.rgFriendsType))&&(s(!0),"userfriends"===b.rgFriendsType?(d=a.getUserContacts,e=b.profileObj.getUtId()):d=a.getContactDetails,d(e).then(function(){b.friends.length()<20&&b.friends.length()<b.totalFriends(b.rgFriendsType)?(s(!1),u()):s(!1)},function(a){a.sucs===!1&&1111===a.rc?u(c):"friendslist"===b.rgFriendsType&&5>A?(A++,setTimeout(function(){u(c)},2e3)):s(!1)}))}function v(a){return{data:function(){return{target:a}},promise:g.getMutualFriend(a)}}function w(){b.ddTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event: $event})" href="#"> <span class="icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" class="border-0" href="#"><span class="icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" class="border-0" href="#"><span class="icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a></div>',b.ddAction=function(c){c.friend.isLoading()||(a.friendAction(c,!0).then(function(){b.$rgDigest()},function(){b.$rgDigest()}),l.close(c.event))},b.showBackKey=0,b.showBack=function(a,c){var d=c.target.getAttribute("data-is-anchor");d||(b.showBackKey=a,c.preventDefault(),c.stopPropagation(),b.$rgDigest())}}function x(){switch(y=m.subscribe(function(a){switch(a.actn){case z.TYPE_CONTACT_UTIDS:"friends"!==b.rgFriendsType&&"friendslist"!==b.rgFriendsType||!B||(B=!1,setTimeout(function(){i.utIds().length()>0&&b.friends.length()<20&&u(!0),b.state.noData=0===b.friends.length()},1e3));break;default:s(!1)}},{action:[z.TYPE_CONTACT_UTIDS,z.TYPE_UPDATE_ADD_FRIEND,z.TYPE_UPDATE_DELETE_FRIEND],callWithUnresolved:!0}),b.rgFriendsType){case"friendslist":break;case"friends":a.initFriends(),b.isOwner=!0,b.pendingRequests=a.getFriends("outgoing"),w();break;case"userfriends":w(),b.totalUserFriends=a.totalUserFriends,b.profileObj=e.getProfile(d.uId),u(!0),g.getMutualFriend(b.profileObj).then(function(a){a.sucs===!0&&(b.profileObj.updateUserObj({nmf:a.mfIDs.length}),C=a.mfIDs,b.$rgDigest())})}}var y,z=n.SYSTEM.FRIENDS,A=0,B=!0,C=[];b.isOwner=!1,b.showMutual=!1,b.showPending=!1,b.friendName="",b.state={loading:!1,noData:!1},b.friends=a.getFriends(b.rgFriendsType),b.totalFriends=a.totalFriends,b.getPendingCount=a.getPendingCount,b.toggleShowMutual=p,b.toggleShowPending=q,b.loadMoreFriends=u,b.getMutualFriend=v,b.searchContact=t,b.showComingSoon=function(a){a.preventDefault(),a.stopPropagation(),o.show("Coming soon","info")},x(),b.$on("$destroy",function(){"userfriends"===b.rgFriendsType&&a.resetUserFriends(),m.unsubscribe(y)})}function j(d,i,j){function k(){e.innerHeight+e.scrollY>=f[0].body.offsetHeight&&d.loadMoreFriends()}var l;b.get(j.rgFriendsTpl).success(function(a){i.append(c(a)(d)),d.$rgDigest()}),"friends"!==d.rgFriendsType&&"userfriends"!==d.rgFriendsType||angular.element(e).on("scroll",k),d.$on("$destroy",function(){switch(d.rgFriendsType){case"friends":l=a.outgoingFriends.keys();for(var b=0;b<l.length;b++)g.add("outgoingUtIds",l[b],{frnS:h.INCOMING_FRIEND});a.outgoingFriends.reset();case"userFriends":angular.element(e).off("scroll",k)}})}return i.$inject=["$scope","$attrs","profileFactory","$document","InviteFactory","rgScrollbarService","Contacts","userFactory","$$stackedMap","rgDropdownService","$$connector","OPERATION_TYPES","Ringalert"],{restrict:"AE",scope:{rgFriendsType:"@"},controller:i,link:j}}angular.module("ringid.friend").directive("rgFriends",a),a.$inject=["friendsFactory","$ringhttp","$compile","$routeParams","$window","$document","Contacts","APP_CONSTANTS"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(b,c,d,e,f,g,h,i,j,k){function l(c){c.friend.isLoading()||a.friendAction(c,!0).then(function(){b.requests.length()<s&&n(),b.$rgDigest()},function(){b.requests.length()<s&&n(),b.$rgDigest()})}function m(a){b.state.loading=a,a||(b.state.noMoreData=0===f.incomingUtIds().length(),e.recalculate(b),b.$emit(k.FEED.HEIGHT)),b.$rgDigest()}function n(c){(c||!b.state.noMoreData&&!b.state.loading)&&(m(!0),a.getContactDetails("incoming",s).then(function(){m(!1)},function(a){a.sucs===!1&&1111===a.rc?n(!0):m(!1)}))}function o(a){return{data:function(){return{target:a}},promise:d.getMutualFriend(a)}}function p(){s>20&&b.$emit(k.FEED.HEIGHT),f.incomingUtIds().length()>0&&b.requests.length()<s&&n(!0),q=h.subscribe(function(a){switch(a.actn){case r.TYPE_CONTACT_UTIDS:f.incomingUtIds().length()>0&&b.requests.length()<s&&n(!0);break;default:m(!1)}},{action:[r.TYPE_CONTACT_UTIDS,r.TYPE_UPDATE_ADD_FRIEND,r.TYPE_UPDATE_DELETE_FRIEND]})}var q,r=g.SYSTEM.FRIENDS,s=parseInt(b.loadCount);b.state={loading:!1,noMoreData:!1},b.requests=a.getFriends("incoming"),b.getRequestCount=a.getRequestCount,b.friendAction=l,b.loadMoreRequests=n,b.getMutualFriend=o,p(),b.$on("$destroy",function(){h.unsubscribe(q)})}function h(a,c,d){var e=d.templateUrl?d.templateUrl:"pages/dropdowns/friend-request-dropdown.html";f.get(e).success(function(d){c.append(b(d)(a)),a.$rgDigest()})}return g.$inject=["$scope","profileFactory","InviteFactory","rgScrollbarService","Contacts","OPERATION_TYPES","$$connector","userFactory","Ringalert","SystemEvents"],{restrict:"AE",scope:{loadOnScroll:"@",loadCount:"@",templateUrl:"@"},link:h,controller:g}}angular.module("ringid.friend").directive("rgRequests",a),a.$inject=["friendsFactory","$compile","$routeParams","$window","$document","$ringhttp"]}(),function(){"use strict";function a(a){var b=this,c=!1,d=!1;b.close=function(e){d&&(d.style.display="none",c.resetTag(e),c.$rgDigest(),d=!1,c=!1,a.unbindHandler("document","click",b.close))},b.open=function(e,f){d=e,c=f,d.style.display="block",a.bindHandler("document","click",b.close)}}function b(a,b,c,d,e,f,g){var h=function(a,f){function h(b){b?a.selectedTag=a.selectedTag<=0?0:a.selectedTag-1:a.selectedTag=a.selectedTag+1>=a.tagSuggestions.length?a.tagSuggestions.length-1:a.selectedTag+1,a.selectedTag>=0&&(o.value=a.tagSuggestions[a.selectedTag].sk),g.scrollTo(a,a.selectedTag/a.tagSuggestions.length*100),a.$rgDigest()}function i(b){var c=b.keyCode||b.which,e=o.value.trim();27!==c&&13!==c&&10!==c||(b.preventDefault(),b.stopPropagation(),e.length>0?(a.selectedTag>-1?a.addHashTag(a.tagSuggestions[a.selectedTag]):a.addHashTag({sk:e,ukey:0}),d.close(),a.tagLoading=!1):o.value="")}function j(b){var c=b.keyCode||b.which,e=o.value.trim();38===c&&e.length>0?h(!0):40===c&&e.length>0?h(!1):27===c||13===c||10===c?b.preventDefault():e.length>0?n=setTimeout(k,200):0===e.length&&(clearTimeout(n),d.close()),a.$rgDigest()}function k(){var b=o.value.trim();b.length>0&&m!==b?(d.open(l,a),m=b,a.tagLoading=!0,a.selectedTag=-1,a.tagSuggestions=[],c.fetchHashtagSuggestion(b).then(function(b){a.tagLoading&&(clearTimeout(n),a.tagLoading=!1,b.sucs===!0?a.tagSuggestions=b.sgstn:d.close(),a.$rgDigest())})):clearTimeout(n),a.$rgDigest()}var l,m,n,o;a.selectedTag=-1,a.tagList=b.tagList,a.tagSuggestions=[],a.tagLoading=!1,o=f[0].parentNode.querySelector("textarea#add-hashtag"),l=f[0].parentNode.querySelector("div#hashtag-dropdown"),o.addEventListener("keyup",j),o.addEventListener("keydown",i),a.removeTag=function(c,d){c.preventDefault(),b.tagList.splice(d,1),a.$rgDigest()},a.addHashTag=function(b){a.tagList.push(b),d.close(!0)},a.resetTag=function(c){b.tagSuggestions=[],a.selectedTag=-1,c&&(o.value=""),a.$rgDigest()},a.gotMedias=function(){return b.audioFiles.length>0||b.videoFiles.length>0},a.$on(e.FILE_UPLOAD.UPLOADS_POSTED,function(){a.tagList=[],a.resetTag(!0)}),a.$on("$destroy",function(){o.removeEventListener("keyup",j),o.removeEventListener("keypress",i)})};return{restrict:"E",link:h,template:'<div ng-show="gotMedias()"><div ><ul class="tag-fnd-lst"><li ng-repeat="tag in tagList" ><span class="tag-title" ng-bind="tag.sk" ></span>&nbsp;<span class="icon-close f-11" rg-click="removeTag($event, $index)"></span></li></ul></div></div><div  ng-show="ddControl.uploadWhat !== \'image\' && getMedia(true).length > 0"  class="b-t-b"><span class="top-r float-left" data-tool="Type something for tags suggestion OR press enter to add new tag"><img class="p-10" src="images/view.png"/></span><textarea id="add-hashtag" ng-model="tagName" type="text"  class="media-tags float-left"  placeholder="Add Hashtag" ></textarea><div class="clear"></div></div><div id="hashtag-dropdown" class="m-s-height tag-dd active" style="display:none;"><div class="loader-s" ng-show="tagLoading"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div><div class="ringscroll" style="position:relative;width:auto;overflow:hidden;height:100%;"><ul class="m-s-result" rg-scrollbar="true" style="overflow: hidden;"><li ng-repeat="tag in tagSuggestions track by tag.ukey" ng-class="{active:$index==selectedTag}"  class="m-t-icon" rg-click="addHashTag({sk: tag.sk, ukey: tag.ukey})"><a href="javascript:void(0)" title="{{tag.sk}}" ng-bind="tag.sk" > abc</a></li></ul></div></div>'}}angular.module("ringid.common.rghashtag_directive",["ringid.common.services","ringid.common.factories"]).service("rgHashtagService",a).directive("rgHashtag",b),a.$inject=["GlobalEvents"],b.$inject=["$compile","fileUploadService","Media","rgHashtagService","SystemEvents","$rootScope","rgScrollbarService"]}(),function(){"use strict";function a(a,b,c){function d(a,d,e,f,g,h,i,j,k,l){function m(){x=0,d.previewStartAt=0,d.ddControl.uploadWhat="image",d.ddControl.createAlbum=!1,d.ddControl.albumName="",d.ddControl.selectedAlbum=0,b.resetUpload(),d.$rgDigest()}function n(a){return a?b[d.ddControl.uploadWhat+"Files"]:b[d.ddControl.uploadWhat+"Files"].slice(d.previewStartAt,d.previewStartAt+3)}function o(a){b[d.ddControl.uploadWhat+"Files"][a].getQueued()?b[d.ddControl.uploadWhat+"Files"][a].cancelUpload():b[d.ddControl.uploadWhat+"Files"].splice(d.previewStartAt+a,1),0===b[d.ddControl.uploadWhat+"Files"].length?m():d.previewStartAt=d.previewStartAt>0?d.previewStartAt-1:d.previewStartAt}function p(){d.previewStartAt=d.previewStartAt-3>0?d.previewStartAt-3:0}function q(){d.previewStartAt=d.previewStartAt+3<=b[d.ddControl.uploadWhat+"Files"].length-4?d.previewStartAt+3:b[d.ddControl.uploadWhat+"Files"].length-3}function r(a){return b[d.ddControl.uploadWhat+"Files"].length>0?d.ddControl.uploadWhat!==a:!1}function s(){b.videoFiles=[],b.imageFiles=[];var a,c,e=this;for(a=0;a<e.files.length;a++)x+=e.files[a].size;if(e.files.length+b.audioFiles.length>w.AUDIO_UPLOAD_LIMIT)i.show("Maximum upload limit "+w.AUDIO_UPLOAD_LIMIT,"warning");else if(x>w.MEDIA_UPLOAD_SIZE_LIMIT)for(i.show("Maximum allowed total upload files size 500MB!","warning"),a=0;a<e.files.length;a++)x-=e.files[a].size;else{d.hasOwnProperty("rgUploadAction")&&d.rgUploadAction("audio"),0===b.audioFiles.length&&(d.ddControl.uploadWhat="audio",d.ddControl.selectedAlbum=null,b.setUploadAlbum(-1));var f=b.audioFiles.length;for(a=0,c=e.files.length;c>a;a++)v("audio",e.files[a])?b.queueFile("audio",e.files[a]):i.show("Invalid Audio File: "+e.files[a].name,"error");k.$broadcast(h.FILE_UPLOAD.QUEUE_START),b.uploadQueue("audio",f)}e.value=null,d.$rgDigest()}function t(){var a,c,e=this;for(a=0;a<e.files.length;a++)x+=e.files[a].size;if(e.files.length+b.videoFiles.length>w.VIDEO_UPLOAD_LIMIT)i.show("Maximum upload limit "+w.VIDEO_UPLOAD_LIMIT,"warning");else if(x>w.MEDIA_UPLOAD_SIZE_LIMIT)for(i.show("Maximum allowed total upload files size 500MB!","warning"),a=0;a<e.files.length;a++)x-=e.files[a].size;else{0===b.videoFiles.length&&(d.ddControl.uploadWhat="video",d.ddControl.selectedAlbum=null,b.setUploadAlbum(-1)),d.hasOwnProperty("rgUploadAction")&&d.rgUploadAction("video");var f=b.videoFiles.length;for(a=0,c=e.files.length;c>a;a++)v("video",e.files[a])?b.queueFile("video",e.files[a]):i.show("Invalid Video File: "+e.files[a].name,"error");b.uploadQueue("video",f),k.$broadcast(h.FILE_UPLOAD.QUEUE_START)}e.value=null,d.$rgDigest()}function u(){d.ddControl.uploadWhat="image";var a=this;switch(d.rgUploadType){case"coverphoto":case"profilephoto":case"tagchatimage":case"chatimage":if(v("image",a.files[0])){var c=b.queueFile(d.rgUploadType,a.files[0]);d.hasOwnProperty("rgUploadAction")&&d.rgUploadAction()({action:d.rgUploadType,uploadFile:c})}else i.show("Invalid Image File: "+a.files[0].name,"error");a.value=null;break;case"status":if(a.files.length+b.imageFiles.length>w.IMAGE_UPLOAD_LIMIT){i.show("Maximum upload limit "+w.IMAGE_UPLOAD_LIMIT,"warning");break}for(var e=b.imageFiles.length,f=0;f<a.files.length;f++)v("image",a.files[f])?b.queueFile("image",a.files[f]):i.show("Invalid Image File: "+a.files[f].name,"error");k.$broadcast(h.FILE_UPLOAD.QUEUE_START),b.uploadQueue("image",e),a.value=null}d.$rgDigest()}function v(a,b){var c;switch(a){case"image":c=new RegExp("image/*");break;case"audio":c=new RegExp("audio/mp3*");break;case"video":c=new RegExp("video/mp4");break;case"default":}return c.test(b.type)}var w=g,x=0;d.uploadProgress=b.uploadProgress,d.previewStartAt=0,d.tagList=b.tagList,d.ddHtml="pages/dropdowns/album-dropdown.html",d.ddControl={Media:c,uploadWhat:"image",createAlbum:!1,albumName:"",selectedAlbum:0},d.selectAlbum=function(){return{data:function(){return{from:"feedpost",mediaType:d.ddControl.uploadWhat}}}},d.getMedia=n,d.removeMedia=o,d.loadPrevious=p,d.loadNext=q,d.disableUpload=r,d.uploadAudio=s,d.uploadVideo=t,d.uploadImage=u,d.$on(h.FILE_UPLOAD.UPLOADS_POSTED,m),d.$on("$destroy",function(){var a,c;switch(d.rgUploadType){case"coverphoto":b.coverImageFile&&(b.coverImageFile.cancelUpload(),b.coverImageFiles=null);break;case"profilephoto":b.profileImageFile&&(b.profileImageFile.cancelUpload(),b.profileImageFiles=null);break;case"tagchatimage":case"chatimage":b.chatImageFiles[d.rgUploadBoxValue]&&(b.chatImageFiles[d.rgUploadBoxValue].cancelUpload(),delete b.chatImageFiles[d.rgUploadBoxValue]);break;case"status":if(b.imageFiles.length>0){for(a=0,c=b.imageFiles.length;c>a;a++)b.imageFiles[a].cancelUpload();b.imageFiles=[]}else if(b.videoFiles.length>0){for(a=0,c=b.videoFiles.length;c>a;a++)b.videoFiles[a].cancelUpload();b.videoFiles=[]}else if(b.audioFiles.length>0){for(a=0,c=b.audioFiles.length;c>a;a++)b.audioFiles[a].cancelUpload();b.audioFiles=[]}}})}d.$inject=["Auth","$scope","mediaMetadata","imageQuality","APP_CONSTANTS","SystemEvents","Ringalert","$$q","$rootScope","rgDropdownService"];var e=function(c,d,e){var f,g,h,i=e.rgUploadType,j="",k="",l='<div class="to-add" ng-show="ddControl.uploadWhat !== \'image\' && getMedia(true).length > 0" ><span ><a  class="btn-share vid top-l" data-tooltip-post="Add to album"  rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true" ringbox-type="remote" ringbox-target="pages/dropdowns/popup-album-dropdown.html" ringbox-data="selectAlbum(media.value)" ></a> </span></div><rg-hashtag></rg-hashtag><div class="status-photo-view" style="border-bottom:1px solid #ebebeb;margin:0;padding:0;margin-bottom:10px;" id="img-height" ng-show="getMedia(true).length > 0"><div id="sts-img-preview" style="text-align:center;" class="scroll"><div ng-show="previewStartAt+3 < getMedia(true).length" class="np-box icon-right-arrow"  style="right:0;margin-top:60px;" rg-click="loadNext()"></div><div ng-show="previewStartAt > 0" class="np-box icon-left-arrow" style="left:0;margin-top:60px;"  rg-click="loadPrevious()"></div><div style="margin-top:3px;" class="status-photo-view-thumb" ng-repeat="image in getMedia()"><div ng-show="image.getProgress() !== 100" class="progress-bar-placement" style="position:absolute;width:100%;text-align:center;"><div class="percent">{{image.getProgress()}}%</div><div class="progress-bar"><div class="uploaded" ng-style="{\'width\': image.getProgress()+ \'%\'}"></div></div></div><div  id="singleImage{{$index}}"  style="position:absolute;width:100%;text-align:center;"><input class="add-title" ng-model="image.cptn" ng-model-options="{ getterSetter: true }" type="text" name="" placeholder="Add Photo Title" ng-show="!image.progressVisible" /><div class="photo-view" style="background-image: url({{image.getPreview()}}); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer;"><div class="status-photo-view-thumb-hover"><span id="closebtn0" class="close" style="display: block;" rg-click="removeMedia($index)" inc="0"><div class="icon-close up-p"></div></span></div></div></div></div></div>';switch(i){case"coverphoto":case"profilephoto":j='<input  id="'+i+'" type="file" name="'+i+'"  accept="image/*" >',d.append(a(j)(c));break;case"tagchatimage":case"chatimage":j='<label  class="icon-camera ico-sty ng-binding ng-scope"><input  id="'+i+'" type="file" style="display:none;" accept="image/*" ></label>',d.append(a(j)(c));break;case"audio":j='<a data-tooltip-post="Add Audios" href="javascript:void(0)"><label  class="audio-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a>',d.append(a(j)(c));break;case"video":j='<a data-tooltip-post="Add Videos" href="javascript:void(0)"><label  class="video-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="video" type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a>',d.append(a(j)(c));break;case"status":j='<div ng-show="rgUploadEnabled "class="post-b-ico"><a data-tooltip-post="Add Videos" href="javascript:void(0)" class="p-ab"><label  class="status-ico video-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'video\')" id="video"type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a></div><div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Audios" href="javascript:void(0)" class="p-ab"><label  class="status-ico audio-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'audio\')" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a></div>',e.rgUploadFeed&&"true"==e.rgUploadFeed&&(j='<div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Photos"  href="javascript:void(0)" class="p-ab"><label  class="status-ico camera-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'image\')" id="'+i+'" type="file" style="display:none;" multiple="multiple" accept="image/*"></label></a></div>'+j),d.append(a(j)(c)),f=d.parent().prepend(a(l)(c))}k=d[0].querySelector("input#"+i),"status"===i?(e.rgUploadFeed&&"true"==e.rgUploadFeed&&k.addEventListener("change",c.uploadImage),g=d[0].querySelector("input#video"),g.addEventListener("change",c.uploadVideo),h=d[0].querySelector("input#audio"),h.addEventListener("change",c.uploadAudio)):"audio"===i?k.addEventListener("change",c.uploadAudio):"video"===i?k.addEventListener("change",c.uploadVideo):k.addEventListener("change",c.uploadImage),c.$rgDigest(),c.$on("$destroy",function(){switch(i){case"status":k.removeEventListener("change",c.uploadImage),h.removeEventListener("change",c.uploadAudio),g.removeEventListener("change",c.uploadVideo);break;case"image":k.removeEventListener("change",c.uploadImage);break;case"audio":k.removeEventListener("change",c.uploadAudio);break;case"video":k.removeEventListener("change",c.uploadVideo)}b.removeScope(c)}),b.setScopeForDigest(c)};return{restrict:"AE",scope:{rgUploadEnabled:"=",rgUploadType:"@",rgUploadAction:"&",rgUploadBoxValue:"="},link:e,controller:d}}angular.module("ringid.common.rgupload_directive",["ringid.common.rghashtag_directive","ringid.common.services","ringid.common.factories"]).directive("rgUpload",a),a.$inject=["$compile","fileUploadService","Media"]}(),function(){"use strict";function a(a){var b=this,c=!1,d=!1;b.close=function(){d&&(c.searchText="",d.style.display="none",c.$rgDigest(),d=!1,c=!1,a.unbindHandler("document","click",b.close))},b.open=function(e,f){d=e,c=f,d.style.display="block",a.bindHandler("document","click",b.close)}}function b(a){function b(b,c,d,e,f,g,h,i){function j(){q!==b.searchText&&(b.resetSearch(),p=0)}function k(){b.noResult=0===b.listData.length(),b.gotAllResult=b.listData.length()>0,b.showLoadbar=!1,b.$rgDigest()}function l(c){j(),(c||!b.showLoadbar&&!b.gotAllResult)&&(clearTimeout(o),b.showLoadbar=!0,b.showDropdown||a.open(b.template,b),q=b.searchText,g.searchContact({schPm:b.searchText,st:b.listData.length()}).then(m,m),o=setTimeout(k,8e3),b.$rgDigest())}function m(a){if(clearTimeout(o),a.sucs===!0){for(var c=0,e=a.searchedcontaclist.length;e>c;c++)n=d.create(a.searchedcontaclist[c]),n&&b.listData.save(n.getKey(),n);a.searchedcontaclist.length>0&&i.recalculate(b),b.showLoadbar=!1,b.noResult=0===b.listData.length(),b.$rgDigest()}else p++,3>p?l(!0):(clearTimeout(o),k())}var n,o,p=0,q="";b.searchText="",b.gotAllResult=!1,b.showLoadbar=!1,b.noResult=!0,b.listData=c.createNew(),b.resetSearch=function(){p=0,b.noResult=!1,b.gotAllResult=!1,b.listData.reset(),b.$rgDigest()},b.contactListAction=function(a){a.friend.isLoading()||(e.friendAction(a,!0).then(function(){b.$rgDigest()},function(){b.$rgDigest()}),b.$rgDigest())},b.doSearch=l,b.getMutualFriend=function(a){return{data:function(){return{target:a}},promise:f.getMutualFriend(a)}}}var c=function(b,c){function d(a){"a"!==a.target.tagName.toLowerCase()&&"a"!==a.target.parentNode.tagName.toLowerCase()&&a.preventDefault(),a.stopPropagation()}var e=c.find("input");b.template=c[0].querySelector("#search-dropdown"),b.template.style.display="none",e.on("keypress",function(a){13===a.keyCode&&a.preventDefault()}),b.doTheSearch=function(){b.searchText.length>0?b.doSearch():a.close()},c.on("click",d),b.$on("$destroy",function(){c.off("click",d)})};return b.$inject=["$scope","$$stackedMap","userFactory","friendsFactory","InviteFactory","friendsHttpService","$timeout","rgScrollbarService"],{restrict:"E",scope:{placeholder:"@"},templateUrl:"pages/dropdowns/search-dropdown.html",link:c,controller:b}}angular.module("ringid.common.rgsearch_directive",["ringid.config","ringid.common.user_factory","ringid.friend.friends_factory"]).service("rgSearchService",a).directive("rgSearch",b),a.$inject=["GlobalEvents"],b.$inject=["rgSearchService"]}(),function(){"use strict";function a(a,b,c,d){function e(e,f){function g(){m=f[0].querySelector("#invname"),n=f[0].querySelector("#invavatarlink"),o=f[0].querySelector("#invavatarimg"),p=f[0].querySelector("#invmutual"),q=f[0].querySelector("#invaddfriend"),f[0].addEventListener("mouseenter",i),f[0].addEventListener("mouseleave",h),f[0].style.display="block",j(),h()}function h(){i(),r=setInterval(j,5e3)}function i(){clearInterval(r)}function j(){s=s?c.suggestionFriends.next(s.getUtId())||c.suggestionFriends.bottom():c.suggestionFriends.bottom(),s?(m.textContent=s.getName(),m.setAttribute("href",s.link()),n.setAttribute("href",s.link()),o.setAttribute("src",s.avatar("thumb")),p.textContent=s.commonFriends()+" mutual friends",s.commonFriends()>0?p.style.display="block":p.style.display="none",k()):f[0].style.display="none"}function k(a){s.isLoading()?q.parentElement.classList.add("f-loading"):q.parentElement.classList.remove("f-loading")}function l(){a.subscribe(function(){t||(t=setTimeout(function(){g()},1e3))},{action:[u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),setTimeout(c.init,5e3)}var m,n,o,p,q,r,s,t,u=b.SYSTEM.FRIENDS;f[0].style.display="none",e.removeOutGoingFriends=function(){for(var a=[],b=c.suggestionFriends.all(),d=c.suggestionFriends.length(),e=0;d>e;e++)0!==b[e].value.friendshipStatus()&&a.push(b[e].value.getUtId());for(var f=0;f<a.length;f++)c.suggestionFriends.remove(a[f]);
},e.getSuggestions=function(){return e.removeOutGoingFriends(),c.suggestionFriends.length()<5&&c.getSuggestionContactsDetails(),{data:function(){return{target:c.suggestionFriends}}}},e.removeSugg=function(){c.removeSuggestion(s.getUtId(),"remove"),j()},e.getMutualFriend=function(){return{data:function(){return{target:s}},promise:c.getMutualFriend(s)}},e.friendRequestAction=function(){var a=3===s.friendshipStatus()?"remove":"addfriend",b=s;i(),d.friendAction({friend:b,action:a},!0).then(function(a){j(),k(a.sucs),h(),a.sucs===!0&&c.removeSuggestion(b.getUtId()).then(function(a){a.sucs===!0&&c.suggestionFriends.remove(b.getUtId())})},function(){k(),h()}),k()},l(),e.$on("$destroy",function(){f[0].removeEventListener("mouseenter",h),f[0].removeEventListener("mouseenter",i)})}return{restrict:"A",templateUrl:"pages/partials/friend-invite.html",link:e}}angular.module("ringid.common.rginvite_directive",["ringid.common.invite_factory","ringid.friend.friends_factory"]).directive("rgInvite",a),a.$inject=["$$connector","OPERATION_TYPES","InviteFactory","friendsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a){function b(){a.$parent&&1!==a.$parent.$id?a.$parent.$rgDigest():a.$rgDigest()}a.startAt=0,a.getMyStickers=function(){return a.myStickerCatIds().slice(a.startAt,a.startAt+4)},a.getTopStickers=function(){return e.getStickerCategories("top").slice(0,4)},a.loadPrevious=function(c){a.startAt=a.startAt>0?a.startAt-1:0,c.stopPropagation(),b()},a.loadNext=function(c){a.startAt=a.startAt+3<a.myStickerCatIds().length-1?a.startAt+1:a.startAt,c.stopPropagation(),b()},a.myStickerCatIds=e.getMyStickerCatIds,a.getSticker=e.getStickerCategoryObject,a.emoticonMap=e.getEmoticonMap()}var j=function(b,c,i){function j(){b.$parent&&1!==b.$parent.$id?b.$parent.$rgDigest():b.$rgDigest()}function k(a){a.preventDefault(),t=!t,t?n(a):l()}function l(a){(!a||"click"!==a.type||a.target!==c[0]&&a.target.parentNode&&a.target.parentNode!==c[0]&&a.target.parentNode.parentNode!==c[0]&&"pt-top"!==a.target.className)&&(t=!1,document.removeEventListener("click",l),document.removeEventListener("scroll",l),c[0].removeEventListener("resize",o),q[0].parentNode.removeChild(q[0]))}function m(d){q=a(d)(b),c.append(q),o(),document.addEventListener("click",l),document.addEventListener("scroll",l),window.addEventListener("resize",o)}function n(a){r=a,g.get(s)?m(g.get(s)):h.get(s).success(function(a){m(a)})}function o(){var a=0,e=c[0].getBoundingClientRect(),f=d.viewport.x-e.width,g=d.viewport.y;a=Math.floor(e.width/2),r.clientX+u<f&&r.clientY+u<g?(b.emoWindowStyle.top=e.top+(a+15)+"px",b.emoWindowStyle.left=e.left+(a+5)+"px"):r.clientX+u>f&&r.clientY+u>g?(b.emoWindowStyle.top=e.top-w+(a-5)+"px",b.emoWindowStyle.left=e.left-v+(a-5)+"px"):r.clientX+u>f?(b.emoWindowStyle.top=e.top+(a+5)+"px",b.emoWindowStyle.left=e.left-v+(a-5)+"px"):r.clientY+u>g&&(b.emoWindowStyle.top=e.top-w+(a-5)+"px",b.emoWindowStyle.left=e.left+(a+5)+"px"),j()}function p(a,c){c.stopPropagation(),i.clicked&&b.$eval(i.clicked)(a,c),l(),j()}var q,r,s="pages/partials/emoticon-window.html",t=!1,u=400,v=300,w="true"==i.showSticker?300:260;b.emoWindowStyle={height:w+"px",width:v+"px"},b.showsticker="true"==i.showSticker,b.selectedStickerCatId=0,c[0].addEventListener("click",k),b.selectEmoOrSticker=p,b.selectStickerCatId=function(a,c){a.stopPropagation(),b.selectedStickerCatId=c,e.getStickerMapByCatId(c).then(function(a){b.emoticonMap=a,j()}),f.scrollTop(b),j()},b.showEmoticons=function(a){a.stopPropagation(),b.emoticonMap=e.getEmoticonMap(),j()},b.$on("$destroy",function(){document.removeEventListener("click",l),document.removeEventListener("scroll",l),c[0].removeEventListener("resize",o)})};return i.$inject=["$scope"],{restrict:"A",link:j,controller:i}}angular.module("ringid.common.rgemoticon_directive",[]).directive("rgEmoticon",a),a.$inject=["$compile","$timeout","$document","utilsFactory","StickerFactory","rgScrollbarService","$templateCache","$ringhttp"]}(),function(){"use strict";function a(){return{restrict:"A",controller:["$scope","$element",function(a,b){this.setPopupStyle=function(a,c){b[0].style.height=a+"px",b[0].style.width=c+"px"}}]}}function b(a,b){return{restrict:"A",require:"^rgImgChange",scope:{rgImgObj:"="},link:function(c,d,e,f){function g(a,b){a>o||b>n?b/n>=a/o?(p=n,q=Math.floor(n/b*a)):(q=o,p=Math.floor(o/a*b)):(q=a,p=b),r[0].style.width=p+"px",r[0].style.height=q+"px",j>p&&(p=j),k>q&&(q=k),p=p+l+m,q+=m,f.setPopupStyle(q,p)}var h=500,i=500,j=0,k=0,l=300,m=60,n=0,o=0,p=0,q=0,r=a('<img src="'+c.rgImgObj.src()+'" />')(c);n=b.viewport.x-40-l-m,o=b.viewport.y-40-m,j=n-i>i?n-i:i,k=o-h>h?o-h:h,d.append(r),e.$observe("rgImg",function(a){r[0].setAttribute("src",""),r[0].setAttribute("src",a),g(c.rgImgObj.getIh(),c.rgImgObj.getIw())})}}}angular.module("ringid.common.rgimg_directive",[]).directive("rgImg",b).directive("rgImgChange",a),b.$inject=["$compile","utilsFactory"]}(),function(){"use strict";function a(a,b,c){function d(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c,d){"album"===d?b.state.albumsLoading=c:(b.state.imagesLoading=c,a.recalculate(b)),b.$rgDigest()}function o(){!b.state.imagesLoading&&b.activeAlbum.getImages().length()<b.activeAlbum.getTotalImageCount()&&(n(!0,"image"),d.loadMoreImage(b.activeAlbum.getKey(),e.uId))}function p(a){return function(){return{image:a,popupFrom:"profile"}}}function q(a){var c="Are you sure you want to delete?",e=j.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:c}},templateUrl:"pages/partials/ringbox-confirm.html"});e.result.then(function(c){c&&d.deleteImage(a).then(function(c){c.sucs===!0?b.activeAlbum.removeImage(a.getKey()):k("Image delete failed","error"),b.$rgDigest()})})}function r(a){a?(b.activeAlbum=a,b.showAlbumPreview=!1,b.activeAlbum.getImages().length()<20&&b.loadMoreImage()):(b.showAlbumPreview=!0,b.activeAlbum=null),b.$rgDigest()}function s(a){b.forSelection&&c.$broadcast(h.IMAGE.DO_REPOSITION,{image:a.src()})}function t(){u=l.subscribe(function(a){switch(a.actn){case v.TYPE_ALBUM_IMAGES:case v.TYPE_FRIEND_ALBUM_IMAGES:a.sucs===!1&&1111===a.rc?d.fetchAllAlbums(e.uId):(d.processResponse(a),n(!1));break;case v.FETCH_FRIEND_ALBUM_LIST:case v.FETCH_ALBUM_LIST:a.sucs===!1&&1111===a.rc?o():(d.processResponse(a,e.uId),n(!1,"album"))}},{action:[v.TYPE_ALBUM_IMAGES,v.TYPE_FRIEND_ALBUM_IMAGES,v.FETCH_FRIEND_ALBUM_LIST,v.FETCH_ALBUM_LIST]}),n(!0,"album"),d.fetchAllAlbums(e.uId)}var u,v=m.SYSTEM.IMAGE;b.showAlbumPreview=!0,b.activeAlbum=null,b.state=d.state,b.albums=d.getAlbums(e.uId),b.loadMoreImage=o,b.deleteImage=q,b.getImageData=p,b.toggleAlbumPreview=r,b.selectPhoto=s,t(),b.$on("$destroy",function(){b.albums.reset(),l.unsubscribe(u)})}d.$inject=["rgScrollbarService","$scope","$rootScope","AlbumFactory","$routeParams","profileFactory","fileUploadService","SystemEvents","Auth","$ringbox","Ringalert","$$connector","OPERATION_TYPES"];var e=function(d,e){function f(){d.showAlbumPreview||a.innerHeight+a.scrollY>=b[0].body.offsetHeight&&d.loadMoreImage()}!d.hasOwnProperty("forSelection")||d.forSelection!==!0&&"true"!==d.forSelection?(d.forSelection=!1,a.addEventListener("scroll",f)):(e[0].children[0].children[0].style.overflow="hidden",e[0].children[0].children[0].style.maxHeight=c.viewportsize().y-200+"px"),d.$on("$destroy",function(){a.removeEventListener("scroll",f)}),d.$rgDigest()};return{restrict:"E",controller:d,link:e,templateUrl:"pages/partials/photos.html",scope:{forSelection:"@forSelection",$close:"&boxClose"}}}angular.module("ringid.common.rgphotos_directive",["ringid.profile"]).directive("rgPhotos",a),a.$inject=["$window","$document","utilsFactory"]}(),function(){"use strict";angular.module("ringid.common.rghref_directive",[]).directive("rgHref",["$location","$route","$rootScope",function(a,b,c){function d(d,e){var f=/#/g.exec(d);f=f?d.substr(f.index+1):d,a.path()==f&&"true"===e.reloadpage&&b.reload(),c.$coreDigest()}return function(a,b,c){var e;c.$observe("rgHref",function(a){return e&&b.unbind("click",d),a?(e=angular.bind(null,d,a,c),b.attr("href",a),void b.bind("click",e)):void b.removeAttr("href")}),a.$on("$destroy",function(){e&&b.unbind("click",e)})}}])}(),function(){"use strict";angular.module("ringid.common.rgslider_directive",[]).directive("rgSlider",function(){return{link:function(a,b,c){function d(){for(x.removeClass("active"),x.eq(o).addClass("active"),y.removeClass("active"),y.eq(o).addClass("active"),n=0;n<r.length;n++)r[n].find("li").removeClass("active"),r[n].find("li").eq(o).addClass("active");G[0]&&j(m(o)),p&&(o=o+1==x.length?0:o+1,e())}function e(){q=setTimeout(function(){d()},w)}function f(){clearTimeout(q)}function g(a){for(var b=a.parentNode.childNodes,c=0,d=0;d<b.length;d++){if(b[d]==a)return c;1==b[d].nodeType&&c++}return-1}function h(){var a;for(n=0;n<z.length;n++)a=angular.element(z[n]),r.push(a),a.find("li").on("click",function(a){o=g(this),f(),d()});x.on("mouseenter",function(a){a.stopPropagation(),p=!1,f()}),x.on("mouseleave",function(a){a.stopPropagation(),p=!1,e()}),y.on("mouseenter",function(a){a.stopPropagation(),p=!1,f()}),y.on("mouseleave",function(a){a.stopPropagation(),p=!1,e()})}function i(){var a,b,c,e,g,h,i;for(a=F[0].clientWidth,b=F[0].clientHeight,c=1,e=Math.round(H/2)-Math.round(a/2),g=Math.round(I/2)-Math.round(b/2),G[J]={w:a,h:b,o:c,l:e,t:g,z:J,i:0},i=A,h=J,n=J+1;n<F.length;n++)i*=B,a=C*G[n-1].w,b=C*G[n-1].h,c=D*G[n-1].o,e=G[n-1].l+G[n-1].w+i-a,--h,g=Math.round(I/2)-Math.round(b/2),G[n]={w:a,h:b,o:c,l:e,t:g,z:h,i:n};for(i=A,h=J,n=J-1;n>=0;n--)i*=B,a=C*G[n+1].w,b=C*G[n+1].h,c=D*G[n+1].o,e=G[n+1].l-i,--h,g=Math.round(I/2)-Math.round(b/2),G[n]={w:a,h:b,o:c,l:e,t:g,z:h,i:n};for(n=0;n<F.length;n++)F[n].orgPos=n,F[n].crslPos=n,F[n].addEventListener("click",function(a){this.crslPos!=J&&(o=this.orgPos,f(),d(),j(this))})}function j(a){k(a),l()}function k(a){for(var b,c=a.crslPos<J?"forward":"backward";a.crslPos!=J;)for("forward"==c?(b=F.pop(),F.unshift(b)):(b=F.shift(),F.push(b)),n=0;n<F.length;n++)F[n].crslPos=n,F[n].className="";a.className="active"}function l(){for(n=0;n<F.length;n++)F[n].style.width=G[n].w+"px",F[n].style.height=G[n].h+"px",F[n].style.opacity=G[n].o,F[n].style.left=G[n].l+"px",F[n].style.top=G[n].t+"px",F[n].style.zIndex=G[n].z,G[n].i=n}function m(a){for(n=0;n<F.length;n++)if(a==F[n].orgPos)return F[n]}var n,o=0,p=!1,q=null,r=[],s=b[0],t=c.navClass||"",u=c.slideClass||"",v=c.descClass||"",w=1e3*parseInt(c.delay)||3e3,x=angular.element(s.querySelectorAll("."+u)),y=angular.element(s.querySelectorAll("."+v)),z=s.querySelectorAll("."+t)||{},A=120,B=.6,C=.6,D=.8,E=s.querySelector(".nav-carousel"),F=E.querySelectorAll("img");F=Array.prototype.slice.call(F);var G=[],H=E.clientWidth,I=E.clientHeight,J=Math.floor(F.length/2);h(),d(),F[0].src=F[0].src,F[0].addEventListener("load",function(){i(),j(F[0]),setTimeout(function(){E.style.visibility="visible"},800)})}}})}(),function(){"use strict";function a(){return function(a,b,c){if(a){for(var d,e=[],f=new RegExp(b,"i"),g=0;g<a.length;g++){if(e.length>10)return e;d=a[g].value.getLiteUser(),f.test(d.getName())&&-1===c.indexOf(d)&&e.push(d)}return e}}}function b(a,b){return{scope:{filterText:"=",focusFilter:"=",onSelect:"&",onClose:"&",tagItems:"="},templateUrl:function(a,b){return b.templateUrl||"pages/dropdowns/tag-friend-dropdown.html"},compile:function(c,d,e){return{pre:function(c,d,e,f){function g(){c.users=b("userListFilter")(a.friends.all(),c.filterText,c.tagItems),c.activeId>=c.users.length&&(c.activeId=0)}function h(){i||(a.searchContact({schPm:c.filterText},!0).then(function(){c.$rgDigest()}),c.loading=!0,i=!0)}var i=!1;c.users=[],c.$watch(a.friends.length,function(a,b){g(),i&&(c.loading=!1,i=!1)}),c.$watch("filterText",function(a,b){g(),i=!1,c.users.length<5&&b.length<a.length&&h()}),c.$watch("users.length",function(b,d){5>b&&d>b&&(c.filterText.length>0?h():a.getContactDetails()),b>5&&!i&&(c.loading=!1)}),c.loading=!!c.users.length,c.choose=function(a,b){c.onSelect()(a,b),g(),c.$rgDigest()},c.close=angular.isFunction(c.onClose)?c.onClose():angular.noop;var j=!1;c.processKeyup=function(a){if(j)return void a.preventDefault();if(38==a.keyCode||40==a.keyCode){var b=this.selectionStart;this.value=(38==a.keyCode?1:-1)+parseInt(this.value,10),this.selectionStart=b,this.selectionEnd=b,j=!0,setTimeout(function(){j=!1},1),a.preventDefault()}},c.activeId=0,c.setActiveId=function(a){c.activeId=a},d.bind("keydown",function(a,b){b=b||a.which||a.keyCode||a.key,13===b?c.users.length&&(c.choose(c.users[c.activeId],a),c.filterText=""):38===b?c.activeId=Math.max(c.activeId-1,0):40===b&&(c.activeId=Math.min(c.activeId+1,c.users.length-1)),c.$rgDigest()}),d.bind("mouseleave",function(){c.activeId=0})},post:function(a,b,c,d){b.on("click",function(a){a.stopPropagation()}),a.$rgDigest()}}}}}angular.module("ringid.common.rg_friend_dropdown",["ringid.friend.friends_factory"]).filter("userListFilter",a).directive("rgFriendDropdown",b),b.$inject=["friendsFactory","$filter"]}(),function(){"use strict";function a(){this.$get=["$compile","StickerEmoticonService","StickerEmoticonFactory","$sniffer","$rootScope",function(a,b,c,d,e){function f(a){function b(a){m.init(k.dom.editor,"00",a,k.callback,k.processors),a.stopPropagation()}function c(a){a.stopPropagation();var b=a.which||a.keyCode||a.key;m.init(k.dom.editor,b,a,k.callback,k.processors)}function d(a){a.stopPropagation();var b=a.which||a.keyCode||a.key;m.init(k.dom.editor,b,a,k.callback,k.processors)}function f(a){return a.stopPropagation(),a.preventDefault(),!1}function g(a){return a.stopPropagation(),a.preventDefault(),!1}function h(a){a.stopPropagation(),a.preventDefault();var b="";if(a.clipboardData)b=a.clipboardData.getData("text/plain");else if(window.clipboardData)try{b=window.clipboardData.getData("Text")}catch(a){}b=b.replace(/\n/g,"<br />"),b=b.replace(/\s\s+/g," "),m.paste(b),k.updateContent()}function j(a){a.stopPropagation(),k.updateContent()}var k=this;this.content="",this.tagOpen=!1,this.fragment=null,this.dom={},this.processors=[],this.callback=[],this.lastDisable=0,this.maxHeight=0,this.init=function(a){this.newLine=a.newLine!==!1,this.maxHeight=a.maxHeight,this.placeholder=a.placeholder||"",this.isDisabled=a.isDisabled||!1,this.emotion=a.emotion?a.emotion:null,this.fragment=document.createDocumentFragment(),this.dom.placeholder=document.createElement("span"),this.dom.placeholder.setAttribute("data-placeholder",this.placeholder),this.fragment.appendChild(this.dom.placeholder),this.dom.editor=document.createElement("div"),this.dom.editor.setAttribute("contenteditable","true"),this.dom.editor.setAttribute("spellcheck","true"),this.dom.editor.setAttribute("data-editor","true"),this.dom.editor.setAttribute("class","editor"),this.fragment.appendChild(this.dom.editor),this.emotion&&this.fragment.appendChild(this.emotion),this.addProcessor("keydown",!1,this.checkDisability,this),this.addProcessor("keydown","enter",this.checkNewLine,this),this.addProcessor("both","enter,up,down",this.checkTag,this),this.addCallback("keyup","delete,backspace",this.checkBR,this),this.addCallback("keyup",!1,this.addDelimiter,this),this.addCallback("keydown",!1,this.setPlaceholderContent,this),this.addCallback("keyup",!1,this.updateContent,this),this.addDelimiter(),this.initEvent(),this.maxHeight>0&&(this.dom.editor.style.maxHeight=this.maxHeight+"px")},this.addDelimiter=function(){var a,b,c=this.dom.editor.innerText||this.dom.editor.textContent;b=n.getFirstNode(this.dom.editor),"8203"!=c.charCodeAt(0)&&(a=document.createTextNode("\u200b"),b?this.dom.editor.insertBefore(a,b):this.dom.editor.appendChild(a)),c=this.dom.editor.innerText||this.dom.editor.textContent,1!=c.length&&"8203"==c.charCodeAt(c.length-1)||(a=document.createTextNode("\u200b"),this.dom.editor.appendChild(a)),b=a=null},this.addProcessor=function(a,b,c,d){this.processors.push({event:a,action:b,fn:c,context:d})},this.addCallback=function(a,b,c,d){this.callback.push({event:a,action:b,fn:c,context:d})},this.setFocus=function(){o.toElmentEnd(this.dom.editor,!0)},this.showError=function(){this.hideError(),this.dom.editor.className=this.dom.editor.className+" error"},this.hideError=function(){this.dom.editor.className=this.dom.editor.className.replace("error","").trim()},this.enable=function(){this.isDisabled=!1},this.disable=function(){this.isDisabled=!0},this.set=function(a){a&&(a=a.replace(/\n/g,"<br />"),a=a.replace(/href="(.*?)"/g,'href="#"'),a=a.replace(/<span/g,'<a href="#" onclick="return false" data-block="true"'),a=a.replace(/<\/span>/g,"</a>"),a=a.replace(/class="tag"/g,'class="tag" onclick="return false" data-block="true"'),this.dom.editor.innerHTML=a,this.updateContent(),this.addDelimiter(),n.adjustMarkup(this.dom.editor))},this.get=function(){return this.content},this.clear=function(){this.dom.editor.innerHTML="",this.dom.placeholder.innerHTML="",this.updateContent(),this.addDelimiter(),e.unloadWarn=!1},this.setNewLineMode=function(a){this.newLine=a},this.getNode=function(){return this.fragment},this.addEmoticon=function(a){m.setContainer(this.dom.editor,!0),m.addEmoticon(a,!0),this.updateContent()},this.addTag=function(a,b){m.setContainer(this.dom.editor,!0),m.addTag(a,b),this.updateContent()},this.findWord=function(a){return n.findCurrentWord(a,this.dom.editor)},this.setPlaceholderContent=function(a,b){a.ctrlKey||a.shiftKey||a.metaKey||l[b]||""!=this.dom.placeholder.innerHTML||(this.dom.placeholder.innerHTML=String.fromCharCode(b))},this.checkDisability=function(a,b){return this.isDisabled?(a.preventDefault(),this.lastDisable=(new Date).getTime()/1e3,(new Date).getTime()-this.lastDisable>2e3&&(this.isDisabled=!1),!1):!0},this.checkTag=function(a,b){return this.tagOpen?(a.preventDefault(),!1):!0},this.checkNewLine=function(a,b){return this.newLine||a.shiftKey||a.ctrlKey?!0:(a.preventDefault(),!1)},this.checkBR=function(a,b){this.dom.editor.firstElementChild&&this.dom.editor.firstElementChild===this.dom.editor.lastElementChild&&"br"==this.dom.editor.firstElementChild.nodeName.toLowerCase()&&this.dom.editor.removeChild(this.dom.editor.firstElementChild)},this.updateContent=function(a,b){var c=this.dom.editor.innerHTML.replace(/<br>/g,"\n");c=c.replace(/&lt;/g,"<"),c=c.replace(/&gt;/g,">"),c=c.replace(/&amp;/g,"&"),c=c.replace(/&nbsp;/g," "),c=c.replace(/\u200B/g,""),c=c.replace(/\n{3,}/g,"\n\n"),c=c.replace(i,function(a,b){return isNaN(b)?b:"##"+b+"##"}),this.content=c.trim();var d=this.dom.editor.innerHTML.replace(/<br>/g,"\n");d=d.replace(/&nbsp;/g," "),d=d.replace(/\u200B/g,""),d=d.replace(/\n{3,}/g,"\n\n"),this.dom.placeholder.innerHTML=d,this.onUpdate&&"function"==typeof this.onUpdate&&this.onUpdate.call(null),""!=this.content?e.unloadWarn=!0:e.unloadWarn=!1},this.initEvent=function(){this.dom.editor.addEventListener("mouseup",b),this.dom.editor.addEventListener("keydown",c),this.dom.editor.addEventListener("keyup",d),this.dom.editor.addEventListener("dragover",f),this.dom.editor.addEventListener("drop",g),this.dom.editor.addEventListener("paste",h),this.dom.editor.addEventListener("cut",j)},this.getPosition=function(){var a=0,b=0,c=this.dom.editor.getBoundingClientRect(),d=o.getCurrentRange().getClientRects();return a=c.left,b=c.top,d.length>0&&(d=d[0],a=d.left-a,b=d.top-b),{x:a,y:b+12}},this.destroy=function(){this.dom.editor.removeEventListener("mouseup",b),this.dom.editor.removeEventListener("keydown",c),this.dom.editor.removeEventListener("keyup",d),this.dom.editor.removeEventListener("dragover",f),this.dom.editor.removeEventListener("drop",g),this.dom.editor.removeEventListener("paste",h),this.dom.editor.removeEventListener("cut",j),this.dom=k=null,e.unloadWarn=!1},this.init(a)}var g=b.getEmoticonMap(),h=c.getEmoticonPattern(),i=/<a.*?data-link="(.*?)".*?>.*?<\/a>/gi,j=d.vendorPrefix.toLowerCase(),k=!(!navigator.userAgent.match(/Trident/)||!navigator.userAgent.match(/rv[ :]11/)),l={13:{fn:"enter",action:"enter",event:"keydown"},8:{fn:"backspace",action:"backspace",event:"keydown"},32:{fn:"space",action:"space",event:"keydown"},46:{fn:"delete",action:"delete",event:"keydown"},27:{fn:"escape",action:"escape",event:"keydown"},37:{fn:"adjust",action:"left",event:"keyup"},39:{fn:"adjust",action:"right",event:"keyup"},38:{fn:"adjust",action:"up",event:"keyup"},40:{fn:"adjust",action:"down",event:"keyup"},"00":{fn:"adjust",action:"click",event:"mouseup"}};"moz"==j&&(l[8]={fn:"backspace",action:"backspace",event:"both"},l[46]={fn:"delete",action:"delete",event:"both"});var m={container:null,event:null,keyCode:0,selection:null,range:null,previousSelection:{},init:function(a,b,c,d,e){var f,g,h,i,j=!0,k=null,p=null;for(this.container=a,this.keyCode=b,this.event=c,this.selection=o.getSelection(),this.range=o.getCurrentRange(),this.action="",k=n.getFirstNode(this.container),p=this.container.lastChild,f=n.getCurrentBoundary(this.selection),f=n.getSafeBoundary(this.selection,f,b,k,p),g=0;g<e.length;g++)i=e[g],i&&(i.event==c.type||"both"==i.event)&&(l[b]&&i.action&&-1!=i.action.indexOf(l[b].action)||i.action===!1)&&i.fn.call(i.context,c,b)===!1&&(j=!1);if(e=[],j){for(l[b]&&m[l[b].fn]&&(l[b].event==c.type||"both"==l[b].event)&&(this.action=l[b].action,m[l[b].fn](f)),!l[b]&&"keydown"==c.type&&f&&m.adjust(f,!1),g=0;g<d.length;g++)h=d[g],h&&h.event==c.type&&(l[b]&&h.action==l[b].action||h.action===!1)&&h.fn.call(h.context,c,b);d=[],k=p=null}},setContainer:function(a,b){this.container=a,b&&o.intersectsNode(a)===!1&&(o.toElmentEnd(a),this.container.focus())},adjust:function(a,b){if(a){if(b="undefined"!=typeof b&&null!==b?b:!0,a.zws&&0==a.candidate.length&&("left"==this.action||"right"==this.action||"click"==this.action))return void(b&&this.event.preventDefault());if(!this.selection.isCollapsed&&"mouseup"==this.event.type&&this.previousSelection&&this.previousSelection.anchorNode==this.selection.anchorNode&&this.previousSelection.anchorOffset==this.selection.anchorOffset&&this.previousSelection.focusOffset==this.selection.focusOffset)return void(this.previousSelection={});if(!b&&this.selection.isCollapsed===!1){if(this.event.ctrlKey||this.event.shiftKey||this.event.metaKey)return;return void(a&&"ltr"==a.direction?o.deleteContents(a.start,a.startPos,a.end,a.endPos):a&&"rtl"==a.direction?o.deleteContents(a.end,a.endPos,a.start,a.startPos):o.deleteContents(this.range.startContainer,this.range.startOffset,this.range.endContainer,this.range.endOffset))}n.adjustCursor(this.selection,a),b&&this.event.preventDefault(),this.selection&&this.selection.anchorNode&&(this.previousSelection.anchorNode=this.selection.anchorNode,this.previousSelection.anchorOffset=this.selection.anchorOffset,this.previousSelection.focusOffset=this.selection.focusOffset)}},enter:function(a){var b,c,d,e=!1;a&&!this.selection.isCollapsed&&("ltr"==a.direction?o.deleteContents(a.start,a.startPos,a.end,a.endPos):o.deleteContents(a.end,a.endPos,a.start,a.startPos),this.range=o.getCurrentRange());try{e=document.execCommand("insertBrOnReturn",!1,!0)}catch(f){e=!1}e||(this.event.preventDefault(),this.range.deleteContents(),b=document.createElement("br"),this.range.insertNode(b),""!=this.container.style.maxHeight&&(this.container.scrollTop=this.container.scrollTop+18),o.toElmentAfter(b),c=b=d=null)},escape:function(){},backspace:function(a){if(a){var b=this.container.innerText||this.container.textContent;if(2==b.length)return void this.event.preventDefault();if("last"!=a.zwsType||a.start!==a.end||a.startPos!=a.endPos){if(a.zws&&"first"==a.zwsType&&0==a.candidate.length)return void this.event.preventDefault();var c;"ltr"==a.direction?(c=n.getNode(a.start,"prev",a.start.length-a.startPos),o.deleteContents(a.start,a.startPos,a.end,a.endPos)):(c=n.getNode(a.end,"next",a.end.length-a.endPos),o.deleteContents(a.end,a.endPos,a.start,a.startPos)),c.parent&&(c.pos="rtl"==a.direction?c.node.childNodes.length:0),o.toElementByType(c.node,c.type,c.pos),this.event.preventDefault(),c=null}}},"delete":function(a){if(a){var b=this.container.innerText||this.container.textContent;if(2==b.length)return void this.event.preventDefault();if("first"!=a.zwsType||a.start!==a.end||a.startPos!=a.endPos){if(a.zws&&"last"==a.zwsType&&0==a.candidate.length)return void this.event.preventDefault();var c;this.selection.isCollapsed||"ltr"==a.direction?(c=n.getNode(a.start,"next",a.start.length-a.startPos),o.deleteContents(a.start,a.startPos,a.end,a.endPos)):(c=n.getNode(a.end,"prev",a.end.length-a.endPos),o.deleteContents(a.end,a.endPos,a.start,a.startPos)),c.parent&&(c.pos=this.selection.isCollapsed||"ltr"==a.direction?c.node.childNodes.length:0),o.toElementByType(c.node,c.type,c.pos),this.event.preventDefault(),c=null}}},space:function(){var a,b="";if(b=n.findCurrentWord(null,this.container),b&&(b=b.replace(/\u200B|\n/g,"")),g[b]){var a=!("ms"!=j||!n.isEditorTag(this.range.endContainer)||3!=this.range.endContainer.childNodes[this.range.endOffset].nodeType||"8203"!=this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0));if(a){var c=this.range.endContainer.childNodes[this.range.endOffset-1];this.range.setStart(c,c.length),this.range.setEnd(c,c.length),c=null}this.range.setStart(this.range.startContainer,this.range.endOffset-b.length),this.range.deleteContents(),this.addEmoticon(b,!0),this.event.preventDefault()}},addEmoticon:function(a,b){var c,d,e,f;if(this.range=o.getCurrentRange(),d=n.parseText(a),b&&""==d.replace(i,"")&&(d+=String.fromCharCode(32)),n.removeClass(this.container),o.insertHtml(d),f=this.container.querySelectorAll(".caret"),f=Array.prototype.slice.call(f),this.selection&&(e=this.selection.focusNode),e&&e.nextSibling&&3==e.nextSibling.nodeType&&1==e.nextSibling.length&&10==e.nextSibling.nodeValue.charCodeAt(0)&&e.nextSibling.parentNode.removeChild(e.nextSibling),e&&3==e.nodeType&&10==e.nodeValue.charCodeAt(e.nodeValue.length-1)&&(e.nodeValue=e.nodeValue.replace(/\u200B|\n/g,"")),!e&&f.length>0){var g=f[f.length-1].nextSibling.nextSibling;g&&3==g.nodeType&&1==g.length&&10==g.nodeValue.charCodeAt(0)&&g.parentNode.removeChild(g),g=null}f.length>0?(e=f[f.length-1],e.nextSibling&&3==e.nextSibling.nodeType?o.toElementByType(e.nextSibling,"pos",1):o.toElmentAfter(e)):e?(c=n.getNode(e,"next",0),o.toElementByType(c.node,c.type,c.pos)):o.toElmentEnd(this.container),this.container.focus(),c=f=e=null},addTag:function(a,b){var c,d,e,f,g,h,i={};b="@"+b,3!=this.range.startContainer.nodeType&&(this.range=o.getCurrentRange()),g=this.range.collapsed?this.range.endOffset:this.range.startOffset;var k=!("ms"!=j||!n.isEditorTag(this.range.endContainer)||3!=this.range.endContainer.childNodes[this.range.endOffset].nodeType||"8203"!=this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0));if(k){g=this.range.endContainer.childNodes[this.range.endOffset-1].nodeValue.length;var l=this.range.endContainer.childNodes[this.range.endOffset-1];this.range.setStart(l,0),this.range.setEnd(l,0),l=null}if(!(g-b.length<0)){if(this.range.setStart(this.range.startContainer,g-b.length),this.range.setEnd(this.range.startContainer,g),this.range.deleteContents(),i["class"]="tag",i.title=a.getName().trim(),i["data-link"]=a.getUtId(),i.text=a.getName().trim(),n.removeClass(this.container),e=n.getBlockHTML(i),o.insertHtml(e),h=this.container.querySelectorAll(".caret"),h=Array.prototype.slice.call(h),f=this.selection.focusNode!==this.container&&this.selection.focusNode.nextSibling&&this.selection.focusNode.nextSibling!==this.container.lastChild?this.selection.focusNode.nextSibling:this.selection.focusNode,d=n.examineNode(f,"focus",this.selection),d.node&&"parent"==d.position&&(f=d.node),f&&f.nextSibling&&3==f.nextSibling.nodeType&&1==f.nextSibling.length&&10==f.nextSibling.nodeValue.charCodeAt(0)&&f.nextSibling.parentNode.removeChild(f.nextSibling),f&&3==f.nodeType&&10==f.nodeValue.charCodeAt(f.nodeValue.length-1)&&(f.nodeValue=f.nodeValue.replace(/\u200B|\n/g,"")),!f&&h.length>0){var l=h[h.length-1].nextSibling;l&&3==l.nodeType&&1==l.length&&10==l.nodeValue.charCodeAt(0)&&l.parentNode.removeChild(l),l=null}h.length>0?o.toElmentAfter(h[h.length-1]):f?(c=n.getNode(f,"next",0),o.toElementByType(c.node,c.type,c.pos)):o.toElmentEnd(this.container),this.container.focus(),c=h=f=null}},paste:function(a){var b,c=n.parseText(a);o.insertHtml(c),this.container.focus(),b=null}},n={examineNode:function(a,b,c){var d,e=Object.create(null),f="focus"==b?c.focusOffset:c.anchorOffset;return e.position=!1,e.length=0,e.node=null,a?(1==a.nodeType&&"true"==a.getAttribute("data-block")&&(e.node=a,e.position="self"),d=n.getNextNode(a,a.length),d&&1==d.nodeType&&"true"==d.getAttribute("data-block")&&(1==a.nodeType||3==a.nodeType&&f==a.length)&&(e.node=d,e.position="next"),d=n.getPrevNode(a,a.length),d&&1==d.nodeType&&"true"==d.getAttribute("data-block")&&(1==a.nodeType||3==a.nodeType&&0==f)&&(e.node=d,e.position="prev"),d="b"==a.parentNode.nodeName.toLowerCase()?a.parentNode.parentNode:a.parentNode,d&&1==d.nodeType&&"true"==d.getAttribute("data-block")&&(e.node=d,e.position="parent"),e.node&&(e.length=3==e.node.nodeType?e.node.nodeValue.length:0),d=null,e):e},getCurrentBoundary:function(a){var b=o.getDirection(),c=Object.create(null);return a?(c.start=a.anchorNode,c.startPos=a.anchorOffset,c.end=a.focusNode,c.endPos=a.focusOffset,c.direction=b,c):c},adjustCursor:function(a,b){a.isCollapsed?o.toElementByType(b.end,b.type,b.endPos):!a.isCollapsed&&b.isAnchorMoved?o.extendSelection(b,!1):o.extendSelection(b)},getSafeBoundary:function(a,b,c,d,e){var f,g,h,i,j=!1,k=null,m=null,o=[],p={enter:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},backspace:{focus:"prev",anchor:"next",dir:"rtl",reverse:!0,both:!0},"delete":{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!0},space:{focus:"next",anchor:"next",dir:"ltr",reverse:!1,both:!1},escape:{},left:{focus:"prev",anchor:"next",dir:"rtl",reverse:!1,both:!1},right:{focus:"next",anchor:"prev",dir:"ltr",reverse:!1,both:!1},up:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},down:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},click:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},any:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1}};if(f=l[c]?l[c].action:"any",""!=f&&p[f]&&p[f].hasOwnProperty("focus")){for(b.isAnchorMoved=!1,b.candidate=[],a.isCollapsed&&!p[f].both||o.push({node:a.anchorNode,type:"anchor",offset:a.anchorOffset}),o.push({node:a.focusNode,type:"focus",offset:a.focusOffset});h=o.pop();)h.node&&(g=p[f][h.type],p[f].reverse&&b.direction!=p[f].dir&&(g="next"==g?"prev":"next"),k=n.examineNode(h.node,h.type,a),"any"==f&&a.isCollapsed&&(k.length==a.focusOffset||"next"==k.position&&a.focusNode.length==a.focusOffset)&&(k.node=null),"backspace"!=f&&"click"!=f||"next"!=k.position||!a.isCollapsed||3!=a.focusNode.nodeType||a.focusNode.length!=a.focusOffset||(k.node=null),k.node&&(m=n.getNode(k.node,g,0),"focus"==h.type?(b.end=m.node,b.endPos=m.pos):(b.start=m.node,b.startPos=m.pos,b.isAnchorMoved=!0),b.type=m.type,j=!0,b.candidate.push(k.node)));return b.zws=!1,b.zwsType="","ltr"==b.direction&&b.start===d&&(0==b.startPos?(a.isCollapsed?(b.endPos=b.startPos=1,b.type=b.type?b.type:"pos"):(b.startPos=1,b.type=b.type?b.type:"pos"),j=!0):1==b.startPos&&"any"!=f&&3==b.start.nodeType&&"8203"==b.start.nodeValue.charCodeAt(0)&&a.isCollapsed&&(b.zws=!0,b.zwsType="first",j=!0)),"backspace"==f&&a.isCollapsed&&0==b.startPos&&n.getPrevNode(b.start,b.start.length)===d&&(b.zws=!0,b.zwsType="first",j=!0),"rtl"==b.direction&&b.end==d&&0==b.endPos&&(b.endPos=1,b.type=b.type?b.type:"pos",j=!0),n.isEditorTag(b.end)&&0==b.endPos&&(b.end=b.end.firstChild,b.endPos=1,b.type=b.type?b.type:"pos",j=!0),n.isEditorTag(b.end)&&b.endPos==b.end.childNodes.length&&b.end.lastChild&&3==b.end.lastChild.nodeType&&"8203"==b.end.lastChild.nodeValue.charCodeAt(0)&&(b.end=b.end.firstChild,b.endPos=1,b.type=b.type?b.type:"pos",j=!0),"ltr"==b.direction&&b.end===e&&(i=b.end.length,i>0&&b.endPos==i?(a.isCollapsed?(b.endPos=b.startPos=i-1,b.type=b.type?b.type:"pos"):(b.endPos=i-1,b.type=b.type?b.type:"pos"),j=!0):b.endPos==i-1&&"any"!=f&&3==b.end.nodeType&&"8203"==b.end.nodeValue.charCodeAt(i-1)&&a.isCollapsed&&(b.zws=!0,
b.zwsType="last",j=!0)),"delete"==f&&a.isCollapsed&&b.end.length==b.endPos&&n.getNextNode(b.end,b.endPos)===e&&(b.zws=!0,b.zwsType="last",j=!0),i=b.start.length,"rtl"==b.direction&&b.start==e&&b.startPos==i&&(b.startPos=i-1,b.type=b.type?b.type:"pos",j=!0),k=m=o=d=e=h=null,j?b:!1}},parseText:function(a){return a=a.replace(h,function(a){var b=[];return b["class"]="em_list "+g[a].replace(/\.[A-Za-z]{3}/,""),b.title=a,b["data-link"]=a,b.text="<b>"+a.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</b>&nbsp;",n.getBlockHTML(b)})},removeClass:function(a){if(a){var b,c=a.querySelectorAll(".caret");for(b=0;b<c.length;b++)c[b].className=c[b].className.replace("caret","").trim();c=null}},adjustMarkup:function(a){if(a){var b,c=a.querySelectorAll(".em_list");for(b=0;b<c.length;b++)c[b].innerHTML="<b>"+c[b].getAttribute("data-link")+"</b>&nbsp;";c=null}},getBlockHTML:function(a){var b='<a href="#" onclick="return false" class="'+a["class"]+' caret" title="'+a.title+'" data-link="'+a["data-link"]+'" spellcheck="false" data-block="true">'+a.text+"</a>";return b},getPrevNode:function(a,b){if(b="undefined"!=typeof b&&null!==b?b:0,!a)return a;if(a.length>b)return a;for(var c=a.previousSibling;c&&!(c.length>0||1==c.nodeType);)c=c.previousSibling;return c},getNextNode:function(a,b){if(b="undefined"!=typeof b&&null!==b?b:0,!a)return a;if(a.length>b)return a;for(var c=a.nextSibling;c&&!(c.length>0||1==c.nodeType);)c=c.nextSibling;return c},getNode:function(a,b,c){var d=Object.create(null),e=!1,f=this.isEditorTag(a);return a?(d.node=null,b="undefined"!=typeof b&&null!==b?b:"prev",c="undefined"!=typeof c&&null!==c?c:0,a.length>c&&(e=!0),f||(d.node="prev"==b?this.getPrevNode(a,c):this.getNextNode(a,c)),d.node&&("prev"==b&&(d.pos=e?d.node.length-c:d.node.length),"next"==b&&(d.pos=e?d.node.length-c:0),d.type="pos"),d.parent=!1,d.node||(d.node=f?a:a.parentNode,d.pos="next"==b?d.node.childNodes.length:0,d.type="pos",d.parent=!0),d):a},isEditorTag:function(a){return a&&1==a.nodeType&&"true"==a.getAttribute("data-editor")||!1},isEmpty:function(a){if(0==a.childNodes.length)return!1;for(var b=a.firstChild;b&&!(1==b.nodeType||b.length>0);)b=b.nextSibling;return!b},getFirstNode:function(a,b){if(0==a.childNodes.length)return!1;var c=a.firstChild;for(b="undefined"!=typeof b&&null!==b?b:!1;c&&(!(1==c.nodeType||c.length>0)||b&&3==c.nodeType&&!(c.length>1)&&"8203"==c.nodeValue.charCodeAt(0));)c=c.nextSibling;return c},findCurrentWord:function(a,b){var c,d=o.getSelection(),e="",f=-1,g="",h=!1,i=n.getFirstNode(b,!0);a=a?a:null;var k=!("ms"!=j||!n.isEditorTag(d.focusNode)||3!=d.focusNode.childNodes[d.focusOffset].nodeType||"8203"!=d.focusNode.childNodes[d.focusOffset].nodeValue.charCodeAt(0));if((d&&3==d.focusNode.nodeType||k)&&(e=k?d.focusNode.childNodes[d.focusOffset-1].nodeValue:d.focusNode.nodeValue.substr(0,d.anchorOffset),e=e.replace(/\s+$/,""),f=a?e.lastIndexOf(a):1,f>=0))for(c=e.length-1;c>=0;c--){if(/\s/.test(e[c])){h=!0;break}if(e[c]==a){g=e[c]+g;break}g=e[c]+g}return null==a?(h||k||i===d.anchorNode||(g=""),i=null,g):(g[0]!=a&&(g=""),g=g.length>1&&(i===d.anchorNode&&d.anchorNode.nodeValue[0]==a||k||b.firstChild===d.anchorNode&&d.anchorNode.nodeValue[1]==a||d.anchorNode.previousSibling&&3==d.anchorNode.previousSibling.nodeType&&32==d.anchorNode.previousSibling.nodeValue.charCodeAt(d.anchorNode.previousSibling.length-1)||32==e.charCodeAt(f-1))||160==e.charCodeAt(f-1)?g.replace(a,""):"",i=null,g)},findPos:function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}},o={toPos:function(a,b){var c=this.getSelection(),d=this.getRange();b="undefined"!=typeof b&&null!==b?b:a.length||a.childNodes.length,d.setStart(a,b),d.setEnd(a,b),d.collapse(!0),c.removeAllRanges(),c.addRange(d),d.detach(),c=null},toElementStart:function(a,b){b&&a.focus(),this.toPos(a,0)},toElmentEnd:function(a,b){return b&&a.focus(),n.isEditorTag(a)&&a.lastChild&&3==a.lastChild.nodeType&&"8203"==a.lastChild.nodeValue.charCodeAt(a.lastChild.nodeValue.length-1)?void this.toPos(a.lastChild,a.lastChild.nodeValue.length-1):void this.toPos(a)},toElmentBefore:function(a){var b=this.getSelection(),c=this.getRange();c.setStartBefore(a),c.collapse(!0),b.removeAllRanges(),b.addRange(c),c.detach(),b=null},toElmentAfter:function(a){var b=this.getSelection(),c=this.getRange();c.setStartAfter(a),c.collapse(!0),b.removeAllRanges(),b.addRange(c),c.detach(),b=null},toElementByType:function(a,b,c){b="undefined"!=typeof b?b:"end","end"==b&&this.toElmentEnd(a),"start"==b&&this.toElementStart(a),"pos"==b&&this.toPos(a,c)},deleteContents:function(a,b,c,d){var e=this.getSelection(),f=this.getRange();b="undefined"!=typeof b&&null!==b?b:a.length||a.childNodes.length,c="undefined"!=typeof c?c:a,d="undefined"!=typeof d&&null!==d?d:c.length||c.childNodes.length,a===c&&b==d||(1==a.nodeType?f.setStartBefore(a):f.setStart(a,b),1==c.nodeType?f.setEndAfter(c):f.setEnd(c,d),e.removeAllRanges(),e.addRange(f),document.execCommand("delete",!1),f.detach())},insertHtml:function(a){var b=(this.getSelection(),this.getCurrentRange());if(this.isIE())b.pasteHTML(a);else if(k){var c,d=document.createElement("div"),e=document.createDocumentFragment();for(d.innerHTML=a;c=d.firstChild;)e.appendChild(c);b.insertNode(e),d=e=c=null}else document.execCommand("insertHtml",!1,a)},getSelection:function(){return this.isIE()?document.selection:window.getSelection()},isIE:function(){return document.selection&&"Control"!=document.selection.type},extendSelection:function(a,b){var c=this.getSelection(),d=this.getRange();return b="undefined"!=b&&null!=b?b:!0,c.extend&&b?void c.extend(a.end,a.endPos):("ltr"==a.direction?(d.setStart(a.start,a.startPos),d.setEnd(a.end,a.endPos)):(d.setStart(a.end,a.endPos),d.setEnd(a.start,a.startPos)),c.removeAllRanges(),c.addRange(d),d.detach(),void(c=null))},reset:function(){var a=this.getSelection(),b=this.getRange(),c=this.getDirection();"ltr"==c?b.setStart(a.focusNode,a.focusOffset):b.setStart(a.anchorNode,a.anchorOffset),b.collapse(!0),a.removeAllRanges(),a.addRange(b),b.detach(),a=null},getRange:function(){return document.createRange()},getCurrentRange:function(){var a=this.getSelection();return this.isIE()?a.createRange():a.rangeCount?a.getRangeAt(0):!1},getDirection:function(){var a=this.getSelection(),b=!1,c=this.getRange();return a&&!a.isCollapsed&&(c.setStart(a.anchorNode,a.anchorOffset),c.setEnd(a.focusNode,a.focusOffset),b=c.collapsed,c.detach()),a=null,b?"rtl":"ltr"},intersectsNode:function(a){var b=this.getCurrentRange(),c=null;if(c=b.commonAncestorContainer,b.intersectsNode)return b.intersectsNode(a);for(;c&&c!==a;)c=c.parentNode;return!!c}},p={};return p.create=function(a){var b=new f(a);return b},p}]}function b(a,b){function c(c,d,e){function f(b,e){if(c.filterFriend=i.findWord("@"),32==e&&(c.filterFriend=""),""==c.filterFriend&&l&&c.closeDropdownFriend(),c.filterFriend&&!l){l=a('<rg-friend-dropdown template-url="pages/dropdowns/tag-editor-dropdown.html" tag-items="[]" filter-text="filterFriend" focus-filter="" on-close="closeDropdownFriend" on-select="chooseFriend"></rg-friend-dropdown>')(c),d.after(l);var f=i.getPosition();l.css({position:"absolute",left:f.x+"px",top:f.y+"px"})}l&&(i.tagOpen=!0,document.addEventListener("click",function g(a){l&&a.target!==l[0]&&c.closeDropdownFriend(),document.removeEventListener("click",g)},!1))}function g(a,b){return l&&(a.preventDefault(),l.triggerHandler(a,b)),!0}function h(a,b){c.editorContent=i.get(),c.$parent&&1!==c.$parent.$id?c.$parent.$rgDigest():c.$rgDigest()}var i,j,k,l;c.filterFriend="",c.editorContent="",j="true"==e.showSticker||e.showSticker===!0?"true":"false",k={newLine:"false"!=e.newLine&&e.newLine!==!1,placeholder:e.placeholder?e.placeholder:"",isDisabled:"true"==e.isDisabled||e.newLine===!0,maxHeight:e.maxHeight?parseInt(e.maxHeight):0},e.showEmoji&&(k.emotion=a('<a href="javascript:void(0)"><i class="icon-emoticon ico-sty" rg-emoticon="" clicked="insertEmoji" show-sticker="'+j+'"></i></a>')(c)[0],d.addClass("with_emo")),i=b.create(k),d.append(i.getNode()),i.onUpdate=h,c.insertEmoji=function(a){i.addEmoticon(a.symbol(),!0)},c.closeDropdownFriend=function(){l&&(l.remove(),l=void 0),i.tagOpen=!1},c.chooseFriend=function(a,b){c.filterFriend&&(i.addTag(a,c.filterFriend),c.closeDropdownFriend())},e.tagFriend&&(i.addCallback("keyup",!1,f,null),i.addCallback("keyup","escape",c.closeDropdownFriend,c),i.addProcessor("keydown","up,down,enter",g,null)),e.onEscape&&i.addCallback("keyup","escape",c.onEscape(),c),e.onEnter&&i.addProcessor("keydown","enter",function(a,b){return k.newLine!==!1||a.shiftKey||a.ctrlKey?!0:(c.onEnter()(c.onEnterArg),!1)}),c.$on("cleareditor",function(){i.clear()}),c.$on("seteditor",function(a,b){b=b||c.editorContent,i.set(b)}),c.$watch("isDisabled",function(a){a?(i.disable(),i.clear()):i.enable()}),e.focus&&c.$watch("focus",function(a){a&&(setTimeout(function(){i.setFocus()},0),e.editMode&&i.set(c.editMode()().toString()))}),c.$on("$destroy",function(){i.destroy(),i=k=l=null})}return{scope:{editorContent:"=",onEnter:"&",onEscape:"&",onEnterArg:"=",isDisabled:"=",focus:"=",editMode:"&"},restrict:"E",link:c}}angular.module("ringid.common.rgeditor_directive",[]).provider("$editor",a).directive("rgEditor",b),b.$inject=["$compile","$editor"]}(),function(){"use strict";function a(a,b,c){return{restrict:"A",scope:{onSelect:"&"},link:function(d,e){function f(){d.$parent&&1!==d.$parent.$id?d.$parent.$rgDigest():d.$rgDigest()}function g(a){a.preventDefault(),d.active?d.initEMotionList("none",a):d.initEMotionList("block",a),d.active=!d.active,f()}function h(a){a.target!==e[0]&&a.target.parentNode&&a.target.parentNode!==e[0]&&a.target.parentNode.parentNode!==e[0]&&"pt-top"!==a.target.className&&d.close(a)}var i;d.active=!1,d.emotionFilterText="",d.initEMotionList=function(b){c.init(),i||(i=a('<rg-emotion-dropdown filter-text="emotionFilterText" focus-filter="active" on-close="close" on-select="choose"></rg-emotion-dropdown>')(d),e.after(i)),i.css("display",b)},d.choose=function(a,b){d.onSelect({item:a}),d.emotionFilterText="",d.initEMotionList("none",b),d.active=!1,f()},e.on("click",g),b.on("click",h),d.close=function(a){d.active&&(d.initEMotionList("none",a),d.active=!1),f()},d.$on("$destroy",function(){e.off("click",g),b.off("click",h),i=void 0})}}}function b(a){function b(a){a.stopPropagation()}return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&onClose"},templateUrl:"pages/dropdowns/emotion-dropdown.html",compile:function(){return{pre:function(b){b.emotions={},b.emotions[0]=a.getEmotions(),b.setEmotion=function(a){b.emotions[0]=a,b.$rgDigest()},a.setScopeForDigest(b),b.updateModel=function(a){b.filterText=a.target.value,b.$parent.$rgDigest()},b.loading=!!b.emotions.length,b.choose=angular.isFunction(b.onSelect)?b.onSelect():angular.noop,b.close=angular.isFunction(b.onClose)?b.onClose():angular.noop,b.$on("$destroy",function(){a.removeScope(b)})},post:function(a,c){c.on("click",b),a.$on("$destroy",function(){c.off("click",b)}),a.$rgDigest()}}}}}angular.module("ringid.common.emotion_directives",["ringid.common.emotion_factory"]).directive("rgEmotion",a).directive("rgEmotionDropdown",b),a.$inject=["$compile","$document","EmotionFactory"],b.$inject=["EmotionFactory"]}(),function(){"use strict";function a(a,b,c,d){angular.element(document.querySelector("body"));return{scope:!0,link:function(b,d,e){function f(a){function f(){n&&g&&(g.off("mouseenter",h),g.off("mouseleave",i),g.remove(),g=void 0),n=!1}function h(){n=!1}function i(){n=!0,f()}function j(f){n||(g||(g=angular.element('<div class="fr-menu"></div>'),g.html(a),d.after(g)),e.onHoverStart&&"function"==typeof b[e.onHoverStart]&&b[e.onHoverStart](),c(g)(b),g.css({display:"block"}),g.on("mouseleave",i),g.on("mouseenter",h),b.$rgDigest())}function k(a){n=!0,window.setTimeout(f,500),window.clearTimeout(m),m=!1,d.off("mouseleave",k)}function l(a){m||(m=window.setTimeout(j.bind(this,a),1200)),d.on("mouseleave",k)}var m,n=!1;d.on("mouseenter",l),b.$on("$destroy",function(){k(),d.off("mouseenter",j),d.off("mouseleave",k)})}var g;"false"!==e.rgHovercard&&a.get(e.hoverTemplateUrl).success(function(a){f(a)})}}}angular.module("ringid.common.rghover_card_directive",[]).directive("rgHovercard",a),a.$inject=["$ringhttp","$templateCache","$compile","$window"]}(),function(){"use strict";function a(a,b){return{restrict:"A",scope:{onSelect:"&",tagItems:"="},link:function(c,d,e){function f(a){a.preventDefault(),c.active?(c.close(a),b.off("click",g)):(c.init(a),b.on("click",g))}function g(a){a.target!=d[0]&&a.target.parentNode!=d[0]&&null!=a.target.parentNode&&a.target.parentNode.parentNode!=d[0]&&"pt-top"!=a.target.className&&c.close(a)}if("false"===e.rgTagFriend)return void d.parent().remove();var h;c.active=!1,c.filterText="",c.init=function(b,e){h||(h=a('<rg-friend-dropdown tag-items="tagItems" filter-text="filterText" focus-filter="active" on-close="close" on-select="choose"></rg-friend-dropdown>')(c),d.after(h)),c.active=!0},c.choose=function(a,b){c.onSelect({item:a}),c.filterText="",c.$parent&&1!==c.$parent.$id?c.$parent.$rgDigest():$scope.$rgDigest()},d.on("click",f),c.close=function(a){c.active&&(h.off("keydown"),h.remove(),h=void 0,c.active=!1)},c.$on("$destroy",function(){d.off("click",f),b.off("click",g),h&&(h=void 0)})}}}angular.module("ringid.common.rg_tag_friend",["ringid.common.rg_friend_dropdown"]).directive("rgTagFriend",a),a.$inject=["$compile","$document"]}(),angular.module("ringid.common.rg_column",["ngRoute"]).directive("rgColumn",["$document","Storage","utilsFactory",function(a,b,c){return{restrict:"A",controller:["utilsFactory","$scope","SystemEvents","$rootScope",function(a,b,c,d){b.spans=a.feedColumn(),b.defaultSpan=a.getDefaultColumn(),b.choose=function(e){a.resetScroll(),a.animateScroll(),a.setFeedColumn(e),b.spans=e,d.$broadcast(c.COMMON.COLUMN_CHANGED,e)},b.$watch(a.feedColumn,function(a){b.spans=a,d.$broadcast(c.COMMON.COLUMN_CHANGED,a)}),b.$on(c.COMMON.WINDOW_RESIZED,function(){b.defaultSpan=a.getDefaultColumn()})}],template:'<span></span>                        <span></span>                        <span></span>                        <div class="col-area">                        <div class="col-area-wrapper">                            <div class="list-ico width-26 top-l" data-tool="3 Column" ng-click="choose(3)"  ng-if="defaultSpan > 2" ng-class="{\'list-act\' : spans == 3 }">                                <span></span>                                <span></span>                                <span></span>                            </div>                            <div class="list-ico width-17 top-l" data-tool="2 Column" ng-click="choose(2)"  ng-if="defaultSpan > 1" ng-class="{\'list-act\' : spans == 2 }">                                <span></span>                                <span></span>                            </div>                            <div  class="list-ico width-9 top-l" data-tool="1 Column" ng-click="choose(1)" ng-class="{\'list-act\' : spans == 1 }">                                <span></span>                            </div>                            </div>                        </div>',link:function(b,c,d,e){function f(b){b.preventDefault(),i||(i=angular.element(c.find("div")[0]),a.on("click",g)),i.toggleClass("colshow")}function g(a){var b=c.parent().parent()[0];a.target!=b&&a.target.parentNode!=b&&null!=a.target.parentNode&&a.target.parentNode.parentNode!=b&&"pt-top"!=a.target.className&&h(a)}function h(a){i.removeClass("colshow")}var i;c.parent().parent().on("click",f),b.$on("$destroy",function(){c.off("click",f),a.off("click",g),i=void 0})}}}]),function(){"use strict";function a(){return{restrict:"A",link:function(a,b,c){c.rgSrc&&a.$watch(c.rgSrc,function(a){null===a||void 0===a?b.removeAttr("src"):b.attr("src",a)})}}}angular.module("ringid.common.rgsrc_directive",[]).directive("rgSrc",a)}(),function(){"use strict";function a(a,b,c,d){function e(e,f){return function(e,f,g,h,i){function j(a){var g,h,j,k,l,n,o,s,t,u=a.length,v=f[0],w=Object.create(null);for(b.$$postDigest(function(){var b,c,d;for(b=0;b<a.length;b++)c=a[b],p[c.$TrackID]&&(d=p[c.$TrackID],d.childHead&&(d.scope.$$childHead=d.childHead))}),g=0;u>g;g++)j=a[g],o={},o[m]=j,l=r(e,o),p[l]?(n=p[l],delete p[l]):(k=e.$new(),k[m]=j,n={},n.clone=null,n.scope=k),a[g].$TrackID=l,w[l]=n;for(l in p)if(p[l]){for(n=p[l],h=0;h<n.clone.length;h++)v.parentNode.removeChild(n.clone[h]);n.scope.$destroy()}for(g=0;u>g;g++)j=a[g],l=j.$TrackID,n=w[l],n.scope.$index=g,t=n.clone,t?(s=v,n.startNode!=s&&c.move(n.clone,null,angular.element(v)),v=n.clone[n.clone.length-1],n.childHead=n.scope.$$childHead,n.scope.$$childHead=null):i(n.scope,function(a){var b=q.cloneNode(!1);a[a.length++]=b,c.enter(a,null,angular.element(v)),v=b,n.clone=a,n.startNode=a[0]});e.target&&e.target.getMapKey&&e.$emit(d.FEED.HEIGHT,e.target.getMapKey()),p=w}var k,l,m,n=g.rgRepeat,o=n.match(/^\s*(.+)\s+in\s+(.*?)\s+track\s+by\s+(.+)\s*$/),p=Object.create(null);if(!o)throw"Expected expression in form of '_item_ in _collection track by _key_'";var q=document.createComment(" end rgRepeat: "+n+" ");k=o[1],l=o[2];var r=a(o[3]);m=o[1],e.$watchCollection(l,j)}}return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:e}}angular.module("ringid.common.rgrepeat_directive",[]).directive("rgRepeat",a),a.$inject=["$parse","$rootScope","$animate","SystemEvents"]}(),function(){"use strict";angular.module("ringid.common.directives",["ringid.common.rgsearch_directive","ringid.common.rground_progress_directive","ringid.common.rginvite_directive","ringid.common.rgemoticon_directive","ringid.common.rgimg_directive","ringid.common.rghashtag_directive","ringid.common.rgupload_directive","ringid.common.rgphotos_directive","ringid.common.rg_friend_dropdown","ringid.common.rgeditor_directive","ringid.common.rghref_directive","ringid.common.rgslider_directive","ringid.common.emotion_directives","ringid.common.rghover_card_directive","ringid.common.rg_tag_friend","ringid.common.rgplayer_directive","ringid.common.rgrepeat_directive","ringid.common.rg_column","ringid.common.rgsrc_directive","ringid.common.rgloading_directive","ringid.common.rgRecorder","ringid.common.rg_global_loader_directive"])}(),function(){"use strict";function a(a,b,c){var d=this,e=b.SYSTEM.PROFILE,f=b.SYSTEM.REQUEST_TYPE;d.basicAndPrivacy=function(b,c){var d;return d=c?{actn:e.TYPE_ACTION_CURRENT_USER_BASICINFO}:{actn:e.TYPE_ACTION_OTHER_USER_BASICINFO,utId:b},a.request(d,f.REQUEST)},d.getUserDetails=function(b,c){var d={actn:e.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!c};return angular.extend(d,b),a.request(d,f.REQUEST,!0)},d.fetchPresence=function(b){var c={actn:e.ACTION_USERS_PRESENCE_DETAILS,uIds:b};return a.send(c,f.REQUEST)},d.fetchPresenceAndMood=function(b){var c={actn:e.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:b};return a.request(c,f.REQUEST)},d.changeMood=function(b){var c={actn:e.TYPE_ACTION_USER_MOOD,mood:b};return a.request(c,f.AUTHENTICATION)},d.getMutualFriends=function(b){var c={actn:e.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:b};return a.request(c,f.REQUEST)},d.getUserProfileData=function(b){var c;return c=b?{actn:e.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS,utId:b}:{actn:e.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS},a.send(c,f.REQUEST)},d.updateProfile=function(b,c,d,g){1!==g&&(g=g.getTime());var h={actn:e.TYPE_ACTION_MODIFY_USER_PROFILE,nOfHd:7,fn:c.fn.utf8Encode(),hc:c.hc?c.hc.utf8Encode():" ",cc:c.cc?c.cc.utf8Encode():" ",gr:c.gr,am:c.am.utf8Encode(),bDay:d?d.getTime():1,mDay:g};return a.request(h,f.UPDATE)},d.updateProfilePrivacy=function(){var b={actn:e.TYPE_ACTION_MODIFY_PRIVACY_SETTINGS,pvc:[3,3,3,3,3]};return a.request(b,f.UPDATE)},d.submitNewEducation=function(b){var c={actn:e.TYPE_ACTION_ADD_EDUCATION,request_type:f.UPDATE,edu:{af:1,cntn:b.cntn?b.cntn.utf8Encode():"",desc:b.desc?b.desc.utf8Encode():"",dgr:b.dgr?b.dgr.utf8Encode():"",grtd:b.grtd,iss:b.iss,scl:b.scl.utf8Encode(),ft:b.ft?b.ft:1,tt:b.tt?b.tt:1,ut:0}};return a.request(c,f.UPDATE)},d.deleteEducation=function(b){var c={actn:e.TYPE_ACTION_REMOVE_EDUCATION,id:b};return a.request(c,f.UPDATE)},d.updateEducationById=function(b){var c={actn:e.TYPE_ACTION_UPDATE_EDUCATION,edu:{id:b.id,scl:b.scl.utf8Encode(),ft:b.ft?b.ft:1,tt:b.tt?b.tt:1,desc:b.desc?b.desc.utf8Encode():"",af:b.af,grtd:b.grtd,iss:b.iss,cntn:b.cntn?b.cntn.utf8Encode():"",dgr:b.dgr?b.dgr.utf8Encode():""}};return a.request(c,f.UPDATE)},d.getAllSkill=function(){var b={actn:230};return a.request(b,f.REQUEST)},d.submitNewSkill=function(b){var c={actn:e.TYPE_ACTION_ADD_SKILL,skill:{skl:b.skl.utf8Encode(),desc:b.desc.utf8Encode()}};return a.request(c,f.UPDATE)},d.updateSkill=function(b){var c={actn:e.TYPE_ACTION_UPDATE_SKILL,skill:{id:b.id,skl:b.skl.utf8Encode(),desc:b.desc.utf8Encode()}};return a.request(c,f.UPDATE)},d.deleteSkill=function(b){var c={actn:e.TYPE_ACTION_REMOVE_SKILL,id:b};return a.request(c,f.UPDATE)},d.submitNewWork=function(b){var c={actn:e.TYPE_ACTION_ADD_WORK,request_type:f.UPDATE,wrk:{pstn:b.pstn?b.pstn.utf8Encode():"",desc:b.desc?b.desc.utf8Encode():"",cnm:b.cnm.utf8Encode(),tt:b.tt||1,ft:b.ft||1}};return a.request(c,f.UPDATE)},d.updateWork=function(b){var c={actn:e.TYPE_ACTION_UPDATE_WORK,wrk:{id:b.id,pstn:b.pstn.utf8Encode(),cnm:b.cnm.utf8Encode(),desc:b.desc.utf8Encode(),tt:b.tt||1,ft:b.ft||1}};return a.request(c,f.UPDATE)},d.deleteWork=function(b){var c={actn:e.TYPE_ACTION_REMOVE_WORK,id:b};return a.request(c,f.UPDATE)},d.changeProfilePicture=function(b){var c={actn:e.TYPE_CHANGE_PROFILE_PIC,type:1,imT:2,pimX:b.pimX,pimY:b.pimY,ih:b.ih,iw:b.iw,iurl:b.iurl};return a.request(c,f.UPDATE)},d.changeCoverPicture=function(b){var c={actn:e.TYPE_CHANGE_COVER_PIC,type:1,imT:3,cimX:b.cimX,cimY:b.cimY,ih:b.ih,iw:b.iw,iurl:b.iurl};return a.request(c,f.UPDATE)},d.removeProfilePicture=function(b){var c={actn:e.TYPE_REMOVE_PROFILE_IMAGE,prIm:b};return a.request(c,f.UPDATE)},d.removeCoverPicture=function(b){var c={actn:e.TYPE_REMOVE_COVER_IMAGE,cIm:b};return a.request(c,f.UPDATE)},d.changePassword=function(b,c){var d={actn:e.CHANGE_PASSWORD,oPw:b,nPw:c};return a.request(d,f.UPDATE)},d.sendCode=function(b){var c={actn:e.SEND_VERIFICATION_CODE_TO_MAIL,el:b.email};return a.request(c,f.REQUEST)},d.sendCodeToPhn=function(b){var c={actn:e.SEND_VERIFICATION_CODE_TO_PHONE,mbl:b.phone,mblDc:b.countryCode};return a.request(c,f.REQUEST)},d.verifyCode=function(b){var c={actn:e.SEND_VERIFICATION_CODE_TO_MAIL,el:b.email,vc:b.code};return a.request(c,f.REQUEST)},d.verifyPhnCode=function(b){var c={actn:e.SEND_VERIFICATION_CODE_TO_PHONE,uId:b.uId,mbl:b.phone,mblDc:b.mblDc,vc:b.code};return a.request(c,f.REQUEST)},d.changePrivacy=function(b){var c={actn:b.utId,sn:b.sn,sv:b.sv};return b.hasOwnProperty("utId")&&(c.utId=b.utId),a.request(c,f.UPDATE)},d.saveCallPvcEdit=function(b){var c={actn:b.actn,sn:b.sn,sv:b.sv};return b.isCurrent||(c.utId=b.utId),a.request(c,f.UPDATE,!0)},d.saveChatPvcEdit=function(b){var c={actn:b.actn,sn:b.sn,sv:b.sv};return b.isCurrent||(c.utId=b.utId),a.request(c,f.UPDATE,!0)},d.saveFeedPvcEdit=function(b){var c={actn:b.actn,sn:b.sn,sv:b.sv};return b.isCurrent||(c.utId=b.utId),a.request(c,f.UPDATE,!0)},d.addSocialAccount=function(b){var d={actn:e.ADD_SOCIAL_NETWORK,it:b.access_token,smid:b.id,wk:c.getUniqueID()};return"facebook"===b.platform?d.smt=4:"twitter"===b.platform&&(d.smt=5),a.request(d,f.AUTHENTICATION)},d.saveAchatSetting=function(b){var c={actn:e.TYPE_CHANGE_PRIVACY,sn:b.sn,sv:b.sv};return a.request(c,f.UPDATE)},d.saveAinfndreqSettings=function(b){var c={actn:e.TYPE_CHANGE_PRIVACY,sn:b.sn,sv:b.sv};return a.request(c,f.UPDATE)},d.saveAfamSettings=function(b){var c={actn:e.TYPE_CHANGE_PRIVACY,sn:b.sn,sv:b.sv};return a.request(c,f.UPDATE)},d.saveAafSetting=function(b){var c={actn:e.TYPE_CHANGE_PRIVACY,sn:b.sn,sv:b.sv};return a.request(c,f.UPDATE)}}angular.module("ringid.profile.http_service",["ringid.config"]).service("profileHttpService",a),a.$inject=["$$connector","OPERATION_TYPES","utilsFactory"]}(),function(){"use strict";angular.module("ringid.profile",["ringid.auth","ringid.profile.http_service","ringid.common.user_factory","ringid.friend.friends_factory","ringid.media","ui.bootstrap","ringid.common.services","angular-svg-round-progress"])}(),function(){"use strict";function a(a,b,c,d,e){function f(c,e,f){function h(a){a||c.enabled?(e.bind("mousedown",i),e.bind("mouseup",k)):(e.unbind("mousedown",i),e.unbind("mouseup",k)),c.$rgDigest()}function i(a){c.enabled&&(1===a.which&&(o=a.clientX,p=a.clientY,x=!0),e.bind("mousemove",j))}function j(a){var b,d,f;c.enabled&&x&&(b=c.elemStyle.backgroundPosition.match(/(-?\d+).*?\s(-?\d+)/)||[],d=a.clientX,f=a.clientY,m=parseInt(b[1])||0,n=parseInt(b[2])||0,m=g(q-z.width,0,m+d-o,y.bound),n=g(r-z.height,0,n+f-p,y.bound),e.css({backgroundPosition:m+"px "+n+"px"}))}function k(a){c.enabled&&x&&(void 0!==m&&void 0!==n&&(c.elemStyle.backgroundPosition=m+"px "+n+"px",b.setReposition({cimX:Math.ceil(Math.abs(m)/w)||0,cimY:Math.ceil(Math.abs(n)/w)||0},c.imgType)),x=!1,m=void 0,n=void 0,e.unbind("mousemove",j))}function l(){c.toggleResizeShow()(c.imgType,!1);var a=this;z.width=a.width,z.height=a.height,z.width/s<=z.height/t?(w=q/z.width,z.width=q,z.height=Math.floor(z.height*w),u=a.width/s,b.setReposition({iw:Math.ceil(a.width),ih:Math.ceil(t*u)},c.imgType)):(w=r/z.height,z.height=r,z.width=Math.floor(z.width*w),u=a.height/t,b.setReposition({ih:Math.ceil(a.height),iw:Math.ceil(s*u)},c.imgType)),h(!0)}var m,n,o,p,q=e[0].clientWidth,r=e[0].clientHeight,s="profilephoto"===c.imgType?d.PROFILE_PIC_CROP_WIDTH:d.COVER_PIC_CROP_WIDTH,t="profilephoto"===c.imgType?d.PROFILE_PIC_CROP_WIDTH:d.COVER_PIC_CROP_HEIGHT,u=1,v="",w=1,x=!1,y={bound:!0},z={width:0,height:0};if(c.selectFromAlbum=b.selectFromAlbum,"coverphoto"===c.imgType){var A=Math.ceil(d.COVER_PIC_CROP_HEIGHT*q/d.COVER_PIC_CROP_WIDTH);c.elemStyle.height=A+"px",r=A}c.$watch("enabled",function(b,d){b?c.repositionExisting?a.resizeImage((c.elemStyle.backgroundImage.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],c.imgType).then(function(){B()}):B():h(!1)});var B=function(){var a=c.elemStyle.backgroundImage;if(v=(a.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1]){var b=new Image;b.onload=l,b.src=v}}}var g=function(a,b,c,d){if(3===arguments.length||d){if(a>c)return a;if(c>b)return b}return c};return{restrict:"A",replace:!1,scope:{elemStyle:"=",enabled:"=",imgType:"@",repositionExisting:"=",toggleResizeShow:"&"},link:f}}angular.module("ringid.profile").directive("rgImgReposition",a),a.$inject=["imageQuality","fileUploadService","$document","APP_CONSTANTS","Ringalert"]}(),function(){"use strict";function a(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r,s,t=f.uId;b.isOwner=g.currentUser().getKey()===t,b.consType=o.get(),b.profilePicDragEnable=!1,b.coverPicDragEnable=!1,b.processing=!1,b.profileDdControl={showOnHover:!0,enableCoverReposition:!0,enableProfileReposition:!0},b.showCoverDD=!1,b.coverPhotoStyle={backgroundSize:"cover"},b.profilePhotoStyle={backgroundSize:"cover"},b.link=m.getRingRoute("USER_PROFILE",{uId:t}),b.profileObj=h.getProfile(t),void 0===f.subpage?b.subPage="post":(b.subPage=f.subpage,"about"===b.subPage&&(b.activeNav="basic")),b.subPageLink="pages/profile/profile."+b.subPage+".html",h.init(b.profileObj).then(function(){u("coverphoto"),u("profilephoto")});var u=function(a){"profilephoto"===a?(b.profilePhotoStyle.backgroundImage="url("+b.profileObj.avatar("thumb")+")",b.profilePhotoStyle.backgroundPosition="50% 50%",b.profilePhotoStyle.backgroundImage.indexOf("prof.png")>-1?b.profileDdControl.enableProfileReposition=!1:b.profileDdControl.enableProfileReposition=!0):(b.coverPhotoStyle.backgroundImage="url("+b.profileObj.getCover()+")",b.coverPhotoStyle.backgroundPosition="0px 0px",b.coverPhotoStyle.backgroundImage.indexOf("default_cover")>-1?b.profileDdControl.enableCoverReposition=!1:b.profileDdControl.enableCoverReposition=!0),b.$rgDigest()};u("coverphoto"),u("profilephoto"),b.frndAction=function(a){q.close(a.event),a.friend.isLoading()||(e.friendAction(a,!0).then(function(){b.$rgDigest()},function(){b.$rgDigest()}),b.$rgDigest())},b.repositionExisting=!1,b.coverDdHtml="pages/dropdowns/coverphoto-dropdown.html",b.coverDdAction=function(a){switch(a.action){case"coverphoto":b.toggleResizeShow("coverphoto",!0),b.uploadAction(a);break;case"toggleReposition":b.repositionExisting=!0,b.toggleResizeShow("coverphoto",!0),b.uploadAction({action:"coverphoto",uploadFile:i.queueFile("coverphoto",b.profileObj.getCover("original"))});break;case"popupData":return i.uploadType="coverphoto",function(){return{popupType:"coverphoto"}}}b.$rgDigest()},b.profileDdHtml="pages/dropdowns/profilephoto-dropdown.html",b.frndActionTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==0 && !ddControl.isCurrentUser()" rg-click="ddAction()({ action: \'addfriend\', friend: ddControl})" href="#"><span class="icon-addf pro-f"></span><span class="txt">{{consType.add_friend}}</span></a><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl})" href="#"> <span class="icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.friendshipStatus()==2" rg-click="ddAction()({ action: \'accept\', friend: ddControl})" href="#"><span class="icon-incoming pro-f"></span><span class="txt">{{consType.accept}}</span></a><a  ng-if="ddControl.friendshipStatus()==3" rg-click="ddAction()({ action: \'remove\', friend: ddControl})" href="#"><span class="friend-ico cancel-req"></span><span class="txt">{{consType.remove}}</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl})" class="border-0" href="#"><span class="icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl})" class="border-0" href="#"><span class="icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a></div>',b.profileDdAction=function(a){switch(a.action){case"profilephoto":b.toggleResizeShow("profilephoto",!0),b.uploadAction(a);break;case"toggleReposition":b.toggleResizeShow("profilephoto",!0),b.repositionExisting=!0,b.uploadAction({action:"profilephoto",uploadFile:i.queueFile("profilephoto",b.profileObj.avatar("original"))});break;case"popupData":return i.uploadType="profilephoto",function(){return{popupType:"profilephoto"}}}b.$rgDigest()},b.toggleResizeShow=function(a,c){"coverphoto"===a?b.cvResizeProgressShow=c||!1:b.ppResizeProgressShow=c||!1,b.$rgDigest()},b.$on(l.IMAGE.DO_REPOSITION,function(c,d){b.toggleResizeShow(i.uploadType,!0),b.uploadAction({action:i.uploadType,uploadFile:i.queueFile(i.uploadType,d.image)}),a.closeAll()}),b.uploadAction=function(a){var c;b.repositionExisting=!1,"coverphoto"===a.action?(r=a.uploadFile,c=r):(s=a.uploadFile,c=s),c&&(p.$broadcast(l.LOADING,!0),c.fetchMeta(function(d){p.$broadcast(l.LOADING,!1),d.success?"coverphoto"===a.action?b.toggleCoverPhotoReposition(c.getPreview()):b.toggleProfilePhotoReposition(c.getPreview()):(b.toggleResizeShow(a.action,!1),n.show(d.message,"error")),b.$rgDigest()})),b.$rgDigest()},b.uploadPicture=function(a,c){var d;"coverphoto"===a?(b.cvUploadProgressShow=!0,b.coverPicDragEnable=!1,d=r):"profilephoto"===a&&(b.ppUploadProgressShow=!0,b.profilePicDragEnable=!1,d=s),p.$broadcast(l.LOADING,!0),d.initUpload().then(function(c){b.cvUploadProgressShow=!1,b.ppUploadProgressShow=!1,c.sucs===!0?"profilephoto"===a?h.changeProfilePicture(c).then(function(){p.$broadcast(l.LOADING,!1),p.$rgDigest(),u(a)}):"coverphoto"===a&&h.changeCoverPicture(c).then(function(){p.$broadcast(l.LOADING,!1),p.$rgDigest(),u(a)}):(u(a),p.$broadcast(l.LOADING,!1))},function(b){u(a)}),c&&c.stopPropagation(),b.$rgDigest()},b.toggleCoverPhotoReposition=function(a,c){var d,e="",f=b.profileObj.getCoverXY();b.coverPicDragEnable?(b.coverPicDragEnable=!1,u("coverphoto")):(a?e=a:(a=b.profileObj.getCover(),
d=a.slice(a.lastIndexOf("/")+1,a.length),e=a.replace(d,d.replace("crp",""))),b.coverPhotoStyle.backgroundImage="url("+e+")",b.coverPhotoStyle.backgroundPosition=-f.x+"px "+-f.y+"px",b.coverPicDragEnable=!0,b.$rgDigest()),c&&c.stopPropagation()},b.$watch("profilePicDragEnable",function(a){a||b.ppUploadProgressShow||u("profilephoto")}),b.$watch("coverPicDragEnable",function(a){a||b.cvUploadProgressShow||u("coverphoto")}),b.toggleProfilePhotoReposition=function(a,c){var d,e,f="";b.profilePicDragEnable?(b.profilePicDragEnable=!1,u("profilephoto")):(a?f=a:(a=b.profileObj.avatar("original"),d=a.slice(a.lastIndexOf("/")+1,a.length),f=a.replace(d,d.replace(e,""))),b.profilePhotoStyle.backgroundImage="url("+f+")",b.profilePhotoStyle.backgroundPosition="0px 0px",b.profilePicDragEnable=!0,b.$rgDigest()),c&&c.stopPropagation()},b.getImageData=function(a){return{data:function(){return{imgId:a}},promise:k.getImageDetails(a)}},b.cvUploadProgressShow=!1,b.cvResizeProgressShow=!1,b.ppResizeProgressShow=!1,b.uploadStyle=function(){return{width:i.progress+"%"}},b.roundProgressBarStyle={dataRoundProgressWidth:"200",dataRoundProgressHeight:"200",dataRoundProgressOuterCircleWidth:"4",dataRoundProgressInnerCircleWidth:"8",dataRoundProgressOuterCircleRadius:"85",dataRoundProgressInnerCircleRadius:"85",dataRoundProgressLabelFont:"24",dataRoundProgressOuterCircleBackgroundColor:"#fff",dataRoundProgressOuterCircleForegroundColor:"#f47727",dataRoundProgressInnerCircleColor:"#fff",dataRoundProgressLabelColor:"#fff"},b.ppUploadProgressShow=!1,b.uploadImageFileSize=function(){return i.currentUploadImageSize},b.getRoundedProgressTextStyle=function(){return{top:"50%",bottom:"auto",left:"50%",transform:"translateY(-50%) translateX(-50%)","font-size":100/3.5+"px",position:"absolute"}},b.roundProgressData=function(){return{label:i.progress+"%",percentage:i.progress,dataLoaded:i.dataLoaded}},b.openRingbox=function(a){return"cover"===a?!b.coverPicDragEnable&&!b.cvResizeProgressShow&&!b.cvUploadProgressShow&&b.profileDdControl.enableCoverReposition:!b.profilePicDragEnable&&!b.ppResizeProgressShow&&!b.ppUploadProgressShow&&b.profileDdControl.enableProfileReposition},b.$on(l.FILE_UPLOAD.PROGRESS_UPDATE,function(){b.$rgDigest()}),b.showMenuItems=!1,b.toggleMenuItem=function(){b.showMenuItems=!b.showMenuItems,b.$rgDigest()},b.closeDropdown=function(){b.showMenuItems=!1,b.$rgDigest()},b.$on("$destroy",function(){"about"===f.subPage&&h.removeProfileData(b.profileObj.getUtId())})}a.$inject=["$ringbox","$scope","Notification","Storage","friendsFactory","$routeParams","Auth","profileFactory","fileUploadService","imageQuality","AlbumFactory","SystemEvents","utilsFactory","Ringalert","languageConstant","$rootScope","rgDropdownService"];var b=function(a,b){function c(b){a.showCoverDD=!a.showCoverDD,a.$rgDigest()}b.on("mouseenter",c),b.on("mouseleave",c),a.$on("$destroy",function(){b.off("mouseenter",c),b.off("mouseleave",c)})};return{restrict:"E",scope:!0,templateUrl:"pages/profile/profile-header.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfile",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e,f){function g(a){a.preventDefault(),b.tmpBasic=angular.copy(b.profileObj.getBasicInfo()),1!==b.tmpBasic.mDay&&"1"!==b.tmpBasic.mDay||(b.tmpBasic.marriageDay=null),1!==b.tmpBasic.birthDay&&"1"!==b.tmpBasic.birthDay||(b.tmpBasic.birthday=null),b.isEditProfile=!0,b.$rgDigest()}function h(){b.isEditProfile=!1,b.$rgDigest()}function i(){b.processing=!0;var g=b.tmpBasic.marriageDay;null==g&&(g=1);var h,i=typeof b.tmpBasic.birthday,j=typeof g;if("string"===i){var k=b.tmpBasic.birthday.split("-"),l=parseInt(k[0])+","+parseInt(k[1])+","+parseInt(k[2]);h=new Date(l)}else if(h=b.tmpBasic.birthday,1!==b.tmpBasic.birthDay&&"1"!==b.tmpBasic.birthDay){var m=c.profileVerbalDate(b.tmpBasic.birthDay);b.tmpBasic.birthday=m}if("string"===j){var n=g.split("-"),o=parseInt(n[0])+","+parseInt(n[1])+","+parseInt(n[2]);g=new Date(o)}d.updateUserProfile(b.uId,b.tmpBasic,h,g).then(function(c){c.sucs===!0?(b.tmpBasic.birthDay=h?h.getTime():"1","object"==typeof h?b.currentUser.setBirthday(b.tmpBasic.birthDay):b.currentUser.setBirthday("1"),"object"===j?b.currentUser.setMarriageday(g.getTime()):b.currentUser.setMarriageday("1"),b.profileObj.getBasicInfo().birthDay=b.tmpBasic.birthDay,b.currentUser.setName(b.tmpBasic.fn),b.currentUser.setHomeCity(b.tmpBasic.hc),b.currentUser.setCurrentCity(b.tmpBasic.cc),b.currentUser.setAboutMe(b.tmpBasic.am),a.updateLoginData("fn",b.tmpBasic.fn),b.currentUser.setGender(b.tmpBasic.gr),e.show("Successfully updated","success"),b.isEditProfile=!1):(b.isEditProfile=!1,e.show(c.mg,"error")),b.processing=!1,f.$rgDigest()})}b.isEditProfile=!1,b.processing=!1,b.enableEditBasic=g,b.updateMyBasicInfo=i,b.cancelUpdateMyBasicInfo=h,b.isDatePickerOpen=!1,b.model={},b.open=function(a,c){switch(a.preventDefault(),a.stopPropagation(),c){case"wcalendar":b.model.wcalendarTo=!1;break;case"wcalendarTo":b.model.wcalendar=!1;break;case"ecalendar":b.model.ecalendarTo=!1;break;case"ecalendarTo":b.model.ecalendar=!1;break;case"mcalendar":b.model.mcalendar=!1}b.model[c]=!b.model[c]},b.dateOptions={showWeeks:"false",startingDay:1};var j=new Date;j.setMonth(j.getMonth()+6),b.minDate=new Date,b.maxBirthDate=new Date(j.getFullYear(),j.getMonth(),j.getDate()),b.maxWeddingDate=new Date(j.getFullYear()+20,j.getMonth(),j.getDate())}return a.$inject=["Storage","$scope","utilsFactory","profileFactory","Ringalert","$rootScope"],{restrict:"E",templateUrl:"pages/profile/profile.about-basic.html",controller:a}}angular.module("ringid.profile").directive("rgProfileBasic",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e,f,g,h){function i(a){a.preventDefault(),d.isEditProfilePrivacy=!0,d.$rgDigest()}function j(a){var b;d.isEditProfilePrivacy=!1,b=d.profileObj.isCurrentUser()?{actn:216,sv:a.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:a.callPrivacy,sn:6,utId:d.profileObj.getUtId(),isCurrent:!1},d.fPrivacyInfo.callPrivacy=a.callPrivacy,g.saveCallPvcEdit(b).then(function(b){b.sucs===!0&&(d.fPrivacyInfo.callPrivacy=a.callPrivacy)});var c;c=d.profileObj.isCurrentUser()?{actn:216,sv:a.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:a.chatPrivacy,sn:7,utId:d.profileObj.getUtId(),isCurrent:!1},d.fPrivacyInfo.chatPrivacy=a.chatPrivacy,g.saveChatPvcEdit(c).then(function(b){b.sucs===!0&&(d.fPrivacyInfo.chatPrivacy=a.chatPrivacy)});var e;e=d.profileObj.isCurrentUser()?{actn:216,sv:a.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:a.feedPrivacy,sn:8,utId:d.profileObj.getUtId(),isCurrent:!1},d.fPrivacyInfo.feedPrivacy=a.feedPrivacy,g.saveFeedPvcEdit(e).then(function(b){b.sucs===!0&&(d.fPrivacyInfo.feedPrivacy=a.feedPrivacy)}),d.$rgDigest()}function k(){d.isEditProfilePrivacy=!1,d.$rgDigest()}d.isEditProfilePrivacy=!1,d.callPvcEdit=!1,d.chatPvcEdit=!1,d.feedPvcEdit=!1,d.fPrivacyInfo={callPrivacy:0,chatPrivacy:0,feedPrivacy:0},d.enablePrivacyEditMode=i,d.savePvcEdit=j,d.cancelPvcEdit=k,d.profileObj.isCurrentUser()?a.fetchPrivacy().then(function(a){a.sucs===!0&&(d.fPrivacyInfo.callPrivacy=a.cla,d.fPrivacyInfo.chatPrivacy=a.chta,d.fPrivacyInfo.feedPrivacy=a.fda),d.$rgDigest()}):(d.access=d.profileObj.getAccess,d.fPrivacyInfo.callPrivacy=d.profileObj.getAccess().cla,d.fPrivacyInfo.chatPrivacy=d.profileObj.getAccess().chta,d.fPrivacyInfo.feedPrivacy=d.profileObj.getAccess().fda,d.fPrivacyInfo.callPrivacy||d.fPrivacyInfo.chatPrivacy||d.fPrivacyInfo.feedPrivacy||d.profileObj.setBlock(1),d.$rgDigest())}a.$inject=["Auth","Storage","$timeout","$scope","utilsFactory","friendsFactory","profileFactory","languageConstant"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-privacy.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfilePrivacy",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e,f){function g(){n&&(b.educationlist[o]=n),b.isEditEducation=-1,b.eduObjInfo.scl="",b.eduObjInfo.dgr="",b.eduObjInfo.cntn="",b.eduObjInfo.toTimeE="",b.eduObjInfo.fromTimeE="",b.isaddNewEducation=!0,b.$rgDigest()}function h(a,c){o=a,b.eduObjInfo=b.educationlist[a],n=angular.copy(b.educationlist[a]),1===b.eduObjInfo.tt&&(b.eduObjInfo.toTimeE=null),1===b.eduObjInfo.ft&&(b.eduObjInfo.fromTimeE=null),b.isaddNewEducation=!1,b.isEditEducation=a,b.$rgDigest()}function i(){n&&(b.educationlist[o]=n),b.isaddNewEducation=!1,b.isEditEducation=-1,b.$rgDigest()}function j(){b.educationlist[o]=n,b.isEditEducation=-1,b.$rgDigest()}function k(){if(b.eduObjInfo.scl||(b.edusclerror=!0,b.$rgDigest()),b.eduObjInfo.dgr||(b.edudgrerror=!0,b.$rgDigest()),b.eduObjInfo.cntn||(b.educntnerror=!0,b.$rgDigest()),!(b.edusclerror||b.edudgrerror||b.educntnerror)){if(b.processing=!0,b.eduObjInfo.fromTimeE&&b.eduObjInfo.toTimeE){var e,f;if(e=b.eduObjInfo.fromTimeE,f=b.eduObjInfo.toTimeE,"string"==typeof e&&(e=new Date(e)),"string"==typeof f&&(f=new Date(f)),e>f)return a.show("Your end date can't be earlier than your start date. Please try again","info"),void(b.processing=!1);b.$rgDigest()}b.eduObjInfo.fromTimeE?b.eduObjInfo.ft=new Date(b.eduObjInfo.fromTimeE).getTime():b.eduObjInfo.ft=1,b.eduObjInfo.toTimeE?b.eduObjInfo.tt=new Date(b.eduObjInfo.toTimeE).getTime():b.eduObjInfo.tt=1,d.updateEducation(b.eduObjInfo).then(function(d){d.sucs===!0?(b.eduObjInfo.fromTimeE?b.eduObjInfo.fromTimeE=c.profileVerbalDate(b.eduObjInfo.ft):(b.eduObjInfo.ft=1,b.eduObjInfo.fromTimeE=""),b.eduObjInfo.toTimeE?b.eduObjInfo.toTimeE=c.profileVerbalDate(b.eduObjInfo.tt):(b.eduObjInfo.tt=1,b.eduObjInfo.toTimeE=""),b.isEditEducation=-1,a.show("Successfully updated","success")):(b.isEditEducation=-1,a.show("Request did not process successfully","error")),b.processing=!1,b.$rgDigest()})}}function l(){if(b.eduObjInfo.scl||(b.edusclerror=!0,b.$rgDigest()),b.eduObjInfo.dgr||(b.edudgrerror=!0,b.$rgDigest()),b.eduObjInfo.cntn||(b.educntnerror=!0,b.$rgDigest()),!(b.edusclerror||b.edudgrerror||b.educntnerror)){if(b.processing=!0,b.eduObjInfo.fromTimeE&&b.eduObjInfo.toTimeE&&b.eduObjInfo.fromTimeE>b.eduObjInfo.toTimeE)return a.show("Your end date can't be earlier than your start date. Please try again","info"),void(b.processing=!1);b.eduObjInfo.fromTimeE?b.eduObjInfo.ft=new Date(c.profileVerbalDate(b.eduObjInfo.fromTimeE)).getTime():b.eduObjInfo.ft=1,b.eduObjInfo.toTimeE?b.eduObjInfo.tt=new Date(c.profileVerbalDate(b.eduObjInfo.toTimeE)).getTime():b.eduObjInfo.tt=1,b.eduObjInfo.ut=(new Date).getTime(),b.eduObjInfo.af=1,b.eduObjInfo.grtd=!1,b.eduObjInfo.iss=!0,d.submitNewEducation(b.eduObjInfo).then(function(c){if(c.sucs===!0){b.eduObjInfo.id=c.id;var e=angular.copy(b.eduObjInfo);d.setProfileData("educationList",e,b.profileObj.getUtId()),a.show("Education info added successfully","success"),b.isaddNewEducation=!1,b.isEditEducation=-1}else a.show("Request did not process successfully","error"),b.isaddNewEducation=!1,b.isEditEducation=-1;b.isaddNewEducation=!1,b.isEditEducation=-1,b.processing=!1,b.$rgDigest()})}}function m(c){var e=b.getProfileData("educationList",b.profileObj.getUtId())[c].id;b.isEditEducation=-1,d.deleteEducation(e).then(function(d){d.sucs===!0?(b.getProfileData("educationList",b.profileObj.getUtId()).splice(c,1),a.show("Successfully deleted","success")):a.show("Request did not process successfully","error"),b.$rgDigest()})}var n,o;b.profileObj.isCurrentUser()?b.isOwner=!0:b.isOwner=!1;d.getUserProfileData({uId:e.uId},b.profileObj.isCurrentUser()),b.getProfileData=d.getProfileData,b.educationlist=b.getProfileData("educationList",b.profileObj.getUtId()),b.edusclerror=!1,b.edudgrerror=!1,b.educntnerror=!1,b.$watch("eduObjInfo.scl",function(a,c){a&&(b.edusclerror=!1)}),b.$watch("eduObjInfo.dgr",function(a,c){a&&(b.edudgrerror=!1)}),b.$watch("eduObjInfo.cntn",function(a,c){a&&(b.educntnerror=!1)}),b.ddActionHtml="pages/dropdowns/action-dropdown.html",b.actionEduDropdown=function(a){switch(f.close(a.event),a.action){case"edit":h(a.data.index,a.data.obj);break;case"delete":m(a.data.index)}},b.isaddNewEducation=!1,b.isEditEducation=-1,b.eduObjInfo={},b.addNewEducation=g,b.submitNewEducation=l,b.updateEducation=k,b.cancelAddEducation=i,b.cancelUpdateEducation=j,b.$on("$destroy",function(){})}a.$inject=["Ringalert","$scope","utilsFactory","profileFactory","$routeParams","rgDropdownService"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-education.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileEducation",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e,f){function g(){o&&(a.worklist[p]=o),a.isEditWork=-1,a.workObjInfo.cnm="",a.workObjInfo.pstn="",a.workObjInfo.desc="",a.workObjInfo.fromTimeE="",a.workObjInfo.toTimeE="",a.workObjInfo.ft="",a.workObjInfo.tt="",a.isAddNewWork=!0,a.$rgDigest()}function h(){o&&(a.worklist[p]=o),a.isAddNewWork=!1,a.$rgDigest()}function i(){if(a.workObjInfo.cnm||(a.workcnmerror=!0,a.$rgDigest()),a.workObjInfo.pstn||(a.workpstnerror=!0,a.$rgDigest()),!a.workcnmerror&&!a.workpstnerror){if(a.processing=!0,a.workObjInfo.fromTimeE&&a.workObjInfo.toTimeE&&a.workObjInfo.fromTimeE>a.workObjInfo.toTimeE)return f.show("Your end date can't be earlier than your start date. Please try again","info"),void(a.processing=!1);a.workObjInfo.status===!0?(a.workObjInfo.tt="0",a.workObjInfo.status=!0,a.workObjInfo.date_info="Present"):a.workObjInfo.toTimeE?a.workObjInfo.tt=new Date(a.workObjInfo.toTimeE).getTime():a.workObjInfo.tt=1,a.workObjInfo.fromTimeE?a.workObjInfo.ft=new Date(a.workObjInfo.fromTimeE).getTime():a.workObjInfo.ft=1,c.submitNewWork(a.workObjInfo).then(function(d){if(d.sucs===!0){a.workObjInfo.id=d.id,a.workObjInfo.ft?a.workObjInfo.fromTimeE=b.profileVerbalDate(a.workObjInfo.ft):a.workObjInfo.ft=1,a.workObjInfo.tt?a.workObjInfo.toTimeE=b.profileVerbalDate(a.workObjInfo.tt):a.workObjInfo.tt=1;var e=angular.copy(a.workObjInfo);c.setProfileData("workList",e,a.profileObj.getUtId()),f.show("Career info added successfully","success"),a.isAddNewWork=!1,a.isEditWork=-1}else f.show("Request did not process successfully","error"),a.isAddNewWork=!1,a.isEditWork=-1;a.processing=!1,a.$rgDigest()})}}function j(a){switch(a.action){case"edit":k(a.data.index),e.close(a.event);break;case"delete":n(a.data.index),e.close(a.event)}}function k(b){p=b,a.workObjInfo=a.worklist[b],o=angular.copy(a.worklist[b]),1!==a.workObjInfo.tt&&"0"!==a.workObjInfo.tt&&0!==a.workObjInfo.tt||(a.workObjInfo.toTimeE=null),1===a.workObjInfo.ft&&(a.workObjInfo.fromTimeE=null),a.isAddNewWork=!1,a.isEditWork=b,a.$rgDigest()}function l(){if(a.workObjInfo.cnm||(a.workcnmerror=!0,a.$rgDigest()),a.workObjInfo.pstn||(a.workpstnerror=!0,a.$rgDigest()),!a.workcnmerror&&!a.workpstnerror){if(a.processing=!0,a.workObjInfo.fromTimeE&&a.workObjInfo.toTimeE){var d,e;if(d=a.workObjInfo.fromTimeE,e=a.workObjInfo.toTimeE,"string"==typeof d&&(d=new Date(d)),"string"==typeof e&&(e=new Date(e)),d>e)return f.show("Your end date can't be earlier than your start date. Please try again","info"),void(a.processing=!1);a.$rgDigest()}a.workObjInfo.fromTimeE?a.workObjInfo.ft=new Date(a.workObjInfo.fromTimeE).getTime():a.workObjInfo.ft=1,a.workObjInfo.toTimeE?a.workObjInfo.tt=new Date(a.workObjInfo.toTimeE).getTime():a.workObjInfo.tt=1,a.workObjInfo.status===!0&&(a.workObjInfo.tt="0",a.workObjInfo.status=!0,a.workObjInfo.date_info="Present"),c.updateWork(a.workObjInfo).then(function(c){c.sucs===!0?(a.workObjInfo.ft?a.workObjInfo.fromTimeE=b.profileVerbalDate(a.workObjInfo.ft):a.workObjInfo.ft=1,a.workObjInfo.tt?a.workObjInfo.toTimeE=b.profileVerbalDate(a.workObjInfo.tt):a.workObjInfo.tt=1,a.workObjInfo.status===!0&&(a.workObjInfo.tt=0,a.date_info="Present"),f.show("Updated successfully","success"),a.isEditWork=-1):(a.isEditWork=-1,f.show("Request did not process successfully","error")),a.processing=!1,a.$rgDigest()})}}function m(){a.worklist[p]=o,a.isEditWork=-1,a.$rgDigest()}function n(b){a.isEditWork=-1;var d=a.getProfileData("workList",a.profileObj.getUtId())[b].id;c.deleteWork(d).then(function(c){c.sucs===!0?(a.getProfileData("workList",a.profileObj.getUtId()).splice(b,1),f.show("Successfully deleted","success")):f.show("Request did not process successfully","error"),a.$rgDigest()})}a.profileObj.isCurrentUser()?a.isOwner=!0:a.isOwner=!1,c.getUserProfileData({uId:d.uId},a.profileObj.isCurrentUser()),a.getProfileData=c.getProfileData,a.worklist=a.getProfileData("workList",a.profileObj.getUtId()),a.ddActionHtml="pages/dropdowns/action-dropdown.html",a.actionWorkDropdown=j,a.isAddNewWork=!1,a.isEditWork=-1,a.workObjInfo={};var o,p;a.addNewWork=g,a.cancelNewWork=h,a.submitNewWork=i,a.cancelUpdateWork=m,a.updateWork=l,a.workcnmerror=!1,a.workpstnerror=!1,a.$watch("workObjInfo.cnm",function(b,c){b&&(a.workcnmerror=!1)}),a.$watch("workObjInfo.pstn",function(b,c){b&&(a.workpstnerror=!1)}),a.$watch("workObjInfo.status",function(b,c){a.workObjInfo.toTimeE=""}),a.$on("$destroy",function(){})}a.$inject=["$scope","utilsFactory","profileFactory","$routeParams","rgDropdownService","Ringalert"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-work.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileWork",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e){function f(){m&&(a.skilllist[n]=m),a.isEditSkill=-1,a.skillObjInfo.skl="",a.skillObjInfo.desc="",a.isAddNewSkill=!0,a.$rgDigest()}function g(){a.skillObjInfo.desc||(a.skilldescerror=!0,a.$rgDigest()),a.skillObjInfo.skl||(a.skillsklerror=!0,a.$rgDigest()),a.skillsklerror||a.skilldescerror||(a.processing=!0,b.submitNewSkill(a.skillObjInfo).then(function(c){var d;c.sucs===!0?(a.skillObjInfo.id=c.id,d=angular.copy(a.skillObjInfo),b.setProfileData("skillList",d,a.profileObj.getUtId()),e.show("Skill info added successfully","success"),a.isAddNewSkill=!1):(a.isAddNewSkill=!1,e.show("Request did not process successfully","error")),a.processing=!1,a.$rgDigest()}))}function h(){m&&(a.skilllist[n]=m),a.isAddNewSkill=!1,a.$rgDigest()}function i(){a.skillObjInfo.desc||(a.skilldescerror=!0,a.$rgDigest()),a.skillObjInfo.skl||(a.skillsklerror=!0,a.$rgDigest()),a.skillsklerror||a.skilldescerror||(a.processing=!0,b.updateSkill(a.skillObjInfo).then(function(b){b.sucs===!0?(a.isEditSkill=-1,e.show("Successfully updated","success")):(a.isEditSkill=-1,e.show("Request did not process successfully","error")),a.processing=!1,a.$rgDigest()}))}function j(c){var d=a.getProfileData("skillList",a.profileObj.getUtId())[c].id;a.isEditSkill=-1,b.deleteSkill(d).then(function(b){b.sucs===!0?(a.getProfileData("skillList",a.profileObj.getUtId()).splice(c,1),e.show("Successfully deleted","success")):e.show("Request did not process successfully","error"),a.$rgDigest()})}function k(b){n=b,a.skillObjInfo=a.skilllist[b],m=angular.copy(a.skilllist[b]),a.isAddNewSkill=!1,a.isEditSkill=b,a.$rgDigest()}function l(){a.skilllist[n]=m,a.isEditSkill=-1,a.$rgDigest()}a.profileObj.isCurrentUser()?a.isOwner=!0:a.isOwner=!1,a.skillsklerror=!1,a.skilldescerror=!1,a.$watch("skillObjInfo.skl",function(b,c){b&&(a.skillsklerror=!1)}),a.$watch("skillObjInfo.desc",function(b,c){b&&(a.skilldescerror=!1)}),b.getUserProfileData({uId:c.uId},a.profileObj.isCurrentUser()),a.getProfileData=b.getProfileData,a.skilllist=a.getProfileData("skillList",a.profileObj.getUtId());var m,n;a.addNewSkill=f,a.submitNewSkill=g,a.cancelNewSkill=h,a.updateSkill=i,a.cancelUpdateSkill=l,a.skillObjInfo={},a.ddActionHtml="pages/dropdowns/action-dropdown.html",a.actionSkillDropdown=function(a){switch(a.action){case"edit":k(a.data.index);break;case"delete":j(a.data.index)}d.close(a.event)},a.isAddNewSkill=!1,a.$on("$destroy",function(){})}a.$inject=["$scope","profileFactory","$routeParams","rgDropdownService","Ringalert"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-skill.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileSkill",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(b){b.preventDefault(),a.showPassEdit===!1&&(a.showPassEdit=!0,a.showMessage=!1),a.$rgDigest()}function e(){a.showPassEdit=!1,a.showMessage=!0,a.IsMatch=!1,a.$rgDigest()}function f(d){d.newpassword!=d.repassword?a.IsMatch=!0:d.newpassword==d.repassword&&(a.IsMatch=!1,a.oldError=!1,c.changePassword(d.oldpassword,d.newpassword).then(function(c){c.sucs===!0?(d={oldpassword:"",newpassword:"",repassword:""},a.showPassEdit=!1,a.showMessage=!0,b.show("Password Changed Successfully","success")):b.show(c.mg,"info")},function(b){a.oldError=!0})),a.$rgDigest()}a.enablePassEdit=d,a.updatePassword=f,a.cancelUpdatePassword=e,a.showMessage=!0,a.showPassEdit=!1,a.IsMatch=!1,a.oldError=!1}a.$inject=["$scope","Ringalert","profileFactory"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-password.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfilePassword",a)}(),function(){"use strict";function a(){function a(a,b,c,d,e,f,g){function h(b){c.phone.countryCode=b.item.code,c.countryFlag=b.item.flagcode,a.close(b.event)}function i(){c.isAddEmail=!0,c.showAddEmailButton=!1,c.$rgDigest()}function j(){c.isAddPhone=!0,c.showAddPhoneButton=!1,c.$rgDigest()}function k(){c.isAddEmail=!1,c.showAddEmailButton=!0,c.$rgDigest()}function l(){c.isAddPhone=!1,c.showAddPhoneButton=!0,c.$rgDigest()}function m(a){e.sendCode(a).then(function(b){b.sucs===!0?(q=b.el,c.isAddEmail=!1,c.isAddCode=!0,c.vemail="",c.emailVerified=!1,c.emailTitle="Click here to verify your Email",a.email=""):d.show(b.mg,"info"),c.$rgDigest()})}function n(a){var b="";b="+880"===a.countryCode&&"0"===a.phone.charAt(0)?a.phone.substr(1):a.phone,c.phone.phone=b,e.sendCodeToPhn(c.phone).then(function(b){b.sucs===!0?(c.phoneNumber=b.mbl,r=b.mblDc,c.isAddPhone=!1,c.isAddPhnCode=!0,c.phoneVerified=!1,c.phoneTitle="Click here to verify your Phone",a.phone="",d.show(b.mg,"info")):d.show(b.mg,"info"),c.$rgDigest()})}function o(a){a.email=q,e.verifyCode(a).then(function(b){b.sucs===!0?(c.isAddEmail=!1,c.isAddCode=!1,c.showAddEmailButton=!0,c.emailVerified=!0,c.emailValue="Verified Email",c.emailTitle="Your Email is verified.",c.vemail=b.el,a.code="",a.email="",d.show(b.mg,"success")):(c.isAddEmail=!1,c.isAddCode=!1,c.showAddEmailButton=!0,c.emailVerified=!1,c.vemail="",d.show(b.mg,"info")),c.$rgDigest()})}function p(a){var b={};b.phone=c.phoneNumber,b.uId=s,b.mblDc=r,b.code=a.code,e.verifyPhnCode(b).then(function(b){b.sucs===!0?(c.isAddPhone=!1,c.isAddPhnCode=!1,c.showAddPhoneButton=!0,c.phoneVerified=!0,c.phoneValue="Verified Phone",c.phoneTitle="Your Phone is verified.",a.code="",d.show(b.mg,"success")):(c.isAddPhone=!1,c.isAddPhnCode=!1,c.showAddPhoneButton=!0,c.phoneVerified=!1,d.show(b.mg,"info")),c.$rgDigest()})}c.emailVerified=!1,c.phoneVerified=!1,c.countryList={},c.isAddEmail=!1,c.isAddPhone=!1,c.addEmail=i,c.addPhone=j,c.isAddCode=!1,c.showAddEmailButton=!0,c.showAddPhoneButton=!0,c.cancelAddEmail=k,c.cancelAddPhone=l,c.sendCode=m,c.sendCodeToPhn=n,c.verifyCode=o,c.verifyPhoneCode=p;var q,r,s=f.uId;c.emailValue="Verify Email",c.emailTitle="Click here to verify your Email",c.phoneValue="Verify Phone",c.phoneTitle="Click here to verify your Phone";var t=[];c.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" ><li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',c.ddControl={countryList:function(){return t}},c.phone={countryCode:g.getCountry().code},c.countryFlag=g.getCountry().flagcode,c.setPrefix=h,b.getList().success(function(a){t=a,c.$rgDigest()}),c.profileObj.isEmailVerified()&&(c.emailValue="Verified Email",c.emailTitle="Your Email is verified.",c.emailVerified=!0,c.vemail=c.profileObj.getEmail()),c.profileObj.isMobileVerified()&&(c.phoneValue="Verified Phone",c.phoneTitle="Your Phone is verified.",c.phoneVerified=!0,c.vnumber=c.profileObj.getMobileNumber()),c.cancelVerification=function(){c.isAddCode=!1,c.isAddPhnCode=!1,c.showAddEmailButton=!0,c.showAddPhoneButton=!0,c.$rgDigest()},c.resendCodeToMail=function(){e.sendCode({email:q}).then(function(a){a.sucs===!0?(q=a.el,d.show(a.mg,"info")):d.show(a.mg,"info"),c.$rgDigest()})},c.resendCodeToPhone=function(){e.sendCodeToPhn({phone:c.phoneNumber,countryCode:r}).then(function(a){a.sucs===!0?(c.phoneNumber=a.mbl,r=a.mblDc,d.show(a.mg,"info")):d.show(a.mg,"info"),c.$rgDigest()})}}a.$inject=["rgDropdownService","countryListService","$scope","Ringalert","profileFactory","$routeParams","Auth"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-recovery.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileRecovery",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(b){b.preventDefault(),a.isEditAchat=!0,a.$rgDigest()}function e(d){a.isEditAchat=!1;var e;a.profileObj.isCurrentUser()&&(e={sv:d.achat,sn:10}),a.chatsettings.achat=d.achat,b.saveAchatSetting(e).then(function(b){b.sucs===!0?(a.chatsettings.achat=d.achat,c.setAchatPermission(d.achat)):a.chatsettings.achat=0}),a.$rgDigest()}function f(){a.isEditAchat=!1,a.$rgDigest()}a.isEditAchat=!1,a.chatsettings={achat:c.getPermission().ancht},a.enableAchatEditMode=d,a.saveAchatSettings=e,a.cancelAchatSettings=f}a.$inject=["$scope","profileFactory","Auth"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-achat.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileAchat",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(b){b.preventDefault(),a.isEditAinfndreq=!0,a.$rgDigest()}function e(d){a.isEditAinfndreq=!1;var e;a.profileObj.isCurrentUser()&&(e={sv:d.ainfndreq,sn:11}),a.incomingfndreqsettings.ainfndreqobj=d.ainfndreqobj,b.saveAinfndreqSettings(e).then(function(b){b.sucs===!0?(a.incomingfndreqsettings.ainfndreq=d.ainfndreq,c.setAinfndreqPermission(d.ainfndreq)):a.incomingfndreqsettings.ainfndreq=0}),a.$rgDigest()}function f(){a.isEditAinfndreq=!1,a.$rgDigest()}a.isEditAinfndreq=!1,a.incomingfndreqsettings={ainfndreq:c.getPermission().aifr},a.enableAinfndreqEditMode=d,a.saveAinfndreqSettings=e,a.cancelAinfndreqSettings=f}a.$inject=["$scope","profileFactory","Auth"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-incoming-frnd-req.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileAinfndreq",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(b){b.preventDefault(),a.isEditAfam=!0,a.$rgDigest()}function e(d){a.isEditAfam=!1;var e;a.profileObj.isCurrentUser()&&(e={sv:d.afam,sn:12}),a.afamsettings.afam=d.afam,b.saveAfamSettings(e).then(function(b){b.sucs===!0?(a.afamsettings.afam=d.afam,c.setAfamPermission(d.afam)):a.afamsettings.afam=0}),a.$rgDigest()}function f(){a.isEditAfam=!1,a.$rgDigest()}a.isEditAfam=!1,a.afamsettings={afam:c.getPermission().afam},a.enableAfamEditMode=d,a.saveAfamSettings=e,a.cancelAfamSettings=f}a.$inject=["$scope","profileFactory","Auth"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-afam.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileAllowaddme",a)}(),function(){"use strict";function a(){function a(a,b,c){function d(b){b.preventDefault(),a.isEditAaf=!0,a.$rgDigest()}function e(d){a.isEditAaf=!1;var e;a.profileObj.isCurrentUser()&&(e={sv:d.aaf,sn:13}),a.aafsettings.aaf=d.aaf,b.saveAafSetting(e).then(function(b){b.sucs===!0?(a.aafsettings.aaf=d.aaf,c.setAafPermission(d.aaf)):a.aafsettings.aaf=0}),a.$rgDigest()}function f(){a.isEditAaf=!1,a.$rgDigest()}a.isEditAaf=!1,a.aafsettings={aaf:c.getPermission().aaf},a.enableAafEditMode=d,a.saveAafSettings=e,a.cancelAafSettings=f}a.$inject=["$scope","profileFactory","Auth"];var b=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-aaf.html",controller:a,link:b}}angular.module("ringid.profile").directive("rgProfileAutoaddfrnd",a)}(),function(){"use strict";angular.module("ringid.profile").directive("rgRelocateTemplate",function(){return{restrict:"E",template:'<ng-include src="template"></ng-include>',link:function(a,b,c){var d=c.twocol,e=c.threecol;a.template=e,window.innerWidth>1800||window.innerWidth<1200&&a.template!=e?a.template=e:window.innerWidth>1200&&window.innerWidth<1800&&a.template!=d&&(a.template=d),window.onresize=function(){window.innerWidth>1800||window.innerWidth<1200&&a.template!=e?(a.template=e,a.$apply()):window.innerWidth>1200&&window.innerWidth<1800&&a.template!=d&&(a.template=d,a.$apply())}}}})}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){var c=a;c.fromTime=new Date(c.ft),c.toTime=new Date(c.tt),c.fromTimeE=k.profileVerbalDate(c.ft),c.toTimeE=k.profileVerbalDate(c.tt),E[b].educationList.push(c)}function m(a,b){var c=a;c.fromTime=new Date(c.ft),c.toTime=new Date(c.tt),0===c.tt?(c.status=!0,c.date_info="Present"):c.toTimeE=k.profileVerbalDate(c.tt),c.fromTimeE=k.profileVerbalDate(c.ft),E[b].workList.push(c)}function n(a,b){var c=a;E[b].skillList.push(c)}function o(a,b,c){if(E.hasOwnProperty(c))switch(a){case"educationList":l(b,c);break;case"workList":m(b,c);break;case"skillList":n(b,c)}}function p(a,b){return E.hasOwnProperty(b)?E[b][a]:[]}function q(a){delete E[a]}function r(a){return C||(C=c.currentUser()),a===C.getKey()?C:D=h.create({uId:a})}function s(a){var b=e.defer();return g.basicAndPrivacy(a.getUtId(),a.isCurrentUser()).then(function(c){c.sucs===!0?(a.isCurrentUser()?C=h.create(angular.extend({},c,{uId:a.getKey()}),!0,!0):(D=h.create(c.userDetails,!0,!1),g.fetchPresenceAndMood(a.getKey()).then(function(a){D.updateUserObj(a)})),b.resolve()):b.reject()}),b.promise}function t(b){var c=e.defer(),d=h.getUser(b);if(b=b||a.uId,d)c.resolve(d);else{var f=h.create({uId:b});g.getUserDetails({uId:b}).then(function(a){a.sucs?(f=h.create(a.userDetails),c.resolve(f)):c.reject(!1)})}return c.promise}function u(a,b){var c=h.getUser(a);return c||(c=h.create({uId:a}),g.getUserDetails({uId:a}).then(function(a){a.sucs&&(h.create(a.userDetails),b&&b.call(this))})),c}function v(a){g.getMutualFriends(a).then(function(a){a.sucs===!0&&D.updateUserObj({nmf:a.mfIDs.length})},function(){})}function w(a,b){var c;c=b?C:h.create(a),E.hasOwnProperty(c.getUtId())||(E[c.getUtId()]={workList:[],educationList:[],skillList:[]},b?g.getUserProfileData():g.getUserProfileData(c.getUtId()))}function x(a){var c=e.defer();return a||(a={iurl:C.avatar("iurl")}),a=angular.extend({},a,j.getReposition("profilephoto")),g.changeProfilePicture(a).then(function(d){d.sucs===!0?(b.updateLoginData("prIm",a.iurl),b.updateLoginData("prImId",d.imgId),C.setProfileImage(a.iurl,d.imgId),c.resolve(d)):c.reject(d)},function(a){c.reject(a)}),c.promise}function y(a){var b=e.defer();return a||(a={iurl:C.getCover("iurl")}),a=angular.extend({},a,j.getReposition("coverphoto")),g.changeCoverPicture(a).then(function(c){c.sucs?(C.setCover(angular.extend(a,{cImId:c.imgId})),b.resolve()):b.reject()},function(a){b.reject()}),b.promise}function z(){var a=e.defer();return C.resetAvatar(),g.removeProfilePicture(C.avatar("iurl")).then(function(b){b.sucs&&a.resolve()},function(b){a.reject("Profile picture removal failed")}),a.promise}function A(){var a=e.defer();return C.resetCover(),g.removeCoverPicture(C.getCover("iurl")).then(function(b){b.sucs?a.resolve():a.reject("Cover picture removal failed")}),a.promise}var B=i.SYSTEM.PROFILE,C=c.currentUser(),D={},E={},F=function(a){var b;switch(a.actn){case B.ACTION_USERS_PRESENCE_DETAILS_DATA:a.sucs===!0&&h.create(a);break;case B.TYPE_ACTION_GET_WORK:if(a.sucs===!0)for(b=0;b<a.workList.length;b++)m(a.workList[b],a.workList[b].utId);break;case B.TYPE_ACTION_GET_EDUCATION:if(a.sucs===!0)for(b=0;b<a.educationList.length;b++)l(a.educationList[b],a.educationList[b].utId);break;case B.TYPE_ACTION_GET_SKILL:if(a.sucs===!0)for(b=0;b<a.skillList.length;b++)n(a.skillList[b],a.skillList[b].utId);
}};return d.subscribe(F,{action:[B.ACTION_USERS_PRESENCE_DETAILS_DATA,B.TYPE_ACTION_GET_WORK,B.TYPE_ACTION_GET_EDUCATION,B.TYPE_ACTION_GET_SKILL]}),{init:s,getProfile:r,getUserDetailsByUId:t,getUserObjectByUId:u,getMutualFriends:v,getUserProfileData:w,changeProfilePicture:x,changeCoverPicture:y,removeProfilePicture:z,removeCoverPicture:A,updateUserProfile:g.updateProfile,savePvcEdit:g.updateUserPrivacy,submitNewEducation:g.submitNewEducation,saveAchatSetting:g.saveAchatSetting,saveAinfndreqSettings:g.saveAinfndreqSettings,saveAfamSettings:g.saveAfamSettings,saveAafSetting:g.saveAafSetting,getProfileData:p,setProfileData:o,removeProfileData:q,deleteEducation:g.deleteEducation,getAllEducation:g.getEducationData,updateEducation:g.updateEducationById,submitNewSkill:g.submitNewSkill,updateSkill:g.updateSkill,deleteSkill:g.deleteSkill,submitNewWork:g.submitNewWork,updateWork:g.updateWork,deleteWork:g.deleteWork,changePassword:g.changePassword,verifyCheck:g.verifyCheck,sendCode:g.sendCode,sendCodeToPhn:g.sendCodeToPhn,verifyCode:g.verifyCode,verifyPhnCode:g.verifyPhnCode,changePrivacy:g.changePrivacy,saveCallPvcEdit:g.saveCallPvcEdit,saveChatPvcEdit:g.saveChatPvcEdit,saveFeedPvcEdit:g.saveFeedPvcEdit,moodChange:g.moodChange,addSocialAccount:g.addSocialAccount}}angular.module("ringid.profile").service("profileFactory",a),a.$inject=["$routeParams","Storage","Auth","$$connector","$$q","Ringalert","profileHttpService","userFactory","OPERATION_TYPES","fileUploadService","utilsFactory"]}(),function(){"use strict";angular.module("ringid.chat",["ringid.config","ngWebSocket","ringid.utils","ringid.common.rgemoticon_directive","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat","angularAudioRecorder"]).config(["recorderServiceProvider",function(a){}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(){o.init(),l.init(),x(),w(),y()}a.chatAppInitiated=!1,a.boxes=c.getBoxes(),a.domBoxLength=function(){for(var b=0,c=0;c<a.boxes.length;c++)1==a.boxes[c].value.nonDomBox&&b++;return b>10?10:b},a.availableNo=c.getNumberOfAvailableChatBox(),a.getProfileLink=g.baseUrl+"/#/profile/",a.goToProfile=function(a,b){u.path(b),a.stopPropagation()},b.$on("chatOpened",function(a,b){b.sendToTab&&l.sendData(n.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE,{boxId:b.user})}),a.contactListAction=function(b){b.friend.isLoading()||(j.friendAction(b,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()}),a.$rgDigest())},a.$on(h.COMMON.WINDOW_RESIZED,function(b,d){a.availableNo=c.getNumberOfAvailableChatBox(d.x),m.safeDigest(a)}),m.onCustomEvent(h.CHAT.TAB_SYNC_NEW_DATA,function(a){a.type==n.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE?c.refreshBox(a.boxId):a.type==n.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE&&(o.loadChatBoxes(),c.openAndAddMessage(a.boxId,a.msg))});var w=function(){a.$on("NET_SUCCESS",function(){e.getUnreadMessagesMultipleTimes()}),window.addEventListener("online",function(a){window.navigator.onLine&&chatRequestProcessor.getUnreadMessagesMultipleTimes()})},x=function(){f.hasOfflineIpPort()?e.getUnreadMessagesMultipleTimes():k.doUpdateOfflineIpPort().then(function(a){e.getUnreadMessagesMultipleTimes()})},y=function(){setTimeout(function(){var a=o.getAllOpenBoxes();a&&Object.keys(a).forEach(function(b,d){var e,f=a[b];if(f.isTagChat)s.openPreviouslyOpenedBoxes(f.boxId);else{c.openChatBox(f.boxId),e=c.getBoxByUId(f.boxId);var g=o.getBox(f.boxId);angular.extend(e,g),t.requestForIp(f.boxId),e&&e.loadHistoryMessages()}})},2e3)},z=function(){b.$on("FIRST_FEED_RECEIVED",function(){a.chatAppInitiated||(a.chatAppInitiated=!0,v())}),setTimeout(function(){a.chatAppInitiated||(a.chatAppInitiated=!0,v())},6e3)};r.isLoggedIn()?z():a.$on(h.AUTH.LOGIN,function(a,b){b===!0&&z()})}angular.module("ringid.chat").controller("ChatController",a),a.$inect=["$scope","$rootScope","ChatFactory","ChatHelper","tagOfflineChatManager","chatUtilsFactory","settings","SystemEvents","PacketDataParse","friendsFactory","ChatPacketSenderService","chatTabSync","utilsFactory","CHAT_GENERAL_CONSTANTS","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","PullerSubscriber","$location"],a.$inject=["$scope","$rootScope","ChatFactory","ChatHelper","tagOfflineChatManager","chatUtilsFactory","settings","SystemEvents","PacketDataParse","friendsFactory","ChatPacketSenderService","chatTabSync","utilsFactory","CHAT_GENERAL_CONSTANTS","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","PullerSubscriber","$location"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.selectedLeftBox={key:0,messages:[]},a.boxes=m.createNew(!0),a.recentMessages=m.createNew(!0),a.ready=b.chatHistoryReady||!1,a.selectLeftBox=function(b){a.selectedLeftBox=b};var p=function(a){var b=a-k.serverTimeDiff,c=i.verbalDate(b);return c};a.getMessageTime=p;var q=function(b,c){c&&(b.user=f.getUserObjectByUId(c,function(){a.$rgDigest()}))},r=function(a){return a.statusType?"Activity message.":a.messageType==l.MESSAGE_TYPES.PLAIN_MESSAGE?a.text:"Received media message."},s=function(a){return"Unread"==a.status?!0:"Received"==a.status&&!a.seenSent},t=function(a){return j.getUnreadMessageCountByBoxId(a.key)},u=function(a){var b=angular.copy(a);return b.date=p(b.messageDate),b.isUnread=function(){return s(b)},b.messageText=function(){return r(b)},b.user.getKey&&q(b,b.user),b.isSelf=function(){return a.userId==e.currentUser().getKey()},b},v=function(a){var b=!1;return a.messages&&a.messages.length>0&&(a.messages.sort(function(a,b){return a.messageDate>b.messageDate?1:a.messageDate<b.messageDate?-1:0}),b=a.messages[a.messages.length-1]),b},w=function(b){var c=j.getChatBoxes(),d=c[b],e=a.boxes.get(b);if(e){e.messages=d.messages;var f=v(e);f&&(e.lastMessage=u(f))}},x=function(a){var b=angular.copy(a),c=v(b);if(c&&(b.lastMessage=u(c)),b.unreadCount=function(){return t(a)},b.sortBy=function(){return this.lastMessage.messageDate},b.isTagChat){var d=a.key;g.getTag(d);b.getTitle=function(){var a=g.getTag(d);return a?a.getTagName():""},b.getCover=function(){var a=g.getTag(d);return a?a.getPictureFullUrl():""},b.shouldVisible=function(){var a=g.getTag(d);return a?a.isTagSafeToShow():!1}}else q(b,b.key),b.getTitle=function(){return b.user.getName()},b.getCover=function(){return b.user.avatar("thumb")},b.shouldVisible=function(){return!0};return b};a.initBoxMessages=function(b){b.messages&&angular.forEach(b.messages,function(b,c){var b=u(b);a.recentMessages.add(b.key,b)})},a.initRecentMessages=function(){var b=(e.currentUser().getKey(),j.getChatBoxes());b&&angular.forEach(b,function(b,c){var d=x(b);d.lastMessage&&a.boxes.add(b.key,d)})},a.clearRecentMessages=function(){a.recentMessages.clear()},a.openChatBox=function(a,b){i.triggerCustomEvent(n.CHAT.UNREAD_MESSAGE_INFO_UPDATED),b?c.openTagChatBox(a):c.openChatBox(a)},a.initRecentMessages(),b.chatHistoryReady||setTimeout(function(){a.ready=!0,b.chatHistoryReady=!0,a.$rgDigest(),o.recalculate(a)},3e3);var y=i.onCustomEvent("MY_TAG_LIST_RECEIVED",function(){a.$rgDigest()}),z=i.onCustomEvent("taglistupdated",function(){a.$rgDigest()}),A=i.onCustomEvent(n.CHAT.MESSAGE_RECEIVED,function(b){w(b.boxId),a.$rgDigest()}),B=i.onCustomEvent(n.CHAT.MESSAGE_SUBMITTED,function(b){w(b.boxId),a.$rgDigest()});a.$on("$destroy",function(){i.removeCustomEvent("MY_TAG_LIST_RECEIVED",y),i.removeCustomEvent("taglistupdated",z),i.removeCustomEvent(n.CHAT.MESSAGE_SUBMITTED,B),i.removeCustomEvent(n.CHAT.MESSAGE_RECEIVED,A)})}angular.module("ringid.chat").controller("ChatHistoryController",a),a.$inject=["$scope","$rootScope","ChatFactory","Storage","Auth","profileFactory","tagChatFactory","userFactory","utilsFactory","chatHistoryFactory","CHAT_GLOBAL_VALUES","TAG_CHAT_GENERAL_CONSTANTS","$$stackedMap","SystemEvents","rgScrollbarService"]}(),function(){"use strict";function a(a,b,c,d,e){a.navSection=0,a.sendMedia=function(){if(a.capturedMedia&&e.boxId){var f=b.queueFile("chatimage",c.dataURLToBlob(a.capturedMedia));c.triggerCustomEvent("BOX_CAM_UPLOAD",{uploadFile:f,boxId:e.boxId}),d.close()}}}angular.module("ringid.chat").controller("ChatMediaUploadController",a),a.$inject=["$scope","fileUploadService","utilsFactory","$boxInstance","localData"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){try{return e[a].NAME}catch(b){}}var i=function(b){return b=a.parseForLE(b,0)},j=function(){var a=g.loginData,b={ip:"",port:""};return a&&(b.ip=a.oIP,b.port=a.oPrt),b},k=function(){var a=j();return!(!a||!a.ip||!a.port)},l=function(){return parseInt((new Date).getTime()+f.serverTimeDiff)};return{parseForLE:function(a){return i(a)},getChatServerCurrentTime:l,getOfflineIpPort:j,hasOfflineIpPort:k,getChatStateName:h}}var b;try{b=angular.module("ringid.chat")}catch(c){}b.factory("chatUtilsFactory",a),a.$inject=["utilsFactory","settings","CHAT_STATES","CHAT_FLOWS","CHAT_STATE_INFO","CHAT_GLOBAL_VALUES","Auth"]}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){}a.factory("ChatFactory",["settings","CHAT_PACKET_FORMAT","ChatPacketSenderService","Storage","$window","$$stackedMap","ChatMap","Auth","utilsFactory","$rootScope","PacketDataParse","$timeout","globalSocketFactory","chatHistoryFactory","profileHttpService","userFactory","friendsFactory","tagChatPacketProcessor","tagChatApiService","tagChatFactory","$interval","$$connector","OPERATION_TYPES","CHAT_GLOBAL_VALUES","AUTH_SERVER_ACTIONS","CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","chatPacketResender","ChatApiService","PLATFORM","profileFactory",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G){var H=(D.ChatPacketSender,t.getUUIDPacketId),I=f.createNew(),J=function(a){if(a)var b=a-400-165;else var b=i.viewport.x-400-165;var c=e.parseInt(b/310);return c},K=function(a){var b=a.friendName.split(",")[0],c=N(b);if(angular.isArray(a.messageList))for(var d=0;d<a.messageList.length;d++)c.pushMessage(a.messageList[d])},L=function(a){var b={key:a,isMinimized:!1,isHidden:!1,isFocused:!1,blinkOn:!1,timeout:5,secretChat:!1,nonDomBox:!1,closedBox:!1,offlineStatus:!1,blocked:!1,isSecretVisible:!0,singlePage:!1,lastSeenBar:!0,unreadCount:0,chatBoxClass:"chat-body-opened"};return b},M=function(a,b,c){a=a.toString(),c||(c={});var d=I.get(a);if(d!==!1)return d;d=g.create(a,b),b||(G.getUserObjectByUId(a),o.fetchPresence([a]));var e=L(a);return e.isFocused=!0,e.nonDomBox=!0,e.isTagChat=b,e.lastLogin=d.getUser()&&d.getUser().lastOnline?d.getUser().lastOnline():"",e=angular.extend(d,e,c)},N=function(a,b){var c=M(a,b);return I.save(a,c),n.addBox(c),c},O=function(a,b){a=a.toString();var c=I.get(a);c===!1?(c=N(a,!1),j.$broadcast("chatOpened",{user:a,sendToTab:b})):(c.nonDomBox||j.$broadcast("chatOpened",{user:a,sendToTab:b}),c.isFocused=!0,c.nonDomBox=!0,c.blinkOn=!1,n.updateBox(c))},P=function(a,b){a=a.toString();var c=I.get(a);if(c===!1?(c=N(a,!0),j.$broadcast("chatOpened",{user:a,sendToTab:b})):(c.nonDomBox||j.$broadcast("chatOpened",{user:a,sendToTab:b}),c.isFocused=!0,c.nonDomBox=!0,c.blinkOn=!1,n.updateBox(c)),t.isTagRegistered(a)){var d=t.getTag(a);c.setIp(d.getChatIp()),c.setRPort(d.getChatRegisterPort()),c.setPort(d.getChatBindingPort()),c.lastCommunicationTime=d.getLastCommunicationTime(),c.initInterval()}return c},Q=function(a,b){a=a.toString();var c=g.create(a,b),d=L(a);return d.closedBox=!0,d.isTagChat=b,d=angular.extend(c,d),I.save(a,d),n.addBox(d),c},R=function(a){a=a.toString();var b=I.get(a);b!==!1&&(I.remove(a),I.save(a,b))},S=function(a){a=a.toString();var b=I.get(a);b.closedBox=!0,n.updateBox(b),b.getIp()&&c.sendChatUnRegisterPacket(b),b.stopInterval(),I.remove(a)},T=function(a){a=a.toString();var b=I.get(a);b.closedBox=!0,n.updateBox(b),b.stopInterval(),I.remove(a)},U=function(a){a=a.toString();var b=I.get(a);b.isMinimized=!b.isMinimized,b.isMinimized?(b.isFocused=!1,b.chatBoxClass="chat-body"):(b.isFocused=!0,b.chatBoxClass="chat-body-opened"),n.updateBox(b)},V=function(a){n.loadChatBoxes();var b=n.getBox(a),c=I.get(a);if(c)b.closedBox?I.remove(a):(angular.extend(c,b),c.loadHistoryMessages());else if(!b.closedBox){var d=M(a,b.isTagChat,b);I.save(a,d),d.loadHistoryMessages()}},W=function(a,b){if(b){var c=h.currentUser(),d=I.get(a);if(d)d.nonDomBox=!0,d.pushMessage(b,c);else{if(b.tag_chat){var e=t.getTag(a);e.isTagSafeToShow()&&P(a)}else O(a);d=N(a,b.tag_chat),d.loadHistoryMessages()}i.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:a,scroll:"bottom"})}};return{openChatBox:function(a,b){O(a,b)},openTagChatBox:P,closeTagChatBox:T,creatNonDomBox:Q,makeVisibleChatBox:R,processInMessage:K,closeChatBox:S,getBoxes:function(){return I.all()},ggg:function(){return I.nonClosedLength()},getBoxByUId:function(a){return I.get(a)},refreshBox:V,minimizeBox:U,getNumberOfAvailableChatBox:function(a){return J(a)},getNonClosedLength:function(){return I.nonClosedLength()},increaseUnreadMessageCount:function(a,b){n.addUnreadMessageInfo(a,b),n.updateUnreadMessageInfos()},decreaseUnreadMessageCount:function(a,b){n.removeUnreadMessageInfo(a,b),n.updateUnreadMessageInfos()},getUnreadMessageCount:function(){return n.getUnreadMessageCount()},getUUIDPacketId:H,openAndAddMessage:W}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c){var d=g.constructPacket(a,b,c);return d}function o(a,b){}var p=i.getUUIDPacketId,q=this;q.getFriendOnlineStatus=function(c){var d={actn:b.SYSTEM.PROFILE.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:c};return a.request(d,b.SYSTEM.REQUEST_TYPE.REQUEST)},q.requestForIp=function(d){var e={actn:175,fndId:d,uId:c.loginData.uId};o("AUTH "+e.actn,e),a.send(e,b.SYSTEM.REQUEST_TYPE.CHAT)},q.getRegisterForFriendChatRequestObject=function(a,b,c,e){var f={ip:a,port:b,packetType:d.FRIEND_CHAT_REGISTER,packetId:i.getUUIDPacketId(),userId:c,friendId:e,platform:k.WEB};return f};q.getBlankMessageObject=function(a){var b=m.getOfflineIpPort(),e=c.currentUser().getKey(),f=m.getChatServerCurrentTime(),g=p(f),i=h.MESSAGE_TYPES.BLANK_MESSAGE,j=d.FRIEND_CHAT_MSG,l={ip:b.ip,port:b.port,packetType:j,userId:e,friendId:a,tag_chat:!1,messageType:i,message:"",messageDate:f,key:g,packetId:g,timeout:0,platform:k.WEB};return l},q.getFriendInformationPacketObject=function(a,b,d,f,g,h,i){var j=m.getOfflineIpPort(),k=c.currentUser().getKey(),l=m.getChatServerCurrentTime(),n=p(l),o=e.OFFLINE_FRIEND_INFORMATION,q={ip:j.ip,port:j.port,packetType:o,userId:k,friendId:a,packetId:n,fullName:b,platform:d,onlineStatus:f,friendAppType:g,friendDeviceToken:h,userMood:i};return q},q.getIdlePacketObject=function(a){var b=a.getIp(),e=a.getPort(),f=c.currentUser().getKey(),g=a.getKey(),h=m.getChatServerCurrentTime(),i=p(h),j=d.FRIEND_CHAT_IDLE,l={ip:b,port:e,packetType:j,userId:f,friendId:g,packetId:i,platform:k.WEB};return l},q.getTypingPacketObject=function(a){var b=a.getIp(),e=a.getPort(),f=c.currentUser().getKey(),g=a.getKey(),h=m.getChatServerCurrentTime(),i=p(h),j=d.FRIEND_CHAT_TYPING,l={ip:b,port:e,packetType:j,userId:f,friendId:g,packetId:i,platform:k.WEB};return l},q.getF2FUnRegisterObject=function(a){var b=a.getIp(),e=a.getPort(),f=c.currentUser().getKey(),g=a.getKey(),h=m.getChatServerCurrentTime(),i=p(h),j=d.FRIEND_UNREGISTER_PKT,k={ip:b,port:e,packetType:j,packetId:i,userId:f,friendId:g,onlineStatus:0,userMood:0};return k},q.getF2FMessageDeleteObject=function(a,b){var e=a.getIp(),f=a.getPort(),g=c.currentUser().getKey(),h=m.getChatServerCurrentTime(),i=a.getKey();d.FRIEND_CHAT_TYPING;if(1==a.offlineStatus){var j=m.getOfflineIpPort();e=j.ip,f=j.port}var l={ip:e,port:f,packetId:b,packetType:d.FRIEND_CHAT_MULTIPLE_MSG_DELETE,userId:g,friendId:i,noOfMessages:1,packetIds:[b],messageDate:h,platform:k.WEB};return l},q.getOfflineIpPort=function(){var d=c.currentUser().getKey(),e={actn:j.GET_OFFLINE_IP_PORT,rid:d};return a.request(e,b.SYSTEM.REQUEST_TYPE.REQUEST)},q.sendViaGlobalChatSocket=function(a,b){var c=n(a,b.PACKET_TYPE,b.FORMAT);return c&&f.send(c),4!=b.PACKET_TYPE&&5!=b.PACKET_TYPE&&o(b.PACKET_NAME,a),c}}angular.module("ringid.chat").service("ChatApiService",a),a.$inject=["$$connector","OPERATION_TYPES","Auth","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","globalSocketFactory","PacketDataParse","CHAT_GENERAL_CONSTANTS","tagChatFactory","AUTH_SERVER_ACTIONS","PLATFORM","utilsFactory","chatUtilsFactory"]}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){}a.factory("ChatMap",["$$stackedMap","$interval","CHAT_PACKET_FORMAT","globalSocketFactory","userFactory","utilsFactory","$websocket","$rootScope","$sce","Auth","tagChatFactory","profileFactory","chatHistoryFactory","PacketDataParse","settings","tagChatApiService","TAG_CHAT_GENERAL_CONSTANTS","tagChatHelper","tagChatStorage","CHAT_GLOBAL_VALUES","CHAT_GENERAL_CONSTANTS","chatUtilsFactory","rgScrollbarService","chatTabSync","ChatPacketSenderService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=function(a){var b=a.key||a.packetId,c=a.messageDate||(new Date).getTime(),d={key:b.toString(),packetId:b.toString(),text:a.message||a.mg||a.text,hrtime:f.chatVerbalDate(c),status:a.status||0,fullName:a.fullName,tagName:a.tagName||"",messageDate:c,isDeleted:!1,messageDateString:a.messageDateString||"",timeout:a.timeout,messageType:a.messageType,tag_chat:a.tag_chat||!1,seenSent:a.seenSent||!1,isSecretVisible:a.isSecretVisible,secretTimedOut:a.secretTimedOut?a.secretTimedOut:!1,lastUpdateTime:(new Date).getTime(),platform:5};return a.tag_chat?(d.packetType=a.packetType||63,d.brokenPacketType=a.brokenPacketType):(d.packetType=a.packetType||6,d.brokenPacketType=a.brokenPacketType),d};return{create:function(c,d){var j,n,p,q,s,w=c;d?(q=c,p=k.getTag(q)):s=e.create({uId:c});var A,B,C,D,E,F=!1,G=!1,H=null,I=0,J=[],K=[],L=a.createNew(!0,"asc"),M=function(a,b,d){var e;if(a.type&&101===a.type)return void(F=!0);if(0==a.type&&0===a.status)return e=L.get(L.packetId),void(e.isDeleted=!0);var g="",h=z(a);angular.isObject(b)||(b=l.getUserObjectByUId(a.userId,function(){f.triggerCustomEvent("SINGLE_MESSAGE_UPDATED",{message:h})}));var j={locationInfo:{},ogData:{},seenUserIds:{},deliveredUserIds:{},user:b,sortBy:function(){return a.messageDate},getTextPartition:function(){return g},setTextPartition:function(){g=v.parseForLE(j.text),g=i.trustAsHtml(g)},getMessageTime:function(){var b=a.messageDate-t.serverTimeDiff,c=f.chatVerbalDate(b);return c},seenUsersCount:function(){return Object.keys(j.seenUserIds).length},deliveredUsersCount:function(){return Object.keys(j.deliveredUserIds).length},addSeenUserId:function(a){j.seenUserIds[a]=!0},addDeliveredUserId:function(a){j.deliveredUserIds[a]=!0},updateLocationInfo:function(){var a,b,c;try{a=angular.fromJson(j.text),b=a.la,c=a.lo,j.locationInfo={lat:b,"long":c,description:a.loc},j.plainText=a.loc}catch(d){}},updateLinkShareInfo:function(){j.ogData={};try{var a=angular.fromJson(j.text);j.ogData={lnkDmn:a.u,description:a.d,title:a.t,url:a.u,image:a.i,message:a.m},j.plainText=a.m}catch(b){}},updateMediaInfo:function(){var a;try{a=angular.fromJson(j.text),j.mediaInfo={url:a.u,caption:a.c,width:a.w,height:a.h},j.plainText=a.c}catch(b){}}};if(angular.extend(j,h),a.userId=j.userId=j.user.getKey(),a.usersToChange&&(j.usersToChange=a.usersToChange),a.statusType&&(j.statusType=a.statusType),"status_update"!==a.status)if(1!=a.secretTimedOut&&"Deleted"===a.status)j.messageType=2,g=v.parseForLE(j.text);else switch(a.messageType){case u.MESSAGE_TYPES.TEXT:g=v.parseForLE(j.text);break;case u.MESSAGE_TYPES.LOCATION_SHARE:j.updateLocationInfo();var k=j.locationInfo.lat,n=j.locationInfo["long"];0!=k&&0!=n?(j.mapStaticUrl=f.getGoogleMapStaticUrl(k,n),j.mapJsUrl=f.getGoogleMapJSUrl(k,n)):g=v.parseForLE(j.text);break;case u.MESSAGE_TYPES.LINK_SHARE:j.updateLinkShareInfo();break;case u.MESSAGE_TYPES.STICKER:j.stickerUrl=o.stickerBase+j.text;break;case u.MESSAGE_TYPES.IMAGE:case u.MESSAGE_TYPES.CAMERA_IMAGE:j.updateMediaInfo();try{j.mediaUrl=o.imBase+j.mediaInfo.url}catch(p){j.mediaUrl=""}g="";break;case u.MESSAGE_TYPES.AUDIO:j.updateMediaInfo(),j.isVideo=!1;try{j.mediaUrl=o.mediaBase+j.mediaInfo.url}catch(p){j.mediaUrl=""}break;case u.MESSAGE_TYPES.VIDEO:j.updateMediaInfo(),j.isVideo=!0;try{j.mediaUrl=o.mediaBase+j.mediaInfo.url}catch(p){j.mediaUrl=""}break;default:g=v.parseForLE(j.text)}else if(a.usersToChange&&(g=r.getTagChatStatusMessage(a),!g))return;g=i.trustAsHtml(g),L.save(j.key,j),a.fromLocalHistory||Q(j);var q=c.toString();m.addMessage(j,q),d&&x.sendData(u.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:q,msg:h,isTagChat:a.tag_chat})},N=function(a,b){var c=a.key||a.packetId,d=a.messageDate-t.serverTimeDiff||(new Date).getTime(),g=[],h={key:c,text:a.message||a.mg||a.text,hrtime:f.chatVerbalDate(d),status:a.status||0,messageType:a.messageType,uploading:a.uploading,uploadProgress:a.uploadProgress,messageDate:d,isDeleted:!1,messageDateString:a.messageDateString||"",mediaUrl:a.mediaUrl,timeout:a.timeout,isSecretVisible:a.isSecretVisible,user:angular.isObject(b)?b:e.getUser(a.userId),lastUpdateTime:(new Date).getTime(),sortBy:function(){return a.messageDate},getTextPartition:function(){return g},setTextPartition:function(){g=v.parseForLE(h.text),g=i.trustAsHtml(g)}};g=v.parseForLE(h.text),g=i.trustAsHtml(g),L.save(h.key,h)},O=function(a,b){},P=function(a){C&&C.socket===!0&&C.close(!0),C=g("ws://"+A+":"+B+"/"+a+"/"+f.getToken),C.socket.binaryType="arraybuffer",C.onMessage(function(a){h.$broadcast("chatDataReceived",{box:j,messageEvent:a})}),C.onClose(function(a){})},Q=function(a){var b=j,c=a.key||a.packetId;if("status_update"==a.status)try{c=c.split("_")[0]}catch(d){}b.messageMaxDate<a.messageDate&&(b.messageMaxDate=a.messageDate,b.messageMaxPacketId=c),(!b.messageMinDate||b.messageMinDate>=a.messageDate)&&(b.messageMinDate=a.messageDate,b.messageMinPacketId=c)};return j={ip:A,port:B,rPort:D,isTagChat:!1,lastCommunicationTime:I,waitingTime:160,tempMessageArray:J,tempSeenMessageArray:K,boxTitle:"",unreadCount:0,messageMaxPacketId:"",messageMinPacketId:"",messageMaxDate:0,messageMinDate:0,hasHistoryMessage:!1,messages:L.all(),getTitleString:function(){var a=j,b=a.getTitle();return d||b||(b=a.getKey()),a.unreadCount>0&&(b=b+" ("+a.unreadCount+")"),b},updateUnreadCount:function(){var a=j;a.unreadCount=m.getUnreadMessageCountByBoxId(w)},getProfileLink:function(){var a=j;return a.isTagChat?void 0:"/profile/"+a.getUser().getKey()},checkWaitingTimePassed:function(){var a=Math.floor(Date.now()/1e3);return a-this.lastCommunicationTime>this.waitingTime},hasIpPort:function(){return!!j.ip&&!!j.port},updateLastCommunicationTime:function(){j.lastCommunicationTime=Math.floor(Date.now()/1e3)},pushMessage:function(a,b,c){M(a,b,c)},pushDummyMessage:function(a,b){N(a,b)},sendTabUpdate:function(a){var b=z(a);x.sendData(u.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:w,msg:b,isTagChat:a.tag_chat})},processMessage:function(a,b){O(a,b)},getKey:function(){return c.toString()},getTagItem:function(){return p},getUser:function(){return p?p:s},getTitle:function(){return p?this.boxTitle=p.getTagName():s&&(this.boxTitle=s.getName()),this.boxTitle},setTitle:function(a){this.boxTitle=a},isConsicutive:function(a){var b=L.get(a),c=L.previous(a);return!(!c||"status_update"==c.status||c.user.getKey()!==b.user.getKey())},isSamePacketId:function(a){return!!L.get(a.toString())},getMessages:function(){return L.all()},getMessage:function(a){return L.get(a.toString())},getBottomMessage:function(){return L.bottom()},getTopMessage:function(){return L.top()},removeMessage:function(a){L.remove(a.toString())},updateMessageStatus:function(a,b){var c=L.get(a);return c?(c.status=b,c):!1},isTyping:function(){return F},setTypingBool:function(a){F=a},isFriendTyping:function(){return G},setFriendTypingBool:function(a){G=a},setAfterRegisterIntervalKey:function(a){H=a},getAfterRegisterIntervalKey:function(){return H},clearAfterRegisterInterval:function(){H&&clearInterval(H)},setIp:function(a){this.ip=a},getIp:function(){return this.ip},setPort:function(a){this.port=a},getPort:function(){return this.port},setRPort:function(a){this.rPort=a},getRPort:function(){return this.rPort},setIpPort:function(a,b,c){A=a,B=b,P(c)},setRegisterConnection:function(a){E=a},connect:function(){return C=g("ws://"+A+":"+B)},getConnection:function(){return C},getRConnection:function(){return E},isBoxBindingPortValid:function(){var a=j,b=Math.floor(Date.now()/1e3)-a.lastCommunicationTime;return b>10&&b<a.waitingTime},getRemainingRegisteredTime:function(){var a=j;return a.waitingTime-(Math.floor(Date.now()/1e3)-a.lastCommunicationTime)},initInterval:function(){n&&this.stopInterval(),n=b(function(){var a=j,b=Math.floor(Date.now()/1e3),c=b-a.lastCommunicationTime;c>10&&c<a.waitingTime?y.sendIdlePacket(a):c>a.waitingTime&&a.stopInterval()},15e3)},stopInterval:function(){angular.isDefined(n)&&b.cancel(n)},startTimer:function(){var a=j,c=a.getMessages();if(angular.isArray(c)&&c.length>0)for(var d=0;d<c.length;d++)if(c[d].value.timeout>0&&0==a.isMinimized&&0==a.isHidden&&!c[d].value.timerStartFlag)switch(c[d].value.messageType){case 2:case 3:case 4:case 5:case 6:var e=c[d].value.timeout,f=c[d].value;f.key=f.packetId,c[d].value.timerStartFlag=!0;var g=function(a,b){h.$broadcast("timeoutDelete",a.key,b)};!function(a,c){b(function(){g(a,c--)},1e3,c+1)}(f,e)}},send:function(a){C&&(1!==C.readyState||C.socket.send(a))},rSend:function(a){E.socket.send(a)},updateBoxMessageMinMaxPacketId:Q,loadHistoryMessages:function(){var a=j,b=m.getMessages(w);if(b)for(var c=0;c<b.length;c++){var d=b[c];Q(d),d.fromLocalHistory=!0,M(d,l.getUserObjectByUId(d.user))}a.updateUnreadCount(),f.triggerCustomEvent("CHAT_HISTORY_LOADED",{boxId:w})}}}}}])}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){a=angular.module("ringid.chat",["ringid.config","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}a.factory("globalSocketFactory",["settings","$websocket","utilsFactory","PacketDataParse","$rootScope","$timeout","tagChatPacketProcessor",function(a,b,c,d,e,f,g){var h,i=function(a){};return{initiate:function(){if(angular.isObject(h))return void(h.isOpen()||0===h.readyState||h.reconnect());try{h=b(a.socketProtocol+a.siteUrl+"/ChatSocket"),h.onError(function(a){}),h.onClose(function(a){}),h.onOpen(function(){}),h.onMessage(function(a){var b=ArrayBuffer.prototype.slice.call(a.data,8);d.getPacketType(b);e.$broadcast("chatDataReceived",{byteData:b})})}catch(c){}},send:function(a){var b=function(a){if(h&&h.isOpen())i(a),h.send(a);else try{h.send(a)}catch(b){}};h&&h.isOpen()?b(a):(this.initiate(),f(b.bind(null,a),2e3,!0))},gs:function(){return h},reConnect:function(){h.isOpen()||h.reConnect()}}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){}function r(){}function s(a,b){b?a.unreadCount-b>0?a.unreadCount-=b:a.unreadCount-b<0?a.unreadCount=0:a.unreadCount=0:t(a),o.updateBox(a),o.removeUnreadMessageInfoByBoxId(a.getKey()),n.triggerCustomEvent("SINGLE_BOX_UPDATED",{box:a})}function t(a){a.unreadCount=0}function u(a,b){a&&a.isFocused===!1&&(a.unreadCount+=b)}function v(a,b){if(a&&b.key){a.removeMessage(b.key),o.removeMessage(b.key,a.getKey());for(var c=a.getMessages(),d=0,e=c.length;e>d;d++)c[d].value.showDate=c[d].value.takeDecisionForShowingDate(),c[d].value.showAvator=c[d].value.takeDecisionForShowingMessageUserAvator();n.triggerCustomEvent("SINGLE_BOX_UPDATED",{box:a})}}function w(a,b){if(!(b.length<1))for(var c=0,d=b.length;d>c;c++)if(b[c].value.timeout>0&&!b[c].value.timerStartFlag)switch(b[c].value.messageType){case 2:case 3:case 4:case 5:case 6:var e=b[c].value.timeout,f=b[c].value;b[c].value.timerStartFlag=!0;var g=function(b,c){a.$broadcast("timeoutDelete",b.key,c)};!function(a,b){i(function(){g(a,b--)},1e3,b+1)}(f,e)}}function x(a,b){if(b[0].value&&b[0].value.timeout>0&&!b[0].value.timerStartFlag)switch(b[0].value.messageType){case 7:case 8:case 9:case 10:var c=b[0].value.timeout,d=b[0].value;b[0].value.timerStartFlag=!0;var e=function(b,c){a.$broadcast("timeoutDelete",b.key,c)};!function(a,b){i(function(){e(a,b--)},1e3,b+1)}(d,c)}}function y(a,c){c||(c=b.getBoxByUId(a)),c.checkWaitingTimePassed()&&(c.isTagChat?k.requestForIp(a):l.requestForIp(a))}function z(a,c){C(a).then(function(d){c||(c=b.getBoxByUId(a)),d.sucs&&d.psnc==j.USER_PRESENCE.ONLINE?c.offlineStatus=!1:c.offlineStatus=!0})}function A(a,b,c,d,h){var i={ip:a,port:b,packetType:18,packetId:h,userId:c,friendId:d,platform:5},j=e.constructPacket(i,18,f.SEEN_PKT_CONFIRM.FORMAT);j&&g.send(j)}function B(a,b,c,d){var h=m.getRegisterForFriendChatRequestObject(a,b,c,d),i=e.constructPacket(h,1,f.REGISTER_PKT.FORMAT);i&&g.send(i)}function C(a){return m.getFriendOnlineStatus(a)}function D(a,c){return c||(c=b.getBoxByUId(a)),!c.checkWaitingTimePassed()}function E(b,c,d,e){if(e)c.call(null,d);else{var f=function(e){e.data.friendId.toString()===b.toString()&&(c.call(null,d),document.removeEventListener(a.CHAT.CHAT_REGISTER,f))};document.addEventListener(a.CHAT.CHAT_REGISTER,f)}}function F(a,d){d||(d=b.getBoxByUId(a));var e=0,f=1,g=1,h=setInterval(function(){f>15&&(clearInterval(h),d.initInterval()),e&&e!=g||(c.sendIdlePacket(d),f++,g+=f),e++},1e3)}function G(a,c){c||(c=b.getBoxByUId(a)),c&&c.loadHistoryMessages()}return{executeAfterRegisterEvent:E,hasChatFriendSession:D,getOnlineStatus:C,getOfflineUpdateTime:q,setOfflineUpdateTime:r,updateFriendPresence:z,registerForFriendChat:B,sendChatSeenConfirmation:A,updateBoxSessionIfRequired:y,sendAfterRegisterIdlePacket:F,startTimerText:w,startTimerOthers:x,decreaseUnreadCount:s,increaseUnreadCount:u,deleteMessageFromOwn:v,loadHistoryMessageForF2FChat:G}}angular.module("ringid.chat").factory("ChatHelper",a),a.$inject=["SystemEvents","ChatFactory","ChatPacketSenderService","OPERATION_TYPES","PacketDataParse","CHAT_PACKET_FORMAT","globalSocketFactory","Auth","$interval","CHAT_GENERAL_CONSTANTS","tagChatManager","PullerSubscriber","ChatApiService","utilsFactory","chatHistoryFactory","profileFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=l.executeAfterTagRegisterEvent,s=h.registerTag,t=k.USER_PRESENCE,u=m.ChatPacketResender,v=m.ChatPacketSender,w=function(b,c){if(!(c.length<1)){var f=e.loginData.uId,g=B(c),h=b.isTagChat;if(h){var i=b.getKey(),k=s(i,1);r(i,function(){z(f,i,g)},null,!k)}else{var l=b.getKey(),m=d.getUniqueID("cseen"),n=b.offlineStatus,o=!1,p=j.hasChatFriendSession(l,b);p?n?D(l,g,m):C(b.ip,b.port,l,g,m):a.requestForIp(l,!0).then(function(a){o||(a.sucs===!0&&a.psnc==t.ONLINE?(j.registerForFriendChat(b.ip,b.rPort,f,l),j.executeAfterRegisterEvent(l,function(){o=!0,C(b.ip,b.port,l,g,m)},null,p)):D(l,g,m))})}}},x=function(a,d){for(var e=b.getBoxByUId(a),f=[],g=0;g<d.length;g++)if(e){var h=e.getMessage(d[g].key);h&&(h.seenSent=!0,f.push(h))}c.updateMessages(f,a)},y=function(a,b,c,d){var e;e=new u,e.setPacketType(p.TAG_CHAT_SEEN),e.setPacketId(c),e.on("send",function(){f.sendTagMsgSeenPacket(a,d,b,c)}),e.start()},z=function(a,b,c){var d=g.getTag(b),f=e.loginData.uId;if(d){for(var h=0;h<c.length;h++){var i=c[h].key,j=c[h].senderId;try{y(f,j,i,d)}catch(k){}}x(b,c)}},A=function(a,b,c,d,f){for(var g=o.defer(),h={ip:a,port:b,packetId:f,packetType:17,userId:e.loginData.uId,friendId:c,messages:[],platform:5},j=parseInt((new Date).getTime()+i.serverTimeDiff),k=0;k<d.length;k++)h.messages[k]={packetId:d[k].key,messageDate:j,status:E(d[k].messageType)};var l,m;return l=new v,l.setPacketObject(h),l.setBrokenPacketType(n.FRIEND_CHAT_SEEN),m=l.getInstance(),m.on("success",function(a){x(c,d),g.resolve("success")}),m.on("failure",function(a){g.reject("failed")}),m.start(),g.promise},B=function(a){for(var b=[],c=0;c<a.length;c++)b.push({key:a[c].key,messageType:a[c].value.messageType,senderId:a[c].value.user.getKey()});return b},C=function(a,b,c,d,e){A(a,b,c,d,e).then(function(){},function(){D(c,d,e)})},D=function(a,b,c){var d=q.getOfflineIpPort(),e=d.ip,f=d.port;A(e,f,a,b,c)},E=function(a){var b=0;switch(a){case 2:case 3:case 4:case 5:case 6:b=k.MESSAGE_STATUS.SEEN;break;
case 7:case 8:case 9:case 10:b=k.MESSAGE_STATUS.VIEWED}return b};return{sendSeenPacket:w}}angular.module("ringid.chat").factory("ChatSeenSend",a),a.$inject=["PullerSubscriber","ChatFactory","chatHistoryFactory","utilsFactory","Auth","tagChatApiService","tagChatFactory","tagChatManager","CHAT_GLOBAL_VALUES","ChatHelper","CHAT_GENERAL_CONSTANTS","tagChatHelper","chatPacketResender","FRIEND_CHAT_PACKET_TYPE","$q","TAG_CHAT_PACKET_TYPE","chatUtilsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=m.ChatPacketResender,p=i.USER_PRESENCE,q=function(a){var b=k.getFriendInformationPacketObject(a.getUId(),a.getName(),a.getPlatform(),a.getOnlineStatus(),a.getAppType(),a.getDeviceToken(),a.getUserMood());l.sendViaGlobalChatSocket(b,b.packetType)},r=function(a){j.sendBlankMessage(a)},s=function(a){var c=b.getBoxByUId(a);return c||(c=b.creatNonDomBox(a,!1),c.loadHistoryMessages()),c},t=function(a,b,c,d){var e=k.getRegisterForFriendChatRequestObject(a,b,c,d),f=new o;f.setPacketType(e.packetType),f.setPacketObject(e),f.on("failure",function(a){var b=s(c);j.sendTemporaryMessages(b,!0)}),f.start()},u=function(){e.subscribe(function(a){if(1111!=a.rc){var b=a,e=b.fndId,h=s(e);if(h.platform=b.dvc,a.actn!=n.RECEIVED_F2F_CHAT||e!=d.currentUser().getKey()){var i=c.create({uId:b.fndId,utId:b.utId,fn:b.nm});f.getContactDetailsByUtIds([b.utId]);var k=i.getOnlineStatus();if(i.setOnlineStatus(b.psnc),b.mood&&i.setUserMood(b.mood),b.dt&&i.setDeviceToken(b.dt),b.apt&&i.setAppType(b.apt),b.dvc&&i.setPlatform(b.dvc),k!=i.getOnlineStatus()&&q(i),b.sucs===!0&&b.psnc==p.ONLINE){var l=b.chIp,m=parseInt(b.chRp),o=d.loginData.uId;h.setIp(l),h.setRPort(m),h.offlineStatus=!1,t(l,m,o,e),g.updateBox(h)}else 1==b.rc?h.blocked=!0:(h.offlineStatus=!0,b.psnc==p.OFFLINE&&r(e),j.sendTemporaryMessages(h,!0)),g.updateBox(h)}}},{action:[175,375]})}(),v=function(b,c){var f={actn:175,fndId:b,uId:d.loginData.uId};if(c){var g=h.defer();return e.request(f,a.SYSTEM.REQUEST_TYPE.CHAT).then(function(a){1111==a.rc&&g.reject(a);var b=s(a.fndId);a.sucs===!0&&a.psnc==p.ONLINE?(b.offlineStatus=!1,b.ip=a.chIp,b.platform=a.dvc,b.rPort=parseInt(a.chRp)):(b.platform=a.dvc,b.offlineStatus=!0),g.resolve(a)},function(a){g.reject(a)}),g.promise}e.send(f,a.SYSTEM.REQUEST_TYPE.CHAT)};return{subscribePuller:function(){u()},requestForIp:function(a,b){return v(a,b)}}}var b;try{b=angular.module("ringid.chat")}catch(c){}b.factory("PullerSubscriber",a),a.$inject=["OPERATION_TYPES","ChatFactory","userFactory","Auth","$$connector","friendsFactory","chatHistoryFactory","$q","CHAT_GENERAL_CONSTANTS","ChatPacketSenderService","ChatApiService","tagChatApiService","chatPacketResender","AUTH_SERVER_ACTIONS"]}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){a=angular.module("ringid.chat",["ringid.config","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}a.factory("PacketDataParse",["CHAT_PACKET_ATTRIBUTE",function(a){return{getPacketType:function(a){var b=new DataView(a),c=b.getIntByByte(0,1);return c},getPacketId:function(a){},copyBufferArray:function(a,b){for(var c=new Uint8Array(a),d=new Uint8Array(c.length-b),e=0;e<c.length-b;e++)d[e]=c[e+b];return d},ipToLong:function(a){for(var b=a.split("."),c=0,d=0;d<b.length;d++){var e=d,f=parseInt(b[d]);c+=f*Math.pow(256,e)}return c},longToIp:function(a){for(var b="",c=3;c>=0;c--)b+=255&a,c>0&&(b+="."),a>>=8;return b},ipToByte:function(a,b){for(var c=a.split("."),d=new Uint8Array(4),e=b;b+4>e;e++)d[e]=c[e-b];return d},byteToIp:function(a){for(var b="",c=0;4>c;c++)b=a[c],3>c&&(b+=".");return b},integerToByte:function(a,b,c){for(var d=new Uint8Array(b),e=b-1;e>=0;e--)d[e]=255&a,a/=256;return d},byteToInteger:function(a,b,c){for(var d=0,e=8*(b-1),f=c;b+c-1>f;f++)d+=a[f]<<e,e-=8;return d+=a[c+b-1]},Bytes2Float32:function(a){var b=2147483648&a?-1:1,c=(a>>23&255)-127,d=8388607&a;if(128==c)return b*(d?Number.NaN:Number.POSITIVE_INFINITY);if(-127==c){if(0==d)return 0*b;c=-126,d/=1<<22}else d=(d|1<<23)/(1<<23);return b*d*Math.pow(2,c)},Float32ToInt:function(a){var b=new DataView(new ArrayBuffer(4));return b.setFloat32(0,a),b.getInt32(0)},constructRegisterPacket:function(a){for(var b=new Uint8Array(25+a.packetId.length),c=0,d=this.ipToByte(a.ip,0),e=0;e<d.length;e++)b[c++]=d[e];for(var f=this.integerToByte(a.port,2,c),e=0;e<f.length;e++)b[c++]=f[e];b[c++]=1;for(var g=this.integerToByte(a.userId,8,c),e=0;e<g.length;e++)b[c++]=g[e];for(var h=this.integerToByte(a.friendId,8,c),e=0;e<h.length;e++)b[c++]=h[e];b[c++]=a.packetId.length;for(var e=0;e<a.packetId.length;e++)b[c++]=a.packetId.charCodeAt(e);return b[c++]=5,b},constructTagRegisterPacket:function(a){for(var b=new Uint8Array(14+a.sessionId.length+a.userId.length+a.packetId.length),c=0,d=this.integerToByte(this.ipToLong(registerJson.ip),8,0),e=0;e<d.length;e++)b[c++]=d[e];for(var f=this.integerToByte(registerJson.port,2,c),e=0;e<f.length;e++)b[c++]=f[e];b[c++]=12,b[c++]=5,b[c++]=a.packetId.length;for(var e=0;e<a.packetId.length;e++)b[c++]=a.packetId.charCodeAt(e);b[c++]=a.userId.length;for(var e=0;e<a.userId.length;e++)b[c++]=a.userId.charCodeAt(e);b[c++]=a.fullName.length;for(var e=0;e<a.fullName.length;e++)b[c++]=a.fullName.charCodeAt(e);for(var g=this.integerToByte(a.tagId,8,c),e=0;e<g.length;e++)b[c++]=g[e];return b},constructUnregisterPacket:function(a){for(var b=new Uint8Array(24),c=0,d=this.ipToByte(a.ip,0),e=0;e<d.length;e++)b[c++]=d[e];for(var f=this.integerToByte(a.port,2,c),e=0;e<f.length;e++)b[c++]=f[e];b[c++]=2;for(var g=this.integerToByte(a.userId,8,c),e=0;e<g.length;e++)b[c++]=g[e];for(var h=this.integerToByte(a.friendId,8,c),e=0;e<h.length;e++)b[c++]=h[e];return b[c++]=1,b},parseRegisterPacket:function(a){var b=new Uint8Array(a),c={},d=0;c.packetType=b[d++],c.friendId=this.byteToInteger(b,8,d),d+=8,c.packetId=this.getIndPckData(b,d+1,b[d]),d=d+1+b[d];var e=this.byteToInteger(b,4,d);return c.port=e,c},parseTagRegisterPacket:function(a){var b=new Uint8Array(a),c={},d=56,e=0;c.packetType=b[0];var f=this.byteToInteger(b,4,1);c.port=f,c.packetId=this.getIndPckData(a,6,b[5]);for(var g=1;8>g;g++)e+=b[g]<<d,d-=8;return e+=b[8],c.tagId=e,c},processUnregisterPacket:function(a){var b=new Uint8Array(a),c={},d=0;return c.packetType=b[d++],c.userId=this.byteToInteger(b,8,d),d+=8,c.friendId=this.byteToInteger(b,8,d),d+=8,c.onlineStatus=1,c},constructPacket:function(b,c,d){if(!b.ip)return!1;if(b.message||""===b.message){var e=b.message;e=e.utf8Encode();var f=e.length}for(var g=6,h=0;h<d.length;h++){switch(d[h]){case 1:g+=1;break;case 2:g+=8;break;case 3:g+=8;break;case 4:g+=1;break;case 5:g+=b.packetId.length;break;case 6:g+=1;break;case 7:g+=4;break;case 8:g+=8;break;case 9:g+=1;break;case 10:g+=1;break;case 11:g+=1;break;case 12:g+=2;break;case 13:g+=4;break;case 14:g+=4;break;case 15:g+=2;break;case 16:g+=f;break;case 17:g+=8;break;case 18:g+=1;for(var i=d.slice(h),j=0;j<b.noOfMessages;j++)for(var k=0;k<i.length;k++)switch(i[k]){case 4:g+=1;break;case 5:g+=b.packetIds[j].length}break;case 19:g+=1;break;case 20:g+=b.fullName.length;break;case 21:g+=1;break;case 22:g+=1;break;case 23:g+=2,g+=8*b.noOfMembers;break;case 24:g+=8;break;case 26:g++;break;case 27:g++;break;case 28:g+=8;break;case a.TAG_NAME_LENGTH:g+=1;break;case a.TAG_NAME:g+=b.tagName.length;break;case a.TAG_PICTURE_URL_LENGTH:g+=1;break;case a.TAG_PICTURE_URL:g+=b.tagPictureUrl.length;break;case a.TAG_NO_OF_MEMBERS:g+=1;var i=d.slice(h+1);for(j=0;j<b.tagMembers.length;j++)for(var k=0;k<i.length;k++)switch(i[k]){case a.USER_ID:g+=8;break;case a.FULL_NAME_LENGTH:g+=1;break;case a.FULL_NAME:g+=b.tagMembers[j].fullName.length;break;case a.TAG_MEMBER_TYPE:g+=1;break;case a.TAG_MEMBER_ADDED_BY:g+=8}}if(18==d[h]||23==d[h]||37==d[p])break}6!=d[d.length-1]||58!=b.packetType&&59!=b.packetType&&19!=b.packetType||(g+=1);for(var l=new DataView(new ArrayBuffer(g)),m=0,n=b.ip.split("."),o=0;o<n.length;o++)l.setUint8(m++,n[o]);l.setUint16(m,b.port),m+=2;for(var p=0;p<d.length;p++){switch(d[p]){case 1:l.setUint8(m++,b.packetType);break;case 2:l.setUint64(m,b.userId),m+=8;break;case 3:l.setUint64(m,b.friendId),m+=8;break;case 4:l.setUint8(m++,b.packetId.length);break;case 5:for(var o=0;o<b.packetId.length;o++)l.setUint8(m++,b.packetId.charCodeAt(o));break;case 6:l.setUint8(m++,b.platform);break;case 7:l.setUint32(m,b.port),m+=4;break;case 8:l.setUint64(m,b.tagId),m+=8;break;case 9:l.setUint8(m++,b.onlineStatus);break;case 10:l.setUint8(m++,b.userMood);break;case 11:l.setUint8(m++,b.messageType);break;case 12:l.setUint16(m,b.timeout),m+=2;break;case 13:l.setUint32(m,b.latitude),m+=4;break;case 14:l.setUint32(m,b.longitude),m+=4;break;case 15:l.setUint16(m,f),m+=2;break;case 16:for(var o=0;f>o;o++)l.setUint8(m++,e.charCodeAt(o));break;case 17:l.setUint64(m,b.messageDate),m+=8;break;case 18:l.setUint8(m++,b.noOfMessages);for(var i=d.slice(p),j=0;j<b.noOfMessages;j++)for(var k=0;k<i.length;k++)switch(i[k]){case 4:l.setUint8(m++,b.packetIds[j].length);break;case 5:for(var o=0;o<b.packetIds[j].length;o++)l.setUint8(m++,b.packetIds[j].charCodeAt(o))}break;case 19:l.setUint8(m++,b.fullName.length);break;case 20:for(var o=0;o<b.fullName.length;o++)l.setUint8(m++,b.fullName.charCodeAt(o));break;case 21:l.setUint8(m++,b.noOfPackets);break;case 22:l.setUint8(m++,b.sequenceNo);break;case 23:l.setUint16(m,b.noOfMembers),m+=2;for(var j=0;j<b.noOfMembers;j++)l.setUint64(m,b.userIds[j]),m+=8;break;case 24:l.setUint64(m,b.updateTime),m+=8;break;case 26:l.setUint8(m++,b.isSecretVisible);break;case 27:l.setUint8(m++,b.messageStatus);break;case 28:l.setUint64(m,b.blockUnblockUpdateDate),m+=8;break;case a.TAG_NAME_LENGTH:l.setUint8(m++,b.tagName.length);break;case a.TAG_NAME:for(var o=0;o<b.tagName.length;o++)l.setUint8(m++,b.tagName.charCodeAt(o));break;case a.TAG_PICTURE_URL_LENGTH:l.setUint8(m++,b.tagPictureUrl.length);break;case a.TAG_PICTURE_URL:for(var o=0;o<b.tagPictureUrl.length;o++)l.setUint8(m++,b.tagPictureUrl.charCodeAt(o));break;case a.TAG_NO_OF_MEMBERS:l.setUint8(m,b.tagMembers.length),m+=1;var i=d.slice(h+1);for(j=0;j<b.tagMembers.length;j++)for(var k=0;k<i.length;k++)switch(i[k]){case a.USER_ID:l.setUint64(m,b.tagMembers[j].userId),m+=8;break;case a.FULL_NAME_LENGTH:l.setUint8(m,b.tagMembers[j].fullName.length),m+=1;break;case a.FULL_NAME:for(var o=0;o<b.tagMembers[j].fullName.length;o++)l.setUint8(m,b.tagMembers[j].fullName.charCodeAt(o)),m+=1;break;case a.TAG_MEMBER_TYPE:l.setUint8(m,b.tagMembers[j].status),m+=1;break;case a.TAG_MEMBER_ADDED_BY:l.setUint64(m,b.tagMembers[j].addedBy),m+=8}}if(18==d[p]||23==d[p]||37==d[p])break}return 6!=d[d.length-1]||58!=b.packetType&&59!=b.packetType&&19!=b.packetType||l.setUint8(m++,b.platform),l},parsePacket:function(b,c,d){for(var e={},f=new DataView(b),g=0,h=0;h<d.length;h++){switch(d[h]){case 1:e.packetType=f.getIntByByte(g++,1);break;case 2:e.userId=f.getIntByByte(g,8),g+=8;break;case 3:e.friendId=f.getIntByByte(g,8),g+=8;break;case 4:e.packetIdLength=f.getIntByByte(g++,1);break;case 5:e.packetId="",e.packetId=f.getString(g,e.packetIdLength),g+=e.packetIdLength;break;case 6:e.platform=f.getIntByByte(g++,1);break;case 7:e.port=f.getIntByByte(g,4),g+=4;break;case 8:e.tagId=f.getIntByByte(g,8),g+=8;break;case 9:e.onlineStatus=f.getIntByByte(g++,1);break;case 10:e.userMood=f.getIntByByte(g++,1);break;case 11:e.messageType=f.getIntByByte(g++,1);break;case 12:e.timeout=f.getIntByByte(g,2),g+=2;break;case 13:e.latitude=f.getIntByByte(g,4,!0),g+=4;break;case 14:e.longitude=f.getIntByByte(g,4,!0),g+=4;break;case 15:e.messageLength=f.getIntByByte(g,2),g+=2;break;case 16:e.message="",e.message=f.getString(g,e.messageLength),g+=e.messageLength;break;case 17:e.messageDate=f.getIntByByte(g,8),g+=8;break;case 18:e.noOfMessages=f.getIntByByte(g++,1);var i=d.slice(h);e.packetData=[];for(var j=0;j<e.noOfMessages;j++){e.packetData[j]={};for(var k=0;k<i.length;k++)switch(i[k]){case 1:e.packetData[j].packetType=f.getIntByByte(g++,1);break;case 2:e.packetData[j].userId=f.getIntByByte(g,8),g+=8;break;case 3:e.packetData[j].friendId=f.getIntByByte(g,8),g+=8;break;case 4:e.packetData[j].packetIdLength=f.getIntByByte(g++,1);break;case 5:e.packetData[j].packetId="",e.packetData[j].packetId=f.getString(g,e.packetData[j].packetIdLength),g+=e.packetData[j].packetIdLength;break;case 8:e.packetData[j].tagId=f.getIntByByte(g,8),g+=8;break;case 11:e.packetData[j].messageType=f.getIntByByte(g++,1);break;case 12:e.packetData[j].timeout=f.getIntByByte(g,2),g+=2;break;case 13:e.packetData[j].latitude=f.getIntByByte(g,4),g+=4;break;case 14:e.packetData[j].longitude=f.getIntByByte(g,4),g+=4;break;case 15:e.packetData[j].messageLength=f.getIntByByte(g,2),g+=2;break;case 16:e.packetData[j].message="",e.packetData[j].message=f.getString(g,e.packetData[j].messageLength),g+=e.packetData[j].messageLength;break;case 17:e.packetData[j].messageDate=f.getIntByByte(g,8),g+=8;break;case 19:e.packetData[j].fullNameLength=f.getIntByByte(g++,1);break;case 20:e.packetData[j].fullName="",e.packetData[j].fullName=f.getString(g,e.packetData[j].fullNameLength),g+=e.packetData[j].fullNameLength;break;case 21:e.packetData[j].noOfPackets=f.getIntByByte(g++,1);break;case 22:e.packetData[j].sequenceNo=f.getIntByByte(g++,1);break;case 24:e.packetData[j].updateTime=f.getIntByByte(g,8),g+=8;break;case 25:e.packetData[j].serverDate=f.getIntByByte(g,8),g+=8;break;case 26:e.packetData[j].isSecretVisible=f.getIntByByte(g++,1);break;case a.TAG_NAME_LENGTH:e.packetData[j].tagNameLength=f.getIntByByte(g++,1);break;case a.TAG_NAME:e.packetData[j].tagName="",e.packetData[j].tagName=f.getString(g,e.packetData[j].tagNameLength),g+=e.packetData[j].tagNameLength;break;case a.TAG_PICTURE_URL_LENGTH:e.packetData[j].tagPictureUrlLength=f.getIntByByte(g++,1);break;case a.TAG_PICTURE_URL:e.packetData[j].tagPictureUrlLength>0?(e.packetData[j].tagPictureUrl=f.getString(g,e.packetData[j].tagPictureUrlLength),g+=e.packetData[j].tagPictureUrlLength):e.packetData[j].tagPictureUrl=""}}break;case 19:e.fullNameLength=f.getIntByByte(g++,1);break;case 20:e.fullName="",0!=e.fullNameLength&&(e.fullName=f.getString(g,e.fullNameLength),g+=e.fullNameLength);break;case 21:e.noOfPackets=f.getIntByByte(g++,1);break;case 22:e.sequenceNo=f.getIntByByte(g++,1);break;case 23:for(e.noOfMembers=f.getIntByByte(g,2),g+=2,e.userIds=[],j=0;j<e.noOfMembers;j++)e.userIds[j]=f.getIntByByte(g,8),g+=8;break;case 24:e.updateTime=f.getIntByByte(g,8),g+=8;break;case 25:e.serverDate=f.getIntByByte(g,8),g+=8;break;case 26:e.isSecretVisible=f.getIntByByte(g++,1);break;case 27:e.messageStatus=f.getIntByByte(g++,1);break;case 28:e.blockUnblockUpdateDate=f.getIntByByte(g,8),g+=8;break;case a.TAG_NO_OF_MEMBERS:var l=f.getIntByByte(g,1);g+=1;var i=d.slice(h+1);for(e.tagMembers=[],j=0;l>j;j++){e.tagMembers[j]={};for(var k=0;k<i.length;k++)switch(i[k]){case a.USER_ID:e.tagMembers[j].userId=f.getIntByByte(g,8),g+=8;break;case a.FULL_NAME_LENGTH:e.tagMembers[j].fullNameLength=f.getIntByByte(g,1),g+=1;break;case a.FULL_NAME:e.tagMembers[j].fullName="",e.tagMembers[j].fullName=f.getString(g,e.tagMembers[j].fullNameLength),g+=e.tagMembers[j].fullNameLength;break;case a.TAG_MEMBER_TYPE:e.tagMembers[j].status=f.getIntByByte(g,1),g+=1;break;case a.TAG_MEMBER_ADDED_BY:e.tagMembers[j].addedBy=f.getIntByByte(g,8),g+=8}}break;case a.TAG_NAME_LENGTH:e.tagNameLength=f.getIntByByte(g++,1);break;case a.TAG_NAME:e.tagName="",e.tagName=f.getString(g,e.tagNameLength),g+=e.tagNameLength;break;case a.TAG_PICTURE_URL_LENGTH:e.tagPictureUrlLength=f.getIntByByte(g++,1);break;case a.TAG_PICTURE_URL:e.tagPictureUrlLength>0?(e.tagPictureUrl=f.getString(g,e.tagPictureUrlLength),g+=e.tagPictureUrlLength):e.tagPictureUrl=""}if(18==d[h]||23==d[h]||37==d[h])break}return e},buildPacketID:function(){return"ring"+Math.floor(Math.random()*(new Date).getTime())},getIndPckData:function(a,b,c){for(var d="",e=b;c+b>e;e++)d+=String.fromCharCode(a[e]);return d}}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this,s=j.ChatPacketSender,t=e.getUUIDPacketId,u=function(a,b){if(b&&b.url){var c=a.message,d={u:b.url,d:b.description,t:b.title,i:b.image,m:c};a.message=angular.toJson(d)}return a},v=function(a,b){if(b&&b.lat){a.la=b.lat,a.lo=b.lng,a.loc=b.description;var c={lo:a.lo,la:a.la,loc:a.loc};a.message=angular.toJson(c)}return a},w=function(a,b){if(b&&b.url){var c={u:b.url,c:b.caption,w:b.width,h:b.height};a.message=angular.toJson(c),a.mediaUrl=b.url,a.plainText=b.caption}return a},x=function(a,b,c){b.fromTemporary=!0,b.messageData=c,a.tempMessageArray.push(b)},y=function(a,c,d,f){var i,j,k,n,o=!1,p=b.currentUser(),q=b.currentUser().getKey(),r=m.getChatServerCurrentTime(),s=a.isTagChat,u=a.getIp(),v=a.getPort();if(a.editMessageKey?(j=a.editMessageKey,a.editMessageKey=void 0,r=a.editMessageDate,a.editMessageDate=void 0,o=!0,s?(k=g.TAG_CHAT_MSG_EDIT,n=g.TAG_CHAT_BROKEN_MSG_EDIT):(k=h.FRIEND_CHAT_MSG_EDIT,n=h.FRIEND_CHAT_BROKEN_MSG_EDIT)):(j=t(r),s?(k=g.TAG_CHAT_MSG,n=g.TAG_CHAT_BROKEN_MSG):(k=h.FRIEND_CHAT_MSG,n=h.FRIEND_CHAT_BROKEN_MSG)),i={isEdit:o,tag_chat:!1,ip:u,port:v,packetType:k,brokenPacketType:n,fullName:p.getName(),userId:q,messageType:d,messageDate:r,message:c,key:j,packetId:j,isSecretVisible:a.isSecretVisible?1:0,timeout:0,platform:l.WEB},s){var w=a.getKey(),x=e.getOrCreateTag(w);!u&&x.getChatIp()&&(u=x.getChatIp(),a.setIp(u)),!a.getPort()&&x.getChatBindingPort()&&(v=x.getChatBindingPort(),a.setPort(v),a.lastCommunicationTime=x.getLastCommunicationTime()),i.tag_chat=!0,i.tagId=w}else i.friendId=a.getUser().getKey(),a.secretChat?i.timeout=a.timeout:i.timeout=0;return i},z=function(a,b){switch(c.hasEmoticon(a.message)&&(a.messageType=3),a.messageType){case f.MESSAGE_TYPES.LOCATION_SHARE:v(a,b.locationData);break;case f.MESSAGE_TYPES.LINK_SHARE:u(a,b.ogData);break;case f.MESSAGE_TYPES.IMAGE:case f.MESSAGE_TYPES.CAMERA_IMAGE:case f.MESSAGE_TYPES.VIDEO:w(a,b.mediaData)}},A=function(a){a.message=a.message||a.text,a.message=a.message.utf8Encode()},B=function(a,b,d){x(a,b,d),c.triggerCustomEvent("RE_REGISTER_TAG",{tagId:a.getKey()})},C=function(a){var b=k.getFriendOnlineStatus,d=[a];return c.requestMultipleTime(b,d)},D=function(a){k.requestForIp(a)},E=function(a,b,c){var d=a.getMessage(b.packetId),e=b.SENDING_STATE;0!=d.status&&"Pending"!=d.status||C(b.userId).then(function(d){d.sucs&&d.psnc==f.USER_PRESENCE.ONLINE?(b.SENDING_STATE=n.MESSAGE_SENDING.SECOND_ONLINE,J(a,b,c)):(b.SENDING_STATE=n.MESSAGE_SENDING.FIRST_OFFLINE,J(a,b,c,!0)),G(b,e)},function(d){b.SENDING_STATE=n.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,x(a,b,c),k.requestForIp(b.friendId),G(b,e)})},F=function(){var a=o.defer();return k.getOfflineIpPort().then(function(c){c.sucs?(b.loginData.oIP=c.oIP,b.loginData.oPrt=c.oPrt,b.updateLocalStorageLoginData(b.loginData),a.resolve(c)):a.reject(c)},function(b){a.reject(b)}),a.promise},G=function(a,b){a.SENDING_STATE!=b&&!angular.isDefined(b)},H=function(a,b,c){if(c){var d=m.getOfflineIpPort();b.ip=d.ip,b.port=d.port}else b.ip=a.getIp(),b.port=a.getPort();return b},I=function(a,b,d){var e=a.getMessage(b.packetId);e&&(e.status=d,p.updateMessage(e,a.getKey()),c.triggerCustomEvent("SINGLE_BOX_UPDATED",{box:a}))},J=function(a,b,c,d){var e,f,g;H(a,b,d),A(b),b.fromTemporary=!1,e=b.tag_chat?B:E,G(b);try{f=new s,f.setPacketObject(b),f.setBrokenPacketType(b.brokenPacketType),g=f.getInstance(),g.on("failure",function(){var d=b.SENDING_STATE;switch(b.SENDING_STATE){case n.MESSAGE_SENDING.FIRST_ONLINE:a.isTagChat?b.SENDING_STATE=n.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH:b.SENDING_STATE=n.MESSAGE_SENDING.PRESENCE_REFRESH,e.call(this,a,b,c);break;case n.MESSAGE_SENDING.SECOND_ONLINE:a.isTagChat?(b.SENDING_STATE=n.MESSAGE_SENDING.ONLINE_FAILED,I(a,b,"Failed")):(b.SENDING_STATE=n.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,x(a,b,c),k.requestForIp(b.friendId));break;case n.MESSAGE_SENDING.THIRD_ONLINE:b.SENDING_STATE=n.MESSAGE_SENDING.FIRST_OFFLINE,J(a,b,b.messageData,!0);break;case n.MESSAGE_SENDING.FIRST_OFFLINE:b.SENDING_STATE=n.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH,F().then(function(){b.SENDING_STATE=n.MESSAGE_SENDING.SECOND_OFFLINE,J(a,b,b.messageData,!0)},function(){b.SENDING_STATE=n.MESSAGE_SENDING.OFFLINE_FAILED,I(a,b,"Failed")});break;case n.MESSAGE_SENDING.SECOND_OFFLINE:b.SENDING_STATE=n.MESSAGE_SENDING.OFFLINE_FAILED,I(a,b,"Failed")}G(b,d)}),g.on("success",function(){var a=b.SENDING_STATE;switch(b.SENDING_STATE){case n.MESSAGE_SENDING.FIRST_ONLINE:case n.MESSAGE_SENDING.SECOND_ONLINE:case n.MESSAGE_SENDING.THIRD_ONLINE:b.SENDING_STATE=n.MESSAGE_SENDING.ONLINE_SUCCESS;break;case n.MESSAGE_SENDING.FIRST_OFFLINE:case n.MESSAGE_SENDING.SECOND_OFFLINE:b.SENDING_STATE=n.MESSAGE_SENDING.OFFLINE_SUCCESS}G(b,a)}),g.start()}catch(h){}},K=function(a,b,d){a.checkWaitingTimePassed()||!a.hasIpPort()?(b.SENDING_STATE=n.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,x(a,b,d),a.isTagChat?c.triggerCustomEvent("DO_TAG_REQUEST_FOR_IP",{tagId:a.getKey()}):k.requestForIp(a.getKey())):(b.SENDING_STATE=b.SENDING_STATE||n.MESSAGE_SENDING.FIRST_ONLINE,H(a,b),J(a,b,d))},L=function(a,b,c){b.tag_chat?b.tagId=a.getKey():b.friendId=a.getKey(),K(a,b,c)},M=function(a,b){for(;angular.isArray(a.tempMessageArray)&&a.tempMessageArray.length>0;){var c=a.tempMessageArray.shift(),d=c.SENDING_STATE;switch(c.SENDING_STATE){case n.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH:a.isTagChat?c.SENDING_STATE=n.MESSAGE_SENDING.SECOND_ONLINE:b?c.SENDING_STATE=n.MESSAGE_SENDING.FIRST_OFFLINE:c.SENDING_STATE=n.MESSAGE_SENDING.THIRD_ONLINE,J(a,c,c.messageData,b);break;case n.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST:a.isTagChat||!b?c.SENDING_STATE=n.MESSAGE_SENDING.FIRST_ONLINE:c.SENDING_STATE=n.MESSAGE_SENDING.FIRST_OFFLINE,J(a,c,c.messageData,b)}G(c,d)}},N=function(a,c,d,e){var f=y(a,c,d,e),g=b.currentUser();z(f,e),f.fromTemporary||a.pushMessage(f,g,!0),K(a,f,e)},O=function(c){if(c.isTagChat){if(c.getIp()){var f=e.getTag(c.getKey());d.sendTagMsgTypingPacket(b.currentUser().getKey(),f)}}else if(c.getIp()&&c.getPort()){var g=k.getTypingPacketObject(c);k.sendViaGlobalChatSocket(g,a.TYPING_PKT)}},P=function(c){if(c.isTagChat){var f=e.getTag(c.getKey());f&&d.sendTagIdlePacket(b.currentUser().getKey(),f)}else{var g=k.getIdlePacketObject(c);k.sendViaGlobalChatSocket(g,a.IDLE_PKT)}},Q=function(b){var c=k.getBlankMessageObject(b);k.sendViaGlobalChatSocket(c,a.CHAT_MSG_OFFLINE)},R=function(a,d,e,f,g){var h=y(a,d,e,g),i=b.currentUser();f&&(h.packetId=f,h.key=f),z(h,g),h.SENDING_STATE=h.SENDING_STATE||n.MESSAGE_SENDING.FIRST_OFFLINE,h.fromTemporary||f||(a.pushMessage(h,i,!0),c.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:a.getKey(),scroll:"bottom"})),J(a,h,g,!0)},S=function(b){var c=k.getF2FUnRegisterObject(b);k.sendViaGlobalChatSocket(c,a.FRIEND_UNREGISTER_PKT)};r.processAndSendMessage=N,r.sendMessage=J,r.retryMessage=L,r.sendTypingPacket=O,r.sendIdlePacket=P,r.sendBlankMessage=Q,r.sendChatUnRegisterPacket=S,r.sendTemporaryMessages=M,r.processAndSendOfflineMessage=R,r.doUpdateOfflineIpPort=F,r.getF2FIpPortMultipleTime=D}angular.module("ringid.chat").service("ChatPacketSenderService",a),a.$inject=["CHAT_PACKET_FORMAT","Auth","utilsFactory","tagChatApiService","tagChatFactory","CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","chatPacketResender","ChatApiService","PLATFORM","chatUtilsFactory","CHAT_STATES","$q","chatHistoryFactory","chatTabSync"]}(),function(){"use strict";function a(){function b(){var a="CrossTab not supported",b=[];throw localStorage||b.push("localStorage not available"),window.addEventListener||b.push("addEventListener not available"),b.length>0&&(a+=": "+b.join(", ")),new Error(a)}function c(){return(new Date).getTime()}function d(b){if(b&&"__CROSSTAB"==b.key){var c;try{c=b.newValue?JSON.parse(b.newValue):{}}catch(d){c={}}c&&c.id&&c.id!==a.id&&(b.newValue===j&&b.oldValue===k||(j=b.newValue,k=b.oldValue,m.message&&m.message.call(this,c.data)))}}function e(a,b){var d={id:l,data:b,timestamp:c()};localStorage.setItem(a,JSON.stringify(d))}function f(){window.removeEventListener("beforeunload",g,!1),window.addEventListener("unload",g,!1)}function g(){}function h(a,b,c){c=c||"0";var d=a.toString();return d.length>=b?d:new Array(b-d.length+1).join(c)+d}function i(c){a.supported||b();var d={data:c,origin:l};e("__CROSSTAB",d)}var j,k,l,m={},n=function(){return c().toString()+h(2147483647*Math.random()|0,10)};this.on=function(a,b){m[a]=b},this.setId=function(a){l=a},this.getId=function(){return l},this.broadcast=i,this.init=function(){a.supported=!!localStorage&&window.addEventListener,a.supported?(l=n(),window.addEventListener("storage",d,!1),window.addEventListener("beforeunload",g,!1),window.addEventListener("DOMContentLoaded",f,!1)):a.broadcast=b}}function b(b,c,d,e){var f,g,h,i,j=!!window.SharedWorker,k=!!window.localStorage,l=function(a,b){try{g.port.postMessage({origin:f,data:angular.extend(b,{type:a})})}catch(c){}},m=function(a,b){try{h.broadcast(angular.extend(b,{type:a}))}catch(c){}},n=function(){f=c.getUniqueID("t"),g=new SharedWorker(d.SHARED_WORKER_PATH),g.port.addEventListener("message",function(a){var b=a.data;b.origin!==f&&c.triggerCustomEvent(e.CHAT.TAB_SYNC_NEW_DATA,b.data)}.bind(this),!1),g.port.start()},o=function(){h=new a,h.init(),f=h.getId(),h.on("message",function(a){a.origin!==f&&c.triggerCustomEvent(e.CHAT.TAB_SYNC_NEW_DATA,a.data)})},p=function(a,b){i&&i.call(this,a,b)},q=function(){j?(n(),i=l):k?(o(),i=m):i=function(){}};return{init:q,sendData:p}}var c;try{c=angular.module("ringid.chat")}catch(d){}c.factory("chatTabSync",b),b.$inejct=["Storage","utilsFactory","CHAT_GENERAL_CONSTANTS","SystemEvents"],b.$inject=["Storage","utilsFactory","CHAT_GENERAL_CONSTANTS","SystemEvents"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){return{link:function(i,j,k){j.on("click",function(j){var l=k.boxId?k.boxId:!1,m="true"==k.isTagChat;if(l&&k.openChatBox!=g.currentUser().getKey()){e.close(j);var n,o=!1;m?(n=c.getTag(l),n&&n.isTagSafeToShow()&&(c.isTagRegistered(l)||d.requestForIp(l),o=!0,a.openTagChatBox(l,!0))):(a.openChatBox(l,!0),b.requestForIp(l));var p=a.getBoxByUId(l);p&&(p.loadHistoryMessages(),h.decreaseUnreadCount(p),o&&p.setTitle(n.getTagName())),f.safeDigest(i),j.preventDefault(),j.stopPropagation()}})}}}function b(a,b,c,d,e,f){return{link:function(e,g,h){g.on("click",function(g){if(h.openChatBox&&h.openChatBox!=d.currentUser().getKey()){c.safeDigest(e),a.openChatBox(h.openChatBox,!0);var i=a.getBoxByUId(h.openChatBox);if(1==i.getUser().friendshipStatus())b.requestForIp(h.openChatBox);else{var j=d.getPermission();if(1==j.ancht)b.requestForIp(h.openChatBox);else{var i=a.getBoxByUId(h.openChatBox);i.blocked=!0}}i&&(i.loadHistoryMessages(),f.decreaseUnreadCount(i)),g.preventDefault(),g.stopPropagation()}})}}}function c(a,b,c,d,e,f,g){return{link:function(f,h,i){h.on("click",function(){var f=i.openTagChatBox;if(!(0>=f)&&i.openChatBox!=e.currentUser().getKey()){var h=c.getTag(f),j=a.openTagChatBox(f,!0);j.setTitle(h.getTagName()),h&&h.isTagSafeToShow()&&(c.isTagRegistered(f)||(c.setTagChatInitiator(f),h&&b.createOrGetTagFromAuth(h,h.getMemberUserIds()).then(function(a){a.isInitiated=!0,d.doOnTagChatRequestStartResponse(a)}))),j&&(j.loadHistoryMessages(),g.decreaseUnreadCount(j))}})}}}function d(a,b){return{link:function(c,d,e){d.on("click",function(){c.rbox.value.isFocused=!0,a.makeVisibleChatBox(e.makeVisibleChatBox),b.$broadcast("focusOn",c.rbox.value.getKey()),d.parent().parent().children().eq(0).removeClass("blink")})}}}function e(a,b){return{link:function(b,c,d){c.on("click",function(){a.openChatBox(d.openChatBox)})}}}function f(a,b,c){return{restrict:"A",link:function(d,e,f){e.on("click",function(){a.closeChatBox(d.box.value.getKey()),b.removeOpenBox(d.box.value.getKey());var e=c.getTag(d.box.value.getKey());e&&e.initMessages(),d.$parent.$digest()})}}}function g(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(c){b.box.value.blinkOn&&!b.box.value.isMinimized?(b.$broadcast("blinkerOff",b.box.value.getKey()),b.$broadcast("focusOn",b.box.value.getKey())):b.box.value.blinkOn&&b.box.value.isMinimized?(a.minimizeBox(b.box.value.getKey()),b.$broadcast("blinkerOff",b.box.value.getKey()),b.$broadcast("focusOn",b.box.value.getKey())):b.box.value.blinkOn||b.box.value.isMinimized?!b.box.value.blinkOn&&b.box.value.isMinimized&&(a.minimizeBox(b.box.value.getKey()),b.$broadcast("focusOn",b.box.value.getKey())):a.minimizeBox(b.box.value.getKey()),b.$digest(),c.stopPropagation()})}}}function h(a){return{scope:!1,restrict:"A",link:function(a,b,c){}}}function i(a,b,c){return{restrict:"A",link:function(a,b,c){b.on("click",function(b){a.showDropdown=!a.showDropdown,b.stopPropagation()})},controller:["$scope","tagChatFactory","tagChatManager","Auth","Ringalert","$compile",function(a,c,d,e,f,g){function h(a){switch(a.action){case"edit":case"view":return b.close(a.event),function(){return{tagId:a.tagId}};case"delete":b.close(a.event);var e=c.getTag(a.tagId);e.setObjectLock(),d.leaveFromTag(a.tagId,currentUser.getKey()).then(function(a){e.removeObjectLock(),f.show(a,"info")},function(a){e.removeObjectLock(),f.show(a,"error")})}}a.showDropdown=!1,a.hasTagObjectLock=function(a){var b=c.getTag(a);return b?b.hasObjectLock():!1},a.getTagDDControl=function(a){var b=c.getTag(a),d=b.getMember(e.loginData.uId);return{tagId:a,isOwner:d?d.isOwner():!1}},a.tagMemberDDActions=h,a.tagMemberDDHtml="pages/partials/tag-chat/member-actions-dropdown.html"}]}}function j(a,b,c){return{restrict:"A",link:function(d,e,f){d.$on("ScrollToBottom",function(a,b){b==d.box.value.getKey()&&(e[0].scrollTop=e[0].scrollHeight,a.preventDefault())});var g=function(a){b.recalculate(d),b.hasScroll(d),c.safeDigest(d),e[0].scrollTop=a};a.$on("ScrollToBottom",function(a,b){a.preventDefault(),b==d.box.value.getKey()&&g(e[0].scrollHeight)}),a.$on("ScrollToUnread",function(a,b){if(b==d.box.value.getKey()){a.preventDefault();var c=e[0].querySelector(".status-Unread");g(c?c.offsetTop-20:e[0].scrollHeight)}})}}}function k(a,b){return{restrict:"A",link:function(a,c,d){a.box.value.blinkOn===!0&&c.addClass("blink"),a.$on("blinkerEvent",function(d,e){e.toString()===a.box.value.getKey()&&(a.box.value.isMinimized?a.box.value.isFocused===!1&&(c.addClass("blink"),a.box.value.blinkOn=!0):a.box.value.isFocused===!1&&(c.addClass("blink"),a.box.value.blinkOn=!0),b.updateBox(a.box.value))}),a.$on("blinkerOff",function(d,e){e.toString()===a.box.value.getKey()&&(c.removeClass("blink"),a.box.value.blinkOn=!1,b.updateBox(a.box.value))})}}}function l(a,b){return{restrict:"A",link:function(a,c,d){a.$on("blinkerEvent",function(d,e){e.toString()===a.rbox.value.getKey()&&(c.addClass("blink"),c.parent().parent().children().eq(0).addClass("blink"),b.updateBox(a.rbox.value))})}}}function m(a){return{restrict:"A",link:function(a,b,c){a.selectEmoticon=function(b){a.messageText=a.messageText+b.symbol()}}}}function n(a,b){return{restrict:"A",link:function(c,d,e){d.bind("click",function(a){a.stopPropagation()}),a.bind("click",function(){c.showHidden=!1,b.safeDigest(c)})}}}function o(a){return{restrict:"A",link:function(b){b.initMessageData=function(){b.messageData={ogData:{},locationData:{}}},b.resetOgInfo=function(){b.messageData.ogData={},b.ogStatus={preview:!1,loading:!1,filterOnProgress:!1}},b.resetMessageLocation=function(){b.messageData.locationData={description:"",lat:"",lng:""}},b.resetMessageText=function(){b.messageText=""},b.resetBottomMenu=function(){b.showBottomMenu=!1},b.resetMessageInput=function(c){b.initMessageData(),b.resetBottomMenu(),b.resetMessageText(),b.resetOgInfo(),b.resetMessageLocation(),c&&a.safeDigest(b)},b.resetMessageInput(!1)}}}a.$inject=["ChatFactory","PullerSubscriber","tagChatFactory","tagChatManager","rgDropdownService","utilsFactory","Auth","ChatHelper","rgScrollbarService","$rootScope"],b.$inject=["ChatFactory","PullerSubscriber","utilsFactory","Auth","$rootScope","ChatHelper"],c.$inject=["ChatFactory","tagChatApiService","tagChatFactory","tagChatManager","Auth","$rootScope","ChatHelper"],
d.$inject=["ChatFactory","$rootScope"],e.$inject=["ChatFactory","$rootScope"],f.$inject=["ChatFactory","chatHistoryFactory","tagChatFactory"],g.$inject=["ChatFactory"],h.$inject=["ChatFactory"],i.$inject=["ChatFactory","rgDropdownService","$compile"],j.$inject=["$rootScope","rgScrollbarService","utilsFactory"],k.$inject=["$window","chatHistoryFactory"],l.$inject=["$window","chatHistoryFactory"],m.$inject=["ChatPacketSenderService"],n.$inject=["$document","utilsFactory"],o.$inject=["utilsFactory"],angular.module("ringid.chat").directive("openBox",a).directive("openChatBox",b).directive("openTagChatBox",c).directive("makeVisibleChatBox",d).directive("showHiddenBoxes",e).directive("closeBox",f).directive("minimizeBox",g).directive("maximizeBox",h).directive("tagChatEdit",i).directive("chatScrollBottom",j).directive("chatBlinkerH",l).directive("chatBindOutsideClick",n).directive("sharedContent",o)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=c.getKey();a.historyLoading=!0,b.call(this,g,d,e,f).then(function(b){b.sucs&&(a.historyLoading=!1)},function(){a.historyLoading=!1,c.hasHistoryMessage=!0})}function b(b,c,d,e,f,g){var h="pages/chatbox.html";return{restrict:"E",replace:!0,scope:!0,templateUrl:h,link:function(f){var g=function(g){var h=b.getBoxByUId(g);if(h&&h.nonDomBox){var i,j,k=h.getBottomMessage(),l=h.getTopMessage();if(l||k?(j=h.messageMinPacketId,i=h.messageMaxPacketId):i=j=b.getUUIDPacketId(),!h.hasHistoryMessage){var m=c.getHistoryRequestMethodByBox(h),n=i==j,o=20;a(f,m,h,e.PAGE_DIRECTION.UP,j,o),n||a(f,m,h,e.PAGE_DIRECTION.DOWN,i,o)}}d.safeDigest(f)};d.onCustomEvent("CHAT_HISTORY_LOADED",function(a){g(a.boxId)})}}}function c(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/extra-chatboxes.html"}}function d(a,b,c){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-chatbox.html",link:function(a,d,e){var f={},g=function(a){c.$broadcast("ScrollToUnread",a)},h=function(c){var d=c.boxId.toString();d==a.box.key&&(f[d]||(f[d]=b.debounce(function(){g(d)},200,!1)),f[d].call(this))};b.onCustomEvent("NEW_MESSAGE_PUSHED",function(a){a.type="pushed",h(a)}),b.onCustomEvent("MESSAGE_RECEIVED",function(b){a.$broadcast("blinkerEvent",b.boxId),b.type="received",h(b)}),b.onCustomEvent("SINGLE_BOX_UPDATED",function(c){var d=c.box;d.getKey()==a.box.value.getKey()&&b.safeDigest(a)})}}}function e(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-topbar.html"}}function f(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-topbar-menu.html",link:function(a){var b=a.box.value;a.hideTopbar=!0,setTimeout(function(){a.hideTopbar=!1,a.$rgDigest()},3e3),a.shouldShowLastOnlineBar=function(){return b.offlineStatus&&b.lastSeenBar&&!!b.getUser().lastOnline&&b.getUser().lastOnline()},a.shouldShowFriendSuggestion=function(){return!b.hideSuggestion&!b.isTagChat&&!!b.getUser()&&1!=b.getUser().friendshipStatus()&&!b.offlineStatus},a.shouldShowChatBoxTopbarMenu=function(){return!b.isTagChat&&(a.shouldShowLastOnlineBar()||a.shouldShowFriendSuggestion())}}}}function g(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-url-preview.html"}}function h(a,b){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-bottom.html",link:function(b,c,d){b.toggleMenu=function(){b.showBottomMenu=!b.showBottomMenu,a.safeDigest(b)}}}}function i(){return{restrict:"E",replace:!0,link:function(a){},templateUrl:"pages/partials/chat/chatbox-location-info.html"}}function j(a,b){return{restrict:"E",replace:!0,link:function(a,c,d){a.showMediaButton=b.hasUserMediaSupport(),c.on("mouseover",function(){a.$parent.bottomMenuHover=!0}),c.on("mouseleave",function(){a.$parent.bottomMenuHover=!1})},templateUrl:"pages/partials/chat/chatbox-bottom-menu.html"}}function k(a,b,c){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-middle.html",link:function(d){c.onCustomEvent("CHAT_HISTORY_LOADED",function(c){a.recalculate(d),a.hasScroll(d),b.$broadcast("ScrollToBottom",c.boxId)})}}}function l(a,b){return{restrict:"E",replace:!0,link:function(c,d,e){var f,g=a.onCustomEvent("SINGLE_MESSAGE_UPDATED",function(b){var d=b.message;d.key==c.message.key&&a.safeDigest(c)});c.openRingboxContent=function(c){f=b.open({type:"remote",scopeData:{message:c,viewport:a.viewport},resolve:{data:{}},onBackDropClickClose:!0,templateUrl:"pages/partials/chat/media-preview.html"})},a.onCustomEvent("SINGLE_MESSAGE_TIMEDOUT",function(a){a.box;f&&f.close()}),c.$on("$destroy",function(){a.removeCustomEvent("SINGLE_MESSAGE_UPDATED",g)})},templateUrl:"pages/partials/chat/message/single.html"}}function m(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/message/upload-progress.html"}}function n(a,b){var c=function(a,b){var c=b?b:"Pending";return a&&"Sent"===c&&(c="Delivered"),c},d=function(c){var d=c-a.serverTimeDiff,e=b.chatVerbalDate(d);return e};return{restrict:"E",replace:!0,link:function(a,b,e){a.$watch("message.status",function(){a.message.statusText=c(a.box.value.isTagChat,a.message.status),a.message.statusDate=d(a.message.messageDate),a.message.statusUserName=a.message.user.getName()})},template:'<div class="t-chat" ><p ><span title="{{ message.statusUserName }}">{{ message.statusUserName }}</span>  {{ message.statusDate }}  <a data-tooltip-post=" {{message.statusText}} " class=" {{message.statusText}} "></a></p></div>'}}function o(b,c,d){return{restrict:"E",replace:!0,link:function(e,f,g){e.historyLoading=!1,f.on("click",function(){var f,g=e.box.value,h=g.getBottomMessage();f=h?g.messageMinPacketId:c.getUUIDPacketId();var i=b.getHistoryRequestMethodByBox(g);a(e,i,g,d.PAGE_DIRECTION.UP,f,10)})},templateUrl:"pages/partials/chat/history-loader-view.html"}}function p(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/home.html",controller:"ChatHistoryController"}}function q(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/top.html"}}function r(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/left.html"}}function s(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/right.html"}}function t(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/left-single-box.html"}}function u(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/right-single-box.html"}}function v(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/message-box.html"}}function w(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-topbar-status.html",link:function(a,b){}}}b.$inject=["ChatFactory","tagOfflineChatManager","utilsFactory","TAG_CHAT_GENERAL_CONSTANTS","rgScrollbarService","$rootScope"],d.$inject=["rgScrollbarService","utilsFactory","$rootScope"],h.$inject=["utilsFactory","$document"],j.$inject=["utilsFactory","rgRecorderService"],k.$inject=["rgScrollbarService","$rootScope","utilsFactory"],l.$inject=["utilsFactory","$ringbox"],n.$inject=["CHAT_GLOBAL_VALUES","utilsFactory"],o.$inject=["tagOfflineChatManager","tagChatFactory","TAG_CHAT_GENERAL_CONSTANTS"],angular.module("ringid.chat").directive("chatBoxUi",b).directive("chatBoxTopBar",e).directive("chatBoxMiddle",k).directive("chatBoxBottom",h).directive("extraChatBoxes",c).directive("chatBoxUrlPreview",g).directive("chatBoxTopBarStatus",w).directive("chatBoxTopBarMenu",f).directive("chatBoxBottomMenu",j).directive("chatBoxLocationInfo",i).directive("chatSingleMessage",l).directive("chatFileUploadProgress",m).directive("singleMessageStatus",n).directive("chatHistoryLoader",o).directive("singleChatBox",d).directive("chatSinglePageTop",q).directive("chatSinglePageLeft",r).directive("chatLeftSingleBox",t).directive("chatSinglePageRight",s).directive("chatRightSingleBox",u).directive("chatMessageBox",v).directive("singlePageChatUI",p)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return{controller:["$scope","ChatSeenSend","ChatHelper","Auth","rgScrollbarService",function(a,b,c,e,f){a.onViewedCalled=function(d){var f=a.box.value,g=a.box.value.isTagChat,h=[{key:d.key,value:d}],i=function(a){for(var b=[],c=0,d=a.length;d>c;c++)a[c].value.user.getKey()!==e.loginData.uId&&"Deleted"!==a[c].value.status&&"Played"!==a[c].value.status&&"Viewed"!==a[c].value.status&&"status_update"!==a[c].value.status&&1!=a[c].value.seenSent&&b.push(a[c]);return b};if(angular.isArray(h)&&h.length>0){if(h=i(h),h.length<1)return;b.sendSeenPacket(f,h),g||c.startTimerOthers(a,h)}},a.showUnreadMessages=function(){var b=a.box.value;c.decreaseUnreadCount(b),d.$broadcast("ScrollToUnread",b.getKey())}}],link:function(d,p,q){d.uploadBoxValue=d.box.value.getKey(),d.uploadAction=function(b){var c=e.getUniqueID("ring"),k={key:c,uploadProgress:b.uploadFile.getProgress,uploading:!0,message:" ",mediaUrl:b.uploadFile.getPreview(),messageDate:parseInt((new Date).getTime()+g.serverTimeDiff),messageType:i.MESSAGE_TYPES.IMAGE,packetId:c,sessionId:e.getToken,timeout:0,status:0,getMessageTime:function(){var a=k.messageDate-g.serverTimeDiff,b=e.chatVerbalDate(a);return b},fileUploadObject:b.uploadFile};d.box.value.pushDummyMessage(k,f.currentUser(),!0),a.setScopeForDigest(d),e.safeDigest(d);var m=function(b){if(a.removeScope(d),b.sucs){var f=d.box.value,g=f.isTagChat,k=(f.offlineStatus,{url:b.url,caption:b.caption,width:b.iw,height:b.ih}),m=j.imBase+b.url;f.removeMessage(c),e.safeDigest(d),g||h.updateFriendPresence(f.getKey()),h.updateBoxSessionIfRequired(f.getKey(),f),l.processAndSendMessage(f,m,i.MESSAGE_TYPES.IMAGE,{mediaData:k}),d.resetMessageInput(),e.safeDigest(d),d.$broadcast("ScrollToBottom",d.box.value.getKey())}},n=function(a){o.show({mg:"Image Upload Failed, please try again"},"error"),s.removeMessage(c)};b.uploadFile.fetchMeta(function(){k.message=b.uploadFile.getPreview(),k.uploading=!0,b.uploadFile.initUpload().then(function(a){k.uploading=!1,m(a)},function(a){k.uploading=!1,n(a)})})},e.onCustomEvent("BOX_CAM_UPLOAD",function(a){d.box.value.getKey()==a.boxId&&d.uploadAction(a)}),c.on("click",function(a){d.box.value.isFocused=!1});var r=d.box.value.getMessages(),s=d.box.value,t=d.box.value.isTagChat,u=function(a){for(var b=[],c=0,d=a.length;d>c;c++)switch(a[c].value.messageType){case 2:case 3:case 4:case 5:case 6:b.push(a[c])}return b},v=function(a){for(var b=[],c=0,d=a.length;d>c;c++)a[c].value.user.getKey()!==f.loginData.uId&&"Deleted"!==a[c].value.status&&"Played"!==a[c].value.status&&"Viewed"!==a[c].value.status&&"status_update"!==a[c].value.status&&1!=a[c].value.seenSent&&b.push(a[c]);return b},w=function(a){for(var c=[],d=0,e=a.length;e>d;d++)"Unread"!=a[d].value.status||a[d].value.timeout&&0!=a[d].value.timeout||(a[d].value.status="Received",c.push(a[d].value));b.updateMessages(c,s.getKey())},x=function(a){b.removeUnreadMessageInfoByBoxId(a)};e.onCustomEvent(m.CHAT.TAB_SYNC_NEW_DATA,function(a){if(i.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER==a.type&&a.boxId==s.getKey()&&angular.isArray(r)&&r.length>0){w(r);var b;if(b=v(r),b=u(b),b.length<1)return;x(a.boxId),s.updateUnreadCount(),t||h.startTimerText(d,b)}}),e.onCustomEvent("WAS_FOCUSED",function(a){var b=a.box,c=a.filteredMessages;b.getKey()==s.getKey()&&(b.isTagChat||h.startTimerText(d,c),n.sendData(i.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:b.getKey()}))});var y=function(a){a.stopPropagation();var b=d.box.value.getKey(),c=d.box.value,f=!1;c.unreadCount>0&&(x(b),c.updateUnreadCount(),f=!0),d.bottomMenuHover||d.bottomMenuButtonHover||(d.showBottomMenu=!1,f=!0),f&&e.safeDigest(d);for(var g=0;g<d.boxes.length;g++)d.boxes[g].value.isFocused=!1;if(c.isMinimized===!0?c.isFocused=!1:c.isFocused=!0,d.$broadcast("blinkerOff",b),d.$broadcast("focusOn",b),angular.isArray(r)&&r.length>0){w(r);var j;if(j=v(r),j=u(j),j.length<1)return;k.sendSeenPacket(c,j),t||h.startTimerText(d,j),n.sendData(i.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:c.getKey()})}a.stopPropagation()};p.on("click",y)}}}var b;try{b=angular.module("ringid.chat")}catch(c){}b.directive("chatFocus",a),a.$inject=["fileUploadService","chatHistoryFactory","$document","$rootScope","utilsFactory","Auth","CHAT_GLOBAL_VALUES","ChatHelper","CHAT_GENERAL_CONSTANTS","settings","ChatSeenSend","ChatPacketSenderService","SystemEvents","chatTabSync","Ringalert"]}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){}a.directive("messageDirective",["Auth","profileFactory","$compile","chatHistoryFactory","$interval","ChatHelper","utilsFactory",function(a,b,c,d,e,f,g){return{restrict:"A",scope:!0,link:function(b,e,h){var i=b.$eval(h.messageBox);i=i.value;var j,k,l=b.$eval(h.messageMsg),m=function(){return!i.isConsicutive(l.key)};if(b.message.takeDecisionForShowingMessageUserAvator=m,b.message.showAvator=m(),l.user.isCurrentUser()){if(e.addClass("cm-box-r"),"status_update"!==l.status){j=angular.element('<img ng-show="message.showAvator" class="chat-img-r chat-img" src="'+l.user.avatar("thumb")+'" />');var n=c(j)(b);e.append(n)}}else if(e.addClass("cm-box"),"status_update"!==l.status){j=angular.element('<img ng-show="message.showAvator" class="chat-img-l chat-img" src="'+l.user.avatar("thumb")+'" />');var n=c(j)(b);e.prepend(n)}var o=function(){var a=Math.floor(l.messageDate/864e5);return i.previousDate!=a?(i.previousDate=a,!0):!1};b.message.takeDecisionForShowingDate=o,b.message.showDate=o(),k=angular.element('<div class="line" ng-show="message.showDate"><div class="line-m">{{ message.messageDate | date }}</div></div><div ng-show="message.showDate" class="clear"></div>');var p=c(k)(b);e.prepend(p),b.$on("timeoutDelete",function(c,e,h){if(e===l.key)if(h>0)b.message.timeout=h;else{var j=l.user.getKey();if(j==a.loginData.uId){switch(b.message.timeout=0,b.message.secretTimedOut=!0,b.message.messageType){case 2:case 3:case 4:case 5:case 6:b.message.status="Deleted";break;case 8:b.message.status="Played";case 7:case 9:case 10:b.message.status="Viewed"}d.updateMessage(b.message,i.getKey())}else f.deleteMessageFromOwn(i,l),g.triggerCustomEvent("SINGLE_MESSAGE_TIMEDOUT",{box:i})}})}}}]).directive("editMessage",["$rootScope","CHAT_GLOBAL_VALUES",function(a,b){return{restrict:"EA",link:function(c,d,e){d.on("click",function(b){a.$broadcast("editMessageEvent",e.editMessage,c.message)});var f=function(a){var c=Math.floor(Date.now()),d=a-b.serverTimeDiff,e=c-d,f=36e5;return!(e>f)};c.message.canEdit=function(){return c.message.user.isCurrentUser()&&f(c.message.messageDate)&&-1===[4,6,7,8,9,10].indexOf(c.message.messageType)&&!(c.message.timeout>0||1==c.message.secretTimedOut)&&-1===["Deleted","status_update","Viewed","Played"].indexOf(c.message.status)}}}}]).directive("retryMessage",["ChatPacketSenderService","CHAT_STATES","ChatApiService",function(a,b,c){return{restrict:"EA",link:function(b,c,d){c.on("click",function(c){a.retryMessage(b.box.value,b.message,b.messageData)})}}}]).directive("deleteMessage",["Storage","PacketDataParse","utilsFactory","Auth","globalSocketFactory","CHAT_PACKET_FORMAT","tagChatFactory","tagChatApiService","CHAT_GLOBAL_VALUES","ChatApiService","ChatHelper",function(a,b,c,d,e,f,g,h,i,j,k){return{restrict:"EA",link:function(a,b,c){a.message.canDelete=function(){return-1===["status_update"].indexOf(a.message.status)},b.on("click",function(b){if(k.deleteMessageFromOwn(a.box.value,a.message),a.message.user.getKey().toString()===d.loginData.uId.toString())if(a.box.value.isTagChat)for(var c=a.box.value.getKey(),e=g.getTag(c),i=a.message.key,l=g.getUUIDPacketId(),m=0;5>m;m++)setTimeout(function(){h.deleteTagMultipleMsgInChatServer(d.loginData.uId,e,l,[i])},100);else if(1!=a.message.secretTimedOut||a.message.timeout>0){a.box.value.sendTabUpdate(a.message);for(var n=j.getF2FMessageDeleteObject(a.box.value,a.message.key),m=0;5>m;m++)setTimeout(function(){j.sendViaGlobalChatSocket(n,f.DELETE_PKT_OFFLINE)},100)}})}}}]).directive("chatMessageReact",["profileFactory",function(a){return{restrict:"A",link:function(b,c,d){var e=b.$eval(d.chatMessageReact),f=["status_pending","status_delivered","status_seen","status_sent"],g=function(){"status_update"==e.status?c.addClass("status_update"):e.user.isCurrentUser()?c.addClass("status_received"):f[e.status]&&c.addClass(f[e.status])};angular.isObject(e.user)?g():a.getUserDetailsByUId(e.user).then(function(a){a&&(e.user=a,g())})}}}]).directive("sendMessageDirective",["ChatFactory","$timeout","PacketDataParse","PullerSubscriber","tagChatApiService","tagChatFactory","tagChatManager","$$connector","OPERATION_TYPES","AUTH_SERVER_ACTIONS","CHAT_GENERAL_CONSTANTS","ChatPacketSenderService","ChatHelper","utilsFactory","SystemEvents","Ringalert",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return{restrict:"A",link:function(a,c,d){a.messageText="",a.selectedLocation=function(){a.$emit("ScrollToBottom",a.box.value.getKey()),n.getUserLocation().then(function(b){b.sucs?(a.messageData.locationData=b,m.updateBoxSessionIfRequired(a.box.value.getKey(),a.box.value),b.lat&&9999!=b.lat&&l.processAndSendMessage(a.box.value,"",k.MESSAGE_TYPES.LOCATION_SHARE,a.messageData),a.$rgDigest(),a.$emit("ScrollToBottom",a.box.value.getKey())):p.show({mg:"Please Enable Browser Location Tracking."},"error")}),a.resetMessageInput(!0)},a.selectEmoticonChat=function(b){if(b.isSticker()||b.isLargeEmoticon()){if(a.resetMessageInput(),!a.box.value.isTagChat){var d=a.box.value.getKey();m.updateFriendPresence(d,a.box.value)}a.box.value.offlineStatus===!0?l.processAndSendOfflineMessage(a.box.value,b.srcWithoutBase(),6):(m.updateBoxSessionIfRequired(a.box.value.getKey(),a.box.value),l.processAndSendMessage(a.box.value,b.srcWithoutBase(),6),a.messageText=""),n.triggerCustomEvent(o.CHAT.MESSAGE_SUBMITTED,{boxId:a.box.value.getKey()}),a.messageText="",a.$emit("ScrollToBottom",a.box.value.getKey())}else a.messageText=a.messageText+""+b.symbol(),c[0].focus()};var e=function(){c.on("keyup",function(d){var e=k.MESSAGE_TYPES.TEXT;a.messageData.locationData.lat?e=k.MESSAGE_TYPES.LOCATION_SHARE:a.messageData.ogData.url&&(e=k.MESSAGE_TYPES.LINK_SHARE);var f=function(){var c=function(){a.box.value.isTyping()===!1&&(l.sendTypingPacket(a.box.value),a.box.value.setTypingBool(!0),b(function(){a.box.value.setTypingBool(!1)},5e3))};a.box.value.checkWaitingTimePassed()||(a.box.value.isTagChat?c():a.box.value.offlineStatus===!1&&c())};if(a.box.value.isTagChat)if(13===d.which){if(a.messageText=a.messageText.replace(/\n/g,""),""!==a.messageText){if(a.box.value.checkWaitingTimePassed()){var h=a.box.value.getKey();g.requestForIp(h)}c.attr("messageKey")&&(a.box.value.editMessageKey=c.attr("messageKey"),c.removeAttr("messageKey"),a.box.value.editMessageDate=c.attr("messageDate"),c.removeAttr("messageDate"),c.removeClass("editing")),l.processAndSendMessage(a.box.value,a.messageText,e,a.messageData),n.triggerCustomEvent(o.CHAT.MESSAGE_SUBMITTED,{boxId:a.box.value.getKey()}),a.resetMessageInput(!0),a.$emit("ScrollToBottom",a.box.value.getKey())}}else f();else if(13===d.which){if(""!==a.messageText){a.messageText=a.messageText.replace(/\n/g,"");a.box.value.getKey();c.attr("messageKey")&&(a.box.value.editMessageKey=c.attr("messageKey"),c.removeAttr("messageKey"),a.box.value.editMessageDate=c.attr("messageDate"),c.removeAttr("messageDate")),a.box.value.offlineStatus===!0?l.processAndSendOfflineMessage(a.box.value,a.messageText,e,!1,a.messageData):(m.updateBoxSessionIfRequired(a.box.value.getKey(),a.box.value),l.processAndSendMessage(a.box.value,a.messageText,e,a.messageData)),n.triggerCustomEvent(o.CHAT.MESSAGE_SUBMITTED,{boxId:a.box.value.getKey()}),c.removeClass("editing"),a.$emit("ScrollToBottom",a.box.value.getKey()),a.resetMessageInput(!0)}}else f()})},f=function(){c.off("keyup")};e(),a.$on("$destroy",f),a.box.value.isFocused===!0&&c[0].focus(),a.$on("editMessageEvent",function(b,d,e){if(a.box.value.getKey()==d){var f=e.messageType;switch(f){case k.MESSAGE_TYPES.TEXT:a.messageText=e.text;break;case k.MESSAGE_TYPES.LOCATION_SHARE:a.locationData=e.locationInfo;break;case k.MESSAGE_TYPES.LINK_SHARE:angular.fromJson(e.text);a.messageText=e.ogData.message||e.ogData.description}c.addClass("editing"),c.attr("messageKey",e.key),c.attr("messageDate",e.messageDate),n.safeDigest(a)}})}}}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(a){try{a.call()}catch(b){}}return{scope:!1,restrict:"A",link:function(b,e,g){b.offlineConfirmReceived=!1;var i=function(e,g){var i=g.byteData,l=f.getPacketType(i);z(function(){switch(l){case 2:var e=f.parsePacket(i,2,m.FRIEND_UNREGISTER_PKT.FORMAT),g=d.getBoxByUId(e.userId);e.userId===g.getKey()&&d.closeChatBox(g.getKey());break;case 3:var p=f.parsePacket(i,3,m.REGISTER_CONFIRM_PKT.FORMAT),g=d.getBoxByUId(p.friendId);v.serverTimeDiff=p.serverDate-Date.now(),g||(g=d.creatNonDomBox(p.friendId,!1)),g.setPort(p.port),g.lastCommunicationTime=Math.floor(Date.now()/1e3),x.sendAfterRegisterIdlePacket(g.getKey(),g),y.sendIdlePacket(g),y.sendTemporaryMessages(g),h.triggerCustomEvent(a.CHAT.CHAT_REGISTER,{friendId:p.friendId});break;case 4:var q=f.parsePacket(i,10,m.IDLE_PKT.FORMAT),g=d.getBoxByUId(q.userId);g&&g.setFriendTypingBool(!1);break;case 5:var r,s=f.parsePacket(i,9,m.TYPING_PKT.FORMAT);r=s.userId==n.currentUser().getKey()?s.friendId:s.userId;var g=d.getBoxByUId(r);g&&(g.setFriendTypingBool(!0),g.lastCommunicationTime=Math.floor(Date.now()/1e3),o.updateBox(g),j(function(){g.setFriendTypingBool(!1)},3e3));break;case 6:break;var g,t;case 7:break;var g,t;case 15:var r,t=f.parsePacket(i,6,m.DELIVER_PKT.FORMAT);r=t.userId==n.currentUser().getKey()?t.friendId:t.userId;var g=d.getBoxByUId(r);g||(d.creatNonDomBox(r,!1),g=d.getBoxByUId(r),g.nonDomBox=!1,c.requestForIp(g.getKey()),g.loadHistoryMessages()),g.lastCommunicationTime=Math.floor(Date.now()/1e3),o.updateBox(g);var u=g.getMessage(t.packetId);u&&("Seen"!=u.status&&"Deleted"!=u.status&&"Viewed"!=u.status&&"Played"!=u.status&&(u.status="Delivered"),o.updateMessage(u,g.getKey()),g.sendTabUpdate(u));break;case 16:var r,z=f.parsePacket(i,7,m.SENT_PKT.FORMAT);r=z.userId==n.currentUser().getKey()?z.friendId:z.userId;var g=d.getBoxByUId(r);g||(d.creatNonDomBox(r,!1),g=d.getBoxByUId(r),g.nonDomBox=!1,c.requestForIp(g.getKey()),g.loadHistoryMessages()),g.lastCommunicationTime=Math.floor(Date.now()/1e3),o.updateBox(g);var u=g.getMessage(z.packetId);u&&("Seen"!=u.status&&"Deleted"!=u.status&&"Viewed"!=u.status&&"Played"!=u.status&&(u.status="Delivered"),o.updateMessage(u,g.getKey()),g.sendTabUpdate(u));break;case 17:var r,A=w.parseRawPacket(i),B=!0;A.userId==n.currentUser().getKey()?(r=A.friendId,B=!1):r=A.userId;var g=d.getBoxByUId(r),C=g.ip,D=g.port;g||(d.creatNonDomBox(r,!1),g=d.getBoxByUId(r),g.nonDomBox=!1,c.requestForIp(g.getKey()),g.loadHistoryMessages()),g.lastCommunicationTime=Math.floor(Date.now()/1e3),o.updateBox(g);for(var E=0;E<A.messages.length;E++){var F=g.getMessage(A.messages[E].packetId);F&&(3==A.messages[E].status?(F.status="Seen",x.startTimerText(b,[{key:A.messages[E].packetId,value:F}])):4==A.messages[E].status&&(F.status="Viewed",x.startTimerOthers(b,[{key:A.messages[E].packetId,value:F}])),o.updateMessage(F,g.getKey()),g.sendTabUpdate(F))}B&&x.sendChatSeenConfirmation(C,D,n.currentUser().getKey(),A.userId,A.packetId);break;case 18:f.parsePacket(i,18,m.SEEN_PKT_CONFIRM.FORMAT);break;case 19:var r,G=f.parsePacket(i,19,m.DELETE_PKT.FORMAT),B=!0,H=!1;G.userId==n.currentUser().getKey()?(r=G.friendId,B=!1,H=!0):r=G.userId;var g=d.getBoxByUId(r);g||(d.creatNonDomBox(r,!1),g=d.getBoxByUId(r),g.nonDomBox=!1,c.requestForIp(g.getKey()),g.loadHistoryMessages()),g.lastCommunicationTime=Math.floor(Date.now()/1e3),o.updateBox(g);for(var I=0;I<G.noOfMessages;I++){var J=G.packetData[I].packetId,u=g.getMessage(J);u&&(H?g.removeMessage(J):(u.text="This message has been deleted",u.setTextPartition(),u.status="Deleted"),o.updateMessage(u,g.getKey()),g.sendTabUpdate(u))}if(B){var K={sessionId:h.getToken,ip:g.getIp(),port:g.getPort(),packetId:G.packetId,packetType:20,userId:G.friendId,friendId:G.userId},L=f.constructPacket(K,20,m.DELETE_CONFIRM_PKT.FORMAT);k.send(L)}break;case 20:var K=f.parsePacket(i,20,m.DELETE_CONFIRM_PKT.FORMAT),g=d.getBoxByUId(K.userId);g||(d.creatNonDomBox(K.userId,!1),g=d.getBoxByUId(K.userId),g.nonDomBox=!1,c.requestForIp(g.getKey()),g.loadHistoryMessages()),g.lastCommunicationTime=Math.floor(Date.now()/1e3),o.updateBox(g);break;case 94:var M=f.parsePacket(i,94,m.OFFLINE_CONFIRM_PKT.FORMAT);v.serverTimeDiff=M.messageDate-Date.now(),b.offlineConfirmReceived=!0;break;case 95:break;var g,u,I}}),b.$digest()};b.$on("chatDataReceived",i)}}}var b;try{b=angular.module("ringid.chat")}catch(c){}b.directive("chatSubscriber",a),a.$inject=["SystemEvents","fileUploadService","PullerSubscriber","ChatFactory","profileFactory","PacketDataParse","userFactory","utilsFactory","$interval","$timeout","globalSocketFactory","Storage","CHAT_PACKET_FORMAT","Auth","chatHistoryFactory","TAG_CHAT_PACKET_TYPE","TAG_CHAT_GENERAL_CONSTANTS","tagChatFactory","tagChatApiService","tagChatManager","tagChatHelper","CHAT_GLOBAL_VALUES","tagChatPacketProcessor","ChatHelper","ChatPacketSenderService"]}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){a=angular.module("ringid.chat",["ringid.config","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}a.directive("setTimeout",["ChatFactory","$compile","$document",function(a,b,c){return{restrict:"EA",template:'<a><span class="icon-timer-s"></span></a>',link:function(a,d,e){var f,g=function(){a.showTimeout=!0,a.closeSettingPopup(),c.bind("click",h);var e=angular.element("<set-timeout-bar ></set-timeout-bar>");f=b(e)(a),d.parent().parent().parent().next().prepend(f)},h=function(){a.showTimeout=!1,c.unbind("click",h),f&&f.remove()};a.closeTimeoutPopup=function(){h()},a.showTimeout=!1,d.on("click",function(b){a.showTimeout?h():g(),b.stopPropagation()})}}}]).directive("setTimeoutBar",["ChatFactory","$compile",function(a,b){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="enable-secret-chat">Enable Secret Chat:</span><div class="switchnew"><input class="float-left" ng-model="box.value.secretChat" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="correct-sec icon-close-b"></a>\n<a href="#" ng-click="showValueBox($event)" class="timeout-sec icon-time"><p>sec</p><span>{{ timeout>4 ? timeout : 5}}</span></a></div></div>',link:function(a,c,d){var e;a.timeout=a.box.value.timeout,a.showTimeoutBox=!1,a.cancel=function(b){a.closeTimeoutPopup(),b&&(b.preventDefault(),b.stopPropagation())},a.showValueBox=function(d){if(a.showTimeoutBox)a.hideValueBox();else{a.showTimeoutBox=!0;var f=angular.element("<set-timeout-Value ></set-timeout-Value>");e=b(f)(a),c.children(0).append(e)}d&&(d.preventDefault(),d.stopPropagation())},a.hideValueBox=function(b){a.showTimeoutBox=!1,e&&e.remove(),b&&(b.preventDefault(),b.stopPropagation())},c.on("click",function(a){a.stopPropagation()})}}}]).directive("setTimeoutValue",["ChatFactory",function(a){return{restrict:"EA",templateUrl:"pages/partials/chat-timeout-value-box.html",link:function(a,b,c){a.selectTimeout=function(b,c){a.box.value.timeout=a.timeout=c,a.hideValueBox(b)}}}}])}(),function(){"use strict";var a;try{a=angular.module("ringid.chat")}catch(b){a=angular.module("ringid.chat",["ringid.config","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}a.directive("setting",["ChatFactory","$compile","$document",function(a,b,c){return{restrict:"EA",template:'<a><span class="icon-g-settings"></span></a>',link:function(a,d,e){var f,g=function(){a.showSetting=!0,a.closeTimeoutPopup(),c.bind("click",h);var e=angular.element("<setting-bar ></setting-bar>");f=b(e)(a),d.parent().parent().parent().next().prepend(f)},h=function(){a.showSetting=!1,c.unbind("click",h),f&&f.remove()};a.closeSettingPopup=function(){h()},a.showSetting=!1,d.on("click",function(b){a.showSetting?h():g(),b.stopPropagation()})}}}]).directive("settingBar",["ChatFactory","$compile",function(a,b){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="secret-visible">Timer:</span><div class="switch-secret-visible"><input class="float-left" ng-model="box.value.isSecretVisible" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="correct-sec icon-close-b"></a>\n</div></div>',link:function(a,b,c){a.cancel=function(b){a.closeSettingPopup(),b&&(b.preventDefault(),b.stopPropagation())},b.on("click",function(a){a.stopPropagation()})}}}])}(),function(){"use strict";var a=angular.module("ringid.tagchat",["ringid"]);a.filter("prettyJSON",function(){function a(a){return JSON?JSON.stringify(a,null,"  "):"your browser doesnt support JSON so cant pretty print"}return a})}(),function(){"use strict";var a,b,c,d,e=angular.module("ringid.tagchat"),f={LOCAL_CHAT:!1,LOCAL_CHAT_REG_IP:"192.168.1.125",LOCAL_CHAT_REG_PORT:1500,LOCAL_CHAT_OFFLINE_IP:"192.168.1.125",LOCAL_CHAT_OFFLINE_PORT:1200,API_VERSION:3,API_VERSION_PORT_OFFSET:0,PACKET_IP_SIZE:4,PACKET_PORT_SIZE:2,PACKET_DYNAMIC_ATTRIBUTE:-1,PACKET_RAW_BYTE_ATTRIBUTE:-2,ONE_BYTE_SIZE:1,TWO_BYTE_SIZE:2,FOUR_BYTE_SIZE:4,EIGHT_BYTE_SIZE:8,TAG_ID_NO_OF_TIME_DIGIT:10,TAG_ID_NO_OF_USER_ID_DIGIT:6,PACKET_MAX_SIZE:512,AUTH_UID_LIST_LIMIT:15,ACTUAL_TAG_REGISTER_TIMEOUT:180,TAG_REGISTER_TIMEOUT:150,API_FETCH_RETRY_COUNT:5,API_FETCH_RETRY_DELAY:3e3,RETRY_COUNT:5,REQUEST_TIMEOUT:18e3,BOX_WAITING_TIME:180,UDP_SERVER_KEEP_ALIVE_INTERVAL:1e4,REQUEST_CACHE_VALIDITY:3e3,RESPONSE_CACHE_VALIDITY:3e3,ATTRIBUTE_TYPE:{INTEGER:1,STRING:2,BYTE:3},MEMBER_STATUS:{MEMBER:1,ADMIN:2,OWNER:3,REMOVED:4,LEAVE:5},MEMBER_MOODS:{ONLINE:1,AWAY:2,OFFLINE:3,DO_NOT_DISTURB:4},REGISTRATION_TYPES:{CREATE:1,ONLY_REGISTER:2,CHAT_INVITE:3},MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,PLAIN_MESSAGE:2,EMOTICON_MESSAGE:3,LOCATION_MESSAGE:4,LINK_MESSAGE:5,DOWNLOAD_STICKER_MESSAGE:6,IMAGE_FILE_FROM_GALLERY:7,AUDIO_FILE:8,VIDEO_FILE:9,IMAGE_FILE_FROM_CAMERA:10,FILE_STREAM:11,HISTORY_RE_FETCH:14,GROUP_ACTIVITY:20},STATUS_MESSAGE_TYPES:{TAG_MEMBER_ADD:1,TAG_MEMBER_DELETE:2,TAG_MEMBER_LEAVE:3,TAG_MEMBER_STATUS_CHANGE_OWNER:4,TAG_MEMBER_STATUS_CHANGE_ADMIN:5,TAG_MEMBER_STATUS_CHANGE_MEMBER:6,TAG_NAME_CHANGE:7,TAG_PICTURE_CHANGE:8,TAG_INFO_UPDATED:9,TAG_ADMIN_ADD:10},PAGE_DIRECTION:{UP:1,DOWN:2},ONLINE_STATUS:{OFFLINE:1,ONLINE:2,AWAY:3},ONLINE_MOOD:{ALIVE:1,DONT_DISTURB:2,BUSY:3,INVISIBLE:4},SECRET_VISIBILITY:{NON_VISIBLE:0,VISIBLE:1},TAG_ACTIVITY_TYPE:{DELETED:0,ADDED:1,LEAVE:2,TAG_RENAME:3,MEMBER_TYPE_CHANGE:4,TAG_URL_RENAME:5,TAG_CREATED:6}};for(a in f)if(b=f[a],angular.isObject(b)){f[a+"_VALUE"]=[];for(c in b)d=b[c],f[a+"_VALUE"][d]=c}var g={FRIEND_CHAT_REGISTER:1,FRIEND_CHAT_UNREGISTER:2,FRIEND_CHAT_REGISTER_CONFIRMATION:3,FRIEND_CHAT_IDLE:4,FRIEND_CHAT_TYPING:5,FRIEND_CHAT_MSG:6,FRIEND_CHAT_MSG_EDIT:7,FRIEND_CHAT_BROKEN_MSG:8,FRIEND_CHAT_BROKEN_MSG_EDIT:9,FRIEND_CHAT_MULTIPLE_MSG:10,FRIEND_CHAT_DELIVERED:15,FRIEND_CHAT_SENT:16,FRIEND_CHAT_SEEN:17,FRIEND_CHAT_SEEN_CONFIRMATION:18,FRIEND_CHAT_MULTIPLE_MSG_DELETE:19,FRIEND_CHAT_MSG_DELETE_CONFIRMATION:20,FRIEND_BROKEN:24,FRIEND_BROKEN_CONFIRMATION:25,FRIEND_CHAT_BLOCK:27,FRIEND_CHAT_UNBLOCK:28,FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION:29},h={TAG_CHAT_TAG_REGISTER:41,TAG_CHAT_TAG_UNREGISTER:42,TAG_CHAT_TAG_REGISTER_CONFIRMATION:43,TAG_CHAT_TAG_INFORMATION:46,TAG_CHAT_TAG_INFORMATION_CONFIRMATION:47,TAG_CHAT_TAG_MEMBER_ADD:51,TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION:52,TAG_CHAT_MEMBER_REMOVE_LEAVE:53,TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION:54,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE:55,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION:56,TAG_CHAT_IDLE:61,TAG_CHAT_TYPING:62,
TAG_CHAT_MSG:63,TAG_CHAT_MSG_EDIT:64,TAG_CHAT_BROKEN_MSG:65,TAG_CHAT_BROKEN_MSG_EDIT:66,TAG_CHAT_MULTIPLE_MSG:67,TAG_CHAT_DELIVERED:68,TAG_CHAT_SENT:69,TAG_CHAT_SEEN:70,TAG_CHAT_SEEN_CONFIRMATION:71,TAG_CHAT_MULTIPLE_MSG_DELETE:72,TAG_CHAT_MSG_DELETE_CONFIRMATION:73,TAG_CHAT_GENERAL_BROKEN_PACKET:74,TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION:75},i={OFFLINE_FRIEND_INFORMATION:91,OFFLINE_FRIEND_INFORMATION_CONFIRMATION:92,OFFLINE_GET_REQUEST:93,OFFLINE_GET_REQUEST_CONFIRMATION:94,OFFLINE_FRIEND_UNREAD_MESSAGE:95,OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:96,OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST:97,OFFLINE_FRIEND_HISTORY_MESSAGE:98,OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION:99,OFFLINE_GET_FRIEND_MESSAGE_STATUS:100,OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION:101,OFFLINE_TAG_INFORMATION_ACTIVITY:104,OFFLINE_MY_TAG_LIST:105,OFFLINE_TAG_UNREAD_MESSAGE:106,OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:107,OFFLINE_TAG_CREATE_TAG:108,OFFLINE_TAG_CREATE_TAG_CONFIRMATION:109,OFFLINE_TAG_HISTORY_MESSAGE_REQUEST:110,OFFLINE_TAG_HISTORY_MESSAGE:111,OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS:112,OFFLINE_TAG_INFORMATION_WITH_MEMBERS:113,OFFLINE_TAG_CONFIRMATION:117,OFFLINE_BROKEN_HISTORY_PACKET:118,OFFLINE_BROKEN_PACKET:119,OFFLINE_BROKEN_PACKET_CONFIRMATION:120},j={};j[h.TAG_CHAT_TAG_REGISTER]=h.TAG_CHAT_TAG_REGISTER_CONFIRMATION,j[h.TAG_CHAT_TAG_INFORMATION]=h.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,j[h.TAG_CHAT_TAG_MEMBER_ADD]=h.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,j[h.TAG_CHAT_MULTIPLE_MSG_DELETE]=h.TAG_CHAT_MSG_DELETE_CONFIRMATION,j[h.TAG_CHAT_MEMBER_REMOVE_LEAVE]=h.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,j[h.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]=h.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,j[h.TAG_CHAT_GENERAL_BROKEN_PACKET]=h.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,j[h.TAG_CHAT_MSG]=[h.TAG_CHAT_SENT,h.TAG_CHAT_DELIVERED,h.TAG_CHAT_SEEN],j[h.TAG_CHAT_MSG_EDIT]=[h.TAG_CHAT_SENT,h.TAG_CHAT_DELIVERED,h.TAG_CHAT_SEEN],j[h.TAG_CHAT_BROKEN_MSG]=[h.TAG_CHAT_SENT,h.TAG_CHAT_DELIVERED,h.TAG_CHAT_SEEN],j[h.TAG_CHAT_BROKEN_MSG_EDIT]=[h.TAG_CHAT_SENT,h.TAG_CHAT_DELIVERED,h.TAG_CHAT_SEEN],j[h.TAG_CHAT_DELIVERED]=[h.TAG_CHAT_SEEN,h.TAG_CHAT_SEEN_CONFIRMATION],j[h.TAG_CHAT_SEEN]=h.TAG_CHAT_SEEN_CONFIRMATION,j[i.OFFLINE_TAG_CREATE_TAG]=i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,j[i.OFFLINE_GET_REQUEST]=i.OFFLINE_GET_REQUEST_CONFIRMATION,j[i.OFFLINE_TAG_UNREAD_MESSAGE]=i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,j[i.OFFLINE_BROKEN_PACKET]=i.OFFLINE_BROKEN_PACKET_CONFIRMATION,j[i.OFFLINE_BROKEN_HISTORY_PACKET]=i.OFFLINE_BROKEN_PACKET_CONFIRMATION,j[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]=i.OFFLINE_TAG_CONFIRMATION,j[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]=i.OFFLINE_TAG_CONFIRMATION,j[g.FRIEND_CHAT_REGISTER]=g.FRIEND_CHAT_REGISTER_CONFIRMATION,j[g.FRIEND_CHAT_MSG]=[g.FRIEND_CHAT_SENT,g.FRIEND_CHAT_DELIVERED,g.FRIEND_CHAT_SEEN],j[g.FRIEND_CHAT_MSG_EDIT]=[g.FRIEND_CHAT_SENT,g.FRIEND_CHAT_DELIVERED,g.FRIEND_CHAT_SEEN],j[g.FRIEND_CHAT_BROKEN_MSG]=[g.FRIEND_CHAT_SENT,g.FRIEND_CHAT_DELIVERED,g.FRIEND_CHAT_SEEN],j[g.FRIEND_CHAT_BROKEN_MSG_EDIT]=[g.FRIEND_CHAT_SENT,g.FRIEND_CHAT_DELIVERED,g.FRIEND_CHAT_SEEN],j[g.FRIEND_CHAT_DELIVERED]=[g.FRIEND_CHAT_SEEN,g.FRIEND_CHAT_SEEN_CONFIRMATION],j[g.FRIEND_CHAT_SEEN]=g.FRIEND_CHAT_SEEN_CONFIRMATION,j[g.FRIEND_BROKEN]=g.FRIEND_BROKEN_CONFIRMATION,j[i.OFFLINE_FRIEND_INFORMATION]=i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,j[i.OFFLINE_FRIEND_UNREAD_MESSAGE]=i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,j[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]=i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,j[i.OFFLINE_FRIEND_HISTORY_MESSAGE]=i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,j[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]=i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION;var k={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,LAST_ONLINE_TIME:26,NO_OF_ITEMS:27,BLOCK_UNBLOCK_DATE:28,MESSAGE_STATUS:29,IS_ADD_TO_DB:30,TAG_NAME_LENGTH:31,TAG_NAME:32,TAG_PICTURE_URL_LENGTH:33,TAG_PICTURE_URL:34,TAG_MEMBER_TYPE:35,TAG_MEMBER_ADDED_BY:36,TAG_NO_OF_MEMBERS:37,TAG_NO_OF_BROKEN_PKT:38,TAG_INFORMATION_UPDATE_FLAG:39,TAG_INFORMATION_TAG_NO_OF_MEMBERS:40,REGISTRATION_TYPE:41,PAGE_DIRECTION:42,PAGE_LIMIT:43,ACTIVITY_TYPE:45,ACTIVITY_VALUE_LENGTH:46,ACTIVITY_VALUE:47,CHANGED_BY_USER_ID:48,FRIEND_APP_TYPE:60,FRIEND_DEVICE_TOKEN_LENGTH:61,FRIEND_DEVICE_TOKEN:62,IS_SECRET_VISIBLE:63,APP_VERSION:64,RAW_DATA_BYTE:80},l={};l[k.PACKET_TYPE]={NAME:"PACKET_TYPE",VAR_NAME:"packetType",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.USER_ID]={NAME:"USER_ID",VAR_NAME:"userId",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.FRIEND_ID]={NAME:"FRIEND_ID",VAR_NAME:"friendId",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.PACKET_ID_LENGTH]={NAME:"PACKET_ID_LENGTH",VAR_NAME:"packetIdLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.PACKET_ID]={NAME:"PACKET_ID",VAR_NAME:"packetId",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.PLATFORM]={NAME:"PLATFORM",VAR_NAME:"platform",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.CHAT_BINDING_PORT]={NAME:"CHAT_BINDING_PORT",VAR_NAME:"chatBindingPort",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:4},l[k.TAG_ID]={NAME:"TAG_ID",VAR_NAME:"tagId",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.ONLINE_STATUS]={NAME:"ONLINE_STATUS",VAR_NAME:"onlineStatus",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.USER_MOOD]={NAME:"USER_MOOD",VAR_NAME:"userMood",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.MESSAGE_TYPE]={NAME:"MESSAGE_TYPE",VAR_NAME:"messageType",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.TIMEOUT]={NAME:"TIMEOUT",VAR_NAME:"timeout",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.LATITUDE]={NAME:"LATITUDE",VAR_NAME:"latitude",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:4},l[k.LONGITUDE]={NAME:"LONGITUDE",VAR_NAME:"longitude",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:4},l[k.MESSAGE_LENGTH]={NAME:"MESSAGE_LENGTH",VAR_NAME:"messageLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.MESSAGE]={NAME:"MESSAGE",VAR_NAME:"message",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.MESSAGE_DATE]={NAME:"MESSAGE_DATE",VAR_NAME:"messageDate",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.NO_OF_MESSAGE]={NAME:"NO_OF_MESSAGE",VAR_NAME:"messagesLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"messages",SIZE:1},l[k.FULL_NAME_LENGTH]={NAME:"FULL_NAME_LENGTH",VAR_NAME:"fullNameLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.FULL_NAME]={NAME:"FULL_NAME",VAR_NAME:"fullName",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.NO_OF_PACKET]={NAME:"NO_OF_PACKET",VAR_NAME:"packetsLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"packets",SIZE:1},l[k.SEQUENCE_NO]={NAME:"SEQUENCE_NO",VAR_NAME:"sequenceNo",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.NO_OF_MEMBERS]={NAME:"NO_OF_MEMBERS",VAR_NAME:"membersLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"members",SIZE:2},l[k.UPDATE_TIME]={NAME:"UPDATE_TIME",VAR_NAME:"updateTime",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.SERVER_DATE]={NAME:"SERVER_DATE",VAR_NAME:"serverDate",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.LAST_ONLINE_TIME]={NAME:"LAST_ONLINE_TIME",VAR_NAME:"lastOnlineTime",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.NO_OF_ITEMS]={NAME:"NO_OF_ITEMS",VAR_NAME:"noOfItems",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"items",SIZE:2},l[k.BLOCK_UNBLOCK_DATE]={NAME:"BLOCK_UNBLOCK_DATE",VAR_NAME:"blockUnblockDate",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.MESSAGE_STATUS]={NAME:"MESSAGE_STATUS",VAR_NAME:"status",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.IS_ADD_TO_DB]={NAME:"IS_ADD_TO_DB",VAR_NAME:"isAddToDb",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.TAG_NAME_LENGTH]={NAME:"TAG_NAME_LENGTH",VAR_NAME:"tagNameLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.TAG_NAME]={NAME:"TAG_NAME",VAR_NAME:"tagName",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.TAG_PICTURE_URL_LENGTH]={NAME:"TAG_PICTURE_URL_LENGTH",VAR_NAME:"tagPictureUrlLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.TAG_PICTURE_URL]={NAME:"TAG_PICTURE_URL",VAR_NAME:"tagPictureUrl",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.TAG_MEMBER_TYPE]={NAME:"TAG_MEMBER_TYPE",VAR_NAME:"status",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.TAG_MEMBER_ADDED_BY]={NAME:"TAG_MEMBER_ADDED_BY",VAR_NAME:"addedBy",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.TAG_NO_OF_MEMBERS]={NAME:"TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"tagMembers",SIZE:2},l[k.TAG_NO_OF_BROKEN_PKT]={NAME:"TAG_NO_OF_BROKEN_PKT",VAR_NAME:"brokenPacketsLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"brokenPackets",SIZE:1},l[k.TAG_INFORMATION_UPDATE_FLAG]={NAME:"TAG_INFORMATION_UPDATE_FLAG",VAR_NAME:"updateFlag",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.TAG_INFORMATION_TAG_NO_OF_MEMBERS]={NAME:"TAG_INFORMATION_TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersCount",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.REGISTRATION_TYPE]={NAME:"REGISTRATION_TYPE",VAR_NAME:"registrationType",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.PAGE_DIRECTION]={NAME:"PAGE_DIRECTION",VAR_NAME:"pageDirection",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.PAGE_LIMIT]={NAME:"PAGE_LIMIT",VAR_NAME:"pageLimit",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.ACTIVITY_TYPE]={NAME:"ACTIVITY_TYPE",VAR_NAME:"activityType",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,CONDITIONAL:!0,SIZE:1},l[k.ACTIVITY_VALUE_LENGTH]={NAME:"ACTIVITY_VALUE_LENGTH",VAR_NAME:"activityValueLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.ACTIVITY_VALUE]={NAME:"ACTIVITY_VALUE",VAR_NAME:"activityValue",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.CHANGED_BY_USER_ID]={NAME:"CHANGED_BY_USER_ID",VAR_NAME:"changedByUserId",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:8},l[k.FRIEND_APP_TYPE]={NAME:"FRIEND_APP_TYPE",VAR_NAME:"friendAppType",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.FRIEND_DEVICE_TOKEN_LENGTH]={NAME:"FRIEND_DEVICE_TOKEN_LENGTH",VAR_NAME:"friendDeviceTokenLength",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.FRIEND_DEVICE_TOKEN]={NAME:"FRIEND_DEVICE_TOKEN",VAR_NAME:"friendDeviceToken",VAR_TYPE:f.ATTRIBUTE_TYPE.STRING,SIZE:-1},l[k.IS_SECRET_VISIBLE]={NAME:"IS_SECRET_VISIBLE",VAR_NAME:"isSecretVisible",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:1},l[k.APP_VERSION]={NAME:"APP_VERSION",VAR_NAME:"appVersion",VAR_TYPE:f.ATTRIBUTE_TYPE.INTEGER,SIZE:2},l[k.RAW_DATA_BYTE]={NAME:"RAW_DATA_BYTE",VAR_NAME:"bytes",VAR_TYPE:f.ATTRIBUTE_TYPE.BYTE,SIZE:-2};var m={};m[g.FRIEND_CHAT_REGISTER]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PLATFORM]},m[g.FRIEND_CHAT_REGISTER_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.CHAT_BINDING_PORT,k.SERVER_DATE]},m[g.FRIEND_CHAT_MSG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE,k.PLATFORM]},m[g.FRIEND_CHAT_MSG_EDIT]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE,k.PLATFORM]},m[g.FRIEND_CHAT_BROKEN_MSG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE,k.PLATFORM]},m[g.FRIEND_CHAT_BROKEN_MSG_EDIT]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE,k.PLATFORM]},m[g.FRIEND_CHAT_MULTIPLE_MSG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE]]},m[g.FRIEND_CHAT_DELIVERED]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PLATFORM]},m[g.FRIEND_CHAT_SENT]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[g.FRIEND_CHAT_SEEN]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,[k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_DATE,k.MESSAGE_STATUS],k.PLATFORM]},m[g.FRIEND_CHAT_SEEN_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[g.FRIEND_BROKEN]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.RAW_DATA_BYTE]},m[g.FRIEND_BROKEN_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.SEQUENCE_NO]},m[g.FRIEND_CHAT_BLOCK]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.BLOCK_UNBLOCK_DATE,k.IS_ADD_TO_DB]},m[g.FRIEND_CHAT_UNBLOCK]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.BLOCK_UNBLOCK_DATE]},m[g.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_TAG_REGISTER]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PLATFORM]},m[h.TAG_CHAT_TAG_UNREGISTER]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.ONLINE_STATUS,k.USER_MOOD]},m[h.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.CHAT_BINDING_PORT,k.SERVER_DATE]},m[h.TAG_CHAT_TAG_INFORMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.ACTIVITY_TYPE,k.TAG_NAME_LENGTH,k.TAG_NAME,k.TAG_PICTURE_URL_LENGTH,k.TAG_PICTURE_URL]},m[h.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_TAG_MEMBER_ADD]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.TAG_NO_OF_MEMBERS,[k.USER_ID,k.FULL_NAME_LENGTH,k.FULL_NAME,k.TAG_MEMBER_TYPE]]},m[h.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_MEMBER_REMOVE_LEAVE]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.TAG_NO_OF_MEMBERS,[k.USER_ID]]},m[h.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.TAG_NO_OF_MEMBERS,[k.USER_ID,k.TAG_MEMBER_TYPE]]},m[h.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_IDLE]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PLATFORM]},m[h.TAG_CHAT_TYPING]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PLATFORM]},m[h.TAG_CHAT_MSG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE]},m[h.TAG_CHAT_MSG_EDIT]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE]},m[h.TAG_CHAT_BROKEN_MSG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE]},m[h.TAG_CHAT_BROKEN_MSG_EDIT]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE]},m[h.TAG_CHAT_MULTIPLE_MSG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE]},m[h.TAG_CHAT_DELIVERED]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_SENT]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_SEEN]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_SEEN_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_MULTIPLE_MSG_DELETE]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,[k.PACKET_ID_LENGTH,k.PACKET_ID]]},m[h.TAG_CHAT_MSG_DELETE_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[h.TAG_CHAT_GENERAL_BROKEN_PACKET]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.RAW_DATA_BYTE]},m[h.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.SEQUENCE_NO]},m[i.OFFLINE_FRIEND_INFORMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.FULL_NAME_LENGTH,k.FULL_NAME,k.PLATFORM,k.ONLINE_STATUS,k.FRIEND_APP_TYPE,k.FRIEND_DEVICE_TOKEN_LENGTH,k.FRIEND_DEVICE_TOKEN,k.USER_MOOD]},m[i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PLATFORM]},m[i.OFFLINE_GET_REQUEST]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.UPDATE_TIME,k.BLOCK_UNBLOCK_DATE,k.APP_VERSION,k.PLATFORM]},m[i.OFFLINE_GET_REQUEST_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.SERVER_DATE]},m[i.OFFLINE_FRIEND_UNREAD_MESSAGE]={FORMAT:[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE]]},m[i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,[k.PACKET_ID_LENGTH,k.PACKET_ID]]},m[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PAGE_DIRECTION,k.PAGE_LIMIT,k.PLATFORM]},m[i.OFFLINE_FRIEND_HISTORY_MESSAGE]={FORMAT:[k.PACKET_TYPE,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.TIMEOUT,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE,k.IS_SECRET_VISIBLE,k.MESSAGE_STATUS],k.PAGE_DIRECTION]},m[i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.NO_OF_PACKET,[k.PACKET_ID_LENGTH,k.PACKET_ID],k.PLATFORM]},m[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.FRIEND_ID,k.PACKET_ID_LENGTH,k.FRIEND_ID,k.NO_OF_PACKET,[k.PACKET_ID_LENGTH,k.PACKET_ID]]},m[i.OFFLINE_TAG_INFORMATION_ACTIVITY]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_ITEMS,[k.ACTIVITY_TYPE,k.USER_ID,k.ACTIVITY_VALUE_LENGTH,k.ACTIVITY_VALUE,k.TAG_MEMBER_TYPE,k.CHANGED_BY_USER_ID,k.UPDATE_TIME]]},m[i.OFFLINE_MY_TAG_LIST]={FORMAT:[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_ITEMS,[k.TAG_ID,k.TAG_NAME_LENGTH,k.TAG_NAME,k.TAG_PICTURE_URL_LENGTH,k.TAG_PICTURE_URL,k.TAG_MEMBER_ADDED_BY,k.TAG_INFORMATION_TAG_NO_OF_MEMBERS]]},m[i.OFFLINE_TAG_UNREAD_MESSAGE]={FORMAT:[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE]]},m[i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,[k.PACKET_ID_LENGTH,k.PACKET_ID]]},m[i.OFFLINE_TAG_CREATE_TAG]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.TAG_NAME_LENGTH,k.TAG_NAME,k.TAG_PICTURE_URL_LENGTH,k.TAG_PICTURE_URL,k.TAG_NO_OF_MEMBERS,[k.USER_ID,k.FULL_NAME_LENGTH,k.FULL_NAME,k.TAG_MEMBER_TYPE],k.PLATFORM]},m[i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PAGE_DIRECTION,k.PAGE_LIMIT,k.APP_VERSION,k.PLATFORM]},m[i.OFFLINE_TAG_HISTORY_MESSAGE]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_MESSAGE,[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.MESSAGE_TYPE,k.MESSAGE_LENGTH,k.MESSAGE,k.MESSAGE_DATE],k.PAGE_DIRECTION]},m[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.PLATFORM]},m[i.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.TAG_NAME_LENGTH,k.TAG_NAME,k.TAG_PICTURE_URL_LENGTH,k.TAG_PICTURE_URL,k.TAG_NO_OF_MEMBERS,[k.USER_ID,k.FULL_NAME_LENGTH,k.FULL_NAME,k.TAG_MEMBER_TYPE,k.TAG_MEMBER_ADDED_BY]]},m[i.OFFLINE_TAG_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.TAG_ID,k.PACKET_ID_LENGTH,k.PACKET_ID]},m[i.OFFLINE_BROKEN_HISTORY_PACKET]={FORMAT:[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.RAW_DATA_BYTE]},m[i.OFFLINE_BROKEN_PACKET]={FORMAT:[k.PACKET_TYPE,k.PACKET_ID_LENGTH,k.PACKET_ID,k.NO_OF_PACKET,k.SEQUENCE_NO,k.RAW_DATA_BYTE,k.USER_ID,k.PLATFORM]},m[i.OFFLINE_BROKEN_PACKET_CONFIRMATION]={FORMAT:[k.PACKET_TYPE,k.USER_ID,k.PACKET_ID_LENGTH,k.PACKET_ID,k.SEQUENCE_NO]};for(var n=angular.extend({},h,g,i),o=Object.keys(n),p=0,q=o.length;q>p;p++)try{m[n[o[p]]].PACKET_NAME=o[p]}catch(r){m[n[o[p]]]={PACKET_NAME:o[p]}}e.constant("TAG_CHAT_PACKET_TYPE",h),e.constant("FRIEND_CHAT_PACKET_TYPE",g),e.constant("OFFLINE_PACKET_TYPE",i),e.constant("FRIEND_CHAT_PACKET_TYPE",g),e.constant("TAG_CHAT_PACKET_ATTRIBUTE",k),e.constant("TAG_CHAT_PACKET_ATTRIBUTE_INFO",l),e.constant("TAG_CHAT_PACKET_INFO",m),e.constant("TAG_CHAT_GENERAL_CONSTANTS",f),e.constant("TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP",j)}(),function(){"use strict";var a=angular.module("ringid.tagchat"),b={STATUS_MESSAGES:{SELF_ADD_MEMBER:"You added {new_member_name} as Group {new_member_type}.",SELF_ADD_MULTIPLE_MEMBER:"You added {new_member_name} and {rest_count} as Group {new_member_type}.",SELF_REMOVE_MEMBER:"You removed {old_member_name} from the group.",SELF_REMOVE_MULTIPLE_MEMBER:"You removed {old_member_name} and {rest_count} from the group.",OTHER_ADD_MEMBER:"{member_name} added {new_member_name} as Group {new_member_type}.",OTHER_ADD_MULTIPLE_MEMBER:"{member_name} added {new_member_name} and {rest_count} as Group {new_member_type}.",OTHER_REMOVE_MEMBER:"{member_name} removed {old_member_name} from the group.",OTHER_REMOVE_MULTIPLE_MEMBER:"{member_name} removed {old_member_name} and {rest_count} from the group.",SELF_LEAVE_GROUP:"You left this conversation.",OTHER_LEAVE_GROUP:"{member_name} left this conservation.",SELF_RENAME_GROUP:"You named the group {group_name}.",OTHER_RENAME_GROUP:"{member_name} named the group {group_name}.",SELF_CHANGE_GROUP_PIC:"You changed the group photo.",OTHER_CHANGE_GROUP_PIC:"{member_name} changed the group photo.",SELF_UPDATE_GROUP_INFO:"You named the group {group_name} and changed the group photo.",OTHER_UPDATE_GROUP_INFO:"{member_name} named the group {group_name} and changed the group photo.",SELF_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} Group Admin.",OTHER_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} as Admin.",SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} and {rest_count} as Group admin.",SELF_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} from Admin.",OTHER_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} from Group Admin.",SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} and {rest_count} from Group Admin.",SELF_REMOVED_FROM_ADMIN_BY_SELF:"You removed yourself from Admin",OTHER_REMOVED_FROM_ADMIN_BY_SELF:"{admin_name} removed himself/herself from Admin",SELF_USER_ADDED_AS_OWNER:"{member_name} made you owner.",OTHER_USER_ADDED_AS_OWNER:"{member_name} made {admin_name} Owner. ",SELF_NOT_GROUP_MEMBER:"You are no longer member of this group"},DEFAULT_FAILURE_MESSAGE:"Request has not been processed successfully. Please try again",DEFAULT_SUCCESS_MESSAGE:"Request has been processed successfully."};a.constant("TAG_CHAT_LANG",b)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a,b){var c=i.getPacketSizeByObject(a,b);if(!(c>k.PACKET_MAX_SIZE))return v(a,b);var d=i.splitAndGetMultipleObjects(a,b);if(d){var e=d[0].packetId;v(d[0],b);for(var f=1;f<d.length;f++)d[f].packetId=e+"_"+f,v(d[f],b)}}function t(a,b){var c=i.constructPacket(a,b);return c}function u(a,b,c){var d,e,g,h,j,k,l,m=[];c||(c=i.parseRawPacket(b)),d=c.packetType,b||(b=t(c,d)),b=b.copy(6,b.byteLength-6),j=i.getBrokenContainerByPacketType(a),k=i.getBrokenPacketSplitter(a,d,c,b),l=i.isMultipleBrokenPacket(d),e=k(),h=e.length;for(var n=0;h>n;n++)g=angular.copy(c),g.platform=f.WEB,g.packetsLength=h,g[j]=e[n][j],g.packetType=a,l?g.packetId=g.packetId+"_"+n:g.sequenceNo=n,m.push(g);return m}function v(a,b){var c=t(a,b);return c&&g.send(c),z(b,a),c}function w(a){a&&g.send(a)}function x(a,b){h.triggerCustomEvent("tagChatNoIpOrPort",{tagId:a.getTagId()})}function y(){var a,b,c=n.loginData;return k.LOCAL_CHAT?(a=k.LOCAL_CHAT_OFFLINE_IP,b=k.LOCAL_CHAT_OFFLINE_PORT):(a=c.oIP,b=c.oPrt+k.API_VERSION_PORT_OFFSET),{ip:a,port:b}}function z(a,b){i.getPacketName(a)}var A=o.ChatPacketException,B=this;B.createOrGetTagFromAuth=function(e,f,g){var h,i={actn:d.START_TAG_CHAT,tid:e.getTagId(),uIds:f,pckId:g};return j.shouldProcessRequest(i)||(h={sucs:!1}),j.setInTagChatRequestCache(j.getAuthRequestKey(i.tid,i.actn),i),h=a.request(i,c.SYSTEM.REQUEST_TYPE.CHAT),b.when(h)},B.addTagMembersInAuth=function(e,f){var g,h={actn:d.ADD_TAG_CHAT_MEMBERS,tid:e.getTagId(),chRp:e.getChatRegisterPort(),chIp:e.getChatIp(),uIds:f};return j.shouldProcessRequest(h)||(g={sucs:!1}),g=a.request(h,c.SYSTEM.REQUEST_TYPE.CHAT),b.when(g)},B.sendFriendChatDeliveryPacket=function(a,b,c,d){var e=y(),f=!!a&&a.getIp()||e.ip,g=!!a&&a.getPort()||e.port;if(f&&g){var h=m.FRIEND_CHAT_DELIVERED,i={ip:f,port:g,packetId:d,packetType:h,userId:b,friendId:c};return v(i,h)}},B.registerTagInChatServer=function(a,b,c,d){if(!b.getChatIp()||!b.getChatRegisterPort())return void x(b," Tag Register Packet ");var g=e.TAG_CHAT_TAG_REGISTER,h={ip:b.getChatIp(),port:b.getChatRegisterPort(),packetId:c||j.getUUIDPacketId(),packetType:g,userId:a,tagId:b.getTagId(),platform:f.WEB};return j.setInTagChatRequestCache(b.getTagId(),h),v(h,g)},B.sendTagInformationToChatServer=function(a,b,c,d){if(!b.getChatIp()||!b.getChatRegisterPort())return void x(b," Sending Tag Information Packet ");var f=e.TAG_CHAT_TAG_INFORMATION,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:d||j.getUUIDPacketId(),packetType:f,activityType:c,userId:a,tagId:b.getTagId(),tagName:b.getTagName().utf8Encode(),tagPictureUrl:b.getPictureUrl()};return v(g,f)},B.getTagInformationWithMemberFromChatServer=function(a,b,c){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Get Tag Info Packet ");var d=e.TAG_CHAT_GET_TAG_INFORMATION_WITH_MEMBERS,f={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c||j.getUUIDPacketId(),packetType:d,userId:a,tagId:b.getTagId()};return v(f,d)},B.addTagMemberInChatServer=function(a,b,c,d){if(!b.getChatIp()||!b.getChatRegisterPort())return void x(b,"add Tag Member Packet ");var f=e.TAG_CHAT_TAG_MEMBER_ADD,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:d||j.getUUIDPacketId(),packetType:f,tagMembers:c,userId:a,tagId:b.getTagId()};return s(g,f)},B.removeTagMembersFromChatServer=function(a,b,c,d){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Remove Tag Member Packet ");var f=e.TAG_CHAT_MEMBER_REMOVE_LEAVE,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:d||j.getUUIDPacketId(),packetType:f,tagMembers:c,userId:a,tagId:b.getTagId()};return j.setInTagChatRequestCache(g.packetId,g),s(g,f)},B.changeTagMemberStatusInChatServer=function(a,b,c,d){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Change Tag Member Status Packet ");var f=e.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:d||j.getUUIDPacketId(),packetType:f,tagMembers:c,userId:a,tagId:b.getTagId()};return s(g,f)},B.sendTagIdlePacket=function(a,b){if(b.getChatIp()&&b.getChatBindingPort()){var c=e.TAG_CHAT_IDLE,d={ip:b.getChatIp(),port:b.getChatBindingPort(),packetType:c,tagId:b.getTagId(),userId:a,platform:f.WEB};return v(d,c)}},B.sendTagMsgTypingPacket=function(a,b){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Sending Tag Msg Typing Packet");var c=e.TAG_CHAT_TYPING,d={ip:b.getChatIp(),port:b.getChatBindingPort(),packetType:c,tagId:b.getTagId(),userId:a,platform:f.WEB};return v(d,c)},B.getSendTagMsgRequestObject=function(a,b,c,d,f){var g,h;if(d){var i=y();g=i.ip,h=i.port}else g=b.getChatIp(),h=b.getChatBindingPort();if(!g||!h)throw d?A("Offline ip/port not set for tagId ",b.getTagId()):A("Ip/port is not set for tag msg send for tagId ",b.getTagId());var j=f?e.TAG_CHAT_MSG_EDIT:e.TAG_CHAT_MSG,k={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c.getPacketId(),packetType:j,userId:a,tagId:b.getTagId(),messageType:c.getMessageType(),messageDate:c.getMessageDate(),message:c.getMessageText()};return k},B.sendTagMsgInChatServer=function(a,b,c,d){var e=B.getSendTagMsgRequestObject(a,b,c,d);return v(e,e.packetType)},B.editTagMsgInChatServer=function(a,b,c,d){var e=B.getSendTagMsgRequestObject(a,b,c,d,!0);return v(e,e.packetType)},B.sendTagBrokenMsgInChatServer=function(a,b,c){},B.sendTagBrokenMsgEditInChatServer=function(a,b,c){},B.sendTagMultipleMsgInChatServer=function(a,b,c){},B.sendTagMsgDeliveredPacket=function(a,b,c){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Sending Tag Msg Delivered Packet");var d=e.TAG_CHAT_DELIVERED,f={ip:b.getChatIp(),port:b.getChatBindingPort(),packetType:d,userId:a,friendId:c.getUserId(),packetId:c.getPacketId(),tagId:b.getTagId()};return v(f,d)},B.sendTagMsgSentPacket=function(a){if(!a.getChatIp()||!a.getChatBindingPort())return void x(a,"Sending Tag Msg Sent Packet");var b=e.TAG_CHAT_SENT,c={ip:a.getChatIp(),port:a.getChatBindingPort(),packetId:a.getPacketId(),packetType:b,tagId:a.getTagId()};return v(c,b)},B.sendTagMsgSeenPacket=function(a,b,c,d){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Sending Tag Msg Seen Packet");var f=e.TAG_CHAT_SEEN,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:d,packetType:f,userId:a,friendId:c,tagId:b.getTagId()};return v(g,f)},B.deleteTagMultipleMsgInChatServer=function(a,b,c,d){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"delete Tag Msg Packet");for(var f=e.TAG_CHAT_MULTIPLE_MSG_DELETE,g=[],h=0;h<d.length;h++)g.push({packetId:d[h]});var i={ip:b.getChatIp(),port:b.getChatBindingPort(),packetType:f,userId:a,tagId:b.getTagId(),packetId:c,packets:g};return j.setInTagChatRequestCache(i.packetId,i),v(i,f)},B.sendOfflineGetRequest=function(a,b,c){var d=y();if(d.ip&&d.port){var e=l.OFFLINE_GET_REQUEST,g={ip:d.ip,port:d.port,packetType:e,userId:a,packetId:c||j.getUUIDPacketId(),updateTime:b||0,blockUnblockDate:0,appVersion:p.apiVersion,platform:f.WEB};return v(g,e)}},B.getFriendUnreadMessageConfirmationObject=function(a,b,c){for(var d=y(),e=d.ip,f=d.port,g=l.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,h=[],i=0;i<c.length;i++)h.push({packetId:c[i]});var j={ip:e,port:f,packetId:b,userId:a,packets:h,packetType:g};return j},B.sendFriendUnreadMessageConfirmation=function(a,b,c){var d=B.getFriendUnreadMessageConfirmationObject(a,b,c);return v(d,d.packetType)},B.getFriendHistoryMessageGetRequestObject=function(a,b,c,d,e){var g=y();if(g.ip&&g.port){var h=l.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,i={ip:g.ip,port:g.port,packetType:h,userId:a,friendId:b,packetId:d||j.getUUIDPacketId(),pageLimit:e||10,pageDirection:c,appVersion:p.apiVersion,platform:f.WEB};return i}},B.sendHistoryMessageGetRequest=function(a,b,c,d,e){
var f=B.getFriendHistoryMessageGetRequestObject(a,b,c,d,e),g=f.packetType;return v(f,g)},B.sendFriendHistoryMessageOfflineConfirmation=function(a,b,c){var d=y(),e=d.ip,f=d.port,g=l.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,h={ip:e,port:f,packetId:c,packetType:g,friendId:b};return v(h,g)},B.createTagInOfflineServer=function(a,b,c){var d=y();if(d.ip&&d.port){var e=l.OFFLINE_TAG_CREATE_TAG,g={ip:d.ip,port:d.port,packetId:c||j.getUUIDPacketId(),packetType:e,userId:a,tagId:b.getTagId(),tagName:b.getTagName().utf8Encode(),tagPictureUrl:b.getPictureUrl(),tagMembers:b.getSerializedMembers(),platform:f.WEB};return v(g,e)}},B.sendHistoryMessageGetRequest=function(a,b,c,d,e){var g=y();if(g.ip&&g.port){var h=l.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,i={ip:g.ip,port:g.port,packetType:h,userId:a,tagId:b,packetId:d||j.getUUIDPacketId(),pageLimit:e||10,pageDirection:c,appVersion:p.apiVersion,platform:f.WEB};return v(i,h)}},B.getTagInformationWithMemberFromOfflineServer=function(a,b,c){var d=y();if(d.ip&&d.port){var e=l.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS,g={ip:d.ip,port:d.port,packetId:c||j.getUUIDPacketId(),packetType:e,userId:a,tagId:b,platform:f.WEB};return v(g,e)}},B.sendOfflineBrokenPacket=function(a,b,c){},B.getTagCreateRequestObject=function(a,b,c){var d=y();if(d.ip&&d.port){var e=l.OFFLINE_TAG_CREATE_TAG,g={ip:d.ip,port:d.port,packetId:c||j.getUUIDPacketId(),packetType:e,userId:a,tagId:b.getTagId(),tagName:b.getTagName().utf8Encode(),tagPictureUrl:b.getPictureUrl(),tagMembers:b.getSerializedMembers(),platform:f.WEB};return g}},B.sendTagRegisterConfirmation=function(a,b){if(!a.getChatIp()||!a.getChatBindingPort())return void x(a,"Sending Tag Register Confirmation");var c=e.TAG_CHAT_TAG_REGISTER_CONFIRMATION,d={ip:a.getChatIp(),port:a.getChatBindingPort(),packetId:b,packetType:c,tagId:a.getTagId(),serverDate:a.serverDate};return v(d,c)},B.sendTagInformationConfirmation=function(a,b,c){var d=y(),f=b.getChatIp()||d.ip,g=b.getChatBindingPort()||d.port;if(f&&g){var h=e.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,i={ip:f,port:g,packetId:c,userId:a,packetType:h,tagId:b.getTagId()};return v(i,h)}},B.sendTagMemberAddConfirmation=function(a,b,c){if(b.getChatIp()&&b.getChatBindingPort()){var d=e.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,f={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c,userId:a,packetType:d,tagId:b.getTagId()};return v(f,d)}},B.sendTagChatMemberRemoveLeaveConfirmation=function(a,b,c){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Sending Tag Remove Leave Confirmation");var d=e.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,f={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c,userId:a,packetType:d,tagId:b.getTagId()};return v(f,d)},B.sendTagMemberStatusChangeConfirmation=function(a,b,c){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Sending Tag Member status change confirmation");var d=e.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,f={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c,userId:a,packetType:d,tagId:b.getTagId()};return v(f,d)},B.sendTagMsgSeenConfirmation=function(a,b,c){},B.sendTagChatMsgDeleteConfirmation=function(a,b,c,d){if(!b.getChatIp()||!b.getChatBindingPort())return void x(b,"Sending Tag Msg Delete Confirmation");var f=e.TAG_CHAT_MSG_DELETE_CONFIRMATION,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c,userId:a,packetType:f,tagId:b.getTagId(),friendId:d};return v(g,f)},B.sendTagGeneralBrokenPacketConfirmation=function(a,b,c,d){if(b.getChatIp()&&b.getChatBindingPort()){var f=e.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,g={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c,userId:a,packetType:f,tagId:b.getTagId(),sequenceNo:d};v(g,f)}},B.sendTagCreateConfirmation=function(a,b,c){if(b.getChatIp()&&b.getChatBindingPort()){var d=l.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,e={ip:b.getChatIp(),port:b.getChatBindingPort(),packetId:c,packetType:d,tagId:b.getTagId(),userId:a};return v(e,d)}},B.sendTagInformationToOfflineServer=function(a,b,c){var d=y();if(d.ip&&d.port){var f=e.TAG_CHAT_TAG_INFORMATION,g={ip:d.ip,port:d.port,packetId:c||j.getUUIDPacketId(),packetType:f,userId:a,tagId:b.getTagId(),tagName:b.getTagName().utf8Encode(),tagPictureUrl:b.getPictureUrl(),tagMembers:b.getSerializedMembers()};return v(g,f)}},B.getTagUnreadMessageConfirmationObject=function(a,b,c){var d=y();if(d.ip&&d.port){for(var e=l.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,f=[],g=0;g<c.length;g++)f.push({packetId:c[g]});var h={ip:d.ip,port:d.port,packetType:e,userId:a,packetId:b,packets:f};return h}},B.sendTagUnreadChatMsgConfirmation=function(a,b,c){var d=B.getTagUnreadMessageConfirmationObject(a,b,c);return v(d,d.packetType)},B.sendTagOfflineConfirmation=function(a,b,c){var d=y(),e=d.ip,f=d.port,g=l.OFFLINE_TAG_CONFIRMATION,h={ip:e,port:f,packetId:c,packetType:g,tagId:b};return v(h,g)},B.sendOfflineBrokenPacketConfirmation=function(a,b,c){var d=y();if(d.ip&&d.port){var e=l.OFFLINE_BROKEN_PACKET_CONFIRMATION,f={ip:d.ip,port:d.port,packetType:e,userId:a,packetId:b,sequenceNo:c};v(f,e)}},B.sendToSelf=function(a){h.triggerCustomEvent("sendTagChatPacketToSelf",{byteData:a.buffer.slice(6)})},B.sendViaGlobalChatSocket=v,B.getPacket=t,B.getBrokenPacketObjects=u,B.logRequestedPacketInfo=z,B.sendPacketViaGlobalChatSocket=w}angular.module("ringid.tagchat").service("tagChatApiService",a),a.$inject=["$$connector","$q","OPERATION_TYPES","AUTH_SERVER_ACTIONS","TAG_CHAT_PACKET_TYPE","PLATFORM","globalSocketFactory","utilsFactory","tagChatPacketProcessor","tagChatFactory","TAG_CHAT_GENERAL_CONSTANTS","OFFLINE_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","Auth","tagChatExceptions","settings","CHAT_GENERAL_CONSTANTS","chatTabSync"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){var b=this,c={id:0,name:"Group",pictureUrl:"",userId:0,packetId:0,memberCount:0,chIp:"",chRp:0,chBp:0,serverDate:0,serverDateDiff:0,members:a.createNew(),messages:a.createNew(),objectLock:!1,lastCommunicationTime:0,ownerUserId:0,creationTime:0};this.getTagId=function(){return c.id},this.setTagId=function(a){c.id=a,c.creationTime=a.toString().substr(0,f.TAG_ID_NO_OF_TIME_DIGIT)},this.getTagCreationTime=function(){return c.creationTime},this.getUserId=function(){return c.userId},this.setUserId=function(a){c.userId=a},this.getPacketId=function(){return c.packetId},this.setPacketId=function(a){c.packetId=a},this.renewPacketId=function(){b.setPacketId(d.getUniqueID("tgrc"))},this.getChatIp=function(){return l?f.LOCAL_CHAT_REG_IP:c.chIp},this.setChatIp=function(a){c.chIp=a},this.resetChatIp=function(a){c.chIp=""},this.getChatRegisterPort=function(){return l?f.LOCAL_CHAT_REG_PORT:c.chRp?c.chRp+m:c.chRp},this.setChatRegisterPort=function(a){c.chRp=a},this.resetChatRegisterPort=function(a){c.chRp=0},this.getChatBindingPort=function(){return c.chBp},this.hasChatIp=function(){return!!c.chIp},this.hasChatBindingPort=function(){return!!c.chBp},this.hasChatRegisterPort=function(){return!!c.chRp},this.resetChatBindingPort=function(){c.chBp=0},this.setChatBindingPort=function(a){c.chBp=a},this.getTagName=function(){return c.name},this.setTagName=function(a){c.name=a},this.setPictureUrl=function(a){c.pictureUrl=a},this.getPictureUrl=function(){return c.pictureUrl.trim()},this.getPictureFullUrl=function(){return""!=this.getPictureUrl()?h.imBase+this.getPictureUrl():"images/prof.png"},this.setServerDate=function(a){c.serverDate=a,b.setServerDateDiff(a-parseInt((new Date).getTime()))},this.getServerDate=function(){return c.serverDate},this.setServerDateDiff=function(a){c.serverDateDiff=a},this.getServerDateDiff=function(){return c.serverDateDiff},this.getMembersCount=function(){return c.memberCount},this.setMembersCount=function(a){c.memberCount=a},this.isTagSafeToShow=function(){return b.getMembersObjectMap().length()>1&&b.isUserMember(e.currentUser().getKey())},this.initMembers=function(){c.members=a.createNew()},this.addMember=function(a){c.members||(c.members=b.initMembers()),a.isOwner()&&(c.ownerUserId=a.getId()),c.members.save(a.getId(),a)},this.updateMember=function(a){this.addMember(a)},this.removeMember=function(a){a instanceof j?c.members.remove(a.getId()):c.members.remove(a)},this.membersLength=function(){return c.members?c.members.length():0},this.getMember=function(a){return c.members.get(a)},this.getMemberObjects=function(){return c.members.values()},this.getMemberUserIds=function(){return c.members.keys()},this.getMembersObjectMap=function(){return c.members},this.setMembersObjectMap=function(a){c.members=a},this.initMemberObjects=function(){for(var a=c.members.all(),b=0;b<c.members.length();b++){var d=a[b].value;setTimeout(function(a){a.initUserObjects()}.bind(null,d),g.REQUEST_DELAY)}},this.getSerializedMembers=function(){for(var a=c.members.all(),b=[],d=0;d<a.length;d++){var e=a[d].value;b.push(e.serialize())}return b},this.isUserMember=function(a){return c.members?!!c.members.get(a):!1},this.isCurrentUserStatusAdmin=function(a){var b=!!c.members&&c.members.get(a);return b?b.isAdmin():!1},this.isCurrentUserStatusMember=function(a){var b=!!c.members&&c.members.get(a);return b?b.isMember():!1},this.setObjectLock=function(){c.objectLock=!0},this.removeObjectLock=function(){c.objectLock=!1},this.hasObjectLock=function(){return c.objectLock},this.getLastCommunicationTime=function(){return c.lastCommunicationTime},this.setLastCommunicationTime=function(a){c.lastCommunicationTime=a},this.resetLastCommunicationTime=function(){c.lastCommunicationTime=0},this.updateLastCommunicationTime=function(){c.lastCommunicationTime=Math.floor(Date.now()/1e3)},this.setOwnerUserId=function(a){c.ownerUserId=a},this.getOwnerUserId=function(){return c.ownerUserId},this.initMessages=function(){c.messages=a.createNew()},this.addMessage=function(a){c.messages||(c.messages=b.initMessages()),c.messages.save(a.getPacketId(),a)},this.removeMessage=function(a){a instanceof k?c.messages.remove(a.getId()):c.messages.remove(a)},this.messagesLength=function(){return c.messages?c.messages.length():0},this.getMessage=function(a){return c.messages.get(a)},this.getMessageObjects=function(){return c.messages.values()},this.getMessageUserIds=function(){return c.messages.keys()},this.getMessagesObjectMap=function(){return c.messages},this.setMessagesObjectMap=function(a){c.messages=a},this.debug=function(){return c}}function j(){var a=this,d={tagId:0,userId:0,fullName:"",status:0,statusValue:"",addedBy:0,user:{},addedByUser:{}};this.initWithUserMapObject=function(b){a.setId(b.getKey()),a.setFullName(b.getName()),a.setUserObj(b)},this.setTagId=function(a){d.tagId=a},this.getTagId=function(){return d.tagId},this.setId=function(a){d.userId=a.toString()},this.getId=function(){return d.userId},this.getUser=function(){return c.getUser(d.userId)},this.setFullName=function(a){d.fullName=a},this.getFullName=function(){return d.fullName},this.getPictureUrl=function(){return a.getUser().getUserAvatar?h.imBase+a.getUser().getUserAvatar():"images/prof.png"},this.getName=function(){return""!==d.fullName?d.fullName:a.getUser()?a.getUser().getName():d.userId},this.getStatus=function(){return d.status},this.getStatusValue=function(){return d.status===f.MEMBER_STATUS.ADMIN?"admin":d.status===f.MEMBER_STATUS.MEMBER?"member":"owner"},this.setStatus=function(a){d.status=a},this.setAddedBy=function(a){d.addedBy=a},this.getAddedBy=function(){return d.addedBy},this.getAddedByUser=function(){return c.getUser(d.addedBy)},this.getAddedByUserName=function(){return!!a.getAddedByUser()&&a.getAddedByUser().getName()},this.setAddedByUserObj=function(a){d.addedByUser=a},this.setUserObj=function(a){d.user=a},this.initUserObjects=function(){b.getUserDetailsByUId(d.userId),setTimeout(function(a){b.getUserDetailsByUId(a.addedBy)}.bind(null,d),g.REQUEST_DELAY)},this.isCurrentUser=function(){return a.getId()===e.currentUser().getKey()},this.isAdmin=function(){return d.status==f.MEMBER_STATUS.ADMIN},this.isMember=function(){return d.status==f.MEMBER_STATUS.MEMBER},this.isOwner=function(){return d.status==f.MEMBER_STATUS.OWNER},this.isRemoved=function(){return d.status==f.MEMBER_STATUS.REMOVED},this.makeAdmin=function(){d.status=f.MEMBER_STATUS.ADMIN},this.makeMember=function(){d.status=f.MEMBER_STATUS.MEMBER},this.makeOwner=function(){d.status=f.MEMBER_STATUS.OWNER},this.serialize=function(){return{userId:a.getId(),fullName:a.getName().utf8Encode(),status:a.getStatus(),addedBy:a.getAddedBy()}}}function k(){var a=this,d={tagId:0,text:"",hrtime:"",status:"",messageDate:"",isDeleted:!1,messageDateString:"",timeout:0,userId:0,fullName:"",type:0,packetId:0,user:{},seenPacketSent:!1,deliveredPacketSent:!1,statusType:"",seenUsers:[],deliveredUsers:[],usersToChange:{},tagName:""};this.getTagId=function(){return d.tagId},this.setTagId=function(a){d.tagId=a},this.getHumanReadableTime=function(){return d.hrtime},this.setHumanReadableTime=function(a){d.hrtime=a},this.setFullName=function(a){d.fullName=a.substring(0,127)},this.getFullName=function(){return d.fullName},this.getPacketId=function(){return d.packetId},this.setPacketId=function(a){d.packetId=a},this.getMessageText=function(a){return d.text},this.setMessageText=function(a){d.text=a},this.setStatus=function(a){d.status=a},this.getStatus=function(){return d.status},this.setMessageDate=function(a){d.messageDate=a},this.getMessageDate=function(){return d.messageDate},this.markAsDeleted=function(){d.isDeleted=!0},this.unMarkFromDeleted=function(){d.isDeleted=!1},this.getIsDeleted=function(){return d.isDeleted},this.setMessageDateString=function(a){d.messageDateString=a},this.setTimeout=function(a){d.timeout=a},this.setUserId=function(a){d.userId=a},this.getMessageDateString=function(){return d.messageDateString},this.getTimeout=function(){return d.timeout},this.getUserId=function(){return d.userId},this.getUser=function(){return c.getUser(d.userId)},this.getMessageType=function(){return d.type},this.setMessageType=function(a){return d.type=a},this.initUserObjects=function(){b.getUserDetailsByUId(d.userId).then(function(a){a&&(d.user=a)})},this.getSeenPacketSent=function(){return d.seenPacketSent},this.getDeliveredPacketSent=function(){return d.deliveredPacketSent},this.setSeenPacketSent=function(a){d.seenPacketSent=a},this.setDeliveredPacketSent=function(a){d.deliveredPacketSent=a},this.addSeenUserId=function(a){d.seenUsers.push(a)},this.addDeliveredUserId=function(a){d.deliveredUsers.push(a)},this.setUsersToChange=function(a){d.usersToChange=a},this.getUsersToChange=function(a){return d.usersToChange},this.setStatusType=function(a){d.statusType=a},this.getStatusType=function(){return d.statusType},this.getTagName=function(){return d.tagName},this.setTagName=function(a){d.tagName=a},this.serialize=function(){return{tagId:a.getTagId(),userId:a.getUserId(),user:a.getUserId(),packetId:a.getPacketId(),fullName:a.getFullName().utf8Encode(),status:a.getStatus(),statusType:a.getStatusType(),type:a.getMessageType(),hrtime:a.getHumanReadableTime(),messageDate:a.getMessageDate(),isDeleted:d.isDeleted,timeout:a.getTimeout(),text:a.getMessageText().utf8Encode(),seenPacketSent:a.getSeenPacketSent(),deliveredPacketSent:a.getDeliveredPacketSent(),usersToChange:Object.keys(d.usersToChange),messageType:a.getMessageType(),tag_chat:!0,tagName:a.getTagName()}}}var l=f.LOCAL_CHAT,m=f.API_VERSION_PORT_OFFSET;return i.prototype.copy=function(){var a=new i;return a.setTagId(this.getTagId()),a.setTagName(this.getTagName()),a.setPictureUrl(this.getPictureUrl()),a.setUserId(this.getUserId()),a.setPacketId(this.getPacketId()),a.setChatBindingPort(this.getChatBindingPort()),a.setChatIp(this.getChatIp()),a.setChatRegisterPort(this.getChatRegisterPort()),a.setServerDate(this.getServerDate()),a.setMembersObjectMap(this.getMembersObjectMap().copy()),a},i.prototype.update=function(a){a.getTagName()&&this.setTagName(a.getTagName()),a.getPictureUrl()&&this.setPictureUrl(a.getPictureUrl()),a.getUserId()&&this.setUserId(a.getUserId()),a.getPacketId()&&this.setPacketId(a.getPacketId()),a.getChatBindingPort()&&this.setChatBindingPort(a.getChatBindingPort()),a.getChatIp()&&this.setChatIp(a.getChatIp()),a.getChatRegisterPort()&&this.setChatRegisterPort(a.getChatRegisterPort()),a.getServerDate()&&this.setServerDate(a.getServerDate())},i.prototype.sortBy=function(){return this.getTagCreationTime()},k.prototype.update=function(a){a.getFullName()&&this.setFullName(a.getFullName()),a.getStatus()&&this.setStatus(a.getStatus()),a.getStatusType()&&this.setStatusType(a.getStatusType()),a.getMessageType()&&this.setMessageType(a.getMessageType()),a.getMessageDate()&&this.setMessageDate(a.getMessageDate()),a.getMessageText()&&this.setMessageText(a.getMessageText()),a.getUsersToChange()&&this.setUsersToChange(a.getUsersToChange()),a.getMessageType()&&this.setMessageType(a.getMessageType()),a.getSeenPacketSent()&&this.setSeenPacketSent(a.getSeenPacketSent()),a.getDeliveredPacketSent()&&this.setDeliveredPacketSent(a.getDeliveredPacketSent()),a.getDeliveredPacketSent()&&this.setDeliveredPacketSent(a.getDeliveredPacketSent()),a.getTimeout()&&this.setTimeout(a.getTimeout()),a.getIsDeleted()&&this.markAsDeleted(),a.getHumanReadableTime()||this.setHumanReadableTime(a.getHumanReadableTime())},{TagObject:i,TagMember:j,TagMessage:k}}var b=angular.module("ringid.tagchat");b.factory("tagChatModels",a),a.$inject=["$$stackedMap","profileFactory","userFactory","utilsFactory","Auth","TAG_CHAT_GENERAL_CONSTANTS","AUTH_SERVER_CONFIG","settings"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){var a=k.currentUser().getKey().toString(),b=(new Date).getTime().toString(),d=b.substr(0,c.TAG_ID_NO_OF_TIME_DIGIT);return d+=a.substr(a.length-c.TAG_ID_NO_OF_USER_ID_DIGIT)}function q(){return fa}function r(a){return fa.get(a)}function s(a){return fa.remove(a)}function t(a,b){return b||(b=new n.TagObject),a.tagId?b.setTagId(a.tagId):b.setTagId(p()),a.packetId&&b.setPacketId(a.packetId),a.userId&&b.setUserId(a.userId),a.tagName&&b.setTagName(a.tagName),a.tagPictureUrl&&b.setPictureUrl(a.tagPictureUrl),a.chIp&&b.setChatIp(a.chIp),a.chRp&&b.setChatRegisterPort(a.chRp),a.serverDate&&b.setServerDate(a.serverDate),a.tagMembersCount&&b.setMembersCount(a.tagMembersCount),b}function u(a,b,d){var e=new n.TagMember;return a&&e.setTagId(a),b&&(b.userId&&e.setId(b.userId),b.fullName&&e.setFullName(b.fullName),b.addedBy&&e.setAddedBy(b.addedBy),b.status?e.setStatus(b.status):e.setStatus(c.MEMBER_STATUS.MEMBER)),e}function v(a,b,c){var d=new n.TagMessage;return a&&d.setTagId(a),b&&(b.userId&&d.setUserId(b.userId),b.user&&d.setUserId(b.user),b.fullName&&d.setFullName(b.fullName),b.message&&d.setMessageText(b.message),b.hrtime&&d.setHumanReadableTime(b.hrtime),b.messageDate&&d.setMessageDate(b.messageDate),b.isDeleted&&d.markAsDeleted(b.isDeleted),b.messageDateString&&d.setMessageDateString(b.messageDateString),b.timeout&&d.setTimeout(b.timeout),b.messageType&&d.setMessageType(b.messageType),b.status&&d.setStatus(b.status),b.packetId&&d.setPacketId(b.packetId),b.usersToChange&&d.setUsersToChange(b.usersToChange),b.statusType&&d.setStatusType(b.statusType),b.tagName&&d.setTagName(b.tagName)),d}function w(a,b,c,d,e,f){var g={},i=r(b);if(i){var k;k=f.messageDate?f.messageDate:parseInt((new Date).getTime())+i.getServerDateDiff(),j.getUserDetailsByUId(c);var l=h.getUser(c);if(g={message:"",fullName:l.getName(),status:"status_update",statusType:d,tagName:f?f.tagName:"",messageDate:k,messageType:2,tag_chat:!0,userId:c,user:c,packetId:a},g.usersToChange={},e.length>0)for(var m=0;m<e.length;m++){var n=e[m],o=u(i.getTagId(),n,!0);g.usersToChange[o.getName()]=!0}var p=v(b,g);return p}return!1}function x(a){var b={key:a.key,text:a.text,messageType:a.messageType,messageDate:a.messageDate};return b}function y(a){if(!(a instanceof n.TagObject))return!1;var b=fa.get(a.getTagId());return b?b.update(a):fa.add(a.getTagId(),a),!0}function z(a,b){b||(b={tagId:a});var c=r(a);return c=c?t(b,c):t(b),fa.save(a,c),c}function A(a,b,c){return c||(c=r(a)),c=t(b,c),fa.save(a,c),c}function B(a,b){var c={tagId:a};b||(b={tagId:a});var d=r(a);d||(d=t(c),fa.save(a,d));var e=v(a,b,!0),f=d.getMessage(b.packetId);return f?f.update(e):(f=e,d.addMessage(f)),f}function C(a,b){ga[a]=b||(new Date).getTime()/1e3}function D(a){return ga[a]?!((new Date).getTime()/1e3-ga[a]>c.TAG_REGISTER_TIMEOUT):!1}function E(a){return!!ga[a]&&D(a)}function F(a){delete ga[a]}function G(a){C(a),l.triggerCustomEvent("tagregistered",{tagId:a})}function H(a){ha[a]=!0,setTimeout(function(){ha[a]=!1},c.API_FETCH_RETRY_DELAY)}function I(a){ha[a]=!1}function J(a){return!!ha[a]}function K(a,b){return a+"-"+b}function L(a,b){la&&(ia[a]=b,R(a))}function M(a){delete ia[a]}function N(a){return ia[a]}function O(a){return!!N(a)}function P(a,b){var c=K(a,b);return!!N(c)}function Q(a,b){var c=K(a,b);M(c)}function R(a){setTimeout(function(){M(a)},c.REQUEST_CACHE_VALIDITY)}function S(a,b){if(b.packetType==d.TAG_CHAT_DELIVERED||b.packetType==f.FRIEND_CHAT_DELIVERED||b.packetType==f.TAG_CHAT_SENT||b.packetType==f.FRIEND_CHAT_SENT){var c=a.split("_");2==c.length&&(b.packetId=c[0],b.sequenceNo=c[1])}return b.sequenceNo||(b.sequenceNo=0),a+"_"+b.sequenceNo+"_"+b.packetType}function T(a,b){var c=S(a,b);ja[c]=b,X(c)}function U(a){delete ja[a]}function V(a,b){var c=S(a,{packetType:b});U(c)}function W(a){var b=S(a.packetId,a);return ja[b]}function X(a){setTimeout(function(){U(a)},c.RESPONSE_CACHE_VALIDITY)}function Y(a,b){T(a,{packetType:b})}function Z(a,b){return!!W({packetId:a,packetType:b})}function $(a,b,c){var d={packetId:b,packetType:a,sequenceNo:c};return!!W(d)}function _(a,b,c){c||(c=0);var d=e[b];if(d){var f=!1;if(angular.isArray(d)){for(var g=0,h=d.length;h>g;g++)if($(d[g],a,c)){f=!0;break}}else f=$(d,a,c)}else;return f}function aa(a){return ka[a]}function ba(a,b){ka[a]=b}function ca(a){delete ka[a]}function da(a){if(a.actn){var b=a.tid||a.tagId,c=P(b,a.actn);return!c}}function ea(a,b){var c;return b||a?c=a:(a=(new Date).getTime(),c=parseInt(a+m.serverTimeDiff)),PacketIDGenerator.create(k.currentUser().getKey(),c,b)}var fa=a.createNew(!0),ga={},ha={},ia={},ja={},ka={},la=!0;return{createNewTag:t,createNewTagMember:u,createNewTagMessage:v,createTagStatusMessage:w,addTagObject:y,removeTagObject:s,getTags:q,getTag:r,generateNewTagId:p,getOrCreateTag:z,getOrCreateMessage:B,updateTag:A,getTagLastMessageObject:x,isTagRegistered:E,markTagAsRegistered:G,unRegisterTag:F,updateTagRegisteredTime:C,setTagChatInitiator:H,resetTagChatInitiator:I,isTagChatInitiator:J,setInTagChatRequestCache:L,resetInTagChatRequestCache:M,resetInTagChatRequestCacheForAuth:Q,getFromTagChatRequestCache:N,getAuthRequestKey:K,isInRequestCacheForAuth:P,isInRequestCacheForChat:O,setInTagChatResponseCache:T,resetFromTagChatResponseCache:V,getFromTagChatResponseCache:W,setInTagChatResponseCacheForAuth:Y,isInTagChatResponseCacheForAuth:Z,getIdleIntervalIdByTagId:aa,setIdleIntervalIdByTagId:ba,resetIdleIntervalIdByTagId:ca,hasReceivedConfirmation:_,shouldProcessRequest:da,startProcessingRequest:la,getUUIDPacketId:ea}}angular.module("ringid.tagchat").factory("tagChatFactory",a),a.$inject=["$$stackedMap","$$connector","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP","FRIEND_CHAT_PACKET_TYPE","AUTH_SERVER_ACTIONS","userFactory","friendsFactory","profileFactory","Auth","utilsFactory","CHAT_GLOBAL_VALUES","tagChatModels","tagChatPacketProcessor"]}(),function(){"use strict";function a(a,b,c){function d(){return"tagc-store-"+b.currentUser().getKey()}function e(b){a.setData(d(),angular.toJson(b))}function f(a,b){i.packets[a]=c.arrayBuffer2String(b.buffer.slice(6)),e(i)}function g(a){return c.string2ArrayBuffer(i.packets[a])}function h(){return i.packets}var i={packets:{}};return b.isLoggedIn(),{savePacket:f,getPacket:g,getAllPackets:h}}angular.module("ringid.tagchat").factory("tagChatStorage",a),a.$inject=["Storage","Auth","utilsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(a){var b=e.getOrCreateTag(a);b&&f.createOrGetTagFromAuth(b,b.getMemberUserIds()).then(function(a){a.isInitiated=!0,B(a)})}function A(a,b){var c=b.chIp,d=b.chRp,f=e.getTag(b.tid),g=j.getBoxByUId(b.tid);f.setChatIp(c),f.setChatRegisterPort(d),g&&(g.setIp(b.chIp),g.setRPort(b.chRp))}function B(a){a.sucs&&(A(a.tid,a),a.isInitiated?F(a.tid,r.REGISTRATION_TYPES.CHAT_INVITE):F(a.tid,r.REGISTRATION_TYPES.ONLY_REGISTER))}function C(){var b;a.subscribe(function(a){var c=a.tid;if(a.sucs&&e.startProcessingRequest)switch(a.actn){case p.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_START:if(e.isInRequestCacheForAuth(c,u.START_TAG_CHAT))return;if(e.isInTagChatResponseCacheForAuth(c,a.actn))return;var d=e.getTag(c);d?(A(c,a),e.isTagRegistered(c)||F(c)):(d=e.getOrCreateTag(c),b=j.getBoxByUId(c),b||(b=j.creatNonDomBox(c,!0)),A(c,a),S(c).then(function(a){a.sucs&&(e.isTagRegistered(c)||F(c))}));break;case p.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_ADD_MEMBER:if(e.isInRequestCacheForAuth(c,u.ADD_TAG_CHAT_MEMBERS))return;if(e.isInTagChatResponseCacheForAuth(a.tid,a.actn))return;e.setInTagChatResponseCacheForAuth(a.tid,a.actn);var d=e.getTag(c);d?e.isTagRegistered(c)||F(c):(d=e.getOrCreateTag(c),b=j.getBoxByUId(c),b||(b=j.creatNonDomBox(c,!0)),S(c).then(function(a){a.sucs&&(e.isTagRegistered(c)||F(c))})),a.uIds&&angular.forEach(a.uIds,function(a){d.addMember(e.createNewTagMember(d.getTagId(),{userId:a},!0))})}},{action:[p.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_START,p.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_ADD_MEMBER]})}function D(a,c){c||(c=e.getTag(a));var d=!1,g=b.defer(),h=m.getUniqueID(),i=function(){f.createOrGetTagFromAuth(c,c.getMemberUserIds(),h).then(function(a){a.sucs&&a.tid?(A(a.tid,a),d=!0):d=!1},function(a){d=!1})};return _(function(){d||i()},function(a){return d&&g.resolve(d),d},function(){g.resolve(d)},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY),g.promise}function E(a,b){var c=d.currentUser();return e.getFromTagChatRequestCache(a.getTagId())?!1:(f.registerTagInChatServer(c.getKey(),a,null,b),!0)}function F(a,b){if(!e.isTagRegistered(a)){var c=e.getTag(a);return c?c.membersLength()<2?-1:(c.hasChatRegisterPort()?E(c,b):e.isInRequestCacheForAuth(a,u.START_TAG_CHAT)||D(a,c).then(function(d){d&&(e.isTagRegistered(a)||(c=e.getTag(a),E(c,b)))}),!0):-1}return!1}function G(a){var c,g,h,i,j,k=d.currentUser(),l=b.defer();a.tagMembersCount=a.memberUIds.length+a.adminUIds.length+1,c=e.createNewTag(a),g={userId:k.getKey(),addedBy:k.getKey(),status:r.MEMBER_STATUS.OWNER},h=e.createNewTagMember(c.getTagId(),g,!0),c.addMember(h);for(var m=0;m<a.memberUIds.length;m++){var n=a.memberUIds[m];g={userId:n,addedBy:k.getKey(),status:r.MEMBER_STATUS.MEMBER},h=e.createNewTagMember(c.getTagId(),g,!0),c.addMember(h)}for(var o=0;o<a.adminUIds.length;o++){var p=a.adminUIds[o];i={userId:p,addedBy:k.getKey(),status:r.MEMBER_STATUS.ADMIN},j=e.createNewTagMember(c.getTagId(),i,!0),c.addMember(j)}c.setObjectLock(),e.addTagObject(c),a.uIds=a.adminUIds.concat(a.memberUIds);var q=function(){f.createOrGetTagFromAuth(c,a.uIds).then(function(a){a.isInitiated=!0,B(a)})},s=function(){q()};try{var t,u,w;t=f.getTagCreateRequestObject(k.getKey(),c),u=new ca,u.setPacketObject(t),u.setBrokenPacketType(v.OFFLINE_BROKEN_PACKET),w=u.getInstance(),w.on("success",function(a){a.sucs&&(c.removeObjectLock(),s(),l.resolve({sucs:!0}))}),w.on("failure",function(a){e.removeTagObject(c.getTagId()),l.reject({sucs:!1,msg:"Unable create tag in offline server."})}),w.start()}catch(x){e.removeTagObject(c.getTagId()),l.reject({sucs:!1,msg:"Unable create tag in offline server."})}return l.promise}function H(a,b,c){var f,g,h,i,j,k,m,n,o,p=d.currentUser(),q=[],s=[],t=[],u=[],v=[],w=[],x={},y={},z={};f=a.getMembersObjectMap().copy(),g=f,h=g.all(),angular.forEach(b,function(a){x[a]=!0}),angular.forEach(c,function(a){y[a]=!0});for(var A=0;A<h.length;A++)i=h[A].value,i.isOwner()||(z[i.getId()]=!0,y[i.getId()]||x[i.getId()]?(j=!1,i.isAdmin()?x[i.getId()]&&(i.makeMember(),j=!0):i.isMember()&&y[i.getId()]&&(i.makeAdmin(),j=!0),j&&(s.push(i.serialize()),w.push(i))):(q.push(i.serialize()),v.push(i)));return angular.forEach(b,function(b){z[b]||b===p.getKey()||(k=l.getUser(b),m=e.createNewTagMember(a.getTagId(),{userId:b,addedBy:p.getKey(),fullName:k.getName(),status:r.MEMBER_STATUS.MEMBER},!0),u.push(m),t.push(m.serialize()))}),angular.forEach(c,function(b){z[b]||b===p.getKey()||(n=l.getUser(b),o=e.createNewTagMember(a.getTagId(),{userId:b,addedBy:p.getKey(),fullName:n.getName(),status:r.MEMBER_STATUS.ADMIN},!0),u.push(o),t.push(o.serialize()))}),{serializedMemberAdminsToRemove:q,serializedMemberAdminsToStatusChange:s,serializedNewMemberAdminsToAdd:t,membersAdminToAddOnSuccess:u,membersAdminToRemoveOnSuccess:v,membersAdminToUpdateOnSuccess:w}}function I(a,b,c,d,e,f){return d.length>0||e.length>0||f.length>0||a.getTagName()!==b||a.getPictureUrl()!==c}function J(a,c,g){var i,j,k,l,m,n=d.currentUser(),o=b.defer();if(c.length>0){i=!1,j=c.keyValues("userId"),f.addTagMembersInAuth(a,j).then(function(a){},function(a){o.reject({sucs:!1,mg:"Auth Update Failed"}),i=!0}),k=e.getUUIDPacketId(),l=!1;var p=y.getChatServerCurrentTime();_(function(){if(!l){var b=F(a.getTagId(),r.REGISTRATION_TYPES.ONLY_REGISTER),d=function(){f.addTagMemberInChatServer(n.getKey(),a,c,k)};ba(a.getTagId(),d,null,!b)}},function(b){return i?(o.reject({sucs:!1,mg:"Failed to send tag new member add packet to auth server."}),!0):(m=aa(k,s.TAG_CHAT_TAG_MEMBER_ADD),m&&!l&&(l=!0,angular.forEach(g,function(b){a.addMember(b)}),a.setMembersCount(a.getMembersCount()+g.length),h.showTagMembersAddStatusMessage(a.getTagId(),n.getKey(),c,p,k),o.resolve({sucs:!0,mg:"Member( "+g.length+" ) Added in "+a.getTagName()})),m)},function(){o.reject({sucs:!1,mg:"Unable to send tag new member add packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)}else o.resolve({sucs:!1});return o.promise}function K(a,c,g){var i,j,k=d.currentUser(),l=b.defer();if(c.length>0){i=e.getUUIDPacketId(),j=!1;var m=y.getChatServerCurrentTime();_(function(){if(!j){var b=F(a.getTagId(),r.REGISTRATION_TYPES.ONLY_REGISTER),d=function(){f.removeTagMembersFromChatServer(k.getKey(),a,c,i)};ba(a.getTagId(),d,null,!b)}},function(b){var d=aa(i,s.TAG_CHAT_MEMBER_REMOVE_LEAVE);return d&&!j&&(j=!0,angular.forEach(g,function(b){a.removeMember(b)}),a.setMembersCount(a.getMembersCount()-g.length),h.showTagMembersRemoveStatusMessage(a.getTagId(),k.getKey(),c,m,i),l.resolve({sucs:!0,mg:"Member( "+g.length+" ) Removed from "+a.getTagName()})),d},function(){l.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)}else l.resolve({sucs:!1});return l.promise}function L(a,c,g){var i,j,k,l=d.currentUser(),m=b.defer(),n=y.getChatServerCurrentTime();return c.length>0?(i=e.getUUIDPacketId(),j=!1,k={},_(function(){if(!j){var b=F(a.getTagId(),r.REGISTRATION_TYPES.ONLY_REGISTER),d=function(){k=f.changeTagMemberStatusInChatServer(l.getKey(),a,c,i)};ba(a.getTagId(),d,null,!b)}},function(b){var d=aa(i,s.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE);return d&&!j&&(j=!0,angular.forEach(g,function(b){a.updateMember(b)}),h.showMemberTypeChangeStatusMessage(a.getTagId(),l.getKey(),c,n,i),m.resolve({sucs:!0,mg:"Member( "+g.length+" ) Status Updated for "+a.getTagName()})),d},function(){m.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)):m.resolve({sucs:!1}),m.promise}function M(a,c,g){var i,j,k,l,m,n,o=d.currentUser(),p=b.defer(),q=a.getTagName(),t=a.getPictureUrl(),u=a.getTagName()!==c,v=a.getPictureUrl()!==g,w={},x=u||v;return x?(i=h.getTagInfoChangeStatusMessage(a.getTagId(),{tagName:c||"",tagPictureUrl:g||""}),u&&(a.setTagName(c),j=r.TAG_ACTIVITY_TYPE.TAG_RENAME,k=e.getUUIDPacketId(),l=!1,_(function(){if(!l){var b=F(a.getTagId(),r.REGISTRATION_TYPES.ONLY_REGISTER),c=function(){w=f.sendTagInformationToChatServer(o.getKey(),a,j,k)};ba(a.getTagId(),c,null,!b)}},function(b){var d=aa(k,s.TAG_CHAT_TAG_INFORMATION);return d&&!l&&(l=!0,h.showTagInfoChangeStatusMessage(a.getTagId(),o.getKey(),{statusMessageType:i,tagName:c
}),p.resolve({sucs:!0,mg:"Updated Group Info of "+a.getTagName()})),d},function(){u&&a.setTagName(q),p.reject({sucs:!1,mg:"Unable to send tag info tag name change packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)),v&&(a.setPictureUrl(g),j=r.TAG_ACTIVITY_TYPE.TAG_URL_RENAME,m=e.getUUIDPacketId(),n=!1,_(function(){if(!n){var b=F(a.getTagId(),r.REGISTRATION_TYPES.ONLY_REGISTER),c=function(){w=f.sendTagInformationToChatServer(o.getKey(),a,j,m)};ba(a.getTagId(),c,null,!b)}},function(b){var d=aa(k,s.TAG_CHAT_TAG_INFORMATION);return d&&!n&&(n=!0,h.showTagInfoChangeStatusMessage(a.getTagId(),o.getKey(),{statusMessageType:i,tagName:c}),p.resolve({sucs:!0,mg:"Updated Group Info of "+a.getTagName()})),d},function(){v&&a.setPictureUrl(t),p.reject({sucs:!1,mg:"Unable to send tag info tag picture url packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY))):p.resolve({sucs:!1}),p.promise}function N(a,c,e,f,g){function h(){J(a,j,k).then(function(a){a.sucs&&(s++,p.notify(a))},p.reject),K(a,l,m).then(function(a){a.sucs&&(s++,p.notify(a))},p.reject),L(a,n,o).then(function(a){a.sucs&&(s++,p.notify(a))},p.reject),M(a,c,e).then(function(a){a.sucs&&(s++,p.notify(a))},p.reject)}var i,j,k,l,m,n,o,p=(d.currentUser(),b.defer());i=H(a,f,g),j=i.serializedNewMemberAdminsToAdd,k=i.membersAdminToAddOnSuccess,l=i.serializedMemberAdminsToRemove,m=i.membersAdminToRemoveOnSuccess,n=i.serializedMemberAdminsToStatusChange,o=i.membersAdminToUpdateOnSuccess;var q=!1;I(a,c,e,j,l,n)?q=F(a.getTagId(),r.REGISTRATION_TYPES.ONLY_REGISTER):p.resolve({sucs:!1});var s=0;return q?ba(a.getTagId(),function(){h()},!q):h(),setTimeout(function(){s?p.resolve({sucs:!0}):p.reject({sucs:!1})},18e3),p.promise}function O(a){var b=e.getTag(a),c=b.getMember(d.currentUser().getKey());return P(a,[c.serialize()],[c])}function P(a,c,g){var h=d.currentUser(),i=b.defer(),j=e.getTag(a),k=!1,l=function(){var b=e.getUUIDPacketId(),d=!1;_(function(){j=e.getTag(a);var d=function(){f.removeTagMembersFromChatServer(h.getKey(),j,c,b)};d()},function(c){var f=aa(b,s.TAG_CHAT_MEMBER_REMOVE_LEAVE);if(f&&!d){d=!0,j=e.getTag(a);for(var k="Member( "+g.length+" ) Removed from "+j.getTagName(),l=0;l<g.length;l++){var m=g[l];m.getId()===h.getKey()&&(k="You left from ("+j.getTagName()+") conversation ",i.resolve({sucs:!0,mg:k})),j.removeMember(m)}i.resolve({sucs:!0,mg:k})}return f},function(){i.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)},m=F(a,r.REGISTRATION_TYPES.ONLY_REGISTER);return m?ba(a,function(){l()},!m):l(),setTimeout(function(){k?i.resolve({sucs:!0}):i.reject({sucs:!1})},25e3),i.promise}function Q(a,c,g){var h=d.currentUser(),i=b.defer(),j=e.getTag(a),k=!1,l=F(a,r.REGISTRATION_TYPES.ONLY_REGISTER),m=function(){var a=e.getUUIDPacketId(),b=!1;_(function(){var b=function(){f.changeTagMemberStatusInChatServer(h.getKey(),j,c,a)};b()},function(d){var e=aa(a,s.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE);return e&&!b&&(b=!0,angular.forEach(g,function(a){j.updateMember(a)}),i.resolve({sucs:!0,mg:"Member( "+c.length+" ) Status Updated for "+j.getTagName()})),e},function(){i.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)};return l?ba(a,function(){m()},!l):m(),setTimeout(function(){k?i.resolve({sucs:!0}):i.reject({sucs:!1})},25e3),i.promise}function R(a,b){var c,g=d.currentUser();b||(b=e.getTag(a)),c=e.getIdleIntervalIdByTagId(a),c&&(clearInterval(c),e.resetIdleIntervalIdByTagId(a)),e.setIdleIntervalIdByTagId(a,c),c=setInterval(function(){var d=Math.floor(Date.now()/1e3),h=d-b.getLastCommunicationTime();h<r.BOX_WAITING_TIME?f.sendTagIdlePacket(g.getKey(),b):(clearInterval(c),e.resetIdleIntervalIdByTagId(a))},r.UDP_SERVER_KEEP_ALIVE_INTERVAL)}function S(a){var c,g,h=b.defer(),i=d.currentUser(),j=a+"-"+v.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS;return c=h.promise,e.isInRequestCacheForChat(j)&&(c={sucs:!1,timeout:!1}),e.setInTagChatRequestCache(j,{}),g=e.getUUIDPacketId(),_(function(){f.getTagInformationWithMemberFromOfflineServer(i.getKey(),a,g)},function(){var b=aa(g,v.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS),c=e.getTag(a);return c.membersLength()?(b&&h.resolve({sucs:!0,timeout:!1}),b):(e.resetFromTagChatResponseCache(g,v.OFFLINE_TAG_INFORMATION_WITH_MEMBERS),!1)},function(){h.resolve({sucs:!1,timeout:!0})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY),b.when(c)}function T(a,b,c){var g=d.currentUser(),h=g.getKey();_(function(){var b=e.getTag(a);f.sendTagMsgDeliveredPacket(h,b,c)},function(a){var c=aa(b,s.TAG_CHAT_DELIVERED);return c},function(){},r.API_FETCH_RETRY_COUNT-2,r.API_FETCH_RETRY_DELAY)}function U(a,b,c){var e=d.currentUser(),g=e.getKey();_(function(){f.sendFriendChatDeliveryPacket(b,g,a,c)},function(a){var b=aa(c,w.FRIEND_CHAT_DELIVERED);return b},function(){},r.API_FETCH_RETRY_COUNT-2,r.API_FETCH_RETRY_DELAY)}function V(a,b,c){c?a.call():setTimeout(a,b)}function W(a,b,c,d){var e,f=0;d||(d=r.API_FETCH_RETRY_COUNT),c&&(a.call(),f=1),e=setInterval(function(){f++,a.call(),f===d&&clearInterval(e)},b)}function X(a){_(function(){var b=e.getTag(a);if(b&&b.isTagSafeToShow()){var c=j.getBoxByUId(a);Y(a,c)}},function(b){var c=e.getTag(a);return!(!c||!c.isTagSafeToShow())},function(){},5,5e3)}function Y(a,b){var c=!1;if(!b){c=!0;var d=e.getOrCreateTag(a);if(d.isTagSafeToShow()){j.openTagChatBox(a),b=j.getBoxByUId(a);var g=d.getMemberUserIds();e.isTagRegistered(a)?(b.setIp(d.getChatIp()),b.setRPort(d.getChatRegisterPort()),b.setPort(d.getChatBindingPort()),b.setTitle(d.getTagName())):f.createOrGetTagFromAuth(d,g||[]).then(function(a){var c=e.getTag(a.tid);c.setChatIp(a.chIp),c.setChatRegisterPort(a.chRp),b.setIp(a.chIp),b.setRPort(a.chRp)})}else b=j.creatNonDomBox(a,!0),b.setIp(d.getChatIp()),b.setRPort(d.getChatRegisterPort()),b.setPort(d.getChatBindingPort()),b.setTitle(d.getTagName())}return c&&b.loadHistoryMessages(),b}function Z(a,b){var c=(d.currentUser(),function(){for(b||(b=j.getBoxByUId(a));angular.isArray(b.tempMessageArray)&&b.tempMessageArray.length>0;){var c=b.tempMessageArray.shift();c.ip=b.getIp(),c.port=b.getPort()}});setTimeout(c,1e3)}function $(a){var b=e.getTag(a);b&&f.sendTagIdlePacket(d.currentUser().getKey(),b)}var _=m.callXTimeAfterYIntervalStopOnSuccess,aa=e.hasReceivedConfirmation,ba=i.executeAfterTagRegisterEvent,ca=x.ChatPacketSender;return m.onCustomEvent("tagChatNoIpOrPort",function(a){F(a.tagId,r.REGISTRATION_TYPES.ONLY_REGISTER)}),m.onCustomEvent("RE_REGISTER_TAG",function(a){e.unRegisterTag(a.tagId),F(a.tagId,r.REGISTRATION_TYPES.CHAT_INVITE)}),m.onCustomEvent("DO_TAG_REQUEST_FOR_IP",function(a){z(a.tagId)}),{createTag:G,updateTag:N,leaveFromTag:O,removeTagMember:P,changeTagMemberStatus:Q,subscribeForAuthUpdate:C,doOnTagChatRequestStartResponse:B,registerTag:F,initTagIdleInterval:R,openTagChatBoxIfClosed:Y,openPreviouslyOpenedBoxes:X,requestForTagInformationMultipleTimes:S,sendTagMessageDeliveryPacketMultipleTimes:T,sendFriendMessageDeliveryPacketMultipleTimes:U,sendTemporaryStoredMessages:Z,sendTagIdlePacket:$,requestForIp:z,getIpPortForTag:D,executeXTimesAfterY:W,executeAfterX:V}}angular.module("ringid.tagchat").factory("tagChatManager",a),a.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatApiService","tagChatPacketProcessor","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","utilsFactory","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","TAG_CHAT_LANG","AUTH_SERVER_ACTIONS","OFFLINE_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","chatPacketResender","chatUtilsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=m.callXTimeAfterYIntervalStopOnSuccess,A=e.hasReceivedConfirmation,B=(i.executeAfterTagRegisterEvent,x.ChatPacketResender),C=x.ChatPacketSender,D=function(a,b){var c=a+"-"+b;return e.isInRequestCacheForChat(c)?!0:(e.setInTagChatRequestCache(c,{}),!1)},E=function(){var a=d.currentUser(),b=w.OFFLINE_GET_REQUEST,c=v.offlineUpdateTime;if(!D(0,b)){var g=y.getChatServerCurrentTime(),h=e.getUUIDPacketId();z(function(){f.sendOfflineGetRequest(a.getKey(),c,h)},function(){var a=A(h,w.OFFLINE_GET_REQUEST);return a&&(v.offlineUpdateTime=g),a},function(){},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY)}},F=function(a,c,g,h){var i=b.defer(),j=i.promise,h=h||10,k=d.currentUser(),l=w.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,m=a;g&&(m+="-"+g),D(m,l)&&(j={sucs:!1});var n=g||e.getUUIDPacketId();return z(function(){f.sendHistoryMessageGetRequest(k.getKey(),a,c,n,h)},function(){var a=A(n,w.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST);return a&&i.resolve({sucs:!0}),a},function(){i.reject({sucs:!1})},r.API_FETCH_RETRY_COUNT,r.API_FETCH_RETRY_DELAY),b.when(j)},G=function(a,c,g,h){var i=b.defer(),j=i.promise,h=h||10,k=d.currentUser(),l=k.getKey(),m=w.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,n=a;g&&(n+="-"+g),D(n,m)&&(j={sucs:!1});var o=g||e.getUUIDPacketId(),p=f.getFriendHistoryMessageGetRequestObject(l,a,c,o,h),q=new B;return q.setPacketType(m),q.setPacketId(o),q.setPacketObject(p),q.on("success",function(a){i.resolve(a)}),q.on("failure",function(a){i.reject(a)}),q.start(),b.when(j)},H=function(a,b){var c=e.getUUIDPacketId(),d=f.getTagUnreadMessageConfirmationObject(a,c,b);try{var g=new C;g.setPacketObject(d),g.setBrokenPacketType(d.packetType),g.setIgnoreConfirmation(!0),g.getInstance().start()}catch(h){}},I=function(a,b,c){var d=f.getFriendUnreadMessageConfirmationObject(a,b,c);try{var e=new C;e.setPacketObject(d),e.setBrokenPacketType(d.packetType),e.setIgnoreConfirmation(!0),e.getInstance().start()}catch(g){}},J=function(a){var b;return b=a.isTagChat?F:G};return{getUnreadMessagesMultipleTimes:E,getHistoryMessagesMultipleTimes:F,getFriendHistoryMessagesMultipleTimes:G,getHistoryRequestMethodByBox:J,sendTagUnreadMessageConfirmation:H,sendFriendUnreadMessageOfflineConfirmation:I}}angular.module("ringid.tagchat").factory("tagOfflineChatManager",a),a.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatApiService","tagChatPacketProcessor","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","utilsFactory","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","TAG_CHAT_LANG","AUTH_SERVER_ACTIONS","CHAT_GLOBAL_VALUES","OFFLINE_PACKET_TYPE","chatPacketResender","chatUtilsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){function C(a){try{a.call()}catch(b){}}function D(a){return Xa[a]}function E(a){var b=l.getFromTagChatResponseCache(a);return b?!0:(l.setInTagChatResponseCache(a.packetId,a),!1)}function F(a){return H(null,{byteData:a})}function G(a,b){k.getPacketName(a)}function H(a,b){var c=b.byteData,e=d.getPacketType(c),f=D(e);if(!f)return!1;var g=k.parseRawPacket(c);return Va&&Wa&&G(e,g),!l.startProcessingRequest||!g||g.packetId&&E(g)?void 0:(C(function(){Va&&!Wa&&G(e,g),f.processor.call(this,g)}),f.scopeUpdate)}function I(d){if(d.fromHistory||!h.isInLocalStorageChatMsgMap(d.packetId)){var f,i=(d.friendId,d.packetId),k=d.userId,l=d.boxId,m=!d.fromHistory,o=g.currentUser().getKey();l||(l=d.userId),l==o&&(l=d.friendId,m=!1);var p=b.getBoxByUId(l);if(d.fromHistory||d.messageType!==j.MESSAGE_TYPES.DELETE_MESSAGE)d.messageType>j.MESSAGE_TYPES.BLANK_MESSAGE&&(p?d.fromHistory||(p.nonDomBox=!0):(b.openChatBox(l),w.requestForIp(l),u.loadHistoryMessageForF2FChat(l,p)),p=b.getBoxByUId(l),C(function(){p.setFriendTypingBool(!1),d.fromHistory?d.seenSent=!0:f="bottom",d.fromHistory&&d.fromOffline||(Ma(k,p),p&&!p.isFocused?(d.status="Unread",f="unread"):d.status=d.status||"Received"),d.tag_chat=!1;var g=p.getKey();if("Edited"==d.status||!p.isSamePacketId(i)){if(d.user=c.getUserObjectByUId(k),"Unread"==d.status&&(b.increaseUnreadMessageCount(l,d.packetId),p.updateUnreadCount()),p.pushMessage(d,p.getKey()),m&&(n.sendFriendMessageDeliveryPacketMultipleTimes(g,p,i),p.isFocused)){var j=[{key:d.packetId,value:p.getMessage(d.packetId)}];z.sendSeenPacket(p,j),e.triggerCustomEvent("WAS_FOCUSED",{box:p,filteredMessages:j})}h.updateBox(p)}d.fromHistory||e.triggerCustomEvent(a.CHAT.MESSAGE_RECEIVED,{boxId:l,scroll:f})}));else if(d.userId==o)p&&p.removeMessage(i),h.removeMessage(i,l);else{var q;q=p?p.getMessage(i):h.getMessage(l,i),q&&(q.text="This message has been deleted",q.status="Deleted",h.updateMessage(q,l))}}}function J(a){a.status="Edited",I(a)}function K(a){var c=a.sequenceNo,d=a.packetId+"_"+c;if(!Ya[d]){Ya[d]=a,Ra(a.packetId,a.packetsLength)&&C(function(){var b=Sa(a.packetId,a.packetsLength);b.originPacketType?J(b):(b.originPacketType=s.FRIEND_CHAT_BROKEN_MSG,I(b)),Ta(a.packetId,a.packetsLength)});var e=d,f=g.currentUser().getKey(),h=a.userId,i=b.getBoxByUId(h);i?m.sendFriendChatDeliveryPacket(i,f,h,e):(w.requestForIp(h),u.executeAfterRegisterEvent(h,function(){var a=b.getBoxByUId(h);m.sendFriendChatDeliveryPacket(a,f,h,e)}))}}function L(a){a.originPacketType=i.TAG_CHAT_BROKEN_MSG_EDIT,K(a)}function M(a){}function N(a){}function O(a){}function P(a){var b=g.currentUser(),c=b.getKey(),d=a.tagId;q.serverTimeDiff=a.serverDate-Date.now();var f=l.getOrCreateTag(d);if(f){if(f.setChatBindingPort(a.chatBindingPort),l.markTagAsRegistered(f.getTagId()),l.isTagChatInitiator(d)){var h=p.getTagEmptyMessageObject(d);m.sendTagMsgInChatServer(c,f,h,!0)}var i=La(d,f);i.setPort(a.chatBindingPort),Ma(d,i,f),i.clearAfterRegisterInterval(),i.stopInterval(),u.sendAfterRegisterIdlePacket(d,i),x.sendTemporaryMessages(i),e.triggerCustomEvent("taglistupdated")}}function Q(a){var b,c,d=g.currentUser(),f=(d.getKey(),a.tagId),c=La(f,b);a.fromHistory||a.fromOffline||(b=l.createNewTag(a),l.addTagObject(b),Ma(f,c,b),l.addTagObject(b),a.tagMembers.length>0&&Na(b,a.tagMembers,a.userId)),c.updateBoxMessageMinMaxPacketId(a),e.triggerCustomEvent("taglistupdated")}function R(a){}function S(a){var b,c,d,f,h=g.currentUser(),i=h.getKey(),j=a.tagId;if(b=a.packetId,c=l.getTag(j),c?(o.showTagInfoChangeStatusMessage(j,a.userId,a),a.fromHistory||(d=l.updateTag(j,a,c))):a.fromHistory||(d=l.createNewTag(a),l.addTagObject(d)),!a.fromHistory&&!a.fromOffline){var f=La(j,d);Ma(j,f,d),m.sendTagInformationConfirmation(i,d,b)}e.triggerCustomEvent("taglistupdated")}function T(a){}function U(a){var b,c,d=g.currentUser(),e=d.getKey(),f=a.tagId;b=l.getOrCreateTag(f),o.showTagMembersAddStatusMessage(f,a.userId,a.tagMembers,a.messageDate,a.packetId,b),b&&!a.fromHistory&&(Na(b,a.tagMembers,a.userId),c=La(f,b),Ma(f,c,b),m.sendTagMemberAddConfirmation(e,b,a.packetId))}function V(a){}function W(a){if(a.tagMembers){var b,c,d,e,f=g.currentUser(),h=f.getKey(),i=a.tagId;c=a.packetId,delete a.packetId,d=l.getOrCreateTag(a.tagId),o.showTagMembersRemoveStatusMessage(a.tagId,a.userId,a.tagMembers,a.messageDate,c,d),a.fromHistory||(e=Oa(d,a.tagMembers),e&&Qa(i),b=La(i,d),Ma(i,b,d),m.sendTagChatMemberRemoveLeaveConfirmation(h,d,c))}}function X(a){var b=g.currentUser(),c=b.getKey(),d=a.tagId;a.userId===c&&l.unRegisterTag(d)}function Y(b){if(b.tagMembers){var c,d,f=g.currentUser(),h=(f.getKey(),b.tagId);d=l.getOrCreateTag(h),o.showMemberTypeChangeStatusMessage(h,b.userId,b.tagMembers,b.messageDate,b.packetId),b.fromHistory||(Pa(d,b.tagMembers),c=La(h,d),Ma(h,c,d)),e.triggerCustomEvent(a.CHAT.MESSAGE_RECEIVED,{boxId:h})}}function Z(a){}function $(a){}function _(b){var c,d,g=b.tagId;d=l.getTag(g),C(function(){d&&(c=La(g,d),c&&(Ma(g,c,d),c.setFriendTypingBool(!0),f(function(){c.setFriendTypingBool(!1)},3e3),h.updateBox(c),e.triggerCustomEvent(a.CHAT.MESSAGE_RECEIVED,{boxId:g})))})}function aa(d){if(d.fromHistory||!h.isInLocalStorageChatMsgMap(d.packetId)){var f=d.tagId,i=l.getTag(f);i||(n.requestForTagInformationMultipleTimes(f),i=l.getOrCreateTag(f));var k,m=b.getBoxByUId(f);if(d.messageType===j.MESSAGE_TYPES.DELETE_MESSAGE){if(d.userId==g.currentUser().getKey())m&&m.removeMessage(d.packetId),h.removeMessage(d.packetId,f);else{var o;o=m?m.getMessage(d.packetId):h.getMessage(f,d.packetId),o&&(o.text="This message has been deleted",o.status="Deleted",h.updateMessage(o,f))}m&&m.removeMessage(d.packetId),h.removeMessage(d.packetId,d.tagId)}else d.fromHistory||d.fromUnread||!d.fromOffline||d.messageType!==j.MESSAGE_TYPES.BLANK_MESSAGE||l.isTagRegistered(d.tagId)||!p.hasChatSession(d.messageDate)?d.messageType>j.MESSAGE_TYPES.BLANK_MESSAGE&&(m=n.openTagChatBoxIfClosed(d.tagId,m),C(function(){d.fromHistory||(k="bottom"),d.fromHistory&&d.fromOffline||(m&&!m.isFocused?(d.status="Unread",k="unread"):d.status=d.status||"Received"),d.tag_chat=!0;var f=m.getKey();if(!m.isSamePacketId(d.packetId)){d.user=c.getUserObjectByUId(d.userId),!d.fromHistory&&i&&i.isTagSafeToShow()&&(m.nonDomBox=!0,Ma(f,m));var g=l.getOrCreateMessage(d.tagId,d);if(g.setStatus(d.status),d.fromHistory?d.seenSent=!0:"Unread"==g.getStatus()&&(b.increaseUnreadMessageCount(f,d.packetId),m.updateUnreadCount()),m.pushMessage(d,m.getKey()),!d.fromOffline){var j=d.packetId;n.sendTagMessageDeliveryPacketMultipleTimes(d.tagId,j,g)}e.triggerCustomEvent(a.CHAT.MESSAGE_RECEIVED,{boxId:f,scroll:k}),h.updateBox(m)}})):n.requestForTagInformationMultipleTimes(d.tagId)}}function ba(a){a.status="Edited",aa(a)}function ca(a){var b=a.sequenceNo,c=a.packetId+"_"+b;Ya[c]||(Ya[c]=a,Ra(a.packetId,a.packetsLength)&&C(function(){var b=Sa(a.packetId,a.packetsLength);b.originPacketType?ba(b):(b.originPacketType=i.TAG_CHAT_BROKEN_MSG,aa(b))}))}function da(a){a.originPacketType=i.TAG_CHAT_BROKEN_MSG_EDIT,ca(a)}function ea(a){}function fa(a){var b=a.tagId,c=l.getTag(a.tagId),d=La(b,c);C(function(){Ma(b,d,c);var e=d.getMessage(a.packetId);if(e&&("Seen"!==e.status&&(e.status="Delivered"),h.updateMessage(e,d.getKey())),c){var f=c.getMessage(a.packetId);f&&"Seen"!==f.getStatus()&&f.setStatus("Delivered")}h.updateBox(d)})}function ga(a){var c,d,e=a.tagId;c=l.getTag(e),d=b.getBoxByUId(e),C(function(){d=La(e,d),Ma(e,d,c);var b=d.updateMessageStatus(a.packetId,"Sent");if(b&&h.updateMessage(b,d.getKey()),c){var f=c.getMessage(a.packetId);f&&f.setStatus("Sent")}h.updateBox(d)})}function ha(a){var c,d,e=a.tagId;c=l.getTag(e),d=b.getBoxByUId(e),C(function(){Ma(e,d,c),d=La(e,d);var b=d.updateMessageStatus(a.packetId,"Seen");if(b&&h.updateMessage(b,d.getKey()),c){var f=c.getMessage(a.packetId);f&&f.setStatus("Seen")}h.updateBox(d)})}function ia(a){}function ja(a){var b=g.currentUser(),c=b.getKey();if(angular.isArray(a.packets)){Ga(a.tagId,a.userId,a.packets);var d=l.getTag(a.tagId);d&&m.sendTagChatMsgDeleteConfirmation(c,d,a.packetId,a.userId)}}function ka(a){var b=l.getFromTagChatRequestCache(a.packetId);b&&Ga(a.tagId,a.userId,b.packets)}function la(a){var b,c,d,e=g.currentUser(),f=e.getKey(),h=a.tagId;b=Ha(a),b&&(d=l.getTag(h),m.sendTagGeneralBrokenPacketConfirmation(f,d,a.packetId,a.sequenceNo),c=La(h))}function ma(a){}function na(a){}function oa(a){for(var b=g.currentUser(),c={},d=b.getKey(),f=a.packetId,h=[],i=0;i<a.messages.length;i++){var k=a.messages[i];k.fromOffline=!0,k.status="Unread",I(k),c[k.userId]=!0,k.messageType!=j.MESSAGE_TYPES.BLANK_MESSAGE&&h.push(k.packetId)}for(var l=Object.keys(c),i=0,m=l.length;m>i;i++)e.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:l[i]});h.length>0&&v.sendFriendUnreadMessageOfflineConfirmation(d,f,h)}function pa(a){var c=g.currentUser(),d=c.getKey(),f=a.packetId,h=a.friendId,i=[],k=b.getBoxByUId(h);if(k||(k=b.creatNonDomBox(h)),a.messages.length||a.pageDirection==j.PAGE_DIRECTION.DOWN){for(var n=y.getChatServerCurrentTime(),o=n,p=!1,q=0;q<a.messages.length;q++){var r=a.messages[q];r.messageType==j.MESSAGE_TYPES.HISTORY_RE_FETCH?Ia(h,j.PAGE_DIRECTION.UP,f):r.messageType!=j.MESSAGE_TYPES.DELETE_MESSAGE&&(p=!0,r.userId.toString()===d.toString()?(r.status=Ja(r.status)||"Delivered",r.friendId=h):(r.status="Received",r.friendId=d),r.boxId=h,r.fromOffline=!0,r.fromHistory=!0,I(r)),r.messageDate<o&&(o=r.messageDate),i.push(r.packetId)}if(p)k.hasHistoryMessage=!0,e.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:h});else if(o!=n){var s=l.getUUIDPacketId(o,!0);Ia(h,j.PAGE_DIRECTION.UP,s)}}else k.hasHistoryMessage=!1;m.sendFriendHistoryMessageOfflineConfirmation(d,h,f)}function qa(a){}function ra(a){var b=g.currentUser(),c=b.getKey(),d=a.packetId,e=a.tagId;if(a.items.length>0)for(var f=0,h=a.items.length;h>f;f++){var i=a.items[f];Da(e,d,i)}m.sendTagOfflineConfirmation(c,e,d)}function sa(a){for(var b,c=g.currentUser(),d=c.getKey(),f=a.packetId,h=0;h<a.items.length;h++)b=l.createNewTag(a.items[h]),l.addTagObject(b),setTimeout(function(a){n.requestForTagInformationMultipleTimes(a).then(function(b){!b.sucs&&b.timeout&&n.requestForTagInformationMultipleTimes(a)})}.bind(this,b.getTagId()),100);e.triggerCustomEvent("MY_TAG_LIST_RECEIVED"),m.sendTagOfflineConfirmation(d,0,f)}function ta(a){for(var b=g.currentUser(),c=b.getKey(),d=(a.packetId,[]),e=0;e<a.messages.length;e++){var f=a.messages[e];f.status="Unread",f.fromUnread=!0,f.fromOffline=!0,f.messageType==j.MESSAGE_TYPES.GROUP_ACTIVITY?Ea(f):aa(f),f.messageType!=j.MESSAGE_TYPES.BLANK_MESSAGE&&d.push(f.packetId)}d.length>0&&v.sendTagUnreadMessageConfirmation(c,d)}function ua(a){}function va(a){}function wa(a){var b=g.currentUser(),c=b.getKey(),d=a.packetId,f=a.tagId,h=[],i=La(f);if(a.messages.length||a.pageDirection==j.PAGE_DIRECTION.DOWN){for(var h=[],k=y.getChatServerCurrentTime(),n=k,o=!1,p=0;p<a.messages.length;p++){var q=a.messages[p];q.tagId=f,q.fromHistory=!0,q.messageType==j.MESSAGE_TYPES.GROUP_ACTIVITY?(o=!0,Ea(q)):a.messages.messageType==j.MESSAGE_TYPES.HISTORY_RE_FETCH?Ia(f,j.PAGE_DIRECTION.UP,q.packetId):q.messageType!=j.MESSAGE_TYPES.DELETE_MESSAGE&&(o=!0,q.userId===c?q.status="Seen":q.status="Received",q.tagId=f,q.fromOffline=!0,q.fromHistory=!0,aa(q)),q.messageDate<n&&(n=q.messageDate),h.push(q.packetId)}if(o)i.hasHistoryMessage=!0,e.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:f});else if(n!=k){var r=l.getUUIDPacketId(n,!0);Ia(f,j.PAGE_DIRECTION.UP,r,!1)}}else i.hasHistoryMessage=!1;m.sendTagOfflineConfirmation(c,f,d)}function xa(a){}function ya(a){var b=g.currentUser(),c=b.getKey(),d=a.tagId,f=l.getOrCreateTag(d,a);Na(f,a.tagMembers);var h=La(d,f);l.isTagRegistered(d)&&Ma(d,h,f),m.sendTagOfflineConfirmation(c,d,a.packetId),e.triggerCustomEvent("taglistupdated")}function za(a){}function Aa(a){var b,c=g.currentUser(),d=c.getKey();a.fromOffline=!0,a.fromHistory=!0,b=Ha(a),b&&m.sendOfflineBrokenPacketConfirmation(d,a.packetId,a.sequenceNo)}function Ba(a){var b,c=g.currentUser(),d=c.getKey();a.tagId;a.fromOffline=!0,b=Ha(a),b&&m.sendOfflineBrokenPacketConfirmation(d,a.packetId,a.sequenceNo)}function Ca(a){}function Da(a,b,c){if(c.changedByUserId!=c.userId||c.status!=j.MEMBER_STATUS.OWNER)switch(c.activityType){case j.TAG_ACTIVITY_TYPE.DELETED:W({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagMembers:[{userId:c.userId}],fromHistory:c.fromHistory});break;case j.TAG_ACTIVITY_TYPE.ADDED:U({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagMembers:[{userId:c.userId,status:c.status,fullName:c.activityValue}],fromHistory:c.fromHistory});break;case j.TAG_ACTIVITY_TYPE.LEAVE:W({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagMembers:[{userId:c.userId}],fromHistory:c.fromHistory});break;case j.TAG_ACTIVITY_TYPE.TAG_RENAME:S({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagName:c.activityValue,fromHistory:c.fromHistory});break;case j.TAG_ACTIVITY_TYPE.MEMBER_TYPE_CHANGE:Y({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagMembers:[{userId:c.userId,status:c.status}],fromHistory:c.fromHistory});break;case j.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:S({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagPictureUrl:c.activityValue,fromHistory:c.fromHistory});break;case j.TAG_ACTIVITY_TYPE.TAG_CREATED:Q({userId:c.changedByUserId,packetId:b,tagId:a,messageDate:c.activityDate,tagName:c.activityValue,tagMembers:[],fromHistory:c.fromHistory})}}function Ea(a){var b,c=a.packetType,d=(a.userId,a.tagId),e=a.packetId,f=a.messageDate;try{b=angular.fromJson(a.message)}catch(g){return}var h={changedByUserId:a.userId,userId:b.mId,status:b.mT,activityValue:b.n,activityType:c,activityDate:f,fromHistory:a.fromHistory||!1};Da(d,e,h)}function Fa(a){var c,d,e=g.currentUser(),f=e.getKey(),i=a.tagId;c=b.getBoxByUId(i),c=La(i),d=l.getTag(a.tagId),C(function(){if(l.isTagRegistered(i)&&Ma(i,c,d),a.userId===f)c&&c.removeMessage(a.packetId),h.removeMessage(a.packetId,a.tagId);else{var b=c.updateMessageStatus(a.packetId,"Deleted");if(b&&(b.text="This message has been deleted",b.setTextPartition(),h.updateMessage(b,c.getKey())),d){var e=d.getMessage(a.packetId);e&&(e.setStatus("Deleted"),e.markAsDeleted())}}h.updateBox(c)})}function Ga(a,b,c){for(var d={tagId:a,userId:b},e=0;e<c.length;e++){var f=c[e];d.packetId=f.packetId,Fa(d)}}function Ha(a){var b=a.packetId+"_"+a.sequenceNo;if(Ya[b])return!1;if(Ya[b]=a.bytes,Ra(a.packetId,a.packetsLength)){var c=Ua(a.packetId,a.packetsLength);c.fromOffline=a.fromOffline||!1,c.fromHistory=a.fromHistory||!1;var d=D(c.packetType);C(function(){G(c.packetType,c),d.processor.call(this,c),Ta(a.packetId,a.packetsLength)})}return!0}function Ia(a,b,c,d){if(d){var e=La(a);v.getFriendHistoryMessagesMultipleTimes(a,b,c).then(function(a){a.sucs&&(e.historyLoading=!1)},function(){e.historyLoading=!1})}else{var e=Ka(a);v.getHistoryMessagesMultipleTimes(a,b,c).then(function(a){a.sucs&&(e.historyLoading=!1)},function(){e.historyLoading=!1})}}function Ja(a){var b=j.MESSAGE_STATUS_VALUE[a];return b&&(b=b.charAt(0)+b.substr(1).toLowerCase()),b}function Ka(a){var c=b.getBoxByUId(a);return c||(c=b.creatNonDomBox(a,!0),c.loadHistoryMessages()),c}function La(a,c){c||(c=l.getTag(a));var d=b.getBoxByUId(a);return d||(d=b.creatNonDomBox(a,!0),!d.getIp()&&c&&c.getChatIp()&&(d.setIp(c.getChatIp()),d.setRPort(c.getChatRegisterPort()),d.setTitle(c.getTagName())),d.loadHistoryMessages()),d}function Ma(a,b,c){b||(b=La(a)),b.updateLastCommunicationTime(),c||(c=l.getTag(a)),c&&c.setLastCommunicationTime(b.lastCommunicationTime),l.updateTagRegisteredTime(a,b.lastCommunicationTime)}function Na(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];c&&(e.addedBy=c);var f=l.createNewTagMember(a.getTagId(),e,!0);f.isRemoved()||a.addMember(f)}}function Oa(a,b){for(var c=!1,d=0;d<b.length;d++){var e=a.getMember(b[d].userId);e&&(c=e.isCurrentUser(),a.removeMember(e))}return c}function Pa(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(a){var e=a.getMember(d.userId);e&&e.setStatus(d.status)}}}function Qa(a){var c=b.getBoxByUId(a);c&&(b.closeChatBox(c.getKey()),h.removeOpenBox(c.getKey())),l.unRegisterTag(a)}function Ra(a,b){for(var c=0;b>c;c++){var d=a+"_"+c;if(!Ya[d])return!1}return!0}function Sa(a,b){for(var c={},d=0;b>d;d++){var e=a+"_"+d,f=Ya[e];0===d?c=f:c.message+=f.message}return c.messageLength=c.message.length,c}function Ta(a,b){for(var c=0;b>c;c++){var d=a+"_"+c;delete Ya[d]}}function Ua(a,b){var c,d,e,f,g=[];for(c=0;b>c;c++){var h=a+"_"+c;g.push(Ya[h])}return d=g.joinAsDataView(),e=d.getIntByByte(0,1),f=k.parseRawPacket(d.buffer),f.fromBrokenPacket=!0,f}var Va=!0,Wa=!0,Xa={},Ya={};n.initTagIdleInterval;return Xa[s.FRIEND_CHAT_REGISTER_CONFIRMATION]={processor:function(){},scopeUpdate:!0},Xa[s.FRIEND_CHAT_MSG]={processor:I,scopeUpdate:!0},Xa[s.FRIEND_CHAT_MSG_EDIT]={processor:J,scopeUpdate:!0},Xa[s.FRIEND_CHAT_BROKEN_MSG]={processor:K,scopeUpdate:!0},Xa[s.FRIEND_CHAT_BROKEN_MSG_EDIT]={processor:L,scopeUpdate:!0},Xa[s.FRIEND_CHAT_DELIVERED]={processor:function(){},scopeUpdate:!0},Xa[s.FRIEND_CHAT_SENT]={processor:function(){},scopeUpdate:!0},Xa[s.FRIEND_CHAT_SEEN_CONFIRMATION]={processor:M,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_REGISTER]={processor:N,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_UNREGISTER]={processor:O,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={processor:P,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_INFORMATION]={processor:S,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={processor:T,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_MEMBER_ADD]={processor:U,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={processor:V,scopeUpdate:!0},Xa[i.TAG_CHAT_MEMBER_REMOVE_LEAVE]={processor:W,scopeUpdate:!0},Xa[i.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={processor:X,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={processor:Y,scopeUpdate:!0},Xa[i.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={processor:Z,scopeUpdate:!0},Xa[i.TAG_CHAT_IDLE]={processor:$,scopeUpdate:!1},Xa[i.TAG_CHAT_TYPING]={processor:_,scopeUpdate:!0},Xa[i.TAG_CHAT_MSG]={processor:aa,scopeUpdate:!0},Xa[i.TAG_CHAT_MSG_EDIT]={processor:ba,scopeUpdate:!0},Xa[i.TAG_CHAT_BROKEN_MSG]={processor:ca,scopeUpdate:!0},Xa[i.TAG_CHAT_BROKEN_MSG_EDIT]={processor:da,scopeUpdate:!0},Xa[i.TAG_CHAT_MULTIPLE_MSG]={processor:ea,scopeUpdate:!0},Xa[i.TAG_CHAT_DELIVERED]={processor:fa,scopeUpdate:!0},Xa[i.TAG_CHAT_SENT]={processor:ga,scopeUpdate:!0},Xa[i.TAG_CHAT_SEEN]={processor:ha,scopeUpdate:!0},Xa[i.TAG_CHAT_SEEN_CONFIRMATION]={processor:ia,scopeUpdate:!0},Xa[i.TAG_CHAT_MULTIPLE_MSG_DELETE]={processor:ja,scopeUpdate:!0},Xa[i.TAG_CHAT_MSG_DELETE_CONFIRMATION]={processor:ka,scopeUpdate:!0},Xa[i.TAG_CHAT_GENERAL_BROKEN_PACKET]={processor:la,scopeUpdate:!0},Xa[i.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={processor:ma,scopeUpdate:!0},Xa[t.OFFLINE_GET_REQUEST_CONFIRMATION]={processor:na,scopeUpdate:!0},Xa[t.OFFLINE_FRIEND_UNREAD_MESSAGE]={processor:oa,scopeUpdate:!0},Xa[t.OFFLINE_FRIEND_HISTORY_MESSAGE]={processor:pa,scopeUpdate:!0},Xa[t.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={processor:qa,scopeUpdate:!0},Xa[t.OFFLINE_TAG_INFORMATION_ACTIVITY]={processor:ra,scopeUpdate:!0},Xa[t.OFFLINE_MY_TAG_LIST]={processor:sa,scopeUpdate:!0},Xa[t.OFFLINE_TAG_UNREAD_MESSAGE]={processor:ta,scopeUpdate:!0},Xa[t.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={processor:ua,scopeUpdate:!0},Xa[t.OFFLINE_TAG_CREATE_TAG]={processor:Q,scopeUpdate:!0},Xa[t.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={processor:R,scopeUpdate:!0},Xa[t.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={processor:va,scopeUpdate:!0},Xa[t.OFFLINE_TAG_HISTORY_MESSAGE]={processor:wa,scopeUpdate:!0},Xa[t.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={processor:xa,scopeUpdate:!0},Xa[t.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={processor:ya,scopeUpdate:!0},Xa[t.OFFLINE_TAG_CONFIRMATION]={processor:za,scopeUpdate:!0},Xa[t.OFFLINE_BROKEN_HISTORY_PACKET]={processor:Aa,scopeUpdate:!0},Xa[t.OFFLINE_BROKEN_PACKET]={processor:Ba,scopeUpdate:!0},Xa[t.OFFLINE_BROKEN_PACKET_CONFIRMATION]={processor:Ca,scopeUpdate:!0},{processUpdates:H,processPacketData:F}}angular.module("ringid.tagchat").factory("tagChatSubscriber",a),a.$inject=["SystemEvents","ChatFactory","profileFactory","PacketDataParse","utilsFactory","$timeout","Auth","chatHistoryFactory","TAG_CHAT_PACKET_TYPE","TAG_CHAT_GENERAL_CONSTANTS","tagChatPacketProcessor","tagChatFactory","tagChatApiService","tagChatManager","tagChatUI","tagChatHelper","CHAT_GLOBAL_VALUES","AUTH_SERVER_ACTIONS","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","ChatHelper","tagOfflineChatManager","ChatApiService","ChatPacketSenderService","chatUtilsFactory","ChatSeenSend","CHAT_GENERAL_CONSTANTS","chatTabSync"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){var b;return b="admin"===a?d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:"member"===a?d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER}function h(a){for(var b={},c=0;c<a.length;c++){var d,e=a[c];d=angular.isString(e.status)?g(e.status):e.status,b[d]||(b[d]=[]),b[d].push(e)}return b}function i(b,f,g,i,j){var k=a.getBoxByUId(b),l=h(g),m={};i&&(j=e.getUUIDPacketId(i,!0),m.messageDate=i);var n=1;for(var o in l)if(l.hasOwnProperty(o)){n||(j=j+"_"+n);var p="";o=parseInt(o),p=o===d.MEMBER_STATUS.ADMIN?d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:o===d.MEMBER_STATUS.MEMBER?d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER;var q=e.createTagStatusMessage(j,b,f,p,l[o],m);
if(!q)continue;var r=q.serialize();k?k.pushMessage(r,f):c.addMessage(r,b)}}function j(a,b,c){c||(c=e.getTag(a));var f=0;return c&&(b.tagName&&b.tagPictureUrl&&c.getTagName()!==b.tagName&&c.getPictureUrl()!==b.tagPictureUrl.trim()?f=d.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:(b.tagName&&c.getTagName()!==b.tagName&&(f=d.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE),b.tagPictureUrl&&c.getPictureUrl()!==b.tagPictureUrl.trim()&&(f=d.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE))),f}function k(b,d,f,g,h){h||(h=e.getTag(b)),g||(g=e.getUUIDPacketId());var i=f.statusMessageType;if(i||(i=j(b,f,h)),f.messageDate&&(g=e.getUUIDPacketId(f.messageDate,!0)),0!==i){var k=a.getBoxByUId(b),l=e.createTagStatusMessage(g,b,d,i,[],f);if(!l)return;var m=l.serialize();k?k.pushMessage(m,d):c.addMessage(m,b)}}function l(b,f,g,i,j,k){k||(k=e.getTag(b));var l=a.getBoxByUId(b),m=h(g),n={};i&&(n.messageDate=i);for(var o in m)if(m.hasOwnProperty(o)){var p=j+"_"+o,q="";o=parseInt(o),o===d.MEMBER_STATUS.ADMIN?q=d.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:o===d.MEMBER_STATUS.MEMBER?q=d.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:o===d.MEMBER_STATUS.OWNER&&(q=d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER);var r=e.createTagStatusMessage(p,b,f,q,m[o],n);if(!r)continue;var s=r.serialize();l?l.pushMessage(s,f):c.addMessage(s,b)}}function m(b,f,g,h,i,j){j||(j=e.getTag(b)),i||(i=e.getUUIDPacketId(h,!0));for(var k=a.getBoxByUId(b),l=0;l<g.length;l++){var m=j.getMember(g[l].userId);m&&(g[l].fullName=m.getName())}var n={};h&&(n.messageDate=h,i=e.getUUIDPacketId(h,!0));var o=e.createTagStatusMessage(i,b,f,d.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE,g,n);if(o){var p=o.serialize();k?k.pushMessage(p,f):c.addMessage(p,b)}}return{getTagInfoChangeStatusMessage:j,showTagInfoChangeStatusMessage:k,showMemberTypeChangeStatusMessage:i,showTagMembersAddStatusMessage:l,showTagMembersRemoveStatusMessage:m}}angular.module("ringid.tagchat").factory("tagChatUI",a),a.$inject=["ChatFactory","utilsFactory","chatHistoryFactory","TAG_CHAT_GENERAL_CONSTANTS","tagChatFactory","Ringalert"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(b){var c;return b===a.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD?c="member":b===a.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD&&(c="admin"),c}function i(e){var f,g,i,j=c.currentUser(),k=(j.getKey(),""),l=e.usersToChange[0],m=e.usersToChange.slice(1).join(", "),n=e.usersToChange.length-1,o=e.fullName,p=e.tagName;if(f=e.tagId,g=d.getOrCreateTag(f),i=j.getKey()===e.userId.toString(),g){if(!o){var q=g.getMember(e.userId);o=q?q.getName():e.userId}var r,s,t={},u=b.STATUS_MESSAGES;switch(e.statusType){case a.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:case a.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:s=h(e.statusType),t.member_name=o,t.new_member_name=l==j.getName()?"you":l,t.new_member_type=s,t.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(m,n),r=i?n?u.SELF_ADD_MULTIPLE_MEMBER:u.SELF_ADD_MEMBER:n?u.OTHER_ADD_MULTIPLE_MEMBER:u.OTHER_ADD_MEMBER;break;case a.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE:t.member_name=o,t.old_member_name=l==j.getName()?"you":l,t.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(m,n),r=i?n?u.SELF_REMOVE_MULTIPLE_MEMBER:l===o?u.SELF_LEAVE_GROUP:u.SELF_REMOVE_MEMBER:n?u.OTHER_REMOVE_MULTIPLE_MEMBER:l===o?u.OTHER_LEAVE_GROUP:u.OTHER_REMOVE_MEMBER;break;case a.STATUS_MESSAGE_TYPES.TAG_MEMBER_LEAVE:t.member_name=o,r=i?u.SELF_LEAVE_GROUP:u.OTHER_LEAVE_GROUP;break;case a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:t.member_name=o,t.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(m,n),l!==j.getName()?t.old_member_name=l:t.old_member_name="you",r=i?n?u.SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:u.SELF_MEMBER_CHANGE_TO_ADMIN:n?u.OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:u.OTHER_MEMBER_CHANGE_TO_ADMIN;break;case a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:t.admin_name=o,l!==j.getName()?t.old_admin_name=l:t.old_admin_name="you",t.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(m,n),r=i?n?u.SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:l===o?u.SELF_REMOVED_FROM_ADMIN_BY_SELF:u.SELF_ADMIN_CHANGE_TO_MEMBER:n?u.OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:l===o?u.OTHER_REMOVED_FROM_ADMIN_BY_SELF:u.OTHER_ADMIN_CHANGE_TO_MEMBER;break;case a.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER:t.member_name=o,t.admin_name=l,r=l!==j.getName()?u.OTHER_USER_ADDED_AS_OWNER:u.SELF_USER_ADDED_AS_OWNER;break;case a.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:t.member_name=o,t.group_name=p,r=i?u.SELF_UPDATE_GROUP_INFO:u.OTHER_UPDATE_GROUP_INFO;break;case a.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE:t.member_name=o,t.group_name=p,r=i?u.SELF_RENAME_GROUP:u.OTHER_RENAME_GROUP;break;case a.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE:t.member_name=o,t.group_name=p,r=i?u.SELF_CHANGE_GROUP_PIC:u.OTHER_CHANGE_GROUP_PIC}return r&&(k=r.supplant(t)),k}}function j(b){var e=c.currentUser(),f=(e.getKey(),{tagId:b,userId:e.getKey(),fullName:e.getName(),message:" ",messageDate:(new Date).getTime(),messageType:a.MESSAGE_TYPES.BLANK_MESSAGE,packetId:d.getUUIDPacketId()}),g=d.createNewTagMessage(b,f);return g}function k(){var a=f.serverTimeDiff,b=(new Date).getTime()-a;return b}function l(b){var c=k();return c-b<a.ACTUAL_TAG_REGISTER_TIMEOUT}function m(a,b,c,d){if(d)b.call(null,c);else{var e=function(d){d.data.tagId.toString()===a.toString()&&(b.call(null,c),document.removeEventListener("tagregistered",e))};document.addEventListener("tagregistered",e)}}return{getTagChatStatusMessage:i,getTagEmptyMessageObject:j,getCurrentChatServerTime:k,hasChatSession:l,executeAfterTagRegisterEvent:m}}angular.module("ringid.tagchat").factory("tagChatHelper",a),a.$inject=["TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_LANG","Auth","tagChatFactory","profileFactory","CHAT_GLOBAL_VALUES","Storage"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a){return!!b[a]}function j(a){return b[a].FORMAT}function k(a){return b[a].PACKET_NAME}function l(b){return a[b].SIZE}function m(a,b){return a-b}function n(a,b){var c=o(b);return a[c].byteLength}function o(b){return a[b].VAR_NAME}function p(b){return a[b].VAR_TYPE}function q(b){return a[b].CONDITIONAL}function r(b){try{return a[b].VAR_CONTAINER_NAME}catch(c){return-1}}function s(b,c){try{var d=a[c].VAR_NAME;if(~d.indexOf("Length")){var e=d.replace("Length","");return b[d]||b[e].length}return b[d]}catch(f){return""}}function t(a,b){try{return a[b+"Length"]}catch(c){return-1}}function u(a){return l(a)==f.PACKET_DYNAMIC_ATTRIBUTE}function v(a){return l(a)==f.PACKET_RAW_BYTE_ATTRIBUTE}function w(){return f.PACKET_IP_SIZE+f.PACKET_PORT_SIZE}function x(a){return new DataView(new ArrayBuffer(a))}function y(a){return new DataView(a)}function z(a,b,c){for(var d=0,e=c.length,f=-1,g=0;e>g;g++){var h=c[g];if(angular.isArray(h)){var i=f;if(i>0)for(var j=c[g-1],k=r(j),m=a[k],o=0;i>o;o++){var p=z(m[o],b,h);d+=p}}else{var t=s(a,h);if(u(h))d+=t.length;else if(v(h)){var w=h;d+=n(a,w)}else{var w=h;d+=l(w),q(w)&&(c=J(b,c,g,t),e=c.length)}f=t}}return d}function A(a,b,c,d,e){if(e==f.ATTRIBUTE_TYPE.INTEGER)d=parseInt(d),c==f.ONE_BYTE_SIZE?a.setUint8(b,d):c==f.TWO_BYTE_SIZE?a.setUint16(b,d):c==f.FOUR_BYTE_SIZE?a.setUint32(b,d):c==f.EIGHT_BYTE_SIZE&&a.setUint64(b,d);else if(e==f.ATTRIBUTE_TYPE.STRING)for(var g=0;g<d.length;g++)a.setUint8(b,d.charCodeAt(g)),b+=1;else if(e==f.ATTRIBUTE_TYPE.BYTE)for(var g=0;c>g;g++)a.setUint8(b+g,d.getUint8(g))}function B(a,b,c,d){var e="";return d==f.ATTRIBUTE_TYPE.INTEGER?e=a.getIntByByte(b,c):d==f.ATTRIBUTE_TYPE.STRING?c>0&&(e=a.getString(b,c)):d==f.ATTRIBUTE_TYPE.BYTE&&c>0&&(e=a.copy(b,c)),e}function C(a){var b=[];try{b=a.split(".")}catch(c){}return b}function D(a){for(var b,c,d=[],e=0;4>e;e++)d.push(B(a,e,1,f.ATTRIBUTE_TYPE.INTEGER));return b=d.join("."),c=B(a,4,2,f.ATTRIBUTE_TYPE.INTEGER),{ip:b,port:c}}function E(a){return B(a,0,1,f.ATTRIBUTE_TYPE.INTEGER)}function F(a){return B(a,1,8,f.ATTRIBUTE_TYPE.INTEGER)}function G(a,b,c,d){for(var e=C(c),g=0;g<e.length;g++)A(a,b,f.ONE_BYTE_SIZE,e[g],f.ATTRIBUTE_TYPE.INTEGER),b+=f.ONE_BYTE_SIZE;return A(a,b,f.TWO_BYTE_SIZE,d,f.ATTRIBUTE_TYPE.INTEGER),b+=f.TWO_BYTE_SIZE}function H(a,b,c,d,e){for(var f=-1,g=b,h=0;h<e.length;h++){var i=e[h];if(angular.isArray(i)){var j=i,k=f;if(k>0)for(var m=e[h-1],o=r(m),t=c[o],w=0;k>w;w++){var x=H(a,b,t[w],d,j);b+=x}}else{var y,z=i,B=s(c,z),C=p(z);y=u(z)?B.length:v(z)?n(c,z):l(z),A(a,b,y,B,C),b+=y,f=B,q(z)&&(e=J(d,e,h,B))}}return b-g}function I(a,b){var c=j(b),d=z(a,b,c)+w();if(!d)return!1;var e=x(d),f=0;return f=G(e,f,a.ip,a.port),f=H(e,f,a,b,c),e}function J(a,b,c,e){if(a==d.TAG_CHAT_TAG_INFORMATION)switch(b=angular.copy(b),e){case f.TAG_ACTIVITY_TYPE.TAG_RENAME:b=b.slice(0,-2);break;case f.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:b.splice(c+1,2)}return b}function K(a,b,c,d,e){for(var f,g,h,i,j,k,n,s,w,x,y,z,A,C,D=-1,E=b,F=0;F<e.length;F++)if(f=e[F],angular.isArray(f)){if(n=f,s=[],w=e[F-1],x=r(w),y=D,y>0)for(z=0;y>z;z++)C={},A=K(a,b,C,d,n),b+=A,s.push(C);c[x]=s}else g=f,h=o(g),b>=a.byteLength?c[h]="":(i=p(g),j=u(g)?t(c,h):v(g)?m(a.byteLength,b):l(g),k=B(a,b,j,i),b+=j,c[h]=k,D=k),q(g)&&(e=J(d,e,F,k));return b-E}function L(a){if(a.packetType==d.TAG_CHAT_SENT){a.originalPacketId=a.packetId;try{var b=a.packetId.split("_");a.packetId=b[0],a.sequenceNo=b[1]}catch(c){a.sequenceNo=0}}return a}function M(a,b,c){c||(c=j(b));var d=y(a),e=0,f={};K(d,e,f,b,c);return f=L(f)}function N(a){var b=new DataView(a),c=b.getIntByByte(0,1);if(i(c))try{return M(a,c)}catch(d){b.print_r(!0)}}function O(a,b){var c=j(b);return z(a,b,c)}function P(a,b,c,d){return b?a.slice(c,d):a.substring(c,d)}function Q(a,b,c,d){var e=j(b),g=z(a,b,e),h=!!angular.isArray(a[c]);if(g>f.PACKET_MAX_SIZE){var i=a[c].length,k=angular.copy(a),l=angular.copy(a);k[c]=P(a[c],h,0,i/2),l[c]=P(a[c],h,i/2,i);var m=z(k,b,e),n=z(l,b,e);m>f.PACKET_MAX_SIZE?d.concat(Q(k,b,c,d)):d.push(k),n>f.PACKET_MAX_SIZE?d.concat(Q(l,b,c,d)):d.push(l)}else d.push(a);return d}function R(a,b){var c=T(b);return Q(a,b,c,[])}function S(a){var b,c,d,e=a.byteLength,g=f.PACKET_MAX_SIZE,h=Math.floor(e/g),i=[],j=0;for(b=0;h>b;b++)d=a.copy(j,g),i.push(d),j+=f.PACKET_MAX_SIZE;return c=e-j,c>0&&(d=a.copy(j,c),i.push(d)),i}function T(a){switch(a){case g.OFFLINE_BROKEN_PACKET:case d.TAG_CHAT_GENERAL_BROKEN_PACKET:return"bytes";case h.FRIEND_CHAT_MSG:case h.FRIEND_CHAT_MSG_EDIT:case h.FRIEND_CHAT_BROKEN_MSG:case h.FRIEND_CHAT_BROKEN_MSG_EDIT:case d.TAG_CHAT_MSG:case d.TAG_CHAT_MSG_EDIT:case d.TAG_CHAT_BROKEN_MSG:case d.TAG_CHAT_BROKEN_MSG_EDIT:return"message";case h.FRIEND_CHAT_SEEN:return"messages";case g.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:case g.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:return"packets"}}function U(a,b,c,e){switch(a){case g.OFFLINE_BROKEN_PACKET:case d.TAG_CHAT_GENERAL_BROKEN_PACKET:return function(){return S(e)};case h.FRIEND_CHAT_MSG:case h.FRIEND_CHAT_MSG_EDIT:case h.FRIEND_CHAT_BROKEN_MSG:case h.FRIEND_CHAT_BROKEN_MSG_EDIT:case d.TAG_CHAT_BROKEN_MSG:case d.TAG_CHAT_BROKEN_MSG_EDIT:case h.FRIEND_CHAT_SEEN:case g.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:case g.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:return function(){return R(c,b)}}}function V(a){switch(a){case g.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:case g.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:case h.FRIEND_CHAT_SEEN:return!0}return!1}return{isTagPacket:i,constructPacket:I,parsePacket:M,parseRawPacket:N,getPacketSizeByObject:O,splitAndGetMultipleObjects:R,splitAndGetBrokenPackets:S,getObjectFromDataView:K,getIpPortFromPacket:D,getPacketType:E,getPacketName:k,getUserId:F,getBrokenContainerByPacketType:T,getBrokenPacketSplitter:U,isMultipleBrokenPacket:V}}angular.module("ringid.tagchat").factory("tagChatPacketProcessor",a),a.$inject=["TAG_CHAT_PACKET_ATTRIBUTE_INFO","TAG_CHAT_PACKET_INFO","CHAT_PACKET_FORMAT","TAG_CHAT_PACKET_TYPE","TAG_CHAT_PACKET_ATTRIBUTE","TAG_CHAT_GENERAL_CONSTANTS","OFFLINE_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){this._config=this._config||{},this._requiredConfigs=this._requiredConfigs||["packetType"],this._callbacks=this._callbacks||{},this.init=function(){this._config=angular.extend(this._config,{packetType:0,packet:"",packetId:0,sequenceNo:0,packetObject:{},sendFailed:!1,sendSuccess:!1,isBroken:!1,isOffline:!1,terminated:!1,ignoreConfirmation:!1})},this.initCallbacks=function(){this._callbacks=angular.extend(this._callbacks,{_send:this.onSend,_successCheck:this.onSuccessCheck,_failure:this.onFailure,_success:this.onSuccess})},this.init.call(this),this.initCallbacks.call(this)}function h(){var a=this;a.onSend=function(){var e;a.hasPacket()?a.hasPacketId()||a.setPacketId(c.getUUIDPacketId()):a.hasPacketObject()&&(e=d.getPacket(a.getPacketObject(),a.getPacketType()),a.setPacket(e),!a.hasPacketId()&&a.getPacketObject().packetId&&a.setPacketId(a.getPacketObject().packetId)),a.hasPacket()&&(a.getPacketObject()&&d.logRequestedPacketInfo(a.getPacketType(),a.getPacketObject()),b.send(a.getPacket()))},a.start=function(){a.preProcess(),a.validateConfig();var b=!1;k(function(){return a.isCallbackDefined("beforeSend")&&a.getCallback("beforeSend").call(),a.isCallbackDefined("send")?a.getCallback("send").call():a.getDefaultCallback("send").call(a)},function(c){return a.getIgnoreConfirmation()?!1:(a.isTerminated()||(a.isCallbackDefined("beforeSuccessCheck")&&a.getCallback("beforeSuccessCheck").call(null,c),b=a.isCallbackDefined("successCheck")?a.getCallback("successCheck").call(null,c):a.getDefaultCallback("successCheck").call(a,c),a.isCallbackDefined("afterSuccessCheck")&&a.getCallback("afterSuccessCheck").call(null,c,b),a.isSendSuccess(b)),a.isSendSuccess()&&a.callSuccessCallback(c),a.isTerminated()||a.isSendSuccess())},function(){a.getIgnoreConfirmation()?(a.isSendSuccess(!0),a.callSuccessCallback()):(a.isSendSuccess(!1),a.callFailureCallback())},e.API_FETCH_RETRY_COUNT,e.API_FETCH_RETRY_DELAY)},g.call(this)}function i(){function a(a){var c;try{c=new h,c.setPacketType(a.packetType),c.setSequenceNo(a.sequenceNo),c.setPacketObject(a),c.on("afterSuccessCheck",function(a,d){b.isTerminated()&&c.isTerminated(!0)}),c.on("success",function(c){a.sequenceNo||(a.sequenceNo=0),c.sucs&&b.onBrokenSuccess(c,a)}),c.on("failure",function(c){a.sequenceNo||(a.sequenceNo=0),b.onBrokenFailure(c,a)}),c.start()}catch(d){}}var b=this;this._config={packetObjects:[],confirmations:{}},this.setPacketObjects=function(a){b._config.packetObjects=a},this.getPacketObjects=function(){return b._config.packetObjects},this.hasPacketObjects=function(){return b._config.packetObjects.length>0},this.onSuccessCheck=function(a){return Object.keys(b._config.confirmations).length===b._config.packetObjects.length},this._checkForSuccess=function(a){var c=b.getDefaultCallback("successCheck").call(b,a);return b.isSendSuccess(c),c},this.addBrokenConfirmation=function(a,c){b._config.confirmations[a+"_"+c]=!0},this.onBrokenSuccess=function(a,c){b.addBrokenConfirmation(c.packetId,c.sequenceNo),b._checkForSuccess(a.tryCount)&&b.callSuccessCallback(a.tryCount)},this.onBrokenFailure=function(a,c){!b.isTerminated()&&b._checkForSuccess(a.tryCount)?b.callSuccessCallback(a.tryCount):b.isTerminated()||(b.isTerminated(!0),b.callFailureCallback())},g.call(this),this.setPacketObjects=function(a){b._config.packetObjects=a},this.start=function(){var c;b.hasPacketObjects()?c=b.getPacketObjects():(b.preProcess(),b.validateConfig(),c=d.getBrokenPacketObjects(b.getBrokenPacketType(),b.getPacket(),b.getPacketObject()),b.setPacketObjects(c));for(var e=c.length,f=0;e>f;f++)a(c[f])}}function j(){function a(a){return a?new i:new h}var b=this;this._config={brokenPacketType:0,packet:"",packetObject:{},packetObjects:[],ignoreConfirmation:!1},this.setPacket=function(a){b._config.packet=a},this.getPacket=function(){return b._config.packet},this.hasPacket=function(){return!!b.getPacket()},this.setBrokenPacketType=function(a){b._config.brokenPacketType=a},this.getBrokenPacketType=function(){return b._config.brokenPacketType},this.hasBrokenPacketType=function(){return!!b.getBrokenPacketType()},this.setPacketObject=function(a){b._config.packetObject=a},this.setIgnoreConfirmation=function(a){b._config.ignoreConfirmation=a},this.getIgnoreConfirmation=function(){return b._config.ignoreConfirmation},this.getPacketObject=function(){return b._config.packetObject},this.hasPacketObject=function(){return Object.keys(b._config.packetObject).length>0},this.setPacketObjects=function(a){b._config.packetObjects=a},this.getPacketObjects=function(a){return b._config.packetObjects},this.hasPacketObjects=function(){return b._config.packetObjects.length>0},this._validate=function(a){if(a&&!b.getBrokenPacketType())throw m("Broken PacketType needs to be set for When Broken Packet is Set.")},this.getInstance=function(c){var e,f;if(b._validate(c),f=d.getBrokenPacketObjects(b.getBrokenPacketType(),b.getPacket(),b.getPacketObject()),!f.length)throw m("Broken Packet Build Error");return(c||f.length>1)&&(b.setPacketObjects(f),c=!0),e=a(c),e.setIgnoreConfirmation(b.getIgnoreConfirmation()),b.hasPacket()&&!c?e.setPacket(b.getPacket()):(b.hasPacketObjects()?e.setPacketObjects(b.getPacketObjects()):e.setPacketObject(b.getPacketObject()),e.setPacketType(b.getBrokenPacketType())),e}}var k=a.callXTimeAfterYIntervalStopOnSuccess,l=c.hasReceivedConfirmation,m=f.ChatPacketException;return g.prototype={preProcess:function(){!this.getPacket()&&this.hasPacketObject()&&this.setPacketType(this.getPacketObject().packetType)},on:function(a,b){this._callbacks[a]=b},onSend:function(){},onSuccessCheck:function(a){return l(this.getPacketId(),this.getPacketType(),this.getSequenceNo())},onFailure:function(){},onSuccess:function(){},setPacketType:function(a){this._config.packetType=a},getPacketType:function(){return this._config.packetType},hasPacketType:function(){return!!this._config.packetType},setSequenceNo:function(a){this._config.sequenceNo=a},getSequenceNo:function(){return this._config.sequenceNo},hasSequenceNo:function(){return!!this._config.sequenceNo},hasPacket:function(){return""!=this._config.packet},getPacket:function(){return this._config.packet},setPacket:function(a){this._config.packet=a},setPacketObject:function(a){this._config.packetObject=a},getPacketObject:function(){return this._config.packetObject},hasPacketObject:function(){return Object.keys(this._config.packetObject).length>0},setPacketId:function(a){this._config.packetId=a},hasPacketId:function(){return 0!=this._config.packetId},getPacketId:function(){return this._config.packetId},setIgnoreConfirmation:function(a){this._config.ignoreConfirmation=a},getIgnoreConfirmation:function(){return this._config.ignoreConfirmation},isBroken:function(a){return"undefined"!=typeof a&&(this._config.isBroken=a),this._config.isBroken},isOffline:function(a){return"undefined"!=typeof a&&(this._config.isOffline=a),this._config.isOffline},isTerminated:function(a){return"undefined"!=typeof a&&(this._config.terminated=a),this._config.terminated},stop:function(){this._config.terminated=!0},isSendSuccess:function(a){return"undefined"!=typeof a&&(this._config.sendSuccess=a),this._config.sendSuccess},validateConfig:function(){if(!this._config.packet&&!this._config.packetObject)throw m("packet or objectToSend needs to be defined");if(this._config.packet&&!this._config.packetType)throw m("sending raw packet needs packetType to be given");var a;for(a=0;a<this._requiredConfigs.length;a++){var b=this._requiredConfigs[a];if(!this._config[b])throw m(b+" Not Defined")}},isCallbackDefined:function(a){return!!this._callbacks[a]},getCallback:function(a){return this._callbacks[a]},getDefaultCallback:function(a){return this._callbacks["_"+a]},getResponseObject:function(a,b,c,d){return{sucs:a,tryCount:b,timeout:!!c,terminated:!!d}},callSuccessCallback:function(a){this.isCallbackDefined("success")?this.getCallback("success").call(this,this.getResponseObject(!0,a)):this.getDefaultCallback("success").call(this,this.getResponseObject(!0,a))},callFailureCallback:function(){this.isCallbackDefined("failure")?this.getCallback("failure").call(null,this.getResponseObject(!1,e.API_FETCH_RETRY_COUNT,!1,this.isTerminated())):this.getDefaultCallback("failure").call(this,this.getResponseObject(!1,e.API_FETCH_RETRY_COUNT,!1,this.isTerminated()))}},h.prototype=g.prototype,i.prototype=g.prototype,{ChatPacketResender:h,ChatPacketBrokenResender:i,ChatPacketSender:j}}var b;try{b=angular.module("ringid.tagchat")}catch(c){}b.factory("chatPacketResender",a),a.$inject=["utilsFactory","globalSocketFactory","tagChatFactory","tagChatApiService","TAG_CHAT_GENERAL_CONSTANTS","tagChatExceptions"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(a){return{tagId:a.getTagId(),isOwner:x.isCurrentUserOwner(a)}}function u(a){for(var b=[],c=a.getMembersObjectMap().all(),d=0,e=0;e<c.length&&3>d;e++){var f=c[e].value,g=f.getPictureUrl();""!==g&&(b.push(g),d++)}return b}function v(a){var b=l.getLastMessageByTag(a.getTagId());return b?b.value:!1}function w(a){switch(a.action){case"edit":case"view":return i.close(),function(){return{tagId:a.tagId}};case"delete":i.close();var b=n.getTag(a.tagId);b.setObjectLock(),o.leaveFromTag(a.tagId,z.getKey()).then(function(a){b.removeObjectLock(),g.show(a,"info")},function(a){b.removeObjectLock(),g.show(a,"error")})}}var x=this;x.memberDDHtml="pages/partials/tag-chat/member-actions-dropdown.html",x.memberDDActions=w,x.getTagDDControl=t,x.ready=!1,x.groupFilter="groups";try{}catch(y){x.debug=!1}var z=f.currentUser();x.isCurrentUserOwner=function(a){return a.getOwnerUserId()==z.getKey()},x.isCurrentUserMember=function(a){return a.isUserMember(z.getKey())},o.subscribeForAuthUpdate(),x.allTags=n.getTags(),x.changeGroupFilter=function(a){x.groupFilter=a||"groups"},x.showGroupLogs=function(a){return"logs"===x.groupFilter},x.showGroups=function(a){return"groups"===x.groupFilter},x.getTagPictureImageByMemberAvatars=u,x.getLastMessageOnATag=v,x.imageBase=d.imBase,x.getUserAvatar=function(a){return a&&a.avatar()?a.avatar():"images/prof.png"},x.getLastMessageText=function(a){return 2===a.messageType?a.text:-1!==[6,7,8,9].indexOf(a.messageType)?"Media":!1};a.$on("chatDataReceived",function(a,b){p.processUpdates(a,b)}),a.shouldShow=function(){return x.ready},k.onCustomEvent("MY_TAG_LIST_RECEIVED",function(){x.ready=!0,x.allTags=n.getTags(),k.safeDigest(a)}),c(function(){x.ready=!0},8e3)}angular.module("ringid.tagchat").controller("TagChatController",a),a.$inject=["$scope","$templateCache","$timeout","settings","$$connector","Auth","Ringalert","CHAT_GLOBAL_VALUES","rgDropdownService","ChatFactory","utilsFactory","tagChatStorage","friendsFactory","tagChatFactory","tagChatManager","tagChatSubscriber","tagOfflineChatManager","ChatHelper","SystemEvents"]}(),function(){"use strict";angular.module("ringid.tagchat").directive("rgTagChatList",function(){return{restrict:"E",templateUrl:"pages/partials/tag-chat/tag-chat-list.html"}})}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){b.memberList=d.createNew(),b.adminList=d.createNew()}function s(){a(function(){b.friends=i.friends.copy(),l.safeDigest(b)},2e3)}function t(a){return!!a&&a.getOwnerUserId()===e.currentUser().getKey()}function u(a){return!0}function v(a){if(a.getId()===K)return!1;if(b.tag&&!t(b.tag)){var c=a.getAddedBy()!==e.currentUser().getKey();if(b.tag.isCurrentUserStatusAdmin(K))if(a.isAdmin()&&c);else if(!a.isMember())return!1;if(b.tag.isCurrentUserStatusMember(K)&&c)return!1}return!0}function w(){return!b.editMode||!b.tag.isCurrentUserStatusMember(K)}function x(){b.state.loading||b.friends.length()===i.totalFriends("friends")||(B(!0),i.getContactDetails().then(function(){b.friends=i.getFriends("friends"),B(!1)},function(){B(!1)}),setTimeout(function(){b.state.loading=!1},3e3))}function y(){if(!I())return void l.safeDigest(b);var a=b.models.tagName,d=b.memberList.keys(),e=b.adminList.keys(),f=b.models.tagId,g=b.models.pictureFileName;h.createTag({tagName:a,memberUIds:d,adminUIds:e,tagId:f,tagPictureUrl:g}).then(function(a){a.sucs&&k.show("Group Created.","success")},function(a){k.show(o.DEFAULT_FAILURE_MESSAGE,"error")},function(a){}),l.triggerCustomEvent("MY_TAG_LIST_RECEIVED"),c.close()}function z(a){var c=g.getTag(b.tag.getTagId());c.removeObjectLock()}function A(){if(!I())return void l.safeDigest(b);var a=g.getTag(b.tag.getTagId()),d=b.models.tagName,e=b.models.pictureFileName,f=b.memberList.keys(),i=b.adminList.keys();b.tag.setObjectLock(),h.updateTag(a,d,e,f,i).then(function(a){z(b.tag.getTagId()),a.sucs&&k.show(a,"success")},function(a){z(b.tag.getTagId()),k.show(o.DEFAULT_FAILURE_MESSAGE,"error")},function(a){a.sucs&&(z(b.tag.getTagId()),k.show(a,"success"))}),b.editMode=!1,l.triggerCustomEvent("MY_TAG_LIST_RECEIVED"),c.close()}function B(c){a(function(){b.state.loading=c,c||q.recalculate(b)})}function C(a,c){b.memberList.length()+b.adminList.length()>b.friends.length()-10&&x();var d=b.tag?b.tag.getTagId():b.models.tagId,e=g.createNewTagMember(d,{status:"member"==c?n.MEMBER_STATUS.MEMBER:n.MEMBER_STATUS.ADMIN,addedBy:K},!1);return u(e)?(b.tag&&e.setTagId(b.tag.getTagId()),e.initWithUserMapObject(a),"admin"===c?b.adminList.add(e.getId(),e):b.memberList.add(e.getId(),e),void l.safeDigest(b)):void k.show("Permission Denied","error")}function D(a){v(a)?(a.isAdmin()?b.adminList.remove(a.getId()):b.memberList.remove(a.getId()),l.safeDigest(b)):k.show("Permission Denied","error")}function E(a){return b.newOwnerTagMember&&a.getId()===b.newOwnerTagMember.getId()}function F(a){b.newOwnerTagMember=a,l.safeDigest(b)}function G(){var a=b.newOwnerTagMember,d=b.tag;b.newOwnerTagMember=!1;var f=a.getStatus();a.makeOwner();var g=d.getMember(e.currentUser().getKey());g.makeMember();var i=function(){a.setStatus(f),g.makeOwner(),d.removeObjectLock()},j=[a.serialize(),g.serialize()],m=[a,g];d.setObjectLock(),h.changeTagMemberStatus(d.getTagId(),j,m).then(function(){h.leaveFromTag(d.getTagId()).then(function(a){d.removeObjectLock(),k.show(a,"info")},function(){k.show(o.DEFAULT_FAILURE_MESSAGE,"error"),i()})},function(){k.show(o.DEFAULT_FAILURE_MESSAGE,"error"),i()}),l.safeDigest(b),c.close()}function H(){b.newOwnerTagMember=!1,c.close(),l.safeDigest(b)}function I(){return b.models.tagName.length>100?b.models.errTagName="Maximum 100 alpha numeric characters":b.models.errTagName="",b.models.errMemberList=b.memberList.length()+b.adminList.length()<2,!b.models.errMemberList&&!b.models.errTagName}b.state={loading:!1,noData:!1};var J={};b.friends=i.getFriends("friends"),b.friendName="",b.editMode=!1,b.addToTag=C,b.removeMember=D,b.createChatTag=y,b.updateChatTag=A,b.loadMoreFriends=x,b.cancel=H,b.validateTag=I,b.newOwnerTagMember=!1,b.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:g.generateNewTagId()},b.uploading=!1,b.selectNewOwner=G,b.setNewOwner=F,b.isMemberSelected=E,b.canRemoveMember=v,b.canUpdateTagInfo=w,b.getPicturePreviewUrl=function(){return m.tagChatImBase+b.models.pictureUrl},b.contactListAction=function(a){a.friend.isLoading()||(i.friendAction(a,!0).then(function(){b.$rgDigest()},function(){b.$rgDigest()}),b.$rgDigest())},b.uploadAction=function(a){a.uploadFile.fetchMeta(function(){b.models.pictureUrl=a.uploadFile.getPreview(),b.uploading=!0,l.safeDigest(b),l.safeDigest(b),a.uploadFile.initUpload().then(function(a){b.uploading=!1,b.models.pictureFileName=a.iurl,b.models.pictureUrl=m.imBase+a.url,l.safeDigest(b)},function(a){b.uploading=!1})})};var K=e.currentUser().getKey();if(j&&j.tagId){b.tag=g.getTag(j.tagId),J=b.memberList;var L=b.tag.getMembersObjectMap();L?(b.memberAdminList=L.copy(),r(),b.tag.initMemberObjects(),angular.forEach(b.memberAdminList.all(),function(a){a.value.isMember()?b.memberList.add(a.key,a.value):b.adminList.add(a.key,a.value)})):r(),b.models.tagName=b.tag.getTagName(),b.models.popupTitle="Update Group chat",b.models.pictureUrl=b.tag.getPictureFullUrl(),b.models.pictureFileName=b.tag.getPictureUrl(),b.editMode=!0}else r();b.$watch("friendName",function(a,b){""!=a&&(i.searchContact({schPm:a},!0),s())}),b.$watch(function(){return b.friends.length()-b.adminList.length()-b.memberList.length()},function(a,b){10>a&&x()}),b.$watch("friendName",function(a){a&&a.length>1&&(B(!0),i.searchContact({schPm:a},!0).then(function(){b.friends=i.getFriends("friends"),B(!1)},function(){B(!1)}))})}angular.module("ringid.tagchat").controller("TagChatPopupController",a),a.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","utilsFactory","settings","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_LANG","profileFactory","rgScrollbarService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){f.registerTag(a.tag.getTagId())}function p(){h.unRegisterFromChatServer(a.tag)}a.currentUserUId=c.currentUser().getKey(),a.registerTag=o,a.unregisterTag=p,i&&i.tagId&&(a.tag=e.getTag(i.tagId),a.tagDebugInfo={},a.tagDebugInfo.isTagRegistered=e.isTagRegistered(i.tagId),a.chatBox=d.getBoxByUId(i.tagId))}angular.module("ringid.tagchat").controller("TagChatDebugInfoController",a),a.$inject=["$scope","$boxInstance","Auth","ChatFactory","tagChatFactory","tagChatManager","friendsFactory","tagChatApiService","localData","Ringalert","utilsFactory","settings","TAG_CHAT_GENERAL_CONSTANTS","profileFactory"]}(),function(){"use strict";function a(){function a(a,b){}return{ChatPacketException:a}}var b=angular.module("ringid.tagchat");b.factory("tagChatExceptions",a),a.$inject=[]}(),function(){"use strict";angular.module("ringid.circle",["ringid.friend.friends_factory","ringid.common.user_factory"])}(),function(){"use strict";function a(a,b){var c=this,d=b.SYSTEM.CIRCLE,e=b.SYSTEM.REQUEST_TYPE;c.go=function(b,c){return c=c||"post",a.request(b)},c.getCircleMembers=function(b,c,f){var g={actn:d.TYPE_GROUP_MEMBERS_LIST,grpId:b,scl:1,lmt:f||40,pvtid:c||0};return a.send(g,e.REQUEST)},c.createCircle=function(b){var c={actn:d.TYPE_CREATE_GROUP,gNm:b.tg.utf8Encode(),uId:b.uId,groupMembers:b.alluser};return a.request(c,e.UPDATE)},c.getCircles=function(){var b={actn:d.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return a.send(b,e.REQUEST)},c.getCircle=function(b){return a.request({actn:d.TYPE_GROUP_DETAILS,grpId:b},e.REQUEST)},c.getCirclesInfo=function(){var b={actn:d.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return a.request(b,e.REQUEST)},c.addMembers=function(b){var c={actn:d.TYPE_ADD_GROUP_MEMBER,grpId:b.grpId,groupMembers:b.members};return a.request(c,e.UPDATE)},c.removeMember=function(b){var c={actn:d.TYPE_REMOVE_GROUP_MEMBER,grpId:b.grpId,groupMembers:[{uId:b.uId}]};return a.request(c,e.UPDATE)},c.removeMembers=function(b){var c={actn:d.TYPE_REMOVE_GROUP_MEMBER,grpId:b.grpId,groupMembers:b.members};return a.request(c,e.UPDATE)},c.addRemoveAdmins=function(b){var c={actn:d.TYPE_EDIT_GROUP_MEMBER,grpId:b.grpId,groupMembers:b.members};return a.request(c,e.UPDATE)},c.addRemoveAdmin=function(b){var c={actn:d.TYPE_EDIT_GROUP_MEMBER,grpId:b.grpId,groupMembers:[{admin:b.admin,uId:b.uId}]};return a.request(c,e.UPDATE)},c.leaveCircle=function(b){var c={actn:d.TYPE_LEAVE_GROUP,grpId:b.grpId};return a.request(c,e.UPDATE)},c.deleteCircle=function(b){var c={actn:d.TYPE_DELETE_GROUP,grpId:b.grpId};return a.request(c,e.UPDATE)},c.getMemberResult=function(b,c,f){var g={actn:d.TYPE_GROUP_MEMBERS_SEARCH_RESULT,grpId:c,schPm:b,st:f||0};return a.send(g,e.REQUEST)}}angular.module("ringid.circle").service("circleHttpService",a),a.$inject=["$$connector","OPERATION_TYPES"]}(),function(){"use strict";function a(a,b,c,d,e){return{create:function(b){function f(){}function g(a){var b=k.memberIds.indexOf(a);-1!==b&&k.memberIds.splice(b,1)}function h(a){var b=k.adminIds.indexOf(a);-1!==b&&k.adminIds.splice(b,1)}function i(){k.mc=k.allMembersMap.length()}function j(a){angular.extend(k,a)}var k={gNm:"",grpId:0,ists:0,sAd:"",ut:0,mc:"",mt:"",groupMembers:"",memberList:[],members:{},allMembersMap:c.createNew(),adminIds:[],memberIds:[]};angular.isObject(b)&&(k=angular.extend({},k,b));var l={sortBy:function(){return k.gNm.toLowerCase();
},update:j,addMember:function(b,c){var d=a.create(b);k.allMembersMap.save(d.getKey(),d),c?l.promoteToAdmin(d.getKey()):l.removeFromAdmin(d.getKey()),i()},isAdmin:function(){return 1===k.mt},isMember:function(){return 0===k.mt},isSuperAdmin:function(a){return k.sAd===a},getSuperAdminUId:function(){return k.sAd},promoteToAdmin:function(a){h(a),k.adminIds.push(a),k.allMembersMap.get(a).setGroupAdmin(k.grpId),f()},removeFromAdmin:function(a){g(a),k.memberIds.push(a),k.allMembersMap.get(a).removeGroupAdmin(k.grpId),f()},getAdmins:function(){for(var a=k.allMembersMap.copy(),b=0;b<k.memberIds.length;b++)a.remove(k.memberIds[b]);return a},getMember:function(a){return k.allMembersMap.get(a)},getMembers:function(){for(var a=k.allMembersMap.copy(),b=0;b<k.adminIds.length;b++)a.remove(k.adminIds[b]);return a},setMembers:function(b){angular.forEach(b,function(b){if(!b.ists){var c=a.create(b);k.allMembersMap.save(c.getKey(),c),b.admin?-1!==k.adminIds.indexOf(c.getKey())?k.adminIds.push(c.getKey()):l.promoteToAdmin(c.getKey()):-1!==k.memberIds.indexOf(c.getKey())?k.memberIds.push(c.getKey()):l.removeFromAdmin(c.getKey())}}),f()},resetMembers:function(){k.allMembersMap.reset(),k.adminIds=[],k.memberIds=[]},removeMember:function(a){var b;b=k.allMembersMap.remove(a),g(a),h(a),i()},getAllMembers:function(){return k.allMembersMap},getMemberIds:function(){return k.memberIds.slice()},getAdminIds:function(){return k.adminIds.slice()},getMembersObjectCount:function(){return k.allMembersMap.length()},getMembersCount:function(){return k.mc},getMemberType:function(){return k.mt},setMemberCount:function(a){k.mc=a},getLink:function(a){return a=a||"",d.baseUrl+e.getRingRoute("CIRCLE_HOME",{circleId:k.grpId,subpage:a})},getLinkOnly:function(a){return a=a||"",e.getRingRoute("CIRCLE_HOME",{circleId:k.grpId,subpage:a}).slice(1)},getKey:function(){return k.grpId},getName:function(){return k.gNm},getAnchor:function(){return'<a class="cir-title" href="/#/circle/'+k.grpId+'" >'+k.gNm+"</a>"}};return l}}}angular.module("ringid.circle").factory("circleMap",a),a.$inject=["userFactory","friendsFactory","$$stackedMap","settings","utilsFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){T.remove(a),c.$broadcast(m.CIRCLE.MY_CIRCLE_REMOVED,{circleId:a})}function q(a,b){var c=a.get(b.grpId);return c?c.update(b):c=i.create(b),a.save(c.getKey(),c),c}function r(a){var b;return a.ists||(b=a.sAd==o.currentUser().getKey()?q(R,a):q(T,a)),b}function s(a){angular.forEach(a,r)}function t(c){a.circleId&&a.circleId==c&&(n.show("Circle Deleted","success"),b.path("/"))}function u(){n.show("Circle does not exist!","warning"),b.path("/")}function v(a){var b,c;if(a.sucs)switch(a.actn){case U.TYPE_UPDATE_EDIT_GROUP_MEMBER:case U.TYPE_UPDATE_ADD_GROUP_MEMBER:b=a.grpId,c=B(b),c&&c.setMembers(a.groupMembers);break;case U.TYPE_UPDATE_DELETE_GROUP:b=a.grpId,c=B(b),c&&(p(c.getKey()),t(a.grpId));break;case U.TYPE_UPDATE_REMOVE_GROUP_MEMBER:b=a.grpId,c=B(b),a.removedMembers&&c&&angular.forEach(a.removedMembers,function(a){c.removeMember(a)});break;case U.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:a.groupList=[{gNm:a.gNm,grpId:a.grpId,mc:a.mc,sAd:a.sAd}],s(a.groupList),y(a.groupMembers)}}function w(a){return a.actn===U.TYPE_UPDATE_EDIT_GROUP_MEMBER||a.actn===U.TYPE_UPDATE_ADD_GROUP_MEMBER||a.actn===U.TYPE_UPDATE_DELETE_GROUP||a.actn===U.TYPE_UPDATE_REMOVE_GROUP_MEMBER||a.actn===U.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND}function x(a){clearTimeout(O),a.actn===U.TYPE_GROUP_LIST&&a.sucs===!0&&(s(a.groupList),c.$broadcast(m.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE))}function y(a){if(a.sucs===!0&&angular.isArray(a.groupMembers)&&a.groupMembers.length){for(var b=0;b<a.groupMembers.length;b++)P=a.groupMembers[b].id;var d=R.get(a.groupMembers[0].grpId);if(d||(d=T.get(a.groupMembers[0].grpId)),!d)return;d.setMembers(a.groupMembers)}c.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:!0})}function z(a){if(Q=a.tr,a.sucs===!0&&angular.isArray(a.groupMembers)&&a.groupMembers.length){var b=R.get(a.groupMembers[0].grpId);if(b||(b=T.get(a.groupMembers[0].grpId)),!b)return;b.setMembers(a.groupMembers)}c.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:a.sucs})}function A(a,b){k.getCircle(a).then(function(a){a.sucs===!0&&(b.setMemberCount(a.mc),c.$broadcast(m.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT))})}function B(a){return R.get(a)||T.get(a)}function C(a){var b=B(a),c=h.defer();return b?setTimeout(function(){c.resolve(b)}):k.getCircle(a).then(function(d){d.sucs?(d.grpId=a,d.ists=0,b=r(d),c.resolve(b)):c.reject(!1)},function(a){}),c.promise}function D(a){return a?R:T}function E(a){var b=h.defer();return k.createCircle(a).then(function(c){c.sucs===!0&&(k.getCircles(),l.info("Your circle "+a.tg+" created successfully.")),b.resolve(c)}),b.promise}function F(a,b){var c=h.defer(),d={grpId:b,members:a};return k.addMembers(d).then(function(a){B(b);c.resolve(a)}),c.promise}function G(a,b,c){0===b&&(P=b),k.getCircleMembers(a,P,c)}function H(a,b){k.getMemberResult(a,b,Q)}function I(a){var b=h.defer();return k.leaveCircle({grpId:a.getKey()}).then(function(c){var d=angular.fromJson(c);d.sucs===!0?(R.remove(a.getKey()),T.remove(a.getKey()),b.resolve(d)):b.reject("Failed")}),b.promise}function J(a){var b=h.defer();return k.deleteCircle({grpId:a.getKey()}).then(function(c){c.sucs===!0?(R.remove(a.getKey()),T.remove(a.getKey()),b.resolve(c)):b.reject("Failed")}),b.promise}function K(a,b){var d={grpId:b.getKey(),uId:a},e=b.removeMember(a);k.removeMember(d).then(function(a){a.sucs!==!0&&(b.addMember(e),n.show(a,"error")),c.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(a){})}function L(a,b){var d={grpId:b.getKey(),members:[]};angular.forEach(a,function(a){d.members.push({uId:a}),b.removeMember(a)}),b.setMemberCount(b.getMembersObjectCount()),k.removeMembers(d).then(function(d){d.sucs!==!0&&(angular.forEach(a,function(a){b.addMember(a)}),b.setMemberCount(b.getMembersObjectCount()),n.show(d,"error")),c.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(a){})}function M(a,b){k.addRemoveAdmin(a).then(function(d){if(d.sucs===!0){var e=d.groupMembers[0];e.uId===a.uId&&e.admin===!0?b.promoteToAdmin(a.uId):e.uId===a.uId&&e.admin===!1&&b.removeFromAdmin(a.uId),c.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}},function(a){})}function N(a){S||(d.subscribe(v,{action:[U.TYPE_UPDATE_DELETE_GROUP,U.TYPE_UPDATE_REMOVE_GROUP_MEMBER,U.TYPE_UPDATE_ADD_GROUP_MEMBER,U.TYPE_UPDATE_EDIT_GROUP_MEMBER]}),d.subscribe(x,{action:[U.TYPE_GROUP_LIST]})),S&&!a||(S=!0,k.getCircles())}var O,P,Q,R=g.createNew(!0,"asc"),S=!1,T=g.createNew(!0,"asc"),U=e.SYSTEM.CIRCLE;return{init:N,processCircleUpdates:v,circleUpdateFilter:w,processCirclesData:x,processCircleMembersData:y,processCircleSearchMembersData:z,getCircle:B,getCirclePromise:C,getCircles:D,createCircle:E,getCircleMembers:G,leaveGroup:I,deleteCircle:J,addMembers:F,removeMember:K,removeMembers:L,toggleMembership:M,redirectHome:u,getMemberResult:H,getSingleCircleInfo:A}}angular.module("ringid.circle").factory("circlesManager",a),a.$inject=["$routeParams","$location","$rootScope","$$connector","OPERATION_TYPES","Storage","$$stackedMap","$$q","circleMap","userFactory","circleHttpService","Notification","SystemEvents","Ringalert","Auth"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(){for(var d=(a.memberList.keys(),a.adminList.keys(),[]),e=0;e<a.memberList.length();e++)d[e]={admin:"false",uId:a.memberList.all()[e].value.user.uId};for(var f=[],g=0;g<a.adminList.length();g++)f[g]={admin:"true",uId:a.adminList.all()[g].value.user.uId};var i=f.concat(d),k={tg:a.models.circleName,alluser:i,uId:h.currentUser().getUId()};b.createCircle(k).then(function(a){a.sucs===!0&&(c.closeAll(),j.path("/circle/"+a.grpId))})}function l(){if(s()){var c=a.memberList.keys(),d=a.adminList.keys(),e=a.circle.getMemberIds(),f=a.circle.getAdminIds(),h=c.difference(e),i=e.difference(c),j=d.difference(f),k=f.difference(d),l=[];angular.forEach(h,function(a){l.push({admin:!1,uId:a})}),angular.forEach(j,function(a){l.push({admin:!0,uId:a})}),l.length>0&&b.addMembers(l,a.circle);var m=i;m=m.concat(k),m.length>0&&b.removeMembers(m,a.circle),g.show("Circle Updated","success"),a.close()}}function m(b){a.memberList.add(b.getUtId(),b),a.selectedMembers.push(b),a.friendlist.remove(b.getUtId()),a.friendDropdown=!1,a.friendsNameFilter="",a.$rgDigest()}function n(b){a.memberList.remove(b.getUtId()),a.$rgDigest()}function o(b){a.adminList.add(b.getUtId(),b),a.memberList.remove(b.getUtId()),a.$rgDigest()}function p(b){a.adminList.remove(b.getUtId()),a.memberList.add(b.getUtId(),b),a.$rgDigest()}function q(b){a.state.loading=b,b||i.recalculate(a),a.$$phase||a.$root.$$phase||a.$digest()}function r(){a.state.loading||a.friends.length()===d.totalFriends("friends")||(q(!0),d.getContactDetails().then(function(){a.friends=d.getFriends("friends"),a.friendlist=d.getFriends("friends").copy(),q(!1)},function(){q(!1)}),setTimeout(function(){a.state.loading=!1},3e3),a.$rgDigest())}function s(){return a.models.circleName.length>60?a.models.errCircleName="Maximum 60 characters":0===a.models.circleName.length?a.models.errCircleName="Name required":a.models.errCircleName="",a.models.errMemberList=a.memberList.length()<1,0===a.models.errCircleName.length&&!a.models.errMemberList}a.friends=d.getFriends("friends"),a.circleAddMode=!1,a.selectedMembers=[],a.state={loading:!1,noData:!1},a.circleNameSection=!0,a.circleMemberSection=!1,a.circleAdminSection=!1,a.friendDropdown=!1,a.$watch("friendsNameFilter",function(b,c){b?a.friendDropdown=!0:a.friendDropdown=!1}),a.closeFriendDd=function(){a.friendDropdown=!1,a.$rgDigest()},a.friendsNameFilter="",a.memberfilter="",a.nextPart=function(b){switch(b){case"setmembers":a.circleNameSection=!1,a.circleMemberSection=!0;break;case"setadmins":a.circleMemberSection=!1,a.circleAdminSection=!0}},a.$on("$destroy",function(){a.friendlist.reset(),a.selectedMembers=[]}),a.friendlist=d.getFriends("friends").copy(),a.models={errCircleName:!1,errMemberList:!1,errAdminList:!1},f.circleId||(a.circleAddMode=!0),a.editMode=!1,f&&f.circleId?(a.circle=b.getCircle(f.circleId),a.memberList=a.circle.getMembers(),a.adminList=a.circle.getAdmins(),a.isCurrentUserSuperAdmin=a.circle.isSuperAdmin(h.currentUser().getKey()),a.models.popupTitle="Edit Group",a.models.circleName=a.circle.getName(),a.editMode=!0):(a.models.popupTitle="Create New Circle",a.models.circleName="",a.memberList=e.createNew(),a.adminList=e.createNew()),a.addToCircle=m,a.addToAdmin=o,a.removeMember=n,a.removeAdmin=p,a.createCircle=k,a.updateCircle=l,a.close=c.close,a.validateCircle=s,a.loadMoreFriends=r,a.$watch("friendName",function(b){b&&b.length>1?(q(!0),d.searchContact({schPm:b},!0).then(function(){a.friends=d.getFriends("friends"),a.friendlist=d.getFriends("friends").copy(),q(!1),a.$rgDigest()},function(){q(!1),a.$rgDigest()})):(a.friendlist=d.getFriends("friends").copy(),a.$rgDigest())})}angular.module("ringid.circle").controller("CirclePopupController",a),a.$inject=["$scope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","Ringalert","Auth","rgScrollbarService","$location"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){for(var c=[],d=0;d<a.memberList.length();d++)c[d]={admin:"false",uId:a.memberList.all()[d].value.user.uId};b.addMembers(c,f.target).then(function(c){c.sucs===!0?b.getSingleCircleInfo(f.target,f.circleObj):(h.show(c.mg,"info"),a.$rgDigest()),a.close()})}function k(b){a.memberList.add(b.getUtId(),b),a.selectedMembers.push(b),a.friendlist.remove(b.getUtId()),a.friendDropdown=!1,a.friendsNameFilter="",a.$rgDigest()}function l(b){a.memberList.remove(b.getUtId()),a.$rgDigest()}a.selectedMembers=[],a.state={loading:!1,noData:!1},a.circleMemberSection=!1,a.friendDropdown=!1,a.$watch("friendsNameFilter",function(b,c){b?a.friendDropdown=!0:a.friendDropdown=!1}),a.closeFriendDd=function(){a.friendDropdown=!1,a.$rgDigest()},a.friendsNameFilter="",a.memberfilter="",a.$on("$destroy",function(){a.friendlist.reset(),a.selectedMembers=[]}),a.friendlist=d.getFriends("friends").copy(),a.memberList=e.createNew(),a.addToCircle=k,a.removeMember=l,a.updateCircle=j,a.close=c.close}angular.module("ringid.circle").controller("circleEditPopupController",a),a.$inject=["$scope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","remoteData","Ringalert","SystemEvents"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){y.circle&&(a.isPageReady=!0,s(),r())}function r(){y.isCurrentUserAdmin=a.currentUser.isAdmin(y.circle.getKey()),y.isCurrentUserSuperAdmin=y.circle.isSuperAdmin(f.currentUser().getKey()),y.ddControl.isAdmin=y.isCurrentUserAdmin,y.ddControl.isSuperAdmin=y.isCurrentUserSuperAdmin}function s(){a.circleMembers=y.circle.getAllMembers(),a.$rgDigest()}function t(){d.getCircleMembers(z,0)}function u(a){d.removeMember(a,y.circle)}function v(b){switch(o.close(b.event),b.action){case"remove":d.removeMember(b.member.getKey(),y.circle);break;case"changemember":d.toggleMembership({grpId:y.circle.getKey(),uId:b.member.getKey(),admin:Boolean(b.admin)},y.circle);break;case"addfriend":case"accept":case"reject":b.friend.isLoading()||e.friendAction(b,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()})}a.$rgDigest()}function w(a){var b="Are you sure you want to "+a.action+" "+y.circle.getName()+"?";o.close(a.event);var c=g.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:b}},templateUrl:"pages/partials/ringbox-confirm.html"});c.result.then(function(b){b&&x(a)})}function x(b){switch(b.action){case"delete":d.deleteCircle(y.circle).then(function(b){b.sucs===!0?c.path("/"):a.$rgDigest()},function(b){a.$rgDigest()});break;case"leave":d.leaveGroup(y.circle).then(function(b){b.sucs===!0&&(c.path("/"),p.$rgDigest()),a.$rgDigest()},function(b){a.$rgDigest()})}}var y=this,z=b.circleId,A=b.subpage;a.loadMoreCircleMember=!1,a.showSearchLoader=!1,a.hideLoadButton=!1,a.currentUserUId=f.currentUser().getUId(),d.getCirclePromise(z).then(function(b){b?(y.circle=b,a.isCurrentUserAdmin=y.circle.isAdmin(),a.isCurrentUserSuperAdmin=y.circle.isSuperAdmin(a.currentUserUId),"members"===A&&(a.showBackKey=0,a.showBack=function(b,c){var d=c.target.getAttribute("data-is-anchor");d||(a.showBackKey=b,c.preventDefault(),c.stopPropagation(),a.$rgDigest())},t()),q()):d.redirectHome()},function(a){d.redirectHome()}),a.showComingSoon=function(a){a.preventDefault(),a.stopPropagation(),n.show("Coming soon","info")},y.ddHtml="pages/dropdowns/circle-edit-dropdown.html",y.ddAction=w,y.ddControl={isAdmin:a.isCurrentUserAdmin,isSuperAdmin:a.isCurrentUserSuperAdmin,getCircleData:function(){return o.close(),{circleId:z}}},y.ddMemberHtml="pages/dropdowns/circle-member-dropdown.html",y.ddMemberAction=v,y.removeMember=u,angular.isUndefined(b.subpage)?y.subPage="post":y.subPage=b.subpage,y.subPageLink="pages/home/circle."+y.subPage+".html",y.isCurrentUserAdmin=!1,y.isCurrentUserSuperAdmin=!1,y.getFriendType=function(a){return a.friendshipStatus()},y.circle?(a.isPageReady=!1,a.circleMembers.length||t()):a.isPageReady=!1,y.shouldShowMemberEditMenu=function(a){return!a.isCurrentUser()&&(y.isCurrentUserSuperAdmin||y.isCurrentUserAdmin&&!a.isAdmin(z))&&!y.circle.isSuperAdmin(a.getKey())},y.memberListSubscriptionKey=i.subscribe(d.processCircleMembersData,{action:j.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_LIST}),y.searchListSubscriptionKey=i.subscribe(d.processCircleSearchMembersData,{action:j.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_SEARCH_RESULT}),a.$on(h.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,function(b,c){a.loadMoreCircleMember=!1,a.showSearchLoader=!1,c.success?a.hideLoadButton=!1:a.hideLoadButton=!0,q(),a.$rgDigest()}),a.$on(h.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT,function(b,c){a.$rgDigest()}),a.$on(h.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,function(){s(),a.$rgDigest()}),a.$on(h.CIRCLE.MY_CIRCLE_REMOVED,function(a,d){d.circleId===b.circleId&&(n.show("Circle has been Removed OR You have been removed from the circle.","info"),l(function(){c.path("/")}))}),a.cMemberSearch=function(){y.searchParam?(a.showSearchLoader=!0,d.getMemberResult(y.searchParam,z)):a.hideLoadButton=!1,a.$rgDigest()},a.loadMoreMembers=function(){if(y.searchParam)a.showSearchLoader=!0,d.getMemberResult(y.searchParam,z);else{var b=20;a.loadMoreCircleMember=!0,d.getCircleMembers(z,null,b)}a.$rgDigest()},a.getCircleId=function(){return{data:function(){return{target:z,circleObj:y.circle}}}},a.$on("$destroy",function(){y.circle&&y.circle.resetMembers(),i.unsubscribe(y.memberListSubscriptionKey),i.unsubscribe(y.searchListSubscriptionKey)})}angular.module("ringid.circle").controller("CirclePageController",a),a.$inject=["$scope","$routeParams","$location","circlesManager","friendsFactory","Auth","$ringbox","SystemEvents","$$connector","OPERATION_TYPES","circleHttpService","$timeout","APP_CONSTANTS","Ringalert","rgDropdownService","$rootScope"]}(),function(){"use strict";function a(a,b,c,d,e){function f(a){return"true"===a||a===!0?d.getCircles(!0):d.getCircles(!1)}var g;a.getCircles=f,c.subscribe(function(){g||(g=setTimeout(function(){clearTimeout(g),e.recalculate(a),a.$rgDigest()}))},{action:[b.SYSTEM.CIRCLE.TYPE_GROUP_LIST]})}angular.module("ringid.circle").controller("allCirclePopupController",a),a.$inject=["$scope","OPERATION_TYPES","$$connector","circlesManager","rgScrollbarService"]}(),function(){"use strict";var a;a=angular.module("ringid.feed",["ngWebSocket","ringid.utils","ringid.config","ringid.connector"])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b){var d=this;if(d.key=q+a.nfId,d.updateRaw(a),d.setFeedUser(b),d.feelings={},d.tagUsers=[],d.shareUsers=[],d.circle={},d.orginal={},d.feedHtml="",d.images=c.createNew(!0,"asc"),d.medias=c.createNew(),d.audios=c.createNew(),d.setImages(),d.initMedias(),d._f.fndId?d.friend=h.create({uId:d._f.fndId,fn:d._f.ffn,ln:d._f.fln}):d.friend=!1,d.initOgData(),d.initLocationData(),d.update(null,!1,!0),d.isSingleContentFeed()){var e=d.getSingleContent();d.images.length()||(d._f.is=e.share(),d._f.ns=e.getTotalShare()),d._f.ic=e.selfComment(),d._f.nc=e.getTotalComment()}Object.defineProperty(d,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{feedKey:d._f.nfId,showEdit:function(){return!!(d._u.isCurrentUser()&&d._f.nl<1)},feedUser:function(){return d._u},tagButtonText:function(){return d.tagUsers.length?"Edit Tag":"Add Tag"},showDelete:function(){return d._u.isCurrentUser()||d.friend&&d.friend.isCurrentUser()},showTagButton:function(){return d._u.isCurrentUser()&&!d._f.grpId}}})}var q="nf_",r="tm",s=m.FEED,t=n.SYSTEM,u='<user-card user="feed.user()"></user-card>',v={nfId:0,utId:0,isNew:0,lctn:"",lat:9999,lng:9999,gNm:"",grpId:0,sts:"",stsTags:[],tim:0,imT:0,fndId:0,whoShare:{},mdaCntntLst:[],type:0,mdLst:[],tm:Date.now(),at:Date.now(),ic:0,il:0,is:0,nc:0,nl:0,ns:0,sc:0,tfc:0,stp:0,fc:0,actvt:0,afn:"",auId:0,lnkDmn:"",lnkDsc:"",lnkTtl:"",lnkURL:"",lnlImgURL:"",fTgLst:[]};return p.prototype={updateRaw:function(a,b){var c;this._f?(c=b||!a.tm?this._f.tm:a.tm,angular.extend(this._f,a),this._f.tm=c):this._f=angular.extend({},v,a),9999===this._f.lat&&(this._f.lctn=""),a=null},update:function(a,b,c){var d=this;c||d.updateRaw(a,b),d._f.mdLst&&d._f.mdLst.length&&(d.feelings=l.getEmotion(d._f.mdLst[0],!0)),d.setTagUsers(),d._f.at?d.vtime=i.verbalDate(d._f.at):d.vtime="",d.setFeedTopMessage(),d.processFeedMessage(),d.addPostfixMessage(),d.parseStatus(),a=null},getKey:function(){return this._f.nfId},sortBy:function(){return this._f[r]||this._f.tm},getMapKey:function(){return this.key},setFeedKey:function(a){this._f.nfId=a},getFeedKey:function(a){return this._f.nfId},getPrivacy:function(){return o["PVC"+(this._f.fpvc||3)]},getByProperty:function(a,b){return b=b||!1,this._f.hasOwnProperty(a)?this._f[a]:b},checkMessageUpdated:function(){return this.message+this._f.lctn+this.tagUsers.reduce(function(a,b){return a.toString()+b.toString()},"")+this._f.tfc},getTargetWall:function(){return this.friend},getTargetCircle:function(){return angular.equals({},this.circle)?this._f.gNm:this.circle},setFeedUser:function(a){var b=this;if(angular.isDefined(a))b._u=a;else if(b._f.utId?b._u=h.getByUtId(b._f.utId):b._f.uId?b._u=h.getUser(b._f.uId):b._u=!1,!b._u){var c={};b._f.uId&&(c.uId=b._f.uId),b._f.utId&&(c.utId=b._f.utId),b._f.fn&&(c.fn=b._f.fn),b._f.prIm&&(c.prIm=b._f.prIm),b._u=h.create(c)}},user:function(){return this._u},processFeedMessage:function(){var a,b="",c="",d=[u],e=this;switch(e.friend?b="F":e._f.grpId&&(e.circle=j.getCircle(e._f.grpId),b="C"),e._f.type){case t.NEWS_FEED_TYPE_IMAGE:e.images.length()>0?(e.message=s["TYPE_1"+e.images.top().getImageType()+b]||s.TYPE_D,e.message=e.feedConditionalReplacer(e.message,[e._u.isCurrentUser()])):e.message=s.TYPE_D;break;case t.NEWS_FEED_TYPE_STATUS:e.hasOgData()&&(c="L"),e.message=s["TYPE_2"+b+c];break;case t.NEWS_FEED_TYPE_MULTIPLE_IMAGE:e.message=s["TYPE_"+e._f.type],e.message=e.feedConditionalReplacer(e.message,[e._u.isCurrentUser()]),d.push(e._f.tim);break;case t.NEWS_FEED_TYPE_ALBUM:case t.NEWS_FEED_TYPE_AUDIO:case t.NEWS_FEED_TYPE_VIDEO:a=e._f.stp||0,e.message=s["TYPE_"+e._f.type+a],a||!e.medias.length()&&!e.audios.length()?d.push('<user-card class="share-user" user="feed.getSingleContent().user()"></user-card>'):d.push(e.medias.length()||e.audios.length());break;default:e.message=s.TYPE_D}e.friend?e.message+=" "+s.F_POSTFIX.format('<user-card class="wall-user" user="feed.getTargetWall()"></user-card>'):e._f.grpId&&(e.message+=" "+s.C_POSTFIX.format('<a class="cir-title" href="/#/circle/'+e._f.grpId+'" >'+e._f.gNm+"</a>")),e.rawmessage=e.message,e.message=e.message.format(d),e.oldMessage=e.message},updateShareMessage:function(){var a=u;this.orginal.getTotalShare()>1&&(a+="and "+(this.orginal.getTotalShare()-1)+" other people");var b=[u];this.message=s.TYPE_SHARE,b.push('<user-card class="share-user" user="feed.getOrginalFeed().user()"></user-card>'),this.message=this.message.format(b),this.oldMessage=this.message,this.addPostfixMessage()},addPostfixMessage:function(){var a=this;a.message=a.oldMessage,(a._f.mdLst.length||a.tagUsers.length||a.location)&&("{0}"!==a.rawmessage?a.message+=" &mdash;":a.message+=" is"),a._f.mdLst.length&&(a.message+='&nbsp;<span class="feelings-text">feeling</span> <img class="feed_emo" src="'+a.feelings.url+'" />&nbsp;'+a.feelings.nm),a.tagUsers.length&&(a.message+='&nbsp;<feed-tag-more-user tag-feed="feed"></feed-tag-more-user>'),this._f.lctn&&(a.message+='&nbsp;<location-card feed="feed"></location-card>')},getMessageText:function(){return this.message},hasActivityMessage:function(){return this._f.actvt>0},setActivity:function(a){this._f.actvt=a.actvt||0,this._f.afn=a.afn,this._f.auId=a.auId,this.setFeedTopMessage()},setFeedTopMessage:function(){var b=this;if(b._f.actvt>0){if(b.subMessage="",b._f.actvt&&m.FEED["ACT_"+b._f.actvt]){var c=h.getByUtId(b._f.auId),d="<b>You</b>";c?c.isCurrentUser()||(d='<user-card user="feed.getActivityUser()"></user-card>'):a.currentUser().getUtId()!==b._f.auId&&(c=h.createByUtId({fn:b._f.afn,utId:b._f.auId},!0),d='<user-card user="feed.getActivityUser()"></user-card>'),b._au=c,b.subMessage=m.FEED["ACT_"+b._f.actvt].format(d)}b.subMessage=k.trustAsHtml(b.subMessage)}},getActivityMessage:function(a,b,c){return this.subMessage},getActivityUser:function(){return this._au},parseStatus:function(){var a,b=[],c=this;if(c._f.sts||c._f.stsTags){if(c._f.stsTags&&c._f.stsTags.length){var d,e=0;c._f.stsTags.sort(function(a,b){return b.pstn>a.pstn?-1:1});for(var f=0;f<c._f.stsTags.length;f++)d=c._f.stsTags[f].pstn-e,a=h.create(c._f.stsTags[f]),d>0&&b.push(i.parseForLE(c._f.sts.substr(e,d))),b.push(a.getLink({"class":"tag",title:a.getName().trim(),"data-link":a.getUtId()})),e=c._f.stsTags[f].pstn;d=c._f.sts.length-e,d>0&&b.push(i.parseForLE(c._f.sts.substr(e,d))),c.feedHtml=b.join("")}else c.feedHtml=i.parseForLE(c._f.sts);c.feedHtml=k.trustAsHtml(c.feedHtml)}else c.feedHtml=""},parseMoreText:function(a){this._f.sts=a.sts,this.parseStatus()},showMore:function(){return!!this._f.sc},setText:function(a,b){this._f.sts=a,b&&(this._f.stsTags=b),this.parseStatus()},text:function(){return this._f.sts},getDynamicText:function(){return this.feedHtml},getDynamicTextMore:function(a,b){a=parseInt(a)>0?parseInt(a):20;for(var c,d="(",e=i.parseForLE(this._f.sts),f=a;f>0;f--)d+="[\\S]+\\s";return d+=")(.*)",c=e.replace(new RegExp(d),'<span class="with-more"><input id="read'+b+'" type="checkbox" /><span class="less">$1</span><span class="more">$2</span><label for="read'+b+'" class="trigger"></label></span>'),k.trustAsHtml(c)},getAtTime:function(){return this._f.at},time:function(){return this.vtime},updateTime:function(){this.vtime=i.verbalDate(this._f.at)},setTime:function(a){this._f.tm=a},getTimestamp:function(){return this._f.tm},incomingLike:function(a){return a&&++this._f.nl||--this._f.nl},like:function(a,b){return a?(this._f.il=1^this._f.il,b?this._f.nl=b:this._f.nl=this._f.il?this._f.nl+1:this._f.nl-1,this.identical&&this.identical.like(a),this._f.il):this._f.il},setTotalLikes:function(a,b){this._f.nl=a,angular.isDefined(b)&&(this._f.il=b),this.identical&&this.identical.setTotalLikes(a,b)},setIdenticalFeed:function(a){this.identical=a},getTotalLikes:function(){return this._f.nl},setTotalComment:function(a,b){this._f.nc=a,angular.isDefined(b)&&(this._f.ic=b),this.identical&&this.identical.setTotalComment(a.ic)},getTotalComment:function(){return this._f.nc},selfComment:function(){return this._f.ic},getTotalShare:function(){return this._f.ns},getShareUsers:function(){return this.shareUsers},addShareUser:function(a){return"array"==typeof a?this.shareUsers=this.shareUsers.concat(a):this.shareUsers.push(a),this.shareUsers},share:function(a,b){return a?(this._f.is=1^this._f.is,b?this._f.ns=b:this._f.ns=this._f.is?this._f.ns+1:this._f.ns-1,this._f.is):this._f.is},shares:function(a){this.orginal=a,this.orginal.addShareUser(this._u),this.updateShareMessage()},getWhoShares:function(){return this._f.whoShare},getOrginalFeed:function(){return this.orginal},hasSharedFeed:function(){return!angular.equals({},this.orginal)},getTotalImage:function(){return this._f.tim},setImages:function(){var a,b,c,e=0;if(this._f.imageList){try{a=angular.isString(this._f.imageList)?angular.fromJson(this._f.imageList):this._f.imageList}catch(f){}for(b=a.length>3?3:a.length,e=0;b>e;e++)a[e].nfId=this._f.nfId,c=d(a[e],this._u),this.images.add(c.getMapKey(),c)}switch(this.images.length()){case 1:this.imlayout=5;break;case 2:this.imlayout=4;break;default:this.imlayout=this._f.nfId%4}},getImages:function(a){return a?this.images:this.images.all()},getImageLayout:function(a){return this.imlayout},hasMedia:function(){return this.images.length()>0||this.medias.length()>0||this.audios.length()>0},getAlbum:function(){return this.album},initMedias:function(){if(this._f.mdaCntntLst&&this._f.mdaCntntLst.length>0){var a=this._f.stp>0?null:this._u,b=this._f.mdaCntntLst;this.album=f.createAlbum({albn:b[0].albn,albId:b[0].albId,mc:b.length,mdaT:b[0].mdaT,utId:a?a.getUtId():0}),this.album.pushContent(b,a,this._f.nfId),this.album.isAudio()?this.audios=this.album.getContents():this.album.isVideo()&&(this.audios=this.album.getContents())}},getMedias:function(){return this.medias},getAudios:function(){return this.audios},setViewColumn:function(a){this.viewColumn=a},getViewColumn:function(){return this.viewColumn},getUrl:function(){return i.getRingRoute("SINGLE_FEED",{feedId:this._f.nfId,shared:this.hasSharedFeed()})},getWhoShareUrl:function(){var a;return a=this.hasSharedFeed()?this.getOrginalFeed().getKey():this.getKey(),i.getRingRoute("WHO_SHARED_FEED",{feedId:a})},hasFeelings:function(){return!!this._f.mdLst.length},getFeelings:function(){return this.feelings},setFeelings:function(a){a&&a.id?(this.feelings=a,this._f.mdLst[0]=a.id):(this.feelings={},this._f.mdLst=[]),this.addPostfixMessage()},setTagUsers:function(a,b){if(a?this._f.fTgLst=a:a=this._f.fTgLst,this.tagUsers.length=0,a&&a.length)for(var c=0;c<a.length;c++)a[c].fn=a[c].nm,this.tagUsers.push(h.createByUtId(a[c]));angular.isDefined(b)&&(this._f.tfc=b)},updateTagUser:function(a){this.setTagUsers(a.fTgLst,a.tfc),this.addPostfixMessage()},hasTagUsers:function(){return!!this.tagUsers.length},getTagUsers:function(){return this.tagUsers},validateForUpdateTag:function(){return""!==this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length()},hasMoreTagUsers:function(){return this._f.tfc>this.tagUsers.length},getMoreTagUsers:function(){return this._f.tfc-this.tagUsers.length},getTotalTag:function(){return this._f.tfc},getLocationText:function(){return this._f.lctn},getLocationShortText:function(){if(this._f.lctn){var a=this._f.lctn,b=this._f.lctn.split(",");return b.length>2&&(a=b[0].replace("(","")),a.length>30&&(a=a.substr(0,30)+"..."),a}},setLocationText:function(a){return this._f.lctn=a,this.addPostfixMessage(),a},resetLocationText:function(){this._f.lctn=""},getContentType:function(){var a;return a=this.images.length()?"image":this.medias.length()?"media":this.audios.length()?"media":"feed"},hasLocationInfo:function(){return!(""===this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length())},getLocationInfo:function(){return this.locationData},getLocationUrl:function(){return k.trustAsResourceUrl(i.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!1))},getLocationEmbedUrl:function(){return k.trustAsResourceUrl(i.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!0))},getLocationStaticEmbedUrl:function(){return k.trustAsResourceUrl(i.getGoogleMapStaticUrl(this._f.lat,this._f.lng,this._f.lctn))},initLocationData:function(){9999!==this._f.lat?this.locationData={description:this._f.lctn,lat:this._f.lat,lng:this._f.lng}:this.locationData={description:this._f.lctn}},setLocationInfo:function(a){this._f.lctn=a.description,this._f.lat=a.lat,this._f.lng=a.lng,this.initLocationData(),this.addPostfixMessage()},getStrmURL:function(){return this._f.strmURL},getLinkDomain:function(){return this._f.lnkDmn},getLinkUrl:function(){return this._f.lnkURL},getLinkTitle:function(){return this._f.lnkTtl},getLinkDescription:function(){return this._f.lnkDsc},getLinkImageUrl:function(){return this._f.lnlImgURL},hasOgData:function(){return!!(this._f.lnlImgURL||this._f.lnkTtl||this._f.lnkDsc)},getOgData:function(){return this.ogData},initOgData:function(){this.ogData||(this.ogData={}),this.ogData.image=this._f.lnlImgURL,this.ogData.description=this._f.lnkDsc,this.ogData.title=this._f.lnkTtl,this.ogData.url=this._f.lnkURL,this.ogData.lnkDmn=this._f.lnkDmn},setOgData:function(a){this._f.lnkDsc=a.lnkDsc||a.description||"",this._f.lnkTtl=a.lnkTtl||a.title||"",this._f.lnkURL=a.lnkURL||a.url||"",this._f.lnlImgURL=a.lnlImgURL||a.image||"",this._f.lnkDmn=a.lnkDmn||a.domain||"",this.initOgData()},isEmpty:function(a){return a=a||{},!this.text||a.tagUsers&&this.tagUsers.length},isSpecial:function(){return this._f.fc>0},isFeed:!0,isTimelinePost:function(){return this.friend&&this.friend.isCurrentUser()},isWallPost:function(){return!!this.friend},isCirclePost:function(){return this._f.grpId>0},isMediaShared:function(){return this._f.stp>0},isSingleContentFeed:function(){return 1===this.images.length()||1===this.medias.length()||1===this.audios.length()},getSingleContent:function(){return this.images.length()&&this.images.bottom()||this.medias.length()&&this.medias.bottom()||this.audios.length()&&this.audios.bottom()||this},isPending:function(a){return void 0!==a&&(this.pending=!!a),this.pending},isShareAble:function(a){var b,c=!0,d=this.isSingleContentFeed()&&!this.images.length(),e=this.getSingleContent();return this._u.isCurrentUser()||d&&e.user().isCurrentUser()?(b="RC15",c=!1):this.friend?(b="CRCFS1",c=!1):this._f.grpId?(b="CRCFS2",c=!1):this._f.is&&!d&&(b="CRCFS3",c=!1),a?{sucs:c,rc:b}:c},encodeUtf8Fields:function(){var a,b,c=["location","lctn","lnkDmn","lnkDsc","lnkTtl","lnkURL","lnlImgURL"];
for(a=0;a<c.length;a++)b=c[a],this._f[b]?this._f[b]=this._f[b].utf8Encode():this._f[b]=""},feedConditionalReplacer:function(a,b){var c=0;return b=b||[],a=a.replace(/(\w+)?\|\|(\w+)?/g,function(a,d,e){return void 0!==b[c]?b[c]?d:e:""}),a.replace(/(\s){2,}/g," ")}},{getPrefix:function(){return q},setSortKey:function(a){r=a},setPrefix:function(a){q=a},getSortIndex:function(){return r},makeKey:function(a){return q+a},create:function(a,b){return new p(a,b)}}}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config","ringid.media"])}b.factory("$$feedMap",a),a.$inject=["Auth","settings","$$stackedMap","$$imageMap","Media","$$mediaAlbumMap","$$mediaMap","userFactory","utilsFactory","circlesManager","$sce","EmotionFactory","MESSAGES","OPERATION_TYPES","PrivacySet"]}(),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){e.setSortKey(a)}function o(){return va.hasOwnProperty(ta)?va[ta].data:d.createNew()}function p(){return va.hasOwnProperty(ta)?va[ta].removed:d.createNew()}function q(){var a=[];try{a=ta.split(".",2)}catch(b){return!1}return 2!=a.length?!1:{action:parseInt(a[0]),page:a[1]}}function r(){for(var a=o(),b=0;b<a.length();b++){var c=Date.now()-a.all()[b].value.getTimestamp();36e5>c&&a.all()[b].value.updateTime()}}function s(a){var b=o();return b.length()<10?(fa(a),!0):!1}function t(){o().reset(),p().reset(),wa.length=0}function u(){var a=e.getSortIndex(),b=o();if("tm"===a)return b.length()?b.top().getTimestamp():k;var c=b.length()?b.top().getAtTime():k;return c}function v(a,b){return e.create(a,b)}function w(){return!0}function x(a,b){return a.nfId==b.page||a.whShrLst&&a.whShrLst[0].nfId==b.page}function y(a,b){return!!a.grpId&&a.grpId==b.page}function z(a,b){return!0}function A(a,b){return b||(b=q()),b.page===a.uId||a.fndId&&b.page===a.fndId?!0:!(!a.orgFd||b.page!==a.orgFd.uId)}function B(a){C(a)}function C(a){H(a,A,{processWhoShare:function(a,b,c){var d,e;a.uId===c.page&&a.orgFd&&(e=v(a.orgFd),d=v(a),d.shares(e),b.save(d.getMapKey(),d))}})}function D(a){H(a,y)}function E(a){H(a,z)}function F(a){H(a,w)}function G(a){var b;va.special||(va.special=d.createNew(e.getSortIndex(),"desc")),b=v(a),va.special.save(b.getMapKey(),b)}function H(a,b,c){c=c||{},angular.isFunction(b)||(b=function(){return!0});var d=angular.isArray(a)?a:a.newsFeedList;if(angular.isArray(d))for(var e,f,g,h,i=q(),j=o(),k=0;k<d.length;k++)g=d[k],h=g.nfId,0==ua?ua=h:ua>h&&(ua=h),g.fc>0?G(d[k]):b(g,i)&&(g.deleted?deleteFromIndexedFeed(g.nfId):g.whShrLst||g.orgFd?c.processWhoShare&&angular.isFunction(c.processWhoShare)?c.processWhoShare.call(null,g,j,i):(g.orgFd?(e=v(g),(f=O(g.orgFd.nfId))||(f=v(g.orgFd))):(e=v(g.whShrLst[0]),(f=O(g.nfId))||(f=v(g))),e.shares(f),j.save(e.getMapKey(),e),M(f,e.getKey())):(e=v(g),j.save(e.getMapKey(),e)))}function I(a){H(a,x)}function J(a){switch(a||(a=q()),a.action){case ra.TYPE_MY_NEWS_FEED:case ra.TYPE_FRIEND_NEWSFEED:return A;case ra.TYPE_GROUP_NEWS_FEED:return y;case ra.TYPE_MEDIAS_NEWS_FEED:return z;case ra.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:return x;case ra.TYPE_NEWS_FEED:default:return w}}function K(a){var b=q();switch(b.action){case ra.TYPE_MY_NEWS_FEED:C(a);break;case ra.TYPE_FRIEND_NEWSFEED:B(a);break;case ra.TYPE_GROUP_NEWS_FEED:D(a);break;case ra.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:I(a);break;case ra.TYPE_NEWS_FEED:F(a);break;case ra.TYPE_MEDIAS_NEWS_FEED:E(a)}}function L(){for(var a;wa.length&&xa;)a=wa.shift(),a.callback?a.callback.call(null,a,!0):K([a])}function M(a,b,c){c||(c=p()),a.reference=b,c.save(a.getMapKey(),a)}function N(a,b){return b||(b=p()),a=e.getPrefix()+a,b.get(a)}function O(a){var b;return b=o(),a=e.getPrefix()+a,b.get(a)}function P(a){var b=o();b.add(a.getMapKey(),a)}function Q(a,b){return b||(b=o()),b.remove(e.makeKey(a))}function R(a,b,c){if(a){var d=Y(a);return d&&d.isSingleContentFeed()?(d.setTotalLikes(c,b),Aa[a]):void 0}}function S(a,b,c){if(a){var d=Aa[a];return d&&d.feed.isSingleContentFeed()?(d.feed.setTotalComment(b,c),d):void 0}}function T(a){var b=O(a.nfId),c=Aa[a.nfId];if(b&&c){switch(a.actn){case ra.TYPE_UPDATE_EDIT_STATUS:b.update(a);break;case ra.TYPE_UPDATE_LIKE_STATUS:case ra.TYPE_UPDATE_UNLIKE_STATUS:b.setTotalLikes(a.loc),b.setFeedTopMessage();break;case ra.TYPE_UPDATE_ADD_STATUS_COMMENT:case ra.TYPE_UPDATE_DELETE_STATUS_COMMENT:b.setTotalComment(a.loc),b.setFeedTopMessage()}return c}}function U(a){Q(a.nfId)}function V(a,b,c,d){if(xa&&!b){a.callback=V;var e=J();return void(e.call(null,a.newsFeed)&&wa.push(a))}var f=a.newsFeed.orgFd&&a.newsFeed.orgFd.nfId;if(f){var g=O(f),h=p();if(g){if(c)return g.setActivity(a.newsFeed.orgFd),Aa[g.getKey()];M(g,a.newsFeed.nfId,h),Q(g.getKey())}else if(g=N(f,h)){var e=J();return void H([a.newsFeed],e,{processWhoShare:function(a,b,e){var f,h=O(g.reference);if(!h)return void K([a]);if(e.page!=ra.TYPE_FRIEND_NEWSFEED&&e.page!=ra.TYPE_MY_NEWS_FEED){if(g.update(a,!0),c)return g.addShareUser(d),h.updateShareMessage(),h.setActivity(a),Aa[h.getKey()];f=v(a),f.setActivity(a.orgFd),Q(g.reference),f.shares(g),b.save(f.getMapKey(),f)}}})}K([a.newsFeed])}}function W(a){if(a.imageList||1!==a.type||(a.imageList=[a]),xa){var b=J();b.call(null,a,q())&&wa.push(a)}else K([a])}function X(a){var b,c=!1,d=angular.isArray(a)?a[0]:a;if(ya.length)for(b=0;b<ya.length;b++)ya[b].action===d.actn&&(c=ya[b].callback.call(null,d));return za[d.actn]&&!c?za[d.actn].call(null,d):void 0}function Y(a){return O(a)}function Z(a,b){var c=f.getUniqueID();return ya.push({key:c,action:a,callback:b}),c}function $(a){for(var b=-1,c=0;c<ya.length;c++)ya[c].key===a&&(b=c);return-1!=b?ya.splice(b,1):[]}function _(a){ta=a,va.hasOwnProperty(ta)||(va[ta]={data:d.createNew(e.getSortIndex(),"desc"),removed:d.createNew(),no_more_feed:!1})}function aa(a){return X(a)}function ba(){return function(a){return!!za[a.actn]}}function ca(){return o().all()}function da(){var a=o();return a.all()}function ea(){return va.hasOwnProperty(ta)?va[ta].no_more_feed:!1}function fa(a){var c=sa.FEED_LIMIT;switch(a=angular.copy(a||{}),a.pvtid=ua||0,a.st=da().length||0,f.feedColumn()){case 1:c=5;break;case 2:c=6;break;case 3:c=9}return a.lmt=a.lmt||c,b.send(a,ra.REQUEST_TYPE.REQUEST)}function ga(a){a=angular.copy(a||{}),a.scl=2,a.tm=0,fa(a)}function ha(a,b){var c=u();return a=angular.copy(a||{}),a.scl=b||2,a.tm=c?c:k,fa(a)}function ia(a,d){var e={actn:ra.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:a},f=c.defer(),g=Y(a);return g?f.resolve(g):b.request(e,ra.REQUEST_TYPE.REQUEST).then(function(a){if(a.sucs===!0){var b=angular.isArray(a)?a:a.newsFeedList[0];if(d&&b.orgFd){if(b.orgFd){g=v(b);var c=v(b.orgFd);g.shares(c)}}else g=v(b);if(g){var e=o();e.save(g.getMapKey(),g)}f.resolve(g)}else f.resolve(!1)},function(a){f.reject(a)}),f.promise}function ja(d,e,g){var h,j=c.defer(),k=0,n=o(),p=f.getUniqueID();d.stsTags=[];var q="",q="";d.text&&(q=d.text.replace(/##([\d]+)##/g,function(a,b,c){var e;return e=c-k,d.stsTags.push({pstn:e,utId:b}),k+=a.length,""}),d.text=q),g?h=d.feed?d.feed:Y(d.nfId):(h=v({nfId:p,fpvc:d.fpvc,sts:d.text,lat:d.lat||9999,lng:d.lng||9999,grpId:d.group||"",friendId:d.friend||"",fndId:d.friend||"",mdLst:d.mdIds||[],isNew:1,pending:!0,lctn:d.lctn||"",lnkDmn:d.lnkDmn||"",lnkDsc:d.lnkDsc||"",lnkTtl:d.lnkTtl||"",lnkURL:d.lnkURL||"",lnlImgURL:d.lnlImgURL||""},e),n.save(h.getMapKey(),h));var r={};if(d.cntntIDLst&&(r.cntntIDLst=d.cntntIDLst),d.group&&(r.grpId=d.group),d.friend&&(r.fndId=parseInt(d.friend)),d.lctn&&(r.lctn=d.lctn.utf8Encode()),d.lnkDmn&&(r.lnkDmn=d.lnkDmn.utf8Encode()),d.lnkDsc&&(r.lnkDsc=d.lnkDsc.utf8Encode()),d.lnkTtl&&(r.lnkTtl=d.lnkTtl.utf8Encode()),d.lnkURL&&(r.lnkURL=d.lnkURL.utf8Encode()),d.lnlImgURL&&(r.lnlImgURL=d.lnlImgURL.utf8Encode()),d.stsTags.length&&(r.stsTags=d.stsTags),r.actn=ra.TYPE_ADD_STATUS,d.images&&d.images.length>0)if(1===d.images.length)r.type=ra.NEWS_FEED_TYPE_IMAGE,r=angular.extend({},r,d.images[0].getAuthData());else{r.actn=ra.TYPE_ADD_MULTI_IMAGE,r.type=ra.NEWS_FEED_TYPE_MULTIPLE_IMAGE,r.imageList=[];for(var s=0,t=d.images.length;t>s;s++)r.imageList.push(d.images[s].getAuthData())}else if(d.videos&&d.videos.length>0){r.mdaCntntDTO={albId:a.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:sa.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:sa.NEWS_FEED_MEDIA_TYPE_VIDEO},r.type=ra.NEWS_FEED_TYPE_VIDEO;for(var s=0,t=d.videos.length;t>s;s++)r.mdaCntntDTO.mdaLst.push(d.videos[s].getAuthData(!0)),0===s&&(r.mdaCntntDTO.htgLst=r.mdaCntntDTO.mdaLst[0].htgLst)}else if(d.audios&&d.audios.length>0){r.mdaCntntDTO={albId:a.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:sa.NEWS_FEED_MEDIA_TYPE_AUDIO,lnkT:sa.NEWS_FEED_MEDIA_TYPE_AUDIO},r.type=ra.NEWS_FEED_TYPE_AUDIO;for(var s=0,t=d.audios.length;t>s;s++)r.mdaCntntDTO.mdaLst.push(d.audios[s].getAuthData(!0)),0===s&&(r.mdaCntntDTO.htgLst=r.mdaCntntDTO.mdaLst[0].htgLst)}else r.actn=ra.TYPE_ADD_STATUS,g?r.type=d.audio?ra.NEWS_FEED_TYPE_AUDIO:ra.NEWS_FEED_TYPE_VIDEO:r.type=ra.NEWS_FEED_TYPE_STATUS;return d.mdIds&&(r.mdIds=d.mdIds),d.tFrndIds&&(r.tFrndIds=d.tFrndIds),r.vldt=d.vldt||"-1",r.lng=d.lng||9999,r.lat=d.lat||9999,r.sts=d.text.utf8Encode(),r.fpvc=d.fpvc||2,b.request(r,ra.REQUEST_TYPE.UPDATE).then(function(a){l.$broadcast(m.FILE_UPLOAD.UPLOADS_POSTED),a.sucs?(g?h&&h.share(a.mdaCntntLst[0].is,a.mdaCntntLst[0].ns):(n.remove(h.getMapKey()),a.type===ra.TYPE_SINGLE_IMAGE_STATUS&&(a.imageList=[a]),K([a])),j.resolve(a)):(g||(n.remove(h.getMapKey()),i.show(a,"error")),j.reject(a))},function(a){g||(n.remove(h.getMapKey()),i.show(json,"error")),j.reject(json)}),j.promise}function ka(a){if(a.addShare)return ja(a,a.user,!0);var d=c.defer(),e={actn:ra.ACTION_SHARE_STATUS,sfId:a.feed.getKey(),type:2,sts:a.text.utf8Encode()};return a.mdIds&&(e.mdIds=a.mdIds),a.tFrndIds&&(e.tFrndIds=a.tFrndIds),a.location&&(a.location.description&&(e.lctn=a.location.description.utf8Encode()),a.location.lat&&(e.lat=a.location.lat,e.lng=a.location.lng)),b.request(e,ra.REQUEST_TYPE.UPDATE).then(function(b){b.sucs?(V(b,!0,!0,j.currentUser()),a.feed.share(!0),d.resolve(b)):d.reject(b)},function(a){d.reject(a)}),d.promise}function la(a,d){var e=c.defer(),f=O(d),g=o();return f?(f.user().isCurrentUser(a.getKey())||setTimeout(function(){e.reject("You are not authorized to delete this feed.")},100),f!==!1?(Q(f.getKey(),g),b.request({actn:ra.TYPE_DELETE_STATUS,nfId:d},ra.REQUEST_TYPE.UPDATE).then(function(a){a.sucs?e.resolve(a):(P(f),e.reject(a))},function(a){P(f),e.reject(a)})):setTimeout(function(){e.reject("Feed Not Found!")},100),e.promise):(setTimeout(function(){e.reject("Can't Delete Invalid Feed")}),e.promise)}function ma(a,d,e,f,g,h,i){var j=c.defer(),k=O(d);k.getMapKey();if(k.user().isCurrentUser(a.getKey())){var l,m=k.text(),n=k.getLocationInfo(),o=k.getOgData(),p=k.getFeelings(),q=[],r=0;e&&(l=e.replace(/##([\d]+)##/g,function(a,b,c){var d;return d=c-r,q.push({pstn:d,utId:b}),r+=a.length,""}),e=l);var s={actn:ra.TYPE_EDIT_STATUS,nfId:d,sts:e.utf8Encode()};q.length&&(s.stsTags=q),f=f||{},s.lctn=f.description?f.description.utf8Encode():"",s.lat=f.lat||9999,s.lng=f.lng||9999;var t=!k.hasOgData()||k.getLinkUrl()!=g.url||k.getLinkImageUrl()!=g.image;t&&(s.lnkDmn=g.domain||"",s.lnkDsc=g.description?g.description.utf8Encode():"",s.lnkTtl=g.title?g.title.utf8Encode():"",s.lnkURL=g.url?g.url.utf8Encode():"",s.lnlImgURL=g.image||"");var u=!1;return h&&h.id?(s.mdIds=[h.id],u=!0):(s.mdIds=[],u=!0),i&&(i.removed&&(s.rTFrndIds=i.removed),i["new"]&&(s.tFrndIds=i["new"])),k!==!1&&(k.setText(e,q),k.setLocationInfo(f),u&&k.setFeelings(h),t&&k.setOgData(g),b.request(s,ra.REQUEST_TYPE.UPDATE).then(function(a){a.sucs===!1?(k.setText(m),k.setLocationInfo(n),u&&k.setFeelings(p),t&&k.setOgData(o),j.reject(a)):j.resolve(a)},function(a){k.setText(m),k.setLocationInfo(n),u&&k.setFeelings(p),t&&k.setOgData(o),j.reject(a)})),j.promise}}function na(a){var d=c.defer(),e={actn:ra.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:a.getKey()};return b.request(e,ra.REQUEST_TYPE.REQUEST).then(function(b){b.sucs?(b.newsFeedList?a.parseMoreText(b.newsFeedList[0]):a.parseMoreText(b),d.resolve(b)):(i.show(b,"error"),d.reject())},function(a){i.show(a,"error"),d.reject()}),d.promise}function oa(a){return b.pull({actn:ra.TYPE_TAG_USER_LIST,nfId:a.getKey()},ra.REQUEST_TYPE.REQUEST)}function pa(a){return ra.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS+"."+a}function qa(a){var b=angular.isArray(a)?a:a.newsFeedList;return b.length>0&&b[0].whShrLst[0]?b[0].whShrLst[0].nfId:!1}var ra=g.SYSTEM,sa=h,ta=ra.TYPE_NEWS_FEED+".all",ua=0,va={},wa=[],xa=!1,ya=[],za={},Aa={};return za[ra.TYPE_NEWS_FEED]=K,za[ra.TYPE_MY_NEWS_FEED]=K,za[ra.TYPE_FRIEND_NEWSFEED]=K,za[ra.TYPE_GROUP_NEWS_FEED]=K,za[ra.TYPE_MEDIAS_NEWS_FEED]=K,za[ra.TYPE_UPDATE_ADD_STATUS]=W,za[ra.ACTION_UPDATE_SHARE_STATUS]=V,za[ra.TYPE_UPDATE_DELETE_STATUS]=U,za[ra.TYPE_UPDATE_EDIT_STATUS]=T,za[ra.TYPE_UPDATE_LIKE_STATUS]=T,za[ra.TYPE_UPDATE_UNLIKE_STATUS]=T,za[ra.TYPE_UPDATE_ADD_STATUS_COMMENT]=T,za[ra.TYPE_UPDATE_DELETE_STATUS_COMMENT]=T,{init:s,addScope:function(a,b){Aa[a]=b},removeScope:function(a){Aa[a]&&delete Aa[a]},getFeed:Y,updateTime:r,pushFeed:K,processIncomingFeed:L,setpushInIncomingFeed:function(a){xa=!!a},getPushIncomingFeed:function(){return xa},hasUnprocessedFeed:function(){return wa.length},addIgnoreFilter:Z,removeIgnoreFilter:$,setFactoryKey:_,createFeed:v,process:aa,getFeedFilter:ba,noMoreFeed:ea,requestForFeed:fa,initFeedRequest:ga,getSingleFeed:ia,requestForMoreFeed:ha,getRawFeeds:ca,getFeeds:da,addFeed:ja,shareFeed:ka,deleteFeed:la,updateFeed:ma,reset:t,moreFeedText:na,getSingleFeedPageKey:pa,getWhoShareFeedId:qa,getTagUsers:oa,setSortBy:n,getCurrentPageValue:q,hasSpecialFeed:function(){var a=q();return ra.TYPE_NEWS_FEED===a.action&&va.special&&va.special.length()>0},getSpecialFeedList:function(){return va.special&&va.special.all()},synchLike:R,synchComment:S}}var c;try{c=angular.module("ringid.feed")}catch(d){c=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config","ringid.notification"])}c.factory("feedFactory",b),b.$inject=["fileUploadService","$$connector","$$q","$$stackedMap","$$feedMap","utilsFactory","OPERATION_TYPES","APP_CONSTANTS","Ringalert","Auth","MIN_TIMESTAMP","$rootScope","SystemEvents"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){return function(c,h,i){function j(a){var c;n||(n=!0,k.addIgnore(),setTimeout(function(){g.$broadcast("FIRST_FEED_RECEIVED")},1e3)),!a.sucs&&a.rc>0&&a.rc==f.NO_MORE_FEED?k.setNoMoreFeed(!0):1111===a.rc?k.feeds.length||b.initFeedRequest(k.params):c=b.process(a),c?c.$rgDigest():(l++,k.feeds=b.getFeeds(),k.busy&&(k.busy=!1,k.clearRequestTimer()),m===!1&&(m=!0,requestAnimationFrame(function(){k.$rgDigest(),m=!1})))}var k=c.$parent,l=0,m=(e.SYSTEM,!1),n=!1,o=a.subscribe(j,{filter:b.getFeedFilter(),callWithUnresolved:!0}),p=d.add(function(){b.requestForFeed(k.params,1)});k.$on("$destroy",function(){a.unsubscribe(o),b.reset(),d.remove(p),n&&k.removeIgnore()})}}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.directive("rgFeedSubscriber",a),a.$inject=["$$connector","feedFactory","$window","$$rgsyncher","OPERATION_TYPES","REASON_CODES","$rootScope"]}(),function(){"use strict";function a(a,b,c){function d(a,b){return b*a.height/a.width}function e(a,b){return'<div class="img'+(a+1)+'" style="background-image:url(\'{{::feedimages['+a+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="RingBoxImagePopupController" ringbox-type="remote" ringbox-animation="true" ringbox-target="pages/partials/notification/'+(b||"image-popup.html")+'" ringbox-data="getImageData(feedimages['+a+'].value, feed)"></div>'}var f={layout_0:'<div class="grid">'+e(0)+'</div><div class="grid">'+e(1)+e(2)+"</div>",layout_2:'<div class="grid">'+e(0)+e(1)+'</div><div class="grid">'+e(2)+"</div>",layout_4:'<div class="grid">'+e(0)+e(1)+"</div>",layout_5:e(0)};f.layout_1=f.layout_0,f.layout_3=f.layout_2,f.layout_6=f.layout_5;var g={layout_0:'<div class="grid">'+e(0,"image-popup-special.html")+'</div><div class="grid">'+e(1,"image-popup-special.html")+e(2,"image-popup-special.html")+"</div>",layout_2:'<div class="grid">'+e(0,"image-popup-special.html")+e(1,"image-popup-special.html")+'</div><div class="grid">'+e(2,"image-popup-special.html")+"</div>",layout_4:'<div class="grid">'+e(0,"image-popup-special.html")+e(1,"image-popup-special.html")+"</div>",layout_5:e(0,"image-popup-special.html")};return g.layout_1=g.layout_0,g.layout_3=g.layout_2,g.layout_6=g.layout_5,{restrict:"A",scope:!0,link:function(a,b,e){var h;if("shared"===e.feedImage&&(a.feed=a.feed.getOrginalFeed()),a.layout_id=a.feed.getImageLayout(),a.feedimages=a.feed.getImages(),5===a.layout_id&&(a.feedimages[0].value.offset().width<600&&a.feedimages[0].value.offset().height<400?a.layout_id=6:d(a.feedimages[0].value.offset(),600)<400&&(a.layout_id=6)),b.addClass("img-layout-"+a.layout_id),a.feedimages.length){h=e.popupTemplate?g:f;var i=c(h["layout_"+a.layout_id])(a);a.feed.getTotalImage()>3&&(i[1].lastChild.innerHTML='<div class="img-bg-opa"></div>    <div class="img-bg-counter">+'+(a.feed.getTotalImage()-3)+"</div>"),b.html(""),b.append(i)}}}}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.directive("feedImage",a),a.$inject=["utilsFactory","SystemEvents","$compile"]}(),function(){"use strict";function a(a,b){return{restrict:"A",link:function(c,d,e){function f(){var a=j.getDynamicText();a.toString()?(d.html(a.toString()),c.editorEnabled?d.addClass("ng-hide"):d.removeClass("ng-hide")):d.addClass("ng-hide"),g()}function g(){j.showMore()&&!k&&(i=angular.element('<span class="showpointer showmore"> Show More</span>'),d.append(i),i.bind("click",h),c.$on("$destroy",function(){i&&(i.unbind("click"),i=null)}))}function h(){a.moreFeedText(j).then(function(a){c[e.rgMoreFeed]=j,d.html(j.getDynamicText().toString()),i.unbind("click"),i=null,c.$rgDigest(),k=!0})}var i,j=c.$eval(e.rgMoreFeed),k=!1,l=0;f(),c.$on(b.FEED.UPDATED,function(a,b){b.id===j.getKey()&&f()}),c.$on(b.FEED.RESET,function(a,b){b.getKey()===j.getKey()&&(j=b,f())}),c.$watch("feed.text()",function(a,b){l>0&&f(),l++}),c.$watch("editorEnabled",function(a,b){f()})}}}angular.module("ringid.feed").directive("rgMoreFeed",a),a.$inject=["feedFactory","SystemEvents"]}(),function(){"use strict";function a(a,b,c,d){return{restrict:"A",link:function(e,f,g){function h(){var a,b,d=c.viewport.yo;n>0&&(b=n+75,a=b-d,a>0&&(75>a?f.css("top","75px"):f.css("top",a+"px")))}function i(){a.hasUnprocessedFeed()?f.hasClass("active")||f.addClass("active"):f.removeClass("active")}function j(){c.viewport.yo>500?a.setpushInIncomingFeed(!0):a.hasUnprocessedFeed()&&k>c.viewport.yo?(a.processIncomingFeed(),a.setpushInIncomingFeed(!1),i()):a.setpushInIncomingFeed(!1),f.hasClass("active")&&h(),k=c.viewport.yo}var k,l=angular.element(b),m=a.getCurrentPageValue(),n=0,o=d.SYSTEM;switch(m.action){case o.TYPE_MY_NEWS_FEED:case o.TYPE_FRIEND_NEWSFEED:n=492;break;case o.TYPE_GROUP_NEWS_FEED:n=250;break;case o.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:case o.TYPE_NEWS_FEED:default:n=0}e.$watch(a.hasUnprocessedFeed,function(a,b){a>b&&i()}),f.on("click",function(){a.processIncomingFeed(),a.setpushInIncomingFeed(!1),i(),c.resetScroll(),c.animateScroll(),e.setFeed(),e.$rgDigest()}),l.bind("scroll",j);var p=function(){l.unbind("scroll",j),f.off("click")};i(),e.$on("$destroy",p)}}}angular.module("ringid.feed").directive("rgIncomingFeed",a),a.$inject=["feedFactory","$window","utilsFactory","OPERATION_TYPES"]}(),function(){"use strict";function a(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/feed-timeout-option.html",link:function(a){a.$rgDigest()},controller:["$scope",function(a){a.rows=[1,9,17],a.cols=[0,1,2,3,4,5,6,7],a.lastCols=[25,26,27,28,29,30],a.select=function(b){angular.isFunction(a.onSelect)&&a.onSelect({item:b}),a.close(),a.$parent.$rgDigest()}}]}}function b(){return function(a,b,c){b.on("click",function(b){b.stopPropagation(),a.select(c.feedTimeoutSelect)}),a.$on("$destroy",function(){b.off("click")})}}function c(a,b){return{restrict:"A",scope:{onSelect:"&ringOnOptionSelect",value:"=selectedValue"},link:function(c,d,e){function f(a){a.target!=d[0]&&a.target.parentNode!=d[0]&&a.target.parentNode.parentNode!=d[0]&&"pt-top"!=a.target.className&&c.close()}var g,h=!1;c.close=function(){g&&g.remove(),g=null,h=!1,a.off("click",f)},c.$watch("value",function(a,b){parseInt(a)>-1?d.addClass("active"):d.removeClass("active")}),d.on("click",function(e){return h?(c.close(),""):(g||(g=b(angular.element("<feed-timout-option></feed-timout-option>"))(c)),d.after(g),h=!0,void a.on("click",f))}),c.$on("$destroy",function(){d.off("click"),a.off("click",f)})}}}var d;try{d=angular.module("ringid.feed")}catch(e){return}d.directive("feedTimeoutSelect",b),d.directive("feedTimoutOption",a),d.directive("feedTimeoutMenu",c),c.$inject=["$document","$compile"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(j,k){return function(k,l,m,n,o){function p(a,b){Y==a||Z||(requestAnimationFrame(function(){for(var b=0;G>b;b++)E&&E[b].loader&&(E[b].loader.style.display=a?"block":"none");Z=!1}),Z=!0,Y=a)}function q(){for(var a=0;F>a;a++)G>a?E[a].element.style.display="block":E[a].element.style.display="none"}function r(){v(k[y]),s(!1),S=!1,p(S,"line 160"),q()}function s(a){X&&E&&requestAnimationFrame(function(){var b;if(P=l[0].scrollHeight,b=P-e.viewport.y-e.viewport.y,e.viewport.yo>b&&a){if(k.LoadMoreData(),k.noMoreFeed)return;k.busy!=S&&(S=k.busy,p(S,"Line 205"))}if(!(J||Math.abs(e.viewport.yo-O)<N)){var c,d,f,g,h,i=[139,0,0],j=[],m=[],n=[0,0,0],o=[0,0,0];for(O=e.viewport.yo,w=0;w<W.length;w++)f=W[w],d=f.key,$[d]&&(g=$[d],g&&(h=g.height,c=g.cell,i[c]+=h,i[c]>=aa+O&&i[c]<=O+M+ba?g.clone.RG_HIDDEN&&j.push(g.clone):(i[c]<aa+O&&(n[c]+=h),i[c]>=aa+O&&i[c]>O+M+ba&&(o[c]+=h),g.clone.RG_HIDDEN||m.push(g.clone))));for(w=0;w<I.length;w++)f=I[w],d=f.key,H[d]&&(g=H[d],g&&(h=g.height,c=g.cell,i[c]+=h,i[c]>=aa+O&&i[c]<=O+M+ba?g.clone.RG_HIDDEN&&j.push(g.clone):(i[c]<aa+O&&(n[c]+=h),i[c]>=aa+O&&i[c]>O+M+ba&&(o[c]+=h),g.clone.RG_HIDDEN||m.push(g.clone))));f=null,g=null;var q=Math.max(Math.max.apply(null,i),M);K.style.height=q+N+"px";for(var r=0;r<E.length;r++)E[r].element.style.paddingTop=n[r]+"px";for(var r=0;r<j.length;r++)j[r].style.display="block",j[r].RG_HIDDEN=!1;for(var r=0;r<m.length;r++)m[r].style.display="none",m[r].RG_HIDDEN=!0}})}function t(a){fastdom.defer(3,function(){H&&H[a]&&(H[a].height=H[a].clone.offsetHeight+12)})}function u(){this.removeEventListener(Q+"TransitionEnd",u),this.removeEventListener("transitionend",u),this.parentNode.removeChild(this)}function v(a){var c,d,e,g,h,j,l,m,n,q=a.length,r=[],s=Object.create(null),t=0;if(J=!0,X&&E){if(0==a.length&&T)return void(k.noMoreFeed&&requestAnimationFrame(function(){k.$rgDigest()}));for(f.$$postDigest(function(){var b,c,d;for(b=0;b<a.length;b++)c=a[b],h=c.key,H[h]&&(d=H[h],d&&d.childHead&&(d.scope.$$childHead=d.childHead))}),i.hasSpecialFeed()&&(W=i.getSpecialFeedList(),t=W.length),c=0;q>c;c++){if(g=(c+t)%G,d=a[c],h=d.key,H[h]){if(j=H[h],!j)continue;j.cell=g,delete H[h]}else e=k.$new(),e[z]=d,j={},j.clone=null,j.cell=g,j.scope=e,j.height=110,j.key=h,j.serial=-1;s[h]=j}for(c=0;G>c;c++)r[c]||(r[c]=0==c&&E[c].element.firstElementChild?E[c].element.firstElementChild:E[c].element.firstChild);for(h in H)if(H[h]){if(j=H[h],!j)continue;j.clone.style.opacity=0,j.clone.RG_DELETE=!0,j.clone.addEventListener(Q+"TransitionEnd",u),j.clone.addEventListener("transitionend",u),j.scope.$destroy()}var v=2,w=[];if(V&&t>0)for(c=0;t>c;c++){if(d=W[c],h=d.key,g=c%G,l=r[g],m=l.parentNode,$[h]){if(j=$[h],!j)continue;n=j.clone,j.cell=g,n!=l.nextSibling&&m.insertBefore(n,l.nextSibling),r[j.cell]=n}else e=k.$new(),e[z]=d.value,n=b(V)(e),m.insertBefore(n[0],l.nextSibling),l=n[0],l.style.opacity=1,j={},j.clone=n[0],j.cell=g,j.scope=e,j.height=110,j.key=h,j.serial=c,j.serialElm=j.clone.querySelector("[feed-serial]"),r[g]=l,$[h]=j,function(a,b){fastdom.defer(1,function(){b&&(b.height=a.offsetHeight+12)})}(l,j);j.serialElm&&(j.serialElm.innerHTML=c+1)}for(c=0;q>c;c++)if(d=a[c],h=d.key,j=s[h]){if(j.scope.$index=c,l=r[j.cell],m=l.parentNode,n=j.clone){do l=l.nextSibling;while(l&&l.RG_DELETE);n!=l&&m.insertBefore(n,l),r[j.cell]=n,j.childHead=j.scope.$$childHead,j.scope.$$childHead=null}else o(j.scope,function(a){m.insertBefore(a[0],l.nextSibling),l=a[0],function(a,b){fastdom.defer(++v,function(){b&&(b.height=a.offsetHeight+12)})}(l,j),!R||T||10>U?l.style.opacity=1:w.push(l),j.clone=l,r[j.cell]=l,j.serialElm=j.clone.querySelector("[feed-serial]"),U++});j.serial!=c+t&&j.serialElm&&(j.serialElm.innerHTML=t+c+1,j.serial=c+t)}w.length>0&&fastdom.defer(2,function(){if(!w)return!1;for(c=0;c<w.length;c++)w[c].style.opacity=1;w=null}),k.busy!=S&&(S=k.busy,p(S,"Line 639"),S=null),H=s,I=a,J=!1,s=null,T=!1,j=null,n=null,m=null,l=null,r=null,e=null,a.length<=10&&requestAnimationFrame(function(){k.$rgDigest()})}}var w,x,y,z,A,B,C=m.feedRepeat,D=C.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),E=[],F=3,G=e.feedColumn(),H=Object.create(null),I=[],J=!1,K=document.querySelector("div.middle"),L=document.getElementById("feeds-container"),M=e.viewport.y,N=M/2,O=0,P=0,Q=h.vendorPrefix.toLowerCase(),R="moz"!=Q&&"ms"!=Q,S=!1,T=!0,U=0,V="",W=[],X=!1,Y=!1,Z=!1,$=Object.create(null);window.performance.now();x=D[1],y=D[2];D[3]?a(D[3]):"";for(z=D[1],w=0;F>w;w++){A={},B=document.createElement("div"),B.className="cell cell-id"+w,B.appendChild(document.createComment("cell: "+w)),A.element=B;var _=document.createElement("div");_.innerHTML='<div class="rf-box"><div class="rf-top"><div class="rf-cir"><span class="icon-logo-circle"></span></div><div class="rf-line"></div></div><div class="rc-feed"> </div><div class="rc-feed rc2"> </div><div class="rc-feed rc3"> </div><div class="rf-ics"></div></div>',_.style.display="none",B.appendChild(_),A.loader=_,E[w]=A,k.showPostBox()&&m.postbox&&0==w?!function(a){d.get(m.postbox,{cache:c}).then(function(c){var d=b(c.data)(k);a.insertBefore(d[0],a.firstChild.nextSibling),X=!0,requestAnimationFrame(function(){v(k[y])}),k.$rgDigest()})}(B):(X=!0,requestAnimationFrame(function(){v(k[y])})),_=null}for(k.showSpecialFeed()&&d.get("pages/partials/special-feed.html",{cache:c}).then(function(a){V=a.data}),w=0;F>w;w++)l[0].appendChild(E[w].element);K.style.height=M+"px",j[0].className="cols-"+G,q(),S=!0,p(S,"line 170");var aa=-1*M*4,ba=4*M;document.documentElement.scrollTop=0,document.body.parentNode.scrollTop=0,document.body.scrollTop=0,window.addEventListener("scroll",s),k.$on(g.COMMON.COLUMN_CHANGED,function(a,b){G=b,j[0].className="cols-"+G,r()}),k.$on(g.COMMON.WINDOW_RESIZED,function(a,b){G=e.feedColumn(),j[0].className="cols-"+G,r()}),k.$watchCollection(y,v),k.$on("$destroy",function(){H=I=B=E=A=$=W=K=L=V=Y=null,window.removeEventListener("scroll",s)}),k.$on(g.FEED.HEIGHT,function(a,b){a.stopPropagation(),H&&H[b]&&t(b)}),k.$on(g.FEED.BUSY,function(a,b){S=b,p(S,"LINE 343")})}}return{restrict:"A",transclude:!0,priority:1e3,terminal:!0,compile:j}}angular.module("ringid.feed").directive("feedRepeat",a),a.$inject=["$parse","$compile","$templateCache","$http","utilsFactory","$rootScope","SystemEvents","$sniffer","feedFactory"]}(),function(){"use strict";function a(){return{restrict:"E",scope:{onHover:"&",onSelect:"&",location:"="},templateUrl:"pages/partials/feed_location/item.html",link:function(a,b,c){b.on("click",function(b){b.stopPropagation(),a.onSelect&&a.onSelect({location:a.location})}),a.onHover&&b.on("mouseover",function(b){a.onHover({location:a.location})}),a.$on("$destroy",function(){b.off("click"),b.off("mouseover")})}}}function b(a){function b(a){a.stopPropagation()}return{restrict:"E",replace:!0,templateUrl:"pages/partials/feed_location/view.html",compile:function(a,c,d){return{pre:function(a,b,c,d){a.initLocation(b)},post:function(a,c,d,e){a.$rgDigest(),c.on("click",b),a.$on("$destroy",function(){c.off("click",b)})}}},controller:["$scope",function(b){function c(a){try{l(a.place_id),g()}catch(b){}}function d(a){q.getDetails({placeId:a},function(b,c){c==google.maps.places.PlacesServiceStatus.OK&&(angular.extend(t[a],b),t[a]=b),i()})}function e(){b.loadingData=!0}function f(){b.loadingData=!1}function g(){b.showLocationMap=!0}function h(){b.suggestedLocations=[]}function i(){b.$rgDigest()}function j(a){return new google.maps.LatLng(a.lat,a.lng)}function k(a){var b=j(a);p=new google.maps.Map(document.getElementById("feed-location-map"),{center:b,zoom:13}),a.description&&r.getPlacePredictions({input:a.description,rankBy:google.maps.places.RankBy.DISTANCE},u)}function l(a){var b=t[a];b&&(o&&o.setMap(null),p.setCenter(b.geometry.location),o=new google.maps.Marker({map:p,place:{placeId:a,location:b.geometry.location}}))}function m(a){h(),e(),i(),r.getPlacePredictions({input:a},u)}function n(a){var c=a.target.value;c&&c.length>3?m(c):(h(),i()),b.keyword=a.target.value}b.keyword="",b.showLocationMap=!0,b.suggestedLocations=[],b.loadingData=!1,b.selfLocation={},b.onLocationItemSelect=function(a){if(angular.isFunction(b.onItemSelect)){try{var c={description:a.terms[0].value}}catch(d){var c={description:a.description}}c.lat=9999,c.lng=9999,a.geometry&&a.geometry.location&&(c.lat=a.geometry.location.lat(),c.lng=a.geometry.location.lng()),b.onItemSelect({location:c}),b.$parent.$rgDigest()}b.close()},b.shareUserLocation=function(){a.getUserLocation().then(function(a){a.sucs?(b.onItemSelect({location:a}),b.$rgDigest(),b.close()):Ringalert.show({mg:"Unable to detect user location"},"error")})},b.onLocationItemHover=c;var o,p,q,r,s,t={};b.initLocation=function(c){s=c.find("input")[0],q=new google.maps.places.PlacesService(s),r=new google.maps.places.AutocompleteService,s.focus(),a.getUserLocation(!0).then(function(a){b.selfLocation=a,k(a.sucs?{lat:a.lat,lng:a.lng,description:a.description}:{lat:23.772493,lng:90.4098315,description:"IPvision Ltd."})}),b.keyword=b.value?b.value.description:""};var u=function(a,c){return c!=google.maps.places.PlacesServiceStatus.OK?void f():(h(),angular.forEach(a,function(a){var c=a.place_id;t[c]?angular.extend(t[c],a):(d(c),t[c]=a),b.suggestedLocations.push(t[c])}),b.suggestedLocations.length>0&&f(),void i())};b.processKeyup=a.debounce(n,500)}]}}function c(){return{replace:!0,template:'<span ng-if="!!feed.getLocationInfo().lat" ><a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="pages/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">  <img height="170px" width="100%" ng-src="{{ ::feed.getLocationStaticEmbedUrl() }}" alt="location-hover" /> </a>'}}var d;try{d=angular.module("ringid.feed")}catch(e){return}d.directive("feedLocationViewItem",a),d.directive("feedLocationView",b),b.$inject=["utilsFactory"],d.directive("feedLocationPreview",c)}(),function(){"use strict";function a(a,b,c){return{restrict:"A",scope:{onItemSelect:"&feedLocationMenuOnSelect",value:"=selectedValue",viewWidth:"@",viewHeight:"@",autoAdjust:"@"},link:function(d,e,f){function g(a){a.target!=e[0]&&a.target.parentNode!=e[0]&&a.target.parentNode.parentNode!=e[0]&&"pt-top"!=a.target.className&&(d.close(),"false"!==d.autoAdjust&&h(event))}function h(a){window.eventFix(a);var b=c.viewportsize();!j&&a.pageY+d.viewHeight+l>b.y&&window.scrollToYOffset(a.pageY-b.y/2,500),a.pageX+d.viewWidth+l>b.x-200&&(d.viewDirection+=" left")}var i,j,k=!1,l=20;d.viewDirection="right",f.feedLocationMenuDirection&&(d.viewDirection=f.feedLocationMenuDirection,j=!0),d.viewWidth=d.viewWidth||600,d.viewHeight=d.viewHeight||466,d.close=function(){i&&i.remove(),i=null,k=!1,a.off("click",g)},d.$watch("value",function(a,b){a.description?e.addClass("active"):e.removeClass("active")}),e.on("click",function(c){return k?(d.close(),""):("false"!==d.autoAdjust&&h(c),i||(i=b(angular.element("<feed-location-view></feed-location-view>"))(d)),e.after(i),k=!0,void a.on("click",g))}),d.$on("$destroy",function(){i&&i.remove(),e.off("click"),
a.off("click",g)}),d.$rgDigest()}}}var b;try{b=angular.module("ringid.feed")}catch(c){return}b.directive("feedLocationMenu",a),a.$inject=["$document","$compile","utilsFactory"]}(),function(){"use strict";function a(a,b){function c(b){var c={};switch(b.type){case"feed":c.actn=1===b.il?h.TYPE_LIKE_STATUS:h.TYPE_UNLIKE_STATUS;break;case"image":c.actn=h.IMAGE.TYPE_LIKE_IMAGE,c.imgId=b.target.getKey(),c.lkd=b.il;break;case"media":c.actn=h.MEDIA.ACTION_LIKE_UNLIKE_MEDIA,c.cntntId=b.target.getKey(),c.lkd=b.il;break;default:throw new Error("comment type not familiar")}return b.target.getFeedKey()&&(c.nfId=b.target.getFeedKey()),a.request(c,h.REQUEST_TYPE.UPDATE)}function d(b){var c={};switch(b.type){case"feed":c.actn=b.il?h.TYPE_LIKE_COMMENT:h.TYPE_UNLIKE_COMMENT,c.nfId=b.key;break;case"image":c.actn=h.IMAGE.TYPE_LIKE_UNLIKE_IMAGE_COMMENT,c.imgId=b.key,c.lkd=b.il;break;case"media":c.actn=h.MEDIA.ACTION_LIKE_UNLIKE_MEDIA_COMMENT,c.cntntId=b.key,c.lkd=b.il;break;default:throw new Error("comment type not familiar")}return b.parentKey&&(c.nfId=b.parentKey),c.cmnId=b.target.getKey(),a.request(c,h.REQUEST_TYPE.UPDATE)}function e(b){var c={};switch(b.type){case"feed":c.actn=h.TYPE_LIST_LIKES_OF_COMMENT,c.nfId=b.key;break;case"image":c.actn=h.IMAGE.TYPE_IMAGE_COMMENT_LIKES,c.imgId=b.key;break;case"media":c.actn=h.MEDIA.ACTION_MEDIACOMMENT_LIKE_LIST,c.cntntId=b.key;break;default:throw new Error("comment type not familiar")}return b.parentKey&&(c.nfId=b.parentKey),c.st=b.st||0,c.cmnId=b.target.getKey(),a.pull(c,h.REQUEST_TYPE.REQUEST)}function f(b){var c={};switch(b.type){case"feed":c.actn=h.TYPE_LIKES_FOR_STATUS,c.nfId=b.target.getKey();break;case"image":c.actn=h.IMAGE.TYPE_LIKES_FOR_IMAGE,c.imgId=b.target.getKey();break;case"media":c.actn=h.MEDIA.ACTION_MEDIA_LIKE_LIST,c.cntntId=b.target.getKey();break;default:throw new Error("comment type not familiar")}return b.target.getFeedKey()&&(c.nfId=b.target.getFeedKey()),c.st=b.st||0,a.pull(c,h.REQUEST_TYPE.REQUEST)}var g,h=b.SYSTEM;return g={likeUnlike:c,likeUnlikeComment:d,fetchWhoLikes:f,fetchWhoLikesComment:e}}function b(a,b,c,d,e,f,g){function h(){var e,f="fetchWhoLikes";a.users.length<a.target.getTotalLikes()&&(e={target:a.target,type:a.likeType,st:a.users.length},"true"==a.likeComment&&(f="fetchWhoLikesComment",e.parentKey=a.targetOwner(),e.key=a.targetParent()),a.loading=!0,b[f](e).then(function(b){if(a.loading=!1,!b.sucs)return void a.$close();var e,f;for(e=0;e<b.likes.length;e++)f=d.createByUtId(b.likes[e],!0,!0),a.users.push(f),f.commonFriends(!0,!0).then(function(){a.$rgDigest()});c.recalculate(a),a.$rgDigest()},function(b){a.$close()},function(a){}))}a.loading=!0,a.users=[],a.contactListAction=function(b){b.friend.isLoading()||(e.friendAction(b,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()}),a.$rgDigest())},a.isCurrentUser=function(a){return a.equals(g._currentUser)},a.loadmore=function(){a.loading||h()},h(),a.getMutualFriend=function(a){return{data:function(){return{target:a}},promise:f.getMutualFriend(a)}}}function c(a,b,c,d,e){function f(b){a.target.like(!0,b.loc?b.loc:!1),c.show(b,"error"),a.anchorCallback.call(null,a.target.like()),a.buttonCallback.call(null,a.target.like()),a.$rgDigest()}a.anchorCallback=angular.noop,a.buttonCallback=angular.noop,a.LikeUnlike=function(){var c,d="likeUnlike";c={target:a.target,type:a.likeType},"true"==a.likeComment&&(d="likeUnlikeComment",c.parentKey=a.targetOwner(),c.key=a.targetParent()),c.il=a.target.like(!0),a.anchorCallback.call(null,c.il),a.buttonCallback.call(null,c.il),b[d](c).then(function(b){if(b.sucs){if("feed"!==a.likeType&&"true"!==a.likeComment&&b.nfId){var d=e.synchLike(b.nfId,c.il,b.loc);d&&d.$rgDigest()}}else f(b)},f),a.$rgDigest()},a.$watch("target",function(b){a.anchorCallback.call(null,b.like()),a.buttonCallback.call(null,b.like(),!0)}),a.showWhoLike=function(){if(a.target.getTotalLikes()){d.open({type:"remote",scope:a,controller:"WhoLikeController",templateUrl:"pages/home/wholikes.html"})}}}function d(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a><i class="lc-ico"></i><b>Like</b></a>',link:function(a,b,c,d){function e(a,c){a?(b[0].firstChild.className=b[0].firstChild.className.replace("icon-like","").trim(),b[0].firstChild.className=b[0].firstChild.className.replace("icon-like-h","").trim(),b[0].firstChild.className+=" icon-like-h",c||(b[0].firstChild.innerHTML='<span class="like-ani"></span>',window.setTimeout(function(){b&&(b[0].firstChild.innerHTML="")},2e3))):(b[0].firstChild.className=b[0].firstChild.className.replace("icon-like-h","").trim(),b[0].firstChild.className=b[0].firstChild.className.replace("icon-like","").trim(),b[0].firstChild.className+=" icon-like")}a.buttonCallback=e,e(a.target.like(),!0),b.bind("click",a.LikeUnlike),a.$on("$destroy",function(){b.unbind("click",a.likeUnlike)})}}}function e(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">Like</a>',link:function(a,b,c,d){b.bind("click",a.LikeUnlike),a.$on("$destroy",function(){b.unbind("click",a.likeUnlike)})}}}function f(a){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes()}}</a>',link:function(a,b,c,d){b.bind("click",a.showWhoLike),a.$on("$destroy",function(){b.unbind("click",a.showWhoLike)})}}}function g(){return{restrict:"EA",scope:{target:"=",likeType:"@",targetParent:"&",targetOwner:"&",likeComment:"@"},controller:"LikeController",template:"<rg-liker-button></rg-liker-button><rg-who-like></rg-who-like>",link:function(a,b,c){function d(a){a?b.addClass("active"):b.removeClass("active")}a.anchorCallback=d,d(a.target.like()),a.$watch("target.like()",function(){d(a.target.like()),a.buttonCallback.call(null,a.target.like(),!0)})}}}angular.module("ringid.feed").factory("LikeHttpService",a).controller("LikeController",c).controller("WhoLikeController",b).directive("rgLikes",g).directive("rgLikerAnchor",e).directive("rgWhoLike",f).directive("rgLikerButton",d),a.$inject=["$$connector","OPERATION_TYPES"],b.$inject=["$scope","LikeHttpService","rgScrollbarService","userFactory","friendsFactory","InviteFactory","Auth"],c.$inject=["$scope","LikeHttpService","Ringalert","$ringbox","feedFactory"],d.$inject=[],e.$inject=[],f.$inject=["$ringbox"],g.$inject=[]}(),function(){"use strict";function a(a,b){function c(b){var c={};switch(b.type){case"feed":c.cmntT=1,c.nfId=b.key;break;case"image":c.cmntT=2,c.imgId=b.key;break;case"media":c.cmntT=3,c.cntntId=b.key;break;default:throw new Error("comment type not familiar")}return c.actn=j.ACTION_GET_FULL_COMMENT,c.cmnId=b.commentId,a.request(c,j.REQUEST_TYPE.REQUEST)}function d(b,c,d){var e={};if(!b.key||!b.type)throw new Error("key and type must needed for fetcing comment");switch(b.type){case"feed":e.actn=j.TYPE_COMMENTS_FOR_STATUS,e.nfId=b.key;break;case"image":e.actn=j.IMAGE.TYPE_COMMENTS_FOR_IMAGE,e.imgId=b.key,b.target.getFeedKey()&&(e.nfId=b.target.getFeedKey());break;case"media":e.actn=j.MEDIA.ACTION_MEDIA_COMMENT_LIST,e.cntntId=b.key,b.target.getFeedKey()&&(e.nfId=b.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return c?(e.scl=d?d:1,e.tm=c):e.st=b.st||0,a.pull(e,j.REQUEST_TYPE.REQUEST)}function e(b){var c={};switch(b.type){case"feed":c.actn=j.TYPE_ADD_STATUS_COMMENT,c.nfId=b.key;break;case"image":c.actn=j.IMAGE.TYPE_ADD_IMAGE_COMMENT,c.imgId=b.key,b.target.getFeedKey()&&(c.nfId=b.target.getFeedKey());break;case"media":c.actn=j.MEDIA.ACTION_ADD_COMMENT_ON_MEDIA,c.cntntId=b.key,b.target.getFeedKey()&&(c.nfId=b.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return c.cmn=b.text.utf8Encode(),a.request(c,j.REQUEST_TYPE.UPDATE)}function f(b){var c={};switch(b.type){case"feed":c.actn=j.TYPE_EDIT_STATUS_COMMENT,c.nfId=b.key;break;case"image":c.actn=j.IMAGE.TYPE_EDIT_IMAGE_COMMENT,c.imgId=b.key;break;case"media":c.actn=j.MEDIA.ACTION_EDIT_COMMENT_ON_MEDIA,c.cntntId=b.key;break;default:throw new Error("comment type not familiar")}return c.cmnId=b.commentId,c.cmn=b.text.utf8Encode(),a.request(c,j.REQUEST_TYPE.UPDATE)}function g(b){var c={};switch(b.type){case"feed":c.actn=j.TYPE_DELETE_STATUS_COMMENT,c.nfId=b.key;break;case"image":c.actn=j.IMAGE.TYPE_DELETE_IMAGE_COMMENT,c.imgId=b.key;break;case"media":c.actn=j.MEDIA.ACTION_DELETE_COMMENT_ON_MEDIA,c.cntntId=b.key;break;default:throw new Error("comment type not familiar")}return c.cmnId=b.commentId,a.request(c,j.REQUEST_TYPE.UPDATE)}function h(a,b){var c,d,e=[j.TYPE_UPDATE_ADD_STATUS_COMMENT,j.TYPE_UPDATE_LIKE_COMMENT,j.TYPE_UPDATE_UNLIKE_COMMENT,j.TYPE_UPDATE_DELETE_STATUS_COMMENT,j.TYPE_UPDATE_EDIT_STATUS_COMMENT],f=[j.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT,j.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT,j.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT,j.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT],g=[j.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT,j.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT,j.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT,j.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT];switch(a){case"feed":c=e,d="nfId";break;case"image":c=f,d="imgId";break;case"media":c=g,d="cntntId";break;default:return[1111111]}return function(a){return-1!==c.indexOf(a.actn)&&a[d]===b}}var i,j=b.SYSTEM;return i={getComment:c,getComments:d,addComment:e,updateComment:f,deleteComment:g,getUpdateFilter:h}}function b(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.$parent&&1!==a.$parent.$id?a.$parent.$rgDigest():a.$rgDigest()}function n(b,c){b&&(a.commentEditorEnabled=!0,a.commentKey=b,a.models.commentedittext=c,m())}function o(b){a.loadingComment=b,C&&(window.clearTimeout(C),C=void 0)}function p(){B=b.subscribe(function(b){switch(b.actn){case D.TYPE_UPDATE_ADD_STATUS_COMMENT:case D.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT:case D.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT:w({comments:[b]});break;case D.TYPE_UPDATE_EDIT_STATUS_COMMENT:case D.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT:case D.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT:var c=a.comments.get(b.cmnId);c&&c.setComment(b.cmn);break;case D.TYPE_UPDATE_LIKE_COMMENT:case D.TYPE_UPDATE_UNLIKE_COMMENT:case D.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:case D.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:var c=a.comments.get(b.cmnId);c&&c.incomingLike(b.loc);break;case D.TYPE_UPDATE_DELETE_STATUS_COMMENT:case D.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT:case D.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT:a.comments.remove(b.cmnId)}m()},{filter:e.getUpdateFilter(a.commentType,a.target.getKey())}),a.$on("$destroy",function(){B&&b.unsubscribe(B),B=!1})}function q(b){var c,d=!1;a.comments.length()&&(c=a.comments.getByIndex(0),d=c.getTimestamp()),v(d,2,b)}function r(b){b.comments&&(b.comments.length>5&&a.target.getTotalComment()>a.comments.length()+b.comments.length?(b.comments.sort(function(a,b){return a.tm>b.tm?1:-1}),b.comments.splice(0,1),w({comments:b.comments}),a.previousComment=!0):(a.previousComment=!1,w(b)))}function s(){var b=!1;if(parseInt(a.activeCommentId)>0){var c;a.comments.length()&&(c=a.comments.getByIndex(a.comments.length()-1),b=c.getTimestamp())}v(b,1)}function t(b){b.comments&&(b.comments.length>5&&a.target.getTotalComment()>a.comments.length()+b.comments.length?(b.comments.sort(function(a,b){return a.tm<b.tm?1:-1}),b.comments.splice(0,1),w({comments:b.comments}),a.afterComment=!0):(a.afterComment=!1,w(b)))}function u(){if(parseInt(a.activeCommentId)>0){var b=a.commentType,c=a.target;"feed"===a.commentType&&a.target.isSingleContentFeed()&&(c=a.target.getSingleContent(),b=a.target.getContentType()),e.getComment({key:c.getKey(),type:b,commentId:parseInt(a.activeCommentId)}).then(function(b){b.sucs?(w({comments:[b.cmntDTO]}),s(),setTimeout(function(){q(!0)},500)):(a.activeCommentId=0,v()),m()},function(a){v()})}else v(),a.afterComment=!1}function v(b,c,d){if(a.target.getTotalComment()&&((2!==c||a.showPreviousButton())&&(1!==c||a.showMoreButton())||d)){o(!0);var f=a.commentType,g=a.target;"feed"===a.commentType&&a.target.isSingleContentFeed()&&(g=a.target.getSingleContent(),f=a.target.getContentType()),C=setTimeout(o.bind(a,!1),3e3),e.getComments({key:g.getKey(),type:f,st:a.comments.length(),target:g},b,c).then(function(b){b.sucs&&(parseInt(a.activeCommentId)?2===c?r(b):t(b):w(b)),o(!1),m()},function(a){},function(a){}),m()}}function w(b){var c,d;for(d=0;d<b.comments.length;d++)c=h.create(b.comments[d]),a.comments.save(c.getKey(),c)}function x(){var b,f,g=a.commenttext,i=a.target,j=a.commentType;a.canComment=!1,A()&&(b=d.getUniqueID(),f={cmnId:b,cmn:g,deleted:!1,isNew:!0,edited:!1,pending:!0},"feed"===a.commentType&&a.target.isSingleContentFeed()&&(i=a.target.getSingleContent(),j=a.target.getContentType()),a.comments.add(b,h.create(f,a.currentUser)),e.addComment({key:i.getKey(),type:j,text:g,target:i}).then(function(d){if(d.sucs===!0){a.comments.remove(b),f.cmnId=d.cmnId,f.pending=!1,angular.extend(d,f);var e=h.create(d,a.currentUser);if(a.comments.add(e.getKey(),e),a.target.setTotalComment(d.loc,1),"feed"===a.commentType&&a.target.isSingleContentFeed())i.setTotalComment(d.loc,1);else if("feed"!==a.commentType){var j=l.synchComment(a.target.getFeedKey(),d.loc,1);j&&j.$rgDigest()}a.canComment=!0,a.commenttext="",m(),k.scrollTo(a,".com-"+e.getKey(),"bottom"),k.recalculate(a)}else a.comments.remove(b),a.canComment=!0,c.show(d,"error"),a.commenttext=g,m()},function(d){a.comments.remove(b),a.canComment=!0,c.show(d,"error"),a.commenttext=g,m()}),k.scrollTo(a,".com-"+b,"bottom"),k.recalculate(a))}function y(b){if(!b.user().isCurrentUser())return void(a.commentEditorEnabled=!1);var d=a.models.commentedittext.trim(),f=a.commentType,g=a.target,h=b.text();b.setComment(d),b.isPending(!0),"feed"===a.commentType&&a.target.isSingleContentFeed()&&(g=a.target.getSingleContent(),f=a.target.getContentType()),""!==d?e.updateComment({key:g.getKey(),type:f,commentId:b.getKey(),text:a.models.commentedittext}).then(function(d){d.sucs||(b.setComment(h),c.show(d,"error")),b.isPending(!1),a.models.commentedittext="",a.commentEditorEnabled=!1,m()},function(a){b.setComment(h),c.show(json,"error"),m()}):c.show("Please write something","error"),m()}function z(b){var d=a.commentType,f=a.target;b.isPending(!0),"feed"===a.commentType&&a.target.isSingleContentFeed()&&(f=a.target.getSingleContent(),d=a.target.getContentType()),e.deleteComment({key:f.getKey(),type:d,commentId:b.getKey()}).then(function(d){if(d.sucs){if(a.comments.remove(d.cmnId),a.target.setTotalComment(d.loc,d.ic),"feed"===a.commentType&&a.target.isSingleContentFeed())f.setTotalComment(d.loc,d.ic);else if("feed"!==a.commentType){var e=l.synchComment(a.target.getFeedKey(),d.loc,d.ic);e&&e.$rgDigest()}}else b.isPending(!1),c.show(d,"error");m()},function(a){b.isPending(!1),c.show(a,"error"),m()}),m()}function A(){return a.commenttext.length<1?(a.commentErrorClass="inputerror",a.canComment=!0,!1):(a.commentErrorClass="",!0)}var B,C,D=j.SYSTEM,E=!1;a.comments=g.createNew(!0,"asc"),a.loadingComment=!1,a.canComment=!0,a.commentEditorEnabled=!1,a.commentKey="",a.commenttext="",a.ddCommentHtml="pages/dropdowns/comment-edit-dropdown.html",a.previousComment=!!a.target.getTotalComment(),a.afterComment=!0,a.models={commentedittext:""},a.currentUser=f.currentUser(),a.openRingboxLike=function(a){return a.getTotalLikes()>0},a.loadMoreComment=s,a.loadPreviousComment=q,a.addComment=x,a.updateComment=y,"feed"===a.commentType&&a.target.isSingleContentFeed()?(a.target.getMedias().length()||a.target.getAudios().length()?a.likeType="media":a.target.getImages(!0).length()&&(a.likeType="image"),a.parentKey=a.target.getSingleContent().getKey()):(a.likeType=a.commentType,a.parentKey=a.target.getKey()),a.hideScroll=!!a.hideScroll&&"false"!==a.hideScroll,a.showPreviousButton=function(){return a.target.getTotalComment()>a.comments.length()&&a.previousComment&&!a.loadingComment},a.showMoreButton=function(){return a.target.getTotalComment()>a.comments.length()&&a.afterComment&&!a.loadingComment},a.cancelEdit=function(){a.commentEditorEnabled=!1,m()},a.commentContentEdit=function(a){return function(){return a.getDynamicText()}},a.actionCommentDropdown=function(a){switch(i.close(a.event),a.action){case"edit":n(a.commentMap.getKey(),a.commentMap.text());break;case"delete":z(a.commentMap)}},a.$watch("showCommentBox",function(b){b&&(B||p(),a.comments.length()||u())}),a.$watch("target.getKey()",function(c){E&&(B&&(b.unsubscribe(B),p(),a.comments.reset()),a.comments.length()||u()),E=!0})}function c(){return{restrict:"E",controller:b,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@",hideScroll:"@"},template:'<div class="feed_comment"><div rg-scrollbar="scrollbar()" disabled="{{::hideScroll}}" ng-class="!hideScroll ? \'comm-scroll-height\':\'\'"><ul class="media-list"><li class="item b-none bd" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item" rg-repeat="comm in comments.all() track by comm.key" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),comment_blink: (comment.getKey() == activeCommentId)}"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><a ng-href="{{comment.user().link()}}"><img ng-src="{{ comment.user().avatar(\'thumb\')}}" alt=""></a></div><div class="comm-p"><p class="unm"><a ng-href="{{comment.user().link()}}">{{comment.user().getName()}}</a></p><p class="comment_text" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.$parent.commentEditorEnabled" placeholder="Write your comment..."></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"><!-- <a ng-class="{active:comment.like()}" rg-click="like(comment)"><i class="icon-like lc-ico" rg-like="comment.like()" ng-class="{\'icon-like-h\':comment.like()}"></i></a> <a ng-class="{active:comment.like()}" rg-click="like(comment)">&nbsp;Like</a> <a ng-class="{active:comment.like()}" class="counter" href="javascript:void(0)" rg-ringbox="{{::comment.getTotalLikes() > 0}}" ringbox-open="openRingboxLike(comment)" ringbox-controller="fetchLikeController" ringbox-target="pages/home/wholikes.html" ringbox-type="remote" ringbox-data="fetchWhoLikes(comment)">{{comment.getTotalLikes()}}</a> --></li><li class="mar-top-7 feed-m"><span class="time"><i class="icon-dt"></i>{{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class="" style="position: relative"><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="comment" dd-action="actionCommentDropdown" ng-class="comment.user().isCurrentUser() ? \'icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li></ul></div><div ng-show="loadingComment" style="text-align:center;margin-top:10px"><div class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div></div><div class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></div><div ng-if="target.getTotalComment() > comments.length()" class="divider"></div><div class="mar-top-10"><div class="comment-w" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div>'}}function d(){return{restrict:"E",controller:b,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@"},template:'<div class="feed-comment-wrapper" style="height:calc(100% - 165px)"><div class="feed_comment" rg-scrollbar="scrollbar()"><ul class="feed-img-l"><li class="item b-none" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item pv-item" ng-repeat="comm in comments.all()" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),active: (comment.getKey() == activeCommentId) }"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{::comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{::comment.user().link()}}">{{::comment.user().getName()}}</a></p><p class="txt_justify" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="$parent.cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.commentEditorEnabled" placeholder="Write something...." style="width: 94%"></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="$parent.cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::commentType}}" target="comment" target-parent="target.getKey()" target-owner="target.getFeedKey()" like-comment="true"><!-- <a ng-class="{active:comment.like()}" rg-click="like(comment)"><i ng-class="{\'icon-like-h\':comment.like() > 0}" class="icon-like lc-ico" rg-like="comment.like()"></i></a> <a ng-class="{active:comment.like()}" rg-click="like(comment)">&nbsp;Like</a> <a ng-class="{active:comment.like()}" class="counter" href="javascript:void(0)" rg-ringbox="{{::comment.getTotalLikes() > 0}}" ringbox-open="openRingboxLike(comment)" ringbox-controller="fetchLikeController" ringbox-target="pages/home/wholikes.html" ringbox-type="remote" ringbox-data="fetchWhoLikes(comment)">{{comment.getTotalLikes()}}</a> --></li><li class="mar-left-60"><span class="time"><i class="icon-dt"></i> {{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class=""><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="comment" dd-action="actionCommentDropdown" ng-class="comment.user().isCurrentUser() ? \'icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li><li ng-show="loadingComment" class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></li><li class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></li></ul></div><div class="pv-c-top"><div class="width-100-percent"><div class="pv-pro float-left"><img ng-src="{{::currentUser.avatar(\'thumb\')}}" alt=""></div><div class="comment-w" style="width:85%" ng-class="commentErrorClass"><div class="comment-editor popimgcmnt-box"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div></div>'}}angular.module("ringid.feed").factory("CommentHttpService",a).controller("CommentsController",b).directive("rgComments",c).directive("rgImageComments",d),a.$inject=["$$connector","OPERATION_TYPES"],b.$inject=["$scope","$$connector","Ringalert","utilsFactory","CommentHttpService","Auth","$$stackedMap","$$commentMap","rgDropdownService","OPERATION_TYPES","rgScrollbarService","feedFactory"]}(),function(){"use strict";function a(a){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",singleFeed:"@",showdroparrow:"="},restrict:"E",template:a.get("top.html")}}angular.module("ringid.feed").directive("rgNewsFeedTop",a),a.$inject=["$templateCache"]}(),function(){"use strict";function a(a){return{restrict:"E",template:a.get("bottom.html")}}angular.module("ringid.feed").directive("rgNewsFeedBottom",a),a.$inject=["$templateCache"]}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"pages/partials/news_feed/details.html",link:function(a){a.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedDetails",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"pages/partials/news_feed/shared_feed.html"}}angular.module("ringid.feed").directive("rgNewsFeedSharedFeed",a)}(),function(){"use strict";function a(a,b,c,d,e){return{restrict:"E",template:c.get("menu.html"),link:function(c,f,g){function h(a){if(a.target.hasAttribute("data-event-share")||a.target.parentNode&&a.target.parentNode.hasAttribute("data-event-share")){a.stopPropagation();var b=c.feed.hasSharedFeed()?c.feed.getOrginalFeed():c.feed,f=b.isShareAble(!0);if(!f.sucs)return void e.show(d[f.rc],"warning");i()}(a.target.hasAttribute("data-event-comment")||a.target.parentNode&&a.target.parentNode.hasAttribute("data-event-comment"))&&(a.stopPropagation(),j()),c.$rgDigest()}function i(){return c.showCommentBox&&(n.removeChild(k),c.showCommentBox=!1),c.showShareBox?c.showShareBox?(n.removeChild(l),c.showShareBox=!1,void c.$emit(b.FEED.HEIGHT,c.feed.getMapKey())):void c.$emit("$feedHeight",c.feed.getMapKey()):(l=l?l:a("<feed-inline-share-view></feed-inline-share-view>")(c)[0],n.appendChild(l),c.showShareBox=!0,void c.$emit(b.FEED.HEIGHT,c.feed.getMapKey()))}function j(){var d;return d='<rg-comments target = "feed" show-comment-box="showCommentBox" comment-type = "feed" comment-order = "asc"></rg-comments>',c.showShareBox&&(n.removeChild(l),c.showShareBox=!1),c.showCommentBox?c.showCommentBox?(n.removeChild(k),c.showCommentBox=!1,void c.$emit(b.FEED.HEIGHT,c.feed.getMapKey())):void 0:(c.showCommentBox=!0,k=k?k:a(d)(c)[0],n.appendChild(k),void c.$emit(b.FEED.HEIGHT,c.feed.getMapKey()))}var k=null,l=null,m=f[0].querySelector("[data-events]"),n=f[0].closest("[data-feed-bottom]");m.addEventListener("click",h),c.closeShareBox=function(){c.showShareBox=!0,i(),c.$rgDigest()},c.closeCommentBox=function(){c.showCommentBox=!0,j(),c.$rgDigest()},c.$on("$destroy",function(){m.removeEventListener("click",h),m=null,n=null,k=null,l=null})}}}angular.module("ringid.feed").directive("rgNewsFeedMenu",a),a.$inject=["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert"]}(),function(){"use strict";function a(a){return{restrict:"A",scope:{feed:"=feedMessage"},link:function(b,c,d){b.$watch("feed.checkMessageUpdated()",function(d){c.html(b.feed.getMessageText()),a(c.contents())(b)})}}}function b(){return{restrict:"E",scope:{feed:"=tagFeed"},controller:["$scope","feedFactory",function(a,b){if(a.getTagUsers=function(a){return{data:function(){return{target:a}},promise:b.getTagUsers(a)}},a.tooltip="",a.feed.getTotalTag()>2){var c=a.feed.getTagUsers();c.length>1&&(a.tooltip+=c[1].getName(),c[2]&&(a.tooltip+="\n"+c[2].getName(),a.feed.getTotalTag()>3&&(a.tooltip+="\nand "+(a.feed.getTotalTag()-3)+" others")))}}],template:'<span class="">with&nbsp;</span><span class="tag-people"><user-card user="feed.getTagUsers()[0]"></user-card></span><span ng-if="::feed.getTotalTag() > 1">&nbsp;and&nbsp;<span class="tag-people" ng-if="::feed.getTotalTag() == 2"><user-card user="feed.getTagUsers()[1]"></user-card></span><span class="" ng-if="::feed.getTotalTag() > 2"><a rg-ringbox="true" ringbox-controller="feedTagUserListController" ringbox-type="remote"ringbox-target="pages/home/tag-user-list.html"ringbox-data="getTagUsers(feed)" class="tag-f-msg" data-tooltip="{{::tooltip}}">{{::feed.getTotalTag() -1}} others peoples</a></span></span>'}}angular.module("ringid.feed").directive("locationCard",function(){return{restrict:"E",replace:!0,scope:{feed:"="},template:'<span class="location">&nbsp;at&nbsp;<a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="pages/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">{{::feed.getLocationShortText()}}</a></span>'}}).directive("userCard",function(){return{restrict:"E",replace:!0,controller:["$scope","profileHttpService","InviteFactory","friendsFactory",function(a,b,c,d){a.getUserDetail=function(){a.showMfc=!1,b.getUserDetails({utId:a.user.getUtId()},!0).then(function(b){b.sucs&&(a.mfc=b.userDetails.mfc,a.showMfc=!0,a.user.setUid(b.userDetails.uId),a.$rgDigest())})},a.getMutualFriend=function(a){return{data:function(){return{target:a}},promise:c.getMutualFriend(a)}},a.contactListAction=function(b){b.friend.isLoading()||(d.friendAction(b,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()}),a.$rgDigest())}}],scope:{user:"="},template:'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="{{::!user.isCurrentUser()}}" on-hover-start="getUserDetail" hover-template-url="pages/partials/hovercards/profile-hover.html">{{::user.getName()}}</a></span>'}}).directive("feedMessage",a).directive("feedTagMoreUser",b),a.$inject=["$compile"],b.$inject=[]}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"pages/partials/single_feed/body.html"}}function b(){return{restrict:"E",templateUrl:"pages/partials/single_feed/header.html"}}function c(){return{restrict:"E",templateUrl:"pages/partials/single_feed/menu.html"}}angular.module("ringid.feed").directive("rgSingleFeedHeader",b).directive("rgSingleFeedBody",a).directive("rgSingleFeedMenu",c)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"pages/partials/single_feed/details.html"}}angular.module("ringid.feed").directive("rgSingleFeedDetails",a)}(),function(){"use strict";function a(a,b,c){return{restrict:"E",template:'<div class="status-box noselect inline-share"><form enctype="multipart/form-data"><div style="padding:10px"><div class="float-left"><div class="thumbnail"><div class="icon-logo-circle pss-logo"><a><img class="responsive-all" rg-src="currentUser.avatar(\'thumb\')"></a></div></div></div><div class="post-t float-right"><div class="inline-share-box"><rg-editor class="editor" editor-content="feedText" new-line="on" on-escape="closeShareBox" focus="showShareBox" placeholder="Write something...."></rg-editor><span class="esc-cancel" rg-click="closeShareBox()">Press Esc to <a>Cancel</a></span><p ng-if="emotions.length" class="pst-loc-txt"><span class="feelings-text">feeling</span> <img class="feed_emo" rg-src="emotions[0].url"> {{emotions[0].nm}} &nbsp;<span class="icon-close f-8" rg-click="emotions.length = 0"></span></p><div ng-if="tagList.length"><ul class="tag-fnd-lst"><span class="tag-with">With :</span><li ng-repeat="usr in tagList"><span class="tag-title">{{::usr.getName()}}</span>&nbsp;<span class="icon-close f-11" rg-click="removeTag(usr)"></span></li></ul></div><p ng-if="feedLocation.description" class="pst-loc-txt">{{ feedLocation.description}} <span class="showpointer icon-close f-8" rg-click="resetFeedLocation()"></span></p><p ng-show="!boxIsLoading && errorMessage" class="s-error">{{errorMessage}}</p><!--<p ng-show="!boxIsLoading && !errorMessage" class="s-info"><b>Enter</b> to SHARE, <b>ESC</b> to Cancel</p>--><rg-loader-view2 is-loading="boxIsLoading"></rg-loader-view2></div></div><div class="clear"></div></div><div class="status-photo-box" style="margin:0;padding:0;border-top:1px solid #ebebeb;width:100%"><div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Feeling" rg-emotion on-select="chooseEmotion(item)" class="p-ab"><span class="status-ico feeling-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Tag Friends" rg-tag-friend="" show-if="showAddTag" tag-items="tagList" on-select="addTag(item)" class="p-ab"><span class="status-ico tag-f-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Location" feed-location-menu="" feed-location-menu-on-select="updateFeedLocation(location)" autoAdjust="{{::autoAdjustScroll}}" selected-value="feedLocation" class="p-ab"><span class="status-ico location-ico"></span></a></div><div class="float-right pad-7-0"><input type="button" ng-disabled="inputDisabled" rg-click="shareFeed()" class="share_btn float-right" value="Share"></div><!--<p>Press escape to cancel</p>--></div></div></form><div class="clear"></div></div>',
controller:"feedInlineShareController",link:function(a,b,c){}}}var b;try{b=angular.module("ringid.feed")}catch(c){return}b.directive("feedInlineShareView",a),a.$inject=["GlobalEvents","$compile","$ringhttp"]}(),function(){"use strict";var a;a=angular.module("ringid.feed"),a.controller("FeedMainController",["$scope","$timeout","feedFactory","utilsFactory","$rootScope","SystemEvents",function(a,b,c,d,e,f){c.reset(),a.noMoreFeed=!1,a.showPostBox=a.showPostBox||function(){return!0},a.showSpecialFeed=a.showSpecialFeed||function(){return!0},a.feeds=c.getFeeds(),c.setFactoryKey(a.pagekey),c.setSortBy(a.sortBy||"tm"),a.busy=!0;var g=setInterval(function(){c.updateTime(),a.$rgDigest()},3e5);a.setFeed=function(b){a.feeds=[],a.feeds=c.getFeeds(),b&&a.$rgDigest()},a.forAdd=a.forAdd||"my",a.getFeeds=function(){return a.feeds&&0!==a.feeds.length||a.setFeed(),a.feeds};var h,i;a.LoadMoreData=function(b){i=a.feeds.length,a.busy!==!1||a.noMoreFeed||(a.busy=!0,c.requestForMoreFeed(a.params),a.clearRequestTimer(),h=setTimeout(function(){a.busy&&i===a.feeds.length&&(a.busy=!1,a.$broadcast(f.FEED.BUSY,a.busy))},6e3))},a.clearRequestTimer=function(a){h&&clearTimeout(h),h=a},a.$on("FeedListChanged",function(){a.setFeed()}),a.setNoMoreFeed=function(b){a.noMoreFeed=b,c.noMoreFeed(b),a.busy=!1,a.$broadcast(f.FEED.BUSY,a.busy)},a.noDataYet=function(){return a.noMoreFeed&&0==a.feeds.length},c.initFeedRequest(a.params),a.$on("$destroy",function(){g&&(clearInterval(g),g=null)}),a.$on(f.COMMON.COLUMN_CHANGED,function(){a.$rgDigest()})}])}(),function(){"use strict";var a;try{a=angular.module("ringid.feed")}catch(b){a=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}a.controller("SingleFeedSubController",["$$feedMap","$scope","$controller","$routeParams","feedFactory","Auth","SystemEvents","utilsFactory","$location",function(a,b,c,d,e,f,g,h,i){function j(){e.getSingleFeed(b.feedId,b.shared).then(function(a){a?(b.feed=a,b.isReady=!0,k()):(b.feed=!1,b.isReady=!0,b.noData=!0),b.$rgDigest()})}function k(){b.feed&&(b.serial=b.feed.serial,b.feedstatus=b.feed.text(),b.keyid=b.feed.getKey(),b.imageslength=b.feed.getImages().length,b.shareMenuDisabled=b.feed.isCirclePost(),b.ogData=b.feed.getOgData(),b.ogShowPreview=b.feed.hasOgData(),b.showCommentBox=!0,c("FeedSubController",{$scope:b}),h.safeDigest(b),b.$broadcast(g.FEED.RESET,b.feed))}b.feedId=parseInt(d.feedId||0),b.shared=!!d.shared,b.activeCommentId=parseInt(d.commentId||0),b.isReady=!1,b.noData=!1,b.pagekey=e.getSingleFeedPageKey(b.feedId),e.setFactoryKey(b.pagekey),b.singleFeed=!0,b.ogData={},b.currentUser=f.currentUser(),j(),b.setFeed=function(a){a?i.path("/"):j()},b.skipSaveScope=!0,c("FeedSubController",{$scope:b})}])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(){return!(c.feedText||c.feedLocation.description||c.ogData.url||c.feelings&&c.feelings.id||c.feed.hasMedia()||c.feed.hasTagUsers())}function n(a){a&&d.path(a)}function o(){var a=i.open({type:"remote",scope:!1,controller:"feedEditTagController",resolve:{localData:{feed:c.feed},remoteData:function(){return c.feed.hasTagUsers()?e.getTagUsers(c.feed):{}}},templateUrl:"pages/home/feed-tag-user-edit.html"});a.result.then(function(a){a&&(c.feed=a),c.cancelEdit()})}c.showdroparrow=0,c.showCommentBox=!1,c.showShareBox=!1,c.showCommentView=!0,c.showShareForm=!1,c.editorEnabled=!1,c.errorImageEdit=!1,c.feedLocation={},c.ogData=c.ogData||{},c.filterOnProgress=!1,c.ogDataLoading=!1,c.ogShowPreview=!1,c.previousFeedLocation="",c.emotions={};var p=c.feed&&c.feed.value?c.feed.value:c.feed;if(p&&p.isSingleContentFeed()?(p.getMedias().length()||p.getAudios().length()?c.likeType="media":p.getImages(!0).length()&&(c.likeType="image"),c.likeTarget=p.getSingleContent()):(c.likeType="feed",c.likeTarget=p),c.shareMenuDisabled=c.shareMenuDisabled?c.shareMenuDisabled:!1,c.toggleCommentBox=function(a){a.stopPropagation(),c.showCommentBox=!c.showCommentBox,c.showCommentBox&&(c.showShareBox=!1)},c.feedEditChooseEmotion=function(a){c.emotions.length=0,c.emotions.push(a),c.$rgDigest()},c.ddTemplate='<div class="ng-cloak action feed-ac float-right"><div class="feed-line" ng-if="ddControl.showEdit()"><span class="icon-edit-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edit\', feedKey: ddControl.feedKey})" href="#">Edit</a></div><div class="feed-line" ng-if="ddControl.showTagButton()"><span class="icon-add-tag feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edittag\', feedKey: ddControl.feedKey})" href="#" class="border-0">{{ddControl.tagButtonText()}}</a></div><div class="feed-line"><span class="icon-delete-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'delete\', feedKey: ddControl.feedKey})" href="#" class="border-0">Delete</a></div></div>',c.actionFeedDropdown=function(b){switch(a.close(b.event),b.action){case"edit":c.enableEditor(b.feedKey);break;case"edittag":o();break;case"delete":c.deleteFeed(b.feedKey)}},c.noDownload=function(a){a.preventDefault(),f.show("Currently download option is available in ringID desktop and mobile app version only.")},c.selectAlbum=function(a){return{data:function(){return{media:a}}}},c.enableEditor=function(a){c.showdroparrow=a,c.editorEnabled=!0;var d=e.getFeed(a);c.feedText=d.text(),c.feedLocation=angular.copy(d.getLocationInfo()),c.ogData=angular.copy(d.getOgData()),c.ogData.image&&(c.ogData.images=[c.ogData.image]),c.ogShowPreview=d.hasOgData(),c.emotions=[d.getFeelings()];var f={feedText:c.feedText,feedLocation:c.feedLocation,feedKey:a,ogData:c.ogData};b.$broadcast("enableeditor",f),c.$rgDigest()},c.cancelEdit=function(){c.editorEnabled=!1,c.errorImageEdit=!1,c.$rgDigest()},c.updateFeed=function(){c.feedText=c.feedText.trim(),c.emotions.length?(c.feelings=c.emotions[0],c.emotions.length=0):c.feelings=!1,m()?(c.errorImageEdit=!0,c.editorEnabled=!0):e.updateFeed(c.currentUser,c.keyid,c.feedText,c.feedLocation,c.ogData,c.feelings).then(function(a){c.editorEnabled=!1,c.errorImageEdit=!1,c.$rgDigest(),c.$broadcast(h.FEED.UPDATED,{id:c.keyid})},function(a){f.show(a,"error"),c.$rgDigest()}),c.$rgDigest()},c.deleteFeed=function(a){var b="Are you sure you want to delete?",d=i.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:b}},templateUrl:"pages/partials/ringbox-confirm.html"});d.result.then(function(b){b&&e.deleteFeed(c.currentUser,a).then(function(a){c.setFeed(!0),f.show(a,"success")},function(a){c.setFeed(!0),f.show(a,"error")})})},c.getShareData=function(){return function(){return{keyid:c.keyid,feed:c.feed.hasSharedFeed()?c.feed.getOrginalFeed():c.feed}}},c.getImageData=function(a,b){return function(){return{image:a,feed:b}}},c.getMediaData=function(a,b){return{data:function(){return{media:a,playlist:b.getAlbum().getContents().all(),feedTime:b.time()}},promise:a.fetchDetails()}},c.getMediaFirstData=function(){var a=c.feed.getMedias().top();return a?c.getMediaData(a,c.feed):void 0},c.getAudioFirstData=function(){var a=c.feed.getAudios().top();return a?c.getMediaData(a,c.feed):void 0},c.getFeedHtml=function(){return c.feed.getDynamicText()},c.selectedFeedLocation=function(a){c.feedLocation=a,k.safeDigest(c)},c.resetFeedLocation=function(){c.feedLocation={}},c.goToFeed=n,c.isShareAble=function(a){return a=a.hasSharedFeed()?a.getOrginalFeed():a,a.isShareAble()},c.openRingBoxLike=function(){return c.feed.getTotalLikes()>0},c.openRingboxShare=function(){return(c.feed.hasSharedFeed()?c.feed.getOrginalFeed().getTotalShare()>0:c.feed.getTotalShare())>0&&!c.feed.isMediaShared()&&!c.feed.isSingleContentFeed()},c.whoShareFalsyFunc=function(){c.feed.isSingleContentFeed()&&f.show("Oops! This feature is coming soon","info")},!c.skipSaveScope){var q=c.feed.value?c.feed.value.getKey():c.feed.getKey();e.addScope(q,c),c.$on("$destroy",function(){e.removeScope(c.feed.getKey())})}}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.controller("FeedSubController",a),a.$inject=["rgDropdownService","$rootScope","$scope","$location","feedFactory","Ringalert","MESSAGES","SystemEvents","$ringbox","Media","utilsFactory","APP_CONSTANTS"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(){b.boxIsLoading=!0,b.feeds.length<b.params.feed.getTotalShare()&&!b.busy&&(a.send({actn:m.TYPE_WHO_SHARES_LIST,nfId:b.params.feed.getKey(),st:b.feeds.length},m.REQUEST_TYPE.REQUEST),b.busy=!0,setTimeout(function(){b.busy=b.busy||!1,b.$rgDigest()},3e3),b.$rgDigest())}var i,j,k,l,m=e.SYSTEM;b.feeds=[],b.message="",b.boxIsLoading=b.params.boxIsLoading?b.params.boxIsLoading:!0;var n;b.params&&(n=d.getFeed(b.params.keyid)),b.showMessage=!1,b.shareMenuDisabled=!0,b.singleFeed=!0,b.busy=!1,b.boxHeight=f.windowHeight-20,i=a.subscribe(function(a){if(b.boxIsLoading=!1,b.isReady=!0,b.busy=!1,!a.sucs)return b.$close(),void g.show(a.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error");if(a.newsFeedList.length)for(l=0;l<a.newsFeedList.length;l++){var d=c.create(a.newsFeedList[l]);d.getKey()===n.getKey()&&d.setIdenticalFeed(n),b.feeds.push(d)}b.$rgDigest()},{action:m.TYPE_WHO_SHARES_LIST}),b.loadMore=h,b.loadMore(),b.$on("$destroy",function(){d.removeIgnoreFilter(j),d.removeIgnoreFilter(k),a.unsubscribe(i)}),b.skipSaveScope=!0}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.controller("FeedWhoShareController",a),a.$inject=["$$connector","$scope","$$feedMap","feedFactory","OPERATION_TYPES","$rootScope","Ringalert"]}(),function(){"use strict";function a(a,b,c){b.viewType="ringbox",b.params=c,a("FeedWhoShareController",{$scope:b})}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.controller("FeedRingboxWhoShareController",a),a.$inject=["$controller","$scope","localData"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(b){var d=s();h(),j(),l(),c.shareFeed(d).then(function(b){k(),m(),i(),l(),o(),q(),t(),r(b),a.media?(a.media.share(!0),a.$close()):a.$parent.$rgDigest()},function(b){k(),i(),u(b),a.$parent.$rgDigest()}),a.$rgDigest()}function h(){a.inputDisabled=!0}function i(){a.inputDisabled=!1}function j(){a.boxIsLoading=!0}function k(){a.boxIsLoading=!1}function l(){a.errorMessage=""}function m(){a.feedText=""}function n(b){a.feedLocation=b}function o(b){a.feedLocation=""}function p(b){n(b),a.$rgDigest()}function q(){d.$broadcast("FeedListChanged"),a.$broadcast("cleareditor")}function r(a){e.show(a,"success")}function s(){var b,c=a.media?null:a.feed,d={text:a.feedText,feed:c&&c.hasSharedFeed()?c.getOrginalFeed():c,location:a.feedLocation},e=a.media;if(a.emotions.length&&(d.mdIds=[a.emotions[0].id],a.emotions.length=0),a.tagList.length){for(d.tFrndIds=[],b=0;b<a.tagList.length;b++)d.tFrndIds.push(a.tagList[b].getUtId());a.tagList.length=0}return(e||c&&c.isSingleContentFeed()&&(c.getMedias().length()||c.getAudios().length()))&&(e=e||c.getSingleContent(),d.audio=e.isAudio(),d.cntntIDLst=[e.getKey()],d.addShare=!0,d.user=a.currentUser),d}function t(){a.afterShareCallback&&a.afterShareCallback()}function u(b){var c=f.getReasonMessageFromResponse(b);""==c&&(c="Unable To Share Status. Please Try Again Later"),a.errorMessage=c}a.feed=a.params.feed,a.afterShareCallback=a.params.afterShareCallback,a.updateFeedLocation=p,a.resetFeedLocation=o,a.currentUser=b.currentUser(),o(),m(),l(),i(),k(),a.shareFeed=g,a.emotions=[],a.tagList=[],a.addTag=function(b){var c=a.tagList.indexOf(b);-1===c&&a.tagList.push(b)},a.removeTag=function(b){var c=a.tagList.indexOf(b);c>=0&&a.tagList.splice(c,1)},a.chooseEmotion=function(b){a.emotions.length=0,a.emotions.push(b)}}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.controller("feedShareController",a),a.$inject=["$scope","Auth","feedFactory","$rootScope","Ringalert","utilsFactory"]}(),function(){"use strict";function a(a,b,c,d){a.params={feed:d.feed,afterShareCallback:a.$close,showSharePostBox:!0},c("feedShareController",{$scope:a})}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}b.controller("feedRingboxShareController",a),a.$inject=["$scope","$boxInstance","$controller","localData"]}(),function(){"use strict";function a(a,b){a.params={feed:a.feed,afterShareCallback:a.closeShareBox,showSharePostBox:!0},b("feedShareController",{$scope:a})}function b(a,b){a.params={feed:null,afterShareCallback:angular.noop,showSharePostBox:!0},a.closeShareBox=function(){a.$close()},a.autoAdjustScroll="false"}var c;try{c=angular.module("ringid.feed")}catch(d){c=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}c.controller("feedMediaShareController",b),c.controller("feedInlineShareController",a),a.$inject=["$scope","$controller"],b.$inject=["$scope","$controller"]}(),function(){"use strict";var a;try{a=angular.module("ringid.feed")}catch(b){a=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}a.controller("FeedAddController",["fileUploadService","$rootScope","$scope","feedFactory","$timeout","$routeParams","SystemEvents","OPERATION_TYPES","rgDropdownService","PrivacySet",function(a,b,c,d,e,f,g,h,i,j){c.privacySet=j,"circle"==c.forAdd||"friend"===c.forAdd?c.showPrivacy=!1:(c.showPrivacy=!0,c.privacy=j.PVC3),c.setPrivacy=function(a){c.privacy=j["PVC"+a.privacy],i.close(a.event),c.$rgDigest()},c.privacyTemplate='<div class="ng-cloak action  ab-drop postbox-action"><div class="a-box" ><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC1.value})" href="#"><span class="{{::ddControl.PVC1.icon}} ab-delete"></span> {{::ddControl.PVC1.text}}</a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC2.value})" href="#"><span class="{{::ddControl.PVC2.icon}} ab-delete"></span> {{::ddControl.PVC2.text}} </a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC3.value})" href="#"><span class="{{::ddControl.PVC3.icon}} ab-delete"></span> {{::ddControl.PVC3.text}}</a></div></div>',c.feedText="",c.feedLocation={},c.ogData={},c.filterOnProgress=!1,c.ogDataLoading=!1,c.ogShowPreview=!1,c.inputDisabled=!1,c.getValidityValues=function(){return new Array(30)},c.showTimeout=!1,c.validity=-1;var k={vldt:c.validity};"friend"===c.forAdd?k.friend=f.uId:"circle"===c.forAdd&&(k.group=f.circleId),c.$on(g.FILE_UPLOAD.QUEUE_START,function(){c.inputDisabled=!0,c.$rgDigest()}),c.$on(g.FILE_UPLOAD.QUEUE_COMPLETE,function(){c.inputDisabled=!1,c.$rgDigest()}),c.shouldDisableInput=function(){return c.inputDisabled||c.ogDataLoading||c.filterOnProgress},c.shouldDisableLocation=function(){return a.imageFiles.length>0||a.videoFiles.length>0||a.audioFiles.length>0||!!c.ogData.url},c.shouldDisableLink=function(){return a.imageFiles.length>0||a.videoFiles.length>0||a.audioFiles.length>0||!!c.feedLocation.lat},c.shouldDisableMedia=function(){return!!c.ogData.url||!!c.feedLocation.lat};var l,m,n=(new Date).getTime();for(c.addFeed=function(){function b(){return!!f.text||!!f.lnkURL||f.images.length>0||f.videos.length>0||f.audios.length>0||!!f.mdIds&&f.mdIds.length>0||!!f.lctn||!!f.tFrndIds&&f.tFrndIds.length>0}function e(){n=l,d.addFeed(f,c.currentUser).then(function(a){c.setFeed(a),c.$parent.$rgDigest()},function(){c.setFeed(),c.feedText=g,c.$broadcast("seteditor",g),c.$parent.$rgDigest()},function(a){}),a.imageFiles.length=0,a.imageFiles=[],a.videoFiles.length=0,a.videoFiles=[],a.audioFiles.length=0,a.audioFiles=[],c.feedText="",c.validity=-1,c.feedLocation={},c.ogData={},c.ogShowPreview=!1,c.inputDisabled=!1,c.errorMessage=!1,c.setFeed(),c.$broadcast("cleareditor"),c.$parent.$rgDigest()}var f={vldt:c.validity};if(c.inputDisabled=!0,f=angular.extend({},k,{text:c.feedText,vldt:c.validity,images:a.imageFiles,videos:a.videoFiles,audios:a.audioFiles}),c.privacy&&(f.fpvc=c.privacy.value),c.feedLocation.description&&(f.lctn=c.feedLocation.description,f.lat=c.feedLocation.lat,f.lng=c.feedLocation.lng),c.ogData.url&&(f.lnkDmn=c.ogData.lnkDmn||c.ogData.url||"",f.lnkDsc=c.ogData.description||"",f.lnkTtl=c.ogData.title||"",f.lnkURL=c.ogData.url||"",f.lnlImgURL=c.ogData.image||""),c.emotions.length&&(f.mdIds=[c.emotions[0].id],c.emotions.length=0),c.tagList.length){for(f.tFrndIds=[],m=0;m<c.tagList.length;m++)f.tFrndIds.push(c.tagList[m].getUtId());c.tagList.length=0}var g=c.feedText;if(""!=f.text&&f.lnkURL){var h=f.text.replace("https","").replace("http",""),i=f.lnkURL.replace("https","").replace("http","");"/"==h[h.length-1]&&(h=h.slice(0,-1)),"/"==i[i.length-1]&&(i=i.slice(0,-1)),h==i&&(f.text="")}b()||""!==f.text?(l=(new Date).getTime(),200>l-n?setTimeout(e,200):e()):(c.feedText="",c.inputDisabled=!1,c.errorMessage=!0,c.ogShowPreview=!1,c.$rgDigest())},c.selectOptions=[],c.selectOptions[0]={value:-1,title:"Unlimited"},m=1;30>=m;m++)c.selectOptions[m]={value:m,title:m+" Day"};c.selectedTimeout=function(a){c.validity=a,c.$rgDigest()},c.selectedLocation=function(a){c.feedLocation=a,c.$rgDigest()},c.resetFeedLocation=function(){c.feedLocation={},c.$rgDigest()},c.emotions=[],c.tagList=[],c.addTag=function(a){var b=c.tagList.indexOf(a);-1===b&&c.tagList.push(a),c.$rgDigest()},c.removeTag=function(a){var b=c.tagList.indexOf(a);b>=0&&c.tagList.splice(b,1),c.$rgDigest()},c.chooseEmotion=function(a){c.emotions.length=0,c.emotions.push(a),c.$rgDigest()};var o=d.getCurrentPageValue();c.showAddTag=o.action!==h.SYSTEM.TYPE_GROUP_NEWS_FEED}])}(),function(){"use strict";var a;try{a=angular.module("ringid.feed")}catch(b){a=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}a.controller("FeedDashboardController",["$scope","$controller","OPERATION_TYPES","Ringalert",function(a,b,c,d){a.pagekey=c.SYSTEM.TYPE_NEWS_FEED+".all",a.action=c.SYSTEM.TYPE_NEWS_FEED,a.params={actn:c.SYSTEM.TYPE_NEWS_FEED},a.forAdd="my",b("FeedMainController",{$scope:a})}])}(),function(){"use strict";var a;try{a=angular.module("ringid.feed")}catch(b){a=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}a.controller("FeedProfileController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(a,b,c,d){var e,f,g=c.uId,h=g;a.currentUser&&a.currentUser.equals(g)?(e="my",f=d.SYSTEM.TYPE_MY_NEWS_FEED):(e="friend",f=d.SYSTEM.TYPE_FRIEND_NEWSFEED),h=f+"."+g,a.pagekey=h,a.action=f,a.params={actn:f,fndId:g},a.forAdd=e,a.sortBy="at",b("FeedMainController",{$scope:a})}])}(),function(){"use strict";var a;try{a=angular.module("ringid.feed")}catch(b){a=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}a.controller("FeedCircleController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(a,b,c,d,e){var f="circle",g=c.circleId,h=d.SYSTEM.TYPE_GROUP_NEWS_FEED+"."+g;a.pagekey=h,a.action=d.SYSTEM.TYPE_GROUP_NEWS_FEED,a.params={actn:d.SYSTEM.TYPE_GROUP_NEWS_FEED,grpId:g},a.forAdd=f,a.shareMenuDisabled=!0,b("FeedMainController",{$scope:a})}])}(),function(){"use strict";var a;try{a=angular.module("ringid.feed")}catch(b){a=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}a.controller("FeedMediasController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(a,b,c,d,e){var f="my",g=d.SYSTEM.TYPE_MEDIAS_NEWS_FEED+".medias";a.pagekey=g,a.action=d.SYSTEM.TYPE_MEDIAS_NEWS_FEED,a.params={actn:d.SYSTEM.TYPE_MEDIAS_NEWS_FEED,pvtid:0,st:0,mtf:0},a.a_f_m="f",a.setTrending=function(b){a.params.mtf=b;var c=a.a_f_m;1===b?a.a_f_m="t":a.a_f_m="f",c!==a.a_f_m&&(e.reset(),e.initFeedRequest(a.params),a.$rgDigest())},a.forAdd=f,a.shareMenuDisabled=!0,a.showPostBox=function(){return!1},a.showSpecialFeed=function(){return!1},b("FeedMainController",{$scope:a})}])}(),function(){"use strict";function a(a,b,c,d){var e=b.fTgLst;a.usersUtIds=[],a.users=[];var f=e.length;if(f){a.total=f;for(var g=0;g<e.length;g++)e[g].fn=e[g].nm,a.users.push(c.createByUtId(e[g],!0))}a.getMutualFriend=function(a){return{data:function(){return{target:a}},promise:d.getMutualFriend(a)}}}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ringid.utils","ringid.config"])}b.controller("feedTagUserListController",a),a.$inject=["$scope","remoteData","userFactory","InviteFactory"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(){a.users=h("filterUserByName")(s,a.filterText)}function m(){p||(i.searchContact({schPm:a.filterText},!0),a.loading=!0,p=!0)}function n(){if("a"!==a.currentType)return void l();i.friends.doForAll(function(a){var b=a.getLiteUser();-1===s.contains(b,function(a,b){return a.equals(b,"utId")})&&-1===q.contains(b,function(a,b){return a.equals(b,"utId")})&&s.push(b)});var b=q.filter(function(a){return-1===s.contains(a,function(a,b){return a.equals(b,"utId")})});s=s.concat(b),l()}var o=b.feed,p=!1,q=[],r=[],s=[];a.users=[],a.filterText="",a.loading=!0,a.currentType="a";var t=k.currentUser();if(a.$watch("filterText",function(b,c){l(),a.users.length<5&&b.length>c.length?(p=!1,m()):(p=!1,a.loading=!1)}),a.$watch(i.friends.length(),function(b,c){n(),a.loading=!1,p=!1}),c&&c.fTgLst&&c.fTgLst.length){for(var u=0;u<c.fTgLst.length;u++)c.fTgLst[u].fn=c.fTgLst[u].nm,-1===q.contains(c.fTgLst[u].utId,function(a,b){return a.equals(b,"utId")})&&(q.push(g.createByUtId(c.fTgLst[u],!0)),r.push(q[u]));n()}a.loading=!1,o.hasTagUsers()||n(),a.toggle=function(b){a.currentType!=b&&(a.currentType=b,"a"==b?(s=[],n()):(s=q,l()))},a.checked=function(a){return q.indexOf(a)>-1},a.loadMore=function(){a.filterText.length?m():(i.getContactDetails(),a.loading=!0)},a.addRemoveTag=function(b,c){var d=q.indexOf(c);d>-1?q.splice(d,1):(q.push(c),a.users.length-q.length<5&&a.loadMore())},a.saveTagUser=function(){var b,c=r.difference(q),d=q.difference(r);if(!c.length&&!d.length)return void j.show("Please Make Your Changes Before Submit","warning");if(0===d.length&&c.length===r.length&&!o.validateForUpdateTag())return void j.show("You can't submit an empty feed","warning");var f={},g={};if(c.length)for(b=0;b<c.length;b++)f[c[b].getUtId()]=!0;if(d.length)for(b=0;b<d.length;b++)g[d[b].getUtId()]=!0;var h={removed:Object.keys(f),"new":Object.keys(g)};e.updateFeed(t,o.getKey(),o.text(),o.getLocationInfo(),!1,o.getFeelings(),h).then(function(b){o.updateTagUser(b),a.$close(o)},function(a){j.show(a,"error")})},a.$on("$destroy",function(){})}var b;try{b=angular.module("ringid.feed")}catch(c){b=angular.module("ringid.feed",["ringid.utils","ringid.config"])}b.filter("filterUserByName",function(){return function(a,b){if(a){for(var c=[],d=new RegExp(b,"i"),e=0;e<a.length;e++)a[e].getName().match(d)&&c.push(a[e]);return c}}}),b.controller("feedEditTagController",a),a.$inject=["$scope","localData","remoteData","$$connector","feedFactory","OPERATION_TYPES","userFactory","$filter","friendsFactory","Ringalert","Auth"]}(),function(){"use strict";var a;a=angular.module("ringid",["oc.lazyLoad","ringid.config","ringid.language","ringid.connector","ringid.global.services","ringid.global.directives","ngWebSocket","ui-notification","ringid.filters","ringid.sticker","ringid.common.factories","ringid.common.services","ringid.common.controllers","ringid.notification","ringid.auth","ringid.profile","ringid.friend","ringid.feed","ringid.circle","ringid.tagchat","ringid.chat","ringid.common.directives"])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){b.isLoggedIn=f.isLoggedIn(),d.init(),b.isLoggedIn?(b.currentUser=f.currentUser(),b.templatePath="pages/index-dashboard.html",d.resume(),d.keepAlive(),setTimeout(m.initFriends,2e3),setTimeout(q.init,5e3),setTimeout(p.init,5e3),setTimeout(g.initStickerData,5e3),setTimeout(o.init,1e4)):b.templatePath="pages/index-login.html",b.$rgDigest(),setTimeout(function(){u=!1,b.$rgDigest()})}function s(){d.subscribe(f.handleInvalidSession,{action:[t.TYPE_SESSION_VALIDATION,t.TYPE_INVALID_LOGIN_SESSION,t.TYPE_MULTIPLE_SESSION]}),f.ensureLoginState(),b.$rgDigest()}var t=h.SYSTEM.AUTH,u=!0;b.openSignIn=function(){return{data:function(){return{fromPopup:!0}}}},b.activePath=null,b.currentUser=f.currentUser(),b.templatePath="pages/index-login.html",b.isLoggedIn=!1,b.isPending=function(){return u},b.showFriendsBar=!1,b.toggleFriendsBar=function(){b.showFriendsBar=!b.showFriendsBar,b.$rgDigest()},b.$on(a.AUTH.LOGIN,function(){r()}),b.$on("CONNECTION_ERROR",function(){var a=e.getCookie("reloaded");a?d.reset():e.setCookie("reloaded",1)}),b.$on("$locationChangeStart",function(a,b,c){b&&d.notifyRouteChange()}),s()}var b;b=angular.module("ringid").controller("ApplicationController",a),a.$inject=["SystemEvents","$scope","$rootScope","$$connector","Storage","Auth","StickerFactory","OPERATION_TYPES","$location","Ringalert","utilsFactory","RING_ROUTES","friendsFactory","InviteFactory","Media","NotificationFactory","circlesManager"]}(),function(){"use strict";var a;a=angular.module("ringid").run(["$rootScope","$window","$document","$$connector","$ringhttp",function(a,b,c,d,e){function f(b){"inactive"!==j&&a.$broadcast("ringInactive",b),j="inactive"}function g(b){"active"!==j&&a.$broadcast("ringActive",b),j="active"}function h(b){this[i?i+"Hidden":"hidden"]&&"inactive"!==j?(a.$broadcast("ringInactive",b),j="inactive"):"active"!==j&&(a.$broadcast("ringActive",b),j="active")}var i,j,k=angular.element(b);d.init(),k.on("inactive",f),k.on("active",g),"hidden"in c?i="":angular.forEach(["moz","webkit","ms"],function(a){a+"Hidden"in c[0]&&(i=a)}),angular.isDefined(i)&&""!==i&&c[0].addEventListener(i+"visibilitychange",h)}])}(),function(){"use strict";angular.module("ringid").config(["$compileProvider","$routeProvider","$locationProvider","$httpProvider","RING_ROUTES","settings","$ocLazyLoadProvider",function(a,b,c,d,e,f,g){g.config({debug:!0,events:!0,modules:[{name:"ringidFriends",files:["app/friend/factories/friends.factory.js","app/friend/factories/friends.http.service.js","app/friend/friend.module.js","app/friend/directives/rg-friends.directive.js","app/friend/directives/rg-requests.directive.js"]},{name:"ringidFeed",files:["app/feed/feed.module.js","app/feed/services/ringfeed.map.factory.js","app/feed/services/feed.factory.js","app/feed/directives/rg-feed-subscriber.directive.js","app/feed/directives/feedimages.directive.js","app/feed/directives/show-more.directive.js","app/feed/directives/rg-incoming-feed.directive.js","app/feed/directives/feed-timeout-option.directive.js","app/feed/directives/feed-repeat.js","app/feed/directives/feed-location-view.directive.js","app/feed/directives/feed-location-menu.directive.js","app/feed/directives/rg-like.directive.js","app/feed/directives/rg-comments.directive.js","app/feed/directives/rg-news-feed-top.directive.js","app/feed/directives/rg-news-feed-bottom.directive.js","app/feed/directives/rg-news-feed-details.directive.js","app/feed/directives/rg-news-feed-shared-feed.directive.js","app/feed/directives/rg-news-feed-menu.directive.js","app/feed/directives/feed-message.directive.js","app/feed/directives/rg-single-feed.directive.js","app/feed/directives/rg-single-feed-details.directive.js","app/feed/directives/feed-inline-share.directive.js","app/feed/controllers/feed.main.controller.js","app/feed/controllers/feed.single.sub.controller.js","app/feed/controllers/feed.sub.controller.js","app/feed/controllers/feed.whoshare.controller.js","app/feed/controllers/feed.ringbox.whoshare.controller.js","app/feed/controllers/feed.share.controller.js","app/feed/controllers/feed.ringbox.share.controller.js","app/feed/controllers/feed.inline.share.controller.js","app/feed/controllers/feed.add.controller.js","app/feed/controllers/feed.dashboard.controller.js","app/feed/controllers/feed.profile.controller.js","app/feed/controllers/feed.circle.controller.js","app/feed/controllers/feed.tag.user.list.controller.js","app/feed/controllers/feed.edit.tag.controller.js"]}]}),d.useApplyAsync(!0),a.debugInfoEnabled(f.debugEnabled),b.when(e.HOME,{templateUrl:"pages/index.html"}).when(e.LOGIN_SOCIAL,{templateUrl:"pages/index.html"}).when(e.SIGNUP_SOCIAL,{templateUrl:"pages/index.html"}).when(e.USER_PROFILE,{templateUrl:"pages/profile/profile.html",resolve:{user:["profileFactory","$route","$location","$q","Ringalert","Auth",function(a,b,c,d,e,f){var g=d.defer();return f.isPendingAsync().then(function(){a.getUserDetailsByUId(b.current.params.uId).then(function(a){g.resolve(a)},function(){e.show("User not found","error"),c.path().indexOf("profile")>-1&&c.path("/"),g.reject()})}),g.promise}]}}).when(e.CIRCLE_HOME,{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/home/circle.html"}).when(e.SINGLE_FEED,{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/index-singlefeed.html"}).when(e.MEDIA_FEEDS,{templateUrl:"pages/home/media.feed.html"}).when(e.WHO_SHARED_FEED,{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/index-who-sharedfeed.html"}).when("/media",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/media-list.html"}).when("/media/myalbums",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/mediasearch/my.albums.html"}).when(e.MEDIA_POST,{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/mediasearch/media.upload.html",controller:"MediaPostController"}).when("/media/:albumtype",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when("/media/:stype/:sk?",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/mediasearch/search.result.html",controller:"mSearchResultController"}).when("/media/:albumtype/:utid/:albumid",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when("/chat",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/partials/chat/single-page/home.html",controller:"ChatHistoryController"}).when("/circle",{templateUrl:"pages/circle-partials/all-circle.html",controller:"allCirclePopupController"}).when("/allnotification",{templateUrl:"pages/partials/all-notification.html"}).when("/allfriendrequest",{templateUrl:"pages/partials/all-friend-request.html"}).when("/medianew",{resolve:{pending:["Auth",function(a){return a.isPendingAsync()}]},templateUrl:"pages/mediapage.html"}).when(e.FAQ,{redirectTo:function(a,b,c){window.location.href=location.protocol+"//"+location.host+"/faq.xhtml"}}).when(e.API_DASHBOARD,{templateUrl:"app/apidashboard/templates/api.index.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","rgDropdownService","rgSearchService","$ringbox",function(a,b,c,d,e,f){function g(b){for(var c=0;c<a.$ignoreScopes.length;c++)j[a.$ignoreScopes[c].$id]&&(a.$ignoreScopes[c].$$childHead=j[a.$ignoreScopes[c].$id]);j=[],b&&(a.$ignoreScopes=[])}a.$on("$routeChangeStart",function(h,i,j){c.isPending()||c.isLoggedIn()||a.doingSilentLogin||"/"===b.url()?(f.closeAll(),d.close(),e.close(),g(!0)):(b.path("/"),g(!0))}),requestAnimationFrame(function(){});var h=[],i=Object.getPrototypeOf(a),j=[];a.$ignoreScopes=[],i.$coreDigest=i.$digest,i.$rgDigest=function(){if(a.$$phase){if(-1==h.indexOf(this)&&1!=this.$id){h.push(this),h.sort(function(a,b){return a.$id-b.$id});for(var b,c,d,e=[];h.length>1;){b=h.pop();for(var f=h.length-1;f>=0;f--){for(c=h[f],d=b.$parent;d!=c&&null!=d;)d=d.$parent;if(null!=d)break}null==d&&e.push(b)}for(;b=e.pop();)h.push(b)}a.$$postDigest(function(){h.length>0&&h.pop().$rgDigest()})}else{if(1==this.$id&&a.$ignoreScopes.length>0){for(var f=0;f<a.$ignoreScopes.length;f++)j[a.$ignoreScopes[f].$id]=a.$ignoreScopes[f].$$childHead,
a.$ignoreScopes[f].$$childHead=null;a.$$postDigest(function(){g()})}this.$coreDigest()}},i.$digest=function(){this.$rgDigest()},i.addIgnore=function(){-1==a.$ignoreScopes.indexOf(this)&&a.$ignoreScopes.push(this)},i.removeIgnore=function(){var b;(b=a.$ignoreScopes.indexOf(this))>-1&&a.$ignoreScopes.splice(b,1)},i.calc=function(){var a,b,c,d=0,e=0;window.performance.now();a=this,b=a;do if(d+=b.$$watchers?b.$$watchers.length:0,e++,!(c=b.$$childHead||b!==a&&b.$$nextSibling))for(;b!==a&&!(c=b.$$nextSibling);)b=b.$parent;while(b=c)}}])}();