/*! @copywrite Ringid.com  2016-06-28 */
var RingWorker,RingMessageChannel;try{RingMessageChannel=new MessageChannel}catch(e){RingMessageChannel=new BroadcastChannel("ring_channel")}!function(e,t){"use strict";function n(){var e,t=Cookies.get("top");return t?(e=parseInt(t)+1,e>255&&(e=1)):e=1,Cookies.set("top",e),e}e._cti=n();try{e.location.origin||(e.location.origin=e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")),RingWorker=new Worker(e.location.origin+"/js/worker/com")}catch(r){console.warn("Your Browser Is Out Dated. Please Update Your Browser To Use RingId"),RingWorker={addCallback:angular.noop,addEventListener:angular.noop,postMessage:angular.noop}}RingWorker.FNS={},RingWorker.addCallback=function(e,t,n){this.FNS[e]||(this.FNS[e]=[]),n=n||null,this.FNS[e].push({ctx:n,fn:t})},RingWorker.send=function(e,t,n,r){if(!n||!e)throw new Error("You must sent data and port");this.postMessage({command:"SEND",packetId:t,data:e,flooding:r,port:n,action:e.actn})},RingWorker.addEventListener("message",function(e){var n,r;if(e.data.notifier&&this.FNS[e.data.notifier])for(r=0;r<this.FNS[e.data.notifier].length;r++)n=this.FNS[e.data.notifier][r],n.fn.call(n.ctx,e.data);else t.warn("message from worker no subs found key: "+e.data.notifier,e,"WORKER_INVALID")}),RingWorker.addCallback("debug",function(e){t.print.apply(t,e.m)},RingWorker),RingWorker.addEventListener("error",function(e){t.alert(e,"WORKER_ERROR")}),RingWorker.pushMessage=function(e,n){try{n?this.postMessage(e,n):this.postMessage(e)}catch(r){t.debug("Ringworker pushMessage ",e,"CHAT")}},RingWorker.pushMessage({command:"SETTINGS",tabId:e._cti,url:"ws://"+e.location.host+"/DataSocket/"+e._cti,aSkey:Cookies.get("sId"),sKey:Cookies.get("sessionID"),CLIENT_DATA_SIZE:460},[RingMessageChannel.port1])}(window,RingLogger),function(e,t){"use strict";e.emojiSupported=function(){var e=document.createElement("canvas");if(!e.getContext||!e.getContext("2d")||"function"!=typeof e.getContext("2d").fillText)return!1;var t=e.getContext("2d");return t.textBaseline="top",t.font="32px Arial",t.fillText("ðŸ˜ƒ",0,0),0!==t.getImageData(16,16,1,1).data[0]}(),e.eventFix=function(t){t=t||e.event;var n=t.pageX,r=t.pageY;void 0===n&&(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElerment.scrollTop)},e.scrollToYOffset=function(t,n){console.log(t);var r=t/(n/15),i=setInterval(function(){console.log(e.scrollY," tar",t),e.scrollY<t?e.scrollBy(0,r):clearInterval(i)},15)},Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),i.prototype=new r,i}),String.prototype.format||(String.prototype.format=function(){var e="[object Array]"===Object.prototype.toString.call(arguments[0])?arguments[0]:arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),String.prototype.supplant||(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t})}),String.prototype.repeat||(String.prototype.repeat=function(e){return Array(e+1).join(this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))},String.prototype.getUTF8Length=function(){for(var e=0,t=this,n=0;n<t.length;n++){var r=t.charCodeAt(n);127>=r?e+=1:2047>=r?e+=2:r>=55296&&57343>=r?(e+=4,n++):e+=65535>r?3:4}return e},String.prototype.toCharCodeArray=function(){for(var e=[],t=0;t<this.length;t++)e.push(this.charCodeAt(t));return e},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.contains||(Array.prototype.contains=function(e,t){if(!t)return this.indexOf(e);var n=this.length>>>0,r=Number(arguments[1])||0;for(r=0>r?Math.ceil(r):Math.floor(r),0>r&&(r+=n);n>r;r++)if(r in this&&t.call(this,this[r],e))return r;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],i=arguments.length>=2?arguments[1]:void 0,o=0;n>o;o++)if(o in t){var a=t[o];e.call(i,a,o,t)&&r.push(a)}return r}),Array.prototype.keyValues||(Array.prototype.keyValues=function(e){var t,n=[];for(t=0;t<this.length;t++)this[t][e]&&n.push(this[t][e]);return n}),Array.prototype.values||(Array.prototype.values=function(){var e,t=[];for(e=0;e<this.length;e++)t.push(this[e]);return t}),Array.prototype.joinAsDataView=function(){var e,n,r=this,i=0,o=0;if(!r.length)return new t(new ArrayBuffer(0));for(var a=0;a<r.length;a++)r[a]instanceof t&&(o+=r[a].byteLength);if(!o)return new t(new ArrayBuffer(0));e=new ArrayBuffer(o),n=new t(e);for(var a=0;a<r.length;a++)if(r[a]instanceof t)for(var s=0;s<r[a].byteLength;s++)n.setUint8(i++,r[a].getUint8(s));return n},Array.prototype.difference=function(e){if(!e||!e.length||!this.length)return this;for(var t={},n=[],r=0;r<e.length;)t[e[r]]=!0,r++;for(r=0;r<this.length;r++)t[this[r]]||n.push(this[r]);return n},t.prototype.copy=function(e,n){var r=this;e=e||0,n=n||r.byteLength;for(var i=new ArrayBuffer(n),o=new t(i),a=0;n>a;a++)o.setUint8(a,r.getUint8(e++));return o},t.prototype.merge=function(e,n,r,i,o){var a,s,c=new t(this.buffer,e,n),l=new ArrayBuffer(c.byteLength+(o-i+1)),u=new t(l);for(a=0;a<c.byteLength;a++)u.setUint8(a,c.getUint8(a));for(s=a;s<u.byteLength;s++)u.setUint8(s,r.getUint8(i++));return u},t.prototype.addAttributeInt=function(e,t,n,r){switch(this.setUint8(e++,t),this.setUint8(e++,n),n){case 1:this.setUint8(e++,r);break;case 2:this.setUint16(e,r),e+=2;break;case 4:this.setUint32(e,r),e+=4}return e},t.prototype.addAttributeString=function(e,t,n){this.setUint8(e++,t),this.setUint8(e++,n.length);for(var r=0;r<n.length;r++)this.setUint8(e++,n.charCodeAt(r));return e},t.prototype.addAttributeData=function(e,t,n,r,i){r=r||0,i=i||n.byteLength,this.setUint8(e++,t),this.setUint16(e,i),e+=2;for(var o=0;i>o;o++)this.setUint8(e++,n.getUint8(r++));return e},t.prototype.print_r=function(e,t,n){t=t||0,n=n||this.byteLength;for(var r,i,o="Index		Binary		Integer		Char\n",a="",s=t;n>s;s++)i=this.getUint8(s),r=String.fromCharCode(i),o+=s+"		 		"+i.toString(2)+"				"+i+"				"+r+"\n",a+=r;return e&&"string"!=typeof e?(console.log(o),console.log("\n length : "+o.length),void console.log(a)):a},t.prototype.printBytes=function(){for(var e=[],t=0;t<this.byteLength;t++)e.push(this.getUint8(t));e.push(-1e3),console.log(e.join("\n"))},t.prototype.getString=function(e,t){var n,r,i,o,a=this,s=[];for(t=t||a.byteLength;t>0;)n=a.getUint8(e),a.getUint8(e)<=127?(s.push(a.getUint8(e++)),t--):a.getUint8(e)>=128&&a.getUint8(e)<=223?(s.push((31&a.getUint8(e++))<<6|63&a.getUint8(e++)),t-=2):a.getUint8(e)>=224&&a.getUint8(e)<=239?(s.push((31&a.getUint8(e++))<<12|((63&a.getUint8(e++))<<6|63&a.getUint8(e++))),t-=3):(o=(7&a.getUint8(e++))<<18|((63&a.getUint8(e++))<<12|((63&a.getUint8(e++))<<6|63&a.getUint8(e++))),o-=65536,r=(o>>10)+55296,i=o%1024+56320,s.push(r,i),t-=4);return String.fromCharCode.apply(null,s)},t.prototype.getStringUtf16=function(e,t,n){t=0|t,e=e||this.byteLength-t;var r=!1,i="",o=!1;if("undefined"!=typeof Buffer&&(i=[],o=!0),0>e&&(e+=this.byteLength),n){var a=this.getUint16(t);65534===a&&(r=!0),t+=2,e-=2}for(var s=t;t+e>s;s+=2){var c=this.getUint16(s,r);c>=0&&55295>=c||c>=57344&&65535>=c?o?i.push(c):i+=String.fromCharCode(c):c>=65536&&1114111>=c&&(c-=65536,o?(i.push(((1047552&c)>>10)+55296),i.push((1023&c)+56320)):i+=String.fromCharCode(((1047552&c)>>10)+55296)+String.fromCharCode((1023&c)+56320))}return o?i.toString():decodeURIComponent(escape(i))},t.prototype.getIntByByte=function(e,t){var n=this;switch(t){case 1:return n.getUint8(e);case 2:return n.getUint16(e);case 4:return n.getUint32(e);case 6:case 8:var r,i,o="";for(r=e;e+t>r;r++)i=n.getUint8(r).toString(2),o+=i.length<8?"0".repeat(8-i.length)+i:i;return parseInt(o,2);default:return n.getUint8(e)}},t.prototype.getSynch=function(e){for(var t=0,n=2130706432;n;)t>>=1,t|=e&n,n>>=8;return t},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=this.byteLength),e=Math.floor(e),t=Math.floor(t),0>e&&(e+=this.byteLength),0>t&&(t+=this.byteLength),e=Math.min(Math.max(0,e),this.byteLength),t=Math.min(Math.max(0,t),this.byteLength),0>=t-e)return new ArrayBuffer(0);var n=new ArrayBuffer(t-e),r=new Uint8Array(n),i=new Uint8Array(this,e,t-e);return r.set(i),n}),t.prototype.setUint64=function(e,t){var n=this,r=Number.isInteger(t)?t.toString(2):parseInt(t).toString(2);r=r.length<64?"0".repeat(64-r.length)+r:r;for(var i=r.match(/.{1,32}/g),o=i.map(function(e){return parseInt(e,2)}),a=0;a<o.length;a++)n.setUint32(e+4*a,o[a])},t.prototype.getBool=function(e){return 1===this.getUint8(e)},e.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,n=(t.parentNode||t.document).querySelectorAll(e),r=-1;n[++r]&&n[r]!=t;);return!!n[r]}}(e.Element.prototype),e.Element&&function(e){e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(e.Element.prototype),e.requestAnimationFrame=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,t.prototype.getUint24=function(e,t){return t?this.getUint8(e)+(this.getUint8(e+1)<<8)+(this.getUint8(e+2)<<16):this.getUint8(e+2)+(this.getUint8(e+1)<<8)+(this.getUint8(e)<<16)},Math.easeIn=function(e,t,n,r){return e/=r/2,1>e?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)},e.decodeEntities=function(){function e(e){return e&&"string"==typeof e&&(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),e=e.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),t.innerHTML=e,e=t.textContent,t.textContent=""),e}var t=document.createElement("div");return e}(),"function"!=typeof Object.assign&&!function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}}()}(window,DataView),function(e,t){"use strict";e.module("ringid.digits",["ringid.config","ringid.global_services"])}(angular,window),function(e,t){"use strict";function n(e){var t=!1;this.initialize=function(){t||(Digits.init({consumerKey:e.digitsConsumerKey}),t=!0)}}e.module("ringid.digits").service("digitsService",n),n.$inject=["settings"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s,c){function l(e,l){function u(e){RingLogger.print(e,RingLogger.tags.PROFILE)}function d(a){RingLogger.print(a,RingLogger.tags.PROFILE);var s=a.oauth_echo_headers,c={authHeader:s["X-Verify-Credentials-Authorization"],apiUrl:s["X-Auth-Service-Provider"]};n.post(t.digitsServiceUrl,c).then(function(t){if(t.data.phoneNumber&&t.data.phoneNumber.length>1){var n,a={mbl:"",mblDc:""},s=t.data.phoneNumber,c=r.getCountryList();RingLogger.print(s,RingLogger.tags.PROFILE);for(var l=0;l<c.length;l++)if(n=s.substr(0,c[l].code.length),c[l].code===n){a.mblDc=c[l].code,a.mbl=s.substr(c[l].code.length);break}RingLogger.print(a,RingLogger.tags.PROFILE),e.verify()(a)}else i.show(o.REQUEST_FAILED)})}function g(){E=!0,f=c('<div class="verify-phone"></div>')(e),l.after(f);var t="",n=s.getData("country");n&&n.hasOwnProperty("code")&&(t=n.code),a.initialize(),Digits.embed({container:".verify-phone",phoneNumber:t}).done(d).fail(u),e.$rgDigest()}function m(){E=!1,f&&f.remove()}var f,E=!1;e.$watch("enabled",function(e){e&&!E?g():!e&&E&&m()})}return{restrict:"E",scope:{verify:"&",enabled:"="},link:l}}e.module("ringid.digits").directive("rgVerifyPhone",n),n.$inject=["$ringhttp","settings","$http","Auth","Ringalert","MESSAGES","digitsService","Storage","$compile"]}(angular,window),function(e,t){"use strict";e.module("ringid.config",[])}(angular,window),function(e,t){"use strict";function n(e){s.signupInit=e.ac+"ringid?pf=5&v="+s.apiVersion+"&",s.signupSocialInit=e.ac+"comports?pf=5&v="+s.apiVersion+"&",s.imBase=e.imsres,s.imServer=e.ims+"ringmarket/",s.mediaServer=e.vodapi+"/stream/",s.mediaBase=e.vodres,s.stickerBase=e.stmres+"stickermarket/d5/",s.stickerApi=e.stmapi+"ringmarket/StickerHandler/?pf=5&v="+s.apiVersion+"&"}var r=location.href.split("/")[2],i="http://",o=location.protocol+"//"+location.host,a={ac:"http://devauth.ringid.com/rac/",ims:"http://devimages.ringid.com/",imsres:"http://devimagesres.ringid.com/",stmapi:"http://devsticker.ringid.com/",stmres:"http://devstickerres.ringid.com/",vodapi:"http://devmediacloudapi.ringid.com/",vodres:"http://devmediacloud.ringid.com/",apiVersion:143},s={apiVersion:a.apiVersion,constantServer:"http://auth.ringid.com/cnstnts?pf=5&v="+a.apiVersion+"&apt=1",socketProtocol:"ws://",secure:!1,analytics:!1,debugEnabled:!0,httpsUrl:"http://"+r,siteUrl:r,baseUrl:o,base:location.host,chatImBase:i+"image.ringid.com/chatContens/",chatVideoBase:i+"image.ringid.com/chatContens/",chatAudioBase:i+"image.ringid.com/chatContens/",tagChatImBase:i+"image.ringid.com/groupContents/",chatHeartBeatUrl:o+"/images/ping.jpg",emotionServer:a.imsres+"/emoticon/d5/",emoticonBase:i+r+"/images/emoticon/",stickerBase:a.stmres+"stickermarket/d5/",stickerApi:a.stmapi+"ringmarket/StickerHandler/?pf=5&v="+a.apiVersion+"&",imMediaBase:i+"image.ringid.com/ringmarket/ChatImageHandler",digitsServiceUrl:"http://dev.ringid.com/DigitsService",digitsConsumerKey:"wnZ1SukFsxdnr22U4PLiS3T9J",twitterApiURL:"http://api.twitter.com/1.1/account/verify_credentials.json",ogServiceUrl:i+r+"/OGService",sessionTimeout:216e5,FEED_LIMIT:6,FEED_TEXT_LIMIT:65335,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE"};s.updateUrlBase=n,s.updateUrlBase(a);var c={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},l={HOME:"/",USER_PROFILE:"/profile/:uId/:subpage?/:albumId?",CIRCLE_HOME:"/circle/:circleId/:subpage?",CIRCLE:"/circle",WHO_SHARED_FEED:"/feed_shares/:feedId/:commentId?",SINGLE_FEED:"/feed/:feedId/:commentId?/:shared?",SINGLE_IMAGE:"/image/:imageId/:commentId?",SINGLE_MEDIA:"/media/:mediaId/:commentId?",MEDIA_FEEDS:"/medias",LOGIN_SOCIAL:"/social/:operation/:platform/:token",SIGNUP_SOCIAL:"/social/:operation/:platform/:token",MEDIA_CLOUD:"/media",MEDIA_POST:"/media/upload",MEDIA_CLOUD_MYALBUM:"/media/myalbums",MEDIA_CLOUD_ALBUM:"/media/:albumtype",MEDIA_CLOUD_SEARCH:"/media/:stype/:sk?",MEDIA_CLOUD_USERMEDIA:"/media/:albumtype/:utid/:albumid",FAQ:"/faq",API_DASHBOARD:"/apidashboard"},u="ringID: Free Video Calls, Secret Chats, Feeds, Stickers & more",d={DEFAULT:u};d[l.HOME]=u,d[l.CIRCLE_HOME]="ringID Circle",d[l.CIRCLE]="ringID Circle",d[l.SINGLE_FEED]=u,d[l.MEDIA_FEEDS]="Media Feeds",d[l.MEDIA_CLOUD]="Media Cloud",d[l.MEDIA_POST]="Media Cloud",d[l.MEDIA_CLOUD_MYALBUM]="Media Cloud",d[l.MEDIA_CLOUD_ALBUM]="Media Cloud",d[l.MEDIA_CLOUD_SEARCH]="Media Cloud",d[l.MEDIA_CLOUD_USERMEDIA]="Media Cloud",e.module("ringid.config").constant("settings",s).constant("PLATFORM",c).constant("RING_ROUTES",l).constant("PAGE_TITLES",d).constant("MIN_TIMESTAMP",0xe87c62b0141)}(angular,window),function(e,t){"use strict";var n={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166,ADDED_TIME:168};e.module("ringid.config").constant("ATTRIBUTE_CODES",n)}(angular,window),function(e,t){"use strict";!function(){e.module("ringid.config").constant("REASON_CODES",{NONE:0,PERMISSION_DENIED:1,PASSCODE_SENT_INTERVAL:2,DONT_DISTURB_MODE:3,ALREADY_SHARED:4,NOT_TAG_MEMBER:5,TAG_DOES_NOT_EXIST:6,SMS_SENDING_FAILED:7,EMAIL_SENDING_FAILED:8,FRIEND_OFFLINE:9,NOT_FRIEND:10,USERID_FRIENDID_SAME:11,ALREADY_FRIEND_REQUESTED:12,EXCEPTION_OCCURED:13,DATABASE_ROLL_BACKED:14,CANT_SHARE_OWN_FEED:15,FRIEND_DID_NOT_FOUND:16,SMS_SEND_RETRY_LIMIT_OVER:17,NO_MORE_FEED:18,NOT_FOUND:404}).constant("SystemEvents",{COMMON:{WINDOW_RESIZED:"WINDOW_RESIZED",COLUMN_CHANGED:"COLUMN_CHANGED",LOADING:"LOADING"},MEDIA:{SLIDER_IMAGE_LOADED:"SLIDER_IMAGE_LOADED"},PORTAL:{DONE_FOLLOW_PORTAL:"DONE_FOLLOW_PORTAL",UNFOLLOW_PORTAL:"UNFOLLOW_PORTAL"},RINGBOX:{UPDATE:"CONTENT_UPDATE"},CIRCLE:{MY_CIRCLE_LIST_FETCH_COMPLETE:"MY_CIRCLE_LOAD_COMPLETE",MY_CIRCLE_LIST_PROCESS_COMPLETE:"MY_CIRCLE_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE:"MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE",MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE:"MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE:"MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE",MY_CIRCLE_MEMBER_REMOVED:"MY_CIRCLE_MEMBER_REMOVED",MY_CIRCLE_REMOVED:"MY_CIRCLE_REMOVED",MY_CIRCLE_UPDATE_MEMBER_COUNT:"MY_CIRCLE_UPDATECOUNT"},FILE_UPLOAD:{PROGRESS_UPDATE:"PROGRESS_UPDATE",QUEUE_START:"QUEUE_START",QUEUE_COMPLETE:"QUEUE_COMPLETE",UPLOADS_POSTED:"UPLOADS_POSTED"},ALBUM:{PHOTOS_SELECTED:"PHOTOS_SELECTED"},IMAGE:{DO_REPOSITION:"DO_REPOSITION",RESIZE:"RESIZE"},FEED:{UPDATED:"UPDATED",CREATED:"CREATED",DELETED:"DELETED",RESET:"RESET",HEIGHT:"HEIGHT",BUSY:"BUSY"},FRIEND:{PENDING_FRIENDS_COUNT_CHANGED:"PENDING_FRIENDS_COUNT_CHANGED",UTID_LIST_RECEIVED:"UTID_LIST_RECEIVED"},AUTH:{LOGIN:"LOGIN",LOGIN_REQUIRED:"LOGIN_REQUIRED",LOGIN_DONE:"LOGIN_DONE"},CHAT:{BOX_CAM_UPLOAD:"BOX_CAM_UPLOAD",BOX_OPENNED:"BOX_OPENNED",BOX_UPDATED:"BOX_UPDATED",WAS_FOCUSED:"WAS_FOCUSED",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",NEW_MESSAGE_PUSHED:"NEW_MESSAGE_PUSHED",MESSAGE_RECEIVED:"MESSAGE_RECEIVED",UNREAD_MESSAGE_INFO_UPDATED:"UNREAD_MESSAGE_INFO_UPDATED",SINGLE_MESSAGE_UPDATED:"SINGLE_MESSAGE_UPDATED",SINGLE_MESSAGE_TIMEOUT:"SINGLE_MESSAGE_TIMEOUT",MESSAGE_SUBMITTED:"MESSAGE_SUBMITTED",MESSAGE_PUSHED:"MESSAGE_PUSHED",DO_START_SECRET_TIMER:"DO_START_SECRET_TIMER",SIMPLE_MESSAGE_TIMEOUT:"SIMPLE_MESSAGE_TIMEOUT",MY_TAG_LIST_RECEIVED:"MY_TAG_LIST_RECEIVED",TAG_LIST_UPDATED:"TAG_LIST_UPDATED",TAG_REGISTERED:"TAG_REGISTERED",TAG_UNREGISTERED:"TAG_UNREGISTERED",TAG_MEMBER_FETCHED:"TAG_MEMBER_FETCHED",TAB_SYNC_NEW_DATA:"TAB_SYNC_NEW_DATA",HISTORY_LOADED:"HISTORY_LOADED",CHAT_REGISTER:"CHAT_REGISTER",TAB_SYNC:"TAB_SYNC",SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD"}}).constant("MESSAGES",{REQUEST_PROCESSED:"Your Request Was Successfully Processed",REQUEST_FAILED:"Your Request Was Failed ! Please Try Later.",RC0:"NONE.",RC1:"PERMISSION_DENIED",RC2:"PASSCODE_SENT_INTERVAL",RC3:"DONT_DISTURB_MODE",RC4:"You have already shared this post.",RC5:"NOT_TAG_MEMBER.",RC6:"TAG_DOES_NOT_EXIST.",RC7:"SMS_SENDING_FAILED.",RC8:"EMAIL_SENDING_FAILED.",RC9:"FRIEND_OFFLINE",RC10:"You are not permitted to share this post",RC11:"USERID_FRIENDID_SAME",RC12:"ALREADY_FRIEND_REQUESTED",RC13:"EXCEPTION_OCCURED",RC14:"DATABASE_ROLL_BACKED",RC15:"You Can't Share Your Own Post",RC16:"FRIEND_DID_NOT_FOUND",RC17:"SMS_SEND_RETRY_LIMIT_OVER",RC18:"NO_MORE_FEED",RC19:"UNKNOWN",RC20:"UNKNOWN",RC21:"LOGGED_IN_FROM_ANOTHER_DEVICE",RC22:"UNKNOWN",RC23:"UNKNOWN",RC26:"USER_EXIST",RC27:"DUPLICATE_DATA",RC33:"THIS_IS_SPECIAL_FRIEND",RC37:"ANONYMOUS_CHAT_PERMISSION_DENIED",RC24:"Wrong Password.",RC38:"Could not find DeviceID!",RC39:"This phone number is not verified.",RC40:"This email is not verified.",RC41:"Your facebook ID is not verified.",RC42:"Your twitter ID is not verified.",RC43:"Could not find Your facebook ID.",RC44:"Could not find Your twitter ID.",RC45:"Wrong RingID!",RC46:"Wrong Phone number!",RC47:"Wrong Email!",RC48:"Device Id required!",RC49:"Password required",RC50:"Login Type required",RC51:"Phone country code required!",RC52:"Phone number required!",RC53:"RingID required!",RC54:"Email required!",RC55:"Version required!",RC56:"Device required!",RC57:"Wrong information",RC60:"Friend limit over!",RC64:"Pending friend limit over!",RC65:"Friend's pending friend limit over",RC66:"Friend's friend limit over",RC404:"NOT_FOUND",CRCFS1:"Wall post can't be shared",CRCFS2:"Group post can't be shared",CRCFS3:"You already shared this post",FEED_INV:"Please insert some text or upload an image!",FTL_ERROR:"A status can't be longer than {max_limit} characters, but this one is {length} characters long. Please make it a little shorter and try again.",FEED:{ACT_1:"{0} liked this post",ACT_2:"{0} commented on this post",ACT_3:"{0} shared this post",TYPE_0:"{0}",TYPE_11:"{0}",TYPE_11C:"{0} posted",TYPE_11F:"{0} posted",TYPE_12:"{0} have||has updated profile picture",TYPE_13:"{0} have||has updated cover picture",TYPE_2:"{0}",TYPE_2L:"{0} shared a link",TYPE_2C:"{0} posted",TYPE_2CL:"{0} shared a link",TYPE_2F:"{0} posted",TYPE_2FL:"{0} shared a link",TYPE_3:"{0} have||has added {1} photos",TYPE_4:"{0} created a album",TYPE_50:"{0} added {1} music",TYPE_51:"{0} shared {1}'s music",TYPE_60:"{0} added {1} video",TYPE_62:"{0} shared {1}'s video",TYPE_D:"{0}",C_POSTFIX:" in {0}",F_POSTFIX:" on {0}'s timeline",TYPE_SHARE:"{0} shared {1}'s feed"},NEWSPORTAL:{C_UNFOLLOW:"Are you sure you want to unfollow?"}}).constant("APP_CONSTANTS",{NOT_FRIEND:0,FRIEND:1,INCOMING_FRIEND:2,OUTGOING_FRIEND:3,TYPE_SEARCH_BY_ALL:0,TYPE_SEARCH_BY_NAME:1,TYPE_SEARCH_BY_PHONE:2,TYPE_SEARCH_BY_EMAIL:3,TYPE_SEARCH_BY_RINGID:4,TYPE_SEARCH_BY_LOCATION:5,IMAGE_UPLOAD_LIMIT:40,VIDEO_UPLOAD_LIMIT:5,AUDIO_UPLOAD_LIMIT:5,COVER_PIC_UPLOAD_MAXIMUM_WIDTH:1480,COVER_PIC_UPLOAD_MAXIMUM_HEIGHT:2048,COVER_PIC_UPLOAD_MINIMUM_WIDTH:740,COVER_PIC_UPLOAD_MINIMUM_HEIGHT:280,PROFILE_PIC_UPLOAD_MINIMUM_WIDTH:100,PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT:100,COVER_PIC_CROP_WIDTH:1480,COVER_PIC_CROP_HEIGHT:450,PROFILE_PIC_CROP_WIDTH:200,IMAGE_UPLOAD_MIN_WIDTH:10,IMAGE_UPLOAD_MIN_HEIGHT:10,MEDIA_UPLOAD_SIZE_LIMIT:524288e3,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE",NEWS_FEED_MEDIA_TYPE_AUDIO:1,NEWS_FEED_MEDIA_TYPE_VIDEO:2}).constant("PrivacySet",{PVC1:{icon:"img_sprite post-ico only-i",iconfeed:"img_sprite post-ico-gray only-i",text:"Only me",value:1},PVC2:{icon:"img_sprite post-ico fri-i",iconfeed:"post-ico-gray fri-i",text:"Friends",value:2},PVC3:{icon:"img_sprite post-ico pub-i",iconfeed:"img_sprite post-ico-gray pub-i",text:"Public",value:3}}).constant("SPAM_TYPES",{USER:1,FEED:2,IMAGE:3,MEDIA:4}).constant("CLIENT_DATA_SIZE",460).constant("AUTH_SERVER_CONFIG",{REQUEST_DELAY:200}).value("DATE_FORMAT","MMM d, y h:mm a").value("STICKER_IMAGE_TYPE",{EMOTICON:1,LARGE_EMOTICON:2,STICKER:3}).value("STICKER_COLLECTION_CATEGORY_PRE_FETCH_COUNT",5)}()}(angular,window),function(e,t){"use strict";e.module("ringid.config").constant("OPERATION_TYPES",{SYSTEM:{REQUEST_TYPE:{KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:114,TYPE_NEWS_FEED:88,TYPE_MY_NEWS_FEED:94,TYPE_FRIEND_NEWSFEED:110,TYPE_GROUP_NEWS_FEED:198,TYPE_MEDIAS_NEWS_FEED:87,TYPE_NEWS_PORTAL_FEED:295,TYPE_COMMENTS_FOR_STATUS:84,ACTION_SHARE_STATUS:191,ACTION_GET_FULL_COMMENT:137,TYPE_ADD_MULTI_IMAGE:117,TYPE_ADD_STATUS:177,NEWS_FEED_TYPE_IMAGE:1,NEWS_FEED_TYPE_STATUS:2,NEWS_FEED_TYPE_MULTIPLE_IMAGE:3,NEWS_FEED_TYPE_ALBUM:4,NEWS_FEED_TYPE_AUDIO:5,NEWS_FEED_TYPE_VIDEO:6,TYPE_SINGLE_IMAGE_STATUS:1,TYPE_TEXT_STATUS:2,TYPE_MULTI_IMAGE_STATUS:3,TYPE_DELETE_STATUS:179,TYPE_EDIT_STATUS:178,TYPE_LIKE_STATUS:184,TYPE_UNLIKE_STATUS:186,TYPE_ADD_STATUS_COMMENT:181,TYPE_LIKE_COMMENT:123,TYPE_UNLIKE_COMMENT:125,TYPE_DELETE_STATUS_COMMENT:183,TYPE_EDIT_STATUS_COMMENT:189,TYPE_LIKES_FOR_STATUS:92,TYPE_LIST_LIKES_OF_COMMENT:116,TYPE_TAG_USER_LIST:274,TYPE_WHO_SHARES_LIST:249,TYPE_UPDATE_ADD_STATUS:377,TYPE_UPDATE_EDIT_STATUS:378,ACTION_UPDATE_SHARE_STATUS:391,TYPE_UPDATE_LIKE_STATUS:384,TYPE_UPDATE_UNLIKE_STATUS:386,TYPE_UPDATE_DELETE_STATUS:379,TYPE_UPDATE_ADD_STATUS_COMMENT:381,TYPE_UPDATE_LIKE_COMMENT:323,TYPE_UPDATE_UNLIKE_COMMENT:325,TYPE_UPDATE_DELETE_STATUS_COMMENT:383,TYPE_UPDATE_EDIT_STATUS_COMMENT:389,ALBUM:{TYPE_UPLOAD_ALBUM_IMAGE:85,TYPE_UPDATE_UPLOAD_ALBUM_IMAGE:90,TYPE_DELETE_ALBUM_IMAGE:176,TYPE_UPDATE_DELETE_ALBUM_IMAGE:376},AUTH:{TYPE_INVALID_LOGIN_SESSION:19,TYPE_SIGN_IN:20,TYPE_SIGN_OUT:22,TYPE_SIGN_UP:21,PHN_MAIL_VERIFICATION_CHECK:28,TYPE_SESSION_VALIDATION:76,TYPE_MULTIPLE_SESSION:75,SIGNUP_SEND_CODE_EMAIL:220,SIGNUP_SEND_CODE_PHONE:100,SIGNUP_REGISTER:126,PASSWORD_RECOVER_OPTIONS:222,PASSWORD_RECOVER_SEND_CODE:217,PASSWORD_RECOVER_VERIFY_CODE:218,PASSWORD_RECOVER:219},FRIENDS:{TYPE_CONTACT_UTIDS:29,TYPE_CONTACT_LIST:23,TYPE_PEOPLE_YOU_MAY_KNOW:31,TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:32,TYPE_FRIEND_CONTACT_LIST:107,TYPE_CONTACT_SEARCH:34,ACTION_FRIEND_SEARCH:35,TYPE_ADD_FRIEND:127,TYPE_UPDATE_ADD_FRIEND:327,TYPE_DELETE_FRIEND:128,TYPE_UPDATE_DELETE_FRIEND:328,TYPE_ACCEPT_FRIEND:129,TYPE_UPDATE_ACCEPT_FRIEND:329,TYPE_ACTION_BLOCK_UNBLOCK_FRIEND:243,TYPE_ACTION_CHANGE_FRIEND_ACCESS:244},NOTIFICATION:{TYPE_MY_NOTIFICATIONS:111,TYPE_SINGLE_NOTIFICATION:113,CLEAR_NOTIFICATION_COUNTER:195,MSG_TYPE_UPDATE_PROFILE_IMAGE:1,MSG_TYPE_UPDATE_COVER_IMAGE:2,MSG_TYPE_ADD_FRIEND:3,MSG_TYPE_ACCEPT_FRIEND:4,MSG_TYPE_ADD_GROUP_MEMBER:5,MSG_TYPE_ADD_STATUS_COMMENT:6,MSG_TYPE_LIKE_STATUS:7,MSG_TYPE_LIKE_COMMENT:8,MSG_TYPE_ADD_COMMENT_ON_COMMENT:9,MSG_TYPE_SHARE_STATUS:10,MSG_TYPE_LIKE_IMAGE:11,MSG_TYPE_IMAGE_COMMENT:12,MSG_TYPE_LIKE_IMAGE_COMMENT:13,MSG_TYPE_LIKE_AUDIO_MEDIA:17,MSG_TYPE_AUDIO_MEDIA_COMMENT:18,MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:19,MSG_TYPE_AUDIO_MEDIA_VIEW:20,MSG_TYPE_LIKE_VIDEO_MEDIA:21,MSG_TYPE_VIDEO_MEDIA_COMMENT:22,MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:23,MSG_TYPE_VIDEO_MEDIA_VIEW:24,MSG_TYPE_YOU_HAVE_BEEN_TAGGED:25,MSG_TYPE_UPGRADE_FRIEND_ACCESS:14,MSG_TYPE_ACCEPT_FRIEND_ACCESS:15,MSG_TYPE_DOWNGRADE_FRIEND_ACCESS:16},CIRCLE:{TYPE_CREATE_GROUP:50,TYPE_GROUP_DETAILS:52,TYPE_LEAVE_GROUP:53,TYPE_GROUP_LIST:70,TYPE_GROUP_MEMBERS_LIST:99,TYPE_GROUP_MEMBERS_SEARCH_RESULT:101,TYPE_DELETE_GROUP:152,TYPE_REMOVE_GROUP_MEMBER:154,TYPE_ADD_GROUP_MEMBER:156,TYPE_EDIT_GROUP_MEMBER:158,TYPE_UPDATE_ADD_GROUP:352,TYPE_UPDATE_DELETE_GROUP:352,TYPE_UPDATE_REMOVE_GROUP_MEMBER:354,TYPE_UPDATE_ADD_GROUP_MEMBER:356,TYPE_UPDATE_EDIT_GROUP_MEMBER:358,TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:51},CHAT:{FRIEND_CHAT_REQUEST:175,FRIEND_CHAT_UPDATE:375},TAG_CHAT:{TAG_CHAT_REQUEST_START:134,TAG_CHAT_UPDATE_START:334,TAG_CHAT_REQUEST_ADD_MEMBER:135,TAG_CHAT_UPDATE_ADD_MEMBER:335},PORTAL:{ACTION_NEWSPORTAL_LIST:299,ACTION_NEWSPORTAL_CATEGORIES_LIST:294,ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL:296,ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED:300,ACTION_CONTACT_SEARCH:34},MEDIA:{ACTION_CHECK_MEDIA_IN_ALBUMS:1006,ACTION_ADD_MEDIA_CONTENT:258,ACTION_UPDATE_MEDIA_CONTENT:259,ACTION_DELETE_MEDIA_CONTENT:260,ACTION_MEDIA_ALBUM_CONTENT_LIST:261,ACTION_MEDIA_CONTENT_DETAILS:262,ACTION_ADD_MEDIA_ALBUM:253,ACTION_UPDATE_MEDIA_ALBUM:254,ACTION_DELETE_MEDIA_ALBUM:255,ACTION_MEDIA_ALBUM_LIST:256,ACTION_MEDIA_ALBUM_DETAILS:257,ACTION_MEDIA_SEARCH_RESULT:277,ACTION_SPECIFIC_MEDIA_RESULT:278,ACTION_GET_TAGGED_MEDIA_SONGS:279,ACTION_GET_MEDIA_SLIDER_IMG:1005,ACTION_GET_HASHTAG_SUGGESTION:280,ACTION_GET_TRENDING_KEYWORDS:281,ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT:272,ACTION_ADD_COMMENT_ON_MEDIA:265,ACTION_LIKE_UNLIKE_MEDIA:264,ACTION_EDIT_COMMENT_ON_MEDIA:266,ACTION_MEDIA_COMMENT_LIST:270,ACTION_MEDIA_LIKE_LIST:269,ACTION_DELETE_COMMENT_ON_MEDIA:267,ACTION_LIKE_UNLIKE_MEDIA_COMMENT:268,ACTION_MEDIACOMMENT_LIKE_LIST:271,ACTION_UPDATE_LIKE_UNLIKE_MEDIA:464,ACTION_UPDATE_ADD_MEDIA_COMMENT:465,ACTION_UPDATE_EDIT_MEDIA_COMMENT:466,ACTION_UPDATE_DELETE_MEDIA_COMMENT:467,ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:468,ACTION_UPDATE_INCREASE_MEDIA_CONTENT_VIEW_COUNT:472},IMAGE:{PROFILE_IMAGE_ALBUM_ID:"profileimages",COVER_IMAGE_ALBUM_ID:"coverimages",FEED_IMAGE_ALBUM_ID:"default",TYPE_FRIEND_ALBUM_IMAGES:109,FETCH_ALBUM_LIST:96,FETCH_FRIEND_ALBUM_LIST:108,TYPE_ALBUM_IMAGES:97,TYPE_COMMENTS_FOR_IMAGE:89,TYPE_LIKES_FOR_IMAGE:93,TYPE_IMAGE_COMMENT_LIKES:196,TYPE_LIKE_IMAGE:185,TYPE_UNLIKE_IMAGE:187,TYPE_IMAGE_DETAILS:121,TYPE_EDIT_IMAGE_COMMENT:194,TYPE_ADD_IMAGE_COMMENT:180,TYPE_LIKE_UNLIKE_IMAGE_COMMENT:197,TYPE_DELETE_IMAGE_COMMENT:182,DELETE_IMAGE:246,TYPE_UPDATE_ADD_IMAGE_COMMENT:380,TYPE_UPDATE_EDIT_IMAGE_COMMENT:394,TYPE_UPDATE_DELETE_IMAGE_COMMENT:382,TYPE_UPDATE_LIKE_IMAGE:385,TYPE_UPDATE_UNLIKE_IMAGE:387,TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:397},PROFILE:{TYPE_CHANGE_COVER_PIC:103,TYPE_CHANGE_PROFILE_PIC:63,TYPE_REMOVE_PROFILE_IMAGE:43,TYPE_REMOVE_COVER_IMAGE:104,TYPE_ACTION_USER_MOOD:193,TYPE_ACTION_USER_MOOD_PRESENCE:199,FETCH_FRIEND_MUTUAL_FRIEND_LIST:118,CHANGE_PASSWORD:130,ACTION_USERS_PRESENCE_DETAILS:136,ACTION_USERS_PRESENCE_DETAILS_DATA:336,TYPE_ACTION_CURRENT_USER_BASICINFO:21,TYPE_ACTION_OTHER_USER_BASICINFO:95,TYPE_ACTION_GET_USER_DETAILS:204,TYPE_ACTION_LIST_WORK_AND_EDUCATIONS:230,TYPE_ACTION_MODIFY_USER_PROFILE:25,TYPE_ACTION_MODIFY_PRIVACY_SETTINGS:74,TYPE_CHANGE_PRIVACY:216,TYPE_CHANGE_FRIEND_PRIVACY:82,SEND_VERIFICATION_CODE_TO_MAIL:221,SEND_VERIFICATION_CODE_TO_PHONE:212,TYPE_ACTION_ADD_EDUCATION:231,TYPE_ACTION_UPDATE_EDUCATION:232,TYPE_ACTION_REMOVE_EDUCATION:233,TYPE_ACTION_GET_WORK:234,TYPE_ACTION_GET_EDUCATION:235,TYPE_ACTION_GET_SKILL:236,TYPE_ACTION_ADD_SKILL:237,TYPE_ACTION_UPDATE_SKILL:238,TYPE_ACTION_REMOVE_SKILL:239,TYPE_ACTION_ADD_WORK:227,TYPE_ACTION_UPDATE_WORK:228,TYPE_ACTION_REMOVE_WORK:229,ADD_SOCIAL_NETWORK:276},REPORT:{ACTION_SPAM_REASON_LIST:1001,ACTION_REPORT_SPAM:1002},FETCH_EMOTION_LIST:273},STICKER:{GET_MY_STICKER:206,ADD_REMOVE_STICKER:207,ADD_JT_VALUE:1,REMOVE_JT_VALUE:3}})}(angular,window),function(e,t){"use strict";e.module("ringid.language",[])}(angular,window),function(e,t){"use strict";e.module("ringid.language").factory("languageConstant",function(){var e={"default":{add_friend:"Add Friend",remove_friend:"Remove Friend",common_friend:"Common Friend",request_sent:"Request Sent",unfriend:"Unfriend",block:"Block",unblock:"UnBlock",edit:"Edit",update:"Update","delete":"Delete",cancel:"Cancel",save:"Save",text_add:"Add",accept:"Accept",remove:"Remove",change:"Change",send:"Send",verify:"verify",add:"Add"}};return{set:function(t){e[t]={}},get:function(t,n){return t=t||"default",e[t]}}})}(angular,window),function(e,t){"use strict";
e.module("ringid.connector",["ngWebSocket","ringid.config"])}(angular,window),function(e,t){"use strict";function n(e,t,n){var r=e.createNew(),i=function(){r.length()>0&&o()},o=function(){var e;r.doForAll(function(t){e=t.call(null),e&&!e.$$phase&&e.$digest()})};return t.$on("ringActive",i),{add:function(e){var t=n.getUniqueID();return r.add(t,e),t},remove:function(e){return r.remove(e)},synch:i}}e.module("ringid.connector").factory("$$rgsyncher",n),n.$inject=["$$stackedMap","$rootScope","Utils"]}(angular,window),function(e,t){"use strict";!function(){function t(e){var t={defer:function(){var t=e.defer(),n={};return{resolve:function(e){var r,i,o,a;if(e.seq||e.totalPacket){if(r=e.pckId,n[e.pckId]||(n[e.pckId]=[]),t.notify(e),e.seq?(i=e.seq.lastIndexOf("/"),o=e.seq.substr(0,i),a=e.seq.substr(i+1,e.seq.length)):(o=e.packetNo,a=e.totalPacket),n[e.pckId]["sq"+o])return!0;if(n[e.pckId]["sq"+o]=!0,n[e.pckId].push(e),a!=n[e.pckId].length)return!0;for(var s={},c=0;c<n[e.pckId].length;c++)for(r in n[e.pckId][c])n[e.pckId][c][r]instanceof Array?s[r]=(s[r]||[]).concat(n[e.pckId][c][r]):s[r]=n[e.pckId][c][r];t.resolve(s),delete n[e.pckId]}else t.resolve(e)},promise:t.promise}}};return t}e.module("ringid.connector").service("mergerService",t),t.$inject=["$$q"]}()}(angular,window),function(e,t){"use strict";!function(n){function r(n,r,i,o,a,s,c,l,u,d,g){function m(t){return function(n){if(!n||!n.actn)return!1;if(!e.isArray(t))return n.actn===t;for(var r=0;r<t.length;r++)if(n.actn===t[r])return!0;return!1}}function f(e){if(A[e.pckId]===!0)return!0;if(A[e.pckId]){var t=A[e.pckId].resolve.call(A[e.pckId],e);return t||(A[e.pckId]=!!t,setTimeout(function(){delete A[e.pckId]},3e3)),!0}return!1}function E(t){var n=!1;return C.length()>0&&C.doForAll(function(r){var i,o=r.filter;o?e.isFunction(o)&&(i=o.call(null,t),i&&(n=!0,r.fn.call(r,t))):r.fn.call(null,t)}),n}function p(e){if(e){var t,n;if(e.actn===u.SYSTEM.AUTH.TYPE_INVALID_LOGIN_SESSION)return void E(e);e.hasOwnProperty("pckId")&&(t=f(e)),t||(n=E(e),n||D.push(e))}}function T(){t.onbeforeunload=function(){return RingLogger.print("On before unload connection closed",RingLogger.tags.CONNECTION),i.unloadWarn?"You have unsaved changes.  Do you want to leave this page and lose your changes?":void 0}}function h(e,t,n,r){var i;return i=e.pckId||c.getUniqueID(),e.pckId=i,RingLogger.print(e,"SEND"),n&&(A[i]=n),e?RingWorker.send(e,i,t,r):void 0}function _(e,t,n,r){var i,o=n?g.defer():l.defer();return i=h(e,t,o,r),o.promise}var I,A=(r.getCookie("sessionID"),r.getCookie("uId"),{}),v=!1,S=(Date.now(),!1),C=a.createNew(),D=[],N=a.createNew();return I={init:T,close:function(){RingLogger.alert("connection close request please see condition",RingLogger.tags.CONNECTION)},send:function(e,t,n){h(e,t,!1,n)},request:function(e,t,n){return _(e,t,!1,n)},pull:function(e,t,n){return _(e,t,!0,n)},subscribe:function(t,n){var r,o,a=[];if(n=n||{},n.key=n.key||c.getUniqueID(),n.scope=n.scope||i,n.autoApply=!1,n.fn=t||e.noop,!n.filter&&n.action&&(n.filter=m(n.action)),C.add(n.key,n),n.callWithUnresolved){for(r=0;r<D.length;r++)o=n.filter.call(null,D[r]),o?n.fn.call(null,D[r]):a.push(D[r]);D.length=0,D=a}return n.key},unsubscribe:function(e){C.remove(e)},stop:function(){v=!0},resume:function(){v=!1},reset:function(){},addInterval:function(e){var t=c.getUniqueID();return N.add(t,e),t},removeInterval:function(e){N.remove(e)},keepAlive:function(){S=!0,RingWorker.pushMessage({command:"KEEPALIVE",aSkey:r.getCookie("sId"),uKey:r.getCookie("uId")})},notifyRouteChange:function(){RingWorker.pushMessage({command:"ROUTE_CHANGE"})}},i.$on("ringInactive",function(e){}),i.$on("$locationChangeStart",function(e){}),RingWorker.addCallback("received",function(e){p(e.data)}),RingWorker.addCallback("event",function(e){e.name&&i.$broadcast(e.name)}),I}e.module("ringid.connector").factory("$$connector",r),r.$inject=["settings","Storage","$rootScope","$websocket","$$stackedMap","ATTRIBUTE_CODES","Utils","$$q","OPERATION_TYPES","CLIENT_DATA_SIZE","mergerService"]}(DataView)}(angular,window),function(e,t){"use strict";e.module("ringid.global_services",["ringid.config","ringid.connector","ringid.utils","ui-notification"])}(angular,window),function(e,t){"use strict";e.module("ringid.global_services").factory("$$userMap",["settings","$$stackedMap","$filter","Utils","Storage","Contacts","$$q","Api",function(t,n,r,i,o,a,s,c){function l(e,t,n,r){this.groups={},this.updateUserObj(e),this.isCurrent=n,this.isProfile=t,this.requestedMutualFriend=!1,this.loading=!1,this.user.psnc=this.isCurrent?2:this.user.psnc,this.user.dvc=this.isCurrent?5:this.user.dvc,e.hasOwnProperty("grpId")&&(this.groups[e.grpId]=e.admin);var i=!0;"fetchDetails"in e&&!e.fetchDetails&&(i=!1),e=null,!i||this.user.prIm&&this.user.uId&&this.user.utId&&(this.user.nmf||!r)||this.requestUserDetails(!!r)}var u={0:"p",1:"desktop",2:"android",3:"iphone",4:"windows",5:"web"},d={fn:"",uId:0,cnty:"",el:"",gr:"",am:"",mblDc:"",mbl:"",prIm:"images/prof.png",cIm:"images/default_cover.jpg",prImId:0,cImId:0,cimX:0,cimY:0,bDay:"",blc:0,re:"",utId:0,tf:0,nmf:0,chta:0,cla:0,fda:0,cc:"",hc:"",adt:0,iev:0,imnv:0,isnp:0,psnc:0,lot:0,mood:0,apt:0,dt:"",frnS:0,ct:0,nct:0,pimX:0,pimY:0,bv:0,owner:0,basicInfo:!1,privacyInfo:{}};return l.prototype={updateUserObj:function(t){t=t||{},this.user?e.extend(this.user,t):this.user=e.extend({},d,t),t.grpId&&(this.groups[t.grpId]=t.admin),""===this.user.prIm&&(this.user.prIm="images/prof.png"),""===this.user.cIm&&(this.user.cIm="images/default_cover.jpg"),0===this.user.frnS&&(this.user.frnS=a.getFrns(this.user.utId).frnS||this.user.frnS),t.mfc&&(this.user.nmf=t.mfc),t.mutualFriends&&(this.user.nmf=t.mutualFriends),this.user.uId=this.user.uId.toString(),this.user.utId=this.user.utId.toString(),t=null},fetchPresence:function(){var e=this;c.user.fetchUserPresence([this.user.uId]).then(function(t){e.updateUserObj(t)})},requestUserDetails:function(e){var t,n={},r=this;return this.user.utId&&"0"!=this.user.utId?n.utId=this.user.utId:this.user.uId&&(n.uId=this.user.uId),n.utId||n.uId?(e&&(this.requestedMutualFriend=!0),t=c.user.getUserDetails(n,!!e,this.user.isnp),t.then(function(e){e.sucs&&r.updateUserObj(e.userDetails)}),t):void 0},getName:function(){return this.user.fn},getCardTemplate:function(){return this.user.isnp?"pages/partials/hovercards/portal-profile-hover.html":"pages/partials/hovercards/profile-hover.html"},avatar:function(e){var n=this.user.prIm||"";if("iurl"===e)return n;if("original"===e)return t.imBase+n;if(n.indexOf("prof.png")>0)return n;n=n.replace("profileimages/",""),"original"===e?e="":e||(e="crp"),e=(/\/uploaded\//.test(n)?"":"p")+e;var r=n.lastIndexOf("/")+1;return n=[t.imBase,n.slice(0,r),e,n.slice(r)].join(""),n.indexOf("prof.png")>0?this.user.prIm:n},getKey:function(){return this.user.uId||this.user.utId},getUId:function(){return this.user.uId},setUid:function(e){this.user.uId=e},getUtId:function(){return+this.user.utId},equals:function(t,n){return n||(n="uId"),e.isObject(t)&&(t="uId"===n?t.getKey():t.getUtId()),this.user[n]==t},link:function(){return this.user.isnp?"#/newsportal/"+this.user.uId:this.user.uId||3!==this.user.ct?t.baseUrl+i.getRingRoute("USER_PROFILE",{uId:this.user.uId,utId:this.user.utId})+(1===this.user.frnS||this.isCurrent?"":"/about"):""},getRingNumber:function(){return this.user.uId.replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")},navActiveLink:function(){if(this.user.uId||this.user.utId){var e="/profile/"+this.user.uId+"/post";return e}return""},toString:function(){return this.user.uId},friendshipStatus:function(){return 0===this.user.frnS?a.getFrns(this.user.utId).frnS||this.user.frnS:this.user.frnS},isLoading:function(e){return"undefined"==typeof e?this.user.loading:(this.user.loading=e,this.user.loading)},commonFriends:function(e,t){var n;return(!this.user.nmf&&!this.requestedMutualFriend||e)&&(n=this.requestUserDetails(!0)),t?n||s.when(this.user.nmf):this.user.nmf},isCurrentUser:function(){return this.isCurrent},sortBy:function(){return this.user.adt},getLiteUser:function(){return this},isAdmin:function(e){return this.groups.hasOwnProperty(e)?this.groups[e]:!1},setGroupAdmin:function(e){this.groups[e]=!0},removeGroupAdmin:function(e){delete this.groups[e]},overwriteInfo:function(e){this.user.prIm=e.prIm||this.user.prIm},haveProfileData:function(){return this.isProfile},getBasicInfo:function(){var e=i.profileVerbalDate(this.user.bDay),t=i.profileVerbalDate(this.user.mDay);return{fn:this.user.fn||"",birthDay:this.user.bDay||"",mDay:this.user.mDay||"",birthday:e,marriageDay:t,el:this.user.el||"",hc:this.user.hc.trim()||"",cc:this.user.cc.trim()||"",gr:this.user.gr||"",am:this.user.am.trim()||"",uId:this.user.uId.toString().substring(2)||""}},resetCover:function(){0!==this.user.cImId&&(this.user.cImId=0,c.user.removeCover(this.user.cIm)),this.user.cIm="images/default_cover.jpg"},getCover:function(e){var n,r,i=this.user.cIm;return"iurl"===e?i:e&&"original"===e?t.imBase+i:i?i.indexOf("default")>0?i:i.indexOf("web")>0?t.imBase+i:(n=(/\/uploaded\//.test(i)?"":"p")+(e||"crp"),r=i.lastIndexOf("/")+1,i=[t.imBase,i.slice(0,r),n,i.slice(r)].join("")):"images/default_cover.jpg"},getCoverXY:function(){return{x:this.user.cimX,y:this.user.cimY}},setCover:function(e){this.user.cIm=e.iurl,this.user.cimX=e.cimX,this.user.cimY=e.cimY,this.user.cImId=e.cImId},getAvatarXY:function(){return{x:this.user.pimX,y:this.user.pimY}},setProfileImage:function(e,t){this.user.prIm=e,this.user.prImId=t},setName:function(e){this.user.fn=e},setAboutMe:function(e){this.user.am=e},setHomeCity:function(e){this.user.hc=e},setCurrentCity:function(e){this.user.cc=e},setGender:function(e){this.user.gr=e},setBirthday:function(e){this.user.bDay=e},setMarriageday:function(e){this.user.mDay=e},getEmail:function(){return this.user.el},getMobileDc:function(){return this.user.mblDc},getMobileNumber:function(){return this.user.mbl},getCountry:function(){return this.user.cnty},friendType:function(){return this.user.ct},setFriendType:function(e){this.user.ct=e},newFriendType:function(){return this.user.nct},getLink:function(e){var t="";if(e)for(var n in e)e.hasOwnProperty(n)&&(t+=n+'="'+e[n]+'" ');return"<a "+t+' href="'+this.link()+'">'+this.user.fn+"</a>"},resetAvatar:function(){0!==this.user.prImId&&(this.user.prImId=0,c.user.removeAvatar(this.user.prIm)),this.user.prIm="images/prof.png"},avatarXY:function(){return{x:this.user.pimX,y:this.user.pimY}},getBday:function(){return this.user.bDay},getUserMood:function(){return this.user.mood},setUserMood:function(e){this.user.mood=e},getAppType:function(){return this.user.apt},setAppType:function(e){this.user.apt=e},getDeviceToken:function(){return this.user.dt},setDeviceToken:function(e){this.user.dt=e},isBlocked:function(){return 0===this.user.cla&&0===this.user.chta&&0===this.user.fda?this.user.bv=1:this.user.bv=0,this.user.bv},setBlock:function(e){var t;t=1===e?0:1,this.user.cla=t,this.user.chta=t,this.user.fda=t,this.user.bv=e},isFriend:function(){return 1===this.user.frnS},unFriend:function(){this.user.frnS=0},getAccess:function(){return{chta:this.user.chta,cla:this.user.cla,fda:this.user.fda}},canChat:function(){return 1===this.user.chta},canSeeFeed:function(){return 1===this.user.fda},setOnlineStatus:function(e){this.user.psnc=e},getOnlineStatus:function(){return this.user.psnc},isOnline:function(){return 2===this.user.psnc&&1===this.user.mood},onlineDevice:function(){return u[this.user.dvc]},getPlatform:function(){return this.user.dvc},setPlatform:function(e){this.user.dvc=e},lastOnline:function(){return 0===this.user.lot?!1:i.verbalDate(this.user.lot)},getProfileImageId:function(){return this.user.prImId},getCoverImageId:function(){return this.user.cImId},isEmailVerified:function(){return this.user.iev},isMobileVerified:function(){return this.user.iev},isNewsPortalUser:function(){return this.user.isnp},toggleMood:function(e){this.user.mood=e?1:2,c.user.changeMood(this.user.mood).then(function(e){e.sucs!==!0&&(this.user.mood=e.mood)})},hasDetails:function(){return!!(this.user.prIm&&this.user.uId&&this.user.utId&&this.user.fn)}},function(e,t,n,r,i){return new l(e,t,n,r,i)}}]).factory("userFactory",["$$userMap","$$stackedMap",function(t,n){var r=n.createNew(),i={},o="ru_",a={getSortIndex:function(){return"adt"},create:function(n,a,s){a=!!a,s=!!s;var c,l;return e.isObject(n)?n.uId?(n.uId=n.uId.toString(),c=n.uId,c=o+c,l=r.get(c)):n.utId?(n.utId=n.utId.toString(),l=i[n.utId],l||(l=!1)):l=!1:(c=o+n,l=r.get(c)),l===!1?n.utId&&i[n.utId]?(l=i[n.utId],c=o+n.uId,r.save(c,l),l.updateUserObj(n)):(l=t(n,a,s),l.getUtId()&&(i[l.getUtId()]=l)):l.updateUserObj(n),r.save(c,l),l},createByUtId:function(e,n,r){return i[e.utId]||(i[e.utId]=t(e,!1,!1,r)),n?i[e.utId].getLiteUser():i[e.utId]},createByUId:function(e,t){var n={uId:e,fetchDatails:!1},r=a.create(n);return r.hasDetails()?t&&t({fetchedDetails:!1}):r.requestUserDetails().then(function(e){var n={sucs:e.sucs,fetchedDetails:!0,rc:e.rc};t&&t(n)}),r},getUser:function(e){return e=o+e,r.get(e)},getByUtId:function(e){return e&&i[e]||!1},getAllUtIds:function(){return Object.keys(i)},getUIdByUtId:function(e){return i[e]&&i[e].getUId()},getUtIdByUId:function(e){var t;try{t=a.getUser(e)}catch(n){}return t&&t.getUtId()}};return a}])}(angular,window),function(e,t){"use strict";function n(e,t){var n=this,r={},i={},o={},a=!1;n.register=function(e,o,a,s){if("undefined"==typeof s&&(s=!0),!e)return void RingLogger.alert("Invalid uId in `userService` ",e,"GENERAL");var c=arguments,l=n;r[e]||(r[e]=[]);var u=t.getUniqueID("us");return i[u]=function(){o.call(a,c),s&&l.unregister(u)},r[e].push(u),n.start(),u},n.trigger=function(e){if(r[e]){var t=[];r[e].forEach(function(e){i[e]&&(i[e].call(null),i[e]&&t.push(e))}),r[e]=t}},n.unregister=function(e){i[e]&&delete i[e]},n.fetchUser=function(t){o[t]||(o[t]=!0,e.createByUId(t,function(e){delete o[t],n.start()}),n.start())},n.start=function(){a||(a=!0,setTimeout(function(){for(var t=Object.keys(r),i=0;i<t.length;i++){var o=t[i],s=e.getUser(o);s&&s.hasDetails()?n.trigger(o):n.fetchUser(o)}a=!1}))}}e.module("ringid.global_services").service("userService",n),n.$inject=["userFactory","Utils"]}(angular,window),function(e,t){"use strict";function n(t,n,r,i){function o(e){return n.request({actn:f.PROFILE.TYPE_ACTION_USER_MOOD,mood:e},E.AUTHENTICATION)}function a(t,r,i){var o={actn:f.PROFILE.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!r};return i&&(o.pType=3),e.extend(o,t),n.request(o,E.REQUEST,!0)}function s(e){return n.pull({actn:f.PROFILE.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:e.getUId()},E.REQUEST)}function c(e){var t={actn:f.PROFILE.ACTION_USERS_PRESENCE_DETAILS,uIds:e};return n.request(t,E.REQUEST)}function l(){return i.get(r.baseUrl+"/resources/countries.json")}function u(e){var t={actn:f.MEDIA.ACTION_MEDIA_CONTENT_DETAILS,cntntId:e.cntntId,utId:e.utId};return n.request(t,E.REQUEST)}function d(e){var t={actn:f.PROFILE.TYPE_REMOVE_PROFILE_IMAGE,prIm:e};return n.request(t,E.UPDATE)}function g(e){var t={actn:f.PROFILE.TYPE_REMOVE_COVER_IMAGE,cIm:e};return n.request(t,E.UPDATE)}function m(e){return n.request({actn:f.PROFILE.SEND_VERIFICATION_CODE_TO_PHONE,mbl:e.mbl,mblDc:e.mblDc,pkd:!0},E.REQUEST)}var f=t.SYSTEM,E=t.SYSTEM.REQUEST_TYPE;return{fetchCountryList:l,user:{changeMood:o,getUserDetails:a,getMutualFriends:s,fetchUserPresence:c,removeAvatar:d,removeCover:g,verifyPhoneNo:m},media:{fetchDetails:u}}}e.module("ringid.global_services").factory("Api",n),n.$inject=["OPERATION_TYPES","$$connector","settings","$ringhttp"]}(angular,window),function(e,t){"use strict";function n(n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){function T(){var e=n,t=r,i=t[0].documentElement,o=t[0].getElementsByTagName("body")[0];return Z.x=e.innerWidth||i.clientWidth||o.clientWidth,Z.y=e.innerHeight||i.clientHeight||o.clientHeight,Z.yo=e.pageYOffset,Z}function h(e,t,n,r){var i=1;return(e>n||t>r)&&(i=Math.min(n/e,r/t)),{width:e*i,height:t*i}}function _(e,t){return oe(e,t)}function I(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0),n.data=t,document.dispatchEvent(n)}function A(e,t){var n=function(e){t.call(this,e.data)};return document.addEventListener(e,n),n}function v(e,t){document.removeEventListener(e,t)}function S(e){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function C(){var e=(new Date).getTime();t.performance&&"function"==typeof t.performance.now&&(e+=performance.now());var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return n}function D(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return n===r&&(r=t.clientWidth),document.body.removeChild(t),e=t=null,n-r}function N(e,t){if(!i[e])return"";var n,r=i[e];switch(e){case"HOME":case"FAQ":break;case"SINGLE_FEED":t.feedId&&(r=r.replace(":feedId",t.feedId));var o=t.shared?"shared":"";r=r.replace(":shared?",o),o?(n=t.commentId||0,r=r.replace(":commentId?",n)):(n=t.commentId||"",r=r.replace(":commentId?/",n));break;case"WHO_SHARED_FEED":t.feedId&&(r=r.replace(":feedId",t.feedId)),n=t.commentId||"",r=r.replace(":commentId?",n);break;case"SINGLE_IMAGE":t.imageId&&(r=r.replace(":imageId",t.imageId)),n=t.commentId||"",r=r.replace(":commentId?",n);break;case"SINGLE_MEDIA":t.mediaId&&(r=r.replace(":mediaId",t.mediaId)),n=t.commentId||"",r=r.replace(":commentId?",n);break;case"USER_PROFILE":t.uId?r=r.replace(":uId",t.uId):(RingLogger.print(t,RingLogger.tags.PROFILE),RingLogger.print("Invalid Route Params Provided",RingLogger.tags.PROFILE)),r=t.utId?r.replace(":utId",t.utId):r.replace("/:utId",""),r=t.albumId?r.replace(":albumId?",t.albumId):r.replace("/:albumId?","");break;case"CIRCLE_HOME":t.circleId&&(r=r.replace(":circleId",t.circleId))}return r=t.subpage?r.replace(":subpage?",t.subpage):r.replace("/:subpage?",""),"/#"+r}function M(e){return o("date")(e,"yyyy-MM-dd")}function R(e){var t=e.split(","),n=new Uint8Array(t);return n.buffer}function y(e){var t=new Uint8Array(e);return Array.prototype.join.call(t,",")}function O(e){var t=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return e?t.test(e)||Q.test(e):!1}function b(e,t){var r,i,a,s=n.Math,c=new Date;if(t=t||Date.now(),isNaN(e)?(r=new Date((e||"").replace(/-/g,"/").replace(/[TZ]/g," ")),e=r.getTime()):r=new Date(e),i=(t-e)/1e3,a=s.floor(i/86400),isNaN(a))return"";switch(!0){case 1>a:switch(!0){case 60>i:return"just now";case 120>i:return"1 minute ago";case 3600>i:return s.floor(i/60)+" minutes ago";case 7200>i:return"1 hour ago";case 86400>i:return s.floor(i/3600)+" hours ago";default:return o("date")(e,"MMM d, h:mm a")}break;case 1===a:return"yesterday at "+o("date")(e,"h:mm a");case 7>a:return o("date")(e,"EEEE 'at' h:mm a");case 365>a:return c.getUTCFullYear()===r.getUTCFullYear()?o("date")(e,"MMMM d 'at' h:mm a"):o("date")(e,"MMMM d yyyy 'at' h:mm a");default:return o("date")(e,"MMM d, yyyy")}}function P(){Z||T();var e=Z.x;return 1280>e?1:e>=1280&&1800>=e?2:e>1800?3:void 0}function L(e,t,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||e.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}}function U(e){var n,r,i,o=";base64,";if(-1===e.indexOf(o))return n=e.split(","),r=n[0].split(":")[1],i=decodeURIComponent(n[1]),new Blob([i],{type:r});n=e.split(o),r=n[0].split(":")[1],i=t.atob(n[1]);for(var a=new Uint8Array(i.length),s=0;s<i.length;++s)a[s]=i.charCodeAt(s);return new Blob([a],{type:r})}function w(e){return o("date")(e,"h:mm a")}function F(e){var t=l.defer(),n=t.promise,r=u.getData("uLocationInfo");return r&&r.lat?(r.sucs=!0,n=r):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var r=n.coords.latitude,i=n.coords.longitude,o={lat:r,lng:i};if(e){var a=new google.maps.Geocoder;a.geocode({location:o},function(e,n){n===google.maps.GeocoderStatus.OK?(u.setData("uLocationInfo",{lat:r,lng:i,description:e[1].formatted_address}),t.resolve({sucs:!0,lat:r,lng:i,description:e[1].formatted_address})):(u.setData("uLocationInfo",{lat:r,lng:i}),t.resolve({sucs:!0,lat:r,lng:i}))})}else u.setData("uLocationInfo",{lat:r,lng:i}),t.resolve({sucs:!0,lat:r,lng:i})},function(e){t.resolve({sucs:!1,error:e})}),l.when(n)}function k(){return document.title}function $(e,t){document.title=e,t&&d.$broadcast("PAGE_TITLE_CHANGE",{title:e})}function G(e){return e.mg?e.mg:H(e.rc)}function H(e){return g["RC"+e]?g["RC"+e]:""}function B(){var e=P(),t=parseInt(u.getCookie("col"));return!t||t>e?e=e>2?2:e:t}function x(){J=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,ee=0,te=-1*J}function Y(){ee+=25;var e=Math.easeIn(ee,J,te,ce);document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e,ce>ee&&requestAnimationFrame(Y)}function K(e){return E.get(p.ogServiceUrl+"?url="+encodeURIComponent(e))}function j(e){var t=l.defer(),n=new Image;return n.onload=function(){t.resolve({imgUrl:this.src,width:this.width,height:this.height})},n.src=e,setTimeout(function(){t.resolve({width:0,height:0})},3e4),t.promise}function V(t,n){var r=l.defer(),i=[];return n.width||(n.width=0),n.height||(n.height=0),e.forEach(t,function(e){setTimeout(function(){j(e).then(function(e){var o,a;e.width&&e.width>=n.width&&(o=!0),e.height&&e.height>=n.height&&(a=!0),o&&a&&(i.push(e.imgUrl),i.length==t.length?r.resolve(e.imgUrl):r.notify(e.imgUrl))})})}),setTimeout(function(){0==i.length&&r.resolve([])},2e4),r.promise}function W(e){u.setCookie("col",parseInt(e))}function q(e){requestAnimationFrame(function(){T(),d.windowHeight=Z.y,d.windowWidth=Z.x,d.$broadcast(m.COMMON.WINDOW_RESIZED,Z)}),e.preventDefault()}var z=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,Q=s.getEmoticonPattern(),X=c.getEmoticonMap(),Z={x:0,y:0,yo:0};T();var J,ee,te,ne=function(e){return e||(e=""),e+(t._cti||"")+n.Math.floor(n.Math.random()*(new n.Date).getTime())},re=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},ie=function(e){return/^(f|ht)tps?:\/\//i.test(e)||(e="http://"+e),e},oe=function(e,n){e=re(e);var r=e,i=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return n||(n=0),"blob:http"===r.substring(0,9)&&(r='<img width="100%" src="'+r+'" />',n=2),0===n&&(r=r.replace(z,function(e){var t=ie(e);return'<a class="feedanchor" target="_blank" href="'+t+'">'+e+"</a>"})),r=r.replace(Q,function(e){return'<span class="em_list '+X[e].replace(/\.[A-Za-z]{3}/,"")+'" data-link="'+e+'" title="'+e+'">&nbsp;</span>'}),t.emojiSupported||(r=r.replace(i,function(e){var t,n,r;return t=e.charCodeAt(0),n=e.charCodeAt(1),r=(1024*(t-55296)+(n-56320)+65536).toString(16),'<u class="emo_list U_'+r+'"></u>'})),1===n&&(r=e),r},ae=function(e,t,n){n||(n="({0},{1})".format(e,t));var r="https://maps.googleapis.com/maps/api/staticmap?center={0},{1}&zoom=18&size=640x170&key={3}&markers=color:orange|label:A|{2}|{0},{1}";return r=r.format(e,t,n,a.GOOGLE_MAP_KEY)},se=function(e,t,n,r){var i;return i=e&&t?"https://maps.google.com/maps?q={0},{1}&hl=en;z=18;iwd=1".format(e,t):"http://maps.google.com?q={0}".format(n),r&&(i+="&output=embed"),i},ce=500;return f.bindHandler("window","resize",q),f.bindHandler("window","scroll",q),{generateUUID:C,tabId:t._cti,viewport:Z,viewportsize:T,scrollbarWidth:D(),getUniqueID:ne,triggerCustomEvent:I,onCustomEvent:A,removeCustomEvent:v,getRingRoute:N,profileVerbalDate:M,verbalDate:b,getScaledImageSize:h,debounce:L,dataURLToBlob:U,string2ArrayBuffer:R,arrayBuffer2String:y,safeDigest:S,chatVerbalDate:w,parseForLE:_,getGoogleMapJSUrl:se,getGoogleMapStaticUrl:ae,hasEmoticon:O,getUserLocation:F,getCurrentPageTitle:k,setPageTitle:$,getReasoneMessage:H,getReasonMessageFromResponse:G,getDefaultColumn:P,feedColumn:B,animateScroll:Y,resetScroll:x,getOGDetails:K,filterImagesByDimentions:V,setFeedColumn:W}}e.module("ringid.global_services").factory("Utils",n),n.$inject=["$window","$document","RING_ROUTES","$filter","APP_CONSTANTS","StickerEmoticonFactory","StickerEmoticonService","$q","Storage","$rootScope","MESSAGES","SystemEvents","GlobalEvents","$ringhttp","settings"]}(angular,window),function(e,t){"use strict";function n(e,t){function n(n,a,s,c,l){var u=!1,d=0,g={success:function(){},error:function(){},abort:function(){},progress:function(){}},m=a;a=/^(http|https):\/\//.test(a)?a:e.baseUrl+(0===a.indexOf("/")?a:"/"+a);var f={success:function(e){return g.success=e,f},error:function(e){return g.error=e,f},abort:function(e){return g.abort=e,f},progress:function(e){return g.progress=e,f},abortRequest:function(){E.abort()}};try{var E=new XMLHttpRequest;u="GET"===n&&/\.html$/.test(a),u&&i.hasOwnProperty(m)?i[m].push(g):u&&t.get(m)?setTimeout(function(){g.success.apply(g,[t.get(m),E])}):(u&&(a=a+"?time="+r,i[m]=[],i[m].push(g)),E.open(n,a,!0),E.responseType=c||"text",E.onreadystatechange=function(){var e;4===E.readyState&&(200===E.status?(e=o(E),u?(t.put(m,e[0]),i[m].forEach(function(e){e.success.apply(e,[t.get(m),E])}),delete i[m]):(g.progress.apply(g,[100]),g.success.apply(g,e))):g.error.apply(g,e))},E.upload.onabort=function(){g.abort.apply(g)},E.upload.onprogress=function(e){d=Math.round(e.loaded/e.total*100),d=d>0?d-1:d,g.progress.apply(g,[d])},E.send(s))}catch(p){}return f}var r=(new Date).getTime(),i={},o=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.response}return[t,e]};return{get:function(e,t,r){return n("GET",e,t,r)},post:function(e,t,r){return n("POST",e,t,r)}}}e.module("ringid.global_services").factory("$ringhttp",n),n.$inject=["settings","$templateCache"]}(angular,window),function(e,t){"use strict";function n(){function e(e){if(3!==e.which&&0!==n[e.type].length)for(var t=0,r=n[e.type].length;r>t;t++)n[e.type][t].call(null,e)}var n={};return{bindHandler:function(r,i,o){if(n.hasOwnProperty(i)||(n[i]=[]),n[i].push(o),1===n[i].length)switch(r){case"document":document.addEventListener(i,e);break;case"window":t.addEventListener(i,e);break;default:document.addEventListener(i,e)}},unbindHandler:function(r,i,o){setTimeout(function(){if(n[i].splice(n[i].indexOf(o),1),0===n[i].length)switch(r){case"document":document.removeEventListener(i,e);break;case"window":t.removeEventListener(i,e);break;default:document.removeEventListener(i,e)}})}}}e.module("ringid.global_services").factory("GlobalEvents",n)}(angular,window),function(e,t){"use strict";function n(t,n,r){var i={delay:3e3,positionX:"right",positionY:"top",replaceMessage:!0},o={title:"Warning",message:"Click ok to continue",showOk:!0,showCancel:!0,craac:!1,textOk:"OK",textCancel:"Cancel",okCallback:e.noop,cencelCallback:e.noop};return{show:function(t,o){o=o||"info",e.isString(t)&&(t={message:t}),t.message=t.message||t.mg,t.message||("success"===o?t.message=r.REQUEST_PROCESSED:"error"===o&&(t.message=r.REQUEST_FAILED));try{n[o](e.extend({},i,t))}catch(a){console.info(t.message)}},clear:function(){n.clearAll()},alert:function(n){n=n||{},n=e.extend({},o,n);var r=t.open({type:"remote",scope:!1,scopeData:n,templateUrl:n.templateUrl||"templates/popups/ring-alert.html"});r.result.then(function(t){var r="string"==typeof t?t:t.sucs;"ok"===r&&e.isFunction(n.okCallback)?n.okCallback.call(null,t):n.cencelCallback.call(null,t)})}}}e.module("ringid.global_services").factory("Ringalert",n),n.$inject=["$ringbox","Notification","MESSAGES"]}(angular,window),function(e,t){"use strict";e.module("ringid.global_services").factory("$$stackedMap",function(){return{createNew:function(t,n){function r(e){e=e||"sortBy";var t=-1,r=1;"desc"===n&&(t=1,r=-1),s.sort(function(n,i){return i.value[e]()>n.value[e]()?t:n.value[e]()>i.value[e]()?r:0})}function i(e){for(var t=0;t<s.length;t++)if(e==s[t].key)return t;return-1}function o(e){var t=i(e);return-1===t||t===s.length-1?!1:s[t+1].value}function a(e){var t=i(e);return-1===t||0===t?!1:s[t-1].value}var s=[],c=this;t=t||!1,n=n||"desc";var l={concat:function(e){s=s.concat(e)},reset:function(){s=[]},all:function(){return s},setStack:function(e){s=e},add:function(e,n){return s.push({key:e,value:n}),t!==!1&&r(),!1},next:function(e){return o(e)},previous:function(e){return a(e)},getByIndex:function(e,t){return s.length&&(e>=0||e<s.length)?t?s[e]:s[e].value:!1},getIndex:function(e){return i(e)},get:function(e){var t=i(e);return t>=0?s[t].value:!1},save:function(e,n){var o;o=i(e),-1===o?l.add(e,n):s[o]={key:e,value:n},t!==!1&&r()},sort:function(e,t){e&&(n=e),r(t)},keys:function(){for(var e=[],t=0;t<s.length;t++)e.push(s[t].key);return e},values:function(){for(var e=[],t=0;t<s.length;t++)e.push(s[t].value);return e},top:function(e){return s.length?(e=!!e,e?s[s.length-1]:s[s.length-1].value):!1},bottom:function(e){return s.length?(e=!!e,e?s[0]:s[0].value):!1},sliceBy:function(e,t){return t||(t=0),(e>s.length||!e)&&(e=s.length),s.slice(t,e)},remove:function(e){var t=i(e);return t>-1?(s.splice(t,1),!0):!1},removeTop:function(){return s.splice(s.length-1,1)[0]},length:function(){return s.length},nonClosedLength:function(){var t=0;return e.forEach(s,function(e,n){t+=e.closedBox?1:0}),t},copy:function(){for(var e=c.createNew(t,n),r=0;r<s.length;r++)e.add(s[r].key,s[r].value);return e},doForAll:function(e){for(var t=0;t<s.length;t++)e.call(null,s[t].value)}};return l}}})}(angular,window),function(e,t){"use strict";function n(n,r,i,o,a,s,c,l,u,d,g,m,f,E){function p(e,t,n){var r={};switch(e){case"fetchRecoverOptions":r.actn=U.PASSWORD_RECOVER_OPTIONS,r.did=x,r.rb=t.mblDc+t.mbl,r.mbl=t.mbl,r.mblDc=t.mblDc,r.vsn=c.apiVersion,r.wk=o.getUniqueID(),r.lt=2;break;case"recoveryVerifyCode":r.actn=U.PASSWORD_RECOVER_VERIFY_CODE,r.uId=t.uId,r.vc=t.vc,r.wk=o.getUniqueID(),r.lt=1;break;case"recoverySendCode":r.actn=U.PASSWORD_RECOVER_SEND_CODE,r.wk=o.getUniqueID(),n?(r.lt=2,r.rb=t.mblDc+t.mbl,r.mbl=t.mbl,r.mblDc=t.mblDc):(r.lt=3,r.rb=t.email,r.el=t.email.utf8Encode());break;case"resetPassword":r.actn=U.PASSWORD_RECOVER,r.uId=t.uId,r.nPw=t.password,r.wk=o.getUniqueID(),r.lt=1;break;case"isValidSession":r.actn=U.TYPE_SESSION_VALIDATION,r.dvcc=5,r.utId=B,r.did=x;break;case"logout":r.actn=U.TYPE_SIGN_OUT;break;case"validSocialId":var i="facebook"===t.platform?c.signupSocialInit+"fb="+t.id+"&lt=4":c.signupSocialInit+"twtr="+t.id+"&lt=5";r=i+"&time="+(new Date).getTime();break;case"signupSendCode":r.wk=o.getUniqueID(),r.uId=t.uId,r.did=t.did,r.lt=1,"email"===t.authMethod?(r.el=t.email.utf8Encode(),r.actn=U.SIGNUP_SEND_CODE_EMAIL):(r.actn=U.SIGNUP_SEND_CODE_PHONE,r.mbl=t.mbl,r.mblDc=t.mblDc);break;case"signupVerifyCode":r.wk=o.getUniqueID(),r.uId=t.uId,r.did=t.did,r.lt=1,"email"===t.authMethod?(r.actn=U.SIGNUP_SEND_CODE_EMAIL,r.el=t.email.utf8Encode(),r.evc=t.vc):(r.actn=U.SIGNUP_SEND_CODE_PHONE,r.mbl=t.mbl,r.mblDc=t.mblDc,r.vc=t.vc);break;case"signup":switch(r.actn=U.SIGNUP_REGISTER,
r.wk=o.getUniqueID(),r.uId=t.uId,r.did=t.did,r.nm=t.name.utf8Encode(),r.usrPw=t.password,r.lt=1,r.ispc=0,r.mbl=t.mbl,r.mblDc=t.mblDc,t.authMethod){case"email":r.el=t.email.utf8Encode(),r.evc=t.vc;break;case"facebook":r.fb=t.id,r.it=t.access_token,r.lt=4;break;case"twitter":r.twtr=t.id,r.it=t.access_token,r.lt=5;break;default:r.mbl=t.mbl,r.mblDc=t.mblDc,r.vc=t.vc}break;case"login":if(t.hasOwnProperty("silent")&&t.silent===!0)return r.actn=U.TYPE_SIGN_IN,r.vsn=c.apiVersion,r.wk=o.getUniqueID(),r.dvc=5,r.tbid=o.tabId,r;switch(r.actn=U.TYPE_SIGN_IN,r.vsn=c.apiVersion,r.usrPw=t.password,r.lt=1,r.sn=c.apiVersion,r.wk=o.getUniqueID(),r.dvc=5,r.tbid=o.tabId,r.did=t.did,t.authMethod){case"ringid":r.lt=1,r.uId=t.silent?t.ringid:"21"+t.ringid;break;case"email":r.lt=3,r.el=t.email.utf8Encode();break;case"facebook":r.uId=t.uId,r.pen=1,r.lt=4,r.apt=1,r.smid=t.id,r.it=t.access_token,delete r.usrPw;break;case"twitter":r.uId=t.uId,delete r.usrPw,r.smid=t.id,r.it=t.access_token,r.lt=5;break;default:r.lt=2,r.mbl=t.mbl,r.mblDc=t.mblDc}t.salt&&t.sId&&(r.salt=t.salt,r.sId=t.sId);break;default:r=t}return r}function T(e){return W._currentUser=e,e}function h(e){e&&(W.loginData=e,i.setData("loginData",e))}function _(e,t,n){try{var r={usrPw:t.authEPassword,salt:t.authESalt,sId:t.sId,lt:e.lt};switch(e.lt){case 1:r.uId=t.authEUsername;break;case 2:r.mbl=t.authEUsername,r.mblDc=e.mblDc;break;case 3:r.el=t.authEUsername;break;default:RingLogger.warning("REMEMBER ME DATA SAVE FAILED",RingLogger.tags.AUTH)}i.setData("remInfo",r);var o=i.getCookie("sessionID");i.setCookie("sessionID",o,n)}catch(a){RingLogger.warning("FAILED REMEMBER ME",RingLogger.tags.AUTH)}}function I(t,n){var r=a.defer();return s.get(c.signupInit+"did="+x+"&time="+(new Date).getTime()).success(function(i){i.success===!0?(j({uId:i.ringID,authServer:i.authServerIP,comPort:i.comPort}),t=e.extend(t,{uId:i.ringID,did:x}),n?r.resolve(t):m.request(p("signupSendCode",t),w.AUTHENTICATION).then(function(t){r.resolve(e.extend(t,{uId:i.ringID}))},function(e){r.reject(e)})):r.reject(i)}).error(function(){r.reject()}),r.promise}function A(e,t){L=!0,e.did=x,m.request(p("login",e),w.AUTHENTICATION).then(function(n){L=!1,n.sucs===!0?(W._validSession=!0,e.remember?(_(e,n,30),i.setData("remember",!0)):(i.deleteData("remInfo"),i.deleteData("remember")),e.authMethod&&i.setData("activeTab",e.authMethod),R(n,!0),t.resolve(n)):(W._validSession=!1,t.reject(n))},function(n){n.sucs===!1&&1111===n.rc?A(e,t):(W._validSession=!1,L=!1,t.reject({sucs:!1,mg:"Reqeust Failed"}))})}function v(){var e=i.getData("loginData");!e||t.hasOwnProperty("ringLoggedIn")&&!t.ringLoggedIn?M():(RingLogger.information("LOGIN POSSIBLE",RingLogger.tags.AUTH),R(e))}function S(e){switch(RingLogger.print(e,RingLogger.tags.AUTH),e.actn){case U.TYPE_MULTIPLE_SESSION:RingLogger.warning("MULTIPLE SESSION",RingLogger.tags.AUTH),L||(RingLogger.print("multiple session warning",e,RingLogger.tags.AUTH),g.alert({title:"Signed Out!",message:"You are signed in from another device",showCancel:!1,okCallback:function(){M(!0)}}));break;case U.TYPE_INVALID_LOGIN_SESSION:RingLogger.warning("INVALID LOGIN SESSION",RingLogger.tags.auth),L||(O=!0,W.loginFromLocalData());break;case U.TYPE_SESSION_VALIDATION:RingLogger.warning("SESSION VALIDATION",RingLogger.tags.auth),L||(b=!0,W.isLoggedIn()?M(!0):W.loginFromLocalData())}}function C(){return m.request({actn:U.PHN_MAIL_VERIFICATION_CHECK},w.REQUEST)}function D(e){setTimeout(function(){s.get(e)},100)}function N(){0===k.length&&E.fetchCountryList().success(function(e){k=e;var t=i.getData("country");t&&t.country?($.code=t.code,$.flagcode=t.flagcode):s.get(c.baseUrl+"/country").success(function(e){if(e&&e.length>0){e=e.toLowerCase();for(var t=0;t<k.length;t++)if(k[t].country.toLowerCase()===e){$.code=k[t].code,$.flagcode=k[t].flagcode,i.setData("country",k[t]);break}}})})}function M(e){RingLogger.print("LOGIN FAIL. LOGGING OUT",RingLogger.tags.AUTH),T(null),P=!1,W.clearCookies(!0),i.reset(),d.closeAll(),e?V(1):(N(),r.$broadcast(n.AUTH.LOGIN,!1))}function R(e,t){RingLogger.print("LOGIN SUCCESS",RingLogger.tags.AUTH),W.loginData=e,j(e,t?30:!1),T(u.create(e,!0,!0)),i.init(e),N(),setTimeout(function(){q.forEach(D)},2e3),m.resume(),m.keepAlive(),P=!1,r.$broadcast(n.AUTH.LOGIN,!0),setTimeout(function(){C().then(function(e){P=!1,e.sucs===!0?(W._validSession=!0,F=e):(RingLogger.warning("PERMISSION GET REQUEST FAIL",RingLogger.tags.AUTH),W._validSession=!1)},function(){P=!1,RingLogger.warning("User Permission fetch fail",RingLogger.tags.PROFILE)})})}var y=i.getCookie("sessionID"),O=!1,b=!1,P=!0,L=!1,U=l.SYSTEM.AUTH,w=l.SYSTEM.REQUEST_TYPE,F={},k=[],$={code:"+880",flagcode:"b880"},G=i.getCookie("sId"),H=i.getCookie("uId"),B=i.getCookie("utId"),x=o.generateUUID();r.$on("ringActive",function(){Cookies.get("sessionID")!==y&&t.location.reload()});var Y=function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},K=function(e){Y("uId"),Y("utId"),Y("sId"),Y("authServer"),Y("comPort"),Y("la"),Y("col"),e||(Y("sessionID"),y=void 0),Y("la")},j=function(e,t){i.setCookie("uId",e.uId||"",t),i.setCookie("sId",e.sId||"",t),i.setCookie("utId",e.utId||"",t),t&&i.setCookie("la",(new Date).getTime(),t),e.authServer&&i.setCookie("authServer",e.authServer||"",t),e.comPort&&i.setCookie("comPort",e.comPort||"",t)},V=function(e,n){e&&(K(),i.reset()),n?setTimeout(function(){t.location="/?rand="+o.getUniqueID()},e):setTimeout(function(){t.location="/"},e)},W={_currentUser:null,_validSession:!1,isPendingAsync:function(){var e,t=a.defer();return P?e=setInterval(function(){P||(clearInterval(e),W._validSession?t.resolve():t.reject())},1e3):t.resolve(),t.promise},isPending:function(){return P},sendCode:I,updateLocalStorageLoginData:h,verifyCode:function(t){return t=e.extend({},t,{did:x}),m.request(p("signupVerifyCode",t),w.AUTHENTICATION)},signup:function(t){var n=a.defer();return e.extend(t,{did:x}),m.request(p("signup",t),w.AUTHENTICATION).then(function(e){RingLogger.print(e,RingLogger.tags.AUTH),n.resolve(e)},function(){n.reject()}),n.promise},openSignup:function(t,n){var r=a.defer();return s.get(p("socialData")).success(function(i){RingLogger.print(i,RingLogger.tags.AUTH),i.success===!1&&2===i.rc?(d.open({type:"remote",scope:!1,controller:"SignUpController",resolve:{localData:{socialData:t,credentials:n},remoteData:e.noop},templateUrl:"templates/welcome/ring-signup-popup.html"}),r.resolve()):r.reject({rc:"dologin",mg:"Already Registered Social ID"})}).error(function(){r.reject({rc:0,mg:"Request Failed"})}),r.promise},login:function(t,n){var r=a.defer();if(n)e.extend(t,{did:x}),s.get(p("validSocialId",t)).success(function(e){RingLogger.print(e,RingLogger.tags.AUTH),e.success===!0||"true"===e.success?(j({uId:e.ringID,authServer:e.authServerIP,comPort:e.comPort}),t.uId=e.ringID,t.authMethod=t.platform,A(t,r)):r.reject({rc:"invalidsocialid",mg:"Unregistered Social ID. Please Register."})}).error(function(){r.reject({rc:0,mg:"Request Failed"})});else{switch(t.authMethod){case"email":i.setData("autoFill",t.email);break;case"ringid":i.setData("autoFill",t.ringid);break;case"phone":i.setData("autoFill",t.mbl)}A(t,r)}return r.promise},logout:function(e){W.isLoggedIn()&&(r.$broadcast(n.LOADING,!0),m.request(p("logout"),w.AUTHENTICATION).then(function(e){r.$broadcast(n.LOADING,!1),RingLogger.information(e,RingLogger.tags.AUTH),M(!0)})),setTimeout(function(){M(!0)},1e3),m.stop()},clearCookies:function(e){K(e)},loginFromLocalData:function(){var t=i.getData("remInfo");if(!L&&t&&(t.uId||t.el||t.mbl)){RingLogger.information("TRYING REMEMBER ME LOGIN",RingLogger.tags.AUTH);var n={remember:!0,silent:!0};e.extend(n,t),W.login(n).then(function(e){e.sucs?(RingLogger.print("Auto Login Success",RingLogger.tags.AUTH),R(e)):(RingLogger.print("Auto Login Failed",RingLogger.tags.AUTH),M(!0))},function(){M(!0)})}else RingLogger.information("NO REMEMBER ME INFORMATION",RingLogger.tags.AUTH),M(!0)},currentUser:function(){return W._currentUser},isLoggedIn:function(){return!!W._currentUser&&!!i.getCookie("sId")&&!!i.getCookie("sessionID")},isValidSession:function(){var e=a.defer();return B&&G&&H?m.request(p("isValidSession")).then(function(t){RingLogger.print(t,RingLogger.tags.AUTH),t.sucs?(W._validSession=!0,e.resolve(t)):(W._validSession=!1,e.reject(t))},function(){e.reject(W._validSession)}):e.reject(W._validSession),e.promise},reloadHome:V,getCountry:function(){var e=i.getData("country");return e&&e.country&&($.code=e.code,$.flagcode=e.flagcode),$},getCountryList:function(){return k},getPermission:function(){return F},setAchatPermission:function(e){F.ancht=e},setAinfndreqPermission:function(e){F.aifr=e},setAfamPermission:function(e){F.afam=e},setAafPermission:function(e){F.aaf=e},ensureLoginState:v,handleInvalidSession:S,fetchPrivacy:C,fetchRecoverOptions:function(e){return m.request(p("fetchRecoverOptions",e),w.AUTHENTICATION)},recoverySendCode:function(e,t){return m.request(p("recoverySendCode",e,t),w.AUTHENTICATION)},recoveryVerifyCode:function(e){return m.request(p("recoveryVerifyCode",e),w.AUTHENTICATION)},resetPassword:function(e){return m.request(p("resetPassword",e),w.AUTHENTICATION)}},q=["/templates/dropdowns/notification-dropdown.html","/templates/dropdowns/friend-request-dropdown.html","/templates/partials/emoticon-window.html","/templates/dropdowns/circle-list-dropdown.html","/templates/dropdowns/search-dropdown.html","/templates/partials/hovercards/profile-hover.html","/templates/partials/notification/image-popup.html","/templates/partials/notification/media-popup.html","/templates/partials/notification/feed-popup_with_image.html","/templates/partials/stickers/popups/sticker-market.html"];return W}e.module("ringid.global_services").factory("Auth",n),n.$inject=["SystemEvents","$rootScope","Storage","Utils","$q","$ringhttp","settings","OPERATION_TYPES","userFactory","$ringbox","Ringalert","$$connector","$ocLazyLoad","Api"]}(angular,window),function(e,t){"use strict";e.module("ringid.global_services").factory("chatHistoryFactory",["Storage","Auth","userFactory","SystemEvents","Utils",function(t,n,r,i,o){var a=CHAT_APP.Constants.GENERAL_CONSTANTS,s=CHAT_APP.Constants.CHAT_VERSION_INFO,c={},l={},u={},d=0,g=0,m=function(){c=t.getData("chatOpenedBoxes")||{},l=t.getData("chatBoxes")||{}},f=function(){return g},E=function(){g=0},p=function(){var e=t.getData("unreadMessageIds");d=0,g=0,e?Object.keys(e).forEach(function(t,n){u[t]={},e[t].forEach(function(e,n){u[t][e]=!0,d++}),g++}):u={}},T=function(e){e!==!1&&(e=!0);var n={};Object.keys(u).forEach(function(e,t){n[e]=Object.keys(u[e])}),t.setData("unreadMessageIds",n,e),o.triggerCustomEvent(i.CHAT.UNREAD_MESSAGE_INFO_UPDATED)},h=function(){c={},l={},v(!1),S(!1),T(!1),I(s,!1)},_=function(){var n=t.getData("cgInf");n&&n.version&&n.version==s.version||h(),n?e.extend(s,n):I()},I=function(n,r){r!==!1&&(r=!0),n&&e.extend(s,n),t.setData("cgInf",s,r)},A=function(e){e.user||(e.user=r.create(e.user));var t=e.user;try{var t=e.user.getKey()}catch(n){}var i={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:e.secretTimedOut?e.secretTimedOut:!1,user:t};return e.usersToChange&&(i.usersToChange=e.usersToChange),e.statusType&&(i.statusType=e.statusType),i},v=function(e){e!==!1&&(e=!0),t.setData("chatBoxes",l,e)},S=function(e){e!==!1&&(e=!0),t.setData("chatOpenedBoxes",c,e)},C=function(e,t){var e=e.toString();c||(c={}),c[e]||(c[e]={boxId:e,isTagChat:t}),S()},D=function(e,t){if(l[e]){var n=l[e].messages;if(n)for(var r=0,i=n.length;i>r;r++)if(n[r].key==t)return n[r]}return!1},N=function(e,t){u[e]||(u[e]={},o.triggerCustomEvent(i.CHAT.UNREAD_MESSAGE_INFO_UPDATED)),u[e][t]||(u[e][t]=!0,d++),g=Object.keys(u).length},M=function(e,t){u[e]&&u[e][t]&&(delete u[e][t],d--,T())},R=function(e){l[e];if(u[e]){var t=Object.keys(u[e]).length;delete u[e],d-=t,0>d&&(d=0),T(),g=Object.keys(u).length,o.triggerCustomEvent(i.CHAT.UNREAD_MESSAGE_INFO_UPDATED)}},y=function(){return u},O=function(){return d},b=function(e){return u[e]?Object.keys(u[e]).length:0},P=function(){_(),m(),p()},L={init:P,loadChatBoxes:m,loadChatGeneralInfo:_,saveChatGeneralInfo:I,updateChatOpenBoxes:S,updateChatBoxes:v,addUnreadMessageInfo:N,removeUnreadMessageInfo:M,updateUnreadMessageInfos:T,getUnreadMessageInfos:y,getUnreadMessageCount:O,getUnreadConversationCount:f,resetConversationCount:E,getUnreadMessageCountByBoxId:b,removeUnreadMessageInfoByBoxId:R,getMessageByPacketId:D,getChatOpenBoxes:function(){return c},getChatBoxes:function(){return l},addOpenBox:C,removeOpenBox:function(e){c[e]&&delete c[e],S()},countOpenBoxes:function(){return c?Object.keys(c).length:0},getAllOpenBoxes:function(){return c&&Object.keys(c).length>0?c:!1},addBox:function(e){C(e.key,e.isTagChat);var e={key:e.key,ip:e.ip,rPort:e.rPort,closedBox:e.closedBox,isMinimized:e.isMinimized,isHidden:e.isHidden,isFocused:e.isFocused,blinkOn:e.blinkOn,timeout:e.timeout,secretChat:e.secretChat,nonDomBox:e.nonDomBox,offlineStatus:e.offlineStatus,isTagChat:e.isTagChat,chatBoxClass:e.chatBoxClass,unreadCount:e.unreadCount,isSecretVisible:e.isSecretVisible,blocked:e.blocked,blockedByUtId:e.blockedByUtId,messages:[]};l||(l={}),l[e.key]||(l[e.key]=e),v()},updateBox:function(t){var t={key:t.key,ip:t.ip,rPort:t.rPort,closedBox:t.closedBox,isMinimized:t.isMinimized,isHidden:t.isHidden,isFocused:t.isFocused,blinkOn:t.blinkOn,timeout:t.timeout,secretChat:t.secretChat,nonDomBox:t.nonDomBox,offlineStatus:t.offlineStatus,isTagChat:t.isTagChat,isSecretVisible:t.isSecretVisible,blocked:t.blocked,blockedByUtId:t.blockedByUtId,chatBoxClass:t.chatBoxClass,unreadCount:t.unreadCount};l||(l={}),l[t.key]?e.extend(l[t.key],t):l[t.key]=t,v()},getBox:function(e){return l[e]?l[e]:!1},addMessage:function(e,t){var t=t.toString();if(l[t]){e.user&&e.user.getKey||(e.user=r.create(e.user));var n={key:e.key||e.packetId,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime||"",status:e.status||0,fullName:e.fullName||"",tagName:e.tagName||"",messageDate:e.messageDate,seenSent:e.seenSent||!1,isDeleted:e.isDeleted||!1,messageDateString:e.messageDateString||"",timeout:e.timeout||0,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:e.secretTimedOut?e.secretTimedOut:!1,user:e.user.getKey(),userId:e.user.getKey()};!e.user,e.statusType&&(n.statusType=e.statusType),e.usersToChange&&(n.usersToChange=e.usersToChange),l[t].messages||(l[t].messages=[]);var i=0;try{for(var o=0;o<l[t].messages.length;o++)if(l[t].messages[o].key===n.key){i=1;break}}catch(s){}0===i&&(l[t].messages.push(n),l[t].messages.sort(function(e,t){return e.messageDate-t.messageDate}),l[t].messages.splice(0,l[t].messages.length-a.HISTORY_MAX_MESSAGE))}v()},removeMessage:function(e,t){var t=t.toString(),n=!1;if(l&&l[t])for(var r=0;r<l[t].messages.length;r++)l[t].messages[r].key===e&&(l[t].messages.splice(r,1),n=!0);n&&v()},updateMessage:function(t,i){var i=i.toString();n.loginData.uId;if(l[i]){e.isObject(t.user)||(t.user=r.create(t.user));var o={key:t.key,packetId:t.packetId||t.key,packetType:t.packetType||6,brokenPacketType:t.brokenPacketType||8,platform:t.platform||5,text:t.text||t.message||t.mg,hrtime:t.hrtime,status:t.status||0,seenSent:t.seenSent||!1,messageDate:t.messageDate,isDeleted:t.isDeleted,latitude:t.latitude,longitude:t.longitude,messageDateString:t.messageDateString||"",timeout:t.timeout,messageType:t.messageType,isSecretVisible:t.isSecretVisible,tag_chat:t.tag_chat,secretTimedOut:t.secretTimedOut?t.secretTimedOut:!1,user:t.user.getKey()};t.usersToChange&&(o.usersToChange=t.usersToChange),t.statusType&&(o.statusType=t.statusType);for(var a=0;a<l[i].messages.length;a++)if(l[i].messages[a].key==o.key){l[i].messages[a]=o;break}}v()},updateMessages:function(e,t){if(e.length){for(var t=t.toString(),n={},r=0,i=e.length;i>r;r++)n[e[r].key]=e[r];if(l)for(var o=l[t],a=0;a<o.messages.length;a++){var s=o.messages[a],c=n[s.key];c&&(o.messages[a]=A(c))}v()}},isInLocalStorageChatMsgMap:function(e,t){try{return!!l[e][t]}catch(n){return!1}},countMessage:function(e){n.loginData.uId;if(l[e]){var t=l[e];return t.messages?t.messages.length:0}return!1},getMessages:function(e){if(l[e]){var t=l[e];return t.messages}return[]},getMessage:function(e,t){if(l[e]&&l[e].messages)for(var n=0;n<l[e].messages.length;n++)if(l[e].messages[n].key==t)return l[e].messages[n];return!1}};return L}])}(angular,window),function(e,t){"use strict";function n(){function n(t){function n(){if(u("contacts")||l("contacts",{}),u("chatOpenedBoxes")||l("chatOpenedBoxes",{}),u("chatBoxes")||l("chatBoxes",{}),u("unreadMessageIds")||l("unreadMessageIds",[]),u("mediaRecent")||l("mediaRecent",[]),u("notiseen")||l("notiseen",[]),u("oldNotiCount")||l("oldNotiCount",0),u("uLocationInfo")||l("uLocationInfo",{}),o){for(var e=[],t=0,n=i.length;n>t;++t)a=i.key(t).match(/(\d+)-([a-z]+)/i),a&&a.length>1&&a[1]!=r&&e.push(i.key(t));e.forEach(function(e){d(e)})}}var a;t?(t=e.fromJson(t),s(t.utId),l("loginData",t),n()):Cookies.get("utId")&&(s(Cookies.get("utId")),n())}var r,i,o=!1,a=function(e){try{var n=t[e],r="__storage_test__";return n.setItem(r,r),n.removeItem(r),o=!0,t[e]}catch(i){return o=!1,{}}};i=a("localStorage");var s=function(t){r=t,e.isDefined(i[r])&&l(r,{})},c=function(e){switch(e){case"loginData":case"country":case"remInfo":case"stickerData":break;case"chatOpenedBoxes":case"chatBoxes":case"cgInf":case"cts":case"unreadMessageIds":case"uLocationInfo":case"mood":case"utIds":case"incomingUtIds":case"outgoingUtIds":case"suggestionUtIds":case"contacts":case"notikeys":case"notiseen":case"oldNotiCount":case"mediaRecent":case"albumname":case"circledata":case"circleut":case"myStickers":e=r+"-"+e}return e},l=function(t,n){t=c(t),o?i.setItem(t,e.toJson(n)):i[t]=e.toJson(n)},u=function(t){return t=c(t),o?e.fromJson(i.getItem(t)):e.fromJson(i[t])},d=function(e){e=c(e),o?i.removeItem(e):delete i[e]},g=function(e,t){setTimeout(function(){l(e,t)},200)};return n(u("loginData")),{init:function(e){n(e)},reset:function(){d("loginData"),d("remInfo"),d("contacts"),d("chatOpenedBoxes"),d("suggestionUtIds")},setData:function(e,t,n){n?g(e,t):l(e,t)},getData:function(e){return u(e)},deleteData:function(e){d(e)},setContact:function(t,n){if(t){var r=u("contacts")||{};r.hasOwnProperty(t)?r[t]=e.extend({},r[t],n):r[t]=n,l("contacts",r)}},getContact:function(e){var t=u.contacts;return t&&t[e]?t[e]:null},updateLoginData:function(e,t){var n=u("loginData");n[e]=t,l("loginData",n)},setCookie:function(e,t,n){n?Cookies.set(e,t,{expires:n}):Cookies.set(e,t)},getCookie:function(e){return Cookies.get(e)},removeCookie:function(e){return Cookies.remove(e)}}}e.module("ringid.global_services").factory("Storage",n),n.$inject=[]}(angular,window),function(e,t){"use strict";e.module("ringid.global_services").provider("$ringbox",function(){var n={boxes:[],boxeScopes:[],boxeDeferred:[],template:'<div class="ringbox"><div class="ringbox-overlay"></div><div class="ringbox-outerContainer"><div class="ringbox-content ringbox-invisible"><div class="ringbox-inner"></div><div class="ringbox-loader"><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div></div></div></div>',init:function(){var t=e.element(this.template);return this.boxes.push(t),t},adjustBoxes:function(){for(var e=0;e<this.boxes.length;e++)this.boxes[e].removeClass("rl_"+e);for(var e=0;e<this.boxes.length;e++)this.boxes[e].addClass("rl_"+e)},$get:["$injector","$rootScope","$$q","$templateCache","$controller","$compile","$document","$player","$ringhttp","$sniffer","Notification","SystemEvents","Utils",function(r,i,o,a,s,c,l,u,d,g,m,f,E){function p(t){if(t.template)return o.when(t.template);var n=e.isFunction(t.templateUrl)?t.templateUrl():t.templateUrl;if(a.get(n))return o.when(a.get(n));var r=o.defer();return d.get(n).success(function(e){a.put(n,e),r.resolve(e)}).error(function(){r.reject()}),r.promise}function T(t){var n=[];return e.forEach(t,function(t){e.isDefined(t.promise)?n.push(t.promise):e.isFunction(t)?n.push(o.when(r.invoke(t))):(e.isArray(t)||e.isObject(t))&&n.push(t)}),n}var h={},_=this,I=g.vendorPrefix.toLowerCase();h.minimizedBox={dom:null,scope:null,deferred:null},h.clear=function(e,t,n){0==_.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened","").trim()),e&&e.$destroy(),t&&t.resolve.apply(null,n),u.miniPlayer.player||0!=_.boxes.length||u.destroyAll()},h.close=function(e){e&&e.stopPropagation&&e.stopPropagation(),_.boxes.length>0&&(_.boxes.pop().remove(),h.clear(_.boxeScopes.pop(),_.boxeDeferred.pop(),arguments))},h.closeAll=function(){for(var e=_.boxes.length-1;e>=0;e--)_.boxes.pop().remove(),h.clear(_.boxeScopes.pop(),_.boxeDeferred.pop(),arguments)};var A=function(){h.minimizedBox.dom[0].style.display="none",u.showMiniPlayer(),0==_.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened",""))};return h.removeMinimize=function(){h.minimizedBox.dom&&h.minimizedBox.dom.remove(),h.minimizedBox.scope&&h.minimizedBox.scope.$destroy()},h.minimize=function(){if(_.boxes.length>0){h.minimizedBox.dom=_.boxes.pop(),h.minimizedBox.scope=_.boxeScopes.pop(),h.minimizedBox.deferred=_.boxeDeferred.pop();var e=h.minimizedBox.dom[0].querySelector(".ringbox-content"),n=e.offsetLeft+(e.offsetWidth-335)/2-200,r=t.innerHeight-(e.offsetTop+(e.offsetHeight-150)/2)-120,i="translate(-"+n+"px,"+r+"px) scale(0.35,0.24)";h.minimizedBox.dom[0].querySelector(".pv-profile").style.display="none",e.style.webkitTransition="transform 0.5s",e.style.MozTransition="transform 0.5s",e.style.msTransition="transform 0.5s",e.style.OTransition="transform 0.5s",e.style.transition="transform 0.5s",e.style.webkitTransform=i,e.style.MozTransform=i,e.style.msTransform=i,e.style.OTransform=i,e.style.transform=i,e.addEventListener(I+"TransitionEnd",A),e.addEventListener("transitionend",A)}},h.maximize=function(e,t){if(h.minimizedBox.dom){var n=h.minimizedBox.dom[0].querySelector(".ringbox-content");h.minimizedBox.dom[0].querySelector("div.ringbox-overlay");h.minimizedBox.dom[0].querySelector(".pv-profile").style.display="block",h.minimizedBox.dom[0].style.display="table",e.appendChild(t),n.style.webkitTransform="initial",n.style.MozTransform="initial",n.style.msTransform="initial",n.style.OTransform="initial",n.style.transform="initial",_.boxes.push(h.minimizedBox.dom),_.boxeScopes.push(h.minimizedBox.scope),_.boxeDeferred.push(h.minimizedBox.deferred),1==_.boxes.length&&(document.body.className=document.body.className.trim()+" ringbox-opened"),h.minimizedBox={dom:null,scope:null,deferred:null},n.removeEventListener(I+"TransitionEnd",A),n.removeEventListener("transitionend",A)}},h.open=function(t){var r=o.defer(),a=o.defer(),d=!1,g=!1,I=_.init(),A=e.element(I[0].querySelector("div.ringbox-content")),v=e.element(A[0].querySelector("div.ringbox-loader")),S=e.element(A[0].querySelector("div.ringbox-inner")),C=e.element(I[0].querySelector("div.ringbox-overlay"));"undefined"==typeof t.loaderHide&&(t.loaderHide=!0),A.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"}),t.animation&&A.addClass("animation"),_.adjustBoxes(),t=e.extend({},t);var D=(t.scope||i).$new();D.boxIsLoading=!0,e.forEach(n.options,function(e,n){D[n]=t[n]}),e.isObject(t.scopeData)&&e.forEach(t.scopeData,function(e,n){D[n]=t.scopeData[n]}),_.boxeScopes.push(D),_.boxeDeferred.push(r);var N=function(){A.addClass("ringbox-invisible"),v.css({display:"block"}),S.css({display:"none"}),A.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"})},M=function(){setTimeout(function(){v.css({display:"none"}),S.css({display:"inline-block"}),y(),A.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),A.removeClass("ringbox-invisible")},300)},R=function(){document.body.appendChild(I[0]),document.body.className=document.body.className.replace("ringbox-opened",""),document.body.className=document.body.className.trim()+" ringbox-opened",g=!1};t.templateUrl&&(t.templateUrl.indexOf("image-popup.html")||t.templateUrl.indexOf("media-popup.html"))?g=setTimeout(R,200):R(),D.$on(f.RINGBOX.UPDATE,function(e,t){y(!0)});var y=function(e){if((!e||"none"==v.css("display"))&&A&&t.scrollable){var n,r=S[0].offsetHeight;n=Math.max(E.viewport.y/2-r/2,40),A.css({"margin-top":n+"px"}),r>E.viewport.y?C.css({right:E.scrollbarWidth+"px"}):C.css({right:"0px"})}};if(!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var O=o.all([p(t)].concat(T(t.resolve))),b={result:r.promise,opened:a.promise,close:h.close,closeAll:h.closeAll,showLoader:N,hideLoader:M,adjustHeight:y};return O.then(function(e){if(D.boxIsLoading=!1,D.$close=h.close,S){d&&clearTimeout(d);var n,r={},i=1;if(t.controller){r.$scope=D,r.$boxInstance=b;for(var o in t.resolve)t.resolve.hasOwnProperty(o)&&(r[o]=e[i++]);n=s(t.controller,r),t.controllerAs&&(D[t.controllerAs]=n)}S.html(e[0]),c(S.contents())(D),g&&(clearTimeout(g),t.loaderHide&&(v.css({display:"none"}),A.removeClass("ringbox-invisible")),R()),A.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),t.loaderHide&&M(),D.$parent.$rgDigest()}},function(e){r.reject(e),h.close()}),O.then(function(){a.resolve(!0)},function(){a.reject(!1)}),t.scrollable&&(I.addClass("scrollable"),y()),t.onBackDropClickClose&&(C.on("click",function P(e){C.off("click",P),h.close(e)}),t.scrollable&&I[0].addEventListener("click",function L(e){e.stopPropagation(),-1!=e.target.className.indexOf("ringbox-outerContainer")&&(I[0].removeEventListener("click",L),h.close())},!1)),t.onEscape&&l.bind("keyup",function U(e){var t=e.which||e.keyCode||e.key;if(32!=t&&e.stopImmediatePropagation(),27==t){if(u.escapeKey)return void(u.escapeKey=!1);l.unbind("keyup",U),h.close()}return!1}),t.scrollable&&I.bind("scroll",function(t){I[0].scrollHeight-(I[0].offsetHeight+I[0].scrollTop)<100&&(e.isFunction(D.onScroll)&&D.onScroll(),e.isFunction(D.loadMore)&&D.loadMore())}),D.$on("$destroy",function(){I=null,A=null,v=null,S=null,b=null,t=null,C=null,O=null}),d=setTimeout(function(){D&&D.boxIsLoading&&(m.error({message:"Something went wrong! Please try again."}),h.close())},2e4),b},h}]};return n}).directive("rgRingbox",["$ringbox",function(t){return{restrict:"EA",scope:{ringboxData:"&",scopeData:"&",onRingBoxOpen:"&",onRingBoxClose:"&",onScroll:"&",ringboxFalsyFunc:"&",ringboxOpen:"&"},link:function(n,r,i){function o(o){o.preventDefault();var a,s,c={},l={};a=i.ringboxType,a||(a="html"),i.ringboxData&&(c=e.isFunction(n.ringboxData)?n.ringboxData():n.ringboxData),i.scopeData&&(l=e.isFunction(n.scopeData)?n.scopeData():n.scopeData);var u=c.data?c.data:c,d={type:a,scrollable:i.ringboxScrollable&&("true"==i.ringboxScrollable||1==i.ringboxScrollable),loaderHide:!i.loaderHide||"false"!=i.loaderHide&&0!=i.loaderHide,scope:i.ringboxScope?n:!1,scopeData:l||{},controller:i.ringboxController||"",resolve:{localData:u,remoteData:c.promise?c:e.noop},onBackDropClickClose:!i.ringBackdropClose||"false"!=i.ringBackdropClose&&0!=i.ringBackdropClose,animation:!i.ringboxAnimation||"false"!=i.ringboxAnimation&&0!=i.ringboxAnimation,onEscape:!i.ringCloseEscape||"false"!=i.ringCloseEscape&&0!=i.ringCloseEscape};if("remote"===a)d.templateUrl=i.ringboxTarget||n.ringboxTarget||i.href||i.src;else if("video"===a);else if("inline"===a)d.template=i.ringboxTarget||n.ringboxTarget;else if(a="html",s=i.ringboxTarget||n.ringboxTarget){if(d.template=e.element(document.querySelector(s)),!(d.template.length>0))throw new Error("Opps ! Your Provideed Target element Does Not Exist!");d.template=d.template[0].outerHTML}else d.template=r.html();var g=t.open(d);g.result.then(function(t){e.isDefined(n.onRingBoxClose)&&e.isFunction(n.onRingBoxClose)&&n.onRingBoxClose()}),g.opened.then(function(){e.isDefined(n.onRingBoxOpen)&&e.isFunction(n.onRingBoxOpen)&&n.onRingBoxOpen()})}function a(e){r.on("click",e),c=n.$on("$destroy",function(){r.off("click",e)})}function s(t){t.preventDefault(),t.stopPropagation(),e.isFunction(n.ringboxFalsyFunc)&&n.ringboxFalsyFunc()}var c;i.ringboxOpen?n.$watch("ringboxOpen()",function(e){c&&(r.off("click",o),r.off("click",s),c()),a(e?o:s)}):a(""===i.rgRingbox||"true"===i.rgRingbox||i.rgRingbox===!0?o:s)}}}])}(angular,window),function(e,t){"use strict";function n(e,t,n){var r={utIds:t.createNew(),incomingUtIds:t.createNew(),outgoingUtIds:t.createNew()},i=t.createNew();return{init:function(){},initStorage:function(){},utIds:function(){return r.utIds},outgoingUtIds:function(){return r.outgoingUtIds},incomingUtIds:function(){return r.incomingUtIds},remove:function(e,t){return i.save(t,r[e].get(t)),r[e].remove(t)},add:function(e,t,n){r[e].save(t,n)},getFrns:function(e){return r.utIds.get(e)||r.incomingUtIds.get(e)||r.outgoingUtIds.get(e)||i.get(e)||{frnS:0}}}}e.module("ringid.global_services").factory("Contacts",n),n.$inject=["settings","$$stackedMap","Storage"]}(angular,window),function(e,t){"use strict";e.module("ringid.global_directives",["ngRoute","ringid.config"])}(angular,window),function(e,t){"use strict";e.module("ringid.global_directives").directive("rgColumn",["$document","Storage","Utils",function(t,n,r){return{restrict:"A",controller:["Utils","$scope","SystemEvents","$rootScope",function(e,t,n,r){t.spans=e.feedColumn(),t.defaultSpan=e.getDefaultColumn(),t.choose=function(i){e.resetScroll(),e.animateScroll(),e.setFeedColumn(i),t.spans=i,r.$broadcast(n.COMMON.COLUMN_CHANGED,i)},t.$watch(e.feedColumn,function(e){t.spans=e,r.$broadcast(n.COMMON.COLUMN_CHANGED,e)}),t.$on(n.COMMON.WINDOW_RESIZED,function(){t.defaultSpan=e.getDefaultColumn()})}],template:'<span></span>                        <span></span>                        <span></span>                        <div class="col-area">                        <div class="col-area-wrapper">                            <div class="list-ico width-26 top-l" data-tool="3 Column" ng-click="choose(3)"  ng-if="defaultSpan > 2" ng-class="{\'list-act\' : spans == 3 }">                                <span></span>                                <span></span>                                <span></span>                            </div>                            <div class="list-ico width-17 top-l" data-tool="2 Column" ng-click="choose(2)"  ng-if="defaultSpan > 1" ng-class="{\'list-act\' : spans == 2 }">                                <span></span>                                <span></span>                            </div>                            <div  class="list-ico width-9 top-l" data-tool="1 Column" ng-click="choose(1)" ng-class="{\'list-act\' : spans == 1 }">                                <span></span>                            </div>                            </div>                        </div>',link:function(n,r,i,o){function a(n){n.preventDefault(),l||(l=e.element(r.find("div")[0]),t.on("click",s)),l.toggleClass("colshow")}function s(e){var t=r.parent().parent()[0];e.target!=t&&e.target.parentNode!=t&&null!=e.target.parentNode&&e.target.parentNode.parentNode!=t&&"pt-top"!=e.target.className&&c(e)}function c(e){l.removeClass("colshow")}var l;r.parent().parent().on("click",a),n.$on("$destroy",function(){r.off("click",a),t.off("click",s),l=void 0})}}}])}(angular,window),function(e,t){"use strict";function n(){this.dicts={maximize:"Back to normal view",minimize:"Go to small view",fullScreen:"Full Screen",playlist:"Playlist",auto:"Auto Play"},this.instances=[],this.template='<div class="rg-player"><div class="container"><div class="play-info"></div><div class="play-error"></div> <div class="music-bars"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><div class="big-play"><span class="img_sprite icon-player"></span></div><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div><div class="player-poster"><img class="poster" /></div></div><div class="playlist-wrapper"></div><div class="media-control"><div class="media-tip"></div><div class="media-control-bg"></div><div class="media-control-layer"><div class="bar-panel"><div class="bar-container"><div class="bar-background"><div class="bar-fill-1"></div><div class="bar-fill-2"></div><div class="bar-hover"></div></div><div class="bar-scrubber"><div class="bar-scrubber-icon"></div></div><div class="seek-time"><div class="timer"></div></div></div></div><div class="control-left"><div class="play-btns"><button class="img_sprite w-h-13 icon-previous-p control-btn prev-btn"></button><button class="img_sprite w-h-13 icon-play-p control-btn start-btn"></button><button class="img_sprite w-h-13 icon-next-p control-btn next-btn"></button></div><div class="volume-bar"><div class="img_sprite w-h-13 icon-speaker-fill volume-icon unmute"></div><div class="volume-bar-container volume-bar-hide"><div data-rel="0" class="bar fill"></div><div data-rel="1" class="bar fill"></div><div data-rel="2" class="bar fill"></div><div data-rel="3" class="bar fill"></div><div data-rel="4" class="bar"></div><div data-rel="5" class="bar"></div><div data-rel="6" class="bar"></div><div data-rel="7" class="bar"></div><div data-rel="8" class="bar"></div><div data-rel="9" class="bar"></div></div></div><div class="time-indicator time-running"></div><div class="time-indicator time-total"></div></div><div class="control-right"><button class="control-btn hd">HD</button><button class="img_sprite w-h-13 icon-minimize control-btn minimize" tooltip="'+this.dicts.minimize+'"></button><button class="img_sprite w-h-13 icon-screen-f control-btn full-screen" tooltip="'+this.dicts.fullScreen+'"></button><button class="img_sprite w-h-13 icon-play-list control-btn playlist-btn" tooltip="'+this.dicts.playlist+'"></button><button class="control-btn auto" tooltip="'+this.dicts.auto+'">AUTO</button></div></div></div></div>',
this.trackTemplate='<a rel="data-rel" href="#"><span class="list-thumb"><img src="data-thumb" /></span><span class="list-title">data-caption<b>data-duration</b></span></a>',this.secToTime=function(e){e=Math.floor(e);var t=parseInt(e/3600)%24,n=parseInt(e/60)%60,e=0>e?0:e%60,r="";return t>0&&(r+=10>t?"0"+t:t),r+=(10>n?"0"+n:n)+":"+(10>e?"0"+e:e)},this.findPos=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}},this.destroy=function(e){try{e.removeEvent(),e.provider.pause(),e.provider.src="",e.dom=null,delete e.provider}catch(t){}},this.addRemoveClass=function(e,t,n){var r;for(r=0;r<n.length;r++)e.className=e.className.replace(n[r],"").trim();for(r=0;r<t.length;r++)e.className+=" "+t[r]},this.createMediaObject=function(e){return"audio"==e?document.createElement("audio"):document.createElement("video")},this.getDefaultThumb=function(e){return e&&"images/default_audio_image.jpg"!=e||(e="images/player-audio.png"),e},this.$get=["$compile","$document",function(n,r){var i=this,o={};return o.escapeKey=!1,o.miniPlayer={dom:{container:null,move:null,resize:null,maximize:null,close:null},parent:null,player:null},o.wh=t.innerHeight,o.destroy=function(){i.instances.length>0&&i.destroy(i.instances.pop())},o.destroyAll=function(){for(var e=i.instances.length-1;e>=0;e--)i.destroy(i.instances.pop())},o.toggleMinMax=function(){for(var e,t=i.instances.length-1;t>=0;t--)if(!i.instances[t].chat){e=i.instances[t];break}e.minimize()},o.showMiniPlayer=function(){o.miniPlayer.player&&(o.miniPlayer.dom.container.appendChild(o.miniPlayer.player.parent),o.miniPlayer.dom.container.style.display="block","PLAYING"==o.miniPlayer.player.playingState&&setTimeout(function(){o.miniPlayer.player.provider.play()}))},o.closeMiniPlayer=function(){o.miniPlayer.player&&(o.ringboxRemove(),o.destroy(),o.miniPlayer.dom.container.parentNode.removeChild(o.miniPlayer.dom.container),o.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},o.miniPlayer.player=null)},o.addToPlaylist=function(e){for(var t=i.instances.length-1;t>=0;t--)if(!i.instances[t].chat){i.instances[t].AddToPlaylist(e);break}},o.player=function(r){function a(){var e=document.mozFullScreen||document.webkitIsFullScreen;e||"FULL"!=B.screenState||B.fullScreen()}function s(e){var t=e.which||e.keyCode||e.key;o.miniPlayer.player||32===t&&B.playPause()}function c(e){e.stopPropagation(),B.playPause()}function l(e){e.stopPropagation(),B.playNext()}function u(e){e.stopPropagation(),B.playPrev()}function d(e){e.stopPropagation(),B.muteUnmute()}function g(e){e.stopPropagation(),B.fullScreen()}function m(e){e.stopPropagation(),B.minimize()}function f(e){B.timeInfo(e),B.isMouseDown&&B.setPosition(e,!1)}function E(e){B.isMouseDown=!0,i.addRemoveClass(B.dom.barContainer,["down"],[])}function p(e){B.isMouseDown=!1,B.setPosition(e,!0),i.addRemoveClass(B.dom.barContainer,[],["down"])}function T(e){B.isMouseDown=!1,i.addRemoveClass(B.dom.barContainer,[],["down"])}function h(e){return e.stopPropagation(),B.playlistState?void B.showPlaylist(!1):void B.playPause()}function _(e){e.stopPropagation(),B.showControl(!0)}function I(e){e.stopPropagation(),B.showControl(!1)}function A(e){e.stopPropagation(),o.miniPlayer.player&&B.maximize(),B.showPlaylist()}function v(e){e.stopPropagation(),B.setAuto()}function S(e){e.stopPropagation(),B.showTootip(e,this.getAttribute("tooltip"))}function C(e){e.stopPropagation(),B.dom.controlTip.style.display="none"}function D(e){e.stopPropagation(),B.showTootip(e,this.getAttribute("tooltip"))}function N(e){e.stopPropagation(),B.dom.controlTip.style.display="none"}function M(e){e.stopPropagation(),B.showTootip(e,this.getAttribute("tooltip"))}function R(e){e.stopPropagation(),B.dom.controlTip.style.display="none"}function y(e){e.stopPropagation(),B.showTootip(e,this.getAttribute("tooltip"))}function O(e){e.stopPropagation(),B.dom.controlTip.style.display="none"}function b(e){e.stopPropagation();var t=parseInt(this.getAttribute("data-rel"));B.changeVolume(t)}function P(e){V=!0,j&&fastdom.read(function(){o.miniPlayer.dom.resize&&(document.body.style.cursor="move",o.miniPlayer.dom.resize.style.cursor="move",B.dom.container.style.cursor="move",fastdom.write(function(){e.clientX+x>=200&&e.clientX+x<=X-q-210&&(o.miniPlayer.dom.container.style.left=e.clientX+x+"px"),e.clientY+Y>=50&&e.clientY+Y<=Q-z&&(o.miniPlayer.dom.container.style.top=e.clientY+Y+"px")}))})}function L(e){e.stopPropagation(),j=!1,document.body.style.cursor="default",o.miniPlayer.dom.resize.style.cursor="ns-resize",B.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",L)}function U(e){e.preventDefault(),e.stopPropagation(),j=!0,X=t.innerWidth,Q=t.innerHeight,x=o.miniPlayer.dom.container.offsetLeft-e.clientX,Y=o.miniPlayer.dom.container.offsetTop-e.clientY,document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",L,!1)}function w(e){return V?void(V=!1):void B.playPause()}function F(e){W&&fastdom.read(function(){if(o.miniPlayer.dom.container){var t=o.miniPlayer.dom.container.offsetHeight,n=parseInt(o.miniPlayer.dom.container.style.top.replace("px",""));fastdom.write(function(){document.body.style.cursor="ns-resize",o.miniPlayer.dom.move.style.cursor="ns-resize",B.dom.container.style.cursor="ns-resize",K>=e.clientY&&250>t&&(t+=3,n-=3,o.miniPlayer.dom.container.style.height=t+"px",o.miniPlayer.dom.container.style.top=n+"px",K=e.clientY),K<e.clientY&&t>120&&(t-=3,n+=3,o.miniPlayer.dom.container.style.height=t+"px",o.miniPlayer.dom.container.style.top=n+"px",K=e.clientY)})}})}function k(e){e.stopPropagation(),W=!1,document.body.style.cursor="default",o.miniPlayer.dom.move.style.cursor="move",B.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",k)}function $(e){e.preventDefault(),e.stopPropagation(),W=!0,X=t.innerWidth,Q=t.innerHeight,K=e.clientY,document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",k,!1)}function G(e){e.preventDefault(),e.stopPropagation(),B.maximize()}function H(e){e.preventDefault(),e.stopPropagation(),o.closeMiniPlayer()}o.ringboxRemove=r.ringboxRemove?r.ringboxRemove:function(){},r.chatVersion||o.closeMiniPlayer();var B={};B.source=r.source||"",B.autoPlay=r.autoPlay||!1,B.showMinMax=r.showMinMax||!1,B.auto=r.auto||!1,B.parent=document.getElementById(r.parentId),B.poster=r.poster||"",B.mediaType=r.type||"video",B.dom={},B.playingState=this.autoPlay?"INIT":"STOPPED",B.screenState="NORMAL",B.volumeState="UNMUTE",B.volume=5,B.duration=0,B.currentTrack=0,B.playlist=r.playlist||[],B.title=r.title||"",B.playlistState=!1,B.hd=!1,B.isMouseDown=!1,B.isLoading=B.autoPlay,B.isFirefox=!!navigator.userAgent.match(/firefox/i),B.canPlay=!0,B.chat=!!r.chatVersion,B.provider=i.createMediaObject(B.mediaType),B.parent.innerHTML=i.template,B.dom.player=B.parent.querySelector(".rg-player"),B.dom.container=B.parent.querySelector(".container"),B.dom.playlistWrap=B.parent.querySelector(".playlist-wrapper"),B.dom.control=B.parent.querySelector(".media-control"),B.dom.bigBlay=B.dom.container.querySelector(".big-play"),B.dom.bigBlayIcon=B.dom.bigBlay.querySelector("span"),B.dom.playError=B.dom.container.querySelector(".play-error"),B.dom.playInfo=B.dom.container.querySelector(".play-info"),B.dom.musicBar=B.dom.container.querySelector(".music-bars"),B.dom.loader=B.dom.container.querySelector(".loader"),B.dom.poster=B.dom.container.querySelector(".player-poster"),B.dom.posterImg=B.dom.poster.querySelector(".poster"),B.dom.barContainer=B.dom.control.querySelector(".bar-container"),B.dom.barScrubber=B.dom.control.querySelector(".bar-scrubber"),B.dom.barLoaded=B.dom.control.querySelector(".bar-fill-1"),B.dom.barPosition=B.dom.control.querySelector(".bar-fill-2"),B.dom.barHover=B.dom.control.querySelector(".bar-hover"),B.dom.controlLayer=B.dom.control.querySelector(".media-control-layer"),B.dom.controlBG=B.dom.control.querySelector(".media-control-bg"),B.dom.controlTip=B.dom.control.querySelector(".media-tip"),B.dom.playBtn=B.dom.control.querySelector(".start-btn"),B.dom.nextBtn=B.dom.control.querySelector(".next-btn"),B.dom.prevBtn=B.dom.control.querySelector(".prev-btn"),B.dom.timeRunning=B.dom.control.querySelector(".time-running"),B.dom.timeTotal=B.dom.control.querySelector(".time-total"),B.dom.hd=B.dom.control.querySelector(".hd"),B.dom.playlistBtn=B.dom.control.querySelector(".playlist-btn"),B.dom.minimize=B.dom.control.querySelector(".minimize"),B.dom.auto=B.dom.control.querySelector(".auto"),B.dom.volumeIcon=B.dom.control.querySelector(".volume-icon"),B.dom.volumeBarContainer=B.dom.control.querySelector(".volume-bar-container"),B.dom.volumeBars=B.dom.volumeBarContainer.querySelectorAll(".bar"),B.dom.fullScreenBtn=B.dom.control.querySelector(".full-screen"),B.dom.seekTimer=B.dom.control.querySelector(".seek-time"),B.dom.timer=B.dom.control.querySelector(".timer"),B.dom.playlist=null,B.dom.player.style.width=r.width?r.width+"px":"100%",B.dom.player.style.height=r.height?r.height+"px":"100%",B.dom.timeRunning.innerHTML="00:00",B.dom.timeTotal.innerHTML="00:00",!r.chatVersion&&B.showMinMax||(B.dom.minimize.style.display="none"),B.dom.poster.appendChild(B.provider),o.miniPlayer.parent=B.parent.parentNode;var x,Y,K,j=!1,V=!1,W=!1,q=350,z=120,Q=t.innerHeight,X=t.innerWidth;return B.initEvent=function(){B.dom.playBtn.addEventListener("click",c,!1),B.dom.nextBtn.addEventListener("click",l,!1),B.dom.prevBtn.addEventListener("click",u,!1),B.dom.volumeIcon.addEventListener("click",d,!1),B.dom.fullScreenBtn.addEventListener("click",g,!1),B.dom.minimize.addEventListener("click",m,!1),B.dom.barContainer.addEventListener("mousemove",f,!1),B.dom.barContainer.addEventListener("mousedown",E,!1),B.dom.barContainer.addEventListener("mouseup",p,!1),B.dom.barContainer.addEventListener("mouseleave",T,!1),B.dom.container.addEventListener("click",h,!1),B.dom.player.addEventListener("mouseover",_,!1),B.dom.player.addEventListener("mouseleave",I,!1),B.dom.playlistBtn.addEventListener("click",A,!1),B.dom.auto.addEventListener("click",v,!1);for(var e=0;e<B.dom.volumeBars.length;e++)B.dom.volumeBars[e].addEventListener("click",b);B.dom.auto.addEventListener("mouseover",S,!1),B.dom.auto.addEventListener("mouseleave",C,!1),B.dom.minimize.addEventListener("mouseover",D,!1),B.dom.minimize.addEventListener("mouseleave",N,!1),B.dom.fullScreenBtn.addEventListener("mouseover",M,!1),B.dom.fullScreenBtn.addEventListener("mouseleave",R,!1),B.dom.playlistBtn.addEventListener("mouseover",y,!1),B.dom.playlistBtn.addEventListener("mouseleave",O,!1),document.addEventListener("mozfullscreenchange",a,!1),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("fullscreenchange",a,!1),document.addEventListener("keyup",s,!1),B.setMediaEvent(),B.createPlaylist(),B.showPoster(!0),B.auto&&B.setAuto(!0)},B.setMediaEvent=function(){B.provider.addEventListener("loadedmetadata",function(e,t){B.initTime(B.provider.duration),B.autoPlay&&B.play()}),B.provider.addEventListener("progress",function(){var e=B.provider.buffered.length>0?B.provider.buffered.end(B.provider.buffered.length-1):0,t=B.provider.currentTime+.05>=e?"BUFFERING":"PLAYING_BUFFERING";B.showBuffered(e,B.provider.duration),B.stateChanged(t)}),B.provider.addEventListener("timeupdate",function(){B.provider&&!B.isMouseDown&&B.showPosition(B.provider.currentTime,B.provider.duration)}),B.provider.addEventListener("play",function(){B.stateChanged("PLAYING"),"video"==B.mediaType&&B.showPoster(!1),e.isFunction(r.scope.onStart())&&r.scope.onStart()()}),B.provider.addEventListener("pause",function(){B.stateChanged("PAUSED"),"video"==B.mediaType&&B.showPoster(!1)}),B.provider.addEventListener("ended",function(){B.stateChanged("ENDED"),"video"==B.mediaType&&B.showPoster(!1),e.isFunction(r.scope.onEnded())&&r.scope.onEnded()()}),B.provider.addEventListener("stalled",function(){!B.provider}),B.provider.addEventListener("error",function(){B.provider&&(B.error=B.provider.error.code,B.canPlay=!1,B.showError())})},B.removeEvent=function(){B.dom.playBtn.removeEventListener("click",c),B.dom.nextBtn.removeEventListener("click",l),B.dom.prevBtn.removeEventListener("click",u),B.dom.volumeIcon.removeEventListener("click",d),B.dom.fullScreenBtn.removeEventListener("click",g),B.dom.minimize.removeEventListener("click",m),B.dom.barContainer.removeEventListener("mousemove",f),B.dom.barContainer.removeEventListener("mousedown",E),B.dom.barContainer.removeEventListener("mouseup",p),B.dom.barContainer.removeEventListener("mouseleave",T),B.dom.container.removeEventListener("click",h),B.dom.player.removeEventListener("mouseover",_),B.dom.player.removeEventListener("mouseleave",I),B.dom.playlistBtn.removeEventListener("click",A),B.dom.auto.removeEventListener("click",v);for(var e=0;e<B.dom.volumeBars.length;e++)B.dom.volumeBars[e].removeEventListener("click",b);B.dom.auto.removeEventListener("mouseover",S),B.dom.auto.removeEventListener("mouseleave",C),B.dom.minimize.removeEventListener("mouseover",D),B.dom.minimize.removeEventListener("mouseleave",N),B.dom.fullScreenBtn.removeEventListener("mouseover",M),B.dom.fullScreenBtn.removeEventListener("mouseleave",R),B.dom.playlistBtn.removeEventListener("mouseover",y),B.dom.playlistBtn.removeEventListener("mouseleave",O),document.removeEventListener("mozfullscreenchange",a),document.removeEventListener("webkitfullscreenchange",a),document.removeEventListener("fullscreenchange",a),document.removeEventListener("keyup",s)},B.maximize=function(){return o.miniPlayer.player?(r.ringboxMaximize(o.miniPlayer.parent,B.parent),"PLAYING"==B.playingState&&setTimeout(function(){B.provider.play()}),o.miniPlayer.dom.move.removeEventListener("mousedown",U),o.miniPlayer.dom.move.removeEventListener("click",w),o.miniPlayer.dom.resize.removeEventListener("mousedown",$),o.miniPlayer.dom.close.removeEventListener("click",H),o.miniPlayer.dom.maximize.removeEventListener("click",G),o.miniPlayer.dom.container.parentNode.removeChild(o.miniPlayer.dom.container),o.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},o.miniPlayer.player=null,i.addRemoveClass(B.dom.minimize,["icon-minimize"],["icon-maximize"]),B.dom.fullScreenBtn.style.display="block",void B.dom.minimize.setAttribute("tooltip",i.dicts.minimize)):void 0},B.minimize=function(){if(o.miniPlayer.player)return void B.maximize();var e=document.createElement("div"),n=document.createElement("a"),a=document.createElement("div"),s=document.createElement("div"),c=document.createElement("a");c.setAttribute("class","mini-close"),c.innerHTML='<div class="img_sprite w-h-16px icon-close pop-close"></div>',n.setAttribute("class","img_sprite w-h-18px maximize icon-maximize"),n.setAttribute("style","position: absolute;right: 22px;top: 5px;color: #fff;"),a.setAttribute("class","move-player"),a.appendChild(n),a.appendChild(c),e.setAttribute("id","mini-player"),e.setAttribute("class","mini-player"),s.setAttribute("class","resize-player"),e.style.display="none",e.appendChild(a),e.appendChild(s),document.body.appendChild(e),B.showPlaylist(!0),B.showControl(!0),o.miniPlayer.dom.container=e,o.miniPlayer.dom.resize=s,o.miniPlayer.dom.move=a,o.miniPlayer.dom.close=c,o.miniPlayer.dom.maximize=n,o.miniPlayer.player=B,B.dom.minimize.setAttribute("tooltip",i.dicts.maximize),r.ringboxMinimize(),Q="FULL"==B.screenState?o.wh:t.innerHeight,e.style.top=Q-z+"px",i.addRemoveClass(B.dom.minimize,["icon-maximize"],["icon-minimize"]),B.dom.fullScreenBtn.style.display="none",c.addEventListener("click",H,!1),n.addEventListener("click",G,!1),a.addEventListener("mousedown",U,!1),a.addEventListener("click",w,!1),s.addEventListener("mousedown",$,!1),c=n=s=a=e=null},B.playPause=function(){return B.canPlay?"PLAYING"==B.playingState?(B.pause(),B.showLoader(),B.showBigPlay(),B.showControl(!1),B.showPlaylist(!0),void B.showInfo(!0)):"PAUSED"==B.playingState?(B.resume(),B.showLoader(),B.showBigPlay(),void B.showInfo()):"STOPPED"==B.playingState?(B.play(),B.showLoader(),B.showBigPlay(),B.showPlaylist(!0),void B.showInfo()):void 0:void 0},B.muteUnmute=function(){return"UNMUTE"==B.volumeState?(B.setVolume(0),i.addRemoveClass(B.dom.volumeIcon,["icon-speaker-m"],["icon-speaker-fill"]),void(B.volumeState="MUTE")):"MUTE"==B.volumeState?(B.setVolume(B.volume),i.addRemoveClass(B.dom.volumeIcon,["icon-speaker-fill"],["icon-speaker-m"]),void(B.volumeState="UNMUTE")):void 0},B.initTime=function(e){B.dom.timeTotal.innerHTML=i.secToTime(e),B.duration=e},B.showPosition=function(e,t){0==B.duration&&t>0&&B.initTime(t),e>t&&B.initTime(e),B.dom.timeRunning.innerHTML=i.secToTime(e),B.dom.barScrubber.style.left=0==B.duration?"-"+B.dom.barScrubber.offsetWidth/2+"px":"calc("+e/B.duration*100+"% - "+B.dom.barScrubber.offsetWidth/2+"px)",B.dom.barPosition.style.width=0==B.duration?"0%":e/B.duration*100+"%"},B.showBuffered=function(e,t){0==B.duration&&t>0&&B.initTime(t),B.dom.barLoaded.style.width=0==B.duration?"0%":e/B.duration*100+"%"},B.timeInfo=function(e){var t="FULL"==B.screenState?{x:0,y:0}:i.findPos(B.dom.barContainer),n=e.pageX-t.x,r=Math.round(n*B.duration/B.dom.barContainer.offsetWidth);0>r&&(r=0),B.dom.timer.innerHTML=i.secToTime(r),B.dom.seekTimer.style.left=n-B.dom.seekTimer.offsetWidth/2+"px",B.dom.barHover.style.left=n-B.dom.barHover.offsetWidth/2+"px"},B.showTootip=function(e,t){var n="FULL"==B.screenState?{x:0,y:0}:i.findPos(B.dom.barContainer),r=e.pageX-n.x;B.dom.controlTip.innerHTML=t,B.dom.controlTip.style.display="block";var o=B.dom.barContainer.offsetWidth,a=B.dom.controlTip.offsetWidth;r=a/2+r>=o?o-a/2:r,B.dom.controlTip.style.left=r-a/2+"px"},B.setPosition=function(e,t){if("STOPPED"!=B.playingState&&B.canPlay){var n="FULL"==B.screenState?{x:0,y:0}:i.findPos(B.dom.barContainer),r=e.pageX-n.x,o=Math.round(r*B.duration/B.dom.barContainer.offsetWidth);t&&B.seek(o),B.showPosition(o)}},B.changeVolume=function(e){var t;for(t=0;t<B.dom.volumeBars.length;t++)i.addRemoveClass(B.dom.volumeBars[t],[],["fill"]);for(t=0;e>=t;t++)i.addRemoveClass(B.dom.volumeBars[t],["fill"],[]);return B.volume=e+1,"MUTE"==B.volumeState?void B.muteUnmute():void B.setVolume(B.volume)},B.showHD=function(){B.hd?B.dom.hd.style.display="inline-block":B.dom.hd.style.display="none"},B.showPoster=function(e){""!=B.poster&&(e?(B.dom.posterImg.src=B.poster,B.dom.posterImg.style.display="inline-block"):B.dom.posterImg.style.display="none")},B.showInfo=function(e){if(""==B.title||"audio"!=B.mediaType||e?B.dom.playInfo.style.display="none":(B.dom.playInfo.innerHTML=B.title,B.dom.playInfo.style.display="block"),B.playlist.length>0){var t=B.playlist[B.currentTrack].value.getThumb();t=i.getDefaultThumb(t),B.poster=t,"audio"==B.mediaType&&B.showPoster(!0)}},B.showLoader=function(){B.isLoading&&B.canPlay?B.dom.loader.style.display="block":B.dom.loader.style.display="none",B.showMusicBar(),B.showBigPlay()},B.showError=function(){B.dom.playError.innerHTML="Sorry, your browser does not support this media format.",B.showLoader(),B.canPlay?B.dom.playError.style.display="none":(B.showPoster(!1),B.dom.playError.style.display="block")},B.showBigPlay=function(e){return B.canPlay?(e?i.addRemoveClass(B.dom.bigBlayIcon,["icon-reload-p"],[]):i.addRemoveClass(B.dom.bigBlayIcon,[],["icon-reload-p"]),"PAUSED"!=B.playingState&&"STOPPED"!=B.playingState||B.isLoading?B.dom.bigBlay.style.display="none":B.dom.bigBlay.style.display="block",void B.showMusicBar()):void(B.dom.bigBlay.style.display="none")},B.initPlaylist=function(){B.playlist.length>1?(B.dom.playlistBtn.style.display="inline-block",B.dom.prevBtn.style.display="inline-block",B.dom.nextBtn.style.display="inline-block",B.dom.auto.style.display="inline-block"):(B.dom.playlistBtn.style.display="none",B.dom.prevBtn.style.display="none",B.dom.nextBtn.style.display="none",B.dom.auto.style.display="none"),B.dom.playlistWrap.style.right="-250px"},B.showPlaylist=function(e){return B.playlistState||e?(B.dom.playlistWrap.style.right="-250px",B.dom.playlistWrap.style.zIndex=999,void(B.playlistState=!1)):B.playlistState?void 0:(B.dom.playlistWrap.style.right="0",B.dom.playlistWrap.style.zIndex=1e4,void(B.playlistState=!0))},B.createPlaylist=function(){if(!(B.playlist.length<2)){for(var e,t,o='<div class="playlist-scrollbar-wrapper"><div rg-scrollbar="true" class="playlist-scrollbar"><ul class="playlist">',a=0;a<B.playlist.length;a++)e=B.playlist[a].value.getThumb(),e=i.getDefaultThumb(e),t=i.trackTemplate.replace(/data-rel/g,a),t=t.replace(/data-thumb/g,e),t=t.replace(/data-caption/g,B.playlist[a].value.getCaption()),t=t.replace(/data-duration/g,i.secToTime(B.playlist[a].value.getDuration())),B.source==B.playlist[a].value.getStreamUrl()&&(B.currentTrack=a),o+="<li>"+t+"</li>";o+="</ul></div></div>",B.dom.playlistWrap.innerHTML="",B.dom.playlistWrap.appendChild(n(o)(r.scope)[0]),B.dom.playlistUL=B.dom.playlistWrap.querySelector(".playlist"),B.dom.playlist=B.dom.playlistWrap.querySelectorAll("ul.playlist > li > a"),r.scope.$parent.$rgDigest();for(var a=0;a<B.dom.playlist.length;a++)B.dom.playlist[a].addEventListener("click",function(e){e.preventDefault(),B.currentTrack=this.getAttribute("rel"),B.title=B.playlist[B.currentTrack].value.getCaption(),B.load(B.playlist[B.currentTrack].value.getStreamUrl())})}},B.updatePlaylist=function(e){e&&(B.playlist=e,B.createPlaylist())},B.AddToPlaylist=function(e){var t,n;if(!B.dom.playlistUL)return void B.updatePlaylist(e);if(e&&B.dom.playlistUL)for(var r=0;r<e.length;r++){var o=document.createElement("li");t=e[r].value.getThumb(),t=i.getDefaultThumb(t),n=i.trackTemplate.replace(/data-rel/g,r),n=n.replace(/data-thumb/g,t),n=n.replace(/data-caption/g,e[r].value.getCaption()),n=n.replace(/data-duration/g,i.secToTime(e[r].value.getDuration())),o.innerHTML=n,B.dom.playlistUL.appendChild(o)}},B.setTrack=function(){if(!(B.playlist.length<2)){0==B.currentTrack?i.addRemoveClass(B.dom.prevBtn,["disabled"],[]):i.addRemoveClass(B.dom.prevBtn,[],["disabled"]),B.currentTrack==B.playlist.length-1?i.addRemoveClass(B.dom.nextBtn,["disabled"],[]):i.addRemoveClass(B.dom.nextBtn,[],["disabled"]);for(var e=0;e<B.dom.playlist.length;e++)e==B.currentTrack?i.addRemoveClass(B.dom.playlist[e],["active"],["active"]):i.addRemoveClass(B.dom.playlist[e],[],["active"]);B.showInfo()}},B.setAuto=function(e){return e?void i.addRemoveClass(B.dom.auto,["enbled"],[]):B.auto?(B.auto=!1,void i.addRemoveClass(B.dom.auto,[],["enbled"])):B.auto?void 0:(B.auto=!0,void i.addRemoveClass(B.dom.auto,["enbled"],[]))},B.showMusicBar=function(){"audio"!=B.mediaType||"PLAYING"!=B.playingState||B.isLoading?B.dom.musicBar.style.display="none":B.dom.musicBar.style.display="block"},B.showControl=function(e){return o.miniPlayer.player?void(B.dom.controlLayer.style.bottom="0px"):void("PLAYING"==B.playingState&&e?(B.dom.controlLayer.style.bottom="0px",B.dom.controlBG.style.opacity=1):(B.dom.controlLayer.style.bottom="-60px",B.dom.controlBG.style.opacity=0))},B.stateChanged=function(e){"BUFFERING"==e?B.isLoading=!0:B.isLoading=!1,B.showLoader(),"PLAYING"==e&&(B.playingState="PLAYING",B.showBigPlay(),i.addRemoveClass(B.dom.playBtn,["icon-pause-p"],["icon-play-p"])),"ENDED"!=e&&"IDLE"!=e||(B.playingState="STOPPED",B.showBigPlay(!0),B.showPlaylist(!0),i.addRemoveClass(B.dom.playBtn,["icon-play-p"],["icon-pause-p"]),B.initTime(0),B.showPosition(0),B.showInfo(!0),B.auto&&B.playlist.length>0&&B.playNext())},B.reset=function(){B.isLoading=!0,B.initTime(0),B.showPosition(0),B.showBuffered(0),B.showLoader(),B.showInfo()},B.fullScreen=function(){if("NORMAL"==B.screenState){if(B.dom.player.requestFullscreen)B.dom.player.requestFullscreen();else if(B.dom.player.mozRequestFullScreen)B.dom.player.mozRequestFullScreen();else{if(!B.dom.player.webkitRequestFullScreen)return!1;B.dom.player.webkitRequestFullScreen()}return B.screenState="FULL",B.showControl(!0),i.addRemoveClass(B.dom.player,["full"],[]),i.addRemoveClass(B.dom.fullScreenBtn,["icon-screen-fe"],["icon-screen-f"]),o.miniPlayer.dom.container&&i.addRemoveClass(o.miniPlayer.dom.container,["full"],[]),B.dom.fullScreenBtn.setAttribute("tooltip",i.dicts.maximize),!0}return"FULL"==B.screenState?(document.cancelFullscreen?document.cancelFullscreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),i.addRemoveClass(B.dom.player,[],["full"]),i.addRemoveClass(B.dom.fullScreenBtn,["icon-screen-f"],["icon-screen-fe"]),o.miniPlayer.dom.container&&i.addRemoveClass(o.miniPlayer.dom.container,[],["full"]),B.showControl(!1),B.screenState="NORMAL",o.escapeKey=!0,B.dom.fullScreenBtn.setAttribute("tooltip",i.dicts.fullScreen),!0):void 0},B.playNext=function(){B.currentTrack!=B.playlist.length-1&&(B.currentTrack++,B.title=B.playlist[B.currentTrack].value.getCaption(),B.load(B.playlist[B.currentTrack].value.getStreamUrl()),r.onNext&&r.onNext.apply(r.scope))},B.playPrev=function(){0!=B.currentTrack&&(B.currentTrack--,B.title=B.playlist[B.currentTrack].value.getCaption(),B.load(B.playlist[B.currentTrack].value.getStreamUrl()),r.onNext&&r.onNext.apply(r.scope))},B.getPlaylistUI=function(){return B.dom.playlistWrap},B.getNextUI=function(){return B.dom.nextBtn},B.getPrevUI=function(){return B.dom.prevBtn},B.load=function(t){B.reset(),B.setTrack(),B.provider.pause(),B.seek(0),B.provider.src=t,B.source=t,e.isFunction(r.scope.onChange())&&B.playlist.length>0&&r.scope.onChange()(B.playlist[B.currentTrack].value)},B.play=function(){B.provider.play(),B.playingState="PLAYING",i.addRemoveClass(B.dom.playBtn,["icon-pause-p"],["icon-play-p"])},B.pause=function(){B.provider.pause(),B.playingState="PAUSED",i.addRemoveClass(B.dom.playBtn,["icon-play-p"],["icon-pause-p"])},B.resume=function(){B.provider.play(),B.playingState="PLAYING",i.addRemoveClass(B.dom.playBtn,["icon-pause-p"],["icon-play-p"])},B.seek=function(e){try{B.provider.currentTime=e}catch(t){}},B.stop=function(){B.provider.pause(),B.seek(0),B.playingState="STOPPED",i.addRemoveClass(B.dom.playBtn,["icon-play-p"],["icon-pause-p"])},B.setVolume=function(e){B.provider.volume=e/10},B.initEvent(),B.showControl(),B.showLoader(),B.showBigPlay(),B.showError(),B.showInfo(),B.showMusicBar(),B.initPlaylist(),B.showHD(),B.playingState="STOPPED",B.provider.autoplay=!1,B.load(r.source),B.setVolume(B.volume),i.instances.push(B),B},o}]}function r(e,t,n){function r(e,r,i){function o(e){e.preventDefault(),e.stopPropagation(),p.minimize()}var a=i.id?i.id:"player_1",s=i.width?i.width:"100%",c=i.height?i.height:"100%",l="false"!=i.auto&&0!=i.auto,u=i.url?i.url:"",d=i.title?i.title:"",g="true"==i.isVideo||0==i.isVideo?"video":"audio",m=i.poster?i.poster:"audio"==g?"images/player-audio.png":"",f="false"!=i.autoPlay&&0!=i.autoPlay,E="true"==i.chat||1==i.chat,p=null,T=null;m&&"default_audio_image.jpg"!=m||(m="images/player-audio.png");var h='<div title="" id="player_'+a+'" class="player '+g+'"></div>';r.append(h),setTimeout(function(){p=t.player({source:u,title:d,playlist:e.playlist,auto:l,type:g,parentId:"player_"+a,autoPlay:f,chatVersion:E,width:s,height:c,poster:m,ringboxMinimize:n.minimize,ringboxMaximize:n.maximize,ringboxRemove:n.removeMinimize,scope:e}),T=r[0].closest(".ringbox-inner").querySelector(".player-size"),T&&T.addEventListener("click",o,!1)}),e.$on("$destroy",function(){T&&T.removeEventListener("click",o),T=null})}return{restrict:"E",scope:{onChange:"&",onStart:"&",onEnded:"&",playlist:"="},link:r}}e.module("ringid.global_directives").provider("$player",n).directive("rgPlayer",r),r.$inject=["$compile","$player","$ringbox"]}(angular,window),function(e,t){"use strict";function n(){return function(t,n,r){e.isFunction(r.rgConditionalClick)&&(n.bind("click",function(e){r.rgConditionalClick()}),t.$on("$destroy",function(){n.unbind("click")}))}}function r(e){return{restrict:"A",link:function(t,n,r){function i(e){o(t,{$event:e}),t.$rgDigest()}var o=e(r.rgClick);r.rgClickNoapply;n.bind("click",i),t.$on("$destroy",function(){n.unbind("click",i)})}}}function i(){return{restrict:"A",transclude:!0,link:function(e,t,n){t.on("load",function(){console.log("image loaded")})}}}e.module("ringid.global_directives").directive("rgImgLoad",i).directive("rgClick",r).directive("rgConditionalClick",n),n.$inject=[],r.$inject=["$parse"]}(angular,window),function(e,t){"use strict";function n(){this.findPos=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}},this.findPosType=function(e){var t,n=0;if(e=e.offsetParent)do if(t=getComputedStyle(e,null),"fixed"==t.getPropertyValue("position")){n=1;break}while(e=e.offsetParent);return n},this.tabindex=100,this.$get=["$$q",function(n){function r(r,o){function a(e){e.preventDefault(),e.stopPropagation();var t=e.which||e.keyCode||e.key;if(38==t||40==t){v.showScrollbar();var n=parseFloat(v.dom.scrollbarThumb.style.top),r=o.keyboardSpeedModifier;38==t&&(r=-1*r);var i=n+r;v.scroll(i),v.thumbTimer&&clearTimeout(v.thumbTimer),v.thumbTimer=setTimeout(v.hideScrollbar,1e3)}}function s(e){e.preventDefault();var t,n,r,a=i.findPos(v.dom.scrollbar),s=parseFloat(v.dom.scrollbarThumb.style.top);-1==v.isFixedPosition&&(v.isFixedPosition=i.findPosType(v.dom.element)),t=(v.isFixedPosition?e.clientY:e.pageY)-a.y,n=o.clickSpeedModifier+parseInt(v.scrollHeight/v.offsetHeight/20)*o.clickSpeedModifier,s>t&&(n=-1*n),r=s+n,v.scroll(r,!0,s)}function c(e){if("none"!=v.displayState){e.preventDefault(),v.scrollbarVisible||v.showScrollbar();var t,n,r,i=parseFloat(v.dom.scrollbarThumb.style.top);t=e.wheelDelta?-1/40*e.wheelDelta:3*e.detail,n=Math.max(parseInt(2*v.offsetHeight/v.scrollHeight*o.dragSpeedModifier),1),r=i+t*n,v.scroll(r)}}function l(e){e.preventDefault(),e.stopPropagation(),v.scrollbarVisible||v.showScrollbar(),v.scrollbarMousedown=!0,I=e.pageY,A=parseFloat(v.dom.scrollbarThumb.style.top),document.addEventListener("mousemove",u,!1),document.addEventListener("mouseup",d,!1)}function u(e){var t=A+e.pageY-I;v.scroll(t)}function d(e){e.stopPropagation(),v.scrollbarMousedown=!1,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d)}function g(e){e.preventDefault();var t,n,r=2,i=e.touches[0].clientY,a=parseFloat(v.dom.scrollbarThumb.style.top);n=Math.max(parseInt(2*v.offsetHeight/v.scrollHeight*o.dragSpeedModifier),1),t=i<v.lasty?a+r*n:a-r*n,v.scroll(t),v.lasty=i}function m(){v.hideScrollbar()}function f(){v.showScrollbar()}var E,p,T,h,_,I,A,v=this,S=500,o={scrollbarWidth:o.scrollbarWidth?o.scrollbarWidth:8,scrollbarAlways:o.scrollbarAlways?o.scrollbarAlways:!1,dragSpeedModifier:o.dragSpeedModifier?o.dragSpeedModifier:5,minThumbHeight:o.minThumbHeight?o.minThumbHeight:10,clickSpeedModifier:o.clickSpeedModifier?o.clickSpeedModifier:40,keyboardSpeedModifier:o.keyboardSpeedModifier?o.keyboardSpeedModifier:20,keyboardEvent:o.keyboardEvent?o.keyboardEvent:!1,onBottomReached:o.onBottomReached?o.onBottomReached:!1};this.scrollbarMousedown=!1,this.isFreezed=!1,this.freezeInfo={height:"",position:"",scrollHeight:0},this.scrollbarVisible=!1,this.displayState="none",this.hasScroll=!1,this.lastY=0,this.scrollHeight=0,this.offsetHeight=0,this.visibleHeight=0,this.thumbHeight=0,this.thumbTimer=null,this.mousewheel="undefined"!=typeof InstallTrigger?"DOMMouseScroll":"mousewheel",this.isTouchSupport="ontouchstart"in t||navigator.msMaxTouchPoints,this.isFixedPosition=-1,this.dom=Object.create(null),this.dom.element=r,this.dom.scrollbarContainer=this.dom.element.parentNode,this.dom.wrapper=document.createElement("div"),this.dom.scrollbar=document.createElement("div"),this.dom.scrollbarThumb=document.createElement("div"),this.dom.scrollbar.className="scrollbar",this.dom.scrollbarThumb.className="thumb",this.dom.wrapper.className="ringscroll",this.dom.element.style.overflow="hidden",this.dom.wrapper.setAttribute("style","position:relative;width:auto;overflow:hidden;height:100%;"),this.dom.scrollbar.setAttribute("style","height:100%;right:1px;opacity:0;top:0px;position:absolute;z-index:1;width:"+o.scrollbarWidth+"px"),
this.dom.scrollbarThumb.setAttribute("style","right:1px;top:0px;opacity:0;position:absolute;z-index:1;width:"+o.scrollbarWidth+"px"),this.dom.scrollbarContainer.insertBefore(this.dom.wrapper,this.dom.element),this.dom.wrapper.appendChild(this.dom.element),this.dom.wrapper.appendChild(this.dom.scrollbar),this.dom.wrapper.appendChild(this.dom.scrollbarThumb),this.scroll=function(t,n,r){var i;fastdom.read(function(){v.dom.element&&(v.hiddenHeight=v.scrollHeight-v.offsetHeight,v.visibleHeight=v.offsetHeight-v.thumbHeight,i=t/v.visibleHeight,t=Math.min(Math.max(t,0),v.visibleHeight),n?(_=0,E=v.dom.element.scrollTop,p=v.hiddenHeight*i-E,T=r,h=t-T,v.doAnimation()):fastdom.write(function(){v.dom.element.scrollTop=v.hiddenHeight*i,v.dom.scrollbarThumb.style.top=t+"px"}),t==v.visibleHeight&&o.onBottomReached&&e.isFunction(o.onBottomReached)&&o.onBottomReached())})},this.reCalculate=function(e){var t,r,i=e?n.defer():!1;return fastdom.read(function(){v.dom&&(v.isFreezed&&(v.dom.wrapper.style.height="100%",v.dom.element.style.position=v.freezeInfo.position,v.dom.element.style.height=v.freezeInfo.height,v.dom.element.style.bottom="initial"),v.scrollHeight=v.dom.element.scrollHeight,v.offsetHeight=v.dom.element.offsetHeight,v.hiddenHeight=v.scrollHeight-v.offsetHeight,v.thumbHeight=Math.max(v.offsetHeight/v.scrollHeight*v.offsetHeight,o.minThumbHeight),(isNaN(v.thumbHeight)||"Infinity"==v.thumbHeight)&&(v.thumbHeight=0),v.visibleHeight=v.offsetHeight-v.thumbHeight,v.isFreezed&&(v.dom.element.scrollTop=v.scrollHeight-v.freezeInfo.scrollHeight),t=v.visibleHeight/v.hiddenHeight,r=v.dom.element.scrollTop*t,v.displayState=v.thumbHeight>=v.offsetHeight?"none":"block",v.hasScroll=!(v.thumbHeight>=v.offsetHeight),fastdom.write(function(){v.dom&&(v.dom.scrollbar.style.display=v.displayState,v.dom.scrollbarThumb.style.height=v.thumbHeight+"px",v.dom.scrollbarThumb.style.display=v.displayState,v.dom.scrollbarThumb.style.top=r+"px"),i&&i.resolve(),v.isFreezed=!1}))}),i?i.promise:!1},this.scrollBySelector=function(e,t,n){var r,i,o,a=0,s=null,c=0,l=0,u=0,d=0;n="undefined"!=typeof n&&null!==n?parseInt(n):0,s=this.dom.element.querySelector(e),s&&(i=s.offsetTop,r=s.offsetHeight,l=parseFloat(v.dom.scrollbarThumb.style.top),t&&(a=r),l+this.dom.element.scrollTop<i&&(u=this.dom.element.offsetHeight-r,t&&(a=-1*r)),o=i+a+n-u,d=o/this.hiddenHeight,c=d*this.visibleHeight,this.scroll(c,!0,l))},this.freeze=function(){if(this.hasScroll){var e=this.scrollHeight-(this.dom.element.scrollTop+this.offsetHeight);if(""==this.freezeInfo.height){var t=getComputedStyle(this.dom.element,null);this.freezeInfo.height=t.getPropertyValue("height"),this.freezeInfo.position=t.getPropertyValue("position")}this.freezeInfo.scrollHeight=this.scrollHeight,this.dom.wrapper.style.height=this.offsetHeight+"px",this.dom.element.style.position="absolute",this.dom.element.style.bottom="-"+e+"px",this.dom.element.style.height="auto",this.isFreezed=!0}},this.scrollByPos=function(e,t){var n,r;t="undefined"!=typeof t&&null!==t?t:!1,t&&(r=parseFloat(this.dom.scrollbarThumb.style.top)),e=parseInt(e),n=e*this.visibleHeight/100,this.scroll(n,t,r)},this.scrollTop=function(e){this.scrollByPos(0,e)},this.scrollBottom=function(e){this.scrollByPos(100,e)},this.hideScrollbar=function(){o.scrollbarAlways||v.isFreezed||(v.scrollbarMousedown||(v.dom.scrollbar.style.opacity=0,v.dom.scrollbarThumb.style.opacity=0,v.scrollbarVisible=!1),v.thumbTimer=null)},this.showScrollbar=function(){this.isFreezed||v.reCalculate(),v.dom.scrollbar.style.opacity=1,v.dom.scrollbarThumb.style.opacity=1,v.scrollbarVisible=!0,o.keyboardEvent&&v.dom.element.focus()},this.destroy=function(){this.dom.scrollbarContainer.removeEventListener("mouseenter",f),this.dom.scrollbarContainer.removeEventListener("mouseleave",m),this.dom.scrollbarThumb.removeEventListener("mousedown",l),this.dom.scrollbar.removeEventListener("click",s),this.dom.element.removeEventListener(this.mousewheel,c),this.dom.element.removeEventListener("keydown",a),this.dom.element.removeEventListener("touchmove",g),v=this.dom=null},this.doAnimation=function(){_+=25;var e=Math.easeIn(_,E,p,S),t=Math.easeIn(_,T,h,S);v.dom.element.scrollTop=e,v.dom.scrollbarThumb.style.top=t+"px",S>_&&requestAnimationFrame(v.doAnimation)},this.dom.scrollbarContainer.addEventListener("mouseenter",f,!1),this.dom.scrollbarContainer.addEventListener("mouseleave",m,!1),this.dom.scrollbarThumb.addEventListener("mousedown",l,!1),this.dom.scrollbar.addEventListener("click",s,!1),this.dom.element.addEventListener(this.mousewheel,c,!1),o.keyboardEvent&&(this.dom.element.addEventListener("keydown",a),this.dom.element.setAttribute("tabindex",i.tabindex++)),this.isTouchSupport&&this.dom.element.addEventListener("touchmove",g)}var i=this,o={};return o.create=function(e,t){var n=new r(e,t);return n},o}]}function r(e){function t(t,n,r){if("true"!=r.disabled&&1!=r.disabled){var i={};r.thumbHeight&&parseInt(r.thumbHeight)>0&&(i.minThumbHeight=parseInt(r.thumbHeight)),r.keyboard&&(i.keyboardEvent=!0),t.bottomReached&&(i.onBottomReached=t.bottomReached);var o=e.create(n[0],i);t.$on("scrollTop",function(e){e.stopPropagation&&e.stopPropagation(),setTimeout(function(){o.scroll(0)},100)}),t.$on("scrollTo",function(e,t,n,r){e.stopPropagation&&e.stopPropagation(),"string"==typeof t?o.scrollBySelector(t,n,r):o.scrollByPos(t)}),t.$on("recalculate",function(e){e.stopPropagation&&e.stopPropagation(),o.reCalculate()}),t.$on("hasScroll",function(e,t){e.stopPropagation&&e.stopPropagation(),t.scroll=!o.hasScroll}),t.$on("freeze",function(e,t){e.stopPropagation&&e.stopPropagation(),o.freeze()}),t.$on("$destroy",function(){o.destroy(),o=null})}}return{restrict:"A",scope:{bottomReached:"&"},link:t}}function i(){return{scrollTop:function(e){e.$broadcast("scrollTop")},scrollTo:function(e,t,n,r){e.$broadcast("scrollTo",t,n,r)},recalculate:function(e){e.$broadcast("recalculate")},hasScroll:function(e){e.$broadcast("hasScroll",e)}}}e.module("ringid.global_directives").provider("$scrollbar",n).directive("rgScrollbar",r).factory("rgScrollbarService",i),r.$inject=["$scrollbar"]}(angular,window),function(e,t){"use strict";function n(t){function n(e){var t=e.keyCode||e.which;27===t&&o.close(e)}function r(){a&&e.isFunction(a.ddBeforeClose)&&a.ddBeforeClose(),s(),t.unbindHandler("document","click",o.close),t.unbindHandler("document","keydown",n)}function i(){a.ddOpened(),t.bindHandler("document","click",o.close),t.bindHandler("document","keydown",n)}var o=this,a=!1,s=!1;o.open=function(e,t){s&&r(),s=e,a=t,i()},o.close=function(e){e&&(e.preventDefault(),e.stopPropagation()),s&&r(),s=!1,a=!1}}function r(e,t,n,r,i,o,a){function s(t,o){function a(e){e.stopPropagation()}function s(e){E?r.close():(d(e),r.open(g,t)),a(e)}function c(e){setTimeout(function(){p?RingLogger.information("IS ON DROPDOWN",RingLogger.tags.DROPDOWN):(RingLogger.information("NOT ON DROPDOWN",RingLogger.tags.DROPDOWN),s(e))},500)}function l(e){RingLogger.information("Mouse Enter",RingLogger.tags.DROPDOWN),p=!0,o.off("mouseleave",c)}function u(e){RingLogger.information("Mouse Leave",RingLogger.tags.DROPDOWN),p=!1,c(e),o.on("mouseleave",c)}function d(e){RingLogger.information("DROPDOWN OPEN",RingLogger.tags.DROPDOWN),E=!0,m=n(f)(t),t.ddControl&&t.ddControl.hasOwnProperty("append")&&!t.ddControl.append?o.after(m):o.append(m);for(var r=0;r<m.length;r++)m[r].addEventListener("click",a);t.ddControl&&t.ddControl.showOnHover&&(o[0].addEventListener("mouseleave",c),m[m.length-1].addEventListener("mouseenter",l),m[m.length-1].addEventListener("mouseleave",u)),t.$rgDigest()}function g(){var e;for(E=!1,e=0;e<m.length;e++)m[e].removeEventListener("click",a);t.ddControl&&t.ddControl.showOnHover&&(o[0].removeEventListener("mouseleave",c),m[m.length-1].removeEventListener("mouseenter",l),m[m.length-1].removeEventListener("mouseleave",u)),m.remove(),t.$parent.$rgDigest()}var m,f,E=!1,p=!1;t.consType=i.get(),o.on("click",s),t.ddHtml||t.ddTemplate?t.ddTemplate?f=t.ddTemplate:e.get(t.ddHtml).success(function(e){f=e}).error(function(){RingLogger.warning("DROPDOWN TEMPLATE missing: "+t.ddHtml,RingLogger.tags.DROPDOWN),t.$rgDigest()}):RingLogger.error("Please set ddHtml for rg-dropdown.",RingLogger.tags.DROPDOWN),t.$on("$destory",function(){o[0].removeEventListener("click",s),g()})}return{restrict:"AE",link:s,scope:{ddHtml:"=",ddControl:"=",ddTemplate:"=",ddAction:"&",ddOpened:"&",ddBeforeClose:"&"}}}e.module("ringid.global_directives").service("rgDropdownService",n).directive("rgDropdown",r),n.$inject=["GlobalEvents"],r.$inject=["$ringhttp","settings","$compile","rgDropdownService","languageConstant","Utils","rgScrollbarService"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){function i(){a=setInterval(function(){var e=l();n.setPageTitle(n.getCurrentPageTitle()===e?c:e)},s)}function o(){clearInterval(a),n.setPageTitle(u())}var a,s=1e3,c=n.getCurrentPageTitle(),l=function(){var e=t.getUnreadConversationCount();return e>0?"("+e+") "+c:c},u=l;return e.$on("ringActive",o),e.$on("ringInactive",i),e.$on("PAGE_TITLE_CHANGE",function(e,t){RingLogger.print("page title changes",t.title,RingLogger.tags.PAGETITLE),c=t.title}),n.onCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){n.setPageTitle(u())}),n.onCustomEvent(r.CHAT.CONVERSATION_COUNT_RESETED,function(){n.setPageTitle(u())}),{}}e.module("ringid.global_directives").directive("rgPageTitle",n),n.$inject=["$rootScope","chatHistoryFactory","Utils","SystemEvents"]}(angular,window),function(e,t){"use strict";e.module("ringid.social",[])}(angular,window),function(e,t){"use strict";e.module("ringid.social").service("socialUtils",function(){var t=this;t.camelCase=function(e){return e.replace(/([\:\-\_]+(.))/g,function(e,t,n,r){return r?n.toUpperCase():n})},t.parseQueryString=function(t){var n,r,i={};return e.forEach((t||"").split("&"),function(t){t&&(r=t.split("="),n=decodeURIComponent(r[0]),i[n]=e.isDefined(r[1])?decodeURIComponent(r[1]):!0)}),i},t.joinUrl=function(e,t){if(/^(?:[a-z]+:)?\/\//i.test(t))return t;var n=[e,t].join("/"),r=function(e){return e.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return r(n)},t.merge=function(e,n){var r={};for(var i in e)e.hasOwnProperty(i)&&(i in n&&"object"==typeof e[i]&&null!==i?r[i]=t.merge(e[i],n[i]):r[i]=e[i]);for(i in n)if(n.hasOwnProperty(i)){if(i in r)continue;r[i]=n[i]}return r}})}(angular,window),function(e,t){"use strict";e.module("ringid.social").constant("socialConfig",{providers:{facebook:{name:"facebook",url:"/auth/facebook",clientId:"477404429103451",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:t.location.origin+"/static-index.html",requiredUrlParams:["access_code"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:680,height:500}},twitter:{twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:t.location.origin+"/static-index.html",type:"1.0",serverUrl:t.location.origin+"/TwiteerLoginService",popupOptions:{width:595,height:745}}}})}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o){var a={};return a.url="",a.popupWindow=null,a.open=function(e,t,n){a.url=e;var o=a.stringifyOptions(a.prepareOptions(n)),s=r.navigator.userAgent,c=i.cordova||s.indexOf("CriOS")>-1?"_blank":t;return a.popupWindow=r.open(e,c,o),r.popup=a.popupWindow,a.popupWindow&&a.popupWindow.focus&&a.popupWindow.focus(),a},a.eventListener=function(n){var r=t.defer();return a.popupWindow.addEventListener("loadstart",function(t){if(0===t.url.indexOf(n)){var i=document.createElement("a");if(i.href=t.url,i.search||i.hash){var s=i.search.substring(1).replace(/\/$/,""),c=i.hash.substring(1).replace(/\/$/,""),l=o.parseQueryString(c),u=o.parseQueryString(s);e.extend(u,l),u.error||r.resolve(u),a.popupWindow.close()}}}),a.popupWindow.addEventListener("loaderror",function(){r.reject({rc:0,mg:"Error Loading Authorization URL"})}),a.popupWindow.addEventListener("onbeforeunload",function(){r.reject({rc:0,mg:"Popup closed unexpectedly"})}),r.promise},a.pollPopup=function(){var r=t.defer(),i=n(function(){try{var t=document.location.host,s=a.popupWindow.location.host;if(s===t&&(a.popupWindow.location.search||a.popupWindow.location.hash)){var c=a.popupWindow.location.search.substring(1).replace(/\/$/,""),l=a.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),u=o.parseQueryString(l),d=o.parseQueryString(c);e.extend(d,u),d.error?r.reject(d):r.resolve(d),n.cancel(i),a.popupWindow.close()}}catch(g){}a.popupWindow&&!a.popupWindow.closed&&void 0!==a.popupWindow.closed||n.cancel(i)},50);return r.promise},a.prepareOptions=function(t){t=t||{};var n=t.width||500,i=t.height||500;return e.extend({width:n,height:i,left:r.screenX+(r.outerWidth-n)/2,top:r.screenY+(r.outerHeight-i)/2.5},t)},a.stringifyOptions=function(t){var n=[];return e.forEach(t,function(e,t){n.push(t+"="+e)}),n.join(",")},a}e.module("ringid.social").factory("socialPopup",t),t.$inject=["$$q","$interval","$window","socialConfig","socialUtils"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n){var r={};return r.authenticate=function(r,i){var o="1.0"===e.providers[r].type?new t:new n;return o.open(e.providers[r],i)},r}function r(t,n,r,i,o,a,s){return function(){function n(){var t=[],n=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return e.forEach(n,function(n){e.forEach(c[n],function(n){var i=r.camelCase(n),o=e.isFunction(c[n])?c[n]():c[i];t.push([n,o])})}),t.map(function(e){return e.join("=")}).join("&")}var i={},c={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"token",responseParams:{token:"token",clientId:"clientId",redirectUri:"redirectUri"}};return i.open=function(r,i){var l=t.defer();c=e.extend({},r,c);var u,d,g=c.name+"_state";e.isFunction(c.state)?o.setData(g,c.state()):e.isString(c.state)&&o.setData(g,c.state),u=[c.authorizationEndpoint,n(i)].join("?"),RingLogger.information("authorization url: "+u,RingLogger.tags.AUTH),d=a.open(u,c.name,c.popupOptions,c.redirectUri);var m=setInterval(function(){d.popupWindow.closed&&(clearInterval(m),l.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return d.pollPopup().then(function(e){clearInterval(m),s.get("https://graph.facebook.com/me?access_token="+e.access_token).success(function(t){RingLogger.information("SOCIAL USER DATA: ",RingLogger.tags.AUTH),RingLogger.print(t,RingLogger.tags.AUTH),t.id?l.resolve({platform:c.name,id:t.id,name:t.name,access_token:e.access_token}):l.reject()}).error(function(){l.reject()})},function(){l.reject({mg:"Popup blocked by Browser. Please unblock."})}),l.promise},i}}function i(t,n,r,i,o){return function(){function n(e,t){t.uId=t.uId.toString();var n="?step=3&oauth_token="+e.oauth_token+"&verifier="+e.oauth_verifier+(t.uId&&t.uId.length>2?"&uId="+t.uId:"")+"&time="+(new Date).getTime();return RingLogger.information("exhcangeForToken URL: "+c.serverUrl+n,RingLogger.tags.AUTH),o.get(c.serverUrl+n)}function r(){return RingLogger.information("exchangeForRequest URL: "+c.serverUrl+"?step=1&callback="+c.redirectUri,RingLogger.tags.AUTH),o.get(c.serverUrl+"?step=1&callback="+encodeURIComponent(c.redirectUri)+"&time="+Date.now())}function a(t){var n=[];return e.forEach(t,function(e,t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.join("&")}var s={},c={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return s.open=function(o,s){var l,u=t.defer();e.extend(c,o),RingLogger.print(c,RingLogger.tags.AUTH),l=i.open("",c.name,c.popupOptions,c.redirectUri);var d=setInterval(function(){l.popupWindow.closed&&(clearInterval(d),u.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return r().success(function(e){if(e.sucs===!0){var t=e.data,r=[c.authorizationEndpoint,a({oauth_token:t.token,callback_url:c.redirectUri})].join("?");l.popupWindow?(l.popupWindow.location=r,RingLogger.information("TWITTER authorize url: "+r,RingLogger.tags.AUTH),RingLogger.print("REQUEST TOKEN DATA: ",t,RingLogger.tags.AUTH),l.pollPopup().then(function(e){clearInterval(d),n(e,s).success(function(t){if(t.sucs===!0||2===t.rc){var n=t.data.members;RingLogger.print("ACCESS TOKEN DATA: ",e,n,RingLogger.tags.AUTH);var r=JSON.parse(n.userDetails),i=JSON.parse(n.accessToken);u.resolve({platform:c.name,id:r.id_str,name:r.name,access_token:i.token,oauthParameters:i.oauthParameters,oauth_token:e.oauth_token,oauth_verifier:e.oauth_verifier})}else u.reject({mg:"exchangeForRequest failed"})}).error(function(){u.reject({mg:"exchangeForRequest failed. Server error"})})})):u.reject({mg:"Popup blocked by Browser. Please unblock."})}else u.reject({mg:"exchangeForRequest failed"})}).error(function(){RingLogger.alert("twitter oauth request token fetch fail",RingLogger.tags.AUTH),u.reject({mg:"exchangeForRequest failed. Server error"})}),u.promise},s}}e.module("ringid.social").factory("socialOauth",n).factory("socialOauth1",i).factory("socialOauth2",r),n.$inject=["socialConfig","socialOauth1","socialOauth2"],r.$inject=["$$q","$window","socialUtils","socialConfig","Storage","socialPopup","$ringhttp"],i.$inject=["$q","socialConfig","socialUtils","socialPopup","$ringhttp"]}(angular,window),function(e,t){"use strict";e.module("ringid.social").provider("$authSocial",["socialConfig",function(t){e.forEach(Object.keys(t.providers),function(n){this[n]=function(r){return e.extend(t.providers[n],r)}},this);var n=function(n){t.providers[n.name]=t.providers[n.name]||{},e.extend(t.providers[n.name],n)};this.oauth1=function(e){n(e),t.providers[e.name].type="1.0"},this.oauth2=function(e){n(e),t.providers[e.name].type="2.0"},this.$get=["$$q","socialOauth",function(e,t){var n={};return n.login=function(n){var r,i=e.defer();return r?i.resolve(r):t.authenticate(n,"login").then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},n.authenticate=function(n,r){var i=e.defer();return t.authenticate(n,r).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},n}]}])}(angular,window),function(e,t){"use strict";e.module("ringid.auth",["ringid.config","ringid.digits","ringid.connector","ringid.social"])}(angular,window),function(e,t){"use strict";e.module("ringid.auth").directive("rgSlider",function(){return{link:function(t,n,r){function i(){for(C.removeClass("active"),C.eq(E).addClass("active"),D.removeClass("active"),D.eq(E).addClass("active"),f=0;f<h.length;f++)h[f].find("li").removeClass("active"),h[f].find("li").eq(E).addClass("active");L[0]&&u(m(E)),p&&(E=E+1==C.length?0:E+1,o())}function o(){T=setTimeout(function(){i()},S)}function a(){clearTimeout(T)}function s(e){for(var t=e.parentNode.childNodes,n=0,r=0;r<t.length;r++){if(t[r]==e)return n;1==t[r].nodeType&&n++}return-1}function c(){var t;for(f=0;f<N.length;f++)t=e.element(N[f]),h.push(t),t.find("li").on("click",function(e){E=s(this),a(),i()});C.on("mouseenter",function(e){e.stopPropagation(),p=!1,a()}),C.on("mouseleave",function(e){e.stopPropagation(),p=!1,o()}),D.on("mouseenter",function(e){e.stopPropagation(),p=!1,a()}),D.on("mouseleave",function(e){e.stopPropagation(),p=!1,o()})}function l(){var e,t,n,r,o,s,c;for(e=P[0].clientWidth,t=P[0].clientHeight,n=1,r=Math.round(U/2)-Math.round(e/2),o=Math.round(w/2)-Math.round(t/2),L[F]={w:e,h:t,o:n,l:r,t:o,z:F,i:0},c=M,s=F,f=F+1;f<P.length;f++)c*=R,e=y*L[f-1].w,t=y*L[f-1].h,n=O*L[f-1].o,r=L[f-1].l+L[f-1].w+c-e,--s,o=Math.round(w/2)-Math.round(t/2),L[f]={w:e,h:t,o:n,l:r,t:o,z:s,i:f};for(c=M,s=F,f=F-1;f>=0;f--)c*=R,e=y*L[f+1].w,t=y*L[f+1].h,n=O*L[f+1].o,r=L[f+1].l-c,--s,o=Math.round(w/2)-Math.round(t/2),L[f]={w:e,h:t,o:n,l:r,t:o,z:s,i:f};for(f=0;f<P.length;f++)P[f].orgPos=f,P[f].crslPos=f,P[f].addEventListener("click",function(e){this.crslPos!=F&&(E=this.orgPos,a(),i(),u(this))})}function u(e){d(e),g()}function d(e){for(var t,n=e.crslPos<F?"forward":"backward";e.crslPos!=F;)for("forward"==n?(t=P.pop(),P.unshift(t)):(t=P.shift(),P.push(t)),f=0;f<P.length;f++)P[f].crslPos=f,P[f].className="";e.className="active"}function g(){for(f=0;f<P.length;f++)P[f].style.width=L[f].w+"px",P[f].style.height=L[f].h+"px",P[f].style.opacity=L[f].o,P[f].style.left=L[f].l+"px",P[f].style.top=L[f].t+"px",P[f].style.zIndex=L[f].z,L[f].i=f}function m(e){for(f=0;f<P.length;f++)if(e==P[f].orgPos)return P[f]}var f,E=0,p=!1,T=null,h=[],_=n[0],I=r.navClass||"",A=r.slideClass||"",v=r.descClass||"",S=1e3*parseInt(r.delay)||3e3,C=e.element(_.querySelectorAll("."+A)),D=e.element(_.querySelectorAll("."+v)),N=_.querySelectorAll("."+I)||{},M=120,R=.6,y=.6,O=.8,b=_.querySelector(".nav-carousel"),P=b.querySelectorAll("img");P=Array.prototype.slice.call(P);var L=[],U=b.clientWidth,w=b.clientHeight,F=Math.floor(P.length/2);c(),i(),P[0].src=P[0].src,P[0].addEventListener("load",function(){l(),u(P[0]),setTimeout(function(){b.style.visibility="visible"},800)})}}})}(angular,window),function(e,t){"use strict";function n(e,n,r,i,o,a,s,c,l){function u(e,t,n){e?(i.disableForm=!1,e.sucs===!0||"true"===e.sucs?(i.requestSuccess=!0,i.errorMsg=e.mg||l.REQUEST_PROCESSED):(i.requestSuccess=!1,i.errorMsg=e.hasOwnProperty("rc")&&e.rc>0?l["RC"+e.rc]:e.mg||l.REQUEST_FAILED,c.analytics&&ga("send","event",t+" Message:"+i.errorMsg+" RC:"+e.rc||"UNKNOWN")),n&&s.show(i.errorMsg,"error")):(i.disableForm=!0,i.requestSuccess=!0,i.errorMsg=""),i.$rgDigest()}function d(e){if(!i.disableForm){switch(i.errorMsg="",i.activeTab=e,i.activeTab){case"email":i.credentials.authMethod="email",i.formStyle.left="-800px",i.credentials.lt=3;break;case"ringid":i.credentials.authMethod="ringid",i.formStyle.left="-400px",i.credentials.lt=1;break;case"facebook":i.credentials.authMethod="social",i.formStyle.left="-1200px",i.credentials.lt=4;break;case"twitter":i.credentials.authMethod="social",i.formStyle.left="-1200px",i.credentials.lt=5;break;case"social":i.credentials.authMethod="social",i.formStyle.left="-1200px";break;default:i.credentials.authMethod="phone",i.formStyle.left="0px",i.credentials.lt=2}i.$rgDigest()}}function g(t){t.event&&e.close(t.event),n.setData("country",t.item),i.credentials.mblDc=t.item.code,i.credentials.flagcode=t.item.flagcode,i.$rgDigest()}function m(e,n){if(n&&n.preventDefault(),e){switch(i.credentials.authMethod){case"ringid":i.credentials.username=i.credentials.ringid;break;case"email":i.credentials.username=i.credentials.email;break;case"phone":i.credentials.username=i.credentials.mbl}i.requestFailed(!1),r.login(i.credentials).then(function(e){e.sucs===!0||"true"===e.sucs?i.params&&i.params.fromPopup?(i.closeAll(),t.location="/"):a.$rgDigest():i.requestFailed(e,"Signin:"+i.credentials.authMethod)},function(e){i.requestFailed(e,"Signin:"+i.credentials.authMethod)})}}function f(){var e=n.getData("activeTab");if(e){var t=n.getData("autoFill");switch(e){case"phone":i.credentials.mbl=t,i.credentials.username=t,i.credentials.lt=2;break;case"email":i.credentials.lt=3,i.credentials.email=t,i.credentials.username=t;break;case"ringid":i.credentials.ringid=t,i.credentials.username=t,i.credentials.lt=1}d(e)}i.$rgDigest()}i.requestFailed=u,i.activeTab="phone",i.credentials={username:"",authMethod:"phone",uId:"",lt:2,mbl:"",email:"",ringid:"",password:"",remember:!!n.getData("remember"),mblDc:r.getCountry().code,flagcode:r.getCountry().flagcode},i.autofill={email:i.credentials.email,ringid:i.credentials.ringid,mbl:i.credentials.mbl},i.errorMsg="",i.requestSuccess=!1,i.disableForm=!1,i.formStyle={left:"0px"},i.activateTab=d,i.setPrefix=g,i.login=m,i.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" ><li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',i.ddControl={append:!1,countryList:r.getCountryList},f()}e.module("ringid.auth").controller("AuthController",n),n.$inject=["rgDropdownService","Storage","Auth","$scope","$$connector","$rootScope","Ringalert","settings","MESSAGES"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){e.close=t.close,e.closeAll=t.closeAll,e.showLoader=t.showLoader,e.hideLoader=t.hideLoader,e.params=r,n("SignInController",{$scope:e})}e.module("ringid.auth").controller("RingboxAuthController",n),n.$inject=["$scope","$boxInstance","$controller","localData"]}(angular,window),function(e,t){"use strict";function n(n,r,i,o,a,s){function c(r){n.authenticate(r,i.credentials).then(function(n){i.params&&i.params.fromPopup&&i.showLoader(),o.login(e.extend(n,i.credentials),!0).then(function(){ga("send","event","Signin Success. ","Auth Method: "+r),i.params&&i.params.fromPopup?(boxInstance.hideLoader(),t.location="/"):s.$rgDigest()},function(e){switch(i.params&&i.params.fromPopup&&boxInstance.hideLoader(),e.rc){case"invalidsocialid":i.requestFailed(e,r+": Unregistered Social ID",!0);break;default:i.requestFailed(e,r+": Something went wrong",!0)}})},function(e){i.params&&i.params.fromPopup&&boxInstance.hideLoader(),i.requestFailed(e,r+": Authentication Failed",!0)})}e.extend(this,r("AuthController",{$scope:i})),i.noSignupAllowed=function(){a.alert({title:"Sign Up",message:"Please sign up from your iOS, Android, Windows enabled device or Desktop prior to logging in from the Web version.",showCancel:!1,okCallback:e.noop})},i.socialLogin=function(e){i.credentials.authMethod=e,c("twitter"===e?e:e)}}e.module("ringid.auth").controller("SignInController",n),n.$inject=["$authSocial","$controller","$scope","Auth","Ringalert","$rootScope"]}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c,l){function u(r,i){i.preventDefault(),n.disableForm||(n.requestFailed(!1),t.sendCode(n.credentials).then(function(e){e.sucs===!0&&(n.credentials.uId=e.uId,n.newUid=e.uId.toString().substr(2),n.signupStep=2,n.formStyle.left="-350px"),n.requestFailed(e,"Signup:sendcode")},function(t){n.requestFailed(e.extend(t,{sucs:!1}),"Signup:sendcode")}))}function d(r,i){i.preventDefault(),n.disableForm||(n.requestFailed(!1),t.verifyCode(n.credentials).then(function(e){e.sucs===!0&&(n.signupStep=3,n.formStyle.left="-700px"),n.requestFailed(e,"Signup:verify")},function(t){n.requestFailed(e.extend(t,{sucs:!1}),"Signup:verify")}))}function g(r,o){o.preventDefault(),n.disableForm||n.credentials.password!==n.credentials.repassword||(n.requestFailed(!1),t.signup(n.credentials).then(function(e){e.sucs===!0&&(n.login(!0),i.closeAll()),n.requestFailed(e,"Signup:sendCode")},function(t){n.requestFailed(e.extend(t,{sucs:!1}),"Signup:signup")}))}e.extend(this,r("AuthController",{$scope:n})),n.close=i.close,n.closeAll=i.closeAll,n.newUid="",n.credentials.repassword="",n.credentials.vc="",n.credentials.name="",n.signupStep=1,n.sendCode=u,n.verifyCode=d,n.signup=g,s&&(n.formStyle.left="0px",n.credentials.mbl="",n.credentials.email="",n.credentials.ringid="",n.credentials.password="",s.signupData&&(n.credentials.authMethod=s.signupData.signupType,n.credentials.flagcode=s.signupData.flagcode),s.socialData&&(e.extend(n.credentials,s.credentials),n.newUid=s.credentials.uId.toString().substr(2),n.credentials.authMethod=s.socialData.platform,n.credentials.id=s.socialData.id,n.credentials.name=s.socialData.name,n.credentials.access_token=s.socialData.access_token,n.signupStep=3,n.formStyle.left="-700px")),a&&(n.newUid=a.uId.toString().substr(2))}e.module("ringid.auth").controller("SignUpController",n),n.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","remoteData","localData","Storage","rgDropdownService"]}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a){e.extend(this,r("AuthController",{$scope:n})),n.close=i.close,n.closeAll=i.closeAll,n.socialSignup=function(r){i.showLoader(),t.sendCode(n.credentials,!0).then(function(){o.authenticate(r,n.credentials).then(function(o){t.openSignup(o,n.credentials).then(e.noop,function(a){"dologin"===a.rc?(n.credentials.authMethod=r,i.showLoader(),t.login(e.extend(o,n.credentials),!0).then(function(){n.closeAll()},function(e){i.hideLoader(),n.requestFailed(e,r+": Social Login Failed",!0)})):(i.hideLoader(),n.requestFailed(a,r+": Authentication Failed",!0))})},function(e){i.hideLoader(),n.requestFailed(e,r+": Authentication Failed",!0)})},function(e){i.hideLoader(),n.requestFailed(e,r+": Authentication Failed",!0)})},n.signupData=function(e){return{data:function(){return{signupData:{signupType:e,code:"phone"===e?t.getCountry().code:"Email",flagcode:"phone"===e?t.getCountry().flagcode:"remail"}}},promise:t.sendCode(n.credentials)}}}e.module("ringid.auth").controller("SignUpSelectController",n),n.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","Ringalert"]}(angular,window),function(e,t){"use strict";function n(t,n,r,i){function o(e){r.verifierEnabled=!1,n.fetchRecoverOptions(e).then(function(e){RingLogger.print(e,RingLogger.tags.AUTH),e.sucs===!0&&(r.activeForm="resetpassword",e.sgtns.forEach(function(e){/^21/.test(e)&&(r.credentials.uId=e)})),r.requestFailed(e,"Recovery:verify")},function(e){RingLogger.print(e,RingLogger.tags.AUTH)})}function a(t,i){i.preventDefault(),r.disableForm||r.credentials.password!==r.credentials.repassword||(r.requestFailed(!1),RingLogger.information(r.credentials,RingLogger.tags.AUTH),n.resetPassword(r.credentials).then(function(e){RingLogger.print(e,RingLogger.tags.AUTH),r.disableForm=!1,r.errorMsg=e.mg,e.sucs===!0&&r.close(),r.requestFailed(e,"Recovery:reset")},function(t){r.requestFailed(e.extend(t,{sucs:!1}),"Recovery:reset")}))}function s(e){r.disableForm||"sendcode"!==r.activeForm||(r.activeTab=e,"email"===r.activeTab?(r.credentials.authMethod="email",r.formStyle.left="0px"):(r.credentials.authMethod="phone",r.formStyle.left="-350px"),r.$rgDigest())}function c(t,i,o){u=o,i.preventDefault(),r.disableForm||(r.requestFailed(!1),RingLogger.information(r.credentials,RingLogger.tags.AUTH),n.recoverySendCode(r.credentials,u).then(function(e){e.sucs===!0&&(r.activeForm="verifycode",r.credentials.uId=e.uId),r.requestFailed(e,"phone")},function(t){r.requestFailed(e.extend(t,{sucs:!1}),"phone")}))}function l(t,i){i.preventDefault(),r.disableForm||(r.requestFailed(!1),RingLogger.information(r.credentials,RingLogger.tags.AUTH),n.recoveryVerifyCode(r.credentials).then(function(e){e.sucs===!0&&(r.activeForm="resetpassword"),r.requestFailed(e,"Recovery:verify")},function(t){r.requestFailed(e.extend(t,{sucs:!1}),"Recovery:verify")}))}e.extend(this,t("AuthController",{$scope:r})),r.close=i.close;var u;r.activeTab="email",r.activeForm="sendcode",r.activateTab=s,r.activateTab(r.activeTab),r.credentials.email="",r.credentials.mbl="",r.fetchRecoverOptions=o,r.sendCode=c,r.verifyCode=l,r.resetPassword=a,r.verifierEnabled=!1,r.enableVerifier=function(){r.verifierEnabled=!0}}e.module("ringid.auth").controller("PasswordRecoverController",n),n.$inject=["$controller","Auth","$scope","$boxInstance"]}(angular,window),function(e,t){"use strict";e.module("ringid.filters",["ringid.config"])}(angular,window),function(e,t){"use strict";!function(){function t(e){return function(t){return t.indexOf("prof.png")>0?t:e.imBase+t}}function n(){return function(e,t){if(e){for(var n=0;n<e.length;n++)t.get(e[n].key)&&console.log("got a matching item:"+e[n].key);return e}}}function r(e){return function(t,n){if(t){for(var r=[],i=n.name.toLowerCase(),o=0;o<t.length;o++)n.showMutual&&t[o].value.friendshipStatus()!==e.FRIEND||(0===i.length||t[o].value.getName().toLowerCase().indexOf(i)>-1)&&r.push(t[o]);return r}}}function i(){return function(e,t){if(e){for(var n=[],r=0;r<e.length;r++)t.get(e[r].value.getKey())||n.push(e[r]);return n}}}function o(){return function(e){var t=new Date(e),n=""+(t.getMonth()+1),r=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),[i,n,r].join("-")}}function a(){return function(e,t){if(e){for(var n=[],r=0;r<e.length;r++)e[r].value.getType()===t&&n.push(e[r]);return n}}}function s(){return function(e,t){
if(e){for(var n=[],r=t.value?t.value.toLowerCase():"",i=0;i<e.length;i++)e[i].value[t.mapApi]().toLowerCase().indexOf(r)>-1&&n.push(e[i]);return n}}}function c(){function e(e,t){return e.indexOf(t)>-1}function t(e,t){return t===e}return function(n,r){var i,o=[];if(n&&n.length>0){switch(r.compare){case"string":i=e;break;default:i=t}for(var a=0;a<n.length;a++)i(n[a][r.prop],r.value)&&o.push(n[a]);return o}}}function l(e){return function(t,n){return e.trustAs(n||"html",t)}}e.module("ringid.filters",["ringid.config"]).filter("validProfileImage",t).filter("friendListFilter",r).filter("mapListFilter",i).filter("stackMapFilter",n).filter("ymdDateFilter",o).filter("mediaFilter",a).filter("mapFilter",s).filter("objectFilter",c).filter("trust",l),t.$inject=["settings"],r.$inject=["APP_CONSTANTS"],l.$inject=["$sce"]}()}(angular,window),function(e,t){"use strict";e.module("ringid.shared",["ringid.filters","ringid.auth","ringid.global_services","ringid.config"])}(angular,window),function(e,t){"use strict";!function(){function t(e,t){return{create:function(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};return{getKey:function(){return o.id},src:function(){return o.src},symbol:function(){return o.symbol},getName:function(){return o.name},srcWithoutBase:function(){return o.src.replace(e.stickerBase,"")},isEmoticon:function(){return o.isEmoticon},isLargeEmoticon:function(){return o.isLargeEmoticon},isSticker:function(){return o.isSticker}}}}}function n(e,t,n){return{create:function(r,i){var o=n.stickerBase+r.collectionId+"/"+r.categoryId+"/";RingLogger.information("$$stickerMap",RingLogger.tags.STICKER),RingLogger.print(r,RingLogger.tags.STICKER);for(var a,s={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+o+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":o+"ca.png",installed:i||!1},c=0;c<r.imageList.length;c++)a=t.create(r.imageList[c],s.type,o),s.imageListMap.add(a.getKey(),a);return{sortBy:function(){return s.categoryId},isInstalled:function(){return s.installed},setInstalled:function(e){s.installed=e},isEmoticon:function(){return s.isEmoticon},isLargeEmoticon:function(){return s.isLargeEmoticon},isSticker:function(){return s.isSticker},getKey:function(){return s.categoryId},getImages:function(){return s.imageListMap},getType:function(){return s.type},link:function(){return s.regularUrl},hoverLink:function(){return s.hoverUrl}}}}}e.module("ringid.shared").factory("$$stickerMap",n).factory("$$stickerImageMap",t),t.$inject=["settings","STICKER_IMAGE_TYPE"],n.$inject=["$$stackedMap","$$stickerImageMap","settings"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i){return{create:function(o){function a(){}function s(e){var t=d.memberIds.indexOf(e);-1!==t&&d.memberIds.splice(t,1)}function c(e){var t=d.adminIds.indexOf(e);-1!==t&&d.adminIds.splice(t,1)}function l(){d.mc=d.allMembersMap.length()}function u(t){e.extend(d,t)}var d={gNm:"",grpId:0,ists:0,sAd:"",ut:0,mc:"",mt:"",groupMembers:"",memberList:[],members:{},allMembersMap:n.createNew(),adminIds:[],memberIds:[]};e.isObject(o)&&(d=e.extend({},d,o));var g={sortBy:function(){return d.gNm.toLowerCase()},update:u,addMember:function(e,n){var r=t.create(e);d.allMembersMap.save(r.getKey(),r),n?g.promoteToAdmin(r.getKey()):g.removeFromAdmin(r.getKey()),l()},isAdmin:function(){return 1===d.mt},isMember:function(){return 0===d.mt},isSuperAdmin:function(e){return d.sAd===e},getSuperAdminUId:function(){return d.sAd},promoteToAdmin:function(e){c(e),d.adminIds.push(e),d.allMembersMap.get(e).setGroupAdmin(d.grpId),a()},removeFromAdmin:function(e){s(e),d.memberIds.push(e),d.allMembersMap.get(e).removeGroupAdmin(d.grpId),a()},getAdmins:function(){for(var e=d.allMembersMap.copy(),t=0;t<d.memberIds.length;t++)e.remove(d.memberIds[t]);return e},getMember:function(e){return d.allMembersMap.get(e)},getMembers:function(){for(var e=d.allMembersMap.copy(),t=0;t<d.adminIds.length;t++)e.remove(d.adminIds[t]);return e},setMembers:function(n){e.forEach(n,function(e){if(!e.ists){var n=t.create(e);d.allMembersMap.save(n.getKey(),n),e.admin?-1!==d.adminIds.indexOf(n.getKey())?d.adminIds.push(n.getKey()):g.promoteToAdmin(n.getKey()):-1!==d.memberIds.indexOf(n.getKey())?d.memberIds.push(n.getKey()):g.removeFromAdmin(n.getKey())}}),a()},resetMembers:function(){d.allMembersMap.reset(),d.adminIds=[],d.memberIds=[]},removeMember:function(e){var t;t=d.allMembersMap.remove(e),s(e),c(e),l()},getAllMembers:function(){return d.allMembersMap},getMemberIds:function(){return d.memberIds.slice()},getAdminIds:function(){return d.adminIds.slice()},getMembersObjectCount:function(){return d.allMembersMap.length()},getMembersCount:function(){return d.mc},getMemberType:function(){return d.mt},setMemberCount:function(e){d.mc=e},getLink:function(e){return e=e||"",r.baseUrl+i.getRingRoute("CIRCLE_HOME",{circleId:d.grpId,subpage:e})},getLinkOnly:function(e){return e=e||"",i.getRingRoute("CIRCLE_HOME",{circleId:d.grpId,subpage:e}).slice(1)},getKey:function(){return d.grpId},getName:function(){return d.gNm},getAnchor:function(){return'<a class="cir-title" href="/#/circle/'+d.grpId+'" >'+d.gNm+"</a>"}};return g}}}e.module("ringid.shared").factory("circleMap",t),t.$inject=["userFactory","$$stackedMap","settings","Utils"]}()}(angular,window),function(e,t){"use strict";function n(t,n,r,i){function o(e,t){var n=this;e=e||{},t&&(n._u=t),n.updateImage(e),Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.image.imgId,showReportButton:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"image"}}})}var a={albId:"",albn:"",cptn:"",nfId:0,ic:0,ih:0,il:0,imT:0,imgId:0,iurl:"",iw:0,nc:0,nl:0,tm:0,user:null};return o.prototype={updateImage:function(t,n){this.image?e.extend(this.image,t):this.image=e.extend({},a,t),t=null,this.key="im"+this.image.imgId,this.image.tm?this._time=i.verbalDate(this.image.tm):this._time={},!this._u&&this.image.hasOwnProperty("uId")&&(this._u=r.create({uId:this.image.uId,fn:this.image.fn||""}))},user:function(){return this._u},src:function(e){if("iurl"===e)return this.image.iurl;var n=this.image.iurl.lastIndexOf("/")+1,r=/\/uploaded\//.test(this.image.iurl)?"":"p";return void 0!==e?[t.imBase,this.image.iurl.slice(0,n),r,e,this.image.iurl.slice(n)].join(""):[t.imBase,this.image.iurl.slice(0,n),r,this.image.iurl.slice(n)].join("")},getByProperty:function(e,t){return t=t||!1,this.image.hasOwnProperty(e)?user[e]:t},sortBy:function(){return this.image.imgId},getIh:function(){return this.image.ih},getIw:function(){return this.image.iw},sortByTime:function(){return this.image.tm},getAlbumName:function(){return this.image.albn},getAlbumId:function(){return this.image.albId},getCaption:function(){return this.image.cptn},getKey:function(){return this.image.imgId},getMapKey:function(){return this.key},getFeedKey:function(){return this.image.nfId},setFeedKey:function(e){this.image.nfId=e},time:function(){return this._time},like:function(e,t){return e?(this.image.il=1^this.image.il,t?this.image.nl=t:this.image.nl=0==this.image.il?this.image.nl-1:this.image.nl+1,this.image.il):this.image.il},getLikes:function(){return this.image.nl},getTotalLikes:function(){return this.image.nl},getImageType:function(){return this.image.imT},incomingLike:function(e){return e&&++this.image.nl||--this.image.nl},offset:function(){return{width:this.image.iw,height:this.image.ih}},selfComment:function(){return this.image.ic},getTotalComment:function(){return this.image.nc},setTotalComment:function(t,n){this.image.nc=t,e.isDefined(n)&&(this.image.ic=n)},getUrl:function(){return"/image/"+this.getKey()},getRelativeHeight:function(e){try{return this.image.ih/this.image.iw*e}catch(t){return this.image.ih}}},function(e,t){return new o(e,t)}}e.module("ringid.shared").factory("$$imageMap",n),n.$inject=["settings","$$stackedMap","userFactory","Utils"]}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u){function d(e,t){var n=this;n.updateMedia(e),n.setUser(e,t),e=null,Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.media.key,showReportButton:function(){return!n._u.isCurrentUser()},showAddToAlbum:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"media"},getRingboxData:function(){return function(){return{media:n}}}}})}function g(e){var t,n=new Date,r=!1,i={ac:e.mdaCntntDTO.ac,albId:e.mdaCntntDTO.albId,albn:e.mdaCntntDTO.albn,artst:e.mdaCntntDTO.artst,cntntId:e.mdaCntntDTO.cntntId,mdaT:e.mdaCntntDTO.mdaT,drtn:e.mdaCntntDTO.drtn,strmURL:e.mdaCntntDTO.strmURL,thmbURL:e.mdaCntntDTO.thmbURL,ttl:e.mdaCntntDTO.ttl,utId:e.utId,viewtime:n.getTime()},o=c.getData("mediaRecent")||[];for(t=0;t<o.length;t++)if(o[t].cntntId===e.mdaCntntDTO.cntntId){r=t;break}r?o[r]=i:(o.length>=6&&o.shift(),o.push(i)),c.setData("mediaRecent",o)}var m=o,f={ac:0,albId:0,cc:0,ic:0,il:0,lc:0,is:0,ns:0,nfId:0,albn:"",artst:"",cntntId:0,drtn:0,mdaT:1,strmURL:"",thmbURL:"",ttl:"",tih:0,tiw:0,user:null,viewtime:0,utId:"",autoplay:!1,gotDetails:!1};return d.prototype={updateMedia:function(t,n){e.isObject(t)?(this.media?e.extend(this.media,t):this.media=e.extend({},f,t),this.media.gotDetails=!!n,this.media.key=this.media.cntntId||this.media.id,t.thmbURL&&t.thmbURL.length>1?this.media.poster=i.mediaBase+t.thmbURL:(this.media.poster=this.media.mdaT===m.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",this.media.feedThumb=this.media.poster,this.media.tih=330,this.media.tiw=600)):(RingLogger.warn("not valid json object media",RingLogger.tags.MEDIA),RingLogger.print(t,RingLogger.tags.MEDIA)),t=null},setUser:function(n,r){if(e.isDefined(r))this._u=r;else if(n.utId?this._u=t.getByUtId(n.utId):n.uId?this._u=t.getUser(n.uId):this._u=!1,!this._u){var i={};n.uId&&(i.uId=n.uId),n.utId&&(i.utId=n.utId),n.fn&&(i.fn=n.fn),n.prIm&&(i.prIm=n.prIm),this._u=t.create(i)}},sortBy:function(){return this.media.viewtime},getMediaUtId:function(){return this.media.utId},getAlbumId:function(){return this.media.albId},getAlbumName:function(){return this.media.albn},getArtistName:function(){return this.media.artst},getKey:function(){return this.media.key},getFeedKey:function(){return this.media.nfId},setFeedKey:function(e){return this.media.nfId=e,this.media.nfId},isAudio:function(){return this.media.mdaT===m.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return this.media.mdaT===m.NEWS_FEED_MEDIA_TYPE_VIDEO},owner:function(){return this._u},user:function(){return this._u},getId:function(){return this.media.cntntId},setIsAutoPlay:function(e){this.media.autoplay=e},getIsAutoPlay:function(){return this.media.autoplay},getViewCount:function(){return this.media.ac>1?"Views : "+this.media.ac:"View : "+this.media.ac},getViewCountOnly:function(){return this.media.ac},getDuration:function(e){if(e){var t=this.media.drtn/60===0?"00":Math.floor(this.media.drtn/60),n=this.media.drtn%60===0?"00":Math.floor(this.media.drtn%60);return t=10>t&&"00"!==t?"0"+t:t,n=10>n&&"00"!==n?"0"+n:n,t+":"+n}return this.media.drtn},getCaption:function(){return this.media.ttl},getStreamUrl:function(){var e=i.mediaBase+this.media.strmURL;if(2===this.media.mdaT){var t=this.media.strmURL.match(/media-(\d+)/);if(t&&2===t.length&&parseInt(t[1])>140){var n=e.lastIndexOf("/")+1;e=[e.slice(0,n),"h",e.slice(n)].join("")}}return e},getStreamUrlOnly:function(){return this.media.strmURL},getThumb:function(){return this.media.poster},getThumbUrlOnly:function(){return this.media.thmbURL},getThumbForMedia:function(){return""===this.media.thmbURL?1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg":this.media.poster},getThumbForMediaOnly:function(){return""===this.media.thmbURL?1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg":this.media.poster},feedThumb:function(){return this.media.feedThumb},iLiked:function(){return this.media.il},like:function(e,t){return e?(this.media.il=1^this.media.il,t?this.media.lc=t:this.media.lc=0===this.media.il?this.media.lc-1:this.media.lc+1,this.media.il):this.media.il},getLikes:function(){return this.media.lc},getTotalLikes:function(){return this.media.lc},setTotalComment:function(t,n){this.media.cc=t,e.isDefined(n)&&(this.media.ic=n)},selfComment:function(){return this.media.ic},getTotalComment:function(){return this.media.cc},getTotalShare:function(){return this.media.ns},setTotalShare:function(e){this.media.ns=e},share:function(e){return e?(this.media.is=1^this.media.is,this.media.ns=this.media.is?this.media.ns+1:this.media.ns-1,this.media.is):this.media.is},thumbOffset:function(e){return e?"height"===e?this.media.tih:this.media.tiw:{width:this.media.tiw,height:this.media.tih}},addToAlbumData:function(){return{strmURL:this.media.strmURL,tiw:this.media.tiw,tih:this.media.tih,drtn:this.media.drtn,thmbURL:this.media.thmbURL,artst:this.media.artst,ttl:this.media.ttl.utf8Encode()}},increaseView:function(){var e=s.defer(),t=this;return a.increaseViewCount(t.media.cntntId).then(function(n){RingLogger.print(n,RingLogger.tags.MEDIA),n.sucs===!0&&t.media.ac++,e.resolve()}),e.promise},updateRecentMedias:g,fetchDetails:function(e){var t=s.defer(),n=this;if(n.media.gotDetails)t.resolve(n);else{var r={cntntId:n.getKey(),utId:e?e.getUtId():n.owner().getUtId()};u.media.fetchDetails(r).then(function(e){e.sucs===!0?(n.updateMedia(e.mdaCntntDTO,!0),g(e),t.resolve(n)):(t.reject(e),l.show(e,"info"))})}return t.promise}},function(e,t){return new d(e,t)}}e.module("ringid.shared").factory("$$mediaMap",t),t.$inject=["userFactory","Auth","$$stackedMap","settings","APP_CONSTANTS","mediaHttpService","$$q","Storage","Ringalert","Api"]}()}(angular,window),function(e,t){"use strict";function n(e){return{create:function(t){var n={fn:t.fn,nPCatId:t.nPCatId,nPCatName:t.nPCatName,nPslgn:t.nPslgn,prIm:t.prIm,subCount:t.subCount,subsc:t.subsc,uId:t.uId,utId:t.utId};return{getKey:function(){return n.utId},getFullName:function(){return n.fn},getCategoryId:function(){return n.nPCatId},getCategoryName:function(){return n.nPCatName},getPortalSlogan:function(){return n.nPslgn},getProfileImage:function(){return n.prIm?e.imBase+n.prIm:"../../../images/test/1.png"},getFollowAndSliderImage:function(){return n.prIm?e.imBase+n.prIm:"../../../images/test/2.png"},getSubCount:function(){return n.subCount},setIfSubscribed:function(e){n.subsc=e},isSubscribed:function(){return n.subsc},getUid:function(){return n.uId}}}}}e.module("ringid.shared").factory("$$newsPortalMap",n),n.$inject=["settings"]}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l){function u(e){return parseInt(e.id)||parseInt(e.albId)}var d=s;return{createKey:function(e){return u(e)},createAlbum:function(n,s){function g(t,n,r){var i;n=n||m.owner;for(var o=0,s=t.length;s>o;o++)r&&(t[o].nfId=r),i=a(e.extend(t[o],{albId:m.id}),n),m.contents.save(i.getKey(),i);return RingLogger.print("CONTENTS ADDED : "+m.contents.length(),RingLogger.tags.MEDIA),m}var m={albn:"",albId:0,mc:0,mdc:0,mdaT:1,sts:0,utId:0,imgURL:"",contents:o.createNew(),uniqueKey:l.getUniqueID(),cover:"",key:0,type:"",owner:0},f=function(t){e.isObject(t)&&(m=e.extend({},m,t),m.albId=parseInt(t.id)||parseInt(t.albId),m.owner=s,m.key=u(t),t.imgURL&&t.imgURL.length>1?m.cover=r.imBase+t.imgURL:m.cover=n.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",m.type=n.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video")};return f(n),{getKey:function(){return m.key},getType:function(){return m.type},isAudio:function(){return m.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return m.mdaT===d.NEWS_FEED_MEDIA_TYPE_VIDEO},getId:function(){return m.albId},getName:function(){return m.albn},getCover:function(){return m.cover},getContentCount:function(){return m.mc||m.mdc},getContents:function(){return m.contents},updateAlbum:function(e){f(e)},pushContent:function(e,t,n,r){return g(e,t,n,r)},getALbumUtId:function(){return m.utId},link:function(e,t){if(e.getUId()||e.getUtId()){var n=l.getRingRoute("USER_PROFILE",{uId:e.getUId(),utId:e.getUtId(),subpage:"media",albumId:m.albId});return t?n.replace("#",""):r.baseUrl+n}return""},addNewContent:function(e){var n,r,o="audio"===m.type?"audioFiles":"videoFiles",a={albId:m.albId,mdaLst:[],mdaT:m.mdaT};if(e){if(m.contents.get(e.getKey()))return void t.show("Content Already Added","warning");a.mdaLst.push(e.addToAlbumData())}else for(n=0,r=i[o].length;r>n;n++)a.mdaLst.push(i[o][n].getAuthData());c.addMediaToAlbum(a).then(function(e){if(e.sucs===!0){for(m.mc+=e.mdaIds.length,n=0,r=e.mdaIds.length;r>n;n++)a.mdaLst[n].cntntId=e.mdaIds[n];g(a.mdaLst)}else RingLogger.warning(e.mg||"Failed to add media",RingLogger.tags.MEDIA)})},deleteContent:function(e){c.deleteAlbumContent(e.getId()).then(function(t){t.sucs===!0&&(m.contents.remove(e.getKey()),m.mc--)})},fetchContentDetails:function(){function e(e,t){setTimeout(function(){c.likeList(e.getId()).then(function(e){})},t)}for(var t=m.contents.all(),n=0,r=t.length;r>n;n++)e(t[n].value,200*n+200)}}}}}e.module("ringid.shared").factory("$$mediaAlbumMap",t),t.$inject=["Ringalert","Auth","settings","fileUploadService","$$stackedMap","$$mediaMap","APP_CONSTANTS","mediaHttpService","Utils"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E){function p(e,t){var n=this;if(n.key=T+e.nfId,n.updateRaw(e),n.setFeedUser(t),n.feelings={},n.tagUsers=[],n.shareUsers=[],n.circle={},n.orginal={},n.feedHtml="",n.images=r.createNew(!0,"asc"),n.medias=r.createNew(),n.audios=r.createNew(),n.setImages(),n.initMedias(),n._f.fndId?n.friend=c.create({uId:n._f.fndId,fn:n._f.ffn,ln:n._f.fln}):n.friend=!1,n.initOgData(),n.initLocationData(),n.update(null,!1,!0),n.isSingleContentFeed()){var i=n.getSingleContent();n.images.length()||(n._f.is=i.share(),n._f.ns=i.getTotalShare()),n._f.ic=i.selfComment(),n._f.nc=i.getTotalComment()}Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{feedKey:n._f.nfId,showEdit:function(){return!!(n._u.isCurrentUser()&&n._f.nl<1)},feedUser:function(){return n._u},tagButtonText:function(){return n.tagUsers.length?"Edit Tag":"Add Tag"},showDelete:function(){return n._u.isCurrentUser()||n.friend&&n.friend.isCurrentUser()},showTagButton:function(){return n._u.isCurrentUser()&&!n._f.grpId},showReportButton:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.isSingleContentFeed()?n.getSingleContent().getKey():n.getKey()},getSpamType:function(){return n.images.length()&&"image"||n.medias.length()&&"media"||n.audios.length()&&"media"||"feed"},showSaveOption:function(){return 7===n._f.type&&!n._f.npFeedInfo.svd},showUnsaveOption:function(){return 7===n._f.type&&n._f.npFeedInfo.svd},isNewsPortalFeed:function(){return 7===n._f.type}}})}var T="nf_",h="tm",_=m.FEED,I=f.SYSTEM,A='<user-card user="feed.user()"></user-card>',v={nfId:0,utId:0,isNew:0,lctn:"",lat:9999,lng:9999,gNm:"",grpId:0,sts:"",stsTags:[],tim:0,imT:0,fndId:0,whoShare:{},mdaCntntLst:[],type:0,mdLst:[],tm:Date.now(),at:Date.now(),ic:0,il:0,is:0,nc:0,nl:0,ns:0,sc:0,tfc:0,stp:0,fc:0,actvt:0,afn:"",auId:0,lnkDmn:"",lnkDsc:"",lnkTtl:"",lnkURL:"",lnlImgURL:"",fTgLst:[]};return p.prototype={updateRaw:function(t,n){var r;this._f?(r=n||!t.tm?this._f.tm:t.tm,e.extend(this._f,t),this._f.tm=r):this._f=e.extend({},v,t),9999===this._f.lat&&(this._f.lctn=""),t=null},update:function(e,t,n){var r=this;n||r.updateRaw(e,t),r._f.mdLst&&r._f.mdLst.length&&(r.feelings=g.getEmotion(r._f.mdLst[0],!0)),r.setTagUsers(),r._f.at?r.vtime=l.verbalDate(r._f.at):r.vtime="",r.setFeedTopMessage(),r.processFeedMessage(),r.addPostfixMessage(),r.parseStatus(),e=null},getKey:function(){return this._f.nfId},sortBy:function(){return this._f[h]||this._f.tm},getMapKey:function(){return this.key},setFeedKey:function(e){this._f.nfId=e},getFeedKey:function(e){return this._f.nfId},getPrivacy:function(){return E["PVC"+(this._f.fpvc||3)]},getByProperty:function(e,t){return t=t||!1,this._f.hasOwnProperty(e)?this._f[e]:t},checkMessageUpdated:function(){return this.message+this._f.lctn+this.tagUsers.reduce(function(e,t){return e.toString()+t.toString()},"")+this._f.tfc},getTargetWall:function(){return this.friend},getTargetCircle:function(){return e.equals({},this.circle)?this._f.gNm:this.circle},setFeedUser:function(t){var n=this;if(e.isDefined(t))n._u=t;else if(n._f.utId?n._u=c.getByUtId(n._f.utId):n._f.uId?n._u=c.getUser(n._f.uId):n._u=!1,!n._u){var r={};n._f.uId&&(r.uId=n._f.uId),n._f.utId&&(r.utId=n._f.utId),n._f.fn&&(r.fn=n._f.fn),n._f.prIm&&(r.prIm=n._f.prIm),7===n._f.type&&(n._f.isnp=!0,r.isnp=n._f.isnp),n._u=c.create(r)}},user:function(){return this._u},processFeedMessage:function(){var e,t="",n="",r=[A],i=this;switch(i.friend?t="F":i._f.grpId&&(i.circle=u.getCircle(i._f.grpId),t="C"),i._f.type){case I.NEWS_FEED_TYPE_IMAGE:i.images.length()>0?(i.message=_["TYPE_1"+i.images.top().getImageType()+t]||_.TYPE_D,i.message=i.feedConditionalReplacer(i.message,[i._u.isCurrentUser()])):i.message=_.TYPE_D;break;case I.NEWS_FEED_TYPE_STATUS:i.hasOgData()&&(n="L"),i.message=_["TYPE_2"+t+n];break;case I.NEWS_FEED_TYPE_MULTIPLE_IMAGE:i.message=_["TYPE_"+i._f.type],i.message=i.feedConditionalReplacer(i.message,[i._u.isCurrentUser()]),r.push(i._f.tim);break;case I.NEWS_FEED_TYPE_ALBUM:case I.NEWS_FEED_TYPE_AUDIO:case I.NEWS_FEED_TYPE_VIDEO:e=i._f.stp||0,i.message=_["TYPE_"+i._f.type+e],e||!i.medias.length()&&!i.audios.length()?r.push('<user-card class="share-user" user="feed.getSingleContent().user()"></user-card>'):r.push(i.medias.length()||i.audios.length());break;default:i.message=_.TYPE_D}i.friend?i.message+=" "+_.F_POSTFIX.format('<user-card class="wall-user" user="feed.getTargetWall()"></user-card>'):i._f.grpId&&(i.message+=" "+_.C_POSTFIX.format('<a class="cir-title" href="/#/circle/'+i._f.grpId+'" >'+i._f.gNm+"</a>")),i.rawmessage=i.message,i.message=i.message.format(r),i.oldMessage=i.message},updateShareMessage:function(){var e=A;this.orginal.getTotalShare()>1&&(e+="and "+(this.orginal.getTotalShare()-1)+" other people");var t=[A];this.message=_.TYPE_SHARE,t.push('<user-card class="share-user" user="feed.getOrginalFeed().user()"></user-card>'),this.message=this.message.format(t),this.oldMessage=this.message,this.addPostfixMessage()},addPostfixMessage:function(){var e=this;e.message=e.oldMessage,(e._f.mdLst.length||e.tagUsers.length||e.location)&&("{0}"!==e.rawmessage?e.message+=" &mdash;":e.message+=" is"),e._f.mdLst.length&&(e.message+='<span class="feelings-text">feeling</span> <img class="feed_emo" src="'+e.feelings.url+'" />&nbsp;'+e.feelings.nm),e.tagUsers.length&&(e.message+='&nbsp;<feed-tag-more-user tag-feed="feed"></feed-tag-more-user>'),this._f.lctn&&(e.message+='&nbsp;<location-card feed="feed"></location-card>')},getMessageText:function(){return this.message},hasActivityMessage:function(){return this._f.actvt>0&&1!==this._f.fc},setActivity:function(e){this._f.actvt=e.actvt||0,this._f.afn=e.afn,this._f.auId=e.auId,this.setFeedTopMessage()},setFeedTopMessage:function(){var e=this;if(e._f.actvt>0){if(e.subMessage="",e._f.actvt&&m.FEED["ACT_"+e._f.actvt]){var n=c.getByUtId(e._f.auId),r="<b>You</b>";n?n.isCurrentUser()||(r='<user-card user="feed.getActivityUser()"></user-card>'):t.currentUser().getUtId()!==e._f.auId&&(n=c.createByUtId({fn:e._f.afn,utId:e._f.auId},!0),r='<user-card user="feed.getActivityUser()"></user-card>'),e._au=n,e.subMessage=m.FEED["ACT_"+e._f.actvt].format(r)}e.subMessage=d.trustAsHtml(e.subMessage)}},getActivityMessage:function(e,t,n){return this.subMessage},getActivityUser:function(){return this._au},feedTextParser:function(e,t,n){var r,e,i=[],o="";if(n=n||e.length,t=t||[],n>0&&(e=e.substr(0,n)),e||t){if(t&&t.length){var a,s=0;t.sort(function(e,t){return t.pstn>e.pstn?-1:1});for(var u=0;u<t.length&&t[u].pstn<n;u++)a=t[u].pstn-s,r=c.create(t[u]),a>0&&i.push(l.parseForLE(e.substr(s,a))),i.push(r.getLink({"class":"tag",title:r.getName().trim(),"data-link":r.getUtId()})),s=t[u].pstn;a=e.length-s,a>0&&i.push(l.parseForLE(e.substr(s,a))),o=i.join("")}else o=l.parseForLE(e);o=d.trustAsHtml(o)}return o},parseStatus:function(){this.feedHtml=this.feedTextParser(this._f.sts,this._f.stsTags)},parseMoreText:function(e){this._f.sts=e.sts,this.parseStatus()},getCroppedHtml:function(e){return this.feedTextParser(e,this._f.stsTags,e.length)},showMore:function(){return!!this._f.sc},setText:function(e,t){this._f.sts=e,t&&(this._f.stsTags=t),this.parseStatus()},text:function(){return this._f.sts},getDynamicText:function(){return this.feedHtml},getDynamicTextMore:function(e,t){e=parseInt(e)>0?parseInt(e):20;for(var n,r="(",i=l.parseForLE(this._f.sts),o=e;o>0;o--)r+="[\\S]+\\s";return r+=")(.*)",n=i.replace(new RegExp(r),'<span class="with-more"><input id="read'+t+'" type="checkbox" /><span class="less">$1</span><span class="more">$2</span><label for="read'+t+'" class="trigger"></label></span>'),d.trustAsHtml(n)},getAtTime:function(){return this._f.at},time:function(){return this.vtime},updateTime:function(){this.vtime=l.verbalDate(this._f.at)},setTime:function(e){this._f.tm=e},getTimestamp:function(){return this._f.tm},incomingLike:function(e){return e&&++this._f.nl||--this._f.nl},like:function(e,t){return e?(this._f.il=1^this._f.il,t?this._f.nl=t:this._f.nl=this._f.il?this._f.nl+1:this._f.nl-1,this.identical&&this.identical.like(e),this._f.il):this._f.il},setTotalLikes:function(t,n){this._f.nl=t,e.isDefined(n)&&(this._f.il=n),this.identical&&this.identical.setTotalLikes(t,n)},setIdenticalFeed:function(e){this.identical=e},getTotalLikes:function(){return this._f.nl},setTotalComment:function(t,n){this._f.nc=t,e.isDefined(n)&&(this._f.ic=n),this.identical&&this.identical.setTotalComment(t.ic)},getTotalComment:function(){return this._f.nc},selfComment:function(){return this._f.ic},getTotalShare:function(){return this._f.ns},getShareUsers:function(){return this.shareUsers},addShareUser:function(e){return"array"==typeof e?this.shareUsers=this.shareUsers.concat(e):this.shareUsers.push(e),this.shareUsers},share:function(e,t){return e?(this._f.is=1^this._f.is,t?this._f.ns=t:this._f.ns=this._f.is?this._f.ns+1:this._f.ns-1,this._f.is):this._f.is},shares:function(e){this.orginal=e,this.orginal.addShareUser(this._u),this.updateShareMessage()},getWhoShares:function(){return this._f.whoShare},getOrginalFeed:function(){return this.orginal},hasSharedFeed:function(){return!e.equals({},this.orginal)},getTotalImage:function(){return this._f.tim},setImages:function(){var t,n,r,o=0;if(this._f.imageList){try{t=e.isString(this._f.imageList)?e.fromJson(this._f.imageList):this._f.imageList}catch(a){}for(n=t.length>3?3:t.length,o=0;n>o;o++)t[o].nfId=this._f.nfId,r=i(t[o],this._u),this.images.add(r.getMapKey(),r)}switch(this.images.length()){case 1:this.imlayout=5;break;case 2:this.imlayout=4;break;default:this.imlayout=this._f.nfId%4}},getImages:function(e){return e?this.images:this.images.all()},getImageLayout:function(e){return this.imlayout},hasMedia:function(){return this.images.length()>0||this.medias.length()>0||this.audios.length()>0},getAlbum:function(){return this.album},initMedias:function(){if(this._f.mdaCntntLst&&this._f.mdaCntntLst.length>0){var e=this._f.stp>0?null:this._u,t=this._f.mdaCntntLst;this.album=a.createAlbum({albn:t[0].albn,albId:t[0].albId,mc:t.length,mdaT:t[0].mdaT,utId:e?e.getUtId():0}),this.album.pushContent(t,e,this._f.nfId),this.album.isAudio()?this.audios=this.album.getContents():this.album.isVideo()&&(this.audios=this.album.getContents())}},getMedias:function(){return this.medias},getAudios:function(){return this.audios},setViewColumn:function(e){this.viewColumn=e},getViewColumn:function(){return this.viewColumn},getUrl:function(){return l.getRingRoute("SINGLE_FEED",{feedId:this._f.nfId,shared:this.hasSharedFeed()})},getWhoShareUrl:function(){var e;return e=this.hasSharedFeed()?this.getOrginalFeed().getKey():this.getKey(),l.getRingRoute("WHO_SHARED_FEED",{feedId:e})},hasFeelings:function(){return!!this._f.mdLst.length},getFeelings:function(){return this.feelings},setFeelings:function(e){e&&e.id?(this.feelings=e,this._f.mdLst[0]=e.id):(this.feelings={},this._f.mdLst=[]),this.addPostfixMessage()},setTagUsers:function(t,n){if(t?this._f.fTgLst=t:t=this._f.fTgLst,this.tagUsers.length=0,t&&t.length)for(var r=0;r<t.length;r++)t[r].fn=t[r].nm,this.tagUsers.push(c.createByUtId(t[r]));e.isDefined(n)&&(this._f.tfc=n)},updateTagUser:function(e){this.setTagUsers(e.fTgLst,e.tfc),this.addPostfixMessage()},hasTagUsers:function(){return!!this.tagUsers.length},getTagUsers:function(){return this.tagUsers},validateForUpdateTag:function(){return""!==this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length()},hasMoreTagUsers:function(){return this._f.tfc>this.tagUsers.length},getMoreTagUsers:function(){return this._f.tfc-this.tagUsers.length},getTotalTag:function(){return this._f.tfc},getLocationText:function(){return this._f.lctn},getLocationShortText:function(){if(this._f.lctn){var e=this._f.lctn,t=this._f.lctn.split(",");return t.length>2&&(e=t[0].replace("(","")),e.length>30&&(e=e.substr(0,30)+"..."),e}},setLocationText:function(e){return this._f.lctn=e,this.addPostfixMessage(),e},resetLocationText:function(){this._f.lctn=""},getContentType:function(){var e;return e=this.images.length()?"image":this.medias.length()?"media":this.audios.length()?"media":"feed"},hasLocationInfo:function(){return!(""===this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length())},getLocationInfo:function(){return this.locationData},getLocationUrl:function(){return d.trustAsResourceUrl(l.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!1))},getLocationEmbedUrl:function(){return d.trustAsResourceUrl(l.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!0))},getLocationStaticEmbedUrl:function(){return d.trustAsResourceUrl(l.getGoogleMapStaticUrl(this._f.lat,this._f.lng,this._f.lctn))},initLocationData:function(){9999!==this._f.lat?this.locationData={description:this._f.lctn,lat:this._f.lat,lng:this._f.lng}:this.locationData={description:this._f.lctn}},setLocationInfo:function(e){this._f.lctn=e.description,this._f.lat=e.lat,this._f.lng=e.lng,this.initLocationData(),this.addPostfixMessage()},getStrmURL:function(){return this._f.strmURL},getLinkDomain:function(){return this._f.lnkDmn},getLinkUrl:function(){return this._f.lnkURL},getLinkTitle:function(){return this._f.lnkTtl},getLinkDescription:function(){return this._f.lnkDsc},getLinkImageUrl:function(){return this._f.lnlImgURL},hasOgData:function(){return!!(this._f.lnlImgURL||this._f.lnkTtl||this._f.lnkDsc)},getOgData:function(){return this.ogData},initOgData:function(){this.ogData||(this.ogData={}),this.ogData.image=this._f.lnlImgURL,this.ogData.description=this._f.lnkDsc,this.ogData.title=this._f.lnkTtl,this.ogData.url=this._f.lnkURL,this.ogData.lnkDmn=this._f.lnkDmn},setOgData:function(e){this._f.lnkDsc=e.lnkDsc||e.description||"",this._f.lnkTtl=e.lnkTtl||e.title||"",this._f.lnkURL=e.lnkURL||e.url||"",this._f.lnlImgURL=e.lnlImgURL||e.image||"",this._f.lnkDmn=e.lnkDmn||e.domain||"",this.initOgData()},isEmpty:function(e){return e=e||{},!this.text||e.tagUsers&&this.tagUsers.length},isSpecial:function(){return 1===this._f.fc},isFeed:!0,isTimelinePost:function(){return this.friend&&this.friend.isCurrentUser()},isWallPost:function(){return!!this.friend},isCirclePost:function(){return this._f.grpId>0},isMediaShared:function(){return this._f.stp>0},isSingleContentFeed:function(){return 1===this.images.length()||1===this.medias.length()||1===this.audios.length()},getSingleContent:function(){
return this.images.length()&&this.images.bottom()||this.medias.length()&&this.medias.bottom()||this.audios.length()&&this.audios.bottom()||this},hasNewsPortalFeed:function(){return this._f.npFeedInfo},hasExternalUrl:function(){return this._f.npFeedInfo.exUrlOp},getNewsPortalcatId:function(){return this._f.npFeedInfo.nCatId},getNewsPortalDescription:function(){return this._f.npFeedInfo.nDctn},getNewsPortalShortDescription:function(){return this._f.npFeedInfo.nSDctn},getNewsPortalTitle:function(){return this._f.npFeedInfo.nTtl},hasNewsPortalUrl:function(){return!!this._f.npFeedInfo.nUrl},getNewsPortalUrl:function(){return this._f.npFeedInfo.nUrl},isSavedNewsPortal:function(){return this._f.npFeedInfo.svd},setPortalSaveStatus:function(e){this._f.npFeedInfo.svd=e},isPending:function(e){return void 0!==e&&(this.pending=!!e),this.pending},isShareAble:function(e){var t,n=!0,r=this.isSingleContentFeed()&&!this.images.length(),i=this.getSingleContent();return this._u.isCurrentUser()||r&&i.user().isCurrentUser()?(t="RC15",n=!1):this.friend?(t="CRCFS1",n=!1):this._f.grpId?(t="CRCFS2",n=!1):this._f.is&&!r&&(t="CRCFS3",n=!1),e?{sucs:n,rc:t}:n},encodeUtf8Fields:function(){var e,t,n=["location","lctn","lnkDmn","lnkDsc","lnkTtl","lnkURL","lnlImgURL"];for(e=0;e<n.length;e++)t=n[e],this._f[t]?this._f[t]=this._f[t].utf8Encode():this._f[t]=""},feedConditionalReplacer:function(e,t){var n=0;return t=t||[],e=e.replace(/(\w+)?\|\|(\w+)?/g,function(e,r,i){return void 0!==t[n]?t[n]?r:i:""}),e.replace(/(\s){2,}/g," ")}},{getPrefix:function(){return T},setSortKey:function(e){h=e},setPrefix:function(e){T=e},getSortIndex:function(){return h},makeKey:function(e){return T+e},create:function(e,t){return new p(e,t)}}}e.module("ringid.shared").factory("$$feedMap",t),t.$inject=["Auth","settings","$$stackedMap","$$imageMap","Media","$$mediaAlbumMap","$$mediaMap","userFactory","Utils","circlesManager","$sce","EmotionFactory","MESSAGES","OPERATION_TYPES","PrivacySet"]}()}(angular,window),function(e,t){"use strict";!function(){e.module("ringid.shared").factory("$$commentMap",["$$stackedMap","settings","$filter","userFactory","Utils","$$stickerMap","$sce",function(t,n,r,i,o,a,s){function c(e,t){t&&(this._u=t),this.updateComment(e)}var l={cmn:"",cmnId:0,deleted:!1,edited:!1,fn:"",il:0,isNew:1,ln:"",nfId:0,imageId:0,tl:0,tm:"",uId:"",prIm:"",pending:!1};return c.prototype={updateComment:function(t){this.comment?e.extend(this.comment,t):this.comment=e.extend({},l,t),this.updateTime(),this.setHtml(),this._u||(this._u=i.create({fn:this.comment.fn,ln:this.comment.ln,uId:this.comment.uId,prIm:this.comment.prIm}))},updateTime:function(){this.comment.tm||(this.comment.tm=Date.now()),this.vtime=o.verbalDate(this.comment.tm)},setHtml:function(){this.html=s.trustAsHtml(o.parseForLE(this.comment.cmn))},user:function(){return this._u},isOwner:function(e){return e===this._u.getKey()},text:function(){return this.comment.cmn},setComment:function(e){this.comment.cmn=e,this.setHtml()},setText:function(e){this.comment.cmn=e,this.setHtml()},getDynamicText:function(){return this.html},getByProperty:function(e,t){return t=t||!1,this.comment.hasOwnProperty(e)?this.comment[e]:t},sortBy:function(){return this.comment.cmnId},getKey:function(){return this.comment.cmnId},setKey:function(e){this.comment.cmnId=e},getFeedKey:function(){return this.comment.nfId},setFeedKey:function(e){this.comment.nfId=e},getImageKey:function(){return this.comment.imageId},setImageKey:function(e){this.comment.imageId=e},getTimestamp:function(){return this.comment.tm},setTime:function(e){this.comment.tm=e,this.updateTime()},getTimeUpdate:function(){return this.updateTime(),this.vtime},time:function(){return this.vtime},like:function(e,t){return e?(this.comment.il=1^this.comment.il,t?this.comment.tl=t:this.comment.tl=0==this.comment.il?this.comment.tl-1:this.comment.tl+1,this.comment.il):this.comment.il},getTotalLikes:function(){return this.comment.tl},incomingLike:function(e){this.comment.tl=e},isPending:function(e){return void 0!==e&&(this.comment.pending=!!e),this.comment.pending},isEditable:function(){return this._u.isCurrentUser()&&0===this.like()},isDeleteAble:function(e){return this._u.isCurrentUser()||e&&e.user().isCurrentUser()}},{getSortIndex:function(){return"tm"},create:function(e,t){return new c(e,t)}}}])}()}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o){function a(e,t){var n=this;e=e||{},n.updateAlbum(e,t)}function s(t,r){for(var i,o,a=0,s=r.length;s>a;a++)o=e.extend({},r[a],{albId:t.album.albId}),i=n(o,t._u),t.album.images.save(i.getKey(),i),t.album.ut<r[a].tm&&(t.album.ut=r[a].tm)}var c={albId:"",timg:"",imageList:[],ut:0};return a.prototype={updateAlbum:function(t,n){this.album?e.extend(this.album,t):this.album=e.extend({},c,t),n&&(this._u=i.create({uId:n})),this.album.images=r.createNew(),this.album.imageList&&this.album.imageList.length>0&&s(this,this.album.imageList)},pushImages:function(e){s(this,e.imageList)},getKey:function(){return this.album.albId},removeImage:function(e){this.album.images.remove(e)&&(this.album.tn=this.album.tn-1,"profileimages"===this.album.albId&&e===this._u.getProfileImageId()?this._u.resetAvatar():"coverimages"===this.album.albId&&e===this._u.getCoverImageId()&&this._u.resetCover())},getName:function(){return this.album.albn},getCoverImage:function(e){var n=this.album.cvImg.lastIndexOf("/")+1;return e="p"+e,[t.imBase,this.album.cvImg.slice(0,n),e,this.album.cvImg.slice(n)].join("")},getTotalImageCount:function(){return this.album.tn},getUpdateTime:function(){return this.album.tm},getImages:function(){return this.album.images}},function(e,t){return new a(e,t)}}e.module("ringid.shared").factory("$$albumMap",n),n.$inject=["settings","$$imageMap","$$stackedMap","userFactory","profileHttpService"]}(angular,window),function(e,t){"use strict";!function(n){function r(e,r,a){function s(e){var n={drtn:Math.floor(e.duration),tiw:e.videoHeight,tih:e.videoWidth,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile};t.URL.revokeObjectURL(e.src),e.deferObj.resolve(n)}function c(e){var t,r=new n(e),a={tag:null,value:null},s={id:r.getString(0,3),type:r.getString(0,1),size:r.getUint24(3)};if(!(s.id in i))return!1;if(a.tag=i[s.id],"T"===s.type)t=r.getUint8(7),a.value=r.getString(7,r.byteLength-7);else if("PIC"===s.id){t=r.getUint8(6);var c={type:null,mime:"image/"+r.getString(7,3).toLowerCase(),description:null,data:null};c.type=o[r.getUint8(11)]||"other";for(var l=11,u=0,d=l;;d++)if(0===r.getUint8(d)){u=d-l;break}c.description=0===u?null:r.getString(l,u),a.value=new Blob(new Uint8Array(e.slice(l+1)),{type:c.mime})}return a.tag?a:!1}function l(e,t,r){if(r=r||0,t=t||4,3>t)return c(e);var a,s=new n(e),l={tag:null,value:null},u={id:s.getString(0,4),type:s.getString(0,1),size:s.getSynch(s.getUint32(4)),flags:[s.getUint8(8),s.getUint8(9)]};if(0!==u.flags[0]||!(u.id in i))return!1;if(l.tag=i[u.id],"T"===u.type)if(a=s.getUint8(10),0===a||3===a)l.value=s.getString(11,s.byteLength-11);else if(1===a)l.value=s.getStringUtf16(-11,11,!0);else{if(2!==a)return!1;l.value=s.getStringUtf16(-11,11)}else if("APIC"===u.id){a=s.getUint8(10);for(var d={type:null,mime:null,description:null,data:null},g=11,m=0,f=g;;f++)if(0===s.getUint8(f)){m=f-g;break}d.mime=s.getString(g,m),d.type=o[s.getUint8(g+m+1)]||"other",g+=m+2,m=0;for(var f=g;;f++)if(0===s.getUint8(f)){m=f-g;break}d.description=0===m?null:s.getString(g,m),l.value=new Blob(new Uint8Array(e.slice(g+1)),{type:d.mime})}return l.tag?l:!1}function u(e,t){var r,i,o=new n(e),a={},s=0,c=10,u=o.byteLength-128;if("TAG"===o.getString(u,3)&&(u+=3,t.ttl=o.getString(u,30).trim()||null,u+=30,t.artst=o.getString(u,30).trim()||null),r=o.getUint8(3),i=o.getUint8(5),s+=o.getSynch(o.getUint32(6)),s>o.byteLength||"ID3"!==o.getString(0,3)||r>4||0!==(128&i));else for(0!==(64&i)&&(c+=o.getSynch(o.getUint32(11)));s>c;){for(var d,g,m,f=!0,E=0;3>E;E++)m=o.getUint8(c+E),(65>m||m>90)&&(48>m||m>57)&&(f=!1);if(!f)break;g=3>r?e.slice(c,c+6+o.getUint24(c+3)):e.slice(c,c+10+o.getSynch(o.getUint32(c+4))),d=l(g,r),d&&(a[d.tag]=d.value),c+=g.byteLength}t.ttl=a.title||t.ttl||"",t.artst=a.artist||a["original-artist"]||t.artst||""}function d(){var e=this,t={drtn:Math.floor(e.duration),tiw:0,tih:0,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile,thmbURL:""},n=new FileReader;n.onload=function(){u(this.result,t),e.deferObj.resolve(t)},n.readAsArrayBuffer(e.fileObj)}function g(e){this.deferObj.reject()}var m=this;m.generateMeta=function(n,r){var i,o=e.defer();return"audio"===r?(i=document.createElement("audio"),i.addEventListener("loadeddata",d),i.fileObj=n):(i=document.createElement("video"),i.addEventListener("loadeddata",function(){function e(){i.removeEventListener("timeupdate",e),s(t)}var t=this;t.currentTime=t.duration>20?10:t.duration/2,i.addEventListener("timeupdate",e)})),i.deferObj=o,i.nameFromFile=n.name,i.addEventListener("onerror",g),i.src=t.URL.createObjectURL(n),o.promise}}var i={TIT2:"title",TOPE:"original-artist",TPE1:"artist",TOA:"original-artist",TP1:"artist",TT2:"title",APIC:"image",PIC:"image"},o=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"];e.module("ringid.shared").service("mediaMetadata",r),r.$inject=["$$q","Ringalert","Utils"]}(DataView)}(angular,window),function(e,t){"use strict";!function(){function n(e,n,r,i){var o=this,a=n.COVER_PIC_UPLOAD_MINIMUM_WIDTH,s=n.COVER_PIC_UPLOAD_MINIMUM_HEIGHT,c=n.COVER_PIC_UPLOAD_MAXIMUM_WIDTH,l=n.COVER_PIC_UPLOAD_MAXIMUM_HEIGHT,u=n.PROFILE_PIC_UPLOAD_MINIMUM_WIDTH,d=n.PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT,g=n.IMAGE_UPLOAD_MIN_HEIGHT,m=n.IMAGE_UPLOAD_MIN_WIDTH;o.resizeImage=function(n,r){function o(){function e(e){t=document.createElement("canvas"),t.width=h.iw,t.height=h.ih,o=t.getContext("2d"),o.drawImage(f,0,0,h.iw,h.ih),e&&(h.imQ=e.qualityIM.quality),h.previewUrl=t.toDataURL("image/jpeg"),h.file=i.dataURLToBlob(h.previewUrl),h.file.name=n.name||r+".jpg",T.resolve(h)}var t,o,f=this,E=1,_=f.width,I=f.height;_>c||I>l?_/c>I/l?(E=c/_,h.iw=c,h.ih=Math.floor(E*I)):(E=l/I,h.ih=l,h.iw=Math.floor(E*_)):(h.iw=_,h.ih=I);var A=g,v=m;switch(r){case"profilephoto":(h.iw<u||h.ih<d)&&(A=d,v=u,p=!0);break;case"coverphoto":(h.iw<a||h.ih<s)&&(A=s,v=a,p=!0);break;case"image":case"status":case"chatimage":case"tagchatimage":(h.iw<m||h.ih<g)&&(p=!0)}p?T.reject("Image Size below Minimum("+v+"px by "+A+"px) :"+n.name):e(!1)}function f(){T.reject("Image invalid: "+n.name)}var E=new Image,p=!1,T=e.defer(),h={ih:0,iw:0,previewUrl:"",file:""},_=t.URL||t.webkitURL;return"string"==typeof n?(E.setAttribute("crossOrigin","anonymous"),E.src=n):E.src=_.createObjectURL(n),E.onload=o,E.onerror=f,T.promise}}e.module("ringid.shared").service("imageQuality",n),n.$inject=["$$q","APP_CONSTANTS","Ringalert","Utils"]}()}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c,l,u){function d(e){var t,n,r,i=new DataView(e);return i.byteLength?(t=i.getBool(0),t===!1?(r=i.getUint8(1),n={sucs:!1,mg:i.getString(2,r)}):t===!0&&(r=i.getUint8(1),n={sucs:!0,url:i.getString(2,r)})):n={sucs:!1,mg:"Failed. Response unreadable"},n}function g(g,m,f,p){function T(e){C.progressVal=e,"coverphoto"!==C.uploadType&&"profilephoto"!==C.uploadType||(E.progress=C.progressVal),i.$broadcast(o.FILE_UPLOAD.PROGRESS_UPDATE),f(),RingLogger.information("Upload Progress:"+C.progressVal,RingLogger.tags.UPLOAD)}function h(t){var n;switch(C.uploadType){case"chatimage":n=d(t),n.sucs===!0&&(n.url=n.url),E.uploadProgress=!1,e.extend(n,C.meta||{});break;case"tagchatimage":n=e.fromJson(t),n.sucs===!0&&(n.url=n.iurl),E.uploadProgress=!1,e.extend(n,C.meta||{});break;case"video":n=d(t),C.meta.thmbURL=n.url?n.url.substr(0,n.url.lastIndexOf("."))+".jpg":"",C.previewUrl=n.url?r.mediaBase+C.meta.thmbURL:"";break;case"audio":n=d(t);break;case"coverphoto":case"profilephoto":n=e.fromJson(t),n.ih=C.meta.ih,n.iw=C.meta.iw,E.uploadProgress=!1;break;case"image":n=e.fromJson(t),C.previewUrl=n.iurl?r.imBase+n.iurl.substr(0,n.iurl.lastIndexOf("/")+1)+"pthumb"+n.iurl.substr(n.iurl.lastIndexOf("/")+1):"";break;case"thumb":n=d(t);break;default:n=e.fromJson(t)}C.response=e.extend({},C.response,n),n.sucs===!0?C.uploadComplete=!0:C.uploadFail=!0,C.queued=!1,n.sucs!==!0&&a.show(n.mg||"Failed","error"),v.resolve(n)}function _(){f(),v.reject()}function I(e){C.uploadFail=!0,a.show("Upload failed!","error"),p?v.resolve():v.reject()}function A(t){switch(C.fileType){case"video":case"audio":u.generateMeta(C.file,C.fileType).then(function(n){C.meta=e.extend({},n,C.meta),t({success:!0}),f()},function(e){a(e,"error"),C.uploadFail=!0,v?v.reject(e):t({success:!1,message:e}),f()});break;case"image":l.resizeImage(C.file,C.uploadType).then(function(e){C.file=e.file,C.meta.ih=e.ih,C.meta.iw=e.iw,C.previewUrl=e.previewUrl,t({success:!0}),f()},function(e){C.uploadFail=!0,v?(a.show(e,"error"),v.reject(e)):t({success:!1,message:e}),f()})}C.gotMeta=!0,f()}var v,S="",C={uniqueId:s.getUniqueID(),uploadType:g,file:m||null,fileName:m.name&&m.name.substr(0,m.name.lastIndexOf("."))||"uploadFile",fileType:(m.name&&m.type?m.type.substr(0,m.type.indexOf("/")):void 0)||"image",response:{url:""},meta:{ttl:"status"!==g&&"image"!==g&&m.name?m.name.substr(0,m.name.lastIndexOf("."))||m.name:""},gotMeta:!1,previewUrl:"",progressVal:0,queued:!1,uploadComplete:!1,uploadFail:!1};switch(g){case"audio":C.fileName+=".mp3";break;case"video":C.fileName+=".mp4";break;default:C.meta.ttl="",C.fileName+=".jpg"}return C.previewUrl=r.baseUrl+"/images/default_"+C.fileType+"_image.jpg","profilephoto"!==g&&"coverphoto"!==g||(C.repositionD={ih:0,iw:0,cimX:0,cimY:0}),{getKey:function(){return C.uniqueId},setRepositionData:function(t){C.repositionD=e.extend({},C.repositionD||{},t)},getRepositionData:function(){return"profilephoto"===C.uploadType?{pimX:C.repositionD.cimX,pimY:C.repositionD.cimY}:{cimX:C.repositionD.cimX,cimY:C.repositionD.cimY}},getFile:function(){return C.file},getName:function(){return C.file.name},fetchMeta:A,initUpload:function(){function e(){"coverphoto"!==C.uploadType&&"profilephoto"!==C.uploadType||Object.keys(C.repositionD).forEach(function(e){i.append(e,C.repositionD[e])}),i.append("file",C.file,C.fileName),C.xhr=c.post(S,i,o).success(h).error(I).progress(T).abort(_)}var i=new FormData,o="text";switch(v=t.defer(),C.queued=!0,i.append("sId",n.getCookie("sId")),i.append("uId",n.getCookie("uId")),i.append("authServer",n.getCookie("authServer")),i.append("comPort",n.getCookie("comPort")),i.append("x-app-version",r.apiVersion),C.uploadType){case"profilephoto":S=r.imServer+"ImageUploadHandler";break;case"coverphoto":S=r.imServer+"CoverImageUploadHandler";break;case"tagchatimage":S=r.imServer+"GroupContentHandler";break;case"chatimage":S=r.imServer+"ChatImageHandler",o="arraybuffer";break;case"image":S=r.imServer+"AlbumImageUploadHandler";break;case"video":S=r.mediaServer+"Mp4UploadHandler",o="arraybuffer";break;case"audio":S=r.mediaServer+"Mp3UploadHandler",o="arraybuffer";break;case"thumb":S=r.mediaServer+"ThumbImageHandler",o="arraybuffer",C.gotMeta=!0}return C.gotMeta?e():A(e),v.promise},cptn:function(e){return arguments.length>0&&(C.meta.ttl=e),C.meta.ttl},getPreview:function(){return C.previewUrl},cancelUpload:function(){C.uploadFail=!0,C.xhr?C.xhr.abortRequest():C.deferred&&C.deferred.reject()},setPreview:function(e){C.previewUrl=e},getProgress:function(){return C.progressVal},uploadCompleted:function(){return C.uploadComplete},uploadFailed:function(){return C.uploadFail},getQueued:function(){return C.queued},setQueued:function(e){C.queued=e||!0},setMeta:function(e){C.meta=e},getMeta:function(){return C.hasOwnProperty("meta")?C.meta:!1},getAuthData:function(e){var t={};switch(C.fileType){case"image":t={ih:C.meta.ih,iw:C.meta.iw,iurl:C.response.iurl,cptn:C.meta.ttl.utf8Encode()};break;case"video":case"audio":if(t={strmURL:C.response.url,tiw:C.meta.tiw,tih:C.meta.tih,drtn:C.meta.drtn,thmbURL:C.meta.thmbURL,artst:C.meta.artst.utf8Encode(),ttl:C.meta.ttl.utf8Encode()},e){for(var n=0;n<E.tagList.length;n++)E.tagList[n].sk=E.tagList[n].sk.utf8Encode();t.htgLst=E.tagList}break;default:t=C.response}return t}}}function m(){var e;for(var t in f)f.hasOwnProperty(t)&&(e=f[t],e&&e.$id&&!e.$$destroyed&&e.$rgDigest())}var f={},E=this,p=-1;E.resetUpload=function(){E.progress=0,E.tagList=[],E.uploadProgress=!1,E.profileImageFile=null,E.coverImageFile=null,E.imageFiles=[],E.videoFiles=[],E.audioFiles=[],E.chatImageFiles={},E.selectFromAlbum=!1},E.resetUpload(),E.createUploadFile=function(e,t){return new g(e,t,m)},E.setUploadAlbum=function(e){p=e},E.getUploadAlbum=function(){return p},E.queueFile=function(e,t){switch(e){case"profilephoto":return E.progress=0,E.profileImageFile=new g(e,t,m),E.profileImageFile;case"coverphoto":return E.progress=0,E.coverImageFile=new g(e,t,m),E.coverImageFile;case"tagchatimage":case"chatimage":return new g(e,t,m);case"image":E.imageFiles.push(new g(e,t,m,!0));break;case"video":E.videoFiles.push(new g(e,t,m,!0));break;case"audio":E.audioFiles.push(new g(e,t,m,!0))}m()},E.setReposition=function(e,t){"coverphoto"===t?E.coverImageFile.setRepositionData(e):"profilephoto"===t&&E.profileImageFile.setRepositionData(e)},E.getReposition=function(e){return"coverphoto"===e?E.coverImageFile.getRepositionData():"profilephoto"===e?E.profileImageFile.getRepositionData():{}},E.uploadQueue=function(e,n){function r(e){for(var t=e?0:n,r=0,i=t,o=E[c].length;o>i;i++)E[c][i]&&E[c][i].uploadFailed()&&(E[c].splice(i,1),r++,i--,o--);return r>0&&m(),r}var a,s=[],c=e+"Files";if(n<E[c].length){a=n+2<E[c].length?n+2:E[c].length;for(var l=n;a>l;l++)!E[c][l]||E[c][l].getQueued()||E[c][l].uploadFailed()||s.push(E[c][l].initUpload());if(0===s.length)return void E.uploadQueue(e,a);t.all(s).then(function(){r(),E.uploadQueue(e,a)},function(t){a-=r(),E.uploadQueue(e,a)})}else var u=setInterval(function(){E.uploadProgress=!1,r(!0);for(var t=0;t<E[c].length;t++)if(!E[c][t].uploadCompleted()){E.uploadProgress=!0;break}E.uploadProgress||(clearInterval(u),i.$broadcast(o.FILE_UPLOAD.QUEUE_COMPLETE,e),m())},2e3)},E.setScopeForDigest=function(e){f[e.$id]=e},E.removeScope=function(e){f[e.$id]&&(f[e.$id]=null)}}e.module("ringid.shared").service("fileUploadService",n),n.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","Utils","$ringhttp","imageQuality","mediaMetadata"]}(angular,window),function(e,t){"use strict";!function(){function t(t,n){function r(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var i=this,o={":D":"awesome.png",":<3":"loved.png","*D*":"excited.png",":)":"happy.png",":-(":"alone.png","(cool)":"cool.png","x=(":"angry.png","o_-":"fresh.png",":>s":"sick.png",":?":"confused.png",";|":"thoughtful.png",":*":"fantastic.png",":=(":"upset.png",">u<":"blah.png","(amused)":"amused.png","(hot)":"hot.png","(-_^)":"motivated.png","(^_^)":"satisfied.png",">=<":"hurt.png",":(s":"ill.png","(cute)":"cute.png","I=)":"relived.png",":O":"shoked.png","(beautiful)":"beautiful.png",":|p":"hyper.png","(pumped)":"pumped.png","%)":"drunk.png","o(":"impatient.png","(restless)":"restless.png",":-)":"emotional.png","(hungry)":"hungry.png","(nostalgic)":"nostalgic.png","(blessed)":"blessed.png","</3":"heartboken.png","(naughty)":"naughty.png","(entertained)":"entertained.png","(broken)":"broken.png","(cold)":"cold.png","(down)":"down.png","(sorry)":"sorry.png","(frustrated)":"frustrated.png",":-s":"scared.png",":@":"fuming.png",NN:"run.png",":'q":"crying.png",":'D":"laughing.png",":'(":"soreness.png","(boiling)":"boiling.png",":x":"xmode.png",":p":"cheeky.png",":=0":"laughing-inside.png","|-O":"yawn.png",":6":"devil.png",":-#":"zipped-lip.png","(clap)":"clap.png","<3":"heart.png","(pink-heart)":"pink-heart.png","(k)":"pink-lip.png","(#)":"sun.png","(*)":"star.png","(g)":"gift.png","(K)":"red-lip.png","(f)":"rose.png"},a=e.extend({":&lt;3":"loved.png","&lt;/3":"heartboken.png","&gt;=&lt;":"hurt.png","&gt;u&lt;":"blah.png",":&gt;s":"sick.png","&lt;3":"heart.png"},o),s=[];for(var c in a)a.hasOwnProperty(c)&&s.push(r(c));var l=new RegExp(s.join("|"),"g");i.getEmoImageName=function(e){try{return o[e]}catch(t){return"default.png"}},i.getAllEmoticons=function(){var n={type:t.EMOTICON,imageList:[]};return e.forEach(o,function(e,r){n.imageList.push({name:e,symbol:r,type:t.EMOTICON})}),n},i.getEmoticonUrlMap=function(){var t={};return e.forEach(o,function(e,r){t[r]=n.emoticonBase+e}),t},i.getEmoticonUrlMapWithHtmlEncode=function(){var t={};return e.forEach(a,function(e,r){t[r]=n.emoticonBase+e}),t},i.getEmoticonPattern=function(){return l},i.getEmoticonMap=function(){return a}}function n(e){function t(){return e.getAllEmoticons()}function n(t){return e.getEmoImageName(t)}function r(e,t,n){var r=settings.stickerBase+e+"/"+t+"/"+n;return r}return{getAllEmoticons:t,getEmoImageName:n,getStickerImageUrl:r,getEmoticonUrlMap:e.getEmoticonUrlMap,getEmoticonUrlMapWithHtmlEncode:e.getEmoticonUrlMapWithHtmlEncode,getEmoticonPattern:e.getEmoticonPattern}}e.module("ringid.shared").service("StickerEmoticonService",t).factory("StickerEmoticonFactory",n),t.$inject=["STICKER_IMAGE_TYPE","settings"],n.$inject=["StickerEmoticonService"]}()}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c,l,u,d,g,m,f){function E(e,t){switch(e){case"utIds":i.utIds().save(t,{frnS:_.FRIEND});break;case"incomingUtIds":i.incomingUtIds().save(t,{frnS:_.INCOMING_FRIEND});break;case"outgoingUtIds":i.outgoingUtIds().save(t,{frnS:_.OUTGOING_FRIEND})}}function p(e){h&&!e||(h=!0,i.init(),d.getContactList())}var T=l.SYSTEM.FRIENDS,h=!1,_=o,I=0,A=0,v={totalPacket:0,complete:!1},S=function(e,t){var n,r,i,o=[],c=[],l=[];if(t)l=e;else{for(n=0,r=e.length;r>n;n++)e[n]!==a.currentUser().getUtId()&&(s.getContact(e[n])?c.push(s.getContact(e[n])):l.push(e[n]));c.lenght>0&&D(c)}var u=new ArrayBuffer(8*l.length),d=new DataView(u);for(n=0,i=0,r=l.length;r>n;n++)d.setInt32(i,0),i+=4,d.setInt32(i,l[n]),i+=4;for(n=0;n<d.byteLength;n++)o.push(d.getInt8(n));return o},C=function(e,t,n){var r=i.remove("utIds",e);t&&B.friends.remove(e),r&&!n||(r=i.remove("incomingUtIds",e),t&&B.incomingFriends.remove(e),r&&!n||(r=i.remove("outgoingUtIds",e),t&&B.outgoingFriends.remove(e)))},D=function(e){for(var t,n,r=0,i=e.length;i>r;r++)t=u.create(e[r]),n=t.friendshipStatus(),e[r].deleted&&1===e[r].deleted||(n===_.FRIEND?B.friends.save(t.getUtId(),t):n===_.INCOMING_FRIEND?B.incomingFriends.save(t.getUtId(),t):n===_.OUTGOING_FRIEND&&B.outgoingFriends.save(t.getUtId(),t),C(e[r].utId,!1,!0))},N=function(e,t){var n=t&&t.mg?t.mg:"Reqeust Failed";m.show(n,"error"),e&&e.reject({sucs:!1,mg:n})},M=function(e){var t,r,o;switch(e.actn){case T.TYPE_CONTACT_UTIDS:if(e.sucs===!0){for(0!==v.totalPacket||v.complete||(v.totalPacket=e.totalPacket),v.totalPacket--,r=0,o=e.utIds.length;o>r;r++)switch(e.utIds[r].value.frnS){case _.FRIEND:i.add("utIds",e.utIds[r].key,e.utIds[r].value);break;case _.INCOMING_FRIEND:i.add("incomingUtIds",e.utIds[r].key,e.utIds[r].value);break;case _.OUTGOING_FRIEND:i.add("outgoingUtIds",e.utIds[r].key,e.utIds[r].value)}0===v.totalPacket&&(v.complete=!0,i.initStorage()),f.triggerCustomEvent(n.FRIEND.UTID_LIST_RECEIVED)}else e.sucs===!1&&1111===e.rc&&(RingLogger.warning("Contact List utID REPEAT",RingLogger.tags.FRIEND),d.getContactList());break;case T.TYPE_UPDATE_ADD_FRIEND:e.sucs===!0&&i.add("incomingUtIds",e.utId,{frns:_.INCOMING_FRIEND});break;case T.TYPE_UPDATE_DELETE_FRIEND:e.sucs===!0&&e.utId&&(C(e.utId,!0,!0),t=u.create(e),t.updateUserObj({frnS:_.NOT_FRIEND}));break;case T.TYPE_UPDATE_ACCEPT_FRIEND:e.sucs===!0&&(C(e.utId,!0),B.friends.add(e.utId,u.create(e)))}},R=function(e){switch(e){case"friendslist":case"friends":return B.friends;case"incoming":return B.incomingFriends;case"outgoing":return B.outgoingFriends;case"userfriends":return B.userFriends}},y=function(){I=0,B.userFriends.reset()},O=function(e){var t,n=r.defer();return d.getUserContacts(e,A).then(function(e){if(I=0===I?e.tf:I,e.sucs===!0){A+=e.contactList.length;for(var r=0;r<e.contactList.length;r++)t=u.create(e.contactList[r]),B.userFriends.save(t.getKey(),t);n.resolve()}else RingLogger.alert("FRIENDS FRIENDLIST FETCH FAIL",RingLogger.tags.FRIEND),n.reject(e)},function(e){n.reject(e)}),n.promise},b=function(e,t){var n,o=[],a=r.defer();switch(t=t?t:20,e=e?e:"utIds"){case"friends":case"friendslist":case"utIds":o=S(i.utIds().keys().slice(0,t)),B.state.isFriendsLoading=o.length>0;break;case"userfriends":break;case"incoming":case"incomingUtIds":o=S(i.incomingUtIds().keys().slice(0,t));break;case"outgoing":case"outgoingUtIds":o=S(i.outgoingUtIds().keys().slice(0,t))}return o.length>0?d.getContactListDetails({utIDs:o,uo:!1}).then(function(e){if(e.sucs===!0){for(n=0;n<e.contacts.length;n++)s.setContact(e.contacts[n].utId,e.contacts[n]);D(e.contacts),a.resolve(e)}else a.reject(e)},function(e){a.reject(e)}):a.reject({sucs:!1}),a.promise},P=function(e){if(e.length>0){var t=S(e,!0);if(t.length>0)return d.getContactListDetails({utIDs:t,uo:!1})}},L=function(e,t){switch(e.friend.isLoading(!0),e.action){case"remove":case"unfriend":return F(e,t);case"add":case"addfriend":return U(e,t);case"accept":return w(e,t);case"incoming_reject":case"outgoing_reject":case"reject":return k(e,t);case"block":return e.block=1,e.bv=0,$(e,t);case"unblock":return e.block=0,e.bv=1,$(e,t);default:return e.friend.isLoading(!1),!1}},U=function(t,n){var o=n?r.defer():!1,a=t.friend.getUtId();return d.sendFriendRequest({uId:t.friend.getKey()}).then(function(r){t.friend.isLoading(!1),r.sucs===!0?(i.add("outgoingUtIds",a,{frns:_.OUTGOING_FRIEND}),n&&o.resolve(r),t.friend.updateUserObj(e.extend({},r,{frns:_.OUTGOING_FRIEND}))):N(o,r)},function(e){t.friend.isLoading(!1),N(o,e)}),n?o.promise:void 0},w=function(i,o){var a=o?r.defer():!1,s=i.friend.getUtId();return d.acceptFriendRequest({friendId:i.friend.getKey(),utId:i.friend.getUtId()}).then(function(r){RingLogger.print(r,RingLogger.tags.FRIEND),i.friend.isLoading(!1),r.sucs===!0?(C(s,!0),t.$broadcast(n.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),i.friend.updateUserObj(e.extend({},r,{frnS:_.FRIEND})),B.friends.save(s,i.friend),o&&a.resolve(r)):N(a,r)},function(e){i.friend.isLoading(!1),N(a,e)}),o?a.promise:void 0},F=function(i,o){var a=o?r.defer():!1,s=i.friend.getUtId();return d.unFriend({friendId:i.friend.getKey()}).then(function(r){RingLogger.print(r,RingLogger.tags.FRIEND),i.friend.isLoading(!1),r.sucs===!0?(C(s,!0,!0),t.$broadcast(n.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),i.friend.updateUserObj(e.extend({},r,{frnS:_.NOT_FRIEND})),o&&a.resolve(r)):N(a,r)},function(e){i.friend.isLoading(!1),N(a,e)}),o?a.promise:void 0},k=function(i,o){var a=o?r.defer():!1,s=i.friend.getUtId();return d.unFriend({friendId:i.friend.getKey()}).then(function(r){i.friend.isLoading(!1),r.sucs===!0?(i.friend.updateUserObj(e.extend({},r,{frnS:_.NOT_FRIEND})),C(s,!0,!0),t.$broadcast(n.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),o&&a.resolve(r)):N(a,r)},function(e){i.friend.isLoading(!1),N(a,e)}),o?a.promise:void 0},$=function(e,t){var n=t?r.defer():!1;return d.blockFriend(e).then(function(r){e.friend.isLoading(!1),r.sucs===!0&&e.friend.setBlock(e.block),t&&n.resolve()},function(){e.friend.isLoading(!1),t&&n.reject()}),t?n.promise:void 0},G=function(){for(var e="",t=0;t<B.friends.size();t++)e+=",".fFactory.friends[t].getKey();return e},H=function(e,t){if(t){var n=r.defer();return d.searchContact(e,t).then(function(e){e.sucs?n.resolve():n.reject()},function(){n.reject()},function(e){if(e.sucs===!0){for(var t=0;t<e.searchedcontaclist.length;t++)s.setContact(e.searchedcontaclist[t].utId,e.searchedcontaclist[t]);D(e.searchedcontaclist)}else n.reject()}),n.promise}return d.searchContact(e,!1)},B={state:{noFriends:!1,isFriendsLoading:!1,isUserFriendsLoading:!1,isRequestsLoading:!1},getRequestCount:function(){var e=i.incomingUtIds().length()+B.incomingFriends.length();return e>99?"99+":e},getPendingCount:function(){return i.outgoingUtIds().length()+B.outgoingFriends.length()},totalFriends:function(e){return"userfriends"===e?I:i.utIds().length()+B.friends.length()},totalUserFriends:function(){return I},friends:g.createNew(),userFriends:g.createNew(),incomingFriends:g.createNew(),outgoingFriends:g.createNew(),process:M,getFriends:R,resetUserFriends:y,getUserContacts:O,getContactDetails:b,getContactDetailsByUtIds:P,removeFriend:F,friendAction:L,addFriend:U,rejectFriendRequest:k,acceptFriendRequest:w,searchContact:H,initFriends:p,addToUtIdList:E,blockFriend:$,getIds:G,utIDsToByteArray:S};return c.subscribe(B.process,{action:[T.TYPE_CONTACT_UTIDS,T.TYPE_UPDATE_ADD_FRIEND,T.TYPE_UPDATE_DELETE_FRIEND,T.TYPE_UPDATE_ACCEPT_FRIEND],callWithUnresolved:!0}),B}e.module("ringid.shared").factory("friendsFactory",n),n.$inject=["$rootScope","SystemEvents","$$q","Contacts","APP_CONSTANTS","Auth","Storage","$$connector","OPERATION_TYPES","userFactory","friendsHttpService","$$stackedMap","Ringalert","Utils"]}(angular,window),function(e,t){"use strict";function n(e,t,n){var r=this,i=t.SYSTEM.FRIENDS,o=n,a=t.SYSTEM.REQUEST_TYPE;r.searchContact=function(t,n){var r={actn:n?i.ACTION_FRIEND_SEARCH:i.TYPE_CONTACT_SEARCH,scat:o.TYPE_SEARCH_BY_ALL,schPm:t.schPm.utf8Encode(),st:t.st||0},s=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return s.test(t.schPm)&&(r.scat=o.TYPE_SEARCH_BY_EMAIL),e.pull(r,a.REQUEST,!0)},r.getContactList=function(t){var n={actn:i.TYPE_CONTACT_UTIDS,cut:-1,ut:t||-1};return e.send(n,a.REQUEST)},r.getContactListDetails=function(t){var n={actn:i.TYPE_CONTACT_LIST,uo:t.uo||!1,utIDs:t.utIDs};return e.pull(n,a.REQUEST,!0)},r.getUserContacts=function(t,n){var r={actn:i.TYPE_FRIEND_CONTACT_LIST,utId:t,st:n||0};return e.pull(r,a.REQUEST)},r.unFriend=function(t){var n={actn:i.TYPE_DELETE_FRIEND,uId:t.friendId};return e.request(n,a.UPDATE,!0)},r.changeFriendType=function(t){var n={actn:i.TYPE_ACTION_CHANGE_FRIEND_ACCESS,ct:t.ct,utId:t.utId};return e.request(n,a.UPDATE)},r.sendFriendRequest=function(t){var n={actn:i.TYPE_ADD_FRIEND,uId:t.uId};return e.request(n,a.UPDATE,!0)},r.blockFriend=function(t){var n={actn:i.TYPE_ACTION_BLOCK_UNBLOCK_FRIEND,idList:[t.friend.getUtId()],bv:t.bv};return e.request(n,a.REQUEST)},r.saveCallPvcEdit=function(t){var n={actn:t.actn,sn:t.callsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveChatPvcEdit=function(t){var n={actn:t.actn,sn:t.chatsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveFeedPvcEdit=function(t){var n={actn:t.actn,sn:t.feedsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.acceptFriendRequest=function(t){var n={actn:i.TYPE_ACCEPT_FRIEND,utId:t.utId};return e.request(n,a.UPDATE,!0)}}e.module("ringid.shared").service("friendsHttpService",n),n.$inject=["$$connector","OPERATION_TYPES","APP_CONSTANTS"]}(angular,window),function(e,t){"use strict";!function(){function t(e,t){var n=this,r=t.SYSTEM.CIRCLE,i=t.SYSTEM.REQUEST_TYPE;n.go=function(t,n){return n=n||"post",e.request(t)},n.getCircleMembers=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_LIST,grpId:t,scl:1,lmt:o||40,pvtid:n||0};return e.send(a,i.REQUEST)},n.createCircle=function(t){var n={actn:r.TYPE_CREATE_GROUP,gNm:t.tg.utf8Encode(),uId:t.uId,groupMembers:t.alluser};return e.request(n,i.UPDATE)},n.getCircles=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.send(t,i.REQUEST)},n.getCircle=function(t){return e.request({actn:r.TYPE_GROUP_DETAILS,grpId:t},i.REQUEST)},n.getCirclesInfo=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.request(t,i.REQUEST)},n.addMembers=function(t){var n={actn:r.TYPE_ADD_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.removeMember=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:[{uId:t.uId}]};return e.request(n,i.UPDATE)},n.removeMembers=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmins=function(t){
var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmin=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:t.grpId,groupMembers:[{admin:t.admin,uId:t.uId}]};return e.request(n,i.UPDATE)},n.leaveCircle=function(t){var n={actn:r.TYPE_LEAVE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.deleteCircle=function(t){var n={actn:r.TYPE_DELETE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.getMemberResult=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_SEARCH_RESULT,grpId:n,schPm:t,st:o||0};return e.send(a,i.REQUEST)}}e.module("ringid.shared").service("circleHttpService",t),t.$inject=["$$connector","OPERATION_TYPES"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getPortalDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,st:e||0,pType:3};return t.pull(n,i.REQUEST,!0)},n.getPortalFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,st:e||0,pType:3};return t.pull(n,i.REQUEST,!0)},n.getPortalCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,utId:e,pType:3};return t.pull(n,i.REQUEST,!0)},n.searchNewsPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:3,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,o,a){var s={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,id:e,subscType:a,npSubIds:n,npUnSubIds:o,pType:3};return t.request(s,i.UPDATE)},n.unFollowPortal=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,id:e,pType:3};return t.request(n,i.UPDATE)},n.getPortalShortDetails=function(e){var n={actn:o,isnp:!0,uId:e,pType:3};return t.request(n,i.REQUEST)}}e.module("ringid.shared").service("portalHttpService",t),t.$inject=["OPERATION_TYPES","$$connector"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E){function p(e){V.remove(e),r.$broadcast(m.CIRCLE.MY_CIRCLE_REMOVED,{circleId:e})}function T(e,t){var n=e.get(t.grpId);return n?n.update(t):n=l.create(t),e.save(n.getKey(),n),n}function h(e){var t;return e.ists||(t=e.sAd==E.currentUser().getKey()?T(K,e):T(V,e)),t}function _(t){e.forEach(t,h)}function I(e){t.circleId&&t.circleId==e&&n.path("/")}function A(){f.show("Circle does not exist!","warning"),n.path("/")}function v(t){var n,r;if(t.sucs)switch(t.actn){case W.TYPE_UPDATE_EDIT_GROUP_MEMBER:case W.TYPE_UPDATE_ADD_GROUP_MEMBER:n=t.grpId,r=R(n),r&&r.setMembers(t.groupMembers);break;case W.TYPE_UPDATE_DELETE_GROUP:n=t.grpId,r=R(n),r&&(p(r.getKey()),I(t.grpId));break;case W.TYPE_UPDATE_REMOVE_GROUP_MEMBER:n=t.grpId,r=R(n),t.removedMembers&&r&&e.forEach(t.removedMembers,function(e){r.removeMember(e)});break;case W.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:t.groupList=[{gNm:t.gNm,grpId:t.grpId,mc:t.mc,sAd:t.sAd}],_(t.groupList),D(t.groupMembers)}}function S(e){return e.actn===W.TYPE_UPDATE_EDIT_GROUP_MEMBER||e.actn===W.TYPE_UPDATE_ADD_GROUP_MEMBER||e.actn===W.TYPE_UPDATE_DELETE_GROUP||e.actn===W.TYPE_UPDATE_REMOVE_GROUP_MEMBER||e.actn===W.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND}function C(e){clearTimeout(B),e.actn===W.TYPE_GROUP_LIST&&e.sucs===!0&&(_(e.groupList),r.$broadcast(m.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE))}function D(t){if(t.sucs===!0&&e.isArray(t.groupMembers)&&t.groupMembers.length){for(var n=0;n<t.groupMembers.length;n++)x=t.groupMembers[n].id;var i=K.get(t.groupMembers[0].grpId);if(i||(i=V.get(t.groupMembers[0].grpId)),!i)return;i.setMembers(t.groupMembers)}r.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:!0})}function N(t){if(Y=t.tr,t.sucs===!0&&e.isArray(t.groupMembers)&&t.groupMembers.length){var n=K.get(t.groupMembers[0].grpId);if(n||(n=V.get(t.groupMembers[0].grpId)),!n)return;n.setMembers(t.groupMembers)}r.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:t.sucs})}function M(e,t){d.getCircle(e).then(function(e){e.sucs===!0&&(t.setMemberCount(e.mc),r.$broadcast(m.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT))})}function R(e){return K.get(e)||V.get(e)}function y(e){var t=R(e),n=c.defer();return t?setTimeout(function(){n.resolve(t)}):d.getCircle(e).then(function(r){r.sucs?(r.grpId=e,r.ists=0,t=h(r),n.resolve(t)):n.reject(!1)},function(e){}),n.promise}function O(e){return e?K:V}function b(e){var t=c.defer();return d.createCircle(e).then(function(e){e.sucs===!0&&d.getCircles(),t.resolve(e)}),t.promise}function P(e,t){var n=c.defer(),r={grpId:t,members:e};return d.addMembers(r).then(function(e){R(t);n.resolve(e)}),n.promise}function L(e,t,n){0===t&&(x=t),d.getCircleMembers(e,x,n)}function U(e,t){d.getMemberResult(e,t,Y)}function w(t){var n=c.defer();return d.leaveCircle({grpId:t.getKey()}).then(function(r){var i=e.fromJson(r);i.sucs===!0?(K.remove(t.getKey()),V.remove(t.getKey()),n.resolve(i)):n.reject("Failed")}),n.promise}function F(e){var t=c.defer();return d.deleteCircle({grpId:e.getKey()}).then(function(n){n.sucs===!0?(K.remove(e.getKey()),V.remove(e.getKey()),t.resolve(n)):t.reject("Failed")}),t.promise}function k(e,t){var n={grpId:t.getKey(),uId:e},i=t.removeMember(e);d.removeMember(n).then(function(e){e.sucs!==!0&&(t.addMember(i),f.show(e,"error")),r.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(e){})}function $(t,n){var i={grpId:n.getKey(),members:[]};e.forEach(t,function(e){i.members.push({uId:e}),n.removeMember(e)}),n.setMemberCount(n.getMembersObjectCount()),d.removeMembers(i).then(function(i){i.sucs!==!0&&(e.forEach(t,function(e){n.addMember(e)}),n.setMemberCount(n.getMembersObjectCount()),f.show(i,"error")),r.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(e){})}function G(e,t){d.addRemoveAdmin(e).then(function(n){if(n.sucs===!0){var i=n.groupMembers[0];i.uId===e.uId&&i.admin===!0?t.promoteToAdmin(e.uId):i.uId===e.uId&&i.admin===!1&&t.removeFromAdmin(e.uId),r.$broadcast(m.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}},function(e){})}function H(e){j||(i.subscribe(v,{action:[W.TYPE_UPDATE_DELETE_GROUP,W.TYPE_UPDATE_REMOVE_GROUP_MEMBER,W.TYPE_UPDATE_ADD_GROUP_MEMBER,W.TYPE_UPDATE_EDIT_GROUP_MEMBER]}),i.subscribe(C,{action:[W.TYPE_GROUP_LIST]})),j&&!e||(j=!0,d.getCircles())}var B,x,Y,K=s.createNew(!0,"asc"),j=!1,V=s.createNew(!0,"asc"),W=o.SYSTEM.CIRCLE;return{init:H,processCircleUpdates:v,circleUpdateFilter:S,processCirclesData:C,processCircleMembersData:D,processCircleSearchMembersData:N,getCircle:R,getCirclePromise:y,getCircles:O,createCircle:b,getCircleMembers:L,leaveGroup:w,deleteCircle:F,addMembers:P,removeMember:k,removeMembers:$,toggleMembership:G,redirectHome:A,getMemberResult:U,getSingleCircleInfo:M}}e.module("ringid.shared").factory("circlesManager",t),t.$inject=["$routeParams","$location","$rootScope","$$connector","OPERATION_TYPES","Storage","$$stackedMap","$$q","circleMap","userFactory","circleHttpService","Notification","SystemEvents","Ringalert","Auth"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r){var i=this,o=r.SYSTEM.REQUEST_TYPE,a=r.SYSTEM.IMAGE;i.fetchAlbumList=function(e){var t={};e?(t.actn=a.FETCH_FRIEND_ALBUM_LIST,t.fndId=e):t.actn=a.FETCH_ALBUM_LIST,n.send(t,o.REQUEST)},i.getAlbumImages=function(e){var t={};e.fndId?(t.actn=a.TYPE_FRIEND_ALBUM_IMAGES,t.fndId=e.fndId):t.actn=a.TYPE_ALBUM_IMAGES,t.st=e.st||0,t.albId=e.albId,n.send(t,o.REQUEST,!0)},i.deleteImage=function(e){return n.request({actn:a.DELETE_IMAGE,imgIds:[e]},o.UPDATE)},i.getImageDetails=function(e){return n.request({actn:a.TYPE_IMAGE_DETAILS,imgId:e},o.REQUEST)},i.getProfilePicORCoverPicImageDetails=function(t){var n=e.defer();return i.go({actn:a.GET_CP_OR_PP_DETAIL,type:t.type}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},i.getFeedImages=function(e){var t={actn:r.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e};return n.request(t,o.REQUEST)}}e.module("ringid.shared").service("imageHttpService",t),t.$inject=["$$q","settings","$$connector","OPERATION_TYPES"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s,c,l){function u(e,t){var n,i,o;switch(e.actn){case f.TYPE_ALBUM_IMAGES:RingLogger.information("got Album images for album: "+e.albId+" success: "+e.sucs,RingLogger.tags.IMAGE),e.sucs===!0?E.get(e.albId)?E.get(e.albId).pushImages(e):(n=new r(e),E.save(n.getKey(),n)):e.sucs===!1&&1111===e.rc&&RingLogger.alert("Album request failed",RingLogger.tags.IMAGE);break;case f.TYPE_FRIEND_ALBUM_IMAGES:RingLogger.information("got Album images for album: "+e.albId+" success: "+e.sucs,RingLogger.tags.IMAGE),e.sucs===!0&&(p.get(e.albId)?p.get(e.albId).pushImages(e):(n=new r(e),p.save(n.getKey(),n)));break;case f.FETCH_FRIEND_ALBUM_LIST:if(e.sucs===!0)for(i=0,o=e.albumList.length;o>i;i++)n=new r(e.albumList[i],t),p.save(n.getKey(),n);break;case f.FETCH_ALBUM_LIST:if(e.sucs===!0)for(i=0,o=e.albumList.length;o>i;i++)n=new r(e.albumList[i],t),E.save(n.getKey(),n);break;default:RingLogger.warning("actn Does not match",e,RingLogger.tags.IMAGE)}}function d(e,t){var r=!1,i=0;if(n.currentUser().getKey()===t){if(i=E.get(e)?E.get(e).getImages().length():0,0!==i&&i>=E.get(e).getTotalImageCount())return}else if(r=t,i=p.get(e)?p.get(e).getImages().length():0,0!==i&&i>=p.get(e).getTotalImageCount())return;c.getAlbumImages({fndId:r,albId:e,st:i})}function g(e){var t=!1;n.currentUser().getKey()!==e&&(t=e),c.fetchAlbumList(t)}var m={imagesLoading:!1,albumsLoading:!1},f=s.SYSTEM.IMAGE,E=o.createNew(),p=o.createNew();return{processResponse:u,state:m,resetAlbums:function(e){e?E.reset():p.reset()},deleteImage:function(e){return c.deleteImage(e.getKey())},getAlbums:function(e){return n.currentUser().getKey()===e?E:p},loadMoreImage:d,fetchAllAlbums:g,getFeedImages:c.getFeedImages,getImageDetails:function(t,n){var r=e.defer();return c.getImageDetails(t).then(function(e){e.sucs===!0?(n&&!e.nfId&&(e.nfId=n),r.resolve(i(e))):l.show(e,"error")},function(e){r.reject()}),r.promise}}}e.module("ringid.shared").factory("AlbumFactory",n),n.$inject=["$$q","settings","Auth","$$albumMap","$$imageMap","$$stackedMap","$$connector","OPERATION_TYPES","imageHttpService","Ringalert"]}(angular,window),function(e,t){"use strict";!function(){function t(e,t){var n=this,r=e.SYSTEM.MEDIA,i=e.SYSTEM.REQUEST_TYPE;n.fetchMediaAlbums=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_LIST,mdaT:e.mdaT||1,utId:e.utId};t.send(n,i.REQUEST,!0)},n.fetchHashtagSuggestion=function(e){return t.pull({actn:r.ACTION_GET_HASHTAG_SUGGESTION,schPm:e.utf8Encode()},i.REQUEST)},n.fetchSearchResult=function(e){var n={actn:r.ACTION_MEDIA_SEARCH_RESULT,schPm:e.utf8Encode()};return t.pull(n,i.REQUEST)},n.fetchContent=function(e){var n={actn:r.ACTION_SPECIFIC_MEDIA_RESULT,schPm:e.sk.utf8Encode(),sugt:e.sugt,pvtid:e.pvtid||0,scl:e.scl||1};return t.send(n,i.REQUEST)},n.fetchAlbumDetails=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_DETAILS,albId:e};return t.request(n,i.REQUEST)},n.addMediaAlbum=function(e){var n={actn:r.ACTION_ADD_MEDIA_ALBUM,imgURL:e.imgURL||"",albn:e.albn.utf8Encode(),mdaT:e.mdaT};return t.request(n,i.UPDATE)},n.updateMediaAlbum=function(e){var n={actn:r.ACTION_UPDATE_MEDIA_ALBUM,albId:e.albId,imgURL:e.imgURL,mdaT:e.mdaT,albn:e.albn.utf8Encode()};return t.request(n,i.UPDATE)},n.deleteAlbum=function(e){var n={actn:r.ACTION_DELETE_MEDIA_ALBUM,albId:e};return t.request(n,i.UPDATE)},n.fetchAlbumContents=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId,utId:e.utId,st:e.st||0};t.send(n,i.REQUEST)},n.fetchAlbumContentsForpopup=function(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId||e.id,utId:e.utId,st:e.st||0};return t.pull(n,i.REQUEST)},n.addMediaToAlbum=function(e){var n={actn:r.ACTION_ADD_MEDIA_CONTENT,albId:e.albId,mdaLst:e.mdaLst,mdaT:e.mdaT};return t.request(n,i.UPDATE)},n.updateMediaAlbum=function(e){var n={actn:r.ACTION_UPDATE_MEDIA_CONTENT,mdaCntntDTO:e.mdaCntntDTO};return t.request(n,i.UPDATE)},n.deleteAlbumContent=function(e){var n={actn:r.ACTION_DELETE_MEDIA_CONTENT,cntntId:e};return t.request(n,i.UPDATE)},n.increaseViewCount=function(e,n){var o={actn:r.ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT,cntntId:e};return n&&(o.nfId=n),t.request(o,i.UPDATE)},n.getSearchTrends=function(){var e={actn:281};return t.pull(e,i.REQUEST)},n.getTaggedMedia=function(e){var n={actn:r.ACTION_GET_TAGGED_MEDIA_SONGS,htid:e,pvtid:0,scl:2};return t.send(n,i.REQUEST)},n.fetchSliderImage=function(e){var n={actn:r.ACTION_GET_MEDIA_SLIDER_IMG,mdaT:e.mdaT};return t.pull(n,i.REQUEST,!0)}}e.module("ringid.shared").service("mediaHttpService",t),t.$inject=["OPERATION_TYPES","$$connector"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T){function h(e){RingLogger.print(e,RingLogger.tags.MEDIA);var t,n,r,a;switch(e.actn){case L.ACTION_MEDIA_ALBUM_LIST:if(e.sucs===!0&&e.mediaAlbumList)for(S=o.currentUser().getUtId()===e.utId?o.currentUser():i.create({utId:e.utId}),n=0,r=e.mediaAlbumList.length;r>n;n++)a=e.mediaAlbumList[n].albId||e.mediaAlbumList[n].id,t=M.get(a)||R.get(a),t?t.updateAlbum(e.mediaAlbumList[n]):t=d.createAlbum(e.mediaAlbumList[n],S),S&&S.isCurrentUser()?M.save(t.getKey(),t):R.save(t.getKey(),t);break;case L.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(e.sucs===!0&&e.mdaCntntLst){var s=d.createKey(e);t=M.get(s)||R.get(s),t&&t.pushContent(e.mdaCntntLst)}}}function _(e,t){switch(P=e||(o.currentUser()?o.currentUser().getUtId():!1),t){case"audio":u.fetchMediaAlbums({utId:P,mdaT:w.NEWS_FEED_MEDIA_TYPE_AUDIO});break;case"video":setTimeout(function(){u.fetchMediaAlbums({utId:P,mdaT:w.NEWS_FEED_MEDIA_TYPE_VIDEO})},500);break;default:u.fetchMediaAlbums({utId:P,mdaT:w.NEWS_FEED_MEDIA_TYPE_AUDIO}),setTimeout(function(){u.fetchMediaAlbums({utId:P,mdaT:w.NEWS_FEED_MEDIA_TYPE_VIDEO})},500)}}function I(e){return e=parseInt(e),M.get(e)||R.get(e)||y.get(e)}function A(){return N?!1:(N=!0,_(),!0)}function v(e,t){switch(e){case"mediaInAlbums":return E.request({actn:L.ACTION_CHECK_MEDIA_IN_ALBUMS,strmURL:t.strmURL},U.REQUEST)}}var S,C,D={albumsLoading:!1,contentsLoading:!1,noresultfound:!1},N=!1,M=m.createNew(),R=m.createNew(),y=m.createNew(),O=m.createNew(),b=m.createNew(),P=0,L=c.SYSTEM.MEDIA,U=c.SYSTEM.REQUEST_TYPE,w=l,F=[],k=[],$=[];return C=E.subscribe(h,{action:[L.ACTION_MEDIA_ALBUM_LIST,L.ACTION_MEDIA_SEARCH_RESULT]}),{init:A,state:D,processResponse:h,getAlbum:I,resetMediaAlbums:function(){R.reset()},getUserAlbums:function(e){return e?t(R.all(),{mapApi:"getType",value:e,compare:"regex"}):R},getAlbums:function(e,n){var r=e?M:R;return n?t(r.all(),{mapApi:"getType",value:n,compare:"regex"}):r},getSearchedSongs:function(){return b},getSearchedAlbums:function(){return O},getContentIdArray:function(){return k},resetContentIdArray:function(){k=[]},getAlbumIdArray:function(){return $},resetAlbumIdArray:function(){$=[]},getSearchedTagArr:function(){return F},resetSearchedSongs:function(){return b.reset()},resetSearchedAlbum:function(){return O.reset()},resetSearchedTagArr:function(){F=[]},fetchAllAlbums:_,createAlbum:function(t,r){var i,a;return r&&(t.id=n.getUniqueID(),a=f.defer()),r&&u.addMediaAlbum(t).then(function(n){RingLogger.print(e.toJson(n),RingLogger.tags.MEDIA),n.sucs===!0?(i=d.createAlbum(e.extend(t,{id:n.albId}),o.currentUser()),M.save(i.getKey(),i),a.resolve(i)):(RingLogger.warning("CREATE NEW ALBUM FAILED: "+n.mg,RingLogger.tags.MEDIA),a.reject(!1))},function(){RingLogger.warning("CREATE NEW ALBUM FAILED: "+json.mg,RingLogger.tags.MEDIA),a.reject(!1)}),r?a.promise:i},deleteAlbum:function(t){u.deleteAlbum(t.getId()).then(function(n){RingLogger.print(e.toJson(n),RingLogger.tags.MEDIA),n.sucs===!0?M.remove(t.getKey()):RingLogger.warn("Delete Album  Failed: "+n.mg,RingLogger.tags.MEDIA)})},fetchAlbumContents:u.fetchAlbumContents,fetchAlbumContentsForpopup:u.fetchAlbumContentsForpopup,getSearchTrends:function(){return u.getSearchTrends()},getTaggedMedia:function(e){u.getTaggedMedia(e)},fetchSearchResult:function(e){return u.fetchSearchResult(e)},fetchSliderImage:function(e){return u.fetchSliderImage(e)},fetchHashtagSuggestion:u.fetchHashtagSuggestion,fetchContent:function(e){return D.noresultfound=!1,u.fetchContent(e)},makeApiCall:v}}e.module("ringid.shared").factory("Media",t),t.$inject=["mapFilterFilter","Utils","Ringalert","userFactory","Auth","$routeParams","Storage","OPERATION_TYPES","APP_CONSTANTS","mediaHttpService","$$mediaAlbumMap","$$mediaMap","$$stackedMap","$$q","$$connector","SystemEvents","$rootScope"]}()}(angular,window),function(e,t){"use strict";!function(){e.module("ringid.shared").factory("EmotionFactory",["$$connector","settings","OPERATION_TYPES",function(t,n,r){function i(e){return{id:e.id,title:e.nm,nm:e.nm,url:n.emotionServer+e.url,cat:e.cat}}function o(e){var t;if(e.sucs&&e.mdLst.length)for(t=0;t<e.mdLst.length;t++)l[e.mdLst[t].id]=i(e.mdLst[t]),d++;s()}function a(){var e=[];for(var t in l)l.hasOwnProperty(t)&&e.push(l[t]);return e}function s(){var e;for(var t in g)e=g[t],e&&e.$id&&!e.$$destroyed&&e.setEmotion.call(e,a())}function c(){d?s():t.send({actn:u.FETCH_EMOTION_LIST},u.REQUEST_TYPE.REQUEST)}var l={},u=r.SYSTEM,d=0,g={};t.subscribe(o,{action:u.FETCH_EMOTION_LIST});return{init:c,getEmotions:a,getLength:function(){return d},getEmotion:function(t,n){var r=e.isObject(t)?t.id:t;return n?l[r]?l[r]:e.isObject(t)?i(t):!1:l[r]||!1},setScopeForDigest:function(e){g[e.$id]=e},removeScope:function(e){g[e.$id]&&(g[e.$id]=null)}}}])}()}(angular,window),function(e,t){"use strict";!function(t){function n(t,n,r,i,o,a,s,c,l,u,d,g,m){function f(e){o.setSortKey(e)}function E(){return Me.hasOwnProperty(De)?Me[De].data:i.createNew()}function p(){return Me.hasOwnProperty(De)?Me[De].removed:i.createNew()}function T(){var e=[];try{e=De.split(".",3)}catch(t){return!1}return e.length<2?!1:{action:parseInt(e[0]),page:e[1],ptype:e[2]}}function h(){for(var e=E(),t=0;t<e.length();t++){var n=Date.now()-e.all()[t].value.getTimestamp();36e5>n&&e.all()[t].value.updateTime()}}function _(e){var t=E();return t.length()<10?(ue(e),!0):!1}function I(){E().reset(),p().reset(),Re.length=0}function A(){var e=o.getSortIndex(),t=E();if("tm"===e)return t.length()?t.top().getTimestamp():d;var n=t.length()?t.top().getAtTime():d;return n}function v(e,t){return o.create(e,t)}function S(){return!0}function C(e,t){return e.nfId==t.page||e.whShrLst&&e.whShrLst[0].nfId==t.page}function D(e,t){return!!e.grpId&&e.grpId==t.page}function N(e,t,n){return t.action===n}function M(e,t,n){return t.action===n}function R(e,t){return t||(t=T()),t.page===e.uId||e.fndId&&t.page===e.fndId?!0:!(!e.orgFd||t.page!==e.orgFd.uId)}function y(e,t){return t||(t=T()),!!(t.page===e.uId||e.fndId&&t.page===e.fndId)}function O(e){b(e)}function b(e){$(e,R,{processWhoShare:function(e,t,n){var r,i;e.uId===n.page&&e.orgFd&&(i=v(e.orgFd),r=v(e),r.shares(i),t.save(r.getMapKey(),r))}})}function P(e){$(e,y)}function L(e){$(e,D)}function U(e){$(e,N)}function w(e){$(e,M)}function F(e){$(e,S)}function k(e){var t;Me.special||(Me.special=i.createNew(o.getSortIndex(),"desc")),t=v(e),Me.special.save(t.getMapKey(),t)}function $(t,n,r){r=r||{},e.isFunction(n)||(n=function(){return!0});var i=e.isArray(t)?t:t.newsFeedList;if(e.isArray(i))for(var o,a,s,c,l=T(),u=E(),d=0;d<i.length;d++)s=i[d],c=s.nfId,0==Ne?Ne=c:Ne>c&&(Ne=c),1!=s.fc?n(s,l,t.actn)&&(s.deleted?deleteFromIndexedFeed(s.nfId):s.whShrLst||s.orgFd?r.processWhoShare&&e.isFunction(r.processWhoShare)?r.processWhoShare.call(null,s,u,l):(s.orgFd?(o=v(s),(a=j(s.orgFd.nfId))||(a=v(s.orgFd))):(o=v(s.whShrLst[0]),(a=j(s.nfId))||(a=v(s))),o.shares(a),u.save(o.getMapKey(),o),Y(a,o.getKey())):(o=v(s),u.save(o.getMapKey(),o))):k(i[d])}function G(e){$(e,C)}function H(e){switch(e||(e=T()),e.action){case Se.TYPE_MY_NEWS_FEED:case Se.TYPE_FRIEND_NEWSFEED:return 3==e.ptype?y:R;case Se.TYPE_GROUP_NEWS_FEED:return D;case Se.TYPE_MEDIAS_NEWS_FEED:return N;case Se.TYPE_NEWS_PORTAL_FEED:return M;case Se.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:return C;case Se.TYPE_NEWS_FEED:default:return S}}function B(e){var t=T();switch(t.action){case Se.TYPE_MY_NEWS_FEED:b(e);break;case Se.TYPE_FRIEND_NEWSFEED:3==t.ptype?P(e):O(e);break;case Se.TYPE_GROUP_NEWS_FEED:L(e);break;case Se.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:G(e);break;case Se.TYPE_NEWS_FEED:F(e);break;case Se.TYPE_MEDIAS_NEWS_FEED:U(e);break;case Se.TYPE_NEWS_PORTAL_FEED:w(e)}}function x(){for(var e;Re.length&&ye;)e=Re.shift(),e.callback?e.callback.call(null,e,!0):B([e])}function Y(e,t,n){n||(n=p()),e.reference=t,n.save(e.getMapKey(),e)}function K(e,t){return t||(t=p()),e=o.getPrefix()+e,t.get(e)}function j(e){var t;return t=E(),e=o.getPrefix()+e,t.get(e)}function V(e){var t=E();t.add(e.getMapKey(),e)}function W(e,t){return t||(t=E()),t.remove(o.makeKey(e))}function q(e,t,n){if(e){var r=te(e);return r&&r.isSingleContentFeed()?(r.setTotalLikes(n,t),Pe[e]):void 0}}function z(e,t,n){if(e){var r=Pe[e];return r&&r.feed.isSingleContentFeed()?(r.feed.setTotalComment(t,n),r):void 0}}function Q(e){var t=j(e.nfId),n=Pe[e.nfId];if(t&&n){switch(e.actn){case Se.TYPE_UPDATE_EDIT_STATUS:t.update(e);break;case Se.TYPE_UPDATE_LIKE_STATUS:case Se.TYPE_UPDATE_UNLIKE_STATUS:t.setTotalLikes(e.loc),t.setFeedTopMessage();break;case Se.TYPE_UPDATE_ADD_STATUS_COMMENT:case Se.TYPE_UPDATE_DELETE_STATUS_COMMENT:t.setTotalComment(e.loc),t.setFeedTopMessage()}return n}}function X(e){W(e.nfId)}function Z(e,t,n,r){if(ye&&!t){e.callback=Z;var i=H();return void(i.call(null,e.newsFeed)&&Re.push(e))}var o=e.newsFeed.orgFd&&e.newsFeed.orgFd.nfId;if(o){var a=j(o),s=p();if(a){if(n)return a.setActivity(e.newsFeed.orgFd),Pe[a.getKey()];Y(a,e.newsFeed.nfId,s),W(a.getKey())}else if(a=K(o,s)){var i=H();return void $([e.newsFeed],i,{processWhoShare:function(e,t,i){var o,s=j(a.reference);if(!s)return void B([e]);if(i.page!=Se.TYPE_FRIEND_NEWSFEED&&i.page!=Se.TYPE_MY_NEWS_FEED){if(a.update(e,!0),n)return a.addShareUser(r),s.updateShareMessage(),s.setActivity(e),Pe[s.getKey()];o=v(e),o.setActivity(e.orgFd),W(a.reference),o.shares(a),t.save(o.getMapKey(),o)}}})}B([e.newsFeed])}}function J(e){if(e.imageList||1!==e.type||(e.imageList=[e]),ye){var t=H();t.call(null,e,T())&&Re.push(e)}else B([e])}function ee(t){var n,r=!1,i=e.isArray(t)?t[0]:t;if(Oe.length)for(n=0;n<Oe.length;n++)Oe[n].action===i.actn&&(r=Oe[n].callback.call(null,i));return be[i.actn]&&!r?be[i.actn].call(null,i):void 0}function te(e){return j(e)}function ne(e,t){var n=a.getUniqueID();return Oe.push({key:n,action:e,callback:t}),n}function re(e){for(var t=-1,n=0;n<Oe.length;n++)Oe[n].key===e&&(t=n);return-1!=t?Oe.splice(t,1):[]}function ie(e){De=e,Me.hasOwnProperty(De)||(Me[De]={data:i.createNew(o.getSortIndex(),"desc"),removed:i.createNew(),no_more_feed:!1})}function oe(e){return ee(e)}function ae(){return function(e){return!!be[e.actn]}}function se(){return E().all()}function ce(){var e=E();return e.all()}function le(){return Me.hasOwnProperty(De)?Me[De].no_more_feed:!1}function ue(t){var r=Ce.FEED_LIMIT;switch(t=e.copy(t||{}),t.pvtid=Ne||0,t.st=ce().length||0,a.feedColumn()){case 1:r=5;break;case 2:r=6;break;case 3:r=9}return t.lmt=t.lmt||r,n.send(t,Se.REQUEST_TYPE.REQUEST)}function de(t){t=e.copy(t||{}),t.scl=2,t.tm=0,ue(t)}function ge(t,n){var r=A();return t=e.copy(t||{}),t.scl=n||2,t.tm=r?r:d,ue(t)}function me(t,i){var o={actn:Se.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:t},a=r.defer(),s=te(t);return s?a.resolve(s):n.request(o,Se.REQUEST_TYPE.REQUEST).then(function(t){if(t.sucs===!0){var n=e.isArray(t)?t:t.newsFeedList[0];if(i&&n.orgFd){if(n.orgFd){s=v(n);var r=v(n.orgFd);s.shares(r)}}else s=v(n);if(s){var o=E();o.save(s.getMapKey(),s)}a.resolve(s)}else a.resolve(!1)},function(e){a.reject(e)}),a.promise}function fe(i,o,s){var c,u=r.defer(),d=0,f=E(),p=a.getUniqueID();i.stsTags=[];var T="",T="";i.text&&(T=i.text.replace(/##([\d]+)##/g,function(e,t,n){var r;return r=n-d,i.stsTags.push({pstn:r,utId:t}),d+=e.length,""}),i.text=T),s?c=i.feed?i.feed:te(i.nfId):(c=v({nfId:p,fpvc:i.fpvc,sts:i.text,lat:i.lat||9999,lng:i.lng||9999,grpId:i.group||"",friendId:i.friend||"",fndId:i.friend||"",mdLst:i.mdIds||[],isNew:1,pending:!0,lctn:i.lctn||"",lnkDmn:i.lnkDmn||"",lnkDsc:i.lnkDsc||"",lnkTtl:i.lnkTtl||"",lnkURL:i.lnkURL||"",lnlImgURL:i.lnlImgURL||""},o),f.save(c.getMapKey(),c));var h={};if(i.cntntIDLst&&(h.cntntIDLst=i.cntntIDLst),i.group&&(h.grpId=i.group),i.friend&&(h.fndId=parseInt(i.friend)),i.lctn&&(h.lctn=i.lctn.utf8Encode()),i.lnkDmn&&(h.lnkDmn=i.lnkDmn.utf8Encode()),i.lnkDsc&&(h.lnkDsc=i.lnkDsc.utf8Encode()),i.lnkTtl&&(h.lnkTtl=i.lnkTtl.utf8Encode()),i.lnkURL&&(h.lnkURL=i.lnkURL.utf8Encode()),i.lnlImgURL&&(h.lnlImgURL=i.lnlImgURL.utf8Encode()),i.stsTags.length&&(h.stsTags=i.stsTags),h.actn=Se.TYPE_ADD_STATUS,i.images&&i.images.length>0)if(1===i.images.length)h.type=Se.NEWS_FEED_TYPE_IMAGE,h=e.extend({},h,i.images[0].getAuthData());else{h.actn=Se.TYPE_ADD_MULTI_IMAGE,h.type=Se.NEWS_FEED_TYPE_MULTIPLE_IMAGE,h.imageList=[];for(var _=0,I=i.images.length;I>_;_++)h.imageList.push(i.images[_].getAuthData())}else if(i.videos&&i.videos.length>0){h.mdaCntntDTO={albId:t.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:Ce.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:Ce.NEWS_FEED_MEDIA_TYPE_VIDEO},h.type=Se.NEWS_FEED_TYPE_VIDEO;for(var _=0,I=i.videos.length;I>_;_++)h.mdaCntntDTO.mdaLst.push(i.videos[_].getAuthData(!0)),0===_&&(h.mdaCntntDTO.htgLst=h.mdaCntntDTO.mdaLst[0].htgLst)}else if(i.audios&&i.audios.length>0){h.mdaCntntDTO={albId:t.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:Ce.NEWS_FEED_MEDIA_TYPE_AUDIO,lnkT:Ce.NEWS_FEED_MEDIA_TYPE_AUDIO},h.type=Se.NEWS_FEED_TYPE_AUDIO;for(var _=0,I=i.audios.length;I>_;_++)h.mdaCntntDTO.mdaLst.push(i.audios[_].getAuthData(!0)),0===_&&(h.mdaCntntDTO.htgLst=h.mdaCntntDTO.mdaLst[0].htgLst)}else h.actn=Se.TYPE_ADD_STATUS,s?h.type=i.audio?Se.NEWS_FEED_TYPE_AUDIO:Se.NEWS_FEED_TYPE_VIDEO:h.type=Se.NEWS_FEED_TYPE_STATUS;return i.mdIds&&(h.mdIds=i.mdIds),i.tFrndIds&&(h.tFrndIds=i.tFrndIds),h.vldt=i.vldt||"-1",h.lng=i.lng||9999,h.lat=i.lat||9999,h.sts=i.text.utf8Encode(),h.fpvc=i.fpvc||2,n.request(h,Se.REQUEST_TYPE.UPDATE).then(function(e){g.$broadcast(m.FILE_UPLOAD.UPLOADS_POSTED),e.sucs?(s?c&&c.share(e.mdaCntntLst[0].is,e.mdaCntntLst[0].ns):(f.remove(c.getMapKey()),e.type===Se.TYPE_SINGLE_IMAGE_STATUS&&(e.imageList=[e]),B([e])),u.resolve(e)):(s||(f.remove(c.getMapKey()),l.show(e,"error")),u.reject(e))},function(e){s||(f.remove(c.getMapKey()),l.show(json,"error")),u.reject(json)}),u.promise}function Ee(e){if(e.addShare)return fe(e,e.user,!0);var t=r.defer(),i={actn:Se.ACTION_SHARE_STATUS,sfId:e.feed.getKey(),type:2,sts:e.text.utf8Encode()};return e.mdIds&&(i.mdIds=e.mdIds),e.tFrndIds&&(i.tFrndIds=e.tFrndIds),e.location&&(e.location.description&&(i.lctn=e.location.description.utf8Encode()),e.location.lat&&(i.lat=e.location.lat,i.lng=e.location.lng)),n.request(i,Se.REQUEST_TYPE.UPDATE).then(function(n){n.sucs?(Z(n,!0,!0,u.currentUser()),e.feed.share(!0),t.resolve(n)):t.reject(n)},function(e){t.reject(e)}),t.promise}function pe(e,t){var i=r.defer(),o=j(t),a=E();return o?(o.user().isCurrentUser(e.getKey())||setTimeout(function(){i.reject("You are not authorized to delete this feed.")},100),o!==!1?(W(o.getKey(),a),n.request({actn:Se.TYPE_DELETE_STATUS,nfId:t},Se.REQUEST_TYPE.UPDATE).then(function(e){e.sucs?i.resolve(e):(V(o),i.reject(e))},function(e){V(o),i.reject(e)})):setTimeout(function(){i.reject("Feed Not Found!")},100),i.promise):(setTimeout(function(){i.reject("Can't Delete Invalid Feed")}),i.promise)}function Te(e,t){var r={actn:Se.PORTAL.ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED,optn:t,feedIdList:[e]};return n.request(r,Se.REQUEST_TYPE.UPDATE)}function he(t,i,o,a,s,c,l){if(e.isObject(i)||(i=j(g)),i&&i.user().isCurrentUser(t.getKey())){var u,d=r.defer(),g=i.getKey(),m=i.text(),f=i.getLocationInfo(),E=i.getFeelings(),p=[],T=0;o&&(u=o.replace(/##([\d]+)##/g,function(e,t,n){var r;return r=n-T,p.push({pstn:r,utId:t}),T+=e.length,""}),o=u);var h={actn:Se.TYPE_EDIT_STATUS,nfId:g,sts:o.utf8Encode()};p.length&&(h.stsTags=p),a=a||{},h.lctn=a.description?a.description.utf8Encode():"",h.lat=a.lat||9999,h.lng=a.lng||9999;var _=s&&(!i.hasOgData()||i.getLinkUrl()!=s.url||i.getLinkImageUrl()!=s.image);_&&(h.lnkDmn=s.domain||"",h.lnkDsc=s.description?s.description.utf8Encode():"",h.lnkTtl=s.title?s.title.utf8Encode():"",h.lnkURL=s.url?s.url.utf8Encode():"",h.lnlImgURL=s.image||"");var I=!1;return c&&c.id?(h.mdIds=[c.id],I=!0):(h.mdIds=[],I=!0),l&&(l.removed&&(h.rTFrndIds=l.removed),l["new"]&&(h.tFrndIds=l["new"])),i!==!1&&(i.setText(o,p),i.setLocationInfo(a),I&&i.setFeelings(c),_&&i.setOgData(s),n.request(h,Se.REQUEST_TYPE.UPDATE).then(function(e){e.sucs===!1?(i.setText(m),i.setLocationInfo(f),I&&i.setFeelings(E),_&&i.setOgData(oldOgData),d.reject(e)):d.resolve(e)},function(e){i.setText(m),i.setLocationInfo(f),I&&i.setFeelings(E),_&&i.setOgData(oldOgData),d.reject(e)})),d.promise}}function _e(e){var t=r.defer(),i={actn:Se.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e.getKey()};return n.request(i,Se.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?t.resolve(e):(l.show(e,"error"),t.reject())},function(e){l.show(e,"error"),t.reject()}),t.promise}function Ie(e){return n.pull({actn:Se.TYPE_TAG_USER_LIST,nfId:e.getKey()},Se.REQUEST_TYPE.REQUEST)}function Ae(e){return Se.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS+"."+e}function ve(t){var n=e.isArray(t)?t:t.newsFeedList;return n.length>0&&n[0].whShrLst[0]?n[0].whShrLst[0].nfId:!1}var Se=s.SYSTEM,Ce=c,De=Se.TYPE_NEWS_FEED+".all",Ne=0,Me={},Re=[],ye=!1,Oe=[],be={},Pe={};return be[Se.TYPE_NEWS_FEED]=B,be[Se.TYPE_MY_NEWS_FEED]=B,be[Se.TYPE_FRIEND_NEWSFEED]=B,be[Se.TYPE_GROUP_NEWS_FEED]=B,be[Se.TYPE_MEDIAS_NEWS_FEED]=B,be[Se.TYPE_NEWS_PORTAL_FEED]=B,be[Se.TYPE_BUSINESS_PAGE_FEED]=B,be[Se.TYPE_UPDATE_ADD_STATUS]=J,be[Se.ACTION_UPDATE_SHARE_STATUS]=Z,be[Se.TYPE_UPDATE_DELETE_STATUS]=X,be[Se.TYPE_UPDATE_EDIT_STATUS]=Q,be[Se.TYPE_UPDATE_LIKE_STATUS]=Q,be[Se.TYPE_UPDATE_UNLIKE_STATUS]=Q,be[Se.TYPE_UPDATE_ADD_STATUS_COMMENT]=Q,be[Se.TYPE_UPDATE_DELETE_STATUS_COMMENT]=Q,{init:_,addScope:function(e,t){Pe[e]=t},removeScope:function(e){Pe[e]&&delete Pe[e]},getFeed:te,updateTime:h,pushFeed:B,processIncomingFeed:x,setpushInIncomingFeed:function(e){ye=!!e},getPushIncomingFeed:function(){return ye},hasUnprocessedFeed:function(){return Re.length},addIgnoreFilter:ne,removeIgnoreFilter:re,setFactoryKey:ie,createFeed:v,process:oe,getFeedFilter:ae,noMoreFeed:le,requestForFeed:ue,initFeedRequest:de,getSingleFeed:me,requestForMoreFeed:ge,getRawFeeds:se,getFeeds:ce,addFeed:fe,shareFeed:Ee,deleteFeed:pe,saveFeed:Te,updateFeed:he,reset:I,moreFeedText:_e,getSingleFeedPageKey:Ae,getWhoShareFeedId:ve,getTagUsers:Ie,setSortBy:f,getCurrentPageValue:T,hasSpecialFeed:function(){var e=T();return Se.TYPE_NEWS_FEED===e.action&&Me.special&&Me.special.length()>0},getSpecialFeedList:function(){return Me.special&&Me.special.all()},synchLike:q,synchComment:z}}e.module("ringid.shared").factory("feedFactory",n),n.$inject=["fileUploadService","$$connector","$$q","$$stackedMap","$$feedMap","Utils","OPERATION_TYPES","APP_CONSTANTS","Ringalert","Auth","MIN_TIMESTAMP","$rootScope","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a){function s(e){var t;switch(e.actn){case E.TYPE_PEOPLE_YOU_MAY_KNOW:if(e.sucs===!0){for(t=0;t<e.contactIds.length;t++)m.push(e.contactIds[t]);l()}else e.sucs===!1&&1111===e.rc?(RingLogger.warning("SUGGESTION UTID LIST FETCH REPEAT",RingLogger.tags.INVITE),c()):RingLogger.warning("SUGGESTION UTID LIST FETCH FAIL",RingLogger.tags.INVITE);break;case E.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:if(T.state.isRequestsLoading=!1,e.sucs===!0)for(t=0;t<e.contactList.length;t++)m.splice(m.indexOf(e.contactList[t].utId),1),g=n.create(e.contactList[t]),g.isFriend()||T.suggestionFriends.save(g.getUtId(),g);else e.sucs===!1&&1111===e.rc?(RingLogger.warning("SUGGESTION DETAILS FETCH REPEAT",RingLogger.tags.INVITE),l()):RingLogger.warning("SUGGESTION DETAILS LIST FETCH FAIL",RingLogger.tags.INVITE)}}function c(){return e.send({actn:E.TYPE_PEOPLE_YOU_MAY_KNOW},p.REQUEST)}function l(t){return t=t||10,
T.state.isRequestsLoading?void 0:(T.state.isRequestsLoading=!0,e.send({actn:E.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:m.slice(0,t)},p.REQUEST))}function u(t,n){var r=a.defer(),o={actn:33,utId:t};return e.request(o,p.REQUEST).then(function(e){e.sucs===!0&&("remove"!==n&&i.addToUtIdList("outgoingUtIds",e.utId),T.suggestionFriends.remove(t),T.suggestionFriends.length()<5&&l(),r.resolve(e))},function(e){r.reject(e)}),r.promise}function d(t){f||e.subscribe(s,{action:[E.TYPE_PEOPLE_YOU_MAY_KNOW,E.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),f&&!t||(f=!0,c())}var g,m=[],f=!1,E=t.SYSTEM.FRIENDS,p=t.SYSTEM.REQUEST_TYPE,T=(t.SYSTEM.PROFILE,{init:d,state:{isRequestsLoading:!1},suggestionFriends:o.createNew(),getSuggestionContactsDetails:l,removeSuggestion:u,allSuggestionFriends:o.createNew(),noOfSuggestions:function(){return T.suggestionFriends.length()}});return T}e.module("ringid.shared").factory("InviteFactory",t),t.$inject=["$$connector","OPERATION_TYPES","userFactory","Storage","friendsFactory","$$stackedMap","$$q"]}()}(angular,window),function(e,t){"use strict";!function(){function n(e,t){function n(t){var n={};switch(t.type){case"feed":n.cmntT=1,n.nfId=t.key;break;case"image":n.cmntT=2,n.imgId=t.key;break;case"media":n.cmntT=3,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.actn=l.ACTION_GET_FULL_COMMENT,n.cmnId=t.commentId,e.request(n,l.REQUEST_TYPE.REQUEST)}function r(t,n,r){var i={};if(!t.key||!t.type)throw new Error("key and type must needed for fetcing comment");switch(t.type){case"feed":i.actn=l.TYPE_COMMENTS_FOR_STATUS,i.nfId=t.key;break;case"image":i.actn=l.IMAGE.TYPE_COMMENTS_FOR_IMAGE,i.imgId=t.key,t.target.getFeedKey()&&(i.nfId=t.target.getFeedKey());break;case"media":i.actn=l.MEDIA.ACTION_MEDIA_COMMENT_LIST,i.cntntId=t.key,t.target.getFeedKey()&&(i.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n?(i.scl=r?r:1,i.tm=n):i.st=t.st||0,e.pull(i,l.REQUEST_TYPE.REQUEST,!0)}function i(t){var n={};switch(t.type){case"feed":n.actn=l.TYPE_ADD_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=l.IMAGE.TYPE_ADD_IMAGE_COMMENT,n.imgId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;case"media":n.actn=l.MEDIA.ACTION_ADD_COMMENT_ON_MEDIA,n.cntntId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n.cmn=t.text.utf8Encode(),e.request(n,l.REQUEST_TYPE.UPDATE,!0)}function o(t){var n={};switch(t.type){case"feed":n.actn=l.TYPE_EDIT_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=l.IMAGE.TYPE_EDIT_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=l.MEDIA.ACTION_EDIT_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,n.cmn=t.text.utf8Encode(),e.request(n,l.REQUEST_TYPE.UPDATE)}function a(t){var n={};switch(t.type){case"feed":n.actn=l.TYPE_DELETE_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=l.IMAGE.TYPE_DELETE_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=l.MEDIA.ACTION_DELETE_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,e.request(n,l.REQUEST_TYPE.UPDATE,!0)}function s(e,t){var n,r,i=[l.TYPE_UPDATE_ADD_STATUS_COMMENT,l.TYPE_UPDATE_LIKE_COMMENT,l.TYPE_UPDATE_UNLIKE_COMMENT,l.TYPE_UPDATE_DELETE_STATUS_COMMENT,l.TYPE_UPDATE_EDIT_STATUS_COMMENT],o=[l.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT,l.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT,l.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT,l.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT],a=[l.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT,l.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT,l.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT,l.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT];switch(e){case"feed":n=i,r="nfId";break;case"image":n=o,r="imgId";break;case"media":n=a,r="cntntId";break;default:return[1111111]}return function(e){return-1!==n.indexOf(e.actn)&&e[r]===t}}var c,l=t.SYSTEM;return c={getComment:n,getComments:r,addComment:i,updateComment:o,deleteComment:a,getUpdateFilter:s}}function r(n,r,i,o,a,s,c,l,u,d,g,m,f){function E(){n.$parent&&1!==n.$parent.$id?n.$parent.$rgDigest():n.$rgDigest()}function p(e,t){e&&(n.commentEditorEnabled=!0,n.commentKey=e,n.models.commentedittext=t,E())}function T(e){n.loadingComment=e,b&&(t.clearTimeout(b),b=void 0)}function h(){O=r.subscribe(function(e){switch(e.actn){case P.TYPE_UPDATE_ADD_STATUS_COMMENT:case P.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT:case P.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT:D({comments:[e]});break;case P.TYPE_UPDATE_EDIT_STATUS_COMMENT:case P.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT:case P.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT:var t=n.comments.get(e.cmnId);t&&t.setComment(e.cmn);break;case P.TYPE_UPDATE_LIKE_COMMENT:case P.TYPE_UPDATE_UNLIKE_COMMENT:case P.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:case P.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:var t=n.comments.get(e.cmnId);t&&t.incomingLike(e.loc);break;case P.TYPE_UPDATE_DELETE_STATUS_COMMENT:case P.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT:case P.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT:n.comments.remove(e.cmnId)}E()},{filter:a.getUpdateFilter(n.commentType,n.target.getKey())}),n.$on("$destroy",function(){O&&r.unsubscribe(O),O=!1})}function _(e){var t,r=!1;n.comments.length()&&(t=n.comments.getByIndex(0),r=t.getTimestamp()),C(r,2,e)}function I(e){e.comments&&(e.comments.length>5&&n.target.getTotalComment()>n.comments.length()+e.comments.length?(e.comments.sort(function(e,t){return e.tm>t.tm?1:-1}),e.comments.splice(0,1),D({comments:e.comments}),n.previousComment=!0):(n.previousComment=!1,D(e)))}function A(){var e=!1;if(parseInt(n.activeCommentId)>0){var t;n.comments.length()&&(t=n.comments.getByIndex(n.comments.length()-1),e=t.getTimestamp())}C(e,1)}function v(e){e.comments&&(e.comments.length>5&&n.target.getTotalComment()>n.comments.length()+e.comments.length?(e.comments.sort(function(e,t){return e.tm<t.tm?1:-1}),e.comments.splice(0,1),D({comments:e.comments}),n.afterComment=!0):(n.afterComment=!1,D(e)))}function S(){if(parseInt(n.activeCommentId)>0){var e=n.commentType,t=n.target;"feed"===n.commentType&&n.target.isSingleContentFeed()&&(t=n.target.getSingleContent(),e=n.target.getContentType()),a.getComment({key:t.getKey(),type:e,commentId:parseInt(n.activeCommentId)}).then(function(e){e.sucs?(D({comments:[e.cmntDTO]}),A(),setTimeout(function(){_(!0)},500)):(n.activeCommentId=0,C()),E()},function(e){C()})}else C(),n.afterComment=!1}function C(e,t,r){if(!n.target.getTotalComment()||(2===t&&!n.showPreviousButton()||1===t&&!n.showMoreButton())&&!r)return void RingLogger.print("fetched all comments or already loading or no comments","rgcomments");T(!0);var i=n.commentType,o=n.target;"feed"===n.commentType&&n.target.isSingleContentFeed()&&(o=n.target.getSingleContent(),i=n.target.getContentType()),b=setTimeout(T.bind(n,!1),3e3),a.getComments({key:o.getKey(),type:i,st:n.comments.length(),target:o},e,t).then(function(e){e.sucs&&(parseInt(n.activeCommentId)?2===t?I(e):v(e):D(e)),T(!1),E(),n.$emit(f.RINGBOX.UPDATE)},function(e){},function(e){}),E()}function D(e){var t,r;for(r=0;r<e.comments.length;r++)t=l.create(e.comments[r]),n.comments.save(t.getKey(),t)}function N(){var t,r,s=n.commenttext,c=n.target,u=n.commentType;n.canComment=!1,y()&&(t=o.getUniqueID(),r={cmnId:t,cmn:s,deleted:!1,isNew:!0,edited:!1,pending:!0},"feed"===n.commentType&&n.target.isSingleContentFeed()&&(c=n.target.getSingleContent(),u=n.target.getContentType()),n.comments.add(t,l.create(r,n.currentUser)),a.addComment({key:c.getKey(),type:u,text:s,target:c}).then(function(o){if(o.sucs===!0){n.comments.remove(t),r.cmnId=o.cmnId,r.pending=!1,e.extend(o,r);var a=l.create(o,n.currentUser);if(n.comments.add(a.getKey(),a),n.target.setTotalComment(o.loc,1),"feed"===n.commentType&&n.target.isSingleContentFeed())c.setTotalComment(o.loc,1);else if("feed"!==n.commentType){var u=m.synchComment(n.target.getFeedKey(),o.loc,1);u&&u.$rgDigest()}n.canComment=!0,n.commenttext="",E(),g.scrollTo(n,".com-"+a.getKey()),g.recalculate(n),n.$emit(f.RINGBOX.UPDATE)}else n.comments.remove(t),n.canComment=!0,i.show(o,"error"),n.commenttext=s,E()},function(e){n.comments.remove(t),n.canComment=!0,i.show(e,"error"),n.commenttext=s,E()}),g.scrollTo(n,".com-"+t),g.recalculate(n))}function M(e){if(!e.user().isCurrentUser())return void(n.commentEditorEnabled=!1);var t=n.models.commentedittext.trim(),r=n.commentType,o=n.target,s=e.text();e.setComment(t),e.isPending(!0),"feed"===n.commentType&&n.target.isSingleContentFeed()&&(o=n.target.getSingleContent(),r=n.target.getContentType()),""!==t?(a.updateComment({key:o.getKey(),type:r,commentId:e.getKey(),text:n.models.commentedittext}).then(function(t){t.sucs||(e.setComment(s),i.show(t,"error")),e.isPending(!1),n.models.commentedittext="",E(),n.$emit(f.RINGBOX.UPDATE)},function(t){e.setComment(s),i.show(json,"error"),E()}),n.commentEditorEnabled=!1):i.show("Please write something","error"),E()}function R(e){var t=n.commentType,r=n.target;e.isPending(!0),"feed"===n.commentType&&n.target.isSingleContentFeed()&&(r=n.target.getSingleContent(),t=n.target.getContentType()),a.deleteComment({key:r.getKey(),type:t,commentId:e.getKey()}).then(function(t){if(t.sucs){if(n.comments.remove(t.cmnId),n.target.setTotalComment(t.loc,t.ic),"feed"===n.commentType&&n.target.isSingleContentFeed())r.setTotalComment(t.loc,t.ic);else if("feed"!==n.commentType){var o=m.synchComment(n.target.getFeedKey(),t.loc,t.ic);o&&o.$rgDigest()}}else e.isPending(!1),i.show(t,"error");E(),n.$emit(f.RINGBOX.UPDATE)},function(t){e.isPending(!1),i.show(t,"error"),E()}),E()}function y(){return n.commenttext.length<1?(n.commentErrorClass="inputerror",n.canComment=!0,!1):(n.commentErrorClass="",!0)}var O,b,P=d.SYSTEM,L=!1;n.comments=c.createNew(!0,"asc"),n.loadingComment=!1,n.canComment=!0,n.commentEditorEnabled=!1,n.commentKey="",n.commenttext="",n.ddCommentHtml="templates/dropdowns/comment-edit-dropdown.html",n.previousComment=!!n.target.getTotalComment(),n.afterComment=!0,n.models={commentedittext:""},n.currentUser=s.currentUser(),n.openRingboxLike=function(e){return e.getTotalLikes()>0},n.loadMoreComment=A,n.loadPreviousComment=_,n.addComment=N,n.updateComment=M,"feed"===n.commentType&&n.target.isSingleContentFeed()?(n.target.getMedias().length()||n.target.getAudios().length()?n.likeType="media":n.target.getImages(!0).length()&&(n.likeType="image"),n.parentKey=n.target.getSingleContent().getKey()):(n.likeType=n.commentType,n.parentKey=n.target.getKey()),n.hideScroll=!!n.hideScroll&&"false"!==n.hideScroll,n.showPreviousButton=function(){return n.target.getTotalComment()>n.comments.length()&&n.previousComment&&!n.loadingComment},n.showMoreButton=function(){return n.target.getTotalComment()>n.comments.length()&&n.afterComment&&!n.loadingComment},n.cancelEdit=function(){n.commentEditorEnabled=!1,E()},n.commentContentEdit=function(e){return function(){return e.getDynamicText()}},n.actionCommentDropdown=function(e){switch(u.close(e.event),e.action){case"edit":p(e.commentMap.getKey(),e.commentMap.text());break;case"delete":R(e.commentMap)}},n.$watch("showCommentBox",function(e){e&&(O||h(),n.comments.length()||S())}),n.$watch("target.getKey()",function(e){L&&(O&&(r.unsubscribe(O),h(),n.comments.reset()),n.comments.length()||S()),L=!0})}function i(){return{restrict:"E",controller:r,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@",hideScroll:"@"},template:'<div class="feed_comment"><div rg-scrollbar="scrollbar()" disabled="{{::hideScroll}}" ng-class="!hideScroll ? \'comm-scroll-height\':\'\'"><ul class="media-list"><li class="item b-none bd" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item com-{{::comment.getKey()}}" rg-repeat="comm in comments.all() track by comm.key" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),comment_blink: (comment.getKey() == activeCommentId)}"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><a ng-href="{{comment.user().link()}}"><img ng-src="{{ comment.user().avatar(\'thumb\')}}" alt=""></a></div><div class="comm-p"><p class="unm"><a ng-href="{{comment.user().link()}}">{{comment.user().getName()}}</a></p><p class="comment_text" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.$parent.commentEditorEnabled" placeholder="Write your comment..."></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-top-7 feed-m"><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i>{{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class="" style="position: relative"><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li></ul></div><div ng-show="loadingComment" style="text-align:center;margin-top:10px"><div class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div></div><div class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></div><div ng-if="target.getTotalComment() > comments.length()" class="divider"></div><div class="mar-top-10"><div class="comment-w" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div>'}}function o(){return{restrict:"E",controller:r,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@"},template:'<div class="feed-comment-wrapper" style="height:calc(100% - 165px)"><div class="feed_comment" rg-scrollbar="scrollbar()"><ul class="feed-img-l"><li class="item b-none" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item pv-item com-{{::comment.getKey()}}" ng-repeat="comm in comments.all()" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),active: (comment.getKey() == activeCommentId) }"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{::comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{::comment.user().link()}}">{{::comment.user().getName()}}</a></p><p class="txt_justify" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="$parent.cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.commentEditorEnabled" placeholder="Write something...." style="width: 94%"></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="$parent.cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::commentType}}" target="comment" target-parent="target.getKey()" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-left-60"><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i> {{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class=""><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li><li ng-show="loadingComment" class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></li><li class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></li></ul></div><div class="pv-c-top"><div class="width-100-percent"><div class="pv-pro float-left"><img ng-src="{{::currentUser.avatar(\'thumb\')}}" alt=""></div><div class="comment-w" style="width:85%" ng-class="commentErrorClass"><div class="comment-editor popimgcmnt-box"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div></div>'}}e.module("ringid.shared").factory("CommentHttpService",n).controller("CommentsController",r).directive("rgComments",i).directive("rgImageComments",o),n.$inject=["$$connector","OPERATION_TYPES"],r.$inject=["$scope","$$connector","Ringalert","Utils","CommentHttpService","Auth","$$stackedMap","$$commentMap","rgDropdownService","OPERATION_TYPES","rgScrollbarService","feedFactory","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function n(e,t){function n(t){var n={};switch(t.type){case"feed":n.actn=1===t.il?s.TYPE_LIKE_STATUS:s.TYPE_UNLIKE_STATUS;break;case"image":n.actn=s.IMAGE.TYPE_LIKE_IMAGE,n.imgId=t.target.getKey(),n.lkd=t.il;break;case"media":n.actn=s.MEDIA.ACTION_LIKE_UNLIKE_MEDIA,n.cntntId=t.target.getKey(),n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey()),e.request(n,s.REQUEST_TYPE.UPDATE)}function r(t){var n={};switch(t.type){case"feed":n.actn=t.il?s.TYPE_LIKE_COMMENT:s.TYPE_UNLIKE_COMMENT,n.nfId=t.key;break;case"image":n.actn=s.IMAGE.TYPE_LIKE_UNLIKE_IMAGE_COMMENT,n.imgId=t.key,n.lkd=t.il;break;case"media":n.actn=s.MEDIA.ACTION_LIKE_UNLIKE_MEDIA_COMMENT,n.cntntId=t.key,n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.cmnId=t.target.getKey(),e.request(n,s.REQUEST_TYPE.UPDATE)}function i(t){var n={};switch(t.type){case"feed":n.actn=s.TYPE_LIST_LIKES_OF_COMMENT,n.nfId=t.key;break;case"image":n.actn=s.IMAGE.TYPE_IMAGE_COMMENT_LIKES,n.imgId=t.key;break;case"media":n.actn=s.MEDIA.ACTION_MEDIACOMMENT_LIKE_LIST,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.st=t.st||0,n.cmnId=t.target.getKey(),e.pull(n,s.REQUEST_TYPE.REQUEST)}function o(t){var n={};switch(t.type){case"feed":n.actn=s.TYPE_LIKES_FOR_STATUS,n.nfId=t.target.getKey();break;case"image":n.actn=s.IMAGE.TYPE_LIKES_FOR_IMAGE,n.imgId=t.target.getKey();break;case"media":n.actn=s.MEDIA.ACTION_MEDIA_LIKE_LIST,n.cntntId=t.target.getKey();break;default:throw new Error("comment type not familiar")}return t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey()),n.st=t.st||0,e.pull(n,s.REQUEST_TYPE.REQUEST)}var a,s=t.SYSTEM;return a={likeUnlike:n,likeUnlikeComment:r,fetchWhoLikes:o,fetchWhoLikesComment:i}}function r(e,t,n,r,i,o,a){function s(){var i,o="fetchWhoLikes";e.users.length<e.target.getTotalLikes()&&(i={target:e.target,type:e.likeType,st:e.users.length},"true"==e.likeComment&&(o="fetchWhoLikesComment",i.parentKey=e.targetOwner(),i.key=e.targetParent()),e.loading=!0,t[o](i).then(function(t){if(e.loading=!1,!t.sucs)return void e.$close();var i,o;for(i=0;i<t.likes.length;i++)o=r.createByUtId(t.likes[i],!0,!0),e.users.push(o),o.commonFriends(!0,!0).then(function(){e.$rgDigest()});n.recalculate(e),e.$rgDigest()},function(t){e.$close()},function(e){}))}e.loading=!0,e.users=[],e.contactListAction=function(t){t.friend.isLoading()||(i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.isCurrentUser=function(e){return e.equals(a._currentUser)},e.loadmore=function(){e.loading||s()},s(),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:o.user.getMutualFriends(e)}}}function i(t,n,r,i,o){function a(e){t.target.like(!0,e.loc?e.loc:!1),r.show(e,"error"),t.anchorCallback.call(null,t.target.like()),t.buttonCallback.call(null,t.target.like()),t.$rgDigest()}t.anchorCallback=e.noop,t.buttonCallback=e.noop,t.LikeUnlike=function(){var e,r="likeUnlike";e={target:t.target,type:t.likeType},"true"==t.likeComment&&(r="likeUnlikeComment",e.parentKey=t.targetOwner(),e.key=t.targetParent()),e.il=t.target.like(!0),t.anchorCallback.call(null,e.il),t.buttonCallback.call(null,e.il),n[r](e).then(function(n){if(n.sucs){if("feed"!==t.likeType&&"true"!==t.likeComment&&n.nfId){var r=o.synchLike(n.nfId,e.il,n.loc);r&&r.$rgDigest()}}else a(n)},a),t.$rgDigest()},t.$watch("target",function(e){t.anchorCallback.call(null,e.like()),t.buttonCallback.call(null,e.like(),!0)}),t.showWhoLike=function(){if(t.target.getTotalLikes()){i.open({type:"remote",scope:t,controller:"WhoLikeController",templateUrl:"templates/home/wholikes.html"})}}}function o(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a><i class="img_sprite lc-ico"></i><b>{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</b></a>',link:function(e,n,r,i){function o(e,r){e?(n[0].firstChild.className=n[0].firstChild.className.replace("icon-like","").trim(),n[0].firstChild.className=n[0].firstChild.className.replace("icon-like-h","").trim(),n[0].firstChild.className+=" icon-like-h",r||(n[0].firstChild.innerHTML='<span class="like-ani"></span>',t.setTimeout(function(){n&&(n[0].firstChild.innerHTML="")},2e3))):(n[0].firstChild.className=n[0].firstChild.className.replace("icon-like-h","").trim(),n[0].firstChild.className=n[0].firstChild.className.replace("icon-like","").trim(),n[0].firstChild.className+=" icon-like")}e.buttonCallback=o,o(e.target.like(),!0),n.bind("click",e.LikeUnlike),e.$on("$destroy",function(){n.unbind("click",e.likeUnlike)})}}}function a(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</a>',link:function(e,t,n,r){t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}function s(e){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes()}}</a>',link:function(e,t,n,r){t.bind("click",e.showWhoLike),e.$on("$destroy",function(){t.unbind("click",e.showWhoLike)})}}}function c(){return{restrict:"EA",scope:{target:"=",likeType:"@",targetParent:"&",targetOwner:"&",likeComment:"@"},controller:"LikeController",template:"<rg-liker-button></rg-liker-button><rg-who-like></rg-who-like>",link:function(e,t,n){function r(e){e?t.addClass("active"):t.removeClass("active")}e.anchorCallback=r,r(e.target.like()),e.$watch("target.like()",function(){r(e.target.like()),e.buttonCallback.call(null,e.target.like(),!0)})}}}e.module("ringid.shared").factory("LikeHttpService",n).controller("LikeController",i).controller("WhoLikeController",r).directive("rgLikes",c).directive("rgLikerAnchor",a).directive("rgWhoLike",s).directive("rgLikerButton",o),n.$inject=["$$connector","OPERATION_TYPES"],r.$inject=["$scope","LikeHttpService","rgScrollbarService","userFactory","friendsFactory","Api","Auth"],i.$inject=["$scope","LikeHttpService","Ringalert","$ringbox","feedFactory"],o.$inject=[],a.$inject=[],s.$inject=["$ringbox"],c.$inject=[]}()}(angular,window),function(e,t){"use strict";!function(){function n(){this.$get=["$compile","StickerEmoticonService","StickerEmoticonFactory","$sniffer","$rootScope",function(e,n,r,i,o){function a(e){function n(e){m.init(p.dom.editor,"00",e,p.callback,p.processors),p.dom.placeholder.className="active",e.stopPropagation()}function r(e){e.stopPropagation();var t=e.which||e.keyCode||e.key;m.init(p.dom.editor,t,e,p.callback,p.processors)}function i(e){e.stopPropagation();var t=e.which||e.keyCode||e.key;m.init(p.dom.editor,t,e,p.callback,p.processors)}function a(e){e.stopPropagation(),e.preventDefault(),p.dom.placeholder.className=""}function s(e){return e.stopPropagation(),e.preventDefault(),!1}function c(e){return e.stopPropagation(),e.preventDefault(),!1}function u(e){e.stopPropagation(),e.preventDefault();var n="";if(e.clipboardData)n=e.clipboardData.getData("text/plain");else if(t.clipboardData)try{n=t.clipboardData.getData("Text")}catch(e){console.log("clipboard copy error")}n=n.replace(/\n/g,"<br />"),n=n.replace(/\s\s+/g," "),n=n.replace(/\u200B/g,""),m.paste(n),p.updateContent()}function d(e){e.stopPropagation(),p.updateContent()}var p=this;this.content="",this.tagOpen=!1,this.fragment=null,this.dom={},this.processors=[],this.callback=[],this.lastDisable=0,this.maxHeight=0,this.init=function(e){this.newLine=e.newLine!==!1,this.maxHeight=e.maxHeight,this.placeholder=e.placeholder||"",this.isDisabled=e.isDisabled||!1,this.emotion=e.emotion?e.emotion:null,this.fragment=document.createDocumentFragment(),this.dom.placeholder=document.createElement("span"),this.dom.placeholder.setAttribute("data-placeholder",this.placeholder),this.fragment.appendChild(this.dom.placeholder),this.dom.editor=document.createElement("div"),this.dom.editor.setAttribute("contenteditable","true"),this.dom.editor.setAttribute("spellcheck","true"),this.dom.editor.setAttribute("data-editor","true"),this.dom.editor.setAttribute("class","editor"),this.fragment.appendChild(this.dom.editor),this.emotion&&this.fragment.appendChild(this.emotion),this.addProcessor("keydown",!1,this.checkDisability,this),this.addProcessor("keydown","enter",this.checkNewLine,this),this.addProcessor("both","enter,up,down",this.checkTag,this),this.addCallback("keyup","delete,backspace",this.checkBR,this),this.addCallback("keyup",!1,this.addDelimiter,this),this.addCallback("keydown",!1,this.setPlaceholderContent,this),this.addCallback("keyup",!1,this.updateContent,this),this.addDelimiter(),this.initEvent(),this.maxHeight>0&&(this.dom.editor.style.maxHeight=this.maxHeight+"px")},this.addDelimiter=function(){var e,t,n=this.dom.editor.innerText||this.dom.editor.textContent;t=f.getFirstNode(this.dom.editor),"8203"!=n.charCodeAt(0)&&(e=document.createTextNode("â€‹"),t?this.dom.editor.insertBefore(e,t):this.dom.editor.appendChild(e)),n=this.dom.editor.innerText||this.dom.editor.textContent,1!=n.length&&"8203"==n.charCodeAt(n.length-1)||(e=document.createTextNode("â€‹"),this.dom.editor.appendChild(e)),t=e=null},this.addProcessor=function(e,t,n,r){this.processors.push({event:e,action:t,fn:n,context:r})},this.addCallback=function(e,t,n,r){this.callback.push({event:e,action:t,fn:n,context:r})},this.setFocus=function(){E.toElmentEnd(this.dom.editor,!0)},this.showError=function(){this.hideError(),this.dom.editor.className=this.dom.editor.className+" error"},this.hideError=function(){this.dom.editor.className=this.dom.editor.className.replace("error","").trim()},this.enable=function(){this.isDisabled=!1},this.disable=function(){this.isDisabled=!0},this.set=function(e){e&&(e=e.replace(/\n/g,"<br />"),e=e.replace(/href="(.*?)"/g,'href="#"'),e=e.replace(/<span/g,'<a href="#" onclick="return false" data-block="true"'),e=e.replace(/<\/span>/g,"</a>"),e=e.replace(/class="tag"/g,'class="tag" onclick="return false" data-block="true"'),e=e.replace(/<a.*?class="feedanchor".*?>(.*?)<\/a>/g,"$1"),this.dom.editor.innerHTML=e,this.updateContent(),this.addDelimiter(),f.adjustMarkup(this.dom.editor))},this.get=function(){return this.content},this.clear=function(){this.dom.editor.innerHTML="",this.dom.placeholder.innerHTML="",this.updateContent(),this.addDelimiter(),o.unloadWarn=!1},this.setNewLineMode=function(e){this.newLine=e},this.getNode=function(){return this.fragment},this.addEmoticon=function(e){m.setContainer(this.dom.editor,!0),m.addEmoticon(e,!0),this.updateContent()},this.addTag=function(e,t){m.setContainer(this.dom.editor,!0),m.addTag(e,t),this.updateContent()},this.findWord=function(e){return f.findCurrentWord(e,this.dom.editor)},this.setPlaceholderContent=function(e,t){e.ctrlKey||e.shiftKey||e.metaKey||g[t]||""!=this.dom.placeholder.innerHTML||(this.dom.placeholder.innerHTML=String.fromCharCode(t))},this.checkDisability=function(e,t){return this.isDisabled?(e.preventDefault(),this.lastDisable=(new Date).getTime()/1e3,(new Date).getTime()-this.lastDisable>2e3&&(this.isDisabled=!1),!1):!0},this.checkTag=function(e,t){return this.tagOpen?(e.preventDefault(),!1):!0},this.checkNewLine=function(e,t){return this.newLine||e.shiftKey||e.ctrlKey?!0:(e.preventDefault(),!1)},this.checkBR=function(e,t){this.dom.editor.firstElementChild&&this.dom.editor.firstElementChild===this.dom.editor.lastElementChild&&"br"==this.dom.editor.firstElementChild.nodeName.toLowerCase()&&this.dom.editor.removeChild(this.dom.editor.firstElementChild)},this.updateContent=function(e,t){var n=this.dom.editor.innerHTML.replace(/<br>/g,"\n");n=n.replace(/&lt;/g,"<"),n=n.replace(/&gt;/g,">"),n=n.replace(/&amp;/g,"&"),n=n.replace(/&nbsp;/g," "),n=n.replace(/\u200B/g,""),n=n.replace(/\n{3,}/g,"\n\n"),n=n.replace(l,function(e,t){return isNaN(t)?t:"##"+t+"##"}),this.content=n.trim();var r=this.dom.editor.innerHTML.replace(/<br>/g,"\n");r=r.replace(/&nbsp;/g," "),r=r.replace(/\u200B/g,""),r=r.replace(/\n{3,}/g,"\n\n"),this.dom.placeholder.innerHTML=r,this.onUpdate&&"function"==typeof this.onUpdate&&this.onUpdate.call(null),""!=this.content?o.unloadWarn=!0:o.unloadWarn=!1},this.initEvent=function(){this.dom.editor.addEventListener("mouseup",n),this.dom.editor.addEventListener("keydown",r),this.dom.editor.addEventListener("keyup",i),this.dom.editor.addEventListener("dragover",s),this.dom.editor.addEventListener("drop",c),this.dom.editor.addEventListener("paste",u),this.dom.editor.addEventListener("cut",d),this.dom.editor.addEventListener("blur",a)},this.getPosition=function(){var e=0,t=0,n=this.dom.editor.getBoundingClientRect(),r=E.getCurrentRange().getClientRects();return e=n.left,t=n.top,r.length>0&&(r=r[0],e=r.left-e,t=r.top-t),{x:e,y:t+12}},this.destroy=function(){this.dom.editor.removeEventListener("mouseup",n),this.dom.editor.removeEventListener("keydown",r),this.dom.editor.removeEventListener("keyup",i),this.dom.editor.removeEventListener("dragover",s),this.dom.editor.removeEventListener("drop",c),this.dom.editor.removeEventListener("paste",u),this.dom.editor.removeEventListener("cut",d),this.dom.editor.removeEventListener("blur",a),this.dom=p=null,o.unloadWarn=!1},this.init(e)}var s=n.getEmoticonMap(),c=r.getEmoticonPattern(),l=/<a.*?data-link="(.*?)".*?>.*?<\/a>/gi,u=i.vendorPrefix.toLowerCase(),d=!(!navigator.userAgent.match(/Trident/)||!navigator.userAgent.match(/rv[ :]11/)),g={13:{fn:"enter",action:"enter",event:"keydown"},8:{fn:"backspace",action:"backspace",event:"keydown"},32:{
fn:"space",action:"space",event:"keydown"},46:{fn:"delete",action:"delete",event:"keydown"},27:{fn:"escape",action:"escape",event:"keydown"},37:{fn:"adjust",action:"left",event:"keyup"},39:{fn:"adjust",action:"right",event:"keyup"},38:{fn:"adjust",action:"up",event:"keyup"},40:{fn:"adjust",action:"down",event:"keyup"},"00":{fn:"adjust",action:"click",event:"mouseup"}};"moz"==u&&(g[8]={fn:"backspace",action:"backspace",event:"both"},g[46]={fn:"delete",action:"delete",event:"both"});var m={container:null,event:null,keyCode:0,selection:null,range:null,previousSelection:{},init:function(e,t,n,r,i){var o,a,s,c,l=!0,u=null,d=null;for(this.container=e,this.keyCode=t,this.event=n,this.selection=E.getSelection(),this.range=E.getCurrentRange(),this.action="",u=f.getFirstNode(this.container),d=this.container.lastChild,o=f.getCurrentBoundary(this.selection),o=f.getSafeBoundary(this.selection,o,t,u,d),a=0;a<i.length;a++)c=i[a],c&&(c.event==n.type||"both"==c.event)&&(g[t]&&c.action&&-1!=c.action.indexOf(g[t].action)||c.action===!1)&&c.fn.call(c.context,n,t)===!1&&(l=!1);if(i=[],l){for(g[t]&&m[g[t].fn]&&(g[t].event==n.type||"both"==g[t].event)&&(this.action=g[t].action,m[g[t].fn](o)),!g[t]&&"keydown"==n.type&&o&&m.adjust(o,!1),a=0;a<r.length;a++)s=r[a],s&&s.event==n.type&&(g[t]&&s.action==g[t].action||s.action===!1)&&s.fn.call(s.context,n,t);r=[],u=d=null}},setContainer:function(e,t){this.container=e,t&&E.intersectsNode(e)===!1&&(E.toElmentEnd(e),this.container.focus())},adjust:function(e,t){if(e){if(t="undefined"!=typeof t&&null!==t?t:!0,e.zws&&0==e.candidate.length&&("left"==this.action||"right"==this.action||"click"==this.action))return void(t&&this.event.preventDefault());if(!this.selection.isCollapsed&&"mouseup"==this.event.type&&this.previousSelection&&this.previousSelection.anchorNode==this.selection.anchorNode&&this.previousSelection.anchorOffset==this.selection.anchorOffset&&this.previousSelection.focusOffset==this.selection.focusOffset)return void(this.previousSelection={});if(!t&&this.selection.isCollapsed===!1){if(this.event.ctrlKey||this.event.shiftKey||this.event.metaKey)return;return void(e&&"ltr"==e.direction?E.deleteContents(e.start,e.startPos,e.end,e.endPos):e&&"rtl"==e.direction?E.deleteContents(e.end,e.endPos,e.start,e.startPos):E.deleteContents(this.range.startContainer,this.range.startOffset,this.range.endContainer,this.range.endOffset))}f.adjustCursor(this.selection,e),t&&this.event.preventDefault(),this.selection&&this.selection.anchorNode&&(this.previousSelection.anchorNode=this.selection.anchorNode,this.previousSelection.anchorOffset=this.selection.anchorOffset,this.previousSelection.focusOffset=this.selection.focusOffset)}},enter:function(e){var t,n,r,i=!1;e&&!this.selection.isCollapsed&&("ltr"==e.direction?E.deleteContents(e.start,e.startPos,e.end,e.endPos):E.deleteContents(e.end,e.endPos,e.start,e.startPos),this.range=E.getCurrentRange());try{i=document.execCommand("insertBrOnReturn",!1,!0)}catch(o){i=!1}i||(this.event.preventDefault(),this.range.deleteContents(),t=document.createElement("br"),this.range.insertNode(t),""!=this.container.style.maxHeight&&(this.container.scrollTop=this.container.scrollTop+18),E.toElmentAfter(t),n=t=r=null)},escape:function(){},backspace:function(e){if(e){var t=this.container.innerText||this.container.textContent;if(2==t.length)return void this.event.preventDefault();if("last"!=e.zwsType||e.start!==e.end||e.startPos!=e.endPos){if(e.zws&&"first"==e.zwsType&&0==e.candidate.length)return void this.event.preventDefault();var n;"ltr"==e.direction?(n=f.getNode(e.start,"prev",e.start.length-e.startPos),E.deleteContents(e.start,e.startPos,e.end,e.endPos)):(n=f.getNode(e.end,"next",e.end.length-e.endPos),E.deleteContents(e.end,e.endPos,e.start,e.startPos)),n.parent&&(n.pos="rtl"==e.direction?n.node.childNodes.length:0),E.toElementByType(n.node,n.type,n.pos),this.event.preventDefault(),n=null}}},"delete":function(e){if(e){var t=this.container.innerText||this.container.textContent;if(2==t.length)return void this.event.preventDefault();if("first"!=e.zwsType||e.start!==e.end||e.startPos!=e.endPos){if(e.zws&&"last"==e.zwsType&&0==e.candidate.length)return void this.event.preventDefault();var n;this.selection.isCollapsed||"ltr"==e.direction?(n=f.getNode(e.start,"next",e.start.length-e.startPos),E.deleteContents(e.start,e.startPos,e.end,e.endPos)):(n=f.getNode(e.end,"prev",e.end.length-e.endPos),E.deleteContents(e.end,e.endPos,e.start,e.startPos)),n.parent&&(n.pos=this.selection.isCollapsed||"ltr"==e.direction?n.node.childNodes.length:0),E.toElementByType(n.node,n.type,n.pos),this.event.preventDefault(),n=null}}},space:function(){var e,t="";if(t=f.findCurrentWord(null,this.container),t&&(t=t.replace(/\u200B|\n/g,"")),s[t]){var e=!("ms"!=u||!f.isEditorTag(this.range.endContainer)||3!=this.range.endContainer.childNodes[this.range.endOffset].nodeType||"8203"!=this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0));if(e){var n=this.range.endContainer.childNodes[this.range.endOffset-1];this.range.setStart(n,n.length),this.range.setEnd(n,n.length),n=null}this.range.setStart(this.range.startContainer,this.range.endOffset-t.length),this.range.deleteContents(),this.addEmoticon(t,!0),this.event.preventDefault()}},addEmoticon:function(e,t){var n,r,i,o;if(this.range=E.getCurrentRange(),r=f.parseText(e),t&&""==r.replace(l,"")&&(r+=String.fromCharCode(32)),f.removeClass(this.container),E.insertHtml(r),o=this.container.querySelectorAll(".caret"),o=Array.prototype.slice.call(o),this.selection&&(i=this.selection.focusNode),i&&i.nextSibling&&3==i.nextSibling.nodeType&&1==i.nextSibling.length&&10==i.nextSibling.nodeValue.charCodeAt(0)&&i.nextSibling.parentNode.removeChild(i.nextSibling),i&&3==i.nodeType&&10==i.nodeValue.charCodeAt(i.nodeValue.length-1)&&(i.nodeValue=i.nodeValue.replace(/\u200B|\n/g,"")),!i&&o.length>0){var a=o[o.length-1].nextSibling.nextSibling;a&&3==a.nodeType&&1==a.length&&10==a.nodeValue.charCodeAt(0)&&a.parentNode.removeChild(a),a=null}o.length>0?(i=o[o.length-1],i.nextSibling&&3==i.nextSibling.nodeType?E.toElementByType(i.nextSibling,"pos",1):E.toElmentAfter(i)):i?(n=f.getNode(i,"next",0),E.toElementByType(n.node,n.type,n.pos)):E.toElmentEnd(this.container),this.container.focus(),n=o=i=null},addTag:function(e,t){var n,r,i,o,a,s,c={};t="@"+t,3!=this.range.startContainer.nodeType&&(this.range=E.getCurrentRange()),a=this.range.collapsed?this.range.endOffset:this.range.startOffset;var l=!("ms"!=u||!f.isEditorTag(this.range.endContainer)||3!=this.range.endContainer.childNodes[this.range.endOffset].nodeType||"8203"!=this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0));if(l){a=this.range.endContainer.childNodes[this.range.endOffset-1].nodeValue.length;var d=this.range.endContainer.childNodes[this.range.endOffset-1];this.range.setStart(d,0),this.range.setEnd(d,0),d=null}if(!(a-t.length<0)){if(this.range.setStart(this.range.startContainer,a-t.length),this.range.setEnd(this.range.startContainer,a),this.range.deleteContents(),c["class"]="tag",c.title=e.getName().trim(),c["data-link"]=e.getUtId(),c.text=e.getName().trim(),f.removeClass(this.container),i=f.getBlockHTML(c),E.insertHtml(i),s=this.container.querySelectorAll(".caret"),s=Array.prototype.slice.call(s),o=this.selection.focusNode!==this.container&&this.selection.focusNode.nextSibling&&this.selection.focusNode.nextSibling!==this.container.lastChild?this.selection.focusNode.nextSibling:this.selection.focusNode,r=f.examineNode(o,"focus",this.selection),r.node&&"parent"==r.position&&(o=r.node),o&&o.nextSibling&&3==o.nextSibling.nodeType&&1==o.nextSibling.length&&10==o.nextSibling.nodeValue.charCodeAt(0)&&o.nextSibling.parentNode.removeChild(o.nextSibling),o&&3==o.nodeType&&10==o.nodeValue.charCodeAt(o.nodeValue.length-1)&&(o.nodeValue=o.nodeValue.replace(/\u200B|\n/g,"")),!o&&s.length>0){var d=s[s.length-1].nextSibling;d&&3==d.nodeType&&1==d.length&&10==d.nodeValue.charCodeAt(0)&&d.parentNode.removeChild(d),d=null}s.length>0?E.toElmentAfter(s[s.length-1]):o?(n=f.getNode(o,"next",0),E.toElementByType(n.node,n.type,n.pos)):E.toElmentEnd(this.container),this.container.focus(),n=s=o=null}},paste:function(e){var t,n=f.parseText(e);E.insertHtml(n),this.container.focus(),t=null}},f={examineNode:function(e,t,n){var r,i=Object.create(null),o="focus"==t?n.focusOffset:n.anchorOffset;return i.position=!1,i.length=0,i.node=null,e?(1==e.nodeType&&"true"==e.getAttribute("data-block")&&(i.node=e,i.position="self"),r=f.getNextNode(e,e.length),r&&1==r.nodeType&&"true"==r.getAttribute("data-block")&&(1==e.nodeType||3==e.nodeType&&o==e.length)&&(i.node=r,i.position="next"),r=f.getPrevNode(e,e.length),r&&1==r.nodeType&&"true"==r.getAttribute("data-block")&&(1==e.nodeType||3==e.nodeType&&0==o)&&(i.node=r,i.position="prev"),r="b"==e.parentNode.nodeName.toLowerCase()?e.parentNode.parentNode:e.parentNode,r&&1==r.nodeType&&"true"==r.getAttribute("data-block")&&(i.node=r,i.position="parent"),i.node&&(i.length=3==i.node.nodeType?i.node.nodeValue.length:0),r=null,i):i},getCurrentBoundary:function(e){var t=E.getDirection(),n=Object.create(null);return e?(n.start=e.anchorNode,n.startPos=e.anchorOffset,n.end=e.focusNode,n.endPos=e.focusOffset,n.direction=t,n):n},adjustCursor:function(e,t){e.isCollapsed?E.toElementByType(t.end,t.type,t.endPos):!e.isCollapsed&&t.isAnchorMoved?E.extendSelection(t,!1):E.extendSelection(t)},getSafeBoundary:function(e,t,n,r,i){var o,a,s,c,l=!1,u=null,d=null,m=[],E={enter:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},backspace:{focus:"prev",anchor:"next",dir:"rtl",reverse:!0,both:!0},"delete":{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!0},space:{focus:"next",anchor:"next",dir:"ltr",reverse:!1,both:!1},escape:{},left:{focus:"prev",anchor:"next",dir:"rtl",reverse:!1,both:!1},right:{focus:"next",anchor:"prev",dir:"ltr",reverse:!1,both:!1},up:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},down:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},click:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},any:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1}};if(o=g[n]?g[n].action:"any",""!=o&&E[o]&&E[o].hasOwnProperty("focus")){for(t.isAnchorMoved=!1,t.candidate=[],e.isCollapsed&&!E[o].both||m.push({node:e.anchorNode,type:"anchor",offset:e.anchorOffset}),m.push({node:e.focusNode,type:"focus",offset:e.focusOffset});s=m.pop();)s.node&&(a=E[o][s.type],E[o].reverse&&t.direction!=E[o].dir&&(a="next"==a?"prev":"next"),u=f.examineNode(s.node,s.type,e),"any"==o&&e.isCollapsed&&(u.length==e.focusOffset||"next"==u.position&&e.focusNode.length==e.focusOffset)&&(u.node=null),"backspace"!=o&&"click"!=o||"next"!=u.position||!e.isCollapsed||3!=e.focusNode.nodeType||e.focusNode.length!=e.focusOffset||(u.node=null),u.node&&(d=f.getNode(u.node,a,0),"focus"==s.type?(t.end=d.node,t.endPos=d.pos):(t.start=d.node,t.startPos=d.pos,t.isAnchorMoved=!0),t.type=d.type,l=!0,t.candidate.push(u.node)));return t.zws=!1,t.zwsType="","ltr"==t.direction&&t.start===r&&(0==t.startPos?(e.isCollapsed?(t.endPos=t.startPos=1,t.type=t.type?t.type:"pos"):(t.startPos=1,t.type=t.type?t.type:"pos"),l=!0):1==t.startPos&&"any"!=o&&3==t.start.nodeType&&"8203"==t.start.nodeValue.charCodeAt(0)&&e.isCollapsed&&(t.zws=!0,t.zwsType="first",l=!0)),"backspace"==o&&e.isCollapsed&&0==t.startPos&&f.getPrevNode(t.start,t.start.length)===r&&(t.zws=!0,t.zwsType="first",l=!0),"rtl"==t.direction&&t.end==r&&0==t.endPos&&(t.endPos=1,t.type=t.type?t.type:"pos",l=!0),f.isEditorTag(t.end)&&0==t.endPos&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",l=!0),f.isEditorTag(t.end)&&t.endPos==t.end.childNodes.length&&t.end.lastChild&&3==t.end.lastChild.nodeType&&"8203"==t.end.lastChild.nodeValue.charCodeAt(0)&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",l=!0),"ltr"==t.direction&&i&&t.end===i&&(c=t.end.length,c>0&&t.endPos==c?(e.isCollapsed?(t.endPos=t.startPos=c-1,t.type=t.type?t.type:"pos"):(t.endPos=c-1,t.type=t.type?t.type:"pos"),l=!0):t.endPos==c-1&&"any"!=o&&3==t.end.nodeType&&"8203"==t.end.nodeValue.charCodeAt(c-1)&&e.isCollapsed&&(t.zws=!0,t.zwsType="last",l=!0)),"delete"==o&&e.isCollapsed&&t.end.length==t.endPos&&f.getNextNode(t.end,t.endPos)===i&&(t.zws=!0,t.zwsType="last",l=!0),c=t.start.length,"rtl"==t.direction&&t.start==i&&t.startPos==c&&(t.startPos=c-1,t.type=t.type?t.type:"pos",l=!0),u=d=m=r=i=s=null,l?t:!1}},parseText:function(e){return e=e.replace(c,function(e){var t=[];return t["class"]="em_list "+s[e].replace(/\.[A-Za-z]{3}/,""),t.title=e,t["data-link"]=e,t.text="<b>"+e.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</b>&nbsp;",f.getBlockHTML(t)})},removeClass:function(e){if(e){var t,n=e.querySelectorAll(".caret");for(t=0;t<n.length;t++)n[t].className=n[t].className.replace("caret","").trim();n=null}},adjustMarkup:function(e){if(e){var t,n=e.querySelectorAll(".em_list");for(t=0;t<n.length;t++)n[t].innerHTML="<b>"+n[t].getAttribute("data-link")+"</b>&nbsp;";n=null}},getBlockHTML:function(e){var t='<a href="#" onclick="return false" class="'+e["class"]+' caret" title="'+e.title+'" data-link="'+e["data-link"]+'" spellcheck="false" data-block="true">'+e.text+"</a>";return t},getPrevNode:function(e,t){if(t="undefined"!=typeof t&&null!==t?t:0,!e)return e;if(e.length>t)return e;for(var n=e.previousSibling;n&&!(n.length>0||1==n.nodeType);)n=n.previousSibling;return n},getNextNode:function(e,t){if(t="undefined"!=typeof t&&null!==t?t:0,!e)return e;if(e.length>t)return e;for(var n=e.nextSibling;n&&!(n.length>0||1==n.nodeType);)n=n.nextSibling;return n},getNode:function(e,t,n){var r=Object.create(null),i=!1,o=this.isEditorTag(e);return e?(r.node=null,t="undefined"!=typeof t&&null!==t?t:"prev",n="undefined"!=typeof n&&null!==n?n:0,e.length>n&&(i=!0),o||(r.node="prev"==t?this.getPrevNode(e,n):this.getNextNode(e,n)),r.node&&("prev"==t&&(r.pos=i?r.node.length-n:r.node.length),"next"==t&&(r.pos=i?r.node.length-n:0),r.type="pos"),r.parent=!1,r.node||(r.node=o?e:e.parentNode,r.pos="next"==t?r.node.childNodes.length:0,r.type="pos",r.parent=!0),r):e},isEditorTag:function(e){return e&&1==e.nodeType&&"true"==e.getAttribute("data-editor")||!1},isEmpty:function(e){if(0==e.childNodes.length)return!1;for(var t=e.firstChild;t&&!(1==t.nodeType||t.length>0);)t=t.nextSibling;return!t},getFirstNode:function(e,t){if(0==e.childNodes.length)return!1;var n=e.firstChild;for(t="undefined"!=typeof t&&null!==t?t:!1;n&&(!(1==n.nodeType||n.length>0)||t&&3==n.nodeType&&!(n.length>1)&&"8203"==n.nodeValue.charCodeAt(0));)n=n.nextSibling;return n},findCurrentWord:function(e,t){var n,r=E.getSelection(),i="",o=-1,a="",s=!1,c=f.getFirstNode(t,!0);e=e?e:null;var l=!("ms"!=u||!f.isEditorTag(r.focusNode)||3!=r.focusNode.childNodes[r.focusOffset].nodeType||"8203"!=r.focusNode.childNodes[r.focusOffset].nodeValue.charCodeAt(0));if((r&&3==r.focusNode.nodeType||l)&&(i=l?r.focusNode.childNodes[r.focusOffset-1].nodeValue:r.focusNode.nodeValue.substr(0,r.anchorOffset),i=i.replace(/\s+$/,""),o=e?i.lastIndexOf(e):1,o>=0))for(n=i.length-1;n>=0;n--){if(/\s/.test(i[n])){s=!0;break}if(i[n]==e){a=i[n]+a;break}a=i[n]+a}return null==e?(s||l||c===r.anchorNode||(a=""),c=null,a):(a[0]!=e&&(a=""),a=a.length>1&&(c===r.anchorNode&&r.anchorNode.nodeValue[0]==e||l||t.firstChild===r.anchorNode&&r.anchorNode.nodeValue[1]==e||r.anchorNode.previousSibling&&3==r.anchorNode.previousSibling.nodeType&&32==r.anchorNode.previousSibling.nodeValue.charCodeAt(r.anchorNode.previousSibling.length-1)||32==i.charCodeAt(o-1))||160==i.charCodeAt(o-1)?a.replace(e,""):"",c=null,a)},findPos:function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}}},E={toPos:function(e,t){var n=this.getSelection(),r=this.getRange();t="undefined"!=typeof t&&null!==t?t:e.length||e.childNodes.length,r.setStart(e,t),r.setEnd(e,t),r.collapse(!0),n.removeAllRanges(),n.addRange(r),r.detach(),n=null},toElementStart:function(e,t){t&&e.focus(),this.toPos(e,0)},toElmentEnd:function(e,t){return t&&e.focus(),f.isEditorTag(e)&&e.lastChild&&3==e.lastChild.nodeType&&"8203"==e.lastChild.nodeValue.charCodeAt(e.lastChild.nodeValue.length-1)?void this.toPos(e.lastChild,e.lastChild.nodeValue.length-1):void this.toPos(e)},toElmentBefore:function(e){var t=this.getSelection(),n=this.getRange();n.setStartBefore(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null},toElmentAfter:function(e){var t=this.getSelection(),n=this.getRange();n.setStartAfter(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null},toElementByType:function(e,t,n){t="undefined"!=typeof t?t:"end","end"==t&&this.toElmentEnd(e),"start"==t&&this.toElementStart(e),"pos"==t&&this.toPos(e,n)},deleteContents:function(e,t,n,r){var i=this.getSelection(),o=this.getRange();t="undefined"!=typeof t&&null!==t?t:e.length||e.childNodes.length,n="undefined"!=typeof n?n:e,r="undefined"!=typeof r&&null!==r?r:n.length||n.childNodes.length,e===n&&t==r||(1==e.nodeType?o.setStartBefore(e):o.setStart(e,t),1==n.nodeType?o.setEndAfter(n):o.setEnd(n,r),i.removeAllRanges(),i.addRange(o),document.execCommand("delete",!1),o.detach())},insertHtml:function(e){var t=(this.getSelection(),this.getCurrentRange());if(this.isIE())t.pasteHTML(e);else if(d){var n,r=document.createElement("div"),i=document.createDocumentFragment();for(r.innerHTML=e;n=r.firstChild;)i.appendChild(n);t.insertNode(i),r=i=n=null}else document.execCommand("insertHtml",!1,e)},getSelection:function(){return this.isIE()?document.selection:t.getSelection()},isIE:function(){return document.selection&&"Control"!=document.selection.type},extendSelection:function(e,t){var n=this.getSelection(),r=this.getRange();return t="undefined"!=t&&null!=t?t:!0,n.extend&&t?void n.extend(e.end,e.endPos):("ltr"==e.direction?(r.setStart(e.start,e.startPos),r.setEnd(e.end,e.endPos)):(r.setStart(e.end,e.endPos),r.setEnd(e.start,e.startPos)),n.removeAllRanges(),n.addRange(r),r.detach(),void(n=null))},reset:function(){var e=this.getSelection(),t=this.getRange(),n=this.getDirection();"ltr"==n?t.setStart(e.focusNode,e.focusOffset):t.setStart(e.anchorNode,e.anchorOffset),t.collapse(!0),e.removeAllRanges(),e.addRange(t),t.detach(),e=null},getRange:function(){return document.createRange()},getCurrentRange:function(){var e=this.getSelection();return this.isIE()?e.createRange():e.rangeCount?e.getRangeAt(0):!1},getDirection:function(){var e=this.getSelection(),t=!1,n=this.getRange();return e&&!e.isCollapsed&&(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),t=n.collapsed,n.detach()),e=null,t?"rtl":"ltr"},intersectsNode:function(e){var t=this.getCurrentRange(),n=null;if(n=t.commonAncestorContainer,t.intersectsNode)return t.intersectsNode(e);for(;n&&n!==e;)n=n.parentNode;return!!n}},p={};return p.create=function(e){var t=new a(e);return t},p}]}function r(e,t,n){function r(r,i,o){function a(t,n){if(r.filterFriend=l.findWord("@"),32==n&&(r.filterFriend=""),""==r.filterFriend&&g&&r.closeDropdownFriend(),r.filterFriend&&!g){g=e('<rg-friend-dropdown template-url="templates/dropdowns/tag-editor-dropdown.html" tag-items="[]" filter-text="filterFriend" focus-filter="" on-close="closeDropdownFriend" on-select="chooseFriend"></rg-friend-dropdown>')(r),i.after(g);var o=l.getPosition();g.css({position:"absolute",left:o.x+"px",top:o.y+"px"})}g&&(l.tagOpen=!0,document.addEventListener("click",function a(e){g&&e.target!==g[0]&&r.closeDropdownFriend(),document.removeEventListener("click",a)},!1))}function s(e,t){return g&&(e.preventDefault(),g.triggerHandler(e,t)),!0}function c(e,t){r.editorContent=l.get(),r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}var l,u,d,g;r.filterFriend="",r.editorContent="",u="true"==o.showSticker||o.showSticker===!0?"true":"false",d={newLine:"false"!=o.newLine&&o.newLine!==!1,placeholder:o.placeholder?o.placeholder:"",isDisabled:"true"==o.isDisabled||o.newLine===!0,maxHeight:o.maxHeight?parseInt(o.maxHeight):0},o.showEmoji&&(d.emotion=e('<a href="javascript:void(0)"><i class="img_sprite icon-emoticon ico-sty" rg-emoticon="" clicked="insertEmoji" show-sticker="'+u+'"></i></a>')(r)[0],i.addClass("with_emo")),l=t.create(d),i.append(l.getNode()),l.onUpdate=c,r.insertEmoji=function(e){l.addEmoticon(e.symbol(),!0)},r.closeDropdownFriend=function(){g&&(g.remove(),g=void 0),l.tagOpen=!1},r.chooseFriend=function(e,t){r.filterFriend&&(l.addTag(e,r.filterFriend),r.closeDropdownFriend())},o.onRingbox&&l.addCallback("keydown",!1,function(e,t){r.$emit(n.RINGBOX.UPDATE)}),o.tagFriend&&(l.addCallback("keyup",!1,a,null),l.addCallback("keyup","escape",r.closeDropdownFriend,r),l.addProcessor("keydown","up,down,enter",s,null)),o.onEscape&&l.addCallback("keyup","escape",r.onEscape(),r),o.onEnter&&l.addProcessor("keydown","enter",function(e,t){return d.newLine!==!1||e.shiftKey||e.ctrlKey?!0:(r.onEnter()(r.onEnterArg),!1)}),r.$on("cleareditor",function(){l.clear()}),r.$on("seteditor",function(e,t){t=t||r.editorContent,l.set(t)}),r.$watch("isDisabled",function(e){e?(l.disable(),l.clear()):l.enable()}),o.focus&&r.$watch("focus",function(e){e&&(setTimeout(function(){l.setFocus()},0),o.editMode&&l.set(r.editMode()().toString()))}),RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from RgEditor",RingLogger.tags.DIGEST)}),r.$on("$destroy",function(){l.destroy(),l=d=g=null})}return{scope:{editorContent:"=",onEnter:"&",onEscape:"&",onEnterArg:"=",isDisabled:"=",focus:"=",editMode:"&"},restrict:"E",link:r}}e.module("ringid.shared").provider("$editor",n).directive("rgEditor",r),r.$inject=["$compile","$editor","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function n(e,n,r,i,o,a,s,c){function l(e){function t(){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}e.startAt=0,e.getMyStickers=function(){return e.myStickerCatIds().slice(e.startAt,e.startAt+4)},e.getTopStickers=function(){return o.getStickerCategories("top").slice(0,4)},e.loadPrevious=function(n){e.startAt=e.startAt>0?e.startAt-1:0,n.stopPropagation(),t()},e.loadNext=function(n){e.startAt=e.startAt+3<e.myStickerCatIds().length-1?e.startAt+1:e.startAt,n.stopPropagation(),t()},e.myStickerCatIds=o.getMyStickerCatIds,e.getSticker=o.getStickerCategoryObject,e.emoticonMap=o.getEmoticonMap()}var u=function(n,r,l){function u(){n.$parent&&1!==n.$parent.$id?n.$parent.$rgDigest():n.$rgDigest()}function d(e){e.preventDefault(),I=!I,I?f(e):g()}function g(e){(!e||"click"!==e.type||e.target!==r[0]&&e.target.parentNode&&e.target.parentNode!==r[0]&&e.target.parentNode.parentNode!==r[0]&&"pt-top"!==e.target.className)&&(I=!1,document.removeEventListener("click",g),document.removeEventListener("scroll",g),r[0].removeEventListener("resize",E),T[0].parentNode.removeChild(T[0]))}function m(i){T=e(i)(n),r.append(T),E(),document.addEventListener("click",g),document.addEventListener("scroll",g),t.addEventListener("resize",E)}function f(e){h=e,s.get(_)?m(s.get(_)):c.get(_).success(function(e){m(e)})}function E(){console.info("Calculate Emo Position");var e=0,t=r[0].getBoundingClientRect(),o=i.viewport.x-t.width,a=i.viewport.y;e=Math.floor(t.width/2),h.clientX+A<o&&h.clientY+A<a?(n.emoWindowStyle.top=t.top+(e+15)+"px",n.emoWindowStyle.left=t.left+(e+5)+"px"):h.clientX+A>o&&h.clientY+A>a?(n.emoWindowStyle.top=t.top-S+(e-5)+"px",n.emoWindowStyle.left=t.left-v+(e-5)+"px"):h.clientX+A>o?(n.emoWindowStyle.top=t.top+(e+5)+"px",n.emoWindowStyle.left=t.left-v+(e-5)+"px"):h.clientY+A>a&&(n.emoWindowStyle.top=t.top-S+(e-5)+"px",n.emoWindowStyle.left=t.left+(e+5)+"px"),u()}function p(e,t){t.stopPropagation(),l.clicked&&n.$eval(l.clicked)(e,t),g(),u()}var T,h,_="templates/partials/emoticon-window.html",I=!1,A=400,v=300,S="true"==l.showSticker?300:260;n.emoWindowStyle={height:S+"px",width:v+"px"},n.showsticker="true"==l.showSticker,n.selectedStickerCatId=0,r[0].addEventListener("click",d),n.selectEmoOrSticker=p,n.selectStickerCatId=function(e,t){e.stopPropagation(),n.selectedStickerCatId=t,o.getStickerMapByCatId(t).then(function(e){n.emoticonMap=e,u()}),a.scrollTop(n),u()},n.showEmoticons=function(e){e.stopPropagation(),n.emoticonMap=o.getEmoticonMap(),u()},n.$on("$destroy",function(){document.removeEventListener("click",g),document.removeEventListener("scroll",g),r[0].removeEventListener("resize",E)})};return l.$inject=["$scope"],{restrict:"A",link:u,controller:l}}e.module("ringid.shared").directive("rgEmoticon",n),n.$inject=["$compile","$timeout","$document","Utils","StickerFactory","rgScrollbarService","$templateCache","$ringhttp"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e){var t=this,n=!1,r=!1;t.close=function(i){RingLogger.information("CLOSE HASHTAG DROPDOWN",RingLogger.tags.MEDIA),r&&(r.style.display="none",n.resetTag(i),n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))},t.open=function(i,o){r=i,n=o,r.style.display="block",e.bindHandler("document","click",t.close)}}function n(e,t,n,r,i,o,a){var s=function(e,o){function s(t){t?e.selectedTag=e.selectedTag<=0?0:e.selectedTag-1:e.selectedTag=e.selectedTag+1>=e.tagSuggestions.length?e.tagSuggestions.length-1:e.selectedTag+1,e.selectedTag>=0&&(f.value=e.tagSuggestions[e.selectedTag].sk),RingLogger.information("MOVED TO SELECTION: "+e.selectedTag,RingLogger.tags.MEDIA),RingLogger.information("scroll to : "+e.selectedTag/e.tagSuggestions.length*100,RingLogger.tags.MEDIA),a.scrollTo(e,e.selectedTag/e.tagSuggestions.length*100),e.$rgDigest()}function c(t){var n=t.keyCode||t.which,i=f.value.trim();27!==n&&13!==n&&10!==n||(t.preventDefault(),t.stopPropagation(),i.length>0?(e.selectedTag>-1?e.addHashTag(e.tagSuggestions[e.selectedTag]):e.addHashTag({sk:i,ukey:0}),r.close(),e.tagLoading=!1):f.value="")}function l(t){var n=t.keyCode||t.which,i=f.value.trim();38===n&&i.length>0?s(!0):40===n&&i.length>0?s(!1):27===n||13===n||10===n?(RingLogger.information("ENTER pressed. add HashTag",RingLogger.tags.MEDIA),t.preventDefault()):i.length>0?(RingLogger.information("Search Param :"+i,RingLogger.tags.MEDIA),m=setTimeout(u,200)):0===i.length&&(RingLogger.information("Search Param empty",RingLogger.tags.MEDIA),clearTimeout(m),r.close()),e.$rgDigest()}function u(){var t=f.value.trim();t.length>0&&g!==t?(r.open(d,e),g=t,e.tagLoading=!0,e.selectedTag=-1,e.tagSuggestions=[],RingLogger.information("Searching for :"+t,RingLogger.tags.MEDIA),n.fetchHashtagSuggestion(t).then(function(t){e.tagLoading&&(clearTimeout(m),e.tagLoading=!1,RingLogger.information("HASH TAG SUGGESTION"),RingLogger.print(t,RingLogger.tags.UPLOAD),t.sucs===!0?e.tagSuggestions=t.sgstn:r.close(),e.$rgDigest())})):clearTimeout(m),e.$rgDigest()}var d,g,m,f;e.selectedTag=-1,e.tagList=t.tagList,e.tagSuggestions=[],e.tagLoading=!1,f=o[0].parentNode.querySelector("textarea#add-hashtag"),d=o[0].parentNode.querySelector("div#hashtag-dropdown"),f.addEventListener("keyup",l),f.addEventListener("keydown",c),e.removeTag=function(n,r){n.preventDefault(),RingLogger.information("remove tag index: "+r,RingLogger.tags.UPLOAD),t.tagList.splice(r,1),e.$rgDigest()},e.addHashTag=function(t){e.tagList.push(t),r.close(!0)},e.resetTag=function(n){t.tagSuggestions=[],e.selectedTag=-1,n&&(f.value=""),e.$rgDigest()},e.gotMedias=function(){return t.audioFiles.length>0||t.videoFiles.length>0},e.$on(i.FILE_UPLOAD.UPLOADS_POSTED,function(){e.tagList=[],e.resetTag(!0)}),e.$on("$destroy",function(){f.removeEventListener("keyup",l),f.removeEventListener("keypress",c)})};return{restrict:"E",link:s,template:'<div ng-show="gotMedias()"><div ><ul class="tag-fnd-lst"><li ng-repeat="tag in tagList" ><span class="tag-title" ng-bind="tag.sk" ></span>&nbsp;<span class="tag-cros" rg-click="removeTag($event, $index)">X</span></li></ul></div></div><div  ng-show="ddControl.uploadWhat !== \'image\' && getMedia(true).length > 0"  class="b-t-b"><span class="top-r float-left" data-tool="Type something for tags suggestion OR press enter to add new tag"><i class="p-10 img_sprite view-ico" style="margin:7px;padding:0;"></i></span><textarea id="add-hashtag" ng-model="tagName" type="text"  class="media-tags float-left"  placeholder="Add Hashtag" ></textarea><div class="clear"></div></div><div id="hashtag-dropdown" class="m-s-height tag-dd active" style="display:none;"><div class="loader-s" ng-show="tagLoading"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div><ul class="m-s-result" rg-scrollbar="true" style="overflow: hidden;"><li ng-repeat="tag in tagSuggestions track by tag.ukey" ng-class="{active:$index==selectedTag}"  class="m-t-icon" rg-click="addHashTag({sk: tag.sk, ukey: tag.ukey})"><a href="javascript:void(0)" title="{{tag.sk}}" ng-bind="tag.sk" > abc</a></li></ul></div>'}}e.module("ringid.shared").service("rgHashtagService",t).directive("rgHashtag",n),t.$inject=["GlobalEvents"],n.$inject=["$compile","fileUploadService","Media","rgHashtagService","SystemEvents","$rootScope","rgScrollbarService"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n){function r(e,r,i,o,a,s,c,l,u,d){function g(){S=0,r.previewStartAt=0,r.ddControl.uploadWhat="image",r.ddControl.createAlbum=!1,r.ddControl.albumName="",r.ddControl.selectedAlbum=0,t.resetUpload(),t.tagList=[],r.tagList=t.tagList,r.$rgDigest()}function m(e){return e?t[r.ddControl.uploadWhat+"Files"]:t[r.ddControl.uploadWhat+"Files"].slice(r.previewStartAt,r.previewStartAt+3)}function f(e){t[r.ddControl.uploadWhat+"Files"][e].getQueued()?t[r.ddControl.uploadWhat+"Files"][e].cancelUpload():t[r.ddControl.uploadWhat+"Files"].splice(r.previewStartAt+e,1),0===t[r.ddControl.uploadWhat+"Files"].length?(RingLogger.information("All media files removed from status",RingLogger.tags.UPLOAD),g()):r.previewStartAt=r.previewStartAt>0?r.previewStartAt-1:r.previewStartAt}function E(){r.previewStartAt=r.previewStartAt-3>0?r.previewStartAt-3:0}function p(){r.previewStartAt=r.previewStartAt+3<=t[r.ddControl.uploadWhat+"Files"].length-4?r.previewStartAt+3:t[r.ddControl.uploadWhat+"Files"].length-3}function T(e){return t[r.ddControl.uploadWhat+"Files"].length>0?r.ddControl.uploadWhat!==e:!1}function h(){t.videoFiles=[],t.imageFiles=[];var e,n,i=this;for(e=0;e<i.files.length;e++)S+=i.files[e].size;if(i.files.length+t.audioFiles.length>v.AUDIO_UPLOAD_LIMIT)c.show("Maximum upload limit "+v.AUDIO_UPLOAD_LIMIT,"warning");else if(S>v.MEDIA_UPLOAD_SIZE_LIMIT)for(c.show("Maximum allowed total upload files size 500MB!","warning"),e=0;e<i.files.length;e++)S-=i.files[e].size;else{r.hasOwnProperty("rgUploadAction")&&r.rgUploadAction("audio"),0===t.audioFiles.length&&(r.ddControl.uploadWhat="audio",r.ddControl.selectedAlbum=null,t.setUploadAlbum(-1));var o=t.audioFiles.length;for(e=0,n=i.files.length;n>e;e++)A("audio",i.files[e])?t.queueFile("audio",i.files[e]):c.show("Invalid Audio File: "+i.files[e].name,"error");u.$broadcast(s.FILE_UPLOAD.QUEUE_START),t.uploadQueue("audio",o)}i.value=null,r.$rgDigest()}function _(){var e,n,i=this;for(e=0;e<i.files.length;e++)S+=i.files[e].size;if(i.files.length+t.videoFiles.length>v.VIDEO_UPLOAD_LIMIT)c.show("Maximum upload limit "+v.VIDEO_UPLOAD_LIMIT,"warning");else if(S>v.MEDIA_UPLOAD_SIZE_LIMIT)for(c.show("Maximum allowed total upload files size 500MB!","warning"),e=0;e<i.files.length;e++)S-=i.files[e].size;else{0===t.videoFiles.length&&(r.ddControl.uploadWhat="video",r.ddControl.selectedAlbum=null,t.setUploadAlbum(-1)),r.hasOwnProperty("rgUploadAction")&&r.rgUploadAction("video");var o=t.videoFiles.length;for(e=0,n=i.files.length;n>e;e++)A("video",i.files[e])?t.queueFile("video",i.files[e]):c.show("Invalid Video File: "+i.files[e].name,"error");t.uploadQueue("video",o),u.$broadcast(s.FILE_UPLOAD.QUEUE_START)}i.value=null,r.$rgDigest()}function I(){r.ddControl.uploadWhat="image";var e=this;switch(r.rgUploadType){case"coverphoto":case"profilephoto":case"tagchatimage":case"chatimage":if(A("image",e.files[0])){var n=t.queueFile(r.rgUploadType,e.files[0]);r.hasOwnProperty("rgUploadAction")&&r.rgUploadAction()({action:r.rgUploadType,uploadFile:n})}else c.show("Invalid Image File: "+e.files[0].name,"error");e.value=null;break;case"status":
if(e.files.length+t.imageFiles.length>v.IMAGE_UPLOAD_LIMIT){c.show("Maximum upload limit "+v.IMAGE_UPLOAD_LIMIT,"warning");break}for(var i=t.imageFiles.length,o=0;o<e.files.length;o++)A("image",e.files[o])?t.queueFile("image",e.files[o]):c.show("Invalid Image File: "+e.files[o].name,"error");u.$broadcast(s.FILE_UPLOAD.QUEUE_START),t.uploadQueue("image",i),e.value=null}r.$rgDigest()}function A(e,t){var n;switch(e){case"image":n=new RegExp("image/*");break;case"audio":n=new RegExp("audio/mp3*");break;case"video":n=new RegExp("video/mp4");break;case"default":}return n.test(t.type)}var v=a,S=0;r.uploadProgress=t.uploadProgress,r.previewStartAt=0,r.tagList=t.tagList,r.ddHtml="templates/dropdowns/album-dropdown.html",r.ddControl={Media:n,uploadWhat:"image",createAlbum:!1,albumName:"",selectedAlbum:0},r.selectAlbum=function(){return{data:function(){return{from:"feedpost",mediaType:r.ddControl.uploadWhat}}}},r.getMedia=m,r.removeMedia=f,r.loadPrevious=E,r.loadNext=p,r.disableUpload=T,r.uploadAudio=h,r.uploadVideo=_,r.uploadImage=I,r.$on(s.FILE_UPLOAD.UPLOADS_POSTED,g),r.$on("$destroy",function(){var e,n;switch(r.rgUploadType){case"coverphoto":t.coverImageFile&&(t.coverImageFile.cancelUpload(),t.coverImageFiles=null);break;case"profilephoto":t.profileImageFile&&(t.profileImageFile.cancelUpload(),t.profileImageFiles=null);break;case"tagchatimage":case"chatimage":t.chatImageFiles[r.rgUploadBoxValue]&&(t.chatImageFiles[r.rgUploadBoxValue].cancelUpload(),delete t.chatImageFiles[r.rgUploadBoxValue]);break;case"status":if(t.imageFiles.length>0){for(e=0,n=t.imageFiles.length;n>e;e++)t.imageFiles[e].cancelUpload();t.imageFiles=[]}else if(t.videoFiles.length>0){for(e=0,n=t.videoFiles.length;n>e;e++)t.videoFiles[e].cancelUpload();t.videoFiles=[]}else if(t.audioFiles.length>0){for(e=0,n=t.audioFiles.length;n>e;e++)t.audioFiles[e].cancelUpload();t.audioFiles=[]}}})}r.$inject=["Auth","$scope","mediaMetadata","imageQuality","APP_CONSTANTS","SystemEvents","Ringalert","$$q","$rootScope","rgDropdownService"];var i=function(n,r,i){var o,a,s,c=i.rgUploadType,l="",u="",d='<div class="to-add" ng-show="ddControl.uploadWhat !== \'image\' && getMedia(true).length > 0" ><span ><a  class="img_sprite btn-share vid top-l" data-tooltip-post="Add to album"  rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true" ringbox-type="remote" ringbox-target="templates/dropdowns/popup-album-dropdown.html" ringbox-data="selectAlbum(media.value)" ></a> </span></div><rg-hashtag></rg-hashtag><div class="status-photo-view" style="border-bottom:1px solid #ebebeb;margin:0;padding:0;margin-bottom:10px;" id="img-height" ng-show="getMedia(true).length > 0"><div id="sts-img-preview" style="text-align:center;" class="scroll"><div ng-show="previewStartAt+3 < getMedia(true).length" class="np-box img_sprite icon-right-arrow"  style="right:0;margin-top:60px;" rg-click="loadNext()"></div><div ng-show="previewStartAt > 0" class="np-box  img_sprite icon-left-arrow" style="left:0;margin-top:60px;"  rg-click="loadPrevious()"></div><div style="margin-top:3px;" class="status-photo-view-thumb" ng-repeat="image in getMedia()"><div ng-show="image.getProgress() !== 100" class="progress-bar-placement" style="position:absolute;width:100%;text-align:center;"><div class="percent">{{image.getProgress()}}%</div><div class="progress-bar"><div class="uploaded" ng-style="{\'width\': image.getProgress()+ \'%\'}"></div></div></div><div  id="singleImage{{$index}}"  style="position:absolute;width:100%;text-align:center;"><input class="add-title" ng-model="image.cptn" ng-model-options="{ getterSetter: true }" type="text" name="" placeholder="Add Photo Title" ng-show="!image.progressVisible" /><div class="photo-view" style="background-image: url({{image.getPreview()}}); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer;"><div class="status-photo-view-thumb-hover"><span id="closebtn0" class="close" style="display: block;" rg-click="removeMedia($index)" inc="0"><div class=" up-p"></div></span></div></div></div></div></div>';switch(c){case"coverphoto":case"profilephoto":l='<input  id="'+c+'" type="file" name="'+c+'"  accept="image/*" >',r.append(e(l)(n));break;case"tagchatimage":case"chatimage":l='<label  class="img_sprite icon-camera ico-sty ng-binding ng-scope"><input  id="'+c+'" type="file" style="display:none;" accept="image/*" ></label>',r.append(e(l)(n));break;case"audio":l='<a data-tooltip-post="Add Audios" href="javascript:void(0)"><label  class="audio-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a>',r.append(e(l)(n));break;case"video":l='<a data-tooltip-post="Add Videos" href="javascript:void(0)"><label  class="video-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="video" type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a>',r.append(e(l)(n));break;case"status":l='<div ng-show="rgUploadEnabled "class="post-b-ico"><a data-tooltip-post="Add Videos" href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico video-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'video\')" id="video"type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a></div><div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Audios" href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico audio-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'audio\')" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a></div>',i.rgUploadFeed&&"true"==i.rgUploadFeed&&(l='<div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Photos"  href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico camera-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'image\')" id="'+c+'" type="file" style="display:none;" multiple="multiple" accept="image/*"></label></a></div>'+l),r.append(e(l)(n)),o=r.parent().prepend(e(d)(n))}u=r[0].querySelector("input#"+c),"status"===c?(i.rgUploadFeed&&"true"==i.rgUploadFeed&&u.addEventListener("change",n.uploadImage),a=r[0].querySelector("input#video"),a.addEventListener("change",n.uploadVideo),s=r[0].querySelector("input#audio"),s.addEventListener("change",n.uploadAudio)):"audio"===c?u.addEventListener("change",n.uploadAudio):"video"===c?u.addEventListener("change",n.uploadVideo):u.addEventListener("change",n.uploadImage),n.$rgDigest(),n.$on("$destroy",function(){switch(c){case"status":i.rgUploadFeed&&"true"==i.rgUploadFeed&&u.removeEventListener("change",n.uploadImage),s.removeEventListener("change",n.uploadAudio),a.removeEventListener("change",n.uploadVideo);break;case"image":u.removeEventListener("change",n.uploadImage);break;case"audio":u.removeEventListener("change",n.uploadAudio);break;case"video":u.removeEventListener("change",n.uploadVideo)}t.removeScope(n)}),t.setScopeForDigest(n)};return{restrict:"AE",scope:{rgUploadEnabled:"=",rgUploadType:"@",rgUploadAction:"&",rgUploadBoxValue:"="},link:i,controller:r}}e.module("ringid.shared").directive("rgUpload",t),t.$inject=["$compile","fileUploadService","Media"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i){function o(o,a){function s(){m=a[0].querySelector("#invname"),f=a[0].querySelector("#invavatarlink"),E=a[0].querySelector("#invavatarimg"),p=a[0].querySelector("#invmutual"),T=a[0].querySelector("#invaddfriend"),a[0].addEventListener("mouseenter",l),a[0].addEventListener("mouseleave",c),a[0].style.display="block",u(),c()}function c(){l(),h=setInterval(u,5e3)}function l(){clearInterval(h)}function u(){_=_?n.suggestionFriends.next(_.getUtId())||n.suggestionFriends.bottom():n.suggestionFriends.bottom(),_?(m.textContent=_.getName(),m.setAttribute("href",_.link()),f.setAttribute("href",_.link()),E.setAttribute("src",_.avatar("thumb")),p.textContent=_.commonFriends()+" mutual friends",_.commonFriends()>0?p.style.display="block":p.style.display="none",d()):a[0].style.display="none"}function d(e){_.isLoading()?T.parentElement.classList.add("f-loading"):T.parentElement.classList.remove("f-loading")}function g(){e.subscribe(function(){I||(I=setTimeout(function(){s()},1e3))},{action:[A.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),setTimeout(n.init,5e3)}var m,f,E,p,T,h,_,I,A=t.SYSTEM.FRIENDS;a[0].style.display="none",o.removeOutGoingFriends=function(){for(var e=[],t=n.suggestionFriends.all(),r=n.suggestionFriends.length(),i=0;r>i;i++)0!==t[i].value.friendshipStatus()&&e.push(t[i].value.getUtId());for(var o=0;o<e.length;o++)n.suggestionFriends.remove(e[o])},o.getSuggestions=function(){return o.removeOutGoingFriends(),n.suggestionFriends.length()<5&&n.getSuggestionContactsDetails(),{data:function(){return{target:n.suggestionFriends}}}},o.removeSugg=function(){n.removeSuggestion(_.getUtId(),"remove"),u()},o.getMutualFriend=function(){return{data:function(){return{target:_}},promise:i.user.getMutualFriends(_)}},o.friendRequestAction=function(){var e=3===_.friendshipStatus()?"remove":"addfriend",t=_;l(),r.friendAction({friend:t,action:e},!0).then(function(e){u(),d(e.sucs),c(),e.sucs===!0&&n.removeSuggestion(t.getUtId()).then(function(e){e.sucs===!0&&n.suggestionFriends.remove(t.getUtId())})},function(){d(),c()}),d()},g(),o.$on("$destroy",function(){a[0].removeEventListener("mouseenter",c),a[0].removeEventListener("mouseenter",l)})}return{restrict:"A",templateUrl:"templates/partials/friend-invite.html",link:o}}e.module("ringid.shared").directive("rgInvite",t),t.$inject=["$$connector","OPERATION_TYPES","InviteFactory","friendsFactory","Api"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t){e.isCurrentPath=function(e,n){if(1==e.length)return n?t.path().indexOf(e[0])>-1:t.path()==e[0];for(var r=0;r<e.length;r++)if(t.path().indexOf(e[r])>-1)return n?t.path().indexOf(e[r])>-1:t.path()==e[r]}}e.module("ringid.shared").controller("MenuController",t),t.$inject=["$scope","$location"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c){function l(t){t&&(i.noOfSuggestions()>d&&(s.recalculate(e),e.$rgDigest()),d=i.noOfSuggestions())}e.users=[];var u=o.SYSTEM.FRIENDS;e.state=i.state,t.opened.then(function(){e.users=n.target.all(),e.$rgDigest()});var d=n.target.length();e.$watch("state.isRequestsLoading",function(t,n){e.$rgDigest()}),e.contactListAction=function(t){t.friend.isLoading()||(r.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.loadmorefriend=function(){i.getSuggestionContactsDetails(5),e.$rgDigest()},e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:c.user.getMutualFriends(e)}};var g=a.subscribe(l,{action:[u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]});e.$on("$destroy",function(){a.unsubscribe(g)})}e.module("ringid.shared").controller("allSuggestionController",t),t.$inject=["$scope","$boxInstance","localData","friendsFactory","InviteFactory","OPERATION_TYPES","$$connector","rgScrollbarService","Api"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o){var a=t.mfIDs;e.mutualfriends=[],n.getContactDetailsByUtIds(a).then(function(t){if(e.mutualfriends=[],t.sucs===!0){for(var n=0;n<t.contacts.length;n++)e.mutualfriends.push(r.create(t.contacts[n]));e.$rgDigest()}o.recalculate(e),e.$rgDigest()}),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:i.user.getMutualFriends(e)}}}e.module("ringid.shared").controller("mutualFriendsController",t),t.$inject=["$scope","remoteData","friendsFactory","userFactory","Api","rgScrollbarService"]}()}(angular,window),function(e,t){"use strict";e.module("ringid.utils",["ringid.config","ringid.global_services"])}(angular,window),function(e,t){"use strict";function n(e){return{restrict:"A",link:function(t,n,r){n[0].onload=function(){t.feedKey?t.$emit(e.FEED.HEIGHT,t.feedKey):t.$emit(e.RINGBOX.UPDATE)},n[0].src=r.ogImageSrc}}}function r(e,n,r,i){return{restrict:"E",replace:!0,scope:{onClick:"&",ogData:"=",showPreview:"=",loadingData:"=",editMode:"@",feedKey:"@"},templateUrl:"",link:function(t,n,i){var o="templates/partials/url-og-preview.html";i.template&&(o=i.template),e.get(o).success(function(e){n.append(r(e)(t)),t.$rgDigest()})},controller:["$scope","$sce","settings",function(e,n,r){function o(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){i.safeDigest(e)}}function a(){if(e.ogData&&!e.ogData.images){var n=e.ogData.url;n&&t.open(n,"_blank")}}function s(){e.ogData.images&&(e.ogData.image=e.ogData.images[e.selectedOgImageIndex])}function c(){e.ogData.image=""}function l(){e.ogData.title=""}function u(){e.ogData.description=""}function d(){e.ogData.url=""}function g(){e.ogData.lnkDmn=""}function m(t,n){e.ogData.meta[t]=n}function f(t,n){e.ogData.meta={youtube:!1,youtube_id:""}}function E(){e.selectedOgImageIndex<e.ogData.images.length-1&&(e.selectedOgImageIndex+=1),s(),o()}function p(){e.selectedOgImageIndex>0&&(e.selectedOgImageIndex-=1),s(),o()}function T(e){e.preventDefault(),e.stopPropagation(),c(),o()}function h(e){e.preventDefault(),e.stopPropagation(),l(),u(),d(),g(),o()}function _(){return!!e.ogData.images&&e.selectedOgImageIndex<e.ogData.images.length-1}function I(){return e.selectedOgImageIndex>0}function A(){return!!e.editMode&&!!e.ogData.image&&e.ogData.filteredImages.length>1}function v(){return!!e.editMode&&!e.filterOnProgress&&!!e.ogData.image}function S(){e.filterOnProgress=!0}function C(){e.filterOnProgress=!1}function D(t){e.ogData.filteredImages.push(t)}function N(t){e.ogData.filteredImages=[]}function M(t){e.ogData.image=t}function R(){return!e.ogData.meta&&e.ogData.url&&(f(),b(e.ogData.url)),!!e.ogData.meta&&e.ogData.meta.youtube}function y(){return e.ogData.meta.youtube_id}function O(){return n.trustAsResourceUrl("https://www.youtube.com/embed/"+y()+"?autoplay=0&autohide=1&border=0&wmode=opaque&enablejsapi=1")}function b(e){var t=/((http|https):\/{2})+((www\.)?youtube\.com)([?&]?([^=]+)=([^&]*))?/im;if(e){var n=e.match(t);n&&n[3]&&n[7]?(m("youtube",!0),m("youtube_id",n[7])):m("youtube",!1)}}function P(){N(),S();var t=e.ogData.images;i.filterImagesByDimentions(t,{width:200}).then(function(n){console.log(n),console.log(t),e.ogData.image||M(n),D(n),e.filterOnProgress&&C(),o()},function(){},function(t){console.log(t),D(t),e.ogData.image||M(t),console.log(e.ogData.image),o()})}e.selectedOgImageIndex=0,e.onClick=a,e.onImageCloseClick=T,e.onDetailCloseClick=h,e.selectPreviousImage=p,e.selectNextImage=E,e.shouldShowNextButton=_,e.shouldShowPreviousButton=I,e.isYoutubeUrl=R,e.getYoutubeUrl=O,e.filterOnProgress=!1,e.ogData.title=decodeEntities(e.ogData.title),e.ogData.description=decodeEntities(e.ogData.description),e.shouldShowNextPreviousButtonContainer=A,e.shouldShowImageCloseButton=v,e.init=function(){e.ogData&&e.ogData.url&&(f(),b(e.ogData.url),e.ogData.url&&(/^https?:\/\//.test(e.ogData.url)||(e.ogData.url="http://"+e.ogData.url)),e.ogData.image&&(/^https?:\/\//.test(e.ogData.image)||(e.ogData.image="http://"+e.ogData.image),r.secure&&/^http:/.test(e.ogData.image)&&(e.ogData.image=r.httpsUrl+"/ImageProxy.png?url="+e.ogData.image.replace(/http:\/\//,""))),e.ogData.images&&e.ogData.images.length>0&&P())},e.$watch("ogData",function(){e.init()})}]}}e.module("ringid.utils").directive("ogImageSrc",n).directive("rgUrlOgPreview",r),n.$inject=["SystemEvents"],r.$inject=["$ringhttp","$templateCache","$compile","Utils"]}(angular,window),function(e,t){"use strict";!function(){function t(t){return{restrict:"E",scope:{fetchedOgInfo:"=",editorContent:"=",showPreview:"=",filterOnProgress:"=",loadingData:"="},link:function(e,t,n){e.fetchedOgInfo=e.fetchedOgInfo||{},e.filterOnProgress&&(e.filterOnProgress=!1)},controller:["$scope","$rootScope","$timeout","Utils","settings",function(t,n,r,i,o){function a(){try{t.$parent.$parent?t.$parent.$parent.$rgDigest():t.$parent.$rgDigest()}catch(e){i.safeDigest(t)}}function s(e,n){if(A(e,n)){if(e&&v.test(e)){console.log("Updated Value ",e);var r=e.match(v),o=r[1];if(o){var s=r[5]?r[5]:"";if(/^https?:\/\//.test(o)||(o="http://"+o),console.log("Detected Url",o),!c(o))return;console.log("Starting to Fetch Url",o);var E=u(o);E?(d(E),p(),I()):(m(),I(),a(),i.getOGDetails(o).success(function(e){f(),console.log("Server Response :",e),e&&e.sucs?(l(o,e),e.lnkDmn=s,e.url=o,e=_(e,o),d(e),p()):(g(),T()),I(),a()}).error(function(e){g(),h(),T(),f(),I(),a()}))}}else g(),T();t.$parent.$rgDigest()}}function c(e){return t.fetchedOgInfo&&C==e?(console.log("Same Url Will Not Fetch"),!1):(C=e,!0)}function l(e,t){S[e]=t}function u(e){S[e]}function d(e){t.fetchedOgInfo=e}function g(){t.fetchedOgInfo={}}function m(){t.loadingData=!0}function f(){t.loadingData=!1}function E(){return t.loadingData}function p(){t.showPreview=!0}function T(){t.showPreview=!1}function h(){C=""}function _(t,n){var r=e.extend({},t);if(r.url||(r.url=n),r.title||(r.title=r.lnkDmn),t.images)for(var i=t.images.length,a=0;i>a;a++)o.secure&&/^http:/.test(t.images[a])&&(t.images[a]=o.httpsUrl+"/ImageProxy.png?url="+t.images[a].replace(/http:\/\//,""));return r.title=decodeEntities(r.title),r.description=decodeEntities(r.description),r}function I(){r(function(){n.$broadcast("statusHeightChange")})}function A(e,n){return E()?!1:t.fetchedOgInfo&&(t.fetchedOgInfo.image||t.fetchedOgInfo.title||t.fetchedOgInfo.description)?!1:(h(),!0)}var v=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,S={},C="";RingLogger.tags.DIGEST&&t.$watch(function(){RingLogger.info("from rgUrlOgFetcher",RingLogger.tags.DIGEST)}),t.$watch("editorContent",i.debounce(function(e,t){s(e,t),a()},500))}]}}var n;try{n=e.module("ringid.utils")}catch(r){return void console.warn("Utils Module Not Found")}n.directive("rgUrlOgFetcher",t),t.$inject=["$compile"]}()}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view.html"}}function r(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view1.html"}}function i(){return{restrict:"E",scope:{isLoading:"="},templateUrl:"templates/partials/loading_view2.html"}}e.module("ringid.utils").directive("rgLoaderView",n).directive("rgLoaderView1",r).directive("rgLoaderView2",i)}(angular,window),function(e,t){"use strict";e.module("ringid.utils").directive("rgCompile",["$compile",function(e){return function(t,n,r){t.$watch(function(e){return e.$eval(r.rgCompile)},function(r){n.html(r),e(n.contents())(t)})}}])}(angular,window),function(e,t){"use strict";var n;n=e.module("ringid.utils"),n.directive("rgKeyUp",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(r){}}t.bind("keyup",r),e.$on("$destroy",function(){t.unbind("keyup",r)})}}),n.directive("rgKeyPress",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(r){RingLogger.alert(r,"DEBUG")}}t.bind("keypress",r),e.$on("$destroy",function(){t.unbind("keypress",r)})}})}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n){var r=n.createNew(),i=function(){r.doForAll(function(e){e.call(null)})};return e.onfocus=i,{add:function(e){var n=t.getUniqueID();return r.add(n,e),n},remove:function(e){return r.remove(e)},fire:function(){i()}}}function n(e,t,n){var r=n.createNew(),i=function(){r.doForAll(function(e){e.call(null)})};return e.onblur=i,{add:function(e){var n=t.getUniqueID();return r.add(n,e),n},remove:function(e){return r.remove(e)},fire:function(){i()}}}var r;r=e.module("ringid.utils"),r.factory("windowFocusHandler",t),t.$inject=["$window","Utils","$$stackedMap"],r.factory("windowBlurHandler",n),n.$inject=["$window","Utils","$$stackedMap"]}()}(angular,window),function(e,t){"use strict";e.module("ringid.directives",["ringid.config","ringid.connector","ringid.global_services"])}(angular,window),function(e,t){"use strict";e.module("ringid.directives").directive("rgRoundProgress",[function(){var e=function(e,n,r){if(1===e.length){var i,o,a,s,c,l,u,d,g,m,f,E=e[0],p=document.createElement("canvas");return{pre:function(e,n,r,T){var h=(t.outerWidth-20)/1920;i=+(e.roundProgressBarStyle.dataRoundProgressWidth||"200")*h,o=+(e.roundProgressBarStyle.dataRoundProgressHeight||"200")*h,p.setAttribute("width",i),p.setAttribute("height",o),p.setAttribute("data-round-progress-model",E.getAttribute("data-round-progress-model")),E.parentNode.replaceChild(p,E),a=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleWidth||"4")*h,s=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleWidth||"8")*h,g=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleRadius||"85")*h,m=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleRadius||"85")*h,f=+(e.roundProgressBarStyle.dataRoundProgressLabelFont||"24")*h+"px Arial",c=e.roundProgressBarStyle.dataRoundProgressOuterCircleBackgroundColor||"#505769",l=e.roundProgressBarStyle.dataRoundProgressOuterCircleForegroundColor||"#13A8E8",u=e.roundProgressBarStyle.dataRoundProgressInnerCircleColor||"#505769",d=e.roundProgressBarStyle.dataRoundProgressLabelColor||"#fff"},post:function(e,t,n,r){var c=p.getAttribute("data-round-progress-model");e.$watch(c,function(e,t){console.log(c,e,t);var n=p.getContext("2d");n.clearRect(0,0,i,o);var r=i/2,u=o/2;n.beginPath(),n.arc(r,u,parseInt(m),0,2*Math.PI,!1),n.lineWidth=parseInt(s),n.strokeStyle="rgba(255,255,255,0.5)",n.globalCompositeOperation="source-over",n.stroke(),n.font=f,n.textAlign="center",n.textBaseline="middle",n.fillStyle=d,n.fillText(e.label+"%",r,u);var E=-(Math.PI/2),T=2*Math.PI*e.percentage-Math.PI/2,h=!1;n.beginPath(),n.arc(r,u,parseInt(g),E,T,h),n.lineWidth=parseInt(a),n.strokeStyle=l,n.stroke()},!0)}}}},n={compile:e,replace:!0};return n}])}(angular,window),function(e,t){"use strict";function n(e,t){return{restrict:"E",template:'<a class="glo-l ng-cloak"> <span class="load-circle"><span class="ld-cir1 glo-cir"></span><span class="ld-cir2 glo-cir"></span><span class="ld-cir3 glo-cir"></span><span class="ld-cir4 glo-cir"></span><span class="ld-cir5 glo-cir"></span><span class="ld-cir6 glo-cir"></span><span class="ld-cir7 glo-cir"></span><span class="ld-cir8 glo-cir"></span><span class="ld-cir9 glo-cir"></span><span class="ld-cir10 glo-cir"></span><span class="ld-cir11 glo-cir"></span><span class="ld-cir12 glo-cir"></span></span><span class="glo-type">Processing...</span></a>',scope:{rgLoadingObj:"="},link:function(n,r){e.$on(t.AUTH.LOGIN,function(){r[0].style.display="none",n.$rgDigest()}),e.$on(t.LOADING,function(e,t){t?r[0].style.display="block":r[0].style.display="none"}),r[0].style.display="none"}}}e.module("ringid.directives").directive("rgLoading",n),n.$inject=["$rootScope","SystemEvents"]}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",template:'<div id="global-loader" class="rgbubbling"><span id="rgbubbling_1"></span><span id="rgbubbling_2"></span><span id="rgbubbling_3"></span></div>'}}e.module("ringid.directives").directive("rgGlobalLoader",n)}(angular,window),function(e,t){"use strict";function n(e,t,n){return{restrict:"A",scope:{onSelect:"&"},link:function(r,i){function o(){r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}function a(e){e.preventDefault(),r.active?r.initEMotionList("none",e):r.initEMotionList("block",e),r.active=!r.active,o()}function s(e){e.target!==i[0]&&e.target.parentNode&&e.target.parentNode!==i[0]&&e.target.parentNode.parentNode!==i[0]&&"pt-top"!==e.target.className&&r.close(e)}var c;r.active=!1,r.emotionFilterText="",r.initEMotionList=function(t){n.init(),c||(c=e('<rg-emotion-dropdown filter-text="emotionFilterText" focus-filter="active" on-close="close" on-select="choose"></rg-emotion-dropdown>')(r),i.after(c)),c.css("display",t)},r.choose=function(e,t){r.onSelect({item:e}),r.emotionFilterText="",r.initEMotionList("none",t),r.active=!1,o()},i.on("click",a),t.on("click",s),r.close=function(e){r.active&&(r.initEMotionList("none",e),r.active=!1),o()},RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from rgEmotionDir",RingLogger.tags.DIGEST)}),r.$on("$destroy",function(){i.off("click",a),t.off("click",s),c=void 0})}}}function r(t){function n(e){e.stopPropagation()}return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&onClose"},templateUrl:"templates/dropdowns/emotion-dropdown.html",compile:function(){return{pre:function(n){n.emotions={},n.emotions[0]=t.getEmotions(),n.setEmotion=function(e){n.emotions[0]=e,n.$rgDigest()},t.setScopeForDigest(n),n.updateModel=function(e){n.filterText=e.target.value,n.$parent.$rgDigest()},n.loading=!!n.emotions.length,n.choose=e.isFunction(n.onSelect)?n.onSelect():e.noop,n.close=e.isFunction(n.onClose)?n.onClose():e.noop,RingLogger.tags.DIGEST&&n.$watch(function(){RingLogger.info("from rgEmotionDropdownDir",RingLogger.tags.DIGEST)}),n.$on("$destroy",function(){t.removeScope(n)})},post:function(e,t){t.on("click",n),e.$on("$destroy",function(){t.off("click",n)}),e.$rgDigest()}}}}}e.module("ringid.directives").directive("rgEmotion",n).directive("rgEmotionDropdown",r),n.$inject=["$compile","$document","EmotionFactory"],r.$inject=["EmotionFactory"]}(angular,window),function(e,t){"use strict";function n(e,t,n){function r(e,t,n,r,i,o,a,s,c,l,u,d,g){function m(n,r){"album"===r?t.state.albumsLoading=n:(t.state.imagesLoading=n,e.recalculate(t)),t.$rgDigest()}function f(){!t.state.imagesLoading&&t.activeAlbum.getImages().length()<t.activeAlbum.getTotalImageCount()&&(m(!0,"image"),r.loadMoreImage(t.activeAlbum.getKey(),i.uId))}function E(e){return function(){return{image:e,popupFrom:"profile"}}}function p(e){var n="Are you sure you want to delete?",i=l.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"});i.result.then(function(n){n&&r.deleteImage(e).then(function(n){n.sucs===!0?t.activeAlbum.removeImage(e.getKey()):u("Image delete failed","error"),t.$rgDigest()})})}function T(e){e?(t.activeAlbum=e,t.showAlbumPreview=!1,t.activeAlbum.getImages().length()<20&&t.loadMoreImage()):(t.showAlbumPreview=!0,t.activeAlbum=null),t.$rgDigest()}function h(e){RingLogger.print("selected: "+e.src(),RingLogger.tags.IMAGE),t.forSelection&&n.$broadcast(s.IMAGE.DO_REPOSITION,{image:e.src()})}function _(){I=d.subscribe(function(e){switch(e.actn){case A.TYPE_ALBUM_IMAGES:case A.TYPE_FRIEND_ALBUM_IMAGES:e.sucs===!1&&1111===e.rc?(RingLogger.warning("ALBUM FETCH REQUEST REPEAT",RingLogger.tags.IMAGE),r.fetchAllAlbums(i.uId)):(r.processResponse(e),m(!1));break;case A.FETCH_FRIEND_ALBUM_LIST:case A.FETCH_ALBUM_LIST:e.sucs===!1&&1111===e.rc?(RingLogger.warning("ALBUM IMAGES FETCH REQUEST REPEAT",RingLogger.tags.IMAGE),f()):(r.processResponse(e,i.uId),m(!1,"album"))}},{action:[A.TYPE_ALBUM_IMAGES,A.TYPE_FRIEND_ALBUM_IMAGES,A.FETCH_FRIEND_ALBUM_LIST,A.FETCH_ALBUM_LIST]}),m(!0,"album"),r.fetchAllAlbums(i.uId)}var I,A=g.SYSTEM.IMAGE;t.profileObj=o.getUser(i.uId),t.showAlbumPreview=!0,t.activeAlbum=null,t.state=r.state,t.albums=r.getAlbums(i.uId),t.loadMoreImage=f,t.deleteImage=p,t.getImageData=E,t.toggleAlbumPreview=T,t.selectPhoto=h,_(),t.$on("$destroy",function(){t.albums.reset(),d.unsubscribe(I)})}r.$inject=["rgScrollbarService","$scope","$rootScope","AlbumFactory","$routeParams","userFactory","fileUploadService","SystemEvents","Auth","$ringbox","Ringalert","$$connector","OPERATION_TYPES"];var i=function(r,i){function o(){r.showAlbumPreview||e.innerHeight+e.scrollY>=t[0].body.offsetHeight&&r.loadMoreImage()}!r.hasOwnProperty("forSelection")||r.forSelection!==!0&&"true"!==r.forSelection?(r.forSelection=!1,e.addEventListener("scroll",o)):(i[0].children[0].children[0].style.overflow="hidden",i[0].children[0].children[0].style.maxHeight=n.viewportsize().y-200+"px"),r.$on("$destroy",function(){e.removeEventListener("scroll",o)}),r.$rgDigest()};return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/photos.html",scope:{forSelection:"@forSelection",$close:"&boxClose"}}}e.module("ringid.directives").directive("rgPhotos",n),n.$inject=["$window","$document","Utils"]}(angular,window),function(e,t){"use strict";!function(){e.module("ringid.directives").directive("rgHref",["$location","$route","$rootScope",function(t,n,r){function i(e,i){var o=/#/g.exec(e);o=o?e.substr(o.index+1):e,t.path()==o&&"true"===i.reloadpage&&n.reload(),r.$coreDigest()}return function(t,n,r){var o;r.$observe("rgHref",function(t){return o&&n.unbind("click",i),t?(o=e.bind(null,i,t,r),n.attr("href",t),void n.bind("click",o)):void n.removeAttr("href")}),t.$on("$destroy",function(){o&&n.unbind("click",o)})}}])}()}(angular,window),function(e,t){"use strict";function n(){return function(e,t,n){if(e){for(var r,i=[],o=new RegExp(t,"i"),a=0;a<e.length;a++){if(i.length>10)return i;r=e[a].value.getLiteUser(),o.test(r.getName())&&-1===n.indexOf(r)&&i.push(r)}return i}}}function r(t,n){return{scope:{filterText:"=",focusFilter:"=",onSelect:"&",onClose:"&",tagItems:"="},templateUrl:function(e,t){return t.templateUrl||"templates/dropdowns/tag-friend-dropdown.html"},compile:function(r,i,o){return{pre:function(r,i,o,a){function s(){r.users=n("userListFilter")(t.friends.all(),r.filterText,r.tagItems),r.activeId>=r.users.length&&(r.activeId=0)}function c(){l||(t.searchContact({schPm:r.filterText},!0).then(function(){r.$rgDigest()}),r.loading=!0,l=!0)}var l=!1;r.users=[],r.$watch(t.friends.length,function(e,t){s(),l&&(r.loading=!1,l=!1)}),r.$watch("filterText",function(e,t){RingLogger.info("newVal : "+e+"   OldValue:  "+t,"FILTER"),s(),l=!1,r.users.length<5&&t.length<e.length&&c()}),r.$watch("users.length",function(e,n){5>e&&n>e&&(r.filterText.length>0?c():t.getContactDetails()),e>5&&!l&&(r.loading=!1)}),r.loading=!!r.users.length,r.choose=function(e,t){r.onSelect()(e,t),s(),r.$rgDigest()},r.close=e.isFunction(r.onClose)?r.onClose():e.noop;var u=!1;r.processKeyup=function(e){if(u)return void e.preventDefault();if(38==e.keyCode||40==e.keyCode){var t=this.selectionStart;this.value=(38==e.keyCode?1:-1)+parseInt(this.value,10),this.selectionStart=t,this.selectionEnd=t,u=!0,setTimeout(function(){u=!1},1),e.preventDefault()}},r.activeId=0,r.setActiveId=function(e){r.activeId=e},i.bind("keydown",function(e,t){t=t||e.which||e.keyCode||e.key,13===t?r.users.length&&(r.choose(r.users[r.activeId],e),r.filterText=""):38===t?r.activeId=Math.max(r.activeId-1,0):40===t&&(r.activeId=Math.min(r.activeId+1,r.users.length-1)),RingLogger.info("keup from dropdown : "+t,"FILTER"),r.$rgDigest()}),i.bind("mouseleave",function(){r.activeId=0})},post:function(e,t,n,r){t.on("click",function(e){e.stopPropagation()}),e.$rgDigest()}}}}}e.module("ringid.directives").filter("userListFilter",n).directive("rgFriendDropdown",r),r.$inject=["friendsFactory","$filter"]}(angular,window),function(e,t){
"use strict";function n(n,r,i,o){e.element(document.querySelector("body"));return{scope:!0,link:function(r,o,a){function s(n){function s(){E&&c&&(c.off("mouseenter",l),c.off("mouseleave",u),c.remove(),c=void 0),E=!1}function l(){E=!1}function u(){E=!0,s()}function d(t){E||(c||(c=e.element('<div class="fr-menu"></div>'),c.html(n),o.after(c)),a.onHoverStart&&"function"==typeof r[a.onHoverStart]&&r[a.onHoverStart](),i(c)(r),c.css({display:"block"}),c.on("mouseleave",u),c.on("mouseenter",l),r.$rgDigest())}function g(e){E=!0,t.setTimeout(s,500),t.clearTimeout(f),f=!1,o.off("mouseleave",g)}function m(e){f||(f=t.setTimeout(d.bind(this,e),1200)),o.on("mouseleave",g)}var f,E=!1;o.on("mouseenter",m),r.$on("$destroy",function(){g(),o.off("mouseenter",d),o.off("mouseleave",g)})}var c;"false"!==a.rgHovercard&&n.get(a.hoverTemplateUrl).success(function(e){s(e)}),"false"!==a.rgHovercard&&n.get(a.hoverTemplateUrl).success(function(e){s(e)}),RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from rgHovercard",RingLogger.tags.DIGEST)})}}}e.module("ringid.directives").directive("rgHovercard",n),n.$inject=["$ringhttp","$templateCache","$compile","$window"]}(angular,window),function(e,t){"use strict";function n(e,t){return{restrict:"A",scope:{onSelect:"&",tagItems:"="},link:function(n,r,i){function o(e){e.preventDefault(),n.active?(n.close(e),t.off("click",a)):(n.init(e),t.on("click",a))}function a(e){e.target!=r[0]&&e.target.parentNode!=r[0]&&null!=e.target.parentNode&&e.target.parentNode.parentNode!=r[0]&&"pt-top"!=e.target.className&&n.close(e)}if("false"===i.rgTagFriend)return void r.parent().remove();var s;n.active=!1,n.filterText="",n.init=function(t,i){s||(s=e('<rg-friend-dropdown tag-items="tagItems" filter-text="filterText" focus-filter="active" on-close="close" on-select="choose"></rg-friend-dropdown>')(n),r.after(s)),n.active=!0},n.choose=function(e,t){n.onSelect({item:e}),n.filterText="",n.$parent&&1!==n.$parent.$id?n.$parent.$rgDigest():$scope.$rgDigest()},r.on("click",o),n.close=function(e){n.active&&(s.off("keydown"),s.remove(),s=void 0,n.active=!1)},RingLogger.tags.DIGEST&&n.$watch(function(){RingLogger.info("from rgTagFriendDirective",RingLogger.tags.DIGEST)}),n.$on("$destroy",function(){r.off("click",o),t.off("click",a),s&&(s=void 0)})}}}e.module("ringid.directives").directive("rgTagFriend",n),n.$inject=["$compile","$document"]}(angular,window),function(e,t){"use strict";function n(){return{restrict:"A",controller:["$element",function(e){this.setPopupStyle=function(t,n){e[0].style.height=t+"px",e[0].style.width=n+"px"}}]}}function r(e,t){return{restrict:"A",require:"^rgImgChange",scope:{rgImgObj:"="},link:function(n,r,i,o){function a(e,t){e>f||t>m?t/m>=e/f?(E=m,p=Math.floor(m/t*e)):(p=f,E=Math.floor(f/e*t)):(p=e,E=t),T[0].style.width=E+"px",T[0].style.height=p+"px",l>E&&(E=l),u>p&&(p=u),RingLogger.information("imgW: "+t+" resizedW: "+E+" maxW: "+m,RingLogger.tags.IMAGE),RingLogger.information("imgH: "+e+"resizedH: "+p+" maxH: "+f,RingLogger.tags.IMAGE),l>E&&(E=l),u>p&&(p=u),E=E+d+g,p+=g,"false"==i.commentsection&&(E-=300),o.setPopupStyle(p,E)}var s=500,c=500,l=0,u=0,d=300,g=60,m=0,f=0,E=0,p=0,T=e('<img src="'+n.rgImgObj.src()+'" />')(n);m=t.viewport.x-40-d-g,f=t.viewport.y-40-g,l=m-c>c?m-c:c,u=f-s>s?f-s:s,r.append(T),i.$observe("rgImg",function(e){T[0].setAttribute("src",""),T[0].setAttribute("src",e),a(n.rgImgObj.getIh(),n.rgImgObj.getIw())})}}}e.module("ringid.directives").directive("rgImg",r).directive("rgImgChange",n),r.$inject=["$compile","Utils"]}(angular,window),function(e,t){"use strict";function n(){return{restrict:"A",link:function(e,t,n){n.rgSrc&&e.$watch(n.rgSrc,function(e){null===e||void 0===e?t.removeAttr("src"):t.attr("src",e)})}}}e.module("ringid.directives").directive("rgSrc",n)}(angular,window),function(e,t){"use strict";function n(t,n,r,i){function o(o,a){return function(o,a,s,c,l){function u(t){var s,c,u,d,g,f,E,_,I,A=t.length,v=a[0],S=Object.create(null);for(n.$$postDigest(function(){var e,n,r;for(e=0;e<t.length;e++)n=t[e],p[n.$TrackID]&&(r=p[n.$TrackID],r.childHead&&(r.scope.$$childHead=r.childHead))}),s=0;A>s;s++)u=t[s],E={},E[m]=u,g=h(o,E),p[g]?(f=p[g],delete p[g]):(d=o.$new(),d[m]=u,f={},f.clone=null,f.scope=d),t[s].$TrackID=g,S[g]=f;for(g in p)if(p[g]){for(f=p[g],c=0;c<f.clone.length;c++)v.parentNode.removeChild(f.clone[c]);f.scope.$destroy()}for(s=0;A>s;s++)u=t[s],g=u.$TrackID,f=S[g],f.scope.$index=s,I=f.clone,I?(_=v,f.startNode!=_&&r.move(f.clone,null,e.element(v)),v=f.clone[f.clone.length-1],f.childHead=f.scope.$$childHead,f.scope.$$childHead=null):l(f.scope,function(t){var n=T.cloneNode(!1);t[t.length++]=n,r.enter(t,null,e.element(v)),v=n,f.clone=t,f.startNode=t[0]});o.target&&o.target.getMapKey&&o.$emit(i.FEED.HEIGHT,o.target.getMapKey()),p=S}var d,g,m,f=s.rgRepeat,E=f.match(/^\s*(.+)\s+in\s+(.*?)\s+track\s+by\s+(.+)\s*$/),p=Object.create(null);if(!E)throw"Expected expression in form of '_item_ in _collection track by _key_'";var T=document.createComment(" end rgRepeat: "+f+" ");d=E[1],g=E[2];var h=t(E[3]);m=E[1],o.$watchCollection(g,u)}}return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:o}}e.module("ringid.directives").directive("rgRepeat",n),n.$inject=["$parse","$rootScope","$animate","SystemEvents"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){function i(i){var o=t.defer();if(!i||"string"!=typeof i)throw new Error("PARAMS_ERROR SPAM_TYPE Must be string");var a=r[i.toUpperCase()];return c[a]?setTimeout(function(){o.resolve(c[a])}):e.pull({actn:s.ACTION_SPAM_REASON_LIST,spmt:a},n.SYSTEM.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?(c[a]=e.rsnLst,o.resolve(c[a])):o.reject(e)},function(e){o.reject(e)}),o.promise}function o(t){if(!t.spmt||!t.spmid||!t.rsnid)throw new Error("PARAMS_ERROR");var i={actn:s.ACTION_REPORT_SPAM,spmt:r[t.spmt],spmid:t.spmid,rsnid:t.rsnid};return e.request(i,n.SYSTEM.REQUEST_TYPE.UPDATE)}var a,s=n.SYSTEM.REPORT,c={};return a={getSpamReasonList:i,reportSpam:o}}function r(e,t,n,r){e.title="Let us know why that's bothers you !",e.spamList=t,e.reason=e.spamList[0].id,RingLogger.print(t,RingLogger.tags.rgReport),RingLogger.tags.DIGEST&&e.$watch(function(){RingLogger.info("from ReportController",RingLogger.tags.DIGEST)}),e.report=function(){return RingLogger.print(e.reason,RingLogger.tags.rgReport),e.reason?void n.reportSpam({spmt:e.spamType.toUpperCase(),spmid:e.spamId,rsnid:e.reason}).then(function(t){if(RingLogger.print(t,RingLogger.tags.rgReport),e.$close(),t.sucs){var n={title:"Done!",message:t.mg,showCancel:!1};r.alert(n)}else r.show(t,"error")}):void(e.error="Please choose one reason")}}function i(e,t,n,r){return{restrict:"EA",scope:{spamId:"=",spamType:"@"},link:function(r,i,o){function a(i){RingLogger.print("clicked rgReport",RingLogger.tags.rgReport),n.close(i);var o=e.open({type:"remote",scope:r,controller:"ReportController",resolve:{remoteData:t.getSpamReasonList(r.spamType)},templateUrl:"templates/popups/rg-report.html"});o.result.then(function(e){})}i.on("click",a),RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from rgReport",RingLogger.tags.DIGEST)}),r.$on("$destroy",function(){i.off("click",a)})}}}e.module("ringid.directives").factory("ReportHttpService",n).controller("ReportController",r).directive("rgReport",i),n.$inject=["$$connector","$$q","OPERATION_TYPES","SPAM_TYPES"],r.$inject=["$scope","remoteData","ReportHttpService","Ringalert"],i.$inject=["$ringbox","ReportHttpService","rgDropdownService","SPAM_TYPES"]}(angular,window),function(e,t){"use strict";e.module("ringid.notification",["ringid.config","ringid.directives"])}(angular,window),function(e,t){"use strict";function n(t,n,r){function i(e){function t(){var t=e.uIdList.length-1;return t>1?" and "+t+" others ":1===t?" and "+t+" other ":""}var n="",r={message:"",popupType:"",mayMerge:1};switch(e.mt){case a.MSG_TYPE_UPDATE_PROFILE_IMAGE:r.message=" changed profile photo",r.popupType="image",r.mayMerge=2;break;case a.MSG_TYPE_UPDATE_COVER_IMAGE:r.message=" changed cover photo",r.popupType="image",r.mayMerge=2;break;case a.MSG_TYPE_LIKE_IMAGE:r.message=t()+" liked your photo",r.popupType="image";break;case a.MSG_TYPE_IMAGE_COMMENT:r.message=t()+" commented on your photo",r.popupType="image";break;case a.MSG_TYPE_LIKE_IMAGE_COMMENT:r.message=t()+" liked your comment",r.popupType="image";break;case a.MSG_TYPE_ADD_FRIEND:r.message=" wants to be friends with you",r.popupType="profile";break;case a.MSG_TYPE_ACCEPT_FRIEND:r.message=" has accepted your friend request",r.popupType="profile";break;case a.MSG_TYPE_ADD_GROUP_MEMBER:r.message=" has added you in a group "+n,r.popupType="group",r.mayMerge=0;break;case a.MSG_TYPE_ADD_STATUS_COMMENT:r.message=t()+" commented on your post",r.popupType="feed";break;case a.MSG_TYPE_LIKE_STATUS:r.message=t()+" liked your post",r.popupType="feed";break;case a.MSG_TYPE_LIKE_COMMENT:r.message=t()+" liked your comment",r.popupType="feed";break;case a.MSG_TYPE_SHARE_STATUS:r.message=t()+" shared your post",r.popupType="feed";break;case a.MSG_TYPE_LIKE_AUDIO_MEDIA:r.message=t()+" liked your music",r.popupType="media";break;case a.MSG_TYPE_AUDIO_MEDIA_COMMENT:r.message=t()+" commented on your music",r.popupType="media";break;case a.MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:r.message=t()+" liked your comment",r.popupType="media";break;case a.MSG_TYPE_AUDIO_MEDIA_VIEW:r.message=t()+" viewed your music",r.popupType="media";break;case a.MSG_TYPE_LIKE_VIDEO_MEDIA:r.message=t()+" liked your video",r.popupType="media";break;case a.MSG_TYPE_VIDEO_MEDIA_COMMENT:r.message=t()+" commented on your video",r.popupType="media";break;case a.MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:r.message=t()+" liked your comment",r.popupType="media";break;case a.MSG_TYPE_VIDEO_MEDIA_VIEW:r.message=t()+" viewed you video",r.popupType="media";break;case a.MSG_TYPE_YOU_HAVE_BEEN_TAGGED:r.message=" tagged you in a status",r.popupType="feed";break;default:r.popupType="nomatch",r.mayMerge=0}return r}function o(e){this.updateNoti(e),e=null}var a=t.SYSTEM.NOTIFICATION,s={acId:0,cmnId:0,fndId:0,fndN:"",id:0,imgId:0,loc:0,mt:0,nfId:0,ut:0,nt:0,prIm:0,message:"",updateTime:"",popupType:"",groupId:0,user:null,seen:!1,mayMerge:1,othersCounter:0};return o.prototype={updateNoti:function(t){var r;e.isObject(t)?(this.noti?e.extend(this.noti,t):(this.noti=e.extend({},s,t),this.noti.uIdList=[]),this.noti.updateTime=n.verbalDate(this.noti.ut)||this.noti.ut,r=i(this.noti),this.noti.message=r.message,this.noti.popupType=r.popupType,this.noti.mayMerge=r.mayMerge,this.noti.fndId&&this.noti.uIdList.push(this.noti.fndId)):(RingLogger.warn("not valid json object noti",RingLogger.tags.NOTIFICATION),RingLogger.print(t,RingLogger.tags.MEDIA)),t=null},sortBy:function(){return this.noti.ut},getName:function(){return this.noti.fndN},isInUidList:function(e){return this.noti.uIdList.indexOf(e)>-1},uIdList:function(e){if(!e||!e.length)return this.noti.uIdList;for(var t=0;t<e.length;t++)-1===this.noti.uIdList.indexOf(e[t])&&this.noti.uIdList.push(e[t])},getUid:function(){return this.noti.fndId},getUserAvatar:function(){if(this.noti.user)return this.noti.user.avatar("thumb");if(this.noti.prIm){var e=this.noti.prIm.lastIndexOf("/")+1;return[r.imBase,this.noti.prIm.slice(0,e),"pthumb",this.noti.prIm.slice(e)].join("")}return"images/prof.png"},getMessage:function(){return this.noti.message},getTime:function(e){return e?this.noti.ut:this.noti.updateTime},updateNotiTime:function(){this.noti.updateTime=n.verbalDate(this.noti.ut)},getKey:function(){return this.noti.id},getPopupType:function(){return this.noti.popupType},getMessageType:function(){return this.noti.mt},getNotiType:function(){return this.noti.nt},getActivityId:function(){return this.noti.acId},getNewsFeedId:function(){return this.noti.nfId},getLink:function(){var e="",t={};switch(this.noti.popupType){case"image":t.mediaId=this.noti.imgId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=n.getRingRoute("SINGLE_IMAGE",t);break;case"media":t.mediaId=this.noti.imgId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=n.getRingRoute("SINGLE_MEDIA",t);break;case"profile":e=n.getRingRoute("USER_PROFILE",{uId:this.noti.fndId});break;case"group":e=n.getRingRoute("CIRCLE_HOME",{circleId:this.noti.acId});break;case"feed":t.feedId=this.noti.nfId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=n.getRingRoute("SINGLE_FEED",t);break;default:e=""}return e},getImgId:function(){return this.noti.imgId},getCommentId:function(){return this.noti.cmnId},getSeenStatus:function(){return this.noti.seen},updateSeenStatus:function(e){this.noti.seen=e},canMerge:function(){return this.noti.mayMerge},setNotiMessage:function(e){this.noti.othersCounter+=e;var t=i(this.noti);this.noti.message=t.message},getRingboxTemplate:function(){var e="";switch(this.noti.popupType){case"image":e="templates/partials/notification/image-popup.html";break;case"media":e="templates/partials/notification/media-popup.html";break;case"feed":e="templates/partials/notification/feed-popup_with_image.html";break;default:e=""}return e},getControllerName:function(){return"image"===this.noti.popupType&&"RingBoxImageController"||"feed"===this.noti.popupType&&"NotiPopupController"||"media"===this.noti.popupType&&"RingBoxMediaController"},showRingbox:function(){return"feed"===this.noti.popupType||"image"===this.noti.popupType||"media"===this.noti.popupType}},function(e){return new o(e)}}e.module("ringid.notification").factory("$$notiMap",n),n.$inject=["OPERATION_TYPES","Utils","settings"]}(angular,window),function(e,t){"use strict";function n(t,n,r){var i=this,o=r.SYSTEM.NOTIFICATION,a=r.SYSTEM.REQUEST_TYPE;i.requestNotification=function(n){var r={actn:o.TYPE_MY_NOTIFICATIONS};n&&n.from_index>0&&(r=e.extend({},r,n)),t.send(r,a.REQUEST)},i.clearNotiCount=function(){var e=new Date,n=e.getTime(),r={actn:o.CLEAR_NOTIFICATION_COUNTER,ut:n};return t.request(r,a.REQUEST)},i.getNotificationDetails=function(e){var n={actn:r.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e.activityId};return t.request(n,a.REQUEST)},i.getImageAlbumDetails=function(e){var n={actn:r.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,request_type:a.REQUEST,imgId:e.imgId};return t.request(n,a.REQUEST)}}e.module("ringid.notification").service("notificationHttpService",n),n.$inject=["$$connector","settings","OPERATION_TYPES"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s,c,l){function u(t){g&&!t||(g=!0,e.subscribe(h,{action:[m.TYPE_MY_NOTIFICATIONS,m.TYPE_SINGLE_NOTIFICATION]}),_())}var d=i.createNew(!0,"desc"),g=!1,m=a.SYSTEM.NOTIFICATION,f=0,E=0,p=-1,T={loading:!1,noMoreData:!1},h=function(e){function t(e){function t(t){e.value.getTime(!0)<r.getTime(!0)?(E=E>0?E-1:0,r.uIdList(e.value.uIdList()),r.setNotiMessage(),d.remove(e.value.getKey())):(i=!1,e.value.uIdList(r.uIdList()),e.value.setNotiMessage())}if(e.value.getMessageType()===r.getMessageType())if(1===e.value.canMerge())switch(e.value.getPopupType()){case"feed":e.value.getNewsFeedId()===r.getNewsFeedId()&&t(e.value.isInUidList(r.getUid())?!1:!0);break;case"image":case"media":e.value.getImgId()===r.getImgId()&&t(e.value.isInUidList(r.getUid())?!1:!0)}else 2===e.value.canMerge()&&e.value.getUid()===r.getUid()&&t(!1)}var r,i=!0;switch(e.actn){case m.TYPE_MY_NOTIFICATIONS:if(e.sucs===!0||"true"===e.sucs){var a=[];f+=e.nList.length;var s=parseInt(n.getData("oldNotiCount"));RingLogger.information("CURRENT oldNotiCount="+s+" totalNewNoti="+e.tn,RingLogger.tags.NOTIFICATION),s>e.tn?(E=e.tn,n.setData("oldNotiCount",0)):E=e.tn-s,RingLogger.information("MODIFIED notiCounter="+E,RingLogger.tags.NOTIFICATION);for(var c=0;c<e.nList.length;c++){i=!0,r=o(e.nList[c]),d.all().forEach(t),a.push(e.nList[c].ut);var l=n.getData("notiseen");if(i){for(var u=0;u<l.length;u++)l[u]===e.nList[c].id&&r.updateSeenStatus(!0);d.save(r.getKey(),r)}}var g=a.sort();p=g[0]||p}else e.sucs===!1&&1111===e.rc?(RingLogger.warning("Notification list request REPEAT",RingLogger.tags.NOTIFICATION),_()):(T.noMoreData=!0,RingLogger.warning("Notification list request failed",RingLogger.tags.NOTIFICATION));break;case m.TYPE_SINGLE_NOTIFICATION:f++,i=!0,r=o(e),d.all().forEach(t),i&&d.save(r.getKey(),r),E++}},_=function(e){e=e||10;var t={from_index:f>0?f:0,to_index:f>0?f+e:e,scl:2,ut:p};r.requestNotification(t)};return{init:u,state:T,loadMoreNoti:_,process:h,getNotifications:function(){return d},getNotification:function(e){return d.get(e)},clearCounter:function(){E>0&&(n.setData("oldNotiCount",E+parseInt(n.getData("oldNotiCount"))),RingLogger.information("Setting oldNotiCount in localStorage="+n.getData("oldNotiCount"),RingLogger.tags.NOTIFICATION),E=0);for(var e=0;e<d.length();e++){var t=Date.now()-d.all()[e].value.sortBy();36e5>t&&d.all()[e].value.updateNotiTime()}},getNotiCount:function(){return E>99?"99+":E}}}e.module("ringid.notification").factory("NotificationFactory",n),n.$inject=["$$connector","$q","Storage","notificationHttpService","$$stackedMap","$$notiMap","OPERATION_TYPES","$rootScope","SystemEvents","Auth"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){function i(e,t,n,r,i,o,a,s,c,l,u,d,g,m){function f(e){switch(e.value.getPopupType()){case"image":return E({action:"image",noti:e.value,nfId:e.value.getNewsFeedId(),imgId:e.value.getImgId(),templateType:"image"});case"media":return E({action:"media",noti:e.value,nfId:e.value.getNewsFeedId(),mediaId:e.value.getImgId(),templateType:"media"});case"feed":return E({action:"ringbox",nfId:e.value.getNewsFeedId(),noti:e.value,templateType:"feed_with_text"})}}function E(e){var i=a.getData("notiseen");switch(i||(i=[],a.setData("notiseen",i)),-1===i.indexOf(e.noti.getKey())&&(i.push(e.noti.getKey()),e.noti.updateSeenStatus(!0),i.length>150&&i.shift()),a.setData("notiseen",i),e.action){case"redirect":if(circle){var s=e.link.slice(1);t.path(s)}else o.show("Circle does not exist!","error");break;case"ringbox":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,templateType:e.templateType}},promise:d.getNotificationDetails({activityId:e.nfId})};case"media":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,mediaId:e.mediaId,popupFrom:"notification",templateType:e.templateType}},promise:m.media.fetchDetails({cntntId:e.mediaId,utId:r.currentUser().getUtId()})};case"image":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,imgId:e.imgId,popupFrom:"notification",templateType:e.templateType}},promise:n.getImageDetails(e.imgId,e.nfId)}}}function p(e){s.state.loading=e,e||(c.recalculate(s),s.$emit(g.FEED.HEIGHT)),s.$rgDigest()}function T(){s.state.loading||s.state.noMoreData||(p(!0),e.loadMoreNoti(_))}var h,_=parseInt(s.loadCount),I=l.SYSTEM.NOTIFICATION;s.state=e.state,s.notifications=e.getNotifications(),s.loadMoreNotification=T,s.getRingboxData=f,s.notificationAction=e.notificationAction,_>20&&s.$emit(g.FEED.HEIGHT),s.notifications.length()<_&&T();var A=u.subscribe(function(){h||(h=setTimeout(function(){h=null,p(!1)},200))},{action:[I.TYPE_MY_NOTIFICATIONS,I.TYPE_SINGLE_NOTIFICATION]});s.$on("$destroy",function(){u.unsubscribe(A)})}function o(e,t,i){var o=i.templateUrl?i.templateUrl:"templates/dropdowns/notification-dropdown.html";n.get(o).success(function(n){t.append(r(n)(e)),e.$rgDigest()})}return i.$inject=["NotificationFactory","$location","AlbumFactory","Auth","rgDropdownService","Ringalert","Storage","$scope","rgScrollbarService","OPERATION_TYPES","$$connector","notificationHttpService","SystemEvents","Api"],{restrict:"AE",controller:i,scope:{loadCount:"@",templateUrl:"@"},link:o}}e.module("ringid.notification").directive("rgNotification",n),n.$inject=["$window","$document","$ringhttp","$compile"]}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c,l,u,d,g){function m(e,t){return t||(t=i.feed),{data:function(){return{media:e,album:t.getAlbum(),feedTime:t.time()}},promise:e.fetchDetails()}}var f=(n.SYSTEM,n.SYSTEM.NOTIFICATION,!0);if(i.currentUser=r.currentUser(),i.feed={},i.focused=!1,i.showCommentBox=!0,i.showFeedFullContent=!0,i.nocontent=!1,i.ddHtml="templates/dropdowns/feed-edit-dropdown.html",i.getMediaData=m,o&&o.notiKey&&(i.key=o.notiKey,i.noti=o.noti,i.templateType=o.templateType),i.boxIsLoading=!1,a.sucs===!1)return i.nocontent=!0,d.show(a,"error"),i.$close(),!1;var E=e.fromJson(a.newsFeedList);if(f&&E[0]&&E[0].orgFd){i.feed=c.create(E[0]);var p=c.create(E[0].orgFd);i.feed.shares(p)}else i.feed=c.create(a.newsFeedList[0]);i.keyid=i.feed&&i.feed.getKey(),(i.feed.hasMedia()||i.feed.hasSharedFeed()&&i.feed.getOrginalFeed().getImages().length)&&(i.templateType="feed_with_image"),i.noti.getCommentId()>0&&(i.activeCommentId=i.noti.getCommentId()),i.shareMenuDisabled=i.shareMenuDisabled?i.shareMenuDisabled:!1;i.toggleCommentBox=function(e){e.stopPropagation(),i.showCommentBox=!i.showCommentBox,i.showCommentBox&&(i.showShareBox=!1)},i.toggleShareBox=function(e){e.stopPropagation();var t=i.feed.hasSharedFeed()?i.feed.getOrginalFeed():i.feed,n=t.isShareAble(!0);n.sucs?(i.showShareBox=!i.showShareBox,i.showShareBox&&(i.showCommentBox=!1)):d.show(g[n.rc],"warning")},i.getImageData=function(e,t){return function(){return{image:e,feed:t}}}}e.module("ringid.notification").controller("NotiPopupController",n),n.$inject=["$$connector","OPERATION_TYPES","Auth","$scope","localData","remoteData","NotificationFactory","$$feedMap","feedFactory","rgDropdownService","Ringalert","MESSAGES"]}(angular,window),function(e,t){"use strict";e.module("ringid.notification").controller("ImageController",["$routeParams","$scope","Auth","$$imageMap","$$stackedMap","AlbumFactory","$$connector","OPERATION_TYPES",function(t,n,r,i,o,a,s,c){function l(){return n.image&&n.image.getLikes()>0}function u(e){"next"===e?"profile"===n.params.popupFrom?T.previous(n.image.getKey())?n.image=T.next(n.image.getKey())||T.bottom():a.loadMoreImage(n.image.getAlbumId(),t.uId):n.image=T.next(n.image.getKey())||T.bottom():n.image=T.previous(n.image.getKey())||T.top(),m(e),n.$rgDigest()}function d(e){if(e)a.getFeedImages(e).then(function(e){if(e.sucs===!0){for(var t,r=e.newsFeedList[0].imageList,o=0,a=r.length;a>o;o++)r[o].nfId=e.nfId,r[o].imgId===n.image.getKey()?(n.image.updateImage(r[o]),T.save(n.image.getKey(),n.image)):(t=i(r[o],n.feed.user()),T.save(t.getKey(),t));g()}});else{var r=a.getAlbums(t.uId);T=r.get(n.image.getAlbumId()).getImages(),g()}}function g(){T.length()>1&&(n.nextImg=!!T.next(n.image.getKey())||!!T.bottom(),n.prevImg=!!T.previous(n.image.getKey())||!!T.top()),n.$rgDigest()}function m(e){var t,r=new Image;t="next"===e?T.next(n.image.getKey()):T.previous(n.image.getKey()),setTimeout(function(){r.src=t?t.src():""},200)}function f(){p=s.subscribe(function(e){n.image&&n.image.getKey()===e.imgId&&(n.image.setTotalComment(e.loc),n.$rgDigest())},{action:[h.TYPE_UPDATE_ADD_IMAGE_COMMENT,h.TYPE_UPDATE_DELETE_IMAGE_COMMENT]}),E=s.subscribe(function(e){e.sucs===!0&&(T=a.getAlbums(t.uId).get(n.image.getAlbumId()).getImages(),n.image=T.next(n.image.getKey())||T.bottom(),n.$rgDigest())},{action:[h.TYPE_ALBUM_IMAGES,h.TYPE_FRIEND_ALBUM_IMAGES]}),n.params.image?n.image=n.params.image:n.params.imgId&&(n.remoteData?n.image=n.remoteData:a.getImageDetails(n.params.imgId).then(function(e){n.image=e,n.$rgDigest()})),n.params.feed&&(n.feed=n.params.feed,d(n.feed.getKey())),"profile"===n.params.popupFrom&&d(),n.$rgDigest()}var E,p,T=o.createNew(),h=c.SYSTEM.IMAGE;n.showCommentBox=!0,n.nextImg=!1,n.prevImg=!1,n.changeImage=u,n.openRingboxLike=l,n.actionImageDropdown=e.noop,n.showOption=function(){return n.image.ddControl.showReportButton()},n.ddTemplate='<div class="ng-cloak action-top feed-drop_top float-right"><div class="ac-top-line" ng-if="ddControl.showReportButton()"><span class="report-ico"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div>',"</div>",f(),n.$on("$destroy",function(){p&&s.unsubscribe(p),s.unsubscribe(E)})}])}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c,l,u,d,g,m){function f(){i.media.increaseView().then(function(){i.$rgDigest()},function(){i.$rgDigest()})}function E(e){return{data:function(){return{media:e}}}}function p(e){i.media=e,i.media.fetchDetails(),f(),i.$rgDigest()}var T,h=l.SYSTEM.MEDIA;i.currentUser=o.currentUser(),i.showCommentBox=!0,i.changeMedia=p,i.actionImageDropdown=e.noop,i.showOptionMenu=function(){return i.media.ddControl.showReportButton()||i.media.ddControl.showAddToAlbum()},i.ddTemplate='<div class="ng-cloak action-top vp-position float-right"><div class="ac-top-line" ng-if="ddControl.showReportButton()"><span class="report-ico"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div><div class="ac-top-line" ng-if="ddControl.showAddToAlbum()"><span class="share-ico"></span><a rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true"ringbox-type="remote" ringbox-target="templates/dropdowns/popup-album-dropdown.html" ringbox-data="ddControl.getRingboxData()">Add to Album</a></div> </div>',i.params&&"notification"===i.params.popupFrom?i.remoteData&&i.remoteData.sucs?(i.media=m(i.remoteData.mdaCntntDTO),i.album=s.getAlbum(i.media.getAlbumId())):i.$close():(i.media=i.params.media,i.playlist=i.params.playlist),i.media&&!i.media.owner().hasDetails()&&i.media.owner().requestUserDetails().then(function(){i.$rgDigest()}),i.selectAlbum=E,i.shareMedia=function(){var e=g.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:i.media},onBackDropClickClose:!0,templateUrl:"templates/home/share-media.html"});e.result.then(function(){i.$rgDigest()})},T=c.subscribe(function(e){i.media&&i.media.getKey()===e.cntntId&&i.media.setTotalComment(e.loc)},{action:[h.ACTION_UPDATE_ADD_MEDIA_COMMENT,h.ACTION_UPDATE_DELETE_MEDIA_COMMENT]}),i.$on("$destroy",function(){T&&c.unsubscribe(T)})}e.module("ringid.notification").controller("MediaController",n),n.$inject=["APP_CONSTANTS","fileUploadService","$routeParams","$scope","Auth","rgDropdownService","Media","$$connector","OPERATION_TYPES","Ringalert","feedFactory","$ringbox","$$mediaMap"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o){e.close=t.close,r&&r.imgId&&(e.templateType=r.templateType),e.params=r,e.remoteData=i,r.noti&&r.noti.getCommentId()>0&&(e.activeCommentId=r.noti.getCommentId()),n("ImageController",{$scope:e})}e.module("ringid.notification").controller("RingBoxImageController",n),n.$inject=["$scope","$boxInstance","$controller","localData","remoteData","feedFactory"]}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a){function s(){t.destroyPlayer(),n.close()}t.close=s,RingLogger.log(o,RingLogger.tags.MEDIA),i&&i.mediaId&&(t.templateType=i.templateType),RingLogger.information(i,RingLogger.tags.MEDIA),t.params=i,t.remoteData=o,r("MediaController",{$scope:t}),t.destroyPlayer=e.noop}e.module("ringid.notification").controller("RingBoxMediaController",n),n.$inject=["$scope","$boxInstance","$controller","localData","remoteData","Media"]}(angular,window),function(e,t){"use strict";e.module("ringid.friend",["ringid.config","ringid.shared"])}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c){function l(e,n,r,o,a,s,c,l,u,d,g,m){function f(t){e.showMutual=!!t,e.showMutual&&p(),e.$rgDigest()}function E(n){e.showPending=!!n,e.showPending?(e.friends=t.getFriends("outgoing"),T(!0),t.getContactDetails("outgoing").then(function(){T(!1)},function(){T(!1)})):e.friends=t.getFriends(e.rgFriendsType),e.$rgDigest()}function p(){var n;R.length>0&&(T(!0),t.getContactDetailsByUtIds(R.splice(0,10),!0).then(function(t){if(t.sucs===!0)for(var r=0;r<t.contacts.length;r++)n=s.create(t.contacts[r]),e.friends.save(n.getKey(),n);T(!1)},function(e){e.sucs===!1&&1111===e.rc?(RingLogger.warning("MUTUAL FRIEND FETCH REPEAT",RingLogger.tags.FRIEND),p()):(T(!1),RingLogger.warning("MUTUAL FRIEND FETCH FAILED",RingLogger.tags.FRIEND))}))}function T(t){e.state.loading=!!t,t||o.recalculate(e),e.state.loading||(e.state.noData=0===e.friends.length()&&0===a.utIds().length()),e.$rgDigest()}function h(){("friends"===e.rgFriendsType||"friendslist"===e.rgFriendsType)&&e.friendName&&e.friendName.length>0&&(T(!0),t.searchContact({schPm:e.friendName},!0).then(function(){T(!1)},function(){T(!1)}))}function _(n){var r,i;e.showMutual?p():e.showPending?(T(!0),t.getContactDetails("outgoing").then(function(){T(!1)},function(){T(!1)})):(n||!e.state.loading&&e.friends.length()!==e.totalFriends(e.rgFriendsType))&&(T(!0),"userfriends"===e.rgFriendsType?(r=t.getUserContacts,i=e.profileObj.getUtId()):r=t.getContactDetails,r(i).then(function(){e.friends.length()<20&&e.friends.length()<e.totalFriends(e.rgFriendsType)?(RingLogger.warning("NEED TO PULL MORE FRIENDS",RingLogger.tags.FRIEND),T(!1),_()):T(!1)},function(t){t.sucs===!1&&1111===t.rc?_(n):"friendslist"===e.rgFriendsType?5>N?(N++,setTimeout(function(){_(n)},2e3)):T(!1):(T(!1),RingLogger.alert("friend Details fetch fail, RETRYING",RingLogger.tags.FRIEND))}))}function I(e){return{data:function(){return{target:e}},promise:m.user.getMutualFriends(e)}}function A(){e.ddTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event: $event})" href="#"> <span class="img_sprite w-h-13 icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" class="border-0" href="#"><span class="img_sprite w-h-13 icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" class="border-0" href="#"><span class="img_sprite w-h-13 icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a></div>',e.ddAction=function(n){n.friend.isLoading()||(t.friendAction(n,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),l.close(n.event))},e.showBackKey=0,e.showBack=function(t,n){var r=n.target.getAttribute("data-is-anchor");r||(e.showBackKey=t,n.preventDefault(),n.stopPropagation(),e.$rgDigest())}}function v(){switch(C=u.subscribe(function(t){switch(t.actn){case D.TYPE_CONTACT_UTIDS:"friends"!==e.rgFriendsType&&"friendslist"!==e.rgFriendsType||!M||(M=!1,setTimeout(function(){a.utIds().length()>0&&e.friends.length()<20&&_(!0),e.state.noData=0===e.friends.length()&&0===a.utIds().length()},1e3));break;default:T(!1)}},{action:[D.TYPE_CONTACT_UTIDS,D.TYPE_UPDATE_ADD_FRIEND,D.TYPE_UPDATE_DELETE_FRIEND],callWithUnresolved:!0}),e.rgFriendsType){case"friendslist":break;case"friends":t.initFriends(),e.isOwner=!0,e.pendingRequests=t.getFriends("outgoing"),A(),S=setTimeout(e.toggleLoading,6e4);break;case"userfriends":A(),e.totalUserFriends=t.totalUserFriends,e.profileObj=s.getUser(i.uId),_(!0),m.user.getMutualFriends(e.profileObj).then(function(t){t.sucs===!0&&(e.profileObj.updateUserObj({nmf:t.mfIDs.length}),R=t.mfIDs,e.$rgDigest())}),S=setTimeout(e.toggleLoading,6e4);break;default:RingLogger.alert("Friend type not found ",RingLogger.tags.FRIEND)}}var S,C,D=d.SYSTEM.FRIENDS,N=0,M=!0,R=[];e.isOwner=!1,e.showMutual=!1,e.showPending=!1,e.friendName="",e.state={loading:!1,noData:!1},e.friends=t.getFriends(e.rgFriendsType),e.totalFriends=t.totalFriends,e.getPendingCount=t.getPendingCount,e.toggleShowMutual=f,e.toggleShowPending=E,e.loadMoreFriends=_,e.getMutualFriend=I,e.searchContact=h,e.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),g.show("Coming soon","info")},v(),e.$on("$destroy",function(){clearTimeout(S),"userfriends"===e.rgFriendsType&&t.resetUserFriends(),u.unsubscribe(C)})}function u(i,l,u){function d(){o.innerHeight+o.scrollY>=a[0].body.offsetHeight&&i.loadMoreFriends()}var g;n.get(u.rgFriendsTpl).success(function(e){l.append(r(e)(i)),i.$rgDigest()}),"friends"!==i.rgFriendsType&&"userfriends"!==i.rgFriendsType||e.element(o).on("scroll",d),
i.$on("$destroy",function(){switch(i.rgFriendsType){case"friends":g=t.outgoingFriends.keys();for(var n=0;n<g.length;n++)s.add("outgoingUtIds",g[n],{frnS:c.INCOMING_FRIEND});t.outgoingFriends.reset();case"userFriends":e.element(o).off("scroll",d)}})}return l.$inject=["$scope","$attrs","$document","rgScrollbarService","Contacts","userFactory","$$stackedMap","rgDropdownService","$$connector","OPERATION_TYPES","Ringalert","Api"],{restrict:"AE",scope:{rgFriendsType:"@"},controller:l,link:u}}e.module("ringid.friend").directive("rgFriends",n),n.$inject=["friendsFactory","$ringhttp","$compile","$routeParams","$window","$document","Contacts","APP_CONSTANTS"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o){function a(t,n,r,i,o,a,s,c,l){function u(n){n.friend.isLoading()||e.friendAction(n,!0).then(function(){t.requests.length()<T&&g(),t.$rgDigest()},function(){t.requests.length()<T&&g(),t.$rgDigest()})}function d(e){t.state.loading=e,e||(t.state.noMoreData=0===i.incomingUtIds().length(),r.recalculate(t),t.$emit(l.FEED.HEIGHT)),t.$rgDigest()}function g(n){(n||!t.state.noMoreData&&!t.state.loading)&&(d(!0),e.getContactDetails("incoming",T).then(function(){d(!1)},function(e){e.sucs===!1&&1111===e.rc?g(!0):(d(!1),RingLogger.warning("No Friend Request:",RingLogger.tags.FRIEND))}))}function m(e){return{data:function(){return{target:e}},promise:n.user.getMutualFriends(e)}}function f(){T>20&&t.$emit(l.FEED.HEIGHT),i.incomingUtIds().length()>0&&t.requests.length()<T&&g(!0),E=a.subscribe(function(e){switch(e.actn){case p.TYPE_CONTACT_UTIDS:i.incomingUtIds().length()>0&&t.requests.length()<T&&g(!0);break;default:d(!1)}},{action:[p.TYPE_CONTACT_UTIDS,p.TYPE_UPDATE_ADD_FRIEND,p.TYPE_UPDATE_DELETE_FRIEND]})}var E,p=o.SYSTEM.FRIENDS,T=parseInt(t.loadCount);t.state={loading:!1,noMoreData:!1},t.requests=e.getFriends("incoming"),t.getRequestCount=e.getRequestCount,t.friendAction=u,t.loadMoreRequests=g,t.getMutualFriend=m,f(),t.$on("$destroy",function(){a.unsubscribe(E)})}function s(e,n,r){var i=r.templateUrl?r.templateUrl:"templates/dropdowns/friend-request-dropdown.html";o.get(i).success(function(r){n.append(t(r)(e)),e.$rgDigest()})}return a.$inject=["$scope","Api","rgScrollbarService","Contacts","OPERATION_TYPES","$$connector","userFactory","Ringalert","SystemEvents"],{restrict:"AE",scope:{loadOnScroll:"@",loadCount:"@",templateUrl:"@"},link:s,controller:a}}e.module("ringid.friend").directive("rgRequests",n),n.$inject=["friendsFactory","$compile","$routeParams","$window","$document","$ringhttp"]}(angular,window),function(e,t){"use strict";e.module("ringid.header",["ringid.config","ringid.auth","ringid.shared","ringid.notification","ringid.friend","ringid.chat"])}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s,c,l,u,d,g){function m(){var t=n.path();"/"===t?e.hideColumn=!1:e.hideColumn=!0}function f(t){h=t&&""!==t?t:"/"===n.path()?"home":"none",e.$rgDigest()}function E(){return h}var p=this,T=o.SYSTEM,h=f();p.getActiveMenu=E,p.logout={ddHtml:"templates/dropdowns/logout-dropdown.html",ddControl:c,ddAction:function(){r.close(),c.logout()},ddOpened:function(){f("logout")},ddBeforeClose:function(){f("")}},p.freq={ddTemplate:'<rg-requests load-on-scroll="true" load-count="10" ></rg-requests>',ddOpened:function(){f("friend_request")},ddBeforeClose:function(){f("")}},p.requestCount=a.getRequestCount,setTimeout(a.initFriends,2e3),p.chatHistory={ddHtml:"templates/partials/chat/chat-history-dropdown.html",ddOpened:function(){u.resetConversationCount(),f("chat_history"),d.triggerCustomEvent(g.CHAT.CONVERSATION_COUNT_RESETED)},ddBeforeClose:function(){f("")}},p.unreadChatConversationCount=u.getUnreadConversationCount,d.onCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){e.$rgDigest()}),p.noti={ddTemplate:'<rg-notification load-count="10" template-url="templates/dropdowns/notification-dropdown.html"></rg-notification>',ddOpened:function(){s.clearCounter(),f("notification")},ddBeforeClose:function(){f("")}},p.notiCount=s.getNotiCount;var _=i.subscribe(function(){setTimeout(function(){e.$rgDigest()},200)},{action:[T.FRIENDS.TYPE_UPDATE_ADD_FRIEND,T.FRIENDS.TYPE_UPDATE_DELETE_FRIEND,T.NOTIFICATION.TYPE_MY_NOTIFICATIONS,T.NOTIFICATION.TYPE_SINGLE_NOTIFICATION]});setTimeout(s.init,5e3),e.hideColumn=!1,t.$on("$routeChangeStart",function(e){m()}),m(),p.defaultSpan=d.getDefaultColumn,t.$on("$routeChangeStart",function(){f(),i.unsubscribe(_)}),e.$on(g.COMMON.WINDOW_RESIZED,function(){e.$rgDigest()}),e.$on(g.FRIEND.PENDING_FRIENDS_COUNT_CHANGED,function(){e.$rgDigest()})}e.module("ringid.header").controller("HeaderController",n),n.$inject=["$scope","$rootScope","$location","rgDropdownService","$$connector","OPERATION_TYPES","friendsFactory","NotificationFactory","Auth","rgScrollbarService","chatHistoryFactory","Utils","SystemEvents"]}(angular,window),function(e,t){"use strict";function n(e){var t=this,n=!1,r=!1;t.close=function(){r&&(n.searchText="",r.style.display="none",n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))},t.open=function(i,o){r=i,n=o,r.style.display="block",e.bindHandler("document","click",t.close)}}function r(e){function t(t,n,r,i,o,a,s,c){function l(){p!==t.searchText&&(t.resetSearch(),E=0)}function u(){t.noResult=0===t.listData.length(),t.gotAllResult=t.listData.length()>0,t.showLoadbar=!1,t.$rgDigest()}function d(n){l(),(n||!t.showLoadbar&&!t.gotAllResult)&&(clearTimeout(f),t.showLoadbar=!0,t.showDropdown||e.open(t.template,t),p=t.searchText,o.searchContact({schPm:t.searchText,st:t.listData.length()}).then(g,g),f=setTimeout(u,8e3),t.$rgDigest())}function g(e){if(clearTimeout(f),e.sucs===!0){for(var n=0,i=e.searchedcontaclist.length;i>n;n++)m=r.create(e.searchedcontaclist[n]),m&&t.listData.save(m.getKey(),m);e.searchedcontaclist.length>0&&s.recalculate(t),t.showLoadbar=!1,t.noResult=0===t.listData.length(),t.$rgDigest()}else E++,3>E?d(!0):(clearTimeout(f),u())}var m,f,E=0,p="";t.searchText="",t.gotAllResult=!1,t.showLoadbar=!1,t.noResult=!0,t.listData=n.createNew(),t.resetSearch=function(){E=0,t.noResult=!1,t.gotAllResult=!1,t.listData.reset(),t.$rgDigest()},t.contactListAction=function(e){e.friend.isLoading()||(i.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())},t.doSearch=d,t.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:c.user.getMutualFriends(e)}}}var n=function(t,n){function r(e){"a"!==e.target.tagName.toLowerCase()&&"a"!==e.target.parentNode.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation()}var i=n.find("input");t.template=n[0].querySelector("#search-dropdown"),t.template.style.display="none",i.on("keypress",function(e){13===e.keyCode&&e.preventDefault()}),t.doTheSearch=function(){t.searchText.length>0?t.doSearch():e.close()},n.on("click",r),t.$on("$destroy",function(){n.off("click",r)})};return t.$inject=["$scope","$$stackedMap","userFactory","friendsFactory","friendsHttpService","$timeout","rgScrollbarService","Api"],{restrict:"E",scope:{placeholder:"@"},templateUrl:"templates/dropdowns/search-dropdown.html",link:n,controller:t}}e.module("ringid.header").service("rgSearchService",n).directive("rgSearch",r),n.$inject=["GlobalEvents"],r.$inject=["rgSearchService"]}(angular,window),function(e,t){"use strict";e.module("ringid.feed",["ngWebSocket","ringid.utils","ringid.config","ringid.connector","ringid.directives"])}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a){return function(n,s,c){function l(e){var n;m||(m=!0,u.addIgnore(),setTimeout(function(){a.$broadcast("FIRST_FEED_RECEIVED")},1e3)),!e.sucs&&e.rc>0&&e.rc==o.NO_MORE_FEED?u.setNoMoreFeed(!0):1111===e.rc?u.feeds.length||t.initFeedRequest(u.params):n=t.process(e),n?n.$rgDigest():(d++,u.feeds=t.getFeeds(),u.busy&&(u.busy=!1,u.clearRequestTimer()),g===!1&&(g=!0,requestAnimationFrame(function(){u.$rgDigest(),g=!1})))}var u=n.$parent,d=0,g=(i.SYSTEM,!1),m=!1,f=e.subscribe(l,{filter:t.getFeedFilter(),callWithUnresolved:!0}),E=r.add(function(){t.requestForFeed(u.params,1)});u.$on("$destroy",function(){e.unsubscribe(f),t.reset(),r.remove(E),m&&u.removeIgnore()})}}e.module("ringid.feed").directive("rgFeedSubscriber",n),n.$inject=["$$connector","feedFactory","$window","$$rgsyncher","OPERATION_TYPES","REASON_CODES","$rootScope"]}(angular,window),function(e,t){"use strict";function n(e,t,n){function r(e,t){return t*e.height/e.width}function i(e,t){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="RingBoxImageController" ringbox-type="remote" ringbox-animation="true" ringbox-target="templates/partials/notification/'+(t||"image-popup.html")+'" ringbox-data="getImageData(feedimages['+e+'].value, feed)"></div>'}var o={layout_0:'<div class="grid">'+i(0)+'</div><div class="grid">'+i(1)+i(2)+"</div>",layout_2:'<div class="grid">'+i(0)+i(1)+'</div><div class="grid">'+i(2)+"</div>",layout_4:'<div class="grid">'+i(0)+i(1)+"</div>",layout_5:i(0)};o.layout_1=o.layout_0,o.layout_3=o.layout_2,o.layout_6=o.layout_5;var a={layout_0:'<div class="grid">'+i(0,"image-popup-special.html")+'</div><div class="grid">'+i(1,"image-popup-special.html")+i(2,"image-popup-special.html")+"</div>",layout_2:'<div class="grid">'+i(0,"image-popup-special.html")+i(1,"image-popup-special.html")+'</div><div class="grid">'+i(2,"image-popup-special.html")+"</div>",layout_4:'<div class="grid">'+i(0,"image-popup-special.html")+i(1,"image-popup-special.html")+"</div>",layout_5:i(0,"image-popup-special.html")};return a.layout_1=a.layout_0,a.layout_3=a.layout_2,a.layout_6=a.layout_5,{restrict:"A",scope:!0,link:function(e,t,i){var s;if("shared"===i.feedImage&&(e.feed=e.feed.getOrginalFeed()),e.layout_id=e.feed.getImageLayout(),e.feedimages=e.feed.getImages(),5===e.layout_id&&(e.feedimages[0].value.offset().width<600&&e.feedimages[0].value.offset().height<400?e.layout_id=6:r(e.feedimages[0].value.offset(),600)<400&&(e.layout_id=6)),t.addClass("img-layout-"+e.layout_id),e.feedimages.length){s=i.popupTemplate?a:o;var c=n(s["layout_"+e.layout_id])(e);e.feed.getTotalImage()>3&&(c[1].lastChild.innerHTML='<div class="img-bg-opa"></div>    <div class="img-bg-counter">+'+(e.feed.getTotalImage()-3)+"</div>"),t.html(""),t.append(c)}}}}e.module("ringid.feed").directive("feedImage",n),n.$inject=["Utils","SystemEvents","$compile"]}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r){return{restrict:"A",link:function(i,o,a){function s(){var e=p;i.showFeedFullContent||(p.length>250&&(e=p.substr(0,p.indexOf(" ",249)),E=!0),e&&e.split(/\r\n|\n\r/).length>10&&(E=!0,e=e.split(/\r\n|\n\r/,10).join("\n\r")),e=E?g.getCroppedHtml(e):f),e?(o.html(e),i.editorEnabled?o.addClass("ng-hide"):o.removeClass("ng-hide")):o.addClass("ng-hide"),c()}function c(){E&&(d=e.element('<span style="display:inline-block;margin-left:5px;" class="showpointer showmore"> Show More</span>'),o.append(d),d.bind("click",u),i.$on("$destroy",function(){d&&(d.unbind("click"),d=null)}))}function l(){f=g.getDynamicText().toString(),E=g.showMore(),d&&(d.unbind("click"),d=null),s()}function u(){if(g.showMore()){r.open({type:"remote",scope:!1,scrollable:!0,controller:"PopupSingleFeedController",onBackDropClickClose:!0,resolve:{remoteData:function(){return t.moreFeedText(g)}},templateUrl:"pages/home/popup-feed.html"})}else o.html(f),d.unbind("click"),d=null}var d,g=i.$eval(a.rgMoreFeed),m=0,f=g.getDynamicText().toString(),E=g.showMore(),p=g.text();s(),i.$on(n.FEED.UPDATED,function(e,t){t.id===g.getKey()&&l()}),i.$on(n.FEED.RESET,function(e,t){t.getKey()===g.getKey()&&(g=t,l())}),i.$watch("feed.text()",function(e,t){m>0&&l(),m++}),i.$watch("editorEnabled",function(e,t){})}}}e.module("ringid.feed").directive("rgMoreFeed",t),t.$inject=["feedFactory","SystemEvents","$ringbox"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i){return{restrict:"A",link:function(o,a,s){function c(){var e,t,n=r.viewport.yo;f>0&&(t=f+75,e=t-n,e>0&&(75>e?a.css("top","75px"):a.css("top",e+"px")))}function l(){t.hasUnprocessedFeed()?a.hasClass("active")||a.addClass("active"):a.removeClass("active")}function u(){r.viewport.yo>500?t.setpushInIncomingFeed(!0):t.hasUnprocessedFeed()&&d>r.viewport.yo?(t.processIncomingFeed(),t.setpushInIncomingFeed(!1),l()):t.setpushInIncomingFeed(!1),a.hasClass("active")&&c(),d=r.viewport.yo}var d,g=e.element(n),m=t.getCurrentPageValue(),f=0,E=i.SYSTEM;switch(m.action){case E.TYPE_MY_NEWS_FEED:case E.TYPE_FRIEND_NEWSFEED:f=492;break;case E.TYPE_GROUP_NEWS_FEED:f=250;break;case E.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:case E.TYPE_NEWS_FEED:default:f=0}o.$watch(t.hasUnprocessedFeed,function(e,t){e>t&&l()}),a.on("click",function(){t.processIncomingFeed(),t.setpushInIncomingFeed(!1),l(),r.resetScroll(),r.animateScroll(),o.setFeed(),o.$rgDigest()}),g.bind("scroll",u);var p=function(){g.unbind("scroll",u),a.off("click")};l(),o.$on("$destroy",p)}}}e.module("ringid.feed").directive("rgIncomingFeed",t),t.$inject=["feedFactory","$window","Utils","OPERATION_TYPES"]}()}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed-timeout-option.html",link:function(e){e.$rgDigest()},controller:["$scope",function(t){t.rows=[1,9,17],t.cols=[0,1,2,3,4,5,6,7],t.lastCols=[25,26,27,28,29,30],t.select=function(n){e.isFunction(t.onSelect)&&t.onSelect({item:n}),t.close(),t.$parent.$rgDigest()}}]}}function r(){return function(e,t,n){t.on("click",function(t){t.stopPropagation(),e.select(n.feedTimeoutSelect)}),e.$on("$destroy",function(){t.off("click")})}}function i(t,n){return{restrict:"A",scope:{onSelect:"&ringOnOptionSelect",value:"=selectedValue"},link:function(r,i,o){function a(e){e.target!=i[0]&&e.target.parentNode!=i[0]&&e.target.parentNode.parentNode!=i[0]&&"pt-top"!=e.target.className&&r.close()}var s,c=!1;r.close=function(){s&&s.remove(),s=null,c=!1,t.off("click",a)},r.$watch("value",function(e,t){parseInt(e)>-1?i.addClass("active"):i.removeClass("active")}),i.on("click",function(o){return c?(r.close(),""):(s||(s=n(e.element("<feed-timout-option></feed-timout-option>"))(r)),i.after(s),c=!0,void t.on("click",a))}),r.$on("$destroy",function(){i.off("click"),t.off("click",a)})}}}e.module("ringid.feed").directive("feedTimeoutSelect",r).directive("feedTimoutOption",n).directive("feedTimeoutMenu",i),i.$inject=["$document","$compile"]}(angular,window),function(e,t){"use strict";function n(e,n,r,i,o,a,s,c,l){function u(u,d){return function(d,g,m,f,E){function p(e,t){X==e||Z||(requestAnimationFrame(function(){for(var t=0;L>t;t++)b&&b[t].loader&&(b[t].loader.style.display=e?"block":"none");Z=!1}),Z=!0,X=e)}function T(){for(var e=0;P>e;e++)L>e?b[e].element.style.display="block":b[e].element.style.display="none"}function h(){v(d[D]),_(!1),j=!1,p(j,"line 160"),T()}function _(e){Q&&b&&requestAnimationFrame(function(){var t;if(x=g[0].scrollHeight,t=x-o.viewport.y-o.viewport.y,o.viewport.yo>t&&e){if(d.LoadMoreData(),d.noMoreFeed)return;d.busy!=j&&(j=d.busy,p(j,"Line 205"))}if(!(F||Math.abs(o.viewport.yo-B)<H)){var n,r,i,a,s,c=[139,0,0],l=[],u=[],m=[0,0,0],f=[0,0,0];for(B=o.viewport.yo,ee||(c[0]=0),S=0;S<z.length;S++)i=z[S],r=i.key,J[r]&&(a=J[r],a&&(s=a.height,n=a.cell,c[n]+=s,c[n]>=ne+B&&c[n]<=B+G+re?a.clone.RG_HIDDEN&&l.push(a.clone):(c[n]<ne+B&&(m[n]+=s),c[n]>=ne+B&&c[n]>B+G+re&&(f[n]+=s),a.clone.RG_HIDDEN||u.push(a.clone))));for(S=0;S<w.length;S++)i=w[S],r=i.key,U[r]&&(a=U[r],a&&(s=a.height,n=a.cell,c[n]+=s,c[n]>=ne+B&&c[n]<=B+G+re?a.clone.RG_HIDDEN&&l.push(a.clone):(c[n]<ne+B&&(m[n]+=s),c[n]>=ne+B&&c[n]>B+G+re&&(f[n]+=s),a.clone.RG_HIDDEN||u.push(a.clone))));i=null,a=null;var E=Math.max(Math.max.apply(null,c),G);k.style.height=E+H+"px";for(var T=0;T<b.length;T++)b[T].element.style.paddingTop=m[T]+"px";for(var T=0;T<l.length;T++)l[T].style.display="block",l[T].RG_HIDDEN=!1;for(var T=0;T<u.length;T++)u[T].style.display="none",u[T].RG_HIDDEN=!0}})}function I(e){fastdom.defer(3,function(){U&&U[e]&&(U[e].height=U[e].clone.offsetHeight+12)})}function A(){this.removeEventListener(Y+"TransitionEnd",A),this.removeEventListener("transitionend",A),this.parentNode.removeChild(this)}function v(e){var t,r,i,o,s,c,u,g,m,f=e.length,T=[],h=Object.create(null),_=0;if(F=!0,Q&&b){if(0==e.length&&V)return void(d.noMoreFeed&&requestAnimationFrame(function(){d.$rgDigest()}));for(a.$$postDigest(function(){var t,n,r;for(t=0;t<e.length;t++)n=e[t],s=n.key,U[s]&&(r=U[s],r&&r.childHead&&(r.scope.$$childHead=r.childHead))}),l.hasSpecialFeed()&&(z=l.getSpecialFeedList(),_=z.length),t=0;f>t;t++){if(o=(t+_)%L,r=e[t],s=r.key,U[s]){if(c=U[s],!c)continue;c.cell=o,delete U[s]}else i=d.$new(),i[N]=r,c={},c.clone=null,c.cell=o,c.scope=i,c.height=110,c.key=s,c.serial=-1;h[s]=c}for(t=0;L>t;t++)T[t]||(T[t]=ee&&0==t&&b[t].element.firstElementChild?b[t].element.firstElementChild:b[t].element.firstChild);for(s in U)if(U[s]){if(c=U[s],!c)continue;c.clone.style.opacity=0,c.clone.RG_DELETE=!0,c.clone.addEventListener(Y+"TransitionEnd",A),c.clone.addEventListener("transitionend",A),c.scope.$destroy()}var I=2,v=[];if(q&&_>0)for(t=0;_>t;t++){if(r=z[t],s=r.key,o=t%L,u=T[o],g=u.parentNode,J[s]){if(c=J[s],!c)continue;m=c.clone,c.cell=o,m!=u.nextSibling&&g.insertBefore(m,u.nextSibling),T[c.cell]=m}else i=d.$new(),i[N]=r.value,m=n(q)(i),g.insertBefore(m[0],u.nextSibling),u=m[0],u.style.opacity=1,c={},c.clone=m[0],c.cell=o,c.scope=i,c.height=110,c.key=s,c.serial=t,c.serialElm=c.clone.querySelector("[feed-serial]"),T[o]=u,J[s]=c,function(e,t){fastdom.defer(1,function(){t&&(t.height=e.offsetHeight+12)})}(u,c);c.serialElm&&(c.serialElm.innerHTML=t+1)}for(t=0;f>t;t++)if(r=e[t],s=r.key,c=h[s]){if(c.scope.$index=t,u=T[c.cell],g=u.parentNode,m=c.clone){do u=u.nextSibling;while(u&&u.RG_DELETE);m!=u&&g.insertBefore(m,u),T[c.cell]=m,c.childHead=c.scope.$$childHead,c.scope.$$childHead=null}else E(c.scope,function(e){g.insertBefore(e[0],u.nextSibling),u=e[0],function(e,t){fastdom.defer(++I,function(){t&&(t.height=e.offsetHeight+12)})}(u,c),!K||V||10>W?u.style.opacity=1:v.push(u),c.clone=u,T[c.cell]=u,c.serialElm=c.clone.querySelector("[feed-serial]"),W++});c.serial!=t+_&&c.serialElm&&(c.serialElm.innerHTML=_+t+1,c.serial=t+_)}v.length>0&&fastdom.defer(2,function(){if(!v)return!1;for(t=0;t<v.length;t++)v[t].style.opacity=1;v=null}),d.busy!=j&&(j=d.busy,p(j,"Line 639"),j=null),U=h,w=e,F=!1,h=null,V=!1,c=null,m=null,g=null,u=null,T=null,i=null,e.length<=10&&requestAnimationFrame(function(){d.$rgDigest()})}}var S,C,D,N,M,R,y=m.feedRepeat,O=y.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),b=[],P=3,L=o.feedColumn(),U=Object.create(null),w=[],F=!1,k=document.querySelector("div.middle"),$=document.getElementById("feeds-container"),G=o.viewport.y,H=G/2,B=0,x=0,Y=c.vendorPrefix.toLowerCase(),K="moz"!=Y&&"ms"!=Y,j=!1,V=!0,W=0,q="",z=[],Q=!1,X=!1,Z=!1,J=Object.create(null),ee=!1;t.performance.now();C=O[1],D=O[2];O[3]?e(O[3]):"";for(N=O[1],S=0;P>S;S++){M={},R=document.createElement("div"),R.className="cell cell-id"+S,R.appendChild(document.createComment("cell: "+S)),M.element=R;var te=document.createElement("div");te.innerHTML='<div class="rf-box"><div class="rf-top"><div class="rf-cir"><span class="icon-logo-circle"></span></div><div class="rf-line"></div></div><div class="rc-feed"> </div><div class="rc-feed rc2"> </div><div class="rc-feed rc3"> </div><div class="rf-ics"></div></div>',te.style.display="none",R.appendChild(te),M.loader=te,b[S]=M,d.showPostBox()&&m.postbox&&0==S?(!function(e){i.get(m.postbox,{cache:r}).then(function(t){var r=n(t.data)(d);e.insertBefore(r[0],e.firstChild.nextSibling),Q=!0,requestAnimationFrame(function(){v(d[D])}),d.$rgDigest()})}(R),ee=!0):(Q=!0,requestAnimationFrame(function(){v(d[D])})),te=null}for(d.showSpecialFeed()&&i.get("templates/partials/special-feed.html",{cache:r}).then(function(e){q=e.data}),S=0;P>S;S++)g[0].appendChild(b[S].element);k.style.height=G+"px",u[0].className="cols-"+L,T(),j=!0,p(j,"line 170");var ne=-1*G*4,re=4*G;document.documentElement.scrollTop=0,document.body.parentNode.scrollTop=0,document.body.scrollTop=0,t.addEventListener("scroll",_),d.$on(s.COMMON.COLUMN_CHANGED,function(e,t){L=t,u[0].className="cols-"+L,h()}),d.$on(s.COMMON.WINDOW_RESIZED,function(e,t){L=o.feedColumn(),u[0].className="cols-"+L}),d.$watchCollection(D,v),d.$on("$destroy",function(){U=w=R=b=M=J=z=k=$=q=X=null,t.removeEventListener("scroll",_)}),d.$on(s.FEED.HEIGHT,function(e,t){e.stopPropagation(),U&&U[t]&&I(t)}),d.$on(s.FEED.BUSY,function(e,t){j=t,p(j,"LINE 343")})}}return{restrict:"A",transclude:!0,priority:1e3,terminal:!0,compile:u}}e.module("ringid.feed").directive("feedRepeat",n),n.$inject=["$parse","$compile","$templateCache","$http","Utils","$rootScope","SystemEvents","$sniffer","feedFactory"]}(angular,window),function(e,t){"use strict";!function(){function t(){return{restrict:"E",scope:{onHover:"&",onSelect:"&",location:"="},templateUrl:"templates/partials/feed_location/item.html",link:function(e,t,n){t.on("click",function(t){t.stopPropagation(),e.onSelect&&e.onSelect({location:e.location})}),e.onHover&&t.on("mouseover",function(t){e.onHover({location:e.location})}),e.$on("$destroy",function(){t.off("click"),t.off("mouseover")})}}}function n(t){function n(e){e.stopPropagation()}return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed_location/view.html",compile:function(e,t,r){return{pre:function(e,t,n,r){e.initLocation(t)},post:function(e,t,r,i){e.$rgDigest(),t.on("click",n),e.$on("$destroy",function(){t.off("click",n)})}}},controller:["$scope",function(n){function r(e){try{g(e.place_id),s()}catch(t){}}function i(t){T.getDetails({placeId:t},function(n,r){r==google.maps.places.PlacesServiceStatus.OK&&(e.extend(I[t],n),I[t]=n),l()})}function o(){n.loadingData=!0}function a(){n.loadingData=!1}function s(){n.showLocationMap=!0}function c(){n.suggestedLocations=[]}function l(){n.$rgDigest()}function u(e){return new google.maps.LatLng(e.lat,e.lng)}function d(e){var t=u(e);p=new google.maps.Map(document.getElementById("feed-location-map"),{center:t,zoom:13}),e.description&&h.getPlacePredictions({input:e.description,rankBy:google.maps.places.RankBy.DISTANCE},A)}function g(e){var t=I[e];t&&(E&&E.setMap(null),p.setCenter(t.geometry.location),E=new google.maps.Marker({map:p,place:{placeId:e,location:t.geometry.location}}))}function m(e){c(),o(),l(),h.getPlacePredictions({input:e},A)}function f(e){var t=e.target.value;t&&t.length>3?m(t):(c(),l()),n.keyword=e.target.value}n.keyword="",n.showLocationMap=!0,n.suggestedLocations=[],n.loadingData=!1,n.selfLocation={},n.onLocationItemSelect=function(t){if(e.isFunction(n.onItemSelect)){try{var r={description:t.terms[0].value}}catch(i){var r={description:t.description}}r.lat=9999,r.lng=9999,t.geometry&&t.geometry.location&&(r.lat=t.geometry.location.lat(),r.lng=t.geometry.location.lng()),n.onItemSelect({location:r}),n.$parent.$rgDigest()}n.close()},n.shareUserLocation=function(){t.getUserLocation().then(function(e){e.sucs?(n.onItemSelect({location:e}),n.$rgDigest(),n.close()):Ringalert.show({mg:"Unable to detect user location"},"error")})},n.onLocationItemHover=r;var E,p,T,h,_,I={};n.initLocation=function(e){_=e.find("input")[0],T=new google.maps.places.PlacesService(_),h=new google.maps.places.AutocompleteService,_.focus(),t.getUserLocation(!0).then(function(e){n.selfLocation=e,d(e.sucs?{lat:e.lat,lng:e.lng,description:e.description}:{lat:23.772493,lng:90.4098315,description:"IPvision Ltd."})}),n.keyword=n.value?n.value.description:""};var A=function(t,r){return r!=google.maps.places.PlacesServiceStatus.OK?(console.warn(r),void a()):(c(),e.forEach(t,function(t){var r=t.place_id;I[r]?e.extend(I[r],t):(i(r),I[r]=t),n.suggestedLocations.push(I[r])}),n.suggestedLocations.length>0&&a(),void l())};n.processKeyup=t.debounce(f,500)}]}}function r(){return{replace:!0,template:'<span ng-if="!!feed.getLocationInfo().lat" ><a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">  <img height="170px" width="100%" ng-src="{{ ::feed.getLocationStaticEmbedUrl() }}" alt="location-hover" /> </a>'}}var i;try{i=e.module("ringid.feed")}catch(o){return void console.warn("Feed Module Not Found")}i.directive("feedLocationViewItem",t),i.directive("feedLocationView",n),n.$inject=["Utils"],i.directive("feedLocationPreview",r)}()}(angular,window),function(e,t){"use strict";!function(){function n(n,r,i){return{restrict:"A",scope:{onItemSelect:"&feedLocationMenuOnSelect",value:"=selectedValue",viewWidth:"@",viewHeight:"@",autoAdjust:"@"},link:function(o,a,s){function c(e){e.target!=a[0]&&e.target.parentNode!=a[0]&&e.target.parentNode.parentNode!=a[0]&&"pt-top"!=e.target.className&&(o.close(),"false"!==o.autoAdjust&&l(event))}function l(e){t.eventFix(e);var n=i.viewportsize();!d&&e.pageY+o.viewHeight+m>n.y&&t.scrollToYOffset(e.pageY-n.y/2,500),e.pageX+o.viewWidth+m>n.x-200&&(o.viewDirection+=" left")}var u,d,g=!1,m=20;o.viewDirection="right",s.feedLocationMenuDirection&&(o.viewDirection=s.feedLocationMenuDirection,d=!0),o.viewWidth=o.viewWidth||600,o.viewHeight=o.viewHeight||466,o.close=function(){u&&u.remove(),u=null,g=!1,n.off("click",c)},o.$watch("value",function(e,t){e.description?a.addClass("active"):a.removeClass("active")}),a.on("click",function(t){return g?(o.close(),""):("false"!==o.autoAdjust&&l(t),u||(u=r(e.element("<feed-location-view></feed-location-view>"))(o)),a.after(u),g=!0,void n.on("click",c))}),o.$on("$destroy",function(){u&&u.remove(),a.off("click"),n.off("click",c)}),o.$rgDigest()}}}var r;try{r=e.module("ringid.feed")}catch(i){return void console.warn("Feed Module Not Found")}r.directive("feedLocationMenu",n),n.$inject=["$document","$compile","Utils"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",template:e.get("top.html")}}e.module("ringid.feed").directive("rgNewsFeedTop",t),t.$inject=["$templateCache"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e){return{restrict:"E",template:e.get("bottom.html")}}e.module("ringid.feed").directive("rgNewsFeedBottom",t),t.$inject=["$templateCache"]}()}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",templateUrl:"templates/partials/news_feed/details.html",link:function(e){e.$rgDigest()}}}e.module("ringid.feed").directive("rgNewsFeedDetails",n)}(angular,window),function(e,t){"use strict";!function(){function t(){return{restrict:"E",templateUrl:"templates/partials/news_feed/shared_feed.html"}}e.module("ringid.feed").directive("rgNewsFeedSharedFeed",t)}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i){return{restrict:"E",template:n.get("menu.html"),link:function(n,o,a){function s(e){if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){e.stopPropagation();var t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0);if(!o.sucs)return void i.show(r[o.rc],"warning");c()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),l()),n.$rgDigest()}function c(){return n.showCommentBox&&(m.removeChild(u),n.showCommentBox=!1),n.showShareBox?n.showShareBox?(m.removeChild(d),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey()):(d=d?d:e("<feed-inline-share-view></feed-inline-share-view>")(n)[0],m.appendChild(d),n.showShareBox=!0,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}function l(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox" comment-type = "feed" comment-order = "asc"></rg-comments>',n.showShareBox&&(m.removeChild(d),n.showShareBox=!1),n.showCommentBox?(m.removeChild(u),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,u=u?u:e(r)(n)[0],m.appendChild(u),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}var u=null,d=null,g=o[0].querySelector("[data-events]"),m=o[0].closest("[data-feed-bottom]");g.addEventListener("click",s),n.closeShareBox=function(){n.showShareBox=!0,c(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,l(),n.$rgDigest()},n.$on("$destroy",function(){g.removeEventListener("click",s),g=null,m=null,u=null,d=null})}}}e.module("ringid.feed").directive("rgNewsFeedMenu",t),t.$inject=["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert"]}()}(angular,window),function(e,t){"use strict";!function(){e.module("ringid.feed").directive("rgPortalNewsFeedMenu",["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert","$ringbox",function(e,t,n,r,i,o){return{restrict:"E",template:n.get("menu.html"),link:function(n,a,s){function c(e){if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){e.stopPropagation();var t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0);if(!o.sucs)return void i.show(r[o.rc],"warning");l()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),u()),n.$rgDigest()}function l(){if(n.showCommentBox&&(f.removeChild(d),n.showCommentBox=!1),!n.showShareBox){var e=o.open({type:"remote",scope:!1,controller:"feedNewsPortalShareController",scopeData:{feed:n.feed},onBackDropClickClose:!0,templateUrl:"templates/newsportal/portal-share-news.html"});return void e.result.then(function(){n.$rgDigest()})}return n.showShareBox?(f.removeChild(g),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey())}function u(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox" comment-type = "feed" comment-order = "asc"></rg-comments>',n.showCommentBox?(f.removeChild(d),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,d=d?d:e(r)(n)[0],f.appendChild(d),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}var d=null,g=null,m=a[0].querySelector("[data-events]"),f=a[0].closest("[data-feed-bottom]");m.addEventListener("click",c),n.closeShareBox=function(){n.showShareBox=!0,l(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,u(),n.$rgDigest()},n.$on("$destroy",function(){m.removeEventListener("click",c),m=null,f=null,d=null,g=null})}}}])}()}(angular,window),function(e,t){"use strict";!function(){function t(e){return{restrict:"A",scope:{feed:"=feedMessage"},link:function(t,n,r){t.$watch("feed.checkMessageUpdated()",function(r){n.html(t.feed.getMessageText()),e(n.contents())(t)})}}}function n(){return{restrict:"E",scope:{feed:"=tagFeed"},controller:["$scope","feedFactory",function(e,t){if(e.getTagUsers=function(e){return{data:function(){return{target:e}},promise:t.getTagUsers(e)}},e.tooltip="",e.feed.getTotalTag()>2){var n=e.feed.getTagUsers();n.length>1&&(e.tooltip+=n[1].getName(),n[2]&&(e.tooltip+="\n"+n[2].getName(),e.feed.getTotalTag()>3&&(e.tooltip+="\nand "+(e.feed.getTotalTag()-3)+" others")))}}],template:'<span class="">with&nbsp;</span><span class="tag-people"><user-card user="feed.getTagUsers()[0]"></user-card></span><span ng-if="::feed.getTotalTag() > 1">&nbsp;and&nbsp;<span class="tag-people" ng-if="::feed.getTotalTag() == 2"><user-card user="feed.getTagUsers()[1]"></user-card></span><span class="" ng-if="::feed.getTotalTag() > 2"><a rg-ringbox="true" ringbox-controller="feedTagUserListController" ringbox-type="remote"ringbox-target="templates/home/tag-user-list.html"ringbox-data="getTagUsers(feed)" class="tag-f-msg" data-tooltip="{{::tooltip}}">{{::feed.getTotalTag() -1}} others peoples</a></span></span>'}}e.module("ringid.feed").directive("locationCard",function(){return{restrict:"E",replace:!0,scope:{feed:"="},template:'<span class="location">&nbsp;at&nbsp;<a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">{{::feed.getLocationShortText()}}</a></span>'
}}).directive("userCard",function(){return{restrict:"E",replace:!0,controller:["$scope","Api","friendsFactory","settings","portalHttpService",function(e,t,n,r,i){e.getUserDetail=function(){e.showMfc=!1,t.user.getUserDetails({utId:e.user.getUtId()},!0,e.user.isNewsPortalUser()).then(function(t){t.sucs&&(e.mfc=t.userDetails.mfc,e.showMfc=!0,e.user.setUid(t.userDetails.uId),t.userDetails.npDTO&&(e.portalCategory=t.userDetails.npDTO.nPCatName,e.follower=t.userDetails.npDTO.subCount,e.isSubscribed=t.userDetails.npDTO.subsc,e.profileImage=r.imBase+t.userDetails.prIm),e.$rgDigest())})},e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:t.user.getMutualFriends(e)}},e.contactListAction=function(t){t.friend.isLoading()||(n.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}}],scope:{user:"="},template:'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="{{::!user.isCurrentUser()}}" on-hover-start="getUserDetail" hover-template-url="{{user.getCardTemplate()}}">{{::user.getName()}}</a></span>'}}).directive("feedMessage",t).directive("feedTagMoreUser",n),t.$inject=["$compile"],n.$inject=[]}()}(angular,window),function(e,t){"use strict";!function(){function t(){return{restrict:"E",templateUrl:"templates/partials/single_feed/body.html"}}function n(){return{restrict:"E",templateUrl:"templates/partials/single_feed/header.html"}}function r(){return{restrict:"E",templateUrl:"templates/partials/single_feed/menu.html"}}e.module("ringid.feed").directive("rgSingleFeedHeader",n).directive("rgSingleFeedBody",t).directive("rgSingleFeedMenu",r)}()}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",templateUrl:"templates/partials/single_feed/details.html"}}e.module("ringid.feed").directive("rgSingleFeedDetails",n)}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n){return{restrict:"E",template:'<div class="status-box noselect inline-share"><form enctype="multipart/form-data"><div style="padding:10px"><div class="float-left"><div class="thumbnail"><div class="icon-logo-circle pss-logo"><a><img class="responsive-all" rg-src="currentUser.avatar(\'thumb\')"></a></div></div></div><div class="post-t float-right"><div class="inline-share-box"><rg-editor class="editor" editor-content="feedText" new-line="on" on-escape="closeShareBox" focus="showShareBox" placeholder="Write something...."></rg-editor><span class="esc-cancel" rg-click="closeShareBox()">Press Esc to <a>Cancel</a></span><p ng-if="emotions.length" class="pst-loc-txt"><span class="feelings-text">feeling</span> <img class="feed_emo" rg-src="emotions[0].url"> {{emotions[0].nm}} &nbsp;<span class="icon-close f-12" rg-click="emotions.length = 0"></span></p><div ng-if="tagList.length"><ul class="tag-fnd-lst"><span class="tag-with">With : </span><li ng-repeat="usr in tagList"><span class="tag-title">{{::usr.getName()}}</span>&nbsp;<span class="tag-cros" rg-click="removeTag(usr)">X</span></li></ul></div><p ng-if="feedLocation.description" class="pst-loc-txt">{{ feedLocation.description}} <span class="showpointer icon-close f-12" rg-click="resetFeedLocation()"></span></p><p ng-show="!boxIsLoading && errorMessage" class="s-error">{{errorMessage}}</p><!--<p ng-show="!boxIsLoading && !errorMessage" class="s-info"><b>Enter</b> to SHARE, <b>ESC</b> to Cancel</p>--><rg-loader-view2 is-loading="boxIsLoading"></rg-loader-view2></div></div><div class="clear"></div></div><div class="status-photo-box" style="margin:0;padding:0;border-top:1px solid #ebebeb;width:100%"><div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Feeling" rg-emotion on-select="chooseEmotion(item)" class="p-ab"><span class="img_sprite status-ico feeling-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Tag Friends" rg-tag-friend="" show-if="showAddTag" tag-items="tagList" on-select="addTag(item)" class="p-ab"><span class="img_sprite status-ico tag-f-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Location" feed-location-menu="" feed-location-menu-on-select="updateFeedLocation(location)" autoAdjust="{{::autoAdjustScroll}}" selected-value="feedLocation" class="p-ab"><span class="img_sprite status-ico location-ico"></span></a></div><div class="float-right pad-7-0"><input type="button" ng-disabled="inputDisabled" rg-click="shareFeed()" class="share_btn float-right" value="Share"></div><!--<p>Press escape to cancel</p>--></div></div></form><div class="clear"></div></div>',controller:"feedInlineShareController",link:function(e,t,n){}}}var n;try{n=e.module("ringid.feed")}catch(r){return void console.warn("Feed Module Not Found")}n.directive("feedInlineShareView",t),t.$inject=["GlobalEvents","$compile","$ringhttp"]}()}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedMainController",["$scope","$timeout","feedFactory","$rootScope","SystemEvents",function(e,t,n,r,i){n.reset(),e.noMoreFeed=!1,e.showPostBox=e.showPostBox||function(){return!0},e.showSpecialFeed=e.showSpecialFeed||function(){return!0},e.feeds=n.getFeeds(),n.setFactoryKey(e.pagekey),n.setSortBy(e.sortBy||"tm"),e.busy=!0;var o=setInterval(function(){n.updateTime(),e.$rgDigest()},3e5);e.setFeed=function(t){e.feeds=[],e.feeds=n.getFeeds(),t&&e.$rgDigest()},e.forAdd=e.forAdd||"my",e.getFeeds=function(){return e.feeds&&0!==e.feeds.length||e.setFeed(),e.feeds};var a,s;e.LoadMoreData=function(t){s=e.feeds.length,e.busy!==!1||e.noMoreFeed||(e.busy=!0,n.requestForMoreFeed(e.params),e.clearRequestTimer(),a=setTimeout(function(){e.busy&&s===e.feeds.length&&(e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy))},6e3))},e.clearRequestTimer=function(e){a&&clearTimeout(a),a=e},e.$on("FeedListChanged",function(){e.setFeed()}),e.setNoMoreFeed=function(t){e.noMoreFeed=t,n.noMoreFeed(t),e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy)},e.noDataYet=function(){return e.noMoreFeed&&0==e.feeds.length},n.initFeedRequest(e.params),e.$on("$destroy",function(){o&&(clearInterval(o),o=null)}),e.$on(i.COMMON.COLUMN_CHANGED,function(){e.$rgDigest()})}])}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("SingleFeedSubController",["$$feedMap","$scope","$controller","$routeParams","feedFactory","Auth","SystemEvents","Utils","$location",function(e,t,n,r,i,o,a,s,c){function l(){i.getSingleFeed(t.feedId,t.shared).then(function(e){e?(t.feed=e,t.isReady=!0,u()):(t.feed=!1,t.isReady=!0,t.noData=!0),t.$rgDigest()})}function u(){t.feed&&(t.serial=t.feed.serial,t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.shareMenuDisabled=t.feed.isCirclePost(),t.ogData=t.feed.getOgData(),t.ogShowPreview=t.feed.hasOgData(),t.showCommentBox=!0,n("FeedSubController",{$scope:t}),s.safeDigest(t),t.$broadcast(a.FEED.RESET,t.feed))}t.feedId=parseInt(r.feedId||0),t.shared=!!r.shared,t.activeCommentId=parseInt(r.commentId||0),t.isReady=!1,t.noData=!1,t.pagekey=i.getSingleFeedPageKey(t.feedId),i.setFactoryKey(t.pagekey),t.singleFeed=!0,t.hideSerial=!0,t.showFeedFullContent=!0,t.ogData={},t.currentUser=o.currentUser(),l(),t.setFeed=function(e){e?c.path("/"):l()},t.skipSaveScope=!0,n("FeedSubController",{$scope:t})}])}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s,c,l,u,d){function g(e){e&&r.path(e)}function m(){var e=c.open({type:"remote",scope:!1,controller:"feedEditTagController",resolve:{localData:{feed:n.feed},remoteData:function(){return n.feed.hasTagUsers()?i.getTagUsers(n.feed):{}}},templateUrl:"templates/home/feed-tag-user-edit.html"});e.result.then(function(e){e&&(n.feed=e),n.cancelEdit()})}n.showdroparrow=0,n.showCommentBox=!1,n.showShareBox=!1,n.showCommentView=!0,n.showShareForm=!1;var f=n.feed&&n.feed.value?n.feed.value:n.feed;if(f&&f.isSingleContentFeed()?(f.getMedias().length()||f.getAudios().length()?n.likeType="media":f.getImages(!0).length()&&(n.likeType="image"),n.likeTarget=f.getSingleContent()):(n.likeType="feed",n.likeTarget=f),n.shareMenuDisabled=n.shareMenuDisabled?n.shareMenuDisabled:!1,n.toggleCommentBox=function(e){e.stopPropagation(),n.showCommentBox=!n.showCommentBox,n.showCommentBox&&(n.showShareBox=!1)},n.ddTemplate='<div class="ng-cloak action feed-ac float-right"><div class="feed-line" ng-if="ddControl.showEdit()"><span class="img_sprite w-h-13 icon-edit-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edit\', feedKey: ddControl.feedKey})" href="#">Edit</a></div><div class="feed-line" ng-if="ddControl.showReportButton()"><span class="report-ico"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div><div class="feed-line" ng-if="ddControl.showTagButton()"><span class="img_sprite w-h-13 icon-add-tag feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edittag\', feedKey: ddControl.feedKey})" href="#" class="border-0">{{ddControl.tagButtonText()}}</a></div><div class="feed-line"  ng-if="ddControl.showDelete()"><span class="img_sprite w-h-13 icon-delete-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'delete\', feedKey: ddControl.feedKey})" href="#" class="border-0">Delete</a></div><div class="feed-line"  ng-if="ddControl.showSaveOption()"><span class="drop-sprite follow-drop save-ico w-h-13"></span><a rg-click="ddAction()({event: $event, action:\'save\', feedKey: ddControl.feedKey})" href="#" class="border-0">Save</a></div><div class="feed-line"  ng-if="ddControl.showUnsaveOption()"><span class="img_sprite w-h-13 icon-delete-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'unsave\', feedKey: ddControl.feedKey})" href="#" class="border-0">Unsave</a></div></div>',n.actionFeedDropdown=function(t){switch(e.close(t.event),t.event.preventDefault(),t.action){case"edit":n.enableEditor(t.feedKey);break;case"edittag":m();break;case"delete":n.deleteFeed(t.feedKey);break;case"save":n.saveFeed(t.feedKey,1);break;case"unsave":n.saveFeed(t.feedKey,2)}},n.noDownload=function(e){e.preventDefault(),o.show("Currently download option is available in ringID desktop and mobile app version only.")},n.selectAlbum=function(e){return{data:function(){return{media:e}}}},n.enableEditor=function(e){var t,r,o={};t=i.getFeed(e),o.localData={feed:t},t.showMore()?o.remoteData=i.moreFeedText(t):o.remoteData=!1,r=c.open({type:"remote",scope:!1,controller:"FeedEditController",scrollable:!0,resolve:o,templateUrl:"pages/partials/news_feed/edit.html"}),r.result.then(function(e){e.sucs?n.$rgDigest():RingLogger.print("cancelled Edit","FEED_EDIT")})},n.deleteFeed=function(e){var t="Are you sure you want to delete?",r=c.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"});r.result.then(function(t){t&&i.deleteFeed(n.currentUser,e).then(function(e){n.setFeed(!0),o.show(e,"success")},function(e){n.setFeed(!0),o.show(e,"error")})})},n.saveFeed=function(e,t){var r;i.saveFeed(e,t).then(function(o){if(o.sucs===!0){r=1===t;var a=i.getFeed(e);a.setPortalSaveStatus(r),n.$rgDigest()}})},n.getShareData=function(){return function(){return{keyid:n.keyid,feed:n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed}}},n.getImageData=function(e,t){return function(){return{image:e,feed:t}}},n.getMediaData=function(e,t){return{data:function(){return{media:e,playlist:t.getAlbum().getContents().all(),feedTime:t.time()}},promise:e.fetchDetails()}},n.getMediaFirstData=function(){var e=n.feed.getMedias().top();return e?n.getMediaData(e,n.feed):void 0},n.getAudioFirstData=function(){var e=n.feed.getAudios().top();return e?n.getMediaData(e,n.feed):void 0},n.goToFeed=g,n.isShareAble=function(e){return e=e.hasSharedFeed()?e.getOrginalFeed():e,e.isShareAble()},n.openRingBoxLike=function(){return n.feed.getTotalLikes()>0},n.openRingboxShare=function(){return(n.feed.hasSharedFeed()?n.feed.getOrginalFeed().getTotalShare()>0:n.feed.getTotalShare())>0&&!n.feed.isMediaShared()&&!n.feed.isSingleContentFeed()},n.whoShareFalsyFunc=function(){n.feed.isSingleContentFeed()&&o.show("Oops! This feature is coming soon","info")},!n.skipSaveScope){var E=n.feed.value?n.feed.value.getKey():n.feed.getKey();i.addScope(E,n),n.$on("$destroy",function(){i.removeScope(n.feed.getKey())})}}e.module("ringid.feed").controller("FeedSubController",n),n.$inject=["rgDropdownService","$rootScope","$scope","$location","feedFactory","Ringalert","MESSAGES","SystemEvents","$ringbox","Media","Utils","APP_CONSTANTS"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i){e.feed=i.create(t.newsFeedList[0]),e.hideSerial=!0,e.showCommentBox=!0,e.showFeedFullContent=!0,RingLogger.print(t,"FEED_MORE"),r("FeedSubController",{$scope:e})}e.module("ringid.feed").controller("PopupSingleFeedController",n),n.$inject=["$scope","remoteData","$boxInstance","$controller","$$feedMap"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a){function s(){t.boxIsLoading=!0,t.feeds.length<t.params.feed.getTotalShare()&&!t.busy&&(e.send({actn:g.TYPE_WHO_SHARES_LIST,nfId:t.params.feed.getKey(),st:t.feeds.length},g.REQUEST_TYPE.REQUEST),t.busy=!0,setTimeout(function(){t.busy=t.busy||!1,t.$rgDigest()},3e3),t.$rgDigest())}var c,l,u,d,g=i.SYSTEM;t.feeds=[],t.message="",t.boxIsLoading=t.params.boxIsLoading?t.params.boxIsLoading:!0;var m;t.params&&(m=r.getFeed(t.params.keyid)),t.showMessage=!1,t.shareMenuDisabled=!0,t.singleFeed=!0,t.busy=!1,t.boxHeight=o.windowHeight-20,c=e.subscribe(function(e){if(t.boxIsLoading=!1,t.isReady=!0,t.busy=!1,!e.sucs)return t.$close(),void a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error");if(e.newsFeedList.length)for(d=0;d<e.newsFeedList.length;d++){var r=n.create(e.newsFeedList[d]);r.getKey()===m.getKey()&&r.setIdenticalFeed(m),t.feeds.push(r)}t.$rgDigest()},{action:g.TYPE_WHO_SHARES_LIST}),t.loadMore=s,t.loadMore(),t.$on("$destroy",function(){r.removeIgnoreFilter(l),r.removeIgnoreFilter(u),e.unsubscribe(c)}),t.skipSaveScope=!0}e.module("ringid.feed").controller("FeedWhoShareController",n),n.$inject=["$$connector","$scope","$$feedMap","feedFactory","OPERATION_TYPES","$rootScope","Ringalert"]}(angular,window),function(e,t){"use strict";function n(e,t,n){t.viewType="ringbox",t.params=n,e("FeedWhoShareController",{$scope:t})}e.module("ringid.feed").controller("FeedRingboxWhoShareController",n),n.$inject=["$controller","$scope","localData"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o){function a(t){var r=h();s(),l(),d(),n.shareFeed(r).then(function(t){u(),g(),c(),d(),f(),p(),_(),T(t),e.media?(e.media.share(!0),e.$close()):e.popup?e.$close():e.$parent.$rgDigest()},function(t){u(),c(),I(t),e.$parent.$rgDigest()}),e.$rgDigest()}function s(){e.inputDisabled=!0}function c(){e.inputDisabled=!1}function l(){e.boxIsLoading=!0}function u(){e.boxIsLoading=!1}function d(){e.errorMessage=""}function g(){e.feedText=""}function m(t){e.feedLocation=t}function f(t){e.feedLocation=""}function E(t){m(t),e.$rgDigest()}function p(){r.$broadcast("FeedListChanged"),e.$broadcast("cleareditor")}function T(e){i.show(e,"success")}function h(){var t,n=e.media?null:e.feed,r={text:e.feedText,feed:n&&n.hasSharedFeed()?n.getOrginalFeed():n,location:e.feedLocation},i=e.media;if(e.emotions.length&&(r.mdIds=[e.emotions[0].id],e.emotions.length=0),e.tagList.length){for(r.tFrndIds=[],t=0;t<e.tagList.length;t++)r.tFrndIds.push(e.tagList[t].getUtId());e.tagList.length=0}return(i||n&&n.isSingleContentFeed()&&(n.getMedias().length()||n.getAudios().length()))&&(i=i||n.getSingleContent(),r.audio=i.isAudio(),r.cntntIDLst=[i.getKey()],r.addShare=!0,r.user=e.currentUser),r}function _(){e.afterShareCallback&&e.afterShareCallback()}function I(t){var n=o.getReasonMessageFromResponse(t);""==n&&(n="Unable To Share Status. Please Try Again Later"),e.errorMessage=n}e.feed=e.params.feed,e.afterShareCallback=e.params.afterShareCallback,e.updateFeedLocation=E,e.resetFeedLocation=f,e.currentUser=t.currentUser(),f(),g(),d(),c(),u(),e.shareFeed=a,e.emotions=[],e.tagList=[],e.addTag=function(t){var n=e.tagList.indexOf(t);-1===n&&e.tagList.push(t)},e.removeTag=function(t){var n=e.tagList.indexOf(t);n>=0&&e.tagList.splice(n,1)},e.chooseEmotion=function(t){e.emotions.length=0,e.emotions.push(t)}}e.module("ringid.feed").controller("feedShareController",n),n.$inject=["$scope","Auth","feedFactory","$rootScope","Ringalert","Utils"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){e.params={feed:r.feed,afterShareCallback:e.$close,showSharePostBox:!0},n("feedShareController",{$scope:e})}e.module("ringid.feed").controller("feedRingboxShareController",n),n.$inject=["$scope","$boxInstance","$controller","localData"]}(angular,window),function(e,t){"use strict";function n(e,t){e.params={feed:e.feed,afterShareCallback:e.closeShareBox,showSharePostBox:!0},t("feedShareController",{$scope:e})}function r(t,n){t.params={feed:null,afterShareCallback:e.noop,showSharePostBox:!0},t.closeShareBox=function(){t.$close()},t.autoAdjustScroll="false"}function i(e){e.closeShareBox=function(){e.$close()},e.autoAdjustScroll="false",e.popup=!0}e.module("ringid.feed").controller("feedMediaShareController",r).controller("feedNewsPortalShareController",i).controller("feedInlineShareController",n),n.$inject=["$scope","$controller"],r.$inject=["$scope","$controller"],i.$inject=["$scope"]}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedAddController",["fileUploadService","$rootScope","$scope","feedFactory","$timeout","$routeParams","SystemEvents","OPERATION_TYPES","rgDropdownService","PrivacySet","MESSAGES","settings",function(t,n,r,i,o,a,s,c,l,u,d,g){r.privacySet=u,"circle"==r.forAdd||"friend"===r.forAdd?r.showPrivacy=!1:(r.showPrivacy=!0,r.privacy=u.PVC3),r.setPrivacy=function(e){r.privacy=u["PVC"+e.privacy],l.close(e.event),r.$rgDigest()},r.privacyTemplate='<div class="ng-cloak action  ab-drop postbox-action"><div class="a-box" ><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC1.value})" href="#"><span class="{{::ddControl.PVC1.icon}} ab-delete"></span> {{::ddControl.PVC1.text}}</a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC2.value})" href="#"><span class="{{::ddControl.PVC2.icon}} ab-delete"></span> {{::ddControl.PVC2.text}} </a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC3.value})" href="#"><span class="{{::ddControl.PVC3.icon}} ab-delete"></span> {{::ddControl.PVC3.text}}</a></div></div>',r.feedText="",r.feedLocation={},r.ogData={},r.filterOnProgress=!1,r.ogDataLoading=!1,r.ogShowPreview=!1,r.inputDisabled=!1,r.getValidityValues=function(){return new Array(30)},r.showTimeout=!1,r.validity=-1;var m={vldt:r.validity};"friend"===r.forAdd?m.friend=a.uId:"circle"===r.forAdd&&(m.group=a.circleId),r.$on(s.FILE_UPLOAD.QUEUE_START,function(){r.inputDisabled=!0,r.$rgDigest()}),r.$on(s.FILE_UPLOAD.QUEUE_COMPLETE,function(){r.inputDisabled=!1,r.$rgDigest()}),r.shouldDisableInput=function(){return r.inputDisabled||r.ogDataLoading||r.filterOnProgress},r.shouldDisableLocation=function(){return t.imageFiles.length>0||t.videoFiles.length>0||t.audioFiles.length>0||!!r.ogData.url},r.shouldDisableLink=function(){return t.imageFiles.length>0||t.videoFiles.length>0||t.audioFiles.length>0||!!r.feedLocation.lat},r.shouldDisableMedia=function(){return!!r.ogData.url||!!r.feedLocation.lat};var f,E,p=(new Date).getTime();for(r.addFeed=function(){function n(){return!!s.lnkURL||s.images.length>0||s.videos.length>0||s.audios.length>0||!!s.mdIds&&s.mdIds.length>0||!!s.lctn||!!s.tFrndIds&&s.tFrndIds.length>0}function o(){var e=!0;if(r.errorMessage="",""!==s.text){var t,i=s.text.length,o=s.text.getUTF8Length();o>g.FEED_TEXT_LIMIT&&(t=Math.floor(i*g.FEED_TEXT_LIMIT/o),r.errorMessage=d.FTL_ERROR.supplant({length:i,max_limit:t}),e=!1)}else n()||(e=!1,r.errorMessage=d.FEED_INV);return e}function a(){p=f,RingLogger.print(s.text,"FEED_TEXT"),RingLogger.print(s.text.length,"FEED_TEXT"),RingLogger.print(s.text.getUTF8Length(),"FEED_TEXT"),i.addFeed(s,r.currentUser).then(function(e){r.setFeed(e),r.$parent.$rgDigest()},function(){r.setFeed(),r.feedText=c,r.$broadcast("seteditor",c),r.$parent.$rgDigest()},function(e){}),t.imageFiles.length=0,t.imageFiles=[],t.videoFiles.length=0,t.videoFiles=[],t.audioFiles.length=0,t.audioFiles=[],r.feedText="",r.validity=-1,r.feedLocation={},r.ogData={},r.ogShowPreview=!1,r.inputDisabled=!1,r.errorMessage="",r.setFeed(),r.$broadcast("cleareditor"),r.$parent.$rgDigest()}var s={vldt:r.validity};if(r.inputDisabled=!0,s=e.extend({},m,{text:r.feedText,vldt:r.validity,images:t.imageFiles,videos:t.videoFiles,audios:t.audioFiles}),r.privacy&&(s.fpvc=r.privacy.value),r.feedLocation.description&&(s.lctn=r.feedLocation.description,s.lat=r.feedLocation.lat,s.lng=r.feedLocation.lng),r.ogData.url&&(s.lnkDmn=r.ogData.lnkDmn||r.ogData.url||"",s.lnkDsc=r.ogData.description||"",s.lnkTtl=r.ogData.title||"",s.lnkURL=r.ogData.url||"",s.lnlImgURL=r.ogData.image||""),r.emotions.length&&(s.mdIds=[r.emotions[0].id],r.emotions.length=0),r.tagList.length){for(s.tFrndIds=[],E=0;E<r.tagList.length;E++)s.tFrndIds.push(r.tagList[E].getUtId());r.tagList.length=0}var c=r.feedText;if(""!=s.text&&s.lnkURL){var l=s.text.replace("https","").replace("http",""),u=s.lnkURL.replace("https","").replace("http","");"/"==l[l.length-1]&&(l=l.slice(0,-1)),"/"==u[u.length-1]&&(u=u.slice(0,-1)),l==u&&(s.text="")}o()?(f=Date.now(),200>f-p?setTimeout(a,200):a()):(r.inputDisabled=!1,r.ogShowPreview=!1,r.$rgDigest())},r.selectOptions=[],r.selectOptions[0]={value:-1,title:"Unlimited"},E=1;30>=E;E++)r.selectOptions[E]={value:E,title:E+" Day"};r.selectedTimeout=function(e){r.validity=e,r.$rgDigest()},r.selectedLocation=function(e){r.feedLocation=e,r.$rgDigest()},r.resetFeedLocation=function(){r.feedLocation={},r.$rgDigest()},r.emotions=[],r.tagList=[],r.addTag=function(e){var t=r.tagList.indexOf(e);-1===t&&r.tagList.push(e),r.$rgDigest()},r.removeTag=function(e){var t=r.tagList.indexOf(e);t>=0&&r.tagList.splice(t,1),r.$rgDigest()},r.chooseEmotion=function(e){r.emotions.length=0,r.emotions.push(e),r.$rgDigest()};var T=i.getCurrentPageValue();r.showAddTag=T.action!==c.SYSTEM.TYPE_GROUP_NEWS_FEED}])}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s){function c(){return E.getDynamicText()}function l(){r.feedLocation={}}function u(e){r.feedLocation=e,r.$rgDigest()}function d(e){r.emotions.length=0,r.emotions.push(e),r.$rgDigest()}function g(){return!(r.feedText||r.feedLocation.description||r.ogData.url||r.feelings&&r.feelings.id||r.feed.hasMedia()||r.feed.hasTagUsers())}function m(){r.feedText=r.feedText.trim(),r.emotions.length?(r.feelings=r.emotions[0],r.emotions.length=0):r.feelings=!1,g()?(r.errorImageEdit=!0,r.editorEnabled=!0):(r.sentRequest=!0,a.updateFeed(t.currentUser(),E,r.feedText,r.feedLocation,r.ogData,r.feelings).then(function(e){RingLogger.print(e,RingLogger.tags.FEED),e.sucs?r.$close({sucs:!0}):(r.sentRequest=!1,s.show(e,"error"),r.$rgDigest())},function(e){s.show(e,"error"),r.$rgDigest()})),r.$rgDigest()}function f(){r.$close({sucs:!1})}var E=i.feed;r.emotions=[],r.editorEnabled=!1,r.errorImageEdit=!1,r.feedLocation={},r.ogData=r.ogData||{},r.filterOnProgress=!1,r.ogDataLoading=!1,r.ogShowPreview=!1,r.previousFeedLocation="",r.feedEditChooseEmotion=d,r.cancelEdit=f,r.updateFeed=m,r.selectedFeedLocation=u,r.resetFeedLocation=l,r.getFeedHtml=c,o&&(o.newsFeedList?E.parseMoreText(o.newsFeedList[0]):E.parseMoreText(o)),r.editorEnabled=!0,r.feedText=E.text(),r.feedLocation=e.copy(E.getLocationInfo()),r.ogData=e.copy(E.getOgData()),r.ogData.image&&(r.ogData.images=[r.ogData.image]),r.ogShowPreview=E.hasOgData(),r.emotions=E.hasFeelings()?[E.getFeelings()]:[],r.sentRequest=!1,RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from FeedEditController",RingLogger.tags.DIGEST)}),r.contentHightChanged=function(){r.$emit(n.RINGBOX.UPDATE)}}e.module("ringid.feed").controller("FeedEditController",n),n.$inject=["Auth","SystemEvents","$scope","localData","remoteData","feedFactory","Ringalert"]}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedDashboardController",["$scope","$controller","OPERATION_TYPES","Ringalert",function(e,t,n,r){e.pagekey=n.SYSTEM.TYPE_NEWS_FEED+".all",e.action=n.SYSTEM.TYPE_NEWS_FEED,e.params={actn:n.SYSTEM.TYPE_NEWS_FEED},e.forAdd="my",t("FeedMainController",{$scope:e})}])}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedProfileController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i,o,a=n.uId,s=a;e.currentUser&&e.currentUser.equals(a)?(i="my",o=r.SYSTEM.TYPE_MY_NEWS_FEED):(i="friend",o=r.SYSTEM.TYPE_FRIEND_NEWSFEED),s=o+"."+a,e.pagekey=s,e.action=o,e.params={actn:o,fndId:a},e.forAdd=i,e.sortBy="at",t("FeedMainController",{$scope:e})}])}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedCircleController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="circle",a=n.circleId,s=r.SYSTEM.TYPE_GROUP_NEWS_FEED+"."+a;e.pagekey=s,e.action=r.SYSTEM.TYPE_GROUP_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_GROUP_NEWS_FEED,grpId:a},e.forAdd=o,e.shareMenuDisabled=!0,t("FeedMainController",{$scope:e})}])}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedMediasController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="my",a=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED+".medias";e.pagekey=a,e.action=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,pvtid:0,st:0,mtf:0},e.a_f_m="f",e.setTrending=function(t){e.params.mtf=t;var n=e.a_f_m;1===t?e.a_f_m="t":e.a_f_m="f",n!==e.a_f_m&&(i.reset(),i.initFeedRequest(e.params),e.$rgDigest())},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}])}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("FeedNewsportalController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="newsportal",a=r.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal";e.pagekey=a,e.action=r.SYSTEM.TYPE_NEWS_PORTAL_FEED,e.params={actn:r.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},e.isReady=!0,e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}])}(angular,window),function(e,t){"use strict";function n(e,t,n,r){var i=t.fTgLst;e.usersUtIds=[],e.users=[];var o=i.length;if(o){e.total=o;for(var a=0;a<i.length;a++)i[a].fn=i[a].nm,e.users.push(n.createByUtId(i[a],!0))}e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:r.user.getMutualFriends(e)}}}e.module("ringid.feed").controller("feedTagUserListController",n),n.$inject=["$scope","remoteData","userFactory","Api"]}(angular,window),function(e,t){"use strict";function n(){return function(e,t){if(e){for(var n=[],r=new RegExp(t,"i"),i=0;i<e.length;i++)e[i].getName().match(r)&&n.push(e[i]);return n}}}function r(e,t,n,r,i,o,a,s,c,l,u){function d(){e.users=s("filterUserByName")(h,e.filterText)}function g(){E||(c.searchContact({schPm:e.filterText},!0),e.loading=!0,E=!0)}function m(){if("a"!==e.currentType)return void d();c.friends.doForAll(function(e){var t=e.getLiteUser();-1===h.contains(t,function(e,t){return e.equals(t,"utId")})&&-1===p.contains(t,function(e,t){return e.equals(t,"utId")})&&h.push(t)});var t=p.filter(function(e){return-1===h.contains(e,function(e,t){return e.equals(t,"utId")})});h=h.concat(t),d()}var f=t.feed,E=!1,p=[],T=[],h=[];e.users=[],e.filterText="",e.loading=!0,e.currentType="a";var _=u.currentUser();if(e.$watch("filterText",function(t,n){d(),e.users.length<5&&t.length>n.length?(E=!1,g()):(E=!1,e.loading=!1)}),e.$watch(c.friends.length(),function(t,n){m(),e.loading=!1,E=!1}),n&&n.fTgLst&&n.fTgLst.length){for(var I=0;I<n.fTgLst.length;I++)n.fTgLst[I].fn=n.fTgLst[I].nm,-1===p.contains(n.fTgLst[I].utId,function(e,t){return e.equals(t,"utId")})&&(p.push(a.createByUtId(n.fTgLst[I],!0)),T.push(p[I]));m()}e.loading=!1,f.hasTagUsers()||m(),e.toggle=function(t){e.currentType!=t&&(e.currentType=t,"a"==t?(h=[],m()):(h=p,d()))},e.checked=function(e){return p.indexOf(e)>-1},e.loadMore=function(){e.filterText.length?g():(c.getContactDetails(),e.loading=!0)},e.addRemoveTag=function(t,n){var r=p.indexOf(n);r>-1?p.splice(r,1):(p.push(n),e.users.length-p.length<5&&e.loadMore())},e.saveTagUser=function(){var t,n=T.difference(p),r=p.difference(T);if(!n.length&&!r.length)return void l.show("Please Make Your Changes Before Submit","warning");if(0===r.length&&n.length===T.length&&!f.validateForUpdateTag())return void l.show("You can't submit an empty feed","warning");var o={},a={};if(n.length)for(t=0;t<n.length;t++)o[n[t].getUtId()]=!0;if(r.length)for(t=0;t<r.length;t++)a[r[t].getUtId()]=!0;var s={removed:Object.keys(o),"new":Object.keys(a)};i.updateFeed(_,f,f.text(),f.getLocationInfo(),!1,f.getFeelings(),s).then(function(t){f.updateTagUser(t),e.$close(f)},function(e){l.show(e,"error")})},e.$on("$destroy",function(){})}e.module("ringid.feed").filter("filterUserByName",n).controller("feedEditTagController",r),r.$inject=["$scope","localData","remoteData","$$connector","feedFactory","OPERATION_TYPES","userFactory","$filter","friendsFactory","Ringalert","Auth"]}(angular,window),function(e,t){"use strict";function n(){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",templateUrl:function(e,t){return t.templatepath}}}e.module("ringid.feed").directive("rgCommonFeedTop",n),n.$inject=[]}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath}}}e.module("ringid.feed").directive("rgCommonFeedBottom",n),n.$inject=[]}(angular,window),function(e,t){"use strict";function n(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}e.module("ringid.feed").directive("rgCommonFeedDetails",n)}(angular,window),function(e,t){"use strict";e.module("ringid.chat",["ringid.config","ringid.sticker","ngWebSocket","ringid.utils","ringid.connector","angularAudioRecorder"])}(angular,window),function(e,t){"use strict";!function(e){e.CHAT_APP={GLOBALS:{uId:-1,appVersion:-1},Constants:{},PacketFormats:{},PacketFormats:{},AuthPacketSender:{},AuthRequests:{},AuthResponses:{},ChatPacketSender:{},Helpers:{},ResponseHelpers:{},SharedHelpers:{},ChatPacketParser:{},PacketSendFlow:{},ChatSessionPacketSender:{},ChatOnlinePacketSender:{},ChatOfflinePacketSender:{},MODELS:{SESSION_OBJECT:{}},CHAT_CLOCK:{},REQUEST_CACHE:{},RESPONSE_CACHE:{},CHAT_SESSION:{},BROKEN_PACKET_CACHE:{},UTILS:{},ChatConnector:{},AuthConnector:{},getCurrentUserId:function(){return CHAT_APP.GLOBALS.uId},getAppVersion:function(){return CHAT_APP.GLOBALS.appVersion},getOfflineIp:function(){return CHAT_APP.GLOBALS.oIpPort.ip},getOfflinePort:function(){return CHAT_APP.GLOBALS.oIpPort.port},Init:function(){}}}(t)}(angular,window),function(e,t){"use strict";!function(t){var n={FRIEND_CHAT_REGISTER:1,FRIEND_CHAT_UNREGISTER:2,FRIEND_CHAT_REGISTER_CONFIRMATION:3,FRIEND_CHAT_IDLE:4,FRIEND_CHAT_TYPING:5,FRIEND_CHAT_MSG:6,FRIEND_CHAT_MSG_EDIT:7,FRIEND_CHAT_BROKEN_MSG:8,FRIEND_CHAT_BROKEN_MSG_EDIT:9,FRIEND_CHAT_MULTIPLE_MSG:10,FRIEND_CHAT_DELIVERED:15,FRIEND_CHAT_SENT:16,FRIEND_CHAT_SEEN:17,FRIEND_CHAT_SEEN_CONFIRMATION:18,FRIEND_CHAT_MULTIPLE_MSG_DELETE:19,FRIEND_CHAT_MSG_DELETE_CONFIRMATION:20,FRIEND_CHAT_BROKEN:24,FRIEND_CHAT_BROKEN_CONFIRMATION:25,FRIEND_CHAT_BLOCK:27,FRIEND_CHAT_UNBLOCK:28,FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION:29},r={TAG_CHAT_TAG_REGISTER:41,TAG_CHAT_TAG_UNREGISTER:42,TAG_CHAT_TAG_REGISTER_CONFIRMATION:43,TAG_CHAT_TAG_INFORMATION:46,TAG_CHAT_TAG_INFORMATION_CONFIRMATION:47,TAG_CHAT_TAG_MEMBER_ADD:51,
TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION:52,TAG_CHAT_MEMBER_REMOVE_LEAVE:53,TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION:54,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE:55,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION:56,TAG_CHAT_IDLE:61,TAG_CHAT_TYPING:62,TAG_CHAT_MSG:63,TAG_CHAT_MSG_EDIT:64,TAG_CHAT_BROKEN_MSG:65,TAG_CHAT_BROKEN_MSG_EDIT:66,TAG_CHAT_MULTIPLE_MSG:67,TAG_CHAT_DELIVERED:68,TAG_CHAT_SENT:69,TAG_CHAT_SEEN:70,TAG_CHAT_SEEN_CONFIRMATION:71,TAG_CHAT_MULTIPLE_MSG_DELETE:72,TAG_CHAT_MSG_DELETE_CONFIRMATION:73,TAG_CHAT_GENERAL_BROKEN_PACKET:74,TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION:75},i={OFFLINE_FRIEND_INFORMATION:91,OFFLINE_FRIEND_INFORMATION_CONFIRMATION:92,OFFLINE_GET_REQUEST:93,OFFLINE_GET_REQUEST_CONFIRMATION:94,OFFLINE_FRIEND_UNREAD_MESSAGE:95,OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:96,OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST:97,OFFLINE_FRIEND_HISTORY_MESSAGE:98,OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION:99,OFFLINE_GET_FRIEND_MESSAGE_STATUS:100,OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION:101,OFFLINE_TAG_INFORMATION_ACTIVITY:104,OFFLINE_MY_TAG_LIST:105,OFFLINE_TAG_UNREAD_MESSAGE:106,OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:107,OFFLINE_TAG_CREATE_TAG:108,OFFLINE_TAG_CREATE_TAG_CONFIRMATION:109,OFFLINE_TAG_HISTORY_MESSAGE_REQUEST:110,OFFLINE_TAG_HISTORY_MESSAGE:111,OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS:112,OFFLINE_TAG_INFORMATION_WITH_MEMBERS:113,OFFLINE_TAG_CONFIRMATION:117,OFFLINE_BROKEN_HISTORY_PACKET:118,OFFLINE_BROKEN_PACKET:119,OFFLINE_BROKEN_PACKET_CONFIRMATION:120},o=Object.assign({},n,r,i),a={};a[n.FRIEND_CHAT_REGISTER]=n.FRIEND_CHAT_REGISTER_CONFIRMATION,a[n.FRIEND_CHAT_MSG]=[n.FRIEND_CHAT_SENT,n.FRIEND_CHAT_DELIVERED,n.FRIEND_CHAT_SEEN],a[n.FRIEND_CHAT_MSG_EDIT]=[n.FRIEND_CHAT_SENT,n.FRIEND_CHAT_DELIVERED,n.FRIEND_CHAT_SEEN],a[n.FRIEND_CHAT_BROKEN_MSG]=[n.FRIEND_CHAT_SENT,n.FRIEND_CHAT_DELIVERED,n.FRIEND_CHAT_SEEN],a[n.FRIEND_CHAT_BROKEN_MSG_EDIT]=[n.FRIEND_CHAT_SENT,n.FRIEND_CHAT_DELIVERED,n.FRIEND_CHAT_SEEN],a[n.FRIEND_CHAT_DELIVERED]=[n.FRIEND_CHAT_SEEN,n.FRIEND_CHAT_SEEN_CONFIRMATION],a[n.FRIEND_CHAT_SEEN]=n.FRIEND_CHAT_SEEN_CONFIRMATION,a[n.FRIEND_CHAT_BROKEN]=n.FRIEND_CHAT_BROKEN_CONFIRMATION,a[n.FRIEND_CHAT_MULTIPLE_MSG_DELETE]=n.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,a[i.OFFLINE_FRIEND_INFORMATION]=i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,a[i.OFFLINE_FRIEND_UNREAD_MESSAGE]=i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,a[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]=i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,a[i.OFFLINE_FRIEND_HISTORY_MESSAGE]=i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,a[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]=i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,a[r.TAG_CHAT_TAG_REGISTER]=r.TAG_CHAT_TAG_REGISTER_CONFIRMATION,a[r.TAG_CHAT_TAG_INFORMATION]=r.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,a[r.TAG_CHAT_TAG_MEMBER_ADD]=r.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,a[r.TAG_CHAT_MULTIPLE_MSG_DELETE]=r.TAG_CHAT_MSG_DELETE_CONFIRMATION,a[r.TAG_CHAT_MEMBER_REMOVE_LEAVE]=r.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,a[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]=r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,a[r.TAG_CHAT_GENERAL_BROKEN_PACKET]=r.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,a[r.TAG_CHAT_MSG]=[r.TAG_CHAT_SENT,r.TAG_CHAT_DELIVERED,r.TAG_CHAT_SEEN],a[r.TAG_CHAT_MSG_EDIT]=[r.TAG_CHAT_SENT,r.TAG_CHAT_DELIVERED,r.TAG_CHAT_SEEN],a[r.TAG_CHAT_BROKEN_MSG]=[r.TAG_CHAT_SENT,r.TAG_CHAT_DELIVERED,r.TAG_CHAT_SEEN],a[r.TAG_CHAT_BROKEN_MSG_EDIT]=[r.TAG_CHAT_SENT,r.TAG_CHAT_DELIVERED,r.TAG_CHAT_SEEN],a[r.TAG_CHAT_DELIVERED]=[r.TAG_CHAT_SEEN,r.TAG_CHAT_SEEN_CONFIRMATION],a[r.TAG_CHAT_SEEN]=r.TAG_CHAT_SEEN_CONFIRMATION,a[i.OFFLINE_TAG_CREATE_TAG]=i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,a[i.OFFLINE_GET_REQUEST]=i.OFFLINE_GET_REQUEST_CONFIRMATION,a[i.OFFLINE_TAG_UNREAD_MESSAGE]=i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,a[i.OFFLINE_BROKEN_PACKET]=i.OFFLINE_BROKEN_PACKET_CONFIRMATION,a[i.OFFLINE_BROKEN_HISTORY_PACKET]=i.OFFLINE_BROKEN_PACKET_CONFIRMATION,a[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]=i.OFFLINE_TAG_CONFIRMATION,a[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]=i.OFFLINE_TAG_CONFIRMATION;var s={PACKET_IP_SIZE:4,PACKET_PORT_SIZE:2,PACKET_DYNAMIC_ATTRIBUTE:-1,PACKET_RAW_BYTE_ATTRIBUTE:-2,ONE_BYTE_SIZE:1,TWO_BYTE_SIZE:2,FOUR_BYTE_SIZE:4,EIGHT_BYTE_SIZE:8,PACKET_MAX_SIZE:512,TAG_ID_NO_OF_TIME_DIGIT:10,TAG_ID_NO_OF_USER_ID_DIGIT:6,OFFLINE_PACKET_TYPE_START:91,ATTRIBUTE_TYPE:{INTEGER:1,STRING:2,BYTE:3}},c={LOCAL_CHAT:!1,LOCAL_CHAT_REG_IP:"192.168.1.125",LOCAL_CHAT_REG_PORT:1500,LOCAL_CHAT_OFFLINE_IP:"192.168.1.125",LOCAL_CHAT_OFFLINE_PORT:1200,API_VERSION:3,API_VERSION_PORT_OFFSET:0,AUTH_UID_LIST_LIMIT:15,ACTUAL_TAG_REGISTER_TIMEOUT:180,TAG_REGISTER_TIMEOUT:160,API_FETCH_RETRY_COUNT:5,API_FETCH_RETRY_DELAY:3e3,RETRY_COUNT:5,AUTH_REQUEST_TIMEOUT:2e3,REQUEST_TIMEOUT:15e3,BOX_WAITING_TIME:180,UDP_SERVER_KEEP_ALIVE_INTERVAL:1e4,REQUEST_CACHE_VALIDITY:15e3,RESPONSE_CACHE_VALIDITY:4e3,BROKEN_CACHE_VALIDITY:3e5,TEMP_MESSAGE_CACHE_VALIDITY:12e4,SESSION_TYPES:{FRIEND:1,TAG:2},REQUEST_TYPES:{FRIEND:1,TAG:2},MEMBER_STATUS:{MEMBER:1,ADMIN:2,OWNER:3,REMOVED:4,LEAVE:5},MEMBER_MOODS:{ONLINE:1,AWAY:2,OFFLINE:3,DO_NOT_DISTURB:4},REGISTRATION_TYPES:{CREATE:1,ONLY_REGISTER:2,CHAT_INVITE:3},MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,TEXT:2,EMOTICON_MESSAGE:3,LOCATION_SHARE:4,LINK_SHARE:5,STICKER:6,IMAGE:7,AUDIO:8,VIDEO:9,CAMERA_IMAGE:10,FILE_STREAM:11,CONTACT_SHARE:12,FILE_STREAM_MAINIFEST:13,HISTORY_RE_FETCH:14,RING_MEDIA_MESSAGE:15,GROUP_ACTIVITY:20,TYPING:101},STATUS_MESSAGE_TYPES:{TAG_MEMBER_ADD:1,TAG_MEMBER_DELETE:2,TAG_MEMBER_LEAVE:3,TAG_MEMBER_STATUS_CHANGE_OWNER:4,TAG_MEMBER_STATUS_CHANGE_ADMIN:5,TAG_MEMBER_STATUS_CHANGE_MEMBER:6,TAG_NAME_CHANGE:7,TAG_PICTURE_CHANGE:8,TAG_INFO_UPDATED:9,TAG_ADMIN_ADD:10},PAGE_DIRECTION:{UP:1,DOWN:2},PAGE_LIMIT:10,ONLINE_STATUS:{OFFLINE:1,ONLINE:2,AWAY:3},ONLINE_MOOD:{ALIVE:1,DONT_DISTURB:2,BUSY:3,INVISIBLE:4},SECRET_VISIBILITY:{NON_VISIBLE:0,VISIBLE:1},TAG_ACTIVITY_TYPE:{DELETED:0,ADDED:1,LEAVE:2,TAG_RENAME:3,MEMBER_TYPE_CHANGE:4,TAG_URL_RENAME:5,TAG_CREATED:6},USER_PRESENCE:{OFFLINE:1,ONLINE:2,AWAY:3},HISTORY_MAX_MESSAGE:10,TAB_SYNC_MAX_TIME:18e4,TAB_SYNC_ACTIONS:{AUTH_REQUEST:0,CHAT_REQUEST:1,GENERAL_INFO_UPDATE:3,CHAT_BOX_INFO_UPDATE:4,SECRET_CHAT_TIMER:5,CHAT_HISTORY_REFRESH:6,CHAT_MSESSAGE_UPDATE:7},MAX_TASK_RETRY_COUNT:15,SHARED_WORKER_PATH:"js/worker/chat/shared.js",CHAT_WORKER_PATH:"/js/worker/chat/chat.worker.js"},l={KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},u={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_USER_MOOD_PRESENCE:199,GET_OFFLINE_IP_PORT:83},d={};d[u.RECEIVED_F2F_CHAT]=u.START_TAG_CHAT,d[u.RECEIVED_TAG_CHAT]=u.START_TAG_CHAT;var g={DEBUG:0,AUTH_REQUEST_RESPONSE:1,CHAT_REQUEST_RESPONSE:2,CHAT_DATA_RECEIVED:3,AUTH_DATA_RECEIVED:4,EXCEPTION:5,CHAT_TIMER_UPDATE:6,RE_INIT:7},m={serverTimeDiff:0,serverTime:0,offlineUpdateTime:0},f={version:"2.5"},E={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},p={OFFLINE:1,ONLINE:2},T={MESSAGE_SENDING:{ONLINE_IP_PORT_REQUEST:0,FIRST_ONLINE:1,PRESENCE_REFRESH:2,SECOND_ONLINE:3,ONLINE_IP_PORT_REFRESH:4,THIRD_ONLINE:5,ONLINE_SUCCESS:6,ONLINE_FAILED:7,FIRST_OFFLINE:101,OFFLINE_IP_PORT_REFRESH:102,SECOND_OFFLINE:102,OFFLINE_FAILED:104,OFFLINE_SUCCESS:105,SUCCESS:201,FAILED:202}},h={PERMISSION_DENIED:1},_=({SEND_MESSAGE:[T.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,T.MESSAGE_SENDING.FIRST_ONLINE,T.MESSAGE_SENDING.PRESENCE_REFRESH,T.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,T.MESSAGE_SENDING.ONLINE_FAILED,T.MESSAGE_SENDING.FIRST_OFFLINE,T.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]},{});!function(n,r,i){var o,a,s,c,l=t.angular&&e.isObject||t.isObject;for(o in n)if(a=n[o],l(a)){n[o+"_VALUE"]=[];for(s in a)c=a[s],n[o+"_VALUE"][c]=s}for(var u=Object.keys(r.MESSAGE_SENDING),d=0,g=u.length;g>d;d++){var m=r.MESSAGE_SENDING[u[d]];try{i[m].NAME=u[d]}catch(f){i[m]={},i[m].NAME=u[d]}}}(c,T,_),t.CHAT_APP.Constants={FRIEND_CHAT_PACKET_TYPE:n,TAG_CHAT_PACKET_TYPE:r,OFFLINE_PACKET_TYPE:i,PACKET_TYPES:o,CONFIRMATION_MAP:a,GENERAL_CONSTANTS:c,PACKET_CONSTANTS:s,WORKER_NOTIFIER_TYPES:g,AUTH_SERVER_ACTIONS:u,AUTH_SERVER_REQUEST_UPDATE_MAP:d,CHAT_STATES:T,CHAT_STATE_INFO:_,CHAT_GLOBAL_VALUES:m,AUTH_REQUEST_TYPE:l,PLATFORM:E,CHAT_VERSION_INFO:f,RESPONSE_REASON_CODES:h,CHAT_SERVER_TYPES:p}}(t)}(angular,window),function(e,t){"use strict";!function(e){function t(t,n){var r,i=CHAT_APP.SharedHelpers.getChatServerCurrentTime(),o=e.CHAT_APP.getCurrentUserId();return r=n||t?t:i,r||Logger.debug("alert","Invalid Timestamp","CHAT"),PacketIDGenerator.create(o,r,n)}function n(e,t,n,r,i){var o=0,a=function(){!o||r>o&&!t.call(null,o)?(e.call(),o++,setTimeout(a,i)):t.call(null,o)||n.call()};a()}function r(e){var t=CHAT_APP.SharedHelpers.getCurrentChatServerTime();return t-e<a.ACTUAL_TAG_REGISTER_TIMEOUT}function i(){function e(e,t,n){var r=getUniqueId("ctr");return o[r]=e,a[r]={delay:t,count:t,maxIteration:n},r}function t(e){delete o[e],delete a[e],Logger.debug("debug","TIMER DELETED FOR ID "+e,"CHAT_TIMER_DEBUG")}function n(e,t){s[e]||(s[e]={});var n=getUniqueId("ccl");return s[e][n]=t,n}function r(e,t){delete s[e][t]}var i=this,o={},a={},s={},c=null;i.setTimeout=function(t,n){if(n>999){var r=i.hasTimer(),o=e(t,n,1);return r?void 0:i.start(),Logger.debug("debug","TIMETOUT SET FOR ID "+o,"CHAT_TIMER_DEBUG"),o}return Logger.debug("error","USE CHAT CLOCK TIMER FOR WAIT TIME > 1000msc, Use Default Timeout/Interval for < 1000msc.","CHAT_TIMER_DEBUG"),0},i.setInterval=function(t,n,r){if(n>999){var o=i.hasTimer(),a=e(t,n,r||-1);return o?void 0:i.start(),Logger.debug("debug","INTERVAL SET FOR ID "+a,"CHAT_TIMER_DEBUG"),a}return Logger.debug("error","USE CHAT CLOCK TIMER FOR WAIT TIME > 1000msc, Use Default Timeout/Interval for < 1000msc.","CHAT_TIMER_DEBUG"),0},i.clearTimeout=function(e){t(e)},i.clearInterval=function(e){t(e)},i.hasTimer=function(){return Object.keys(a).length>0},i.on=function(e,t){return n(e,t)},i.off=function(e,t){r(e,t)},i.trigger=function(e,t){if(s[e]){var n=Object.keys(s[e]);n.forEach(function(n){s[e][n].call(this,t)})}},i.stop=function(){clearInterval(c)},i.start=function(){c=setInterval(function(){i.trigger("TICK");for(var e=Object.keys(a),n=0;n<e.length;n++){var r=e[n],s=a[r];s&&(0==s.maxIteration?t(r):0==s.count||-1==s.maxIteration?(o[r].call(),-1!=s.maxIteration?s.count=s.delay:void 0):(s.count--,-1!=s.maxIteration?s.maxIteration--:void 0))}},1e3)}}var o=e.CHAT_APP.Constants,a=o.GENERAL_CONSTANTS;o.CHAT_GLOBAL_VALUES;e.CHAT_APP.UTILS={hasChatSession:r,getUUIDPacketId:t,callXTimeAfterYIntervalStopOnSuccess:n,ChatClock:i}}(t)}(angular,window),function(e,t){"use strict";!function(e){function t(){if(o.serverTime>0){var e=Date.now()+o.serverTimeDiff,t=e-o.serverTime,n=o.serverTime+t%1e3;return n}return Date.now()}function n(e){var n=Date.now()-t(),r=e+n;return r}var r=e.CHAT_APP,i=r.Constants,o=(i.GENERAL_CONSTANTS,i.CHAT_GLOBAL_VALUES);r.ChatConnector;e.CHAT_APP.SharedHelpers={getChatServerCurrentTime:t,getClientTimeFromServerTime:n}}(t)}(angular,window),function(e,t){"use strict";!function(e){var t=e.CHAT_APP.Constants,n=t.FRIEND_CHAT_PACKET_TYPE,r=t.TAG_CHAT_PACKET_TYPE,i=t.OFFLINE_PACKET_TYPE,o=t.PACKET_CONSTANTS,a={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,LAST_ONLINE_TIME:26,NO_OF_ITEMS:27,BLOCK_UNBLOCK_DATE:28,MESSAGE_STATUS:29,IS_ADD_TO_DB:30,TAG_NAME_LENGTH:31,TAG_NAME:32,TAG_PICTURE_URL_LENGTH:33,TAG_PICTURE_URL:34,TAG_MEMBER_TYPE:35,TAG_MEMBER_ADDED_BY:36,TAG_NO_OF_MEMBERS:37,TAG_NO_OF_BROKEN_PKT:38,TAG_INFORMATION_UPDATE_FLAG:39,TAG_INFORMATION_TAG_NO_OF_MEMBERS:40,REGISTRATION_TYPE:41,PAGE_DIRECTION:42,PAGE_LIMIT:43,ACTIVITY_TYPE:45,ACTIVITY_VALUE_LENGTH:46,ACTIVITY_VALUE:47,CHANGED_BY_USER_ID:48,FRIEND_APP_TYPE:60,FRIEND_DEVICE_TOKEN_LENGTH:61,FRIEND_DEVICE_TOKEN:62,IS_SECRET_VISIBLE:63,APP_VERSION:64,RAW_DATA_BYTE:80},s={};s[a.PACKET_TYPE]={ATTRIBUTE_NAME:"PACKET_TYPE",VAR_NAME:"packetType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.USER_ID]={ATTRIBUTE_NAME:"USER_ID",VAR_NAME:"userId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.FRIEND_ID]={ATTRIBUTE_NAME:"FRIEND_ID",VAR_NAME:"friendId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.PACKET_ID_LENGTH]={ATTRIBUTE_NAME:"PACKET_ID_LENGTH",VAR_NAME:"packetIdLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.PACKET_ID]={ATTRIBUTE_NAME:"PACKET_ID",VAR_NAME:"packetId",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.PLATFORM]={ATTRIBUTE_NAME:"PLATFORM",VAR_NAME:"platform",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.CHAT_BINDING_PORT]={ATTRIBUTE_NAME:"CHAT_BINDING_PORT",VAR_NAME:"chatBindingPort",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[a.TAG_ID]={ATTRIBUTE_NAME:"TAG_ID",VAR_NAME:"tagId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.ONLINE_STATUS]={ATTRIBUTE_NAME:"ONLINE_STATUS",VAR_NAME:"onlineStatus",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.USER_MOOD]={ATTRIBUTE_NAME:"USER_MOOD",VAR_NAME:"userMood",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.MESSAGE_TYPE]={ATTRIBUTE_NAME:"MESSAGE_TYPE",VAR_NAME:"messageType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TIMEOUT]={ATTRIBUTE_NAME:"TIMEOUT",VAR_NAME:"timeout",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.LATITUDE]={ATTRIBUTE_NAME:"LATITUDE",VAR_NAME:"latitude",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[a.LONGITUDE]={ATTRIBUTE_NAME:"LONGITUDE",VAR_NAME:"longitude",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[a.MESSAGE_LENGTH]={ATTRIBUTE_NAME:"MESSAGE_LENGTH",VAR_NAME:"messageLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.MESSAGE]={ATTRIBUTE_NAME:"MESSAGE",VAR_NAME:"message",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.MESSAGE_DATE]={ATTRIBUTE_NAME:"MESSAGE_DATE",VAR_NAME:"messageDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.NO_OF_MESSAGE]={ATTRIBUTE_NAME:"NO_OF_MESSAGE",VAR_NAME:"messagesLength",VAR_CONTAINER_NAME:"messages",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.FULL_NAME_LENGTH]={ATTRIBUTE_NAME:"FULL_NAME_LENGTH",VAR_NAME:"fullNameLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.FULL_NAME]={ATTRIBUTE_NAME:"FULL_NAME",VAR_NAME:"fullName",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.NO_OF_PACKET]={ATTRIBUTE_NAME:"NO_OF_PACKET",VAR_NAME:"packetsLength",VAR_CONTAINER_NAME:"packets",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.SEQUENCE_NO]={ATTRIBUTE_NAME:"SEQUENCE_NO",VAR_NAME:"sequenceNo",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.NO_OF_MEMBERS]={ATTRIBUTE_NAME:"NO_OF_MEMBERS",VAR_NAME:"membersLength",VAR_CONTAINER_NAME:"members",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.UPDATE_TIME]={ATTRIBUTE_NAME:"UPDATE_TIME",VAR_NAME:"updateTime",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.SERVER_DATE]={ATTRIBUTE_NAME:"SERVER_DATE",VAR_NAME:"serverDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.LAST_ONLINE_TIME]={ATTRIBUTE_NAME:"LAST_ONLINE_TIME",VAR_NAME:"lastOnlineTime",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.NO_OF_ITEMS]={ATTRIBUTE_NAME:"NO_OF_ITEMS",VAR_NAME:"noOfItems",VAR_CONTAINER_NAME:"items",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.BLOCK_UNBLOCK_DATE]={ATTRIBUTE_NAME:"BLOCK_UNBLOCK_DATE",VAR_NAME:"blockUnblockDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.MESSAGE_STATUS]={ATTRIBUTE_NAME:"MESSAGE_STATUS",VAR_NAME:"status",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.IS_ADD_TO_DB]={ATTRIBUTE_NAME:"IS_ADD_TO_DB",VAR_NAME:"isAddToDb",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_NAME_LENGTH]={ATTRIBUTE_NAME:"TAG_NAME_LENGTH",VAR_NAME:"tagNameLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.TAG_NAME]={ATTRIBUTE_NAME:"TAG_NAME",VAR_NAME:"tagName",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.TAG_PICTURE_URL_LENGTH]={ATTRIBUTE_NAME:"TAG_PICTURE_URL_LENGTH",VAR_NAME:"tagPictureUrlLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_PICTURE_URL]={ATTRIBUTE_NAME:"TAG_PICTURE_URL",VAR_NAME:"tagPictureUrl",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.TAG_MEMBER_TYPE]={ATTRIBUTE_NAME:"TAG_MEMBER_TYPE",VAR_NAME:"status",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_MEMBER_ADDED_BY]={ATTRIBUTE_NAME:"TAG_MEMBER_ADDED_BY",VAR_NAME:"addedBy",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersLength",VAR_CONTAINER_NAME:"tagMembers",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.TAG_NO_OF_BROKEN_PKT]={ATTRIBUTE_NAME:"TAG_NO_OF_BROKEN_PKT",VAR_NAME:"brokenPacketsLength",VAR_CONTAINER_NAME:"brokenPackets",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_INFORMATION_UPDATE_FLAG]={ATTRIBUTE_NAME:"TAG_INFORMATION_UPDATE_FLAG",VAR_NAME:"updateFlag",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.TAG_INFORMATION_TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_INFORMATION_TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersCount",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.REGISTRATION_TYPE]={ATTRIBUTE_NAME:"REGISTRATION_TYPE",VAR_NAME:"registrationType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.PAGE_DIRECTION]={ATTRIBUTE_NAME:"PAGE_DIRECTION",VAR_NAME:"pageDirection",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.PAGE_LIMIT]={ATTRIBUTE_NAME:"PAGE_LIMIT",VAR_NAME:"pageLimit",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.ACTIVITY_TYPE]={ATTRIBUTE_NAME:"ACTIVITY_TYPE",VAR_NAME:"activityType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1,CONDITIONAL:!0},s[a.ACTIVITY_VALUE_LENGTH]={ATTRIBUTE_NAME:"ACTIVITY_VALUE_LENGTH",VAR_NAME:"activityValueLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.ACTIVITY_VALUE]={ATTRIBUTE_NAME:"ACTIVITY_VALUE",VAR_NAME:"activityValue",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.CHANGED_BY_USER_ID]={ATTRIBUTE_NAME:"CHANGED_BY_USER_ID",VAR_NAME:"changedByUserId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[a.FRIEND_APP_TYPE]={ATTRIBUTE_NAME:"FRIEND_APP_TYPE",VAR_NAME:"friendAppType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.FRIEND_DEVICE_TOKEN_LENGTH]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN_LENGTH",VAR_NAME:"friendDeviceTokenLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.FRIEND_DEVICE_TOKEN]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN",VAR_NAME:"friendDeviceToken",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[a.IS_SECRET_VISIBLE]={ATTRIBUTE_NAME:"IS_SECRET_VISIBLE",VAR_NAME:"isSecretVisible",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[a.APP_VERSION]={ATTRIBUTE_NAME:"APP_VERSION",VAR_NAME:"appVersion",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[a.RAW_DATA_BYTE]={ATTRIBUTE_NAME:"RAW_DATA_BYTE",VAR_NAME:"bytes",VAR_TYPE:o.ATTRIBUTE_TYPE.BYTE,SIZE:-2};var c={};c[n.FRIEND_CHAT_REGISTER]={PACKET_NAME:"FRIEND_CHAT_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[n.FRIEND_CHAT_UNREGISTER]={PACKET_NAME:"FRIEND_CHAT_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM,a.ONLINE_STATUS,a.USER_MOOD]},c[n.FRIEND_CHAT_REGISTER_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.CHAT_BINDING_PORT,a.SERVER_DATE]},c[n.FRIEND_CHAT_IDLE]={PACKET_NAME:"FRIEND_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PLATFORM]},c[n.FRIEND_CHAT_TYPING]={PACKET_NAME:"FRIEND_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PLATFORM]},c[n.FRIEND_CHAT_MSG]={PACKET_NAME:"FRIEND_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_BROKEN_MSG]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.PLATFORM]},c[n.FRIEND_CHAT_MULTIPLE_MSG]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE]]},c[n.FRIEND_CHAT_DELIVERED]={PACKET_NAME:"FRIEND_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[n.FRIEND_CHAT_SENT]={PACKET_NAME:"FRIEND_CHAT_SENT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[n.FRIEND_CHAT_SEEN]={PACKET_NAME:"FRIEND_CHAT_SEEN",BROKEN_CONTAINER:"messages",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_DATE,a.MESSAGE_STATUS],a.PLATFORM]},c[n.FRIEND_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[n.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[n.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[n.FRIEND_CHAT_BROKEN]={PACKET_NAME:"FRIEND_CHAT_BROKEN",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},c[n.FRIEND_CHAT_BROKEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BROKEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},c[n.FRIEND_CHAT_BLOCK]={PACKET_NAME:"FRIEND_CHAT_BLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.BLOCK_UNBLOCK_DATE,a.IS_ADD_TO_DB]},c[n.FRIEND_CHAT_UNBLOCK]={PACKET_NAME:"FRIEND_CHAT_UNBLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.BLOCK_UNBLOCK_DATE]},c[n.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_TAG_REGISTER]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[r.TAG_CHAT_TAG_UNREGISTER]={PACKET_NAME:"TAG_CHAT_TAG_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ONLINE_STATUS,a.USER_MOOD]},c[r.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.CHAT_BINDING_PORT,a.SERVER_DATE]},c[r.TAG_CHAT_TAG_INFORMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.ACTIVITY_TYPE,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL]},c[r.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_TAG_MEMBER_ADD]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE]]},c[r.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_MEMBER_REMOVE_LEAVE]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID]]},c[r.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.TAG_MEMBER_TYPE]]},c[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_IDLE]={PACKET_NAME:"TAG_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PLATFORM]},c[r.TAG_CHAT_TYPING]={PACKET_NAME:"TAG_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PLATFORM]},c[r.TAG_CHAT_MSG]={PACKET_NAME:"TAG_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_BROKEN_MSG]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_MULTIPLE_MSG]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]},c[r.TAG_CHAT_DELIVERED]={PACKET_NAME:"TAG_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_SENT]={PACKET_NAME:"TAG_CHAT_SENT",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_SEEN]={PACKET_NAME:"TAG_CHAT_SEEN",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[r.TAG_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[r.TAG_CHAT_GENERAL_BROKEN_PACKET]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},c[r.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},c[i.OFFLINE_FRIEND_INFORMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.PLATFORM,a.ONLINE_STATUS,a.FRIEND_APP_TYPE,a.FRIEND_DEVICE_TOKEN_LENGTH,a.FRIEND_DEVICE_TOKEN,a.USER_MOOD]},c[i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[i.OFFLINE_GET_REQUEST]={PACKET_NAME:"OFFLINE_GET_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.UPDATE_TIME,a.BLOCK_UNBLOCK_DATE,a.APP_VERSION,a.PLATFORM]},c[i.OFFLINE_GET_REQUEST_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_REQUEST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SERVER_DATE]},c[i.OFFLINE_FRIEND_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE]]},c[i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PAGE_DIRECTION,a.PAGE_LIMIT,a.PLATFORM]},c[i.OFFLINE_FRIEND_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.TIMEOUT,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE,a.IS_SECRET_VISIBLE,a.MESSAGE_STATUS],a.PAGE_DIRECTION]},c[i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.FRIEND_ID,a.PACKET_ID,a.PACKET_ID_LENGTH,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID],a.PLATFORM]},c[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.FRIEND_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[i.OFFLINE_TAG_INFORMATION_ACTIVITY]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_ACTIVITY",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.ACTIVITY_TYPE,a.USER_ID,a.ACTIVITY_VALUE_LENGTH,a.ACTIVITY_VALUE,a.TAG_MEMBER_TYPE,a.CHANGED_BY_USER_ID,a.UPDATE_TIME]]},c[i.OFFLINE_MY_TAG_LIST]={PACKET_NAME:"OFFLINE_MY_TAG_LIST",BROKEN_CONTAINER:"items",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_ITEMS,[a.TAG_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_MEMBER_ADDED_BY,a.TAG_INFORMATION_TAG_NO_OF_MEMBERS]]
},c[i.OFFLINE_TAG_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE]]},c[i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,[a.PACKET_ID_LENGTH,a.PACKET_ID]]},c[i.OFFLINE_TAG_CREATE_TAG]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE],a.PLATFORM]},c[i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PAGE_DIRECTION,a.PAGE_LIMIT,a.APP_VERSION,a.PLATFORM]},c[i.OFFLINE_TAG_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_MESSAGE,[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.MESSAGE_TYPE,a.MESSAGE_LENGTH,a.MESSAGE,a.MESSAGE_DATE],a.PAGE_DIRECTION]},c[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.PLATFORM]},c[i.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.TAG_NAME_LENGTH,a.TAG_NAME,a.TAG_PICTURE_URL_LENGTH,a.TAG_PICTURE_URL,a.TAG_NO_OF_MEMBERS,[a.USER_ID,a.FULL_NAME_LENGTH,a.FULL_NAME,a.TAG_MEMBER_TYPE,a.TAG_MEMBER_ADDED_BY]]},c[i.OFFLINE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.TAG_ID,a.PACKET_ID_LENGTH,a.PACKET_ID]},c[i.OFFLINE_BROKEN_HISTORY_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_HISTORY_PACKET",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE]},c[i.OFFLINE_BROKEN_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.PACKET_ID_LENGTH,a.PACKET_ID,a.NO_OF_PACKET,a.SEQUENCE_NO,a.RAW_DATA_BYTE,a.USER_ID,a.PLATFORM]},c[i.OFFLINE_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"OFFLINE_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[a.PACKET_TYPE,a.USER_ID,a.PACKET_ID_LENGTH,a.PACKET_ID,a.SEQUENCE_NO]},e.CHAT_APP.PacketFormats={CHAT_PACKET_ATTRIBUTE:a,CHAT_PACKET_ATTRIBUTE_INFO:s,CHAT_PACKET_INFO:c}}(t)}(angular,window),function(e,t){"use strict";!function(e){function t(){var t=e.CHAT_APP.Constants.PACKET_TYPES,n=e.CHAT_APP.Constants.PLATFORM.WEB,r=e.CHAT_APP.getAppVersion,i=e.CHAT_APP.getCurrentUserId,o=e.CHAT_APP.UTILS.getUUIDPacketId;this.getFriendChatRegisterObject=function(e,r){var a={packetType:t.FRIEND_CHAT_REGISTER,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatUnregisterObject=function(e,r,a,s){var c={packetType:t.FRIEND_CHAT_UNREGISTER,userId:i(),friendId:e,platform:n,onlineStatus:r,userMood:a,packetId:s||o()};return c},this.getFriendChatRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.FRIEND_CHAT_REGISTER_CONFIRMATION,friendId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getFriendChatIdleObject=function(e){var r={packetType:t.FRIEND_CHAT_IDLE,userId:i(),friendId:e,platform:n};return r},this.getFriendChatTypingObject=function(e){var r={packetType:t.FRIEND_CHAT_TYPING,userId:i(),friendId:e,platform:n};return r},this.getFriendChatMsgObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatMsgEditObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG_EDIT,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatBrokenMsgObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatBrokenMsgEditObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG_EDIT,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatMultipleMsgObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_MULTIPLE_MSG,userId:i(),friendId:e,messages:n,packetId:r||o()};return a},this.getFriendChatDeliveredObject=function(e,r){var a={packetType:t.FRIEND_CHAT_DELIVERED,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatSentObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SENT,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatSeenObject=function(e,r,a){var s={packetType:t.FRIEND_CHAT_SEEN,userId:i(),friendId:e,messages:r,platform:n,packetId:a||o()};return s},this.getFriendChatSeenConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SEEN_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatMultipleMsgDeleteObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_MULTIPLE_MSG_DELETE,userId:i(),friendId:e,packets:n,packetId:r||o()};return a},this.getFriendChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatBrokenObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BROKEN,userId:i(),friendId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getFriendChatBrokenConfirmationObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_BROKEN_CONFIRMATION,userId:i(),friendId:e,sequenceNo:n,packetId:r||o()};return a},this.getFriendChatBlockObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BLOCK,userId:i(),friendId:e,blockUnblockDate:n,isAddToDb:r,packetId:a||o()};return s},this.getFriendChatUnblockObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_UNBLOCK,userId:i(),friendId:e,blockUnblockDate:n,packetId:r||o()};return a},this.getFriendChatBlockUnblockConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getTagChatTagRegisterObject=function(e,r){var a={packetType:t.TAG_CHAT_TAG_REGISTER,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getTagChatTagUnregisterObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_TAG_UNREGISTER,userId:i(),tagId:e,onlineStatus:n,userMood:r,packetId:a||o()};return s},this.getTagChatTagRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.TAG_CHAT_TAG_REGISTER_CONFIRMATION,tagId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getTagChatTagInformationObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_TAG_INFORMATION,userId:i(),tagId:e,activityType:n,tagName:r,tagPictureUrl:a,packetId:s||o()};return c},this.getTagChatTagInformationConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberAddObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_ADD,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberAddConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatMemberRemoveLeaveObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatMemberRemoveLeaveConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberTypeChangeObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberTypeChangeConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatIdleObject=function(e){var r={packetType:t.TAG_CHAT_IDLE,userId:i(),tagId:e,platform:n};return r},this.getTagChatTypingObject=function(e){var r={packetType:t.TAG_CHAT_TYPING,userId:i(),tagId:e,platform:n};return r},this.getTagChatMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatMsgEditObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG_EDIT,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatBrokenMsgObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatBrokenMsgEditObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG_EDIT,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatMultipleMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MULTIPLE_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatDeliveredObject=function(e,n,r){var a={packetType:t.TAG_CHAT_DELIVERED,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSentObject=function(e,n){var r={packetType:t.TAG_CHAT_SENT,tagId:e,packetId:n||o()};return r},this.getTagChatSeenObject=function(e,n,r){var a={packetType:t.TAG_CHAT_SEEN,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSeenConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_SEEN_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getTagChatMultipleMsgDeleteObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MULTIPLE_MSG_DELETE,userId:i(),tagId:e,packets:n,packetId:r||o()};return a},this.getTagChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatGeneralBrokenPacketObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET,userId:i(),tagId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getTagChatGeneralBrokenPacketConfirmationObject=function(e,n,r){var a={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,userId:i(),tagId:e,sequenceNo:n,packetId:r||o()};return a},this.getOfflineFriendInformationObject=function(e,r,a,s,c,l,u){var d={packetType:t.OFFLINE_FRIEND_INFORMATION,userId:i(),friendId:e,fullName:r,platform:n,onlineStatus:a,friendAppType:s,friendDeviceToken:c,userMood:l,packetId:u||o()};return d},this.getOfflineFriendInformationConfirmationObject=function(e,r){var i={packetType:t.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,friendId:e,platform:n,packetId:r||o()};return i},this.getOfflineGetRequestObject=function(e,a,s){var c={packetType:t.OFFLINE_GET_REQUEST,userId:i(),updateTime:e,blockUnblockDate:a,appVersion:r(),platform:n,packetId:s||o()};return c},this.getOfflineGetRequestConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_GET_REQUEST_CONFIRMATION,serverDate:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineFriendHistoryMessageRequestObject=function(e,r,a,s){var c={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,userId:i(),friendId:e,pageDirection:r,pageLimit:a,platform:n,packetId:s||o()};return c},this.getOfflineFriendHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE,friendId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineFriendHistoryMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,friendId:e,packetId:n||o()};return r},this.getOfflineGetFriendMessageStatusObject=function(e,r,a){var s={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS,userId:i(),friendId:e,packets:r,platform:n,packetId:a||o()};return s},this.getOfflineGetFriendMessageStatusConfirmationObject=function(e,n,r){var i={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,friendId:e,packets:n,packetId:r||o()};return i},this.getOfflineTagInformationActivityObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_INFORMATION_ACTIVITY,tagId:e,noOfItems:n,items:r,packetId:i||o()};return a},this.getOfflineMyTagListObject=function(e,n,r){var i={packetType:t.OFFLINE_MY_TAG_LIST,noOfItems:e,items:n,packetId:r||o()};return i},this.getOfflineTagUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineTagUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineTagCreateTagObject=function(e,r,a,s,c){var l={packetType:t.OFFLINE_TAG_CREATE_TAG,userId:i(),tagId:e,tagName:r,tagPictureUrl:a,tagMembers:s,platform:n,packetId:c||o()};return l},this.getOfflineTagCreateTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineTagHistoryMessageRequestObject=function(e,a,s,c){var l={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,userId:i(),tagId:e,pageDirection:a,pageLimit:s,appVersion:r(),platform:n,packetId:c||o()};return l},this.getOfflineTagHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE,tagId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineGetTagInformationWithMembersObject=function(e,r){var a={packetType:t.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getOfflineTagInformationWithMembersObject=function(e,n,r,i,a){var s={packetType:t.OFFLINE_TAG_INFORMATION_WITH_MEMBERS,tagId:e,tagName:n,tagPictureUrl:r,tagMembers:i,packetId:a||o()};return s},this.getOfflineTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineBrokenHistoryPacketObject=function(e,n,r){var i={packetType:t.OFFLINE_BROKEN_HISTORY_PACKET,sequenceNo:e,bytes:n,packetId:r||o()};return i},this.getOfflineBrokenPacketObject=function(e,r,a){var s={packetType:t.OFFLINE_BROKEN_PACKET,sequenceNo:e,bytes:r,userId:i(),platform:n,packetId:a||o()};return s},this.getOfflineBrokenPacketConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_BROKEN_PACKET_CONFIRMATION,userId:i(),sequenceNo:e,packetId:n||o()};return r}}e.CHAT_APP.ChatRequests=new t}(t)}(angular,window),function(e,t){"use strict";!function(e){function t(){var e=(n.Constants.AUTH_REQUEST_TYPE,n.Constants.AUTH_SERVER_ACTIONS);this.getOfflineIpPort=function(t){var n={actn:e.GET_OFFLINE_IP_PORT,rid:i()};return t&&(n.pckId=t),n},this.getTagChatRegisterIpPort=function(t,n,r){var i={actn:e.START_TAG_CHAT,tid:t,uIds:n};return r&&(i.pckId=r),i},this.getFriendChatRegisterIpPort=function(t,n){var r={actn:e.START_F2F_CHAT,fndId:t,uId:i()};return n&&(r.pckId=n),r},this.getTagChatMembersAddObject=function(t,n,r,i,o){var a={actn:e.ADD_TAG_CHAT_MEMBERS,tid:t,uIds:n,chIp:r,chRp:i};return o&&(a.pckId=o),a},this.getOfflineIpPort=function(){var t={actn:e.GET_OFFLINE_IP_PORT,rid:i(),requestType:r.REQUEST};return t},this.getFriendPresenceObject=function(t){var n={actn:e.GET_USER_MOOD_PRESENCE,fndId:t};return n}}var n=e.CHAT_APP,r=n.AUTH_REQUEST_TYPE,i=n.getCurrentUserId;e.CHAT_APP.AuthRequests=new t}(t)}(angular,window),function(e,t){"use strict";!function(e){function n(){return Date.UTC(1582,9,15)}function r(e){var t=i(e),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}}function i(e){return e-f}function o(){return(new Date).getTime()}function a(e){for(var t,n,r=0;r++<m;){if(t=e,t>g)return g=t,t;if(g>t)return g+1;if(n=g+1,n==g)return g=n,n}return n}function s(e,t,n){try{e=parseInt(e)}catch(i){return console.error("Invalid User Id Provided for PacketIDGenerator"),""}var s;n?s=t:(t||(t=o()),s=a(t));var c=r(s);return c.hi=4096|c.hi,l(c.low,c.mid,c.hi,e)}function c(e,t,n){e=String(e),n=n?n:"0";for(var r=t-e.length;r>0;r>>>=1,n+=n)1&r&&(e=n+e);return e}function l(e,t,n,r){0>e&&console.error("Invalid time in packetIdgen");var i=c(e.toString(16),8)+"-"+c(t.toString(16),4)+"-"+c(n.toString(16),4)+"-"+c(0..toString(16),4)+"-"+c(r.toString(16),12);return i}function u(e){var t=e.split("-"),n=[t[2].substring(1),t[1],t[0]].join(""),r=parseInt(n,16);r-=E;var i=Math.floor(r/1e4);return i}function d(){}var g=0,m=50,f=n(),E=122192928e9;d.prototype.create=s,d.prototype.getTimestamp=u,e=e||new d,t.PacketIDGenerator=e}(t.PacketIDGenerator)}(angular,window),function(e,t){"use strict";!function(){var t={STATUS_MESSAGES:{SELF_ADD_MEMBER:"You added {new_member_name} as Group {new_member_type}.",SELF_ADD_MULTIPLE_MEMBER:"You added {new_member_name} and {rest_count} as Group {new_member_type}.",SELF_REMOVE_MEMBER:"You removed {old_member_name} from the group.",SELF_REMOVE_MULTIPLE_MEMBER:"You removed {old_member_name} and {rest_count} from the group.",OTHER_ADD_MEMBER:"{member_name} added {new_member_name} as Group {new_member_type}.",OTHER_ADD_MULTIPLE_MEMBER:"{member_name} added {new_member_name} and {rest_count} as Group {new_member_type}.",OTHER_REMOVE_MEMBER:"{member_name} removed {old_member_name} from the group.",OTHER_REMOVE_MULTIPLE_MEMBER:"{member_name} removed {old_member_name} and {rest_count} from the group.",SELF_LEAVE_GROUP:"You left this conversation.",OTHER_LEAVE_GROUP:"{member_name} left this conservation.",SELF_RENAME_GROUP:"You named the group {group_name}.",OTHER_RENAME_GROUP:"{member_name} named the group {group_name}.",SELF_CHANGE_GROUP_PIC:"You changed the group photo.",OTHER_CHANGE_GROUP_PIC:"{member_name} changed the group photo.",SELF_UPDATE_GROUP_INFO:"You named the group {group_name} and changed the group photo.",OTHER_UPDATE_GROUP_INFO:"{member_name} named the group {group_name} and changed the group photo.",SELF_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} Group Admin.",OTHER_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} as Admin.",SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} and {rest_count} as Group admin.",SELF_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} from Admin.",OTHER_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} from Group Admin.",SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} and {rest_count} from Group Admin.",SELF_REMOVED_FROM_ADMIN_BY_SELF:"You removed yourself from Admin",OTHER_REMOVED_FROM_ADMIN_BY_SELF:"{admin_name} removed himself/herself from Admin",SELF_USER_ADDED_AS_OWNER:"{member_name} made you owner.",OTHER_USER_ADDED_AS_OWNER:"{member_name} made {admin_name} Owner. ",SELF_NOT_GROUP_MEMBER:"You are no longer member of this group"},DEFAULT_FAILURE_MESSAGE:"Request has not been processed successfully. Please try again",DEFAULT_SUCCESS_MESSAGE:"Request has been processed successfully."},n={MESSAGE_DELETE_TEXT:"This message has been deleted"},r=e.module("ringid.chat");r.constant("CHAT_LANG",{TAG:t,CHAT:n})}()}(angular,window),function(e,t){"use strict";!function(t){function n(n,r,i,o,a,s,c,l,u,d,g,m,f){function E(e){return Be[e]}function p(e){switch(e){case $e.MESSAGE_TYPES.DELETE_MESSAGE:case $e.MESSAGE_TYPES.TEXT:case $e.MESSAGE_TYPES.EMOTICON_MESSAGE:case $e.MESSAGE_TYPES.LOCATION_SHARE:case $e.MESSAGE_TYPES.LINK_SHARE:case $e.MESSAGE_TYPES.STICKER:case $e.MESSAGE_TYPES.IMAGE:case $e.MESSAGE_TYPES.CAMERA_IMAGE:case $e.MESSAGE_TYPES.AUDIO:case $e.MESSAGE_TYPES.VIDEO:case $e.MESSAGE_TYPES.RING_MEDIA_MESSAGE:return!0;default:return!1}}function T(e){var t=e.packetType,n=E(t);if(!n)return RingLogger.warning("M: Packet Processor Not Implemented. Packet Type ",t,"CHAT"),!1;try{n.processor.call(this,e)}catch(r){RingLogger.alert("M: Exception In PACKET Procsessing.",t,r,RingLogger.tags.CHAT)}return!0}function h(e){e.userId,e.friendId,e.packetId}function _(e){var t=e.userId,n=(e.friendId,e.onlineStatus,e.userMood,e.packetId,s.getBoxByUId(t));t===n.getKey()&&s.closeChatBox(n.getKey())}function I(e){var t=e.friendId,n=(e.chatBindingPort,e.serverDate);e.packetId;Ge.serverTime=n,Ge.serverTimeDiff=Date.now()-n;var r=s.getBoxByUId(t);r||(r=s.creatNonDomBox(t,!1))}function A(e){var t=e.userId,n=(e.friendId,s.getBoxByUId(t));n&&n.setFriendTypingBool(!1)}function v(e){var t;e.userId,e.friendId;t=e.userId==o.currentUser().getKey()?e.friendId:e.userId;var n=s.getBoxByUId(t);n&&(n.setFriendTypingBool(!0),setTimeout(function(){n.setFriendTypingBool(!1),l.triggerCustomEvent(i.CHAT.BOX_UPDATED,{boxId:t})},3e3))}function S(e){var t=e.userId,n=e.friendId,a=e.messageType,c=e.timeout,m=(e.message,e.messageDate),f=(e.isSecretVisible,e.packetId);if(p(a)){var E,T=e.boxId,h=o.currentUser().getKey();if(T||(T=t),T==h&&(T=n),T=T.toString(),!r.isInLocalStorageChatMsgMap(T,f)){var _=s.getBoxByUId(T);if(e.fromHistory||a!==$e.MESSAGE_TYPES.DELETE_MESSAGE){if(e.messageType>$e.MESSAGE_TYPES.BLANK_MESSAGE){_?e.fromHistory||_.nonDomBox||(_.nonDomBox=!0,_.loadHistoryMessages(),l.triggerCustomEvent(i.CHAT.BOX_OPENNED,{boxId:T})):s.openChatBox(T),_=s.getBoxByUId(T),_.setFriendTypingBool(!1),e.fromHistory&&e.fromOffline||(_&&!_.isFocused&&_.latestSeenMessageDate<=m?(e.status="Unread",E="unread"):e.status=e.status||"Received"),e.fromHistory?"Unread"!=e.status&&(e.seenSent=!0):E="bottom",e.tag_chat=!1;var n=_.getKey();if("Edited"==e.status||!_.isSamePacketId(f)){if(e.user=u.create({uId:t,fetchDatails:!1}),"Unread"==e.status&&(s.increaseUnreadMessageCount(T,e.packetId),_.updateUnreadCount()),_.pushMessage(e,_.getKey()),!e.fromHistory&&_.isFocused){var I=[{key:e.packetId,value:_.getMessage(e.packetId)}];g.sendSeenPacket(_,I),c>0&&l.triggerCustomEvent(i.CHAT.WAS_FOCUSED,{box:_,filteredMessages:I})}r.updateBox(_)}}}else d.doOnMessageTypeDeleteMessage(T,t,f,e,_)}}}function C(e){e.userId,e.friendId,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;e.status="Edited",S(e)}function D(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;S(e)}function N(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;C(e)}function M(e){e.userId,e.friendId,e.messages,e.packetId}function R(e){var t=e.userId,n=e.friendId,r=e.packetId,i=d.getFriendBoxId(t,n),o=d.getFriendBox(i),a=o.getMessage(r);a&&(d.updateMessageStatusToDelivered(i,a),o.sendTabUpdate(a))}function y(e){var t=e.userId,n=e.friendId,r=e.packetId,i=d.getFriendBoxId(t,n),o=d.getFriendBox(i),a=o.getMessage(r);a&&(d.updateMessageStatusToDelivered(o.getKey(),a),o.sendTabUpdate(a))}function O(e){for(var t=e.userId,n=e.friendId,o=(e.messages,e.packetId,d.getFriendBoxId(t,n)),a=d.getFriendBox(o),s=0;s<e.messages.length;s++){var c=a.getMessage(e.messages[s].packetId);if(c){var u=!1;e.messages[s].status==$e.MESSAGE_STATUS.DELETED||(e.messages[s].status==$e.MESSAGE_STATUS.SEEN?(c.status="Seen",l.triggerCustomEvent(i.CHAT.DO_START_SECRET_TIMER,{boxId:o,others:!1,messages:[{key:e.messages[s].packetId,value:c}]}),u=!0):e.messages[s].status==$e.MESSAGE_STATUS.VIEWED&&(c.status="Viewed",l.triggerCustomEvent(SystemEvent.CHAT.DO_START_SECRET_TIMER,{boxId:o,others:!0,messages:[{key:e.messages[s].packetId,value:c}]}),u=!0)),u&&(r.updateMessage(c,a.getKey()),a.sendTabUpdate(c))}}}function b(e){e.userId,e.friendId,e.packetId}function P(e){for(var t=e.userId,n=e.friendId,i=e.packets,a=(e.packetId,d.getFriendBoxId(t,n)),s=d.getFriendBox(a),c=0;c<i.length;c++){var l=i[c].packetId,u=s.getMessage(l);u&&(t!=o.currentUser().getKey()?(u.text="This message has been deleted",u.setTextPartition(),u.status="Deleted"):s.removeMessage(l),r.updateMessage(u,s.getKey()),s.sendTabUpdate(u))}}function L(e){var t=e.userId,n=e.friendId,r=(e.packetId,d.getFriendBoxId(t,n));d.getFriendBox(r)}function U(e){e.userId,e.friendId,e.sequenceNo,e.rawDataByte,e.packetId}function w(e){e.userId,e.friendId,e.sequenceNo,e.packetId}function F(e){e.userId,e.friendId,e.blockUnblockDate,e.isAddToDb,e.packetId}function k(e){e.userId,e.friendId,e.blockUnblockDate,e.packetId}function $(e){e.userId,e.friendId,e.packetId}function G(e){e.userId,e.tagId,e.packetId}function H(e){e.userId,e.tagId,e.onlineStatus,e.userMood,e.packetId}function B(e){var t=e.tagId,n=(e.chatBindingPort,e.serverDate);e.packetId;Ge.serverTime=n,Ge.serverTimeDiff=Date.now()-n;var r=s.getBoxByUId(t);r||(r=s.creatNonDomBox(t,!0))}function x(e){e.userId,e.tagId,e.activityType,e.tagName,e.tagPictureUrl,e.packetId;d.processTagInformation(e)}function Y(e){e.userId,e.tagId,e.packetId}function K(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;d.processTagMemberAddUpdate(e),l.triggerCustomEvent(i.CHAT.TAG_LIST_UPDATED,{tagId:t})}function j(e){e.userId,e.tagId,e.packetId}function V(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;d.processTagMemberRemoveLeave(e),l.triggerCustomEvent(i.CHAT.TAG_LIST_UPDATED,{tagId:t})}function W(e){var t=e.userId,n=e.tagId;e.packetId;t===o.currentUser().getKey()&&d.doTagUnregisterTask(n),l.triggerCustomEvent(i.CHAT.TAG_LIST_UPDATED,{tagId:n})}function q(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;d.processTagMemberStatusChange(e),l.triggerCustomEvent(i.CHAT.TAG_LIST_UPDATED,{tagId:t})}function z(e){e.userId,e.tagId,e.packetId}function Q(e){var t=(e.userId,e.tagId),n=s.getBoxByUId(t);n&&n.setFriendTypingBool(!1)}function X(e){var t,n,r=e.userId,o=e.tagId;t=s.getBoxByUId(o),t&&(n=a.getTag(o),n&&(t.showTypingText(r),setTimeout(function(){t.hideTypingText(),l.triggerCustomEvent(i.CHAT.BOX_UPDATED,{boxId:o})},3e3)))}function Z(e){var t=e.userId,n=e.tagId,o=e.messageType,g=(e.message,e.messageDate),m=e.packetId;if(p(o)&&(n=n.toString(),e.fromHistory||!r.isInLocalStorageChatMsgMap(n,m))){var E=a.getTag(n);if(!E){var T=He.getOfflineGetTagInformationWithMembersObject(n);f.send(T),E=a.getOrCreateTag(n)}var h,_=s.getBoxByUId(n);if(o===$e.MESSAGE_TYPES.DELETE_MESSAGE)d.doOnMessageTypeDeleteMessage(n,t,m,e,_);else if(o>$e.MESSAGE_TYPES.BLANK_MESSAGE){_=c.openTagChatBoxIfClosed(n,_),e.fromHistory||(h="bottom"),e.fromHistory&&e.fromOffline||(_&&!_.isFocused&&_.latestSeenMessageDate<=g?(e.status="Unread",h="unread"):e.status=e.status||"Received"),e.tag_chat=!0;var n=_.getKey();_.isSamePacketId(m)||(e.user=u.create({uId:t,fetchDatails:!1}),!e.fromHistory&&E&&E.isTagSafeToShow()&&(_.nonDomBox||(_.nonDomBox=!0,_.loadHistoryMessages(),l.triggerCustomEvent(i.CHAT.BOX_OPENNED,{boxId:n}))),e.fromHistory?("Unread"!=e.status&&(e.seenSent=!0),r.removeUnreadMessageInfo(n,m),_.updateUnreadCount()):"Unread"==e.status&&(s.increaseUnreadMessageCount(n,m),_.updateUnreadCount()),_.pushMessage(e,_.getKey()),r.updateBox(_))}}}function J(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId;e.status="Edited",Z(e)}function ee(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function te(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function ne(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId}function re(e){var t=(e.userId,e.friendId,e.tagId),n=e.packetId,i=d.getTagChatBox(t),o=i.getMessage(n);o&&("Seen"!==o.status&&(o.status="Delivered"),r.updateMessage(o,i.getKey())),r.updateBox(i)}function ie(e){var t=e.tagId,n=e.packetId,i=d.getTagChatBox(t),o=i.updateMessageStatus(n,"Sent");o&&r.updateMessage(o,i.getKey()),r.updateBox(i)}function oe(e){var t=(e.userId,e.friendId,e.tagId),n=e.packetId,i=d.getTagChatBox(t),o=i.updateMessageStatus(n,"Seen");o&&r.updateMessage(o,i.getKey()),r.updateBox(i)}function ae(e){e.tagId,e.packetId}function se(t){var n=t.userId,r=t.tagId,i=t.packets;t.packetId;if(e.isArray(i))for(var o=d.getTagChatBox(r),a=0;a<i.length;a++)d.doOnMessageTypeDeleteMessage(r,n,i[a].packetId,null,o)}function ce(e){e.userId,e.tagId,e.packetId}function le(e){e.userId,e.tagId,e.sequenceNo,e.rawDataByte,e.packetId}function ue(e){e.userId,e.tagId,e.sequenceNo,e.packetId}function de(e){e.userId,e.friendId,e.fullName,e.onlineStatus,e.friendAppType,e.friendDeviceToken,e.userMood,e.packetId}function ge(e){e.friendId,e.packetId}function me(e){e.userId,e.updateTime,e.blockUnblockDate,e.packetId}function fe(e){var t=e.serverDate;e.packetId;Ge.serverTime=t,Ge.serverTimeDiff=Date.now()-t}function Ee(e){for(var t=e.messages,n=(e.packetId,{}),r=0;r<t.length;r++){var i=t[r];i.messageType!=$e.MESSAGE_TYPES.DELETED?(i.fromOffline=!0,i.fromHistory=!1,i.status="Unread",S(i),n[i.userId]=!0):RingLogger.alert("Unread Deleted Message",i,"CHAT")}}function pe(e){e.userId,e.packets,e.packetId}function Te(e){e.userId,e.friendId,e.pageDirection,e.pageLimit,e.packetId}function he(e){var t=e.friendId,n=e.messages,r=e.pageDirection,a=(e.packetId,o.currentUser().getKey()),c=[],u=s.getBoxByUId(t);if(u||(u=s.creatNonDomBox(t)),n.length||r==$e.PAGE_DIRECTION.DOWN){for(var g=!1,m=0;m<n.length;m++){var f=n[m];f.messageType!=$e.MESSAGE_TYPES.HISTORY_RE_FETCH&&(g=!0,f.userId.toString()==a?(f.status=d.getMessageStatus(f.status)||"Delivered",f.friendId=t):(f.status<$e.MESSAGE_STATUS.SEEN?f.status="Unread":f.status="Received",f.friendId=a),f.boxId=t,f.fromOffline=!0,f.fromHistory=!0,S(f)),c.push(f.packetId)}g&&(u.hasHistoryMessage=!0,l.triggerCustomEvent(i.CHAT.BOX_UPDATED,{boxId:t,noScroll:!0}))}else u.hasHistoryMessage=!1}function _e(e){e.friendId,e.packetId}function Ie(e){e.userId,e.friendId,e.packets,e.packetId}function Ae(e){e.friendId,e.packets,e.packetId}function ve(e){var t=e.tagId,n=(e.noOfItems,e.items),r=e.packetId;n.forEach(function(e){d.processAGroupActivity(t,r,e)})}function Se(e){for(var t,n=(e.noOfItems,e.items,e.packetId,0);n<e.items.length;n++)t=a.createNewTag(e.items[n]),a.addTagObject(t);l.triggerCustomEvent(i.CHAT.MY_TAG_LIST_RECEIVED)}function Ce(e){for(var t=(e.messages,e.packetId,0);t<e.messages.length;t++){var n=e.messages[t];n.status="Unread",n.fromUnread=!0,n.fromOffline=!0,n.messageType==$e.MESSAGE_TYPES.GROUP_ACTIVITY?d.processGroupActivityMessage(n):Z(n)}}function De(e){e.userId,e.packets,e.packetId}function Ne(e){e.userId,e.tagId,e.tagName,e.tagPictureUrl,e.tagMembers,e.packetId}function Me(e){e.tagId,e.packetId}function Re(e){e.userId,e.tagId,e.pageDirection,e.pageLimit,e.packetId}function ye(e){var t=e.tagId,n=e.messages,r=e.pageDirection,a=(e.packetId,d.getTagChatBox(t));if(n.length||r==$e.PAGE_DIRECTION.DOWN){for(var s,c=0;c<n.length;c++){var u=n[c];u.tagId=t,u.fromHistory=!0,u.fromOffline=!0,u.messageType==$e.MESSAGE_TYPES.GROUP_ACTIVITY?(s=!0,d.processGroupActivityMessage(u)):(s=!0,u.userId==o.currentUser().getKey()?u.status="Seen":u.status="Received",Z(u))}s&&(a.hasHistoryMessage=!0,l.triggerCustomEvent(i.CHAT.BOX_UPDATED,{boxId:t,noScroll:!0}))}else a.hasHistoryMessage=!1}function Oe(e){e.userId,e.tagId,e.packetId}function be(e){var t=e.tagId,n=(e.tagName,
e.tagPictureUrl,e.tagMembers);e.packetId;e.tagMembersCount=n.length;var r=a.getOrCreateTag(t,e);d.addMembersToTagObject(r,e.tagMembers),l.triggerCustomEvent(i.CHAT.TAG_LIST_UPDATED,{tagId:t})}function Pe(e){e.tagId,e.packetId}function Le(e){e.sequenceNo,e.rawDataByte,e.packetId}function Ue(e){e.sequenceNo,e.rawDataByte,e.userId,e.packetId}function we(e){e.userId,e.sequenceNo,e.packetId}var Fe=t.CHAT_APP.Constants.PACKET_TYPES,ke=t.CHAT_APP.Constants,$e=ke.GENERAL_CONSTANTS,Ge=ke.CHAT_GLOBAL_VALUES,He=CHAT_APP.ChatRequests,Be={};return Be[Fe.FRIEND_CHAT_REGISTER]={processor:h},Be[Fe.FRIEND_CHAT_UNREGISTER]={processor:_},Be[Fe.FRIEND_CHAT_REGISTER_CONFIRMATION]={processor:I},Be[Fe.FRIEND_CHAT_IDLE]={processor:A},Be[Fe.FRIEND_CHAT_TYPING]={processor:v},Be[Fe.FRIEND_CHAT_MSG]={processor:S},Be[Fe.FRIEND_CHAT_MSG_EDIT]={processor:C},Be[Fe.FRIEND_CHAT_BROKEN_MSG]={processor:D},Be[Fe.FRIEND_CHAT_BROKEN_MSG_EDIT]={processor:N},Be[Fe.FRIEND_CHAT_MULTIPLE_MSG]={processor:M},Be[Fe.FRIEND_CHAT_DELIVERED]={processor:R},Be[Fe.FRIEND_CHAT_SENT]={processor:y},Be[Fe.FRIEND_CHAT_SEEN]={processor:O},Be[Fe.FRIEND_CHAT_SEEN_CONFIRMATION]={processor:b},Be[Fe.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={processor:P},Be[Fe.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={processor:L},Be[Fe.FRIEND_CHAT_BROKEN]={processor:U},Be[Fe.FRIEND_CHAT_BROKEN_CONFIRMATION]={processor:w},Be[Fe.FRIEND_CHAT_BLOCK]={processor:F},Be[Fe.FRIEND_CHAT_UNBLOCK]={processor:k},Be[Fe.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={processor:$},Be[Fe.TAG_CHAT_TAG_REGISTER]={processor:G},Be[Fe.TAG_CHAT_TAG_UNREGISTER]={processor:H},Be[Fe.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={processor:B},Be[Fe.TAG_CHAT_TAG_INFORMATION]={processor:x},Be[Fe.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={processor:Y},Be[Fe.TAG_CHAT_TAG_MEMBER_ADD]={processor:K},Be[Fe.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={processor:j},Be[Fe.TAG_CHAT_MEMBER_REMOVE_LEAVE]={processor:V},Be[Fe.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={processor:W},Be[Fe.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={processor:q},Be[Fe.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={processor:z},Be[Fe.TAG_CHAT_IDLE]={processor:Q},Be[Fe.TAG_CHAT_TYPING]={processor:X},Be[Fe.TAG_CHAT_MSG]={processor:Z},Be[Fe.TAG_CHAT_MSG_EDIT]={processor:J},Be[Fe.TAG_CHAT_BROKEN_MSG]={processor:ee},Be[Fe.TAG_CHAT_BROKEN_MSG_EDIT]={processor:te},Be[Fe.TAG_CHAT_MULTIPLE_MSG]={processor:ne},Be[Fe.TAG_CHAT_DELIVERED]={processor:re},Be[Fe.TAG_CHAT_SENT]={processor:ie},Be[Fe.TAG_CHAT_SEEN]={processor:oe},Be[Fe.TAG_CHAT_SEEN_CONFIRMATION]={processor:ae},Be[Fe.TAG_CHAT_MULTIPLE_MSG_DELETE]={processor:se},Be[Fe.TAG_CHAT_MSG_DELETE_CONFIRMATION]={processor:ce},Be[Fe.TAG_CHAT_GENERAL_BROKEN_PACKET]={processor:le},Be[Fe.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={processor:ue},Be[Fe.OFFLINE_FRIEND_INFORMATION]={processor:de},Be[Fe.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={processor:ge},Be[Fe.OFFLINE_GET_REQUEST]={processor:me},Be[Fe.OFFLINE_GET_REQUEST_CONFIRMATION]={processor:fe},Be[Fe.OFFLINE_FRIEND_UNREAD_MESSAGE]={processor:Ee},Be[Fe.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={processor:pe},Be[Fe.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={processor:Te},Be[Fe.OFFLINE_FRIEND_HISTORY_MESSAGE]={processor:he},Be[Fe.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={processor:_e},Be[Fe.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={processor:Ie},Be[Fe.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={processor:Ae},Be[Fe.OFFLINE_TAG_INFORMATION_ACTIVITY]={processor:ve},Be[Fe.OFFLINE_MY_TAG_LIST]={processor:Se},Be[Fe.OFFLINE_TAG_UNREAD_MESSAGE]={processor:Ce},Be[Fe.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={processor:De},Be[Fe.OFFLINE_TAG_CREATE_TAG]={processor:Ne},Be[Fe.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={processor:Me},Be[Fe.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={processor:Re},Be[Fe.OFFLINE_TAG_HISTORY_MESSAGE]={processor:ye},Be[Fe.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={processor:Oe},Be[Fe.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={processor:be},Be[Fe.OFFLINE_TAG_CONFIRMATION]={processor:Pe},Be[Fe.OFFLINE_BROKEN_HISTORY_PACKET]={processor:Le},Be[Fe.OFFLINE_BROKEN_PACKET]={processor:Ue},Be[Fe.OFFLINE_BROKEN_PACKET_CONFIRMATION]={processor:we},{processUpdates:T}}var r;try{r=e.module("ringid.chat")}catch(i){console.log(i)}r.factory("ChatResponses",n),n.$inject=["$rootScope","chatHistoryFactory","SystemEvents","Auth","tagChatFactory","ChatFactory","tagChatManager","Utils","userFactory","ChatResponseProcessor","ChatSeenSend","ChatHelper","ChatConnector"]}(t)}(angular,window),function(e,t){"use strict";!function(t){function n(t,n,r,i,o,a,s,c,l,u,d){function g(e){return M[e]}function m(e){if(1111==e.rc)return void RingLogger.alert("M: Auth Request Failed",e,RingLogger.tags.CHAT);var t=e.actn,n=g(t);if(!n)return RingLogger.warning("Packet Processor Not Implemented. Action Id ",t,RingLogger.tags.CHAT),!1;try{n.processor.call(this,e)}catch(r){RingLogger.alert("Exception In PACKET Procsessing.",t,r,RingLogger.tags.CHAT)}return!0}function f(e){RingLogger.print("M: Received Auth TAG CHAT Start",e,RingLogger.tags.CHAT);var t=e.tid,i=n.getTag(t);if(i)i=n.getOrCreateTag(t);else{var o=r.getBoxByUId(t);o||(o=r.creatNonDomBox(t,!0));var a=D.getOfflineGetTagInformationWithMembersObject(t);d.request(a).then(function(e){if(e.sucs){var r=n.getTag(t);r&&l.startChatSession(t,A.TAG,r.getMemberUserIds())}})}}function E(t){RingLogger.print("M: Received Auth Add Member ",t,RingLogger.tags.TAG_CHAT);var i=t.tid,o=n.getTag(i);if(o)o=n.getOrCreateTag(i),l.startChatSession(i,A.TAG),t.uIds?e.forEach(t.uIds,function(e){o.addMember(n.createNewTagMember(o.getTagId(),{userId:e},!0))}):RingLogger.error("No Member Info Send Via Auth Update",message,RingLogger.tags.TAG_CHAT);else{var a=r.getBoxByUId(i);a||(a=r.creatNonDomBox(i,!0));var s=D.getOfflineGetTagInformationWithMembersObject(i);d.request(s,10).then(function(e){if(e.sucs){n.getTag(i)}})}}function p(e){RingLogger.print("M: Received Auth F2F CHAT Start",e,RingLogger.tags.CHAT);var t=e.fndId,n=t;if(n!=u.currentUser().getKey()){var r=N(n);r.platform=e.dvc;var i=o.create({uId:e.fndId,utId:e.utId,fn:e.nm});a.getContactDetailsByUtIds([e.utId]);var l=i.getOnlineStatus();i.setOnlineStatus(e.psnc),e.mood&&i.setUserMood(e.mood),e.dt&&i.setDeviceToken(e.dt),e.apt&&i.setAppType(e.apt),e.dvc&&i.setPlatform(e.dvc),l!=i.getOnlineStatus()&&s.sendFriendInformation(i),e.sucs===!0&&e.psnc==C.ONLINE?r.offlineStatus=!1:e.rc==v.PERMISSION_DENIED?r.blocked=!0:r.offlineStatus=!0,c.updateBox(r)}}function T(e){p(e)}function h(e){}function _(e){if(RingLogger.debug("M: Received Auth USER_MOOD_PRESENCE",e,RingLogger.tags.CHAT),e.fndId){var t=o.getUser(e.fndId);t&&(e.psnc&&t.setOnlineStatus(e.psnc),e.mood&&t.setUserMood(e.mood),e.dvc&&t.setPlatform(e.dvc))}else RingLogger.alert("FriendID not present in 199 Response",e,RingLogger.tags.CHAT)}var I=CHAT_APP.Constants,A=I.GENERAL_CONSTANTS.SESSION_TYPES,v=I.RESPONSE_REASON_CODES,S=CHAT_APP.Constants.AUTH_SERVER_ACTIONS,C=I.GENERAL_CONSTANTS.USER_PRESENCE,D=CHAT_APP.ChatRequests,N=function(e){var t=r.getBoxByUId(e);return t||(t=r.creatNonDomBox(e,!1),t.loadHistoryMessages()),t},M={};return M[S.START_F2F_CHAT]={processor:T},M[S.GET_USER_MOOD_PRESENCE]={processor:_},M[S.START_TAG_CHAT]={processor:h},M[S.RECEIVED_TAG_CHAT]={processor:f},M[S.ADD_TAG_CHAT_MEMBERS]={processor:E},M[S.RECEIVED_F2F_CHAT]={processor:p},{processUpdates:m}}var r;try{r=e.module("ringid.chat")}catch(i){}r.factory("ChatAuthResponses",n),n.$inject=["$rootScope","tagChatFactory","ChatFactory","ChatPacketSenderService","userFactory","friendsFactory","chatRequestProcessor","chatHistoryFactory","ChatWorkerCommands","Auth","ChatConnector"]}(t)}(angular,window),function(e,t){"use strict";!function(){function n(n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h,_,I,A,v,S){function C(){try{v.initiate(),p.init(),f.init(),L(),P(),D=E.onCustomEvent(d.FRIEND.UTID_LIST_RECEIVED,function(){U()}),N=E.onCustomEvent(d.CHAT.MY_TAG_LIST_RECEIVED,function(){w()})}catch(e){RingLogger.alert("Chat App Init Error",e,RingLogger.tags.CHAT)}}var D,N,M=CHAT_APP.Constants,R=M.GENERAL_CONSTANTS,y=R.SESSION_TYPES,O=(CHAT_APP.SharedHelpers,!1);n.boxes=i.getBoxes(),n.$on("chatDataReceived",function(e,t){c.processUpdates(t.jsonData),E.safeDigest(n)}),n.$on("authDataReceived",function(e,t){l.processUpdates(t.jsonData),E.safeDigest(n)}),n.domBoxLength=function(){for(var e=0,t=0;t<n.boxes.length;t++)1==n.boxes[t].value.nonDomBox&&e++;return e>10?10:e},n.availableNo=i.getNumberOfAvailableChatBox(),n.getProfileLink=u.baseUrl+"/#/profile/",n.goToProfile=function(e,t){A.path(t),e.stopPropagation()},n.contactListAction=function(e){e.friend.isLoading()||(g.friendAction(e,!0).then(function(){n.$rgDigest()},function(){n.$rgDigest()}),n.$rgDigest())},n.$on(d.COMMON.WINDOW_RESIZED,function(e,t){n.availableNo=i.getNumberOfAvailableChatBox(t.x),E.safeDigest(n)});var b=E.onCustomEvent(d.CHAT.TAB_SYNC_NEW_DATA,function(e){RingLogger.information("TAB SYNC DATA",e,RingLogger.tags.TAB_DATA_RECEIVED),e.type==R.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE?i.refreshBox(e.boxId):e.type==R.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE&&(p.loadChatBoxes(),i.openAndAddMessage(e.boxId,e.msg))}),P=function(){n.$on("NET_SUCCESS",function(){RingLogger.alert("NET WAS DISCONNECTED, REQUESTING OFFLINE MESSAGES",RingLogger.tags.CHAT),a.getUnreadMessagesMultipleTimes()}),t.addEventListener("online",function(e){t.navigator.onLine&&(RingLogger.alert("Browser Gets Online From Offline",RingLogger.tags.CHAT),a.getUnreadMessagesMultipleTimes())})},L=function(){s.hasOfflineIpPort()?a.getUnreadMessagesMultipleTimes():m.doUpdateOfflineIpPort().then(function(e){a.getUnreadMessagesMultipleTimes()})},U=function(){var t=p.getAllOpenBoxes();t&&Object.keys(t).forEach(function(n,r){var o,a=t[n];if(!a.isTagChat){i.openChatBox(a.boxId),o=i.getBoxByUId(a.boxId);var s=p.getBox(a.boxId);e.extend(o,s),S.startChatSession(a.boxId,y.FRIEND),o&&o.loadHistoryMessages()}})},w=function(){var e=p.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t,n){var r=e[t];r.isTagChat&&I.openPreviouslyOpenedBoxes(r.boxId)})},F=function(){r.$on("FIRST_FEED_RECEIVED",function(){O||(O=!0,C())}),setTimeout(function(){O||(O=!0,C())},6e3)};_.isLoggedIn()?F():n.$on(d.AUTH.LOGIN,function(e,t){t===!0&&F()}),n.$on("$destroy",function(){E.removeCustomEvent(d.CHAT.TAB_SYNC_NEW_DATA,b),E.removeCustomEvent(d.FRIEND.UTID_LIST_RECEIVED,D),E.removeCustomEvent(d.CHAT.MY_TAG_LIST_RECEIVED,N)})}e.module("ringid.chat").controller("ChatController",n),n.$inject=["$scope","$rootScope","ChatFactory","ChatHelper","chatRequestProcessor","ChatUtilsFactory","ChatResponses","ChatAuthResponses","settings","SystemEvents","friendsFactory","ChatPacketSenderService","chatTabSync","Utils","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","$location","ChatConnector","ChatWorkerCommands"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m){var f=CHAT_APP.Constants,E=f.GENERAL_CONSTANTS,p=(f.CHAT_GLOBAL_VALUES,CHAT_APP.SharedHelpers);t.selectedLeftBox={key:0,messages:[]},t.boxes=d.createNew(!0),t.recentMessages=d.createNew(!0),t.ready=n.chatHistoryReady||!1,t.selectLeftBox=function(e){t.selectedLeftBox=e};var T=function(e){var t=p.getClientTimeFromServerTime(e),n=l.verbalDate(t);return n};t.getMessageTime=T;var h=function(e,n){n&&(e.user=c.create({uId:n}),e.user.requestUserDetails().then(function(){t.$rgDigest()}))},_=function(e){return e.statusType?"Activity message.":e.messageType==E.MESSAGE_TYPES.PLAIN_MESSAGE?e.text:"Received media message."},I=function(e){return"Unread"==e.status?!0:"Received"==e.status&&!e.seenSent},A=function(e){return u.getUnreadMessageCountByBoxId(e.key)},v=function(t){var n=e.copy(t);return n.date=T(n.messageDate),n.isUnread=function(){return I(n)},n.messageText=function(){return _(n)},n.user.getKey&&h(n,n.user),n.isSelf=function(){return t.userId==o.currentUser().getKey()},n},S=function(e){var t=!1;return e.messages&&e.messages.length>0&&(e.messages.sort(function(e,t){return e.messageDate>t.messageDate?1:e.messageDate<t.messageDate?-1:0}),t=e.messages[e.messages.length-1]),t},C=function(e){var n=u.getChatBoxes(),r=n[e],i=t.boxes.get(e);if(i){i.messages=r.messages;var o=S(i);o&&(i.lastMessage=v(o))}},D=function(t){var n=e.copy(t),r=S(n);if(r&&(n.lastMessage=v(r)),n.unreadCount=function(){return A(t)},n.sortBy=function(){return this.lastMessage.messageDate},n.isTagChat){var i=t.key;s.getTag(i);n.getTitle=function(){var e=s.getTag(i);return e?e.getTagName():""},n.getCover=function(){var e=s.getTag(i);return e?e.getPictureFullUrl():""},n.shouldVisible=function(){var e=s.getTag(i);return e?e.isTagSafeToShow():!1}}else h(n,n.key),n.getTitle=function(){return n.user.getName()},n.getCover=function(){return n.user.avatar("thumb")},n.shouldVisible=function(){return!0};return n};t.initBoxMessages=function(n){n.messages&&e.forEach(n.messages,function(e,n){var e=v(e);t.recentMessages.add(e.key,e)})},t.initRecentMessages=function(){var n=(o.currentUser().getKey(),u.getChatBoxes());n&&e.forEach(n,function(e,n){var r=D(e);r.lastMessage&&t.boxes.add(e.key,r)})},t.clearRecentMessages=function(){t.recentMessages.clear()},t.openChatBox=function(e,t){l.triggerCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED),t?r.openTagChatBox(e):r.openChatBox(e)},t.initRecentMessages(),n.chatHistoryReady||setTimeout(function(){t.ready=!0,n.chatHistoryReady=!0,t.$rgDigest(),m.recalculate(t)},3e3);var N=l.onCustomEvent(g.CHAT.MY_TAG_LIST_RECEIVED,function(){l.safeDigest(t)}),M=l.onCustomEvent(g.CHAT.TAG_LIST_UPDATED,function(){l.safeDigest(t)}),R=l.onCustomEvent(g.CHAT.MESSAGE_RECEIVED,function(e){C(e.boxId),l.safeDigest(t)}),y=l.onCustomEvent(g.CHAT.MESSAGE_SUBMITTED,function(e){C(e.boxId),l.safeDigest(t)});t.$on("$destroy",function(){l.removeCustomEvent(g.CHAT.MY_TAG_LIST_RECEIVED,N),l.removeCustomEvent(g.CHAT.TAG_LIST_UPDATED,M),l.removeCustomEvent(g.CHAT.MESSAGE_SUBMITTED,y),l.removeCustomEvent(g.CHAT.MESSAGE_RECEIVED,R)})}e.module("ringid.chat").controller("ChatHistoryController",t),t.$inject=["$scope","$rootScope","ChatFactory","Storage","Auth","Api","tagChatFactory","userFactory","Utils","chatHistoryFactory","$$stackedMap","SystemEvents","rgScrollbarService"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o){e.navSection=0,e.sendMedia=function(){if(e.capturedMedia&&i.boxId){var a=t.queueFile("chatimage",n.dataURLToBlob(e.capturedMedia));n.triggerCustomEvent(o.CHAT.BOX_CAM_UPLOAD,{uploadFile:a,boxId:i.boxId}),r.close()}}}e.module("ringid.chat").controller("ChatMediaUploadController",t),t.$inject=["$scope","fileUploadService","Utils","$boxInstance","localData","SystemEvents"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){function T(e){return{tagId:e.getTagId(),isOwner:A.isCurrentUserOwner(e)}}function h(e){for(var t=[],n=e.getMembersObjectMap().all(),r=0,i=0;i<n.length&&3>r;i++){var o=n[i].value,a=o.getPictureUrl();""!==a&&(t.push(a),r++)}return t}function _(e){var t=u.getLastMessageByTag(e.getTagId());return t?t.value:!1}function I(t){switch(t.action){case"edit":case"view":return s.close(),function(){return{tagId:t.tagId}};case"delete":s.close();var n=g.getTag(t.tagId);n.setObjectLock(),m.leaveFromTag(t.tagId,S.getKey()).then(function(t){n.removeObjectLock(),e.$rgDigest()},function(t){n.removeObjectLock(),a.show(t,"error"),e.$rgDigest()}),e.$rgDigest();break;default:console.log("Err. no matching action")}}var A=this;A.memberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html",A.memberDDActions=I,A.getTagDDControl=T,A.ready=!1,A.groupFilter="groups";try{A.debug=RingLogger.conditions[RingLogger.tags.TAG_CHAT]}catch(v){A.debug=!1}var S=o.currentUser();CHAT_APP.Constants.CHAT_GLOBAL_VALUES;A.isCurrentUserOwner=function(e){return e.getOwnerUserId()==S.getKey()},A.isCurrentUserMember=function(e){return e.isUserMember(S.getKey())},A.allTags=g.getTags(),A.changeGroupFilter=function(e){A.groupFilter=e||"groups"},A.showGroupLogs=function(e){return"logs"===A.groupFilter},A.showGroups=function(e){return"groups"===A.groupFilter},A.getTagPictureImageByMemberAvatars=h,A.getLastMessageOnATag=_,A.imageBase=r.imBase,A.getUserAvatar=function(e){return e&&e.avatar()?e.avatar():"images/prof.png"},A.getLastMessageText=function(e){return 2===e.messageType?e.text:-1!==[6,7,8,9].indexOf(e.messageType)?"Media":!1};e.shouldShow=function(){return A.ready},e.showSingleMemberAlert=function(){a.show({mg:"Please add a member before leaving the group."},"info")};var C=l.onCustomEvent(p.CHAT.TAG_LIST_UPDATED,function(){A.allTags=g.getTags(),A.ready=!0,l.safeDigest(e)});n(function(){A.ready=!0},8e3),e.$on("$destroy",function(){l.removeCustomEventListener(p.CHAT.TAG_LIST_UPDATED,C)})}e.module("ringid.chat").controller("TagChatController",n),n.$inject=["$scope","$templateCache","$timeout","settings","$$connector","Auth","Ringalert","rgDropdownService","ChatFactory","Utils","tagChatStorage","friendsFactory","tagChatFactory","tagChatManager","chatRequestProcessor","ChatHelper","SystemEvents"]}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T){function h(){n.memberList=i.createNew(),n.adminList=i.createNew()}function _(){t(function(){n.friends=l.friends.copy(),g.safeDigest(n)},2e3)}function I(e){return!!e&&e.getOwnerUserId()===o.currentUser().getKey()}function A(e){return!0}function v(e){if(e.getId()===G)return!1;if(n.tag&&!I(n.tag)){var t=e.getAddedBy()!==o.currentUser().getKey();if(n.tag.isCurrentUserStatusAdmin(G))if(e.isAdmin()&&t);else if(!e.isMember())return!1;if(n.tag.isCurrentUserStatusMember(G)&&t)return!1}return!0}function S(){return!n.editMode||!n.tag.isCurrentUserStatusMember(G)}function C(){n.state.loading||n.friends.length()===l.totalFriends("friends")||(R(!0),l.getContactDetails().then(function(){n.friends=l.getFriends("friends"),R(!1)},function(){R(!1)}),setTimeout(function(){n.state.loading=!1},3e3))}function D(){if(!w())return void g.safeDigest(n);var e=n.models.tagName,t=n.memberList.keys(),i=n.adminList.keys(),o=n.models.tagId,a=n.models.pictureFileName;c.createTag({tagName:e,memberUIds:t,adminUIds:i,tagId:o,tagPictureUrl:a}).then(function(e){},function(e){d.show(F.DEFAULT_FAILURE_MESSAGE,"error")},function(e){}),r.close()}function N(e){var t=s.getTag(n.tag.getTagId());t.removeObjectLock()}function M(){if(!w())return void g.safeDigest(n);var e=s.getTag(n.tag.getTagId()),t=n.models.tagName,i=n.models.pictureFileName,o=n.memberList.keys(),a=n.adminList.keys();n.tag.setObjectLock(),c.updateTag(e,t,i,o,a).then(function(e){N(n.tag.getTagId())},function(e){N(n.tag.getTagId()),d.show(F.DEFAULT_FAILURE_MESSAGE,"error")},function(e){e.sucs&&N(n.tag.getTagId())}),n.editMode=!1,g.triggerCustomEvent(T.CHAT.MY_TAG_LIST_RECEIVED),r.close()}function R(e){t(function(){n.state.loading=e,e||E.recalculate(n)})}function y(e,t){n.memberList.length()+n.adminList.length()>n.friends.length()-10&&C();var r=n.tag?n.tag.getTagId():n.models.tagId,i=s.createNewTagMember(r,{status:"member"==t?k.MEMBER_STATUS.MEMBER:k.MEMBER_STATUS.ADMIN,addedBy:G},!1);return A(i)?(n.tag&&i.setTagId(n.tag.getTagId()),i.initWithUserMapObject(e),"admin"===t?n.adminList.add(i.getId(),i):n.memberList.add(i.getId(),i),void g.safeDigest(n)):void d.show("Permission Denied","error")}function O(e){v(e)?(e.isAdmin()?n.adminList.remove(e.getId()):n.memberList.remove(e.getId()),g.safeDigest(n)):d.show("Permission Denied","error")}function b(e){return n.newOwnerTagMember&&e.getId()===n.newOwnerTagMember.getId()}function P(e){n.newOwnerTagMember=e,g.safeDigest(n)}function L(){var e=n.newOwnerTagMember,t=n.tag;n.newOwnerTagMember=!1;var i=e.getStatus();e.makeOwner();var a=t.getMember(o.currentUser().getKey());a.makeMember();var s=function(){e.setStatus(i),a.makeOwner(),t.removeObjectLock()},l=[e.serialize(),a.serialize()],u=[e,a];t.setObjectLock(),c.changeTagMemberStatus(t.getTagId(),l,u).then(function(){c.leaveFromTag(t.getTagId()).then(function(e){t.removeObjectLock()},function(){d.show(F.DEFAULT_FAILURE_MESSAGE,"error"),s()})},function(){d.show(F.DEFAULT_FAILURE_MESSAGE,"error"),s()}),g.safeDigest(n),r.close()}function U(){n.newOwnerTagMember=!1,r.close(),g.safeDigest(n)}function w(){return n.models.tagName.length>100?n.models.errTagName="Maximum 100 alpha numeric characters":n.models.errTagName="",n.models.errMemberList=n.memberList.length()+n.adminList.length()<2,!n.models.errMemberList&&!n.models.errTagName}var F=p.TAG,k=CHAT_APP.Constants.GENERAL_CONSTANTS;n.state={loading:!1,noData:!1};var $={};n.friends=l.getFriends("friends"),n.friendName="",n.editMode=!1,n.addToTag=y,n.removeMember=O,n.createChatTag=D,n.updateChatTag=M,n.loadMoreFriends=C,n.cancel=U,n.validateTag=w,n.newOwnerTagMember=!1,n.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:s.generateNewTagId()},n.uploading=!1,n.selectNewOwner=L,n.setNewOwner=P,n.isMemberSelected=b,n.canRemoveMember=v,n.canUpdateTagInfo=S,n.getPicturePreviewUrl=function(){return m.tagChatImBase+n.models.pictureUrl},n.contactListAction=function(e){e.friend.isLoading()||(l.friendAction(e,!0).then(function(){n.$rgDigest()},function(){n.$rgDigest()}),n.$rgDigest())},n.uploadAction=function(e){console.log(e),e.uploadFile.fetchMeta(function(){n.models.pictureUrl=e.uploadFile.getPreview(),n.uploading=!0,g.safeDigest(n),e.uploadFile.initUpload().then(function(e){n.uploading=!1,console.info("chat image uploaded:"+e),n.models.pictureFileName=e.iurl,n.models.pictureUrl=m.imBase+e.url,g.safeDigest(n)},function(e){console.log(e),n.uploading=!1})})};var G=o.currentUser().getKey();if(u&&u.tagId){n.tag=s.getTag(u.tagId),$=n.memberList;var H=n.tag.getMembersObjectMap();H?(n.memberAdminList=H.copy(),h(),n.tag.initMemberObjects(),e.forEach(n.memberAdminList.all(),function(e){e.value.isMember()?n.memberList.add(e.key,e.value):n.adminList.add(e.key,e.value)})):h(),n.models.tagName=n.tag.getTagName(),n.models.popupTitle="Update Group chat",n.models.pictureUrl=n.tag.getPictureFullUrl(),n.models.pictureFileName=n.tag.getPictureUrl(),n.editMode=!0}else h();var B=g.onCustomEvent(T.CHAT.TAG_MEMBER_FETCHED,function(e){n.$rgDigest()});n.$watch("friendName",function(e,t){console.log("search contact: "+e),""!=e&&(l.searchContact({schPm:e},!0),_())}),n.$watch(function(){return n.friends.length()-n.adminList.length()-n.memberList.length()},function(e,t){10>e&&C()}),n.$watch("friendName",function(e){e&&e.length>1&&(R(!0),l.searchContact({schPm:e},!0).then(function(){n.friends=l.getFriends("friends"),R(!1)},function(){R(!1)}))}),n.$on("$destroy",function(){g.removeCustomEvent(T.CHAT.TAG_MEMBER_FETCHED,B),n.tag.unregisterMemberObjectsListener()})}e.module("ringid.chat").controller("TagChatPopupController",t),t.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","profileFactory","rgScrollbarService","CHAT_LANG","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c,l,u,d){function g(){o.registerTag(e.tag.getTagId())}function m(){}CHAT_APP.Constants.GENERAL_CONSTANTS;e.currentUserUId=n.currentUser().getKey(),e.registerTag=g,e.unregisterTag=m,s&&s.tagId&&(e.tag=i.getTag(s.tagId),e.tagDebugInfo={},e.tagDebugInfo.isTagRegistered=i.isTagRegistered(s.tagId),e.chatBox=r.getBoxByUId(s.tagId))}e.module("ringid.chat").controller("TagChatDebugInfoController",t),t.$inject=["$scope","$boxInstance","Auth","ChatFactory","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","profileFactory"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t){var n=CHAT_APP.Constants,r=(n.GENERAL_CONSTANTS,n.CHAT_GLOBAL_VALUES,function(e){return e=t.parseForLE(e,0)}),i=function(){var t=e.loginData,n={ip:"",port:""};return t&&(n.ip=t.oIP,n.port=t.oPrt),n},o=function(){var e=i();return!(!e||!e.ip||!e.port)},a=function(e){var n=CHAT_APP.SharedHelpers.getClientTimeFromServerTime(e);return t.chatVerbalDate(n)};return{parseForLE:r,getOfflineIpPort:i,hasOfflineIpPort:o,getChatVerbalDateFromServerDate:a}}var n;n=e.module("ringid.chat"),n.factory("ChatUtilsFactory",t),t.$inject=["Auth","Utils"]}()}(angular,window),function(e,t){"use strict";!function(){function n(){var e,t;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(t="new",e=navigator.mediaDevices.getUserMedia):(t="old",e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),{gum:e,version:t}}function r(r){var i=this,o="old",a=null,s={recordedImage:{width:0,height:0,image:""},recordedVideo:{width:0,height:0,video:""},mediaPreview:{width:400,height:400},mediaStream:"",mediaObject:"",isStreaming:!1,text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser"}};e.extend(s,r);var c=function(){},l=function(){};this._callbacks={streamReady:c,error:l};var u=function(){var e=n();a=e.gum,o=e.version},d=function(){i.getMediaObject().readyState>3?i.onCanPlay():i.getMediaObject().addEventListener("canplay",i.onCanPlay,!1)},g=function(e){var n=document.createElement("video"),r=t.URL||t.webkitURL;return n.src=r.createObjectURL(e),n.autoplay=!0,n},m=function(e){s.mediaStream=e,s.mediaObject=g(e),d()},f=function(e){var t;t="DevicesNotFoundError"==e.name||"OverconstrainedError"==e.name?s.text.WEBCAM_DISCONNECTED:"PermissionDeniedError"==e.name?s.text.PERMISSION_DENINED:s.text.GUM_NOT_SUPPORTED,i.triggerEvent("error",{text:t}),RingLogger.alert("rgRecorder failure",e,RingLogger.tags.RG_RECRODER)};i.on=function(e,t){i._callbacks[e]=t},i.triggerEvent=function(e,t){i._callbacks[e]&&i._callbacks[e].call(i,t)},i.getProps=function(){return s},i.getMediaPreview=function(){return s.mediaPreview},i.getMediaObject=function(){return s.mediaObject},i.getStream=function(){return s.mediaStream},i.setStream=function(e){s.mediaStream=e},i.isStreaming=function(e){return e?void(s.isStreaming=e):s.isStreaming},i.startRecording=function(){i.getStream().record()},i.stopRecording=function(){var e=i.getStream();if(e.getTracks){var t=e.getTracks();t.forEach(function(e){e.stop()})}else e.stop()},i.getRecordedMedia=function(e){i.getStream().getRecordedData(e)},i.captureImage=function(){var e=i.getMediaObject(),t=document.createElement("canvas"),n=t.getContext("2d");return e.width&&e.height?(t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),t.toDataURL("image/jpeg")):!1},i.onCanPlay=function(e){var t=i.getMediaObject(),n=i.getMediaPreview();if(!i.isStreaming()){var r=t.videoHeight/(t.videoWidth/n.width);isNaN(r)&&(r=width/(4/3)),t.setAttribute("width",n.width),t.setAttribute("height",r),i.isStreaming(!0),i.triggerEvent("streamReady",{stream:i.getStream(),media:t})}},i.openMedia=function(e){if(a)try{"old"==o?a.call(navigator,e,m,f):a.call(navigator.mediaDevices,e).then(m)["catch"](f)}catch(t){RingLogger.alert(t,"WEBCAM")}else i.triggerEvent("error",{text:s.text.GUM_NOT_SUPPORTED})},i.destroy=function(){var e=i.getMediaObject();e&&e.removeEventListener("canplay",i.onCanPlay),i.getStream()&&(i.stopRecording(),i.setStream(null))};var E=function(){u()};E()}function i(){var e=!1,t=!1;this.getRecorderInstance=function(e){return new r(e)},this.hasUserMediaSupport=function(){return e||(t=!!n().gum,e=!0),t}}e.module("ringid.chat").service("rgRecorderService",i)}()}(angular,window),function(e,t){"use strict";!function(){var t;try{t=e.module("ringid.chat")}catch(n){}t.factory("ChatMap",["$$stackedMap","$interval","$websocket","$rootScope","$sce","Auth","ChatConnector","userFactory","Utils","tagChatFactory","chatHistoryFactory","settings","tagChatHelper","tagChatStorage","ChatUtilsFactory","rgScrollbarService","chatTabSync","$$mediaMap","SystemEvents",function(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h,_){var I=CHAT_APP.Constants,A=(I.CHAT_GLOBAL_VALUES,I.GENERAL_CONSTANTS),v=CHAT_APP.SharedHelpers,S=function(e){var t=e.key||e.packetId,n=e.messageDate||(new Date).getTime(),r={key:t.toString(),packetId:t.toString(),text:e.message||e.mg||e.text,hrtime:E.getChatVerbalDateFromServerDate(n),status:e.status||0,fullName:e.fullName,tagName:e.tagName||"",messageDate:n,isDeleted:!1,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat||!1,seenSent:e.seenSent||!1,isSecretVisible:e.isSecretVisible,secretTimedOut:e.secretTimedOut?e.secretTimedOut:!1,lastUpdateTime:(new Date).getTime(),platform:5,scroll:e.scroll};return e.tag_chat?(r.packetType=e.packetType||63,r.brokenPacketType=e.brokenPacketType):(r.packetType=e.packetType||6,r.brokenPacketType=e.brokenPacketType),r};return{create:function(r,a){var s,f,p,I,C=r;a?(p=r,f=u.getTag(p)):I=c.create({uId:r});var D=!1,N=!1,M={},R="",y=t.createNew(!0,"asc"),O=function(t,n,i){var a;if(t.type&&101===t.type)return void(D=!0);if(0==t.type&&0===t.status)return a=y.get(y.packetId),void(a.isDeleted=!0);var s="",u=S(t);e.isObject(n)||(n=c.create({uId:t.userId,fetchDatails:!1}));var f={locationInfo:{},ogData:{},seenUserIds:{},deliveredUserIds:{},user:n,sortBy:function(){return t.messageDate},getTextPartition:function(){return s},setTextPartition:function(){s=E.parseForLE(f.text),s=o.trustAsHtml(s)},getMessageTime:function(){return Cmessage.hrtime},seenUsersCount:function(){return Object.keys(f.seenUserIds).length},deliveredUsersCount:function(){return Object.keys(f.deliveredUserIds).length},addSeenUserId:function(e){f.seenUserIds[e]=!0},addDeliveredUserId:function(e){f.deliveredUserIds[e]=!0},updateLocationInfo:function(){var t,n,r;try{t=e.fromJson(f.text),n=t.la,r=t.lo,f.locationInfo={lat:n,"long":r,description:t.loc},f.plainText=t.loc}catch(i){}},updateLinkShareInfo:function(){f.ogData={};try{var t=e.fromJson(f.text);f.ogData={lnkDmn:t.u,description:t.d,title:t.t,url:t.u,image:t.i,message:t.m},f.plainText=t.m}catch(n){}},updateMediaInfo:function(){var t;try{t=e.fromJson(f.text),f.mediaInfo={url:t.u,caption:t.c,width:t.w,height:t.h};var n=l.getScaledImageSize(f.mediaInfo.width,f.mediaInfo.height,l.viewport.x,l.viewport.y),r=l.getScaledImageSize(f.mediaInfo.width,f.mediaInfo.height,150,300);f.mediaInfo.width=n.width,f.mediaInfo.height=n.height,f.mediaInfo.thumbWidth=r.width,f.mediaInfo.thumbHeight=r.height,f.plainText=t.c}catch(i){RingLogger.alert(i,"CHAT")}},updateRingMediaInfo:function(){var t;try{var t=e.fromJson(f.text);f.ringMediaObject=h(t)}catch(n){RingLogger.alert(n,"CHAT")}},getSafeMapJsUrl:function(){return o.trustAsResourceUrl(f.mapJsEmbededUrl)},refreshStatusMessageText:function(){s=m.getTagChatStatusMessage(t),s=o.trustAsHtml(s)}};if(e.extend(f,u),t.userId=f.userId=f.user.getKey(),t.usersToChange&&(f.usersToChange=t.usersToChange),t.statusType&&(f.statusType=t.statusType),"status_update"!==t.status)if(1!=t.secretTimedOut&&"Deleted"===t.status)f.messageType=2,s=E.parseForLE(f.text);else switch(t.messageType){case A.MESSAGE_TYPES.DELETE_MESSAGE:f.text="This msg has been deleted";break;case A.MESSAGE_TYPES.TEXT:case A.MESSAGE_TYPES.EMOTICON_MESSAGE:s=E.parseForLE(f.text);break;case A.MESSAGE_TYPES.LOCATION_SHARE:f.updateLocationInfo();var p=f.locationInfo.lat,I=f.locationInfo["long"];0!=p&&0!=I?(f.mapStaticUrl=l.getGoogleMapStaticUrl(p,I),f.mapJsUrl=l.getGoogleMapJSUrl(p,I),f.mapJsEmbededUrl=l.getGoogleMapJSUrl(p,I,"",!0)):s=E.parseForLE(f.text);break;case A.MESSAGE_TYPES.LINK_SHARE:f.updateLinkShareInfo();break;case A.MESSAGE_TYPES.STICKER:f.stickerUrl=g.stickerBase+f.text;break;case A.MESSAGE_TYPES.IMAGE:case A.MESSAGE_TYPES.CAMERA_IMAGE:f.updateMediaInfo();try{f.mediaUrl=g.imBase+f.mediaInfo.url}catch(v){f.mediaUrl=""}s="";break;case A.MESSAGE_TYPES.AUDIO:f.updateMediaInfo(),f.isVideo=!1;try{f.mediaUrl=g.mediaBase+f.mediaInfo.url}catch(v){f.mediaUrl=""}break;case A.MESSAGE_TYPES.VIDEO:f.updateMediaInfo(),f.isVideo=!0;try{f.mediaUrl=g.mediaBase+f.mediaInfo.url}catch(v){f.mediaUrl=""}break;case A.MESSAGE_TYPES.RING_MEDIA_MESSAGE:f.updateRingMediaInfo();try{f.plainText=f.ringMediaObject.getCaption(),f.thumbURL=f.ringMediaObject.getThumbForMedia(),
f.albumName=f.ringMediaObject.getAlbumName(),f.artistName=f.ringMediaObject.getArtistName(),f.durationText=f.ringMediaObject.getDuration(!0)}catch(v){RingLogger.alert(v,"CHAT"),f.thumbURL=""}break;default:return void RingLogger.log("Skipping UnHandled Chat Message Type.",f.messageType,"CHAT")}else{if(!(t.usersToChange&&t.usersToChange.length>0))return;if(s=m.getTagChatStatusMessage(t),!s)return}s=o.trustAsHtml(s),y.save(f.key,f),t.fromLocalHistory||L(f);var C=r.toString();d.addMessage(f,C),l.triggerCustomEvent(_.CHAT.MESSAGE_PUSHED,{boxId:C,fromLocalHistory:t.fromLocalHistory||!1,fromHistory:t.fromHistory||!1,msg_status:u.status.toLowerCase()}),i&&T.sendData(A.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:C,msg:u,isTagChat:t.tag_chat})},b=function(t,n){var r=t.key||t.packetId,i=v.getChatServerCurrentTime(),a=[],s={key:r,text:t.message||t.mg||t.text,hrtime:E.getChatVerbalDateFromServerDate(i),status:t.status||0,messageType:t.messageType,uploading:t.uploading,uploadProgress:t.uploadProgress,messageDate:i,isDeleted:!1,messageDateString:t.messageDateString||"",mediaUrl:t.mediaUrl,mediaInfo:{thumbWidth:150,thumbHeight:63},timeout:t.timeout,isSecretVisible:t.isSecretVisible,user:e.isObject(n)?n:c.getUser(t.userId),lastUpdateTime:(new Date).getTime(),sortBy:function(){return t.messageDate},getTextPartition:function(){return a},setTextPartition:function(){a=E.parseForLE(s.text),a=o.trustAsHtml(a)}};a=E.parseForLE(s.text),a=o.trustAsHtml(a),y.save(s.key,s),l.triggerCustomEvent(_.CHAT.MESSAGE_PUSHED,{boxId:C,fromLocalHistory:!1,fromHistory:!1,msg_status:s.status})},P=function(e,t){},L=function(e){var t=s,n=e.key||e.packetId;if("status_update"==e.status)try{n=n.split("_")[0]}catch(r){RingLogger.alert(r,"CHAT")}t.messageMaxDate<e.messageDate&&(t.messageMaxDate=e.messageDate,t.messageMaxPacketId=n),(!t.messageMinDate||t.messageMinDate>=e.messageDate)&&(t.messageMinDate=e.messageDate,t.messageMinPacketId=n)};return s={isTagChat:!1,boxTitle:"",unreadCount:0,messageMaxPacketId:"",messageMinPacketId:"",messageMaxDate:0,messageMinDate:0,latestSeenMessageDate:0,hasHistoryMessage:!1,messages:y.all(),getTitleString:function(){var e=s,t=e.getTitle();return a||t||(t=e.getKey()),e.unreadCount>0&&(t=t+" ("+e.unreadCount+")"),t},updateUnreadCount:function(){var e=s;e.unreadCount=d.getUnreadMessageCountByBoxId(C)},getProfileLink:function(){var e=s;return e.isTagChat?void 0:"/profile/"+e.getUser().getKey()},checkWaitingTimePassed:function(){var e=Math.floor(Date.now()/1e3);return e-this.lastCommunicationTime>this.waitingTime},pushMessage:function(e,t,n){O(e,t,n)},pushDummyMessage:function(e,t){b(e,t)},sendTabUpdate:function(e){var t=S(e);T.sendData(A.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:C,msg:t,isTagChat:e.tag_chat})},processMessage:function(e,t){P(e,t)},getKey:function(){return r.toString()},getTagItem:function(){return f||u.getTag(s.getKey())},getUser:function(){return f?f:I},getTitle:function(){return f?this.boxTitle=f.getTagName():I&&(this.boxTitle=I.getName()),this.boxTitle},setTitle:function(e){this.boxTitle=e},isConsicutive:function(e){var t=y.get(e),n=y.previous(e);return!(!n||"status_update"==n.status||n.user.getKey()!==t.user.getKey())},isSamePacketId:function(e){return!!y.get(e.toString())},getMessages:function(){return y.all()},getMessage:function(e){return y.get(e.toString())},getBottomMessage:function(){return y.bottom()},getTopMessage:function(){return y.top()},removeMessage:function(e){y.remove(e.toString())},updateMessageStatus:function(e,t){var n=y.get(e);return n?(n.status=t,n):!1},isTyping:function(){return D},setTypingBool:function(e){D=e},isFriendTyping:function(){return N},showTypingText:function(e){M[e]=!0,D=N=!0},hideTypingText:function(e){delete M[e],D=N=!1},getTypingText:function(){if(R="is typing ...",a){var e=u.getTag(s.getKey()),t=Object.keys(M),n=" is typing ...";M.length>3&&(t=M.slice(0,3),n=" and "+M.length-3+" others are typing...");var r=[];t.forEach(function(t){var n=e.getMember(t);r.push(n.getName())}),R=r.join(",")+n}else R=s.getUser().getName()+" "+R;return R},setFriendTypingBool:function(e){N=e},startTimer:function(){var t=s,r=t.getMessages();if(e.isArray(r)&&r.length>0)for(var o=0;o<r.length;o++)if(r[o].value.timeout>0&&0==t.isMinimized&&0==t.isHidden&&!r[o].value.timerStartFlag)switch(r[o].value.messageType){case 2:case 3:case 4:case 5:case 6:var a=r[o].value.timeout,c=r[o].value;c.key=c.packetId,r[o].value.timerStartFlag=!0;var l=function(e,t){i.$broadcast("timeoutDelete",e.key,t)};!function(e,t){n(function(){l(e,t--)},1e3,t+1)}(c,a)}},updateBoxMessageMinMaxPacketId:L,loadHistoryMessages:function(){var e=s,t=!1,n=d.getMessages(C);if(n)for(var r=0;r<n.length;r++){var i=n[r];L(i),i.fromLocalHistory=!0;var o=!1;0==i.status&&(v.getChatServerCurrentTime()-i.messageDate>12e4?(i.status="Failed",t=!0):o=!0),"Seen"==i.stauts&&i.messageDate>e.latestSeenMessageDate&&(e.latestSeenMessageDate=i.messageDate)}t&&d.updateMessages(n,C),e.updateUnreadCount(),l.triggerCustomEvent(_.CHAT.HISTORY_LOADED,{boxId:C})}}}}}])}()}(angular,window),function(e,t){"use strict";!function(){function n(e,t){CHAT_APP.GLOBALS[e]=t}function r(r,o,a,s,c){var l=CHAT_APP.Constants,u=CHAT_APP.PacketFormats.CHAT_PACKET_INFO,d=l.WORKER_NOTIFIER_TYPES,g=l.GENERAL_CONSTANTS,m=l.CHAT_GLOBAL_VALUES,f={},E=!1;i=new Worker(t.location.origin+g.CHAT_WORKER_PATH);var p=function(e,t){try{var n=u[e.packetType].PACKET_NAME;RingLogger.debug("{1}({0}, {2})".format(e.packetType,n,t.toUpperCase()),e,RingLogger.tags.CHAT_REQUEST)}catch(r){}},T=function(e,t,n){f[e]||(f[e]=[]),n=n||null,f[e]={ctx:n,fn:t,ct:Date.now()}},h=function(){if(!E){if(!RingMessageChannel.port2)return void setTimeout(h,500);var e={command:"SETTINGS",url:c.socketProtocol+t.location.host+"/ChatSocket/"+t._cti,tabId:t._cti,salt:Cookies.get("sId"),sKey:Cookies.get("sessionID"),appVersion:c.apiVersion,CLIENT_DATA_SIZE:512};try{var r=a.currentUser().getKey();r&&(e.uId=a.currentUser().getKey()),e.oIpPort=s.getOfflineIpPort()}catch(o){RingLogger.information("Current User Exception ",o,RingLogger.tags.CHAT)}try{i.postMessage(e,[RingMessageChannel.port2])}catch(o){RingLogger.alert("Chat Woker Exception ",o,RingLogger.tags.CHAT)}n("uId",r),n("appVersion",c.apiVersion),E=!0}};return i.addEventListener("error",function(e){RingLogger.alert(e,"WORKER_ERROR")}),i.addEventListener("message",function(e){switch(e.data.notifier){case d.DEBUG:try{RingLogger[e.data.type].apply(null,e.data.m)}catch(t){RingLogger.alert("Invalid Worker Log Type",RingLogger.tags.CHAT)}break;case d.CHAT_DATA_RECEIVED:e.data.object&&r.$broadcast("chatDataReceived",{jsonData:e.data.object});break;case d.AUTH_DATA_RECEIVED:e.data.object&&r.$broadcast("authDataReceived",{jsonData:e.data.object});break;case d.CHAT_REQUEST_RESPONSE:var n=e.data.object.packetId,i=e.data.object,o=f[n];n&&o&&(i.notify?o.fn.notify.call(o.ctx,i):i.sucs?o.fn.resolve.call(o.ctx,i):i.error?(RingLogger.alert("Error : ",i.msg,RingLogger.tags.CHAT),o.fn.resolve.call(o.ctx,i)):i.sucs||o.fn.resolve.call(o.ctx,i)),delete f[n];break;case d.AUTH_REQUEST_RESPONSE:break;case d.CHAT_TIMER_UPDATE:var a=e.data.object.serverTime;m.serverTime=a;break;case d.RE_INIT:h();break;case d.EXCEPTION:try{RingLogger[e.data.type].apply(null,e.data.m)}catch(t){RingLogger.alert("Invalid Worker Log Type",RingLogger.tags.CHAT)}}}),{initiate:h,sendCommand:function(n,r){var o={command:n,tabId:t._cti},a=e.extend({},r,o);i.postMessage(a)},sendGlobal:function(e,r){n(e,r);var o={command:"UPDATE_GLOBALS",tabId:t._cti};o[e]=r,i.postMessage(o)},rawSend:function(e){i.postMessage({command:"RAW_SEND",tabId:t._cti,object:e})},send:function(e,n){p(e,"send"),i.postMessage({command:"SEND",tabId:t._cti,object:e,retryCount:n})},request:function(e,n){p(e,"request");var r=o.defer();return e.packetId||(e.packetId=s.getUUIDPacketId()),T(e.packetId,r,this),i.postMessage({command:"REQUEST",tabId:t._cti,object:e,retryCount:n}),r.promise}}}var i,o;try{o=e.module("ringid.chat")}catch(a){}o.factory("ChatConnector",r),r.$inject=["$rootScope","$q","Auth","ChatUtilsFactory","settings"]}()}(angular,window),function(e,t){"use strict";!function(){function t(){function e(e,t){}return{ChatPacketException:e}}var n=e.module("ringid.chat");n.factory("ChatExceptions",t),t.$inject=[]}()}(angular,window),function(e,t){"use strict";!function(){var t;try{t=e.module("ringid.chat")}catch(n){}t.factory("ChatFactory",["settings","Storage","$$stackedMap","ChatMap","Auth","Utils","ChatConnector","chatHistoryFactory","userFactory","friendsFactory","tagChatFactory","$interval","SystemEvents","OPERATION_TYPES","$rootScope",function(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E){function p(){return T||(T=new CHAT_APP.UTILS.ChatClock),T}var T=null,h=(CHAT_APP.Constants.GENERAL_CONSTANTS.SESSION_TYPES,r.createNew()),_=function(e){if(e)var t=e-400-165;else var t=a.viewport.x-400-165;var n=parseInt(t/310);return n},I=function(t){var n=t.friendName.split(",")[0],r=S(n);if(e.isArray(t.messageList))for(var i=0;i<t.messageList.length;i++)r.pushMessage(t.messageList[i])},A=function(e){var t={key:e,isMinimized:!1,isHidden:!1,isFocused:!1,blinkOn:!1,timeout:5,secretChat:!1,nonDomBox:!1,closedBox:!1,offlineStatus:!1,blocked:!1,blockedByUtId:[],isSecretVisible:!0,singlePage:!1,lastSeenBar:!0,unreadCount:0,bottomScrolled:!1,chatBoxClass:"chat-body-opened"};return t},v=function(t,n,r){t=t.toString(),r||(r={});var o=h.get(t);if(o!==!1)return o;if(o=i.create(t,n),!n){var a=l.create({uId:t});a.fetchPresence()}var s=A(t);return s.isFocused=!0,s.nonDomBox=!0,s.isTagChat=n,s.lastLogin=o.getUser()&&o.getUser().lastOnline?o.getUser().lastOnline():"",s=e.extend(o,s,r)},S=function(e,t){var n=v(e,t);return h.save(e,n),c.addBox(n),n},C=function(e,t){var n=!1;e=e.toString();var r=h.get(e);r===!1?(r=S(e,!1),n=!0):(r.nonDomBox||(n=!0),r.isFocused=!0,r.nonDomBox=!0,r.blinkOn=!1,c.updateBox(r)),n&&a.triggerCustomEvent(m.CHAT.BOX_OPENNED,{boxId:e,sendToTab:t})},D=function(e,t){var n=!1;e=e.toString();var r=h.get(e);return r===!1?(r=S(e,!0),n=!0):(r.nonDomBox||(n=!0),r.isFocused=!0,r.nonDomBox=!0,r.blinkOn=!1,c.updateBox(r)),n&&a.triggerCustomEvent(m.CHAT.BOX_OPENNED,{boxId:e,sendToTab:t}),r},N=function(t,n){t=t.toString();var r=i.create(t,n),o=A(t);return o.closedBox=!0,o.isTagChat=n,o=e.extend(r,o),h.save(t,o),c.addBox(o),r},M=function(e){e=e.toString();var t=h.get(e);t!==!1&&(h.remove(e),t.isFocused=!0,h.save(e,t),E.$broadcast("focusOn",e))},R=function(e){e=e.toString();var t=h.get(e);t.closedBox=!0,c.updateBox(t),h.remove(e)},y=function(e){e=e.toString();var t=h.get(e);t.closedBox=!0,c.updateBox(t),h.remove(e)},O=function(e){e=e.toString();var t=h.get(e);t.isMinimized=!t.isMinimized,t.isMinimized?(t.isFocused=!1,t.chatBoxClass="chat-body"):(t.isFocused=!0,t.chatBoxClass="chat-body-opened"),c.updateBox(t)},b=function(t){c.loadChatBoxes();var n=c.getBox(t),r=h.get(t);if(r)n.closedBox?h.remove(t):(e.extend(r,n),r.loadHistoryMessages());else if(!n.closedBox){var i=v(t,n.isTagChat,n);h.save(t,i),i.loadHistoryMessages()}},P=function(e,t){if(t){var n=o.currentUser(),r=h.get(e);if(r)r.nonDomBox=!0,r.pushMessage(t,n);else{if(t.tag_chat){var i=d.getTag(e);i.isTagSafeToShow()&&D(e)}else C(e);r=S(e,t.tag_chat),r.loadHistoryMessages()}a.triggerCustomEvent(m.CHAT.NEW_MESSAGE_PUSHED,{boxId:e,scroll:"bottom"})}};return{openChatBox:C,openTagChatBox:D,closeTagChatBox:y,creatNonDomBox:N,makeVisibleChatBox:M,processInMessage:I,closeChatBox:R,refreshBox:b,minimizeBox:O,openAndAddMessage:P,getBoxes:function(){return h.all()},ggg:function(){return h.nonClosedLength()},getBoxByUId:function(e){return h.get(e)},getNumberOfAvailableChatBox:function(e){return _(e)},getNonClosedLength:function(){return h.nonClosedLength()},increaseUnreadMessageCount:function(e,t){c.addUnreadMessageInfo(e,t),c.updateUnreadMessageInfos()},decreaseUnreadMessageCount:function(e,t){c.removeUnreadMessageInfo(e,t),c.updateUnreadMessageInfos()},getUnreadMessageCount:function(){return c.getUnreadMessageCount()},getUnreadConversationCount:function(){return c.getUnreadConversationCount()},getChatClock:p}}])}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c){function l(t,n){n?t.unreadCount-n>0?t.unreadCount-=n:t.unreadCount-n<0?t.unreadCount=0:t.unreadCount=0:u(t),c.updateBox(t),c.removeUnreadMessageInfoByBoxId(t.getKey()),s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}function u(e){e.unreadCount=0}function d(e,t){e&&e.isFocused===!1&&(e.unreadCount+=t)}function g(t,n){if(t&&n.key){t.removeMessage(n.key),c.removeMessage(n.key,t.getKey());for(var r=t.getMessages(),i=0,o=r.length;o>i;i++)r[i].value.showDate=r[i].value.takeDecisionForShowingDate(),r[i].value.showAvator=r[i].value.takeDecisionForShowingMessageUserAvator();s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}}function m(e,t){if(!(t.length<1))for(var n=0,r=t.length;r>n;n++)if(t[n].value.timeout>0&&!t[n].value.timerStartFlag)switch(t[n].value.messageType){case 2:case 3:case 4:case 5:case 6:var i=t[n].value.timeout,o=t[n].value;t[n].value.timerStartFlag=!0;var s=function(t,n){e.$broadcast("timeoutDelete",t.key,n)};!function(e,t){a(function(){s(e,t--)},1e3,t+1)}(o,i)}}function f(e,t){if(t[0].value&&t[0].value.timeout>0&&!t[0].value.timerStartFlag)switch(t[0].value.messageType){case 7:case 8:case 9:case 10:var n=t[0].value.timeout,r=t[0].value;t[0].value.timerStartFlag=!0;var i=function(t,n){e.$broadcast("timeoutDelete",t.key,n)};!function(e,t){a(function(){i(e,t--)},1e3,t+1)}(r,n)}}function E(e,t,n,i,o){CHAT_APP.ChatRequests.getFriendChatSeenConfirmationObject(i,packetType);r.send(seenConfirmationObject)}function p(e,n){n||(n=t.getBoxByUId(e)),n&&n.loadHistoryMessages()}CHAT_APP.Constants.GENERAL_CONSTANTS;return{sendChatSeenConfirmation:E,startTimerText:m,startTimerOthers:f,decreaseUnreadCount:l,increaseUnreadCount:d,deleteMessageFromOwn:g,loadHistoryMessageForF2FChat:p}}e.module("ringid.chat").factory("ChatHelper",t),t.$inject=["SystemEvents","ChatFactory","OPERATION_TYPES","ChatConnector","ChatWorkerCommands","Auth","$interval","Utils","chatHistoryFactory"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d){function g(e){var t=e.boxId,n=e.packetId;if(t&&n){var i=r.getBoxByUId(t);if(i)N(i,{packetId:n},"Failed");else{var o=s.getMessage(t,n);o.status="Failed",s.updateMessage(o,t)}}else RingLogger.debug("Handle Failed Message has not boxId",e,"CHAT")}var m=this,f=CHAT_APP.Constants,E=CHAT_APP.SharedHelpers,p=f.GENERAL_CONSTANTS,T=f.TAG_CHAT_PACKET_TYPE,h=f.FRIEND_CHAT_PACKET_TYPE,_=(f.OFFLINE_PACKET_TYPE,f.CHAT_STATES,f.PLATFORM),I=(p.SESSION_TYPES,CHAT_APP.UTILS.getUUIDPacketId),A=function(t,n){if(n&&n.url){var r=t.message,i={u:n.url,d:n.description,t:n.title,i:n.image,m:r};t.message=e.toJson(i)}return t},v=function(t,n){if(n&&n.lat){t.la=n.lat,t.lo=n.lng,t.loc=n.description;var r={lo:t.lo,la:t.la,loc:t.loc};t.message=e.toJson(r)}return t},S=function(t,n){if(n&&n.url){var r={u:n.url,c:n.caption,w:n.width,h:n.height};t.message=e.toJson(r),t.mediaUrl=n.url,t.plainText=n.caption}return t},C=function(e,n,r,i){var o,a,s,c,l=!1,u=t.currentUser(),d=t.currentUser().getKey(),g=E.getChatServerCurrentTime(),m=e.isTagChat;if(e.editMessageKey?(a=e.editMessageKey,e.editMessageKey=void 0,g=parseInt(e.editMessageDate),e.editMessageDate=void 0,l=!0,m?(s=T.TAG_CHAT_MSG_EDIT,c=T.TAG_CHAT_BROKEN_MSG_EDIT):(s=h.FRIEND_CHAT_MSG_EDIT,c=h.FRIEND_CHAT_BROKEN_MSG_EDIT)):(a=I(g,!0),m?(s=T.TAG_CHAT_MSG,c=T.TAG_CHAT_BROKEN_MSG):(s=h.FRIEND_CHAT_MSG,c=h.FRIEND_CHAT_BROKEN_MSG)),o={isEdit:l,tag_chat:!1,packetType:s,brokenPacketType:c,fullName:u.getName(),userId:d,messageType:r,messageDate:g,message:n,key:a,packetId:a,isSecretVisible:e.isSecretVisible?1:0,timeout:0,platform:_.WEB},m){var f=e.getKey();o.tag_chat=!0,o.tagId=f}else o.friendId=e.getUser().getKey(),e.secretChat?o.timeout=e.timeout:o.timeout=0;return o},D=function(e,t){switch(n.hasEmoticon(e.message)&&(e.messageType=3),e.messageType){case p.MESSAGE_TYPES.LOCATION_SHARE:v(e,t.locationData);break;case p.MESSAGE_TYPES.LINK_SHARE:A(e,t.ogData);break;case p.MESSAGE_TYPES.IMAGE:case p.MESSAGE_TYPES.CAMERA_IMAGE:case p.MESSAGE_TYPES.VIDEO:S(e,t.mediaData)}},N=function(e,t,r){var i=e.getMessage(t.packetId);i&&(i.status=r,s.updateMessage(i,e.getKey()),n.triggerCustomEvent(d.CHAT.BOX_UPDATED,{boxId:e.getKey()}))},M=function(e,n){var r=t.currentUser();e.pushMessage(n,r,!0)},R=function(e,t,n,r){var i=C(e,t,n,r);return D(i,r),i},y=function(e,t,n,r){var i=R(e,t,n,r);O(e,i)},O=function(e,t){return M(e,t),t.message=t.message.utf8Encode(),setTimeout(function(){l.request(t).then(function(t){t.sucs||(t.boxId=e.getKey(),g(t))})}),t},b=function(e,t,n){t.tag_chat?t.tagId=e.getKey():t.friendId=e.getKey();var r=R(e,t.text,t.messageType,t.messageData);r.message=r.message.utf8Encode(),r.packetId=t.packetId,r.key=t.packetId,t.status="Pending",setTimeout(function(){l.request(r).then(function(t){t.sucs||(t.boxId=e.getKey(),g(t))})})},P=function(e){var t;t=e.isTagChat?CHAT_APP.ChatRequests.getTagChatTypingObject(e.getKey()):CHAT_APP.ChatRequests.getFriendChatTypingObject(e.getKey()),l.rawSend(t)},L=function(e){var t,n=0,r=0;t=e.isTagChat?CHAT_APP.ChatRequests.getFriendChatUnregisterObject(e.getKey(),n,r):CHAT_APP.ChatRequests.getTagChatTagUnregisterObject(e.getKey(),n,r),l.send(t)},U=function(e){var t=p.MESSAGE_TYPES.TEXT;return e.locationData.lat?t=p.MESSAGE_TYPES.LOCATION_SHARE:e.ogData.url&&(t=p.MESSAGE_TYPES.LINK_SHARE),t};m.sendMessage=y,m.retryMessage=b,m.sendTypingPacket=P,m.sendChatUnRegisterPacket=L,m.getSendMessageObject=R,m.pushMessageToBox=M,m.getMessageType=U,m.doSendMessage=O}e.module("ringid.chat").service("ChatPacketSenderService",t),t.$inject=["Auth","Utils","ChatFactory","tagChatFactory","ChatUtilsFactory","$q","chatHistoryFactory","chatTabSync","ChatConnector","ChatWorkerCommands","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c,l,u,d){var g=CHAT_APP.Constants,m=CHAT_APP.ChatRequests,f=(g.CHAT_GLOBAL_VALUES,g.GENERAL_CONSTANTS),E=(g.TAG_CHAT_PACKET_TYPE,g.FRIEND_CHAT_PACKET_TYPE),p=(f.USER_PRESENCE,f.MESSAGE_STATUS_VALUE,CHAT_APP.SharedHelpers),T=function(e,t,n){var r=m.getFriendChatSeenObject(e,t);r.brokenPacketType=E.FRIEND_CHAT_SEEN;for(var i=p.getChatServerCurrentTime(),o=0;o<t.length;o++)r.messages[o].packetId=t[o].key,r.messages[o].messageDate=i,r.messages[o].status=v(t[o].messageType);d.request(r).then(function(r){r.sucs&&(RingLogger.print("F2F Seen packet Success",RingLogger.tags.CHAT),_(e,t),n.resolve("success"))},function(){RingLogger.print("F2F Seen packet Failure",RingLogger.tags.CHAT),n.reject("failed")})},h=function(e,t){if(!(t.length<1)){var n=l.defer(),r=A(t),i=e.getKey();return e.isTagChat?(I(i,r),n.resolve({sucs:!0})):(T(i,r,n),n.promise)}},_=function(e,r){for(var i=t.getBoxByUId(e),o=[],a=0;a<r.length;a++)if(i){var s=i.getMessage(r[a].key);s&&(s.seenSent=!0,o.push(s))}n.updateMessages(o,e)},I=function(e,t){var n=o.getTag(e);i.loginData.uId;if(n){for(var r=0;r<t.length;r++){var a=t[r].key,s=t[r].senderId,c=m.getTagChatSeenObject(s,e,a);d.send(c)}_(e,t)}else RingLogger.print("TagSeen packet not send, tagObject not found.")},A=function(e){for(var t=[],n=0;n<e.length;n++)t.push({key:e[n].key,messageType:e[n].value.messageType,senderId:e[n].value.user.getKey()});return t},v=function(e){var t=0;switch(e){case 2:case 3:case 4:case 5:case 6:t=f.MESSAGE_STATUS.SEEN;break;case 7:case 8:case 9:case 10:t=f.MESSAGE_STATUS.VIEWED}return t};return{sendSeenPacket:h}}e.module("ringid.chat").factory("ChatSeenSend",t),t.$inject=["ChatWorkerCommands","ChatFactory","chatHistoryFactory","Utils","Auth","tagChatFactory","tagChatManager","ChatHelper","tagChatHelper","$q","ChatUtilsFactory","ChatConnector"]}()}(angular,window),function(e,t){"use strict";!function(){function n(){function e(){var e="CrossTab not supported",n=[];throw localStorage||n.push("localStorage not available"),t.addEventListener||n.push("addEventListener not available"),n.length>0&&(e+=": "+n.join(", ")),new Error(e)}function r(){return(new Date).getTime()}function i(e){if(e&&"__CROSSTAB"==e.key){var t;try{t=e.newValue?JSON.parse(e.newValue):{}}catch(r){t={}}t&&t.id&&t.id!==n.id&&(e.newValue===u&&e.oldValue===d||(u=e.newValue,d=e.oldValue,m.message&&m.message.call(this,t.data)))}}function o(e,t){var n={id:g,data:t,timestamp:r()};localStorage.setItem(e,JSON.stringify(n))}function a(){t.removeEventListener("beforeunload",s,!1),t.addEventListener("unload",s,!1)}function s(){}function c(e,t,n){n=n||"0";var r=e.toString();return r.length>=t?r:new Array(t-r.length+1).join(n)+r}function l(t){n.supported||e();var r={data:t,origin:g};o("__CROSSTAB",r)}var u,d,g,m={},f=function(){return r().toString()+c(2147483647*Math.random()|0,10)};this.on=function(e,t){m[e]=t},this.setId=function(e){g=e},this.getId=function(){return g},this.broadcast=l,this.init=function(){n.supported=!!localStorage&&t.addEventListener,n.supported?(g=f(),t.addEventListener("storage",i,!1),t.addEventListener("beforeunload",s,!1),t.addEventListener("DOMContentLoaded",a,!1)):n.broadcast=e}}function r(r,i,o){var a,s,c,l,u=CHAT_APP.Constants.GENERAL_CONSTANTS,d=!!t.SharedWorker,g=!!t.localStorage,m=function(t,n){try{s.port.postMessage({origin:a,data:e.extend(n,{type:t})})}catch(r){}},f=function(t,n){try{c.broadcast(e.extend(n,{type:t}))}catch(r){}},E=function(){a=i.getUniqueID("t"),s=new SharedWorker(u.SHARED_WORKER_PATH),s.port.addEventListener("message",function(e){var t=e.data;t.origin!==a&&i.triggerCustomEvent(o.CHAT.TAB_SYNC_NEW_DATA,t.data)}.bind(this),!1),s.port.start()},p=function(){c=new n,c.init(),a=c.getId(),c.on("message",function(e){e.origin!==a&&i.triggerCustomEvent(o.CHAT.TAB_SYNC_NEW_DATA,e.data)})},T=function(e,t){l&&l.call(this,e,t)},h=function(){d?(E(),l=m):g?(p(),l=f):l=function(){}};return{init:h,sendData:T}}var i;try{i=e.module("ringid.chat")}catch(o){}i.factory("chatTabSync",r),r.$inject=["Storage","Utils","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e){var t=function(e){return e?!0:(Ringlogger.alert("Invalid Chat Session Type",e,Ringlogger.tags.CHAT),!1)};this.startChatSession=function(n,r,i){t(r)&&e.sendCommand("START_CHAT_SESSION",{id:n,type:r,uIds:i})},this.endChatSession=function(n,r){t(r)&&e.sendCommand("END_CHAT_SESSION",{id:n,type:r})},this.sendAuthRequest=function(t){e.sendCommand("SEND_AUTH_REQUSET",{object:t,type:"send"})},this.sendTagChatMemberAddAuthRequest=function(t){e.sendCommand("SEND_TAG_CHAT_MEMBER_ADD_AUTH_REQUEST",{object:t,type:"send"})},this.doGetChatHistoryMessages=function(t,n,r,i,o){e.sendCommand("FETCH_HISTORY_MESSAGE",{id:t,type:i,pageDirection:n,limit:r,packetId:o})}}var n;try{n=e.module("ringid.chat")}catch(r){}n.service("ChatWorkerCommands",t),t.$inject=["ChatConnector"]}()}(angular,window),function(e,t){"use strict";!function(t){function n(e,t,n,r,i,o,a){function s(){var e=i.currentUser().getKey().toString(),t=(new Date).getTime().toString(),n=t.substr(0,M.TAG_ID_NO_OF_TIME_DIGIT);return n+=e.substr(e.length-M.TAG_ID_NO_OF_USER_ID_DIGIT)}function c(){return y}function l(e){return y.get(e)}function u(e){return y.remove(e)}function d(e,t){return t||(t=new a.TagObject),e.tagId?t.setTagId(e.tagId):t.setTagId(s()),e.packetId&&t.setPacketId(e.packetId),e.userId&&t.setUserId(e.userId),e.tagName&&t.setTagName(e.tagName),e.tagPictureUrl&&t.setPictureUrl(e.tagPictureUrl),e.serverDate&&t.setServerDate(e.serverDate),e.tagMembersCount&&t.setMembersCount(e.tagMembersCount),t}function g(e,t,n){var r=new a.TagMember;return e&&r.setTagId(e),t&&(t.userId&&r.setId(t.userId),t.fullName&&r.setFullName(t.fullName),t.addedBy&&r.setAddedBy(t.addedBy),t.status?r.setStatus(t.status):r.setStatus(N.MEMBER_STATUS.MEMBER)),r}function m(e,t,n){var r=new a.TagMessage;return e&&r.setTagId(e),t&&(t.userId&&r.setUserId(t.userId),t.user&&r.setUserId(t.user),t.fullName&&r.setFullName(t.fullName),t.message&&r.setMessageText(t.message),t.hrtime&&r.setHumanReadableTime(t.hrtime),t.messageDate&&r.setMessageDate(t.messageDate),t.isDeleted&&r.markAsDeleted(t.isDeleted),t.messageDateString&&r.setMessageDateString(t.messageDateString),t.timeout&&r.setTimeout(t.timeout),t.messageType&&r.setMessageType(t.messageType),t.status&&r.setStatus(t.status),t.packetId&&r.setPacketId(t.packetId),t.usersToChange&&r.setUsersToChange(t.usersToChange),t.usersToChangeName&&r.setUsersToChangeName(t.usersToChangeName),t.statusType&&r.setStatusType(t.statusType),t.tagName&&r.setTagName(t.tagName)),r}function f(e,t,r,i,o,a){var s={},c=l(t);if(c){var u;u=a.messageDate?a.messageDate:D.getChatServerCurrentTime();var d=n.getUser(r),g="";if(d&&""!=d.getName()&&(g=d.getName()),s={message:"",fullName:g,status:"status_update",statusType:i,tagName:a?a.tagName:"",messageDate:u,messageType:2,tag_chat:!0,userId:r,user:r,packetId:e},s.usersToChange={},o.length>0)for(var f=0;f<o.length;f++){var E=o[f];s.usersToChange[E.userId]=!0}var p=m(t,s);return p}return!1}function E(e){var t={key:e.key,text:e.text,messageType:e.messageType,messageDate:e.messageDate};return t}function p(e){if(!(e instanceof a.TagObject))return console.error("Please provide tagChatModels.TagObject() Instance"),!1;var t=y.get(e.getTagId());return t?t.update(e):y.add(e.getTagId(),e),!0}function T(e,t){t||(t={tagId:e});var n=l(e);return n=n?d(t,n):d(t),y.save(e,n),n}function h(e,t,n){return n||(n=l(e)),n=d(t,n),y.save(e,n),n}function _(e,t){var n={tagId:e};t||(t={tagId:e});var r=l(e);r||(r=d(n),y.save(e,r));var i=m(e,t,!0),o=r.getMessage(t.packetId);return o?o.update(i):(o=i,r.addMessage(o)),o}function I(e){R[e]=!0,setTimeout(function(){R[e]=!1},N.API_FETCH_RETRY_DELAY)}function A(e){R[e]=!1}function v(e){return!!R[e]}function S(e){if(e.actn){var t=e.tid||e.tagId,n=_isInRequestCacheForAuth(t,e.actn);return!n}}var C=CHAT_APP.Constants,D=CHAT_APP.SharedHelpers,N=C.GENERAL_CONSTANTS,M=C.PACKET_CONSTANTS,R=(C.CHAT_GLOBAL_VALUES,C.AUTH_SERVER_ACTIONS,C.TAG_CHAT_PACKET_TYPE,C.FRIEND_CHAT_PACKET_TYPE,C.CONFIRMATION_MAP,CHAT_APP.UTILS,{}),y=e.createNew(!0),O=!0;return{createNewTag:d,createNewTagMember:g,createNewTagMessage:m,createTagStatusMessage:f,addTagObject:p,removeTagObject:u,getTags:c,getTag:l,generateNewTagId:s,getOrCreateTag:T,getOrCreateMessage:_,updateTag:h,getTagLastMessageObject:E,setTagChatInitiator:I,resetTagChatInitiator:A,isTagChatInitiator:v,shouldProcessRequest:S,startProcessingRequest:O}}e.module("ringid.chat").factory("tagChatFactory",n),n.$inject=["$$stackedMap","$$connector","userFactory","friendsFactory","Auth","Utils","tagChatModels"]}(t)}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o){function a(e){var t;return e===d.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD?t="member":e===d.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD&&(t="admin"),t}function s(e,t){var n=e.getMember(t);if(n)return n.getName();var i=r.getUser(t);return i&&""!=i.getName()?i.getName():t}function c(e){var i,o,c,l=t.currentUser(),u=(l.getKey(),""),m="",f="",E=e.usersToChange.length-1,p=e.fullName,T=(e.userId,e.tagName);if(i=e.tagId,o=n.getOrCreateTag(i),c=l.getKey()===e.userId.toString(),o){p||(p=s(o,e.userId));var h=[],_=0;e.usersToChange.forEach(function(e){var t=r.getUser(e);if(t&&""!=t.getName())h.push(t.getName()),_++;else{var n=s(o,e);h.push(n)}}),RingLogger.log("Tag Id {0}, Members Count {1}, Fetched User Count {2}".format(i,e.usersToChange.length,h),"CHAT_0"),_==e.usersToChange.length&&(e.allStatusUserFetched=!0),m=h.length>0?h[0]:e.usersToChange[0],f=h.slice(1).join(", ").replace('"',"'");var I,A,v={},S=g.STATUS_MESSAGES;switch(e.statusType){case d.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:case d.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:A=a(e.statusType),v.member_name=p,v.new_member_name=m==l.getName()?"you":m,v.new_member_type=A,v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),I=c?E?S.SELF_ADD_MULTIPLE_MEMBER:S.SELF_ADD_MEMBER:E?S.OTHER_ADD_MULTIPLE_MEMBER:S.OTHER_ADD_MEMBER;break;case d.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE:v.member_name=p,v.old_member_name=m==l.getName()?"you":m,v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),I=c?E?S.SELF_REMOVE_MULTIPLE_MEMBER:m===p?S.SELF_LEAVE_GROUP:S.SELF_REMOVE_MEMBER:E?S.OTHER_REMOVE_MULTIPLE_MEMBER:m===p?S.OTHER_LEAVE_GROUP:S.OTHER_REMOVE_MEMBER;break;case d.STATUS_MESSAGE_TYPES.TAG_MEMBER_LEAVE:v.member_name=p,I=c?S.SELF_LEAVE_GROUP:S.OTHER_LEAVE_GROUP;break;case d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:v.member_name=p,v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),m!==l.getName()?v.old_member_name=m:v.old_member_name="you",I=c?E?S.SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:S.SELF_MEMBER_CHANGE_TO_ADMIN:E?S.OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:S.OTHER_MEMBER_CHANGE_TO_ADMIN;break;case d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:v.admin_name=p,m!==l.getName()?v.old_admin_name=m:v.old_admin_name="you",v.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(f,E),I=c?E?S.SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:m===p?S.SELF_REMOVED_FROM_ADMIN_BY_SELF:S.SELF_ADMIN_CHANGE_TO_MEMBER:E?S.OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:m===p?S.OTHER_REMOVED_FROM_ADMIN_BY_SELF:S.OTHER_ADMIN_CHANGE_TO_MEMBER;break;case d.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER:v.member_name=p,v.admin_name=m,I=m!==l.getName()?S.OTHER_USER_ADDED_AS_OWNER:S.SELF_USER_ADDED_AS_OWNER;break;case d.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:v.member_name=p,v.group_name=T,I=c?S.SELF_UPDATE_GROUP_INFO:S.OTHER_UPDATE_GROUP_INFO;break;case d.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE:v.member_name=p,v.group_name=T,I=c?S.SELF_RENAME_GROUP:S.OTHER_RENAME_GROUP;break;case d.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE:v.member_name=p,v.group_name=T,I=c?S.SELF_CHANGE_GROUP_PIC:S.OTHER_CHANGE_GROUP_PIC}return I&&(u=I.supplant(v)),u}}function l(e){var r=t.currentUser(),i=(r.getKey(),{tagId:e,userId:r.getKey(),fullName:r.getName(),message:" ",messageDate:(new Date).getTime(),messageType:d.MESSAGE_TYPES.BLANK_MESSAGE,packetId:CHAT_APP.UTILS.getUUIDPacketId()}),o=n.createNewTagMessage(e,i);return o}var u=CHAT_APP.Constants,d=(CHAT_APP.SharedHelpers,u.GENERAL_CONSTANTS),g=(u.CHAT_GLOBAL_VALUES,e.TAG);return{getTagChatStatusMessage:c,getTagEmptyMessageObject:l}}e.module("ringid.chat").factory("tagChatHelper",t),t.$inject=["CHAT_LANG","Auth","tagChatFactory","userFactory","userService","Utils"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h,_,I){function A(e){var t,r,o,c,l,u=i.currentUser(),d=n.defer();e.tagMembersCount=e.memberUIds.length+e.adminUIds.length+1,t=a.createNewTag(e),r={userId:u.getKey(),addedBy:u.getKey(),status:w.MEMBER_STATUS.OWNER},o=a.createNewTagMember(t.getTagId(),r,!0),t.addMember(o);for(var g=0;g<e.memberUIds.length;g++){var f=e.memberUIds[g];r={userId:f,addedBy:u.getKey(),status:w.MEMBER_STATUS.MEMBER},o=a.createNewTagMember(t.getTagId(),r,!0),t.addMember(o)}for(var E=0;E<e.adminUIds.length;E++){var p=e.adminUIds[E];c={userId:p,addedBy:u.getKey(),status:w.MEMBER_STATUS.ADMIN},l=a.createNewTagMember(t.getTagId(),c,!0),t.addMember(l)}t.setObjectLock(),a.addTagObject(t),m.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED),e.uIds=e.adminUIds.concat(e.memberUIds);var T=$.getOfflineTagCreateTagObject(t.getTagId(),t.getTagName(),t.getPictureUrl(),t.getSerializedMembers());return T.brokenPacketType=F.OFFLINE_BROKEN_PACKET,_.request(T).then(function(e){t.removeObjectLock(),e.sucs?(d.resolve(e),s.startChatSession(t.getTagId(),w.SESSION_TYPES.TAG,t.getMemberUserIds())):e.error?d.error(e):d.reject(e)}),d.promise}function v(t,n,r){var o,s,c,l,u,d,m,f,E,p=i.currentUser(),T=[],h=[],_=[],I=[],A=[],v=[],S={},C={},D={};o=t.getMembersObjectMap().copy(),s=o,c=s.all(),e.forEach(n,function(e){S[e]=!0}),e.forEach(r,function(e){C[e]=!0});for(var N=0;N<c.length;N++)l=c[N].value,D[l.getId()]=!0,l.isOwner()||(C[l.getId()]||S[l.getId()]?(u=!1,l.isAdmin()?S[l.getId()]&&(l.makeMember(),u=!0):l.isMember()&&C[l.getId()]&&(l.makeAdmin(),u=!0),u&&(h.push(l.serialize()),v.push(l))):(T.push(l.serialize()),A.push(l)));
return e.forEach(n,function(e){D[e]||e===p.getKey()||(d=g.getUser(e),m=a.createNewTagMember(t.getTagId(),{userId:e,addedBy:p.getKey(),fullName:d.getName(),status:w.MEMBER_STATUS.MEMBER},!0),I.push(m),_.push(m.serialize()))}),e.forEach(r,function(e){D[e]||e===p.getKey()||(f=g.getUser(e),E=a.createNewTagMember(t.getTagId(),{userId:e,addedBy:p.getKey(),fullName:f.getName(),status:w.MEMBER_STATUS.ADMIN},!0),I.push(E),_.push(E.serialize()))}),{serializedMemberAdminsToRemove:T,serializedMemberAdminsToStatusChange:h,serializedNewMemberAdminsToAdd:_,membersAdminToAddOnSuccess:I,membersAdminToRemoveOnSuccess:A,membersAdminToUpdateOnSuccess:v}}function S(t,r,o){var a,l,u=i.currentUser(),d=n.defer();if(r.length>0){a=!1,l=r.keyValues("userId");var g=k.getTagChatMembersAddObject(t.getTagId(),l);s.sendTagChatMemberAddAuthRequest(g);var g=$.getTagChatTagMemberAddObject(t.getTagId(),r),m=U.getChatServerCurrentTime();_.request(g).then(function(n){n.sucs&&(e.forEach(o,function(e){t.addMember(e)}),t.setMembersCount(t.getMembersCount()+o.length),c.showTagMembersAddStatusMessage(t.getTagId(),u.getKey(),r,m,!1,n.packetId),d.resolve({sucs:!0,mg:"Member( "+o.length+" ) Added in "+t.getTagName()}))},function(e){d.reject({sucs:!1,mg:"Unable to send tag new member add packet to chat server."}),RingLogger.alert("Unable to send tag new member add packet to chat server",t.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})}else d.resolve({sucs:!1});return d.promise}function C(t,r,o){var a=i.currentUser(),s=n.defer();if(r.length>0){var l=U.getChatServerCurrentTime(),u=$.getTagChatMemberRemoveLeaveObject(t.getTagId(),r);_.request(u).then(function(n){n.sucs&&(e.forEach(o,function(e){t.removeMember(e)}),t.setMembersCount(t.getMembersCount()-o.length),c.showTagMembersRemoveStatusMessage(t.getTagId(),a.getKey(),r,l,n.packetId),s.resolve({sucs:!0,mg:"Member( "+o.length+" ) Removed from "+t.getTagName()}))},function(e){s.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."}),RingLogger.alert("Unable to send tag  member remove packet to chat server",t.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})}else s.resolve({sucs:!1});return s.promise}function D(t,r,o){var a=i.currentUser(),s=n.defer(),l=U.getChatServerCurrentTime();if(r.length>0){var u=$.getTagChatTagMemberTypeChangeObject(t.getTagId(),r);_.request(u).then(function(n){n.sucs&&(e.forEach(o,function(e){t.updateMember(e)}),c.showMemberTypeChangeStatusMessage(t.getTagId(),a.getKey(),r,l,!1,n.packetId),s.resolve({sucs:!0,mg:"Member( "+o.length+" ) Status Updated for "+t.getTagName()}))},function(e){s.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."}),RingLogger.alert("Unable to send tag  member status change packet to chat server",t.getTagId()," tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})}else s.resolve({sucs:!1});return s.promise}function N(e,t,r){var o,a,s=i.currentUser(),l=n.defer(),u=e.getTagName(),d=e.getPictureUrl(),g=e.getTagName()!==t,m=e.getPictureUrl()!==r,f=g||m;if(f){if(o=c.getTagInfoChangeStatusMessage(e.getTagId(),{tagName:t||"",tagPictureUrl:r||""}),g){e.setTagName(t),a=w.TAG_ACTIVITY_TYPE.TAG_RENAME;var E=$.getTagChatTagInformationObject(e.getTagId(),a,t,d);_.request(E).then(function(n){n.sucs&&(c.showTagInfoChangeStatusMessage(e.getTagId(),s.getKey(),{statusMessageType:o,tagName:t},!1),m||l.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(t){g&&e.setTagName(u),l.reject({sucs:!1,mg:"Unable to send tag info tag name change packet to chat server."}),RingLogger.alert("Unable to send tag  member info tag name change packet to chat server",e.getTagId()," update-tag-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})}if(m){e.setPictureUrl(r),a=w.TAG_ACTIVITY_TYPE.TAG_URL_RENAME;var E=$.getTagChatTagInformationObject(e.getTagId(),a,u,r);_.request(E).then(function(n){n.sucs&&(c.showTagInfoChangeStatusMessage(e.getTagId(),s.getKey(),{statusMessageType:o,tagName:t},!1),l.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(t){m&&e.setPictureUrl(d),l.reject({sucs:!1,mg:"Unable to send tag info tag picture url packet to chat server."}),RingLogger.alert("Unable to send tag info tag picture url packet to chat server",e.getTagId()," update-tag-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})}}else l.resolve({sucs:!1});return l.promise}function M(e,t,r,o,a){var s,c,l,u,d,g,f,E=(i.currentUser(),n.defer());s=v(e,o,a),c=s.serializedNewMemberAdminsToAdd,l=s.membersAdminToAddOnSuccess,u=s.serializedMemberAdminsToRemove,d=s.membersAdminToRemoveOnSuccess,g=s.serializedMemberAdminsToStatusChange,f=s.membersAdminToUpdateOnSuccess;var p=0;return S(e,c,l).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),C(e,u,d).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),D(e,g,f).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),N(e,t,r).then(function(e){e.sucs&&(p++,E.notify(e))},E.reject),setTimeout(function(){p?E.resolve({sucs:!0}):E.reject({sucs:!1})},18e3),m.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED),E.promise}function R(e){var t=a.getTag(e),n=t.getMember(i.currentUser().getKey());return y(e,[n.serialize()],[n])}function y(e,t,r){var o=i.currentUser(),s=n.defer(),c=a.getTag(e),l=$.getTagChatMemberRemoveLeaveObject(e,t);return _.request(l).then(function(t){if(t.sucs){c=a.getTag(e);for(var n="Member( "+r.length+" ) Removed from "+c.getTagName(),i=!1,l=0;l<r.length;l++){var u=r[l];if(u.getId()===o.getKey()&&(n="You left from ("+c.getTagName()+") conversation ",a.removeTagObject(e),i=!0,s.resolve({sucs:!0,mg:n})),i)break;c.removeMember(u)}i||s.resolve({sucs:!0,mg:n})}},function(e){s.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."}),RingLogger.alert("Unable to send tag  member remove packet to chat server",c.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)}),m.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED),s.promise}function O(t,r,o){var s=(i.currentUser(),n.defer()),c=a.getTag(t),l=$.getTagChatTagMemberTypeChangeObject(t,r);return _.request(l).then(function(t){t.sucs&&(e.forEach(o,function(e){c.updateMember(e)}),s.resolve({sucs:!0,mg:"Member( "+r.length+" ) Status Updated for "+c.getTagName()}))},function(e){s.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."}),RingLogger.alert("Unable to send tag  member status change packet to chat server",c.getTagId()," tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT)}),m.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED),s.promise}function b(e){G(function(){var t=a.getTag(e);if(t&&t.isTagSafeToShow()){var n=u.getBoxByUId(e);P(e,n)}},function(t){var n=a.getTag(e);return!(!n||!n.isTagSafeToShow())},function(){},5,5e3)}function P(e,t){var n=!1;if(!t){n=!0;var r=a.getOrCreateTag(e);r.isTagSafeToShow()?(u.openTagChatBox(e),t=u.getBoxByUId(e),t.setTitle(r.getTagName())):t=u.creatNonDomBox(e,!0),t.setTitle(r.getTagName())}return n&&t.loadHistoryMessages(),t}var L=CHAT_APP.Constants,U=CHAT_APP.SharedHelpers,w=L.GENERAL_CONSTANTS,F=(L.AUTH_SERVER_ACTIONS,L.TAG_CHAT_PACKET_TYPE,L.OFFLINE_PACKET_TYPE),k=(L.FRIEND_CHAT_PACKET_TYPE,o.TAG,CHAT_APP.AuthRequests),$=CHAT_APP.ChatRequests,G=CHAT_APP.UTILS.callXTimeAfterYIntervalStopOnSuccess;return{createTag:A,updateTag:M,leaveFromTag:R,removeTagMember:y,changeTagMemberStatus:O,openTagChatBoxIfClosed:P,openPreviouslyOpenedBoxes:b}}e.module("ringid.chat").factory("tagChatManager",t),t.$inject=["$$connector","$q","$timeout","Auth","CHAT_LANG","tagChatFactory","ChatWorkerCommands","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","ChatUtilsFactory","ChatConnector","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a){function s(){var t=this,n={id:0,name:"Group",pictureUrl:"",userId:0,packetId:0,memberCount:0,serverDate:0,serverDateDiff:0,members:e.createNew(),messages:e.createNew(),objectLock:!1,ownerUserId:0,creationTime:0};this.getTagId=function(){return n.id},this.setTagId=function(e){n.id=e,n.creationTime=e.toString().substr(0,u.TAG_ID_NO_OF_TIME_DIGIT)},this.getTagCreationTime=function(){return n.creationTime},this.getUserId=function(){return n.userId},this.setUserId=function(e){n.userId=e},this.getPacketId=function(){return n.packetId},this.setPacketId=function(e){n.packetId=e},this.renewPacketId=function(){t.setPacketId(r.getUniqueID("tgrc"))},this.getTagName=function(){return n.name},this.setTagName=function(e){n.name=e},this.setPictureUrl=function(e){n.pictureUrl=e},this.getPictureUrl=function(){return n.pictureUrl.trim()},this.getPictureFullUrl=function(){return""!=this.getPictureUrl()?o.imBase+this.getPictureUrl():"images/prof.png"},this.setServerDate=function(e){n.serverDate=e,t.setServerDateDiff(e-parseInt((new Date).getTime()))},this.getServerDate=function(){return n.serverDate},this.setServerDateDiff=function(e){n.serverDateDiff=e},this.getServerDateDiff=function(){return n.serverDateDiff},this.getMembersCount=function(){return n.memberCount},this.setMembersCount=function(e){n.memberCount=e},this.isTagSafeToShow=function(){return n.memberCount>0},this.initMembers=function(){n.members=e.createNew()},this.addMember=function(e){n.members||(n.members=t.initMembers()),e.isOwner()&&(n.ownerUserId=e.getId()),n.members.save(e.getId(),e)},this.updateMember=function(e){this.addMember(e)},this.removeMember=function(e){e instanceof c?n.members.remove(e.getId()):n.members.remove(e)},this.membersLength=function(){return n.members?n.members.length():0},this.getMember=function(e){return n.members.get(e)},this.getMemberObjects=function(){return n.members.values()},this.getMemberUserIds=function(){return n.members.keys()},this.getMembersObjectMap=function(){return n.members},this.setMembersObjectMap=function(e){n.members=e},this.initMemberObjects=function(){for(var e=n.members.all(),t=0;t<n.members.length();t++){var r=e[t].value;r.initUserObjects()}},this.unregisterMemberObjectsListener=function(){for(var e=n.members.all(),t=0;t<n.members.length();t++){var r=e[t].value;r.unregisterUserObjectsListener()}},this.getSerializedMembers=function(){for(var e=n.members.all(),t=[],r=0;r<e.length;r++){var i=e[r].value;t.push(i.serialize())}return t},this.isUserMember=function(e){return n.members?!!n.members.get(e):!1},this.isCurrentUserStatusAdmin=function(e){var t=!!n.members&&n.members.get(e);return t?t.isAdmin():!1},this.isCurrentUserStatusMember=function(e){var t=!!n.members&&n.members.get(e);return t?t.isMember():!1},this.setObjectLock=function(){n.objectLock=!0},this.removeObjectLock=function(){n.objectLock=!1},this.hasObjectLock=function(){return n.objectLock},this.setOwnerUserId=function(e){n.ownerUserId=e},this.getOwnerUserId=function(){return n.ownerUserId},this.initMessages=function(){n.messages=e.createNew()},this.addMessage=function(e){n.messages||(n.messages=t.initMessages()),n.messages.save(e.getPacketId(),e)},this.removeMessage=function(e){e instanceof l?n.messages.remove(e.getId()):n.messages.remove(e)},this.messagesLength=function(){return n.messages?n.messages.length():0},this.getMessage=function(e){return n.messages.get(e)},this.getMessageObjects=function(){return n.messages.values()},this.getMessageUserIds=function(){return n.messages.keys()},this.getMessagesObjectMap=function(){return n.messages},this.setMessagesObjectMap=function(e){n.messages=e},this.debug=function(){return n}}function c(){var e=this,s={tagId:0,userId:0,fullName:"",status:0,statusValue:"",addedBy:0,user:{},addedByUser:{},userRegisterKey:null,addedByUserRegisterKey:null};this.initWithUserMapObject=function(t){e.setId(t.getKey()),e.setFullName(t.getName()),e.setUserObj(t)},this.setTagId=function(e){s.tagId=e},this.getTagId=function(){return s.tagId},this.setId=function(e){s.userId=e.toString()},this.getId=function(){return s.userId},this.getUser=function(){return t.getUser(s.userId)},this.setFullName=function(e){s.fullName=e},this.getFullName=function(){return s.fullName},this.getPictureUrl=function(){return e.getUser().getUserAvatar?o.imBase+e.getUser().getUserAvatar():"images/prof.png"},this.getName=function(){return""!==s.fullName?s.fullName:e.getUser()?e.getUser().getName():s.userId},this.getStatus=function(){return s.status},this.getStatusValue=function(){return s.status===u.MEMBER_STATUS.ADMIN?"admin":s.status===u.MEMBER_STATUS.MEMBER?"member":"owner"},this.setStatus=function(e){s.status=e},this.setAddedBy=function(e){s.addedBy=e.toString()},this.getAddedBy=function(){return s.addedBy},this.getAddedByUser=function(){return t.getUser(s.addedBy)},this.getAddedByUserName=function(){return!!e.getAddedByUser()&&e.getAddedByUser().getName()},this.setAddedByUserObj=function(e){s.addedByUser=e},this.setUserObj=function(e){s.user=e},this.unregisterUserObjectsListener=function(){n.unregister(s.userRegisterKey),s.userRegisterKey=null,n.unregister(s.addedByUserRegisterKey),s.addedByUserRegisterKey=null},this.initUserObjects=function(){var t=e.getUser();s.userRegisterKey||t&&t.hasDetails()||(s.userRegisterKey=n.register(s.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:s.userId,tagId:s.tagId})}));var i=e.getAddedByUser();s.addedByUserRegisterKey||i&&i.hasDetails()||(s.addedByUserRegisterKey=n.register(s.addedBy,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:s.addedBy,tagId:s.tagId})}))},this.isCurrentUser=function(){return e.getId()===i.currentUser().getKey()},this.isAdmin=function(){return s.status==u.MEMBER_STATUS.ADMIN},this.isMember=function(){return s.status==u.MEMBER_STATUS.MEMBER},this.isOwner=function(){return s.status==u.MEMBER_STATUS.OWNER},this.isRemoved=function(){return s.status==u.MEMBER_STATUS.REMOVED},this.makeAdmin=function(){s.status=u.MEMBER_STATUS.ADMIN},this.makeMember=function(){s.status=u.MEMBER_STATUS.MEMBER},this.makeOwner=function(){s.status=u.MEMBER_STATUS.OWNER},this.serialize=function(){return{userId:e.getId(),fullName:e.getName().utf8Encode(),status:e.getStatus(),addedBy:e.getAddedBy()}}}function l(){var e=this,i={tagId:0,text:"",hrtime:"",status:"",messageDate:"",isDeleted:!1,messageDateString:"",timeout:0,userId:0,fullName:"",type:0,packetId:0,user:{},seenPacketSent:!1,deliveredPacketSent:!1,statusType:"",seenUsers:[],deliveredUsers:[],usersToChange:{},usersToChangeName:{},tagName:"",allStatusUserFetched:!1,statusUsersFetchCount:0,userRegisterKey:null};this.getTagId=function(){return i.tagId},this.setTagId=function(e){i.tagId=e},this.getHumanReadableTime=function(){return i.hrtime},this.setHumanReadableTime=function(e){i.hrtime=e},this.setFullName=function(e){i.fullName=e.substring(0,127)},this.getFullName=function(){return i.fullName},this.getPacketId=function(){return i.packetId},this.setPacketId=function(e){i.packetId=e},this.getMessageText=function(e){return i.text},this.setMessageText=function(e){i.text=e},this.setStatus=function(e){i.status=e},this.getStatus=function(){return i.status},this.setMessageDate=function(e){i.messageDate=e},this.getMessageDate=function(){return i.messageDate},this.markAsDeleted=function(){i.isDeleted=!0},this.unMarkFromDeleted=function(){i.isDeleted=!1},this.getIsDeleted=function(){return i.isDeleted},this.setMessageDateString=function(e){i.messageDateString=e},this.setTimeout=function(e){i.timeout=e},this.setUserId=function(e){i.userId=e},this.getMessageDateString=function(){return i.messageDateString},this.getTimeout=function(){return i.timeout},this.getUserId=function(){return i.userId},this.getUser=function(){return t.getUser(i.userId)},this.getMessageType=function(){return i.type},this.setMessageType=function(e){return i.type=e},this.initUserObjects=function(){var t=e.getUser();i.userRegisterKey||t&&t.hasDetails()||(i.userRegisterKey=n.register(i.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:i.userId,tagId:i.tagId})}))},this.unregisterUserObjectsListener=function(){n.unregister(i.userRegisterKey),i.userRegisterKey=null},this.getSeenPacketSent=function(){return i.seenPacketSent},this.getDeliveredPacketSent=function(){return i.deliveredPacketSent},this.setSeenPacketSent=function(e){i.seenPacketSent=e},this.setDeliveredPacketSent=function(e){i.deliveredPacketSent=e},this.addSeenUserId=function(e){i.seenUsers.push(e)},this.addDeliveredUserId=function(e){i.deliveredUsers.push(e)},this.setUsersToChange=function(e){i.usersToChange=e},this.getUsersToChange=function(){return i.usersToChange},this.setUsersToChangeName=function(e){i.usersToChangeName=e},this.getUsersToChange=function(){return i.usersToChangeName},this.setStatusType=function(e){i.statusType=e},this.getStatusType=function(){return i.statusType},this.getTagName=function(){return i.tagName},this.setTagName=function(e){i.tagName=e},this.serialize=function(){return{tagId:e.getTagId(),userId:e.getUserId(),user:e.getUserId(),packetId:e.getPacketId(),fullName:e.getFullName().utf8Encode(),status:e.getStatus(),statusType:e.getStatusType(),type:e.getMessageType(),hrtime:e.getHumanReadableTime(),messageDate:e.getMessageDate(),isDeleted:i.isDeleted,timeout:e.getTimeout(),text:e.getMessageText().utf8Encode(),seenPacketSent:e.getSeenPacketSent(),deliveredPacketSent:e.getDeliveredPacketSent(),usersToChange:Object.keys(i.usersToChange),allStatusUserFetched:i.allStatusUserFetched,messageType:e.getMessageType(),tag_chat:!0,tagName:e.getTagName()}}}var u=CHAT_APP.Constants.GENERAL_CONSTANTS;u.LOCAL_CHAT,u.API_VERSION_PORT_OFFSET;return s.prototype.copy=function(){var e=new s;return e.setTagId(this.getTagId()),e.setTagName(this.getTagName()),e.setPictureUrl(this.getPictureUrl()),e.setUserId(this.getUserId()),e.setPacketId(this.getPacketId()),e.setChatBindingPort(this.getChatBindingPort()),e.setChatIp(this.getChatIp()),e.setChatRegisterPort(this.getChatRegisterPort()),e.setServerDate(this.getServerDate()),e.setMembersObjectMap(this.getMembersObjectMap().copy()),e},s.prototype.update=function(e){e.getTagName()&&this.setTagName(e.getTagName()),e.getPictureUrl()&&this.setPictureUrl(e.getPictureUrl()),e.getUserId()&&this.setUserId(e.getUserId()),e.getPacketId()&&this.setPacketId(e.getPacketId()),e.getServerDate()&&this.setServerDate(e.getServerDate())},s.prototype.sortBy=function(){return this.getTagCreationTime()},l.prototype.update=function(e){e.getFullName()&&this.setFullName(e.getFullName()),e.getStatus()&&this.setStatus(e.getStatus()),e.getStatusType()&&this.setStatusType(e.getStatusType()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getMessageDate()&&this.setMessageDate(e.getMessageDate()),e.getMessageText()&&this.setMessageText(e.getMessageText()),e.getUsersToChange()&&this.setUsersToChange(e.getUsersToChange()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getSeenPacketSent()&&this.setSeenPacketSent(e.getSeenPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getTimeout()&&this.setTimeout(e.getTimeout()),e.getIsDeleted()&&this.markAsDeleted(),e.getHumanReadableTime()||this.setHumanReadableTime(e.getHumanReadableTime())},{TagObject:s,TagMember:c,TagMessage:l}}var n=e.module("ringid.chat");n.factory("tagChatModels",t),t.$inject=["$$stackedMap","userFactory","userService","Utils","Auth","settings","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r){function i(){return"tagc-store-"+n.currentUser().getKey()}function o(n){t.setData(i(),e.toJson(n))}function a(e,t){l.packets[e]=r.arrayBuffer2String(t.buffer.slice(6)),o(l)}function s(e){return r.string2ArrayBuffer(l.packets[e])}function c(){return l.packets}var l={packets:{}};return n.isLoggedIn(),{savePacket:a,getPacket:s,getAllPackets:c}}e.module("ringid.chat").factory("tagChatStorage",t),t.$inject=["Storage","Auth","Utils"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o){function a(e){var t;return t="admin"===e?f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:"member"===e?f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER}function s(t){for(var n={},r=0;r<t.length;r++){var i,o=t[r];i=e.isString(o.status)?a(o.status):o.status,n[i]||(n[i]=[]),n[i].push(o)}return n}function c(e,n,o,a,c,l){var u=t.getBoxByUId(e),d=s(o),g={};a&&(l=CHAT_APP.UTILS.getUUIDPacketId(a,!0),g.messageDate=a);var m=1;for(var E in d)if(d.hasOwnProperty(E)){m||(l=l+"_"+m);var p="";E=parseInt(E),p=E===f.MEMBER_STATUS.ADMIN?f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:E===f.MEMBER_STATUS.MEMBER?f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER;var T=i.createTagStatusMessage(l,e,n,p,d[E],g);if(!T)continue;var h=T.serialize();u?(h.fromHistory=c,u.pushMessage(h,n)):r.addMessage(h,e)}}function l(e,t,n){n||(n=i.getTag(e));var r=0;return n&&(t.tagName&&t.tagPictureUrl&&n.getTagName()!==t.tagName&&n.getPictureUrl()!==t.tagPictureUrl.trim()?r=f.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:(t.tagName&&n.getTagName()!==t.tagName&&(r=f.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE),t.tagPictureUrl&&n.getPictureUrl()!==t.tagPictureUrl.trim()&&(r=f.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE))),r}function u(e,n,o,a,s,c){c||(c=i.getTag(e)),s||(s=CHAT_APP.UTILS.getUUIDPacketId());var u=o.statusMessageType;if(u||(u=l(e,o,c)),o.messageDate&&(s=CHAT_APP.UTILS.getUUIDPacketId(o.messageDate,!0)),0!==u){var d=t.getBoxByUId(e),g=i.createTagStatusMessage(s,e,n,u,[],o);if(!g)return;var m=g.serialize();d?(m.fromHistory=a,d.pushMessage(m,n)):r.addMessage(m,e)}}function d(e,n,o,a,c,l,u){u||(u=i.getTag(e));var d=t.getBoxByUId(e),g=s(o),m={};a&&(m.messageDate=a);for(var E in g)if(g.hasOwnProperty(E)){var p=l+"_"+E,T="";E=parseInt(E),E===f.MEMBER_STATUS.ADMIN?T=f.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:E===f.MEMBER_STATUS.MEMBER?T=f.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:E===f.MEMBER_STATUS.OWNER&&(T=f.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER);var h=i.createTagStatusMessage(p,e,n,T,g[E],m);if(!h)continue;var _=h.serialize();d?(_.fromHistory=c,d.pushMessage(_,n)):r.addMessage(_,e)}}function g(e,n,o,a,s,c,l){l||(l=i.getTag(e)),c||(c=CHAT_APP.UTILS.getUUIDPacketId(a,!0));for(var u=t.getBoxByUId(e),d=0;d<o.length;d++){var g=l.getMember(o[d].userId);g&&(o[d].fullName=g.getName())}var m={};a&&(m.messageDate=a,c=CHAT_APP.UTILS.getUUIDPacketId(a,!0));var E=i.createTagStatusMessage(c,e,n,f.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE,o,m);if(E){var p=E.serialize();u?(p.fromHistory=s,u.pushMessage(p,n)):r.addMessage(p,e)}}var m=CHAT_APP.Constants,f=m.GENERAL_CONSTANTS;return{getTagInfoChangeStatusMessage:l,showTagInfoChangeStatusMessage:u,showMemberTypeChangeStatusMessage:c,showTagMembersAddStatusMessage:d,showTagMembersRemoveStatusMessage:g}}e.module("ringid.chat").factory("tagChatUI",t),t.$inject=["ChatFactory","Utils","chatHistoryFactory","tagChatFactory","Ringalert"]}()}(angular,window),function(e,t){"use strict";!function(t){function n(e,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T,h){var _=t.CHAT_APP,I=_.Constants,A=(I.GENERAL_CONSTANTS,I.CHAT_GLOBAL_VALUES),v=_.ChatRequests,S=_.SharedHelpers,C=(p.TAG,function(){var e=A.offlineUpdateTime,t=S.getChatServerCurrentTime(),n=v.getOfflineGetRequestObject(e,0);h.request(n).then(function(e){e.sucs&&(A.offlineUpdateTime=t)})}),D=function(e,t,n,r){n=n||_.UTILS.getUUIDPacketId(),r=r||10;var i=v.getOfflineTagHistoryMessageRequestObject(e,t,r,n);return h.request(i)},N=function(e,t,n,r){n=n||_.UTILS.getUUIDPacketId(),r=r||10;var i=v.getOfflineFriendHistoryMessageRequestObject(e,t,r,n);return h.request(i)},M=function(e,t){var n=v.getOfflineTagUnreadMessageConfirmationObject(t);h.send(n)},R=function(e,t,n){var r=v.getOfflineFriendUnreadMessageConfirmationObject(n,t);h.send(r)},y=function(e){var t;return t=e.isTagChat?D:N},O=function(e){var t=v.getOfflineFriendInformationObject(e.getUId(),e.getName(),e.getOnlineStatus(),e.getAppType()||1,e.getDeviceToken(),e.getUserMood());h.send(t)};return{getUnreadMessagesMultipleTimes:C,getTagHistoryMessagesMultipleTimes:D,getFriendHistoryMessagesMultipleTimes:N,getHistoryRequestMethodByBox:y,sendTagUnreadMessageConfirmation:M,sendFriendUnreadMessageOfflineConfirmation:R,sendFriendInformation:O}}e.module("ringid.chat").factory("chatRequestProcessor",n),n.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","CHAT_LANG","ChatUtilsFactory","ChatConnector"]}(t)}(angular,window),function(e,t){"use strict";!function(t){function n(n,r,i,o,a,s,c,l){function u(e,t,n){var r=i.getBoxByUId(e);return r||(i.creatNonDomBox(e,n),r=i.getBoxByUId(e),r.nonDomBox=t||!1,o.updateBox(r)),r}function d(e){CHAT_SESSION.UnRegister(e)}function g(e){var t=P.MESSAGE_STATUS_VALUE[e];return t&&(t=t.charAt(0)+t.substr(1).toLowerCase()),t}function m(e,t,n,s,c){if(c||(c=i.getBoxByUId(e)),t==r.currentUser().getKey())c&&c.removeMessage(n),o.removeMessage(n,e);else{var l,u=!1;l=c?c.getMessage(n):o.getMessage(e,n),l||(l=s,u=!0),l.message=a.MESSAGE_DELETE_TEXT,l.status="Deleted",c?u&&c.pushMessage(l,t):o.updateMessage(l,e)}}function f(e,t){var n;return n=e==r.currentUser().getKey()?t:e}function E(e,t){return u(e,t,!1)}function p(e,t){t&&("Seen"!=t.status&&"Deleted"!=t.status&&"Viewed"!=t.status&&"Played"!=t.status&&(t.status="Delivered"),o.updateMessage(t,e))}function T(e){d(e)}function h(e,t,r){r||(r=n.getTag(e));var i=u(e,t,!0);return r&&i.setTitle(r.getTagName()),i}function _(e){d(e)}function I(e){var t,r=e.userId,i=e.tagId,o=e.tagMembers,a=e.packetId,s=e.messageDate||null;t=n.getOrCreateTag(i),c.showTagMembersAddStatusMessage(i,r,o,s,e.fromHistory,a,t),t&&!e.fromHistory&&R(t,o,r)}function A(e){var t,r,i=e.userId,o=e.tagId,a=e.tagMembers,s=e.packetId,l=e.messageDate||null;delete e.packetId,t=n.getOrCreateTag(o),c.showTagMembersRemoveStatusMessage(o,i,a,l,e.fromHistory,s,t),e.fromHistory||(r=y(t,a),r&&(M(o),_(o)))}function v(e){var t,r=(e.userId,e.tagId),i=(e.activityType,e.tagName,e.tagPictureUrl,e.packetId,n.getTag(r));i?(c.showTagInfoChangeStatusMessage(r,e.userId,e,e.fromHistory),e.fromHistory||(t=n.updateTag(r,e,i))):e.fromHistory||(t=n.createNewTag(e),n.addTagObject(t)),s.triggerCustomEvent(l.CHAT.TAG_LIST_UPDATED)}function S(e){var t,r=e.userId,i=e.tagId,o=e.tagMembers,a=e.packetId,s=e.messageDate||null;t=n.getOrCreateTag(i),c.showMemberTypeChangeStatusMessage(i,r,o,s,e.fromHistory,a),e.fromHistory||O(t,o)}function C(e){var t=h(e.tagId);t.updateBoxMessageMinMaxPacketId(e)}function D(e,t,n){if(n.changedByUserId!=n.userId||n.status!=P.MEMBER_STATUS.OWNER)switch(n.activityType){case P.TAG_ACTIVITY_TYPE.DELETED:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case P.TAG_ACTIVITY_TYPE.ADDED:I({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status,fullName:n.activityValue}],fromHistory:n.fromHistory});break;case P.TAG_ACTIVITY_TYPE.LEAVE:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case P.TAG_ACTIVITY_TYPE.TAG_RENAME:v({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,fromHistory:n.fromHistory});break;case P.TAG_ACTIVITY_TYPE.MEMBER_TYPE_CHANGE:S({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status}],fromHistory:n.fromHistory});break;case P.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:v({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagPictureUrl:n.activityValue,fromHistory:n.fromHistory});break;case P.TAG_ACTIVITY_TYPE.TAG_CREATED:C({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,tagMembers:[],fromHistory:n.fromHistory})}}function N(t){RingLogger.information("GROUP ACTIVITY MSG",t,RingLogger.tags.TAG_CHAT_RESPONSE);var n,r=t.packetType,i=(t.userId,t.tagId),o=t.packetId,a=t.messageDate;try{n=e.fromJson(t.message)}catch(s){return void RingLogger.alert("INVALID JSON IN GROUP ACTIVITY MESSAGE",t.message,RingLogger.tags.TAG_CHAT)}var c={changedByUserId:t.userId,userId:n.mId,status:n.mT,activityValue:n.n,activityType:r,activityDate:a,fromHistory:t.fromHistory||!1};D(i,o,c)}function M(e){var t=i.getBoxByUId(e);t&&(i.closeChatBox(t.getKey()),o.removeOpenBox(t.getKey()))}function R(e,t,r){for(var i=0;i<t.length;i++){var o=t[i];r&&(o.addedBy=r);var a=n.createNewTagMember(e.getTagId(),o,!1);a.isRemoved()||e.addMember(a)}}function y(e,t){for(var n=!1,r=0;r<t.length;r++){var i=e.getMember(t[r].userId);i&&(n=i.isCurrentUser(),e.removeMember(i))}return n}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(e){var i=e.getMember(r.userId);i&&i.setStatus(r.status)}}}var b=t.CHAT_APP.Constants,P=b.GENERAL_CONSTANTS,a=a.CHAT;return{doFriendUnregisterTask:T,getFriendBoxId:f,getFriendBox:E,updateMessageStatusToDelivered:p,doOnMessageTypeDeleteMessage:m,getMessageStatus:g,doTagUnregisterTask:_,getTagChatBox:h,processAGroupActivity:D,processGroupActivityMessage:N,addMembersToTagObject:R,removeMembersFromTagObject:y,updateMemberStatusInTagObject:O,processTagMemberAddUpdate:I,processTagMemberRemoveLeave:A,processTagInformation:v,processTagMemberStatusChange:S}}var r;try{r=e.module("ringid.chat")}catch(i){console.log(i)}r.factory("ChatResponseProcessor",n),n.$inject=["tagChatFactory","Auth","ChatFactory","chatHistoryFactory","CHAT_LANG","Utils","tagChatUI","SystemEvents"]}(t)}(angular,window),function(e,t){"use strict";function n(e,t){return{link:function(n,r,i){var o={CAPTURE:"Capture",RETAKE:"ReTake"};n.videoId=e.getUniqueID("rgRec"),n.showLoader=!0,n.media=null,n.errorText="",n.connected=!1,n.captureText=o.CAPTURE;var a=function(){return document.querySelector("#"+n.videoId)},s={text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser. Please use upgraded browser."}},c=t.getRecorderInstance(s);c.on("streamReady",function(e){n.showLoader=!1,n.connected=!0,n.$rgDigest();try{a().appendChild(e.media),n.media=e.media,e.media.play()}catch(t){RingLogger.alert("Stream Ready Exception",t)}}),c.on("error",function(e){n.errorText=e.text,n.showLoader=!1,n.connected=!1,n.$rgDigest()}),n.connect=function(){n.showLoader=!0,n.connected=!1,c.openMedia({video:!0,audio:!1})},setTimeout(function(){n.connect()},500),n.doCapture=function(){if(n.captureText==o.CAPTURE){var e=c.captureImage();e&&(n.capturedMedia=e,n.captureText=o.RETAKE),n.media&&n.media.pause()}else n.capturedMedia=null,n.captureText=o.CAPTURE,n.media.play();n.$rgDigest()},n.$on("$destroy",function(){c.destroy()})},templateUrl:"templates/partials/recorder/image.html"}}e.module("ringid.chat").directive("rgImageCapture",n),n.$inject=["Utils","rgRecorderService"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s){return{link:function(c,l,u){l.on("click",function(l){var d=CHAT_APP.Constants.GENERAL_CONSTANTS,g=d.SESSION_TYPES,m=u.boxId?u.boxId:!1,f="true"==u.isTagChat;if(m&&u.openChatBox!=i.currentUser().getKey()){r.safeDigest(c),n.close(l);var E,p=!1;if(f){if(E=t.getTag(m),E&&E.isTagSafeToShow()){p=!0;var E=t.getTag(m);a.startChatSession(m,g.TAG,E.getMemberUserIds()),e.openTagChatBox(m,!0)}}else a.startChatSession(m,g.FRIEND),e.openChatBox(m,!0);var T=e.getBoxByUId(m);T&&(o.decreaseUnreadCount(T),p&&T.setTitle(E.getTagName())),r.safeDigest(c),s.$broadcast("focusOn",m),l.preventDefault(),l.stopPropagation()}})}}}function r(e,t,n,r,i,o){return{link:function(a,s,c){s.on("click",function(s){var l=c.openChatBox,u=CHAT_APP.Constants.GENERAL_CONSTANTS,d=u.SESSION_TYPES;if(!l)return void RingLogger.alert("Invalid ChatBoxId to open box",RingLogger.tags.CHAT);
if(l==n.currentUser().getKey())return void RingLogger.alert("Same User ChatBox",RingLogger.tags.CHAT);t.safeDigest(a),e.openChatBox(l,!0);var g=e.getBoxByUId(l);if(1==g.getUser().friendshipStatus())i.startChatSession(l,d.FRIEND);else{var m=n.getPermission();if(1==m.ancht)i.startChatSession(l,d.FRIEND);else{var g=e.getBoxByUId(l);g.blocked=!0}}g&&r.decreaseUnreadCount(g),o.$broadcast("focusOn",l),s.preventDefault(),s.stopPropagation()})}}}function i(e,t,n,r,i,o,a){return{link:function(n,s,c){s.on("click",function(){var n=CHAT_APP.Constants.GENERAL_CONSTANTS,s=n.SESSION_TYPES,l=c.openTagChatBox;if(!(0>=l)&&c.openChatBox!=r.currentUser().getKey()){var u=t.getTag(l),d=e.openTagChatBox(l,!0);d.setTitle(u.getTagName()),u&&u.isTagSafeToShow()&&u&&a.startChatSession(l,s.TAG,u.getMemberUserIds()),d&&(d.loadHistoryMessages(),o.decreaseUnreadCount(d)),i.$broadcast("focusOn",l),event.preventDefault(),event.stopPropagation()}})}}}function o(e,t){return{link:function(t,n,r){n.on("click",function(i){t.rbox.value.isFocused=!0,e.makeVisibleChatBox(r.makeVisibleChatBox),n.parent().parent().children().eq(0).removeClass("blink"),i.preventDefault()})}}}function a(e,t){return{link:function(t,n,r){n.on("click",function(){e.openChatBox(r.openChatBox)})}}}function s(e,t,n){return{restrict:"A",link:function(r,i,o){i.on("click",function(){e.closeChatBox(r.box.value.getKey()),t.removeOpenBox(r.box.value.getKey());var i=n.getTag(r.box.value.getKey());i&&i.initMessages(),r.$parent.$digest()})}}}function c(e,t){return{restrict:"A",link:function(n,r,i){r.on("click",function(r){n.box.value.blinkOn&&!n.box.value.isMinimized?(n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):n.box.value.blinkOn&&n.box.value.isMinimized?(e.minimizeBox(n.box.value.getKey()),n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):n.box.value.blinkOn||n.box.value.isMinimized?!n.box.value.blinkOn&&n.box.value.isMinimized&&(e.minimizeBox(n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):(e.minimizeBox(n.box.value.getKey()),t.$broadcast("focusOn",null)),n.$digest(),r.stopPropagation()})}}}function l(e){return{scope:!1,restrict:"A",link:function(e,t,n){}}}function u(e,t,n){return{restrict:"A",link:function(e,t,n){t.on("click",function(t){e.showDropdown=!e.showDropdown,t.stopPropagation()})},controller:["$scope","tagChatFactory","tagChatManager","Auth","Ringalert","$compile",function(e,n,r,i,o,a){function s(e){switch(e.action){case"edit":case"view":return t.close(e.event),function(){return{tagId:e.tagId}};case"delete":t.close(e.event);var i=n.getTag(e.tagId);i.setObjectLock(),r.leaveFromTag(e.tagId,currentUser.getKey()).then(function(e){i.removeObjectLock(),o.show(e,"info")},function(e){i.removeObjectLock(),o.show(e,"error")})}}e.showDropdown=!1,e.hasTagObjectLock=function(e){var t=n.getTag(e);return t?t.hasObjectLock():!1},e.getTagDDControl=function(e){var t=n.getTag(e),r=t.getMember(i.loginData.uId);return{tagId:e,isOwner:r?r.isOwner():!1}},e.tagMemberDDActions=s,e.tagMemberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html"}]}}function d(e,t,n,r){return{restrict:"A",link:function(e,i,o){function a(){RingLogger.information("ScrollToUnread Called for ",e.box.key,"CHAT"),e.refreshScrollbar(!0,function(){var t=i[0].querySelector(".status-unread-container");t?c.scrollBySelector(".status-unread-container",!0):c.scrollBottom(!0),t=null,e.$rgDigest()})}e.$on("ScrollToBottom",function(t,n){n==e.box.value.getKey()&&(i[0].scrollTop=i[0].scrollHeight,t.preventDefault())});var s={minThumbHeight:20},c=t.create(i[0],s);e.bottomReached=function(){ChatHelper.decreaseUnreadCount(box),e.$rgDigest()},e.scrollbarFreezed=!1,e.freezeScrollbar=function(){e.scrollbarFreezed=!0,c.freeze()},e.refreshScrollbar=function(t,n){(e.scrollbarFreezed||t)&&(e.scrollbarFreezed=!1,c.reCalculate(!0).then(function(){e.scroll=c.hasScroll,n&&n.call(this)})),e.bottomScrolled||(e.bottomScrolled=!0,a())};var l=n.onCustomEvent(r.CHAT.SCROLL_TO_BOTTOM,function(t){t.boxId==e.box.value.getKey()&&(RingLogger.information("ScrollToBottom Called for ",t.boxId,"CHAT"),e.refreshScrollbar(!0,function(){c.scrollBottom(!0),e.$rgDigest()}))}),u=n.onCustomEvent(r.CHAT.SCROLL_TO_UNREAD,function(t){t.boxId==e.box.value.getKey()&&a()});e.$on("$destroy",function(){n.removeCustomEvent(r.CHAT.SCROLL_TO_BOTTOM,l),n.removeCustomEvent(r.CHAT.SCROLL_TO_UNREAD,u)})}}}function g(e,t){return{restrict:"A",link:function(e,n,r){e.box.value.blinkOn===!0&&n.addClass("blink"),e.$on("blinkerEvent",function(r,i){i.toString()===e.box.value.getKey()&&(e.box.value.isMinimized?e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0):e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0),t.updateBox(e.box.value))}),e.$on("blinkerOff",function(r,i){i.toString()===e.box.value.getKey()&&(n.removeClass("blink"),e.box.value.blinkOn=!1,t.updateBox(e.box.value))}),e.$on("focusOn",function(t,r){r&&r.toString()===e.box.value.getKey()?n.addClass("chat-active"):(n.removeClass("chat-active"),e.box.value.isFocused=!1)})}}}function m(e,t){return{restrict:"A",link:function(e,n,r){e.$on("blinkerEvent",function(r,i){i.toString()===e.rbox.value.getKey()&&(n.addClass("blink"),n.parent().parent().children().eq(0).addClass("blink"),t.updateBox(e.rbox.value))})}}}function f(e){return{restrict:"A",link:function(e,t,n){e.selectEmoticon=function(t){e.messageText=e.messageText+t.symbol()}}}}function E(e,t){return{restrict:"A",link:function(n,r,i){r.bind("click",function(e){e.stopPropagation()}),e.bind("click",function(){n.showHidden=!1,t.safeDigest(n)})}}}function p(e){return{restrict:"A",link:function(t){t.initMessageData=function(){t.messageData={ogData:{},locationData:{}}},t.resetOgInfo=function(){t.messageData.ogData={},t.ogStatus={preview:!1,loading:!1,filterOnProgress:!1}},t.resetMessageLocation=function(){t.messageData.locationData={description:"",lat:"",lng:""}},t.resetMessageText=function(){t.messageText=""},t.resetBottomMenu=function(){t.showBottomMenu=!1},t.resetMessageInput=function(n){t.initMessageData(),t.resetBottomMenu(),t.resetMessageText(),t.resetOgInfo(),t.resetMessageLocation(),n&&e.safeDigest(t)},t.resetMessageInput(!1)}}}n.$inject=["ChatFactory","tagChatFactory","rgDropdownService","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"],r.$inject=["ChatFactory","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"],i.$inject=["ChatFactory","tagChatFactory","tagChatManager","Auth","$rootScope","ChatHelper","ChatWorkerCommands"],o.$inject=["ChatFactory","$rootScope"],a.$inject=["ChatFactory","$rootScope"],s.$inject=["ChatFactory","chatHistoryFactory","tagChatFactory"],c.$inject=["ChatFactory","$rootScope"],l.$inject=["ChatFactory"],u.$inject=["ChatFactory","rgDropdownService","$compile"],d.$inject=["$rootScope","$scrollbar","Utils","SystemEvents"],g.$inject=["$window","chatHistoryFactory"],m.$inject=["$window","chatHistoryFactory"],f.$inject=["ChatPacketSenderService"],E.$inject=["$document","Utils"],p.$inject=["Utils"],e.module("ringid.chat").directive("openBox",n).directive("openChatBox",r).directive("openTagChatBox",i).directive("makeVisibleChatBox",o).directive("showHiddenBoxes",a).directive("closeBox",s).directive("minimizeBox",c).directive("maximizeBox",l).directive("tagChatEdit",u).directive("chatScrollBottom",d).directive("chatBlinker",g).directive("chatBlinkerH",m).directive("chatBindOutsideClick",E).directive("sharedContent",p)}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o){var a=n.getKey();e.historyLoading=!0,t.call(this,a,r,i,o).then(function(t){t.sucs&&(e.historyLoading=!1),e.refreshScrollbar()},function(){e.historyLoading=!1,n.hasHistoryMessage=!0,e.refreshScrollbar()}),setTimeout(function(){e.historyLoading||(e.historyLoading=!1,e.refreshScrollbar())},1e4)}function r(e,t,n,r,i,o,a,s){var c="templates/chatbox.html";return{restrict:"E",replace:!0,scope:!0,templateUrl:c,link:function(i){setTimeout(a.initStickerData,5e3);var c=CHAT_APP.Constants.GENERAL_CONSTANTS,l=e.onCustomEvent(t.CHAT.BOX_OPENNED,function(r){var a=n.getBoxByUId(r.boxId);a&&a.messages.length<c.HISTORY_MAX_MESSAGE&&setTimeout(function(){a.loadHistoryMessages(),setTimeout(function(){a.bottomScrolled||(a.bottomScrolled=!0,e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:r.boxId}))},500)},500),r.sendToTab&&o.sendData(c.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE,{boxId:r.boxId}),i.$rgDigest(),i.$parent.$rgDigest()});s.on("click",function(e){r.$broadcast("focusOn",null)}),i.$on("$destroy",function(){e.removeCustomEvent(t.CHAT.BOX_OPENNED,l),e.removeCustomEvent(t.CHAT.TAG_LIST_UPDATED,tagListUpdatedFuncRef)})}}}function i(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/extra-chatboxes.html"}}function o(e,t,n,r,i,o){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-chatbox.html",link:function(r,i,a){var s=(CHAT_APP.Constants.GENERAL_CONSTANTS,{}),c=function(i){RingLogger.log("BOX CALLBACK",i,"CHAT"),r.refreshScrollbar(!0),e.safeDigest(r),!i.noScroll&&r.bottomScrolled&&e.triggerCustomEvent(n.CHAT.SCROLL_TO_UNREAD,{boxId:i.boxId}),i.blink&&t.$broadcast("blinkerEvent",i.boxId)},l=function(t){var n=t.boxId.toString();n==r.box.key&&(s[n]||(s[n]={}),s[n][t.type]||(s[n][t.type]=e.debounce(function(e){c(e)},500,!1)),s[n][t.type].call(this,t))},u=e.onCustomEvent(n.CHAT.HISTORY_LOADED,function(t){var n=t.boxId.toString();if(n==r.box.key){var i=CHAT_APP.UTILS.getUUIDPacketId();D(r,o,r.box.value,null,i),e.safeDigest(r)}}),d=e.onCustomEvent(n.CHAT.TAG_LIST_UPDATED,function(e){e.type="tag_updated",e.noScroll=!0,e.blink=!1,e.boxId=e.tagId,l(e)}),g=e.onCustomEvent(n.CHAT.MESSAGE_PUSHED,function(e){e.type="pushed",e.noScroll=e.noScroll||e.fromLocalHistory||e.fromHistory||!1,e.blink=!e.fromLocalHistory||!e.fromHistory||!0,l(e)}),m=e.onCustomEvent(n.CHAT.BOX_UPDATED,function(t){t.boxId==r.box.key&&e.safeDigest(r)});r.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.HISTORY_LOADED,u),e.removeCustomEvent(n.CHAT.MESSAGE_RECEIVED,g),e.removeCustomEvent(n.CHAT.BOX_UPDATED,m),e.removeCustomEvent(n.CHAT.TAG_LIST_UPDATED,d)})}}}function a(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar.html"}}function s(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar-menu.html",link:function(e){var t=e.box.value;e.hideTopbar=!0,setTimeout(function(){e.hideTopbar=!1,e.$rgDigest()},3e3),e.shouldShowLastOnlineBar=function(){return t.offlineStatus&&t.lastSeenBar&&!!t.getUser().lastOnline&&t.getUser().lastOnline()},e.shouldShowFriendSuggestion=function(){return!t.hideSuggestion&!t.isTagChat&&!!t.getUser()&&1!=t.getUser().friendshipStatus()&&!t.offlineStatus},e.shouldShowChatBoxTopbarMenu=function(){return!t.isTagChat&&(e.shouldShowLastOnlineBar()||e.shouldShowFriendSuggestion())}}}}function c(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-url-preview.html"}}function l(e,t){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-bottom.html",link:function(t,n,r){t.toggleMenu=function(){t.showBottomMenu=!t.showBottomMenu,e.safeDigest(t)}}}}function u(){return{restrict:"E",replace:!0,link:function(e){},templateUrl:"templates/partials/chat/chatbox-location-info.html"}}function d(e,t){return{restrict:"E",replace:!0,link:function(e,n,r){e.showMediaButton=t.hasUserMediaSupport(),n.on("mouseover",function(){e.$parent.bottomMenuHover=!0}),n.on("mouseleave",function(){e.$parent.bottomMenuHover=!1})},templateUrl:"templates/partials/chat/chatbox-bottom-menu.html"}}function g(e,t){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-middle.html",link:function(e){}}}function m(e,t,n,r){return{restrict:"E",replace:!0,link:function(r,i,o){var a,s=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,function(t){var n=t.message;n.key==r.message.key&&e.safeDigest(r)});r.openRingboxContent=function(n){a=t.open({type:"remote",scopeData:{message:n,viewport:e.viewport},resolve:{data:{}},onBackDropClickClose:!0,templateUrl:"templates/partials/chat/media-preview.html"})},r.getMediaData=function(e){return{data:function(){return{media:e}},promise:e.fetchDetails()}};var c=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEDOUT,function(e){e.box;a&&a.close()});r.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,s),e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,c)})},templateUrl:"templates/partials/chat/message/single.html"}}function f(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/message/upload-progress.html"}}function E(e,t){var n=(CHAT_APP.Constants.CHAT_GLOBAL_VALUES,CHAT_APP.SharedHelpers,function(e,t){var n=t?t:"Pending";return"Sent"===n&&(n="Delivered"),n}),r=function(e){return t.getChatVerbalDateFromServerDate(e)};return{restrict:"E",replace:!0,link:function(e,t,i){e.$watch("message.status",function(){e.message.statusText=n(e.box.value.isTagChat,e.message.status),e.message.statusDate=r(e.message.messageDate),e.message.statusUserName=e.message.user.getName()})},templateUrl:"templates/partials/chat/message/status.html"}}function p(e,t,n){return{restrict:"E",replace:!0,link:function(t,n,r){var i=CHAT_APP.Constants.GENERAL_CONSTANTS;t.historyLoading=!1,n.on("click",function(){var n=CHAT_APP.UTILS.getUUIDPacketId();t.freezeScrollbar(),D(t,e,t.box.value,i.PAGE_DIRECTION.UP,n)})},templateUrl:"templates/partials/chat/history-loader-view.html"}}function T(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}}function h(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/top.html"}}function _(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/left.html"}}function I(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/right.html"}}function A(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/left-single-box.html"}}function v(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/right-single-box.html"}}function S(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/message-box.html"}}function C(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar-status.html",link:function(e,t){}}}var D=function(e,t,r,i,o){var a=CHAT_APP.Constants.GENERAL_CONSTANTS;if(r&&r.nonDomBox){var s,c,l=r.getBottomMessage(),u=r.getTopMessage();u||l?(c=r.messageMinPacketId,s=r.messageMaxPacketId):s=c=o;var d=t.getHistoryRequestMethodByBox(r),g=s==c,m=a.HISTORY_MAX_MESSAGE+2;i&&i!=a.PAGE_DIRECTION.UP||n(e,d,r,a.PAGE_DIRECTION.UP,c,m),g||i&&i!=a.PAGE_DIRECTION.DOWN||n(e,d,r,a.PAGE_DIRECTION.DOWN,s,m)}};r.$inject=["Utils","SystemEvents","ChatFactory","$rootScope","chatRequestProcessor","chatTabSync","StickerFactory","$document"],o.$inject=["Utils","$rootScope","SystemEvents","chatTabSync","ChatFactory","chatRequestProcessor"],l.$inject=["Utils","$document"],d.$inject=["Utils","rgRecorderService"],g.$inject=["$rootScope","Utils"],m.$inject=["Utils","$ringbox","SystemEvents","$$mediaMap"],E.$inject=["Utils","ChatUtilsFactory"],p.$inject=["chatRequestProcessor","tagChatFactory","ChatFactory"],e.module("ringid.chat").directive("chatBoxUi",r).directive("chatBoxTopBar",a).directive("chatBoxMiddle",g).directive("chatBoxBottom",l).directive("extraChatBoxes",i).directive("chatBoxUrlPreview",c).directive("chatBoxTopBarStatus",C).directive("chatBoxTopBarMenu",s).directive("chatBoxBottomMenu",d).directive("chatBoxLocationInfo",u).directive("chatSingleMessage",m).directive("chatFileUploadProgress",f).directive("singleMessageStatus",E).directive("chatHistoryLoader",p).directive("singleChatBox",o).directive("chatSinglePageTop",h).directive("chatSinglePageLeft",_).directive("chatLeftSingleBox",A).directive("chatSinglePageRight",I).directive("chatRightSingleBox",v).directive("chatMessageBox",S).directive("singlePageChatUI",T)}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p){var T=CHAT_APP.Constants,h=(T.CHAT_GLOBAL_VALUES,T.GENERAL_CONSTANTS),_=CHAT_APP.SharedHelpers;return{controller:["$scope","ChatSeenSend","ChatHelper","Auth","rgScrollbarService","ChatUtilsFactory","SystemEvents",function(t,n,r,i,a,s,c){t.onViewedCalled=function(o){var a=t.box.value,s=t.box.value.isTagChat,c=[{key:o.key,value:o}],l=function(e){for(var t=[],n=0,r=e.length;r>n;n++)e[n].value.user.getKey()!==i.loginData.uId&&"Deleted"!==e[n].value.status&&"Played"!==e[n].value.status&&"Viewed"!==e[n].value.status&&"status_update"!==e[n].value.status&&1!=e[n].value.seenSent&&t.push(e[n]);return t};if(e.isArray(c)&&c.length>0){if(c=l(c),c.length<1)return;n.sendSeenPacket(a,c),s||r.startTimerOthers(t,c)}},t.showUnreadMessages=function(){RingLogger.print("Unread Messages shown",RingLogger.tags.CHAT);var e=t.box.value;r.decreaseUnreadCount(e),o.triggerCustomEvent(c.CHAT.SCROLL_TO_BOTTOM,{boxId:t.box.key,topAlign:!0})}}],link:function(r,f,p){var T=r.box.value.getKey();r.uploadBoxValue=r.box.value.getKey(),r.uploadAction=function(e){RingLogger.print(e,RingLogger.tags.CHAT);var n=o.getUniqueID("ring"),i=function(e){if(RingLogger.print(e,RingLogger.tags.CHAT),t.removeScope(r),e.sucs){var i=r.box.value,a=(i.isTagChat,i.offlineStatus,{url:e.url,caption:e.caption,width:e.iw,height:e.ih}),s=l.imBase+e.url;i.removeMessage(n),o.safeDigest(r),d.sendMessage(i,s,h.MESSAGE_TYPES.IMAGE,{mediaData:a}),r.resetMessageInput(),o.safeDigest(r)}},s=function(e){m.show({mg:"Image Upload Failed, please try again"},"error"),v.removeMessage(n),r.$rgDigest()};e.uploadFile.fetchMeta(function(c){var l={key:n,uploadProgress:e.uploadFile.getProgress,uploading:!0,message:" ",mediaUrl:e.uploadFile.getPreview(),messageDate:_.getChatServerCurrentTime(),messageType:h.MESSAGE_TYPES.IMAGE,packetId:n,sessionId:o.getToken,timeout:0,status:0,getMessageTime:function(){return E.getChatVerbalDateFromServerDate(l.messageDate)},fileUploadObject:e.uploadFile};r.box.value.pushDummyMessage(l,a.currentUser(),!0),t.setScopeForDigest(r),o.safeDigest(r),e.uploadFile.initUpload().then(function(e){l.uploading=!1,i(e)},function(e){console.log(e),l.uploading=!1,s(e)})})};var I=o.onCustomEvent(c.CHAT.BOX_CAM_UPLOAD,function(e){r.box.value.getKey()==e.boxId&&r.uploadAction(e)}),A=r.box.value.getMessages(),v=r.box.value,S=r.box.value.isTagChat,C=function(e){for(var t=[],n=0,r=e.length;r>n;n++)switch(e[n].value.messageType){case 2:case 3:case 4:case 5:case 6:t.push(e[n])}return t},D=function(e){for(var t=[],n=0,r=e.length;r>n;n++)e[n].value.user.getKey()!==a.loginData.uId&&"Deleted"!==e[n].value.status&&"Played"!==e[n].value.status&&"Viewed"!==e[n].value.status&&"status_update"!==e[n].value.status&&1!=e[n].value.seenSent&&t.push(e[n]);return t},N=function(e){for(var t=[],r=0,i=e.length;i>r;r++)"Unread"!=e[r].value.status||e[r].value.timeout&&0!=e[r].value.timeout||(e[r].value.status="Received",t.push(e[r].value));n.updateMessages(t,v.getKey())},M=function(e){n.removeUnreadMessageInfoByBoxId(e)},R=o.onCustomEvent(c.CHAT.TAB_SYNC_NEW_DATA,function(t){if(h.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER==t.type&&(RingLogger.information("TAB_FOCUS_TIMER",t,RingLogger.tags.CHAT),t.boxId==v.getKey()&&e.isArray(A)&&A.length>0)){var n;if(n=D(A),n=C(n),n.length<1)return;N(A),M(t.boxId),v.updateUnreadCount(),S||s.startTimerText(r,n)}}),y=o.onCustomEvent(c.CHAT.WAS_FOCUSED,function(e){if(e&&e.box){var t=e.box,n=e.filteredMessages;t.getKey()==v.getKey()&&(t.isTagChat||s.startTimerText(r,n),g.sendData(h.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:t.getKey()}))}}),O=o.onCustomEvent(c.CHAT.DO_START_SECRET_TIMER,function(e){e&&e.boxId==T&&(e.others?s.startTimerOthers(r,e.messages):s.startTimerText(r,e.messages))}),b=function(t){t.stopPropagation();var n=r.box.value.getKey(),a=r.box.value,c=!1;a.unreadCount>0&&(M(n),a.updateUnreadCount(),c=!0),RingLogger.print("Focus Called",RingLogger.tags.CHAT_0),r.bottomMenuHover||r.bottomMenuButtonHover||(r.showBottomMenu=!1,c=!0),c&&o.safeDigest(r);for(var l=0;l<r.boxes.length;l++)r.boxes[l].value.isFocused=!1;if(a.isMinimized===!0?a.isFocused=!1:a.isFocused=!0,r.$broadcast("blinkerOff",n),i.$broadcast("focusOn",n),e.isArray(A)&&A.length>0){var d;if(d=D(A),d=C(d),d.length<1)return;N(A),u.sendSeenPacket(a,d),S||s.startTimerText(r,d),g.sendData(h.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:a.getKey()})}};f.on("click",b),r.$on("$destroy",function(){o.removeCustomEvent(c.CHAT.BOX_CAM_UPLOAD,I),o.removeCustomEvent(c.CHAT.DO_START_SECRET_TIMER,O),o.removeCustomEvent(c.WAS_FOCUSED,y),o.removeCustomEvent(c.CHAT.TAB_SYNC_NEW_DATA,R)})}}}var n;try{n=e.module("ringid.chat")}catch(r){}n.directive("chatFocus",t),t.$inject=["fileUploadService","chatHistoryFactory","$document","$rootScope","Utils","Auth","ChatHelper","SystemEvents","settings","ChatSeenSend","ChatPacketSenderService","chatTabSync","Ringalert","ChatConnector","ChatUtilsFactory","rgScrollbarService"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c){return{restrict:"A",scope:!0,link:function(i,l,u){var d=i.$eval(u.messageBox);d=d.value;var g,m,f=i.$eval(u.messageMsg),E=function(){return!d.isConsicutive(f.key)};if(i.message.takeDecisionForShowingMessageUserAvator=E,i.message.showAvator=E(),f.user.isCurrentUser()){if(l.addClass("cm-box-r"),"status_update"!==f.status){g=e.element('<img ng-show="message.showAvator" title="'+f.user.getName()+'" class="chat-img-r chat-img" src="'+f.user.avatar("thumb")+'" />');var p=n(g)(i);l.append(p)}}else if(l.addClass("cm-box"),"status_update"!==f.status){g=e.element('<img ng-show="message.showAvator" title="'+f.user.getName()+'" class="chat-img-l chat-img" src="'+f.user.avatar("thumb")+'" />');var p=n(g)(i);l.prepend(p)}var T=function(){var e=Math.floor(f.messageDate/864e5);return d.previousDate!=e?(d.previousDate=e,!0):!1};i.message.takeDecisionForShowingDate=T,i.message.showDate=T(),m=e.element('<div class="line" ng-show="message.showDate"><div class="line-m">{{ message.messageDate | date }}</div></div><div ng-show="message.showDate" class="clear"></div>');var h=n(m)(i);l.prepend(h),i.$on("timeoutDelete",function(e,n,s){if(n===f.key)if(RingLogger.debug(n+":"+s,"CHAT"),s>0)i.message.timeout=s;else{var c=f.user.getKey();if(c==t.loginData.uId){switch(i.message.timeout=0,i.message.secretTimedOut=!0,i.message.messageType){case 2:case 3:case 4:case 5:case 6:i.message.status="Deleted";break;case 8:i.message.status="Played";case 7:case 9:case 10:i.message.status="Viewed"}r.updateMessage(i.message,d.getKey())}else o.deleteMessageFromOwn(d,f),a.triggerCustomEvent(SystemEvents.CHAT.SINGLE_MESSAGE_TIMEOUT,{box:d})}});var _=[],I=[];I.push(i.message.userId),"status_update"==i.message.status&&e.extend(I,i.message.usersToChange),I.forEach(function(e){var t=s.getUser(e);if(!t||!t.hasDetails()){var n=c.register(e,a.debounce(function(){"status_update"==i.message.status&&i.message.refreshStatusMessageText(),i.$rgDigest()},300,!1));_.push(n)}}),i.$on("$destroy",function(){_.forEach(function(e){c.unregister(e)})})}}}function n(e){return{restrict:"EA",link:function(t,n,r){var i=CHAT_APP.SharedHelpers;CHAT_APP.Constants.CHAT_GLOBAL_VALUES;n.on("click",function(i){e.$broadcast("editMessageEvent",r.editMessage,t.message),n.parent().parent().parent().addClass("editing-highlight")});var o=function(e){var t=i.getClientTimeFromServerTime(e),n=Math.floor(Date.now()),r=n-t,o=36e5;return!(r>o)};t.message.canEdit=function(){return t.message.user.isCurrentUser()&&o(t.message.messageDate)&&-1===[4,6,7,8,9,10].indexOf(t.message.messageType)&&!(t.message.timeout>0||1==t.message.secretTimedOut)&&-1===["Deleted","status_update","Viewed","Played"].indexOf(t.message.status)}}}}function r(e){return{restrict:"EA",link:function(t,n,r){n.on("click",function(n){e.retryMessage(t.box.value,t.message,t.messageData)})}}}function i(e,t,n,r,i,o){return{restrict:"EA",link:function(e,t,a){e.message.canDelete=function(){return-1===["status_update"].indexOf(e.message.status)},t.on("click",function(t){if(i.deleteMessageFromOwn(e.box.value,e.message),e.message.user.getKey().toString()===n.loginData.uId.toString())if(e.box.value.isTagChat){var a=e.box.value.getKey(),s=(o.getTag(a),[{packetId:e.message.key}]),c=u.getTagChatMultipleMsgDeleteObject(a,s);r.send(c)}else if(1!=e.message.secretTimedOut||e.message.timeout>0){e.box.value.sendTabUpdate(e.message);var l=e.box.value.getKey(),s=[{packetId:e.message.key}],c=u.getFriendChatMultipleMsgDeleteObject(l,s);r.send(c)}})}}}function o(t,n){return{restrict:"A",link:function(r,i,o){var a=r.$eval(o.chatMessageReact),s=["status_pending","status_delivered","status_seen","status_sent"],c=function(){"status_update"==a.status?i.addClass("status_update"):a.user.isCurrentUser()?i.addClass("status_received"):s[a.status]&&i.addClass(s[a.status])};e.isObject(a.user)?c():t.user.getUserDetailsByUId({uId:a.user}).then(function(e){e&&(a.user=n.create(e),c(),Utils.safeDigest(r))})}}}function a(t,n,r,i,o,a,s,c,l,u,d,g){return{restrict:"A",link:function(t,n,r){var i=CHAT_APP.Constants.GENERAL_CONSTANTS;CHAT_APP.Constants.AUTH_SERVER_ACTIONS;t.messageText="";var o=function(e){var t=0,n={startPos:0,endPos:0,selectionLength:0};if(document.selection){e.focus();var r=document.selection.createRange();r.moveStart("character",-e.value.length),t=r.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart,n.startPos=e.selectionStart,n.endPos=e.selectionEnd,n.selectionLength=Math.abs(e.selectionStart-e.selectionEnd));return n},a=function(e,t,n){e.value=e.value;var r=e.value;if(null!==e){if(e.createTextRange){var i=e.createTextRange();return e.value=r.slice(0,t.startPos)+n+r.slice(t.endPos),i.move("character",t.startPos+n.length),i.select(),!0}return e.selectionStart||0===e.selectionStart?(e.focus(),e.value=r.slice(0,t.startPos)+n+r.slice(t.endPos),e.setSelectionRange(t.startPos+n.length,t.startPos+n.length),!0):(e.focus(),!1)}};t.selectedLocation=function(){u.triggerCustomEvent(d.CHAT.SCROLL_TO_BOTTOM,{boxId:t.box.key}),u.getUserLocation().then(function(e){e.sucs?(t.messageData.locationData=e,e.lat&&9999!=e.lat?c.sendMessage(t.box.value,"",i.MESSAGE_TYPES.LOCATION_SHARE,t.messageData):RingLogger.alert("Location Lat not found.",e,RingLogger.tags.CHAT),t.$rgDigest()):(g.show({mg:"Please Enable Browser Location Tracking."},"error"),RingLogger.alert(e.error,RingLogger.tags.CHAT)),t.resetMessageInput(!0)})},t.selectEmoticonChat=function(e){if(e.isSticker()||e.isLargeEmoticon()){t.resetMessageInput();c.sendMessage(t.box.value,e.srcWithoutBase(),6);u.triggerCustomEvent(d.CHAT.MESSAGE_SUBMITTED,{boxId:t.box.value.getKey()}),t.messageText="",u.triggerCustomEvent(d.CHAT.SCROLL_TO_BOTTOM,{boxId:t.box.value.getKey()})}else t.messageText=t.messageText+""+e.symbol(),n[0].focus()};var s=function(){n.on("keyup",function(e){var r=function(){var e=function(){t.box.value.isTyping()===!1&&(c.sendTypingPacket(t.box.value),t.box.value.setTypingBool(!0),setTimeout(function(){t.box.value.setTypingBool(!1),u.triggerCustomEvent(d.CHAT.BOX_UPDATED,{boxId:t.box.key})},5e3))};t.box.value.isTagChat?e():t.box.value.offlineStatus===!1&&e()};if(13==e.which&&e.ctrlKey){var i=n[0],s=o(i);a(i,s,"\n"),t.messageText=i.value}if(13!==e.which||13==e.which&&e.ctrlKey)r();else{n.attr("messageKey")&&(t.box.value.editMessageKey=n.attr("messageKey"),n.removeAttr("messageKey"),t.box.value.editMessageDate=n.attr("messageDate"),n.removeAttr("messageDate"),n.removeClass("editing"),n.removeClass("editing-highlight"));var l=c.getMessageType(t.messageData);""!==t.messageText&&(t.messageText=t.messageText.replace(/^\s+|\s+$/g,""),t.messageText=t.messageText.replace(/\n\n+/g,"\n\n"),c.sendMessage(t.box.value,t.messageText,l,t.messageData),t.resetMessageInput(!0),u.triggerCustomEvent(d.CHAT.MESSAGE_SUBMITTED,{boxId:t.box.key}))}})},l=function(){n.off("keyup")};s(),t.$on("$destroy",l),t.box.value.isFocused===!0&&n[0].focus(),t.$on("editMessageEvent",function(r,o,a){if(t.box.value.getKey()==o){var s=a.messageType;switch(s){case i.MESSAGE_TYPES.TEXT:t.messageText=a.text;break;case i.MESSAGE_TYPES.LOCATION_SHARE:t.locationData=a.locationInfo;break;case i.MESSAGE_TYPES.LINK_SHARE:e.fromJson(a.text);t.messageText=a.ogData.message||a.ogData.description}n.addClass("editing"),n.attr("messageKey",a.key),n.attr("messageDate",a.messageDate),u.safeDigest(t),n[0].focus()}})}}}function s(e,t){return{restrict:"A",link:function(n,r,i){r[0].onload=function(){n.message.scroll&&e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:i.boxid})},r[0].src=i.chatimgsrc}}}var c;try{c=e.module("ringid.chat")}catch(l){}var u=CHAT_APP.ChatRequests;t.$inject=["Auth","$compile","chatHistoryFactory","$interval","ChatHelper","Utils","userFactory","userService"],n.$inject=["$rootScope"],r.$inject=["ChatPacketSenderService"],i.$inject=["Storage","Utils","Auth","ChatConnector","ChatHelper","tagChatFactory"],o.$inject=["Api","userFactory"],a.$inject=["ChatFactory","$timeout","ChatConnector","tagChatFactory","tagChatManager","$$connector","OPERATION_TYPES","ChatPacketSenderService","ChatHelper","Utils","SystemEvents","Ringalert"],s.$inject=["Utils","SystemEvents"],c.directive("messageDirective",t),c.directive("editMessage",n),c.directive("retryMessage",r),c.directive("deleteMessage",i),c.directive("chatMessageReact",o),c.directive("sendMessageDirective",a),c.directive("chatImage",s)}()}(angular,window),function(e,t){"use strict";!function(){var t;try{t=e.module("ringid.chat")}catch(n){}t.directive("setTimeout",["ChatFactory","$compile","$document",function(t,n,r){return{restrict:"EA",template:'<a><span class="img_sprite w-h-22px icon-timer-s"></span></a>',link:function(t,i,o){var a,s=function(){t.showTimeout=!0,t.closeSettingPopup(),r.bind("click",c);var o=e.element("<set-timeout-bar ></set-timeout-bar>");a=n(o)(t),i.parent().parent().parent().next().prepend(a)},c=function(){t.showTimeout=!1,r.unbind("click",c),a&&a.remove()};t.closeTimeoutPopup=function(){c()},t.showTimeout=!1,i.on("click",function(e){console.dir(t.showTimeout),t.showTimeout?c():s(),e.stopPropagation()})}}}]).directive("setTimeoutBar",["ChatFactory","$compile",function(t,n){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="enable-secret-chat">Enable Secret Chat:</span><div class="switchnew"><input class="float-left" ng-model="box.value.secretChat" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n<a href="#" ng-click="showValueBox($event)" class="img_sprite timeout-sec icon-time"><p>sec</p><span>{{ timeout>4 ? timeout : 5}}</span></a></div></div>',link:function(t,r,i){var o;t.timeout=t.box.value.timeout,t.showTimeoutBox=!1,t.cancel=function(e){t.closeTimeoutPopup(),e&&(e.preventDefault(),e.stopPropagation())},t.showValueBox=function(i){if(t.showTimeoutBox)t.hideValueBox();else{t.showTimeoutBox=!0;var a=e.element("<set-timeout-Value ></set-timeout-Value>");o=n(a)(t),r.children(0).append(o)}i&&(i.preventDefault(),i.stopPropagation())},t.hideValueBox=function(e){t.showTimeoutBox=!1,o&&o.remove(),e&&(e.preventDefault(),e.stopPropagation())},r.on("click",function(e){e.stopPropagation()})}}}]).directive("setTimeoutValue",["ChatFactory",function(e){return{restrict:"EA",templateUrl:"templates/partials/chat-timeout-value-box.html",link:function(e,t,n){e.selectTimeout=function(t,n){e.box.value.timeout=e.timeout=n,e.hideValueBox(t)}}}}])}()}(angular,window),function(e,t){"use strict";!function(){var t;try{t=e.module("ringid.chat")}catch(n){}t.directive("setting",["ChatFactory","$compile","$document",function(t,n,r){return{restrict:"EA",template:'<a><span class="img_sprite icon-g-settings"></span></a>',link:function(t,i,o){var a,s=function(){t.showSetting=!0,t.closeTimeoutPopup(),r.bind("click",c);var o=e.element("<setting-bar ></setting-bar>");a=n(o)(t),i.parent().parent().parent().next().prepend(a);
},c=function(){t.showSetting=!1,r.unbind("click",c),a&&a.remove()};t.closeSettingPopup=function(){c()},t.showSetting=!1,i.on("click",function(e){console.dir(t.showSetting),t.showSetting?c():s(),e.stopPropagation()})}}}]).directive("settingBar",["ChatFactory","$compile","profileFactory","tagChatFactory","ChatUtilsFactory","Auth","ChatConnector","PLATFORM","Ringalert",function(e,t,n,r,i,o,a,s,c){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="secret-visible">Timer:</span><div class="switch-secret-visible"><input class="float-left" ng-model="box.value.isSecretVisible" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n</div></div>',link:function(e,t,n){var r=(CHAT_APP.SharedHelpers,CHAT_APP.UTILS.getUUIDPacketId,o.currentUser());r.getUtId();e.cancel=function(t){e.closeSettingPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.blockUnblock=function(e){},t.on("click",function(e){e.stopPropagation()})}}}])}()}(angular,window),function(e,t){"use strict";e.module("ringid.chat").directive("rgTagChatList",function(){return{restrict:"E",templateUrl:"templates/partials/tag-chat/tag-chat-list.html"}})}(angular,window),function(e,t){"use strict";e.module("ringid.sticker",["ringid.config"])}(angular,window),function(e,t){"use strict";function n(t,n){var r=function(r,i,o){var a={type:t.STICKER,imageList:[]},s=r.imagesList;if(e.isArray(s)){var c=s[0].sCtId,l=o[c];a.collectionId=l.getCollectionId(),a.categoryId=c,e.forEach(s,function(e){a.imageList.push({name:e.imUrl,type:t.STICKER,id:e.imId}),i[e.sCtId]=n.create(a)})}return i};return{parseCategoryStickerData:r}}e.module("ringid.sticker").factory("StickerHelper",n),n.$inject=["STICKER_IMAGE_TYPE","$$stickerMap"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){n.stickerCategories=r.getStickerCategories(),RingLogger.print(n.stickerCategories,RingLogger.tags.STICKER),n.stickerCollections=r.getStickerCollections(),t&&t.stickerKey&&(n.sticker=r.getStickerCategoryObject(t.stickerKey),n.$rgDigest()),n.addSticker=function(e){r.addMySticker(e.getKey()),n.$rgDigest()},n.removeSticker=function(e){r.removeMySticker(e.getKey()),n.$rgDigest()},n.isInstalled=function(e){return r.isDownloaded(e)},n.close=function(t){e.close(),t&&(t.preventDefault(),t.stopPropagation())}}e.module("ringid.sticker").controller("StickerPopupController",n),n.$inject=["$boxInstance","localData","$scope","StickerFactory"]}(angular,window),function(e,t){"use strict";function n(t){return{keyString:"sCtId",getKeyString:function(){return n.keyString},create:function(n){var r={sCtId:0,sctName:"",sClId:0,cgBnrImg:"",rnk:1,dtlImg:"",thmColor:"",txtColor:"",cgNw:0,icn:"",prz:0,free:0,dcpn:""},i=function(t){var n=e.extend({},r,t);return n};return e.isObject(n)&&(r=i(n)),{getCategoryId:function(){return r.sCtId},setCategoryId:function(e){r.sCtId=e},getCollectionId:function(){return r.sClId},setCollectionId:function(e){r.sClId=e},getKey:function(){return this.getCategoryId()},setKey:function(e){this.setCategoryId(e)},getName:function(){return r.sctName},setName:function(e){r.sctName=e},getTextColor:function(){return r.txtColor},setTextColor:function(e){r.txtColor=e},getBannerImage:function(){return r.bnrImg},setBannerImage:function(e){r.cgBnrImg=e},getRank:function(){return r.rnk},setRank:function(e){r.rnk=e},getDetailImage:function(){return r.dtlImg},getDetailImageUrl:function(){var e=t.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getDetailImage();return e},setDetailImage:function(e){r.dtlImg=e},getNewCategory:function(){return r.cgNw},setNewCategory:function(e){r.cgNw=e},getIconImage:function(){return r.icn},setIconImage:function(e){r.icn=e},getIconImageUrl:function(){var e=t.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getIconImage();return e},getCaptionImageUrl:function(e){var n=t.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/";return e?n+"ca.png":n+"c.png"},getPrice:function(){return r.prz},setPrice:function(e){r.prz=e},isFree:function(){return r.free},setIsFree:function(e){r.free=e},getDescription:function(){return r.dcpn},setDescription:function(e){r.dcpn=e},getThumbColor:function(){return r.thmColor},setThumbColor:function(e){r.thmColor=e}}}}}e.module("ringid.sticker").factory("StickerCategoryModel",n),n.$inject=["settings"]}(angular,window),function(e,t){"use strict";function n(t,n){return{create:function(n){var r={sClId:0,name:"",txtColor:"",bnrImg:"",thmColor:"",categories:[]},i=function(t){var n=e.extend({},r,t);return n};return e.isObject(n)&&(r=i(n)),{getId:function(){return r.sClId},setId:function(e){r.sClId=e},getKey:function(){return this.getId()},setKey:function(e){this.setId(e)},getName:function(){return r.name},setName:function(e){r.name=e},getTextColor:function(){return r.txtColor},setTextColor:function(e){r.txtColor=e},getBannerImage:function(){return r.bnrImg},setBannerImage:function(e){r.bnrImg=e},getBannerImageUrl:function(){var e=t.stickerBase+this.getId()+"/"+this.getBannerImage();return e},getThumbColor:function(){return r.thmColor},setThumbColor:function(e){r.thmColor=e},addCategories:function(e){r.categories.push(e)},removeCategories:function(e){r.categories.splice(e,1)},getCategories:function(){return r.categories}}}}}e.module("ringid.sticker").factory("StickerCollectionModel",n),n.$inject=["settings","$$stackedMap"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){var i=r.STICKER,o=r.SYSTEM.REQUEST_TYPE,a=this;a.go=function(t,n,r){return n=n||"get",r=r||[],e[n](t,r)},a.getAll=function(){var e=n.stickerApi+"all=1";return a.go(e)},a.getStickerCategoriesByCollectionId=function(e){var t=n.stickerApi+"collectionId="+e;return a.go(t)},a.getStickersByCatId=function(e){var t=n.stickerApi+"categoryId="+e;return a.go(t)},a.getMyStickers=function(){var e={actn:i.GET_MY_STICKER};return t.request(e,o.REQUEST)},a.addSticker=function(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.ADD_JT_VALUE};return t.request(n,o.UPDATE)},a.removeSticker=function(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.REMOVE_JT_VALUE};return t.request(n,o.UPDATE)}}e.module("ringid.sticker").service("stickerHttpService",n),n.$inject=["$ringhttp","$$connector","settings","OPERATION_TYPES"]}(angular,window),function(e,t){"use strict";function n(e,t){return{create:function(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};return{getKey:function(){return o.id},src:function(){return o.src},symbol:function(){return o.symbol},getName:function(){return o.name},srcWithoutBase:function(){return o.src.replace(e.stickerBase,"")},isEmoticon:function(){return o.isEmoticon},isLargeEmoticon:function(){return o.isLargeEmoticon},isSticker:function(){return o.isSticker}}}}}function r(e,t,n){return{create:function(r,i){for(var o,a=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",s={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+a+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":a+"ca.png",installed:i||!1},c=0;c<r.imageList.length;c++)o=t.create(r.imageList[c],s.type,a),s.imageListMap.add(o.getKey(),o);return{sortBy:function(){return s.categoryId},isInstalled:function(){return s.installed},setInstalled:function(e){s.installed=e},isEmoticon:function(){return s.isEmoticon},isLargeEmoticon:function(){return s.isLargeEmoticon},isSticker:function(){return s.isSticker},getKey:function(){return s.categoryId},getImages:function(){return s.imageListMap},getType:function(){return s.type},link:function(){return s.regularUrl},hoverLink:function(){return s.hoverUrl}}}}}function i(t,n,r,i,o,a,s,c,l,u){function d(t){try{var n=t.getKey();r.getStickerCategoriesByCollectionId(n).success(function(n){if(n&&n.sucs===!0&&n.categoriesList){var r=n.categoriesList;e.isArray(r)&&e.forEach(r,function(e){var n=e[a.getKeyString()],r=v[n];r||(r=a.create(e),v[r.getKey()]=r),t.addCategories(r.getKey())})}}).error(function(e){})}catch(i){}}function g(t){try{e.forEach(t.freeCategoriesList,function(e){var t=a.create(e);v[t.getKey()]=t,C.free.push(t.getKey())})}catch(n){}try{e.forEach(t.topCategoriesList,function(e){var t=a.create(e);v[t.getKey()]=t,C.top.push(t.getKey())})}catch(n){}try{e.forEach(t.stNewCategoriesList,function(e){var t=a.create(e);v[t.getKey()]=t,C["new"].push(t.getKey())})}catch(n){}try{e.forEach(t.stickerCollectionsList,function(e){var t=s.create(e);D[t.getKey()]=t,d(t)})}catch(n){}}function m(){r.getAll().success(function(e){try{e&&e.sucs===!0&&(E(e),g(e),T())}catch(t){}}).error(function(e){})}function f(){try{return u.getData(I)}catch(e){return!1}}function E(e){u.setData(I,e)}function p(){u.setData(A,N)}function T(){N=u.getData(A),y&&N||(N={},r.getMyStickers().then(function(t){t.sucs===!0&&(e.forEach(t.catIds,function(e){N[e]=1,S[e]&&S[e].setInstalled(!0)}),p())}))}function h(e){try{g(e)}catch(t){}}function _(e){try{return v[e]}catch(t){return{}}}var I="stickerData",A="myStickers",v={},S={},C={free:[],"new":[],top:[]},D={},N={},M=i.getAllEmoticons(),R=n.create(M,!0),y=!1,O=function(e){var t=l.defer();return S[e]||r.getStickersByCatId(e).success(function(e){e&&e.sucs===!0&&(o.parseCategoryStickerData(e,S,v),t.resolve(e))}).error(function(e){t.reject(e)}),t.promise};return{initStickerData:function(t){if(t===!0)m();else{var n=f();e.isObject(n)?(h(n),T()):m()}},getNoOfMyStickers:function(){return N?Object.keys(N).length:0},getStickerCategories:function(e){return e?C[e]:C},getStickerCollections:function(){return D},getMyStickerCatIds:function(){return N?Object.keys(N):[]},getStickerMapByCatId:function(e){var t=l.defer();return S[e]?t.resolve(S[e]):O(e).then(function(){t.resolve(S[e])},function(e){t.reject(e)}),t.promise},isDownloaded:function(e){return!!N[e]},getStickerCategoryObject:function(e){return _(e)},getEmoticonMap:function(){return R},getMyStickers:function(){return r.getMyStickers()},addMySticker:function(e){try{N[e]=1,p(),S[e]&&S[e].setInstalled(!0)}catch(t){}r.addSticker({catId:e}).then(function(t){t.sucs!==!0&&(N[e]=0,S[e].setInstalled(!1))},function(e){})},removeMySticker:function(e){try{delete N[e],p(),S[e]&&S[e].setInstalled(!1)}catch(t){}r.removeSticker({catId:e}).then(function(t){t.sucs!==!0&&(N[e]=1,S[e].setInstalled(!0))},function(e){})}}}e.module("ringid.sticker").factory("StickerFactory",i).factory("$$stickerMap",r).factory("$$stickerImageMap",n),n.$inject=["settings","STICKER_IMAGE_TYPE"],r.$inject=["$$stackedMap","$$stickerImageMap","settings"],i.$inject=["$$stackedMap","$$stickerMap","stickerHttpService","StickerEmoticonFactory","StickerHelper","StickerCategoryModel","StickerCollectionModel","STICKER_IMAGE_TYPE","$$q","Storage"]}(angular,window),function(e,t){"use strict";function n(e){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category.html",scope:{categories:"=categories"},link:function(t){t.getStickerCategory=e.getStickerCategoryObject,t.showPreview=function(e){return function(){return{stickerKey:e}}},t.isInstalled=function(t){return e.isDownloaded(t)},t.addSticker=function(n){e.addMySticker(n),t.$rgDigest()},t.removeSticker=function(n){e.removeMySticker(n),t.$rgDigest()}}}}e.module("ringid.sticker").directive("rgStickerCategory",n),n.$inject=["StickerFactory"]}(angular,window),function(e,t){"use strict";e.module("ringid.sticker").directive("rgStickerCategoryList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category-list.html",scope:{categories:"=categories"}}})}(angular,window),function(e,t){"use strict";e.module("ringid.sticker").directive("rgStickerCollectionList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-collection-list.html",scope:{collections:"="},link:function(e){e.currentCollectionIdToShow=0,e.shouldShowCollectionCategories=function(t){return e.currentCollectionIdToShow==t},e.showCollectionCategories=function(t){e.displayingCollections=!e.displayingCollections,e.currentCollectionIdToShow=t,e.$rgDigest()},e.displayingCollections=!0}}})}(angular,window),function(e,t){"use strict";e.module("ringid.controllers",["ringid.config"])}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s){function c(){var e=a.open({type:"remote",resolve:{localData:{mdaT:"audio"===d?E.NEWS_FEED_MEDIA_TYPE_AUDIO:E.NEWS_FEED_MEDIA_TYPE_VIDEO}},scope:!1,controller:"AlbumCreateController",templateUrl:"templates/popups/create-album-popup.html"});e.result.then(function(e){e&&(t.selectedAlbum=e,t.$rgDigest())})}function l(e){switch(e.action){case"select":if(t.selectedAlbum&&t.selectedAlbum.getKey()===e.albumMap.getKey())break;f.indexOf(e.albumMap.getKey())>-1?t.selectedAlbum=null:(t.selectedAlbum=e.albumMap,RingLogger.information("Selected Album: "+t.selectedAlbum.getName(),RingLogger.tags.UPLOAD))}t.$rgDigest()}function u(){n.init(),g=o.subscribe(function(){setTimeout(function(){t.$rgDigest()},500)},{action:[m.ACTION_MEDIA_ALBUM_LIST]}),t.media?(d=t.media.isAudio()?"audio":"video",n.makeApiCall("mediaInAlbums",{strmURL:t.media.getStreamUrlOnly()}).then(function(e){RingLogger.print(e,RingLogger.tags.MEDIA),e.sucs===!0&&(f=e.albIds,t.$rgDigest())})):d=t.params.mediaType}var d,g,m=i.SYSTEM.MEDIA,f=[],E=e;t.selectedAlbum=null,t.albumName="",t.media=t.params.media,t.selectAlbum=l,t.createAlbumPopup=c,t.existsInAlbum=function(e){return t.selectedAlbum?t.selectedAlbum.getId()===e||f.indexOf(e)>-1:f.indexOf(e)>-1},t.addToAlbum=function(){t.media&&t.selectedAlbum?t.selectedAlbum.addNewContent(t.media):t.selectedAlbum&&s.setUploadAlbum(t.selectedAlbum.getId()),t.close()},t.getAlbums=function(){return n.getAlbums(!0,d)},u(),t.$on("$destroy",function(){o.unsubscribe(g)})}e.module("ringid.controllers").controller("AlbumlistController",t),t.$inject=["APP_CONSTANTS","$scope","Media","Ringalert","OPERATION_TYPES","$$connector","$ringbox","fileUploadService"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i){e.albumName="",e.createAlbum=function(){e.albumName.length>0&&(RingLogger.information("Create Album: "+e.albumName,RingLogger.tags.UPLOAD),t.createAlbum({albn:e.albumName,mdaT:i.mdaT},!0).then(function(e){e&&r.close(e)}))}}e.module("ringid.controllers").controller("AlbumCreateController",n),n.$inject=["$scope","Media","APP_CONSTANTS","$boxInstance","localData"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){e.close=t.close,e.params=r,n("AlbumlistController",{$scope:e})}e.module("ringid.controllers").controller("RingBoxAlbumlistController",n),n.$inject=["$scope","$boxInstance","$controller","localData"]}(angular,window),function(e,t){"use strict";function n(e,t,n){function r(e){t.close(e)}e.close=r,e.params=n}e.module("ringid.controllers").controller("RingBoxConfirmController",n),n.$inject=["$scope","$boxInstance","localData"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r){e.params={},e.params.imgId=t.imageId,e.isReady=!1,e.currentUser=r.currentUser(),n("ImagePopupController",{$scope:e}),e.showCommentBox=!0}e.module("ringid.controllers").controller("SingleImageController",n),n.$inject=["$scope","$routeParams","$controller","Auth"]}(angular,window),function(e,t){"use strict";e.module("ringid.media",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),function(e,t){"use strict";function n(e,n,r,i){function o(e,n,r,o,a,s,c,l,u,d,g,m,f,E,p,T,h,_){function I(e,t){"false"!==s.profilePage&&("album"===t?s.state.albumsLoading=e:s.state.contentsLoading=e,s.$rgDigest())}function A(e){return"true"===s.profilePage?c.getAlbums(O.isCurrentUser(),e):c.getAlbums(!0,e)}function v(e){var t="Are you sure you want to delete?",n=_.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(t){t&&c.deleteMedia(e)})}function S(e,n){if("false"===s.profilePage){var r,i=[];switch(i.push(e.getName()),i.push(e.getContentCount()),d.setData("albumname",i),n){case"audio":r="media/"+n+"/"+e.getALbumUtId()+"/"+e.getKey(),l.path(r);break;case"video":r="media/"+n+"/"+e.getALbumUtId()+"/"+e.getKey(),l.path(r);break;default:r="media",l.path(r)}}else e?t.location=e.link(O):t.location=f.getRingRoute("USER_PROFILE",{uId:O.getUId(),utId:O.getUtId(),subpage:"media"})}function C(e,t){t?s.selectedPlaylist.add(e.getKey(),e):s.selectedPlaylist.remove(e.getKey())}function D(e,t){var n;return n=e?s.activeAlbum.getContents().all():s.selectedPlaylist.all(),t=t||n[0].value,{data:function(){return{media:t,playlist:n,popupForm:"profile"}},promise:t.fetchDetails(O)}}function N(e){(e||!s.state.contentsLoading&&s.activeAlbum&&s.activeAlbum.getContents().length()<s.activeAlbum.getContentCount())&&(I(!0),c.fetchAlbumContents({albId:s.activeAlbum.getKey(),utId:O.getUtId(),st:s.activeAlbum.getContents().length()}))}function M(){R=m.subscribe(function(e){switch(e.actn){case y.ACTION_MEDIA_ALBUM_LIST:e.utId===O.getUtId()&&setTimeout(function(){s.showMediaPreview||(s.activeAlbum=c.getAlbum(i.albumId),s.activeAlbum&&N(!0)),I(!1,"album")},2e3);break;case y.ACTION_MEDIA_ALBUM_CONTENT_LIST:c.processResponse(e),setTimeout(function(){I(!1)},1e3)}},{action:[y.ACTION_MEDIA_ALBUM_LIST,y.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),i.albumId?(s.showMediaPreview=!1,s.activeAlbum=c.getAlbum(i.albumId),s.activeAlbum&&N(!0),I(!0)):s.showMediaPreview=!0,O.isCurrentUser()||(c.fetchAllAlbums(O.getUtId()),I(!0,"album")),c.init()&&I(!0,"album")}var R,y=g.SYSTEM.MEDIA,O=e.getProfile(i.uId||0);s.profilePage=u.inProfile,s.showMediaPreview=!1,s.activeAlbum=null,s.state=c.state,s.selectedPlaylist=T.createNew(),s.getAlbums=A,s.deleteMedia=v,s.toggleAlbumPreview=S,s.getMediaData=D,s.selectMedia=C,s.loadMoreContent=N,s.musicTab=!0,s.showAlbumContents=!1,i.albumId&&(s.showAlbumContents=!0,s.$rgDigest()),s.showDesiredTab=function(e){switch(e){case"music":s.musicTab=!0;break;case"video":s.musicTab=!1}s.$rgDigest()},M(),"false"===s.profilePage?s.limitItem=4:s.limitItem="Infinity",s.$on("$destroy",function(){m.unsubscribe(R),c.resetMediaAlbums()})}o.$inject=["profileFactory","Auth","fileUploadService","SystemEvents","$rootScope","$scope","Media","$location","$attrs","Storage","OPERATION_TYPES","$$connector","Utils","userFactory","$$mediaAlbumMap","$$stackedMap","mapFilterFilter","$ringbox"];var a=function(t,r,i){function o(){t.showMediaPreview||e.innerHeight+e.scrollY>=n[0].body.offsetHeight&&t.loadMoreContent(!0)}e.addEventListener("scroll",o),t.$on("$destroy",function(){e.removeEventListener("scroll",o)})};return{restrict:"E",controller:o,link:a,templateUrl:function(e,t){return t.templatepath}}}e.module("ringid.media").directive("rgMedia",n),n.$inject=["$window","$document","Media","$routeParams"]}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n){function r(e,t,n,r,i,o,a,s,c,l,u,d,g){function m(){for(var e=n.getData("mediaRecent"),r=0;r<e.length;r++){var i=t(e[r]);o.medias.save(i.getKey(),i)}}var f=[];n.setData("albumname",f),o.medias=e.createNew(!0,"desc"),o.popupmedias=e.createNew(!0,"desc");r.SYSTEM.MEDIA;o.recentMediaDropdown="templates/dropdowns/recent-media-dropdown.html",o.searchedMedia=e.createNew(),o.trendingArr=[],o.nodatafound=!1,o.noaudiofound=!1,o.activeNav="recent";var E=i.currentUser();o.utId=E.getUtId(),a.fetchAllAlbums(),m(),o.getRecentMediaData=function(e){return{data:function(){return{media:e,playlist:o.medias.all()}},promise:e.fetchDetails()}},o.getTaggedMedia=function(e){a.getTaggedMedia(e)},o.goToMyAlbums=function(e){var t="media/"+e;l.path(t)},o.selectAlbum=function(e){return{data:function(){return{media:e}}}},o.actionRecentMediaDropdown=function(e){switch(e.action){case"addtoalbum":console.log("addtoalbum");d.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:e.data.obj}},templateUrl:"templates/dropdowns/popup-album-dropdown.html"});break;case"sendtofriend":console.log("sendtofriend");break;case"shareatringid":var t=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:e.data.obj},onBackDropClickClose:!0,templateUrl:"templates/home/share-media.html"});t.result.then(function(){o.$rgDigest()}),console.log("shareatringid");break;case"shareatfb":console.log("shareatfb");break;case"download":console.log("download"),g.show("Currently download option is available in ringID desktop and mobile app version only","info")}},o.$on("$destroy",function(){a.resetMediaAlbums()})}r.$inject=["$$stackedMap","$$mediaMap","Storage","OPERATION_TYPES","Auth","$scope","Media","userFactory","$$mediaAlbumMap","$location","rgDropdownService","$ringbox","Ringalert"];var i=function(e,t){t.bind("click",function(){})};return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/media-search.html"}}e.module("ringid.media").directive("rgMediaSearch",t),t.$inject=["$document","Media","$routeParams"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t){function n(e,t,n,r,i,o,a){function s(e){var t;switch(e.actn){case c.ACTION_MEDIA_SEARCH_RESULT:if(e.sucs===!0)for(n.showDropdown=!0,t=0;t<e.sgstn.length;t++)n.searchResult.push(e.sgstn[t]);else n.stoploader=!0;o.recalculate(n)}n.$rgDigest()}var c=t.SYSTEM.MEDIA;n.showDropdown=!1,n.stoploader=!1,n.showTrending=!1,n.searchResult=[],n.trendingArr=[],n.doSearch=function(){n.searchResult=[],n.stoploader=!1,n.searchParam?(n.showTrending=!1,r.fetchSearchResult(n.searchParam).then(s),n.showDropdown=!0):(n.showDropdown=!1,n.showTrending=!0)},n.doContentSearch=function(t){var r;switch(n.showDropdown=!1,t.sugt){case 1:r="/media/songs/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 2:r="/media/albums/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 3:r="/media/tags/"+t.sk,i.path(encodeURI(r)),e.$rgDigest()}},n.fetchTrendingKeyword=function(){return n.showDropdown=!0,n.trendingArr.length>0?(n.showTrending=!0,void n.$rgDigest()):void r.getSearchTrends().then(function(e){if(e.sucs===!0){for(var t=0;t<e.sgstn.length;t++){switch(console.log(e.sgstn[t]),e.sgstn[t].sugt){case 1:e.sgstn[t].searchtype="songs";break;case 2:e.sgstn[t].searchtype="albums";break;case 3:e.sgstn[t].searchtype="tags"}n.trendingArr.push(e.sgstn[t])}n.showTrending=!0}n.$rgDigest()})},n.hideDropdown=function(){n.showDropdown=!1,n.showTrending=!1,n.searchParam="",n.searchResult=[]},n.$on("$destroy",function(){n.trendingArr=[],n.searchResult=[]})}n.$inject=["$rootScope","OPERATION_TYPES","$scope","Media","$location","rgScrollbarService","GlobalEvents"];var r=function(e,t){t.bind("click",function(){});var n=t.find("input");e.activeId=0,e.setActiveId=function(t){e.activeId=t},n.on("keydown",function(t){13===t.keyCode&&e.searchParam&&e.doContentSearch({sk:e.searchParam,sugt:1})}),t.on("keydown",function(t){if(13===t.keyCode){if(e.searchResult.length){var n=e.searchResult[e.activeId];e.doContentSearch({sk:n.sk,sugt:n.sugt})}}else 38===t.keyCode?(e.activeId=Math.max(e.activeId-1,0),e.$rgDigest()):40===t.keyCode&&(e.activeId=Math.min(e.activeId+1,e.searchResult.length-1),e.$rgDigest())})};return{restrict:"E",controller:n,link:r,templateUrl:"templates/mediasearch/media-search-directive.html"}}e.module("ringid.media").directive("rgMediaSearchDirective",t),t.$inject=["$document","Media"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n){function r(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()==e}}r.$inject=["$scope","$location"];var i=function(e,t){};return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/media.tabnav.dir.html"}}e.module("ringid.media").directive("rgTabNav",t),t.$inject=["$routeParams"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n){function r(e,t,r,i,o){e.sliderImages=i.createNew();var a,s;t.fetchSliderImage({mdaT:1}).then(function(t){if(t.sucs===!0)for(var i=0;i<t.mediaAlbumList.length;i++)a=r.createAlbum(t.mediaAlbumList[i]),e.sliderImages.save(a.getKey(),a);e.$broadcast(n.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()}),t.fetchSliderImage({mdaT:2}).then(function(t){if(t.sucs===!0)for(var i=0;i<t.mediaAlbumList.length;i++)s=r.createAlbum(t.mediaAlbumList[i]),e.sliderImages.save(s.getKey(),s);e.$broadcast(n.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()},function(e){},function(e){}),e.setAlbumName=function(e){var t=[];t.push(e.name),t.push(e.count),o.setData("albumname",t)},e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}r.$inject=["$scope","Media","$$mediaAlbumMap","$$stackedMap","Storage"];var i=function(e,t,r){e.showLeftArrow=!1,e.showRightArrow=!0;var i,o=t[0].querySelector(".media-slider"),a=t[0].querySelector(".photobanner"),s=1,c=!0,l=0,u=o.clientWidth;e.imageWidth=u/2,e.$rgDigest(),e.$on(n.COMMON.WINDOW_RESIZED,function(t){i&&clearTimeout(i),i=setTimeout(function(){l=1,a.style.display="none",e.$parent.$rgDigest(),c=!0,u=o.clientWidth,e.imageWidth=u/2,a.style.width=e.sliderImages.length()*e.imageWidth+"px",a.style.marginLeft="-"+(s-l)*e.imageWidth+"px",a.style.display="",e.$parent.$rgDigest()},500)}),e.$on(n.MEDIA.SLIDER_IMAGE_LOADED,function(t,n){a.style.display="none",e.$parent.$rgDigest(),a.style.width=e.sliderImages.length()*e.imageWidth+"px",a.style.display="",e.$parent.$rgDigest()}),e.right=function(){c&&(a.style.width=e.sliderImages.length()*e.imageWidth+"px",c=!1),a.style.marginLeft="-"+s*e.imageWidth+"px",s++,l=0,s>1&&(e.showLeftArrow=!0),s===e.sliderImages.length()-1&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){s--,l=0,1===s&&(e.showLeftArrow=!1),s<e.sliderImages.length()-1&&(e.showRightArrow=!0),a.style.marginLeft="-"+(s-1)*e.imageWidth+"px",e.$parent.$rgDigest()}};return{restrict:"E",controller:r,link:i,templateUrl:"templates/mediasearch/media-slider-directive.html"}}e.module("ringid.media").directive("rgMediaSlider",t),t.$inject=["$document","Media","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c,l,u,d){function g(e){switch(console.log(e),s.loadMoreSongs=!1,s.loadMoreAlbums=!1,e.actn){case E.ACTION_SPECIFIC_MEDIA_RESULT:s.noresultfound=!1;var t;if(e.sucs===!0){10===e.tr?t=e.mdaLst.length-1:(t=e.mdaLst.length,s.noresultfound=!0);for(var n=0;t>n;n++)1===e.mdaLst[n].sugt&&(p.push(e.mdaLst[n].cntntId),e.mdaLst[n].viewtime=(new Date).getTime(),I=a(e.mdaLst[n]),h.save(I.getKey(),I)),2===e.mdaLst[n].sugt&&(T.push(e.mdaLst[n].albId),I=i.createAlbum(e.mdaLst[n]),_.save(I.getKey(),I)),3===e.mdaLst[n].sugt&&(console.log(e.mdaLst[n]),s.searchedTagArr.push(e.mdaLst[n]))}else s.noresultfound=!0;break;case E.ACTION_GET_TAGGED_MEDIA_SONGS:if(s.noresultfound=!1,e.sucs===!0)for(n=0;n<e.mdaLst.length;n++)console.log(e.mdaLst[n]),I=a(e.mdaLst[n]),h.save(I.getKey(),I);else s.noresultfound=!0}s.$rgDigest()}var m=[];t.setData("albumname",m),s.stype=r.stype,s.searchkey=decodeURI(r.sk);var f,E=d.SYSTEM.MEDIA;s.loadMoreSongs=!1,s.loadMoreAlbums=!1,s.showSearchTitle=!0;var p=[],T=[];s.searchedTagArr=[];var h=o.createNew(),_=o.createNew();switch(s.searchedSongs=function(){return h},s.searchedAlbums=function(){return _},r.stype){case"songs":f=1;break;case"albums":f=2;break;case"tags":f=3;break;default:f=1}s.showSearchDropdown=!1;e.currentUser();if(s.searchsongsection=!1,s.searchalbumsection=!1,s.searchtagsection=!1,s.noresultsection=!1,"tag"!==s.stype){var I={sk:s.searchkey,sugt:f};c.fetchContent(I)}switch(s.stype){case"songs":s.searchsongsection=!0;break;case"albums":s.searchalbumsection=!0;break;case"tags":s.searchtagsection=!0;break;case"tag":s.searchsongsection=!0,s.showSearchTitle=!1,isNaN(s.searchkey)||c.getTaggedMedia(parseInt(s.searchkey))}s.searchedTags=c.getSearchedTagArr(),s.cntntidarray=c.getContentIdArray,s.albumidarray=c.getAlbumIdArray,s.noresultfound=!1,s.loadMoreSuggestedSongs=function(){s.loadMoreSongs=!0;var e={sk:s.searchkey,sugt:f,pvtid:p.pop(),scl:2};c.fetchContent(e),c.resetContentIdArray(),s.$rgDigest()},s.loadMoreSuggestedAlbums=function(){s.loadMoreAlbums=!0;var e={sk:s.searchkey,sugt:f,pvtid:T.pop(),scl:2};c.fetchContent(e),c.resetAlbumIdArray(),s.$rgDigest()},s.getTaggedMedia=function(e){var t="media/tag/"+e.htid;l.path(encodeURI(t))},s.goToAlbum=function(e){var n;switch(m.push(e.name),m.push(e.mc),t.setData("albumname",m),e.type){case"audio":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;case"video":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;default:n="media",l.path(n)}},s.getMediaData=function(e){return{data:function(){return{media:e,playlist:[{key:e.getKey(),value:e}]}},promise:e.fetchDetails()}};var A=u.subscribe(g,{action:[E.ACTION_SPECIFIC_MEDIA_RESULT,E.ACTION_GET_TAGGED_MEDIA_SONGS]});s.$on("$destroy",function(){u.unsubscribe(A),h.reset(),_.reset()})}e.module("ringid.media").controller("mSearchResultController",t),t.$inject=["Auth","Storage","userFactory","$routeParams","$$mediaAlbumMap","$$stackedMap","$$mediaMap","$scope","Media","$location","$$connector","OPERATION_TYPES"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c,l,u,d,g){function m(e,t){t?c.selectedPlaylist.add(e.getKey(),e):c.selectedPlaylist.remove(e.getKey())}function f(e,t){var n;return n=e?c.songs.all():c.selectedPlaylist.all(),t=t||n[0].value,{data:function(){return{media:t,playlist:n}},promise:t.fetchDetails()}}function E(e){var r;switch(e.actn){case p.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(e.sucs===!0){for(r=0;r<e.mdaCntntLst.length;r++){e.mdaCntntLst[r].utId=c.utid;var i=t(e.mdaCntntLst[r]);c.songs.save(i.getKey(),i)}c.loadMoreSong=!1}else c.loadMoreSong=!1,c.stoploader=!0;break;case p.ACTION_MEDIA_ALBUM_LIST:if(e.sucs===!0){for(r=0;r<e.mediaAlbumList.length;r++)if(e.mediaAlbumList[r].mdaT===T){var o=n.createAlbum(e.mediaAlbumList[r]);c.myAlbumsMap.save(o.getKey(),o)}}else c.stoploader=!0}c.$rgDigest()}c.albumName=r.getData("albumname")[0],c.mediaCount=r.getData("albumname")[1],c.albumtype=a.albumtype,c.utid=a.utid,c.albumid=a.albumid,c.songsArray=[],c.songs=e.createNew(),c.selectedPlaylist=e.createNew(),c.myAlbumsMap=e.createNew();var p=s.SYSTEM.MEDIA;c.userallalbum=!1,c.showSearchDropdown=!1,c.stoploader=!1,c.loadMoreSong=!1;var T;if(!a.utid&&!a.albumid){var h=o.currentUser();c.utid=h.getUtId(),"audio"===a.albumtype?T=1:"video"===a.albumtype?T=2:u.path("media"),l.fetchAllAlbums(c.utid,c.albumtype),c.userallalbum=!0}isNaN(c.utid)&&isNaN(c.albumid)&&u.path("media"),c.goToAlbum=function(e){var t,n=[];switch(n.push(e.name),n.push(e.mc),r.setData("albumname",n),e.type){case"audio":t="media/"+e.type+"/"+e.utid+"/"+e.albumid,u.path(t);break;case"video":t="media/"+e.type+"/"+e.utid+"/"+e.albumid,u.path(t);break;default:t="media",u.path(t)}},c.loadMoreMedia=function(e){c.loadMoreSong=!0,l.fetchAlbumContents({albId:c.albumid,utId:c.utid,st:e})},c.utid&&c.albumid&&(l.fetchAlbumContents({albId:c.albumid,utId:c.utid}),c.albumMap=n.createAlbum({albn:c.albumName,albId:c.albumid,utId:c.utid})),c.selectMedia=m,c.getMediaData=f,c.$on("$destroy",function(){d.unsubscribe(_)});var _=d.subscribe(E,{action:[p.ACTION_MEDIA_ALBUM_CONTENT_LIST,p.ACTION_MEDIA_ALBUM_LIST]})}e.module("ringid.media").controller("allAlbumTypeController",t),t.$inject=["$$stackedMap","$$mediaMap","$$mediaAlbumMap","Storage","userFactory","Auth","$routeParams","OPERATION_TYPES","$scope","Media","$location","$$connector","Ringalert"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n){function r(r){r&&r.sucs===!0&&(t.path(n.MEDIA_FEEDS),e.$rgDigest())}e.setFeed=r}e.module("ringid.media").controller("MediaPostController",n),n.$inject=["$scope","$location","RING_ROUTES"]}(angular,window),function(e,t){"use strict";e.module("ringid.newsportal",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),function(e,t){"use strict";!function(){
function t(e,t,n,r,i,o,a,s){e.portalFollowMap=n.createNew();var c,l;e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="pages/dropdowns/portal-follow-action-dropdown.html",i.getPortalFollowingList().then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.portalFollowMap.save(c.getKey(),c);l=e.portalFollowMap.length()}else e.isEmptyFollow=!0;e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:i.getPortalCatList(e.getKey())}},e.loadMoreFollowingPortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getPortalFollowingList(l).then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.portalFollowMap.save(c.getKey(),c);l=e.portalFollowMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.$rgDigest(),e.actionFollowingDropdown=function(t){switch(t.action){case"edit":a.close(t.event),e.$rgDigest();var n=o.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal.value},remoteData:function(){return i.getPortalCatList(t.data.portal.value.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":a.close(t.event),e.$rgDigest();var r=s.NEWSPORTAL.C_UNFOLLOW,n=o.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(n){n&&i.unFollowPortal(t.data.portal.value.getKey()).then(function(t){t.sucs===!0&&(e.portalFollowMap.remove(t.id),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()),e.$rgDigest()})})}},e.$on(t.PORTAL.UNFOLLOW_PORTAL,function(t,n){e.portalFollowMap.remove(n.id),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()}),e.$on("$destroy",function(){e.portalFollowMap.reset()})}e.module("ringid.newsportal").controller("portalFollowingController",t),t.$inject=["$scope","SystemEvents","$$stackedMap","$$newsPortalMap","portalHttpService","$ringbox","rgDropdownService","MESSAGES"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i){e.portalDiscoverMap=r.createNew(),e.searchResultMap=r.createNew();var o,a;e.searching=!1,e.nodata=!1,e.loadmore=!0,e.showloadmore=!1,e.selected=null,i.getPortalDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.portalDiscoverMap.save(o.getKey(),o);a=e.portalDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getDiscoverPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.getSearchPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.loadMorePortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getPortalDiscoverList(a).then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.portalDiscoverMap.save(o.getKey(),o);a=e.portalDiscoverMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.doSearch=function(){e.searchParam?(e.searching=!0,e.nodata=!1,e.searchResultMap.reset(),e.$rgDigest(),i.searchNewsPortal(e.searchParam).then(function(t){if(t.sucs===!0)for(var r=0;r<t.searchedcontaclist.length;r++)o=n.create(t.searchedcontaclist[r].npDTO),e.searchResultMap.save(o.getKey(),o);else e.nodata=!0;e.$rgDigest()})):(e.searching=!1,e.nodata=!1,e.$rgDigest())},e.$on(t.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r);var r=setTimeout(function(){e.searchResultMap.length()>0?(e.searchResultMap.remove(n.id),0==e.searchResultMap.length()&&(e.searchParam="",e.searching=!1,e.$rgDigest())):e.portalDiscoverMap.remove(n.id),e.selected=null,e.$rgDigest()},1e3);e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset(),e.searchResultMap.reset()})}e.module("ringid.newsportal").controller("portalDiscoverController",n),n.$inject=["$scope","SystemEvents","$$newsPortalMap","$$stackedMap","portalHttpService"]}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i){var o="newsportal_saved",a=r.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal_saved";e.pagekey=a,e.params={actn:r.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0,svd:!0},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}e.module("ringid.newsportal").controller("portalSaveController",t),t.$inject=["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory"]}()}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s){e.portalName=r.target.getFullName(),e.portalId=r.target.getKey();for(var c=[],l=[],u=[],d=[],g=0,m=0;m<n.nCatList.length;m++)c.push(n.nCatList[m]),d.push(n.nCatList[m].id),n.nCatList[m].subsc&&l.push(n.nCatList[m].id);if(n.nCatList.length==l.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=c,0==l.length){e.selectall=!0;for(var f=0;f<e.categoryList.length;f++)e.categoryList[f].subsc=e.selectall;l=d,e.$rgDigest()}e.selectPortalCat=function(e){var t=l.indexOf(e.id),n=u.indexOf(e.id);e.subsc?(-1!==n&&u.splice(n,1),-1===t&&l.push(e.id)):(-1!==t&&l.splice(t,1),-1===n&&u.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.portalId,l,u,g).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.PORTAL.DONE_FOLLOW_PORTAL,n),0===l.length&&t.$broadcast(a.PORTAL.UNFOLLOW_PORTAL,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){e.selectall?(g=2,l=d,u=[],e.$rgDigest()):(g=1,l=[],u=d,e.$rgDigest());for(var t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){c=[]})}e.module("ringid.newsportal").controller("portalFollowController",n),n.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","portalHttpService","SystemEvents","$ringbox"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i,o,a,s){e.portalName=r.target.getFullName(),e.portalId=r.target.getKey();for(var c=[],l=[],u=[],d=[],g=0,m=0;m<n.nCatList.length;m++)c.push(n.nCatList[m]),d.push(n.nCatList[m].id),n.nCatList[m].subsc&&l.push(n.nCatList[m].id);if(n.nCatList.length==l.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=c,0==l.length){e.selectall=!0;for(var f=0;f<e.categoryList.length;f++)e.categoryList[f].subsc=e.selectall;l=d,e.$rgDigest()}e.selectPortalCat=function(e){var t=l.indexOf(e.id),n=u.indexOf(e.id);e.subsc?(-1!==n&&u.splice(n,1),-1===t&&l.push(e.id)):(-1!==t&&l.splice(t,1),-1===n&&u.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.portalId,l,u,g).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.PORTAL.DONE_FOLLOW_PORTAL,n),0===l.length&&t.$broadcast(a.PORTAL.UNFOLLOW_PORTAL,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){e.selectall?(g=2,l=d,u=[],e.$rgDigest()):(g=1,l=[],u=d,e.$rgDigest());for(var t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){c=[]})}e.module("ringid.newsportal").controller("portalFollowController",n),n.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","portalHttpService","SystemEvents","$ringbox"]}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("PortalProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","portalHttpService","$$newsPortalMap","SystemEvents","$ringbox",function(e,t,n,r,i,o,a,s,c,l){var u,d,g=r.uid,m=g;u="newsportal",d=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="pages/dropdowns/portal-cover-follow-action-dropdown.html",m=d+"."+g+".3",e.pagekey=m,e.action=d,e.params={actn:d,fndId:g,pType:3},e.forAdd=u,e.sortBy="at",a.getPortalShortDetails(g).then(function(t){t.sucs===!0&&(t.userDetails.npDTO.utId=t.userDetails.utId,t.userDetails.npDTO.prIm=t.userDetails.prIm,e.portalMap=s.create(t.userDetails.npDTO)),e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:a.getPortalCatList(e.getKey())}},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.actionFollowingDropdown=function(t){switch(t.action){case"edit":i.close(t.event),e.$rgDigest();l.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal},remoteData:function(){return a.getPortalCatList(t.data.portal.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":i.close(t.event),e.$rgDigest(),a.unFollowPortal(t.data.portal.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.PORTAL.UNFOLLOW_PORTAL,t),e.portalMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.portalMap.setIfSubscribed(!0),e.$rgDigest()}),t("FeedMainController",{$scope:e})}])}(angular,window),function(e,t){"use strict";e.module("ringid.feed").controller("PortalFeedSubController",["$$feedMap","$scope","$controller","localData","$routeParams","feedFactory","Auth","SystemEvents","$location","$boxInstance",function(e,t,n,r,i,o,a,s,c,l){t.feed=r.target,console.log(t.feed),t.singleFeed=!0,t.ogData={},t.currentUser=a.currentUser(),t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.imageShowMoreLength=t.feed.getTotalImage()-1,t.showCommentBox=!0,n("FeedSubController",{$scope:t}),t.$rgDigest(),l.hideLoader()}])}(angular,window),function(e,t){"use strict";function n(){function e(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()==e}}e.$inject=["$scope","$location"];var t=function(e,t){};return{restrict:"E",controller:e,link:t,templateUrl:"pages/newsportal/portal.tabnav.directive.html"}}e.module("ringid.newsportal").directive("rgPortalTabNav",n),n.$inject=[]}(angular,window),function(e,t){"use strict";function n(e,t,n){function r(e,t,n,r,i,o,a){e.sliderImages=t.createNew(),e.showLeftArrow=!1,e.showRightArrow=!1;var s;i.getPortalDiscoverList().then(function(t){if(t.sucs===!0){for(var n=0;n<t.npList.length;n++)s=r.create(t.npList[n]),e.sliderImages.save(s.getKey(),s);e.showRightArrow=!0}e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:i.getPortalCatList(e.getKey())}},e.$on(o.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){var r=e.sliderImages.get(n.id);r&&r.setIfSubscribed(!0),e.$rgDigest()}),e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}r.$inject=["$scope","$$stackedMap","Storage","$$newsPortalMap","portalHttpService","SystemEvents","Utils"];var i=function(e,r,i){function o(){var t=s.clientWidth;n.viewport.x>=1600&&(e.imageWidth=t/4,e.$parent.$rgDigest()),n.viewport.x>=1270&&n.viewport.x<1600&&(e.imageWidth=t/3,e.$parent.$rgDigest()),n.viewport.x>980&&n.viewport.x<1270&&(e.imageWidth=t/2,e.$parent.$rgDigest())}var a,s=r[0].querySelector(".news_banner_wrap"),c=r[0].querySelector(".news_banner_con"),l=1,u=!0,d=0;o(),e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(t){a&&clearTimeout(a),a=setTimeout(function(){d=1,c.style.display="none",e.$parent.$rgDigest(),u=!0,o(),c.style.width=e.sliderImages.length()*e.imageWidth+"px",c.style.marginLeft="-"+((l-d)*e.imageWidth+5*l)+"px",c.style.display="",e.$parent.$rgDigest()},500)}),e.$on(t.MEDIA.SLIDER_IMAGE_LOADED,function(t,n){c.style.display="none",e.$parent.$rgDigest(),c.style.width=e.sliderImages.length()*e.imageWidth+"px",c.style.display="",e.$parent.$rgDigest()}),e.right=function(){u&&(c.style.width=e.sliderImages.length()*e.imageWidth+"px",u=!1),c.style.marginLeft="-"+(l*e.imageWidth+5*l)+"px",l++,d=0,l>1&&(e.showLeftArrow=!0),l===e.sliderImages.length()-4&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){l--,d=0,1===l&&(e.showLeftArrow=!1),l<e.sliderImages.length()-1&&(e.showRightArrow=!0),c.style.marginLeft="-"+((l-1)*e.imageWidth+5*l)+"px",e.$parent.$rgDigest()}};return{restrict:"E",controller:r,link:i,templateUrl:"pages/newsportal/portal-slider-directive.html"}}e.module("ringid.newsportal").directive("rgPortalSlider",n),n.$inject=["$document","SystemEvents","Utils"]}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n,r,i,o,a){e.portalDiscoverMap=t.createNew();var s,c;e.nodata=!1,e.selected=null,e.params={actn:a.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},r.getPortalDiscoverList().then(function(t){if(t.sucs===!0){for(var r=0;r<t.npList.length;r++)s=n.create(t.npList[r]),e.portalDiscoverMap.save(s.getKey(),s);c=e.portalDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:r.getPortalCatList(e.getKey())}},e.$on(i.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r);var r=setTimeout(function(){e.portalDiscoverMap.remove(n.id),e.selected=null,o.initFeedRequest(e.params),e.$rgDigest()},1e3);e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset()})}e.$inject=["$scope","$$stackedMap","$$newsPortalMap","portalHttpService","SystemEvents","feedFactory","OPERATION_TYPES"];var t=function(e,t){};return{restrict:"E",controller:e,link:t,templateUrl:"pages/newsportal/discover.portal.directive.html"}}e.module("ringid.newsportal").directive("rgDiscoverPortal",n),n.$inject=[]}(angular,window),function(e,t){"use strict";e.module("ringid.profile",["ringid.config","ringid.digits","ringid.global_services","ringid.auth","ringid.media","ui.bootstrap","angular-svg-round-progress"])}(angular,window),function(e,t){"use strict";function n(t,n,r){var i=this,o=n.SYSTEM.PROFILE,a=n.SYSTEM.REQUEST_TYPE;i.basicAndPrivacy=function(e,n){var r;return r=n?{actn:o.TYPE_ACTION_CURRENT_USER_BASICINFO}:{actn:o.TYPE_ACTION_OTHER_USER_BASICINFO,utId:e},t.request(r,a.REQUEST)},i.getUserDetails=function(n,r){var i={actn:o.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!r};return e.extend(i,n),t.request(i,a.REQUEST,!0)},i.fetchPresenceAndMood=function(e){var n={actn:o.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:e};return t.request(n,a.REQUEST)},i.changeMood=function(e){var n={actn:o.TYPE_ACTION_USER_MOOD,mood:e};return t.request(n,a.AUTHENTICATION)},i.getMutualFriends=function(e){var n={actn:o.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:e};return t.request(n,a.REQUEST)},i.getUserProfileData=function(e){var n;return n=e?{actn:o.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS,utId:e}:{actn:o.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS},t.send(n,a.REQUEST)},i.updateProfile=function(e,n,r,i){1!==i&&(i=i.getTime());var s={actn:o.TYPE_ACTION_MODIFY_USER_PROFILE,nOfHd:7,fn:n.fn.utf8Encode(),hc:n.hc?n.hc.utf8Encode():" ",cc:n.cc?n.cc.utf8Encode():" ",gr:n.gr,am:n.am.utf8Encode(),bDay:r?r.getTime():1,mDay:i};return t.request(s,a.UPDATE)},i.updateProfilePrivacy=function(){var e={actn:o.TYPE_ACTION_MODIFY_PRIVACY_SETTINGS,pvc:[3,3,3,3,3]};return t.request(e,a.UPDATE)},i.submitNewEducation=function(e){var n={actn:o.TYPE_ACTION_ADD_EDUCATION,request_type:a.UPDATE,edu:{af:1,cntn:e.cntn?e.cntn.utf8Encode():"",desc:e.desc?e.desc.utf8Encode():"",dgr:e.dgr?e.dgr.utf8Encode():"",grtd:e.grtd,iss:e.iss,scl:e.scl.utf8Encode(),ft:e.ft?e.ft:1,tt:e.tt?e.tt:1,ut:0}};return t.request(n,a.UPDATE)},i.deleteEducation=function(e){var n={actn:o.TYPE_ACTION_REMOVE_EDUCATION,id:e};return t.request(n,a.UPDATE)},i.updateEducationById=function(e){var n={actn:o.TYPE_ACTION_UPDATE_EDUCATION,edu:{id:e.id,scl:e.scl.utf8Encode(),ft:e.ft?e.ft:1,tt:e.tt?e.tt:1,desc:e.desc?e.desc.utf8Encode():"",af:e.af,grtd:e.grtd,iss:e.iss,cntn:e.cntn?e.cntn.utf8Encode():"",dgr:e.dgr?e.dgr.utf8Encode():""}};return t.request(n,a.UPDATE)},i.getAllSkill=function(){var e={actn:230};return t.request(e,a.REQUEST)},i.submitNewSkill=function(e){var n={actn:o.TYPE_ACTION_ADD_SKILL,skill:{skl:e.skl.utf8Encode(),desc:e.desc.utf8Encode()}};return t.request(n,a.UPDATE)},i.updateSkill=function(e){var n={actn:o.TYPE_ACTION_UPDATE_SKILL,skill:{id:e.id,skl:e.skl.utf8Encode(),desc:e.desc.utf8Encode()}};return t.request(n,a.UPDATE)},i.deleteSkill=function(e){var n={actn:o.TYPE_ACTION_REMOVE_SKILL,id:e};return t.request(n,a.UPDATE)},i.submitNewWork=function(e){var n={actn:o.TYPE_ACTION_ADD_WORK,request_type:a.UPDATE,wrk:{pstn:e.pstn?e.pstn.utf8Encode():"",desc:e.desc?e.desc.utf8Encode():"",cnm:e.cnm.utf8Encode(),tt:e.tt||1,ft:e.ft||1}};return t.request(n,a.UPDATE)},i.updateWork=function(e){var n={actn:o.TYPE_ACTION_UPDATE_WORK,wrk:{id:e.id,pstn:e.pstn.utf8Encode(),cnm:e.cnm.utf8Encode(),desc:e.desc.utf8Encode(),tt:e.tt||1,ft:e.ft||1}};return t.request(n,a.UPDATE)},i.deleteWork=function(e){var n={actn:o.TYPE_ACTION_REMOVE_WORK,id:e};return t.request(n,a.UPDATE)},i.changeProfilePicture=function(e){var n={actn:o.TYPE_CHANGE_PROFILE_PIC,type:1,imT:2,pimX:e.pimX,pimY:e.pimY,ih:e.ih,iw:e.iw,iurl:e.iurl};return t.request(n,a.UPDATE)},i.changeCoverPicture=function(e){var n={actn:o.TYPE_CHANGE_COVER_PIC,type:1,imT:3,cimX:e.cimX,cimY:e.cimY,ih:e.ih,iw:e.iw,iurl:e.iurl};return t.request(n,a.UPDATE)},i.changePassword=function(e,n){var r={actn:o.CHANGE_PASSWORD,oPw:e,nPw:n};return t.request(r,a.UPDATE)},i.sendCode=function(e){var n={actn:o.SEND_VERIFICATION_CODE_TO_MAIL,el:e.email};return t.request(n,a.REQUEST)},i.verifyCode=function(e){var n={actn:o.SEND_VERIFICATION_CODE_TO_MAIL,el:e.email,vc:e.code};return t.request(n,a.REQUEST)},i.changePrivacy=function(e){var n={actn:e.utId,sn:e.sn,sv:e.sv};return e.hasOwnProperty("utId")&&(n.utId=e.utId),t.request(n,a.UPDATE,!0)},i.saveCallPvcEdit=function(e){var n={actn:e.actn,sn:e.sn,sv:e.sv};return e.isCurrent||(n.utId=e.utId),t.request(n,a.UPDATE,!0)},i.saveChatPvcEdit=function(e){var n={actn:e.actn,sn:e.sn,sv:e.sv};return e.isCurrent||(n.utId=e.utId),t.request(n,a.UPDATE,!0)},i.saveFeedPvcEdit=function(e){var n={actn:e.actn,sn:e.sn,sv:e.sv};return e.isCurrent||(n.utId=e.utId),t.request(n,a.UPDATE,!0)},i.addSocialAccount=function(e){var n={actn:o.ADD_SOCIAL_NETWORK,it:e.access_token,smid:e.id,wk:r.getUniqueID()};return"facebook"===e.platform?n.smt=4:"twitter"===e.platform&&(n.smt=5),t.request(n,a.AUTHENTICATION)},i.saveAchatSetting=function(e){var n={actn:o.TYPE_CHANGE_PRIVACY,sn:e.sn,sv:e.sv};return t.request(n,a.UPDATE)},i.saveAinfndreqSettings=function(e){var n={actn:o.TYPE_CHANGE_PRIVACY,sn:e.sn,sv:e.sv};return t.request(n,a.UPDATE)},i.saveAfamSettings=function(e){var n={actn:o.TYPE_CHANGE_PRIVACY,sn:e.sn,sv:e.sv};return t.request(n,a.UPDATE)},i.saveAafSetting=function(e){var n={actn:o.TYPE_CHANGE_PRIVACY,sn:e.sn,sv:e.sv};return t.request(n,a.UPDATE)}}e.module("ringid.profile").service("profileHttpService",n),n.$inject=["$$connector","OPERATION_TYPES","Utils"]}(angular,window),function(e,t){"use strict";function n(e,t,n,r,i){function o(e,n){function o(e){T=n[0].clientWidth;var t=Math.ceil(r.COVER_PIC_CROP_HEIGHT*T/r.COVER_PIC_CROP_WIDTH);n[0].style.height=t+"px",h=t}function s(t){t||e.enabled?(n.bind("mousedown",c),n.bind("mouseup",u)):(n.unbind("mousedown",c),n.unbind("mouseup",u)),e.$rgDigest()}function c(t){e.enabled&&(1===t.which&&(E=t.clientX,p=t.clientY,C=!0),n.bind("mousemove",l))}function l(t){var r,i,o;e.enabled&&C&&(r=e.elemStyle.backgroundPosition.match(/(-?\d+).*?\s(-?\d+)/)||[],i=t.clientX,o=t.clientY,m=parseInt(r[1])||0,f=parseInt(r[2])||0,m=a(T-N.width,0,m+i-E,D.bound),f=a(h-N.height,0,f+o-p,D.bound),RingLogger.information("xPos: "+m," yPos:"+f,RingLogger.tags.UPLOAD),n.css({backgroundPosition:m+"px "+f+"px"}))}function u(r){e.enabled&&C&&(void 0!==m&&void 0!==f&&(e.elemStyle.backgroundPosition=m+"px "+f+"px",console.log("%c: yPos: "+f+" xpos: "+m,"color:red"),console.log("%c: REPOSITION SCALE: "+S,"color:red"),t.setReposition({cimX:Math.ceil(Math.abs(m)/S)||0,cimY:Math.ceil(Math.abs(f)/S)||0},e.imgType)),C=!1,m=void 0,f=void 0,n.unbind("mousemove",l))}function d(){e.toggleResizeShow()(e.imgType,!1);var n=this;N.width=n.width,N.height=n.height,N.width/_<=N.height/I?(S=T/N.width,N.width=T,N.height=Math.floor(N.height*S),A=n.width/_,t.setReposition({iw:Math.ceil(n.width),ih:Math.ceil(I*A)},e.imgType)):(S=h/N.height,N.height=h,N.width=Math.floor(N.width*S),A=n.height/I,t.setReposition({ih:Math.ceil(n.height),iw:Math.ceil(_*A)},e.imgType)),s(!0),console.log("repositionScale: "+S),console.log("elementW: "+T+" elementH: "+h),console.log("cropMinW: "+_+" cropMinH: "+I),console.log("imageW: "+N.width+" imageH: "+N.height)}function g(){"coverphoto"===e.imgType&&i.unbindHandler("window","resize",o),e.enabled&&(n.unbind("mousedown",c),n.unbind("mouseup",u))}var m,f,E,p,T=n[0].clientWidth,h=n[0].clientHeight,_="profilephoto"===e.imgType?r.PROFILE_PIC_CROP_WIDTH:r.COVER_PIC_CROP_WIDTH,I="profilephoto"===e.imgType?r.PROFILE_PIC_CROP_WIDTH:r.COVER_PIC_CROP_HEIGHT,A=1,v="",S=1,C=!1,D={bound:!0},N={width:0,height:0};e.selectFromAlbum=t.selectFromAlbum,"coverphoto"===e.imgType&&(o(!0),i.bindHandler("window","resize",o)),e.$watch("enabled",function(e,t){e?M():s(!1)});var M=function(){var t=e.elemStyle.backgroundImage;if(v=(t.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1]){var n=new Image;n.onload=d,n.src=v}};e.$on("$destroy",g)}var a=function(e,t,n,r){if(3===arguments.length||r){if(e>n)return e;if(n>t)return t}return n};return{restrict:"A",replace:!1,scope:{elemStyle:"=",enabled:"=",imgType:"@",toggleResizeShow:"&"},link:o}}e.module("ringid.profile").directive("rgImgReposition",n),n.$inject=["imageQuality","fileUploadService","$document","APP_CONSTANTS","GlobalEvents"]}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T){function h(){D||setTimeout(function(){t.$rgDigest(),D=!1})}function _(){T.bindHandler("window","resize",h)}function I(){T.unbindHandler("window","resize",h),"about"===o.subPage&&s.removeProfileData(t.profileObj.getUtId())}t.viewport=g.viewport;var A,v,S=o.uId;t.isOwner=a.currentUser().getKey()===S,t.consType=f.get(),t.profilePicDragEnable=!1,t.coverPicDragEnable=!1,t.processing=!1,t.profileDdControl={showOnHover:!0,enableCoverReposition:!0,enableProfileReposition:!0},t.showCoverDD=!1,t.coverPhotoStyle={backgroundSize:"cover"},t.profilePhotoStyle={backgroundSize:"cover"},t.link=g.getRingRoute("USER_PROFILE",{uId:S}),t.profileObj=s.getProfile(S),t.profileObj&&(RingLogger.print("Page title from profile change",RingLogger.tags.PAGETITLE),g.setPageTitle(t.profileObj.getName(),!0)),void 0===o.subpage?t.subPage="post":(t.subPage=o.subpage,"about"===t.subPage&&(t.activeNav="basic")),t.subPageLink="templates/profile/profile."+t.subPage+".html",s.init(t.profileObj).then(function(){C("coverphoto"),C("profilephoto")});var C=function(e){"profilephoto"===e?(t.profilePhotoStyle.backgroundImage="url("+t.profileObj.avatar("thumb")+")",t.profilePhotoStyle.backgroundPosition="50% 50%",t.profilePhotoStyle.backgroundImage.indexOf("prof.png")>-1?t.profileDdControl.enableProfileReposition=!1:t.profileDdControl.enableProfileReposition=!0):(t.coverPhotoStyle.backgroundImage="url("+t.profileObj.getCover()+")",t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage.indexOf("default_cover")>-1?t.profileDdControl.enableCoverReposition=!1:t.profileDdControl.enableCoverReposition=!0),t.$rgDigest()};C("coverphoto"),C("profilephoto"),t.frndAction=function(e){p.close(e.event),e.friend.isLoading()||(i.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())},t.repositionExisting=!1,t.coverDdHtml="templates/dropdowns/coverphoto-dropdown.html",t.coverDdAction=function(e){switch(p.close(e.event),e.action){case"coverphoto":t.repositionExisting=!1,t.toggleResizeShow("coverphoto",!0),t.uploadAction(e);break;case"toggleReposition":t.repositionExisting=!0,t.toggleResizeShow("coverphoto",!0),t.uploadAction({action:"coverphoto",uploadFile:c.queueFile("coverphoto",t.profileObj.getCover("original"))});break;case"popupData":return c.uploadType="coverphoto",function(){return{popupType:"coverphoto"}};default:console.warn("Cover Photo Dropdown Action did not Match")}t.$rgDigest()},t.profileDdHtml="templates/dropdowns/profilephoto-dropdown.html",t.frndActionTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==0 && !ddControl.isCurrentUser()" rg-click="ddAction()({ action: \'addfriend\', friend: ddControl, event:$event})" href="#"><span class="icon-addf pro-f"></span><span class="txt">{{consType.add_friend}}</span></a><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event:$event})" href="#"> <span class="img_sprite w-h-13 icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.friendshipStatus()==2" rg-click="ddAction()({ action: \'accept\', friend: ddControl, event:$event})" href="#"><span class="icon-incoming pro-f"></span><span class="txt">{{consType.accept}}</span></a><a  ng-if="ddControl.friendshipStatus()==3" rg-click="ddAction()({ action: \'remove\', friend: ddControl, event:$event})" href="#"><span class="friend-ico cancel-req"></span><span class="txt">Cancel Request</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" href="#"><span class="img_sprite w-h-13 icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" href="#"><span class="img_sprite w-h-13 icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a><a  ng-if="!ddControl.isCurrentUser()" rg-report spam-type="user" spam-id="ddControl.getKey()"><span class="report-ico"></span><span>Report</span></a></div>',t.profileDdAction=function(e){switch(p.close(e.event),e.action){case"profilephoto":t.repositionExisting=!1,t.toggleResizeShow("profilephoto",!0),t.uploadAction(e);break;case"toggleReposition":t.toggleResizeShow("profilephoto",!0),t.repositionExisting=!0,t.uploadAction({action:"profilephoto",uploadFile:c.queueFile("profilephoto",t.profileObj.avatar("original"))});break;case"popupData":return c.uploadType="profilephoto",function(){return{popupType:"profilephoto"}};default:console.warn("Cover Photo Dropdown Action did not Match")}t.$rgDigest()},t.toggleResizeShow=function(e,n){"coverphoto"===e?t.cvResizeProgressShow=n||!1:t.ppResizeProgressShow=n||!1,t.$rgDigest()},t.$on(d.IMAGE.DO_REPOSITION,function(n,r){t.toggleResizeShow(c.uploadType,!0),t.uploadAction({action:c.uploadType,uploadFile:c.queueFile(c.uploadType,r.image)}),e.closeAll()}),t.uploadAction=function(e){var n;"coverphoto"===e.action?(A=e.uploadFile,n=A):(v=e.uploadFile,n=v),n&&(E.$broadcast(d.LOADING,!0),n.fetchMeta(function(r){E.$broadcast(d.LOADING,!1),r.success?"coverphoto"===e.action?t.toggleCoverPhotoReposition(n.getPreview()):t.toggleProfilePhotoReposition(n.getPreview()):(t.toggleResizeShow(e.action,!1),m.show(r.message,"error")),t.$rgDigest()})),t.$rgDigest()},t.uploadPicture=function(e,n){var r;"coverphoto"===e?(t.cvUploadProgressShow=!0,t.coverPicDragEnable=!1,r=A):"profilephoto"===e&&(t.ppUploadProgressShow=!0,t.profilePicDragEnable=!1,r=v),E.$broadcast(d.LOADING,!0),r.initUpload().then(function(n){t.cvUploadProgressShow=!1,t.ppUploadProgressShow=!1,n.sucs===!0?"profilephoto"===e?s.changeProfilePicture(n).then(function(){E.$broadcast(d.LOADING,!1),E.$rgDigest(),C(e)}):"coverphoto"===e&&s.changeCoverPicture(n).then(function(){E.$broadcast(d.LOADING,!1),E.$rgDigest(),C(e)}):(C(e),E.$broadcast(d.LOADING,!1))},function(t){C(e)}),n&&n.stopPropagation(),t.$rgDigest()},t.toggleCoverPhotoReposition=function(e,n){var r,i="",o=t.profileObj.getCoverXY();t.coverPicDragEnable?(t.coverPicDragEnable=!1,C("coverphoto")):(e?i=e:(e=t.profileObj.getCover(),r=e.slice(e.lastIndexOf("/")+1,e.length),i=e.replace(r,r.replace("crp",""))),t.repositionExisting?t.coverPhotoStyle.backgroundPosition=-o.x+"px "+-o.y+"px":t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage="url("+i+")",t.coverPicDragEnable=!0,t.$rgDigest()),n&&n.stopPropagation()},t.$watch("profilePicDragEnable",function(e){e||t.ppUploadProgressShow||C("profilephoto")}),t.$watch("coverPicDragEnable",function(e){e||t.cvUploadProgressShow||C("coverphoto")}),t.toggleProfilePhotoReposition=function(e,n){var r,i,o="",a=t.profileObj.getAvatarXY();t.profilePicDragEnable?(t.profilePicDragEnable=!1,C("profilephoto")):(e?o=e:(e=t.profileObj.avatar("original"),r=e.slice(e.lastIndexOf("/")+1,e.length),o=e.replace(r,r.replace(i,""))),t.repositionExisting?t.profilePhotoStyle.backgroundPosition=-a.x+"px "+-a.y+"px":t.profilePhotoStyle.backgroundPosition="0px 0px",t.profilePhotoStyle.backgroundImage="url("+o+")",t.profilePicDragEnable=!0,t.$rgDigest()),n&&n.stopPropagation()},t.getImageData=function(e){return{data:function(){return{imgId:e}},promise:u.getImageDetails(e)}},t.cvUploadProgressShow=!1,t.cvResizeProgressShow=!1,t.ppResizeProgressShow=!1,t.uploadStyle=function(){return{width:c.progress+"%"}},t.roundProgressBarStyle={dataRoundProgressWidth:"200",dataRoundProgressHeight:"200",dataRoundProgressOuterCircleWidth:"4",dataRoundProgressInnerCircleWidth:"8",dataRoundProgressOuterCircleRadius:"85",dataRoundProgressInnerCircleRadius:"85",dataRoundProgressLabelFont:"24",dataRoundProgressOuterCircleBackgroundColor:"#fff",dataRoundProgressOuterCircleForegroundColor:"#f47727",dataRoundProgressInnerCircleColor:"#fff",dataRoundProgressLabelColor:"#fff"},t.ppUploadProgressShow=!1,t.uploadImageFileSize=function(){return c.currentUploadImageSize},t.getRoundedProgressTextStyle=function(){return{top:"50%",bottom:"auto",left:"50%",transform:"translateY(-50%) translateX(-50%)","font-size":100/3.5+"px",position:"absolute"}},t.roundProgressData=function(){return{label:c.progress+"%",percentage:c.progress,dataLoaded:c.dataLoaded}},t.openRingbox=function(e){return"cover"===e?!t.coverPicDragEnable&&!t.cvResizeProgressShow&&!t.cvUploadProgressShow&&t.profileDdControl.enableCoverReposition:!t.profilePicDragEnable&&!t.ppResizeProgressShow&&!t.ppUploadProgressShow&&t.profileDdControl.enableProfileReposition},t.$on(d.FILE_UPLOAD.PROGRESS_UPDATE,function(){t.$rgDigest()}),t.showMenuItems=!1,t.toggleMenuItem=function(){t.showMenuItems=!t.showMenuItems,t.$rgDigest()},t.closeDropdown=function(){t.showMenuItems=!1,t.$rgDigest()};var D;_(),t.$on("$destroy",I)}e.$inject=["$ringbox","$scope","Notification","Storage","friendsFactory","$routeParams","Auth","profileFactory","fileUploadService","imageQuality","AlbumFactory","SystemEvents","Utils","Ringalert","languageConstant","$rootScope","rgDropdownService","GlobalEvents"];var t=function(e,t){function n(t){e.showCoverDD=!e.showCoverDD,e.$rgDigest()}t.on("mouseenter",n),t.on("mouseleave",n),e.$on("$destroy",function(){t.off("mouseenter",n),t.off("mouseleave",n)})};return{restrict:"E",scope:!0,templateUrl:"templates/profile/profile-header.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfile",n)}(angular,window),function(e,t){"use strict";function n(){function t(t,n,r,i,o,a){function s(t){t.preventDefault(),n.tmpBasic=e.copy(n.profileObj.getBasicInfo()),1!==n.tmpBasic.mDay&&"1"!==n.tmpBasic.mDay||(n.tmpBasic.marriageDay=null),1!==n.tmpBasic.birthDay&&"1"!==n.tmpBasic.birthDay||(n.tmpBasic.birthday=null),n.isEditProfile=!0,n.$rgDigest()}function c(){n.isEditProfile=!1,n.$rgDigest()}function l(){n.processing=!0;var e=n.tmpBasic.marriageDay;null==e&&(e=1);var s,c=typeof n.tmpBasic.birthday,l=typeof e;if("string"===c){var u=n.tmpBasic.birthday.split("-"),d=parseInt(u[0])+","+parseInt(u[1])+","+parseInt(u[2]);s=new Date(d)}else if(s=n.tmpBasic.birthday,1!==n.tmpBasic.birthDay&&"1"!==n.tmpBasic.birthDay){var g=r.profileVerbalDate(n.tmpBasic.birthDay);n.tmpBasic.birthday=g}if("string"===l){var m=e.split("-"),f=parseInt(m[0])+","+parseInt(m[1])+","+parseInt(m[2]);e=new Date(f)}i.updateUserProfile(n.uId,n.tmpBasic,s,e).then(function(r){
r.sucs===!0?(n.tmpBasic.birthDay=s?s.getTime():"1","object"==typeof s?n.currentUser.setBirthday(n.tmpBasic.birthDay):n.currentUser.setBirthday("1"),"object"===l?n.currentUser.setMarriageday(e.getTime()):n.currentUser.setMarriageday("1"),n.profileObj.getBasicInfo().birthDay=n.tmpBasic.birthDay,n.currentUser.setName(n.tmpBasic.fn),n.currentUser.setHomeCity(n.tmpBasic.hc),n.currentUser.setCurrentCity(n.tmpBasic.cc),n.currentUser.setAboutMe(n.tmpBasic.am),t.updateLoginData("fn",n.tmpBasic.fn),n.currentUser.setGender(n.tmpBasic.gr),o.show("Successfully updated","success"),n.isEditProfile=!1):(n.isEditProfile=!1,o.show(r.mg,"error")),n.processing=!1,a.$rgDigest()})}n.isEditProfile=!1,n.processing=!1,n.enableEditBasic=s,n.updateMyBasicInfo=l,n.cancelUpdateMyBasicInfo=c,n.isDatePickerOpen=!1,n.model={},n.open=function(e,t){switch(e.preventDefault(),e.stopPropagation(),t){case"wcalendar":n.model.wcalendarTo=!1;break;case"wcalendarTo":n.model.wcalendar=!1;break;case"ecalendar":n.model.ecalendarTo=!1;break;case"ecalendarTo":n.model.ecalendar=!1;break;case"mcalendar":n.model.mcalendar=!1}n.model[t]=!n.model[t]},n.dateOptions={showWeeks:"false",startingDay:1};var u=new Date;u.setMonth(u.getMonth()+6),n.minDate=new Date,n.maxBirthDate=new Date(u.getFullYear(),u.getMonth(),u.getDate()),n.maxWeddingDate=new Date(u.getFullYear()+20,u.getMonth(),u.getDate())}return t.$inject=["Storage","$scope","Utils","profileFactory","Ringalert","$rootScope"],{restrict:"E",templateUrl:"templates/profile/profile.about-basic.html",controller:t}}e.module("ringid.profile").directive("rgProfileBasic",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n,r,i,o,a){function s(e){e.preventDefault(),r.isEditProfilePrivacy=!0,r.$rgDigest()}function c(e){var t;r.isEditProfilePrivacy=!1,t=r.profileObj.isCurrentUser()?{actn:216,sv:e.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:e.callPrivacy,sn:6,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.callPrivacy=e.callPrivacy,o.saveCallPvcEdit(t).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.callPrivacy)});var n;n=r.profileObj.isCurrentUser()?{actn:216,sv:e.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:e.chatPrivacy,sn:7,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.chatPrivacy=e.chatPrivacy,o.saveChatPvcEdit(n).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.chatPrivacy=e.chatPrivacy)});var i;i=r.profileObj.isCurrentUser()?{actn:216,sv:e.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:e.feedPrivacy,sn:8,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.feedPrivacy=e.feedPrivacy,o.saveFeedPvcEdit(i).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.feedPrivacy=e.feedPrivacy)}),r.$rgDigest()}function l(){r.isEditProfilePrivacy=!1,r.$rgDigest()}r.isEditProfilePrivacy=!1,r.callPvcEdit=!1,r.chatPvcEdit=!1,r.feedPvcEdit=!1,r.fPrivacyInfo={callPrivacy:0,chatPrivacy:0,feedPrivacy:0},r.enablePrivacyEditMode=s,r.savePvcEdit=c,r.cancelPvcEdit=l,r.profileObj.isCurrentUser()?e.fetchPrivacy().then(function(e){e.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.cla,r.fPrivacyInfo.chatPrivacy=e.chta,r.fPrivacyInfo.feedPrivacy=e.fda),r.$rgDigest()}):(r.access=r.profileObj.getAccess,r.fPrivacyInfo.callPrivacy=r.profileObj.getAccess().cla,r.fPrivacyInfo.chatPrivacy=r.profileObj.getAccess().chta,r.fPrivacyInfo.feedPrivacy=r.profileObj.getAccess().fda,r.fPrivacyInfo.callPrivacy||r.fPrivacyInfo.chatPrivacy||r.fPrivacyInfo.feedPrivacy||r.profileObj.setBlock(1),r.$rgDigest())}e.$inject=["Auth","Storage","$timeout","$scope","friendsFactory","profileFactory","languageConstant"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-privacy.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfilePrivacy",n)}(angular,window),function(e,t){"use strict";function n(){function t(t,n,r,i,o,a,s,c){function l(){T&&(n.educationlist[h]=T),n.isEditEducation=-1,n.eduObjInfo.scl="",n.eduObjInfo.dgr="",n.eduObjInfo.cntn="",n.eduObjInfo.toTimeE="",n.eduObjInfo.fromTimeE="",n.isaddNewEducation=!0,n.$rgDigest()}function u(t,r){h=t,n.eduObjInfo=n.educationlist[t],T=e.copy(n.educationlist[t]),1===n.eduObjInfo.tt&&(n.eduObjInfo.toTimeE=null),1===n.eduObjInfo.ft&&(n.eduObjInfo.fromTimeE=null),n.isaddNewEducation=!1,n.isEditEducation=t,n.$rgDigest()}function d(){T&&(n.educationlist[h]=T),n.isaddNewEducation=!1,n.isEditEducation=-1,n.$rgDigest()}function g(){n.educationlist[h]=T,n.isEditEducation=-1,n.$rgDigest()}function m(){if(n.eduObjInfo.scl||(n.edusclerror=!0,n.$rgDigest()),n.eduObjInfo.dgr||(n.edudgrerror=!0,n.$rgDigest()),n.eduObjInfo.cntn||(n.educntnerror=!0,n.$rgDigest()),!(n.edusclerror||n.edudgrerror||n.educntnerror)){if(n.processing=!0,n.eduObjInfo.fromTimeE&&n.eduObjInfo.toTimeE){var e,o;if(e=n.eduObjInfo.fromTimeE,o=n.eduObjInfo.toTimeE,"string"==typeof e&&(e=new Date(e)),"string"==typeof o&&(o=new Date(o)),e>o)return t.show("Your end date can't be earlier than your start date. Please try again","info"),void(n.processing=!1);n.$rgDigest()}n.eduObjInfo.fromTimeE?n.eduObjInfo.ft=new Date(n.eduObjInfo.fromTimeE).getTime():n.eduObjInfo.ft=1,n.eduObjInfo.toTimeE?n.eduObjInfo.tt=new Date(n.eduObjInfo.toTimeE).getTime():n.eduObjInfo.tt=1,i.updateEducation(n.eduObjInfo).then(function(e){e.sucs===!0?(n.eduObjInfo.fromTimeE?n.eduObjInfo.fromTimeE=r.profileVerbalDate(n.eduObjInfo.ft):(n.eduObjInfo.ft=1,n.eduObjInfo.fromTimeE=""),n.eduObjInfo.toTimeE?n.eduObjInfo.toTimeE=r.profileVerbalDate(n.eduObjInfo.tt):(n.eduObjInfo.tt=1,n.eduObjInfo.toTimeE=""),n.isEditEducation=-1,t.show("Successfully updated","success")):(n.isEditEducation=-1,t.show("Request did not process successfully","error")),n.processing=!1,n.$rgDigest()})}}function f(){if(n.eduObjInfo.scl||(n.edusclerror=!0,n.$rgDigest()),n.eduObjInfo.dgr||(n.edudgrerror=!0,n.$rgDigest()),n.eduObjInfo.cntn||(n.educntnerror=!0,n.$rgDigest()),!(n.edusclerror||n.edudgrerror||n.educntnerror)){if(n.processing=!0,n.eduObjInfo.fromTimeE&&n.eduObjInfo.toTimeE&&n.eduObjInfo.fromTimeE>n.eduObjInfo.toTimeE)return t.show("Your end date can't be earlier than your start date. Please try again","info"),void(n.processing=!1);n.eduObjInfo.fromTimeE?n.eduObjInfo.ft=new Date(r.profileVerbalDate(n.eduObjInfo.fromTimeE)).getTime():n.eduObjInfo.ft=1,n.eduObjInfo.toTimeE?n.eduObjInfo.tt=new Date(r.profileVerbalDate(n.eduObjInfo.toTimeE)).getTime():n.eduObjInfo.tt=1,n.eduObjInfo.ut=(new Date).getTime(),n.eduObjInfo.af=1,n.eduObjInfo.grtd=!1,n.eduObjInfo.iss=!0,i.submitNewEducation(n.eduObjInfo).then(function(r){if(r.sucs===!0){n.eduObjInfo.id=r.id;var i=e.copy(n.eduObjInfo);n.educationlist.push(i),t.show("Education info added successfully","success"),n.isaddNewEducation=!1,n.isEditEducation=-1}else t.show("Request did not process successfully","error"),n.isaddNewEducation=!1,n.isEditEducation=-1;n.isaddNewEducation=!1,n.isEditEducation=-1,n.processing=!1,n.$rgDigest()})}}function E(e,r){var o=r.id;n.isEditEducation=-1,i.deleteEducation(o).then(function(r){r.sucs===!0?(n.educationlist.splice(e,1),t.show("Successfully deleted","success")):t.show("Request did not process successfully","error"),n.$rgDigest()})}function p(e){if(e.sucs===!0){for(var t=0;t<e.educationList.length;t++){var i=e.educationList[t];I[i.id]=i}for(var o,a=Object.keys(I),s=[],c=0;c<a.length;c++)o=I[a[c]],o.fromTime=new Date(o.ft),o.toTime=new Date(o.tt),o.fromTimeE=r.profileVerbalDate(o.ft),o.toTimeE=r.profileVerbalDate(o.tt),s.push(o);n.educationlist=s}else RingLogger.warning("failed to get Education list for user :"+e.utId,RingLogger.tags.PROFILE),RingLogger.log(e,RingLogger.tags.PROFILE);n.$rgDigest()}var T,h,_=s.SYSTEM.PROFILE;n.profileObj.isCurrentUser()?n.isOwner=!0:n.isOwner=!1;i.getUserProfileData({uId:o.uId},n.profileObj.isCurrentUser()),n.getProfileData=i.getProfileData,n.educationlist=[],n.edusclerror=!1,n.edudgrerror=!1,n.educntnerror=!1,n.$watch("eduObjInfo.scl",function(e,t){e&&(n.edusclerror=!1)}),n.$watch("eduObjInfo.dgr",function(e,t){e&&(n.edudgrerror=!1)}),n.$watch("eduObjInfo.cntn",function(e,t){e&&(n.educntnerror=!1)}),n.ddActionHtml="templates/dropdowns/action-dropdown.html",n.actionEduDropdown=function(e){switch(a.close(e.event),e.action){case"edit":u(e.data.index,e.data.obj);break;case"delete":E(e.data.index,e.data.obj)}},n.isaddNewEducation=!1,n.isEditEducation=-1,n.eduObjInfo={},n.addNewEducation=l,n.submitNewEducation=f,n.updateEducation=m,n.cancelAddEducation=d,n.cancelUpdateEducation=g;var I={},A=c.subscribe(p,{action:[_.TYPE_ACTION_GET_EDUCATION]});n.$on("$destroy",function(){c.unsubscribe(A),n.educationlist=[]})}t.$inject=["Ringalert","$scope","Utils","profileFactory","$routeParams","rgDropdownService","OPERATION_TYPES","$$connector"];var n=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-education.html",controller:t,link:n}}e.module("ringid.profile").directive("rgProfileEducation",n)}(angular,window),function(e,t){"use strict";function n(){function t(t,n,r,i,o,a,s,c){function l(){_&&(t.worklist[I]=_),t.isEditWork=-1,t.workObjInfo.cnm="",t.workObjInfo.pstn="",t.workObjInfo.desc="",t.workObjInfo.fromTimeE="",t.workObjInfo.toTimeE="",t.workObjInfo.ft="",t.workObjInfo.tt="",t.isAddNewWork=!0,t.$rgDigest()}function u(){_&&(t.worklist[I]=_),t.isAddNewWork=!1,t.$rgDigest()}function d(){if(t.workObjInfo.cnm||(t.workcnmerror=!0,t.$rgDigest()),t.workObjInfo.pstn||(t.workpstnerror=!0,t.$rgDigest()),!t.workcnmerror&&!t.workpstnerror){if(t.processing=!0,t.workObjInfo.fromTimeE&&t.workObjInfo.toTimeE&&t.workObjInfo.fromTimeE>t.workObjInfo.toTimeE)return a.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.workObjInfo.status===!0?(t.workObjInfo.tt="0",t.workObjInfo.status=!0,t.workObjInfo.date_info="Present"):t.workObjInfo.toTimeE?t.workObjInfo.tt=new Date(t.workObjInfo.toTimeE).getTime():t.workObjInfo.tt=1,t.workObjInfo.fromTimeE?t.workObjInfo.ft=new Date(t.workObjInfo.fromTimeE).getTime():t.workObjInfo.ft=1,r.submitNewWork(t.workObjInfo).then(function(r){if(r.sucs===!0){t.workObjInfo.id=r.id,t.workObjInfo.ft?t.workObjInfo.fromTimeE=n.profileVerbalDate(t.workObjInfo.ft):t.workObjInfo.ft=1,t.workObjInfo.tt?t.workObjInfo.toTimeE=n.profileVerbalDate(t.workObjInfo.tt):t.workObjInfo.tt=1;var i=e.copy(t.workObjInfo);t.worklist.push(i),a.show("Career info added successfully","success"),t.isAddNewWork=!1,t.isEditWork=-1}else a.show("Request did not process successfully","error"),t.isAddNewWork=!1,t.isEditWork=-1;t.processing=!1,t.$rgDigest()})}}function g(e){switch(e.action){case"edit":m(e.data.index),o.close(e.event);break;case"delete":p(e.data.index,e.data.obj),o.close(e.event)}}function m(n){I=n,t.workObjInfo=t.worklist[n],_=e.copy(t.worklist[n]),1!==t.workObjInfo.tt&&"0"!==t.workObjInfo.tt&&0!==t.workObjInfo.tt||(t.workObjInfo.toTimeE=null),1===t.workObjInfo.ft&&(t.workObjInfo.fromTimeE=null),t.isAddNewWork=!1,t.isEditWork=n,t.$rgDigest()}function f(){if(t.workObjInfo.cnm||(t.workcnmerror=!0,t.$rgDigest()),t.workObjInfo.pstn||(t.workpstnerror=!0,t.$rgDigest()),!t.workcnmerror&&!t.workpstnerror){if(t.processing=!0,t.workObjInfo.fromTimeE&&t.workObjInfo.toTimeE){var e,i;if(e=t.workObjInfo.fromTimeE,i=t.workObjInfo.toTimeE,"string"==typeof e&&(e=new Date(e)),"string"==typeof i&&(i=new Date(i)),e>i)return a.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.$rgDigest()}t.workObjInfo.fromTimeE?t.workObjInfo.ft=new Date(t.workObjInfo.fromTimeE).getTime():t.workObjInfo.ft=1,t.workObjInfo.toTimeE?t.workObjInfo.tt=new Date(t.workObjInfo.toTimeE).getTime():t.workObjInfo.tt=1,t.workObjInfo.status===!0&&(t.workObjInfo.tt="0",t.workObjInfo.status=!0,t.workObjInfo.date_info="Present"),r.updateWork(t.workObjInfo).then(function(e){e.sucs===!0?(t.workObjInfo.ft?t.workObjInfo.fromTimeE=n.profileVerbalDate(t.workObjInfo.ft):t.workObjInfo.ft=1,t.workObjInfo.tt?t.workObjInfo.toTimeE=n.profileVerbalDate(t.workObjInfo.tt):t.workObjInfo.tt=1,t.workObjInfo.status===!0&&(t.workObjInfo.tt=0,t.date_info="Present"),a.show("Updated successfully","success"),t.isEditWork=-1):(t.isEditWork=-1,a.show("Request did not process successfully","error")),t.processing=!1,t.$rgDigest()})}}function E(){t.worklist[I]=_,t.isEditWork=-1,t.$rgDigest()}function p(e,n){t.isEditWork=-1;var i=n.id;r.deleteWork(i).then(function(n){n.sucs===!0?(t.worklist.splice(e,1),a.show("Successfully deleted","success")):a.show("Request did not process successfully","error"),t.$rgDigest()})}function T(e){if(e.sucs===!0){for(var r=0;r<e.workList.length;r++){var i=e.workList[r];A[i.id]=i}for(var o,a=Object.keys(A),s=[],c=0;c<a.length;c++)o=A[a[c]],o.fromTime=new Date(o.ft),o.toTime=new Date(o.tt),0===o.tt?(o.status=!0,o.date_info="Present"):o.toTimeE=n.profileVerbalDate(o.tt),o.fromTimeE=n.profileVerbalDate(o.ft),s.push(o);t.worklist=s}else RingLogger.warning("failed to get Work list for user :"+e.utId,RingLogger.tags.PROFILE),RingLogger.log(e,RingLogger.tags.PROFILE);t.$rgDigest()}var h=s.SYSTEM.PROFILE;t.profileObj.isCurrentUser()?t.isOwner=!0:t.isOwner=!1,r.getUserProfileData({uId:i.uId},t.profileObj.isCurrentUser()),t.getProfileData=r.getProfileData,t.worklist=[],t.ddActionHtml="templates/dropdowns/action-dropdown.html",t.actionWorkDropdown=g,t.isAddNewWork=!1,t.isEditWork=-1,t.workObjInfo={};var _,I;t.addNewWork=l,t.cancelNewWork=u,t.submitNewWork=d,t.cancelUpdateWork=E,t.updateWork=f,t.workcnmerror=!1,t.workpstnerror=!1,t.$watch("workObjInfo.cnm",function(e,n){e&&(t.workcnmerror=!1)}),t.$watch("workObjInfo.pstn",function(e,n){e&&(t.workpstnerror=!1)}),t.$watch("workObjInfo.status",function(e,n){t.workObjInfo.toTimeE=""});var A={},v=c.subscribe(T,{action:[h.TYPE_ACTION_GET_WORK]});t.$on("$destroy",function(){c.unsubscribe(v),t.worklist=[]})}t.$inject=["$scope","Utils","profileFactory","$routeParams","rgDropdownService","Ringalert","OPERATION_TYPES","$$connector"];var n=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-work.html",controller:t,link:n}}e.module("ringid.profile").directive("rgProfileWork",n)}(angular,window),function(e,t){"use strict";function n(){function t(t,n,r,i,o,a,s){function c(){T&&(t.skilllist[h]=T),t.isEditSkill=-1,t.skillObjInfo.skl="",t.skillObjInfo.desc="",t.isAddNewSkill=!0,t.$rgDigest()}function l(){t.skillObjInfo.desc||(t.skilldescerror=!0,t.$rgDigest()),t.skillObjInfo.skl||(t.skillsklerror=!0,t.$rgDigest()),t.skillsklerror||t.skilldescerror||(t.processing=!0,n.submitNewSkill(t.skillObjInfo).then(function(n){var r;n.sucs===!0?(t.skillObjInfo.id=n.id,r=e.copy(t.skillObjInfo),t.skilllist.push(r),o.show("Skill info added successfully","success"),t.isAddNewSkill=!1):(t.isAddNewSkill=!1,o.show("Request did not process successfully","error")),t.processing=!1,t.$rgDigest()}))}function u(){T&&(t.skilllist[h]=T),t.isAddNewSkill=!1,t.$rgDigest()}function d(){t.skillObjInfo.desc||(t.skilldescerror=!0,t.$rgDigest()),t.skillObjInfo.skl||(t.skillsklerror=!0,t.$rgDigest()),t.skillsklerror||t.skilldescerror||(t.processing=!0,n.updateSkill(t.skillObjInfo).then(function(e){e.sucs===!0?(t.isEditSkill=-1,o.show("Successfully updated","success")):(t.isEditSkill=-1,o.show("Request did not process successfully","error")),t.processing=!1,t.$rgDigest()}))}function g(e,r){var i=r.id;t.isEditSkill=-1,n.deleteSkill(i).then(function(n){n.sucs===!0?(t.skilllist.splice(e,1),o.show("Successfully deleted","success")):o.show("Request did not process successfully","error"),t.$rgDigest()})}function m(n){h=n,t.skillObjInfo=t.skilllist[n],T=e.copy(t.skilllist[n]),t.isAddNewSkill=!1,t.isEditSkill=n,t.$rgDigest()}function f(){t.skilllist[h]=T,t.isEditSkill=-1,t.$rgDigest()}function E(e){if(e.sucs===!0){for(var n=0;n<e.skillList.length;n++){var r=e.skillList[n];_[r.id]=r}for(var i,o=Object.keys(_),a=[],s=0;s<o.length;s++)i=_[o[s]],a.push(i);t.skilllist=a}else RingLogger.warning("failed to get skill list for user :"+e.utId,RingLogger.tags.PROFILE),RingLogger.log(e,RingLogger.tags.PROFILE);t.$rgDigest()}var p=s.SYSTEM.PROFILE;t.skilllist=[],t.profileObj.isCurrentUser()?t.isOwner=!0:t.isOwner=!1,t.skillsklerror=!1,t.skilldescerror=!1,t.$watch("skillObjInfo.skl",function(e,n){e&&(t.skillsklerror=!1)}),t.$watch("skillObjInfo.desc",function(e,n){e&&(t.skilldescerror=!1)}),n.getUserProfileData({uId:r.uId},t.profileObj.isCurrentUser()),t.getProfileData=n.getProfileData;var T,h;t.addNewSkill=c,t.submitNewSkill=l,t.cancelNewSkill=u,t.updateSkill=d,t.cancelUpdateSkill=f,t.skillObjInfo={},t.ddActionHtml="templates/dropdowns/action-dropdown.html",t.actionSkillDropdown=function(e){switch(e.action){case"edit":m(e.data.index);break;case"delete":g(e.data.index,e.data.obj)}i.close(e.event)},t.isAddNewSkill=!1;var _={},I=a.subscribe(E,{action:[p.TYPE_ACTION_GET_SKILL]});t.$on("$destroy",function(){a.unsubscribe(I),t.skilllist=[]})}t.$inject=["$scope","profileFactory","$routeParams","rgDropdownService","Ringalert","$$connector","OPERATION_TYPES"];var n=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-skill.html",controller:t,link:n}}e.module("ringid.profile").directive("rgProfileSkill",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n){function r(t){t.preventDefault(),e.showPassEdit===!1&&(e.showPassEdit=!0,e.showMessage=!1),e.$rgDigest()}function i(){e.showPassEdit=!1,e.showMessage=!0,e.IsMatch=!1,e.$rgDigest()}function o(r){r.newpassword!=r.repassword?e.IsMatch=!0:r.newpassword==r.repassword&&(e.IsMatch=!1,e.oldError=!1,n.changePassword(r.oldpassword,r.newpassword).then(function(n){n.sucs===!0?(r={oldpassword:"",newpassword:"",repassword:""},e.showPassEdit=!1,e.showMessage=!0,t.show("Password Changed Successfully","success")):t.show(n.mg,"info")},function(t){e.oldError=!0})),e.$rgDigest()}e.enablePassEdit=r,e.updatePassword=o,e.cancelUpdatePassword=i,e.showMessage=!0,e.showPassEdit=!1,e.IsMatch=!1,e.oldError=!1}e.$inject=["$scope","Ringalert","profileFactory"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-password.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfilePassword",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n,r,i,o,a){function s(){n.isAddEmail=!0,n.showAddEmailButton=!1,n.$rgDigest()}function c(){n.isAddEmail=!1,n.showAddEmailButton=!0,n.$rgDigest()}function l(){n.isAddPhone=!1,n.showAddPhoneButton=!0,n.$rgDigest()}function u(e){i.sendCode(e).then(function(t){t.sucs===!0?(m=t.el,n.isAddEmail=!1,n.isAddCode=!0,n.vemail="",n.emailVerified=!1,n.emailTitle="Click here to verify your Email",e.email=""):r.show(t.mg,"info"),n.$rgDigest()})}function d(e){n.verifierEnabled=!1,t.user.verifyPhoneNo(e).then(function(t){t.sucs===!0?(n.phoneNumber=e.mblDc+e.mbl,f=e.mblDc,n.vnumber=n.phoneNumber,n.phoneVerified=!0,n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified."):r.show(t.mg,"error"),n.$rgDigest()})}function g(e){e.email=m,i.verifyCode(e).then(function(t){t.sucs===!0?(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!0,n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.vemail=t.el,e.code="",e.email="",r.show(t.mg,"success")):(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!1,n.vemail="",r.show(t.mg,"info")),n.$rgDigest()})}n.emailVerified=!1,n.phoneVerified=!1,n.isAddEmail=!1,n.isAddPhone=!1,n.addEmail=s,n.isAddCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.cancelAddEmail=c,n.cancelAddPhone=l,n.sendCode=u,n.verifyCode=g,n.verifyThePhoneNum=d,n.verifierEnabled=!1,n.enableVerifier=function(){n.verifierEnabled=!0};var m,f;n.emailValue="Verify Email",n.emailTitle="Click here to verify your Email",n.phoneValue="Verify Phone",n.phoneTitle="Click here to verify your Phone",n.profileObj.isEmailVerified()&&(n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.emailVerified=!0,n.vemail=n.profileObj.getEmail()),n.profileObj.isMobileVerified()&&(n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified.",n.phoneVerified=!0,n.vnumber=n.profileObj.getMobileNumber()),n.cancelVerification=function(){n.isAddCode=!1,n.isAddPhnCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.$rgDigest()},n.resendCodeToMail=function(){i.sendCode({email:m}).then(function(e){e.sucs===!0?(m=e.el,r.show(e.mg,"info")):r.show(e.mg,"info"),n.$rgDigest()})}}e.$inject=["rgDropdownService","Api","$scope","Ringalert","profileFactory","$routeParams","Auth"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-recovery.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfileRecovery",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n){function r(t){t.preventDefault(),e.isEditAchat=!0,e.$rgDigest()}function i(r){e.isEditAchat=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.achat,sn:10}),e.chatsettings.achat=r.achat,t.saveAchatSetting(i).then(function(t){t.sucs===!0?(e.chatsettings.achat=r.achat,n.setAchatPermission(r.achat)):e.chatsettings.achat=0}),e.$rgDigest()}function o(){e.isEditAchat=!1,e.$rgDigest()}e.isEditAchat=!1,e.chatsettings={achat:n.getPermission().ancht},e.enableAchatEditMode=r,e.saveAchatSettings=i,e.cancelAchatSettings=o}e.$inject=["$scope","profileFactory","Auth"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-achat.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfileAchat",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n){function r(t){t.preventDefault(),e.isEditAinfndreq=!0,e.$rgDigest()}function i(r){e.isEditAinfndreq=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.ainfndreq,sn:11}),e.incomingfndreqsettings.ainfndreqobj=r.ainfndreqobj,t.saveAinfndreqSettings(i).then(function(t){t.sucs===!0?(e.incomingfndreqsettings.ainfndreq=r.ainfndreq,n.setAinfndreqPermission(r.ainfndreq)):e.incomingfndreqsettings.ainfndreq=0}),e.$rgDigest()}function o(){e.isEditAinfndreq=!1,e.$rgDigest()}e.isEditAinfndreq=!1,e.incomingfndreqsettings={ainfndreq:n.getPermission().aifr},e.enableAinfndreqEditMode=r,e.saveAinfndreqSettings=i,e.cancelAinfndreqSettings=o}e.$inject=["$scope","profileFactory","Auth"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-incoming-frnd-req.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfileAinfndreq",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n){function r(t){t.preventDefault(),e.isEditAfam=!0,e.$rgDigest()}function i(r){e.isEditAfam=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.afam,sn:12}),e.afamsettings.afam=r.afam,t.saveAfamSettings(i).then(function(t){t.sucs===!0?(e.afamsettings.afam=r.afam,n.setAfamPermission(r.afam)):e.afamsettings.afam=0}),e.$rgDigest()}function o(){e.isEditAfam=!1,e.$rgDigest()}e.isEditAfam=!1,e.afamsettings={afam:n.getPermission().afam},e.enableAfamEditMode=r,e.saveAfamSettings=i,e.cancelAfamSettings=o}e.$inject=["$scope","profileFactory","Auth"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-afam.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfileAllowaddme",n)}(angular,window),function(e,t){"use strict";function n(){function e(e,t,n){function r(t){t.preventDefault(),e.isEditAaf=!0,e.$rgDigest()}function i(r){e.isEditAaf=!1;var i;e.profileObj.isCurrentUser()&&(i={sv:r.aaf,sn:13}),e.aafsettings.aaf=r.aaf,t.saveAafSetting(i).then(function(t){t.sucs===!0?(e.aafsettings.aaf=r.aaf,n.setAafPermission(r.aaf)):e.aafsettings.aaf=0}),e.$rgDigest()}function o(){e.isEditAaf=!1,e.$rgDigest()}e.isEditAaf=!1,e.aafsettings={aaf:n.getPermission().aaf},e.enableAafEditMode=r,e.saveAafSettings=i,e.cancelAafSettings=o}e.$inject=["$scope","profileFactory","Auth"];var t=function(){};return{restrict:"E",templateUrl:"templates/profile/profile.about-aaf.html",controller:e,link:t}}e.module("ringid.profile").directive("rgProfileAutoaddfrnd",n)}(angular,window),function(e,t){"use strict";e.module("ringid.profile").directive("rgRelocateTemplate",function(){return{restrict:"E",template:'<ng-include src="template"></ng-include>',link:function(e,n,r){var i=r.twocol,o=r.threecol;e.template=o,t.innerWidth>1800||t.innerWidth<1200&&e.template!=o?e.template=o:t.innerWidth>1200&&t.innerWidth<1800&&e.template!=i&&(e.template=i),t.onresize=function(){t.innerWidth>1800||t.innerWidth<1200&&e.template!=o?(e.template=o,e.$apply()):t.innerWidth>1200&&t.innerWidth<1800&&e.template!=i&&(e.template=i,e.$apply())}}}})}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c,l,u,d){function g(e,t){var n=e;n.fromTime=new Date(n.ft),n.toTime=new Date(n.tt),n.fromTimeE=d.profileVerbalDate(n.ft),n.toTimeE=d.profileVerbalDate(n.tt),M[t].educationList.push(n)}function m(e,t){var n=e;n.fromTime=new Date(n.ft),n.toTime=new Date(n.tt),0===n.tt?(n.status=!0,n.date_info="Present"):n.toTimeE=d.profileVerbalDate(n.tt),n.fromTimeE=d.profileVerbalDate(n.ft),M[t].workList.push(n)}function f(e,t){var n=e;M[t].skillList.push(n)}function E(e,t,n){if(M.hasOwnProperty(n))switch(e){case"educationList":g(t,n);break;case"workList":m(t,n);break;case"skillList":f(t,n)}}function p(e,t){return M.hasOwnProperty(t)?M[t][e]:[]}function T(e){delete M[e]}function h(e){return D||(D=r.currentUser()),e===D.getKey()?D:N=c.create({uId:e})}function _(t){var n=o.defer();return s.basicAndPrivacy(t.getUtId(),t.isCurrentUser()).then(function(r){r.sucs===!0?(t.isCurrentUser()?D=c.create(e.extend({},r,{uId:t.getKey()}),!0,!0):(N=c.create(r.userDetails,!0,!1),s.fetchPresenceAndMood(t.getKey()).then(function(e){N.updateUserObj(e)})),n.resolve()):n.reject()}),n.promise}function I(e){s.getMutualFriends(e).then(function(e){e.sucs===!0&&N.updateUserObj({nmf:e.mfIDs.length})},function(){})}function A(e,t){var n;n=t?D:c.create(e),M.hasOwnProperty(n.getUtId())||(M[n.getUtId()]={workList:[],educationList:[],skillList:[]},t?s.getUserProfileData():s.getUserProfileData(n.getUtId()))}function v(t){var r=o.defer();return t||(t={iurl:D.avatar("iurl")}),t=e.extend({},t,u.getReposition("profilephoto")),s.changeProfilePicture(t).then(function(e){e.sucs===!0?(n.updateLoginData("prIm",t.iurl),n.updateLoginData("prImId",e.imgId),D.setProfileImage(t.iurl,e.imgId),r.resolve(e)):r.reject(e)},function(e){r.reject(e)}),r.promise}function S(t){var n=o.defer();return t||(t={iurl:D.getCover("iurl")}),t=e.extend({},t,u.getReposition("coverphoto")),s.changeCoverPicture(t).then(function(r){r.sucs?(D.setCover(e.extend(t,{cImId:r.imgId})),n.resolve()):n.reject()},function(e){n.reject()}),n.promise}var C=l.SYSTEM.PROFILE,D=r.currentUser(),N={},M={},R=function(e){e.actn};return i.subscribe(R,{action:[C.ACTION_USERS_PRESENCE_DETAILS_DATA]}),{init:_,getProfile:h,getMutualFriends:I,getUserProfileData:A,changeProfilePicture:v,changeCoverPicture:S,updateUserProfile:s.updateProfile,savePvcEdit:s.updateUserPrivacy,submitNewEducation:s.submitNewEducation,saveAchatSetting:s.saveAchatSetting,saveAinfndreqSettings:s.saveAinfndreqSettings,saveAfamSettings:s.saveAfamSettings,saveAafSetting:s.saveAafSetting,getProfileData:p,setProfileData:E,removeProfileData:T,deleteEducation:s.deleteEducation,getAllEducation:s.getEducationData,updateEducation:s.updateEducationById,submitNewSkill:s.submitNewSkill,updateSkill:s.updateSkill,deleteSkill:s.deleteSkill,submitNewWork:s.submitNewWork,updateWork:s.updateWork,deleteWork:s.deleteWork,changePassword:s.changePassword,verifyCheck:s.verifyCheck,sendCode:s.sendCode,verifyCode:s.verifyCode,changePrivacy:s.changePrivacy,saveCallPvcEdit:s.saveCallPvcEdit,saveChatPvcEdit:s.saveChatPvcEdit,saveFeedPvcEdit:s.saveFeedPvcEdit,moodChange:s.moodChange,addSocialAccount:s.addSocialAccount}}e.module("ringid.profile").service("profileFactory",n),n.$inject=["$routeParams","Storage","Auth","$$connector","$$q","Ringalert","profileHttpService","userFactory","OPERATION_TYPES","fileUploadService","Utils"]}(angular,window),function(e,t){"use strict";e.module("ringid.circle",["ringid.global_services","ringid.global_directives","ringid.shared"])}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g){function m(){for(var e=(t.memberList.keys(),t.adminList.keys(),[]),n=0;n<t.memberList.length();n++)e[n]={admin:"false",uId:t.memberList.all()[n].value.user.uId};for(var o=[],a=0;a<t.adminList.length();a++)o[a]={admin:"true",uId:t.adminList.all()[a].value.user.uId};var s=o.concat(e),c={tg:t.models.circleName,alluser:s,uId:l.currentUser().getUId()};r.createCircle(c).then(function(e){e.sucs===!0&&(i.closeAll(),d.path("/circle/"+e.grpId))})}function f(){if(A()){var n=t.memberList.keys(),i=t.adminList.keys(),o=t.circle.getMemberIds(),a=t.circle.getAdminIds(),s=n.difference(o),l=o.difference(n),u=i.difference(a),d=a.difference(i),g=[];e.forEach(s,function(e){g.push({admin:!1,uId:e})}),e.forEach(u,function(e){g.push({admin:!0,uId:e})}),g.length>0&&r.addMembers(g,t.circle);var m=l;m=m.concat(d),m.length>0&&r.removeMembers(m,t.circle),c.show("Circle Updated","success"),t.close()}}function E(e){t.memberList.add(e.getKey(),e),t.friendDropdown=!1,t.friendsNameFilter="",t.$rgDigest()}function p(e){t.memberList.remove(e.getKey()),t.$rgDigest()}function T(e){t.adminList.add(e.getKey(),e),t.memberList.remove(e.getKey()),t.$rgDigest()}function h(e){t.adminList.remove(e.getKey()),t.memberList.add(e.getKey(),e),t.$rgDigest()}function _(e){t.state.loading=e,e||u.recalculate(t),t.$$phase||t.$root.$$phase||t.$digest()}function I(){t.state.loading||t.friendlist.length()===o.totalFriends("friends")||(_(!0),o.getContactDetails().then(function(){t.friendlist=o.getFriends("friends"),RingLogger.information("FRIENDS LENGTH: "+t.friendlist.length(),RingLogger.tags.FRIEND),_(!1)},function(){_(!1)}),setTimeout(function(){t.state.loading=!1},3e3),t.$rgDigest())}function A(){return t.models.circleName.length>60?t.models.errCircleName="Maximum 60 characters":0===t.models.circleName.length?t.models.errCircleName="Name required":t.models.errCircleName="",t.models.errMemberList=t.memberList.length()<1,0===t.models.errCircleName.length&&!t.models.errMemberList}t.circleAddMode=!1,t.selectedMembers=[],t.state={loading:!1,noData:!1},t.circleNameSection=!0,t.circleMemberSection=!1,t.circleAdminSection=!1,t.friendDropdown=!1,t.$watch("friendsNameFilter",function(e,n){e?t.friendDropdown=!0:t.friendDropdown=!1}),t.closeFriendDd=function(){t.friendDropdown=!1,t.$rgDigest()},t.friendlistNameFilter="",t.memberfilter="",t.nextPart=function(e){switch(e){case"setname":t.circleNameSection=!0,t.circleMemberSection=!1,t.circleAdminSection=!1,t.$rgDigest();break;case"setmembers":t.circleNameSection=!1,t.circleMemberSection=!0,t.circleAdminSection=!1,t.$rgDigest();break;case"setadmins":t.circleNameSection=!1,t.circleMemberSection=!1,t.circleAdminSection=!0,t.$rgDigest()}},t.$on("$destroy",function(){t.friendlist.reset(),t.selectedMembers=[]}),t.friendlist=o.getFriends("friends"),t.models={errCircleName:!1,errMemberList:!1,errAdminList:!1},s.circleId||(t.circleAddMode=!0),t.editMode=!1,s&&s.circleId?(t.circle=r.getCircle(s.circleId),t.memberList=t.circle.getMembers(),t.adminList=t.circle.getAdmins(),t.isCurrentUserSuperAdmin=t.circle.isSuperAdmin(l.currentUser().getKey()),t.models.popupTitle="Edit Group",t.models.circleName=t.circle.getName(),t.editMode=!0):(t.models.popupTitle="Create New Circle",t.models.circleName="",t.memberList=a.createNew(),t.adminList=a.createNew()),t.addToCircle=E,t.addToAdmin=T,t.removeMember=p,t.removeAdmin=h,t.createCircle=m,t.updateCircle=f,t.close=i.close,t.validateCircle=A,t.loadMoreFriends=I,t.$watch("friendName",function(e){e&&e.length>1?(_(!0),o.searchContact({schPm:e},!0).then(function(){t.friendlist=o.getFriends("friends"),_(!1),t.$rgDigest()},function(){_(!1),t.$rgDigest()})):(t.friendlist=o.getFriends("friends").copy(),t.$rgDigest())})}e.module("ringid.circle").controller("CirclePopupController",t),t.$inject=["$scope","$rootScope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","Ringalert","Auth","rgScrollbarService","$location","SystemEvents"]}()}(angular,window),
function(e,t){"use strict";!function(){function t(e,t,n,r,i,o,a,s,c){function l(){for(var n=[],r=0;r<e.memberList.length();r++)n[r]={admin:"false",uId:e.memberList.all()[r].value.user.uId};t.addMembers(n,o.target).then(function(n){n.sucs===!0?t.getSingleCircleInfo(o.target,o.circleObj):(s.show(n.mg,"error"),e.$rgDigest()),e.close()})}function u(t){e.memberList.add(t.getUtId(),t),e.selectedMembers.push(t),e.friendlist.remove(t.getUtId()),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function d(t){e.memberList.remove(t.getUtId()),e.$rgDigest()}e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleMemberSection=!1,e.friendDropdown=!1,e.$watch("friendsNameFilter",function(t,n){t?e.friendDropdown=!0:e.friendDropdown=!1}),e.closeFriendDd=function(){e.friendDropdown=!1,e.$rgDigest()},e.friendsNameFilter="",e.memberfilter="",e.$on("$destroy",function(){e.friendlist.reset(),e.selectedMembers=[]}),e.friendlist=r.getFriends("friends").copy(),e.memberList=i.createNew(),e.addToCircle=u,e.removeMember=d,e.updateCircle=l,e.close=n.close}e.module("ringid.circle").controller("circleEditPopupController",t),t.$inject=["$scope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","remoteData","Ringalert","SystemEvents"]}()}(angular,window),function(e,t){"use strict";!function(){function t(t,n,r,i,o,a,s,c,l,u,d,g,m,f,E,p,T){function h(){N.circle&&(t.isPageReady=!0,I(),_()),t.$rgDigest()}function _(){N.isCurrentUserAdmin=t.currentUser.isAdmin(N.circle.getKey()),N.isCurrentUserSuperAdmin=N.circle.isSuperAdmin(a.currentUser().getKey()),N.ddControl.isAdmin=N.isCurrentUserAdmin,N.ddControl.isSuperAdmin=N.isCurrentUserSuperAdmin}function I(){t.circleMembers=N.circle.getAllMembers(),t.$rgDigest()}function A(){i.getCircleMembers(M,0)}function v(e){i.removeMember(e,N.circle)}function S(e){switch(RingLogger.print(e,RingLogger.tags.CIRCLE),E.close(e.event),e.action){case"remove":i.removeMember(e.member.getKey(),N.circle);break;case"changemember":i.toggleMembership({grpId:N.circle.getKey(),uId:e.member.getKey(),admin:Boolean(e.admin)},N.circle);break;case"addfriend":case"accept":case"reject":e.friend.isLoading()||o.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()})}t.$rgDigest()}function C(e){var t="Are you sure you want to "+e.action+" "+N.circle.getName()+"?";E.close(e.event);var n=s.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"});n.result.then(function(t){t&&D(e)})}function D(e){switch(e.action){case"delete":i.deleteCircle(N.circle).then(function(e){e.sucs===!0?r.path("/"):t.$rgDigest()},function(e){t.$rgDigest()});break;case"leave":i.leaveGroup(N.circle).then(function(e){e.sucs===!0&&(r.path("/"),p.$rgDigest()),t.$rgDigest()},function(e){t.$rgDigest()})}}var N=this,M=n.circleId,R=n.subpage;t.loadMoreCircleMember=!1,t.showSearchLoader=!1,t.hideLoadButton=!1,t.currentUserUId=a.currentUser().getUId(),i.getCirclePromise(M).then(function(e){e?(N.circle=e,T.setPageTitle(e.getName(),!0),t.isCurrentUserAdmin=N.circle.isAdmin(),t.isCurrentUserSuperAdmin=N.circle.isSuperAdmin(t.currentUserUId),"members"===R&&(t.showBackKey=0,t.showBack=function(e,n){var r=n.target.getAttribute("data-is-anchor");r||(t.showBackKey=e,n.preventDefault(),n.stopPropagation(),t.$rgDigest())},A()),h()):i.redirectHome()},function(e){i.redirectHome()}),t.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),f.show("Coming soon","info")},N.ddHtml="templates/dropdowns/circle-edit-dropdown.html",N.ddAction=C,N.ddControl={isAdmin:t.isCurrentUserAdmin,isSuperAdmin:t.isCurrentUserSuperAdmin,getCircleData:function(){return E.close(),{circleId:M}}},N.ddMemberHtml="templates/dropdowns/circle-member-dropdown.html",N.ddMemberAction=S,N.removeMember=v,e.isUndefined(n.subpage)?N.subPage="post":N.subPage=n.subpage,N.subPageLink="templates/home/circle."+N.subPage+".html",N.isCurrentUserAdmin=!1,N.isCurrentUserSuperAdmin=!1,N.getFriendType=function(e){return e.friendshipStatus()},N.circle?(t.isPageReady=!1,t.circleMembers.length||A()):t.isPageReady=!1,N.shouldShowMemberEditMenu=function(e){return!e.isCurrentUser()&&(N.isCurrentUserSuperAdmin||N.isCurrentUserAdmin&&!e.isAdmin(M))&&!N.circle.isSuperAdmin(e.getKey())},N.memberListSubscriptionKey=l.subscribe(i.processCircleMembersData,{action:u.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_LIST}),N.searchListSubscriptionKey=l.subscribe(i.processCircleSearchMembersData,{action:u.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_SEARCH_RESULT}),t.$on(c.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,function(e,n){RingLogger.print(c.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,RingLogger.tags.CIRCLE),t.loadMoreCircleMember=!1,t.showSearchLoader=!1,n.success?t.hideLoadButton=!1:t.hideLoadButton=!0,h(),t.$rgDigest()}),t.$on(c.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT,function(e,n){t.$rgDigest()}),t.$on(c.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,function(){I(),t.$rgDigest()}),t.$on(c.CIRCLE.MY_CIRCLE_REMOVED,function(e,t){t.circleId===n.circleId&&(f.show("Circle has been Removed OR You have been removed from the circle.","error"),g(function(){r.path("/")}))}),t.cMemberSearch=function(){N.searchParam?(t.showSearchLoader=!0,i.getMemberResult(N.searchParam,M)):t.hideLoadButton=!1,t.$rgDigest()},t.loadMoreMembers=function(){if(N.searchParam)t.showSearchLoader=!0,i.getMemberResult(N.searchParam,M);else{var e=20;t.loadMoreCircleMember=!0,i.getCircleMembers(M,null,e)}t.$rgDigest()},t.getCircleId=function(){return{data:function(){return{target:M,circleObj:N.circle}}}},t.$on("$destroy",function(){N.circle&&N.circle.resetMembers(),l.unsubscribe(N.memberListSubscriptionKey),l.unsubscribe(N.searchListSubscriptionKey)})}e.module("ringid.circle").controller("CirclePageController",t),t.$inject=["$scope","$routeParams","$location","circlesManager","friendsFactory","Auth","$ringbox","SystemEvents","$$connector","OPERATION_TYPES","circleHttpService","$timeout","APP_CONSTANTS","Ringalert","rgDropdownService","$rootScope","Utils"]}()}(angular,window),function(e,t){"use strict";!function(){function t(e,t,n,r,i){function o(e){return"true"===e||e===!0?r.getCircles(!0):r.getCircles(!1)}var a;r.init(),e.getCircles=o;var s=n.subscribe(function(){a||(a=setTimeout(function(){clearTimeout(a),i.recalculate(e),e.$rgDigest()}))},{action:[t.SYSTEM.CIRCLE.TYPE_GROUP_LIST]});e.$on("$destroy",function(){n.unsubscribe(s)})}e.module("ringid.circle").controller("allCirclePopupController",t),t.$inject=["$scope","OPERATION_TYPES","$$connector","circlesManager","rgScrollbarService"]}()}(angular,window),function(e,t){"use strict";e.module("ringid",["ngRoute","ringid.config","ui-notification","ringid.language","ringid.connector","ringid.global_services","ringid.global_directives","ringid.auth","ringid.filters","ringid.shared","ringid.utils","ringid.directives","ringid.header","ringid.friend","ringid.directives","ringid.controllers","ringid.feed","ringid.sticker","ringid.profile","ringid.circle","ringid.chat","ringid.newsportal","oc.lazyLoad"])}(angular,window),function(e,t){"use strict";function n(t,n,r,i,o,a,s,c){function l(){n.isLoggedIn=a.isLoggedIn(),i.init(),n.isLoggedIn?(RingLogger.warning("USER LOGGED IN appInit()",RingLogger.tags.AUTH),n.currentUser=a.currentUser(),n.templatePath="templates/index-dashboard.html",i.resume(),i.keepAlive(),c.sendGlobal("uId",a.currentUser().getKey())):(RingLogger.warning("USER NOT LOGGED IN appInit()",RingLogger.tags.AUTH),n.templatePath="templates/index-login.html"),n.$rgDigest(),setTimeout(function(){g=!1,n.$rgDigest()})}function u(){i.subscribe(a.handleInvalidSession,{action:[d.TYPE_SESSION_VALIDATION,d.TYPE_INVALID_LOGIN_SESSION,d.TYPE_MULTIPLE_SESSION]}),a.ensureLoginState(),n.$rgDigest()}var d=s.SYSTEM.AUTH,g=!0;n.openSignIn=function(){return{data:function(){return{fromPopup:!0}}}},n.activePath=null,n.currentUser=a.currentUser(),n.templatePath="templates/index-login.html",n.isLoggedIn=!1,n.isPending=function(){return g},n.showFriendsBar=!1,n.toggleFriendsBar=function(){n.showFriendsBar=!n.showFriendsBar,n.$rgDigest()},n.$on(t.AUTH.LOGIN,function(){RingLogger.information("AUTH LOGIN EVENT: ",RingLogger.tags.AUTH),l()}),n.$on("CONNECTION_ERROR",function(){var e=o.getCookie("reloaded");e?i.reset():o.setCookie("reloaded",1)}),n.$on("$locationChangeStart",function(e,t,n){t&&i.notifyRouteChange()}),u(),RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from ROOTSCOPE",RingLogger.tags.DIGEST)}),RingLogger.tags.DIGEST&&n.$watch(function(){RingLogger.info("from AppController",RingLogger.tags.DIGEST)}),n.send=function(t,n){n=n||s.SYSTEM.REQUEST_TYPE.REQUEST,e.isString(t)&&(t=e.fromJson(t)),i.send(t,n)},n.$on("ocLazyLoad.moduleLoaded",function(e,t){RingLogger.print("module loaded",t,RingLogger.tags.OCLOADER)})}var r;r=e.module("ringid").controller("ApplicationController",n),n.$inject=["SystemEvents","$scope","$rootScope","$$connector","Storage","Auth","OPERATION_TYPES","ChatConnector"]}(angular,window),function(e,t){"use strict";var n;n=e.module("ringid").run(["$rootScope","$window","$document","$$connector","$ringhttp","settings",function(t,n,r,i,o,a){function s(e){"inactive"!==d&&t.$broadcast("ringInactive",e),d="inactive"}function c(e){"active"!==d&&t.$broadcast("ringActive",e),d="active"}function l(e){this[u?u+"Hidden":"hidden"]&&"inactive"!==d?(t.$broadcast("ringInactive",e),d="inactive"):"active"!==d&&(t.$broadcast("ringActive",e),d="active")}var u,d,g=e.element(n);i.init(),g.on("inactive",s),g.on("active",c),"hidden"in r?u="":e.forEach(["moz","webkit","ms"],function(e){e+"Hidden"in r[0]&&(u=e)}),e.isDefined(u)&&""!==u&&r[0].addEventListener(u+"visibilitychange",l),o.get(a.constantServer).success(function(t){var n=e.fromJson(t);n.sucs===!0&&a.updateUrlBase(n),n=null})}])}(angular,window),function(e,t){"use strict";e.module("ringid").config(["$compileProvider","$routeProvider","$locationProvider","$httpProvider","RING_ROUTES","settings",function(n,r,i,o,a,s){o.useApplyAsync(!0),n.debugInfoEnabled(s.debugEnabled),o.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var c=function(e){var t,n,r,i,o,a,s,l="";for(t in e)if(n=e[t],n instanceof Array)for(s=0;s<n.length;++s)o=n[s],r=t+"["+s+"]",a={},a[r]=o,l+=c(a)+"&";else if(n instanceof Object)for(i in n)o=n[i],r=t+"["+i+"]",a={},a[r]=o,l+=c(a)+"&";else void 0!==n&&null!==n&&(l+=encodeURIComponent(t)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l};o.defaults.transformRequest=[function(t){return e.isObject(t)&&"[object File]"!==String(t)?c(t):t}],r.when(a.HOME,{templateUrl:"templates/index.html"}).when(a.LOGIN_SOCIAL,{templateUrl:"templates/index.html"}).when(a.SIGNUP_SOCIAL,{templateUrl:"templates/index.html"}).when(a.USER_PROFILE,{templateUrl:"templates/profile/profile.html",resolve:{user:["Api","userFactory","$route","$location","$q","Ringalert","Auth",function(e,t,n,r,i,o,a){var s=i.defer();return a.isPendingAsync().then(function(){var i=t.getUser(n.current.params.uId);i&&i.hasDetails()?s.resolve(i):e.user.getUserDetails({uId:n.current.params.uId}).then(function(e){s.resolve(t.create(e.userDetails))},function(){o.show("User not found","error"),r.path().indexOf("profile")>-1&&r.path("/"),s.reject()})}),s.promise}]}}).when(a.CIRCLE_HOME,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/home/circle.html"}).when(a.SINGLE_FEED,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/index-singlefeed.html"}).when(a.MEDIA_FEEDS,{templateUrl:"templates/home/media.feed.html"}).when(a.WHO_SHARED_FEED,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/index-who-sharedfeed.html"}).when(a.MEDIA_CLOUD,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/media-list.html"}).when(a.MEDIA_CLOUD_MYALBUM,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/my.albums.html"}).when(a.MEDIA_POST,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/media.upload.html",controller:"MediaPostController"}).when(a.MEDIA_CLOUD_ALBUM,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when(a.MEDIA_CLOUD_SEARCH,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/search.result.html",controller:"mSearchResultController"}).when(a.MEDIA_CLOUD_USERMEDIA,{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when("/chat",{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}).when(a.CIRCLE,{templateUrl:"templates/circle-partials/all-circle.html",controller:"allCirclePopupController"}).when("/newsportal",{templateUrl:"pages/newsportal/portal-index.html",controller:"FeedNewsportalController"}).when("/newsportal/following",{templateUrl:"pages/newsportal/following.html",controller:"portalFollowingController"}).when("/newsportal/discover",{templateUrl:"pages/newsportal/discover.html",controller:"portalDiscoverController"}).when("/newsportal/saved",{templateUrl:"pages/newsportal/saved.html",controller:"portalSaveController"}).when("/newsportal/:uid",{templateUrl:"pages/newsportal/profilenews.html",controller:"portalSaveController"}).when("/allnotification",{templateUrl:"templates/partials/all-notification.html"}).when("/allfriendrequest",{templateUrl:"templates/partials/all-friend-request.html"}).when("/medianew",{resolve:{pending:["Auth",function(e){return e.isPendingAsync()}]},templateUrl:"templates/mediapage.html"}).when(a.FAQ,{redirectTo:function(e,n,r){t.location.href=location.protocol+"//"+location.host+"/faq.xhtml"}}).when(a.API_DASHBOARD,{templateUrl:"app/apidashboard/templates/api.index.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","rgDropdownService","$ringbox","PAGE_TITLES","Utils",function(e,n,r,i,o,a,s){function c(t){for(var n=0;n<e.$ignoreScopes.length;n++)g[e.$ignoreScopes[n].$id]&&(e.$ignoreScopes[n].$$childHead=g[e.$ignoreScopes[n].$id]);g=[],t&&(e.$ignoreScopes=[])}var l=0;e.$on("$routeChangeSuccess",function(e,t){RingLogger.print("page title from global change",RingLogger.tags.PAGETITLE),a[t.$$route.originalPath]?s.setPageTitle(a[t.$$route.originalPath],l>0):s.setPageTitle(a.DEFAULT),l++}),e.$on("$routeChangeStart",function(t,a,s){r.isPending()||r.isLoggedIn()||e.doingSilentLogin||"/"===n.url()?(o.closeAll(),i.close(),c(!0)):(n.path("/"),c(!0))}),requestAnimationFrame(function(){});var u=[],d=Object.getPrototypeOf(e),g=[];e.$ignoreScopes=[],d.$coreDigest=d.$digest,d.$rgDigest=function(){if(e.$$phase){if(-1==u.indexOf(this)&&1!=this.$id){u.push(this),u.sort(function(e,t){return e.$id-t.$id});for(var t,n,r,i=[];u.length>1;){t=u.pop();for(var o=u.length-1;o>=0;o--){for(n=u[o],r=t.$parent;r!=n&&null!=r;)r=r.$parent;if(null!=r)break}null==r&&i.push(t)}for(;t=i.pop();)u.push(t)}e.$$postDigest(function(){u.length>0&&u.pop().$rgDigest()})}else{if(1==this.$id&&e.$ignoreScopes.length>0){for(var o=0;o<e.$ignoreScopes.length;o++)g[e.$ignoreScopes[o].$id]=e.$ignoreScopes[o].$$childHead,e.$ignoreScopes[o].$$childHead=null;e.$$postDigest(function(){c()})}this.$coreDigest()}},d.$digest=function(){this.$rgDigest()},d.addIgnore=function(){-1==e.$ignoreScopes.indexOf(this)&&e.$ignoreScopes.push(this)},d.removeIgnore=function(){var t;(t=e.$ignoreScopes.indexOf(this))>-1&&e.$ignoreScopes.splice(t,1)},d.calc=function(){var e,n,r,i=0,o=0;t.performance.now();e=this,n=e;do if(i+=n.$$watchers?n.$$watchers.length:0,o++,!(r=n.$$childHead||n!==e&&n.$$nextSibling))for(;n!==e&&!(r=n.$$nextSibling);)n=n.$parent;while(n=r)}}])}(angular,window);