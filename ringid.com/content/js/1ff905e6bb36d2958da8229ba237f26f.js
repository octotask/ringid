/*! @copywrite Ringid.com  2016-08-13 */
var RingWorker,RingMessageChannel;try{RingMessageChannel=new MessageChannel}catch(e){RingMessageChannel=new BroadcastChannel("ring_channel")}!function(e){"use strict";function t(){var e,t=Cookies.get("top");return t?(e=parseInt(t,10)+1,e>255&&(e=1)):e=1,Cookies.set("top",e),e}e._cti=t();try{e.location.origin||(e.location.origin=e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:"")),RingWorker=new Worker(e.location.origin+"/js/worker/com")}catch(e){RingLogger.warn("Your Browser Is Out Dated. Please Update Your Browser To Use RingId"),RingWorker={addCallback:angular.noop,addEventListener:angular.noop,postMessage:angular.noop}}RingWorker.FNS={},RingWorker.addCallback=function(e,t,n){var r=n||null;this.FNS[e]||(this.FNS[e]=[]),this.FNS[e].push({ctx:r,fn:t})},RingWorker.send=function(e,t,n,r){if(!n||!e)throw new Error("You must sent data and port");this.postMessage({command:"SEND",packetId:t,data:e,flooding:r,port:n,action:e.actn})},RingWorker.addEventListener("message",function(e){var t,n;if(e.data.notifier&&this.FNS[e.data.notifier])for(n=0;n<this.FNS[e.data.notifier].length;n++)t=this.FNS[e.data.notifier][n],t.fn.call(t.ctx,e.data);else RingLogger.warn("message from worker no subs found key: "+e.data.notifier,e,"WORKER_INVALID")}),RingWorker.addCallback("debug",function(e){RingLogger.print.apply(RingLogger,e.m)},RingWorker),RingWorker.addEventListener("error",function(e){RingLogger.alert(e,"WORKER_ERROR")}),RingWorker.pushMessage=function(e,t){try{t?this.postMessage(e,t):this.postMessage(e)}catch(t){RingLogger.debug("Ringworker pushMessage ",e,"CHAT")}},RingWorker.pushMessage({command:"SETTINGS",tabId:e._cti,url:"ws://"+e.location.host+"/DataSocket/"+e._cti,aSkey:Cookies.get("sId"),sKey:Cookies.get("sessionID"),CLIENT_DATA_SIZE:460},[RingMessageChannel.port1])}(window),function(e,t){"use strict";e.emojiSupported=function(){var e,t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d")||"function"!=typeof t.getContext("2d").fillText)&&(e=t.getContext("2d"),e.textBaseline="top",e.font="32px Arial",e.fillText("ðŸ˜ƒ",0,0),0!==e.getImageData(16,16,1,1).data[0])}(),e.eventFix=function(t){var n=t||e.event,r=n.pageX;void 0===r&&(n.pageX=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.pageY=n.clientY+document.body.scrollTop+document.documentElerment.scrollTop)},e.scrollToYOffset=function(t,n){var r=t/(n/15),i=setInterval(function(){e.scrollY<t?e.scrollBy(0,r):clearInterval(i)},15)},Function.prototype.bind||(Function.prototype.bind=function(e){var t,n=Array.prototype.slice.call(arguments,1),r=this,i=function(){};if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return t=function(){return r.apply(this instanceof i?this:e,n.concat(Array.prototype.slice.call(arguments)))},this.prototype&&(i.prototype=this.prototype),t.prototype=new i,t}),String.prototype.format||(String.prototype.format=function(){var e="[object Array]"===Object.prototype.toString.call(arguments[0])?arguments[0]:arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}),String.prototype.supplant||(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t})}),String.prototype.repeat||(String.prototype.repeat=function(e){return Array(e+1).join(this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))},String.prototype.getUTF8Length=function(){var e,t,n=0,r=this;for(e=0;e<r.length;e++)t=r.charCodeAt(e),t<=127?n+=1:t<=2047?n+=2:t>=55296&&t<=57343?(n+=4,e++):n+=t<65535?3:4;return n},String.prototype.toCharCodeArray=function(){var e,t=[];for(e=0;e<this.length;e++)t.push(this.charCodeAt(e));return t},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.contains||(Array.prototype.contains=function(e,t){var n,r;if(!t)return this.indexOf(e);for(n=this.length>>>0,r=Number(arguments[1])||0,r=r<0?Math.ceil(r):Math.floor(r),r<0&&(r+=n);r<n;r++)if(r in this&&t.call(this,this[r],e))return r;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,n,r,i,o,a;if(void 0===this||null===this)throw new TypeError;if(t=Object(this),n=t.length>>>0,"function"!=typeof e)throw new TypeError;for(r=[],i=arguments.length>=2?arguments[1]:void 0,o=0;o<n;o++)o in t&&(a=t[o],e.call(i,a,o,t)&&r.push(a));return r}),Array.prototype.keyValues||(Array.prototype.keyValues=function(e){var t,n=[];for(t=0;t<this.length;t++)this[t][e]&&n.push(this[t][e]);return n}),Array.prototype.values||(Array.prototype.values=function(){var e,t=[];for(e=0;e<this.length;e++)t.push(this[e]);return t}),Array.prototype.joinAsDataView=function(){var e,n,r,i,o=this,a=0,s=0;if(!o.length)return new t(new ArrayBuffer(0));for(e=0;e<o.length;e++)o[e]instanceof t&&(s+=o[e].byteLength);if(!s)return new t(new ArrayBuffer(0));for(r=new ArrayBuffer(s),i=new t(r),e=0;e<o.length;e++)if(o[e]instanceof t)for(n=0;n<o[e].byteLength;n++)i.setUint8(a++,o[e].getUint8(n));return i},Array.prototype.difference=function(e){var t={},n=[],r=0;if(!e||!e.length||!this.length)return this;for(;r<e.length;)t[e[r]]=!0,r++;for(r=0;r<this.length;r++)t[this[r]]||n.push(this[r]);return n},t.prototype.copy=function(e,n){var r,i=this,o=e||0,a=n||i.byteLength,s=new ArrayBuffer(a),c=new t(s);for(r=0;r<a;r++)c.setUint8(r,i.getUint8(o++));return c},t.prototype.merge=function(e,n,r,i,o){var a,s,c=i,l=new t(this.buffer,e,n),u=new ArrayBuffer(l.byteLength+(o-c+1)),d=new t(u);for(a=0;a<l.byteLength;a++)d.setUint8(a,l.getUint8(a));for(s=a;s<d.byteLength;s++)d.setUint8(s,r.getUint8(c++));return d},t.prototype.addAttributeInt=function(e,t,n,r){var i=e;switch(this.setUint8(i++,t),this.setUint8(i++,n),n){case 1:this.setUint8(i++,r);break;case 2:this.setUint16(i,r),i+=2;break;case 4:this.setUint32(i,r),i+=4}return i},t.prototype.addAttributeString=function(e,t,n){var r,i=e;for(this.setUint8(i++,t),this.setUint8(i++,n.length),r=0;r<n.length;r++)this.setUint8(i++,n.charCodeAt(r));return i},t.prototype.addAttributeData=function(e,t,n,r,i){var o,a=e,s=i||n.byteLength,c=r||0;for(this.setUint8(a++,t),this.setUint16(a,s),a+=2,o=0;o<s;o++)this.setUint8(a++,n.getUint8(c++));return a},t.prototype.print_r=function(e,t,n){var r,i,o,a=a||0,s=n||this.byteLength,c="Index\t\tBinary\t\tInteger\t\tChar\n",l="";for(i=a;i<s;i++)o=this.getUint8(i),r=String.fromCharCode(o),c+=i+"\t\t \t\t"+o.toString(2)+"\t\t\t\t"+o+"\t\t\t\t"+r+"\n",l+=r;if(!e||"string"==typeof e)return l},t.prototype.printBytes=function(){var e,t=[];for(e=0;e<this.byteLength;e++)t.push(this.getUint8(e));t.push(-1e3)},t.prototype.getString=function(e,t){for(var n,r,i,o=this,a=[],s=t||o.byteLength,c=e;s>0;)o.getUint8(c)<=127?(a.push(o.getUint8(c++)),s--):o.getUint8(c)>=128&&o.getUint8(c)<=223?(a.push((31&o.getUint8(c++))<<6|63&o.getUint8(c++)),s-=2):o.getUint8(c)>=224&&o.getUint8(c)<=239?(a.push((31&o.getUint8(c++))<<12|((63&o.getUint8(c++))<<6|63&o.getUint8(c++))),s-=3):(i=(7&o.getUint8(c++))<<18|((63&o.getUint8(c++))<<12|((63&o.getUint8(c++))<<6|63&o.getUint8(c++))),i-=65536,n=(i>>10)+55296,r=i%1024+56320,a.push(n,r),s-=4);return String.fromCharCode.apply(null,a)},t.prototype.getStringUtf16=function(e,t,n){var r,i,o,a=0|a,s=s||this.byteLength-a,c=!1,l="",u=!1;for("undefined"!=typeof Buffer&&(l=[],u=!0),s<0&&(s+=this.byteLength),n&&(r=this.getUint16(a),65534===r&&(c=!0),a+=2,s-=2),i=a;i<a+s;i+=2)o=this.getUint16(i,c),o>=0&&o<=55295||o>=57344&&o<=65535?u?l.push(o):l+=String.fromCharCode(o):o>=65536&&o<=1114111&&(o-=65536,u?(l.push(((1047552&o)>>10)+55296),l.push((1023&o)+56320)):l+=String.fromCharCode(((1047552&o)>>10)+55296)+String.fromCharCode((1023&o)+56320));return u?l.toString():decodeURIComponent(escape(l))},t.prototype.getIntByByte=function(e,t){var n,r,i=this,o="";switch(t){case 1:return i.getUint8(e);case 2:return i.getUint16(e);case 4:return i.getUint32(e);case 6:case 8:for(n=e;n<e+t;n++)r=i.getUint8(n).toString(2),o+=r.length<8?"0".repeat(8-r.length)+r:r;return parseInt(o,2);default:return i.getUint8(e)}},t.prototype.getSynch=function(e){for(var t=0,n=2130706432;n;)t>>=1,t|=e&n,n>>=8;return t},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n,r,i,o=e,a=t;return void 0===o&&(o=0),void 0===a&&(a=this.byteLength),o=Math.floor(o),a=Math.floor(a),o<0&&(o+=this.byteLength),a<0&&(a+=this.byteLength),o=Math.min(Math.max(0,o),this.byteLength),a=Math.min(Math.max(0,a),this.byteLength),a-o<=0?new ArrayBuffer(0):(n=new ArrayBuffer(a-o),r=new Uint8Array(n),i=new Uint8Array(this,o,a-o),r.set(i),n)}),t.prototype.setUint64=function(e,t){var n,r,i,o=this,a=Number.isInteger(t)?t.toString(2):parseInt(t,10).toString(2);for(a=a.length<64?"0".repeat(64-a.length)+a:a,n=a.match(/.{1,32}/g),r=n.map(function(e){return parseInt(e,2)}),i=0;i<r.length;i++)o.setUint32(e+4*i,r[i])},t.prototype.getBool=function(e){return 1===this.getUint8(e)},e.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,n=(t.parentNode||t.document).querySelectorAll(e),r=-1;n[++r]&&n[r]!==t;);return!!n[r]},e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(e.Element.prototype),e.requestAnimationFrame=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,t.prototype.getUint24=function(e,t){return t?this.getUint8(e)+(this.getUint8(e+1)<<8)+(this.getUint8(e+2)<<16):this.getUint8(e+2)+(this.getUint8(e+1)<<8)+(this.getUint8(e)<<16)},Math.easeIn=function(e,t,n,r){var i=e;return i/=r/2,i<1?n/2*i*i+t:(i--,-(n/2*(i*(i-2-1)))+t)},e.decodeEntities=function(){var e=document.createElement("div");function t(t){var n=t;return n&&"string"==typeof n&&(n=n.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),n=n.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=n,n=e.textContent,e.textContent=""),n}return t}(),"function"!=typeof Object.assign&&!function(){Object.assign=function(e){var t,n,r,i;if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(t=Object(e),n=1;n<arguments.length;n++)if(r=arguments[n],void 0!==r&&null!==r)for(i in r)r.hasOwnProperty(i)&&(t[i]=r[i]);return t}}()}(window,DataView),function(e,t){"use strict";e.module("ringid.digits",["ringid.config","ringid.global_services"])}(angular,window),angular.module("ringid.digits").service("digitsService",digitsService),digitsService.$inject=["settings"];function digitsService(e){var t=!1;function n(){t||(Digits.init({consumerKey:e.digitsConsumerKey}),t=!0)}this.initialize=n}angular.module("ringid.digits").directive("rgVerifyPhone",rgVerifyPhone),rgVerifyPhone.$inject=["$ringhttp","settings","$http","Auth","Ringalert","MESSAGES","digitsService","Storage","$compile"];function rgVerifyPhone(e,t,n,r,i,o,a,s,c){function l(e,l){var u,d=!1;function g(t){var n,a,s,c,l={mbl:"",mblDc:""};if(t.data.phoneNumber&&t.data.phoneNumber.length>1){for(s=t.data.phoneNumber,c=r.getCountryList(),RingLogger.print(s,RingLogger.tags.PROFILE),n=0;n<c.length;n++)if(a=s.substr(0,c[n].code.length),c[n].code===a){l.mblDc=c[n].code,l.mbl=s.substr(c[n].code.length);break}RingLogger.print(l,RingLogger.tags.PROFILE),e.verify()(l)}else i.show(o.REQUEST_FAILED)}function m(e){RingLogger.print(e,RingLogger.tags.PROFILE)}function E(e){var r=u.find("iframe"),i=e.oauth_echo_headers,o={authHeader:i["X-Verify-Credentials-Authorization"],apiUrl:i["X-Auth-Service-Provider"]};RingLogger.print(e,RingLogger.tags.PROFILE),r&&(r[0].style.height="100%"),n.post(t.digitsServiceUrl,o).then(g)}function f(){var t="",n=s.getData("country");d=!0,u=c('<div class="verify-phone"></div>')(e),l.after(u),n&&n.hasOwnProperty("code")&&(t=n.code),a.initialize(),Digits.embed({container:".verify-phone",phoneNumber:t,theme:{accent:"F47727"}}).done(E).fail(m),e.$rgDigest()}function p(){d=!1,u&&u.remove()}function T(e){e&&!d?f():!e&&d&&p()}e.$watch("enabled",T)}return{restrict:"E",scope:{verify:"&",enabled:"="},link:l}}!function(e,t){"use strict";e.module("ringid.config",[])}(angular,window);var server=location.href.split("/")[2],protocol="http://",baseUrl=location.protocol+"//"+location.host,settingDefault={ac:"http://devauth.ringid.com/rac/",ims:"http://devimages.ringid.com/",imsres:"http://devimagesres.ringid.com/",stmapi:"http://devsticker.ringid.com/",stmres:"http://devstickerres.ringid.com/",vodapi:"http://devmediacloudapi.ringid.com/",vodres:"http://devmediacloud.ringid.com/",apiVersion:140},settings={apiVersion:settingDefault.apiVersion,constantServer:"http://devauth.ringid.com/cnstnts?pf=5&v="+settingDefault.apiVersion+"&apt=1",socketProtocol:"ws://",secure:!1,analytics:!1,debugEnabled:!0,html5Mode:!0,httpsUrl:"http://"+server,siteUrl:server,baseUrl:baseUrl,base:location.host,chatImBase:protocol+"image.ringid.com/chatContens/",chatVideoBase:protocol+"image.ringid.com/chatContens/",chatAudioBase:protocol+"image.ringid.com/chatContens/",tagChatImBase:protocol+"image.ringid.com/groupContents/",chatHeartBeatUrl:baseUrl+"/images/ping.jpg",emotionServer:settingDefault.imsres+"/emoticon/d5/",emoticonBase:protocol+server+"/images/emoticon/",stickerBase:settingDefault.stmres+"stickermarket/d5/",stickerApi:settingDefault.stmapi+"ringmarket/StickerHandler/?pf=5&v="+settingDefault.apiVersion+"&",imMediaBase:protocol+"image.ringid.com/ringmarket/ChatImageHandler",digitsServiceUrl:"http://www.ringid.com/DigitsService",digitsConsumerKey:"wnZ1SukFsxdnr22U4PLiS3T9J",twitterApiURL:"http://api.twitter.com/1.1/account/verify_credentials.json",ogServiceUrl:protocol+server+"/OGService",sessionTimeout:216e5,FEED_LIMIT:6,FEED_TEXT_LIMIT:65335,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,USERS_PRESENCE_REFRESH_INTERVAL:3,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE"},PLATFORM={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},RING_ROUTES={HOME:"/",PROFILE:"/profile/:uId/:subpage?/:albumId?",CIRCLE:"/circle/:circleId/:subpage?",CIRCLE_LIST:"/circles",CHAT:"/chat/single",CHAT_GROUPS:"/chat/groups",CHAT_GROUP:"/chat/group/:tagId",WHO_SHARED_FEED:"/feed_shares/:feedId/:commentId?",SINGLE_FEED:"/feed/:feedId/:commentId?/:shared?",SINGLE_IMAGE:"/image/:imageId/:commentId?",SINGLE_MEDIA:"/media/:mediaId/:commentId?",MEDIA_FEEDS:"/medias",LOGIN_SOCIAL:"/social/:operation/:platform/:token",SIGNUP_SOCIAL:"/social/:operation/:platform/:token",NEWSPORTAL:"/newsportal/:portalid?",NEWSPORTAL_FEED:"/newsportal",NEWSPORTAL_FOLLOWING:"/newsportal/following",NEWSPORTAL_DISCOVER:"/newsportal/discover",NEWSPORTAL_SAVED:"/newsportal/saved",PAGE:"/page/:portalid",PAGES_FEED:"/pages",PAGES_FOLLOWING:"/pages/following",PAGES_DISCOVER:"/pages/discover",PAGES_SAVED:"/pages/saved",NOTIFICATIONS:"/allnotification",FRIEND_REQUESTS:"/allfriendrequest",MEDIA_CLOUD:"/media",MEDIA_POST:"/media/upload",MEDIA_CLOUD_MYALBUM:"/media/myalbums",MEDIA_CLOUD_ALBUM:"/media/:albumtype",MEDIA_CLOUD_SEARCH:"/media/:stype/:sk?",MEDIA_CLOUD_USERMEDIA:"/media/:albumtype/:utid/:albumid",FAQ:"/faq",API_DASHBOARD:"/apidashboard"},DEFAULTS_TITLE="ringID: Free Video Calls, Secret Chats, Feeds, Stickers & more",PAGE_TITLES={DEFAULT:DEFAULTS_TITLE};function setUrlBase(e){settings.signupInit=e.ac+"ringid?pf=5&v="+settings.apiVersion+"&",settings.signupSocialInit=e.ac+"comports?pf=5&v="+settings.apiVersion+"&",settings.imBase=e.imsres,settings.imServer=e.ims+"ringmarket/",settings.mediaServer=e.vodapi+"/stream/",settings.mediaBase=e.vodres,settings.stickerBase=e.stmres+"stickermarket/d5/",settings.stickerApi=e.stmapi+"ringmarket/StickerHandler/?pf=5&v="+settings.apiVersion+"&"}settings.updateUrlBase=setUrlBase,settings.updateUrlBase(settingDefault),PAGE_TITLES[RING_ROUTES.HOME]=DEFAULTS_TITLE,PAGE_TITLES[RING_ROUTES.CIRCLE]="ringID Circle",PAGE_TITLES[RING_ROUTES.CIRCLE_LIST]="ringID Circles",PAGE_TITLES[RING_ROUTES.SINGLE_FEED]=DEFAULTS_TITLE,PAGE_TITLES[RING_ROUTES.MEDIA_FEEDS]="Media Feeds",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_POST]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_MYALBUM]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_ALBUM]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_SEARCH]="Media Cloud",PAGE_TITLES[RING_ROUTES.MEDIA_CLOUD_USERMEDIA]="Media Cloud",PAGE_TITLES[RING_ROUTES.NEWSPORTAL]="News Portal",PAGE_TITLES[RING_ROUTES.PAGES]="Pages",angular.module("ringid.config").constant("settings",settings).constant("PLATFORM",PLATFORM).constant("RING_ROUTES",RING_ROUTES).constant("PAGE_TITLES",PAGE_TITLES).constant("MIN_TIMESTAMP",0xe87c62b0141);var ATTRIBUTE_CODES={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166,ADDED_TIME:168};angular.module("ringid.config").constant("ATTRIBUTE_CODES",ATTRIBUTE_CODES),angular.module("ringid.config").constant("REASON_CODES",{NONE:0,PERMISSION_DENIED:1,PASSCODE_SENT_INTERVAL:2,DONT_DISTURB_MODE:3,ALREADY_SHARED:4,NOT_TAG_MEMBER:5,TAG_DOES_NOT_EXIST:6,SMS_SENDING_FAILED:7,EMAIL_SENDING_FAILED:8,FRIEND_OFFLINE:9,NOT_FRIEND:10,USERID_FRIENDID_SAME:11,ALREADY_FRIEND_REQUESTED:12,EXCEPTION_OCCURED:13,DATABASE_ROLL_BACKED:14,CANT_SHARE_OWN_FEED:15,FRIEND_DID_NOT_FOUND:16,SMS_SEND_RETRY_LIMIT_OVER:17,NO_MORE_FEED:18,NOT_FOUND:404}).constant("SystemEvents",{COMMON:{WINDOW_RESIZED:"WINDOW_RESIZED",WINDOW_SCROLLED:"WINDOW_SCROLLED",COLUMN_CHANGED:"COLUMN_CHANGED",LOADING:"LOADING"},MEDIA:{SLIDER_IMAGE_LOADED:"SLIDER_IMAGE_LOADED"},PORTAL:{DONE_FOLLOW_PORTAL:"DONE_FOLLOW_PORTAL",UNFOLLOW_PORTAL:"UNFOLLOW_PORTAL"},BUSINESS:{DONE_FOLLOW_BUSINESS:"DONE_FOLLOW_BUSINESS",UNFOLLOW_BUSINESS:"UNFOLLOW_BUSINESS"},RINGBOX:{UPDATE:"CONTENT_UPDATE"},CIRCLE:{MY_CIRCLE_LIST_FETCH_COMPLETE:"MY_CIRCLE_LOAD_COMPLETE",MY_CIRCLE_LIST_PROCESS_COMPLETE:"MY_CIRCLE_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE:"MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE",MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE:"MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE:"MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE",MY_CIRCLE_MEMBER_REMOVED:"MY_CIRCLE_MEMBER_REMOVED",MY_CIRCLE_REMOVED:"MY_CIRCLE_REMOVED",MY_CIRCLE_UPDATE_MEMBER_COUNT:"MY_CIRCLE_UPDATECOUNT"},FILE_UPLOAD:{PROGRESS_UPDATE:"PROGRESS_UPDATE",QUEUE_START:"QUEUE_START",QUEUE_COMPLETE:"QUEUE_COMPLETE",UPLOADS_POSTED:"UPLOADS_POSTED"},ALBUM:{PHOTOS_SELECTED:"PHOTOS_SELECTED"},IMAGE:{DO_REPOSITION:"DO_REPOSITION",RESIZE:"RESIZE"},FEED:{UPDATED:"UPDATED",CREATED:"CREATED",DELETED:"DELETED",RESET:"RESET",HEIGHT:"HEIGHT",BUSY:"BUSY"},FRIEND:{PENDING_FRIENDS_COUNT_CHANGED:"PENDING_FRIENDS_COUNT_CHANGED",UTID_LIST_RECEIVED:"UTID_LIST_RECEIVED"},AUTH:{LOGIN:"LOGIN",LOGIN_REQUIRED:"LOGIN_REQUIRED",LOGIN_DONE:"LOGIN_DONE"},CHAT:{BOX_CAM_UPLOAD:"BOX_CAM_UPLOAD",BOX_OPENNED:"BOX_OPENNED",BOX_UPDATED:"BOX_UPDATED",WAS_FOCUSED:"WAS_FOCUSED",NEW_MESSAGE_PUSHED:"NEW_MESSAGE_PUSHED",MESSAGE_RECEIVED:"MESSAGE_RECEIVED",UNREAD_MESSAGE_INFO_UPDATED:"UNREAD_MESSAGE_INFO_UPDATED",SINGLE_MESSAGE_UPDATED:"SINGLE_MESSAGE_UPDATED",SINGLE_MESSAGE_TIMEOUT:"SINGLE_MESSAGE_TIMEOUT",MESSAGE_SUBMITTED:"MESSAGE_SUBMITTED",MESSAGE_PUSHED:"MESSAGE_PUSHED",DO_START_SECRET_TIMER:"DO_START_SECRET_TIMER",SIMPLE_MESSAGE_TIMEOUT:"SIMPLE_MESSAGE_TIMEOUT",MY_TAG_LIST_RECEIVED:"MY_TAG_LIST_RECEIVED",TAG_LIST_UPDATED:"TAG_LIST_UPDATED",TAG_REGISTERED:"TAG_REGISTERED",TAG_UNREGISTERED:"TAG_UNREGISTERED",TAG_MEMBER_FETCHED:"TAG_MEMBER_FETCHED",TAB_SYNC_NEW_DATA:"TAB_SYNC_NEW_DATA",HISTORY_LOADED:"HISTORY_LOADED",API_HISTROY_PROCESSED:"API_HISTROY_PROCESSED",CHAT_REGISTER:"CHAT_REGISTER",TAB_SYNC:"TAB_SYNC",SCROLL_TO_BOTTOM:"SCROLL_TO_BOTTOM",SCROLL_TO_UNREAD:"SCROLL_TO_UNREAD",CONVERSATION_COUNT_RESETED:"CONVERSATION_COUNT_RESETED"}}).constant("MESSAGES",{REQUEST_PROCESSED:"Your Request Was Successfully Processed",REQUEST_FAILED:"Your Request Was Failed ! Please Try Later.",RC0:"NONE.",RC1:"PERMISSION_DENIED",RC2:"PASSCODE_SENT_INTERVAL",RC3:"DONT_DISTURB_MODE",RC4:"You have already shared this post.",RC5:"NOT_TAG_MEMBER.",RC6:"TAG_DOES_NOT_EXIST.",RC7:"SMS_SENDING_FAILED.",RC8:"EMAIL_SENDING_FAILED.",RC9:"FRIEND_OFFLINE",RC10:"You are not permitted to share this post",RC11:"USERID_FRIENDID_SAME",RC12:"ALREADY_FRIEND_REQUESTED",RC13:"EXCEPTION_OCCURED",RC14:"DATABASE_ROLL_BACKED",RC15:"You Can't Share Your Own Post",RC16:"FRIEND_DID_NOT_FOUND",RC17:"SMS_SEND_RETRY_LIMIT_OVER",RC18:"NO_MORE_FEED",RC19:"UNKNOWN",RC20:"UNKNOWN",RC21:"LOGGED_IN_FROM_ANOTHER_DEVICE",RC22:"UNKNOWN",RC23:"UNKNOWN",RC26:"USER_EXIST",RC27:"DUPLICATE_DATA",RC33:"THIS_IS_SPECIAL_FRIEND",RC37:"ANONYMOUS_CHAT_PERMISSION_DENIED",RC24:"Wrong Password.",RC38:"Could not find DeviceID!",RC39:"This phone number is not verified.",RC40:"This email is not verified.",RC41:"Your facebook ID is not verified.",RC42:"Your twitter ID is not verified.",RC43:"Could not find Your facebook ID.",RC44:"Could not find Your twitter ID.",RC45:"Wrong RingID!",RC46:"Wrong Phone number!",RC47:"Wrong Email!",RC48:"Device Id required!",RC49:"Password required",RC50:"Login Type required",RC51:"Phone country code required!",RC52:"Phone number required!",RC53:"RingID required!",RC54:"Email required!",RC55:"Version required!",RC56:"Device required!",RC57:"Wrong information",RC60:"Friend limit over!",RC64:"Pending friend limit over!",RC65:"Friend's pending friend limit over",RC66:"Friend's friend limit over",RC79:"You are blocked by authority for spam contents",RC404:"NOT_FOUND",CRCFS1:"Wall post can't be shared",CRCFS2:"Group post can't be shared",CRCFS3:"You already shared this post",FEED_INV:"Please insert some text or upload an image!",FTL_ERROR:"A status can't be longer than {max_limit} characters, but this one is {length} characters long. Please make it a little shorter and try again.",FEED:{ACT_1:"{0} liked this post",ACT_2:"{0} commented on this post",ACT_3:"{0} shared this post",TYPE_0:"{0}",TYPE_11:"{0}",TYPE_11C:"{0} posted",TYPE_11F:"{0} posted",TYPE_12:"{0} have||has updated profile picture",TYPE_13:"{0} have||has updated cover picture",TYPE_2:"{0}",TYPE_2L:"{0} shared a link",TYPE_2C:"{0} posted",TYPE_2CL:"{0} shared a link",TYPE_2F:"{0} posted",TYPE_2FL:"{0} shared a link",TYPE_3:"{0} have||has added {1} photos",TYPE_4:"{0} created a album",TYPE_50:"{0} added {1} music",TYPE_51:"{0} shared {1}'s music",TYPE_60:"{0} added {1} video",TYPE_62:"{0} shared {1}'s video",TYPE_D:"{0}",C_POSTFIX:" in {0}",F_POSTFIX:" on {0}'s timeline",TYPE_SHARE:"{0} shared {1}'s feed"},NEWSPORTAL:{C_UNFOLLOW:"Are you sure you want to unfollow?"}}).constant("APP_CONSTANTS",{NOT_FRIEND:0,FRIEND:1,INCOMING_FRIEND:2,OUTGOING_FRIEND:3,TYPE_SEARCH_BY_ALL:0,TYPE_SEARCH_BY_NAME:1,TYPE_SEARCH_BY_PHONE:2,TYPE_SEARCH_BY_EMAIL:3,TYPE_SEARCH_BY_RINGID:4,TYPE_SEARCH_BY_LOCATION:5,IMAGE_UPLOAD_LIMIT:40,VIDEO_UPLOAD_LIMIT:5,AUDIO_UPLOAD_LIMIT:5,COVER_PIC_UPLOAD_MAXIMUM_WIDTH:1480,COVER_PIC_UPLOAD_MAXIMUM_HEIGHT:2048,COVER_PIC_UPLOAD_MINIMUM_WIDTH:740,COVER_PIC_UPLOAD_MINIMUM_HEIGHT:280,PROFILE_PIC_UPLOAD_MINIMUM_WIDTH:100,PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT:100,COVER_PIC_CROP_WIDTH:1480,COVER_PIC_CROP_HEIGHT:450,PROFILE_PIC_CROP_WIDTH:200,IMAGE_UPLOAD_MIN_WIDTH:10,IMAGE_UPLOAD_MIN_HEIGHT:10,MEDIA_UPLOAD_SIZE_LIMIT:524288e3,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE",NEWS_FEED_MEDIA_TYPE_AUDIO:1,NEWS_FEED_MEDIA_TYPE_VIDEO:2}).constant("PrivacySet",{PVC1:{icon:"img_sprite post-ico only-i",iconfeed:"img_sprite post-ico-gray only-i",text:"Only me",value:1},PVC2:{icon:"img_sprite post-ico fri-i",iconfeed:"post-ico-gray fri-i",text:"Friends",value:2},PVC3:{icon:"img_sprite post-ico pub-i",iconfeed:"img_sprite post-ico-gray pub-i",text:"Public",value:3}}).constant("SPAM_TYPES",{USER:1,FEED:2,IMAGE:3,MEDIA:4}).constant("CLIENT_DATA_SIZE",460).constant("AUTH_SERVER_CONFIG",{REQUEST_DELAY:200}).value("DATE_FORMAT","MMM d, y h:mm a").value("STICKER_IMAGE_TYPE",{EMOTICON:1,LARGE_EMOTICON:2,STICKER:3}).value("STICKER_COLLECTION_CATEGORY_PRE_FETCH_COUNT",5),angular.module("ringid.config").constant("OPERATION_TYPES",{SYSTEM:{REQUEST_TYPE:{KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:114,TYPE_NEWS_FEED:88,TYPE_MY_NEWS_FEED:94,TYPE_FRIEND_NEWSFEED:110,TYPE_GROUP_NEWS_FEED:198,TYPE_MEDIAS_NEWS_FEED:87,TYPE_NEWS_PORTAL_FEED:295,TYPE_BUSINESS_PAGE_FEED:306,TYPE_COMMENTS_FOR_STATUS:84,ACTION_SHARE_STATUS:191,ACTION_GET_FULL_COMMENT:137,TYPE_ADD_MULTI_IMAGE:117,TYPE_ADD_STATUS:177,NEWS_FEED_TYPE_IMAGE:1,NEWS_FEED_TYPE_STATUS:2,NEWS_FEED_TYPE_MULTIPLE_IMAGE:3,NEWS_FEED_TYPE_ALBUM:4,NEWS_FEED_TYPE_AUDIO:5,NEWS_FEED_TYPE_VIDEO:6,TYPE_SINGLE_IMAGE_STATUS:1,TYPE_TEXT_STATUS:2,TYPE_MULTI_IMAGE_STATUS:3,TYPE_DELETE_STATUS:179,TYPE_EDIT_STATUS:178,TYPE_LIKE_STATUS:184,TYPE_UNLIKE_STATUS:186,TYPE_ADD_STATUS_COMMENT:181,TYPE_LIKE_COMMENT:123,TYPE_UNLIKE_COMMENT:125,TYPE_DELETE_STATUS_COMMENT:183,TYPE_EDIT_STATUS_COMMENT:189,TYPE_LIKES_FOR_STATUS:92,TYPE_LIST_LIKES_OF_COMMENT:116,TYPE_TAG_USER_LIST:274,TYPE_WHO_SHARES_LIST:249,TYPE_UPDATE_ADD_STATUS:377,TYPE_UPDATE_EDIT_STATUS:378,ACTION_UPDATE_SHARE_STATUS:391,TYPE_UPDATE_LIKE_STATUS:384,TYPE_UPDATE_UNLIKE_STATUS:386,TYPE_UPDATE_DELETE_STATUS:379,TYPE_UPDATE_ADD_STATUS_COMMENT:381,TYPE_UPDATE_LIKE_COMMENT:323,TYPE_UPDATE_UNLIKE_COMMENT:325,TYPE_UPDATE_DELETE_STATUS_COMMENT:383,TYPE_UPDATE_EDIT_STATUS_COMMENT:389,ALBUM:{TYPE_UPLOAD_ALBUM_IMAGE:85,TYPE_UPDATE_UPLOAD_ALBUM_IMAGE:90,TYPE_DELETE_ALBUM_IMAGE:176,TYPE_UPDATE_DELETE_ALBUM_IMAGE:376},AUTH:{TYPE_INVALID_LOGIN_SESSION:19,TYPE_SIGN_IN:20,TYPE_SIGN_OUT:22,TYPE_SIGN_UP:21,PHN_MAIL_VERIFICATION_CHECK:28,TYPE_SESSION_VALIDATION:76,TYPE_MULTIPLE_SESSION:75,SIGNUP_SEND_CODE_EMAIL:220,SIGNUP_SEND_CODE_PHONE:100,SIGNUP_REGISTER:126,PASSWORD_RECOVER_OPTIONS:222,PASSWORD_RECOVER_SEND_CODE:217,PASSWORD_RECOVER_VERIFY_CODE:218,PASSWORD_RECOVER:219},FRIENDS:{TYPE_CONTACT_UTIDS:29,TYPE_CONTACT_LIST:23,TYPE_PEOPLE_YOU_MAY_KNOW:31,TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:32,TYPE_FRIEND_CONTACT_LIST:107,TYPE_CONTACT_SEARCH:34,ACTION_FRIEND_SEARCH:35,TYPE_ADD_FRIEND:127,TYPE_UPDATE_ADD_FRIEND:327,TYPE_DELETE_FRIEND:128,TYPE_UPDATE_DELETE_FRIEND:328,TYPE_ACCEPT_FRIEND:129,TYPE_UPDATE_ACCEPT_FRIEND:329,TYPE_ACTION_BLOCK_UNBLOCK_FRIEND:243,TYPE_ACTION_CHANGE_FRIEND_ACCESS:244},NOTIFICATION:{TYPE_MY_NOTIFICATIONS:111,TYPE_SINGLE_NOTIFICATION:113,CLEAR_NOTIFICATION_COUNTER:195,MSG_TYPE_UPDATE_PROFILE_IMAGE:1,MSG_TYPE_UPDATE_COVER_IMAGE:2,MSG_TYPE_ADD_FRIEND:3,MSG_TYPE_ACCEPT_FRIEND:4,MSG_TYPE_ADD_GROUP_MEMBER:5,MSG_TYPE_ADD_STATUS_COMMENT:6,MSG_TYPE_LIKE_STATUS:7,MSG_TYPE_LIKE_COMMENT:8,MSG_TYPE_ADD_COMMENT_ON_COMMENT:9,MSG_TYPE_SHARE_STATUS:10,MSG_TYPE_LIKE_IMAGE:11,MSG_TYPE_IMAGE_COMMENT:12,MSG_TYPE_LIKE_IMAGE_COMMENT:13,MSG_TYPE_LIKE_AUDIO_MEDIA:17,MSG_TYPE_AUDIO_MEDIA_COMMENT:18,MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:19,MSG_TYPE_AUDIO_MEDIA_VIEW:20,MSG_TYPE_LIKE_VIDEO_MEDIA:21,MSG_TYPE_VIDEO_MEDIA_COMMENT:22,MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:23,MSG_TYPE_VIDEO_MEDIA_VIEW:24,MSG_TYPE_YOU_HAVE_BEEN_TAGGED:25,MSG_TYPE_UPGRADE_FRIEND_ACCESS:14,MSG_TYPE_ACCEPT_FRIEND_ACCESS:15,MSG_TYPE_DOWNGRADE_FRIEND_ACCESS:16},CIRCLE:{TYPE_CREATE_GROUP:50,TYPE_GROUP_DETAILS:52,TYPE_LEAVE_GROUP:53,TYPE_GROUP_LIST:70,TYPE_GROUP_MEMBERS_LIST:99,TYPE_GROUP_MEMBERS_SEARCH_RESULT:101,TYPE_DELETE_GROUP:152,TYPE_REMOVE_GROUP_MEMBER:154,TYPE_ADD_GROUP_MEMBER:156,TYPE_EDIT_GROUP_MEMBER:158,TYPE_UPDATE_ADD_GROUP:352,TYPE_UPDATE_DELETE_GROUP:352,TYPE_UPDATE_REMOVE_GROUP_MEMBER:354,TYPE_UPDATE_ADD_GROUP_MEMBER:356,TYPE_UPDATE_EDIT_GROUP_MEMBER:358,TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:51},CHAT:{FRIEND_CHAT_REQUEST:175,FRIEND_CHAT_UPDATE:375},TAG_CHAT:{TAG_CHAT_REQUEST_START:134,TAG_CHAT_UPDATE_START:334,TAG_CHAT_REQUEST_ADD_MEMBER:135,TAG_CHAT_UPDATE_ADD_MEMBER:335},PORTAL:{ACTION_NEWSPORTAL_LIST:299,ACTION_NEWSPORTAL_CATEGORIES_LIST:294,ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL:296,ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED:300,ACTION_NEWSPORTAL_BREAKING_FEED:302,ACTION_CONTACT_SEARCH:34},MEDIA:{ACTION_CHECK_MEDIA_IN_ALBUMS:1006,ACTION_ADD_MEDIA_CONTENT:258,ACTION_UPDATE_MEDIA_CONTENT:259,ACTION_DELETE_MEDIA_CONTENT:260,ACTION_MEDIA_ALBUM_CONTENT_LIST:261,ACTION_MEDIA_CONTENT_DETAILS:262,ACTION_ADD_MEDIA_ALBUM:253,ACTION_UPDATE_MEDIA_ALBUM:254,ACTION_DELETE_MEDIA_ALBUM:255,ACTION_MEDIA_ALBUM_LIST:256,ACTION_MEDIA_ALBUM_DETAILS:257,ACTION_MEDIA_SEARCH_RESULT:277,ACTION_SPECIFIC_MEDIA_RESULT:278,ACTION_GET_TAGGED_MEDIA_SONGS:279,ACTION_GET_MEDIA_SLIDER_IMG:1005,ACTION_GET_HASHTAG_SUGGESTION:280,ACTION_GET_TRENDING_KEYWORDS:281,ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT:272,ACTION_ADD_COMMENT_ON_MEDIA:265,ACTION_LIKE_UNLIKE_MEDIA:264,ACTION_EDIT_COMMENT_ON_MEDIA:266,ACTION_MEDIA_COMMENT_LIST:270,ACTION_MEDIA_LIKE_LIST:269,ACTION_DELETE_COMMENT_ON_MEDIA:267,ACTION_LIKE_UNLIKE_MEDIA_COMMENT:268,ACTION_MEDIACOMMENT_LIKE_LIST:271,ACTION_UPDATE_LIKE_UNLIKE_MEDIA:464,ACTION_UPDATE_ADD_MEDIA_COMMENT:465,ACTION_UPDATE_EDIT_MEDIA_COMMENT:466,ACTION_UPDATE_DELETE_MEDIA_COMMENT:467,ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:468,ACTION_UPDATE_INCREASE_MEDIA_CONTENT_VIEW_COUNT:472},IMAGE:{PROFILE_IMAGE_ALBUM_ID:"profileimages",COVER_IMAGE_ALBUM_ID:"coverimages",FEED_IMAGE_ALBUM_ID:"default",TYPE_FRIEND_ALBUM_IMAGES:109,FETCH_ALBUM_LIST:96,FETCH_FRIEND_ALBUM_LIST:108,TYPE_ALBUM_IMAGES:97,TYPE_COMMENTS_FOR_IMAGE:89,TYPE_LIKES_FOR_IMAGE:93,TYPE_IMAGE_COMMENT_LIKES:196,TYPE_LIKE_IMAGE:185,TYPE_UNLIKE_IMAGE:187,TYPE_IMAGE_DETAILS:121,TYPE_EDIT_IMAGE_COMMENT:194,TYPE_ADD_IMAGE_COMMENT:180,TYPE_LIKE_UNLIKE_IMAGE_COMMENT:197,TYPE_DELETE_IMAGE_COMMENT:182,DELETE_IMAGE:246,TYPE_UPDATE_ADD_IMAGE_COMMENT:380,TYPE_UPDATE_EDIT_IMAGE_COMMENT:394,TYPE_UPDATE_DELETE_IMAGE_COMMENT:382,TYPE_UPDATE_LIKE_IMAGE:385,TYPE_UPDATE_UNLIKE_IMAGE:387,TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:397},PROFILE:{TYPE_CHANGE_COVER_PIC:103,TYPE_CHANGE_PROFILE_PIC:63,TYPE_REMOVE_PROFILE_IMAGE:43,TYPE_REMOVE_COVER_IMAGE:104,TYPE_ACTION_USER_MOOD:193,TYPE_ACTION_USER_MOOD_PRESENCE:199,FETCH_FRIEND_MUTUAL_FRIEND_LIST:118,CHANGE_PASSWORD:130,ACTION_USERS_PRESENCE_DETAILS:136,ACTION_USERS_PRESENCE_DETAILS_DATA:336,TYPE_ACTION_CURRENT_USER_BASICINFO:21,TYPE_ACTION_OTHER_USER_BASICINFO:95,TYPE_ACTION_GET_USER_DETAILS:204,TYPE_ACTION_LIST_WORK_AND_EDUCATIONS:230,TYPE_ACTION_MODIFY_USER_PROFILE:25,
TYPE_ACTION_MODIFY_PRIVACY_SETTINGS:74,TYPE_CHANGE_PRIVACY:216,TYPE_CHANGE_FRIEND_PRIVACY:82,SEND_VERIFICATION_CODE_TO_MAIL:221,SEND_VERIFICATION_CODE_TO_PHONE:212,TYPE_ACTION_ADD_EDUCATION:231,TYPE_ACTION_UPDATE_EDUCATION:232,TYPE_ACTION_REMOVE_EDUCATION:233,TYPE_ACTION_GET_WORK:234,TYPE_ACTION_GET_EDUCATION:235,TYPE_ACTION_GET_SKILL:236,TYPE_ACTION_ADD_SKILL:237,TYPE_ACTION_UPDATE_SKILL:238,TYPE_ACTION_REMOVE_SKILL:239,TYPE_ACTION_ADD_WORK:227,TYPE_ACTION_UPDATE_WORK:228,TYPE_ACTION_REMOVE_WORK:229,ADD_SOCIAL_NETWORK:276},REPORT:{ACTION_SPAM_REASON_LIST:1001,ACTION_REPORT_SPAM:1002},FETCH_EMOTION_LIST:273},STICKER:{GET_MY_STICKER:206,ADD_REMOVE_STICKER:207,ADD_JT_VALUE:1,REMOVE_JT_VALUE:3}}),function(e,t){"use strict";e.module("ringid.language",[])}(angular,window),angular.module("ringid.language").factory("languageConstant",languageConstant);function languageConstant(){var e={default:{add_friend:"Add Friend",remove_friend:"Remove Friend",common_friend:"Common Friend",request_sent:"Request Sent",unfriend:"Unfriend",block:"Block",unblock:"UnBlock",edit:"Edit",update:"Update",delete:"Delete",cancel:"Cancel",save:"Save",text_add:"Add",accept:"Accept",remove:"Remove",change:"Change",send:"Send",verify:"verify",add:"Add"}};function t(t){e[t]={}}function n(t){var n=t||"default";return e[n]}return{set:t,get:n}}!function(e,t){"use strict";e.module("ringid.connector",["ngWebSocket","ringid.config"])}(angular,window),angular.module("ringid.connector").factory("$$rgsyncher",rgSynchar),rgSynchar.$inject=["$$stackedMap","$rootScope","Utils"];function rgSynchar(e,t,n){var r=e.createNew();function i(){r.length()>0&&o()}function o(){var e;r.doForAll(function(t){e=t.call(null),e&&!e.$$phase&&e.$digest()})}t.$on("ringActive",i);function a(e){var t=n.getUniqueID();return r.add(t,e),t}function s(e){return r.remove(e)}return{add:a,remove:s,synch:i}}angular.module("ringid.connector").service("mergerService",mergerService),mergerService.$inject=["$$q"];function mergerService(e){var t;function n(){var t=e.defer(),n={};function r(e){var r,i,o,a,s,c={};if(e.seq||e.totalPacket){if(r=e.pckId,n[e.pckId]||(n[e.pckId]=[]),t.notify(e),e.seq?(i=e.seq.lastIndexOf("/"),o=e.seq.substr(0,i),s=parseInt(e.seq.substr(i+1,e.seq.length),10)):(o=e.packetNo,s=parseInt(e.totalPacket,10)),n[e.pckId]["sq"+o])return!0;if(n[e.pckId]["sq"+o]=!0,n[e.pckId].push(e),s===n[e.pckId].length){for(a=0;a<n[e.pckId].length;a++)for(r in n[e.pckId][a])n[e.pckId][a][r]instanceof Array?c[r]=(c[r]||[]).concat(n[e.pckId][a][r]):c[r]=n[e.pckId][a][r];return t.resolve(c),delete n[e.pckId],!1}return!0}return t.resolve(e),!1}return{resolve:r,promise:t.promise}}return t={defer:n}}angular.module("ringid.connector").factory("$$connector",$$connector),$$connector.$inject=["settings","Storage","$rootScope","$websocket","$$stackedMap","ATTRIBUTE_CODES","Utils","$$q","OPERATION_TYPES","CLIENT_DATA_SIZE","mergerService"];function $$connector(e,t,n,r,i,o,a,s,c,l,u){var d,g={},m=i.createNew(),E=[],f=i.createNew();function p(e){return function(t){var n;if(!t||!t.actn)return!1;if(!angular.isArray(e))return t.actn===e;for(n=0;n<e.length;n++)if(t.actn===e[n])return!0;return!1}}function T(e){var t;return g[e.pckId]===!0||!!g[e.pckId]&&(t=g[e.pckId].resolve.call(g[e.pckId],e),t||(g[e.pckId]=!!t,setTimeout(function(){delete g[e.pckId]},3e3)),!0)}function h(e){var t=!1;return m.length()>0&&(m.doForAll(function(n){var r,i=n.filter;i?angular.isFunction(i)&&(r=i.call(null,e),r&&(t=!0,n.fn.call(n,e))):n.fn.call(null,e)}),t||RingLogger.print("No Subscriber Found For action : "+e.actn,e,RingLogger.tags.CONNECTION)),t}function I(e){var t,n;if(e){if(e.actn===c.SYSTEM.AUTH.TYPE_INVALID_LOGIN_SESSION)return void h(e);e.hasOwnProperty("pckId")&&(t=T(e)),t||(n=h(e),n||E.push(e))}}function _(){return RingLogger.print("On before unload connection closed",RingLogger.tags.CONNECTION),n.unloadWarn?"You have unsaved changes.  Do you want to leave this page and lose your changes?":angular.noop()}window.onbeforeunload=_;function A(){RingLogger.print("connector init called",RingLogger.tags.CONNECTION)}function S(e,t,n,r){var i;i=e.pckId||a.getUniqueID(),e.pckId=i,RingLogger.print(e,"SEND"),n&&(g[i]=n),e&&RingWorker.send(e,i,t,r)}function C(e,t,n,r){var i=n?u.defer():s.defer();return S(e,t,i,r),i.promise}function v(){RingLogger.alert("connection close request please see condition",RingLogger.tags.CONNECTION)}function D(e,t,n){S(e,t,!1,n)}function R(e,t,n){return C(e,t,!1,n)}function M(e,t,n){return C(e,t,!0,n)}function N(e,t){var r,i,o=[],s=t||{};if(s.key=s.key||a.getUniqueID(),s.scope=s.scope||n,s.autoApply=!1,s.fn=e||angular.noop,!s.filter&&s.action&&(s.filter=p(s.action)),m.add(s.key,s),s.callWithUnresolved){for(r=0;r<E.length;r++)i=s.filter.call(null,E[r]),i?s.fn.call(null,E[r]):o.push(E[r]);E.length=0,E=o}return s.key}function y(e){m.remove(e)}function b(){}function O(){}function P(){}function L(e){var t=a.getUniqueID();return f.add(t,e),t}function U(e){f.remove(e)}function F(){RingWorker.pushMessage({command:"KEEPALIVE",aSkey:t.getCookie("sId"),uKey:t.getCookie("uId")})}function w(){RingWorker.pushMessage({command:"ROUTE_CHANGE"})}return d={init:A,close:v,send:D,request:R,pull:M,subscribe:N,unsubscribe:y,stop:b,resume:O,reset:P,addInterval:L,removeInterval:U,keepAlive:F,notifyRouteChange:w},RingWorker.addCallback("received",function(e){I(e.data)}),RingWorker.addCallback("event",function(e){e.name&&n.$broadcast(e.name)}),d}!function(e,t){"use strict";e.module("ringid.global_services",["ringid.config","ringid.connector","ringid.utils","ui-notification"])}(angular,window),angular.module("ringid.global_services").factory("$$userMap",userMap).factory("userFactory",userFactory),userMap.$inject=["settings","$$stackedMap","$filter","Utils","Storage","Contacts","$$q","Api","routeService"];function userMap(e,t,n,r,i,o,a,s,c){var l={0:"p",1:"desktop",2:"android",3:"iphone",4:"windows",5:"web"},u={fn:"",uId:0,cnty:"",el:"",gr:"",am:"",mblDc:"",mbl:"",prIm:"images/prof.png",cIm:"images/default_cover.jpg",prImId:0,cImId:0,cimX:0,cimY:0,bDay:"",blc:0,re:"",utId:0,tf:0,nmf:0,chta:0,cla:0,fda:0,cc:"",hc:"",adt:0,iev:0,imnv:0,isnp:0,isbusn:0,psnc:0,lot:0,mood:0,apt:0,dt:"",frnS:0,ct:0,nct:0,pimX:0,pimY:0,bv:0,owner:0,basicInfo:!1,privacyInfo:{},lastPresenceCheck:0};function d(e,t,n,r){var i=!0;this.groups={},this.updateUserObj(e),this.isCurrent=n,this.isProfile=t,this.requestedMutualFriend=!1,this.loading=!1,this.user.psnc=this.isCurrent?2:this.user.psnc,this.user.dvc=this.isCurrent?5:this.user.dvc,e.hasOwnProperty("grpId")&&(this.groups[e.grpId]=e.admin),"fetchDetails"in e&&!e.fetchDetails&&(i=!1),!i||this.user.prIm&&this.user.uId&&this.user.utId&&(this.user.nmf||!r)||this.requestUserDetails(!!r),e.psnc&&(this.user.lastPresenceCheck=Date.now())}d.prototype={updateUserObj:g,fetchPresence:m,requestUserDetails:E,getName:f,getCardTemplate:p,avatar:T,getKey:h,getUId:I,setUid:_,getUtId:A,equals:S,link:$e,getRingNumber:C,navActiveLink:v,toString:D,friendshipStatus:R,isLoading:M,commonFriends:N,isCurrentUser:y,sortBy:b,getLiteUser:O,isAdmin:P,setGroupAdmin:L,removeGroupAdmin:U,overwriteInfo:F,haveProfileData:w,getBasicInfo:k,resetCover:$,getCover:G,getCoverXY:B,setCover:H,getAvatarXY:x,setProfileImage:Y,setName:K,setAboutMe:j,setHomeCity:V,setCurrentCity:W,setGender:q,setBirthday:z,setMarriageday:Q,getEmail:X,getMobileDc:Z,getMobileNumber:J,getCountry:ee,friendType:te,setFriendType:ne,newFriendType:re,getLink:ie,resetAvatar:oe,avatarXY:ae,getBday:se,getUserMood:ce,setUserMood:le,getAppType:ue,setAppType:de,getDeviceToken:ge,setDeviceToken:me,isBlocked:Ee,setBlock:fe,isFriend:pe,unFriend:Te,getAccess:he,canChat:Ie,canSeeFeed:_e,setOnlineStatus:Ae,getOnlineStatus:Se,isOnline:Ce,onlineDevice:ve,getPlatform:De,setPlatform:Re,hasLastOnline:Ne,lastOnline:Me,getLastOnlineTime:ye,getProfileImageId:be,getCoverImageId:Oe,isEmailVerified:Pe,isMobileVerified:Le,isNewsPortalUser:Ue,isBusinessPageUser:Fe,toggleMood:we,hasDetails:ke,shouldUpdatePresence:Ge};function g(e){var t=e||{};this.user?angular.extend(this.user,t):this.user=angular.extend({},u,t),t.grpId&&(this.groups[t.grpId]=t.admin),""===this.user.prIm&&(this.user.prIm="images/prof.png"),""===this.user.cIm&&(this.user.cIm="images/default_cover.jpg"),0===this.user.frnS&&(this.user.frnS=o.getFrns(this.user.utId).frnS||this.user.frnS),t.mfc&&(this.user.nmf=t.mfc),t.mutualFriends&&(this.user.nmf=t.mutualFriends),t.psnc&&(this.user.lastPresenceCheck=Date.now()),this.user.uId&&(this.user.uId=this.user.uId.toString()),this.user.utId&&(this.user.utId=this.user.utId.toString()),t=null}function m(){var e=this;s.user.fetchUserPresence([this.user.uId]).then(function(t){return 1111===t.rc?void(e.user.psnc=0):(e.user.lastPresenceCheck=Date.now(),r.triggerCustomEvent("PRESENCE_UPDATE",t),void e.updateUserObj(t))})}function E(e){var t,n={},r=this;return this.user.utId&&0!==parseInt(this.user.utId,10)?n.utId=this.user.utId:this.user.uId&&(n.uId=this.user.uId),!(!n.utId&&!n.uId)&&(e&&(this.requestedMutualFriend=!0),t=s.user.getUserDetails(n,!!e,this.user.isnp),t.then(function(e){e.sucs&&r.updateUserObj(e.userDetails)}),t)}function f(){return this.user.fn}function p(){var e;return e=this.user.isnp||this.user.isbusn?"pages/partials/hovercards/portal-profile-hover.html":"pages/partials/hovercards/profile-hover.html"}function T(t){var n,r=t,i=this.user.prIm||"";return"iurl"===r?i:"original"===r?e.imBase+i:i.indexOf("prof.png")>0?i:(i=i.replace("profileimages/",""),"original"===r?r="":r||(r="crp"),r=(/\/uploaded\//.test(i)?"":"p")+r,n=i.lastIndexOf("/")+1,i=[e.imBase,i.slice(0,n),r,i.slice(n)].join(""),i.indexOf("prof.png")>0?this.user.prIm:i)}function h(){return this.user.uId||this.user.utId}function I(){return this.user.uId}function _(e){this.user.uId=e}function A(){return+this.user.utId}function S(e,t){var n,r=t||"uId";return angular.isObject(e)&&(n="uId"===r?e.getKey():e.getUtId()),this.user[r]===n}function C(){return this.user.uId.replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")}function v(){var e="";return(this.user.uId||this.user.utId)&&(e="/profile/"+this.user.uId+"/post"),e}function D(){return this.user.uId}function R(){var e;return e=0===this.user.frnS?o.getFrns(this.user.utId).frnS||this.user.frnS:this.user.frnS}function M(e){return"undefined"!=typeof e&&(this.user.loading=e),this.user.loading}function N(e,t){var n;return(!this.user.nmf&&!this.requestedMutualFriend||e)&&(n=this.requestUserDetails(!0)),t?n||a.when(this.user.nmf):this.user.nmf}function y(){return this.isCurrent}function b(){return this.user.adt}function O(){return this}function P(e){var t=!1;return this.groups.hasOwnProperty(e)&&(t=this.groups[e]),t}function L(e){this.groups[e]=!0}function U(e){delete this.groups[e]}function F(e){this.user.prIm=e.prIm||this.user.prIm}function w(){return this.isProfile}function k(){var e=r.profileVerbalDate(this.user.bDay),t=r.profileVerbalDate(this.user.mDay);return{fn:this.user.fn||"",birthDay:this.user.bDay||"",mDay:this.user.mDay||"",birthday:e,marriageDay:t,el:this.user.el||"",hc:this.user.hc.trim()||"",cc:this.user.cc.trim()||"",gr:this.user.gr||"",am:this.user.am.trim()||"",uId:this.user.uId.toString().substring(2)||""}}function $(){0!==this.user.cImId&&(this.user.cImId=0,s.user.removeCover(this.user.cIm)),this.user.cIm="images/default_cover.jpg"}function G(t){var n,r,i=this.user.cIm;return i&&i.length>0?"iurl"!==t&&(t&&"original"===t?i=e.imBase+i:i.indexOf("default")===-1&&(i.indexOf("web")>0?i=e.imBase+i:(n=(/\/uploaded\//.test(i)?"":"p")+(t||"crp"),r=i.lastIndexOf("/")+1,i=[e.imBase,i.slice(0,r),n,i.slice(r)].join("")))):i="images/default_cover.jpg",i}function B(){return{x:this.user.cimX,y:this.user.cimY}}function H(e){this.user.cIm=e.iurl,this.user.cimX=e.cimX,this.user.cimY=e.cimY,this.user.cImId=e.cImId}function x(){return{x:this.user.pimX,y:this.user.pimY}}function Y(e,t){this.user.prIm=e,this.user.prImId=t}function K(e){this.user.fn=e}function j(e){this.user.am=e}function V(e){this.user.hc=e}function W(e){this.user.cc=e}function q(e){this.user.gr=e}function z(e){this.user.bDay=e}function Q(e){this.user.mDay=e}function X(){return this.user.el}function Z(){return this.user.mblDc}function J(){return this.user.mbl}function ee(){return this.user.cnty}function te(){return this.user.ct}function ne(e){this.user.ct=e}function re(){return this.user.nct}function ie(e){var t,n="";if(e)for(t in e)e.hasOwnProperty(t)&&(n+=t+'="'+e[t]+'" ');return"<a "+n+' href="'+this.link()+'">'+this.user.fn+"</a>"}function oe(){0!==this.user.prImId&&(this.user.prImId=0,s.user.removeAvatar(this.user.prIm)),this.user.prIm="images/prof.png"}function ae(){return{x:this.user.pimX,y:this.user.pimY}}function se(){return this.user.bDay}function ce(){return this.user.mood}function le(e){this.user.mood=e}function ue(){return this.user.apt}function de(e){this.user.apt=e}function ge(){return this.user.dt}function me(e){this.user.dt=e}function Ee(){return 0===this.user.cla&&0===this.user.chta&&0===this.user.fda?this.user.bv=1:this.user.bv=0,this.user.bv}function fe(e){var t;t=1===e?0:1,this.user.cla=t,this.user.chta=t,this.user.fda=t,this.user.bv=e}function pe(){return 1===this.user.frnS}function Te(){this.user.frnS=0}function he(){return{chta:this.user.chta,cla:this.user.cla,fda:this.user.fda}}function Ie(){var e=!1;return 1===this.user.chta&&(e=!0),e}function _e(){var e=!1;return 1===this.user.fda&&(e=!0),e}function Ae(e){this.user.psnc=e}function Se(){return this.user.psnc}function Ce(){return 2===this.user.psnc&&1===this.user.mood}function ve(){return l[this.user.dvc]}function De(){return this.user.dvc}function Re(e){this.user.dvc=e}function Me(e){var t="";return 0!==this.user.lot&&(t=r.verbalDate(this.user.lot,null,e),e||(t="Last Seen "+t)),t}function Ne(){return!!this.user.lot}function ye(){return this.user.lot}function be(){return this.user.prImId}function Oe(){return this.user.cImId}function Pe(){return this.user.iev}function Le(){return this.user.iev}function Ue(){return this.user.isnp}function Fe(){return this.user.isbusn}function we(e){this.user.mood=e?1:2,s.user.changeMood(this.user.mood).then(function(e){e.sucs!==!0&&(this.user.mood=e.mood)})}function ke(){return!!(this.user.prIm&&this.user.uId&&this.user.utId&&this.user.fn)}function $e(){var e;return e=this.user.isnp?c.getRoute("NEWSPORTAL",{portalid:this.user.utId}):this.user.isbusn?c.getRoute("PAGE",{portalid:this.user.utId}):this.user.uId||3!==this.user.ct?c.getRoute("PROFILE",{uId:this.user.uId,utId:this.user.utId,subpage:1===this.user.frnS||this.isCurrent?"":"about"}):""}function Ge(){return Date.now()-this.user.lastPresenceCheck>60*e.USERS_PRESENCE_REFRESH_INTERVAL*1e3}return function(e,t,n,r,i){return new d(e,t,n,r,i)}}userFactory.$inject=["$$userMap","$$stackedMap","$$connector","OPERATION_TYPES","Api","settings","Utils"];function userFactory(e,t,n,r,i,o,a){var s=t.createNew(),c={},l=-1,u=new LRUCache(100),d=r.SYSTEM.PROFILE,g=o.USERS_PRESENCE_REFRESH_INTERVAL,m="ru_",E={getSortIndex:f,create:p,createByUtId:T,createByUId:h,getUser:I,getByUtId:_,getAllUtIds:A,getUIdByUtId:S,getUtIdByUId:C,trackUserUsage:D,unTrackUserUsage:R,updateLRUUserPresence:M,refreshPesence:b,initPresenceRefresh:y};O();function f(){return"adt"}function p(t,n,r){var i,o,a=!!n,l=!!r;return angular.isObject(t)?t.uId?(t.uId=t.uId.toString(),i=t.uId,i=m+i,o=s.get(i)):t.utId?(t.utId=t.utId.toString(),o=c[t.utId],o||(o=!1)):o=!1:(i=m+t,o=s.get(i)),o===!1?t.utId&&c[t.utId]?(o=c[t.utId],i=m+t.uId,s.save(i,o),o.updateUserObj(t)):(o=e(t,a,l),o.getUtId()&&(c[o.getUtId()]=o)):o.updateUserObj(t),s.save(i,o),o}function T(t,n,r){return c[t.utId]||(c[t.utId]=e(t,!1,!1,r)),n?c[t.utId].getLiteUser():c[t.utId]}function h(e,t){var n,r={uId:e,fetchDatails:!1},i=E.create(r);return i.hasDetails()?t&&t({fetchedDetails:!1}):i.requestUserDetails().then(function(e){n={sucs:e.sucs,fetchedDetails:!0,rc:e.rc},t&&t(n)}),i}function I(e){var t=m+e;return s.get(t)}function _(e){return e&&c[e]||!1}function A(){return Object.keys(c)}function S(e){return c[e]&&c[e].getUId()}function C(e){var t;try{t=E.getUser(e)}catch(e){RingLogger.print(e)}return t&&t.getUtId()}function v(e,t){var n=u.get(e),r=t?-1:1;n?(n.count+=r,n.count<=0&&u.remove(e)):t||u.put(e,{count:0}),20===u.size&&y(),RingLogger.information("User Track Length",n,u.size,"GENERAL")}function D(e){v(e,!1)}function R(e){v(e,!0)}function M(e){var t=e;e||(t=u.keys()),RingLogger.information("LRU UserPresence updating...","GENERAL"),i.user.fetchUserPresence(t)}function N(e){var t=e;e||(t=s.keys()),RingLogger.information("ALL UserPresence updating...","GENERAL"),i.user.fetchUserPresence(t)}function y(){l=0,b()}function b(e){var t,n=Date.now(),r=[];s.doForAll(function(e){r.push(e.getKey())}),t=n-l,l!==-1&&(e||!l||t>60*g*1e3)&&(r>100?M():N(r),M(),l=n)}function O(){n.subscribe(function(e){switch(e.actn){case d.ACTION_USERS_PRESENCE_DETAILS_DATA:RingLogger.information("PRESENCE DETAIL",e,RingLogger.tags.PROFILE),p(e),a.triggerCustomEvent("PRESENCE_UPDATE",e)}},{action:[d.ACTION_USERS_PRESENCE_DETAILS_DATA]})}return E}angular.module("ringid.global_services").service("userService",userService),userService.$inject=["userFactory","Utils"];function userService(e,t){var n=this,r={},i={},o={},a=!1;n.register=s,n.trigger=c,n.unregister=l,n.fetchUser=u,n.start=d;function s(e,o,a,s){var c=arguments,l=t.getUniqueID("us"),u=n;return e?(r[e]||(r[e]=[]),i[l]=function(){o.call(a,c),("undefined"==typeof s||s)&&u.unregister(l)},r[e].push(l),n.start()):(RingLogger.alert("Invalid uId in `userService` ",e,"GENERAL"),l=!1),l}function c(e){var t=[];r[e]&&(r[e].forEach(function(e){i[e]&&(i[e].call(null),i[e]&&t.push(e))}),r[e]=t)}function l(e){i[e]&&delete i[e]}function u(t){o[t]||(o[t]=!0,e.createByUId(t,function(){delete o[t],n.start()}),n.start())}function d(){var t,i,o,s;function c(){for(o=Object.keys(r),i=0;i<o.length;i++)t=o[i],s=e.getUser(t),s&&s.hasDetails()?n.trigger(t):n.fetchUser(t);a=!1}a||(a=!0,setTimeout(c))}}angular.module("ringid.global_services").factory("Api",ApiFactory),ApiFactory.$inject=["OPERATION_TYPES","$$connector","settings","$ringhttp"];function ApiFactory(e,t,n,r){var i=e.SYSTEM,o=e.SYSTEM.REQUEST_TYPE;function a(e){return t.request({actn:i.PROFILE.TYPE_ACTION_USER_MOOD,mood:e},o.AUTHENTICATION)}function s(e,n,r,a){var s={actn:i.PROFILE.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!n};return r&&(s.pType=3),a&&(s.pType=4),angular.extend(s,e),t.request(s,o.REQUEST,!0)}function c(e){return t.pull({actn:i.PROFILE.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:e.getUId()},o.REQUEST)}function l(e){var n={actn:i.PROFILE.ACTION_USERS_PRESENCE_DETAILS,uIds:e};return t.request(n,o.REQUEST,!0)}function u(){return r.get(n.baseUrl+"/resources/countries.json")}function d(e){var n={actn:i.MEDIA.ACTION_MEDIA_CONTENT_DETAILS,cntntId:e.cntntId,utId:e.utId};return t.request(n,o.REQUEST)}function g(e){var n={actn:i.PROFILE.TYPE_REMOVE_PROFILE_IMAGE,prIm:e};return t.request(n,o.UPDATE)}function m(e){var n={actn:i.PROFILE.TYPE_REMOVE_COVER_IMAGE,cIm:e};return t.request(n,o.UPDATE)}function E(e){return t.request({actn:i.PROFILE.SEND_VERIFICATION_CODE_TO_PHONE,mbl:e.mbl,mblDc:e.mblDc,pkd:!0},o.REQUEST)}return{fetchCountryList:u,user:{changeMood:a,getUserDetails:s,getMutualFriends:c,fetchUserPresence:l,removeAvatar:g,removeCover:m,verifyPhoneNo:E},media:{fetchDetails:d}}}angular.module("ringid.global_services").factory("Utils",UtilsFactory),UtilsFactory.$inject=["$window","$document","RING_ROUTES","$filter","APP_CONSTANTS","StickerEmoticonFactory","StickerEmoticonService","$q","Storage","$rootScope","MESSAGES","SystemEvents","GlobalEvents","$ringhttp","settings","$location"];function UtilsFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f){var p,T,h,I=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,_=o.getEmoticonPattern(),A=a.getEmoticonMap(),S=500,C={x:0,y:0,yo:0};function v(){var n=e,r=t,i=r[0].documentElement,o=r[0].getElementsByTagName("body")[0];return C.x=n.innerWidth||i.clientWidth||o.clientWidth,C.y=n.innerHeight||i.clientHeight||o.clientHeight,C.yo=n.pageYOffset,C}v();function D(e,t,n,r){var i=1;return(e>n||t>r)&&(i=Math.min(n/e,r/t)),{width:e*i,height:t*i}}function R(t){return(t||"")+(window._cti||"")+e.Math.floor(e.Math.random()*(new e.Date).getTime())}function M(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function N(e){var t=e;return/^(f|ht)tps?:\/\//i.test(e)||(t="http://"+e),t}function y(e,t){var n=e,r=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g,i=M(e),o=t;return o||(o=0),"blob:http"===n.substring(0,9)&&(n='<img width="100%" src="'+n+'" />',o=2),0===o&&(n=n.replace(I,function(e){var t=N(e);return'<a class="feedanchor" target="_blank" href="'+t+'">'+e+"</a>"})),n=n.replace(_,function(e){return'<span class="em_list '+A[e].replace(/\.[A-Za-z]{3}/,"")+'" data-link="'+e+'" title="'+e+'">&nbsp;</span>'}),window.emojiSupported||(n=n.replace(r,function(e){var t,n,r;return t=e.charCodeAt(0),n=e.charCodeAt(1),r=(1024*(t-55296)+(n-56320)+65536).toString(16),'<u class="emo_list U_'+r+'"></u>'})),1===o&&(n=i),n}function b(e,t){return y(e,t)}function O(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0),n.data=t,document.dispatchEvent(n)}function P(e,t){function n(e){t.call(this,e.data||{})}return document.addEventListener(e,n),n}function L(e,t){document.removeEventListener(e,t)}function U(e){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function F(){var e,t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*(t+Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)})}function w(){var e,t,n,r;return e=document.createElement("p"),e.style.width="100%",e.style.height="200px",t=document.createElement("div"),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t),n=e.offsetWidth,t.style.overflow="scroll",r=e.offsetWidth,n===r&&(r=t.clientWidth),document.body.removeChild(t),e=t=null,n-r}function k(e){return r("date")(e,"yyyy-MM-dd")}function $(e){var t=e.split(","),n=new Uint8Array(t);return n.buffer}function G(e){var t=new Uint8Array(e);return Array.prototype.join.call(t,",")}function B(e){var t=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return!!e&&(t.test(e)||_.test(e))}function H(t,n,i){var o,a,s,c=e.Math,l=t,u=n||Date.now(),d="",g="",m=new Date;if(isNaN(l)?(o=new Date((l||"").replace(/-/g,"/").replace(/[TZ]/g," ")),l=o.getTime()):o=new Date(l),a=(u-l)/1e3,s=c.floor(a/86400),isNaN(s))return"";switch(!0){case s<1:switch(!0){case a<60:d=c.floor(a)+"s",g="Just now";break;case a<120:d="1m",g="1 minute ago";break;case a<3600:d=c.floor(a/60)+"m",g=c.floor(a/60)+" minutes ago";break;case a<7200:d="1h",g="1 hour ago";break;case a<86400:d=c.floor(a/3600)+"h",g=c.floor(a/3600)+" hours ago";break;default:d=r("date")(l,"h")+"h",g=r("date")(l,"MMM d, h:mm a")}break;case 1===s:d="1d",g="Yesterday at "+r("date")(l,"h:mm a");break;case s<7:d=c.floor(s)+"d",g=r("date")(l,"EEEE 'at' h:mm a");break;case s<30:d=c.floor(s)+"d",g=r("date")(l,"EEEE 'at' h:mm a");break;case s<365:d=c.floor(s/30)+"M",m.getUTCFullYear()===o.getUTCFullYear()&&(g=r("date")(l,"MMMM d 'at' h:mm a")),g=r("date")(l,"MMMM d yyyy 'at' h:mm a");break;case s>365:d=c.floor(s/365)+"y",g=r("date")(l,"MMM d, yyyy");break;default:d=r("date")(l,"d")+"d",g=r("date")(l,"MMM d, yyyy")}return i?d:g}function x(){C||v();var e=C.x;return e<=1270?1:e>1270&&e<1695?2:3}function Y(e,t,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||e.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}}function K(e){var t,n,r,i,o,a=";base64,";if(e.indexOf(a)===-1)return t=e.split(","),i=t[0].split(":")[1],o=decodeURIComponent(t[1]),new Blob([o],{type:i});for(t=e.split(a),i=t[0].split(":")[1],o=window.atob(t[1]),r=new Uint8Array(o.length),n=0;n<o.length;++n)r[n]=o.charCodeAt(n);return new Blob([r],{type:i})}function j(e){return r("date")(e,"h:mm a")}function V(e,t,n){var r=n,o="https://maps.googleapis.com/maps/api/staticmap?center={0},{1}&zoom=18&size=640x170&key={3}&markers=color:orange|label:A|{2}|{0},{1}";return r||(r="({0},{1})".format(e,t)),o=o.format(e,t,r,i.GOOGLE_MAP_KEY)}function W(e,t,n,r){var i;return i=e&&t?"https://maps.google.com/maps?q={0},{1}&hl=en;z=18;iwd=1".format(e,t):"http://maps.google.com?q={0}".format(n),r&&(i+="&output=embed"),i}function q(e){var t=s.defer(),n=t.promise,r=c.getData("uLocationInfo");return r&&r.lat?(r.sucs=!0,n=r):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(n){var r,i=n.coords.latitude,o=n.coords.longitude,a={lat:i,lng:o};e?(r=new google.maps.Geocoder,r.geocode({location:a},function(e,n){n===google.maps.GeocoderStatus.OK?(c.setData("uLocationInfo",{lat:i,lng:o,description:e[1].formatted_address}),t.resolve({sucs:!0,lat:i,lng:o,description:e[1].formatted_address})):(c.setData("uLocationInfo",{lat:i,lng:o}),t.resolve({sucs:!0,lat:i,lng:o}))})):(c.setData("uLocationInfo",{lat:i,lng:o}),t.resolve({sucs:!0,lat:i,lng:o}))},function(e){t.resolve({sucs:!1,error:e})}),s.when(n)}function z(){return document.title}function Q(e,t){document.title=e,t&&l.$broadcast("PAGE_TITLE_CHANGE",{title:e})}function X(e){return e.mg?e.mg:Z(e.rc)}function Z(e){return u["RC"+e]?u["RC"+e]:""}function J(){var e=x(),t=parseInt(c.getCookie("col"),10);return!t||t>e||"/"!==f.path()?e=e>2?2:e:t}function ee(){p=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,T=0,h=-1*p}function te(){var e=Math.easeIn(T,p,h,S);T+=25,document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e,T<S&&requestAnimationFrame(te)}function ne(e){return m.get(E.ogServiceUrl+"?url="+encodeURIComponent(e))}function re(e){var t=s.defer(),n=new Image;return n.onload=function(){t.resolve({imgUrl:this.src,width:this.width,height:this.height})},n.src=e,setTimeout(function(){t.resolve({width:0,height:0})},3e4),t.promise}function ie(e,t){var n=s.defer(),r=[];return t.width||(t.width=0),t.height||(t.height=0),angular.forEach(e,function(i){setTimeout(function(){re(i).then(function(i){var o,a;i.width&&i.width>=t.width&&(o=!0),i.height&&i.height>=t.height&&(a=!0),o&&a&&(r.push(i.imgUrl),r.length===e.length?n.resolve(i.imgUrl):n.notify(i.imgUrl))})})}),setTimeout(function(){0===r.length&&n.resolve([])},2e4),n.promise}function oe(e){c.setCookie("col",parseInt(e,10))}function ae(e){var t,n=C.x,r=400,i=10,o=415,a=600,s=30,c=n-r-s-i*e;return t=c/e,!(t<o)&&Math.min(t,a)}function se(e){requestAnimationFrame(function(){v(),l.windowHeight=C.y,l.windowWidth=C.x,l.$broadcast(d.COMMON.WINDOW_RESIZED,C)}),e.preventDefault()}g.bindHandler("window","resize",se);function ce(e){requestAnimationFrame(function(){v(),l.windowHeight=C.y,l.windowWidth=C.x,l.$broadcast(d.COMMON.WINDOW_SCROLLED,C)}),e.preventDefault()}return g.bindHandler("window","scroll",ce),{generateUUID:F,tabId:window._cti,viewport:C,viewportsize:v,scrollbarWidth:w(),getUniqueID:R,triggerCustomEvent:O,onCustomEvent:P,removeCustomEvent:L,profileVerbalDate:k,verbalDate:H,getScaledImageSize:D,debounce:Y,dataURLToBlob:K,string2ArrayBuffer:$,arrayBuffer2String:G,safeDigest:U,chatVerbalDate:j,parseForLE:b,getGoogleMapJSUrl:W,getGoogleMapStaticUrl:V,hasEmoticon:B,getUserLocation:q,getCurrentPageTitle:z,setPageTitle:Q,getReasoneMessage:Z,getReasonMessageFromResponse:X,getDefaultColumn:x,feedColumn:J,animateScroll:te,resetScroll:ee,getOGDetails:ne,filterImagesByDimentions:ie,setFeedColumn:oe,calCulateCellWidth:ae}}angular.module("ringid.global_services").factory("$ringhttp",ringhttp),ringhttp.$inject=["settings","$templateCache"];function ringhttp(e,t){var n=(new Date).getTime(),r={};function i(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t=e.response}return[t,e]}function o(o,a,s,c){var l,u,d=!1,g=0,m=a,E={success:angular.noop,error:angular.noop,abort:angular.noop,progress:angular.noop},f={success:function(e){return E.success=e,f},error:function(e){return E.error=e,f},abort:function(e){return E.abort=e,f},progress:function(e){return E.progress=e,f},abortRequest:function(){l.abort()}};u=/^(http|https):\/\//.test(a)?a:e.baseUrl+(0===a.indexOf("/")?a:"/"+a);try{l=new XMLHttpRequest,d="GET"===o&&/\.html$/.test(u),d&&r.hasOwnProperty(m)?r[m].push(E):d&&t.get(m)?setTimeout(function(){E.success.apply(E,[t.get(m),l])}):(d&&(u=u+"?time="+n,r[m]=[],r[m].push(E)),l.open(o,u,!0),l.responseType=c||"text",l.onreadystatechange=function(){var e;4===l.readyState&&(200===l.status?(e=i(l),d?(t.put(m,e[0]),r[m].forEach(function(e){e.success.apply(e,[t.get(m),l])}),delete r[m]):(E.progress.apply(E,[100]),E.success.apply(E,e))):E.error.apply(E,e))},l.upload.onabort=function(){E.abort.apply(E)},l.upload.onprogress=function(e){g=Math.round(e.loaded/e.total*100),g=g>0?g-1:g,E.progress.apply(E,[g])},l.send(s))}catch(e){RingLogger.print(e)}return f}return{get:function(e,t,n){return o("GET",e,t,n)},post:function(e,t,n){return o("POST",e,t,n)}}}angular.module("ringid.global_services").factory("GlobalEvents",GlobalEvents);function GlobalEvents(){var e={};function t(t){var n,r;if(3!==t.which&&0!==e[t.type].length)for(n=0,r=e[t.type].length;n<r;n++)e[t.type][n].call(null,t)}function n(n,r,i){if(e.hasOwnProperty(r)||(e[r]=[]),e[r].push(i),1===e[r].length)switch(n){case"document":document.addEventListener(r,t);break;case"window":window.addEventListener(r,t);break;default:document.addEventListener(r,t)}}function r(n,r,i){setTimeout(function(){var o=e[r].indexOf(i);if(o>=0&&e[r].splice(o,1),0===e[r].length)switch(n){case"document":document.removeEventListener(r,t);break;case"window":window.removeEventListener(r,t);break;default:document.removeEventListener(r,t)}})}return{bindHandler:n,unbindHandler:r}}angular.module("ringid.global_services").factory("Ringalert",Ringalert),Ringalert.$inject=["$ringbox","Notification","MESSAGES"];function Ringalert(e,t,n){var r={delay:3e3,positionX:"right",positionY:"top",replaceMessage:!0},i={title:"Warning",message:"Click ok to continue",showOk:!0,showCancel:!0,craac:!1,textOk:"OK",textCancel:"Cancel",okCallback:angular.noop,cencelCallback:angular.noop};function o(e,i){var o,a=i||"info";o=angular.isString(e)?{message:e}:e,o.message=o.message||o.mg,o.message||("success"===a?o.message=n.REQUEST_PROCESSED:"error"===a&&(o.message=n.REQUEST_FAILED));try{t[a](angular.extend({},r,o))}catch(e){}}function a(){t.clearAll()}function s(t){var n=t||{},r=e.open({type:"remote",scope:!1,scopeData:n,templateUrl:n.templateUrl||"templates/popups/ring-alert.html"});n=angular.extend({},i,n),r.result.then(function(e){var t="string"==typeof e?e:e.sucs;"ok"===t&&angular.isFunction(n.okCallback)?n.okCallback.call(null,e):n.cencelCallback.call(null,e)})}return{show:o,clear:a,alert:s}}angular.module("ringid.global_services").factory("$$stackedMap",function(){return{createNew:function(e,t){
var n,r,i,o=[],a=this;n=e||!1,r=t||"desc";function s(e){var t=e||"sortBy",n=-1,i=1;"desc"===r&&(n=1,i=-1),o.sort(function(e,r){return r.value[t]()>e.value[t]()?n:e.value[t]()>r.value[t]()?i:0})}function c(e){var t;for(t=0;t<o.length;t++)if(e==o[t].key)return t;return-1}function l(e){var t=c(e);return t!==-1&&t!==o.length-1&&o[t+1].value}function u(e){var t=c(e);return t!==-1&&0!==t&&o[t-1].value}function d(e){o=o.concat(e)}function g(){o=[]}function m(){return o}function E(e){o=e}function f(e,t){return o.push({key:e,value:t}),n!==!1&&s(),!1}function p(e){return l(e)}function T(e){return u(e)}function h(e,t){return!(!o.length||!(e>=0||e<o.length))&&(t?o[e]:o[e].value)}function I(e){var t=c(e);return t>=0&&o[t].value}function _(e,t){var r;r=c(e),r===-1?i.add(e,t):o[r]={key:e,value:t},n!==!1&&s()}function A(e,t){e&&(r=e),s(t)}function S(){var e,t=[];for(e=0;e<o.length;e++)t.push(o[e].key);return t}function C(){var e,t=[];for(e=0;e<o.length;e++)t.push(o[e].value);return t}function v(e){var t=!!e;return!!o.length&&(t?o[o.length-1]:o[o.length-1].value)}function D(e){var t=!!e;return!!o.length&&(t?o[0]:o[0].value)}function R(e,t){var n=e,r=t;return r||(r=0),(n>o.length||!n)&&(n=o.length),o.slice(r,n)}function M(e){var t=c(e);return t>-1&&(o.splice(t,1),!0)}function N(){return o.splice(o.length-1,1)[0]}function y(){return o.length}function b(){var e=0;return angular.forEach(o,function(t){e+=t.closedBox?1:0}),e}function O(){var e,t=a.createNew(n,r);for(e=0;e<o.length;e++)t.add(o[e].key,o[e].value);return t}function P(e){var t;for(t=0;t<o.length;t++)e.call(null,o[t].value)}return i={concat:d,reset:g,all:m,setStack:E,add:f,next:p,previous:T,getByIndex:h,getIndex:c,get:I,save:_,sort:A,keys:S,values:C,top:v,bottom:D,sliceBy:R,remove:M,removeTop:N,length:y,nonClosedLength:b,copy:O,doForAll:P}}}}),angular.module("ringid.global_services").factory("Auth",AuthFactory),AuthFactory.$inject=["SystemEvents","$rootScope","Storage","Utils","$q","$ringhttp","settings","OPERATION_TYPES","userFactory","$ringbox","Ringalert","$$connector","$ocLazyLoad","Api"];function AuthFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m){var E,f=n.getCookie("sessionID"),p=["/templates/dropdowns/notification-dropdown.html","/templates/dropdowns/friend-request-dropdown.html","/templates/partials/emoticon-window.html","/templates/dropdowns/circle-list-dropdown.html","/templates/dropdowns/search-dropdown.html","/templates/partials/hovercards/profile-hover.html","/templates/partials/notification/image-popup.html","/templates/partials/notification/media-popup.html","/templates/partials/notification/feed-popup_with_image.html","/templates/partials/stickers/popups/sticker-market.html"],T=!0,h=!1,I=s.SYSTEM.AUTH,_=s.SYSTEM.REQUEST_TYPE,A={},S=[],C={code:"+880",flagcode:"b880"},v=n.getCookie("sId"),D=n.getCookie("uId"),R=n.getCookie("utId"),M=r.generateUUID();t.$on("ringActive",function(){Cookies.get("sessionID")!==f&&window.location.reload()});function N(e,t,n){var i,o={};switch(e){case"fetchRecoverOptions":o.actn=I.PASSWORD_RECOVER_OPTIONS,o.did=M,o.rb=t.mblDc+t.mbl,o.mbl=t.mbl,o.mblDc=t.mblDc,o.vsn=a.apiVersion,o.wk=r.getUniqueID(),o.lt=2;break;case"recoveryVerifyCode":o.actn=I.PASSWORD_RECOVER_VERIFY_CODE,o.uId=t.uId,o.vc=t.vc,o.wk=r.getUniqueID(),o.lt=1;break;case"recoverySendCode":o.actn=I.PASSWORD_RECOVER_SEND_CODE,o.wk=r.getUniqueID(),n?(o.lt=2,o.rb=t.mblDc+t.mbl,o.mbl=t.mbl,o.mblDc=t.mblDc):(o.lt=3,o.rb=t.email,o.el=t.email.utf8Encode());break;case"resetPassword":o.actn=I.PASSWORD_RECOVER,o.uId=t.uId,o.nPw=t.password,o.wk=r.getUniqueID(),o.lt=1;break;case"isValidSession":o.actn=I.TYPE_SESSION_VALIDATION,o.dvcc=5,o.utId=R,o.did=M;break;case"logout":o.actn=I.TYPE_SIGN_OUT;break;case"validSocialId":i="facebook"===t.platform?a.signupSocialInit+"fb="+t.id+"&lt=4":a.signupSocialInit+"twtr="+t.id+"&lt=5",o=i+"&time="+(new Date).getTime();break;case"signupSendCode":o.wk=r.getUniqueID(),o.uId=t.uId,o.did=t.did,o.lt=1,"email"===t.authMethod?(o.el=t.email.utf8Encode(),o.actn=I.SIGNUP_SEND_CODE_EMAIL):(o.actn=I.SIGNUP_SEND_CODE_PHONE,o.mbl=t.mbl,o.mblDc=t.mblDc);break;case"signupVerifyCode":o.wk=r.getUniqueID(),o.uId=t.uId,o.did=t.did,o.lt=1,"email"===t.authMethod?(o.actn=I.SIGNUP_SEND_CODE_EMAIL,o.el=t.email.utf8Encode(),o.evc=t.vc):(o.actn=I.SIGNUP_SEND_CODE_PHONE,o.mbl=t.mbl,o.mblDc=t.mblDc,o.vc=t.vc);break;case"signup":switch(o.actn=I.SIGNUP_REGISTER,o.wk=r.getUniqueID(),o.uId=t.uId,o.did=t.did,o.nm=t.name.utf8Encode(),o.usrPw=t.password,o.lt=1,o.ispc=0,o.mbl=t.mbl,o.mblDc=t.mblDc,t.authMethod){case"email":o.el=t.email.utf8Encode(),o.evc=t.vc;break;case"facebook":o.fb=t.id,o.it=t.access_token,o.lt=4;break;case"twitter":o.twtr=t.id,o.it=t.access_token,o.lt=5;break;default:o.mbl=t.mbl,o.mblDc=t.mblDc,o.vc=t.vc}break;case"login":if(t.hasOwnProperty("silent")&&t.silent===!0)o.actn=I.TYPE_SIGN_IN,o.vsn=a.apiVersion,o.wk=r.getUniqueID(),o.dvc=5,o.tbid=r.tabId;else{switch(o.actn=I.TYPE_SIGN_IN,o.vsn=a.apiVersion,o.usrPw=t.password,o.lt=1,o.sn=a.apiVersion,o.wk=r.getUniqueID(),o.dvc=5,o.tbid=r.tabId,o.did=t.did,t.authMethod){case"ringid":o.lt=1,o.uId=t.silent?t.ringid:"21"+t.ringid;break;case"email":o.lt=3,o.el=t.email.utf8Encode();break;case"facebook":o.uId=t.uId,o.pen=1,o.lt=4,o.apt=1,o.smid=t.id,o.it=t.access_token,delete o.usrPw;break;case"twitter":o.uId=t.uId,delete o.usrPw,o.smid=t.id,o.it=t.access_token,o.lt=5;break;default:o.lt=2,o.mbl=t.mbl,o.mblDc=t.mblDc}t.salt&&t.sId&&(o.salt=t.salt,o.sId=t.sId)}break;default:o=t}return o}function y(e){return E._currentUser=e,e}function b(e){e&&(E.loginData=e,n.setData("loginData",e))}function O(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function P(e){O("uId"),O("utId"),O("sId"),O("authServer"),O("comPort"),O("la"),O("col"),e||(O("sessionID"),f=void 0),O("la")}function L(e,t){n.setCookie("uId",e.uId||"",t),n.setCookie("sId",e.sId||"",t),n.setCookie("utId",e.utId||"",t),t&&n.setCookie("la",(new Date).getTime(),t),e.authServer&&n.setCookie("authServer",e.authServer||"",t),e.comPort&&n.setCookie("comPort",e.comPort||"",t)}function U(e,t){e&&(P(),n.reset()),t?setTimeout(function(){window.location="/?rand="+r.getUniqueID()},e):setTimeout(function(){window.location="/"},e)}function F(e,t,r){var i;try{switch(i={usrPw:t.authEPassword,salt:t.authESalt,sId:t.sId,lt:e.lt},e.lt){case 1:i.uId=t.authEUsername;break;case 2:i.mbl=t.authEUsername,i.mblDc=e.mblDc;break;case 3:i.el=t.authEUsername;break;default:RingLogger.warning("REMEMBER ME DATA SAVE FAILED",RingLogger.tags.AUTH)}n.setData("remInfo",i),n.setCookie("sessionID",n.getCookie("sessionID"),r)}catch(e){RingLogger.warning("FAILED REMEMBER ME",RingLogger.tags.AUTH)}}function w(e,t){var n=i.defer();return o.get(a.signupInit+"did="+M+"&time="+(new Date).getTime()).success(function(r){r.success===!0?(L({uId:r.ringID,authServer:r.authServerIP,comPort:r.comPort}),angular.extend(e,{uId:r.ringID,did:M}),t?n.resolve(e):d.request(N("signupSendCode",e),_.AUTHENTICATION).then(function(e){n.resolve(angular.extend(e,{uId:r.ringID}))},function(e){n.reject(e)})):n.reject(r)}).error(function(){n.reject()}),n.promise}function k(e,t){h=!0,e.did=M,d.request(N("login",e),_.AUTHENTICATION).then(function(r){h=!1,r.sucs===!0?(E._validSession=!0,e.remember?(F(e,r,30),n.setData("remember",!0)):(n.deleteData("remInfo"),n.deleteData("remember")),e.authMethod&&n.setData("activeTab",e.authMethod),ge(r,!0),t.resolve(r)):(E._validSession=!1,t.reject(r))},function(n){n.sucs===!1&&1111===n.rc?k(e,t):(E._validSession=!1,h=!1,t.reject({sucs:!1,mg:"Reqeust Failed"}))})}function $(){var e=n.getData("loginData");!e||window.hasOwnProperty("ringLoggedIn")&&!window.ringLoggedIn?de():(RingLogger.information("LOGIN POSSIBLE",RingLogger.tags.AUTH),ge(e))}function G(e){switch(RingLogger.print(e,RingLogger.tags.AUTH),e.actn){case I.TYPE_MULTIPLE_SESSION:RingLogger.warning("MULTIPLE SESSION",RingLogger.tags.AUTH),h||(RingLogger.print("multiple session warning",e,RingLogger.tags.AUTH),u.alert({title:"Signed Out!",message:"You are signed in from another device",showCancel:!1,okCallback:function(){de(!0)}}));break;case I.TYPE_INVALID_LOGIN_SESSION:RingLogger.warning("INVALID LOGIN SESSION",RingLogger.tags.auth),h||E.loginFromLocalData();break;case I.TYPE_SESSION_VALIDATION:RingLogger.warning("SESSION VALIDATION",RingLogger.tags.auth),h||(E.isLoggedIn()?de(!0):E.loginFromLocalData());break;default:RingLogger.warning("No Case found for invalidSession Response",RingLogger.tags.auth)}}function B(){return d.request({actn:I.PHN_MAIL_VERIFICATION_CHECK},_.REQUEST)}function H(){var e,t=i.defer();return T?e=setInterval(function(){T||(clearInterval(e),E._validSession?t.resolve():t.reject())},1e3):t.resolve(),t.promise}function x(){return T}function Y(e){return angular.extend(e,{did:M}),d.request(N("signupVerifyCode",e),_.AUTHENTICATION)}function K(e){var t=i.defer();return angular.extend(e,{did:M}),d.request(N("signup",e),_.AUTHENTICATION).then(function(e){RingLogger.print(e,RingLogger.tags.AUTH),t.resolve(e)},function(){t.reject()}),t.promise}function j(e,t){var n=i.defer();o.get(N("socialData")).success(a).error(r);function r(){n.reject({rc:0,mg:"Request Failed"})}function a(r){RingLogger.print(r,RingLogger.tags.AUTH),r.success===!1&&2===r.rc?(l.open({type:"remote",scope:!1,controller:"SignUpController",resolve:{localData:{socialData:e,credentials:t},remoteData:angular.noop},templateUrl:"templates/welcome/ring-signup-popup.html"}),n.resolve()):n.reject({rc:"dologin",mg:"Already Registered Social ID"})}return n.promise}function V(e,t){var r=i.defer();if(t)angular.extend(e,{did:M}),o.get(N("validSocialId",e)).success(s).error(a);else{switch(e.authMethod){case"email":n.setData("autoFill",e.email);break;case"ringid":n.setData("autoFill",e.ringid);break;case"phone":n.setData("autoFill",e.mbl);break;default:RingLogger.warning("Authentication method not found to set autofill Data",RingLogger.tags.AUTH)}k(e,r)}function a(){r.reject({rc:0,mg:"Request Failed"})}function s(t){RingLogger.print(t,RingLogger.tags.AUTH),t.success===!0||"true"===t.success?(L({uId:t.ringID,authServer:t.authServerIP,comPort:t.comPort}),e.uId=t.ringID,e.authMethod=e.platform,k(e,r)):r.reject({rc:"invalidsocialid",mg:"Unregistered Social ID. Please Register."})}return r.promise}function W(){E.isLoggedIn()&&(t.$broadcast(e.LOADING,!0),d.request(N("logout"),_.AUTHENTICATION).then(function(n){t.$broadcast(e.LOADING,!1),RingLogger.information(n,RingLogger.tags.AUTH),de(!0)})),setTimeout(function(){de(!0)},1e3),d.stop()}function q(){var e={remember:!0,silent:!0},t=n.getData("remInfo");!h&&t&&(t.uId||t.el||t.mbl)?(RingLogger.information("TRYING REMEMBER ME LOGIN",RingLogger.tags.AUTH),angular.extend(e,t),E.login(e).then(i,r)):(RingLogger.information("NO REMEMBER ME INFORMATION",RingLogger.tags.AUTH),de(!0));function r(){de(!0)}function i(e){e.sucs?(RingLogger.print("Auto Login Success",RingLogger.tags.AUTH),ge(e)):(RingLogger.print("Auto Login Failed",RingLogger.tags.AUTH),de(!0))}}function z(){return E._currentUser}function Q(){return!!E._currentUser&&!!n.getCookie("sId")&&!!n.getCookie("sessionID")}function X(){var e=i.defer();R&&v&&D?d.request(N("isValidSession")).then(n,t):e.reject(E._validSession);function t(){e.reject(E._validSession)}function n(t){RingLogger.print(t,RingLogger.tags.AUTH),t.sucs?(E._validSession=!0,e.resolve(t)):(E._validSession=!1,e.reject(t))}return e.promise}function Z(){var e=n.getData("country");return e&&e.country&&(C.code=e.code,C.flagcode=e.flagcode),C}function J(){return S}function ee(){return A}function te(e){A.ancht=e}function ne(e){A.aifr=e}function re(e){A.afam=e}function ie(e){A.aaf=e}function oe(e){return d.request(N("fetchRecoverOptions",e),_.AUTHENTICATION)}function ae(e,t){return d.request(N("recoverySendCode",e,t),_.AUTHENTICATION)}function se(e){return d.request(N("recoveryVerifyCode",e),_.AUTHENTICATION)}function ce(e){return d.request(N("resetPassword",e),_.AUTHENTICATION)}E={_currentUser:null,_validSession:!1,isPendingAsync:H,isPending:x,sendCode:w,updateLocalStorageLoginData:b,verifyCode:Y,signup:K,openSignup:j,login:V,logout:W,clearCookies:P,loginFromLocalData:q,currentUser:z,isLoggedIn:Q,isValidSession:X,reloadHome:U,getCountry:Z,getCountryList:J,getPermission:ee,setAchatPermission:te,setAinfndreqPermission:ne,setAfamPermission:re,setAafPermission:ie,ensureLoginState:$,handleInvalidSession:G,fetchPrivacy:B,fetchRecoverOptions:oe,recoverySendCode:ae,recoveryVerifyCode:se,resetPassword:ce};function le(e){setTimeout(function(){o.get(e)},100)}function ue(){var e,t;0===S.length&&m.fetchCountryList().success(i);function r(r){if(r&&r.length>0)for(t=r.toLowerCase(),e=0;e<S.length;e++)if(S[e].country.toLowerCase()===t){C.code=S[e].code,C.flagcode=S[e].flagcode,n.setData("country",S[e]);break}}function i(e){S=e,t=n.getData("country"),t&&t.country?(C.code=t.code,C.flagcode=t.flagcode):o.get(a.baseUrl+"/country").success(r)}}function de(r){RingLogger.print("LOGIN FAIL. LOGGING OUT",RingLogger.tags.AUTH),y(null),T=!1,E.clearCookies(!0),n.reset(),l.closeAll(),r?U(1):(ue(),t.$broadcast(e.AUTH.LOGIN,!1))}function ge(r,i){RingLogger.print("LOGIN SUCCESS",RingLogger.tags.AUTH),E.loginData=r,L(r,!!i&&30),y(c.create(r,!0,!0)),n.init(r),ue(),setTimeout(function(){p.forEach(le)},2e3),d.resume(),d.keepAlive(),T=!1,t.$broadcast(e.AUTH.LOGIN,!0),setTimeout(function(){B().then(a,o)});function o(){RingLogger.warning("User Permission fetch fail",RingLogger.tags.PROFILE)}function a(e){e.sucs===!0?(E._validSession=!0,A=e):(RingLogger.warning("PERMISSION GET REQUEST FAIL",RingLogger.tags.AUTH),E._validSession=!1)}}return E}angular.module("ringid.global_services").factory("chatHistoryFactory",chatHistoryFactory),chatHistoryFactory.$inject=["Storage","Auth","userFactory","SystemEvents","Utils"];function chatHistoryFactory(e,t,n,r,i){var o,a=CHAT_APP.Constants.GENERAL_CONSTANTS,s=CHAT_APP.Constants.CHAT_VERSION_INFO,c={},l={},u={},d=0,g=0;function m(){c=e.getData("chatOpenedBoxes")||{},l=e.getData("chatBoxes")||{}}function E(){return g}function f(){g=0}function p(){var t=e.getData("unreadMessageIds");d=0,g=0,t?Object.keys(t).forEach(function(e){u[e]={},t[e].forEach(function(t){u[e][t]=!0,d++}),g++}):u={}}function T(t){var n,o;t!==!1&&(n=!0),o={},Object.keys(u).forEach(function(e){o[e]=Object.keys(u[e])}),e.setData("unreadMessageIds",o,n),i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)}function h(){c={},l={},S(!1),C(!1),T(!1),_(s,!1)}function I(){var t=e.getData("cgInf");t&&t.version&&t.version===s.version||h(),t?angular.extend(s,t):_()}function _(t,n){var r=n;r!==!1&&(r=!0),t&&angular.extend(s,t),e.setData("cgInf",s,r)}function A(e){var t,r;angular.isObject(e.user)||(e.user=n.create(e.user)),t=e.user;try{t=e.user.getKey()}catch(e){RingLogger.debug(e,RingLogger.tags.CHAT)}return r={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:t},e.usersToChange&&(r.usersToChange=e.usersToChange),e.statusType&&(r.statusType=e.statusType),r}function S(t){var n=t;n!==!1&&(n=!0),e.setData("chatBoxes",l,n)}function C(t){var n=t;n!==!1&&(n=!0),e.setData("chatOpenedBoxes",c,n)}function v(e,t){var n=e.toString();c||(c={}),c[n]||(c[n]={boxId:n,isTagChat:t}),C()}function D(e,t){var n,r,i;if(l[e]&&(n=l[e].messages))for(i=0,r=n.length;i<r;i++)if(n[i].key===t)return n[i];return!1}function R(e,t){u[e]||(u[e]={},i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED)),u[e][t]||(u[e][t]=!0,d++),g=Object.keys(u).length}function M(e,t){u[e]&&u[e][t]&&(delete u[e][t],d--,T())}function N(e){var t;u[e]&&(t=Object.keys(u[e]).length,delete u[e],d-=t,d<0&&(d=0),T(),g=Object.keys(u).length,i.triggerCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED))}function y(){return u}function b(){return d}function O(e){return u[e]?Object.keys(u[e]).length:0}function P(){I(),m(),p()}return o={init:P,loadChatBoxes:m,loadChatGeneralInfo:I,saveChatGeneralInfo:_,updateChatOpenBoxes:C,updateChatBoxes:S,addUnreadMessageInfo:R,removeUnreadMessageInfo:M,updateUnreadMessageInfos:T,getUnreadMessageInfos:y,getUnreadMessageCount:b,getUnreadConversationCount:E,resetConversationCount:f,getUnreadMessageCountByBoxId:O,removeUnreadMessageInfoByBoxId:N,getMessageByPacketId:D,getChatOpenBoxes:function(){return c},getChatBoxes:function(){return l},addOpenBoxes:v,removeOpenBox:function(e){c[e]&&delete c[e],C()},countOpenBoxes:function(){var e;return e=c?Object.keys(c).length:0},getAllOpenBoxes:function(){var e;return e=!!(c&&Object.keys(c).length>0)&&c},addBox:function(e){var t=e;t={key:t.key,ip:t.ip,rPort:t.rPort,closedBox:t.closedBox,isMinimized:t.isMinimized,isHidden:t.isHidden,isFocused:t.isFocused,blinkOn:t.blinkOn,timeout:t.timeout,secretChat:t.secretChat,nonDomBox:t.nonDomBox,offlineStatus:t.offlineStatus,isTagChat:t.isTagChat,chatBoxClass:t.chatBoxClass,unreadCount:t.unreadCount,isSecretVisible:t.isSecretVisible,blocked:t.blocked,blockedByUtId:t.blockedByUtId,messages:[]},l||(l={}),l[t.key]||(l[t.key]=t),S()},updateBox:function(e){var t=e;t={key:t.key,ip:t.ip,rPort:t.rPort,closedBox:t.closedBox,isMinimized:t.isMinimized,isHidden:t.isHidden,isFocused:t.isFocused,blinkOn:t.blinkOn,timeout:t.timeout,secretChat:t.secretChat,nonDomBox:t.nonDomBox,offlineStatus:t.offlineStatus,isTagChat:t.isTagChat,isSecretVisible:t.isSecretVisible,blocked:t.blocked,blockedByUtId:t.blockedByUtId,chatBoxClass:t.chatBoxClass,unreadCount:t.unreadCount},l||(l={}),l[t.key]?angular.extend(l[t.key],t):l[t.key]=t,S()},getBox:function(e){return!!l[e]&&l[e]},addMessage:function(e,t){var r,i,o,s=t.toString();if(l[s]){e.user&&e.user.getKey||(e.user=n.create(e.user)),o={key:e.key||e.packetId,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime||"",status:e.status||0,fullName:e.fullName||"",tagName:e.tagName||"",messageDate:e.messageDate,seenSent:e.seenSent||!1,isDeleted:e.isDeleted||!1,messageDateString:e.messageDateString||"",timeout:e.timeout||0,messageType:e.messageType,tag_chat:e.tag_chat,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:e.user.getKey(),userId:e.user.getKey()},e.statusType&&(o.statusType=e.statusType),e.usersToChange&&(o.usersToChange=e.usersToChange),l[s].messages||(l[s].messages=[]),r=0;try{for(i=0;i<l[s].messages.length;i++)if(l[s].messages[i].key===o.key){r=1;break}}catch(e){RingLogger.alert(e,RingLogger.tags.CHAT)}0===r&&(l[s].messages.push(o),l[s].messages.sort(function(e,t){return e.messageDate-t.messageDate}),l[s].messages.splice(0,l[s].messages.length-a.HISTORY_MAX_MESSAGE))}S()},removeMessage:function(e,t){var n,r=t.toString(),i=!1;if(l&&l[r])for(n=0;n<l[r].messages.length;n++)l[r].messages[n].key===e&&(l[r].messages.splice(n,1),i=!0);i&&S()},updateMessage:function(e,t){var r,i,o=t.toString();if(l[o])for(angular.isObject(e.user)||(e.user=n.create(e.user)),i={key:e.key,packetId:e.packetId||e.key,packetType:e.packetType||6,brokenPacketType:e.brokenPacketType||8,platform:e.platform||5,text:e.text||e.message||e.mg,hrtime:e.hrtime,status:e.status||0,seenSent:e.seenSent||!1,messageDate:e.messageDate,isDeleted:e.isDeleted,latitude:e.latitude,longitude:e.longitude,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,isSecretVisible:e.isSecretVisible,tag_chat:e.tag_chat,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,user:e.user.getKey()},e.usersToChange&&(i.usersToChange=e.usersToChange),e.statusType&&(i.statusType=e.statusType),r=0;r<l[o].messages.length;r++)if(l[o].messages[r].key===i.key){l[o].messages[r]=i;break}S()},updateMessages:function(e,t){var n,r,i,o,a,s,c,u;if(e.length){for(n=t.toString(),r={},i=0,a=e.length;i<a;i++)r[e[i].key]=e[i];if(l)for(s=l[n],o=0;o<s.messages.length;o++)c=s.messages[o],u=r[c.key],u&&(s.messages[o]=A(u));S()}},isInLocalStorageChatMsgMap:function(e,t){try{return!!l[e][t]}catch(e){return!1}},countMessage:function(e){var t;return!!l[e]&&(t=l[e],t.messages?t.messages.length:0)},getMessages:function(e){var t;return l[e]?(t=l[e],t.messages):[]},getMessage:function(e,t){var n;if(l[e]&&l[e].messages)for(n=0;n<l[e].messages.length;n++)if(l[e].messages[n].key===t)return l[e].messages[n];return!1}}}angular.module("ringid.global_services").factory("Storage",StorageFactory),StorageFactory.$inject=[];function StorageFactory(){var e,t,n,r,i=!1;function o(e){try{return t=window[e],n="__storage_test__",t.setItem(n,n),t.removeItem(n),i=!0,window[e]}catch(e){return i=!1,{}}}r=o("localStorage");function a(t){e=t,angular.isDefined(r[e])&&c(e,{})}function s(t){var n=t;switch(t){case"loginData":case"country":case"remInfo":case"stickerData":break;case"chatOpenedBoxes":case"chatBoxes":case"cgInf":case"cts":case"unreadMessageIds":case"uLocationInfo":case"mood":case"utIds":case"incomingUtIds":case"outgoingUtIds":case"suggestionUtIds":case"contacts":case"notikeys":case"notiseen":case"oldNotiCount":case"mediaRecent":case"albumname":case"circledata":case"circleut":case"myStickers":n=e+"-"+t}return n}function c(e,t){var n=s(e);i?r.setItem(n,angular.toJson(t)):r[n]=angular.toJson(t)}function l(e){var t,n=s(e);return t=i?angular.fromJson(r.getItem(n)):angular.fromJson(r[n])}function u(e){var t=s(e);i?r.removeItem(t):delete r[t]}function d(t){var n,o,s;function d(){var t,a=[];if(l("contacts")||c("contacts",{}),l("chatOpenedBoxes")||c("chatOpenedBoxes",{}),l("chatBoxes")||c("chatBoxes",{}),l("unreadMessageIds")||c("unreadMessageIds",[]),l("mediaRecent")||c("mediaRecent",[]),l("notiseen")||c("notiseen",[]),l("oldNotiCount")||c("oldNotiCount",0),l("uLocationInfo")||c("uLocationInfo",{}),l("mediaRecent")||c("mediaRecent",[]),i){for(t=0,o=r.length;t<o;++t)n=r.key(t).match(/(\d+)-([a-z]+)/i),n&&n.length>1&&parseInt(n[1],10)!==e&&a.push(r.key(t));a.forEach(function(e){u(e)})}}t?(s=angular.fromJson(t),a(s.utId),c("loginData",s),d()):Cookies.get("utId")&&(a(Cookies.get("utId")),d())}function g(e,t){setTimeout(function(){c(e,t)},200)}d(l("loginData"));function m(e){d(e)}function E(){u("loginData"),u("remInfo"),u("contacts"),u("chatOpenedBoxes"),u("suggestionUtIds")}function f(e,t,n){n?g(e,t):c(e,t)}function p(e){return l(e)}function T(e){u(e)}function h(e,t){var n;e&&(n=l("contacts")||{},n.hasOwnProperty(e)?n[e]=angular.extend({},n[e],t):n[e]=t,c("contacts",n))}function I(e){var t,n=l("contacts");return t=!(!n||!n[e])&&n[e]}function _(e,t){var n=l("loginData");n[e]=t,c("loginData",n)}function A(e,t,n){n?Cookies.set(e,t,{expires:n}):Cookies.set(e,t)}function S(e){return Cookies.get(e)}function C(e){return Cookies.remove(e)}return{init:m,reset:E,setData:f,getData:p,deleteData:T,setContact:h,getContact:I,updateLoginData:_,setCookie:A,getCookie:S,removeCookie:C}}angular.module("ringid.global_services").factory("Contacts",ContactsFactory),ContactsFactory.$inject=["settings","$$stackedMap"];function ContactsFactory(e,t){var n={utIds:t.createNew(),incomingUtIds:t.createNew(),outgoingUtIds:t.createNew()},r=t.createNew();function i(){}function o(){}function a(){return n.utIds}function s(){return n.outgoingUtIds}function c(){return n.incomingUtIds}function l(e,t){return r.save(t,n[e].get(t)),n[e].remove(t)}function u(e,t,r){n[e].save(t,r)}function d(e){return n.utIds.get(e)||n.incomingUtIds.get(e)||n.outgoingUtIds.get(e)||r.get(e)||{frnS:0}}return{init:i,initStorage:o,utIds:a,outgoingUtIds:s,incomingUtIds:c,remove:l,add:u,getFrns:d}}angular.module("ringid.global_services").service("routeService",routeService),routeService.$inject=["RING_ROUTES","settings"];function routeService(e,t){var n=this;n.getRoute=o,n.validParam=r;function r(e,t){var n=!0;switch(e){case"uId":n=/^21\d{8}$/.test(t);break;case"utId":case"albumId":case"circleId":n=/^[0-9]+$/.test(t);break;default:RingLogger.warning("No Validation rule for: "+e,RingLogger.tags.DEFAULT)}return n||RingLogger.warning("Invalid "+e+": "+t),n}function i(e,t){var n,i=e;for(n in t)t.hasOwnProperty(n)&&r(n,t[n])&&(i=i.replace(new RegExp(":"+n+"\\??"),t[n]));return i=i.replace(/\/:[\w]+\??/g,"")}function o(n,r){var o;if(!e[n])return"";switch(o=e[n],n){case"HOME":case"MEDIA_CLOUD":case"MEDIA_FEEDS":case"CIRCLE_LIST":case"NEWSPORTAL_FEED":case"PAGES_FEED":case"CHAT_GROUPS":case"MEDIA_CLOUD_MYALBUM":case"MEDIA_POST":case"NEWSPORTAL_FOLLOWING":case"NEWSPORTAL_DISCOVER":case"NEWSPORTAL_SAVED":case"PAGES_FOLLOWING":case"PAGES_DISCOVER":case"PAGES_SAVED":case"FAQ":break;case"PROFILE":case"CIRCLE":case"NEWSPORTAL":case"PAGE":case"WHO_SHARED_FEED":case"SINGLE_FEED":case"MEDIA_CLOUD_ALBUM":case"MEDIA_CLOUD_SEARCH":case"MEDIA_CLOUD_USERMEDIA":case"SINGLE_IMAGE":case"SINGLE_MEDIA":case"CHAT_GROUP":o=i(o,r)}return t.html5Mode?o:"/#"+o}}!function(e,t){"use strict";e.module("ringid.global_directives",["ngRoute","ringid.config"])}(angular,window),angular.module("ringid.global_directives").directive("rgColumn",rgColumn),rgColumn.$inject=["$document","Utils","SystemEvents","$rootScope"];function rgColumn(e,t,n,r){i.$inject=["$scope"];function i(e){function i(i){t.resetScroll(),t.animateScroll(),t.setFeedColumn(i),e.spans=i,r.$broadcast(n.COMMON.COLUMN_CHANGED,i)}function o(t){e.spans=t,r.$broadcast(n.COMMON.COLUMN_CHANGED,t)}function a(){e.defaultSpan=t.getDefaultColumn(),e.$rgDigest()}e.spans=t.feedColumn(),e.defaultSpan=t.getDefaultColumn(),e.choose=i,e.$watch(t.feedColumn,o),e.$on(n.COMMON.WINDOW_RESIZED,a)}function o(t,n){var r;function i(t){t.preventDefault(),r||(r=angular.element(n.find("div")[0]),e.on("click",o)),r.toggleClass("colshow")}function o(e){var t=n.parent().parent()[0];e.target!==t&&e.target.parentNode!==t&&null!==e.target.parentNode&&e.target.parentNode.parentNode!==t&&"pt-top"!==e.target.className&&a(e)}n.parent().parent().on("click",i);function a(){r.removeClass("colshow")}function s(){n.off("click",i),e.off("click",o),r=void 0}t.$on("$destroy",s)}return{restrict:"A",controller:i,template:'<span></span><span></span><span></span><div class="col-area"><div class="col-area-wrapper"><div class="list-ico width-26 top-l" data-tool="3 Column" ng-click="choose(3)" ng-if="defaultSpan > 2" ng-class="{\'list-act\' : spans == 3 }"><span></span><span></span><span></span></div><div class="list-ico width-17 top-l" data-tool="2 Column" ng-click="choose(2)"  ng-if="defaultSpan > 1" ng-class="{\'list-act\' : spans == 2 }"><span></span><span></span></div><div  class="list-ico width-9 top-l" data-tool="1 Column" ng-click="choose(1)" ng-class="{\'list-act\' : spans == 1 }"><span></span></div></div></div>',link:o}}angular.module("ringid.global_directives").directive("rgImgLoad",rgImgLoad).directive("rgClick",rgClick).directive("rgConditionalClick",rgConditionalClick),rgConditionalClick.$inject=[];function rgConditionalClick(){function e(e,t,n){function r(){n.rgConditionalClick()}function i(){t.unbind("click")}angular.isFunction(n.rgConditionalClick)&&(t.bind("click",r),e.$on("$destroy",i))}return e}rgClick.$inject=["$parse"];function rgClick(e){function t(t,n,r){var i=e(r.rgClick);function o(e){i(t,{$event:e}),t.$rgDigest()}function a(){n.unbind("click",o)}n.bind("click",o),t.$on("$destroy",a)}return{restrict:"A",link:t}}function rgImgLoad(){function e(e,t){function n(){RingLogger.print("Image Loaded")}t.on("load",n)}return{restrict:"A",transclude:!0,link:e}}angular.module("ringid.global_directives").service("rgDropdownService",dropdownService).directive("rgDropdown",rgDropdown),dropdownService.$inject=["GlobalEvents"];function dropdownService(e){var t=this,n=!1,r=!1;function i(e){var n=e.keyCode||e.which;27===n&&t.close(e)}function o(){n&&angular.isFunction(n.ddBeforeClose)&&n.ddBeforeClose(),r(),e.unbindHandler("document","click",t.close),e.unbindHandler("document","keydown",i)}function a(){n.ddOpened(),e.bindHandler("document","click",t.close),e.bindHandler("document","keydown",i)}t.open=function(e,t){r&&o(),r=e,n=t,a()},t.close=function(e){e&&(e.preventDefault(),e.stopPropagation()),r&&o(),r=!1,n=!1}}rgDropdown.$inject=["$ringhttp","settings","$compile","rgDropdownService","languageConstant","Utils","rgScrollbarService"];function rgDropdown(e,t,n,r,i,o,a){function s(t,o){var a,s,c=!1,l=!1;t.consType=i.get();function u(e){e.stopPropagation()}function d(e){c?r.close():(T(e),r.open(h,t)),u(e)}function g(e){function t(){l?RingLogger.information("IS ON DROPDOWN",RingLogger.tags.DROPDOWN):(RingLogger.information("NOT ON DROPDOWN",RingLogger.tags.DROPDOWN),d(e))}setTimeout(t,500)}function m(e){s=e}function E(){RingLogger.warning("DROPDOWN TEMPLATE missing: "+t.ddHtml,RingLogger.tags.DROPDOWN),t.$rgDigest()}o.on("click",d),t.ddHtml||t.ddTemplate?t.ddTemplate?s=t.ddTemplate:e.get(t.ddHtml).success(m,E):RingLogger.error("Please set ddHtml for rg-dropdown.",RingLogger.tags.DROPDOWN);function f(){RingLogger.information("Mouse Enter",RingLogger.tags.DROPDOWN),l=!0,o.off("mouseleave",g)}function p(e){RingLogger.information("Mouse Leave",RingLogger.tags.DROPDOWN),l=!1,g(e),o.on("mouseleave",g)}function T(){var e;for(RingLogger.information("DROPDOWN OPEN",RingLogger.tags.DROPDOWN),c=!0,a=n(s)(t),t.ddControl&&t.ddControl.hasOwnProperty("append")&&!t.ddControl.append?o.after(a):o.append(a),e=0;e<a.length;e++)a[e].addEventListener("click",u);t.ddControl&&t.ddControl.showOnHover&&(o[0].addEventListener("mouseleave",g),a[a.length-1].addEventListener("mouseenter",f),a[a.length-1].addEventListener("mouseleave",p)),t.$rgDigest()}function h(){var e;for(c=!1,e=0;e<a.length;e++)a[e].removeEventListener("click",u);t.ddControl&&t.ddControl.showOnHover&&(o[0].removeEventListener("mouseleave",g),a[a.length-1].removeEventListener("mouseenter",f),a[a.length-1].removeEventListener("mouseleave",p)),a.remove(),t.$parent.$rgDigest()}function I(){o[0].removeEventListener("click",d),h()}t.$on("$destory",I)}return{restrict:"AE",link:s,scope:{ddHtml:"=",ddControl:"=",ddTemplate:"=",ddAction:"&",ddOpened:"&",ddBeforeClose:"&"}}}angular.module("ringid.global_directives").directive("rgPageTitle",rgPageTitle),rgPageTitle.$inject=["$rootScope","chatHistoryFactory","Utils","SystemEvents"];function rgPageTitle(e,t,n,r){var i,o,a=1e3,s=n.getCurrentPageTitle();function c(){var e,n=t.getUnreadConversationCount();return e=n>0?"("+n+") "+s:s}i=c;function l(){function e(){var e=c();n.setPageTitle(n.getCurrentPageTitle()===e?s:e)}o=setInterval(e,a)}function u(){clearInterval(o),n.setPageTitle(i())}function d(e,t){RingLogger.print("page title changes",t.title,RingLogger.tags.PAGETITLE),s=t.title}function g(){n.setPageTitle(i())}return e.$on("ringActive",u),e.$on("ringInactive",l),e.$on("PAGE_TITLE_CHANGE",d),n.onCustomEvent(r.CHAT.UNREAD_MESSAGE_INFO_UPDATED,g),n.onCustomEvent(r.CHAT.CONVERSATION_COUNT_RESETED,g),{}}angular.module("ringid.global_directives").directive("rgUserTrack",rgUserTrack),rgUserTrack.$inject=["userFactory","Utils"];function rgUserTrack(e,t){function n(n,r,i){var o,a=i.rgUserTrack;function s(){o=e.getUser(a),o&&o.shouldUpdatePresence()&&o.fetchPresence()}a&&(e.trackUserUsage(a),r.on("mouseover",t.debounce(s,500)),n.$on("$destroy",function(){e.unTrackUserUsage(a)}))}return{restrict:"A",link:n}}!function(e,t){"use strict";e.module("ringid.social",[])}(angular,window),angular.module("ringid.social").service("socialUtils",socialUtils);function socialUtils(){var e=this;function t(t,n){var r,i={};for(r in t)t.hasOwnProperty(r)&&(r in n&&"object"==typeof t[r]&&null!==r?i[r]=e.merge(t[r],n[r]):i[r]=t[r]);for(r in n)if(n.hasOwnProperty(r)){if(r in i)continue;i[r]=n[r]}return i}function n(e,t){var n;if(/^(?:[a-z]+:)?\/\//i.test(t))return t;n=[e,t].join("/");function r(e){return e.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/#/g,"#").replace(/:\//g,"://")}return r(n)}function r(e){var t,n,r={};function i(){e&&(n=e.split("="),t=decodeURIComponent(n[0]),r[t]=!angular.isDefined(n[1])||decodeURIComponent(n[1]));
}return angular.forEach((e||"").split("&"),i),r}function i(e){function t(e,t,n,r){return r?n.toUpperCase():n}return e.replace(/([:\-_]+(.))/g,t)}e.camelCase=i,e.parseQueryString=r,e.joinUrl=n,e.merge=t}angular.module("ringid.social").constant("socialConfig",{providers:{facebook:{name:"facebook",url:"/auth/facebook",clientId:"477404429103451",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/static-index.html",requiredUrlParams:["access_code"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:680,height:500}},twitter:{twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin+"/static-index.html",type:"1.0",serverUrl:window.location.origin+"/TwiteerLoginService",popupOptions:{width:595,height:745}}}}),angular.module("ringid.social").factory("socialPopup",socialPopup),socialPopup.$inject=["$$q","$interval","$window","socialConfig","socialUtils"];function socialPopup(e,t,n,r,i){var o={};o.url="",o.popupWindow=null,o.open=u,o.eventListener=l,o.pollPopup=c,o.prepareOptions=s,o.stringifyOptions=a;function a(e){var t=[];function n(e,n){t.push(n+"="+e)}return angular.forEach(e,n),t.join(",")}function s(e){var t,r,i;return r=e||{},t=r.width||500,i=r.height||500,angular.extend({width:t,height:i,left:n.screenX+(n.outerWidth-t)/2,top:n.screenY+(n.outerHeight-i)/2.5},r)}function c(){var t,n,r,a=e.defer();function s(){var e,s,c,l;try{t=document.location.host,n=o.popupWindow.location.host,n===t&&(o.popupWindow.location.search||o.popupWindow.location.hash)&&(e=o.popupWindow.location.search.substring(1).replace(/\/$/,""),s=o.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),c=i.parseQueryString(s),l=i.parseQueryString(e),angular.extend(l,c),l.error?a.reject(l):a.resolve(l),clearInterval(r),o.popupWindow.close())}catch(e){}o.popupWindow&&!o.popupWindow.closed&&void 0!==o.popupWindow.closed||clearInterval(r)}return r=setInterval(s,50),a.promise}function l(t){var n=e.defer();function r(e){var r,a,s,c,l;0===e.url.indexOf(t)&&(r=document.createElement("a"),r.href=e.url,(r.search||r.hash)&&(a=r.search.substring(1).replace(/\/$/,""),s=r.hash.substring(1).replace(/\/$/,""),c=i.parseQueryString(s),l=i.parseQueryString(a),angular.extend(l,c),l.error||n.resolve(l),o.popupWindow.close()))}o.popupWindow.addEventListener("loadstart",r),o.popupWindow.addEventListener("loaderror",a),o.popupWindow.addEventListener("onbeforeunload",s);function a(){n.reject({rc:0,mg:"Error Loading Authorization URL"})}function s(){n.reject({rc:0,mg:"Popup closed unexpectedly"})}return n.promise}function u(e,t,i){var a=o.stringifyOptions(o.prepareOptions(i)),s=n.navigator.userAgent,c=r.cordova||s.indexOf("CriOS")>-1?"_blank":t;return o.url=e,o.popupWindow=n.open(e,c,a),n.popup=o.popupWindow,o.popupWindow&&o.popupWindow.focus&&o.popupWindow.focus(),o}return o}angular.module("ringid.social").factory("socialOauth",socialOauthFactory).factory("socialOauth1",socialOauth1Factory).factory("socialOauth2",socialOauth2Factory),socialOauthFactory.$inject=["socialConfig","socialOauth1","socialOauth2"];function socialOauthFactory(e,t,n){var r={};function i(r,i){var o="1.0"===e.providers[r].type?t():n();return o.open(e.providers[r],i)}return r.authenticate=i,r}socialOauth2Factory.$inject=["$$q","$window","socialUtils","socialConfig","Storage","socialPopup","$ringhttp"];function socialOauth2Factory(e,t,n,r,i,o,a){function s(){var t={},r={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"token",responseParams:{token:"token",clientId:"clientId",redirectUri:"redirectUri"}};function s(){var e,t,i=[],o=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];function a(o){e=n.camelCase(o),t=angular.isFunction(r[o])?r[o]():r[e],i.push([o,t])}function s(e){angular.forEach(r[e],a)}function c(e){return e.join("=")}return angular.forEach(o,s,a),i.map(c).join("&")}function c(t,n){var c,l,u,d,g,m=e.defer();angular.extend(r,t),g=r.name+"_state",angular.isFunction(r.state)?i.setData(g,r.state()):angular.isString(r.state)&&i.setData(g,r.state),u=[r.authorizationEndpoint,s(n)].join("?"),RingLogger.information("authorization url: "+u,RingLogger.tags.AUTH),d=o.open(u,r.name,r.popupOptions,r.redirectUri),l=setInterval(h,1e3),d.pollPopup().then(T,E);function E(){m.reject({mg:"Popup blocked by Browser. Please unblock."})}function f(e){RingLogger.information("SOCIAL USER DATA: ",RingLogger.tags.AUTH),RingLogger.print(e,RingLogger.tags.AUTH),e.id?m.resolve({platform:r.name,id:e.id,name:e.name,access_token:c}):m.reject()}function p(){m.reject()}function T(e){clearInterval(l),c=e.access_token,a.get("https://graph.facebook.com/me?access_token="+e.access_token).success(f).error(p)}function h(){d.popupWindow.closed&&(clearInterval(l),m.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))}return m.promise}return t.open=c,t}return s}socialOauth1Factory.$inject=["$q","socialConfig","socialUtils","socialPopup","$ringhttp"];function socialOauth1Factory(e,t,n,r,i){function o(){var t={},n={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};t.open=c;function o(e,t){var r;return t.uId=t.uId.toString(),r="?step=3&oauth_token="+e.oauth_token+"&verifier="+e.oauth_verifier+(t.uId&&t.uId.length>2?"&uId="+t.uId:"")+"&time="+(new Date).getTime(),RingLogger.information("exhcangeForToken URL: "+n.serverUrl+r,RingLogger.tags.AUTH),i.get(n.serverUrl+r)}function a(){return RingLogger.information("exchangeForRequest URL: "+n.serverUrl+"?step=1&callback="+n.redirectUri,RingLogger.tags.AUTH),i.get(n.serverUrl+"?step=1&callback="+encodeURIComponent(n.redirectUri)+"&time="+Date.now())}function s(e){var t=[];function n(e,n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}return angular.forEach(e,n),t.join("&")}function c(t,i){var c,l,u=e.defer();angular.extend(n,t),RingLogger.print(n,RingLogger.tags.AUTH),l=r.open("",n.name,n.popupOptions,n.redirectUri),c=setInterval(d,1e3),a().success(m).error(g);function d(){l.popupWindow.closed&&(clearInterval(c),u.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))}function g(){RingLogger.alert("twitter oauth request token fetch fail",RingLogger.tags.AUTH),u.reject({mg:"exchangeForRequest failed. Server error"})}function m(e){var t,r;function a(e){function t(t){var r,i,o;t.sucs===!0||2===t.rc?(r=t.data.members,i=JSON.parse(r.userDetails),o=JSON.parse(r.accessToken),RingLogger.print("ACCESS TOKEN DATA: ",e,r,RingLogger.tags.AUTH),u.resolve({platform:n.name,id:i.id_str,name:i.name,access_token:o.token,oauthParameters:o.oauthParameters,oauth_token:e.oauth_token,oauth_verifier:e.oauth_verifier})):u.reject({mg:"exchangeForRequest failed"})}function r(){u.reject({mg:"exchangeForRequest failed. Server error"})}clearInterval(c),o(e,i).success(t).error(r)}e.sucs===!0?(t=e.data,r=[n.authorizationEndpoint,s({oauth_token:t.token,callback_url:n.redirectUri})].join("?"),l.popupWindow?(l.popupWindow.location=r,RingLogger.information("TWITTER authorize url: "+r,RingLogger.tags.AUTH),RingLogger.print("REQUEST TOKEN DATA: ",t,RingLogger.tags.AUTH),l.pollPopup().then(a)):u.reject({mg:"Popup blocked by Browser. Please unblock."})):u.reject({mg:"exchangeForRequest failed"})}return u.promise}return t}return o}angular.module("ringid.social").provider("$authSocial",authSocial),authSocial.$inject=["socialConfig"];function authSocial(e){function t(t){function n(n){return angular.extend(e.providers[t],n)}this[t]=n}angular.forEach(Object.keys(e.providers),t,this);function n(t){e.providers[t.name]=e.providers[t.name]||{},angular.extend(e.providers[t.name],t)}function r(t){n(t),e.providers[t.name].type="1.0"}function i(t){n(t),e.providers[t.name].type="2.0"}this.oauth1=r,this.oauth2=i;function o(e,t){var n={login:r,authenticate:i};function r(n){var r,i=e.defer();function o(e){i.resolve(e)}function a(e){i.reject(e)}return r?i.resolve(r):t.authenticate(n,"login").then(o,a),i.promise}function i(n,r){var i=e.defer();function o(e){i.resolve(e)}function a(e){i.reject(e)}return t.authenticate(n,r).then(o,a),i.promise}return n}this.$get=["$$q","socialOauth",o]}!function(e,t){"use strict";e.module("ringid.auth",["ringid.config","ringid.digits","ringid.connector","ringid.social"])}(angular,window),angular.module("ringid.auth").directive("rgSlider",rgSlider);function rgSlider(){function e(e,t,n){var r,i,o,a=0,s=!0,c=null,l=[],u=t[0],d=n.navClass||"",g=n.slideClass||"",m=n.descClass||"",E=1e3*parseInt(n.delay,10)||3e3,f=angular.element(u.querySelectorAll("."+g)),p=angular.element(u.querySelectorAll("."+m)),T=u.querySelectorAll("."+d)||{},h=120,I=.6,_=.6,A=.8,S=u.querySelector(".nav-carousel"),C=[],v=S.clientWidth,D=S.clientHeight;i=S.querySelectorAll("img"),i=Array.prototype.slice.call(i),o=Math.floor(i.length/2),b(),R();function R(){for(f.removeClass("active"),f.eq(a).addClass("active"),p.removeClass("active"),p.eq(a).addClass("active"),r=0;r<l.length;r++)l[r].find("li").removeClass("active"),l[r].find("li").eq(a).addClass("active");C[0]&&P(F(a)),s&&(a=a+1===f.length?0:a+1,M())}function M(){function e(){R()}c=setTimeout(e,E)}function N(){clearTimeout(c)}function y(e){var t,n=e.parentNode.childNodes,r=0;for(t=0;t<n.length;t++){if(n[t]===e)return r;1===n[t].nodeType&&r++}return-1}function b(){var e,t;function n(){a=y(this),N(),R()}for(t=0;t<T.length;t++)e=angular.element(T[t]),l.push(e),e.find("li").on("click",n);function r(e){e.stopPropagation(),s=!1,N()}function i(e){e.stopPropagation(),s=!0,M()}f.on("mouseenter",r),f.on("mouseleave",i),p.on("mouseenter",r),p.on("mouseleave",i)}function O(){var e,t,n,s,c,l,u;for(e=i[0].clientWidth,t=i[0].clientHeight,n=1,s=Math.round(v/2)-Math.round(e/2),c=Math.round(D/2)-Math.round(t/2),C[o]={w:e,h:t,o:n,l:s,t:c,z:o,i:0},u=h,l=o,r=o+1;r<i.length;r++)u*=I,e=_*C[r-1].w,t=_*C[r-1].h,n=A*C[r-1].o,s=C[r-1].l+C[r-1].w+u-e,--l,c=Math.round(D/2)-Math.round(t/2),C[r]={w:e,h:t,o:n,l:s,t:c,z:l,i:r};for(u=h,l=o,r=o-1;r>=0;r--)u*=I,e=_*C[r+1].w,t=_*C[r+1].h,n=A*C[r+1].o,s=C[r+1].l-u,--l,c=Math.round(D/2)-Math.round(t/2),C[r]={w:e,h:t,o:n,l:s,t:c,z:l,i:r};function d(){this.crslPos!==o&&(a=this.orgPos,N(),R(),P(this))}for(r=0;r<i.length;r++)i[r].orgPos=r,i[r].crslPos=r,i[r].addEventListener("click",d)}function P(e){L(e),U()}function L(e){for(var t,n=e.crslPos<o?"forward":"backward";e.crslPos!==o;)for("forward"===n?(t=i.pop(),i.unshift(t)):(t=i.shift(),i.push(t)),r=0;r<i.length;r++)i[r].crslPos=r,i[r].className="";e.className="active"}function U(){for(r=0;r<i.length;r++)i[r].style.width=C[r].w+"px",i[r].style.height=C[r].h+"px",i[r].style.opacity=C[r].o,i[r].style.left=C[r].l+"px",i[r].style.top=C[r].t+"px",i[r].style.zIndex=C[r].z,C[r].i=r}function F(e){for(r=0;r<i.length;r++)if(e===i[r].orgPos)return i[r];return!1}i[0].src=i[0].src;function w(){O(),P(i[0]);function e(){S.style.visibility="visible"}setTimeout(e,800)}i[0].addEventListener("load",w)}return{link:e}}angular.module("ringid.auth").controller("AuthController",AuthController),AuthController.$inject=["rgDropdownService","Storage","Auth","$scope","$$connector","$rootScope","Ringalert","settings","MESSAGES"];function AuthController(e,t,n,r,i,o,a,s,c){r.requestFailed=l,r.activeTab="phone",r.credentials={username:"",authMethod:"phone",uId:"",lt:2,mbl:"",email:"",ringid:"",password:"",remember:Boolean(t.getData("remember")),mblDc:n.getCountry().code,flagcode:n.getCountry().flagcode},r.autofill={email:r.credentials.email,ringid:r.credentials.ringid,mbl:r.credentials.mbl},r.errorMsg="",r.requestSuccess=!1,r.disableForm=!1,r.formStyle={left:"0px"},r.activateTab=u,r.setPrefix=d,r.login=g,r.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" > <li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',r.ddControl={append:!1,countryList:n.getCountryList};function l(e,t,n){e?(r.disableForm=!1,e.sucs===!0||"true"===e.sucs?(r.requestSuccess=!0,r.errorMsg=e.mg||c.REQUEST_PROCESSED):(r.requestSuccess=!1,r.errorMsg=e.hasOwnProperty("rc")&&e.rc>0?c["RC"+e.rc]:e.mg||c.REQUEST_FAILED,s.analytics&&ga("send","event",t+" Message:"+r.errorMsg+" RC:"+e.rc||"UNKNOWN")),n&&a.show(r.errorMsg,"error")):(r.disableForm=!0,r.requestSuccess=!0,r.errorMsg=""),r.$rgDigest()}function u(e){if(!r.disableForm){switch(r.errorMsg="",r.activeTab=e,r.activeTab){case"email":r.credentials.authMethod="email",r.formStyle.left="-800px",r.credentials.lt=3;break;case"ringid":r.credentials.authMethod="ringid",r.formStyle.left="-400px",r.credentials.lt=1;break;case"facebook":r.credentials.authMethod="social",r.formStyle.left="-1200px",r.credentials.lt=4;break;case"twitter":r.credentials.authMethod="social",r.formStyle.left="-1200px",r.credentials.lt=5;break;case"social":r.credentials.authMethod="social",r.formStyle.left="-1200px";break;default:r.credentials.authMethod="phone",r.formStyle.left="0px",r.credentials.lt=2}r.$rgDigest()}}function d(n){n.event&&e.close(n.event),t.setData("country",n.item),r.credentials.mblDc=n.item.code,r.credentials.flagcode=n.item.flagcode,r.$rgDigest()}function g(e,t){if(t&&t.preventDefault(),e){switch(r.credentials.authMethod){case"ringid":r.credentials.username=r.credentials.ringid;break;case"email":r.credentials.username=r.credentials.email;break;case"phone":r.credentials.username=r.credentials.mbl;break;default:RingLogger.print("Missing AuthMethod for login request",RingLogger.tags.AUTH)}r.requestFailed(!1),n.login(r.credentials).then(i,a)}function i(e){e.sucs===!0||"true"===e.sucs?r.params&&r.params.fromPopup?(r.closeAll(),window.location="/"):o.$rgDigest():r.requestFailed(e,"Signin:"+r.credentials.authMethod)}function a(e){r.requestFailed(e,"Signin:"+r.credentials.authMethod)}}function m(){var e,n=t.getData("activeTab");if(n){switch(e=t.getData("autoFill"),n){case"phone":r.credentials.mbl=e,r.credentials.username=e,r.credentials.lt=2;break;case"email":r.credentials.lt=3,r.credentials.email=e,r.credentials.username=e;break;case"ringid":r.credentials.ringid=e,r.credentials.username=e,r.credentials.lt=1;break;default:RingLogger.print("Missing autofill category",RingLogger.tags.AUTH)}u(n)}r.$rgDigest()}m()}angular.module("ringid.auth").controller("RingboxAuthController",RingboxAuthController),RingboxAuthController.$inject=["$scope","$boxInstance","$controller","localData"];function RingboxAuthController(e,t,n,r){e.close=t.close,e.closeAll=t.closeAll,e.showLoader=t.showLoader,e.hideLoader=t.hideLoader,e.params=r,n("SignInController",{$scope:e})}angular.module("ringid.auth").controller("SignInController",SignInController),SignInController.$inject=["$authSocial","$controller","$scope","Auth","Ringalert","$rootScope"];function SignInController(e,t,n,r,i,o){angular.extend(this,t("AuthController",{$scope:n})),n.noSignupAllowed=a,n.socialLogin=c;function a(){i.alert({title:"Sign Up",message:"Please sign up from your iOS, Android, Windows enabled device or Desktop prior to logging in from the Web version.",showCancel:!1,okCallback:angular.noop})}function s(t){function i(){ga("send","event","Signin Success. ","Auth Method: "+t),n.params&&n.params.fromPopup?($boxInstance.hideLoader(),window.location="/"):o.$rgDigest()}function a(e){switch(n.params&&n.params.fromPopup&&$boxInstance.hideLoader(),e.rc){case"invalidsocialid":n.requestFailed(e,t+": Unregistered Social ID",!0);break;default:n.requestFailed(e,t+": Something went wrong",!0)}}function s(e){n.params&&n.params.fromPopup&&n.showLoader(),r.login(angular.extend(e,n.credentials),!0).then(i,a)}function c(e){n.params&&n.params.fromPopup&&$boxInstance.hideLoader(),n.requestFailed(e,t+": Authentication Failed",!0)}e.authenticate(t,n.credentials).then(s,c)}function c(e){n.credentials.authMethod=e,s("twitter"===e?e:e)}}angular.module("ringid.auth").controller("SignUpController",SignUpController),SignUpController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","remoteData","localData"];function SignUpController(e,t,n,r,i,o,a){angular.extend(this,n("AuthController",{$scope:t})),t.close=r.close,t.closeAll=r.closeAll,t.newUid="",t.credentials.repassword="",t.credentials.vc="",t.credentials.name="",t.signupStep=1,t.sendCode=s,t.verifyCode=c,t.signup=l,a&&(t.formStyle.left="0px",t.credentials.mbl="",t.credentials.email="",t.credentials.ringid="",t.credentials.password="",a.signupData&&(t.credentials.authMethod=a.signupData.signupType,t.credentials.flagcode=a.signupData.flagcode),a.socialData&&(angular.extend(t.credentials,a.credentials),t.newUid=a.credentials.uId.toString().substr(2),t.credentials.authMethod=a.socialData.platform,t.credentials.id=a.socialData.id,t.credentials.name=a.socialData.name,t.credentials.access_token=a.socialData.access_token,t.signupStep=3,t.formStyle.left="-700px")),o&&(t.newUid=o.uId.toString().substr(2));function s(n,r){function i(e){e.sucs===!0&&(t.credentials.uId=e.uId,t.newUid=e.uId.toString().substr(2),t.signupStep=2,t.formStyle.left="-350px"),t.requestFailed(e,"Signup:sendcode")}function o(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:sendcode")}r.preventDefault(),t.disableForm||(t.requestFailed(!1),e.sendCode(t.credentials).then(i,o))}function c(n,r){function i(e){e.sucs===!0&&(t.signupStep=3,t.formStyle.left="-700px"),t.requestFailed(e,"Signup:verify")}function o(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:verify")}r.preventDefault(),t.disableForm||(t.requestFailed(!1),e.verifyCode(t.credentials).then(i,o))}function l(n,i){function o(e){e.sucs===!0&&(t.login(!0),r.closeAll()),t.requestFailed(e,"Signup:sendCode")}function a(e){t.requestFailed(angular.extend(e,{sucs:!1}),"Signup:signup")}i.preventDefault(),t.disableForm||t.credentials.password!==t.credentials.repassword||(t.requestFailed(!1),e.signup(t.credentials).then(o,a))}}angular.module("ringid.auth").controller("SignUpSelectController",SignUpSelectController),SignUpSelectController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial"];function SignUpSelectController(e,t,n,r,i){angular.extend(this,n("AuthController",{$scope:t})),t.close=r.close,t.closeAll=r.closeAll,t.socialSignup=a,t.signupData=o;function o(n){function r(){return{signupData:{signupType:n,code:"phone"===n?e.getCountry().code:"Email",flagcode:"phone"===n?e.getCountry().flagcode:"remail"}}}return{data:r,promise:e.sendCode(t.credentials)}}function a(n){function o(){function o(i){function o(o){function a(){t.closeAll()}function s(){r.hideLoader(),t.requestFailed(o,n+": Social Login Failed",!0)}"dologin"===o.rc?(t.credentials.authMethod=n,r.showLoader(),e.login(angular.extend(i,t.credentials),!0).then(a,s)):(r.hideLoader(),t.requestFailed(o,n+": Authentication Failed",!0))}e.openSignup(i,t.credentials).then(angular.noop,o)}function a(e){r.hideLoader(),t.requestFailed(e,n+": Authentication Failed",!0)}i.authenticate(n,t.credentials).then(o,a)}function a(e){r.hideLoader(),t.requestFailed(e,n+": Authentication Failed",!0)}r.showLoader(),e.sendCode(t.credentials,!0).then(o,a)}}angular.module("ringid.auth").controller("PasswordRecoverController",PasswordRecoverController),PasswordRecoverController.$inject=["$controller","Auth","$scope","$boxInstance"];function PasswordRecoverController(e,t,n,r){var i;angular.extend(this,e("AuthController",{$scope:n})),n.close=r.close,n.activeTab="email",n.activeForm="sendcode",n.activateTab=c,n.activateTab(n.activeTab),n.credentials.email="",n.credentials.mbl="",n.fetchRecoverOptions=a,n.sendCode=l,n.verifyCode=u,n.resetPassword=s,n.verifierEnabled=!1,n.enableVerifier=o;function o(){n.verifierEnabled=!0}function a(e){function r(e){n.verifierEnabled=!1;function t(e){/^21/.test(e)&&(n.credentials.uId=e)}RingLogger.print(e,RingLogger.tags.AUTH),e.sucs===!0&&(n.activeForm="resetpassword",e.sgtns.forEach(t)),n.requestFailed(e,"Recovery:verify")}function i(e){n.verifierEnabled=!1,n.requestFailed(e,"Recovery:verify"),RingLogger.print(e,RingLogger.tags.AUTH)}t.fetchRecoverOptions(e).then(r,i)}function s(e,r){r.preventDefault();function i(e){RingLogger.print(e,RingLogger.tags.AUTH),n.disableForm=!1,n.errorMsg=e.mg,e.sucs===!0&&n.close(),n.requestFailed(e,"Recovery:reset")}function o(e){n.requestFailed(angular.extend(e,{sucs:!1}),"Recovery:reset")}n.disableForm||n.credentials.password!==n.credentials.repassword||(n.requestFailed(!1),RingLogger.information(n.credentials,RingLogger.tags.AUTH),t.resetPassword(n.credentials).then(i,o))}function c(e){n.disableForm||"sendcode"!==n.activeForm||(n.activeTab=e,"email"===n.activeTab?(n.credentials.authMethod="email",n.formStyle.left="0px"):(n.credentials.authMethod="phone",n.formStyle.left="-350px"),n.$rgDigest())}function l(e,r,o){function a(e){e.sucs===!0&&(n.activeForm="verifycode",n.credentials.uId=e.uId),n.requestFailed(e,"phone")}function s(e){n.requestFailed(angular.extend(e,{sucs:!1}),"phone")}i=o,r.preventDefault(),n.disableForm||(n.requestFailed(!1),RingLogger.information(n.credentials,RingLogger.tags.AUTH),t.recoverySendCode(n.credentials,i).then(a,s))}function u(e,r){r.preventDefault();function i(e){e.sucs===!0&&(n.activeForm="resetpassword"),n.requestFailed(e,"Recovery:verify")}function o(e){n.requestFailed(angular.extend(e,{sucs:!1}),"Recovery:verify")}n.disableForm||(n.requestFailed(!1),RingLogger.information(n.credentials,RingLogger.tags.AUTH),t.recoveryVerifyCode(n.credentials).then(i,o))}}!function(e,t){"use strict";e.module("ringid.filters",["ringid.config"])}(angular,window),angular.module("ringid.filters",["ringid.config"]).filter("validProfileImage",validProfileImage).filter("friendListFilter",friendListFilter).filter("mapListFilter",mapListFilter).filter("ymdDateFilter",ymdDateFilter).filter("mediaFilter",mediaFilter).filter("mapFilter",mapFilter).filter("objectFilter",objectFilter).filter("mapOrderBy",mapOrderByFilter).filter("arrayFilter",arrayFilter).filter("trust",trustFilter),validProfileImage.$inject=["settings"];function validProfileImage(e){return function(t){return t.indexOf("prof.png")>0?t:e.imBase+t}}friendListFilter.$inject=["APP_CONSTANTS"];function friendListFilter(e){return function(t,n){var r,i,o=[];if(t)for(r=n.name.toLowerCase(),i=0;i<t.length;i++)n.showMutual&&t[i].value.friendshipStatus()!==e.FRIEND||(0===r.length||t[i].value.getName().toLowerCase().indexOf(r)>-1)&&o.push(t[i]);return o}}function mapListFilter(){return function(e,t){var n,r=[];if(e)for(n=0;n<e.length;n++)t.get(e[n].value.getKey())||r.push(e[n]);return r}}function ymdDateFilter(){return function(e){var t=new Date(e),n=""+(t.getMonth()+1),r=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),[i,n,r].join("-")}}function mediaFilter(){return function(e,t){var n,r=[];if(e)for(n=0;n<e.length;n++)e[n].value.getType()===t&&r.push(e[n]);return r}}function mapFilter(){return function(e,t){var n,r,i=[];if(e)for(r=t.value?t.value.toLowerCase():"",n=0;n<e.length;n++)e[n].value[t.mapApi]().toLowerCase().indexOf(r)>-1&&i.push(e[n]);return i}}function objectFilter(){function e(e,t){return e.indexOf(t)>-1}function t(e,t){return t===e}return function(n,r){var i,o,a=[];if(n&&n.length>0){switch(r.compare){case"string":i=e;break;default:i=t}for(o=0;o<n.length;o++)i(n[o][r.prop],r.value)&&a.push(n[o])}return a}}trustFilter.$inject=["$sce"];function trustFilter(e){return function(t,n){return e.trustAs(n||"html",t)}}function mapOrderByFilter(){return function(e,t,n){var r,i=[],o=t.length;return angular.forEach(e,function(e){i.push(e)}),i.sort(function(e,n){for(r=0;r<o;r++)if(e.value[t[r]]()!==n.value[t[r]]())return e.value[t[r]]()>n.value[t[r]]()?1:-1;return e.value[t[0]]()>n.value[t[0]]()?1:-1}),n&&i.reverse(),i}}function arrayFilter(){return function(e,t){var n,r,i=t.filterArray,o=t.key;return e&&(n=e.filter(function(e){for(r=0;r<i.length;r++)if(e.hasOwnProperty(o)&&e[o]===i[r][o])return!1;return!0})),n}}!function(e,t){"use strict";e.module("ringid.shared",["ringid.filters","ringid.auth","ringid.global_services","ringid.config"])}(angular,window),angular.module("ringid.shared").factory("$$stickerMap",stickerMap).factory("$$stickerImageMap",stickerImageMap),stickerImageMap.$inject=["settings","STICKER_IMAGE_TYPE"];function stickerImageMap(e,t){function n(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};function a(){return o.isSticker}function s(){return o.isLargeEmoticon}function c(){return o.isEmoticon}function l(){return o.src.replace(e.stickerBase,"")}function u(){return o.name}function d(){return o.symbol}function g(){return o.src}function m(){return o.id}return{getKey:m,src:g,symbol:d,getName:u,srcWithoutBase:l,isEmoticon:c,isLargeEmoticon:s,isSticker:a}}return{create:n}}stickerMap.$inject=["$$stackedMap","$$stickerImageMap","settings"];function stickerMap(e,t,n){function r(r,i){var o,a,s=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",c={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+s+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":s+"ca.png",installed:i||!1};for(RingLogger.information("$$stickerMap",RingLogger.tags.STICKER),RingLogger.print(r,RingLogger.tags.STICKER),o=0;o<r.imageList.length;o++)a=t.create(r.imageList[o],c.type,s),c.imageListMap.add(a.getKey(),a);function l(){return c.hoverUrl}function u(){return c.regularUrl}function d(){return c.type}function g(){return c.imageListMap}function m(){return c.categoryId}function E(){return c.isSticker}function f(){return c.isLargeEmoticon}function p(){return c.isEmoticon}function T(e){c.installed=e}function h(){return c.installed}function I(){return c.categoryId}return{sortBy:I,isInstalled:h,setInstalled:T,isEmoticon:p,isLargeEmoticon:f,isSticker:E,getKey:m,getImages:g,getType:d,link:u,hoverLink:l}}return{create:r}}angular.module("ringid.shared").factory("circleMap",circleMap),circleMap.$inject=["userFactory","$$stackedMap","settings","routeService"];function circleMap(e,t,n,r){return{create:function(i){var o,a={gNm:"",grpId:0,ists:0,sAd:"",ut:0,mc:"",mt:"",groupMembers:"",memberList:[],members:{},allMembersMap:t.createNew(),adminIds:[],memberIds:[]};angular.isObject(i)&&(a=angular.extend({},a,i));function s(){}function c(e){var t=a.memberIds.indexOf(e);t!==-1&&a.memberIds.splice(t,1)}function l(e){var t=a.adminIds.indexOf(e);t!==-1&&a.adminIds.splice(t,1)}function u(){a.mc=a.allMembersMap.length()}function d(e){angular.extend(a,e)}function g(){return'<a class="cir-title" href="/#/circle/'+a.grpId+'" >'+a.gNm+"</a>"}function m(){return a.gNm}function E(){return a.grpId}function f(e){var t=e||"";return r.getRoute("CIRCLE",{circleId:a.grpId,subpage:t})}function p(e){var t=e||"";return n.baseUrl+r.getRoute("CIRCLE",{circleId:a.grpId,subpage:t})}function T(e){a.mc=e}function h(){return a.mt}function I(){return a.mc}function _(){return a.allMembersMap.length()}function A(){return a.adminIds.slice()}function S(){return a.memberIds.slice()}function C(){return a.allMembersMap}function v(e){a.allMembersMap.remove(e),c(e),l(e),u()}function D(){a.allMembersMap.reset(),a.adminIds=[],a.memberIds=[]}function R(t){var n;function r(t){t.ists||(n=e.create(t),a.allMembersMap.save(n.getKey(),n),t.admin?a.adminIds.indexOf(n.getKey())!==-1?a.adminIds.push(n.getKey()):o.promoteToAdmin(n.getKey()):a.memberIds.indexOf(n.getKey())!==-1?a.memberIds.push(n.getKey()):o.removeFromAdmin(n.getKey()))}angular.forEach(t,r),s()}function M(){var e,t=a.allMembersMap.copy();for(e=0;e<a.adminIds.length;e++)t.remove(a.adminIds[e]);return t}function N(e){return a.allMembersMap.get(e)}function y(){var e,t=a.allMembersMap.copy();for(e=0;e<a.memberIds.length;e++)t.remove(a.memberIds[e]);return t}function b(e){c(e),a.memberIds.push(e),a.allMembersMap.get(e).removeGroupAdmin(a.grpId),s()}function O(e){l(e),a.adminIds.push(e),a.allMembersMap.get(e).setGroupAdmin(a.grpId),s()}function P(){return a.sAd}function L(e){return a.sAd===e}function U(){return 0===a.mt}function F(){return 1===a.mt}function w(t,n){var r=e.create(t);a.allMembersMap.save(r.getKey(),r),n?o.promoteToAdmin(r.getKey()):o.removeFromAdmin(r.getKey()),u()}function k(){return a.gNm.toLowerCase()}return o={sortBy:k,update:d,addMember:w,isAdmin:F,isMember:U,isSuperAdmin:L,getSuperAdminUId:P,promoteToAdmin:O,removeFromAdmin:b,getAdmins:y,getMember:N,getMembers:M,setMembers:R,resetMembers:D,removeMember:v,getAllMembers:C,getMemberIds:S,getAdminIds:A,getMembersObjectCount:_,getMembersCount:I,getMemberType:h,setMemberCount:T,getLink:p,getLinkOnly:f,getKey:E,getName:m,getAnchor:g}}}}angular.module("ringid.shared").factory("$$imageMap",$$imageMap),$$imageMap.$inject=["settings","$$stackedMap","userFactory","Utils"];function $$imageMap(e,t,n,r){var i={albId:"",albn:"",cptn:"",nfId:0,ic:0,ih:0,il:0,imT:0,imgId:0,iurl:"",iw:0,nc:0,nl:0,tm:0,user:null};function o(e,t){var n=this,r=e||{};O&&(n._u=t),n.updateImage(r),Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.image.imgId,showReportButton:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"image"}}})}function a(e){try{return this.image.ih/this.image.iw*e}catch(e){return this.image.ih}}function s(){return"/image/"+this.getKey()}function c(e,t){this.image.nc=e,angular.isDefined(t)&&(this.image.ic=t)}function l(){return this.image.nc}function u(){return this.image.ic}function d(){return{width:this.image.iw,height:this.image.ih}}function g(e){return e&&++this.image.nl||--this.image.nl}function m(){return this.image.imT}function E(){return this.image.nl}function f(){return this.image.nl}function p(e,t){return e?(this.image.il=1^this.image.il,t?this.image.nl=t:this.image.nl=0===parseInt(this.image.il,10)?this.image.nl-1:this.image.nl+1,this.image.il):this.image.il}function T(){return this._time}function h(e){this.image.nfId=e}function I(){return this.image.nfId}function _(){return this.key}function A(){return this.image.imgId}function S(){return this.image.cptn}function C(){return this.image.albId}function v(){return this.image.albn}function D(){return this.image.tm}function R(){return this.image.iw}function M(){return this.image.ih}function N(){return this.image.imgId}function y(e,t){return this.image.hasOwnProperty(e)?this.image[e]:t}function b(t){var n,r,i;return"iurl"===t?this.image.iurl:(n=this.image.iurl.lastIndexOf("/")+1,i=/\/uploaded\//.test(this.image.iurl)?"":"p",r=void 0!==t?[e.imBase,this.image.iurl.slice(0,n),i,t,this.image.iurl.slice(n)].join(""):[e.imBase,this.image.iurl.slice(0,n),i,this.image.iurl.slice(n)].join(""))}function O(){return this._u}function P(e){this.image?angular.extend(this.image,e):this.image=angular.extend({},i,e),this.key="im"+this.image.imgId,this.image.tm?this._time=r.verbalDate(this.image.tm):this._time={},!this._u&&this.image.hasOwnProperty("uId")&&(this._u=n.create({uId:this.image.uId,fn:this.image.fn||""}))}return o.prototype={updateImage:P,user:O,src:b,getByProperty:y,sortBy:N,getIh:M,getIw:R,sortByTime:D,getAlbumName:v,getAlbumId:C,getCaption:S,getKey:A,getMapKey:_,getFeedKey:I,setFeedKey:h,time:T,like:p,getLikes:f,getTotalLikes:E,getImageType:m,incomingLike:g,offset:d,selfComment:u,getTotalComment:l,setTotalComment:c,getUrl:s,getRelativeHeight:a},function(e,t){return new o(e,t)}}angular.module("ringid.shared").factory("$$mediaMap",$$mediaMap),$$mediaMap.$inject=["userFactory","Auth","$$stackedMap","settings","APP_CONSTANTS","mediaHttpService","$$q","Storage","Ringalert","Api","$ringhttp"];function $$mediaMap(e,t,n,r,i,o,a,s,c,l,u){var d=i,g={ac:0,albId:0,cc:0,ic:0,il:0,lc:0,is:0,ns:0,nfId:0,albn:"",artst:"",cntntId:0,drtn:0,mdaT:1,strmURL:"",
thmbURL:"",ttl:"",tih:0,tiw:0,user:null,viewtime:0,utId:"",autoplay:!1,gotDetails:!1};function m(e,t){var n=this;n.updateMedia(e),n.setUser(e,t),Object.defineProperty(n,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{key:n.media.key,showReportButton:function(){return!n._u.isCurrentUser()},showAddToAlbum:function(){return!n._u.isCurrentUser()},getSpamId:function(){return n.getKey()},getSpamType:function(){return"media"},getRingboxData:function(){return function(){return{media:n}}},showMediaShareButton:function(){return!!n.token}}})}function E(e){var t,n=new Date,r=!1,i=s.getData("mediaRecent")||[],o={ac:e.mdaCntntDTO.ac,albId:e.mdaCntntDTO.albId,albn:e.mdaCntntDTO.albn,artst:e.mdaCntntDTO.artst,cntntId:e.mdaCntntDTO.cntntId,mdaT:e.mdaCntntDTO.mdaT,drtn:e.mdaCntntDTO.drtn,strmURL:e.mdaCntntDTO.strmURL,thmbURL:e.mdaCntntDTO.thmbURL,ttl:e.mdaCntntDTO.ttl,utId:e.mdaCntntDTO.utId,viewtime:n.getTime()};for(t=0;t<i.length;t++)if(i[t].cntntId===e.mdaCntntDTO.cntntId){r=t;break}r?i[r]=o:(i.length>=6&&i.shift(),i.push(o)),s.setData("mediaRecent",i)}function f(){return this.token}function p(){var e=a.defer(),t=this;function n(n){n.sucs?(t.token=n.id,e.resolve(n.id)):e.reject(!1)}function r(t){e.reject(t)}return t.token?setTimeout(function(){e.resolve(t.token)}):u.get("mediaID?mediaID="+t.getKey()+"&ip="+s.getCookie("authServer")+"&port="+s.getCookie("comPort")).success(n).error(r),e.promise}function T(e){var t,n=a.defer(),r=this;function i(e){e.sucs===!0?(r.updateMedia(e.mdaCntntDTO,!0),E(e),n.resolve(r)):(n.reject(e),c.show(e,"info"))}return r.media.gotDetails?n.resolve(r):(t={cntntId:r.getKey(),utId:e?e.getUtId():r.owner().getUtId()},l.media.fetchDetails(t).then(i)),n.promise}function h(){var e=a.defer(),t=this;function n(n){RingLogger.print(n,RingLogger.tags.MEDIA),n.sucs===!0&&t.media.ac++,e.resolve()}return o.increaseViewCount(t.media.cntntId).then(n),e.promise}function I(){return{strmURL:this.media.strmURL,tiw:this.media.tiw,tih:this.media.tih,drtn:this.media.drtn,thmbURL:this.media.thmbURL,artst:this.media.artst,ttl:this.media.ttl.utf8Encode()}}function _(){return r.httpsUrl+"/player/embed?id="+this.token}function A(e){var t;return t=e?"height"===e?this.media.tih:this.media.tiw:{width:this.media.tiw,height:this.media.tih}}function S(e){return e?(this.media.is=1^this.media.is,this.media.ns=this.media.is?this.media.ns+1:this.media.ns-1,this.media.is):this.media.is}function C(e){this.media.ns=e}function v(){return this.media.ns}function D(){return this.media.cc}function R(){return this.media.ic}function M(e,t){this.media.cc=e,angular.isDefined(t)&&(this.media.ic=t)}function N(){return this.media.lc}function y(){return this.media.lc}function b(e,t){return e?(this.media.il=1^this.media.il,t?this.media.lc=t:this.media.lc=0===this.media.il?this.media.lc-1:this.media.lc+1,this.media.il):this.media.il}function O(){return this.media.il}function P(){return this.media.feedThumb}function L(){var e=this.media.poster;return""===this.media.thmbURL&&(e=1===this.media.mdaT?"images/default_audio_image.jpg":"images/default_video_image.jpg"),e}function U(){return this.media.thmbURL}function F(){return this.media.poster}function w(){return this.media.strmURL}function k(){var e,t,n=r.mediaBase+this.media.strmURL;return 2===this.media.mdaT&&(e=this.media.strmURL.match(/media-(\d+)/),e&&2===e.length&&parseInt(e[1],10)>140&&(t=n.lastIndexOf("/")+1,n=[n.slice(0,t),"h",n.slice(t)].join(""))),n}function $(){return this.media.ttl}function G(e){var t,n,r;return e?(n=this.media.drtn/60===0?"00":Math.floor(this.media.drtn/60),r=this.media.drtn%60===0?"00":Math.floor(this.media.drtn%60),n=n<10&&"00"!==n?"0"+n:n,r=r<10&&"00"!==r?"0"+r:r,t=n+":"+r):t=this.media.drtn,t}function B(){return this.media.ac}function H(){var e;return e=this.media.ac>1?"Views : "+this.media.ac:"View : "+this.media.ac}function x(){return this.media.autoplay}function Y(e){this.media.autoplay=e}function K(){return this.media.cntntId}function j(){return this._u}function V(){return this._u}function W(){return this.media.mdaT===d.NEWS_FEED_MEDIA_TYPE_VIDEO}function q(){return this.media.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO}function z(e){return this.media.nfId=e,this.media.nfId}function Q(){return this.media.nfId}function X(){return this.media.key}function Z(){return this.media.artst}function J(){return this.media.albn}function ee(){return this.media.albId}function te(){return this.media.utId}function ne(){return this.media.viewtime}function re(t,n){var r={};angular.isDefined(n)?this._u=n:(t.utId?this._u=e.getByUtId(t.utId):t.uId?this._u=e.getUser(t.uId):this._u=!1,this._u||(t.uId&&(r.uId=t.uId),t.utId&&(r.utId=t.utId),t.fn&&(r.fn=t.fn),t.prIm&&(r.prIm=t.prIm),this._u=e.create(r)))}function ie(e,t){angular.isObject(e)?(this.media?angular.extend(this.media,e):this.media=angular.extend({},g,e),this.media.gotDetails=!!t,this.media.key=this.media.cntntId||this.media.id,e.thmbURL&&e.thmbURL.length>1?this.media.poster=r.mediaBase+e.thmbURL:(this.media.poster=this.media.mdaT===d.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",this.media.feedThumb=this.media.poster,this.media.tih=330,this.media.tiw=600)):(RingLogger.warn("not valid json object media",RingLogger.tags.MEDIA),RingLogger.print(e,RingLogger.tags.MEDIA))}return m.prototype={updateMedia:ie,setUser:re,sortBy:ne,getMediaUtId:te,getAlbumId:ee,getAlbumName:J,getArtistName:Z,getKey:X,getFeedKey:Q,setFeedKey:z,isAudio:q,isVideo:W,owner:V,user:j,getId:K,setIsAutoPlay:Y,getIsAutoPlay:x,getViewCount:H,getViewCountOnly:B,getDuration:G,getCaption:$,getStreamUrl:k,getStreamUrlOnly:w,getThumb:F,getThumbUrlOnly:U,getThumbForMedia:L,feedThumb:P,iLiked:O,like:b,getLikes:y,getTotalLikes:N,setTotalComment:M,selfComment:R,getTotalComment:D,getTotalShare:v,setTotalShare:C,share:S,thumbOffset:A,getEmbedUrl:_,addToAlbumData:I,increaseView:h,updateRecentMedias:E,fetchDetails:T,getToken:f,setMediaToken:p},function(e,t){return new m(e,t)}}angular.module("ringid.shared").factory("$$newsPortalMap",$$newsPortalMap),$$newsPortalMap.$inject=["settings","routeService"];function $$newsPortalMap(e,t){function n(n){var r={fn:n.fn,nPCatId:n.nPCatId,nPCatName:n.nPCatName,nPslgn:n.nPslgn,prIm:n.prIm,subCount:n.subCount,subsc:n.subsc,uId:n.uId,utId:n.utId};function i(){return r.utId}function o(){return r.fn}function a(){return r.nPCatId}function s(){return r.nPCatName}function c(){return r.nPslgn}function l(){return r.prIm?e.imBase+r.prIm:"../../../images/test/1.png"}function u(){return r.prIm?e.imBase+r.prIm:"../../../images/test/2.png"}function d(){return r.subCount}function g(e){r.subsc=e}function m(){return r.subsc}function E(){return r.uId}function f(n){var i;return"following"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL_FOLLOWING")),"discover"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL_DISCOVER")),"saved"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL_SAVED")),"profile"===n&&(i=e.baseUrl+t.getRoute("NEWSPORTAL",{portalid:r.utId})),i}return{getKey:i,getFullName:o,getCategoryId:a,getCategoryName:s,getPortalSlogan:c,getProfileImage:l,getFollowAndSliderImage:u,getSubCount:d,setIfSubscribed:g,isSubscribed:m,getUid:E,getLink:f}}return{create:n}}angular.module("ringid.shared").factory("$$businessPageMap",$$businessPageMap),$$businessPageMap.$inject=["settings","routeService"];function $$businessPageMap(e,t){function n(n){var r={fn:n.fn,nPCatId:n.nPCatId,nPCatName:n.nPCatName,nPslgn:n.nPslgn,prIm:n.prIm,subCount:n.subCount,subsc:n.subsc,uId:n.uId,utId:n.utId,nop:n.nop};function i(){return r.utId}function o(){return r.fn}function a(){return r.nPCatId}function s(){return r.nPCatName}function c(){return r.nPslgn}function l(){return r.prIm?e.imBase+r.prIm:"../../../images/test/1.png"}function u(){return r.prIm?e.imBase+r.prIm:"../../../images/test/2.png"}function d(){return r.subCount}function g(e){r.subsc=e}function m(){return r.subsc}function E(){return r.uId}function f(){return t.getRoute("PAGE",{portalid:r.utId})}return{getKey:i,getFullName:o,getCategoryId:a,getCategoryName:s,getSlogan:c,getProfileImage:l,getFollowAndSliderImage:u,getSubCount:d,setIfSubscribed:g,isSubscribed:m,getUid:E,getLink:f}}return{create:n}}angular.module("ringid.shared").factory("$$mediaAlbumMap",$$mediaAlbumMap),$$mediaAlbumMap.$inject=["Ringalert","Auth","settings","fileUploadService","$$stackedMap","$$mediaMap","APP_CONSTANTS","mediaHttpService","Utils","routeService"];function $$mediaAlbumMap(e,t,n,r,i,o,a,s,c,l){var u=a;function d(e){return parseInt(e.id,10)||parseInt(e.albId,10)}return{createKey:function(e){return d(e)},createAlbum:function(t,a){var g={albn:"",albId:0,mc:0,mdc:0,mdaT:1,sts:0,utId:0,imgURL:"",contents:i.createNew(),uniqueKey:c.getUniqueID(),cover:"",key:0,type:"",owner:0};function m(e){angular.isObject(e)&&(g=angular.extend({},g,e),g.albId=parseInt(e.id,10)||parseInt(e.albId,10),g.owner=a,g.key=d(e),e.imgURL&&e.imgURL.length>1?g.cover=n.imBase+e.imgURL:g.cover=t.mdaT===u.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/default_audio_image.jpg":"images/default_video_image.jpg",g.type=t.mdaT===u.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video")}m(t);function E(e,t,n){var r,i,a,s=t||g.owner;for(i=0,a=e.length;i<a;i++)n&&(e[i].nfId=n),r=o(angular.extend(e[i],{albId:g.id}),s),g.contents.save(r.getKey(),r);return RingLogger.print("CONTENTS ADDED : "+g.contents.length(),RingLogger.tags.MEDIA),g}function f(e){function t(t){t.sucs===!0&&(g.contents.remove(e.getKey()),g.mc--)}s.deleteAlbumContent(e.getId()).then(t)}function p(t){var n,i,o="audio"===g.type?"audioFiles":"videoFiles",a={albId:g.albId,mdaLst:[],mdaT:g.mdaT};function c(e){if(e.sucs===!0){for(g.mc+=e.mdaIds.length,n=0,i=e.mdaIds.length;n<i;n++)a.mdaLst[n].cntntId=e.mdaIds[n];E(a.mdaLst)}else RingLogger.warning(e.mg||"Failed to add media",RingLogger.tags.MEDIA)}if(t){if(g.contents.get(t.getKey()))return void e.show("Content Already Added","warning");a.mdaLst.push(t.addToAlbumData())}else for(n=0,i=r[o].length;n<i;n++)a.mdaLst.push(r[o][n].getAuthData());s.addMediaToAlbum(a).then(c)}function T(e,t){var r,i="";return(e.getUId()||e.getUtId())&&(r=l.getRoute("PROFILE",{uId:e.getUId(),utId:e.getUtId(),subpage:"media",albumId:g.albId}),i=t?r.replace("#",""):n.baseUrl+r),i}function h(){return g.utId}function I(e,t,n,r){return E(e,t,n,r)}function _(e){m(e)}function A(){return g.contents}function S(){return g.mc||g.mdc}function C(){var e=S();return e>1?"audio"===g.type?" Songs":" Videos":"audio"===g.type?" Song":" Video"}function v(){return g.cover}function D(){return g.albn}function R(){return g.albId}function M(){return g.mdaT===u.NEWS_FEED_MEDIA_TYPE_VIDEO}function N(){return g.mdaT===u.NEWS_FEED_MEDIA_TYPE_AUDIO}function y(){return g.type}function b(){return g.key}return{getKey:b,getType:y,isAudio:N,isVideo:M,getId:R,getName:D,getCover:v,getContentCount:S,getContentText:C,getContents:A,updateAlbum:_,pushContent:I,getALbumUtId:h,link:T,addNewContent:p,deleteContent:f}}}}angular.module("ringid.shared").factory("$$feedMap",$$feedMap),$$feedMap.$inject=["Auth","settings","$$stackedMap","$$imageMap","Media","$$mediaAlbumMap","$$mediaMap","userFactory","Utils","circlesManager","$sce","EmotionFactory","MESSAGES","OPERATION_TYPES","PrivacySet","routeService"];function $$feedMap(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f){var p="nf_",T="tm",h=g.FEED,I=m.SYSTEM,_='<user-card user="feed.user()"></user-card>',A={nfId:0,utId:0,isNew:0,lctn:"",lat:9999,lng:9999,gNm:"",grpId:0,sts:"",stsTags:[],tim:0,imT:0,fndId:0,whoShare:{},mdaCntntLst:[],type:0,mdLst:[],tm:Date.now(),at:Date.now(),ic:0,il:0,is:0,nc:0,nl:0,ns:0,sc:0,tfc:0,stp:0,fc:0,actvt:0,afn:"",auId:0,lnkDmn:"",lnkDsc:"",lnkTtl:"",lnkURL:"",lnlImgURL:"",fTgLst:[]};function S(e,t){var r,i=this;i.key=p+e.nfId,i.updateRaw(e),i.setFeedUser(t),i.feelings={},i.tagUsers=[],i.shareUsers=[],i.circle={},i.orginal={},i.feedHtml="",i.images=n.createNew(!0,"asc"),i.medias=n.createNew(),i.audios=n.createNew(),i.setImages(),i.initMedias(),i._f.fndId?i.friend=s.create({uId:i._f.fndId,fn:i._f.ffn,ln:i._f.fln}):i.friend=!1,i.initOgData(),i.initLocationData(),i.update(null,!1,!0),i.isSingleContentFeed()&&(r=i.getSingleContent(),i.images.length()||(i._f.is=r.share(),i._f.ns=r.getTotalShare()),i._f.ic=r.selfComment(),i._f.nc=r.getTotalComment()),Object.defineProperty(i,"ddControl",{enumerable:!1,configurable:!1,writable:!1,value:{feedKey:i._f.nfId,showEdit:function(){return i._u.isCurrentUser()&&i._f.nl<1},feedUser:function(){return i._u},tagButtonText:function(){return i.tagUsers.length?"Edit Tag":"Add Tag"},showDelete:function(){return i._u.isCurrentUser()||i.friend&&i.friend.isCurrentUser()},showTagButton:function(){return i._u.isCurrentUser()&&!i._f.grpId},showReportButton:function(){return!i._u.isCurrentUser()},getSpamId:function(){return i.isSingleContentFeed()?i.getSingleContent().getKey():i.getKey()},getSpamType:function(){return i.images.length()&&"image"||i.medias.length()&&"media"||i.audios.length()&&"media"||"feed"},showSaveOptionForNews:function(){return 7===i._f.type&&!i._f.npFeedInfo.svd},showUnsaveOptionForNews:function(){return 7===i._f.type&&i._f.npFeedInfo.svd},showSaveOptionForBusiness:function(){return 8===i._f.type&&!i._f.npFeedInfo.svd},showUnsaveOptionForBusiness:function(){return 8===i._f.type&&i._f.npFeedInfo.svd},isNewsPortalFeed:function(){return 7===i._f.type}}})}S.prototype={updateRaw:C,update:v,getKey:D,sortBy:R,getMapKey:M,setFeedKey:N,getFeedKey:y,getPrivacy:b,getByProperty:O,checkMessageUpdated:P,getTargetWall:L,getTargetCircle:U,setFeedUser:F,user:w,processFeedMessage:k,updateShareMessage:$,addPostfixMessage:G,getMessageText:B,hasActivityMessage:H,setActivity:x,setFeedTopMessage:Y,getActivityMessage:K,getActivityUser:j,feedTextParser:V,parseStatus:W,parseMoreText:q,getCroppedHtml:z,showMore:Q,setText:X,text:Z,getDynamicText:J,getDynamicTextMore:ee,getAtTime:te,time:ne,updateTime:re,setTime:ie,getTimestamp:oe,incomingLike:ae,like:se,setTotalLikes:ce,setIdenticalFeed:le,getTotalLikes:ue,setTotalComment:de,getTotalComment:ge,selfComment:me,getTotalShare:Ee,getShareUsers:fe,addShareUser:pe,share:Te,shares:he,getWhoShares:Ie,getOrginalFeed:_e,hasSharedFeed:Ae,getTotalImage:Se,setImages:Ce,getImages:ve,getImageLayout:De,hasMedia:Re,getAlbum:Me,initMedias:Ne,getMedias:ye,getAudios:be,setViewColumn:Oe,getViewColumn:Pe,getUrl:Le,getWhoShareUrl:Ue,hasFeelings:Fe,getFeelings:we,setFeelings:ke,setTagUsers:$e,updateTagUser:Ge,hasTagUsers:Be,getTagUsers:He,validateForUpdateTag:xe,hasMoreTagUsers:Ye,getMoreTagUsers:Ke,getTotalTag:je,getLocationText:Ve,getLocationShortText:We,setLocationText:qe,resetLocationText:ze,getContentType:Qe,hasLocationInfo:Xe,getLocationInfo:Ze,getLocationUrl:Je,getLocationEmbedUrl:et,getLocationStaticEmbedUrl:tt,initLocationData:nt,setLocationInfo:rt,getStrmURL:it,getLinkDomain:ot,getLinkUrl:at,getLinkTitle:st,getLinkDescription:ct,getLinkImageUrl:lt,hasOgData:ut,getOgData:dt,initOgData:gt,setOgData:mt,isEmpty:Et,isSpecial:ft,isFeed:!0,isTimelinePost:pt,isWallPost:Tt,isCirclePost:ht,isMediaShared:It,isSingleContentFeed:_t,getSingleContent:At,hasNewsPortalFeed:St,hasExternalUrl:Ct,getNewsPortalcatId:vt,getNewsPortalDescription:Dt,setNewsPortalDescription:Rt,getNewsPortalShortDescription:Mt,getNewsPortalTitle:Nt,hasNewsPortalUrl:yt,getNewsPortalUrl:bt,getPortalBaseUrl:Ot,isSavedNewsPortal:Pt,setPortalSaveStatus:Lt,isPending:Ut,isShareAble:Ft,encodeUtf8Fields:wt,feedConditionalReplacer:kt};function C(e,t){var n;this._f?(n=t||!e.tm?this._f.tm:e.tm,angular.extend(this._f,e),this._f.tm=n):this._f=angular.extend({},A,e),9999===this._f.lat&&(this._f.lctn="")}function v(e,t,n){var r=this;n||r.updateRaw(e,t),r._f.mdLst&&r._f.mdLst.length&&(r.feelings=d.getEmotion(r._f.mdLst[0],!0)),r.setTagUsers(),r._f.at?r.vtime=c.verbalDate(r._f.at):r.vtime="",r.setFeedTopMessage(),r.processFeedMessage(),r.addPostfixMessage(),r.parseStatus()}function D(){return this._f.nfId}function R(){return this._f[T]||this._f.tm}function M(){return this.key}function N(e){this._f.nfId=e}function y(){return this._f.nfId}function b(){return E["PVC"+(this._f.fpvc||3)]}function O(e,t){return this._f.hasOwnProperty(e)?this._f[e]:!!t}function P(){return this.message+this._f.lctn+this.tagUsers.reduce(function(e,t){return e.toString()+t.toString()},"")+this._f.tfc}function L(){return this.friend}function U(){return angular.equals({},this.circle)?this._f.gNm:this.circle}function F(e){var t,n=this;angular.isDefined(e)?n._u=e:(n._f.utId?n._u=s.getByUtId(n._f.utId):n._f.uId?n._u=s.getUser(n._f.uId):n._u=!1,n._u||(t={},n._f.uId&&(t.uId=n._f.uId),n._f.utId&&(t.utId=n._f.utId),n._f.fn&&(t.fn=n._f.fn),n._f.prIm&&(t.prIm=n._f.prIm),3===n._f.spType&&(n._f.isnp=!0,t.isnp=n._f.isnp),4===n._f.spType&&(n._f.isbusn=!0,t.isbusn=n._f.isbusn),n._u=s.create(t)))}function w(){return this._u}function k(){var e,t="",n="",r=[_],i=this;switch(i.friend?t="F":i._f.grpId&&(i.circle=l.getCircle(i._f.grpId),t="C"),i._f.type){case I.NEWS_FEED_TYPE_IMAGE:i.images.length()>0?(i.message=h["TYPE_1"+i.images.top().getImageType()+t]||h.TYPE_D,i.message=i.feedConditionalReplacer(i.message,[i._u.isCurrentUser()])):i.message=h.TYPE_D;break;case I.NEWS_FEED_TYPE_STATUS:i.hasOgData()&&(n="L"),i.message=h["TYPE_2"+t+n];break;case I.NEWS_FEED_TYPE_MULTIPLE_IMAGE:i.message=h["TYPE_"+i._f.type],i.message=i.feedConditionalReplacer(i.message,[i._u.isCurrentUser()]),r.push(i._f.tim);break;case I.NEWS_FEED_TYPE_ALBUM:case I.NEWS_FEED_TYPE_AUDIO:case I.NEWS_FEED_TYPE_VIDEO:e=i._f.stp||0,i.message=h["TYPE_"+i._f.type+e],e||!i.medias.length()&&!i.audios.length()?r.push('<user-card class="share-user" user="feed.getSingleContent().user()"></user-card>'):r.push(i.medias.length()||i.audios.length());break;default:i.message=h.TYPE_D}i.friend?i.message+=" "+h.F_POSTFIX.format('<user-card class="wall-user" user="feed.getTargetWall()"></user-card>'):i._f.grpId&&(i.message+=" "+h.C_POSTFIX.format('<a class="cir-title" href="/#/circle/'+i._f.grpId+'" >'+i._f.gNm+"</a>")),i.rawmessage=i.message,i.message=i.message.format(r),i.oldMessage=i.message}function $(){var e=[_];this.message=h.TYPE_SHARE,e.push('<user-card class="share-user" user="feed.getOrginalFeed().user()"></user-card>'),this.message=this.message.format(e),this.oldMessage=this.message,this.addPostfixMessage()}function G(){var e=this;e.message=e.oldMessage,(e._f.mdLst.length||e.tagUsers.length||e.location)&&("{0}"!==e.rawmessage?e.message+=" &mdash;":e.message+=" is"),e._f.mdLst.length&&(e.message+='<span class="feelings-text">feeling</span> <img class="feed_emo" src="'+e.feelings.url+'" />&nbsp;'+e.feelings.nm),e.tagUsers.length&&(e.message+='&nbsp;<feed-tag-more-user tag-feed="feed"></feed-tag-more-user>'),this._f.lctn&&(e.message+='&nbsp;<location-card feed="feed"></location-card>')}function B(){return this.message}function H(){return this._f.actvt>0&&1!==this._f.fc}function x(e){this._f.actvt=e.actvt||0,this._f.afn=e.afn,this._f.auId=e.auId,this.setFeedTopMessage()}function Y(){var t,n,r=this;r._f.actvt>0&&(r.subMessage="",r._f.actvt&&g.FEED["ACT_"+r._f.actvt]&&(t=s.getByUtId(r._f.auId),n="<b>You</b>",t?t.isCurrentUser()||(n='<user-card user="feed.getActivityUser()"></user-card>'):e.currentUser().getUtId()!==r._f.auId&&(t=s.createByUtId({fn:r._f.afn,utId:r._f.auId},!0),n='<user-card user="feed.getActivityUser()"></user-card>'),r._au=t,r.subMessage=g.FEED["ACT_"+r._f.actvt].format(n)),r.subMessage=u.trustAsHtml(r.subMessage))}function K(){return this.subMessage}function j(){return this._au}function V(e,t,n){var r,i,o,a=[],l="",d=e,g=0,m=n||d.length,E=t||[];if(m>0&&(d=d.substr(0,m)),d||E){if(E&&E.length){for(E.sort(function(e,t){return t.pstn>e.pstn?-1:1}),o=0;o<E.length&&E[o].pstn<m;o++)i=E[o].pstn-g,r=s.create(E[o]),i>0&&a.push(c.parseForLE(d.substr(g,i))),a.push(r.getLink({class:"tag",title:r.getName().trim(),"data-link":r.getUtId()})),g=E[o].pstn;i=d.length-g,i>0&&a.push(c.parseForLE(d.substr(g,i))),l=a.join("")}else l=c.parseForLE(d);l=u.trustAsHtml(l)}return l}function W(){this.feedHtml=this.feedTextParser(this._f.sts,this._f.stsTags)}function q(e){this._f.sts=e.sts,this.parseStatus()}function z(e){return this.feedTextParser(e,this._f.stsTags,e.length)}function Q(){return!!this._f.sc}function X(e,t){this._f.sts=e,t&&(this._f.stsTags=t),this.parseStatus()}function Z(){return this._f.sts}function J(){return this.feedHtml}function ee(e,t){var n,r,i=parseInt(e,10)||20,o="(",a=c.parseForLE(this._f.sts);for(r=i;r>0;r--)o+="[\\S]+\\s";return o+=")(.*)",n=a.replace(new RegExp(o),'<span class="with-more"><input id="read'+t+'" type="checkbox" /><span class="less">$1</span><span class="more">$2</span><label for="read'+t+'" class="trigger"></label></span>'),u.trustAsHtml(n)}function te(){return this._f.at}function ne(){return this.vtime}function re(){this.vtime=c.verbalDate(this._f.at)}function ie(e){this._f.tm=e}function oe(){return this._f.tm}function ae(e){return e&&++this._f.nl||--this._f.nl}function se(e,t){return e?(this._f.il=1^this._f.il,t?this._f.nl=t:this._f.nl=this._f.il?this._f.nl+1:this._f.nl-1,this.identical&&this.identical.like(e),this._f.il):this._f.il}function ce(e,t){this._f.nl=e,angular.isDefined(t)&&(this._f.il=t),this.identical&&this.identical.setTotalLikes(e,t)}function le(e){this.identical=e}function ue(){return this._f.nl}function de(e,t){this._f.nc=e,angular.isDefined(t)&&(this._f.ic=t),this.identical&&this.identical.setTotalComment(e.ic)}function ge(){return this._f.nc}function me(){return this._f.ic}function Ee(){return this._f.ns}function fe(){return this.shareUsers}function pe(e){return angular.isArray(e)?this.shareUsers=this.shareUsers.concat(e):this.shareUsers.push(e),this.shareUsers}function Te(e,t){return e?(this._f.is=1^this._f.is,t?this._f.ns=t:this._f.ns=this._f.is?this._f.ns+1:this._f.ns-1,this._f.is):this._f.is}function he(e){this.orginal=e,this.orginal.addShareUser(this._u),this.updateShareMessage()}function Ie(){return this._f.whoShare}function _e(){return this.orginal}function Ae(){return!angular.equals({},this.orginal)}function Se(){return this._f.tim}function Ce(){var e,t,n,i=0;if(this._f.imageList){try{e=angular.isString(this._f.imageList)?angular.fromJson(this._f.imageList):this._f.imageList}catch(e){RingLogger.alert(e.message)}for(t=e.length>3?3:e.length,i=0;i<t;i++)e[i].nfId=this._f.nfId,n=r(e[i],this._u),this.images.add(n.getMapKey(),n)}switch(this.images.length()){case 1:this.imlayout=5;break;case 2:this.imlayout=4;break;default:this.imlayout=this._f.nfId%4}}function ve(e){return e?this.images:this.images.all()}function De(){return this.imlayout}function Re(){return this.images.length()>0||this.medias.length()>0||this.audios.length()>0}function Me(){return this.album}function Ne(){var e,t;this._f.mdaCntntLst&&this._f.mdaCntntLst.length>0&&(e=this._f.stp>0?null:this._u,t=this._f.mdaCntntLst,this.album=o.createAlbum({albn:t[0].albn,albId:t[0].albId,mc:t.length,mdaT:t[0].mdaT,utId:e?e.getUtId():0}),this.album.pushContent(t,e,this._f.nfId),this.album.isAudio()?this.audios=this.album.getContents():this.album.isVideo()&&(this.medias=this.album.getContents()))}function ye(){return this.medias}function be(){return this.audios}function Oe(e){this.viewColumn=e}function Pe(){return this.viewColumn}function Le(){return f.getRoute("SINGLE_FEED",{feedId:this._f.nfId,shared:this.hasSharedFeed()?"shared":""})}function Ue(){var e;return e=this.hasSharedFeed()?this.getOrginalFeed().getKey():this.getKey(),f.getRoute("WHO_SHARED_FEED",{feedId:e})}function Fe(){return!!this._f.mdLst.length}function we(){return this.feelings}function ke(e){e&&e.id?(this.feelings=e,this._f.mdLst[0]=e.id):(this.feelings={},this._f.mdLst=[]),this.addPostfixMessage()}function $e(e,t){var n,r=e;if(r?this._f.fTgLst=r:r=this._f.fTgLst,this.tagUsers.length=0,r&&r.length)for(n=0;n<r.length;n++)r[n].fn=r[n].nm,this.tagUsers.push(s.createByUtId(r[n]));angular.isDefined(t)&&(this._f.tfc=t)}function Ge(e){this.setTagUsers(e.fTgLst,e.tfc),this.addPostfixMessage()}function Be(){return!!this.tagUsers.length}function He(){return this.tagUsers}function xe(){return""!==this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length()}function Ye(){return this._f.tfc>this.tagUsers.length}function Ke(){return this._f.tfc-this.tagUsers.length}function je(){return this._f.tfc}function Ve(){return this._f.lctn}function We(){var e,t;return this._f.lctn?(e=this._f.lctn,t=this._f.lctn.split(","),t.length>2&&(e=t[0].replace("(","")),e.length>30&&(e=e.substr(0,30)+"..."),e):""}function qe(e){return this._f.lctn=e,this.addPostfixMessage(),e}function ze(){this._f.lctn=""}function Qe(){var e;return e=this.images.length()?"image":this.medias.length()?"media":this.audios.length()?"media":"feed"}function Xe(){return!(""===this._f.lctn||this._f.lnkURL||this._f.sts||this.images.length()||this.medias.length()||this.audios.length())}function Ze(){return this.locationData}function Je(){return u.trustAsResourceUrl(c.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!1))}function et(){return u.trustAsResourceUrl(c.getGoogleMapJSUrl(this._f.lat,this._f.lng,this._f.lctn,!0))}function tt(){return u.trustAsResourceUrl(c.getGoogleMapStaticUrl(this._f.lat,this._f.lng,this._f.lctn))}function nt(){9999!==this._f.lat?this.locationData={description:this._f.lctn,lat:this._f.lat,lng:this._f.lng}:this.locationData={description:this._f.lctn}}function rt(e){this._f.lctn=e.description,this._f.lat=e.lat,this._f.lng=e.lng,this.initLocationData(),this.addPostfixMessage()}function it(){return this._f.strmURL}function ot(){return this._f.lnkDmn}function at(){return this._f.lnkURL}function st(){return this._f.lnkTtl}function ct(){return this._f.lnkDsc}function lt(){return this._f.lnlImgURL}function ut(){return!!(this._f.lnlImgURL||this._f.lnkTtl||this._f.lnkDsc)}function dt(){return this.ogData}function gt(){this.ogData||(this.ogData={}),this.ogData.image=this._f.lnlImgURL,this.ogData.description=this._f.lnkDsc,this.ogData.title=this._f.lnkTtl,this.ogData.url=this._f.lnkURL,this.ogData.lnkDmn=this._f.lnkDmn}function mt(e){this._f.lnkDsc=e.lnkDsc||e.description||"",this._f.lnkTtl=e.lnkTtl||e.title||"",this._f.lnkURL=e.lnkURL||e.url||"",this._f.lnlImgURL=e.lnlImgURL||e.image||"",this._f.lnkDmn=e.lnkDmn||e.domain||"",this.initOgData()}function Et(e){var t=e||{};return!this.text||t.tagUsers&&this.tagUsers.length}function ft(){return 1===this._f.fc}function pt(){return this.friend&&this.friend.isCurrentUser()}function Tt(){return!!this.friend}function ht(){return this._f.grpId>0}function It(){return this._f.stp>0}function _t(){return 1===this.images.length()||1===this.medias.length()||1===this.audios.length()}function At(){return this.images.length()&&this.images.bottom()||this.medias.length()&&this.medias.bottom()||this.audios.length()&&this.audios.bottom()||this}function St(){return this._f.npFeedInfo}function Ct(){return this._f.npFeedInfo.exUrlOp}function vt(){return this._f.npFeedInfo.nCatId}function Dt(){return this._f.npFeedInfo.nDctn}function Rt(e){this._f.npFeedInfo.nDctn=e}function Mt(){return this._f.npFeedInfo.nSDctn}function Nt(){return this._f.npFeedInfo.nTtl}function yt(){return!!this._f.npFeedInfo.nUrl}function bt(){return this._f.npFeedInfo.nUrl}function Ot(){var e,t=this._f.npFeedInfo.nUrl;return e=t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0],e=e.split(":")[0]}function Pt(){return this._f.npFeedInfo.svd}function Lt(e){this._f.npFeedInfo.svd=e}function Ut(e){return void 0!==e&&(this.pending=!!e),this.pending}function Ft(e){var t,n=!0,r=this.isSingleContentFeed()&&!this.images.length(),i=this.getSingleContent();return this._u.isCurrentUser()||r&&i.user().isCurrentUser()?(t="RC15",n=!1):this.friend?(t="CRCFS1",n=!1):this._f.grpId?(t="CRCFS2",n=!1):this._f.is&&!r&&(t="CRCFS3",n=!1),e?{sucs:n,rc:t}:n}function wt(){var e,t,n=["location","lctn","lnkDmn","lnkDsc","lnkTtl","lnkURL","lnlImgURL"];for(e=0;e<n.length;e++)t=n[e],this._f[t]?this._f[t]=this._f[t].utf8Encode():this._f[t]=""}function kt(e,t){var n=0,r=t||[],i=e.replace(/(\w+)?\|\|(\w+)?/g,function(e,t,i){return void 0!==r[n]?r[n]?t:i:""});return i.replace(/(\s){2,}/g," ")}function $t(){return p}function Gt(e){T=e}function Bt(e){p=e}function Ht(){return T}function xt(e){return p+e}function Yt(e,t){return new S(e,t)}return{getPrefix:$t,setSortKey:Gt,setPrefix:Bt,getSortIndex:Ht,makeKey:xt,create:Yt}}angular.module("ringid.shared").factory("$$commentMap",["$$stackedMap","settings","$filter","userFactory","Utils","$$stickerMap","$sce",function(e,t,n,r,i,o,a){var s={cmn:"",cmnId:0,deleted:!1,edited:!1,fn:"",il:0,isNew:1,ln:"",nfId:0,imageId:0,tl:0,tm:"",uId:"",prIm:"",pending:!1};function c(e,t){t&&(this._u=t),this.updateComment(e)}function l(e){this.comment?angular.extend(this.comment,e):this.comment=angular.extend({},s,e),this.updateTime(),this.setHtml(),this._u||(this._u=r.create({fn:this.comment.fn,ln:this.comment.ln,uId:this.comment.uId,prIm:this.comment.prIm}))}function u(){this.comment.tm||(this.comment.tm=Date.now()),this.vtime=i.verbalDate(this.comment.tm)}function d(){this.html=a.trustAsHtml(i.parseForLE(this.comment.cmn))}function g(){return this._u}function m(e){return e===this._u.getKey()}function E(){return this.comment.cmn}function f(e){this.comment.cmn=e,this.setHtml()}function p(e){this.comment.cmn=e,this.setHtml()}function T(){return this.html}function h(e,t){var n=t||!1;return this.comment.hasOwnProperty(e)?this.comment[e]:n}function I(){return this.comment.cmnId}function _(){return this.comment.cmnId}function A(e){this.comment.cmnId=e}function S(){return this.comment.nfId}function C(e){this.comment.nfId=e}function v(){return this.comment.imageId}function D(e){this.comment.imageId=e}function R(){return this.comment.tm}function M(e){this.comment.tm=e,this.updateTime()}function N(){return this.updateTime(),this.vtime}function y(){return this.vtime}function b(e,t){return e?(this.comment.il=1^this.comment.il,t?this.comment.tl=t:this.comment.tl=0===this.comment.il?this.comment.tl-1:this.comment.tl+1,this.comment.il):this.comment.il}function O(){return this.comment.tl}function P(e){this.comment.tl=e}function L(e){return void 0!==e&&(this.comment.pending=!!e),this.comment.pending}function U(){return this._u.isCurrentUser()&&0===this.like()}function F(e){return this._u.isCurrentUser()||e&&e.user().isCurrentUser()}c.prototype={updateComment:l,updateTime:u,setHtml:d,user:g,isOwner:m,text:E,setComment:f,setText:p,getDynamicText:T,getByProperty:h,sortBy:I,getKey:_,setKey:A,getFeedKey:S,setFeedKey:C,getImageKey:v,setImageKey:D,getTimestamp:R,setTime:M,getTimeUpdate:N,time:y,like:b,getTotalLikes:O,incomingLike:P,isPending:L,isEditable:U,isDeleteAble:F};function w(){return"tm"}function k(e,t){return new c(e,t)}return{getSortIndex:w,create:k}}]),angular.module("ringid.shared").factory("$$albumMap",$$albumMap),$$albumMap.$inject=["settings","$$imageMap","$$stackedMap","userFactory"];function $$albumMap(e,t,n,r){var i={albId:"",timg:"",imageList:[],ut:0};function o(e,t){var n=this,r=e||{};n.updateAlbum(r,t)}function a(e,n){var r,i,o,a;for(o=0,i=n.length;o<i;o++)a=angular.extend({},n[o],{albId:e.album.albId}),r=t(a,e._u),e.album.images.save(r.getKey(),r),e.album.ut<n[o].tm&&(e.album.ut=n[o].tm)}function s(){return this.album.images}function c(){return this.album.tm}function l(){return this.album.tn}function u(t){var n=this.album.cvImg.lastIndexOf("/")+1;return[e.imBase,this.album.cvImg.slice(0,n),"p"+t,this.album.cvImg.slice(n)].join("")}function d(){return this.album.albn}function g(e){this.album.images.remove(e)&&(this.album.tn=this.album.tn-1,"profileimages"===this.album.albId&&e===this._u.getProfileImageId()?this._u.resetAvatar():"coverimages"===this.album.albId&&e===this._u.getCoverImageId()&&this._u.resetCover())}function m(){return this.album.albId}function E(e){a(this,e.imageList)}function f(e,t){this.album?angular.extend(this.album,e):this.album=angular.extend({},i,e),t&&(this._u=r.create({uId:t})),this.album.images=n.createNew(),this.album.imageList&&this.album.imageList.length>0&&a(this,this.album.imageList)}return o.prototype={updateAlbum:f,pushImages:E,getKey:m,removeImage:g,getName:d,getCoverImage:u,
getTotalImageCount:l,getUpdateTime:c,getImages:s},function(e,t){return new o(e,t)}}var frameTypes={TIT2:"title",TOPE:"original-artist",TPE1:"artist",TOA:"original-artist",TP1:"artist",TT2:"title",APIC:"image",PIC:"image"},frameImageTypes=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"];angular.module("ringid.shared").service("mediaMetadata",mediaMetadata),mediaMetadata.$inject=["$$q"];function mediaMetadata(e){var t=this;function n(e){var t={drtn:Math.floor(e.duration),tiw:e.videoHeight,tih:e.videoWidth,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile};window.URL.revokeObjectURL(e.src),e.deferObj.resolve(t)}function r(e){var t,n,r,i,o,a=new DataView(e),s={tag:null,value:null},c={id:a.getString(0,3),type:a.getString(0,1),size:a.getUint24(3)};if(!(c.id in frameTypes))return!1;if(s.tag=frameTypes[c.id],"T"===c.type)t=a.getUint8(7),s.value=a.getString(7,a.byteLength-7);else if("PIC"===c.id){for(t=a.getUint8(6),n={type:null,mime:"image/"+a.getString(7,3).toLowerCase(),description:null,data:null},n.type=frameImageTypes[a.getUint8(11)]||"other",r=11,i=0,o=r;;o++)if(0===a.getUint8(o)){i=o-r;break}n.description=0===i?null:a.getString(r,i),s.value=new Blob(new Uint8Array(e.slice(r+1)),{type:n.mime})}return!!s.tag&&s}function i(e,t,n){if(n=n||0,t=t||4,t<3)return r(e);var i,o=new DataView(e),a={tag:null,value:null},s={id:o.getString(0,4),type:o.getString(0,1),size:o.getSynch(o.getUint32(4)),flags:[o.getUint8(8),o.getUint8(9)]};if(0!==s.flags[0]||!(s.id in frameTypes))return!1;if(a.tag=frameTypes[s.id],"T"===s.type)if(i=o.getUint8(10),0===i||3===i)a.value=o.getString(11,o.byteLength-11);else if(1===i)a.value=o.getStringUtf16(-11,11,!0);else{if(2!==i)return!1;a.value=o.getStringUtf16(-11,11)}else if("APIC"===s.id){i=o.getUint8(10);for(var c={type:null,mime:null,description:null,data:null},l=11,u=0,d=l;;d++)if(0===o.getUint8(d)){u=d-l;break}c.mime=o.getString(l,u),c.type=frameImageTypes[o.getUint8(l+u+1)]||"other",l+=u+2,u=0;for(var d=l;;d++)if(0===o.getUint8(d)){u=d-l;break}c.description=0===u?null:o.getString(l,u),a.value=new Blob(new Uint8Array(e.slice(l+1)),{type:c.mime})}return!!a.tag&&a}function o(e,t){var n,r,o=new DataView(e),a={},s=0,c=10,l=o.byteLength-128;if("TAG"===o.getString(l,3)&&(l+=3,t.ttl=o.getString(l,30).trim()||null,l+=30,t.artst=o.getString(l,30).trim()||null),n=o.getUint8(3),r=o.getUint8(5),s+=o.getSynch(o.getUint32(6)),s>o.byteLength||"ID3"!==o.getString(0,3)||n>4||0!==(128&r));else for(0!==(64&r)&&(c+=o.getSynch(o.getUint32(11)));c<s;){for(var u,d,g,m=!0,E=0;E<3;E++)g=o.getUint8(c+E),(g<65||g>90)&&(g<48||g>57)&&(m=!1);if(!m)break;d=n<3?e.slice(c,c+6+o.getUint24(c+3)):e.slice(c,c+10+o.getSynch(o.getUint32(c+4))),u=i(d,n),u&&(a[u.tag]=u.value),c+=d.byteLength}t.ttl=a.title||t.ttl||"",t.artst=a.artist||a["original-artist"]||t.artst||""}function a(){var e=this,t={drtn:Math.floor(e.duration),tiw:0,tih:0,artst:"",ttl:e.nameFromFile.substr(0,e.nameFromFile.lastIndexOf("."))||e.nameFromFile,thmbURL:""},n=new FileReader;n.onload=function(){o(this.result,t),e.deferObj.resolve(t)},n.readAsArrayBuffer(e.fileObj)}function s(e){this.deferObj.reject()}t.generateMeta=function(t,r){var i,o=e.defer();return"audio"===r?(i=document.createElement("audio"),i.addEventListener("loadeddata",a),i.fileObj=t):(i=document.createElement("video"),i.addEventListener("loadeddata",function(){var e=this;e.currentTime=e.duration>20?10:e.duration/2;function t(){i.removeEventListener("timeupdate",t),n(e)}i.addEventListener("timeupdate",t)})),i.deferObj=o,i.nameFromFile=t.name,i.addEventListener("onerror",s),i.src=window.URL.createObjectURL(t),o.promise}}angular.module("ringid.shared").service("imageQuality",imageQuality),imageQuality.$inject=["$$q","APP_CONSTANTS","Ringalert","Utils"];function imageQuality(e,t,n,r){var i=this,o=t.COVER_PIC_UPLOAD_MINIMUM_WIDTH,a=t.COVER_PIC_UPLOAD_MINIMUM_HEIGHT,s=t.COVER_PIC_UPLOAD_MAXIMUM_WIDTH,c=t.COVER_PIC_UPLOAD_MAXIMUM_HEIGHT,l=t.PROFILE_PIC_UPLOAD_MINIMUM_WIDTH,u=t.PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT,d=t.IMAGE_UPLOAD_MIN_HEIGHT,g=t.IMAGE_UPLOAD_MIN_WIDTH;i.resizeImage=function(t,n){var i=new Image,m=!1,E=e.defer(),f={ih:0,iw:0,previewUrl:"",file:""},p=window.URL||window.webkitURL;function T(){var e,i,p,T,h=this,I=1,_=h.width,A=h.height;function S(o){e=document.createElement("canvas"),e.width=f.iw,e.height=f.ih,i=e.getContext("2d"),i.drawImage(h,0,0,f.iw,f.ih),o&&(f.imQ=o.qualityIM.quality),f.previewUrl=e.toDataURL("image/jpeg"),f.file=r.dataURLToBlob(f.previewUrl),f.file.name=t.name||n+".jpg",E.resolve(f)}switch(_>s||A>c?_/s>A/c?(I=s/_,f.iw=s,f.ih=Math.floor(I*A)):(I=c/A,f.ih=c,f.iw=Math.floor(I*_)):(f.iw=_,f.ih=A),p=d,T=g,n){case"profilephoto":(f.iw<l||f.ih<u)&&(p=u,T=l,m=!0);break;case"coverphoto":(f.iw<o||f.ih<a)&&(p=a,T=o,m=!0);break;case"image":case"status":case"chatimage":case"tagchatimage":(f.iw<g||f.ih<d)&&(m=!0)}m?E.reject("Image Size below Minimum("+T+"px by "+p+"px) :"+t.name):S(!1)}function h(){E.reject("Image invalid: "+t.name)}return"string"==typeof t?(i.setAttribute("crossOrigin","anonymous"),i.src=t):i.src=p.createObjectURL(t),i.onload=T,i.onerror=h,E.promise}}angular.module("ringid.shared").service("fileUploadService",fileUploadService),fileUploadService.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","Utils","$ringhttp","imageQuality","mediaMetadata"];function fileUploadService(e,t,n,r,i,o,a,s,c,l){var u={},d=this;function g(e){var t,n,r,i=new DataView(e);return i.byteLength?(t=i.getBool(0),t===!1?(r=i.getUint8(1),n={sucs:!1,mg:i.getString(2,r)}):t===!0&&(r=i.getUint8(1),n={sucs:!0,url:i.getString(2,r)})):n={sucs:!1,mg:"Failed. Response unreadable"},n}function m(u,m,E,f){var p,T="",h={uniqueId:a.getUniqueID(),uploadType:u,file:m||null,fileName:m.name&&m.name.substr(0,m.name.lastIndexOf("."))||"uploadFile",fileType:(m.name&&m.type?m.type.substr(0,m.type.indexOf("/")):void 0)||"image",response:{url:""},meta:{ttl:"status"!==u&&"image"!==u&&m.name?m.name.substr(0,m.name.lastIndexOf("."))||m.name:""},gotMeta:!1,previewUrl:"",progressVal:0,queued:!1,uploadComplete:!1,uploadFail:!1};switch(u){case"audio":h.fileName+=".mp3";break;case"video":h.fileName+=".mp4";break;default:h.meta.ttl="",h.fileName+=".jpg"}h.previewUrl=n.baseUrl+"/images/default_"+h.fileType+"_image.jpg","profilephoto"!==u&&"coverphoto"!==u||(h.repositionD={ih:0,iw:0,cimX:0,cimY:0});function I(e){h.progressVal=e,"coverphoto"!==h.uploadType&&"profilephoto"!==h.uploadType||(d.progress=h.progressVal),r.$broadcast(i.FILE_UPLOAD.PROGRESS_UPDATE),E(),RingLogger.information("Upload Progress:"+h.progressVal,RingLogger.tags.UPLOAD)}function _(e){var t;switch(h.uploadType){case"chatimage":t=g(e),t.sucs===!0&&(t.url=t.url),d.uploadProgress=!1,angular.extend(t,h.meta||{});break;case"groupchatcover":t=g(e),angular.extend(t,h.meta||{});break;case"groupchatprofile":case"tagchatimage":t=angular.fromJson(e),t.sucs===!0&&(t.url=t.iurl),d.uploadProgress=!1,angular.extend(t,h.meta||{});break;case"video":t=g(e),h.meta.thmbURL=t.url?t.url.substr(0,t.url.lastIndexOf("."))+".jpg":"",h.previewUrl=t.url?n.mediaBase+h.meta.thmbURL:"";break;case"audio":t=g(e);break;case"coverphoto":case"profilephoto":t=angular.fromJson(e),t.ih=h.meta.ih,t.iw=h.meta.iw,d.uploadProgress=!1;break;case"image":t=angular.fromJson(e),h.previewUrl=t.iurl?n.imBase+t.iurl.substr(0,t.iurl.lastIndexOf("/")+1)+"pthumb"+t.iurl.substr(t.iurl.lastIndexOf("/")+1):"";break;case"thumb":t=g(e);break;default:t=angular.fromJson(e)}h.response=angular.extend({},h.response,t),t.sucs===!0?h.uploadComplete=!0:h.uploadFail=!0,h.queued=!1,t.sucs!==!0&&o.show(t.mg||"Failed","error"),p.resolve(t)}function A(){E(),p.reject()}function S(){h.uploadFail||(h.uploadFail=!0,o.show("Upload failed!","error")),f?p.resolve():p.reject()}function C(e){function t(t){h.meta=angular.extend({},t,h.meta),e({success:!0}),E()}function n(t){o.show(t,"error"),h.uploadFail=!0,p?p.reject(t):e({success:!1,message:t}),E()}function r(t){h.file=t.file,h.meta.ih=t.ih,h.meta.iw=t.iw,h.previewUrl=t.previewUrl,e({success:!0}),E()}function i(t){h.uploadFail=!0,p?(o.show(t,"error"),p.reject(t)):e({success:!1,message:t}),E()}switch(h.fileType){case"video":case"audio":l.generateMeta(h.file,h.fileType).then(t,n);break;case"image":c.resizeImage(h.file,h.uploadType).then(r,i);break;default:RingLogger.warning("FileType not Matched.",RingLogger.tags.UPLOAD)}h.gotMeta=!0,E()}function v(e){var t,n={};function r(){if(n={strmURL:h.response.url,tiw:h.meta.tiw,tih:h.meta.tih,drtn:h.meta.drtn,thmbURL:h.meta.thmbURL,artst:h.meta.artst.utf8Encode(),ttl:h.meta.ttl.utf8Encode()},e){for(t=0;t<d.hashTags.length;t++)d.hashTags[t].sk=d.hashTags[t].sk.utf8Encode();n.htgLst=d.hashTags}}switch(h.fileType){case"image":n={ih:h.meta.ih,iw:h.meta.iw,iurl:h.response.iurl,cptn:h.meta.ttl.utf8Encode()};break;case"video":r();break;case"audio":r();break;default:n=h.response}return n}function D(){var e=!1;return h.hasOwnProperty("meta")&&(e=h.meta),e}function R(e){h.meta=e}function M(e){h.queued=e||!0}function N(){return h.queued}function y(){return h.uploadFail}function b(){return h.uploadComplete}function O(){return h.progressVal}function P(e){h.previewUrl=e}function L(){h.uploadFail=!0,h.xhr?h.xhr.abortRequest():h.deferred&&h.deferred.resolve()}function U(){return h.previewUrl}function F(e){return arguments.length>0&&(h.meta.ttl=e),h.meta.ttl}function w(){var r=new FormData,i="text";switch(p=e.defer(),h.queued=!0,r.append("sId",t.getCookie("sId")),r.append("uId",t.getCookie("uId")),r.append("authServer",t.getCookie("authServer")),r.append("comPort",t.getCookie("comPort")),r.append("x-app-version",n.apiVersion),h.uploadType){case"profilephoto":T=n.imServer+"ImageUploadHandler";break;case"coverphoto":T=n.imServer+"CoverImageUploadHandler";break;case"tagchatimage":T=n.imServer+"GroupContentHandler";break;case"groupchatcover":T=n.imServer+"RoomChatCoverHandler",i="arraybuffer";break;case"groupchatprofile":T=n.imServer+"RoomChatProfileHandler";break;case"chatimage":T=n.imServer+"ChatImageHandler",i="arraybuffer";break;case"image":T=n.imServer+"AlbumImageUploadHandler";break;case"video":T=n.mediaServer+"Mp4UploadHandler",i="arraybuffer";break;case"audio":T=n.mediaServer+"Mp3UploadHandler",i="arraybuffer";break;case"thumb":T=n.mediaServer+"ThumbImageHandler",i="arraybuffer",h.gotMeta=!0}h.gotMeta?o():C(o);function o(){"coverphoto"!==h.uploadType&&"profilephoto"!==h.uploadType||Object.keys(h.repositionD).forEach(function(e){r.append(e,h.repositionD[e])}),r.append("file",h.file,h.fileName),h.xhr=s.post(T,r,i).success(_).error(S).progress(I).abort(A)}return p.promise}function k(){return h.file.name}function $(){return h.file}function G(){var e;return e="profilephoto"===h.uploadType?{pimX:h.repositionD.cimX,pimY:h.repositionD.cimY}:{cimX:h.repositionD.cimX,cimY:h.repositionD.cimY}}function B(e){h.repositionD=angular.extend({},h.repositionD||{},e)}function H(){return h.uniqueId}return{getKey:H,setRepositionData:B,getRepositionData:G,getFile:$,getName:k,fetchMeta:C,initUpload:w,cptn:F,getPreview:U,cancelUpload:L,setPreview:P,getProgress:O,uploadCompleted:b,uploadFailed:y,getQueued:N,setQueued:M,setMeta:R,getMeta:D,getAuthData:v}}d.profileImageFile=null,d.coverImageFile=null,d.chatImageFiles={},d.progress=0,d.uploadProgress=!1,d.selectFromAlbum=!1,d.hashTags=[],d.imageFiles=[],d.videoFiles=[],d.audioFiles=[];function E(){d.progress=0,d.uploadProgress=!1,d.hashTags.splice(0),d.imageFiles.splice(0),d.videoFiles.splice(0),d.audioFiles.splice(0)}function f(e,t){return new m(e,t,S)}function p(e,t){switch(e){case"profilephoto":return d.progress=0,d.profileImageFile=new m(e,t,S),d.profileImageFile;case"coverphoto":return d.progress=0,d.coverImageFile=new m(e,t,S),d.coverImageFile;case"groupchatcover":case"groupchatprofile":case"tagchatimage":case"chatimage":return new m(e,t,S);case"image":d.imageFiles.push(new m(e,t,S,(!0)));break;case"video":d.videoFiles.push(new m(e,t,S,(!0)));break;case"audio":d.audioFiles.push(new m(e,t,S,(!0)))}return S(),!1}function T(e,t){"coverphoto"===t?d.coverImageFile.setRepositionData(e):"profilephoto"===t&&d.profileImageFile.setRepositionData(e)}function h(e){var t;return t="coverphoto"===e?d.coverImageFile.getRepositionData():"profilephoto"===e?d.profileImageFile.getRepositionData():{}}function I(t,n){var o,a,s,c=[],l=t+"Files";function u(){E(),d.uploadQueue(t,s)}function g(){s-=E(),d.uploadQueue(t,s)}function m(){for(d.uploadProgress=!1,E(!0),a=0;a<d[l].length;a++)if(!d[l][a].uploadCompleted()){d.uploadProgress=!0;break}d.uploadProgress||(clearInterval(o),r.$broadcast(i.FILE_UPLOAD.QUEUE_COMPLETE,t),S())}if(n<d[l].length){for(s=n+2<d[l].length?n+2:d[l].length,a=n;a<s;a++)!d[l][a]||d[l][a].getQueued()||d[l][a].uploadFailed()||c.push(d[l][a].initUpload());if(0===c.length)return void d.uploadQueue(t,s);e.all(c).then(u,g)}else o=setInterval(m,2e3);function E(e){var t,r,i=e?0:n,o=0;for(r=i,t=d[l].length;r<t;r++)d[l][r]&&d[l][r].uploadFailed()&&(d[l].splice(r,1),o++,r--,t--);return o>0&&S(),o}}function _(e){u[e.$id]=e}function A(e){u[e.$id]&&(u[e.$id]=null)}function S(){var e,t;for(t in u)u.hasOwnProperty(t)&&(e=u[t],e&&e.$id&&!e.$$destroyed&&e.$rgDigest())}d.resetUpload=E,d.createUploadFile=f,d.queueFile=p,d.setReposition=T,d.getReposition=h,d.uploadQueue=I,d.setScopeForDigest=_,d.removeScope=A}angular.module("ringid.shared").service("StickerEmoticonService",StickerEmoticonService).factory("StickerEmoticonFactory",StickerEmoticonFactory),StickerEmoticonService.$inject=["STICKER_IMAGE_TYPE","settings"];function StickerEmoticonService(e,t){var n,r,i=this,o=[],a={":D":"awesome.png",":<3":"loved.png","*D*":"excited.png",":)":"happy.png",":-(":"alone.png","(cool)":"cool.png","x=(":"angry.png","o_-":"fresh.png",":>s":"sick.png",":?":"confused.png",";|":"thoughtful.png",":*":"fantastic.png",":=(":"upset.png",">u<":"blah.png","(amused)":"amused.png","(hot)":"hot.png","(-_^)":"motivated.png","(^_^)":"satisfied.png",">=<":"hurt.png",":(s":"ill.png","(cute)":"cute.png","I=)":"relived.png",":O":"shoked.png","(beautiful)":"beautiful.png",":|p":"hyper.png","(pumped)":"pumped.png","%)":"drunk.png","o(":"impatient.png","(restless)":"restless.png",":-)":"emotional.png","(hungry)":"hungry.png","(nostalgic)":"nostalgic.png","(blessed)":"blessed.png","</3":"heartboken.png","(naughty)":"naughty.png","(entertained)":"entertained.png","(broken)":"broken.png","(cold)":"cold.png","(down)":"down.png","(sorry)":"sorry.png","(frustrated)":"frustrated.png",":-s":"scared.png",":@":"fuming.png",NN:"run.png",":'q":"crying.png",":'D":"laughing.png",":'(":"soreness.png","(boiling)":"boiling.png",":x":"xmode.png",":p":"cheeky.png",":=0":"laughing-inside.png","|-O":"yawn.png",":6":"devil.png",":-#":"zipped-lip.png","(clap)":"clap.png","<3":"heart.png","(pink-heart)":"pink-heart.png","(k)":"pink-lip.png","(#)":"sun.png","(*)":"star.png","(g)":"gift.png","(K)":"red-lip.png","(f)":"rose.png"},s=angular.extend({":&lt;3":"loved.png","&lt;/3":"heartboken.png","&gt;=&lt;":"hurt.png","&gt;u&lt;":"blah.png",":&gt;s":"sick.png","&lt;3":"heart.png"},a);i.getEmoImageName=E,i.getAllEmoticons=m,i.getEmoticonUrlMap=g,i.getEmoticonUrlMapWithHtmlEncode=d,i.getEmoticonPattern=u,i.getEmoticonMap=l;function c(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}for(n in s)s.hasOwnProperty(n)&&o.push(c(n));r=new RegExp(o.join("|"),"g");function l(){return s}function u(){return r}function d(){var e={};return angular.forEach(s,function(n,r){e[r]=t.emoticonBase+n}),e}function g(){var e={};return angular.forEach(a,function(n,r){e[r]=t.emoticonBase+n}),e}function m(){var t={type:e.EMOTICON,imageList:[]};return angular.forEach(a,function(n,r){t.imageList.push({name:n,symbol:r,type:e.EMOTICON})}),t}function E(e){try{return a[e]}catch(e){return"default.png"}}}StickerEmoticonFactory.$inject=["StickerEmoticonService","settings"];function StickerEmoticonFactory(e,t){function n(){return e.getAllEmoticons()}function r(t){return e.getEmoImageName(t)}function i(e,n,r){var i=t.stickerBase+e+"/"+n+"/"+r;return i}return{getAllEmoticons:n,getEmoImageName:r,getStickerImageUrl:i,getEmoticonUrlMap:e.getEmoticonUrlMap,getEmoticonUrlMapWithHtmlEncode:e.getEmoticonUrlMapWithHtmlEncode,getEmoticonPattern:e.getEmoticonPattern}}angular.module("ringid.shared").factory("friendsFactory",friendsFactory),friendsFactory.$inject=["$rootScope","SystemEvents","$$q","Contacts","APP_CONSTANTS","Auth","Storage","$$connector","OPERATION_TYPES","userFactory","friendsHttpService","$$stackedMap","Ringalert","Utils","mapFilterFilter"];function friendsFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E){var f,p=c.SYSTEM.FRIENDS,T=!1,h=i,I=0,_=0,A={totalPacket:0,complete:!1};function S(e,t){var n,r,i,s,c,l=[],u=[],d=[];if(RingLogger.print("UTID Byte Array of "+e.length+" utids",RingLogger.tags.FRIEND),t)d=e;else{for(i=0,s=e.length;i<s;i++)e[i]!==o.currentUser().getUtId()&&(a.getContact(e[i])?u.push(a.getContact(e[i])):d.push(e[i]));u.length>0&&(RingLogger.print("Got request utid contacts in LocalStorage: "+u.length),v(u))}for(RingLogger.print("Request UTID Byte Array of "+d.length+" utids",RingLogger.tags.FRIEND),n=new ArrayBuffer(8*d.length),r=new DataView(n),i=0,c=0,s=d.length;i<s;i++)r.setInt32(c,0),c+=4,r.setInt32(c,d[i]),c+=4;for(i=0;i<r.byteLength;i++)l.push(r.getInt8(i));return l}function C(e,t,n){var i=r.remove("utIds",e);t&&f.friends.remove(e),i&&!n||(i=r.remove("incomingUtIds",e),t&&f.incomingFriends.remove(e),i&&!n||(i=r.remove("outgoingUtIds",e),t&&f.outgoingFriends.remove(e)))}function v(e){var t,n,r,i;for(r=0,n=e.length;r<n;r++)t=l.create(e[r]),i=t.friendshipStatus(),e[r].deleted&&1===e[r].deleted||(i===h.FRIEND?f.friends.save(t.getUtId(),t):i===h.INCOMING_FRIEND?f.incomingFriends.save(t.getUtId(),t):i===h.OUTGOING_FRIEND&&f.outgoingFriends.save(t.getUtId(),t),C(e[r].utId,!1,!0))}function D(e,t){var n=t&&t.mg?t.mg:"Reqeust Failed";g.show(n,"error"),e&&e.reject({sucs:!1,mg:n})}function R(e){var n,i,o;switch(e.actn){case p.TYPE_CONTACT_UTIDS:if(e.sucs===!0){for(0!==A.totalPacket||A.complete||(A.totalPacket=e.totalPacket),A.totalPacket--,i=0,o=e.utIds.length;i<o;i++)switch(e.utIds[i].value.frnS){case h.FRIEND:r.add("utIds",e.utIds[i].key,e.utIds[i].value);break;case h.INCOMING_FRIEND:r.add("incomingUtIds",e.utIds[i].key,e.utIds[i].value);break;case h.OUTGOING_FRIEND:r.add("outgoingUtIds",e.utIds[i].key,e.utIds[i].value)}0===A.totalPacket&&(A.complete=!0,r.initStorage(),m.triggerCustomEvent(t.FRIEND.UTID_LIST_RECEIVED))}else e.sucs===!1&&1111===e.rc&&(RingLogger.warning("Contact List utID REPEAT",RingLogger.tags.FRIEND),u.getContactList());break;case p.TYPE_UPDATE_ADD_FRIEND:e.sucs===!0&&r.add("incomingUtIds",e.utId,{frns:h.INCOMING_FRIEND});break;case p.TYPE_UPDATE_DELETE_FRIEND:e.sucs===!0&&e.utId&&(C(e.utId,!0,!0),n=l.create(e),n.updateUserObj({frnS:h.NOT_FRIEND}));break;case p.TYPE_UPDATE_ACCEPT_FRIEND:e.sucs===!0&&(C(e.utId,!0),f.friends.add(e.utId,l.create(e)))}}function M(e){switch(e){case"friendslist":case"friends":return f.friends;case"incoming":return f.incomingFriends;case"outgoing":return f.outgoingFriends;case"userfriends":return f.userFriends;default:return f.friends}}function N(e,t){var i=e||20,o=n.defer();0===r.utIds().length()&&0===f.friends.length()?s.subscribe(function(){setTimeout(a,2e3)},{action:[p.TYPE_CONTACT_UTIDS],callWithUnresolved:!0}):a();function a(){t?B({schPm:t},!0).then(function(){o.resolve(E(f.friends.all(),{mapApi:"getName",value:t}))}):f.friends.length()<e&&r.utIds().length()>0?O("utIds",e-f.friends.length()).then(function(){o.resolve(f.friends.sliceBy(i))}):o.resolve(f.friends.sliceBy(i))}return o.promise}function y(){I=0,f.userFriends.reset()}function b(e){var t,r,i=n.defer();function o(e){if(I=0===I?e.tf:I,e.sucs===!0){for(_+=e.contactList.length,t=0;t<e.contactList.length;t++)r=l.create(e.contactList[t]),f.userFriends.save(r.getKey(),r);i.resolve()}else RingLogger.alert("FRIENDS FRIENDLIST FETCH FAIL",RingLogger.tags.FRIEND),i.reject(e)}function a(e){i.reject(e)}return u.getUserContacts(e,_).then(o,a),i.promise}function O(e,t){var i,o,s,c=[],l=n.defer();switch(o=t||20,s=e||"utIds"){case"friends":case"friendslist":case"utIds":RingLogger.print("fetch Details by utid",RingLogger.tags.FRIEND),c=S(r.utIds().keys().slice(0,o)),f.state.isFriendsLoading=c.length>0;break;case"userfriends":break;case"incoming":case"incomingUtIds":c=S(r.incomingUtIds().keys().slice(0,o));break;case"outgoing":case"outgoingUtIds":c=S(r.outgoingUtIds().keys().slice(0,o));break;default:c=S(r.utIds().keys().slice(0,o)),f.state.isFriendsLoading=c.length>0}function d(e){if(e.sucs===!0){for(i=0;i<e.contacts.length;i++)a.setContact(e.contacts[i].utId,e.contacts[i]);v(e.contacts),l.resolve(e)}else RingLogger.warning("Contacts Details fetch Failed",e,RingLogger.tags.FRIEND),l.reject(e)}function g(e){l.reject(e)}return c.length>0?(RingLogger.print("requesting details with utid byteArray Length: "+c.length,RingLogger.tags.FRIEND),u.getContactListDetails({utIDs:c,uo:!1}).then(d,g)):(RingLogger.print("requesting fails with utid byteArray Length: "+c.length,RingLogger.tags.FRIEND),l.resolve({sucs:!0})),l.promise}function P(e){var t;return e.length>0&&(t=S(e,!0),t.length>0)&&u.getContactListDetails({utIDs:t,uo:!1})}function L(e,t){switch(e.friend.isLoading(!0),e.action){case"remove":case"unfriend":return w(e,t);case"add":case"addfriend":return U(e,t);case"accept":return F(e,t);case"incoming_reject":case"outgoing_reject":case"reject":return k(e,t);case"block":return e.block=1,e.bv=0,$(e,t);case"unblock":return e.block=0,e.bv=1,$(e,t);default:return e.friend.isLoading(!1),!1}}function U(e,t){var i=!!t&&n.defer(),o=e.friend.getUtId();function a(n){e.friend.isLoading(!1),n.sucs===!0?(r.add("outgoingUtIds",o,{frns:h.OUTGOING_FRIEND}),t&&i.resolve(n),e.friend.updateUserObj(angular.extend({},n,{frns:h.OUTGOING_FRIEND}))):D(i,n)}function s(t){e.friend.isLoading(!1),D(i,t)}return u.sendFriendRequest({uId:e.friend.getKey()}).then(a,s),!!t&&i.promise}function F(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();function s(n){RingLogger.print(n,RingLogger.tags.FRIEND),r.friend.isLoading(!1),n.sucs===!0?(C(a,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),r.friend.updateUserObj(angular.extend({},n,{frnS:h.FRIEND})),f.friends.save(a,r.friend),i&&o.resolve(n)):D(o,n)}function c(e){r.friend.isLoading(!1),D(o,e)}return u.acceptFriendRequest({friendId:r.friend.getKey(),utId:r.friend.getUtId()}).then(s,c),!!i&&o.promise}function w(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();function s(n){RingLogger.print(n,RingLogger.tags.FRIEND),r.friend.isLoading(!1),n.sucs===!0?(C(a,!0,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),r.friend.updateUserObj(angular.extend({},n,{frnS:h.NOT_FRIEND})),i&&o.resolve(n)):D(o,n)}function c(e){r.friend.isLoading(!1),D(o,e)}return u.unFriend({friendId:r.friend.getKey()}).then(s,c),!!i&&o.promise}function k(r,i){var o=!!i&&n.defer(),a=r.friend.getUtId();function s(n){r.friend.isLoading(!1),n.sucs===!0?(r.friend.updateUserObj(angular.extend({},n,{frnS:h.NOT_FRIEND})),C(a,!0,!0),e.$broadcast(t.FRIEND.PENDING_FRIENDS_COUNT_CHANGED),i&&o.resolve(n)):D(o,n)}function c(e){r.friend.isLoading(!1),D(o,e)}return u.unFriend({friendId:r.friend.getKey()}).then(s,c),!!i&&o.promise}function $(e,t){var r=!!t&&n.defer();function i(n){e.friend.isLoading(!1),n.sucs===!0&&e.friend.setBlock(e.block),t&&r.resolve()}function o(){e.friend.isLoading(!1),t&&r.reject()}return u.blockFriend(e).then(i,o),!!t&&r.promise}function G(){var e,t="";for(e=0;e<f.friends.size();e++)t+=",".fFactory.friends[e].getKey();return t}function B(e,t){var r,i;function o(e){if(e.sucs===!0){for(i=0;i<e.searchedcontaclist.length;i++)a.setContact(e.searchedcontaclist[i].utId,e.searchedcontaclist[i]);v(e.searchedcontaclist),r.resolve()}else r.reject()}function s(){r.reject()}return t?(r=n.defer(),u.searchContact(e,t).then(o,s),r.promise):u.searchContact(e,!1)}function H(e,t){switch(e){case"utIds":r.utIds().save(t,{frnS:h.FRIEND});break;case"incomingUtIds":r.incomingUtIds().save(t,{frnS:h.INCOMING_FRIEND});break;case"outgoingUtIds":r.outgoingUtIds().save(t,{frnS:h.OUTGOING_FRIEND})}}function x(){var e=r.incomingUtIds().length()+f.incomingFriends.length();return e>99?"99+":e}function Y(){return r.outgoingUtIds().length()+f.outgoingFriends.length()}function K(e){return"userfriends"===e?I:r.utIds().length()+f.friends.length()}function j(){return I}f={state:{noFriends:!1,isFriendsLoading:!1,isUserFriendsLoading:!1,isRequestsLoading:!1},getRequestCount:x,getPendingCount:Y,totalFriends:K,totalUserFriends:j,friends:d.createNew(),userFriends:d.createNew(),incomingFriends:d.createNew(),outgoingFriends:d.createNew(),process:R,getFriends:M,myFriends:N,resetUserFriends:y,getUserContacts:b,getContactDetails:O,getContactDetailsByUtIds:P,removeFriend:w,friendAction:L,addFriend:U,rejectFriendRequest:k,acceptFriendRequest:F,searchContact:B,initFriends:V,addToUtIdList:H,blockFriend:$,getIds:G,utIDsToByteArray:S},s.subscribe(f.process,{action:[p.TYPE_CONTACT_UTIDS,p.TYPE_UPDATE_ADD_FRIEND,p.TYPE_UPDATE_DELETE_FRIEND,p.TYPE_UPDATE_ACCEPT_FRIEND],callWithUnresolved:!0});function V(e){T&&!e||(T=!0,r.init(),u.getContactList())}return f}angular.module("ringid.shared").service("friendsHttpService",friendsHttpService),friendsHttpService.$inject=["$$connector","OPERATION_TYPES","APP_CONSTANTS"];function friendsHttpService(e,t,n){var r=this,i=t.SYSTEM.FRIENDS,o=n,a=t.SYSTEM.REQUEST_TYPE;r.searchContact=function(t,n){var r={actn:n?i.ACTION_FRIEND_SEARCH:i.TYPE_CONTACT_SEARCH,scat:o.TYPE_SEARCH_BY_ALL,schPm:t.schPm.utf8Encode(),st:t.st||0},s=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return s.test(t.schPm)&&(r.scat=o.TYPE_SEARCH_BY_EMAIL),e.request(r,a.REQUEST,!0)},r.getContactList=function(t){var n={actn:i.TYPE_CONTACT_UTIDS,cut:-1,ut:t||-1};return e.send(n,a.REQUEST)},r.getContactListDetails=function(t){var n={actn:i.TYPE_CONTACT_LIST,uo:t.uo||!1,utIDs:t.utIDs};return e.pull(n,a.REQUEST,!0)},r.getUserContacts=function(t,n){var r={actn:i.TYPE_FRIEND_CONTACT_LIST,utId:t,st:n||0};return e.pull(r,a.REQUEST)},r.unFriend=function(t){var n={actn:i.TYPE_DELETE_FRIEND,uId:t.friendId};return e.request(n,a.UPDATE,!0)},r.changeFriendType=function(t){var n={actn:i.TYPE_ACTION_CHANGE_FRIEND_ACCESS,ct:t.ct,utId:t.utId};return e.request(n,a.UPDATE)},r.sendFriendRequest=function(t){var n={actn:i.TYPE_ADD_FRIEND,uId:t.uId};return e.request(n,a.UPDATE,!0)},r.blockFriend=function(t){var n={actn:i.TYPE_ACTION_BLOCK_UNBLOCK_FRIEND,idList:[t.friend.getUtId()],bv:t.bv};return e.request(n,a.REQUEST)},r.saveCallPvcEdit=function(t){var n={actn:t.actn,sn:t.callsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveChatPvcEdit=function(t){var n={actn:t.actn,sn:t.chatsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.saveFeedPvcEdit=function(t){var n={actn:t.actn,sn:t.feedsn,sv:t.sv,utId:t.friend.getUtId()};return e.request(n,a.UPDATE)},r.acceptFriendRequest=function(t){var n={actn:i.TYPE_ACCEPT_FRIEND,utId:t.utId};return e.request(n,a.UPDATE,!0)}}angular.module("ringid.shared").service("circleHttpService",circleHttpService),circleHttpService.$inject=["$$connector","OPERATION_TYPES"];function circleHttpService(e,t){var n=this,r=t.SYSTEM.CIRCLE,i=t.SYSTEM.REQUEST_TYPE;n.getCircleMembers=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_LIST,grpId:t,scl:1,lmt:o||40,pvtid:n||0};return e.send(a,i.REQUEST)},n.createCircle=function(t){var n={actn:r.TYPE_CREATE_GROUP,gNm:t.tg.utf8Encode(),uId:t.uId,groupMembers:t.alluser};return e.request(n,i.UPDATE)},n.getCircles=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.send(t,i.REQUEST)},n.getCircle=function(t){return e.request({actn:r.TYPE_GROUP_DETAILS,grpId:t},i.REQUEST)},n.getCirclesInfo=function(){var t={actn:r.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return e.request(t,i.REQUEST)},n.addMembers=function(t){var n={actn:r.TYPE_ADD_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.removeMember=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:[{uId:t.uId}]};return e.request(n,i.UPDATE)},n.removeMembers=function(t){var n={actn:r.TYPE_REMOVE_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmins=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:t.grpId,groupMembers:t.members};return e.request(n,i.UPDATE)},n.addRemoveAdmin=function(t){var n={actn:r.TYPE_EDIT_GROUP_MEMBER,grpId:t.grpId,groupMembers:[{admin:t.admin,uId:t.uId}]};return e.request(n,i.UPDATE)},n.leaveCircle=function(t){var n={actn:r.TYPE_LEAVE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.deleteCircle=function(t){var n={actn:r.TYPE_DELETE_GROUP,grpId:t.grpId};return e.request(n,i.UPDATE)},n.getMemberResult=function(t,n,o){var a={actn:r.TYPE_GROUP_MEMBERS_SEARCH_RESULT,grpId:n,schPm:t,st:o||0};return e.send(a,i.REQUEST)}}angular.module("ringid.shared").service("portalHttpService",portalHttpService),portalHttpService.$inject=["OPERATION_TYPES","$$connector"];function portalHttpService(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getPortalDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,st:e||0,pType:3};return t.pull(n,i.REQUEST,!0)},n.getPortalFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,st:e||0,pType:3};return t.pull(n,i.REQUEST,!0)},n.getPortalCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,utId:e,pType:3};return t.pull(n,i.REQUEST,!0)},n.searchNewsPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:3,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,o,a){var s={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,id:e,subscType:a,npSubIds:n,npUnSubIds:o,pType:3};return t.request(s,i.UPDATE)},n.unFollowPortal=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,id:e,pType:3};return t.request(n,i.UPDATE)},n.getPortalShortDetails=function(e){var n={actn:o,isnp:!0,utId:e,pType:3};return t.request(n,i.REQUEST)},n.getBreakingNews=function(){var e={actn:r.ACTION_NEWSPORTAL_BREAKING_FEED};return t.request(e,i.REQUEST)}}angular.module("ringid.shared").service("businessHttpService",businessHttpService),businessHttpService.$inject=["OPERATION_TYPES","$$connector"];function businessHttpService(e,t){var n=this,r=e.SYSTEM.PORTAL,i=e.SYSTEM.REQUEST_TYPE,o=e.SYSTEM.PROFILE.TYPE_ACTION_GET_USER_DETAILS;n.getBusinessDiscoverList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:1,st:e||0,pType:4};return t.pull(n,i.REQUEST,!0)},n.getBusinessFollowingList=function(e){var n={actn:r.ACTION_NEWSPORTAL_LIST,subscType:2,st:e||0,pType:4};return t.pull(n,i.REQUEST,!0)},n.getBusinessCatList=function(e){var n={actn:r.ACTION_NEWSPORTAL_CATEGORIES_LIST,utId:e,pType:4};return t.pull(n,i.REQUEST,!0)},n.searchBusinessPortal=function(e){var n={actn:r.ACTION_CONTACT_SEARCH,pType:4,schPm:e};return t.pull(n,i.REQUEST,!0)},n.doneFollowing=function(e,n,o,a){var s={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,id:e,subscType:a,npSubIds:n,npUnSubIds:o,pType:4};return t.request(s,i.UPDATE)},n.unFollowBusiness=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:1,id:e,pType:4};return t.request(n,i.UPDATE)},n.followBusinessPage=function(e){var n={actn:r.ACTION_SUBSCRIBE_UNSUBSCRIBE_NEWSPORTAL,subscType:2,id:e,pType:4};return t.request(n,i.UPDATE)},n.getBusinessShortDetails=function(e){var n={actn:o,utId:e,pType:4};return t.request(n,i.REQUEST)}}angular.module("ringid.shared").factory("circlesManager",circlesManager),circlesManager.$inject=["$routeParams","$location","$rootScope","$$connector","OPERATION_TYPES","Storage","$$stackedMap","$$q","circleMap","userFactory","circleHttpService","Notification","SystemEvents","Ringalert","Auth"];function circlesManager(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E){
var f,p,T,h=a.createNew(!0,"asc"),I=!1,_=a.createNew(!0,"asc"),A=i.SYSTEM.CIRCLE;function S(e){_.remove(e),n.$broadcast(g.CIRCLE.MY_CIRCLE_REMOVED,{circleId:e})}function C(e,t){var n=e.get(t.grpId);return n?n.update(t):n=c.create(t),e.save(n.getKey(),n),n}function v(e){var t;return e.ists||(t=e.sAd===E.currentUser().getKey()?C(h,e):C(_,e)),t}function D(e){angular.forEach(e,v)}function R(n){e.circleId&&parseInt(e.circleId,10)===parseInt(n,10)&&t.path("/")}function M(){m.show("Circle does not exist!","warning"),t.path("/")}function N(e){var t,n;function r(e){n.removeMember(e)}if(e.sucs)switch(e.actn){case A.TYPE_UPDATE_EDIT_GROUP_MEMBER:case A.TYPE_UPDATE_ADD_GROUP_MEMBER:t=e.grpId,n=U(t),n&&n.setMembers(e.groupMembers);break;case A.TYPE_UPDATE_DELETE_GROUP:t=e.grpId,n=U(t),n&&(S(n.getKey()),R(e.grpId));break;case A.TYPE_UPDATE_REMOVE_GROUP_MEMBER:t=e.grpId,n=U(t),e.removedMembers&&n&&angular.forEach(e.removedMembers,r);break;case A.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:e.groupList=[{gNm:e.gNm,grpId:e.grpId,mc:e.mc,sAd:e.sAd}],D(e.groupList),O(e.groupMembers)}}function y(e){return e.actn===A.TYPE_UPDATE_EDIT_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_ADD_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_DELETE_GROUP||e.actn===A.TYPE_UPDATE_REMOVE_GROUP_MEMBER||e.actn===A.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND}function b(e){clearTimeout(f),e.actn===A.TYPE_GROUP_LIST&&e.sucs===!0&&(D(e.groupList),n.$broadcast(g.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE))}function O(e){var t,r;if(e.sucs===!0&&angular.isArray(e.groupMembers)&&e.groupMembers.length){for(t=0;t<e.groupMembers.length;t++)p=e.groupMembers[t].id;if(r=h.get(e.groupMembers[0].grpId),r||(r=_.get(e.groupMembers[0].grpId)),!r)return;r.setMembers(e.groupMembers)}n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:!0})}function P(e){var t;if(T=e.tr,e.sucs===!0&&angular.isArray(e.groupMembers)&&e.groupMembers.length){if(t=h.get(e.groupMembers[0].grpId),t||(t=_.get(e.groupMembers[0].grpId)),!t)return;t.setMembers(e.groupMembers)}n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:e.sucs})}function L(e,t){function r(e){e.sucs===!0&&(t.setMemberCount(e.mc),n.$broadcast(g.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT))}u.getCircle(e).then(r)}function U(e){return h.get(e)||_.get(e)}function F(e){var t=U(e),n=s.defer();function r(r){r.sucs?(r.grpId=e,r.ists=0,t=v(r),n.resolve(t)):n.reject(!1)}function i(){n.resolve(t)}return t?setTimeout(i):u.getCircle(e).then(r),n.promise}function w(e){return e?h:_}function k(e){var t=s.defer();function n(e){e.sucs===!0&&u.getCircles(),t.resolve(e)}return u.createCircle(e).then(n),t.promise}function $(e,t){var n=s.defer(),r={grpId:t,members:e};function i(e){n.resolve(e)}return u.addMembers(r).then(i),n.promise}function G(e,t,n){0===t&&(p=t),u.getCircleMembers(e,p,n)}function B(e,t){u.getMemberResult(e,t,T)}function H(e){var t=s.defer();function n(n){var r=angular.fromJson(n);r.sucs===!0?(h.remove(e.getKey()),_.remove(e.getKey()),t.resolve(r)):t.reject("Failed")}return u.leaveCircle({grpId:e.getKey()}).then(n),t.promise}function x(e){var t=s.defer();function n(n){n.sucs===!0?(h.remove(e.getKey()),_.remove(e.getKey()),t.resolve(n)):t.reject("Failed")}return u.deleteCircle({grpId:e.getKey()}).then(n),t.promise}function Y(e,t){var r={grpId:t.getKey(),uId:e},i=t.removeMember(e);function o(e){e.sucs!==!0&&(t.addMember(i),m.show(e,"error")),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}u.removeMember(r).then(o)}function K(e,t){var r={grpId:t.getKey(),members:[]};function i(r){r.sucs!==!0&&(angular.forEach(e,function(e){t.addMember(e)}),t.setMemberCount(t.getMembersObjectCount()),m.show(r,"error")),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}function o(e){r.members.push({uId:e}),t.removeMember(e)}angular.forEach(e,o),t.setMemberCount(t.getMembersObjectCount()),u.removeMembers(r).then(i)}function j(e,t){var r;function i(i){i.sucs===!0&&(r=i.groupMembers[0],r.uId===e.uId&&r.admin===!0?t.promoteToAdmin(e.uId):r.uId===e.uId&&r.admin===!1&&t.removeFromAdmin(e.uId),n.$broadcast(g.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE))}u.addRemoveAdmin(e).then(i)}function V(e){I||(r.subscribe(N,{action:[A.TYPE_UPDATE_DELETE_GROUP,A.TYPE_UPDATE_REMOVE_GROUP_MEMBER,A.TYPE_UPDATE_ADD_GROUP_MEMBER,A.TYPE_UPDATE_EDIT_GROUP_MEMBER]}),r.subscribe(b,{action:[A.TYPE_GROUP_LIST]})),I&&!e||(I=!0,u.getCircles())}return{init:V,processCircleUpdates:N,circleUpdateFilter:y,processCirclesData:b,processCircleMembersData:O,processCircleSearchMembersData:P,getCircle:U,getCirclePromise:F,getCircles:w,createCircle:k,getCircleMembers:G,leaveGroup:H,deleteCircle:x,addMembers:$,removeMember:Y,removeMembers:K,toggleMembership:j,redirectHome:M,getMemberResult:B,getSingleCircleInfo:L}}angular.module("ringid.shared").service("imageHttpService",imageHttpService),imageHttpService.$inject=["$$q","settings","$$connector","OPERATION_TYPES"];function imageHttpService(e,t,n,r){var i=this,o=r.SYSTEM.REQUEST_TYPE,a=r.SYSTEM.IMAGE;function s(e){var t={actn:r.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:e};return n.request(t,o.REQUEST)}function c(t){var n=e.defer();return i.go({actn:a.GET_CP_OR_PP_DETAIL,type:t.type}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function l(e){return n.request({actn:a.TYPE_IMAGE_DETAILS,imgId:e},o.REQUEST)}function u(e){return n.request({actn:a.DELETE_IMAGE,imgIds:[e]},o.UPDATE)}function d(e){var t={};e.fndId?(t.actn=a.TYPE_FRIEND_ALBUM_IMAGES,t.fndId=e.fndId):t.actn=a.TYPE_ALBUM_IMAGES,t.st=e.st||0,t.albId=e.albId,n.send(t,o.REQUEST,!0)}function g(e){var t={};e?(t.actn=a.FETCH_FRIEND_ALBUM_LIST,t.fndId=e):t.actn=a.FETCH_ALBUM_LIST,n.send(t,o.REQUEST)}i.fetchAlbumList=g,i.getAlbumImages=d,i.deleteImage=u,i.getImageDetails=l,i.getProfilePicORCoverPicImageDetails=c,i.getFeedImages=s}angular.module("ringid.shared").factory("AlbumFactory",AlbumFactory),AlbumFactory.$inject=["$$q","settings","Auth","$$albumMap","$$imageMap","$$stackedMap","$$connector","OPERATION_TYPES","imageHttpService","Ringalert"];function AlbumFactory(e,t,n,r,i,o,a,s,c,l){var u={imagesLoading:!1,albumsLoading:!1},d=s.SYSTEM.IMAGE,g=o.createNew(),m=o.createNew();function E(e,t){var n,i,o;switch(e.actn){case d.TYPE_ALBUM_IMAGES:RingLogger.information("got Album images for album: "+e.albId+" success: "+e.sucs,RingLogger.tags.IMAGE),e.sucs===!0?g.get(e.albId)?g.get(e.albId).pushImages(e):(n=new r(e),g.save(n.getKey(),n)):e.sucs===!1&&1111===e.rc&&RingLogger.alert("Album request failed",RingLogger.tags.IMAGE);break;case d.TYPE_FRIEND_ALBUM_IMAGES:RingLogger.information("got Album images for album: "+e.albId+" success: "+e.sucs,RingLogger.tags.IMAGE),e.sucs===!0&&(m.get(e.albId)?m.get(e.albId).pushImages(e):(n=new r(e),m.save(n.getKey(),n)));break;case d.FETCH_FRIEND_ALBUM_LIST:if(e.sucs===!0)for(i=0,o=e.albumList.length;i<o;i++)n=new r(e.albumList[i],t),m.save(n.getKey(),n);break;case d.FETCH_ALBUM_LIST:if(e.sucs===!0)for(i=0,o=e.albumList.length;i<o;i++)n=new r(e.albumList[i],t),g.save(n.getKey(),n);break;default:RingLogger.warning("actn Does not match",e,RingLogger.tags.IMAGE)}}function f(e,t){var r=!1,i=0;if(n.currentUser().getKey()===t){if(i=g.get(e)?g.get(e).getImages().length():0,0!==i&&i>=g.get(e).getTotalImageCount())return}else if(r=t,i=m.get(e)?m.get(e).getImages().length():0,0!==i&&i>=m.get(e).getTotalImageCount())return;c.getAlbumImages({fndId:r,albId:e,st:i})}function p(e){var t=!1;n.currentUser().getKey()!==e&&(t=e),c.fetchAlbumList(t)}function T(t,n){var r=e.defer();function o(e){e.sucs===!0?(n&&!e.nfId&&(e.nfId=n),r.resolve(i(e))):l.show(e,"error")}function a(e){r.reject(e)}return c.getImageDetails(t).then(o,a),r.promise}function h(e){return n.currentUser().getKey()===e?g:m}function I(e){return c.deleteImage(e.getKey())}function _(e){e?g.reset():m.reset()}return{processResponse:E,state:u,resetAlbums:_,deleteImage:I,getAlbums:h,loadMoreImage:f,fetchAllAlbums:p,getFeedImages:c.getFeedImages,getImageDetails:T}}angular.module("ringid.shared").service("mediaHttpService",mediaHttpService),mediaHttpService.$inject=["OPERATION_TYPES","$$connector"];function mediaHttpService(e,t){var n=this,r=e.SYSTEM.MEDIA,i=e.SYSTEM.REQUEST_TYPE;n.fetchMediaAlbums=A,n.fetchHashtagSuggestion=_,n.fetchSearchResult=I,n.fetchContent=h,n.fetchAlbumDetails=T,n.addMediaAlbum=p,n.updateMediaAlbum=f,n.deleteAlbum=E,n.fetchAlbumContents=m,n.fetchAlbumContentsForpopup=g,n.addMediaToAlbum=d,n.updateMediaContent=u,n.deleteAlbumContent=l,n.increaseViewCount=c,n.getSearchTrends=s,n.getTaggedMedia=a,n.fetchSliderImage=o;function o(e){var n={actn:r.ACTION_GET_MEDIA_SLIDER_IMG,mdaT:e.mdaT};return t.pull(n,i.REQUEST,!0)}function a(e){var n={actn:r.ACTION_GET_TAGGED_MEDIA_SONGS,htid:e,pvtid:0,scl:2};return t.send(n,i.REQUEST)}function s(){var e={actn:281};return t.pull(e,i.REQUEST)}function c(e,n){var o={actn:r.ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT,cntntId:e};return n&&(o.nfId=n),t.request(o,i.UPDATE)}function l(e){var n={actn:r.ACTION_DELETE_MEDIA_CONTENT,cntntId:e};return t.request(n,i.UPDATE)}function u(e){var n={actn:r.ACTION_UPDATE_MEDIA_CONTENT,mdaCntntDTO:e.mdaCntntDTO};return t.request(n,i.UPDATE)}function d(e){var n={actn:r.ACTION_ADD_MEDIA_CONTENT,albId:e.albId,mdaLst:e.mdaLst,mdaT:e.mdaT};return t.request(n,i.UPDATE)}function g(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId||e.id,utId:e.utId,st:e.st||0};return t.pull(n,i.REQUEST)}function m(e){var n={actn:r.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:e.albId,utId:e.utId,st:e.st||0};t.send(n,i.REQUEST)}function E(e){var n={actn:r.ACTION_DELETE_MEDIA_ALBUM,albId:e};return t.request(n,i.UPDATE)}function f(e){var n={actn:r.ACTION_UPDATE_MEDIA_ALBUM,albId:e.albId,imgURL:e.imgURL,mdaT:e.mdaT,albn:e.albn.utf8Encode()};return t.request(n,i.UPDATE)}function p(e){var n={actn:r.ACTION_ADD_MEDIA_ALBUM,imgURL:e.imgURL||"",albn:e.albn.utf8Encode(),mdaT:e.mdaT};return t.request(n,i.UPDATE)}function T(e){var n={actn:r.ACTION_MEDIA_ALBUM_DETAILS,albId:e};return t.request(n,i.REQUEST)}function h(e){var n={actn:r.ACTION_SPECIFIC_MEDIA_RESULT,schPm:e.sk.utf8Encode(),sugt:e.sugt,pvtid:e.pvtid||0,scl:e.scl||1};return t.send(n,i.REQUEST)}function I(e){var n={actn:r.ACTION_MEDIA_SEARCH_RESULT,schPm:e.utf8Encode()};return t.pull(n,i.REQUEST)}function _(e){return t.pull({actn:r.ACTION_GET_HASHTAG_SUGGESTION,schPm:e.utf8Encode()},i.REQUEST)}function A(e){var n={actn:r.ACTION_MEDIA_ALBUM_LIST,mdaT:e.mdaT||1,utId:e.utId};t.send(n,i.REQUEST,!0)}}angular.module("ringid.shared").factory("Media",MediaFactory),MediaFactory.$inject=["mapFilterFilter","Utils","Ringalert","userFactory","Auth","$routeParams","Storage","OPERATION_TYPES","APP_CONSTANTS","mediaHttpService","$$mediaAlbumMap","$$mediaMap","$$stackedMap","$$q","$$connector"];function MediaFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E){var f,p={albumsLoading:!1,contentsLoading:!1,noresultfound:!1},T=!1,h=g.createNew(),I=g.createNew(),_=g.createNew(),A=g.createNew(),S=g.createNew(),C=0,v=s.SYSTEM.MEDIA,D=s.SYSTEM.REQUEST_TYPE,R=c,M=[],N=[],y=[];function b(e){var t,n,o,a,s;switch(RingLogger.print(e,RingLogger.tags.MEDIA),e.actn){case v.ACTION_MEDIA_ALBUM_LIST:if(e.sucs===!0&&e.mediaAlbumList)for(f=i.currentUser().getUtId()===e.utId?i.currentUser():r.create({utId:e.utId}),o=0,a=e.mediaAlbumList.length;o<a;o++)s=e.mediaAlbumList[o].albId||e.mediaAlbumList[o].id,t=h.get(s)||I.get(s),t?t.updateAlbum(e.mediaAlbumList[o]):t=u.createAlbum(e.mediaAlbumList[o],f),f&&f.isCurrentUser()?h.save(t.getKey(),t):I.save(t.getKey(),t);break;case v.ACTION_MEDIA_ALBUM_CONTENT_LIST:e.sucs===!0&&e.mdaCntntLst&&(n=u.createKey(e),t=h.get(n)||I.get(n),t&&t.pushContent(e.mdaCntntLst))}}function O(e,t){switch(C=e||!!i.currentUser()&&i.currentUser().getUtId(),t){case"audio":l.fetchMediaAlbums({utId:C,mdaT:R.NEWS_FEED_MEDIA_TYPE_AUDIO});break;case"video":setTimeout(function(){l.fetchMediaAlbums({utId:C,mdaT:R.NEWS_FEED_MEDIA_TYPE_VIDEO})},500);break;default:l.fetchMediaAlbums({utId:C,mdaT:R.NEWS_FEED_MEDIA_TYPE_AUDIO}),setTimeout(function(){l.fetchMediaAlbums({utId:C,mdaT:R.NEWS_FEED_MEDIA_TYPE_VIDEO})},500)}}function P(e){var t=parseInt(e,10);return 0!==t&&(h.get(t)||I.get(t)||_.get(t)||!1)}E.subscribe(b,{action:[v.ACTION_MEDIA_ALBUM_LIST,v.ACTION_MEDIA_SEARCH_RESULT]});function L(){return!T&&(T=!0,O(),!0)}function U(e,t){switch(e){case"mediaInAlbums":return E.request({actn:v.ACTION_CHECK_MEDIA_IN_ALBUMS,strmURL:t.strmURL},D.REQUEST);default:return!1}}function F(){I.reset()}function w(t){return t?e(I.all(),{mapApi:"getType",value:t,compare:"regex"}):I}function k(t,n){var r=t?h:I;return t&&!T&&L(),n?e(r.all(),{mapApi:"getType",value:n,compare:"regex"}):r}function $(){return S}function G(){return A}function B(){return N}function H(){N=[]}function x(){return y}function Y(){y=[]}function K(){return M}function j(){return S.reset()}function V(){return A.reset()}function W(){M=[]}function q(e,n){var r,o;n&&(e.id=t.getUniqueID(),o=m.defer());function a(t){RingLogger.print(angular.toJson(t),RingLogger.tags.MEDIA),t.sucs===!0?(r=u.createAlbum(angular.extend(e,{id:t.albId}),i.currentUser()),h.save(r.getKey(),r),o.resolve(r)):(RingLogger.warning("CREATE NEW ALBUM FAILED: "+t.mg,RingLogger.tags.MEDIA),o.reject(!1))}function s(e){RingLogger.warning("CREATE NEW ALBUM FAILED: "+e.mg,RingLogger.tags.MEDIA),o.reject(!1)}return n&&l.addMediaAlbum(e).then(a,s),n?o.promise:r}function z(e){function t(t){RingLogger.print(angular.toJson(t),RingLogger.tags.MEDIA),t.sucs===!0?h.remove(e.getKey()):RingLogger.warn("Delete Album  Failed: "+t.mg,RingLogger.tags.MEDIA)}l.deleteAlbum(e.getId()).then(t)}function Q(){return l.getSearchTrends()}function X(e){l.getTaggedMedia(e)}function Z(e){return l.fetchSearchResult(e)}function J(e){return l.fetchSliderImage(e)}function ee(e){return p.noresultfound=!1,l.fetchContent(e)}return{init:L,state:p,processResponse:b,getAlbum:P,resetMediaAlbums:F,getUserAlbums:w,getAlbums:k,getSearchedSongs:$,getSearchedAlbums:G,getContentIdArray:B,resetContentIdArray:H,getAlbumIdArray:x,resetAlbumIdArray:Y,getSearchedTagArr:K,resetSearchedSongs:j,resetSearchedAlbum:V,resetSearchedTagArr:W,fetchAllAlbums:O,createAlbum:q,deleteAlbum:z,fetchAlbumContents:l.fetchAlbumContents,fetchAlbumContentsForpopup:l.fetchAlbumContentsForpopup,getSearchTrends:Q,getTaggedMedia:X,fetchSearchResult:Z,fetchSliderImage:J,fetchHashtagSuggestion:l.fetchHashtagSuggestion,fetchContent:ee,makeApiCall:U}}angular.module("ringid.shared").factory("EmotionFactory",EmotionFactory),EmotionFactory.$inject=["$$connector","settings","OPERATION_TYPES"];function EmotionFactory(e,t,n){var r={},i=n.SYSTEM,o=0,a={};function s(e){return{id:e.id,title:e.nm,nm:e.nm,url:t.emotionServer+e.url,cat:e.cat}}function c(e){var t;if(e.sucs&&e.mdLst.length)for(t=0;t<e.mdLst.length;t++)r[e.mdLst[t].id]=s(e.mdLst[t]),o++;u()}e.subscribe(c,{action:i.FETCH_EMOTION_LIST});function l(){var e,t=[];for(e in r)r.hasOwnProperty(e)&&t.push(r[e]);return t}function u(){var e,t;for(t in a)a.hasOwnProperty(t)&&(e=a[t],e&&e.$id&&!e.$$destroyed&&e.setEmotion.call(e,l()))}function d(){o?u():e.send({actn:i.FETCH_EMOTION_LIST},i.REQUEST_TYPE.REQUEST)}function g(){return o}function m(e,t){var n=angular.isObject(e)?e.id:e;return t?r[n]?r[n]:!!angular.isObject(e)&&s(e):r[n]||!1}function E(e){a[e.$id]=e}function f(e){a[e.$id]&&(a[e.$id]=null)}return{init:d,getEmotions:l,getLength:g,getEmotion:m,setScopeForDigest:E,removeScope:f}}angular.module("ringid.shared").factory("feedFactory",feedFactory),feedFactory.$inject=["$$connector","$$q","$$stackedMap","$$feedMap","Utils","OPERATION_TYPES","APP_CONSTANTS","Ringalert","Auth","MIN_TIMESTAMP","$rootScope","SystemEvents"];function feedFactory(e,t,n,r,i,o,a,s,c,l,u,d){var g=o.SYSTEM,m=a,E=g.TYPE_NEWS_FEED+".all",f=0,p={},T=[],h=!1,I=[],_={},A={};_[g.TYPE_NEWS_FEED]=ae,_[g.TYPE_MY_NEWS_FEED]=ae,_[g.TYPE_FRIEND_NEWSFEED]=ae,_[g.TYPE_GROUP_NEWS_FEED]=ae,_[g.TYPE_MEDIAS_NEWS_FEED]=ae,_[g.TYPE_NEWS_PORTAL_FEED]=ae,_[g.TYPE_BUSINESS_PAGE_FEED]=ae,_[g.TYPE_UPDATE_ADD_STATUS]=he,_[g.ACTION_UPDATE_SHARE_STATUS]=Te,_[g.TYPE_UPDATE_DELETE_STATUS]=pe,_[g.TYPE_UPDATE_EDIT_STATUS]=fe,_[g.TYPE_UPDATE_LIKE_STATUS]=fe,_[g.TYPE_UPDATE_UNLIKE_STATUS]=fe,_[g.TYPE_UPDATE_ADD_STATUS_COMMENT]=fe,_[g.TYPE_UPDATE_DELETE_STATUS_COMMENT]=fe;function S(e,t){A[e]=t}function C(e){A[e]&&delete A[e]}function v(e){h=!!e}function D(){return h}function R(){return T.length}function M(){var e=P();return g.TYPE_NEWS_FEED===e.action&&p.special&&p.special.length()>0}function N(){return p.special&&p.special.all()}return{init:U,addScope:S,removeScope:C,getFeed:_e,updateTime:L,pushFeed:ae,processIncomingFeed:se,setpushInIncomingFeed:v,getPushIncomingFeed:D,hasUnprocessedFeed:R,addIgnoreFilter:Ae,removeIgnoreFilter:Se,setFactoryKey:Ce,createFeed:$,process:ve,getFeedFilter:De,noMoreFeed:Ne,requestForFeed:ye,initFeedRequest:be,getSingleFeed:Pe,requestForMoreFeed:Oe,getRawFeeds:Re,getFeeds:Me,addFeed:Le,shareFeed:Ue,deleteFeed:Fe,saveFeed:we,updateFeed:ke,reset:F,moreFeedText:$e,getSingleFeedPageKey:Be,getWhoShareFeedId:He,getTagUsers:Ge,setSortBy:y,getCurrentPageValue:P,hasSpecialFeed:M,getSpecialFeedList:N,synchLike:me,synchComment:Ee,getPortalFeedDetails:xe};function y(e){r.setSortKey(e)}function b(){return p.hasOwnProperty(E)?p[E].data:n.createNew()}function O(){return p.hasOwnProperty(E)?p[E].removed:n.createNew()}function P(){var e=[];try{e=E.split(".",3)}catch(e){return!1}return!(e.length<2)&&{action:parseInt(e[0],10),page:e[1],ptype:e[2]}}function L(){var e,t,n=b();for(e=0;e<n.length();e++)t=Date.now()-n.all()[e].value.getTimestamp(),t<36e5&&n.all()[e].value.updateTime()}function U(e){var t=b();return t.length()<10&&(ye(e),!0)}function F(){b().reset(),O().reset(),T.length=0}function w(){var e,t=r.getSortIndex(),n=b();return"tm"===t?n.length()?n.top().getTimestamp():l:e=n.length()?n.top().getAtTime():l}function k(){var e,t=r.getSortIndex(),n=b();return"tm"===t?n.length()?n.bottom().getTimestamp():Date.now():e=n.length()?n.bottom().getAtTime():Date.now()}function $(e,t){return r.create(e,t)}function G(){return!0}function B(e,t){var n=parseInt(t.page,10);return e.nfId===n||e.whShrLst&&e.whShrLst[0].nfId===n}function H(e,t){return e.grpId===parseInt(t.page,10)}function x(e,t,n){return t.action===n}function Y(e,t,n){return t.action===n&&3===e.spType}function K(e,t){var n=t||P();return!!(n.page===e.uId||e.fndId&&n.page===e.fndId)}function j(e,t,n){return t.action===n&&4===e.spType}function V(e,t){var n=t||P();return!!(n.page===e.uId||e.fndId&&n.page===e.fndId)}function W(e,t){var n=t||P();return!!(n.page===e.uId||e.fndId&&n.page===e.fndId)||!(!e.orgFd||n.page!==e.orgFd.uId)}function q(e){z(e)}function z(e){re(e,W,{processWhoShare:function(e,t,n){var r,i;e.uId===n.page&&e.orgFd&&(i=$(e.orgFd),r=$(e),r.shares(i),t.save(r.getMapKey(),r))}})}function Q(e){re(e,K)}function X(e){re(e,H)}function Z(e){re(e,x)}function J(e){re(e,Y)}function ee(e){re(e,j)}function te(e){re(e,G)}function ne(e){var t;p.special||(p.special=n.createNew(r.getSortIndex(),"desc")),t=$(e),p.special.save(t.getMapKey(),t)}function re(e,t,n){var i,o,a,s,c,l=n||{},u=t||function(){return!1},d=angular.isArray(e)?e:e.newsFeedList,g=P(),m=b();if(angular.isArray(d))for(s=0;s<d.length;s++)a=d[s],c=a.nfId,0===f?f=c:c<f&&(f=c),1!==a.fc?u(a,g,e.actn)&&(a.deleted?m.remove(r.makeKey(a.nfId)):a.whShrLst||a.orgFd?l.processWhoShare&&angular.isFunction(l.processWhoShare)?l.processWhoShare.call(null,a,m,g):(a.orgFd?(i=$(a),(o=ue(a.orgFd.nfId))||(o=$(a.orgFd))):(i=$(a.whShrLst[0]),(o=ue(a.nfId))||(o=$(a))),i.shares(o),m.save(i.getMapKey(),i),ce(o,i.getKey())):(i=$(a),m.save(i.getMapKey(),i))):ne(d[s])}function ie(e){re(e,B)}function oe(e){var t=e||P();switch(t.action){case g.TYPE_MY_NEWS_FEED:case g.TYPE_FRIEND_NEWSFEED:return 3===t.ptype?K:4===t.ptype?V:W;case g.TYPE_GROUP_NEWS_FEED:return H;case g.TYPE_MEDIAS_NEWS_FEED:return x;case g.TYPE_NEWS_PORTAL_FEED:return Y;case g.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:return B;case g.TYPE_BUSINESS_PAGE_FEED:return j;case g.TYPE_NEWS_FEED:default:return G}}function ae(e){var t=P();switch(t.action){case g.TYPE_MY_NEWS_FEED:z(e);break;case g.TYPE_FRIEND_NEWSFEED:3===t.ptype?Q(e):q(e);break;case g.TYPE_GROUP_NEWS_FEED:X(e);break;case g.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:ie(e);break;case g.TYPE_NEWS_FEED:te(e);break;case g.TYPE_MEDIAS_NEWS_FEED:Z(e);break;case g.TYPE_NEWS_PORTAL_FEED:J(e);break;case g.TYPE_BUSINESS_PAGE_FEED:ee(e)}}function se(){for(var e;T.length&&h;)e=T.shift(),e.callback?e.callback.call(null,e,!0):ae([e])}function ce(e,t,n){var r=n||O();e.reference=t,r.save(e.getMapKey(),e)}function le(e,t){var n=t||O(),i=r.makeKey(e);return n.get(i)}function ue(e){var t=b(),n=r.makeKey(e);return t.get(n)}function de(e){var t=b();t.add(e.getMapKey(),e)}function ge(e,t){var n=t||b();return n.remove(r.makeKey(e))}function me(e,t,n){var r=_e(e);return!(!r||!r.isSingleContentFeed())&&(r.setTotalLikes(n,t),A[e])}function Ee(e,t,n){var r=A[e];return!(!r||!r.feed.isSingleContentFeed())&&(r.feed.setTotalComment(t,n),r)}function fe(e){var t=ue(e.nfId),n=A[e.nfId];if(!t||!n)return!1;switch(e.actn){case g.TYPE_UPDATE_EDIT_STATUS:t.update(e);break;case g.TYPE_UPDATE_LIKE_STATUS:case g.TYPE_UPDATE_UNLIKE_STATUS:t.setTotalLikes(e.loc),t.setFeedTopMessage();break;case g.TYPE_UPDATE_ADD_STATUS_COMMENT:case g.TYPE_UPDATE_DELETE_STATUS_COMMENT:t.setTotalComment(e.loc),t.setFeedTopMessage()}return n}function pe(e){ge(e.nfId)}function Te(e,t,n,r){var i,o,a,s=oe();if(h&&!t)return e.callback=Te,s.call(null,e.newsFeed)&&T.push(e),!1;if(i=e.newsFeed.orgFd&&e.newsFeed.orgFd.nfId,!i)return!1;if(o=ue(i),a=O(),o){if(n)return o.setActivity(e.newsFeed.orgFd),A[o.getKey()];ce(o,e.newsFeed.nfId,a),ge(o.getKey())}else if(o=le(i,a))return re([e.newsFeed],s,{processWhoShare:function(e,t,i){var a,s=ue(o.reference);return s?parseInt(i.page,10)!==g.TYPE_FRIEND_NEWSFEED&&parseInt(i.page,10)!==g.TYPE_MY_NEWS_FEED&&(o.update(e,!0),n?(o.addShareUser(r),s.updateShareMessage(),s.setActivity(e),A[s.getKey()]):(a=$(e),a.setActivity(e.orgFd),ge(o.reference),a.shares(o),t.save(a.getMapKey(),a),!1)):(ae([e]),!1)}}),!1;return ae([e.newsFeed])}function he(e){var t=oe();e.imageList||1!==e.type||(e.imageList=[e]),h?t.call(null,e,P())&&T.push(e):ae([e])}function Ie(e){var t,n=!1,r=angular.isArray(e)?e[0]:e;if(I.length)for(t=0;t<I.length;t++)I[t].action===r.actn&&(n=I[t].callback.call(null,r));return!(!_[r.actn]||n)&&_[r.actn].call(null,r)}function _e(e){return ue(e)}function Ae(e,t){var n=i.getUniqueID();return I.push({key:n,action:e,callback:t}),n}function Se(e){var t,n=-1;for(t=0;t<I.length;t++)I[t].key===e&&(n=t);return n!==-1?I.splice(n,1):[]}function Ce(e){E=e,p.hasOwnProperty(E)||(p[E]={data:n.createNew(r.getSortIndex(),"desc"),removed:n.createNew(),no_more_feed:!1})}function ve(e){return Ie(e)}function De(){return function(e){return!!_[e.actn]}}function Re(){return b().all()}function Me(){var e=b();return e.all()}function Ne(){return!!p.hasOwnProperty(E)&&p[E].no_more_feed}function ye(t){var n=m.FEED_LIMIT,r=angular.copy(t||{});switch(r.pvtid=f||0,r.st=Me().length||0,i.feedColumn()){case 1:n=5;break;case 2:n=6;break;case 3:n=9;break;default:n=5}return r.lmt=r.lmt||n,e.send(r,g.REQUEST_TYPE.REQUEST)}function be(e){var t=angular.copy(e||{});t.scl=2,t.tm=0,ye(t)}function Oe(e,t){var n=w(),r=angular.copy(e||{});return r.scl=t||2,r.tm=n||l,ye(r)}function Pe(n,r){var i={actn:g.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n},o=t.defer(),a=_e(n);return a?o.resolve(a):e.request(i,g.REQUEST_TYPE.REQUEST).then(function(e){var t,n,i;e.sucs===!0?(t=angular.isArray(e)?e:e.newsFeedList[0],r&&t.orgFd?t.orgFd&&(a=$(t),i=$(t.orgFd),a.shares(i)):a=$(t),a&&(n=b(),n.save(a.getMapKey(),a)),o.resolve(a)):o.resolve(!1)},function(e){o.reject(e)}),o.promise}function Le(n,r,o){var a,c,l,E,f=t.defer(),p=0,T=b(),h=n,I=i.getUniqueID(),_="";if(h.stsTags=[],h.text&&(_=h.text.replace(/##([\d]+)##/g,function(e,t,n){var r;return r=n-p,h.stsTags.push({pstn:r,utId:t}),p+=e.length,""}),h.text=_),o?a=h.feed?h.feed:_e(h.nfId):(a=$({nfId:I,fpvc:h.fpvc,sts:h.text,lat:h.lat||9999,lng:h.lng||9999,tm:k()+2,grpId:h.group||"",friendId:h.friend||"",fndId:h.friend||"",mdLst:h.mdIds||[],isNew:1,pending:!0,lctn:h.lctn||"",lnkDmn:h.lnkDmn||"",lnkDsc:h.lnkDsc||"",lnkTtl:h.lnkTtl||"",lnkURL:h.lnkURL||"",lnlImgURL:h.lnlImgURL||""},r),T.save(a.getMapKey(),a)),c={},h.cntntIDLst&&(c.cntntIDLst=h.cntntIDLst),h.group&&(c.grpId=h.group),h.friend&&(c.fndId=parseInt(h.friend,10)),h.lctn&&(c.lctn=h.lctn.utf8Encode()),h.lnkDmn&&(c.lnkDmn=h.lnkDmn.utf8Encode()),h.lnkDsc&&(c.lnkDsc=h.lnkDsc.utf8Encode()),h.lnkTtl&&(c.lnkTtl=h.lnkTtl.utf8Encode()),h.lnkURL&&(c.lnkURL=h.lnkURL.utf8Encode()),h.lnlImgURL&&(c.lnlImgURL=h.lnlImgURL.utf8Encode()),h.stsTags.length&&(c.stsTags=h.stsTags),c.actn=g.TYPE_ADD_STATUS,h.images&&h.images.length>0)if(1===h.images.length)c.type=g.NEWS_FEED_TYPE_IMAGE,c=angular.extend({},c,h.images[0].getAuthData());else for(c.actn=g.TYPE_ADD_MULTI_IMAGE,c.type=g.NEWS_FEED_TYPE_MULTIPLE_IMAGE,c.imageList=[],l=0,E=h.images.length;l<E;l++)c.imageList.push(h.images[l].getAuthData());else if(h.videos&&h.videos.length>0)for(c.mdaCntntDTO={albId:h.albId,htgLst:h.htgLst,mdaLst:[],mdaT:m.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:m.NEWS_FEED_MEDIA_TYPE_VIDEO},c.type=g.NEWS_FEED_TYPE_VIDEO,l=0,E=h.videos.length;l<E;l++)c.mdaCntntDTO.mdaLst.push(h.videos[l].getAuthData(!0));else if(h.audios&&h.audios.length>0)for(c.mdaCntntDTO={albId:h.albId,htgLst:h.htgLst,mdaLst:[],mdaT:m.NEWS_FEED_MEDIA_TYPE_AUDIO,lnkT:m.NEWS_FEED_MEDIA_TYPE_AUDIO},c.type=g.NEWS_FEED_TYPE_AUDIO,l=0,E=h.audios.length;l<E;l++)c.mdaCntntDTO.mdaLst.push(h.audios[l].getAuthData(!0));else c.actn=g.TYPE_ADD_STATUS,o?c.type=h.audio?g.NEWS_FEED_TYPE_AUDIO:g.NEWS_FEED_TYPE_VIDEO:c.type=g.NEWS_FEED_TYPE_STATUS;return h.mdIds&&(c.mdIds=h.mdIds),h.tFrndIds&&(c.tFrndIds=h.tFrndIds),c.vldt=h.vldt||"-1",c.lng=h.lng||9999,c.lat=h.lat||9999,c.sts=h.text.utf8Encode(),c.fpvc=h.fpvc||2,e.request(c,g.REQUEST_TYPE.UPDATE).then(function(e){u.$broadcast(d.FILE_UPLOAD.UPLOADS_POSTED),e.sucs?(o?a&&a.share(e.mdaCntntLst[0].is,e.mdaCntntLst[0].ns):(T.remove(a.getMapKey()),e.type===g.TYPE_SINGLE_IMAGE_STATUS&&(e.imageList=[e]),ae([e])),f.resolve(e)):(o||(T.remove(a.getMapKey()),s.show(e,"error")),f.reject(e))},function(e){o||(T.remove(a.getMapKey()),s.show(e,"error")),f.reject(e)}),f.promise}function Ue(n){var r,i;return n.addShare?Le(n,n.user,!0):(r=t.defer(),i={actn:g.ACTION_SHARE_STATUS,sfId:n.feed.getKey(),type:2,sts:n.text.utf8Encode()},n.mdIds&&(i.mdIds=n.mdIds),n.tFrndIds&&(i.tFrndIds=n.tFrndIds),n.location&&(n.location.description&&(i.lctn=n.location.description.utf8Encode()),n.location.lat&&(i.lat=n.location.lat,i.lng=n.location.lng)),e.request(i,g.REQUEST_TYPE.UPDATE).then(function(e){e.sucs?(Te(e,!0,!0,c.currentUser()),n.feed.share(!0),r.resolve(e)):r.reject(e)},function(e){r.reject(e)}),r.promise)}function Fe(n,r){var i=t.defer(),o=ue(r),a=b();return o?(o.user().isCurrentUser(n.getKey())||setTimeout(function(){i.reject("You are not authorized to delete this feed.")},100),ge(o.getKey(),a),e.request({actn:g.TYPE_DELETE_STATUS,nfId:r},g.REQUEST_TYPE.UPDATE).then(function(e){e.sucs?i.resolve(e):(de(o),i.reject(e))},function(e){de(o),i.reject(e)}),i.promise):(setTimeout(function(){i.reject("Can't Delete Invalid Feed")}),i.promise)}function we(t,n,r){var i={actn:g.PORTAL.ACTION_SAVE_UNSAVE_NEWSPORTAL_FEED,optn:n,pType:r,feedIdList:[t]};return e.request(i,g.REQUEST_TYPE.UPDATE)}function ke(n,r,i,o,a,s,c){var l,u,d,m,E,f,p,T,h,I=r,_=i,A=0,S=o,C=[];return angular.isObject(I)||(I=ue(u)),!(!I||!I.user().isCurrentUser(n.getKey()))&&(l=t.defer(),u=I.getKey(),f=I.text(),p=I.getLocationInfo(),T=I.getFeelings(),_&&(_=_.replace(/##([\d]+)##/g,function(e,t,n){var r;return r=n-A,C.push({pstn:r,utId:t}),A+=e.length,""})),d={actn:g.TYPE_EDIT_STATUS,nfId:u,sts:_.utf8Encode()},C.length&&(d.stsTags=C),S=S||{},d.lctn=S.description?S.description.utf8Encode():"",d.lat=S.lat||9999,d.lng=S.lng||9999,m=a&&(!I.hasOgData()||I.getLinkUrl()!==a.url||I.getLinkImageUrl()!==a.image),m&&(d.lnkDmn=a.domain||"",d.lnkDsc=a.description?a.description.utf8Encode():"",d.lnkTtl=a.title?a.title.utf8Encode():"",d.lnkURL=a.url?a.url.utf8Encode():"",d.lnlImgURL=a.image||"",h=I.getOgData()),E=!1,s&&s.id?(d.mdIds=[s.id],E=!0):(d.mdIds=[],E=!0),c&&(c.removed&&(d.rTFrndIds=c.removed),c.new&&(d.tFrndIds=c.new)),I!==!1&&(I.setText(_,C),I.setLocationInfo(S),E&&I.setFeelings(s),m&&I.setOgData(a),e.request(d,g.REQUEST_TYPE.UPDATE).then(function(e){e.sucs===!1?(I.setText(f),I.setLocationInfo(p),E&&I.setFeelings(T),m&&I.setOgData(h),l.reject(e)):l.resolve(e)},function(e){I.setText(f),I.setLocationInfo(p),E&&I.setFeelings(T),m&&I.setOgData(h),l.reject(e)})),l.promise)}function $e(n){var r=t.defer(),i={actn:g.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n.getKey()};return e.request(i,g.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?r.resolve(e):(s.show(e,"error"),r.reject())},function(e){s.show(e,"error"),r.reject()}),r.promise}function Ge(t){return e.pull({actn:g.TYPE_TAG_USER_LIST,nfId:t.getKey()},g.REQUEST_TYPE.REQUEST)}function Be(e){return g.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS+"."+e}function He(e){var t=angular.isArray(e)?e:e.newsFeedList;return!!(t.length>0&&t[0].whShrLst[0])&&t[0].whShrLst[0].nfId}function xe(n){var r,i,o;return r={actn:g.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:n},i=t.defer(),e.request(r,g.REQUEST_TYPE.REQUEST).then(function(e){e.sucs===!0?(o=e.newsFeedList[0],i.resolve(o)):i.resolve(!1)},function(e){i.reject(e)}),i.promise}}angular.module("ringid.shared").factory("InviteFactory",InviteFactory),InviteFactory.$inject=["$$connector","OPERATION_TYPES","userFactory","Storage","friendsFactory","$$stackedMap","$$q"];function InviteFactory(e,t,n,r,i,o,a){var s,c=[],l=!1,u=t.SYSTEM.FRIENDS,d=t.SYSTEM.REQUEST_TYPE,g={init:T,state:{isRequestsLoading:!1},suggestionFriends:o.createNew(),getSuggestionContactsDetails:f,removeSuggestion:p,allSuggestionFriends:o.createNew(),noOfSuggestions:function(){return g.suggestionFriends.length()}};function m(e){var t;switch(e.actn){case u.TYPE_PEOPLE_YOU_MAY_KNOW:if(e.sucs===!0){for(t=0;t<e.contactIds.length;t++)c.push(e.contactIds[t]);f()}else e.sucs===!1&&1111===e.rc?(RingLogger.warning("SUGGESTION UTID LIST FETCH REPEAT",RingLogger.tags.INVITE),E()):RingLogger.warning("SUGGESTION UTID LIST FETCH FAIL",RingLogger.tags.INVITE);break;case u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:if(g.state.isRequestsLoading=!1,e.sucs===!0)for(t=0;t<e.contactList.length;t++)c.splice(c.indexOf(e.contactList[t].utId),1),s=n.create(e.contactList[t]),s.isFriend()||g.suggestionFriends.save(s.getUtId(),s);else e.sucs===!1&&1111===e.rc?(RingLogger.warning("SUGGESTION DETAILS FETCH REPEAT",RingLogger.tags.INVITE),f()):RingLogger.warning("SUGGESTION DETAILS LIST FETCH FAIL",RingLogger.tags.INVITE);break;default:RingLogger.print("MISSING CASE",RingLogger.tags.INVITE)}}function E(){return e.send({actn:u.TYPE_PEOPLE_YOU_MAY_KNOW},d.REQUEST)}function f(t){var n=t||10;return!g.state.isRequestsLoading&&(g.state.isRequestsLoading=!0,e.send({actn:u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:c.slice(0,n)},d.REQUEST))}function p(t,n){var r=a.defer(),o={actn:33,utId:t};function s(e){e.sucs===!0&&("remove"!==n&&i.addToUtIdList("outgoingUtIds",e.utId),g.suggestionFriends.remove(t),g.suggestionFriends.length()<5&&f(),r.resolve(e))}function c(e){r.reject(e)}return e.request(o,d.REQUEST).then(s,c),r.promise}function T(t){l||e.subscribe(m,{action:[u.TYPE_PEOPLE_YOU_MAY_KNOW,u.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),l&&!t||(l=!0,E())}return g}angular.module("ringid.shared").directive("rgAudio",rgAudio);function rgAudio(){return{restrict:"E",templateUrl:"templates/partials/news_feed/rg-audio.directive.html",scope:{feed:"=",getMediaData:"&",selectAlbum:"&",noDownload:"&",getAudioFirstData:"&"},link:function(e){e.$rgDigest()}}}angular.module("ringid.shared").directive("rgVideo",rgVideo);function rgVideo(){return{restrict:"E",templateUrl:"templates/partials/news_feed/rg-video.directive.html",scope:{feed:"=",getMediaData:"&",selectAlbum:"&",noDownload:"&",
getMediaFirstData:"&"},link:function(e){e.$rgDigest()}}}angular.module("ringid.shared").service("rgSelectorService",selectorService).directive("rgSelector",selector),selectorService.$inject=["GlobalEvents"];function selectorService(e){var t=this,n=!1,r=!1;t.close=o,t.open=i;function i(i,o){r||(r=i,n=o,n.dropdownOpen=!0,n.$rgDigest(),r.style.display="block",e.bindHandler("document","click",t.close),RingLogger.print("rgSelector Dropdown Open",RingLogger.tags.DROPDOWN))}function o(){RingLogger.information("rgSelector Dropdown Close",RingLogger.tags.DROPDOWN),r&&(r.style.display="none",n.resetTag(),n.dropdownOpen=!1,n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))}}selector.$inject=["$compile","fileUploadService","Media","rgSelectorService","SystemEvents","$rootScope","rgScrollbarService"];function selector(e,t,n,r,i,o,a){function s(e,t){var n,o,s,c;e.dropdownOpen=!1,e.selectedIndex=-1,e.itemList=[],e.filterText="",c=t[0].parentNode.querySelector("input#select-item"),s=t[0].parentNode.querySelector("div#items-dropdown"),c.addEventListener("keyup",E),c.addEventListener("click",d),e.resetTag=l;function l(){e.selectedIndex=-1,e.filterText="",e.$rgDigest()}e.$on(i.FILE_UPLOAD.UPLOADS_POSTED,function(){e.resetTag(!0)});function u(t){t?e.selectedIndex=e.selectedIndex<=0?0:e.selectedIndex-1:e.selectedIndex=e.selectedIndex+1>=e.itemList.length?e.itemList.length-1:e.selectedIndex+1,e.selectedIndex>=0&&(e.filterText=e.itemList[e.selectedIndex]),RingLogger.information("MOVED TO SELECTION: "+e.selectedIndex,RingLogger.tags.MEDIA),RingLogger.information("scroll to : "+e.selectedIndex/e.itemList.length*100,RingLogger.tags.MEDIA),a.scrollTo(e,e.selectedIndex/e.itemList.length*100),e.$rgDigest()}function d(e){e.stopPropagation(),f(!0)}function g(t){Boolean(t)?(e.loading=!1,e.filterText="",r.close()):Boolean(e.dropdownOpen)||r.open(s,e),e.$rgDigest()}function m(t){var n=e.filterText;t.preventDefault(),n.length>0&&(e.selectedIndex>-1?(e.selectItem()(e.itemList[e.selectedIndex],t),e.filterText=""):(e.selectItem()(n,t),e.filterText=""),e.$rgDigest())}function E(t){var r=t.keyCode||t.which,i=e.filterText;38===r&&i.length>0?u(!0):40===r&&i.length>0?u(!1):27===r||13===r||10===r?(RingLogger.information("ENTER pressed. add HashTag",RingLogger.tags.MEDIA),"true"===e.selectAny?m(t):t.preventDefault()):i.length>0?(RingLogger.information("Search Param :"+i,RingLogger.tags.MEDIA),n=setTimeout(f,200)):0===i.length&&RingLogger.information("Search Param empty",RingLogger.tags.MEDIA),e.$rgDigest()}function f(t){var r=e.filterText;clearTimeout(n),(t||r!==o)&&(e.loading=!0,g(),o=r,e.fetchItems()(r).then(function(t){RingLogger.print(t,RingLogger.tags.DROPDOWN),e.loading=!1,t.length>0&&(e.itemList=t),e.$rgDigest()},function(){e.loading=!1,g(!0),e.$rgDigest()}),e.$rgDigest())}e.$on("$destroy",function(){c.removeEventListener("keyup",E),c.removeEventListener("click",d)})}c.$inject=["$element","$attrs"];function c(e,t){return t.templateUrl}return{restrict:"E",link:s,scope:{initItems:"@",selectAny:"@",templateUrl:"@",selectedItems:"=",fetchItems:"&",selectItem:"&",removeItem:"&"},templateUrl:c}}angular.module("ringid.shared").factory("CommentHttpService",CommentHttpService).controller("CommentsController",CommentsController).directive("rgComments",rgComments).directive("rgImageComments",rgImageComments),CommentHttpService.$inject=["$$connector","OPERATION_TYPES"];function CommentHttpService(e,t){var n,r=t.SYSTEM;n={getComment:i,getComments:o,addComment:a,updateComment:s,deleteComment:c,getUpdateFilter:l};function i(t){var n={};switch(t.type){case"feed":n.cmntT=1,n.nfId=t.key;break;case"image":n.cmntT=2,n.imgId=t.key;break;case"media":n.cmntT=3,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.actn=r.ACTION_GET_FULL_COMMENT,n.cmnId=t.commentId,e.request(n,r.REQUEST_TYPE.REQUEST)}function o(t,n,i){var o={};if(!t.key||!t.type)throw new Error("key and type must needed for fetcing comment");switch(t.type){case"feed":o.actn=r.TYPE_COMMENTS_FOR_STATUS,o.nfId=t.key;break;case"image":o.actn=r.IMAGE.TYPE_COMMENTS_FOR_IMAGE,o.imgId=t.key,t.target.getFeedKey()&&(o.nfId=t.target.getFeedKey());break;case"media":o.actn=r.MEDIA.ACTION_MEDIA_COMMENT_LIST,o.cntntId=t.key,t.target.getFeedKey()&&(o.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n?(o.scl=i?i:1,o.tm=n):o.st=t.st||0,e.pull(o,r.REQUEST_TYPE.REQUEST,!0)}function a(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_ADD_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_ADD_IMAGE_COMMENT,n.imgId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;case"media":n.actn=r.MEDIA.ACTION_ADD_COMMENT_ON_MEDIA,n.cntntId=t.key,t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return n.cmn=t.text.utf8Encode(),e.request(n,r.REQUEST_TYPE.UPDATE,!0)}function s(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_EDIT_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_EDIT_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_EDIT_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,n.cmn=t.text.utf8Encode(),e.request(n,r.REQUEST_TYPE.UPDATE)}function c(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_DELETE_STATUS_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_DELETE_IMAGE_COMMENT,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_DELETE_COMMENT_ON_MEDIA,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return n.cmnId=t.commentId,e.request(n,r.REQUEST_TYPE.UPDATE,!0)}function l(e,t){var n,i,o=[r.TYPE_UPDATE_ADD_STATUS_COMMENT,r.TYPE_UPDATE_LIKE_COMMENT,r.TYPE_UPDATE_UNLIKE_COMMENT,r.TYPE_UPDATE_DELETE_STATUS_COMMENT,r.TYPE_UPDATE_EDIT_STATUS_COMMENT],a=[r.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT,r.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT],s=[r.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT,r.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT];switch(e){case"feed":n=o,i="nfId";break;case"image":n=a,i="imgId";break;case"media":n=s,i="cntntId";break;default:return[1111111]}return function(e){return n.indexOf(e.actn)!==-1&&e[i]===t}}return n}CommentsController.$inject=["$scope","$$connector","Ringalert","Utils","CommentHttpService","Auth","$$stackedMap","$$commentMap","rgDropdownService","OPERATION_TYPES","rgScrollbarService","feedFactory","SystemEvents"];function CommentsController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E,f=l.SYSTEM,p=!1;e.comments=a.createNew(!0,"asc"),e.loadingComment=!1,e.canComment=!0,e.commentEditorEnabled=!1,e.commentKey="",e.commenttext="",e.ddCommentHtml="templates/dropdowns/comment-edit-dropdown.html",e.previousComment=!!e.target.getTotalComment(),e.afterComment=!0,e.models={commentedittext:""},e.currentUser=o.currentUser(),e.openRingboxLike=function(e){return e.getTotalLikes()>0},e.loadMoreComment=C,e.loadPreviousComment=A,e.addComment=N,e.updateComment=y,"feed"===e.commentType&&e.target.isSingleContentFeed()?(e.target.getMedias().length()||e.target.getAudios().length()?e.likeType="media":e.target.getImages(!0).length()&&(e.likeType="image"),e.parentKey=e.target.getSingleContent().getKey()):(e.likeType=e.commentType,e.parentKey=e.target.getKey()),e.hideScroll=!!e.hideScroll&&"false"!==e.hideScroll,e.showPreviousButton=function(){return e.target.getTotalComment()>e.comments.length()&&e.previousComment&&!e.loadingComment},e.showMoreButton=function(){return e.target.getTotalComment()>e.comments.length()&&e.afterComment&&!e.loadingComment},e.cancelEdit=function(){e.commentEditorEnabled=!1,T()},e.commentContentEdit=function(e){return function(){return e.getDynamicText()}},e.actionCommentDropdown=function(e){switch(c.close(e.event),e.action){case"edit":h(e.commentMap.getKey(),e.commentMap.text());break;case"delete":b(e.commentMap)}};function T(){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}function h(t,n){t&&(e.commentEditorEnabled=!0,e.commentKey=t,e.models.commentedittext=n,T())}function I(t){e.loadingComment=t,E&&(window.clearTimeout(E),E=void 0)}function _(){m=t.subscribe(function(t){var n;switch(t.actn){case f.TYPE_UPDATE_ADD_STATUS_COMMENT:case f.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT:case f.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT:M({comments:[t]});break;case f.TYPE_UPDATE_EDIT_STATUS_COMMENT:case f.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT:case f.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT:n=e.comments.get(t.cmnId),n&&n.setComment(t.cmn);break;case f.TYPE_UPDATE_LIKE_COMMENT:case f.TYPE_UPDATE_UNLIKE_COMMENT:case f.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:case f.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:n=e.comments.get(t.cmnId),n&&n.incomingLike(t.loc);break;case f.TYPE_UPDATE_DELETE_STATUS_COMMENT:case f.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT:case f.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT:e.comments.remove(t.cmnId)}T()},{filter:i.getUpdateFilter(e.commentType,e.target.getKey())}),e.$on("$destroy",function(){m&&t.unsubscribe(m),m=!1})}function A(t){var n,r=!1;e.comments.length()&&(n=e.comments.getByIndex(0),r=n.getTimestamp()),R(r,2,t)}function S(t){t.comments&&(t.comments.length>5&&e.target.getTotalComment()>e.comments.length()+t.comments.length?(t.comments.sort(function(e,t){return e.tm>t.tm?1:-1}),t.comments.splice(0,1),M({comments:t.comments}),e.previousComment=!0):(e.previousComment=!1,M(t)))}function C(){var t,n=!1;parseInt(e.activeCommentId,10)>0&&e.comments.length()&&(t=e.comments.getByIndex(e.comments.length()-1),n=t.getTimestamp()),R(n,1)}function v(t){t.comments&&(t.comments.length>5&&e.target.getTotalComment()>e.comments.length()+t.comments.length?(t.comments.sort(function(e,t){return e.tm<t.tm?1:-1}),t.comments.splice(0,1),M({comments:t.comments}),e.afterComment=!0):(e.afterComment=!1,M(t)))}function D(){var t,n;parseInt(e.activeCommentId,10)>0?(t=e.commentType,n=e.target,"feed"===e.commentType&&e.target.isSingleContentFeed()&&(n=e.target.getSingleContent(),t=e.target.getContentType()),i.getComment({key:n.getKey(),type:t,commentId:parseInt(e.activeCommentId,10)}).then(function(t){t.sucs?(M({comments:[t.cmntDTO]}),C(),setTimeout(function(){A(!0)},500)):(e.activeCommentId=0,R()),T()},function(){R()})):(R(),e.afterComment=!1)}function R(t,n,r){var o,a;return e.target.getTotalComment()&&(2!==n||e.showPreviousButton())&&(1!==n||e.showMoreButton())||r?(I(!0),o=e.commentType,a=e.target,"feed"===e.commentType&&e.target.isSingleContentFeed()&&(a=e.target.getSingleContent(),o=e.target.getContentType()),E=setTimeout(I.bind(e,!1),3e3),i.getComments({key:a.getKey(),type:o,st:e.comments.length(),target:a},t,n).then(function(t){t.sucs&&(parseInt(e.activeCommentId,10)?2===n?S(t):v(t):M(t)),I(!1),T(),e.$emit(g.RINGBOX.UPDATE)}),void T()):void RingLogger.print("fetched all comments or already loading or no comments","rgcomments")}function M(t){var n,r;for(r=0;r<t.comments.length;r++)n=s.create(t.comments[r]),e.comments.save(n.getKey(),n)}function N(){var t,o,a=e.commenttext,c=e.target,l=e.commentType;e.canComment=!1,O()&&(t=r.getUniqueID(),o={cmnId:t,cmn:a,deleted:!1,isNew:!0,edited:!1,pending:!0},"feed"===e.commentType&&e.target.isSingleContentFeed()&&(c=e.target.getSingleContent(),l=e.target.getContentType()),e.comments.add(t,s.create(o,e.currentUser)),i.addComment({key:c.getKey(),type:l,text:a,target:c}).then(function(r){var i,l;r.sucs===!0?(e.comments.remove(t),o.cmnId=r.cmnId,o.pending=!1,angular.extend(r,o),i=s.create(r,e.currentUser),e.comments.add(i.getKey(),i),e.target.setTotalComment(r.loc,1),"feed"===e.commentType&&e.target.isSingleContentFeed()?c.setTotalComment(r.loc,1):"feed"!==e.commentType&&(l=d.synchComment(e.target.getFeedKey(),r.loc,1),l&&l.$rgDigest()),e.canComment=!0,e.commenttext="",T(),u.scrollTo(e,".com-"+i.getKey()),u.recalculate(e),e.$emit(g.RINGBOX.UPDATE)):(e.comments.remove(t),e.canComment=!0,n.show(r,"error"),e.commenttext=a,T())},function(r){e.comments.remove(t),e.canComment=!0,n.show(r,"error"),e.commenttext=a,T()}),u.scrollTo(e,".com-"+t),u.recalculate(e))}function y(t){var r,o,a,s;return t.user().isCurrentUser()?(r=e.models.commentedittext.trim(),o=e.commentType,a=e.target,s=t.text(),t.setComment(r),t.isPending(!0),"feed"===e.commentType&&e.target.isSingleContentFeed()&&(a=e.target.getSingleContent(),o=e.target.getContentType()),""!==r?(i.updateComment({key:a.getKey(),type:o,commentId:t.getKey(),text:e.models.commentedittext}).then(function(r){r.sucs||(t.setComment(s),n.show(r,"error")),t.isPending(!1),e.models.commentedittext="",T(),e.$emit(g.RINGBOX.UPDATE)},function(e){t.setComment(s),n.show(e,"error"),T()}),e.commentEditorEnabled=!1):n.show("Please write something","error"),void T()):void(e.commentEditorEnabled=!1)}function b(t){var r=e.commentType,o=e.target;t.isPending(!0),"feed"===e.commentType&&e.target.isSingleContentFeed()&&(o=e.target.getSingleContent(),r=e.target.getContentType()),i.deleteComment({key:o.getKey(),type:r,commentId:t.getKey()}).then(function(r){var i;r.sucs?(e.comments.remove(r.cmnId),e.target.setTotalComment(r.loc,r.ic),"feed"===e.commentType&&e.target.isSingleContentFeed()?o.setTotalComment(r.loc,r.ic):"feed"!==e.commentType&&(i=d.synchComment(e.target.getFeedKey(),r.loc,r.ic),i&&i.$rgDigest())):(t.isPending(!1),n.show(r,"error")),T(),e.$emit(g.RINGBOX.UPDATE)},function(e){t.isPending(!1),n.show(e,"error"),T()}),T()}function O(){return e.commenttext.length<1?(e.commentErrorClass="inputerror",e.canComment=!0,!1):(e.commentErrorClass="",!0)}e.$watch("showCommentBox",function(t){t&&(m||_(),e.comments.length()||D())}),e.$watch("target.getKey()",function(){p&&(m&&(t.unsubscribe(m),_(),e.comments.reset()),e.comments.length()||D()),p=!0})}function rgComments(){return{restrict:"E",controller:CommentsController,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@",hideScroll:"@"},template:'<div class="feed_comment"><div rg-scrollbar="scrollbar()" disabled="{{::hideScroll}}" ng-class="!hideScroll ? \'comm-scroll-height\':\'\'"><ul class="media-list"><li class="item b-none bd" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item com-{{::comment.getKey()}}" rg-repeat="comm in comments.all() track by comm.key" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),comment_blink: (comment.getKey() == activeCommentId)}"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><a ng-href="{{comment.user().link()}}"><img ng-src="{{ comment.user().avatar(\'thumb\')}}" alt=""></a></div><div class="comm-p"><p class="unm"><a ng-href="{{comment.user().link()}}">{{comment.user().getName()}}</a></p><p class="comment_text" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.$parent.commentEditorEnabled" placeholder="Write your comment..."></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-top-7 feed-m"><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i>{{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class="" style="position: relative"><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li></ul></div><div ng-show="loadingComment" style="text-align:center;margin-top:10px"><div class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div></div><div class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></div><div ng-if="target.getTotalComment() > comments.length()" class="divider"></div><div class="mar-top-10"><div class="comment-w" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div>'}}function rgImageComments(){return{restrict:"E",controller:CommentsController,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@"},template:'<div class="feed-comment-wrapper" style="height:calc(100% - 165px)"><div class="feed_comment" rg-scrollbar="scrollbar()"><ul class="feed-img-l"><li class="item b-none" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item pv-item com-{{::comment.getKey()}}" ng-repeat="comm in comments.all()" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),active: (comment.getKey() == activeCommentId) }"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{::comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{::comment.user().link()}}">{{::comment.user().getName()}}</a></p><p class="txt_justify" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-if="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="$parent.models.commentedittext" new-line="false" on-enter="$parent.updateComment" on-enter-arg="comment" on-escape="$parent.cancelEdit" edit-mode="$parent.commentContentEdit(comment)" show-emoji="true" focus="$parent.commentEditorEnabled" placeholder="Write something...." style="width: 94%"></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="$parent.cancelEdit()">cancel</a></span></span></p><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::commentType}}" target="comment" target-parent="target.getKey()" target-owner="target.getFeedKey()" like-comment="true"></li><li class="mar-left-60"><span class="time"><i class="img_sprite icon-dt-ico w-h-13"></i> {{comment.time()}}</span></li></ul></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class=""><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="{comment:comment,target:target}" dd-action="actionCommentDropdown" ng-class="target.user().isCurrentUser() || comment.user().isCurrentUser() ? \'img_sprite w-h-13 icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div></li><li ng-show="loadingComment" class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></li><li class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></li></ul></div><div class="pv-c-top"><div class="width-100-percent"><div class="pv-pro float-left"><img ng-src="{{::currentUser.avatar(\'thumb\')}}" alt=""></div><div class="comment-w" style="width:85%" ng-class="commentErrorClass"><div class="comment-editor popimgcmnt-box"><rg-editor class="editor" editor-content="commenttext" new-line="false" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div></div>'}}angular.module("ringid.shared").factory("LikeHttpService",LikeHttpService).controller("LikeController",LikeController).controller("WhoLikeController",WhoLikeController).directive("rgLikes",rgLikes).directive("rgLikerAnchor",rgLikerAnchor).directive("rgWhoLike",rgWhoLike).directive("rgLikerButton",rgLikerButton),LikeHttpService.$inject=["$$connector","OPERATION_TYPES"];function LikeHttpService(e,t){var n,r=t.SYSTEM;n={likeUnlike:i,likeUnlikeComment:o,fetchWhoLikes:s,fetchWhoLikesComment:a};function i(t){var n={};switch(t.type){case"feed":n.actn=1===t.il?r.TYPE_LIKE_STATUS:r.TYPE_UNLIKE_STATUS;break;case"image":n.actn=r.IMAGE.TYPE_LIKE_IMAGE,n.imgId=t.target.getKey(),n.lkd=t.il;break;case"media":n.actn=r.MEDIA.ACTION_LIKE_UNLIKE_MEDIA,n.cntntId=t.target.getKey(),n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey()),e.request(n,r.REQUEST_TYPE.UPDATE)}function o(t){var n={};switch(t.type){case"feed":n.actn=t.il?r.TYPE_LIKE_COMMENT:r.TYPE_UNLIKE_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_LIKE_UNLIKE_IMAGE_COMMENT,n.imgId=t.key,n.lkd=t.il;break;case"media":n.actn=r.MEDIA.ACTION_LIKE_UNLIKE_MEDIA_COMMENT,n.cntntId=t.key,n.lkd=t.il;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.cmnId=t.target.getKey(),e.request(n,r.REQUEST_TYPE.UPDATE)}function a(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_LIST_LIKES_OF_COMMENT,n.nfId=t.key;break;case"image":n.actn=r.IMAGE.TYPE_IMAGE_COMMENT_LIKES,n.imgId=t.key;break;case"media":n.actn=r.MEDIA.ACTION_MEDIACOMMENT_LIKE_LIST,n.cntntId=t.key;break;default:throw new Error("comment type not familiar")}return t.parentKey&&(n.nfId=t.parentKey),n.st=t.st||0,n.cmnId=t.target.getKey(),e.pull(n,r.REQUEST_TYPE.REQUEST)}function s(t){var n={};switch(t.type){case"feed":n.actn=r.TYPE_LIKES_FOR_STATUS,n.nfId=t.target.getKey();break;case"image":n.actn=r.IMAGE.TYPE_LIKES_FOR_IMAGE,n.imgId=t.target.getKey();break;case"media":n.actn=r.MEDIA.ACTION_MEDIA_LIKE_LIST,n.cntntId=t.target.getKey();break;default:throw new Error("comment type not familiar")}return t.target.getFeedKey()&&(n.nfId=t.target.getFeedKey()),n.st=t.st||0,e.pull(n,r.REQUEST_TYPE.REQUEST)}return n}WhoLikeController.$inject=["$scope","LikeHttpService","rgScrollbarService","userFactory","friendsFactory","Api","Auth"];function WhoLikeController(e,t,n,r,i,o,a){e.loading=!0,e.users=[],e.contactListAction=function(t){t.friend.isLoading()||(i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.isCurrentUser=function(e){return e.equals(a._currentUser)},e.loadmore=function(){e.loading||s()};function s(){var i,o="fetchWhoLikes";e.users.length<e.target.getTotalLikes()&&(i={target:e.target,type:e.likeType,st:e.users.length},"true"===e.likeComment&&(o="fetchWhoLikesComment",i.parentKey=e.targetOwner(),i.key=e.targetParent()),e.loading=!0,t[o](i).then(function(t){var i,o;if(e.loading=!1,!t.sucs)return void e.$close();for(i=0;i<t.likes.length;i++)o=r.createByUtId(t.likes[i],!0,!0),e.users.push(o),o.commonFriends(!0,!0).then(function(){e.$rgDigest()});n.recalculate(e),e.$rgDigest()},function(){e.$close()}))}s(),e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:o.user.getMutualFriends(e)}}}LikeController.$inject=["$scope","LikeHttpService","Ringalert","$ringbox","feedFactory"];function LikeController(e,t,n,r,i){e.anchorCallback=angular.noop,e.buttonCallback=angular.noop;function o(t){e.target.like(!0,!!t.loc&&t.loc),n.show(t,"error"),e.anchorCallback.call(null,e.target.like()),e.buttonCallback.call(null,e.target.like()),e.$rgDigest()}e.LikeUnlike=function(){var n,r="likeUnlike";n={target:e.target,type:e.likeType},"true"===e.likeComment&&(r="likeUnlikeComment",n.parentKey=e.targetOwner(),n.key=e.targetParent()),n.il=e.target.like(!0),e.anchorCallback.call(null,n.il),e.buttonCallback.call(null,n.il),t[r](n).then(function(t){var r;t.sucs?"feed"!==e.likeType&&"true"!==e.likeComment&&t.nfId&&(r=i.synchLike(t.nfId,n.il,t.loc),r&&r.$rgDigest()):o(t)},o),e.$rgDigest()},e.$watch("target",function(t){e.anchorCallback.call(null,t.like()),e.buttonCallback.call(null,t.like(),!0)}),e.showWhoLike=function(){e.target.getTotalLikes()&&r.open({type:"remote",scope:e,controller:"WhoLikeController",templateUrl:"templates/home/wholikes.html"})}}rgLikerButton.$inject=[];function rgLikerButton(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a><i class="img_sprite lc-ico"></i><b>{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</b></a>',link:function(e,t){function n(e,n){e?(t[0].firstChild.className=t[0].firstChild.className.replace("icon-like","").trim(),t[0].firstChild.className=t[0].firstChild.className.replace("icon-like-h","").trim(),t[0].firstChild.className+=" icon-like-h",n||(t[0].firstChild.innerHTML='<span class="like-ani"></span>',window.setTimeout(function(){t&&(t[0].firstChild.innerHTML="")},2e3))):(t[0].firstChild.className=t[0].firstChild.className.replace("icon-like-h","").trim(),t[0].firstChild.className=t[0].firstChild.className.replace("icon-like","").trim(),t[0].firstChild.className+=" icon-like")}e.buttonCallback=n,n(e.target.like(),!0),t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}rgLikerAnchor.$inject=[];function rgLikerAnchor(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes() > 1 ? "Likes":"Like"}}</a>',link:function(e,t){t.bind("click",e.LikeUnlike),e.$on("$destroy",function(){t.unbind("click",e.likeUnlike)})}}}rgWhoLike.$inject=[];function rgWhoLike(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes()}}</a>',link:function(e,t){t.bind("click",e.showWhoLike),e.$on("$destroy",function(){t.unbind("click",e.showWhoLike)})}}}rgLikes.$inject=[];function rgLikes(){return{restrict:"EA",scope:{target:"=",likeType:"@",targetParent:"&",targetOwner:"&",likeComment:"@"},controller:"LikeController",template:"<rg-liker-button></rg-liker-button><rg-who-like></rg-who-like>",link:function(e,t){function n(e){e?t.addClass("active"):t.removeClass("active")}e.anchorCallback=n,n(e.target.like()),e.$watch("target.like()",function(){n(e.target.like()),e.buttonCallback.call(null,e.target.like(),!0)})}}}angular.module("ringid.shared").directive("rgEmoticon",rgEmoticon),rgEmoticon.$inject=["$compile","$timeout","$document","Utils","StickerFactory","rgScrollbarService","$templateCache","$ringhttp"];function rgEmoticon(e,t,n,r,i,o,a,s){function c(t,n,c){var l,u,d="templates/partials/emoticon-window.html",g=!1,m=400,E=300,f="true"===c.showSticker?300:260;t.emoWindowStyle={height:f+"px",width:E+"px"},t.showsticker="true"===c.showSticker,t.selectedStickerCatId=0;function p(){t.$parent&&1!==t.$parent.$id?t.$parent.$rgDigest():t.$rgDigest()}function T(e){e.preventDefault(),g=!g,g?_(e):h()}n[0].addEventListener("click",T);function h(e){(!e||"click"!==e.type||e.target!==n[0]&&e.target.parentNode&&e.target.parentNode!==n[0]&&e.target.parentNode.parentNode!==n[0]&&"pt-top"!==e.target.className)&&(g=!1,document.removeEventListener("click",h),document.removeEventListener("scroll",h),n[0].removeEventListener("resize",A),l[0].parentNode.removeChild(l[0]))}function I(r){l=e(r)(t),n.append(l),A(),document.addEventListener("click",h),document.addEventListener("scroll",h),window.addEventListener("resize",A)}function _(e){u=e,a.get(d)?I(a.get(d)):s.get(d).success(function(e){I(e)})}t.selectEmoOrSticker=S;function A(){var e=0,i=n[0].getBoundingClientRect(),o=r.viewport.x-i.width,a=r.viewport.y;e=Math.floor(i.width/2),u.clientX+m<o&&u.clientY+m<a?(t.emoWindowStyle.top=i.top+(e+15)+"px",t.emoWindowStyle.left=i.left+(e+5)+"px"):u.clientX+m>o&&u.clientY+m>a?(t.emoWindowStyle.top=i.top-f+(e-5)+"px",t.emoWindowStyle.left=i.left-E+(e-5)+"px"):u.clientX+m>o?(t.emoWindowStyle.top=i.top+(e+5)+"px",t.emoWindowStyle.left=i.left-E+(e-5)+"px"):u.clientY+m>a&&(t.emoWindowStyle.top=i.top-f+(e-5)+"px",t.emoWindowStyle.left=i.left+(e+5)+"px"),p()}function S(e,n){n.stopPropagation(),c.clicked&&t.$eval(c.clicked)(e,n),h(),p()}t.selectStickerCatId=function(e,n){e.stopPropagation(),t.selectedStickerCatId=n,i.getStickerMapByCatId(n).then(function(e){t.emoticonMap=e,p()}),o.scrollTop(t),p()},t.showEmoticons=function(e){e.stopPropagation(),t.emoticonMap=i.getEmoticonMap(),p()},t.$on("$destroy",function(){document.removeEventListener("click",h),document.removeEventListener("scroll",h),n[0].removeEventListener("resize",A)})}l.$inject=["$scope"];function l(e){function t(){e.$parent&&1!==e.$parent.$id?e.$parent.$rgDigest():e.$rgDigest()}e.startAt=0,e.getMyStickers=function(){return e.myStickerCatIds().slice(e.startAt,e.startAt+4)},e.getTopStickers=function(){return i.getStickerCategories("top").slice(0,4)},e.loadPrevious=function(n){e.startAt=e.startAt>0?e.startAt-1:0,n.stopPropagation(),t()},e.loadNext=function(n){e.startAt=e.startAt+3<e.myStickerCatIds().length-1?e.startAt+1:e.startAt,n.stopPropagation(),t()},e.myStickerCatIds=i.getMyStickerCatIds,e.getSticker=i.getStickerCategoryObject,e.emoticonMap=i.getEmoticonMap()}return{restrict:"A",link:c,controller:l}}angular.module("ringid.shared").directive("rgUpload",rgUpload),rgUpload.$inject=["$compile","fileUploadService"];function rgUpload(e,t){n.$inject=["Auth","$scope","mediaMetadata","imageQuality","APP_CONSTANTS","SystemEvents","Ringalert","$$q","$rootScope","Media"];function n(e,n,r,i,o,a,s,c,l,u){var d=o,g=0;n.uploadProgress=t.uploadProgress,n.disableUpload=E,n.uploadAudio=f,n.uploadVideo=p,n.uploadImage=T;function m(){t.resetUpload(),g=0,n.uploadProgress=t.uploadProgress,n.$rgDigest()}n.$on(a.FILE_UPLOAD.UPLOADS_POSTED,m);function E(e){return t[n.uploadSpec.type+"Files"].length>0&&n.uploadSpec.type!==e}function f(){var e,r,i,o=this;for(e=0;e<o.files.length;e++)g+=o.files[e].size;if(o.files.length+t.audioFiles.length>d.AUDIO_UPLOAD_LIMIT)s.show("Maximum upload limit "+d.AUDIO_UPLOAD_LIMIT,"warning");else if(g>d.MEDIA_UPLOAD_SIZE_LIMIT)for(s.show("Maximum allowed total upload files size 500MB!","warning"),e=0;e<o.files.length;e++)g-=o.files[e].size;else{for(n.hasOwnProperty("rgUploadAction")&&n.rgUploadAction("audio"),0===t.audioFiles.length&&(n.uploadSpec.type="audio",u.init()),i=t.audioFiles.length,e=0,r=o.files.length;e<r;e++)h("audio",o.files[e])?t.queueFile("audio",o.files[e]):s.show("Invalid Audio File: "+o.files[e].name,"error");l.$broadcast(a.FILE_UPLOAD.QUEUE_START),t.uploadQueue("audio",i)}o.value=null,n.$rgDigest()}function p(){var e,r,i,o=this;for(e=0;e<o.files.length;e++)g+=o.files[e].size;if(o.files.length+t.videoFiles.length>d.VIDEO_UPLOAD_LIMIT)s.show("Maximum upload limit "+d.VIDEO_UPLOAD_LIMIT,"warning");else if(g>d.MEDIA_UPLOAD_SIZE_LIMIT)for(s.show("Maximum allowed total upload files size 500MB!","warning"),e=0;e<o.files.length;e++)g-=o.files[e].size;else{for(0===t.videoFiles.length&&(u.init(),n.uploadSpec.type="video"),n.hasOwnProperty("rgUploadAction")&&n.rgUploadAction("video"),r=t.videoFiles.length,e=0,i=o.files.length;e<i;e++)h("video",o.files[e])?t.queueFile("video",o.files[e]):s.show("Invalid Video File: "+o.files[e].name,"error");t.uploadQueue("video",r),l.$broadcast(a.FILE_UPLOAD.QUEUE_START)}o.value=null,n.$rgDigest();
}function T(){var e,r,i,o=this;switch(n.rgUploadType){case"coverphoto":case"profilephoto":case"tagchatimage":case"groupchatcover":case"groupchatprofile":case"chatimage":h("image",o.files[0])?(i=t.queueFile(n.rgUploadType,o.files[0]),n.hasOwnProperty("rgUploadAction")&&n.rgUploadAction()({action:n.rgUploadType,uploadFile:i})):s.show("Invalid Image File: "+o.files[0].name,"error");break;case"status":if(o.files.length+t.imageFiles.length>d.IMAGE_UPLOAD_LIMIT){s.show("Maximum upload limit "+d.IMAGE_UPLOAD_LIMIT,"warning");break}for(e=t.imageFiles.length,r=0;r<o.files.length;r++)h("image",o.files[r])?t.queueFile("image",o.files[r]):s.show("Invalid Image File: "+o.files[r].name,"error");n.uploadSpec.type="image",l.$broadcast(a.FILE_UPLOAD.QUEUE_START),t.uploadQueue("image",e);break;default:RingLogger.warning("Case Mismatch",RingLogger.tags.UPLOAD)}o.value=null,n.$rgDigest()}function h(e,t){var n;switch(e){case"image":n=new RegExp("image/*");break;case"audio":n=new RegExp("audio/mp3*");break;case"video":n=new RegExp("video/mp4");break;default:RingLogger.warning("Case Mismatch",RingLogger.tags.UPLOAD)}return n.test(t.type)}n.$on("$destroy",function(){var e,r;switch(n.rgUploadType){case"coverphoto":t.coverImageFile&&(t.coverImageFile.cancelUpload(),t.coverImageFiles=null);break;case"profilephoto":t.profileImageFile&&(t.profileImageFile.cancelUpload(),t.profileImageFiles=null);break;case"tagchatimage":case"chatimage":t.chatImageFiles[n.rgUploadBoxValue]&&(t.chatImageFiles[n.rgUploadBoxValue].cancelUpload(),delete t.chatImageFiles[n.rgUploadBoxValue]);break;case"status":if(t.imageFiles.length>0){for(e=0,r=t.imageFiles.length;e<r;e++)t.imageFiles[e].cancelUpload();t.imageFiles.splice(0)}else if(t.videoFiles.length>0){for(e=0,r=t.videoFiles.length;e<r;e++)t.videoFiles[e].cancelUpload();t.videoFiles.splice(0)}else if(t.audioFiles.length>0){for(e=0,r=t.audioFiles.length;e<r;e++)t.audioFiles[e].cancelUpload();t.audioFiles.splice(0)}break;default:RingLogger.warning("Case Mismatch",RingLogger.tags.UPLOAD)}})}function r(n,r,i){var o,a,s=i.rgUploadType,c="",l="";switch(s){case"coverphoto":case"profilephoto":c='<input  id="'+s+'" type="file" name="'+s+'"  accept="image/*" >',r.append(e(c)(n));break;case"groupchatcover":c='<label><span class="img_sprite w35 parent icon-camera"><input  id="'+s+'" type="file" style="display:none;" accept="image/*" ></span><span>Upload Group Photo</span></label>',r.append(e(c)(n));break;case"tagchatimage":case"chatimage":c='<label  class="img_sprite icon-camera ico-sty ng-binding "><input  id="'+s+'" type="file" style="display:none;" accept="image/*" ></label>',r.append(e(c)(n));break;case"audio":c='<a data-tooltip-post="Add Audios" href="javascript:void(0)"><label  class="audio-ico ng-binding " ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a>',r.append(e(c)(n));break;case"video":c='<a data-tooltip-post="Add Videos" href="javascript:void(0)"><label  class="video-ico ng-binding " ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="video" type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a>',r.append(e(c)(n));break;case"status":c='<div ng-show="rgUploadEnabled "class="post-b-ico"><a data-tooltip-post="Add Videos" href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico video-ico ng-binding " ><input ng-disabled="disableUpload(\'video\')" id="video"type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a></div><div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Audios" href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico audio-ico ng-binding " ><input ng-disabled="disableUpload(\'audio\')" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a></div>',i.rgUploadFeed&&"true"===i.rgUploadFeed&&(c='<div ng-show="rgUploadEnabled" class="post-b-ico"><a data-tooltip-post="Add Photos"  href="javascript:void(0)" class="p-ab"><label  class="img_sprite status-ico camera-ico ng-binding " ><input ng-disabled="disableUpload(\'image\')" id="'+s+'" type="file" style="display:none;" multiple="multiple" accept="image/*"></label></a></div>'+c),r.append(e(c)(n));break;default:RingLogger.warning("Case Mismatch",RingLogger.tags.UPLOAD)}l=r[0].querySelector("input#"+s),"status"===s?(i.rgUploadFeed&&"true"===i.rgUploadFeed&&l.addEventListener("change",n.uploadImage),o=r[0].querySelector("input#video"),o.addEventListener("change",n.uploadVideo),a=r[0].querySelector("input#audio"),a.addEventListener("change",n.uploadAudio)):"audio"===s?l.addEventListener("change",n.uploadAudio):"video"===s?l.addEventListener("change",n.uploadVideo):l.addEventListener("change",n.uploadImage),n.$rgDigest(),n.$on("$destroy",function(){switch(s){case"status":i.rgUploadFeed&&"true"===i.rgUploadFeed&&l.removeEventListener("change",n.uploadImage),a.removeEventListener("change",n.uploadAudio),o.removeEventListener("change",n.uploadVideo);break;case"image":l.removeEventListener("change",n.uploadImage);break;case"audio":l.removeEventListener("change",n.uploadAudio);break;case"video":l.removeEventListener("change",n.uploadVideo);break;default:RingLogger.warning("Case Mismatch",RingLogger.tags.UPLOAD)}t.removeScope(n)}),t.setScopeForDigest(n)}return{restrict:"AE",scope:{uploadSpec:"=",rgUploadEnabled:"=",rgUploadType:"@",rgUploadAction:"&",rgUploadBoxValue:"="},link:r,controller:n}}angular.module("ringid.shared").directive("rgInvite",rgInvite),rgInvite.$inject=["$$connector","OPERATION_TYPES","InviteFactory","friendsFactory","Api"];function rgInvite(e,t,n,r,i){function o(o,a){var s,c,l,u,d,g,m,E,f=t.SYSTEM.FRIENDS;a[0].style.display="none",o.removeOutGoingFriends=_,o.getSuggestions=I,o.removeSugg=h,o.getMutualFriend=T,o.friendRequestAction=p;function p(){var e=3===m.friendshipStatus()?"remove":"addfriend",t=m;function i(e){v(),D(e.sucs),S(),e.sucs===!0&&n.removeSuggestion(t.getUtId()).then(function(e){e.sucs===!0&&n.suggestionFriends.remove(t.getUtId())})}function o(){D(),S()}C(),r.friendAction({friend:t,action:e},!0).then(i,o),D()}function T(){return{data:function(){return{target:m}},promise:i.user.getMutualFriends(m)}}function h(){n.removeSuggestion(m.getUtId(),"remove"),v()}function I(){return o.removeOutGoingFriends(),n.suggestionFriends.length()<5&&n.getSuggestionContactsDetails(),{data:function(){return{target:n.suggestionFriends}}}}function _(){var e,t,r=[],i=n.suggestionFriends.all(),o=n.suggestionFriends.length();for(e=0;e<o;e++)0!==i[e].value.friendshipStatus()&&r.push(i[e].value.getUtId());for(t=0;t<r.length;t++)n.suggestionFriends.remove(r[t])}function A(){s=a[0].querySelector("#invname"),c=a[0].querySelector("#invavatarlink"),l=a[0].querySelector("#invavatarimg"),u=a[0].querySelector("#invmutual"),d=a[0].querySelector("#invaddfriend"),a[0].addEventListener("mouseenter",C),a[0].addEventListener("mouseleave",S),a[0].style.display="block",v(),S()}function S(){C(),g=setInterval(v,5e3)}function C(){clearInterval(g)}function v(){m=m?n.suggestionFriends.next(m.getUtId())||n.suggestionFriends.bottom():n.suggestionFriends.bottom(),m?(s.textContent=m.getName(),s.setAttribute("href",m.link()),c.setAttribute("href",m.link()),l.setAttribute("src",m.avatar("thumb")),u.textContent=m.commonFriends()+" mutual friends",m.commonFriends()>0?u.style.display="block":u.style.display="none",D()):a[0].style.display="none"}function D(){m.isLoading()?d.parentElement.classList.add("f-loading"):d.parentElement.classList.remove("f-loading")}function R(){e.subscribe(function(){E||(E=setTimeout(function(){A()},1e3))},{action:[f.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),setTimeout(n.init,5e3)}function M(){a[0].removeEventListener("mouseenter",S),a[0].removeEventListener("mouseenter",C)}R(),o.$on("$destroy",M)}return{restrict:"A",templateUrl:"templates/partials/friend-invite.html",link:o}}angular.module("ringid.shared").controller("MenuController",MenuController),MenuController.$inject=["$scope","$location","routeService"];function MenuController(e,t,n){e.isCurrentPath=r,e.routes={home:n.getRoute("HOME"),profile:n.getRoute("PROFILE",{uId:e.currentUser.getUId(),subpage:"post"}),mediaCloud:n.getRoute("MEDIA_CLOUD"),mediaFeed:n.getRoute("MEDIA_FEEDS"),circle:n.getRoute("CIRCLE_LIST"),newsportal:n.getRoute("NEWSPORTAL_FEED"),pages:n.getRoute("PAGES_FEED")},RingLogger.print(e.routes,RingLogger.tags.DEFAULT);function r(e,n){return n?t.path().indexOf(e)>-1:t.path()===e}}angular.module("ringid.shared").controller("allSuggestionController",allSuggestionController),allSuggestionController.$inject=["$scope","$boxInstance","localData","friendsFactory","InviteFactory","OPERATION_TYPES","$$connector","rgScrollbarService","Api"];function allSuggestionController(e,t,n,r,i,o,a,s,c){var l,u,d=o.SYSTEM.FRIENDS;l=n.target.length(),e.users=[],e.state=i.state,e.contactListAction=E,e.loadmorefriend=m,e.getMutualFriend=g,t.opened.then(function(){e.users=n.target.all(),e.$rgDigest()}),e.$watch("state.isRequestsLoading",function(){e.$rgDigest()}),u=a.subscribe(f,{action:[d.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]});function g(e){return{data:function(){return{target:e}},promise:c.user.getMutualFriends(e)}}function m(){i.getSuggestionContactsDetails(5),e.$rgDigest()}function E(t){t.friend.isLoading()||(r.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}function f(t){t&&(i.noOfSuggestions()>l&&(s.recalculate(e),e.$rgDigest()),l=i.noOfSuggestions())}e.$on("$destroy",function(){a.unsubscribe(u)})}angular.module("ringid.shared").controller("mutualFriendsController",mutualFriendsController),mutualFriendsController.$inject=["$scope","remoteData","friendsFactory","userFactory","Api","rgScrollbarService"];function mutualFriendsController(e,t,n,r,i,o){var a,s=t.mfIDs;e.mutualfriends=[],e.getMutualFriend=l,n.getContactDetailsByUtIds(s).then(c);function c(t){if(e.mutualfriends=[],t.sucs===!0){for(a=0;a<t.contacts.length;a++)e.mutualfriends.push(r.create(t.contacts[a]));e.$rgDigest()}o.recalculate(e),e.$rgDigest()}function l(e){return{data:function(){return{target:e}},promise:i.user.getMutualFriends(e)}}}!function(e,t){"use strict";e.module("ringid.ui_editor",[])}(angular,window),angular.module("ringid.ui_editor").constant("EDITOR_DATA",{PATTERN:{DATA_BLOCK:/<a.*?data-link="(.*?)".*?>.*?<\/a>/gi},CHAR:{SPACE:32,LINE_FEED:10,ZERO_WIDTH_SPACE:8203,NON_BREAKING_SPACE:160},KEY:{ENTER:13,BACKSPACE:8,SPACE:32,DELETE:46,ESCAPE:27,LEFT:37,RIGHT:39,UP:38,DOWN:40,CLICK:0}}),angular.module("ringid.ui_editor").factory("keys",Keys),Keys.$inject=["$sniffer","EDITOR_DATA"];function Keys(e,t){var n=e.vendorPrefix.toLowerCase(),r=[];return r[t.KEY.ENTER]={fn:"enter",action:"enter",event:"keydown"},r[t.KEY.BACKSPACE]={fn:"backspace",action:"backspace",event:"keydown"},r[t.KEY.SPACE]={fn:"space",action:"space",event:"keydown"},r[t.KEY.DELETE]={fn:"delete",action:"delete",event:"keydown"},r[t.KEY.ESCAPE]={fn:"escape",action:"escape",event:"keydown"},r[t.KEY.LEFT]={fn:"adjust",action:"left",event:"keyup"},r[t.KEY.RIGHT]={fn:"adjust",action:"right",event:"keyup"},r[t.KEY.UP]={fn:"adjust",action:"up",event:"keyup"},r[t.KEY.DOWN]={fn:"adjust",action:"down",event:"keyup"},r[t.KEY.CLICK]={fn:"adjust",action:"click",event:"mouseup"},"moz"===n&&(r[t.KEY.BACKSPACE]={fn:"backspace",action:"backspace",event:"both"},r[t.KEY.DELETE]={fn:"delete",action:"delete",event:"both"}),r}angular.module("ringid.ui_editor").factory("cursor",Cursor);function Cursor(){var e=!(!navigator.userAgent.match(/Trident/)||!navigator.userAgent.match(/rv[ :]11/)),t={toPosition:n,toElementStart:r,toElmentEnd:i,toElmentBefore:o,toElmentAfter:a,toElementByType:s,deleteContents:c,insertHtml:l,getSelection:u,isIE:d,extendSelection:g,reset:m,getRange:E,getCurrentRange:f,getDirection:p,intersectsNode:T};function n(e,t){var n=this.getSelection(),r=this.getRange(),i=t;i="undefined"!=typeof i&&null!==i?i:e.length||e.childNodes.length,r.setStart(e,i),r.setEnd(e,i),r.collapse(!0),n.removeAllRanges(),n.addRange(r),r.detach(),n=null}function r(e,t){t&&e.focus(),this.toPosition(e,0)}function i(e,t){t&&e.focus(),this.toPosition(e)}function o(e){var t=this.getSelection(),n=this.getRange();n.setStartBefore(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null}function a(e){var t=this.getSelection(),n=this.getRange();n.setStartAfter(e),n.collapse(!0),t.removeAllRanges(),t.addRange(n),n.detach(),t=null}function s(e,t,n){var r=t;r="undefined"!=typeof r?r:"end","end"===r&&this.toElmentEnd(e),"start"===r&&this.toElementStart(e),"pos"===r&&this.toPosition(e,n)}function c(e,t,n,r){var i=this.getSelection(),o=this.getRange(),a=e,s=t,c=n,l=r;s="undefined"!=typeof s&&null!==s?s:a.length||a.childNodes.length,c="undefined"!=typeof c?c:a,l="undefined"!=typeof l&&null!==l?l:c.length||c.childNodes.length,a===c&&s===l||(1===a.nodeType?o.setStartBefore(a):o.setStart(a,s),1===c.nodeType?o.setEndAfter(c):o.setEnd(c,l),i.removeAllRanges(),i.addRange(o),document.execCommand("delete",!1),o.detach())}function l(t){var n,r,i,o=this.getCurrentRange();if(this.isIE())o.pasteHTML(t);else if(e){for(n=document.createElement("div"),r=document.createDocumentFragment(),n.innerHTML=t;i=n.firstChild;)r.appendChild(i);o.insertNode(r),n=r=i=null}else document.execCommand("insertHtml",!1,t)}function u(){return this.isIE()?document.selection:window.getSelection()}function d(){return document.selection&&"Control"!==document.selection.type}function g(e,t){var n,r=this.getSelection(),i=this.getRange();return n="undefined"===t||null===t||t,r.extend&&n?void r.extend(e.end,e.endPos):("ltr"===e.direction?(i.setStart(e.start,e.startPos),i.setEnd(e.end,e.endPos)):(i.setStart(e.end,e.endPos),i.setEnd(e.start,e.startPos)),r.removeAllRanges(),r.addRange(i),i.detach(),void(r=null))}function m(){var e=this.getSelection(),t=this.getRange(),n=this.getDirection();"ltr"===n?t.setStart(e.focusNode,e.focusOffset):t.setStart(e.anchorNode,e.anchorOffset),t.collapse(!0),e.removeAllRanges(),e.addRange(t),t.detach(),e=null}function E(){return document.createRange()}function f(){var e=this.getSelection();return this.isIE()?e.createRange():!!e.rangeCount&&e.getRangeAt(0)}function p(){var e=this.getSelection(),t=!1,n=this.getRange();return e&&!e.isCollapsed&&(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),t=n.collapsed,n.detach()),e=null,t?"rtl":"ltr"}function T(e){var t=this.getCurrentRange(),n=null;if(n=t.commonAncestorContainer,t.intersectsNode)return t.intersectsNode(e);for(;n&&n!==e;)n=n.parentNode;return n}return t}angular.module("ringid.ui_editor").factory("modifiers",Modifiers),Modifiers.$inject=["$sniffer","StickerEmoticonService","cursor","utils","keys","EDITOR_DATA"];function Modifiers(e,t,n,r,i,o){var a=t.getEmoticonMap(),s=e.vendorPrefix.toLowerCase(),c={container:null,event:null,keyCode:0,action:"",selection:null,range:null,previousSelection:{},init:l,setContainer:u,adjust:d,enter:g,escape:m,backspace:E,delete:f,space:p,addEmoticon:T,addTag:h,paste:I};function l(e,t,o,a,s){var l,u,d,g,m=!0,E=null,f=null;for(this.container=e,this.keyCode=t,this.event=o,this.selection=n.getSelection(),this.range=n.getCurrentRange(),this.action="",E=r.getFirstNode(this.container),f=this.container.lastChild,l=r.getCurrentBoundary(this.selection),l=r.getSafeBoundary(this.selection,l,t,E,f),u=0;u<s.length;u++)g=s[u],g&&(g.event===o.type||"both"===g.event)&&(i[t]&&g.action&&g.action.indexOf(i[t].action)!==-1||g.action===!1)&&g.fn.call(g.context,o,t)===!1&&(m=!1);if(m){for(i[t]&&c[i[t].fn]&&(i[t].event===o.type||"both"===i[t].event)&&(this.action=i[t].action,c[i[t].fn](l)),!i[t]&&"keydown"===o.type&&l&&c.adjust(l,!1),u=0;u<a.length;u++)d=a[u],d&&d.event===o.type&&(i[t]&&d.action===i[t].action||d.action===!1)&&d.fn.call(d.context,o,t);E=f=null}}function u(e,t){this.container=e,t&&n.intersectsNode(e)===!1&&r.setAtEditorEnd(e)}function d(e,t){if(e){if(e.zws&&0===e.candidate.length&&("left"===this.action||"right"===this.action||"click"===this.action))return void(t&&this.event.preventDefault());if(!this.selection.isCollapsed&&"mouseup"===this.event.type&&this.previousSelection&&this.previousSelection.anchorNode===this.selection.anchorNode&&this.previousSelection.anchorOffset===this.selection.anchorOffset&&this.previousSelection.focusOffset===this.selection.focusOffset)return void(this.previousSelection={});if(!t&&this.selection.isCollapsed===!1){if(this.event.ctrlKey||this.event.shiftKey||this.event.metaKey)return;return void(e&&"ltr"===e.direction?n.deleteContents(e.start,e.startPos,e.end,e.endPos):e&&"rtl"===e.direction?n.deleteContents(e.end,e.endPos,e.start,e.startPos):n.deleteContents(this.range.startContainer,this.range.startOffset,this.range.endContainer,this.range.endOffset))}r.adjustCursor(this.selection,e),t&&this.event.preventDefault(),this.selection&&this.selection.anchorNode&&(this.previousSelection.anchorNode=this.selection.anchorNode,this.previousSelection.anchorOffset=this.selection.anchorOffset,this.previousSelection.focusOffset=this.selection.focusOffset)}}function g(e){var t,r=!1;e&&!this.selection.isCollapsed&&("ltr"===e.direction?n.deleteContents(e.start,e.startPos,e.end,e.endPos):n.deleteContents(e.end,e.endPos,e.start,e.startPos),this.range=n.getCurrentRange());try{r=document.execCommand("insertBrOnReturn",!1,!0)}catch(e){r=!1}r||(this.event.preventDefault(),this.range.deleteContents(),t=document.createElement("br"),this.range.insertNode(t),""!==this.container.style.maxHeight&&(this.container.scrollTop=this.container.scrollTop+18),n.toElmentAfter(t),t=null)}function m(){}function E(e){var t,i;if(e){if(i=this.container.innerText||this.container.textContent,2===i.length)return void this.event.preventDefault();if("last"!==e.zwsType||e.start!==e.end||e.startPos!==e.endPos){if(e.zws&&"first"===e.zwsType&&0===e.candidate.length)return void this.event.preventDefault();"ltr"===e.direction?(t=r.getNode(e.start,"prev",e.start.length-e.startPos),n.deleteContents(e.start,e.startPos,e.end,e.endPos)):(t=r.getNode(e.end,"next",e.end.length-e.endPos),n.deleteContents(e.end,e.endPos,e.start,e.startPos)),t.parent&&(t.pos="rtl"===e.direction?t.node.childNodes.length:0),n.toElementByType(t.node,t.type,t.pos),this.event.preventDefault(),t=null}}}function f(e){var t,i;if(e){if(i=this.container.innerText||this.container.textContent,2===i.length)return void this.event.preventDefault();if("first"!==e.zwsType||e.start!==e.end||e.startPos!==e.endPos){if(e.zws&&"last"===e.zwsType&&0===e.candidate.length)return void this.event.preventDefault();this.selection.isCollapsed||"ltr"===e.direction?(t=r.getNode(e.start,"next",e.start.length-e.startPos),n.deleteContents(e.start,e.startPos,e.end,e.endPos)):(t=r.getNode(e.end,"prev",e.end.length-e.endPos),n.deleteContents(e.end,e.endPos,e.start,e.startPos)),t.parent&&(t.pos=this.selection.isCollapsed||"ltr"===e.direction?t.node.childNodes.length:0),n.toElementByType(t.node,t.type,t.pos),this.event.preventDefault(),t=null}}}function p(){var e,t,n="";n=r.findCurrentWord(null,this.container),n&&(n=n.replace(/\u200B|\n/g,"")),a[n]&&(e="ms"===s&&r.isEditorTag(this.range.endContainer)&&3===this.range.endContainer.childNodes[this.range.endOffset].nodeType&&this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE,e&&(t=this.range.endContainer.childNodes[this.range.endOffset-1],this.range.setStart(t,t.length),this.range.setEnd(t,t.length),t=null),this.range.setStart(this.range.startContainer,this.range.endOffset-n.length),this.range.deleteContents(),this.addEmoticon(n,!0),this.event.preventDefault())}function T(e,t){var i,a,s,c,l;this.range=n.getCurrentRange(),a=r.parseText(e),t&&""===a.replace(o.PATTERN.DATA_BLOCK,"")&&(a+=String.fromCharCode(o.CHAR.SPACE)),r.removeClass(this.container),n.insertHtml(a),c=this.container.querySelectorAll(".caret"),c=Array.prototype.slice.call(c),this.selection&&(s=this.selection.focusNode),s&&s.nextSibling&&3===s.nextSibling.nodeType&&1===s.nextSibling.length&&s.nextSibling.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&s.nextSibling.parentNode.removeChild(s.nextSibling),s&&3===s.nodeType&&s.nodeValue.charCodeAt(s.nodeValue.length-1)===o.CHAR.LINE_FEED&&(s.nodeValue=s.nodeValue.replace(/\u200B|\n/g,"")),!s&&c.length>0&&(l=c[c.length-1].nextSibling.nextSibling,l&&3===l.nodeType&&1===l.length&&l.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&l.parentNode.removeChild(l),l=null),c.length>0?(s=c[c.length-1],s.nextSibling&&3===s.nextSibling.nodeType?n.toElementByType(s.nextSibling,"pos",1):n.toElmentAfter(s)):s?(i=r.getNode(s,"next",0),n.toElementByType(i.node,i.type,i.pos)):r.setAtEditorEnd(this.container),this.container.focus(),i=c=s=null}function h(e,t){var i,a,c,l,u,d,g,m,E,f={};m="@"+t,3!==this.range.startContainer.nodeType&&(this.range=n.getCurrentRange()),u=this.range.collapsed?this.range.endOffset:this.range.startOffset,E="ms"===s&&r.isEditorTag(this.range.endContainer)&&3===this.range.endContainer.childNodes[this.range.endOffset].nodeType&&this.range.endContainer.childNodes[this.range.endOffset].nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE,E&&(u=this.range.endContainer.childNodes[this.range.endOffset-1].nodeValue.length,g=this.range.endContainer.childNodes[this.range.endOffset-1],this.range.setStart(g,0),this.range.setEnd(g,0),g=null),u-m.length<0||(this.range.setStart(this.range.startContainer,u-m.length),this.range.setEnd(this.range.startContainer,u),this.range.deleteContents(),f.className="tag",f.title=e.getName().trim(),f.dataLink=e.getUtId(),f.text=e.getName().trim(),r.removeClass(this.container),c=r.getBlockHTML(f),n.insertHtml(c),d=this.container.querySelectorAll(".caret"),d=Array.prototype.slice.call(d),l=this.selection.focusNode!==this.container&&this.selection.focusNode.nextSibling&&this.selection.focusNode.nextSibling!==this.container.lastChild?this.selection.focusNode.nextSibling:this.selection.focusNode,a=r.examineNode(l,"focus",this.selection),a.node&&"parent"===a.position&&(l=a.node),l&&l.nextSibling&&3===l.nextSibling.nodeType&&1===l.nextSibling.length&&l.nextSibling.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&l.nextSibling.parentNode.removeChild(l.nextSibling),l&&3===l.nodeType&&l.nodeValue.charCodeAt(l.nodeValue.length-1)===o.CHAR.LINE_FEED&&(l.nodeValue=l.nodeValue.replace(/\u200B|\n/g,"")),!l&&d.length>0&&(g=d[d.length-1].nextSibling,g&&3===g.nodeType&&1===g.length&&g.nodeValue.charCodeAt(0)===o.CHAR.LINE_FEED&&g.parentNode.removeChild(g),g=null),d.length>0?n.toElmentAfter(d[d.length-1]):l?(i=r.getNode(l,"next",0),n.toElementByType(i.node,i.type,i.pos)):r.setAtEditorEnd(this.container),this.container.focus(),i=d=l=null)}function I(e){var t=r.parseText(e);n.insertHtml(t),this.container.focus()}return c}angular.module("ringid.ui_editor").factory("utils",Utils),Utils.$inject=["$sniffer","StickerEmoticonService","StickerEmoticonFactory","cursor","keys","EDITOR_DATA"];function Utils(e,t,n,r,i,o){var a=n.getEmoticonPattern(),s=t.getEmoticonMap(),c=e.vendorPrefix.toLowerCase(),l={examineNode:u,getCurrentBoundary:d,adjustCursor:g,getSafeBoundary:m,parseText:E,removeClass:f,adjustMarkup:p,getBlockHTML:T,getPrevNode:h,getNextNode:I,getNode:_,isEditorTag:A,setAtEditorEnd:S,isEmpty:C,getFirstNode:v,findCurrentWord:D,findPos:R};function u(e,t,n){var r,i=Object.create(null),o="focus"===t?n.focusOffset:n.anchorOffset;return i.position=!1,i.length=0,i.node=null,e?(1===e.nodeType&&"true"===e.getAttribute("data-block")&&(i.node=e,i.position="self"),r=l.getNextNode(e,e.length),r&&1===r.nodeType&&"true"===r.getAttribute("data-block")&&(1===e.nodeType||3===e.nodeType&&o===e.length)&&(i.node=r,i.position="next"),r=l.getPrevNode(e,e.length),r&&1===r.nodeType&&"true"===r.getAttribute("data-block")&&(1===e.nodeType||3===e.nodeType&&0===o)&&(i.node=r,i.position="prev"),r="b"===e.parentNode.nodeName.toLowerCase()?e.parentNode.parentNode:e.parentNode,r&&1===r.nodeType&&"true"===r.getAttribute("data-block")&&(i.node=r,i.position="parent"),i.node&&(i.length=3===i.node.nodeType?i.node.nodeValue.length:0),r=null,i):i}function d(e){var t=r.getDirection(),n=Object.create(null);return e?(n.start=e.anchorNode,n.startPos=e.anchorOffset,n.end=e.focusNode,n.endPos=e.focusOffset,n.direction=t,n):n}function g(e,t){e.isCollapsed?r.toElementByType(t.end,t.type,t.endPos):!e.isCollapsed&&t.isAnchorMoved?r.extendSelection(t,!1):r.extendSelection(t)}function m(e,t,n,r,a){var s,c,u,d,g,m=!1,E=null,f=null,p=[];if(g={enter:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},backspace:{focus:"prev",anchor:"next",dir:"rtl",reverse:!0,both:!0},delete:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!0},space:{focus:"next",anchor:"next",dir:"ltr",reverse:!1,both:!1},escape:{},left:{focus:"prev",anchor:"next",dir:"rtl",reverse:!1,both:!1},right:{focus:"next",anchor:"prev",dir:"ltr",reverse:!1,both:!1},up:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},down:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},click:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1},any:{focus:"next",anchor:"prev",dir:"ltr",reverse:!0,both:!1}},s=i[n]?i[n].action:"any",""===s||!g[s]||!g[s].hasOwnProperty("focus"))return!1;for(t.isAnchorMoved=!1,t.candidate=[],e.isCollapsed&&!g[s].both||p.push({node:e.anchorNode,type:"anchor",offset:e.anchorOffset}),p.push({node:e.focusNode,type:"focus",offset:e.focusOffset});u=p.pop();)u.node&&(c=g[s][u.type],g[s].reverse&&t.direction!==g[s].dir&&(c="next"===c?"prev":"next"),E=l.examineNode(u.node,u.type,e),"any"===s&&e.isCollapsed&&(E.length===e.focusOffset||"next"===E.position&&e.focusNode.length===e.focusOffset)&&(E.node=null),"backspace"!==s&&"click"!==s||"next"!==E.position||!e.isCollapsed||3!==e.focusNode.nodeType||e.focusNode.length!==e.focusOffset||(E.node=null),E.node&&(f=l.getNode(E.node,c,0),"focus"===u.type?(t.end=f.node,t.endPos=f.pos):(t.start=f.node,t.startPos=f.pos,t.isAnchorMoved=!0),t.type=f.type,m=!0,t.candidate.push(E.node)));return t.zws=!1,t.zwsType="","ltr"===t.direction&&t.start===r&&(0===t.startPos?(e.isCollapsed?(t.endPos=t.startPos=1,t.type=t.type?t.type:"pos"):(t.startPos=1,t.type=t.type?t.type:"pos"),m=!0):1===t.startPos&&"any"!==s&&3===t.start.nodeType&&t.start.nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE&&e.isCollapsed&&(t.zws=!0,t.zwsType="first",m=!0)),"backspace"===s&&e.isCollapsed&&0===t.startPos&&l.getPrevNode(t.start,t.start.length)===r&&(t.zws=!0,t.zwsType="first",m=!0),"rtl"===t.direction&&t.end===r&&0===t.endPos&&(t.endPos=1,t.type=t.type?t.type:"pos",m=!0),l.isEditorTag(t.end)&&0===t.endPos&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",m=!0),l.isEditorTag(t.end)&&t.endPos===t.end.childNodes.length&&t.end.lastChild&&3===t.end.lastChild.nodeType&&t.end.lastChild.nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE&&(t.end=t.end.firstChild,t.endPos=1,t.type=t.type?t.type:"pos",m=!0),"ltr"===t.direction&&a&&t.end===a&&(d=t.end.length,d>0&&t.endPos===d?(e.isCollapsed?(t.endPos=t.startPos=d-1,t.type=t.type?t.type:"pos"):(t.endPos=d-1,t.type=t.type?t.type:"pos"),m=!0):t.endPos===d-1&&"any"!==s&&3===t.end.nodeType&&t.end.nodeValue.charCodeAt(d-1)===o.CHAR.ZERO_WIDTH_SPACE&&e.isCollapsed&&(t.zws=!0,t.zwsType="last",m=!0)),"delete"===s&&e.isCollapsed&&t.end.length===t.endPos&&l.getNextNode(t.end,t.endPos)===a&&(t.zws=!0,t.zwsType="last",m=!0),d=t.start.length,"rtl"===t.direction&&t.start===a&&t.startPos===d&&(t.startPos=d-1,t.type=t.type?t.type:"pos",m=!0),E=f=p=u=null,!!m&&t}function E(e){var t={},n=e;return n=n.replace(a,function(e){return t.className="em_list "+s[e].replace(/\.[A-Za-z]{3}/,""),t.title=e,t.dataLink=e,t.text="<b>"+e.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</b>&nbsp;",l.getBlockHTML(t)})}function f(e){var t,n=e.querySelectorAll(".caret");if(e){for(t=0;t<n.length;t++)n[t].className=n[t].className.replace("caret","").trim();n=null}}function p(e){var t,n=e.querySelectorAll(".em_list");if(e){for(t=0;t<n.length;t++)n[t].innerHTML="<b>"+n[t].getAttribute("data-link")+"</b>&nbsp;";n=null}}function T(e){var t='<a href="#" onclick="return false" class="'+e.className+' caret" title="'+e.title+'" data-link="'+e.dataLink+'" spellcheck="false" data-block="true">'+e.text+"</a>";return t}function h(e,t){var n,r=t;if(r="undefined"!=typeof r&&null!==r?r:0,!e)return e;if(e.length>r)return e;for(n=e.previousSibling;n&&!(n.length>0||1===n.nodeType);)n=n.previousSibling;return n}function I(e,t){var n,r=t;if(r="undefined"!=typeof r&&null!==r?r:0,!e)return e;if(e.length>r)return e;for(n=e.nextSibling;n&&!(n.length>0||1===n.nodeType);)n=n.nextSibling;return n}function _(e,t,n){var r=Object.create(null),i=!1,o=l.isEditorTag(e),a=n,s=t;return e?(r.node=null,s="undefined"!=typeof s&&null!==s?s:"prev",a="undefined"!=typeof a&&null!==a?a:0,e.length>a&&(i=!0),o||(r.node="prev"===s?l.getPrevNode(e,a):l.getNextNode(e,a)),r.node&&("prev"===s&&(r.pos=i?r.node.length-a:r.node.length),"next"===s&&(r.pos=i?r.node.length-a:0),r.type="pos"),r.parent=!1,r.node||(r.node=o?e:e.parentNode,r.pos="next"===s?r.node.childNodes.length:0,r.type="pos",r.parent=!0),r):e}function A(e){return e&&1===e.nodeType&&"true"===e.getAttribute("data-editor")||!1}function S(e){l.isEditorTag(e)&&e.lastChild&&3===e.lastChild.nodeType&&e.lastChild.nodeValue.charCodeAt(e.lastChild.nodeValue.length-1)===o.CHAR.ZERO_WIDTH_SPACE&&(e.focus(),r.toElmentEnd(e.lastChild,e.lastChild.nodeValue.length-1)),r.toElmentEnd(e)}function C(e){var t=e.firstChild;if(0===e.childNodes.length)return!1;for(;t&&!(1===t.nodeType||t.length>0);)t=t.nextSibling;return t}function v(e,t){var n=e.firstChild,r=t;if(0===e.childNodes.length)return!1;for(r="undefined"!=typeof r&&null!==r&&r;n&&(!(1===n.nodeType||n.length>0)||r&&3===n.nodeType&&!(n.length>1)&&n.nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE);)n=n.nextSibling;return n}function D(e,t){var n,i,a=r.getSelection(),s="",u=-1,d="",g=!1,m=l.getFirstNode(t,!0);if(i="ms"===c&&l.isEditorTag(a.focusNode)&&3===a.focusNode.childNodes[a.focusOffset].nodeType&&a.focusNode.childNodes[a.focusOffset].nodeValue.charCodeAt(0)===o.CHAR.ZERO_WIDTH_SPACE,a&&(3===a.focusNode.nodeType||i)&&(s=i?a.focusNode.childNodes[a.focusOffset-1].nodeValue:a.focusNode.nodeValue.substr(0,a.anchorOffset),s=s.replace(/\s+$/,""),u=e?s.lastIndexOf(e):1,u>=0))for(n=s.length-1;n>=0;n--){if(/\s/.test(s[n])){g=!0;break}if(s[n]===e){d=s[n]+d;break}d=s[n]+d}return null===e?(g||i||m===a.anchorNode||(d=""),m=null,d):(d[0]!==e&&(d=""),d=d.length>1&&(m===a.anchorNode&&a.anchorNode.nodeValue[0]===e||i||t.firstChild===a.anchorNode&&a.anchorNode.nodeValue[1]===e||a.anchorNode.previousSibling&&3===a.anchorNode.previousSibling.nodeType&&a.anchorNode.previousSibling.nodeValue.charCodeAt(a.anchorNode.previousSibling.length-1)===o.CHAR.SPACE||s.charCodeAt(u-1)===o.CHAR.SPACE||s.charCodeAt(u-1)===o.CHAR.NON_BREAKING_SPACE)?d.replace(e,""):"",m=null,d)}function R(e){var t=0,n=0,r=e;if(r.offsetParent)do t+=r.offsetLeft,n+=r.offsetTop;while(r=r.offsetParent);return{x:t,y:n}}return l}angular.module("ringid.ui_editor").provider("$editor",EditorProvider);function EditorProvider(){this.$get=["$compile","$rootScope","keys","utils","cursor","modifiers","EDITOR_DATA",_get]}function _get(e,t,n,r,i,o,a){var s={};return s.create=function(e){var s=new Editor(e,t,n,r,i,o,a);return s},s}function Editor(e,t,n,r,i,o,a){var s=this;this.content="",this.tagOpen=!1,this.fragment=null,this.dom={},this.processors=[],this.callback=[],this.lastDisable=0,this.maxHeight=0,this.newLine="undefined"==typeof e.newLine||e.newLine,this.maxHeight=e.maxHeight,this.placeholder=e.placeholder||"",this.isDisabled="undefined"!=typeof e.isDisabled&&e.isDisabled,this.emotion=e.emotion?e.emotion:null,this.fragment=document.createDocumentFragment(),this.dom.placeholder=document.createElement("span"),this.dom.placeholder.setAttribute("data-placeholder",this.placeholder),this.fragment.appendChild(this.dom.placeholder),this.dom.editor=document.createElement("div"),this.dom.editor.setAttribute("contenteditable","true"),this.dom.editor.setAttribute("spellcheck","true"),
this.dom.editor.setAttribute("data-editor","true"),this.dom.editor.setAttribute("class","editor"),this.fragment.appendChild(this.dom.editor),this.emotion&&this.fragment.appendChild(this.emotion),this.maxHeight>0&&(this.dom.editor.style.maxHeight=this.maxHeight+"px"),this.updateContent=function(){var e,n;e=this.dom.editor.innerHTML.replace(/<br>/g,"\n"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&amp;/g,"&"),e=e.replace(/&nbsp;/g," "),e=e.replace(/\u200B/g,""),e=e.replace(/\n{3,}/g,"\n\n"),e=e.replace(a.PATTERN.DATA_BLOCK,function(e,t){return isNaN(t)?t:"##"+t+"##"}),this.content=e.trim(),n=this.dom.editor.innerHTML.replace(/<br>/g,"\n"),n=n.replace(/&nbsp;/g," "),n=n.replace(/\u200B/g,""),n=n.replace(/\n{3,}/g,"\n\n"),this.dom.placeholder.innerHTML=n,this.onUpdate&&"function"==typeof this.onUpdate&&this.onUpdate.call(null),""!==this.content?t.unloadWarn=!0:t.unloadWarn=!1},this.addEmoticon=function(e){o.setContainer(this.dom.editor,!0),o.addEmoticon(e,!0),this.updateContent()},this.addTag=function(e,t){o.setContainer(this.dom.editor,!0),o.addTag(e,t),this.updateContent()},this.addDelimiter=function(){var e,t,n;e=this.dom.editor.innerText||this.dom.editor.textContent,n=r.getFirstNode(this.dom.editor),e.charCodeAt(0)!==a.CHAR.ZERO_WIDTH_SPACE&&(t=document.createTextNode("â€‹"),n?this.dom.editor.insertBefore(t,n):this.dom.editor.appendChild(t)),e=this.dom.editor.innerText||this.dom.editor.textContent,1!==e.length&&e.charCodeAt(e.length-1)===a.CHAR.ZERO_WIDTH_SPACE||(t=document.createTextNode("â€‹"),this.dom.editor.appendChild(t))},this.getPosition=function(){var e=0,t=0,n=this.dom.editor.getBoundingClientRect(),r=i.getCurrentRange().getClientRects();return e=n.left,t=n.top,r.length>0&&(r=r[0],e=r.left-e,t=r.top-t),{x:e,y:t+12}},this.findWord=function(e){return r.findCurrentWord(e,this.dom.editor)},this.setFocus=function(){r.setAtEditorEnd(this.dom.editor)},this.clear=function(){this.dom.editor.innerHTML="",this.dom.placeholder.innerHTML="",this.updateContent(),this.addDelimiter(),t.unloadWarn=!1},this.setPlaceholderContent=function(e,t){e.ctrlKey||e.shiftKey||e.metaKey||n[t]||""!==this.dom.placeholder.innerHTML||(this.dom.placeholder.innerHTML=String.fromCharCode(t))},this.set=function(e){var t=e;t&&(t=t.replace(/\n/g,"<br />"),t=t.replace(/href="(.*?)"/g,'href="#"'),t=t.replace(/<span/g,'<a href="#" onclick="return false" data-block="true"'),t=t.replace(/<\/span>/g,"</a>"),t=t.replace(/class="tag"/g,'class="tag" onclick="return false" data-block="true"'),t=t.replace(/<a.*?class="feedanchor".*?>(.*?)<\/a>/g,"$1"),this.dom.editor.innerHTML=t,this.updateContent(),this.addDelimiter(),r.adjustMarkup(this.dom.editor))},this.initEvent=function(){this.dom.editor.addEventListener("mouseup",c),this.dom.editor.addEventListener("keydown",l),this.dom.editor.addEventListener("keyup",u),this.dom.editor.addEventListener("dragover",g),this.dom.editor.addEventListener("drop",m),this.dom.editor.addEventListener("paste",E),this.dom.editor.addEventListener("cut",f),this.dom.editor.addEventListener("blur",d)},this.destroy=function(){this.dom.editor.removeEventListener("mouseup",c),this.dom.editor.removeEventListener("keydown",l),this.dom.editor.removeEventListener("keyup",u),this.dom.editor.removeEventListener("dragover",g),this.dom.editor.removeEventListener("drop",m),this.dom.editor.removeEventListener("paste",E),this.dom.editor.removeEventListener("cut",f),this.dom.editor.removeEventListener("blur",d),this.dom=s=null,t.unloadWarn=!1},this.addDelimiter(),this.initEvent(),this.addProcessor("keydown",!1,this.checkDisability,this),this.addProcessor("keydown","enter",this.checkNewLine,this),this.addProcessor("both","enter,up,down",this.checkTag,this),this.addCallback("keyup","delete,backspace",this.checkBR,this),this.addCallback("keyup",!1,this.addDelimiter,this),this.addCallback("keydown",!1,this.setPlaceholderContent,this),this.addCallback("keyup",!1,this.updateContent,this);function c(e){o.init(s.dom.editor,0,e,s.callback,s.processors),s.dom.placeholder.className="active",e.stopPropagation()}function l(e){var t=e.which||e.keyCode||e.key;e.stopPropagation(),o.init(s.dom.editor,t,e,s.callback,s.processors)}function u(e){var t=e.which||e.keyCode||e.key;e.stopPropagation(),o.init(s.dom.editor,t,e,s.callback,s.processors)}function d(e){e.stopPropagation(),e.preventDefault(),s.dom.placeholder.className=""}function g(e){return e.stopPropagation(),e.preventDefault(),!1}function m(e){return e.stopPropagation(),e.preventDefault(),!1}function E(e){var t="";if(e.stopPropagation(),e.preventDefault(),e.clipboardData)t=e.clipboardData.getData("text/plain");else if(window.clipboardData)try{t=window.clipboardData.getData("Text")}catch(e){throw new Error("clipboard copy error")}t=t.replace(/\n/g,"<br />"),t=t.replace(/\s\s+/g," "),t=t.replace(/\u200B/g,""),o.paste(t),s.updateContent()}function f(e){e.stopPropagation(),s.updateContent()}}Editor.prototype.addProcessor=function(e,t,n,r){this.processors.push({event:e,action:t,fn:n,context:r})},Editor.prototype.addCallback=function(e,t,n,r){this.callback.push({event:e,action:t,fn:n,context:r})},Editor.prototype.showError=function(){this.hideError(),this.dom.editor.className=this.dom.editor.className+" error"},Editor.prototype.hideError=function(){this.dom.editor.className=this.dom.editor.className.replace("error","").trim()},Editor.prototype.enable=function(){this.isDisabled=!1},Editor.prototype.disable=function(){this.isDisabled=!0},Editor.prototype.get=function(){return this.content},Editor.prototype.setNewLineMode=function(e){this.newLine=e},Editor.prototype.getNode=function(){return this.fragment},Editor.prototype.checkDisability=function(e){return!this.isDisabled||(e.preventDefault(),this.lastDisable=(new Date).getTime()/1e3,(new Date).getTime()-this.lastDisable>2e3&&(this.isDisabled=!1),!1)},Editor.prototype.checkTag=function(e){return!this.tagOpen||(e.preventDefault(),!1)},Editor.prototype.checkNewLine=function(e){return!!(this.newLine||e.shiftKey||e.ctrlKey)||(e.preventDefault(),!1)},Editor.prototype.checkBR=function(){this.dom.editor.firstElementChild&&this.dom.editor.firstElementChild===this.dom.editor.lastElementChild&&"br"===this.dom.editor.firstElementChild.nodeName.toLowerCase()&&this.dom.editor.removeChild(this.dom.editor.firstElementChild)},angular.module("ringid.ui_editor").directive("rgEditor",rgEditor),rgEditor.$inject=["$compile","$editor","SystemEvents"];function rgEditor(e,t,n){return{scope:{editorContent:"=",onEnter:"&",onEscape:"&",onEnterArg:"=",isDisabled:"=",focus:"=",editMode:"&"},restrict:"E",link:r};function r(r,i,o){var a,s,c,l;r.filterFriend="",r.editorContent="",s="true"===o.showSticker||o.showSticker===!0?"true":"false",c={newLine:!("false"===o.newLine||o.newLine===!1),placeholder:o.placeholder?o.placeholder:"",isDisabled:"true"===o.isDisabled||o.isDisabled===!0,maxHeight:o.maxHeight?parseInt(o.maxHeight,10):0},o.showEmoji&&(c.emotion=e('<a href="javascript:void(0)"><i class="img_sprite icon-emoticon ico-sty" rg-emoticon="" clicked="insertEmoji" show-sticker="'+s+'"></i></a>')(r)[0],i.addClass("with_emo")),a=t.create(c),i.append(a.getNode()),a.onUpdate=m,r.insertEmoji=function(e){a.addEmoticon(e.symbol(),!0)},r.closeDropdownFriend=function(){l&&(l.remove(),l=void 0),a.tagOpen=!1},r.chooseFriend=function(e){r.filterFriend&&(a.addTag(e,r.filterFriend),r.closeDropdownFriend())};function u(t,n){var o;r.filterFriend=a.findWord("@"),32===n&&(r.filterFriend=""),""===r.filterFriend&&l&&r.closeDropdownFriend(),r.filterFriend&&!l&&(l=e('<rg-friend-dropdown template-url="templates/dropdowns/tag-editor-dropdown.html" tag-items="[]" filter-text="filterFriend" focus-filter="" on-close="closeDropdownFriend" on-select="chooseFriend"></rg-friend-dropdown>')(r),i.after(l),o=a.getPosition(),l.css({position:"absolute",left:o.x+"px",top:o.y+"px"})),l&&(a.tagOpen=!0,document.addEventListener("click",function e(t){l&&t.target!==l[0]&&r.closeDropdownFriend(),document.removeEventListener("click",e)},!1))}function d(e,t){return l&&(e.preventDefault(),l.triggerHandler(e,t)),!0}function g(e){return!(c.newLine===!1&&!e.shiftKey&&!e.ctrlKey)||(r.onEnter()(r.onEnterArg),!1)}function m(){r.editorContent=a.get(),r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}o.onRingbox&&a.addCallback("keydown",!1,function(){r.$emit(n.RINGBOX.UPDATE)}),o.tagFriend&&(a.addCallback("keyup",!1,u,null),a.addCallback("keyup","escape",r.closeDropdownFriend,r),a.addProcessor("keydown","up,down,enter",d,null)),o.onEscape&&a.addCallback("keyup","escape",r.onEscape(),r),o.onEnter&&a.addProcessor("keydown","enter",g),r.$on("cleareditor",function(){a.clear()}),r.$on("seteditor",function(e,t){var n=t||r.editorContent;a.set(n)}),r.$watch("isDisabled",function(e){e?(a.disable(),a.clear()):a.enable()}),o.focus&&r.$watch("focus",function(e){e&&(setTimeout(function(){a.setFocus()},0),o.editMode&&a.set(r.editMode()().toString()))}),RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from RgEditor",RingLogger.tags.DIGEST)}),r.$on("$destroy",function(){a.destroy(),a=c=l=null})}}!function(e,t){"use strict";e.module("ringid.ui_scrollbar",[])}(angular,window),angular.module("ringid.ui_scrollbar").provider("$scrollbar",ScrollbarProvider);function ScrollbarProvider(){this.findPos=function(e){var t=0,n=0,r=e;if(r.offsetParent)do t+=r.offsetLeft,n+=r.offsetTop;while(r=r.offsetParent);return{x:t,y:n}},this.findPosType=function(e){var t,n=0,r=e;if(r=r.offsetParent)do if(t=getComputedStyle(r,null),"fixed"===t.getPropertyValue("position")){n=1;break}while(r=r.offsetParent);return n},this.tabindex=100,this.$get=["$$q",function(e){var t=this,n={};function r(n,r){var i,o,a,s,c,l,u,d=this,g=500;r.scrollbarWidth=r.scrollbarWidth?r.scrollbarWidth:8,r.scrollbarAlways=!!r.scrollbarAlways&&r.scrollbarAlways,r.dragSpeedModifier=r.dragSpeedModifier?r.dragSpeedModifier:5,r.minThumbHeight=r.minThumbHeight?r.minThumbHeight:10,r.clickSpeedModifier=r.clickSpeedModifier?r.clickSpeedModifier:40,r.keyboardSpeedModifier=r.keyboardSpeedModifier?r.keyboardSpeedModifier:20,r.keyboardEvent=!!r.keyboardEvent&&r.keyboardEvent,r.onBottomReached=!!r.onBottomReached&&r.onBottomReached,this.scrollbarMousedown=!1,this.isFreezed=!1,this.freezeInfo={height:"",position:"",scrollHeight:0},this.scrollbarVisible=!1,this.displayState="none",this.hasScroll=!1,this.lastY=0,this.scrollHeight=0,this.offsetHeight=0,this.visibleHeight=0,this.thumbHeight=0,this.thumbTimer=null,this.mousewheel="undefined"!=typeof InstallTrigger?"DOMMouseScroll":"mousewheel",this.isTouchSupport="ontouchstart"in window||navigator.msMaxTouchPoints,this.isFixedPosition=-1,this.dom=Object.create(null),this.dom.element=n,this.dom.scrollbarContainer=this.dom.element.parentNode,this.dom.wrapper=document.createElement("div"),this.dom.scrollbar=document.createElement("div"),this.dom.scrollbarThumb=document.createElement("div"),this.dom.scrollbar.className="scrollbar",this.dom.scrollbarThumb.className="thumb",this.dom.wrapper.className="ringscroll",this.dom.element.style.overflow="hidden",this.dom.wrapper.setAttribute("style","position:relative;width:auto;overflow:hidden;height:100%;"),this.dom.scrollbar.setAttribute("style","height:100%;right:1px;opacity:0;top:0px;position:absolute;z-index:1;width:"+r.scrollbarWidth+"px"),this.dom.scrollbarThumb.setAttribute("style","right:1px;top:0px;opacity:0;position:absolute;z-index:1;width:"+r.scrollbarWidth+"px"),this.dom.scrollbarContainer.insertBefore(this.dom.wrapper,this.dom.element),this.dom.wrapper.appendChild(this.dom.element),this.dom.wrapper.appendChild(this.dom.scrollbar),this.dom.wrapper.appendChild(this.dom.scrollbarThumb),this.scroll=function(e,t,n){var l,u;fastdom.read(function(){d.dom.element&&(d.hiddenHeight=d.scrollHeight-d.offsetHeight,d.visibleHeight=d.offsetHeight-d.thumbHeight,l=e/d.visibleHeight,u=Math.min(Math.max(e,0),d.visibleHeight),t?(c=0,i=d.dom.element.scrollTop,o=d.hiddenHeight*l-i,a=n,s=u-a,d.doAnimation()):fastdom.write(function(){d.dom.element.scrollTop=d.hiddenHeight*l,d.dom.scrollbarThumb.style.top=u+"px"}),u===d.visibleHeight&&r.onBottomReached&&angular.isFunction(r.onBottomReached)&&r.onBottomReached())})},this.reCalculate=function(t){var n,i,o=!!t&&e.defer();return fastdom.read(function(){d.dom&&(d.isFreezed&&(d.dom.wrapper.style.height="100%",d.dom.element.style.position=d.freezeInfo.position,d.dom.element.style.height=d.freezeInfo.height,d.dom.element.style.bottom="initial"),d.scrollHeight=d.dom.element.scrollHeight,d.offsetHeight=d.dom.element.offsetHeight,d.hiddenHeight=d.scrollHeight-d.offsetHeight,d.thumbHeight=Math.max(d.offsetHeight/d.scrollHeight*d.offsetHeight,r.minThumbHeight),(isNaN(d.thumbHeight)||"Infinity"===d.thumbHeight)&&(d.thumbHeight=0),d.visibleHeight=d.offsetHeight-d.thumbHeight,d.isFreezed&&(d.dom.element.scrollTop=d.scrollHeight-d.freezeInfo.scrollHeight),n=d.visibleHeight/d.hiddenHeight,i=d.dom.element.scrollTop*n,d.displayState=d.thumbHeight>=d.offsetHeight?"none":"block",d.hasScroll=d.thumbHeight>=d.offsetHeight,fastdom.write(function(){d.dom&&(d.dom.scrollbar.style.display=d.displayState,d.dom.scrollbarThumb.style.height=d.thumbHeight+"px",d.dom.scrollbarThumb.style.display=d.displayState,d.dom.scrollbarThumb.style.top=i+"px"),o&&o.resolve(),d.isFreezed=!1}))}),!!o&&o.promise},this.scrollBySelector=function(e,t,n){var r,i,o,a,s=0,c=null,l=0,u=0,g=0,m=0;r="undefined"!=typeof n&&null!==n?parseInt(n,10):0,c=this.dom.element.querySelector(e),c&&(o=c.offsetTop,i=c.offsetHeight,u=parseFloat(d.dom.scrollbarThumb.style.top),t&&(s=i),u+this.dom.element.scrollTop<o&&(g=this.dom.element.offsetHeight-i,t&&(s=-1*i)),a=o+s+r-g,m=a/this.hiddenHeight,l=m*this.visibleHeight,this.scroll(l,!0,u))},this.freeze=function(){var e,t;this.hasScroll&&(t=this.scrollHeight-(this.dom.element.scrollTop+this.offsetHeight),""===this.freezeInfo.height&&(e=getComputedStyle(this.dom.element,null),this.freezeInfo.height=e.getPropertyValue("height"),this.freezeInfo.position=e.getPropertyValue("position")),this.freezeInfo.scrollHeight=this.scrollHeight,this.dom.wrapper.style.height=this.offsetHeight+"px",this.dom.element.style.position="absolute",this.dom.element.style.bottom="-"+t+"px",this.dom.element.style.height="auto",this.isFreezed=!0)},this.scrollByPos=function(e,t){var n,r,i;i="undefined"!=typeof t&&null!==t&&t,i&&(r=parseFloat(this.dom.scrollbarThumb.style.top)),n=parseInt(e,10)*this.visibleHeight/100,this.scroll(n,i,r)},this.scrollTop=function(e){this.scrollByPos(0,e)},this.scrollBottom=function(e){this.scrollByPos(100,e)},this.hideScrollbar=function(){r.scrollbarAlways||d.isFreezed||(d.scrollbarMousedown||(d.dom.scrollbar.style.opacity=0,d.dom.scrollbarThumb.style.opacity=0,d.scrollbarVisible=!1),d.thumbTimer=null)},this.showScrollbar=function(){this.isFreezed||d.reCalculate(),d.dom.scrollbar.style.opacity=1,d.dom.scrollbarThumb.style.opacity=1,d.scrollbarVisible=!0,r.keyboardEvent&&d.dom.element.focus()},this.destroy=function(){this.dom.scrollbarContainer.removeEventListener("mouseenter",A),this.dom.scrollbarContainer.removeEventListener("mouseleave",_),this.dom.scrollbarThumb.removeEventListener("mousedown",p),this.dom.scrollbar.removeEventListener("click",E),this.dom.element.removeEventListener(this.mousewheel,f),this.dom.element.removeEventListener("keydown",m),this.dom.element.removeEventListener("touchmove",I),d=this.dom=null},this.doAnimation=function(){var e,t;c+=25,e=Math.easeIn(c,i,o,g),t=Math.easeIn(c,a,s,g),d.dom.element.scrollTop=e,d.dom.scrollbarThumb.style.top=t+"px",c<g&&requestAnimationFrame(d.doAnimation)},this.dom.scrollbarContainer.addEventListener("mouseenter",A,!1),this.dom.scrollbarContainer.addEventListener("mouseleave",_,!1),this.dom.scrollbarThumb.addEventListener("mousedown",p,!1),this.dom.scrollbar.addEventListener("click",E,!1),this.dom.element.addEventListener(this.mousewheel,f,!1),r.keyboardEvent&&(this.dom.element.addEventListener("keydown",m),this.dom.element.setAttribute("tabindex",t.tabindex++)),this.isTouchSupport&&this.dom.element.addEventListener("touchmove",I);function m(e){var t,n,i,o=e.which||e.keyCode||e.key;e.preventDefault(),e.stopPropagation(),38!==o&&40!==o||(d.showScrollbar(),t=parseFloat(d.dom.scrollbarThumb.style.top),n=r.keyboardSpeedModifier,38===o&&(n*=-1),i=t+n,d.scroll(i),d.thumbTimer&&clearTimeout(d.thumbTimer),d.thumbTimer=setTimeout(d.hideScrollbar,1e3))}function E(e){var n,i,o,a=t.findPos(d.dom.scrollbar),s=parseFloat(d.dom.scrollbarThumb.style.top);e.preventDefault(),d.isFixedPosition===-1&&(d.isFixedPosition=t.findPosType(d.dom.element)),n=(d.isFixedPosition?e.clientY:e.pageY)-a.y,i=r.clickSpeedModifier+(parseInt(d.scrollHeight/d.offsetHeight/20,10)*r.clickSpeedModifier,10),n<s&&(i*=-1),o=s+i,d.scroll(o,!0,s)}function f(e){var t,n,i,o=parseFloat(d.dom.scrollbarThumb.style.top);"none"!==d.displayState&&(e.preventDefault(),d.scrollbarVisible||d.showScrollbar(),t=e.wheelDelta?-.025*e.wheelDelta:3*e.detail,n=Math.max(parseInt(2*d.offsetHeight/d.scrollHeight*r.dragSpeedModifier,10),1),i=o+t*n,d.scroll(i))}function p(e){e.preventDefault(),e.stopPropagation(),d.scrollbarVisible||d.showScrollbar(),d.scrollbarMousedown=!0,l=e.pageY,u=parseFloat(d.dom.scrollbarThumb.style.top),document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",h,!1)}function T(e){var t=u+e.pageY-l;d.scroll(t)}function h(e){e.stopPropagation(),d.scrollbarMousedown=!1,document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",h)}function I(e){var t,n,i=2,o=e.touches[0].clientY,a=parseFloat(d.dom.scrollbarThumb.style.top);e.preventDefault(),n=Math.max(parseInt(2*d.offsetHeight/d.scrollHeight*r.dragSpeedModifier,10),1),t=o<d.lasty?a+i*n:a-i*n,d.scroll(t),d.lasty=o}function _(){d.hideScrollbar()}function A(){d.showScrollbar()}}return n.create=function(e,t){var n=new r(e,t);return n},n}]}angular.module("ringid.ui_scrollbar").factory("rgScrollbarService",rgScrollbarService);function rgScrollbarService(){return{scrollTop:function(e){e.$broadcast("scrollTop")},scrollTo:function(e,t,n,r){e.$broadcast("scrollTo",t,n,r)},recalculate:function(e){e.$broadcast("recalculate")},hasScroll:function(e){e.$broadcast("hasScroll",e)}}}angular.module("ringid.ui_scrollbar").directive("rgScrollbar",rgScrollbar),rgScrollbar.$inject=["$scrollbar"];function rgScrollbar(e){function t(t,n,r){var i,o={};"true"!==r.disabled&&r.disabled!==!0&&(r.thumbHeight&&parseInt(r.thumbHeight,10)>0&&(o.minThumbHeight=parseInt(r.thumbHeight,10)),r.keyboard&&(o.keyboardEvent=!0),t.bottomReached&&(o.onBottomReached=t.bottomReached),i=e.create(n[0],o),t.$on("scrollTop",function(e){e.stopPropagation&&e.stopPropagation(),setTimeout(function(){i.scroll(0)},100)}),t.$on("scrollTo",function(e,t,n,r){e.stopPropagation&&e.stopPropagation(),"string"==typeof t?i.scrollBySelector(t,n,r):i.scrollByPos(t)}),t.$on("recalculate",function(e){e.stopPropagation&&e.stopPropagation(),i.reCalculate()}),t.$on("hasScroll",function(e,t){e.stopPropagation&&e.stopPropagation(),t.scroll=i.hasScroll}),t.$on("freeze",function(e){e.stopPropagation&&e.stopPropagation(),i.freeze()}),t.$on("$destroy",function(){i.destroy(),i=null}))}return{restrict:"A",scope:{bottomReached:"&"},link:t}}!function(e,t){"use strict";e.module("ringid.ui_ringbox",["ringid.ui_player"])}(angular,window),angular.module("ringid.ui_ringbox").provider("$ringbox",ringboxProvider);function ringboxProvider(){var e={boxes:[],boxeScopes:[],boxeDeferred:[],template:'<div class="ringbox"><div class="ringbox-overlay"></div><div class="ringbox-outerContainer"><div class="ringbox-content ringbox-invisible"><div class="ringbox-inner"></div><div class="ringbox-loader"><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div></div></div></div>',init:function(){var e=angular.element(this.template);return this.boxes.push(e),e},adjustBoxes:function(){var e;for(e=0;e<this.boxes.length;e++)this.boxes[e].removeClass("rl_"+e);for(e=0;e<this.boxes.length;e++)this.boxes[e].addClass("rl_"+e)},$get:["$injector","$rootScope","$$q","$templateCache","$controller","$compile","$document","$player","$ringhttp","$sniffer","Notification","SystemEvents","Utils",t]};return e;function t(t,n,r,i,o,a,s,c,l,u,d,g,m){var E={},f=this,p=u.vendorPrefix.toLowerCase();function T(e){var t,n=angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl;return e.template?r.when(e.template):(n=angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,i.get(n)?r.when(i.get(n)):(t=r.defer(),l.get(n).success(function(e){i.put(n,e),t.resolve(e)}).error(function(){t.reject()}),t.promise))}function h(e){var n=[];return angular.forEach(e,function(e){angular.isDefined(e.promise)?n.push(e.promise):angular.isFunction(e)?n.push(r.when(t.invoke(e))):(angular.isArray(e)||angular.isObject(e))&&n.push(e)}),n}function I(){E.minimizedBox.dom[0].style.display="none",c.showMiniPlayer(),0===f.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened",""))}return E.minimizedBox={dom:null,scope:null,deferred:null},E.clear=function(e,t,n){0===f.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened","").trim()),e&&e.$destroy(),t&&t.resolve.apply(null,n),c.miniPlayer.player||0!==f.boxes.length||c.destroyAll()},E.close=function(e){e&&e.stopPropagation&&e.stopPropagation(),f.boxes.length>0&&(f.boxes.pop().remove(),E.clear(f.boxeScopes.pop(),f.boxeDeferred.pop(),arguments))},E.closeAll=function(){var e;for(e=f.boxes.length-1;e>=0;e--)f.boxes.pop().remove(),E.clear(f.boxeScopes.pop(),f.boxeDeferred.pop(),arguments)},E.removeMinimize=function(){E.minimizedBox.dom&&E.minimizedBox.dom.remove(),E.minimizedBox.scope&&E.minimizedBox.scope.$destroy()},E.minimize=function(){var e,t,n,r;f.boxes.length>0&&(E.minimizedBox.dom=f.boxes.pop(),E.minimizedBox.scope=f.boxeScopes.pop(),E.minimizedBox.deferred=f.boxeDeferred.pop(),e=E.minimizedBox.dom[0].querySelector(".ringbox-content"),t=e.offsetLeft+(e.offsetWidth-335)/2-200,n=window.innerHeight-(e.offsetTop+(e.offsetHeight-150)/2)-120,r="translate(-"+t+"px,"+n+"px) scale(0.35,0.24)",E.minimizedBox.dom[0].querySelector(".pv-profile").style.display="none",e.style.webkitTransition="transform 0.5s",e.style.MozTransition="transform 0.5s",e.style.msTransition="transform 0.5s",e.style.OTransition="transform 0.5s",e.style.transition="transform 0.5s",e.style.webkitTransform=r,e.style.MozTransform=r,e.style.msTransform=r,e.style.OTransform=r,e.style.transform=r,e.addEventListener(p+"TransitionEnd",I),e.addEventListener("transitionend",I))},E.maximize=function(e,t){var n;E.minimizedBox.dom&&(n=E.minimizedBox.dom[0].querySelector(".ringbox-content"),E.minimizedBox.dom[0].querySelector(".pv-profile").style.display="block",E.minimizedBox.dom[0].style.display="table",e.appendChild(t),n.style.webkitTransform="initial",n.style.MozTransform="initial",n.style.msTransform="initial",n.style.OTransform="initial",n.style.transform="initial",f.boxes.push(E.minimizedBox.dom),f.boxeScopes.push(E.minimizedBox.scope),f.boxeDeferred.push(E.minimizedBox.deferred),1===f.boxes.length&&(document.body.className=document.body.className.trim()+" ringbox-opened"),E.minimizedBox={dom:null,scope:null,deferred:null},n.removeEventListener(p+"TransitionEnd",I),n.removeEventListener("transitionend",I))},E.open=function(t){var i,l,u,p,I,_,A=r.defer(),S=r.defer(),C=!1,v=!1,D={},R=1,M=f.init(),N=angular.element(M[0].querySelector("div.ringbox-content")),y=angular.element(N[0].querySelector("div.ringbox-loader")),b=angular.element(N[0].querySelector("div.ringbox-inner")),O=angular.element(M[0].querySelector("div.ringbox-overlay"));t.loaderHide="undefined"==typeof t.loaderHide||t.loaderHide,t.onEscape="undefined"==typeof t.onEscape||t.onEscape,t.animation="undefined"==typeof t.animation||t.animation,t.onBackDropClickClose="undefined"==typeof t.onBackDropClickClose||t.onBackDropClickClose,t.scrollable="undefined"!=typeof t.scrollable&&t.scrollable,I=angular.extend({},t),N.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"}),I.animation&&N.addClass("animation"),f.adjustBoxes(),i=(I.scope||n).$new(),i.boxIsLoading=!0,angular.forEach(e.options,function(e,t){i[t]=I[t]}),angular.isObject(I.scopeData)&&angular.forEach(I.scopeData,function(e,t){i[t]=I.scopeData[t]}),f.boxeScopes.push(i),f.boxeDeferred.push(A);function P(){N.addClass("ringbox-invisible"),y.css({display:"block"}),b.css({display:"none"}),N.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"})}function L(){setTimeout(function(){y.css({display:"none"}),b.css({display:"inline-block"}),F(),N.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),N.removeClass("ringbox-invisible")},300)}function U(){document.body.appendChild(M[0]),document.body.className=document.body.className.replace("ringbox-opened",""),document.body.className=document.body.className.trim()+" ringbox-opened",v=!1}I.templateUrl&&(I.templateUrl.indexOf("image-popup.html")||I.templateUrl.indexOf("media-popup.html"))?v=setTimeout(U,200):U(),i.$on(g.RINGBOX.UPDATE,function(){F(!0)});function F(e){var t,n;e&&"none"!==y.css("display")||N&&I.scrollable&&(t=b[0].offsetHeight,n=Math.max(m.viewport.y/2-t/2,40),N.css({"margin-top":n+"px"}),t>m.viewport.y?O.css({right:m.scrollbarWidth+"px"}):O.css({right:"0px"}))}if(!I.template&&!I.templateUrl)throw new Error("One of template or templateUrl options is required.");return l=r.all([T(I)].concat(h(I.resolve))),u={result:A.promise,opened:S.promise,close:E.close,closeAll:E.closeAll,showLoader:P,hideLoader:L,adjustHeight:F},l.then(function(e){if(i.boxIsLoading=!1,i.$close=E.close,b){if(C&&clearTimeout(C),I.controller){D.$scope=i,D.$boxInstance=u;for(_ in I.resolve)I.resolve.hasOwnProperty(_)&&(D[_]=e[R++]);p=o(I.controller,D),I.controllerAs&&(i[I.controllerAs]=p)}b.html(e[0]),a(b.contents())(i),v&&(clearTimeout(v),I.loaderHide&&(y.css({display:"none"}),N.removeClass("ringbox-invisible")),U()),N.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),I.loaderHide&&L(),i.$parent.$rgDigest()}},function(e){A.reject(e),E.close()}),l.then(function(){S.resolve(!0)},function(){S.reject(!1)}),I.scrollable&&(M.addClass("scrollable"),F()),I.onBackDropClickClose&&(O.on("click",function e(t){O.off("click",e),E.close(t)}),I.scrollable&&M[0].addEventListener("click",function e(t){t.stopPropagation(),t.target.className.indexOf("ringbox-outerContainer")!==-1&&(M[0].removeEventListener("click",e),E.close())},!1)),I.onEscape&&s.bind("keyup",function e(t){var n=t.which||t.keyCode||t.key;if(32!==n&&t.stopImmediatePropagation(),27===n){if(c.escapeKey)return void(c.escapeKey=!1);s.unbind("keyup",e),E.close()}}),I.scrollable&&M.bind("scroll",function(){M[0].scrollHeight-(M[0].offsetHeight+M[0].scrollTop)<100&&(angular.isFunction(i.onScroll)&&i.onScroll(),angular.isFunction(i.loadMore)&&i.loadMore())}),i.$on("$destroy",function(){M=null,N=null,y=null,b=null,u=null,I=null,O=null,l=null}),C=setTimeout(function(){i&&i.boxIsLoading&&(d.error({message:"Something went wrong! Please try again."}),E.close())},2e4),u},E}}angular.module("ringid.ui_ringbox").directive("rgRingbox",rgRingbox),rgRingbox.$inject=["$ringbox"];function rgRingbox(e){return{restrict:"EA",scope:{ringboxData:"&",scopeData:"&",onRingBoxOpen:"&",onRingBoxClose:"&",onScroll:"&",ringboxFalsyFunc:"&",ringboxOpen:"&"},link:t};function t(t,n,r){var i;function o(i){var o,a,s,c,l,u={},d={};if(i.preventDefault(),o=r.ringboxType,o||(o="html"),r.ringboxData&&(u=angular.isFunction(t.ringboxData)?t.ringboxData():t.ringboxData),r.scopeData&&(d=angular.isFunction(t.scopeData)?t.scopeData():t.scopeData),s=u.data?u.data:u,c={type:o,scrollable:r.ringboxScrollable&&("true"===r.ringboxScrollable||r.ringboxScrollable===!0),loaderHide:!(r.loaderHide&&("false"===r.loaderHide||r.loaderHide===!1)),scope:!!r.ringboxScope&&t,scopeData:d||{},controller:r.ringboxController||"",resolve:{localData:s,remoteData:u.promise?u:angular.noop},onBackDropClickClose:!(r.ringBackdropClose&&("false"===r.ringBackdropClose||r.ringBackdropClose===!1)),animation:!(r.ringboxAnimation&&("false"===r.ringboxAnimation||r.ringboxAnimation===!1)),onEscape:!(r.ringCloseEscape&&("false"===r.ringCloseEscape||r.ringCloseEscape===!1))},"remote"===o)c.templateUrl=r.ringboxTarget||t.ringboxTarget||r.href||r.src;else if("inline"===o)c.template=r.ringboxTarget||t.ringboxTarget;else if(o="html",a=r.ringboxTarget||t.ringboxTarget){if(c.template=angular.element(document.querySelector(a)),!(c.template.length>0))throw new Error("Opps ! Your Provideed Target element Does Not Exist!");c.template=c.template[0].outerHTML}else c.template=n.html();l=e.open(c),l.result.then(function(){angular.isDefined(t.onRingBoxClose)&&angular.isFunction(t.onRingBoxClose)&&t.onRingBoxClose()}),l.opened.then(function(){angular.isDefined(t.onRingBoxOpen)&&angular.isFunction(t.onRingBoxOpen)&&t.onRingBoxOpen()})}function a(e){n.on("click",e),i=t.$on("$destroy",function(){n.off("click",e)})}function s(e){e.preventDefault(),e.stopPropagation(),angular.isFunction(t.ringboxFalsyFunc)&&t.ringboxFalsyFunc()}r.ringboxOpen?t.$watch("ringboxOpen()",function(e){i&&(n.off("click",o),n.off("click",s),i()),a(e?o:s)}):a(""===r.rgRingbox||"true"===r.rgRingbox||r.rgRingbox===!0?o:s)}}!function(e,t){"use strict";e.module("ringid.ui_player",[])}(angular,window),angular.module("ringid.ui_player").provider("$player",PlayerProvider);function PlayerProvider(){this.dicts={maximize:"Back to normal view",minimize:"Go to small view",fullScreen:"Full Screen",playlist:"Playlist",auto:"Auto Play"},this.instances=[],this.template='<div class="rg-player"><div class="container"><div class="play-info"></div><div class="play-error"></div><div class="player-debug">Meta Data</div><div class="music-bars"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><div class="big-play"><span class="img_sprite icon-player"></span></div><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div><div class="player-poster"><img class="poster" /></div></div><div class="playlist-wrapper"></div><div class="media-control"><div class="media-tip"></div><div class="media-control-bg"></div><div class="media-control-layer"><div class="bar-panel"><div class="bar-container"><div class="bar-background"><div class="bar-fill-1"></div><div class="bar-fill-2"></div><div class="bar-hover"></div></div><div class="bar-scrubber"><div class="bar-scrubber-icon"></div></div><div class="seek-time"><div class="timer"></div></div></div></div><div class="control-left"><div class="play-btns"><button class="img_sprite w-h-13 icon-previous-p control-btn prev-btn"></button><button class="img_sprite w-h-13 icon-play-p control-btn start-btn"></button><button class="img_sprite w-h-13 icon-next-p control-btn next-btn"></button></div><div class="volume-bar"><div class="img_sprite w-h-13 icon-speaker-fill volume-icon unmute"></div><div class="volume-bar-container volume-bar-hide"><div data-rel="0" class="bar fill"></div><div data-rel="1" class="bar fill"></div><div data-rel="2" class="bar fill"></div><div data-rel="3" class="bar fill"></div><div data-rel="4" class="bar"></div><div data-rel="5" class="bar"></div><div data-rel="6" class="bar"></div><div data-rel="7" class="bar"></div><div data-rel="8" class="bar"></div><div data-rel="9" class="bar"></div></div></div><div class="time-indicator time-running"></div><div class="time-indicator time-total"></div></div><div class="control-right"><button class="control-btn hd">HD</button><button class="img_sprite w-h-13 icon-minimize control-btn minimize" tooltip="'+this.dicts.minimize+'"></button><button class="img_sprite w-h-13 icon-screen-f control-btn full-screen" tooltip="'+this.dicts.fullScreen+'"></button><button class="img_sprite w-h-13 icon-play-list control-btn playlist-btn" tooltip="'+this.dicts.playlist+'"></button><button class="control-btn auto" tooltip="'+this.dicts.auto+'">AUTO</button></div></div></div></div>',
this.trackTemplate='<a rel="data-rel" href="#"><span class="list-thumb"><img src="data-thumb" /></span><span class="list-title">data-caption<b>data-duration</b></span></a>',this.secToTime=function(e){var t,n,r,i="";return t=Math.floor(e),n=parseInt(t/3600,10)%24,r=parseInt(t/60,10)%60,t=t<0?0:t%60,n>0&&(i+=n<10?"0"+n:n),i+=(r<10?"0"+r:r)+":"+(t<10?"0"+t:t)},this.findPos=function(e){var t=0,n=0,r=e;if(r.offsetParent)do t+=r.offsetLeft,n+=r.offsetTop;while(null!==(r=r.offsetParent));return{x:t,y:n}},this.destroy=function(e){try{e.removeEvent(),e.provider.pause(),e.provider.src="",e.dom=null,delete e.provider}catch(e){throw new Error("undfined instance provided. ignoring...")}},this.addRemoveClass=function(e,t,n){var r;for(r=0;r<n.length;r++)e.className=e.className.replace(n[r],"").trim();for(r=0;r<t.length;r++)e.className+=" "+t[r]},this.createMediaObject=function(e){return"audio"===e?document.createElement("audio"):document.createElement("video")},this.getDefaultThumb=function(e){var t=e;return t&&"images/default_audio_image.jpg"!==t||(t="images/player-audio.png"),t},this.$get=["$compile",function(e){var t=this,n={};return n.escapeKey=!1,n.miniPlayer={dom:{container:null,move:null,resize:null,maximize:null,close:null},parent:null,player:null},n.wh=window.innerHeight,n.destroy=function(){t.instances.length>0&&t.destroy(t.instances.pop())},n.destroyAll=function(){var e;for(e=t.instances.length-1;e>=0;e--)t.destroy(t.instances.pop())},n.toggleMinMax=function(){var e,n;for(n=t.instances.length-1;n>=0;n--)if(!t.instances[n].chat){e=t.instances[n];break}e.minimize()},n.showMiniPlayer=function(){n.miniPlayer.player&&(n.miniPlayer.dom.container.appendChild(n.miniPlayer.player.parent),n.miniPlayer.dom.container.style.display="block","PLAYING"===n.miniPlayer.player.playingState&&setTimeout(function(){n.miniPlayer.player.provider.play()}))},n.closeMiniPlayer=function(){n.miniPlayer.player&&(n.ringboxRemove(),n.destroy(),n.miniPlayer.dom.container.parentNode.removeChild(n.miniPlayer.dom.container),n.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},n.miniPlayer.player=null)},n.addToPlaylist=function(e){var n;for(n=t.instances.length-1;n>=0;n--)if(!t.instances[n].chat){t.instances[n].addToPlaylist(e);break}},n.player=function(r){var i,o,a,s,c,l={},u=!1,d=!1,g=!1,m=350,E=120,f=window.innerHeight,p=window.innerWidth;n.ringboxRemove=r.ringboxRemove?r.ringboxRemove:angular.nope,r.chatVersion||n.closeMiniPlayer(),l.source=r.source||"",l.autoPlay=r.autoPlay||!1,l.showMinMax=r.showMinMax||!1,l.auto=r.auto||!1,l.parent=document.getElementById(r.parentId),l.poster=r.poster||"",l.mediaType=r.type||"video",l.dom={},l.playingState=this.autoPlay?"INIT":"STOPPED",l.bufferState="BUFFERING",l.screenState="NORMAL",l.volumeState="UNMUTE",l.volume=5,l.duration=0,l.currentTrack=0,l.playlist=r.playlist||[],l.title=r.title||"",l.playlistState=!1,l.hd=!1,l.debug=!0,l.isMouseDown=!1,l.isLoading=l.autoPlay,l.isFirefox=!!navigator.userAgent.match(/firefox/i),l.canPlay=!0,l.chat=!!r.chatVersion,l.provider=t.createMediaObject(l.mediaType),l.parent.innerHTML=t.template,l.dom.player=l.parent.querySelector(".rg-player"),l.dom.container=l.parent.querySelector(".container"),l.dom.playlistWrap=l.parent.querySelector(".playlist-wrapper"),l.dom.control=l.parent.querySelector(".media-control"),l.dom.bigBlay=l.dom.container.querySelector(".big-play"),l.dom.bigBlayIcon=l.dom.bigBlay.querySelector("span"),l.dom.playError=l.dom.container.querySelector(".play-error"),l.dom.debug=l.dom.container.querySelector(".player-debug"),l.dom.playInfo=l.dom.container.querySelector(".play-info"),l.dom.musicBar=l.dom.container.querySelector(".music-bars"),l.dom.loader=l.dom.container.querySelector(".loader"),l.dom.poster=l.dom.container.querySelector(".player-poster"),l.dom.posterImg=l.dom.poster.querySelector(".poster"),l.dom.barContainer=l.dom.control.querySelector(".bar-container"),l.dom.barScrubber=l.dom.control.querySelector(".bar-scrubber"),l.dom.barLoaded=l.dom.control.querySelector(".bar-fill-1"),l.dom.barPosition=l.dom.control.querySelector(".bar-fill-2"),l.dom.barHover=l.dom.control.querySelector(".bar-hover"),l.dom.controlLayer=l.dom.control.querySelector(".media-control-layer"),l.dom.controlBG=l.dom.control.querySelector(".media-control-bg"),l.dom.controlTip=l.dom.control.querySelector(".media-tip"),l.dom.playBtn=l.dom.control.querySelector(".start-btn"),l.dom.nextBtn=l.dom.control.querySelector(".next-btn"),l.dom.prevBtn=l.dom.control.querySelector(".prev-btn"),l.dom.timeRunning=l.dom.control.querySelector(".time-running"),l.dom.timeTotal=l.dom.control.querySelector(".time-total"),l.dom.hd=l.dom.control.querySelector(".hd"),l.dom.playlistBtn=l.dom.control.querySelector(".playlist-btn"),l.dom.minimize=l.dom.control.querySelector(".minimize"),l.dom.auto=l.dom.control.querySelector(".auto"),l.dom.volumeIcon=l.dom.control.querySelector(".volume-icon"),l.dom.volumeBarContainer=l.dom.control.querySelector(".volume-bar-container"),l.dom.volumeBars=l.dom.volumeBarContainer.querySelectorAll(".bar"),l.dom.fullScreenBtn=l.dom.control.querySelector(".full-screen"),l.dom.seekTimer=l.dom.control.querySelector(".seek-time"),l.dom.timer=l.dom.control.querySelector(".timer"),l.dom.playlist=null,l.dom.player.style.width=r.width?r.width+"px":"100%",l.dom.player.style.height=r.height?r.height+"px":"100%",l.dom.timeRunning.innerHTML="00:00",l.dom.timeTotal.innerHTML="00:00",!r.chatVersion&&l.showMinMax||(l.dom.minimize.style.display="none"),l.debug&&(l.dom.debug.style.display="block"),l.dom.poster.appendChild(l.provider),n.miniPlayer.parent=l.parent.parentNode,i=l.dom.player.requestFullscreen||l.dom.player.mozRequestFullScreen||l.dom.player.webkitRequestFullScreen,o=document.cancelFullscreen||document.exitFullscreen||document.webkitCancelFullScreen;function T(){var e=document.mozFullScreen||document.webkitIsFullScreen;e||"FULL"!==l.screenState||l.fullScreen()}function h(e){var t=e.which||e.keyCode||e.key;n.miniPlayer.player||32===t&&l.playPause()}function I(e){e.stopPropagation(),l.playPause()}function _(e){e.stopPropagation(),l.playNext()}function A(e){e.stopPropagation(),l.playPrev()}function S(e){e.stopPropagation(),l.muteUnmute()}function C(e){e.stopPropagation(),l.fullScreen()}function v(e){e.stopPropagation(),l.minimize()}function D(e){l.timeInfo(e),l.isMouseDown&&l.setPosition(e,!1)}function R(){l.isMouseDown=!0,t.addRemoveClass(l.dom.barContainer,["down"],[])}function M(e){l.isMouseDown=!1,l.setPosition(e,!0),t.addRemoveClass(l.dom.barContainer,[],["down"])}function N(){l.isMouseDown=!1,t.addRemoveClass(l.dom.barContainer,[],["down"])}function y(e){return e.stopPropagation(),l.playlistState?void l.showPlaylist(!1):void l.playPause()}function b(e){e.stopPropagation(),l.showControl(!0)}function O(e){e.stopPropagation(),l.showControl(!1)}function P(e){e.stopPropagation(),n.miniPlayer.player&&l.maximize(),l.showPlaylist()}function L(e){e.stopPropagation(),l.setAuto()}function U(e){e.stopPropagation(),l.showTootip(e,this.getAttribute("tooltip"))}function F(e){e.stopPropagation(),l.dom.controlTip.style.display="none"}function w(e){e.stopPropagation(),l.showTootip(e,this.getAttribute("tooltip"))}function k(e){e.stopPropagation(),l.dom.controlTip.style.display="none"}function $(e){e.stopPropagation(),l.showTootip(e,this.getAttribute("tooltip"))}function G(e){e.stopPropagation(),l.dom.controlTip.style.display="none"}function B(e){e.stopPropagation(),l.showTootip(e,this.getAttribute("tooltip"))}function H(e){e.stopPropagation(),l.dom.controlTip.style.display="none"}function x(e){var t;e.stopPropagation(),t=parseInt(this.getAttribute("data-rel"),10),l.changeVolume(t)}function Y(e){d=!0,u&&fastdom.read(function(){n.miniPlayer.dom.resize&&(document.body.style.cursor="move",n.miniPlayer.dom.resize.style.cursor="move",l.dom.container.style.cursor="move",fastdom.write(function(){e.clientX+a>=200&&e.clientX+a<=p-m-210&&(n.miniPlayer.dom.container.style.left=e.clientX+a+"px"),e.clientY+s>=50&&e.clientY+s<=f-E&&(n.miniPlayer.dom.container.style.top=e.clientY+s+"px")}))})}function K(e){e.stopPropagation(),u=!1,document.body.style.cursor="default",n.miniPlayer.dom.resize.style.cursor="ns-resize",l.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",K)}function j(e){e.preventDefault(),e.stopPropagation(),u=!0,p=window.innerWidth,f=window.innerHeight,a=n.miniPlayer.dom.container.offsetLeft-e.clientX,s=n.miniPlayer.dom.container.offsetTop-e.clientY,document.addEventListener("mousemove",Y,!1),document.addEventListener("mouseup",K,!1)}function V(){return d?void(d=!1):void l.playPause()}function W(e){g&&fastdom.read(function(){var t,r;n.miniPlayer.dom.container&&(t=n.miniPlayer.dom.container.offsetHeight,r=parseInt(n.miniPlayer.dom.container.style.top.replace("px",""),10),fastdom.write(function(){document.body.style.cursor="ns-resize",n.miniPlayer.dom.move.style.cursor="ns-resize",l.dom.container.style.cursor="ns-resize",c>=e.clientY&&t<250&&(t+=3,r-=3,n.miniPlayer.dom.container.style.height=t+"px",n.miniPlayer.dom.container.style.top=r+"px",c=e.clientY),c<e.clientY&&t>120&&(t-=3,r+=3,n.miniPlayer.dom.container.style.height=t+"px",n.miniPlayer.dom.container.style.top=r+"px",c=e.clientY)}))})}function q(e){e.stopPropagation(),g=!1,document.body.style.cursor="default",n.miniPlayer.dom.move.style.cursor="move",l.dom.container.style.cursor="pointer",document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",q)}function z(e){e.preventDefault(),e.stopPropagation(),g=!0,p=window.innerWidth,f=window.innerHeight,c=e.clientY,document.addEventListener("mousemove",W,!1),document.addEventListener("mouseup",q,!1)}function Q(e){e.preventDefault(),e.stopPropagation(),l.maximize()}function X(e){e.preventDefault(),e.stopPropagation(),n.closeMiniPlayer()}return l.initEvent=function(){var e;for(l.dom.playBtn.addEventListener("click",I,!1),l.dom.nextBtn.addEventListener("click",_,!1),l.dom.prevBtn.addEventListener("click",A,!1),l.dom.volumeIcon.addEventListener("click",S,!1),l.dom.fullScreenBtn.addEventListener("click",C,!1),l.dom.minimize.addEventListener("click",v,!1),l.dom.barContainer.addEventListener("mousemove",D,!1),l.dom.barContainer.addEventListener("mousedown",R,!1),l.dom.barContainer.addEventListener("mouseup",M,!1),l.dom.barContainer.addEventListener("mouseleave",N,!1),l.dom.container.addEventListener("click",y,!1),l.dom.player.addEventListener("mouseover",b,!1),l.dom.player.addEventListener("mouseleave",O,!1),l.dom.playlistBtn.addEventListener("click",P,!1),l.dom.auto.addEventListener("click",L,!1),e=0;e<l.dom.volumeBars.length;e++)l.dom.volumeBars[e].addEventListener("click",x);l.dom.auto.addEventListener("mouseover",U,!1),l.dom.auto.addEventListener("mouseleave",F,!1),l.dom.minimize.addEventListener("mouseover",w,!1),l.dom.minimize.addEventListener("mouseleave",k,!1),l.dom.fullScreenBtn.addEventListener("mouseover",$,!1),l.dom.fullScreenBtn.addEventListener("mouseleave",G,!1),l.dom.playlistBtn.addEventListener("mouseover",B,!1),l.dom.playlistBtn.addEventListener("mouseleave",H,!1),document.addEventListener("mozfullscreenchange",T,!1),document.addEventListener("webkitfullscreenchange",T,!1),document.addEventListener("fullscreenchange",T,!1),document.addEventListener("keyup",h,!1),l.setMediaEvent(),l.createPlaylist(),l.showPoster(!0),l.auto&&l.setAuto(!0)},l.setMediaEvent=function(){l.provider.addEventListener("loadedmetadata",function(){l.initTime(l.provider.duration),l.autoPlay&&l.play()}),l.provider.addEventListener("timeupdate",function(){var e,t,n,r;l.provider&&!l.isMouseDown&&(r=l.provider.duration,n=l.provider.currentTime,e=l.provider.buffered.length>0?l.provider.buffered.end(l.provider.buffered.length-1):0,t=n+.05>=e?"BUFFERING":"PLAYING_BUFFERING",(4!==l.provider.readyState||n<.05||0===e)&&(t="BUFFERING"),l.showBuffered(e,r),l.stateChanged(t),l.bufferState=t,l.showPosition(n,r),l.showDebug())}),l.provider.addEventListener("play",function(){l.stateChanged("PLAYING"),"video"===l.mediaType&&l.showPoster(!1),angular.isFunction(r.scope.onStart())&&r.scope.onStart()()}),l.provider.addEventListener("pause",function(){l.stateChanged("PAUSED"),"video"===l.mediaType&&l.showPoster(!1)}),l.provider.addEventListener("ended",function(){l.stateChanged("ENDED"),"video"===l.mediaType&&l.showPoster(!1),angular.isFunction(r.scope.onEnded())&&r.scope.onEnded()()}),l.provider.addEventListener("stalled",function(){!l.provider}),l.provider.addEventListener("error",function(){l.provider&&(l.error=l.provider.error.code,l.canPlay=!1,l.showError())})},l.removeEvent=function(){var e;for(l.dom.playBtn.removeEventListener("click",I),l.dom.nextBtn.removeEventListener("click",_),l.dom.prevBtn.removeEventListener("click",A),l.dom.volumeIcon.removeEventListener("click",S),l.dom.fullScreenBtn.removeEventListener("click",C),l.dom.minimize.removeEventListener("click",v),l.dom.barContainer.removeEventListener("mousemove",D),l.dom.barContainer.removeEventListener("mousedown",R),l.dom.barContainer.removeEventListener("mouseup",M),l.dom.barContainer.removeEventListener("mouseleave",N),l.dom.container.removeEventListener("click",y),l.dom.player.removeEventListener("mouseover",b),l.dom.player.removeEventListener("mouseleave",O),l.dom.playlistBtn.removeEventListener("click",P),l.dom.auto.removeEventListener("click",L),e=0;e<l.dom.volumeBars.length;e++)l.dom.volumeBars[e].removeEventListener("click",x);l.dom.auto.removeEventListener("mouseover",U),l.dom.auto.removeEventListener("mouseleave",F),l.dom.minimize.removeEventListener("mouseover",w),l.dom.minimize.removeEventListener("mouseleave",k),l.dom.fullScreenBtn.removeEventListener("mouseover",$),l.dom.fullScreenBtn.removeEventListener("mouseleave",G),l.dom.playlistBtn.removeEventListener("mouseover",B),l.dom.playlistBtn.removeEventListener("mouseleave",H),document.removeEventListener("mozfullscreenchange",T),document.removeEventListener("webkitfullscreenchange",T),document.removeEventListener("fullscreenchange",T),document.removeEventListener("keyup",h)},l.maximize=function(){if(n.miniPlayer.player)return r.ringboxMaximize(n.miniPlayer.parent,l.parent),"PLAYING"===l.playingState&&setTimeout(function(){l.provider.play()}),n.miniPlayer.dom.move.removeEventListener("mousedown",j),n.miniPlayer.dom.move.removeEventListener("click",V),n.miniPlayer.dom.resize.removeEventListener("mousedown",z),n.miniPlayer.dom.close.removeEventListener("click",X),n.miniPlayer.dom.maximize.removeEventListener("click",Q),n.miniPlayer.dom.container.parentNode.removeChild(n.miniPlayer.dom.container),n.miniPlayer.dom={container:null,move:null,resize:null,maximize:null,close:null},n.miniPlayer.player=null,t.addRemoveClass(l.dom.minimize,["icon-minimize"],["icon-maximize"]),l.dom.fullScreenBtn.style.display="block",void l.dom.minimize.setAttribute("tooltip",t.dicts.minimize)},l.minimize=function(){var e=document.createElement("div"),i=document.createElement("a"),o=document.createElement("div"),a=document.createElement("div"),s=document.createElement("a");return n.miniPlayer.player?void l.maximize():(s.setAttribute("class","mini-close"),s.innerHTML='<div class="img_sprite w-h-16px icon-close pop-close"></div>',i.setAttribute("class","img_sprite w-h-18px maximize icon-maximize"),i.setAttribute("style","position: absolute;right: 22px;top: 5px;color: #fff;"),o.setAttribute("class","move-player"),o.appendChild(i),o.appendChild(s),e.setAttribute("id","mini-player"),e.setAttribute("class","mini-player"),a.setAttribute("class","resize-player"),e.style.display="none",e.appendChild(o),e.appendChild(a),document.body.appendChild(e),l.showPlaylist(!0),l.showControl(!0),n.miniPlayer.dom.container=e,n.miniPlayer.dom.resize=a,n.miniPlayer.dom.move=o,n.miniPlayer.dom.close=s,n.miniPlayer.dom.maximize=i,n.miniPlayer.player=l,l.dom.minimize.setAttribute("tooltip",t.dicts.maximize),r.ringboxMinimize(),f="FULL"===l.screenState?n.wh:window.innerHeight,e.style.top=f-E+"px",t.addRemoveClass(l.dom.minimize,["icon-maximize"],["icon-minimize"]),l.dom.fullScreenBtn.style.display="none",s.addEventListener("click",X,!1),i.addEventListener("click",Q,!1),o.addEventListener("mousedown",j,!1),o.addEventListener("click",V,!1),a.addEventListener("mousedown",z,!1),void(s=i=a=o=e=null))},l.playPause=function(){if(l.canPlay)return"PLAYING"===l.playingState?(l.pause(),l.showLoader(),l.showBigPlay(),l.showControl(!1),l.showPlaylist(!0),void l.showInfo(!0)):"PAUSED"===l.playingState?(l.resume(),l.showLoader(),l.showBigPlay(),void l.showInfo()):"STOPPED"===l.playingState?(l.play(),l.showLoader(),l.showBigPlay(),l.showPlaylist(!0),void l.showInfo()):void 0},l.muteUnmute=function(){return"UNMUTE"===l.volumeState?(l.setVolume(0),t.addRemoveClass(l.dom.volumeIcon,["icon-speaker-m"],["icon-speaker-fill"]),void(l.volumeState="MUTE")):"MUTE"===l.volumeState?(l.setVolume(l.volume),t.addRemoveClass(l.dom.volumeIcon,["icon-speaker-fill"],["icon-speaker-m"]),void(l.volumeState="UNMUTE")):void 0},l.initTime=function(e){l.dom.timeTotal.innerHTML=t.secToTime(e),l.duration=e},l.showPosition=function(e,n){0===l.duration&&n>0&&l.initTime(n),e>n&&l.initTime(e),l.dom.timeRunning.innerHTML=t.secToTime(e),l.dom.barScrubber.style.left=0===l.duration?"-"+l.dom.barScrubber.offsetWidth/2+"px":"calc("+e/l.duration*100+"% - "+l.dom.barScrubber.offsetWidth/2+"px)",l.dom.barPosition.style.width=0===l.duration?"0%":e/l.duration*100+"%"},l.showBuffered=function(e,t){0===l.duration&&t>0&&l.initTime(t),l.dom.barLoaded.style.width=0===l.duration?"0%":e/l.duration*100+"%"},l.timeInfo=function(e){var n,r="FULL"===l.screenState?{x:0,y:0}:t.findPos(l.dom.barContainer),i=e.pageX-r.x;n=Math.round(i*l.duration/l.dom.barContainer.offsetWidth),n<0&&(n=0),l.dom.timer.innerHTML=t.secToTime(n),l.dom.seekTimer.style.left=i-l.dom.seekTimer.offsetWidth/2+"px",l.dom.barHover.style.left=i-l.dom.barHover.offsetWidth/2+"px"},l.showTootip=function(e,n){var r,i,o="FULL"===l.screenState?{x:0,y:0}:t.findPos(l.dom.barContainer),a=e.pageX-o.x;l.dom.controlTip.innerHTML=n,l.dom.controlTip.style.display="block",i=l.dom.barContainer.offsetWidth,r=l.dom.controlTip.offsetWidth,a=i<=r/2+a?i-r/2:a,l.dom.controlTip.style.left=a-r/2+"px"},l.setPosition=function(e,n){var r,i,o;"STOPPED"!==l.playingState&&l.canPlay&&(r="FULL"===l.screenState?{x:0,y:0}:t.findPos(l.dom.barContainer),i=e.pageX-r.x,o=Math.round(i*l.duration/l.dom.barContainer.offsetWidth),n&&l.seek(o),l.showPosition(o))},l.changeVolume=function(e){var n;for(n=0;n<l.dom.volumeBars.length;n++)t.addRemoveClass(l.dom.volumeBars[n],[],["fill"]);for(n=0;n<=e;n++)t.addRemoveClass(l.dom.volumeBars[n],["fill"],[]);return l.volume=e+1,"MUTE"===l.volumeState?void l.muteUnmute():void l.setVolume(l.volume)},l.showHD=function(){l.hd?l.dom.hd.style.display="inline-block":l.dom.hd.style.display="none"},l.showPoster=function(e){""!==l.poster&&(e?(l.dom.posterImg.src=l.poster,l.dom.posterImg.style.display="inline-block"):l.dom.posterImg.style.display="none")},l.showInfo=function(e){var n;""===l.title||"audio"!==l.mediaType||e?l.dom.playInfo.style.display="none":(l.dom.playInfo.innerHTML=l.title,l.dom.playInfo.style.display="block"),l.playlist.length>0&&(n=l.playlist[l.currentTrack].value.getThumb(),n=t.getDefaultThumb(n),l.poster=n,"audio"===l.mediaType&&l.showPoster(!0))},l.showLoader=function(){l.isLoading&&l.canPlay&&"BUFFERING"===l.bufferState?l.dom.loader.style.display="block":l.dom.loader.style.display="none",l.showMusicBar(),l.showBigPlay()},l.showError=function(){l.dom.playError.innerHTML="Sorry, your browser does not support this media format.",l.showLoader(),l.canPlay?l.dom.playError.style.display="none":(l.showPoster(!1),l.dom.playError.style.display="block")},l.showBigPlay=function(e){return l.canPlay?(e?t.addRemoveClass(l.dom.bigBlayIcon,["icon-reload-p"],[]):t.addRemoveClass(l.dom.bigBlayIcon,[],["icon-reload-p"]),e&&"STOPPED"===l.playingState?void(l.dom.bigBlay.style.display="block"):("PAUSED"!==l.playingState&&"STOPPED"!==l.playingState||l.isLoading?l.dom.bigBlay.style.display="none":l.dom.bigBlay.style.display="block",void l.showMusicBar())):void(l.dom.bigBlay.style.display="none")},l.initPlaylist=function(){l.playlist.length>1?(l.dom.playlistBtn.style.display="inline-block",l.dom.prevBtn.style.display="inline-block",l.dom.nextBtn.style.display="inline-block",l.dom.auto.style.display="inline-block"):(l.dom.playlistBtn.style.display="none",l.dom.prevBtn.style.display="none",l.dom.nextBtn.style.display="none",l.dom.auto.style.display="none"),l.dom.playlistWrap.style.right="-250px"},l.showPlaylist=function(e){return l.playlistState||e?(l.dom.playlistWrap.style.right="-250px",l.dom.playlistWrap.style.zIndex=999,void(l.playlistState=!1)):l.playlistState?void 0:(l.dom.playlistWrap.style.right="0",l.dom.playlistWrap.style.zIndex=1e4,void(l.playlistState=!0))},l.createPlaylist=function(){var n,i,o,a='<div class="playlist-scrollbar-wrapper"><div rg-scrollbar="true" class="playlist-scrollbar"><ul class="playlist">';if(!(l.playlist.length<2)){for(i=0;i<l.playlist.length;i++)n=l.playlist[i].value.getThumb(),n=t.getDefaultThumb(n),o=t.trackTemplate.replace(/data-rel/g,i),o=o.replace(/data-thumb/g,n),o=o.replace(/data-caption/g,l.playlist[i].value.getCaption()),o=o.replace(/data-duration/g,t.secToTime(l.playlist[i].value.getDuration())),l.source===l.playlist[i].value.getStreamUrl()&&(l.currentTrack=i),a+="<li>"+o+"</li>";for(a+="</ul></div></div>",l.dom.playlistWrap.innerHTML="",l.dom.playlistWrap.appendChild(e(a)(r.scope)[0]),l.dom.playlistUL=l.dom.playlistWrap.querySelector(".playlist"),l.dom.playlist=l.dom.playlistWrap.querySelectorAll("ul.playlist > li > a"),r.scope.$parent.$rgDigest(),i=0;i<l.dom.playlist.length;i++)l.dom.playlist[i].addEventListener("click",function(e){e.preventDefault(),l.currentTrack=this.getAttribute("rel"),l.title=l.playlist[l.currentTrack].value.getCaption(),l.load(l.playlist[l.currentTrack].value.getStreamUrl())})}},l.updatePlaylist=function(e){e&&(l.playlist=e,l.createPlaylist())},l.addToPlaylist=function(e){var n,r,i,o;if(!l.dom.playlistUL)return void l.updatePlaylist(e);if(e&&l.dom.playlistUL)for(i=0;i<e.length;i++)o=document.createElement("li"),n=e[i].value.getThumb(),n=t.getDefaultThumb(n),r=t.trackTemplate.replace(/data-rel/g,i),r=r.replace(/data-thumb/g,n),r=r.replace(/data-caption/g,e[i].value.getCaption()),r=r.replace(/data-duration/g,t.secToTime(e[i].value.getDuration())),o.innerHTML=r,l.dom.playlistUL.appendChild(o)},l.setTrack=function(){var e;if(!(l.playlist.length<2)){for(0===l.currentTrack?t.addRemoveClass(l.dom.prevBtn,["disabled"],[]):t.addRemoveClass(l.dom.prevBtn,[],["disabled"]),l.currentTrack===l.playlist.length-1?t.addRemoveClass(l.dom.nextBtn,["disabled"],[]):t.addRemoveClass(l.dom.nextBtn,[],["disabled"]),e=0;e<l.dom.playlist.length;e++)e===l.currentTrack?t.addRemoveClass(l.dom.playlist[e],["active"],["active"]):t.addRemoveClass(l.dom.playlist[e],[],["active"]);l.showInfo()}},l.setAuto=function(e){return e?void t.addRemoveClass(l.dom.auto,["enbled"],[]):l.auto?(l.auto=!1,void t.addRemoveClass(l.dom.auto,[],["enbled"])):l.auto?void 0:(l.auto=!0,void t.addRemoveClass(l.dom.auto,["enbled"],[]))},l.showMusicBar=function(){"audio"!==l.mediaType||"PLAYING"!==l.playingState||"PLAYING_BUFFERING"!==l.bufferState||l.isLoading?l.dom.musicBar.style.display="none":l.dom.musicBar.style.display="block"},l.showControl=function(e){return n.miniPlayer.player?void(l.dom.controlLayer.style.bottom="0px"):void("PLAYING"===l.playingState&&e?(l.dom.controlLayer.style.bottom="0px",l.dom.controlBG.style.opacity=1):(l.dom.controlLayer.style.bottom="-60px",l.dom.controlBG.style.opacity=0))},l.showDebug=function(){var e;l.debug&&(e=l.provider.buffered.length>0?l.provider.buffered.end(l.provider.buffered.length-1):0,l.dom.debug.innerHTML="ready State: "+l.provider.readyState+" <br />Buffered: "+e+" <br />Current time: "+l.provider.currentTime+" <br />Playing State: "+l.playingState+" <br />Buffer State: "+l.bufferState+" <br />Loading State: "+(l.isLoading?"true":"false"))},l.stateChanged=function(e){"BUFFERING"===l.bufferState?l.isLoading=!0:l.isLoading=!1,"PLAYING"===e&&(l.playingState="PLAYING",l.showBigPlay(),t.addRemoveClass(l.dom.playBtn,["icon-pause-p"],["icon-play-p"])),"ENDED"!==e&&"IDLE"!==e||(l.playingState="STOPPED",l.bufferState="BUFFERING",l.isLoading=!1,l.showBigPlay(!0),l.showPlaylist(!0),t.addRemoveClass(l.dom.playBtn,["icon-play-p"],["icon-pause-p"]),l.initTime(0),l.showPosition(0),l.showInfo(!0),l.auto&&l.playlist.length>0&&l.playNext()),l.showLoader()},l.reset=function(){l.isLoading=!0,l.initTime(0),l.showPosition(0),l.showBuffered(0),l.showLoader(),l.showInfo()},l.fullScreen=function(){if(i)return"NORMAL"===l.screenState?(i.call(l.dom.player),l.screenState="FULL",l.showControl(!0),t.addRemoveClass(l.dom.player,["full"],[]),t.addRemoveClass(l.dom.fullScreenBtn,["icon-screen-fe"],["icon-screen-f"]),n.miniPlayer.dom.container&&t.addRemoveClass(n.miniPlayer.dom.container,["full"],[]),void l.dom.fullScreenBtn.setAttribute("tooltip",t.dicts.maximize)):"FULL"===l.screenState?(o.call(document),l.screenState="NORMAL",l.showControl(!1),t.addRemoveClass(l.dom.player,[],["full"]),t.addRemoveClass(l.dom.fullScreenBtn,["icon-screen-f"],["icon-screen-fe"]),n.miniPlayer.dom.container&&t.addRemoveClass(n.miniPlayer.dom.container,[],["full"]),n.escapeKey=!0,void l.dom.fullScreenBtn.setAttribute("tooltip",t.dicts.fullScreen)):void 0},l.playNext=function(){l.currentTrack!==l.playlist.length-1&&(l.currentTrack++,l.title=l.playlist[l.currentTrack].value.getCaption(),l.load(l.playlist[l.currentTrack].value.getStreamUrl()),r.onNext&&r.onNext.apply(r.scope))},l.playPrev=function(){0!==l.currentTrack&&(l.currentTrack--,l.title=l.playlist[l.currentTrack].value.getCaption(),l.load(l.playlist[l.currentTrack].value.getStreamUrl()),r.onNext&&r.onNext.apply(r.scope))},l.getPlaylistUI=function(){return l.dom.playlistWrap},l.getNextUI=function(){return l.dom.nextBtn},l.getPrevUI=function(){return l.dom.prevBtn},l.load=function(e){l.reset(),l.setTrack(),l.provider.pause(),l.seek(0),l.provider.src=e,l.source=e,angular.isFunction(r.scope.onChange())&&l.playlist.length>0&&r.scope.onChange()(l.playlist[l.currentTrack].value)},l.play=function(){l.provider.play(),l.playingState="PLAYING",t.addRemoveClass(l.dom.playBtn,["icon-pause-p"],["icon-play-p"])},l.pause=function(){l.provider.pause(),l.playingState="PAUSED",t.addRemoveClass(l.dom.playBtn,["icon-play-p"],["icon-pause-p"])},l.resume=function(){l.provider.play(),l.playingState="PLAYING",t.addRemoveClass(l.dom.playBtn,["icon-pause-p"],["icon-play-p"])},l.seek=function(e){try{l.provider.currentTime=e}catch(e){throw new Error("provider is not defined. So ignoring...")}},l.stop=function(){l.provider.pause(),l.seek(0),l.playingState="STOPPED",t.addRemoveClass(l.dom.playBtn,["icon-play-p"],["icon-pause-p"])},l.setVolume=function(e){l.provider.volume=e/10},l.initEvent(),l.showControl(),l.showLoader(),l.showBigPlay(),l.showError(),l.showInfo(),l.showMusicBar(),l.initPlaylist(),l.showHD(),l.playingState="STOPPED",l.provider.autoplay=!1,l.load(r.source),l.setVolume(l.volume),t.instances.push(l),l},n}]}angular.module("ringid.ui_player").directive("rgPlayer",rgPlayer),rgPlayer.$inject=["$compile","$player","$ringbox"];function rgPlayer(e,t,n){function r(e,r,i){var o,a=i.id?i.id:"player_1",s=i.width?i.width:"100%",c=i.height?i.height:"100%",l=!("false"===i.auto||i.auto===!1),u=i.url?i.url:"",d=i.title?i.title:"",g="true"===i.isVideo||i.isVideo===!1?"video":"audio",m=i.poster?i.poster:"",E=!("false"===i.autoPlay||i.autoPlay===!1),f="true"===i.chat||i.chat===!0,p=null,T=null;m&&"default_audio_image.jpg"!==m||(m="images/player-audio.png"),o='<div title="" id="player_'+a+'" class="player '+g+'"></div>',r.append(o),setTimeout(function(){p=t.player({source:u,title:d,playlist:e.playlist,auto:l,type:g,parentId:"player_"+a,autoPlay:E,chatVersion:f,width:s,height:c,poster:m,ringboxMinimize:n.minimize,ringboxMaximize:n.maximize,ringboxRemove:n.removeMinimize,scope:e}),T=r[0].closest(".ringbox-inner").querySelector(".player-size"),T&&T.addEventListener("click",h,!1)});function h(e){e.preventDefault(),e.stopPropagation(),p.minimize()}e.$on("$destroy",function(){T&&T.removeEventListener("click",h),T=null})}return{restrict:"E",scope:{onChange:"&",onStart:"&",onEnded:"&",playlist:"="},link:r}}!function(e,t){"use strict";e.module("ringid.utils",["ringid.config","ringid.global_services"])}(angular,window),angular.module("ringid.utils").directive("ogImageSrc",ogImageSrc).directive("rgUrlOgPreview",rgUrlOgPreview),ogImageSrc.$inject=["SystemEvents"];function ogImageSrc(e){return{restrict:"A",link:function(t,n,r){n[0].onload=function(){t.feedKey?t.$emit(e.FEED.HEIGHT,t.feedKey):t.$emit(e.RINGBOX.UPDATE)},n[0].src=r.ogImageSrc}}}rgUrlOgPreview.$inject=["$ringhttp","$templateCache","$compile","Utils"];function rgUrlOgPreview(e,t,n,r){return{restrict:"E",replace:!0,scope:{onClick:"&",ogData:"=",showPreview:"=",loadingData:"=",editMode:"@",feedKey:"@"},templateUrl:"",link:function(t,r,i){var o="templates/partials/url-og-preview.html";i.template&&(o=i.template),e.get(o).success(function(e){r.append(n(e)(t)),t.$rgDigest()})},controller:["$scope","$sce","settings",function(e,t,n){e.selectedOgImageIndex=0,e.onClick=o,e.onImageCloseClick=p,e.onDetailCloseClick=T,e.selectPreviousImage=f,e.selectNextImage=E,e.shouldShowNextButton=h,e.shouldShowPreviousButton=I,e.isYoutubeUrl=M,e.getYoutubeUrl=y,e.filterOnProgress=!1,e.ogData.title=decodeEntities(e.ogData.title),e.ogData.description=decodeEntities(e.ogData.description),e.shouldShowNextPreviousButtonContainer=_,e.shouldShowImageCloseButton=A,e.init=function(){e.ogData&&e.ogData.url&&(m(),b(e.ogData.url),e.ogData.url&&(/^https?:\/\//.test(e.ogData.url)||(e.ogData.url="http://"+e.ogData.url)),e.ogData.image&&(/^https?:\/\//.test(e.ogData.image)||(e.ogData.image="http://"+e.ogData.image),n.secure&&/^http:/.test(e.ogData.image)&&(e.ogData.image=n.httpsUrl+"/ImageProxy.png?url="+e.ogData.image.replace(/http:\/\//,""))),e.ogData.images&&e.ogData.images.length>0&&O())},e.$watch("ogData",function(){e.init()});function i(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){r.safeDigest(e)}}function o(){var t;e.ogData&&!e.ogData.images&&(t=e.ogData.url,t&&window.open(t,"_blank"))}function a(){e.ogData.images&&(e.ogData.image=e.ogData.images[e.selectedOgImageIndex])}function s(){e.ogData.image=""}function c(){e.ogData.title=""}function l(){e.ogData.description=""}function u(){e.ogData.url=""}function d(){e.ogData.lnkDmn=""}function g(t,n){e.ogData.meta[t]=n}function m(){e.ogData.meta={youtube:!1,youtube_id:""}}function E(){e.selectedOgImageIndex<e.ogData.images.length-1&&(e.selectedOgImageIndex+=1),a(),i()}function f(){e.selectedOgImageIndex>0&&(e.selectedOgImageIndex-=1),a(),i()}function p(e){e.preventDefault(),e.stopPropagation(),s(),i()}function T(e){e.preventDefault(),e.stopPropagation(),c(),l(),u(),d(),i()}function h(){return!!e.ogData.images&&e.selectedOgImageIndex<e.ogData.images.length-1}function I(){return e.selectedOgImageIndex>0}function _(){return!!e.editMode&&!!e.ogData.image&&!!e.ogData.filteredImages&&e.ogData.filteredImages.length>1}function A(){return!!e.editMode&&!e.filterOnProgress&&!!e.ogData.image}function S(){e.filterOnProgress=!0}function C(){e.filterOnProgress=!1}function v(t){e.ogData.filteredImages.push(t)}function D(){e.ogData.filteredImages=[]}function R(t){e.ogData.image=t}function M(){return!e.ogData.meta&&e.ogData.url&&(m(),b(e.ogData.url)),!!e.ogData.meta&&e.ogData.meta.youtube}function N(){return e.ogData.meta.youtube_id}function y(){return t.trustAsResourceUrl("https://www.youtube.com/embed/"+N()+"?autoplay=0&autohide=1&border=0&wmode=opaque&enablejsapi=1")}function b(e){var t,n=/((http|https):\/{2})+((www\.)?youtube\.com)([?&]?([^=]+)=([^&]*))?/im;e&&(t=e.match(n),t&&t[3]&&t[7]?(g("youtube",!0),g("youtube_id",t[7])):g("youtube",!1))}function O(){var t;D(),S(),t=e.ogData.images,r.filterImagesByDimentions(t,{width:200}).then(function(n){
RingLogger.log(n,RingLogger.tags.IMAGE),RingLogger.log(t,RingLogger.tags.IMAGE),e.ogData.image||R(n),v(n),e.filterOnProgress&&C(),i()},function(){},function(t){RingLogger.log(t,RingLogger.tags.IMAGE),v(t),e.ogData.image||R(t),RingLogger.log(e.ogData.image,RingLogger.tags.IMAGE),i()})}}]}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){RingLogger.warn("Utils Module Not Found")}ringUtilsModule.directive("rgUrlOgFetcher",rgUrlOgFetcher),rgUrlOgFetcher.$inject=[];function rgUrlOgFetcher(){return{restrict:"E",scope:{fetchedOgInfo:"=",editorContent:"=",showPreview:"=",filterOnProgress:"=",loadingData:"="},link:function(e){e.fetchedOgInfo=e.fetchedOgInfo||{},e.filterOnProgress&&(e.filterOnProgress=!1)},controller:["$scope","$rootScope","$timeout","Utils","settings",function(e,t,n,r,i){var o,a={},s="";o=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\.\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im;function c(){try{e.$parent.$parent?e.$parent.$parent.$rgDigest():e.$parent.$rgDigest()}catch(t){r.safeDigest(e)}}RingLogger.tags.DIGEST&&e.$watch(function(){RingLogger.info("from rgUrlOgFetcher",RingLogger.tags.DIGEST)}),e.$watch("editorContent",r.debounce(function(e,t){l(e,t),c()},500));function l(t,n){var i,a,s,l,T;if(C(t,n)){if(t&&o.test(t)){if(RingLogger.debug("Updated Value ",t,RingLogger.tags.OG_FETCHER),i=t.match(o),a=i[1]){if(T=i[5]?i[5]:"",/^https?:\/\//.test(a)||(a="http://"+a),RingLogger.debug("Detected Url",a,RingLogger.tags.OG_FETCHER),!u(a))return;RingLogger.log("Starting to Fetch Url",a,RingLogger.tags.OG_FETCHER),s=g(a),s?(m(s),h(),S()):(f(),S(),c(),r.getOGDetails(a).success(function(e){l=e,p(),RingLogger.debug("Server Response :",l,RingLogger.tags.OG_FETCHER),l&&l.sucs?(d(a,l),l.lnkDmn=T,l.url=a,l=A(l,a),m(l),h()):(E(),I()),S(),c()}).error(function(){E(),_(),I(),p(),S(),c()}))}}else E(),I();e.$parent.$rgDigest()}}function u(t){return e.fetchedOgInfo&&s===t?(RingLogger.log("Same Url Will Not Fetch",RingLogger.tags.OG_FETCHER),!1):(s=t,!0)}function d(e,t){a[e]=t}function g(e){return a[e]}function m(t){e.fetchedOgInfo=t}function E(){e.fetchedOgInfo={}}function f(){e.loadingData=!0}function p(){e.loadingData=!1}function T(){return e.loadingData}function h(){e.showPreview=!0}function I(){e.showPreview=!1}function _(){s=""}function A(e,t){var n,r,o=angular.extend({},e);if(o.url||(o.url=t),o.title||(o.title=o.lnkDmn),e.images)for(n=e.images.length,r=0;r<n;r++)i.secure&&/^http:/.test(e.images[r])&&(e.images[r]=i.httpsUrl+"/ImageProxy.png?url="+e.images[r].replace(/http:\/\//,""));return o.title=decodeEntities(o.title),o.description=decodeEntities(o.description),o}function S(){n(function(){t.$broadcast("statusHeightChange")})}function C(){return!T()&&((!e.fetchedOgInfo||!(e.fetchedOgInfo.image||e.fetchedOgInfo.title||e.fetchedOgInfo.description))&&(_(),!0))}}]}}angular.module("ringid.utils").directive("rgLoaderView",rgLoaderView).directive("rgLoaderView1",rgLoaderView1).directive("rgLoaderView2",rgLoaderView2);function rgLoaderView(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view.html"}}function rgLoaderView1(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"templates/partials/loading_view1.html"}}function rgLoaderView2(){return{restrict:"E",scope:{isLoading:"="},templateUrl:"templates/partials/loading_view2.html"}}angular.module("ringid.utils").directive("rgCompile",["$compile",function(e){return function(t,n,r){t.$watch(function(){return t.$eval(r.rgCompile)},function(r){n.html(r),e(n.contents())(t)})}}]);var app;app=angular.module("ringid.utils"),app.directive("rgKeyUp",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(e){}}t.bind("keyup",r),e.$on("$destroy",function(){t.unbind("keyup",r)})}}),app.directive("rgKeyPress",function(){return function(e,t,n){function r(t){try{e[n.rgKeyUp](t),e.$rgDigest()}catch(e){RingLogger.alert(e,"DEBUG")}}t.bind("keypress",r),e.$on("$destroy",function(){t.unbind("keypress",r)})}}),angular.module("ringid.utils").directive("midWidth",midWidth),midWidth.$inject=["Utils","SystemEvents"];function midWidth(e,t){return function(n,r){function i(t){var n=e.calCulateCellWidth(t);r.removeClass("cols-1 cols-2 cols-3"),r.addClass("cols-"+t),n?r.css({width:n*t+10*t-20+"px"}):r.css({width:"415px"})}n.$on(t.COMMON.COLUMN_CHANGED,function(e,t){i(t)}),n.$on(t.COMMON.WINDOW_RESIZED,function(t,n){i(e.feedColumn())}),n.$on("$routeChangeSuccess",function(t,n){i(e.feedColumn())}),i(e.feedColumn())}}!function(e,t){"use strict";e.module("ringid.directives",["ringid.config","ringid.connector","ringid.global_services"])}(angular,window);function loadTemplate(e,t,n,r,i){r.get(e).success(function(e){n.append(i(e)(t)),t.$rgDigest()})}angular.module("ringid.directives").directive("rgTemplate",["$ringhttp","$compile",function(e,t){return{restrict:"AE",link:function(n,r,i){loadTemplate(i.templateUrl,n,r,e,t)}}}]).directive("userSearchInput",[function(){return{scope:{searchKey:"="},restrict:"AE",templateUrl:"pages/partials/usercards/search-input.html"}}]).directive("userInfoView1",[function(){return{restrict:"AE",templateUrl:"pages/partials/usercards/user-info-view-1.html",link:function(e,t,n){n.userActionsTpl&&(e.userActionsTpl=n.userActionsTpl),e.$watch(function(){return e.member.getUser()},function(){e.$rgDigest()}),!e.member.getUser()}}}]).directive("userMemberType",["$ringhttp","$compile",function(e,t){return{restrict:"AE",link:function(n,r,i){var o="pages/partials/usercards/member-type.html";i.templateUrl&&(o=i.templateUrl),loadTemplate(o,n,r,e,t)}}}]).directive("userActions",["$ringhttp","$compile",function(e,t){return{restrict:"AE",link:function(n,r,i){var o="pages/partials/usercards/user-actions.html";i.templateUrl&&(o=i.templateUrl),loadTemplate(o,n,r,e,t)}}}]).directive("friendOnlineStatus",["$ringhttp","$compile",function(e,t){return{restrict:"AE",replace:!0,scope:{user:"="},link:function(n,r,i){var o="pages/partials/friend-online-status.html";i.templateUrl&&(o=i.templateUrl),loadTemplate(o,n,r,e,t)}}}]).directive("userFriendshipType",["$ringhttp","$compile","rgDropdownService","Ringalert","friendsFactory","APP_CONSTANTS",function(e,t,n,r,i,o){return{restrict:"AE",link:function(a,s,c){var l=a.member.isCurrentUser(),u="pages/partials/usercards/user-friendship-type.html";function d(){return a.member&&a.member.getUser()?a.member.getUser().friendshipStatus():-1}function g(){var e=d();switch(e){case o.NOT_FRIEND:a.actionObject={action:"addfriend"},a.friendTypeText="Add Friend",a.friendTypeClass="add-fnd";break;case o.FRIEND:a.friendTypeText="Friend",a.friendTypeClass="fnd";break;case o.INCOMING_FRIEND:a.actionObject={action:"accept"},a.friendTypeText="Accept",a.friendTypeClass="accept";break;case o.OUTGOING_FRIEND:a.actionObject={action:"reject"},a.friendTypeText="Cancel Request",a.friendTypeClass="cancel-req";break;default:a.friendTypeClass=""}}function m(e){var t;n.close(e),t=a.member.getUser().friendshipStatus(),t!==o.FRIEND&&(a.member.getUser().isLoading()||(a.actionObject.event=e,a.actionObject.friend=a.member.getUser(),i.friendAction(a.actionObject,!0).then(function(){a.$rgDigest()},function(){a.$rgDigest()}))),a.$rgDigest()}l||(a.friendTypeText="",a.friendTypeClass="",a.memberAction=m,a.actionObject={},c.templateUrl&&(u=c.templateUrl),loadTemplate(u,a,s,e,t),a.$watch(d,function(){g()}),a.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),r.show("Coming soon","info")})}}}]);var app=angular.module("ringid.directives");app.directive("rgWizard",function(){return{restrict:"E",templateUrl:"pages/partials/wizard/base.html",link:function(e){if(!e.rgWizardData)return void RingLogger.warning("Please specify rg-wizard-data in scope for rg-wizad","GENERAL");e.nextButtonText="Next",e.doneButtonText="Done",e.showNextButton=!0,e.showDoneButton=!0,e.hideSteps=e.rgWizardData.hideSteps||!1,e.steps=e.rgWizardData.steps,e.totalSteps=e.steps.length,e.onFinish=n();function t(){var t;return e.steps.forEach(function(n){n.id===e.currentStep&&(t=n)}),t}function n(){return e.rgWizardData.onFinish}function r(t){return e.rgWizardData.steps[t]}e.totalSteps&&(e.currentStep=e.steps[0].id,e.isFinishStep=function(t){return t===e.steps[e.totalSteps-1].id},e.refreshStepParams=function(){var n=t();e.disableNextButton=!n.showNextButton(),e.isFinishStep(e.currentStep)?e.nextButtonText="Done":e.nextButtonText="Next",e.$rgDigest()},e.goToStep=function(t){var n=r(t),i=n.showNextButton();t>=0&&t<e.totalSteps&&i&&(e.currentStep=t,e.refreshStepParams())},e.goNextStep=function(){e.isFinishStep(e.currentStep)?(n().call(),e.$rgDigest()):e.currentStep<e.totalSteps-1&&(e.currentStep+=1,e.refreshStepParams())},e.goPrevStep=function(){e.currentStep>0&&(e.currentStep-=1,e.refreshStepParams())},e.$watch(function(){var e=t();return e.showNextButton()},function(){e.refreshStepParams()}),e.refreshStepParams())}}}),app.directive("rgWizardStepList",function(){return{restrict:"E",templateUrl:"pages/partials/wizard/steps.html",link:function(e){if(!e.rgWizardData)return void RingLogger.warning("Please specify rg-wizard-data in scope for rg-wizad","GENERAL")}}}),angular.module("ringid.directives").directive("rgRoundProgress",roundProgress);function roundProgress(){var e;function t(e){var t,n,r,i,o,a,s,c,l,u,d;return 1===e.length&&(t=e[0],i=document.createElement("canvas"),{pre:function(e){var g=(window.outerWidth-20)/1920;n=+(e.roundProgressBarStyle.dataRoundProgressWidth||"200")*g,r=+(e.roundProgressBarStyle.dataRoundProgressHeight||"200")*g,i.setAttribute("width",n),i.setAttribute("height",r),i.setAttribute("data-round-progress-model",t.getAttribute("data-round-progress-model")),t.parentNode.replaceChild(i,t),o=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleWidth||"4")*g,a=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleWidth||"8")*g,l=+(e.roundProgressBarStyle.dataRoundProgressOuterCircleRadius||"85")*g,u=+(e.roundProgressBarStyle.dataRoundProgressInnerCircleRadius||"85")*g,d=+(e.roundProgressBarStyle.dataRoundProgressLabelFont||"24")*g+"px Arial",s=e.roundProgressBarStyle.dataRoundProgressOuterCircleForegroundColor||"#13A8E8",c=e.roundProgressBarStyle.dataRoundProgressLabelColor||"#fff"},post:function(e){var t,g,m,E,f,p,T=i.getAttribute("data-round-progress-model");e.$watch(T,function(e,h){RingLogger.print(T,e,h,RingLogger.tags.PROFILE),t=i.getContext("2d"),t.clearRect(0,0,n,r),g=n/2,m=r/2,t.beginPath(),t.arc(g,m,parseInt(u,10),0,2*Math.PI,!1),t.lineWidth=parseInt(a,10),t.strokeStyle="rgba(255,255,255,0.5)",t.globalCompositeOperation="source-over",t.stroke(),t.font=d,t.textAlign="center",t.textBaseline="middle",t.fillStyle=c,t.fillText(e.label+"%",g,m),E=-(Math.PI/2),f=2*Math.PI*e.percentage-Math.PI/2,p=!1,t.beginPath(),t.arc(g,m,parseInt(l,10),E,f,p),t.lineWidth=parseInt(o,10),t.strokeStyle=s,t.stroke()},!0)}})}return e={compile:t,replace:!0}}angular.module("ringid.directives").directive("rgLoading",rgLoading),rgLoading.$inject=["$rootScope","SystemEvents"];function rgLoading(e,t){function n(n,r){e.$on(t.AUTH.LOGIN,function(){r[0].style.display="none",n.$rgDigest()}),e.$on(t.LOADING,function(e,t){t?r[0].style.display="block":r[0].style.display="none"}),r[0].style.display="none"}return{restrict:"E",template:'<a class="glo-l ng-cloak"> <span class="load-circle"><span class="ld-cir1 glo-cir"></span><span class="ld-cir2 glo-cir"></span><span class="ld-cir3 glo-cir"></span><span class="ld-cir4 glo-cir"></span><span class="ld-cir5 glo-cir"></span><span class="ld-cir6 glo-cir"></span><span class="ld-cir7 glo-cir"></span><span class="ld-cir8 glo-cir"></span><span class="ld-cir9 glo-cir"></span><span class="ld-cir10 glo-cir"></span><span class="ld-cir11 glo-cir"></span><span class="ld-cir12 glo-cir"></span></span><span class="glo-type">Processing...</span></a>',scope:{rgLoadingObj:"="},link:n}}angular.module("ringid.directives").directive("rgGlobalLoader",rgGlobalLoader);function rgGlobalLoader(){return{restrict:"E",template:'<div id="global-loader" class="rgbubbling"><span id="rgbubbling_1"></span><span id="rgbubbling_2"></span><span id="rgbubbling_3"></span></div>'}}angular.module("ringid.directives").directive("rgEmotion",rgEmotionDirective).directive("rgEmotionDropdown",rgEmotionDropdown),rgEmotionDirective.$inject=["$compile","$document","EmotionFactory"];function rgEmotionDirective(e,t,n){function r(r,i){var o;r.active=!1,r.emotionFilterText="",r.initEMotionList=l,r.choose=c,i.on("click",d),t.on("click",g),r.close=u;function a(){RingLogger.info("from rgEmotionDir",RingLogger.tags.DIGEST)}RingLogger.tags.DIGEST&&r.$watch(a);function s(){r.$parent&&1!==r.$parent.$id?r.$parent.$rgDigest():r.$rgDigest()}function c(e,t){r.onSelect({item:e}),r.emotionFilterText="",r.initEMotionList("none",t),r.active=!1,s()}function l(t){n.init(),o||(o=e('<rg-emotion-dropdown filter-text="emotionFilterText" focus-filter="active" on-close="close" on-select="choose"></rg-emotion-dropdown>')(r),i.after(o)),o.css("display",t)}function u(e){r.active&&(r.initEMotionList("none",e),r.active=!1),s()}function d(e){e.preventDefault(),r.active?r.initEMotionList("none",e):r.initEMotionList("block",e),r.active=!r.active,s()}function g(e){e.target!==i[0]&&e.target.parentNode&&e.target.parentNode!==i[0]&&e.target.parentNode.parentNode!==i[0]&&"pt-top"!==e.target.className&&r.close(e)}r.$on("$destroy",function(){i.off("click",d),t.off("click",g),o=void 0})}return{restrict:"A",scope:{onSelect:"&"},link:r}}rgEmotionDropdown.$inject=["EmotionFactory"];function rgEmotionDropdown(e){function t(e){e.stopPropagation()}return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&onClose"},templateUrl:"templates/dropdowns/emotion-dropdown.html",compile:function(){return{pre:function(t){t.emotions={},t.emotions[0]=e.getEmotions(),t.setEmotion=function(e){t.emotions[0]=e,t.$rgDigest()},e.setScopeForDigest(t),t.updateModel=function(e){t.filterText=e.target.value,t.$parent.$rgDigest()},t.loading=!!t.emotions.length,t.choose=angular.isFunction(t.onSelect)?t.onSelect():angular.noop,t.close=angular.isFunction(t.onClose)?t.onClose():angular.noop,RingLogger.tags.DIGEST&&t.$watch(function(){RingLogger.info("from rgEmotionDropdownDir",RingLogger.tags.DIGEST)}),t.$on("$destroy",function(){e.removeScope(t)})},post:function(e,n){n.on("click",t),e.$on("$destroy",function(){n.off("click",t)}),e.$rgDigest()}}}}}angular.module("ringid.directives").directive("rgPhotos",rgPhotos),rgPhotos.$inject=["$window","$document","Utils"];function rgPhotos(e,t,n){r.$inject=["rgScrollbarService","$scope","$rootScope","AlbumFactory","$routeParams","userFactory","fileUploadService","SystemEvents","Auth","$ringbox","Ringalert","$$connector","OPERATION_TYPES"];function r(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E=g.SYSTEM.IMAGE;t.profileObj=o.getUser(i.uId),t.showAlbumPreview=!0,t.activeAlbum=null,t.state=r.state,t.albums=r.getAlbums(i.uId),t.loadMoreImage=p,t.deleteImage=h,t.getImageData=T,t.toggleAlbumPreview=I,t.selectPhoto=_;function f(n,r){"album"===r?t.state.albumsLoading=n:(t.state.imagesLoading=n,e.recalculate(t)),t.$rgDigest()}function p(){!t.state.imagesLoading&&t.activeAlbum.getImages().length()<t.activeAlbum.getTotalImageCount()&&(f(!0,"image"),r.loadMoreImage(t.activeAlbum.getKey(),i.uId))}function T(e){return function(){return{image:e,popupFrom:"profile"}}}function h(e){var n="Are you sure you want to delete?",i=l.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"});i.result.then(function(n){function i(n){n.sucs===!0?t.activeAlbum.removeImage(e.getKey()):u.show("Image delete failed","error"),t.$rgDigest()}n&&r.deleteImage(e).then(i)})}function I(e){e?(t.activeAlbum=e,t.showAlbumPreview=!1,t.activeAlbum.getImages().length()<20&&t.loadMoreImage()):(t.showAlbumPreview=!0,t.activeAlbum=null),t.$rgDigest()}function _(e){RingLogger.print("selected: "+e.src(),RingLogger.tags.IMAGE),t.forSelection&&n.$broadcast(s.IMAGE.DO_REPOSITION,{image:e.src()})}function A(){function e(e){switch(e.actn){case E.TYPE_ALBUM_IMAGES:case E.TYPE_FRIEND_ALBUM_IMAGES:e.sucs===!1&&1111===e.rc?(RingLogger.warning("ALBUM FETCH REQUEST REPEAT",RingLogger.tags.IMAGE),r.fetchAllAlbums(i.uId)):(r.processResponse(e),f(!1));break;case E.FETCH_FRIEND_ALBUM_LIST:case E.FETCH_ALBUM_LIST:e.sucs===!1&&1111===e.rc?(RingLogger.warning("ALBUM IMAGES FETCH REQUEST REPEAT",RingLogger.tags.IMAGE),p()):(r.processResponse(e,i.uId),f(!1,"album"));break;default:RingLogger.print("Case Mismatch",RingLogger.tags.IMAGE)}}m=d.subscribe(e,{action:[E.TYPE_ALBUM_IMAGES,E.TYPE_FRIEND_ALBUM_IMAGES,E.FETCH_FRIEND_ALBUM_LIST,E.FETCH_ALBUM_LIST]}),f(!0,"album"),r.fetchAllAlbums(i.uId)}A(),t.$on("$destroy",function(){t.albums.reset(),d.unsubscribe(m)})}function i(r,i){function o(){r.showAlbumPreview||e.innerHeight+e.scrollY>=t[0].body.offsetHeight&&r.loadMoreImage()}!r.hasOwnProperty("forSelection")||r.forSelection!==!0&&"true"!==r.forSelection?(r.forSelection=!1,e.addEventListener("scroll",o)):(i[0].children[0].children[0].style.overflow="hidden",i[0].children[0].children[0].style.maxHeight=n.viewportsize().y-200+"px"),r.$on("$destroy",function(){e.removeEventListener("scroll",o)}),r.$rgDigest()}return{restrict:"E",controller:r,link:i,templateUrl:"templates/partials/photos.html",scope:{forSelection:"@forSelection",$close:"&boxClose"}}}angular.module("ringid.directives").directive("rgHref",rgHref),rgHref.$inject=["$location","$route","$rootScope"];function rgHref(e,t,n){function r(r,i){var o=/#/g.exec(r);o=o?r.substr(o.index+1):r,e.path()===o&&"true"===i.reloadpage&&t.reload(),n.$coreDigest()}function i(e,t,n){var i;n.$observe("rgHref",function(e){return i&&t.unbind("click",r),e?(i=angular.bind(null,r,e,n),t.attr("href",e),void t.bind("click",i)):void t.removeAttr("href")}),e.$on("$destroy",function(){i&&t.unbind("click",i)})}return i}angular.module("ringid.directives").directive("rgHovercard",rgHovercard),rgHovercard.$inject=["$ringhttp","$templateCache","$compile"];function rgHovercard(e,t,n){function r(t,r,i){var o;function a(e){var a,s=!1;function c(){s&&o&&(o.off("mouseenter",l),o.off("mouseleave",u),o.remove(),o=void 0),s=!1}function l(){s=!1}function u(){s=!0,c()}function d(){s||(o||(o=angular.element('<div class="fr-menu"></div>'),o.html(e),r.after(o)),i.onHoverStart&&"function"==typeof t[i.onHoverStart]&&t[i.onHoverStart](),n(o)(t),o.css({display:"block"}),o.on("mouseleave",u),o.on("mouseenter",l),t.$rgDigest())}function g(){s=!0,window.setTimeout(c,500),window.clearTimeout(a),a=!1,r.off("mouseleave",g)}function m(e){a||(a=window.setTimeout(d.bind(this,e),1200)),r.on("mouseleave",g)}r.on("mouseenter",m),t.$on("$destroy",function(){g(),r.off("mouseenter",d),r.off("mouseleave",g)})}"false"!==i.rgHovercard&&e.get(i.hoverTemplateUrl).success(function(e){a(e)}),"false"!==i.rgHovercard&&e.get(i.hoverTemplateUrl).success(function(e){a(e)}),RingLogger.tags.DIGEST&&t.$watch(function(){RingLogger.info("from rgHovercard",RingLogger.tags.DIGEST)})}return{scope:!0,link:r}}angular.module("ringid.directives").directive("rgImg",rgImg).directive("rgImgChange",rgImgChange);function rgImgChange(){e.$inject=["$element"];function e(e){this.setPopupStyle=function(t,n){e[0].style.height=t+"px",e[0].style.width=n+"px"}}return{restrict:"A",controller:e}}rgImg.$inject=["$compile","Utils"];function rgImg(e,t){function n(n,r,i,o){var a=500,s=500,c=0,l=0,u=300,d=60,g=0,m=0,E=0,f=0,p=e('<img src="'+n.rgImgObj.src()+'" />')(n);g=t.viewport.x-40-u-d,m=t.viewport.y-40-d,c=g-s>s?g-s:s,l=m-a>a?m-a:a,r.append(p),i.$observe("rgImg",T);function T(e){p[0].setAttribute("src",""),p[0].setAttribute("src",e),h(n.rgImgObj.getIh(),n.rgImgObj.getIw())}function h(e,t){e>m||t>g?t/g>=e/m?(E=g,f=Math.floor(g/t*e)):(f=m,E=Math.floor(m/e*t)):(f=e,E=t),p[0].style.width=E+"px",p[0].style.height=f+"px",E<c&&(E=c),f<l&&(f=l),RingLogger.information("imgW: "+t+" resizedW: "+E+" maxW: "+g,RingLogger.tags.IMAGE),RingLogger.information("imgH: "+e+"resizedH: "+f+" maxH: "+m,RingLogger.tags.IMAGE),E<c&&(E=c),f<l&&(f=l),E=E+u+d,f+=d,"false"===i.commentsection&&(E-=300),o.setPopupStyle(f,E)}}return{restrict:"A",require:"^rgImgChange",scope:{rgImgObj:"="},link:n}}angular.module("ringid.directives").directive("rgSrc",rgSrc);function rgSrc(){function e(e,t,n){function r(e){null===e||void 0===e?t.removeAttr("src"):t.attr("src",e)}n.rgSrc&&e.$watch(n.rgSrc,r)}return{restrict:"A",link:e}}angular.module("ringid.directives").directive("rgRepeat",rgRepeat),rgRepeat.$inject=["$parse","$rootScope","$animate","SystemEvents"];function rgRepeat(e,t,n,r){function i(){return function(i,o,a,s,c){var l,u,d,g,m=a.rgRepeat,E=m.match(/^\s*(.+)\s+in\s+(.*?)\s+track\s+by\s+(.+)\s*$/),f=Object.create(null);if(!E)throw new Error("Expected expression in form of '_item_ in _collection track by _key_'");d=document.createComment(" end rgRepeat: "+m+" "),l=E[2],g=e(E[3]),u=E[1],i.$watchCollection(l,p);function p(e){var a,s,l,m,E,p,T,h,I,_=e.length,A=o[0],S=Object.create(null);t.$$postDigest(function(){for(a=0;a<e.length;a++)l=e[a],f[l.$TrackID]&&(p=f[l.$TrackID],p.childHead&&(p.scope.$$childHead=p.childHead))});function C(e){var t=d.cloneNode(!1);e[e.length++]=t,n.enter(e,null,angular.element(A)),A=t,p.clone=e,p.startNode=e[0]}for(a=0;a<_;a++)l=e[a],T={},T[u]=l,E=g(i,T),f[E]?(p=f[E],delete f[E]):(m=i.$new(),m[u]=l,p={},p.clone=null,p.scope=m),e[a].$TrackID=E,S[E]=p;for(E in f)if(f[E]){for(p=f[E],s=0;s<p.clone.length;s++)A.parentNode.removeChild(p.clone[s]);p.scope.$destroy()}for(a=0;a<_;a++)l=e[a],E=l.$TrackID,p=S[E],p.scope.$index=a,I=p.clone,I?(h=A,p.startNode!==h&&n.move(p.clone,null,angular.element(A)),A=p.clone[p.clone.length-1],p.childHead=p.scope.$$childHead,p.scope.$$childHead=null):c(p.scope,C);i.target&&i.target.getMapKey&&i.$emit(r.FEED.HEIGHT,i.target.getMapKey()),f=S}}}return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:i}}angular.module("ringid.directives").factory("ReportHttpService",ReportHttpService).controller("ReportController",ReportController).directive("rgReport",rgReport),ReportHttpService.$inject=["$$connector","$$q","OPERATION_TYPES","SPAM_TYPES"];function ReportHttpService(e,t,n,r){var i,o=n.SYSTEM.REPORT,a={};i={getSpamReasonList:s,reportSpam:c};function s(i){var s,c=t.defer();if(!i||"string"!=typeof i)throw new Error("PARAMS_ERROR spamType Must be string");return s=r[i.toUpperCase()],a[s]?setTimeout(function(){c.resolve(a[s])}):e.pull({actn:o.ACTION_SPAM_REASON_LIST,spmt:s},n.SYSTEM.REQUEST_TYPE.REQUEST).then(function(e){e.sucs?(a[s]=e.rsnLst,c.resolve(a[s])):c.reject(e)},function(e){c.reject(e)}),c.promise}function c(t){var i;if(!t.spmt||!t.spmid||!t.rsnid)throw new Error("PARAMS_ERROR");return i={actn:o.ACTION_REPORT_SPAM,spmt:r[t.spmt],spmid:t.spmid,rsnid:t.rsnid},e.request(i,n.SYSTEM.REQUEST_TYPE.UPDATE)}return i}ReportController.$inject=["$scope","remoteData","ReportHttpService","Ringalert"];function ReportController(e,t,n,r){e.title="Let us know why that's bothers you !",e.spamList=t,e.reason=e.spamList[0].id,RingLogger.print(t,RingLogger.tags.rgReport),RingLogger.tags.DIGEST&&e.$watch(function(){RingLogger.info("from ReportController",RingLogger.tags.DIGEST)}),e.report=function(){return RingLogger.print(e.reason,RingLogger.tags.rgReport),e.reason?void n.reportSpam({spmt:e.spamType.toUpperCase(),spmid:e.spamId,rsnid:e.reason}).then(function(t){var n;RingLogger.print(t,RingLogger.tags.rgReport),e.$close(),t.sucs?(n={title:"Done!",message:t.mg,showCancel:!1},r.alert(n)):r.show(t,"error")}):void(e.error="Please choose one reason")}}rgReport.$inject=["$ringbox","ReportHttpService","rgDropdownService"];function rgReport(e,t,n){return{restrict:"EA",scope:{spamId:"=",spamType:"@"},link:function(r,i){function o(i){RingLogger.print("clicked rgReport",RingLogger.tags.rgReport),n.close(i),e.open({type:"remote",scope:r,controller:"ReportController",resolve:{remoteData:t.getSpamReasonList(r.spamType)},templateUrl:"templates/popups/rg-report.html"})}i.on("click",o),RingLogger.tags.DIGEST&&r.$watch(function(){RingLogger.info("from rgReport",RingLogger.tags.DIGEST)}),r.$on("$destroy",function(){i.off("click",o)})}}}!function(e,t){"use strict";e.module("ringid.notification",["ringid.config","ringid.directives"])}(angular,window),angular.module("ringid.notification").factory("$$notiMap",$$notiMap),$$notiMap.$inject=["OPERATION_TYPES","Utils","settings","routeService"];function $$notiMap(e,t,n,r){var i=e.SYSTEM.NOTIFICATION,o={acId:0,cmnId:0,fndId:0,fndN:"",id:0,imgId:0,loc:0,mt:0,nfId:0,ut:0,nt:0,prIm:0,message:"",updateTime:"",popupType:"",groupId:0,user:null,seen:!1,mayMerge:1,othersCounter:0};function a(e){var t="",n={message:"",popupType:"",mayMerge:1};function r(){var t="",n=e.uIdList.length-1;return n>1?t=" and "+n+" others ":1===n&&(t=" and "+n+" other "),t}switch(e.mt){case i.MSG_TYPE_UPDATE_PROFILE_IMAGE:n.message=" changed profile photo",n.popupType="image",n.mayMerge=2;break;case i.MSG_TYPE_UPDATE_COVER_IMAGE:n.message=" changed cover photo",n.popupType="image",n.mayMerge=2;break;case i.MSG_TYPE_LIKE_IMAGE:n.message=r()+" liked your photo",n.popupType="image";break;case i.MSG_TYPE_IMAGE_COMMENT:n.message=r()+" commented on your photo",n.popupType="image";break;case i.MSG_TYPE_LIKE_IMAGE_COMMENT:n.message=r()+" liked your comment",n.popupType="image";break;case i.MSG_TYPE_ADD_FRIEND:n.message=" wants to be friends with you",n.popupType="profile";break;case i.MSG_TYPE_ACCEPT_FRIEND:n.message=" has accepted your friend request",n.popupType="profile";break;case i.MSG_TYPE_ADD_GROUP_MEMBER:n.message=" has added you in a group "+t,n.popupType="group",n.mayMerge=0;break;case i.MSG_TYPE_ADD_STATUS_COMMENT:n.message=r()+" commented on your post",n.popupType="feed";break;case i.MSG_TYPE_LIKE_STATUS:n.message=r()+" liked your post",n.popupType="feed";break;case i.MSG_TYPE_LIKE_COMMENT:n.message=r()+" liked your comment",n.popupType="feed";break;case i.MSG_TYPE_SHARE_STATUS:n.message=r()+" shared your post",n.popupType="feed";break;case i.MSG_TYPE_LIKE_AUDIO_MEDIA:n.message=r()+" liked your music",n.popupType="media";break;case i.MSG_TYPE_AUDIO_MEDIA_COMMENT:n.message=r()+" commented on your music",n.popupType="media";break;case i.MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:n.message=r()+" liked your comment",n.popupType="media";break;case i.MSG_TYPE_AUDIO_MEDIA_VIEW:n.message=r()+" viewed your music",n.popupType="media";break;case i.MSG_TYPE_LIKE_VIDEO_MEDIA:n.message=r()+" liked your video",n.popupType="media";break;case i.MSG_TYPE_VIDEO_MEDIA_COMMENT:n.message=r()+" commented on your video",n.popupType="media";break;case i.MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:n.message=r()+" liked your comment",n.popupType="media";break;case i.MSG_TYPE_VIDEO_MEDIA_VIEW:n.message=r()+" viewed you video",n.popupType="media";break;case i.MSG_TYPE_YOU_HAVE_BEEN_TAGGED:n.message=" tagged you in a status",n.popupType="feed";break;default:n.popupType="nomatch",n.mayMerge=0}return n}function s(e){this.updateNoti(e)}function c(e){var n;angular.isObject(e)?(this.noti?angular.extend(this.noti,e):(this.noti=angular.extend({},o,e),this.noti.uIdList=[]),this.noti.updateTime=t.verbalDate(this.noti.ut)||this.noti.ut,n=a(this.noti),this.noti.message=n.message,this.noti.popupType=n.popupType,this.noti.mayMerge=n.mayMerge,this.noti.fndId&&this.noti.uIdList.push(this.noti.fndId)):(RingLogger.warn("not valid json object noti",RingLogger.tags.NOTIFICATION),RingLogger.print(e,RingLogger.tags.MEDIA))}function l(){return this.noti.ut}function u(){return this.noti.fndN}function d(e){return this.noti.uIdList.indexOf(e)>-1}function g(e){var t;if(e&&e.length)for(t=0;t<e.length;t++)this.noti.uIdList.indexOf(e[t])===-1&&this.noti.uIdList.push(e[t]);return this.noti.uIdList}function m(){return this.noti.fndId}function E(){var e,t;return this.noti.user?e=this.noti.user.avatar("thumb"):this.noti.prIm?(t=this.noti.prIm.lastIndexOf("/")+1,e=[n.imBase,this.noti.prIm.slice(0,t),"pthumb",this.noti.prIm.slice(t)].join("")):e="images/prof.png",e}function f(){return this.noti.message}function p(e){return e?this.noti.ut:this.noti.updateTime}function T(){this.noti.updateTime=t.verbalDate(this.noti.ut)}function h(){return this.noti.id}function I(){return this.noti.popupType}function _(){return this.noti.mt}function A(){return this.noti.nt}function S(){return this.noti.acId}function C(){return this.noti.nfId}function v(){var e="",t={};switch(this.noti.popupType){case"image":t.mediaId=this.noti.imgId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=r.getRoute("SINGLE_IMAGE",t);break;case"media":t.mediaId=this.noti.imgId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=r.getRoute("SINGLE_MEDIA",t);break;case"profile":e=r.getRoute("PROFILE",{uId:this.noti.fndId});break;case"group":e=r.getRoute("CIRCLE",{circleId:this.noti.acId});break;case"feed":t.feedId=this.noti.nfId,this.noti.cmnId&&(t.commentId=this.noti.cmnId),e=r.getRoute("SINGLE_FEED",t);break;default:e=""}return e}function D(){return this.noti.imgId}function R(){return this.noti.cmnId}function M(){return this.noti.seen}function N(e){this.noti.seen=e}function y(){return this.noti.mayMerge}function b(e){var t;this.noti.othersCounter+=e,t=a(this.noti),this.noti.message=t.message}function O(){var e="";switch(this.noti.popupType){case"image":e="templates/partials/notification/image-popup.html";break;case"media":e="templates/partials/notification/media-popup.html";break;case"feed":e="templates/partials/notification/feed-popup_with_image.html";break;default:e=""}return e}function P(){return"image"===this.noti.popupType&&"RingBoxImageController"||"feed"===this.noti.popupType&&"NotiPopupController"||"media"===this.noti.popupType&&"RingBoxMediaController"}function L(){return"feed"===this.noti.popupType||"image"===this.noti.popupType||"media"===this.noti.popupType}return s.prototype={updateNoti:c,sortBy:l,getName:u,isInUidList:d,uIdList:g,getUid:m,getUserAvatar:E,getMessage:f,getTime:p,updateNotiTime:T,getKey:h,getPopupType:I,getMessageType:_,getNotiType:A,getActivityId:S,getNewsFeedId:C,getLink:v,getImgId:D,getCommentId:R,getSeenStatus:M,updateSeenStatus:N,canMerge:y,setNotiMessage:b,getRingboxTemplate:O,getControllerName:P,showRingbox:L},function(e){return new s(e)}}angular.module("ringid.notification").service("notificationHttpService",notificationHttpService),notificationHttpService.$inject=["$$connector","settings","OPERATION_TYPES"];function notificationHttpService(e,t,n){var r=this,i=n.SYSTEM.NOTIFICATION,o=n.SYSTEM.REQUEST_TYPE;function a(){var t=new Date,n={actn:i.CLEAR_NOTIFICATION_COUNTER,ut:t.getTime()};return e.request(n,o.REQUEST)}function s(t){var n={actn:i.TYPE_MY_NOTIFICATIONS};t&&t.from_index>0&&(n=angular.extend({},n,t)),e.send(n,o.REQUEST)}function c(t){var r={actn:n.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:t.activityId};return e.request(r,o.REQUEST)}function l(t){var r={actn:n.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,request_type:o.REQUEST,imgId:t.imgId};return e.request(r,o.REQUEST)}r.requestNotification=s,
r.clearNotiCount=a,r.getNotificationDetails=c,r.getImageAlbumDetails=l}angular.module("ringid.notification").factory("NotificationFactory",NotificationFactory),NotificationFactory.$inject=["$$connector","$q","Storage","notificationHttpService","$$stackedMap","$$notiMap","OPERATION_TYPES"];function NotificationFactory(e,t,n,r,i,o,a){var s=i.createNew(!0,"desc"),c=!1,l=a.SYSTEM.NOTIFICATION,u=0,d=0,g=-1,m={loading:!1,noMoreData:!1};function E(e){var t,r,i,a,c,E,p,T=!0;function h(e){function n(){e.value.getTime(!0)<t.getTime(!0)?(d=d>0?d-1:0,t.uIdList(e.value.uIdList()),t.setNotiMessage(),s.remove(e.value.getKey())):(T=!1,e.value.uIdList(t.uIdList()),e.value.setNotiMessage())}if(e.value.getMessageType()===t.getMessageType())if(1===e.value.canMerge())switch(e.value.getPopupType()){case"feed":e.value.getNewsFeedId()===t.getNewsFeedId()&&n(e.value.isInUidList(t.getUid())?!1:!0);break;case"image":case"media":e.value.getImgId()===t.getImgId()&&n(e.value.isInUidList(t.getUid())?!1:!0);break;default:RingLogger.print("Case Mismatch",RingLogger.tags.NOTIFICATION)}else 2===e.value.canMerge()&&e.value.getUid()===t.getUid()&&n(!1)}switch(e.actn){case l.TYPE_MY_NOTIFICATIONS:if(e.sucs===!0||"true"===e.sucs){for(E=[],u+=e.nList.length,a=parseInt(n.getData("oldNotiCount"),10),RingLogger.information("CURRENT oldNotiCount="+a+" totalNewNoti="+e.tn,RingLogger.tags.NOTIFICATION),a>e.tn?(d=e.tn,n.setData("oldNotiCount",0)):d=e.tn-a,RingLogger.information("MODIFIED notiCounter="+d,RingLogger.tags.NOTIFICATION),r=0;r<e.nList.length;r++)if(T=!0,t=o(e.nList[r]),s.all().forEach(h),E.push(e.nList[r].ut),c=n.getData("notiseen"),T){for(i=0;i<c.length;i++)c[i]===e.nList[r].id&&t.updateSeenStatus(!0);s.save(t.getKey(),t)}p=E.sort(),g=p[0]||g}else e.sucs===!1&&1111===e.rc?(RingLogger.warning("Notification list request REPEAT",RingLogger.tags.NOTIFICATION),f()):(m.noMoreData=!0,RingLogger.warning("Notification list request failed",RingLogger.tags.NOTIFICATION));break;case l.TYPE_SINGLE_NOTIFICATION:u++,T=!0,t=o(e),s.all().forEach(h),T&&s.save(t.getKey(),t),d++}}function f(e){var t=e||10,n={from_index:u>0?u:0,to_index:u>0?u+t:t,scl:2,ut:g};r.requestNotification(n)}function p(t){c&&!t||(c=!0,e.subscribe(E,{action:[l.TYPE_MY_NOTIFICATIONS,l.TYPE_SINGLE_NOTIFICATION]}),f())}function T(){return d>99?"99+":d}function h(){var e,t;for(d>0&&(n.setData("oldNotiCount",d+parseInt(n.getData("oldNotiCount"),10)),RingLogger.information("Setting oldNotiCount in localStorage="+n.getData("oldNotiCount"),RingLogger.tags.NOTIFICATION),d=0),e=0;e<s.length();e++)t=Date.now()-s.all()[e].value.sortBy(),t<36e5&&s.all()[e].value.updateNotiTime()}function I(e){return s.get(e)}function _(){return s}return{init:p,state:m,loadMoreNoti:f,process:E,getNotifications:_,getNotification:I,clearCounter:h,getNotiCount:T}}angular.module("ringid.notification").directive("rgNotification",rgNotification),rgNotification.$inject=["$window","$document","$ringhttp","$compile"];function rgNotification(e,t,n,r){i.$inject=["NotificationFactory","$location","AlbumFactory","Auth","rgDropdownService","Ringalert","circlesManager","Storage","$scope","rgScrollbarService","OPERATION_TYPES","$$connector","notificationHttpService","SystemEvents","Api"];function i(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E){var f,p,T=parseInt(c.loadCount,10),h=u.SYSTEM.NOTIFICATION;c.state=e.state,c.notifications=e.getNotifications(),c.loadMoreNotification=S,c.getRingboxData=I,c.notificationAction=e.notificationAction;function I(e){switch(e.value.getPopupType()){case"image":return _({action:"image",noti:e.value,nfId:e.value.getNewsFeedId(),imgId:e.value.getImgId(),templateType:"image"});case"media":return _({action:"media",noti:e.value,nfId:e.value.getNewsFeedId(),mediaId:e.value.getImgId(),templateType:"media"});case"feed":return _({action:"ringbox",nfId:e.value.getNewsFeedId(),noti:e.value,templateType:"feed_with_text"});default:return!1}}function _(e){var i,c,l=s.getData("notiseen");switch(l||(l=[],s.setData("notiseen",l)),l.indexOf(e.noti.getKey())===-1&&(l.push(e.noti.getKey()),e.noti.updateSeenStatus(!0),l.length>150&&l.shift()),s.setData("notiseen",l),e.action){case"redirect":c=a.getCircle(e.circleId),c?(i=e.link.slice(1),t.path(i)):o.show("Circle does not exist!","error");break;case"ringbox":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,templateType:e.templateType}},promise:g.getNotificationDetails({activityId:e.nfId})};case"media":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,mediaId:e.mediaId,popupFrom:"notification",templateType:e.templateType}},promise:E.media.fetchDetails({cntntId:e.mediaId,utId:r.currentUser().getUtId()})};case"image":return{data:function(){return{notiKey:e.noti.getKey(),noti:e.noti,imgId:e.imgId,popupFrom:"notification",templateType:e.templateType}},promise:n.getImageDetails(e.imgId,e.nfId)};default:RingLogger.print("Case Mismatch",RingLogger.tags.NOTIFICATION)}return!1}function A(e){c.state.loading=e,e||(l.recalculate(c),c.$emit(m.FEED.HEIGHT)),c.$rgDigest()}function S(){c.state.loading||c.state.noMoreData||(A(!0),e.loadMoreNoti(T))}T>20&&c.$emit(m.FEED.HEIGHT),c.notifications.length()<T&&S(),f=d.subscribe(function(){p||(p=setTimeout(function(){p=null,A(!1)},200))},{action:[h.TYPE_MY_NOTIFICATIONS,h.TYPE_SINGLE_NOTIFICATION]}),c.$on("$destroy",function(){d.unsubscribe(f)})}function o(e,t,i){var o=i.templateUrl?i.templateUrl:"templates/dropdowns/notification-dropdown.html";n.get(o).success(function(n){t.append(r(n)(e)),e.$rgDigest()})}return{restrict:"AE",controller:i,scope:{loadCount:"@",templateUrl:"@"},link:o}}angular.module("ringid.notification").controller("NotiPopupController",NotiPopupController),NotiPopupController.$inject=["$$connector","OPERATION_TYPES","Auth","$scope","localData","remoteData","NotificationFactory","$$feedMap","feedFactory","rgDropdownService","Ringalert","MESSAGES"];function NotiPopupController(e,t,n,r,i,o,a,s,c,l,u,d){var g,m,E=!0;r.currentUser=n.currentUser(),r.feed={},r.focused=!1,r.showCommentBox=!0,r.showFeedFullContent=!0,r.nocontent=!1,r.ddHtml="templates/dropdowns/feed-edit-dropdown.html",r.getMediaData=f,i&&i.notiKey&&(r.key=i.notiKey,r.noti=i.noti,r.templateType=i.templateType),r.boxIsLoading=!1,o.sucs===!1?(r.nocontent=!0,u.show(o,"error"),r.$close()):(g=angular.fromJson(o.newsFeedList),E&&g[0]&&g[0].orgFd?(r.feed=s.create(g[0]),m=s.create(g[0].orgFd),r.feed.shares(m)):r.feed=s.create(o.newsFeedList[0]),r.keyid=r.feed&&r.feed.getKey()),(r.feed.hasMedia()||r.feed.hasSharedFeed()&&r.feed.getOrginalFeed().getImages().length)&&(r.templateType="feed_with_image"),r.noti.getCommentId()>0&&(r.activeCommentId=r.noti.getCommentId());function f(e,t){var n;return t||(n=r.feed),{data:function(){return{media:e,album:n.getAlbum(),feedTime:n.time()}},promise:e.fetchDetails()}}r.shareMenuDisabled=!!r.shareMenuDisabled&&r.shareMenuDisabled,r.toggleCommentBox=p,r.toggleShareBox=T,r.getImageData=h;function p(e){e.stopPropagation(),r.showCommentBox=!r.showCommentBox,r.showCommentBox&&(r.showShareBox=!1)}function T(e){var t=r.feed.hasSharedFeed()?r.feed.getOrginalFeed():r.feed,n=t.isShareAble(!0);e.stopPropagation(),n.sucs?(r.showShareBox=!r.showShareBox,r.showShareBox&&(r.showCommentBox=!1)):u.show(d[n.rc],"warning")}function h(e,t){return function(){return{image:e,feed:t}}}}angular.module("ringid.notification").controller("ImageController",["$routeParams","$scope","Auth","$$imageMap","$$stackedMap","AlbumFactory","$$connector","OPERATION_TYPES",function(e,t,n,r,i,o,a,s){var c,l,u=i.createNew(),d=s.SYSTEM.IMAGE;t.showCommentBox=!0,t.nextImg=!1,t.prevImg=!1,t.changeImage=E,t.openRingboxLike=m,t.actionImageDropdown=angular.noop,t.showOption=g,t.ddTemplate='<div class="ng-cloak action-top feed-drop_top"><div class="ac-top-line drop-h" ng-if="ddControl.showReportButton()"><span class="drop-sprite media-report-mar w-h-13 report-ico feed-font"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div></div>';function g(){return t.image.ddControl.showReportButton()}function m(){return t.image&&t.image.getLikes()>0}function E(n){"next"===n?"profile"===t.params.popupFrom?u.previous(t.image.getKey())?t.image=u.next(t.image.getKey())||u.bottom():o.loadMoreImage(t.image.getAlbumId(),e.uId):t.image=u.next(t.image.getKey())||u.bottom():t.image=u.previous(t.image.getKey())||u.top(),T(n),t.$rgDigest()}function f(n){var i,a,s,c,l;function d(e){if(e.sucs===!0){for(i=e.newsFeedList[0].imageList,c=i.length,l=0;l<c;l++)i[l].nfId=e.nfId,i[l].imgId===t.image.getKey()?(t.image.updateImage(i[l]),u.save(t.image.getKey(),t.image)):(s=r(i[l],t.feed.user()),u.save(s.getKey(),s));p()}}n?o.getFeedImages(n).then(d):(a=o.getAlbums(e.uId),u=a.get(t.image.getAlbumId()).getImages(),p())}function p(){u.length()>1&&(t.nextImg=!!u.next(t.image.getKey())||!!u.bottom(),t.prevImg=!!u.previous(t.image.getKey())||!!u.top()),t.$rgDigest()}function T(e){var n,r=new Image;n="next"===e?u.next(t.image.getKey()):u.previous(t.image.getKey()),setTimeout(function(){r.src=n?n.src():""},200)}function h(){l=a.subscribe(function(e){t.image&&t.image.getKey()===e.imgId&&(t.image.setTotalComment(e.loc),t.$rgDigest())},{action:[d.TYPE_UPDATE_ADD_IMAGE_COMMENT,d.TYPE_UPDATE_DELETE_IMAGE_COMMENT]}),c=a.subscribe(function(n){n.sucs===!0&&(u=o.getAlbums(e.uId).get(t.image.getAlbumId()).getImages(),t.image=u.next(t.image.getKey())||u.bottom(),t.$rgDigest())},{action:[d.TYPE_ALBUM_IMAGES,d.TYPE_FRIEND_ALBUM_IMAGES]}),t.params.image?t.image=t.params.image:t.params.imgId&&(t.remoteData?t.image=t.remoteData:o.getImageDetails(t.params.imgId).then(function(e){t.image=e,t.$rgDigest()})),t.params.feed&&(t.feed=t.params.feed,f(t.feed.getKey())),"profile"===t.params.popupFrom&&f(),t.$rgDigest()}h(),t.$on("$destroy",function(){l&&a.unsubscribe(l),a.unsubscribe(c)})}]),angular.module("ringid.notification").controller("MediaController",MediaController),MediaController.$inject=["APP_CONSTANTS","fileUploadService","$routeParams","$scope","Auth","rgDropdownService","Media","$$connector","OPERATION_TYPES","Ringalert","feedFactory","$ringbox","$$mediaMap"];function MediaController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E=c.SYSTEM.MEDIA;r.currentUser=i.currentUser(),r.showCommentBox=!0,r.changeMedia=A;function f(){window.FB&&window.FB.ui({method:"share",href:r.media.getEmbedUrl()},function(e){RingLogger.print(e)})}r.actionImageDropdown=h,r.shareMedia=S,r.selectAlbum=_,r.showOptionMenu=I,r.ddTemplate='<div class="ng-cloak action-top vp-position"><div class="ac-top-line drop-h dis_ib bs-box w-100-per" ng-if="ddControl.showReportButton()"><span class="drop-sprite w-h-13 report-ico feed-font"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div><div class="ac-top-line drop-h dis_ib bs-box w-100-per" ng-if="ddControl.showAddToAlbum()"><span class="drop-sprite w-h-13 add-album-ico feed-font"></span><a rg-ringbox="true" ringbox-controller="RingBoxAlbumlistController" ringbox-animation="true"ringbox-type="remote" ringbox-target="templates/dropdowns/popup-album-dropdown.html" ringbox-data="ddControl.getRingboxData()">Add to Album</a></div> <div class="ac-top-line drop-h dis_ib bs-box w-100-per"> <span class="drop-sprite w-h-13 fb-share-ico feed-font"></span><a href="javascript:void(0);"  rg-click="ddAction()({event: $event, action:\'shareToFb\' })"   >Share in Facebook</a></div> </div>',r.params&&"notification"===r.params.popupFrom?r.remoteData&&r.remoteData.sucs?(r.media=g(r.remoteData.mdaCntntDTO),r.album=a.getAlbum(r.media.getAlbumId())):r.$close():(r.media=r.params.media,r.playlist=r.params.playlist),r.media&&!r.media.owner().hasDetails()&&r.media.owner().requestUserDetails().then(function(){r.$rgDigest()});function p(){r.media.setMediaToken().then(function(){r.$rgDigest()})}function T(){r.media.increaseView().then(function(){r.$rgDigest()},function(){r.$rgDigest()}),p()}function h(e){"shareToFb"===e.action&&f()}function I(){return r.media.ddControl.showReportButton()||r.media.ddControl.showAddToAlbum()||r.media.ddControl.showMediaShareButton()}function _(e){return{data:function(){return{media:e}}}}function A(e){r.media=e,r.media.fetchDetails(),T(),r.$rgDigest()}function S(){var e=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:r.media},onBackDropClickClose:!0,templateUrl:"templates/home/share-media.html"});e.result.then(function(){r.$rgDigest()})}m=s.subscribe(function(e){r.media&&r.media.getKey()===e.cntntId&&r.media.setTotalComment(e.loc)},{action:[E.ACTION_UPDATE_ADD_MEDIA_COMMENT,E.ACTION_UPDATE_DELETE_MEDIA_COMMENT]}),r.$on("$destroy",function(){m&&s.unsubscribe(m)})}angular.module("ringid.notification").controller("RingBoxImageController",RingBoxImageController),RingBoxImageController.$inject=["$scope","$boxInstance","$controller","localData","remoteData"];function RingBoxImageController(e,t,n,r,i){e.close=t.close,r&&r.imgId&&(e.templateType=r.templateType),e.params=r,e.remoteData=i,r.noti&&r.noti.getCommentId()>0&&(e.activeCommentId=r.noti.getCommentId()),n("ImageController",{$scope:e})}angular.module("ringid.notification").controller("RingBoxMediaController",RingBoxMediaController),RingBoxMediaController.$inject=["$scope","$boxInstance","$controller","localData","remoteData"];function RingBoxMediaController(e,t,n,r,i){e.close=o,RingLogger.log(i,RingLogger.tags.MEDIA),r&&r.mediaId&&(e.templateType=r.templateType),RingLogger.information(r,RingLogger.tags.MEDIA),e.params=r,e.remoteData=i,n("MediaController",{$scope:e}),e.destroyPlayer=angular.noop;function o(){e.destroyPlayer(),t.close()}}!function(e,t){"use strict";e.module("ringid.friend",["ringid.config","ringid.shared"])}(angular,window),angular.module("ringid.friend").directive("rgFriends",rgFriends),FriendsController.$inject=["$scope","$attrs","rgScrollbarService","friendsFactory","Contacts","userFactory","$$stackedMap","rgDropdownService","$$connector","OPERATION_TYPES","Ringalert","Api","$routeParams"];function FriendsController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E,f=l.SYSTEM.FRIENDS,p=0,T=!0,h=[];e.isOwner=!1,e.showMutual=!1,e.showPending=!1,e.friendName="",e.state={loading:!1,noData:!1},e.friends=r.getFriends(e.rgFriendsType),e.totalFriends=r.totalFriends,e.getPendingCount=r.getPendingCount,e.toggleShowMutual=_,e.toggleShowPending=A,e.loadMoreFriends=D,e.getMutualFriend=R,e.searchContact=v,e.showComingSoon=I;function I(e){e.preventDefault(),e.stopPropagation(),u.show("Coming soon","info")}function _(t){e.showMutual=!!t,e.showMutual&&S(),e.$rgDigest()}function A(t){e.showPending=!!t,e.showPending?(e.friends=r.getFriends("outgoing"),C(!0),r.getContactDetails("outgoing").then(function(){C(!1)},function(){C(!1)})):e.friends=r.getFriends(e.rgFriendsType),e.$rgDigest()}function S(){var t,n;function i(r){if(r.sucs===!0)for(n=0;n<r.contacts.length;n++)t=o.create(r.contacts[n]),e.friends.save(t.getKey(),t);C(!1)}function a(e){e.sucs===!1&&1111===e.rc?(RingLogger.warning("MUTUAL FRIEND FETCH REPEAT",RingLogger.tags.FRIEND),S()):(C(!1),RingLogger.warning("MUTUAL FRIEND FETCH FAILED",RingLogger.tags.FRIEND))}h.length>0&&(C(!0),r.getContactDetailsByUtIds(h.splice(0,10),!0).then(i,a))}function C(t){e.state.loading=!!t,t||n.recalculate(e),e.state.loading||(e.state.noData=0===e.friends.length()&&0===i.utIds().length()),e.$rgDigest()}function v(){("friends"===e.rgFriendsType||"friendslist"===e.rgFriendsType)&&e.friendName&&e.friendName.length>0&&(C(!0),r.searchContact({schPm:e.friendName},!0).then(function(){C(!1)},function(){C(!1)}))}function D(t){var n,i;e.showMutual?(RingLogger.print("Load Mutual Friends",RingLogger.tags.FRIEND),S()):e.showPending?(RingLogger.print("Load Pending Friend requests",RingLogger.tags.FRIEND),C(!0),r.getContactDetails("outgoing").then(function(){C(!1)},function(){C(!1)})):(t||!e.state.loading&&e.friends.length()!==e.totalFriends(e.rgFriendsType))&&(C(!0),"userfriends"===e.rgFriendsType?(RingLogger.print("Load Friends Friendlist",RingLogger.tags.FRIEND),n=r.getUserContacts,i=e.profileObj.getUtId()):(RingLogger.print("Load Friendlist",RingLogger.tags.FRIEND),n=r.getContactDetails),n(i).then(a,s));function a(){e.friends.length()<20&&e.friends.length()<e.totalFriends(e.rgFriendsType)?(RingLogger.warning("NEED TO PULL MORE FRIENDS",RingLogger.tags.FRIEND),C(!1),D()):(RingLogger.warning("Got FRIENDS",RingLogger.tags.FRIEND),C(!1)),o.refreshPesence(!0)}function s(n){n.sucs===!1&&1111===n.rc?D(t):"friendslist"===e.rgFriendsType?p<5?(p++,setTimeout(function(){D(t)},2e3)):C(!1):(C(!1),RingLogger.alert("friend Details fetch fail, RETRYING",RingLogger.tags.FRIEND))}}function R(e){return{data:function(){return{target:e}},promise:d.user.getMutualFriends(e)}}function M(){e.ddTemplate='<div class="action friend-ac z-in-110 top-23"><div class="ac-top-line drop-h"><div class="drop-sprite fl-left w-h-18-19 remove-member-ico feed-font"></div> <a class="mar-top-8" ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event: $event})" href="#">{{consType.unfriend}}</a></div><div class="ac-top-line drop-h"  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" ><div class="drop-sprite w-h-18-19 block-ico feed-font"></div><a class="mar-top-8" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})" href="#">{{consType.block}}</a></div><div class="ac-top-line drop-h"  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" ><div class="drop-sprite w-h-18-19 unblock-ico feed-font"></div><a class="mar-top-8" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})" href="#">{{consType.unblock}}</a></div></div>',e.ddAction=y,e.showBackKey=0,e.showBack=N}function N(t,n){var r=n.target.getAttribute("data-is-anchor");r||(e.showBackKey=t,n.preventDefault(),n.stopPropagation(),e.$rgDigest())}function y(t){t.friend.isLoading()||(r.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),s.close(t.event))}function b(){switch(E=c.subscribe(function(t){switch(t.actn){case f.TYPE_CONTACT_UTIDS:"friends"!==e.rgFriendsType&&"friendslist"!==e.rgFriendsType||!T||(T=!1,setTimeout(function(){i.utIds().length()>0&&e.friends.length()<20&&(RingLogger.print("Got Utids and friendsList is < 20",RingLogger.tags.FRIEND),D(!0)),e.state.noData=0===e.friends.length()&&0===i.utIds().length()},1e3));break;default:C(!1)}},{action:[f.TYPE_CONTACT_UTIDS,f.TYPE_UPDATE_ADD_FRIEND,f.TYPE_UPDATE_DELETE_FRIEND],callWithUnresolved:!0}),e.rgFriendsType){case"friendslist":break;case"friends":r.initFriends(),e.isOwner=!0,e.pendingRequests=r.getFriends("outgoing"),M(),m=setTimeout(e.toggleLoading,6e4);break;case"userfriends":M(),e.totalUserFriends=r.totalUserFriends,e.profileObj=o.getUser(g.uId),D(!0),d.user.getMutualFriends(e.profileObj).then(function(t){t.sucs===!0&&(e.profileObj.updateUserObj({nmf:t.mfIDs.length}),h=t.mfIDs,e.$rgDigest())}),m=setTimeout(e.toggleLoading,6e4);break;default:RingLogger.alert("Friend type not found ",RingLogger.tags.FRIEND)}}b(),e.$on("$destroy",function(){clearTimeout(m),"userfriends"===e.rgFriendsType&&r.resetUserFriends(),c.unsubscribe(E)})}rgFriends.$inject=["friendsFactory","$ringhttp","$compile","$routeParams","$window","$document","Contacts","APP_CONSTANTS","Utils"];function rgFriends(e,t,n,r,i,o,a,s,c){function l(r,l,u){var d,g;t.get(u.rgFriendsTpl).success(function(e){l.append(n(e)(r)),r.$rgDigest()});function m(){i.innerHeight+i.scrollY>=o[0].body.offsetHeight&&r.loadMoreFriends()}"friends"!==r.rgFriendsType&&"userfriends"!==r.rgFriendsType||angular.element(i).on("scroll",m),g=c.onCustomEvent("PRESENCE_UPDATE",function(){r.$rgDigest()}),r.$on("$destroy",function(){var t;switch(r.rgFriendsType){case"friends":for(d=e.outgoingFriends.keys(),t=0;t<d.length;t++)a.add("outgoingUtIds",d[t],{frnS:s.INCOMING_FRIEND});e.outgoingFriends.reset();break;case"userFriends":angular.element(i).off("scroll",m);break;default:RingLogger.print("Case Mismatch",RingLogger.tags.FRIEND)}c.removeCustomEvent("PRESENCE_UPDATE",g)})}return{restrict:"AE",scope:{rgFriendsType:"@"},controller:FriendsController,link:l}}angular.module("ringid.friend").directive("rgRequests",rgRequests),rgRequests.$inject=["friendsFactory","$compile","$routeParams","$window","$document","$ringhttp"];function rgRequests(e,t,n,r,i,o){a.$inject=["$scope","Api","rgScrollbarService","Contacts","OPERATION_TYPES","$$connector","userFactory","Ringalert","SystemEvents"];function a(t,n,r,i,o,a,s,c,l){var u,d=o.SYSTEM.FRIENDS,g=parseInt(t.loadCount,10);t.state={loading:!1,noMoreData:!1},t.requests=e.getFriends("incoming"),t.getRequestCount=e.getRequestCount,t.friendAction=m,t.loadMoreRequests=f,t.getMutualFriend=p;function m(n){n.friend.isLoading()||e.friendAction(n,!0).then(i,r);function r(){t.requests.length()<g&&f(),t.$rgDigest()}function i(){t.requests.length()<g&&f(),t.$rgDigest()}}function E(e){t.state.loading=e,e||(t.state.noMoreData=0===i.incomingUtIds().length(),r.recalculate(t),t.$emit(l.FEED.HEIGHT)),t.$rgDigest()}function f(n){(n||!t.state.noMoreData&&!t.state.loading)&&(E(!0),e.getContactDetails("incoming",g).then(r,i));function r(){E(!1)}function i(e){e.sucs===!1&&1111===e.rc?f(!0):(E(!1),RingLogger.warning("No Friend Request:",RingLogger.tags.FRIEND))}}function p(e){return{data:function(){return{target:e}},promise:n.user.getMutualFriends(e)}}function T(){g>20&&t.$emit(l.FEED.HEIGHT),i.incomingUtIds().length()>0&&t.requests.length()<g&&f(!0),u=a.subscribe(function(e){switch(e.actn){case d.TYPE_CONTACT_UTIDS:i.incomingUtIds().length()>0&&t.requests.length()<g&&f(!0);break;default:E(!1)}},{action:[d.TYPE_CONTACT_UTIDS,d.TYPE_UPDATE_ADD_FRIEND,d.TYPE_UPDATE_DELETE_FRIEND]})}T(),t.$on("$destroy",function(){a.unsubscribe(u)})}function s(e,n,r){var i=r.templateUrl?r.templateUrl:"templates/dropdowns/friend-request-dropdown.html";o.get(i).success(function(r){n.append(t(r)(e)),e.$rgDigest()})}return{restrict:"AE",scope:{loadOnScroll:"@",loadCount:"@",templateUrl:"@"},link:s,controller:a}}!function(e,t){"use strict";e.module("ringid.header",["ringid.config","ringid.auth","ringid.shared","ringid.notification","ringid.friend","ringid.chat"])}(angular,window),angular.module("ringid.header").controller("HeaderController",HeaderController),HeaderController.$inject=["$scope","$rootScope","$location","rgDropdownService","$$connector","OPERATION_TYPES","friendsFactory","NotificationFactory","Auth","rgScrollbarService","chatHistoryFactory","Utils","SystemEvents"];function HeaderController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E=this,f=o.SYSTEM,p=h();E.getActiveMenu=I,E.logout={ddHtml:"templates/dropdowns/logout-dropdown.html",ddControl:c,ddAction:function(){r.close(),c.logout()},ddOpened:function(){h("logout")},ddBeforeClose:function(){h("")}},E.freq={ddTemplate:'<rg-requests load-on-scroll="true" load-count="10" ></rg-requests>',ddOpened:function(){h("friend_request")},ddBeforeClose:function(){h("")}},E.requestCount=a.getRequestCount,setTimeout(a.initFriends,2e3),E.chatHistory={ddHtml:"templates/partials/chat/chat-history-dropdown.html",ddOpened:function(){u.resetConversationCount(),h("chat_history"),d.triggerCustomEvent(g.CHAT.CONVERSATION_COUNT_RESETED)},ddBeforeClose:function(){h("")}},E.unreadChatConversationCount=u.getUnreadConversationCount,d.onCustomEvent(g.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){e.$rgDigest()}),E.noti={ddTemplate:'<rg-notification load-count="10" template-url="templates/dropdowns/notification-dropdown.html"></rg-notification>',ddOpened:function(){s.clearCounter(),h("notification")},ddBeforeClose:function(){h("")}},E.notiCount=s.getNotiCount,m=i.subscribe(function(){setTimeout(function(){e.$rgDigest()},200)},{action:[f.FRIENDS.TYPE_UPDATE_ADD_FRIEND,f.FRIENDS.TYPE_UPDATE_DELETE_FRIEND,f.NOTIFICATION.TYPE_MY_NOTIFICATIONS,f.NOTIFICATION.TYPE_SINGLE_NOTIFICATION]}),setTimeout(s.init,5e3),e.hideColumn=!1;function T(){var t=n.path();"/"===t?e.hideColumn=!1:e.hideColumn=!0}t.$on("$routeChangeStart",function(){T()}),T();function h(t){p=t&&""!==t?t:"/"===n.path()?"home":"none",e.$rgDigest()}function I(){return p}E.defaultSpan=d.getDefaultColumn,t.$on("$routeChangeStart",function(){h(),i.unsubscribe(m)}),e.$on(g.COMMON.WINDOW_RESIZED,function(){e.$rgDigest()}),e.$on(g.FRIEND.PENDING_FRIENDS_COUNT_CHANGED,function(){e.$rgDigest()})}angular.module("ringid.header").service("rgSearchService",searchService).directive("rgSearch",rgSearch),searchService.$inject=["GlobalEvents"];function searchService(e){var t=this,n=!1,r=!1;t.close=i,t.open=o;function i(){r&&(n.searchText="",r.style.display="none",n.$rgDigest(),r=!1,n=!1,e.unbindHandler("document","click",t.close))}function o(i,o){r=i,n=o,r.style.display="block",e.bindHandler("document","click",t.close)}}rgSearch.$inject=["rgSearchService"];function rgSearch(e){function t(t,n){var r=n.find("input");t.template=n[0].querySelector("#search-dropdown"),t.template.style.display="none",r.on("keypress",i),t.doTheSearch=a,n.on("click",o),t.$on("$destroy",function(){n.off("click",o)});function i(e){13===e.keyCode&&e.preventDefault()}function o(e){"a"!==e.target.tagName.toLowerCase()&&"a"!==e.target.parentNode.tagName.toLowerCase()&&e.preventDefault(),e.stopPropagation()}function a(){t.searchText.length>0?t.doSearch():e.close()}}n.$inject=["$scope","$$stackedMap","userFactory","friendsFactory","friendsHttpService","$timeout","rgScrollbarService","Api"];function n(t,n,r,i,o,a,s,c){var l,u=0,d="";t.searchText="",t.gotAllResult=!1,t.showLoadbar=!1,t.noResult=!0,t.listData=n.createNew(),t.resetSearch=g,t.contactListAction=m,t.doSearch=T,t.getMutualFriend=E;function g(){u=0,t.noResult=!1,t.gotAllResult=!1,t.listData.reset(),t.$rgDigest()}function m(e){e.friend.isLoading()||(i.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())}function E(e){return{data:function(){return{target:e}},promise:c.user.getMutualFriends(e)}}function f(){d!==t.searchText&&(t.resetSearch(),u=0)}function p(){t.noResult=0===t.listData.length(),t.gotAllResult=t.listData.length()>0,t.showLoadbar=!1,t.$rgDigest()}function T(n){f(),(n||!t.showLoadbar&&!t.gotAllResult)&&(clearTimeout(l),t.showLoadbar=!0,t.showDropdown||e.open(t.template,t),d=t.searchText,o.searchContact({schPm:t.searchText,st:t.listData.length()}).then(h,h),l=setTimeout(p,8e3),t.$rgDigest())}function h(e){var n,i,o;if(clearTimeout(l),e.sucs===!0){for(n=0,i=e.searchedcontaclist.length;n<i;n++)o=r.create(e.searchedcontaclist[n]),o&&t.listData.save(o.getKey(),o);e.searchedcontaclist.length>0&&s.recalculate(t),t.showLoadbar=!1,t.noResult=0===t.listData.length(),t.$rgDigest()}else u++,u<3?T(!0):(clearTimeout(l),p())}}return{restrict:"E",scope:{placeholder:"@"},templateUrl:"templates/dropdowns/search-dropdown.html",link:t,controller:n}}!function(e,t){"use strict";e.module("ringid.postbox",[])}(angular,window),angular.module("ringid.postbox").directive("rgPostbox",postbox);function postbox(){return{scope:{feedAdd:"@",setFeed:"&"},controller:postboxController,link:linkFunc,templateUrl:templateFunc}}templateFunc.$inject=["$attrs"];function templateFunc(e){return e.template?e.template:"pages/feed/postbox.html"}function linkFunc(e,t){var n,r=t[0].querySelector("#add-album");r.addEventListener("keyup",i);function i(){n||(n=setTimeout(function(){n=!1,e.$rgDigest()},500))}e.$on("$destroy",function(){r.removeEventListener("keyup",i)})}postboxController.$inject=["fileUploadService","$rootScope","$scope","feedFactory","$timeout","$routeParams","$$stackedMap","SystemEvents","OPERATION_TYPES","rgDropdownService","PrivacySet","MESSAGES","settings","Media","$$q","friendsFactory","APP_CONSTANTS"];function postboxController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p){var T,h,I,_,A=p;n.setPrivacy=y,n.getValidityValues=b,n.addFeed=O,n.shouldDisableInput=D,n.shouldDisableLocation=R,n.shouldDisableLink=M,n.shouldDisableMedia=N,n.selectedTimeout=P,n.selectedLocation=L,n.resetFeedLocation=U,n.addTag=F,n.removeTag=w,n.chooseEmotion=k,n.hashTags=e.hashTags,n.fetchHashTags=$,n.selectHashTag=G,n.removeHashTag=B,n.shouldShowHashTag=H,n.friendTags=a.createNew(),n.toggleShowFriendTag=x,n.fetchFriends=Y,n.selectFriendTag=K,n.removeFriendTag=j,n.getMedia=v,n.ddHtml="templates/dropdowns/album-dropdown.html",n.ddControl={Media:m},n.ddAction=V,C(),n.$on(s.FILE_UPLOAD.QUEUE_START,function(){n.inputDisabled=!0,n.$rgDigest()}),n.$on(s.FILE_UPLOAD.QUEUE_COMPLETE,function(){n.inputDisabled=!1,n.$rgDigest()});function S(){n.filterOnProgress=!1,n.ogDataLoading=!1,n.emotions=[],e.resetUpload(),n.friendTags.reset(),n.feedText="",n.validity=-1,n.ddControl.uploadSpec=n.uploadSpec,n.ddControl.albumName="",n.ddControl.selectedAlbum=-1,n.feedLocation={},n.ogData={},n.ogShowPreview=!1,n.inputDisabled=!1,n.errorMessage="",n.showFriendTag=!1,n.$rgDigest()}function C(){var e;switch(_={},T=(new Date).getTime(),n.privacySet=u,n.uploadSpec={type:"image"},S(),n.feedAdd){case"circle":case"friend":n.showPrivacy=!1;break;default:n.showPrivacy=!0,n.privacy=u.PVC3}for("friend"===n.feedAdd?_.friend=o.uId:"circle"===n.feedAdd&&(_.group=o.circleId),n.privacyTemplate='<div class="ng-cloak action  ab-drop postbox-action"><div class="a-box" ><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC1.value})" href="#"><span class="{{::ddControl.PVC1.icon}} ab-delete"></span>{{::ddControl.PVC1.text}}</a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC2.value})" href="#"><span class="{{::ddControl.PVC2.icon}} ab-delete"></span>{{::ddControl.PVC2.text}} </a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC3.value})" href="#"><span class="{{::ddControl.PVC3.icon}} ab-delete"></span>{{::ddControl.PVC3.text}}</a></div></div>',n.showTimeout=!1,n.validity=-1,_.vlDtvldt=n.validity,n.selectOptions=[],n.selectOptions[0]={value:-1,title:"Unlimited"},e=1;e<=30;e++)n.selectOptions[e]={value:e,title:e+" Day"};I=r.getCurrentPageValue(),n.showAddTag=I.action!==c.SYSTEM.TYPE_GROUP_NEWS_FEED}function v(){return e[n.uploadWhat+"Files"]}function D(){return n.inputDisabled||n.ogDataLoading||n.filterOnProgress}function R(){return!1}function M(){return e.imageFiles.length>0||e.videoFiles.length>0||e.audioFiles.length>0||!!n.feedLocation.lat}function N(){return!!n.ogData.url||!!n.feedLocation.lat}function y(e){n.privacy=u["PVC"+e.privacy],l.close(e.event),n.$rgDigest()}function b(){return new Array(30)}function O(){var t,i,o,a,s={vldt:n.validity};n.inputDisabled=!0,s=angular.extend({},_,{text:n.feedText,vldt:n.validity,images:e.imageFiles,videos:e.videoFiles,audios:e.audioFiles}),n.privacy&&(s.fpvc=n.privacy.value),n.feedLocation.description&&(s.lctn=n.feedLocation.description,s.lat=n.feedLocation.lat,s.lng=n.feedLocation.lng),n.ogData.url&&(s.lnkDmn=n.ogData.lnkDmn||n.ogData.url||"",s.lnkDsc=n.ogData.description||"",s.lnkTtl=n.ogData.title||"",s.lnkURL=n.ogData.url||"",s.lnlImgURL=n.ogData.image||""),n.emotions.length&&(s.mdIds=[n.emotions[0].id],n.emotions.length=0),n.friendTags.length()>0&&(s.tFrndIds=[],n.friendTags.doForAll(function(e){s.tFrndIds.push(e.getUtId())})),i=n.feedText,""!==s.text&&s.lnkURL&&(o=s.text.replace("https","").replace("http",""),a=s.lnkURL.replace("https","").replace("http",""),"/"===o[o.length-1]&&(o=o.slice(0,-1)),"/"===a[a.length-1]&&(a=a.slice(0,-1)),o===a&&(s.text=""));function c(){return!!s.lnkURL||s.images.length>0||s.videos.length>0||s.audios.length>0||!!s.mdIds&&s.mdIds.length>0||!!s.lctn||!!s.tFrndIds&&s.tFrndIds.length>0}function l(){var e,t,r,i=!0;return n.errorMessage="",""!==s.text?(t=s.text.length,r=s.text.getUTF8Length(),r>g.FEED_TEXT_LIMIT&&(e=Math.floor(t*g.FEED_TEXT_LIMIT/r),n.errorMessage=d.FTL_ERROR.supplant({length:t,max_limit:e}),i=!1)):c()||(i=!1,n.errorMessage=d.FEED_INV),i}function u(){T=h,RingLogger.print(s.text,"FEED_TEXT"),RingLogger.print(s.text.length,"FEED_TEXT"),RingLogger.print(s.text.getUTF8Length(),"FEED_TEXT"),r.addFeed(s,n.currentUser).then(function(e){n.setFeed()(e),n.$parent.$rgDigest()},function(){n.setFeed()(),n.feedText=i,n.$broadcast("seteditor",i),
n.$parent.$rgDigest()}),S(),n.setFeed()(),n.$broadcast("cleareditor"),n.$parent.$rgDigest()}function E(){h=Date.now(),h-T<200?setTimeout(u,200):u()}l()?(s.albId=n.ddControl.selectedAlbum,"image"!==n.uploadSpec.type?(s.htgLst=n.hashTags,t=m.getAlbum(n.ddControl.selectedAlbum),!t&&n.ddControl.albumName.length>0||t&&t.getName()!==n.ddControl.albumName?m.createAlbum({albn:n.ddControl.albumName,mdaT:"audio"===n.uploadSpec.type?A.NEWS_FEED_MEDIA_TYPE_AUDIO:A.NEWS_FEED_MEDIA_TYPE_VIDEO},!0).then(function(e){n.ddControl.selectedAlbum=e.getKey(),s.albId=n.ddControl.selectedAlbum,E()}):E()):E()):(n.inputDisabled=!1,n.ogShowPreview=!1,n.$rgDigest())}function P(e){n.validity=e,n.$rgDigest()}function L(e){n.feedLocation=e,n.$rgDigest()}function U(){n.feedLocation={},n.$rgDigest()}function F(e){var t=n.tagList.indexOf(e);t===-1&&n.tagList.push(e),n.$rgDigest()}function w(e){var t=n.tagList.indexOf(e);t>=0&&n.tagList.splice(t,1),n.$rgDigest()}function k(e){n.emotions.length=0,n.emotions.push(e),n.$rgDigest()}function $(e){var t=E.defer();function n(e){RingLogger.information("HASH TAG SUGGESTION",RingLogger.tags.UPLOAD),RingLogger.print(e,RingLogger.tags.UPLOAD),e.sucs===!0?t.resolve(e.sgstn):t.resolve([])}return RingLogger.information("Searching for :"+e,RingLogger.tags.MEDIA),m.fetchHashtagSuggestion(e).then(n),t.promise}function G(e,t){t.stopPropagation(),"string"==typeof e||e instanceof String?n.hashTags.push({sk:e,ukey:0}):n.hashTags.push(e),n.$rgDigest()}function B(e,t){e.preventDefault(),n.hashTags.splice(t,1),n.$rgDigest()}function H(){return e.audioFiles.length>0||e.videoFiles.length>0}function x(){n.showFriendTag=!n.showFriendTag}function Y(e){return f.myFriends(20,e)}function K(e,t){n.friendTags.add(e.getKey(),e),t.stopPropagation(),n.$rgDigest()}function j(e,t){t.stopPropagation(),n.friendTags.remove(e),n.$rgDigest()}function V(e,t){t.preventDefault(),"string"==typeof e||e instanceof String?(n.ddControl.albumName=e,n.ddControl.selectedAlbum=-1):(n.ddControl.albumName=e.getName(),n.ddControl.selectedAlbum=e.getId()),RingLogger.print(e),n.$rgDigest()}}angular.module("ringid.postbox").directive("rgUploadPreview",uploadPreview);function uploadPreview(){e.$inject=["$scope","fileUploadService","SystemEvents"];function e(e,t,n){e.previewStartAt=0,e.getMedia=i,e.loadPrevious=a,e.loadNext=s,e.removeMedia=o;function r(){e.previewStartAt=0,e.$rgDigest()}r(),e.$on(n.FILE_UPLOAD.UPLOADS_POSTED,r),e.$broadcast(n.FILE_UPLOAD.PROGRESS_UPDATE,function(){e.$rgDigest()});function i(n){return n?t[e.uploadSpec.type+"Files"]:t[e.uploadSpec.type+"Files"].slice(e.previewStartAt,e.previewStartAt+3)}function o(n){t[e.uploadSpec.type+"Files"][n].getQueued()?(t[e.uploadSpec.type+"Files"][n].cancelUpload(),t[e.uploadSpec.type+"Files"].splice(n,1)):t[e.uploadSpec.type+"Files"].splice(e.previewStartAt+n,1),0===t[e.uploadSpec.type+"Files"].length?(RingLogger.information("All media files removed from status",RingLogger.tags.UPLOAD),r()):(e.previewStartAt=e.previewStartAt>0?e.previewStartAt-1:e.previewStartAt,e.$rgDigest())}function a(){e.previewStartAt=e.previewStartAt-3>0?e.previewStartAt-3:0}function s(){e.previewStartAt=e.previewStartAt+3<=t[e.uploadSpec.type+"Files"].length-4?e.previewStartAt+3:t[e.uploadSpec.type+"Files"].length-3}}return{restrict:"E",template:'<div class="status-photo-view" style="border-bottom:1px solid #ebebeb;margin:0;padding:0;margin-bottom:10px;" id="img-height" ng-show="getMedia(true).length > 0"><div id="sts-img-preview" style="text-align:center;" class="scroll"><div ng-show="previewStartAt+3 < getMedia(true).length" class="np-box img_sprite icon-right-arrow"  style="right:0;margin-top:60px;" rg-click="loadNext()"></div><div ng-show="previewStartAt > 0" class="np-box  img_sprite icon-left-arrow" style="left:0;margin-top:60px;"  rg-click="loadPrevious()"></div><div style="margin-top:3px;" class="status-photo-view-thumb" ng-repeat="image in getMedia()"><div ng-show="image.getProgress() !== 100" class="progress-bar-placement" style="position:absolute;width:100%;text-align:center;"><div class="percent">{{image.getProgress()}}%</div><div class="progress-bar"><div class="uploaded" ng-style="{\'width\': image.getProgress()+ \'%\'}"></div></div></div><div  id="singleImage{{$index}}"  style="position:absolute;width:100%;text-align:center;"><input class="add-title" ng-model="image.cptn" ng-model-options="{ getterSetter: true }" type="text" name="" placeholder="Add Photo Title" ng-show="!image.progressVisible" /><div class="m-icn" ng-class="{\'audio\' : uplodSpec.type == \'audio\', \'video\' : uplodSpec.type == \'video\'}"></div><div class="photo-view" style="background-image: url({{image.getPreview()}}); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer;"><div class="status-photo-view-thumb-hover"><span id="closebtn0" class="close" style="display: block;" rg-click="removeMedia($index)" inc="0"><div class=" up-p"></div></span></div></div></div></div></div>',controller:e}}!function(e,t){"use strict";e.module("ringid.feed",["ngWebSocket","ringid.utils","ringid.config","ringid.connector","ringid.directives","ringid.postbox"])}(angular,window),angular.module("ringid.feed").directive("rgFeedSubscriber",rgFeedSubscriber),rgFeedSubscriber.$inject=["$$connector","feedFactory","$window","$$rgsyncher","OPERATION_TYPES","REASON_CODES","$rootScope"];function rgFeedSubscriber(e,t,n,r,i,o,a){return function(n){var i,s,c=n.$parent,l=!1,u=!1;function d(e){var n;l||(l=!0,c.addIgnore(),setTimeout(function(){a.$broadcast("FIRST_FEED_RECEIVED")},1e3)),!e.sucs&&e.rc>0&&e.rc===o.NO_MORE_FEED?c.setNoMoreFeed(!0):1111===e.rc?c.feeds.length||t.initFeedRequest(c.params):n=t.process(e),n?n.$rgDigest():(c.feeds=t.getFeeds(),c.busy&&(c.busy=!1,c.clearRequestTimer()),u===!1&&(u=!0,requestAnimationFrame(function(){c.$rgDigest(),u=!1})))}i=e.subscribe(d,{filter:t.getFeedFilter(),callWithUnresolved:!0}),s=r.add(function(){t.requestForFeed(c.params,1)}),c.$on("$destroy",function(){e.unsubscribe(i),t.reset(),r.remove(s),l&&c.removeIgnore()})}}angular.module("ringid.feed").directive("feedImage",feedImage),feedImage.$inject=["Utils","SystemEvents","$compile"];function feedImage(e,t,n){var r,i,o,a,s;function c(e,t){return t*e.height/e.width}function l(e,t){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="RingBoxImageController" ringbox-type="remote" ringbox-animation="true" ringbox-target="templates/partials/notification/'+(t||"image-popup.html")+'" ringbox-data="getImageData(feedimages['+e+'].value, feed)"></div>'}function u(e,t,n){return'<div class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="'+n+'" ringbox-type="remote" ringbox-animation="true" ringbox-target="'+t+'"loader-hide = "false"ringbox-scrollable="true" ringbox-data="getFeedInfo(feed)"></div>'}function d(e){return'<a ng-href="{{feed.getNewsPortalUrl()}}" target="_blank" class="img'+(e+1)+'" style="background-image:url(\'{{::feedimages['+e+"].value.src(600)}}')\"></a>"}return r={layout_0:'<div class="grid">'+l(0)+'</div><div class="grid">'+l(1)+l(2)+"</div>",layout_2:'<div class="grid">'+l(0)+l(1)+'</div><div class="grid">'+l(2)+"</div>",layout_4:'<div class="grid">'+l(0)+l(1)+"</div>",layout_5:l(0)},r.layout_1=r.layout_0,r.layout_3=r.layout_2,r.layout_6=r.layout_5,i={layout_0:'<div class="grid">'+l(0,"image-popup-special.html")+'</div><div class="grid">'+l(1,"image-popup-special.html")+l(2,"image-popup-special.html")+"</div>",layout_2:'<div class="grid">'+l(0,"image-popup-special.html")+l(1,"image-popup-special.html")+'</div><div class="grid">'+l(2,"image-popup-special.html")+"</div>",layout_4:'<div class="grid">'+l(0,"image-popup-special.html")+l(1,"image-popup-special.html")+"</div>",layout_5:l(0,"image-popup-special.html")},i.layout_1=i.layout_0,i.layout_3=i.layout_2,i.layout_6=i.layout_5,o={layout_0:'<div class="grid">'+u(0,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+'</div><div class="grid">'+u(1,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+u(2,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+"</div>",layout_2:'<div class="grid">'+u(0,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+u(1,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+'</div><div class="grid">'+u(2,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+"</div>",layout_4:'<div class="grid">'+u(0,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+u(1,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")+"</div>",layout_5:u(0,"pages/newsportal/portal-feed-popup.html","PortalFeedPopUpController")},o.layout_1=o.layout_0,o.layout_3=o.layout_2,o.layout_6=o.layout_5,a={layout_0:'<div class="grid">'+u(0,"pages/business/business-feed-popup.html","businessFeedPopupController")+'</div><div class="grid">'+u(1,"pages/business/business-feed-popup.html","businessFeedPopupController")+u(2,"pages/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_2:'<div class="grid">'+u(0,"pages/business/business-feed-popup.html","businessFeedPopupController")+u(1,"pages/business/business-feed-popup.html","businessFeedPopupController")+'</div><div class="grid">'+u(2,"pages/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_4:'<div class="grid">'+u(0,"pages/business/business-feed-popup.html","businessFeedPopupController")+u(1,"pages/business/business-feed-popup.html","businessFeedPopupController")+"</div>",layout_5:u(0,"pages/business/business-feed-popup.html","businessFeedPopupController")},a.layout_1=a.layout_0,a.layout_3=a.layout_2,a.layout_6=a.layout_5,s={layout_0:'<div class="grid">'+d(0)+'</div><div class="grid">'+d(1)+d(2)+"</div>",layout_2:'<div class="grid">'+d(0)+d(1)+'</div><div class="grid">'+d(2)+"</div>",layout_4:'<div class="grid">'+d(0)+d(1)+"</div>",layout_5:d(0)},s.layout_1=s.layout_0,s.layout_3=s.layout_2,s.layout_6=s.layout_5,{restrict:"A",scope:!0,link:function(e,t,l){var u,d;"shared"===l.feedImage&&(e.feed=e.feed.getOrginalFeed()),e.layout_id=e.feed.getImageLayout(),e.feedimages=e.feed.getImages(),5===e.layout_id&&(e.feedimages[0].value.offset().width<600&&e.feedimages[0].value.offset().height<400?e.layout_id=6:c(e.feedimages[0].value.offset(),600)<400&&(e.layout_id=6)),t.addClass("img-layout-"+e.layout_id),e.feedimages.length&&(u=l.popupTemplate?i:r,"true"===l.portal&&"false"===l.exUrl&&(u=o),"true"===l.portal&&"true"===l.exUrl&&(u=s),"true"===l.pages&&"false"===l.exUrl&&(u=a),"true"===l.pages&&"true"===l.exUrl&&(u=s),d=n(u["layout_"+e.layout_id])(e),e.feed.getTotalImage()>3&&(d[1].lastChild.innerHTML='<div class="img-bg-opa"></div><div class="img-bg-counter">+'+(e.feed.getTotalImage()-3)+"</div>"),t.html(""),t.append(d))}}}angular.module("ringid.feed").directive("rgMoreFeed",rgMoreFeed),rgMoreFeed.$inject=["feedFactory","SystemEvents","$ringbox"];function rgMoreFeed(e,t,n){return{restrict:"A",link:function(r,i,o){var a,s=r.$eval(o.rgMoreFeed),c=0,l=s.getDynamicText().toString(),u=s.showMore(),d=s.text();function g(){var e=d;r.showFeedFullContent||(d.length>250&&(e=d.substr(0,d.indexOf(" ",249)),u=!0),e&&e.split(/\r\n|\n\r/).length>10&&(u=!0,e=e.split(/\r\n|\n\r/,10).join("\n\r")),e=u?s.getCroppedHtml(e):l),e?(i.html(e),r.editorEnabled?i.addClass("ng-hide"):i.removeClass("ng-hide")):i.addClass("ng-hide"),m()}function m(){u&&(a=angular.element('<span style="display:inline-block;margin-left:5px;" class="showpointer showmore"> Show More</span>'),i.append(a),a.bind("click",f),r.$on("$destroy",function(){a&&(a.unbind("click"),a=null)}))}function E(){l=s.getDynamicText().toString(),u=s.showMore(),a&&(a.unbind("click"),a=null),g()}g(),r.$on(t.FEED.UPDATED,function(e,t){t.id===s.getKey()&&E()}),r.$on(t.FEED.RESET,function(e,t){t.getKey()===s.getKey()&&(s=t,E())}),r.$watch("feed.text()",function(){c>0&&E(),c++});function f(){s.showMore()?n.open({type:"remote",scope:!1,scrollable:!0,controller:"PopupSingleFeedController",onBackDropClickClose:!0,resolve:{remoteData:function(){return e.moreFeedText(s)}},templateUrl:"pages/home/popup-feed.html"}):(i.html(l),a.unbind("click"),a=null)}}}}angular.module("ringid.feed").directive("rgIncomingFeed",rgIncomingFeed),rgIncomingFeed.$inject=["feedFactory","$window","Utils","OPERATION_TYPES"];function rgIncomingFeed(e,t,n,r){return{restrict:"A",link:function(i,o){var a,s=angular.element(t),c=e.getCurrentPageValue(),l=0,u=r.SYSTEM;switch(c.action){case u.TYPE_MY_NEWS_FEED:case u.TYPE_FRIEND_NEWSFEED:l=492;break;case u.TYPE_GROUP_NEWS_FEED:l=250;break;case u.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:case u.TYPE_NEWS_FEED:default:l=0}function d(){var e,t,r=n.viewport.yo;l>0&&(t=l+75,e=t-r,e>0&&(e<75?o.css("top","75px"):o.css("top",e+"px")))}function g(){e.hasUnprocessedFeed()?o.hasClass("active")||o.addClass("active"):o.removeClass("active")}function m(){n.viewport.yo>500?e.setpushInIncomingFeed(!0):e.hasUnprocessedFeed()&&a>n.viewport.yo?(e.processIncomingFeed(),e.setpushInIncomingFeed(!1),g()):e.setpushInIncomingFeed(!1),o.hasClass("active")&&d(),a=n.viewport.yo}i.$watch(e.hasUnprocessedFeed,function(e,t){e>t&&g()});function E(){e.processIncomingFeed(),e.setpushInIncomingFeed(!1),g(),n.resetScroll(),n.animateScroll(),i.setFeed(),i.$rgDigest()}o.on("click",E),s.bind("scroll",m);function f(){s.unbind("scroll",m),o.off("click",E)}g(),i.$on("$destroy",f)}}}angular.module("ringid.feed").directive("feedTimeoutSelect",feedTimeoutSelect).directive("feedTimoutOption",feedTimoutOption).directive("feedTimeoutMenu",feedTimeoutMenu);function feedTimoutOption(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed-timeout-option.html",link:function(e){e.$rgDigest()},controller:["$scope",function(e){e.rows=[1,9,17],e.cols=[0,1,2,3,4,5,6,7],e.lastCols=[25,26,27,28,29,30],e.select=function(t){angular.isFunction(e.onSelect)&&e.onSelect({item:t}),e.close(),e.$parent.$rgDigest()}}]}}function feedTimeoutSelect(){return function(e,t,n){function r(t){t.stopPropagation(),e.select(n.feedTimeoutSelect)}t.on("click",r),e.$on("$destroy",function(){t.off("click",r)})}}feedTimeoutMenu.$inject=["$document","$compile"];function feedTimeoutMenu(e,t){return{restrict:"A",scope:{onSelect:"&ringOnOptionSelect",value:"=selectedValue"},link:function(n,r){var i,o=!1;n.close=function(){i&&i.remove(),i=null,o=!1,e.off("click",s)};function a(e){parseInt(e,10)>-1?r.addClass("active"):r.removeClass("active")}n.$watch("value",a);function s(e){e.target!==r[0]&&e.target.parentNode!==r[0]&&e.target.parentNode.parentNode!==r[0]&&"pt-top"!==e.target.className&&n.close()}function c(){return o?void n.close():(i||(i=t(angular.element("<feed-timout-option></feed-timout-option>"))(n)),r.after(i),o=!0,void e.on("click",s))}r.on("click",c),n.$on("$destroy",function(){r.off("click",c),e.off("click",s)})}}}angular.module("ringid.feed").directive("feedRepeat",feedRepeat),feedRepeat.$inject=["$parse","$compile","$templateCache","$http","Utils","$rootScope","SystemEvents","$sniffer","feedFactory"];function feedRepeat(e,t,n,r,i,o,a,s,c){function l(e){return function(e,l,u,d,g){var m,E,f,p,T,h,I,_,A=u.feedRepeat,S=A.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),C=[],v=3,D=i.feedColumn(),R=Object.create(null),M=[],N=!1,y=document.querySelector("div.middle"),b=i.viewport.y,O=b/2,P=0,L=0,U=s.vendorPrefix.toLowerCase(),F="moz"===U||"ms"===U,w=!1,k=!0,$=0,G="",B=[],H=!1,x=!1,Y=!1,K=Object.create(null),j=!1;for(E=S[2],f=S[1],m=0;m<v;m++)p={},_=document.createElement("div"),_.className="cell cell-id"+m,_.appendChild(document.createComment("cell: "+m)),p.element=_,T=document.createElement("div"),T.innerHTML='<div class="rf-box"><div class="rf-top"><div class="rf-cir"><span class="icon-logo-circle"></span></div><div class="rf-line"></div></div><div class="rc-feed"> </div><div class="rc-feed rc2"> </div><div class="rc-feed rc3"> </div><div class="rf-ics"></div></div>',T.style.display="none",_.appendChild(T),p.loader=T,C[m]=p,e.showPostBox()&&u.postbox&&0===m?(V(),j=!0):(H=!0,W()),T=null;for(e.showSpecialFeed()&&r.get("templates/partials/special-feed.html",{cache:n}).then(function(e){G=e.data}),m=0;m<v;m++)l[0].appendChild(C[m].element);function V(){var n=t('<rg-postbox set-feed="setFeed" feed-add="feedAdd" ></rg-postbox')(e),r=C[0].element;r.insertBefore(n[0],r.firstChild.nextSibling),H=!0,W(),ee()}function W(){requestAnimationFrame(function(){ne(e[E])})}function q(e){x===e||Y||(requestAnimationFrame(function(){for(m=0;m<D;m++)C&&C[m].loader&&(C[m].loader.style.display=e?"block":"none");Y=!1}),Y=!0,x=e)}function z(){var e;for(e=0;e<v;e++)e<D?C[e].display||(C[e].element.style.display="block",C[e].display=!0,RingLogger.print("visibility of cell changed",RingLogger.tags.FEED)):C[e].display!==!1&&(C[e].element.style.display="none",C[e].display=!1)}function Q(){ne(e[E]),X(!1),w=!1,q(w),z()}y.style.height=b+"px",z(),w=!0,q(w),h=-1*b*4,I=4*b,document.documentElement.scrollTop=0,document.body.parentNode.scrollTop=0,document.body.scrollTop=0;function X(t){H&&C&&requestAnimationFrame(function(){var n,r,o,a,s,c,u,d,g=[139,0,0],E=[],f=[],p=[0,0,0],T=[0,0,0];if(L=l[0].scrollHeight,n=L-i.viewport.y-i.viewport.y,i.viewport.yo>n&&t){if(e.loadMoreData(),e.noMoreFeed)return;e.busy!==w&&(w=e.busy,q(w))}if(!(N||Math.abs(i.viewport.yo-P)<O)){for(P=i.viewport.yo,j||(g[0]=0),m=0;m<B.length;m++)a=B[m],o=a.key,K[o]&&(s=K[o],s&&(c=s.height,r=s.cell,g[r]+=c,g[r]>=h+P&&g[r]<=P+b+I?s.clone.RG_HIDDEN&&E.push(s.clone):(g[r]<h+P&&(p[r]+=c),g[r]>=h+P&&g[r]>P+b+I&&(T[r]+=c),s.clone.RG_HIDDEN||f.push(s.clone))));for(m=0;m<M.length;m++)a=M[m],o=a.key,R[o]&&(s=R[o],s&&(c=s.height,r=s.cell,g[r]+=c,g[r]>=h+P&&g[r]<=P+b+I?s.clone.RG_HIDDEN&&E.push(s.clone):(g[r]<h+P&&(p[r]+=c),g[r]>=h+P&&g[r]>P+b+I&&(T[r]+=c),s.clone.RG_HIDDEN||f.push(s.clone))));for(a=null,s=null,u=Math.max(Math.max.apply(null,g),b),y.style.height=u+O+"px",d=0;d<C.length;d++)C[d].element.style.paddingTop=p[d]+"px";for(d=0;d<E.length;d++)E[d].style.display="block",E[d].RG_HIDDEN=!1;for(d=0;d<f.length;d++)f[d].style.display="none",f[d].RG_HIDDEN=!0}})}function Z(){ne(e[E]),z()}window.addEventListener("scroll",X),e.$on(a.COMMON.COLUMN_CHANGED,function(e,t){D=t,Q()}),e.$on(a.COMMON.WINDOW_RESIZED,Z),e.$on(a.COMMON.WINDOW_SCROLLED,Z),e.$watchCollection(E,ne),e.$on("$destroy",function(){R=M=_=C=p=K=B=y=G=x=null,window.removeEventListener("scroll",X)}),e.$on(a.FEED.HEIGHT,function(e,t){e.stopPropagation(),R&&R[t]&&J(R[t])}),e.$on(a.FEED.BUSY,function(e,t){w=t,q(w)});function J(e){fastdom.defer(2,function(){e&&(e.height=e.clone.offsetHeight+12)})}function ee(){requestAnimationFrame(function(){e.$rgDigest()})}function te(){this.removeEventListener(U+"TransitionEnd",te),this.removeEventListener("transitionend",te),this.parentNode.removeChild(this)}function ne(n){var r,i,a,s,l,u,d,E,p=n.length,T=[],h=Object.create(null),I=0,_=[];N=!0;function A(e){d.insertBefore(e[0],u.nextSibling),u=e[0],!F||k||$<10?u.style.opacity=1:_.push(u),l.clone=u,T[l.cell]=u,l.serialElm=l.clone.querySelector("[feed-serial]"),$++,J(l)}if(H&&C){if(0===n.length&&k)return void(e.noMoreFeed&&ee());for(o.$$postDigest(function(){for(m=0;m<n.length;m++)r=n[m],s=r.key,R[s]&&(l=R[s],l&&l.childHead&&(l.scope.$$childHead=l.childHead))}),c.hasSpecialFeed()&&(B=c.getSpecialFeedList(),I=B.length),m=0;m<p;m++){if(a=(m+I)%D,r=n[m],s=r.key,R[s]){if(l=R[s],!l)continue;l.cell=a,delete R[s]}else i=e.$new(),i[f]=r,l={},l.clone=null,l.cell=a,l.scope=i,l.height=110,l.key=s,l.serial=-1;h[s]=l}for(m=0;m<D;m++)T[m]||(T[m]=j&&0===m&&C[m].element.firstElementChild?C[m].element.firstElementChild:C[m].element.firstChild);for(s in R)if(R[s]){if(l=R[s],!l)continue;l.clone.style.opacity=0,l.clone.RG_DELETE=!0,l.clone.addEventListener(U+"TransitionEnd",te),l.clone.addEventListener("transitionend",te),l.scope.$destroy()}if(G&&I>0)for(m=0;m<I;m++){if(r=B[m],s=r.key,a=m%D,u=T[a],d=u.parentNode,K[s]){if(l=K[s],!l)continue;E=l.clone,l.cell=a,E!==u.nextSibling&&d.insertBefore(E,u.nextSibling),T[l.cell]=E}else i=e.$new(),i[f]=r.value,E=t(G)(i),d.insertBefore(E[0],u.nextSibling),u=E[0],u.style.opacity=1,l={},l.clone=E[0],l.cell=a,l.scope=i,l.height=110,l.key=s,l.serial=m,l.serialElm=l.clone.querySelector("[feed-serial]"),T[a]=u,K[s]=l,J(l);l.serialElm&&(l.serialElm.innerHTML=m+1)}for(m=0;m<p;m++)if(r=n[m],s=r.key,l=h[s]){if(l.scope.$index=m,u=T[l.cell],d=u.parentNode,E=l.clone){do u=u.nextSibling;while(u&&u.RG_DELETE);E!==u&&d.insertBefore(E,u),T[l.cell]=E,l.childHead=l.scope.$$childHead,l.scope.$$childHead=null}else g(l.scope,A);l.serial!==m+I&&l.serialElm&&(l.serialElm.innerHTML=I+m+1,l.serial=m+I)}_.length>0&&fastdom.defer(2,function(){if(_){for(m=0;m<_.length;m++)_[m].style.opacity=1;_=null}}),e.busy!==w&&(w=e.busy,q(w),w=null),R=h,M=n,N=!1,h=null,k=!1,l=null,E=null,d=null,u=null,T=null,i=null,n.length<=10&&ee()}}}}return{restrict:"A",transclude:!0,priority:1e3,terminal:!0,compile:l}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedLocationViewItem",feedLocationViewItem);function feedLocationViewItem(){return{restrict:"E",scope:{onHover:"&",onSelect:"&",location:"="},templateUrl:"templates/partials/feed_location/item.html",link:function(e,t){function n(t){t.stopPropagation(),e.onSelect&&e.onSelect({location:e.location})}t.on("click",n);function r(){e.onHover({location:e.location})}e.onHover&&t.on("mouseover",r),e.$on("$destroy",function(){t.off("click",n),t.off("mouseover",r)})}}}feedApp.directive("feedLocationView",feedLocationView),feedLocationView.$inject=["Utils","Ringalert"];function feedLocationView(e,t){function n(e){e.stopPropagation()}return{restrict:"E",replace:!0,templateUrl:"templates/partials/feed_location/view.html",compile:function(){return{pre:function(e,t){e.initLocation(t)},post:function(e,t){e.$rgDigest(),t.on("click",n),e.$on("$destroy",function(){t.off("click",n)})}}},controller:["$scope",function(n){var r,i,o,a,s,c={};n.keyword="",n.showLocationMap=!0,n.suggestedLocations=[],n.loadingData=!1,n.selfLocation={},n.onLocationItemSelect=l,n.shareUserLocation=u,n.onLocationItemHover=g,n.initLocation=d;function l(e){var t;if(angular.isFunction(n.onItemSelect)){try{t={description:e.terms[0].value}}catch(n){t={description:e.description}}t.lat=9999,t.lng=9999,e.geometry&&e.geometry.location&&(t.lat=e.geometry.location.lat(),t.lng=e.geometry.location.lng()),n.onItemSelect({location:t}),n.$parent.$rgDigest()}n.close()}function u(){e.getUserLocation().then(function(e){e.sucs?(n.onItemSelect({location:e}),n.$rgDigest(),n.close()):t.show({mg:"Unable to detect user location"},"error")})}function d(t){s=t.find("input")[0],o=new google.maps.places.PlacesService(s),a=new google.maps.places.AutocompleteService,s.focus(),e.getUserLocation(!0).then(function(e){n.selfLocation=e,A(e.sucs?{lat:e.lat,lng:e.lng,description:e.description}:{lat:23.772493,lng:90.4098315,description:"IPvision Ltd."})}),n.keyword=n.value?n.value.description:""}function g(e){try{S(e.place_id),T()}catch(e){}}function m(e){o.getDetails({placeId:e},function(t,n){n===google.maps.places.PlacesServiceStatus.OK&&(angular.extend(c[e],t),c[e]=t),I()})}function E(e,t){return t!==google.maps.places.PlacesServiceStatus.OK?void p():(h(),angular.forEach(e,function(e){var t=e.place_id;c[t]?angular.extend(c[t],e):(m(t),c[t]=e),n.suggestedLocations.push(c[t])}),n.suggestedLocations.length>0&&p(),void I())}function f(){n.loadingData=!0}function p(){n.loadingData=!1}function T(){n.showLocationMap=!0}function h(){n.suggestedLocations=[]}function I(){n.$rgDigest()}function _(e){return new google.maps.LatLng(e.lat,e.lng)}function A(e){var t=_(e);i=new google.maps.Map(document.getElementById("feed-location-map"),{center:t,zoom:13}),e.description&&a.getPlacePredictions({input:e.description,rankBy:google.maps.places.RankBy.DISTANCE},E)}function S(e){var t=c[e];t&&(r&&r.setMap(null),i.setCenter(t.geometry.location),r=new google.maps.Marker({map:i,place:{placeId:e,location:t.geometry.location}}))}function C(e){h(),f(),I(),a.getPlacePredictions({input:e},E)}function v(e){var t=e.target.value;t&&t.length>3?C(t):(h(),I()),n.keyword=e.target.value}n.processKeyup=e.debounce(v,500)}]}}function feedLocationPreview(){return{replace:!0,template:'<span ng-if="!!feed.getLocationInfo().lat" ><a ng-href="{{ ::feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote"ringbox-target="templates/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }"><img height="170px" width="100%" ng-src="{{ ::feed.getLocationStaticEmbedUrl() }}" alt="location-hover" /></a>'}}feedApp.directive("feedLocationPreview",feedLocationPreview);var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedLocationMenu",feedLocationMenu),feedLocationMenu.$inject=["$document","$compile","Utils"];function feedLocationMenu(e,t,n){return{restrict:"A",scope:{onItemSelect:"&feedLocationMenuOnSelect",value:"=selectedValue",viewWidth:"@",viewHeight:"@",autoAdjust:"@"},link:function(r,i,o){var a,s,c=!1,l=20;r.viewDirection="right",o.feedLocationMenuDirection&&(r.viewDirection=o.feedLocationMenuDirection,s=!0),r.viewWidth=r.viewWidth||600,r.viewHeight=r.viewHeight||466,r.close=function(){a&&a.remove(),a=null,c=!1,e.off("click",u)},r.$watch("value",function(e){e.description?i.addClass("active"):i.removeClass("active")});function u(e){e.target!==i[0]&&e.target.parentNode!==i[0]&&e.target.parentNode.parentNode!==i[0]&&"pt-top"!==e.target.className&&(r.close(),"false"!==r.autoAdjust&&d(event))}function d(e){var t=n.viewportsize();window.eventFix(e),!s&&e.pageY+r.viewHeight+l>t.y&&window.scrollToYOffset(e.pageY-t.y/2,500),e.pageX+r.viewWidth+l>t.x-200&&(r.viewDirection+=" left")}function g(n){return c?void r.close():("false"!==r.autoAdjust&&d(n),a||(a=t(angular.element("<feed-location-view></feed-location-view>"))(r)),i.after(a),c=!0,void e.on("click",u))}i.on("click",g),r.$on("$destroy",function(){a&&a.remove(),i.off("click",g),e.off("click",u)}),r.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedTop",rgNewsFeedTop),rgNewsFeedTop.$inject=["$templateCache"];function rgNewsFeedTop(e){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",template:e.get("top.html")}}angular.module("ringid.feed").directive("rgNewsFeedBottom",rgNewsFeedBottom),rgNewsFeedBottom.$inject=["$templateCache"];function rgNewsFeedBottom(e){return{restrict:"E",template:e.get("bottom.html")}}angular.module("ringid.feed").directive("rgNewsFeedDetails",rgNewsFeedDetails);function rgNewsFeedDetails(){return{restrict:"E",templateUrl:"templates/partials/news_feed/details.html",link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgNewsFeedSharedFeed",rgNewsFeedSharedFeed);function rgNewsFeedSharedFeed(){return{restrict:"E",templateUrl:"templates/partials/news_feed/shared_feed.html"}}angular.module("ringid.feed").directive("rgNewsFeedMenu",rgNewsFeedMenu),rgNewsFeedMenu.$inject=["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert"];function rgNewsFeedMenu(e,t,n,r,i){return{restrict:"E",template:n.get("menu.html"),link:function(n,o){var a=null,s=null,c=o[0].querySelector("[data-events]"),l=o[0].closest("[data-feed-bottom]");function u(e){var t,o;if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){if(e.stopPropagation(),t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0),!o.sucs)return void i.show(r[o.rc],"warning");d()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),g()),n.$rgDigest()}c.addEventListener("click",u);function d(){return n.showCommentBox&&(l.removeChild(a),n.showCommentBox=!1),n.showShareBox?n.showShareBox?(l.removeChild(s),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey()):(s=s||e("<feed-inline-share-view></feed-inline-share-view>")(n)[0],l.appendChild(s),n.showShareBox=!0,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}function g(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox"comment-type = "feed" comment-order = "asc"></rg-comments>',n.showShareBox&&(l.removeChild(s),n.showShareBox=!1),n.showCommentBox?(l.removeChild(a),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,a=a||e(r)(n)[0],l.appendChild(a),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}n.closeShareBox=function(){n.showShareBox=!0,d(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,g(),n.$rgDigest()},n.$on("$destroy",function(){c.removeEventListener("click",u),c=null,l=null,a=null,s=null})}}}angular.module("ringid.feed").directive("rgPortalNewsFeedMenu",["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert","$ringbox",function(e,t,n,r,i,o){return{restrict:"E",template:n.get("menu.html"),link:function(n,a){var s=null,c=null,l=a[0].querySelector("[data-events]"),u=a[0].closest("[data-feed-bottom]");n.$rgDigest();function d(e){var t,o;if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){if(e.stopPropagation(),t=n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed,o=t.isShareAble(!0),!o.sucs)return void i.show(r[o.rc],"warning");g()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),m()),n.$rgDigest()}l.addEventListener("click",d);function g(){var e;return n.showCommentBox&&(u.removeChild(s),n.showCommentBox=!1),n.showShareBox?n.showShareBox?(u.removeChild(c),n.showShareBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):void n.$emit("$feedHeight",n.feed.getMapKey()):(e=o.open({type:"remote",scope:!1,controller:"feedNewsPortalShareController",scopeData:{feed:n.feed},onBackDropClickClose:!0,templateUrl:"templates/newsportal/portal-share-news.html"}),void e.result.then(function(){n.$rgDigest()}))}function m(){var r;return r='<rg-comments target = "feed" show-comment-box="showCommentBox"comment-type = "feed" comment-order = "asc"></rg-comments>',n.showCommentBox?(u.removeChild(s),n.showCommentBox=!1,void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey())):(n.showCommentBox=!0,s=s||e(r)(n)[0],u.appendChild(s),void n.$emit(t.FEED.HEIGHT,n.feed.getMapKey()))}n.closeShareBox=function(){n.showShareBox=!0,g(),n.$rgDigest()},n.closeCommentBox=function(){n.showCommentBox=!0,m(),n.$rgDigest()},n.$on("$destroy",function(){l.removeEventListener("click",d),l=null,u=null,s=null,c=null})}}}]),angular.module("ringid.feed").directive("locationCard",function(){return{restrict:"E",replace:!0,scope:{feed:"="},template:'<span class="location">&nbsp;at&nbsp;<a ng-href="{{ ::feed.getLocationUrl() }}"rg-ringbox="true" ringbox-type="remote" ringbox-target="templates/partials/google-map-preview.html"scope-data="{url : feed.getLocationEmbedUrl() }">{{::feed.getLocationShortText()}}</a></span>'}}).directive("userCard",function(){return{restrict:"E",replace:!0,controller:["$scope","Api","friendsFactory","settings",function(e,t,n,r){e.getUserDetail=function(){e.showMfc=!1,t.user.getUserDetails({utId:e.user.getUtId()},!0,e.user.isNewsPortalUser(),e.user.isBusinessPageUser()).then(function(t){t.sucs&&(e.mfc=t.userDetails.mfc,e.showMfc=!0,e.user.setUid(t.userDetails.uId),t.userDetails.npDTO&&(e.portalCategory=t.userDetails.npDTO.nPCatName,e.follower=t.userDetails.npDTO.subCount,e.isSubscribed=t.userDetails.npDTO.subsc,e.profileImage=r.imBase+t.userDetails.prIm),e.$rgDigest())})},e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:t.user.getMutualFriends(e)}},e.contactListAction=function(t){t.friend.isLoading()||(n.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())}}],scope:{
user:"="},template:'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="{{::!user.isCurrentUser()}}"on-hover-start="getUserDetail" hover-template-url="{{user.getCardTemplate()}}">{{::user.getName()}}</a></span>'}}).directive("feedMessage",feedMessage).directive("feedTagMoreUser",feedTagMoreUser),feedMessage.$inject=["$compile"];function feedMessage(e){return{restrict:"A",scope:{feed:"=feedMessage"},link:function(t,n){t.$watch("feed.checkMessageUpdated()",function(){n.html(t.feed.getMessageText()),e(n.contents())(t)})}}}feedTagMoreUser.$inject=[];function feedTagMoreUser(){return{restrict:"E",scope:{feed:"=tagFeed"},controller:["$scope","feedFactory",function(e,t){var n;e.getTagUsers=function(e){return{data:function(){return{target:e}},promise:t.getTagUsers(e)}},e.tooltip="",e.feed.getTotalTag()>2&&(n=e.feed.getTagUsers(),n.length>1&&(e.tooltip+=n[1].getName(),n[2]&&(e.tooltip+="\n"+n[2].getName(),e.feed.getTotalTag()>3&&(e.tooltip+="\nand "+(e.feed.getTotalTag()-3)+" others"))))}],template:'<span class="">with&nbsp;</span><span class="tag-people"><user-card user="feed.getTagUsers()[0]"></user-card></span><span ng-if="::feed.getTotalTag() > 1">&nbsp;and&nbsp;<span class="tag-people" ng-if="::feed.getTotalTag() == 2"><user-card user="feed.getTagUsers()[1]"></user-card></span><span class="" ng-if="::feed.getTotalTag() > 2"><a rg-ringbox="true" ringbox-controller="feedTagUserListController" ringbox-type="remote"ringbox-target="templates/home/tag-user-list.html"ringbox-data="getTagUsers(feed)" class="tag-f-msg" data-tooltip="{{::tooltip}}">{{::feed.getTotalTag() -1}} others peoples</a></span></span>'}}angular.module("ringid.feed").directive("rgSingleFeedHeader",rgSingleFeedHeader).directive("rgSingleFeedBody",rgSingleFeedBody).directive("rgSingleFeedMenu",rgSingleFeedMenu);function rgSingleFeedBody(){return{restrict:"E",templateUrl:"templates/partials/single_feed/body.html"}}function rgSingleFeedHeader(){return{restrict:"E",templateUrl:"templates/partials/single_feed/header.html"}}function rgSingleFeedMenu(){return{restrict:"E",templateUrl:"templates/partials/single_feed/menu.html"}}angular.module("ringid.feed").directive("rgSingleFeedDetails",rgSingleFeedDetails);function rgSingleFeedDetails(){return{restrict:"E",templateUrl:"templates/partials/single_feed/details.html"}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){}feedApp.directive("feedInlineShareView",feedInlineShareView),feedInlineShareView.$inject=[];function feedInlineShareView(){return{restrict:"E",template:'<div class="status-box noselect inline-share"><form enctype="multipart/form-data"><div style="padding:10px"><div class="float-left"><div class="thumbnail"><div class="icon-logo-circle pss-logo"><a><img class="responsive-all" rg-src="currentUser.avatar(\'thumb\')"></a></div></div></div><div class="post-t float-right"><div class="inline-share-box"><rg-editor class="editor" editor-content="feedText" new-line="on" on-escape="closeShareBox" focus="showShareBox" placeholder="Write something...."></rg-editor><span class="esc-cancel" rg-click="closeShareBox()">Press Esc to <a>Cancel</a></span><p ng-if="emotions.length" class="pst-loc-txt"><span class="feelings-text">feeling</span> <img class="feed_emo" rg-src="emotions[0].url"> {{emotions[0].nm}} &nbsp;<span class="icon-close f-12" rg-click="emotions.length = 0"></span></p><div ng-if="tagList.length"><ul class="tag-fnd-lst"><span class="tag-with">With : </span><li ng-repeat="usr in tagList"><span class="tag-title">{{::usr.getName()}}</span>&nbsp;<span class="tag-cros" rg-click="removeTag(usr)">X</span></li></ul></div><p ng-if="feedLocation.description" class="pst-loc-txt">{{ feedLocation.description}} <span class="showpointer icon-close f-12" rg-click="resetFeedLocation()"></span></p><p ng-show="!boxIsLoading && errorMessage" class="s-error">{{errorMessage}}</p><!--<p ng-show="!boxIsLoading && !errorMessage" class="s-info"><b>Enter</b> to SHARE, <b>ESC</b> to Cancel</p>--><rg-loader-view2 is-loading="boxIsLoading"></rg-loader-view2></div></div><div class="clear"></div></div><div class="status-photo-box" style="margin:0;padding:0;border-top:1px solid #ebebeb;width:100%"><div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Feeling" rg-emotion on-select="chooseEmotion(item)" class="p-ab"><span class="img_sprite status-ico feeling-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Tag Friends" rg-tag-friend="" show-if="showAddTag" tag-items="tagList" on-select="addTag(item)" class="p-ab"><span class="img_sprite status-ico tag-f-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Location" feed-location-menu="" feed-location-menu-on-select="updateFeedLocation(location)" autoAdjust="{{::autoAdjustScroll}}" selected-value="feedLocation" class="p-ab"><span class="img_sprite status-ico location-ico"></span></a></div><div class="float-right pad-7-0"><input type="button" ng-disabled="inputDisabled" rg-click="shareFeed()" class="share_btn float-right" value="Share"></div><!--<p>Press escape to cancel</p>--></div></div></form><div class="clear"></div></div>',controller:"feedInlineShareController"}}angular.module("ringid.feed").controller("FeedMainController",["$scope","$timeout","feedFactory","$rootScope","SystemEvents",function(e,t,n,r,i){var o,a,s;n.reset(),e.noMoreFeed=!1;function c(){return!0}e.showPostBox=e.showPostBox||c,e.showSpecialFeed=e.showSpecialFeed||c,e.feeds=n.getFeeds(),n.setFactoryKey(e.pagekey),n.setSortBy(e.sortBy||"tm"),e.busy=!0,o=setInterval(function(){n.updateTime(),e.$rgDigest()},3e5),e.setFeed=function(t){e.feeds=[],e.feeds=n.getFeeds(),t&&e.$rgDigest()},e.forAdd=e.forAdd||"my",e.getFeeds=function(){return e.feeds&&0!==e.feeds.length||e.setFeed(),e.feeds},e.loadMoreData=function(){s=e.feeds.length,e.busy!==!1||e.noMoreFeed||(e.busy=!0,n.requestForMoreFeed(e.params),e.clearRequestTimer(),a=setTimeout(function(){e.busy&&s===e.feeds.length&&(e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy))},6e3))},e.clearRequestTimer=function(e){a&&clearTimeout(a),a=e},e.$on("FeedListChanged",function(){e.setFeed()}),e.setNoMoreFeed=function(t){e.noMoreFeed=t,n.noMoreFeed(t),e.busy=!1,e.$broadcast(i.FEED.BUSY,e.busy)},e.noDataYet=function(){return e.noMoreFeed&&0===e.feeds.length},e.getFeedInfo=function(e){return{data:function(){return{target:e}},promise:n.getPortalFeedDetails(e.getKey())}},n.initFeedRequest(e.params),e.$on("$destroy",function(){o&&(clearInterval(o),o=null)}),e.$on(i.COMMON.COLUMN_CHANGED,function(){e.$rgDigest()})}]),angular.module("ringid.feed").controller("SingleFeedSubController",["$$feedMap","$scope","$controller","$routeParams","feedFactory","Auth","SystemEvents","Utils","$location",function(e,t,n,r,i,o,a,s,c){t.feedId=parseInt(r.feedId||0,10),t.shared=!!r.shared,t.activeCommentId=parseInt(r.commentId||0,10),t.isReady=!1,t.noData=!1,t.pagekey=i.getSingleFeedPageKey(t.feedId),i.setFactoryKey(t.pagekey),t.singleFeed=!0,t.hideSerial=!0,t.showFeedFullContent=!0,t.ogData={},t.currentUser=o.currentUser(),l(),t.setFeed=function(e){e?c.path("/"):l()},t.skipSaveScope=!0,t.getFeedInfo=function(e){return{data:function(){return{target:e}}}},n("FeedSubController",{$scope:t});function l(){i.getSingleFeed(t.feedId,t.shared).then(function(e){e?(t.feed=e,t.isReady=!0,u()):(t.feed=!1,t.isReady=!0,t.noData=!0),t.$rgDigest()})}function u(){t.feed&&(t.serial=t.feed.serial,t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.shareMenuDisabled=t.feed.isCirclePost(),t.ogData=t.feed.getOgData(),t.ogShowPreview=t.feed.hasOgData(),t.showCommentBox=!0,n("FeedSubController",{$scope:t}),s.safeDigest(t),t.$broadcast(a.FEED.RESET,t.feed))}}]),angular.module("ringid.feed").controller("FeedSubController",FeedSubController),FeedSubController.$inject=["rgDropdownService","$rootScope","$scope","$location","feedFactory","Ringalert","MESSAGES","SystemEvents","$ringbox"];function FeedSubController(e,t,n,r,i,o,a,s,c){var l,u;n.showdroparrow=0,n.showCommentBox=!1,n.showShareBox=!1,n.showCommentView=!0,n.showShareForm=!1,l=n.feed&&n.feed.value?n.feed.value:n.feed,l&&l.isSingleContentFeed()?(l.getMedias().length()||l.getAudios().length()?n.likeType="media":l.getImages(!0).length()&&(n.likeType="image"),n.likeTarget=l.getSingleContent()):(n.likeType="feed",n.likeTarget=l),n.shareMenuDisabled=!!n.shareMenuDisabled&&n.shareMenuDisabled,n.toggleCommentBox=function(e){e.stopPropagation(),n.showCommentBox=!n.showCommentBox,n.showCommentBox&&(n.showShareBox=!1)},n.ddTemplate='<div class="ng-cloak action feed-ac z-in-110 top-23"><div class="ac-top-line drop-h" ng-if="ddControl.showEdit()"><span class="drop-sprite w-h-13 edit-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edit\', feedKey: ddControl.feedKey})" href="#">Edit</a></div><div class="ac-top-line drop-h" ng-if="ddControl.showReportButton()"><span class="drop-sprite w-h-13 report-ico feed-font"></span><a rg-report spam-type="{{ddControl.getSpamType()}}" spam-id="ddControl.getSpamId()">Report</a></div><div class="ac-top-line drop-h" ng-if="ddControl.showTagButton()"><span class="drop-sprite w-h-13 add-tag-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edittag\', feedKey: ddControl.feedKey})" href="#" class="border-0">{{ddControl.tagButtonText()}}</a></div><div class="ac-top-line drop-h"  ng-if="ddControl.showDelete()"><span class="drop-sprite w-h-13 delete-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'delete\', feedKey: ddControl.feedKey})" href="#" class="border-0">Delete</a></div><div class="ac-top-line drop-h" ng-if="ddControl.showSaveOptionForNews()"><span class="drop-sprite save-ico w-h-13 feed-font"></span><a rg-click="ddAction()({event: $event, action:\'save\', feedKey: ddControl.feedKey,ptype:3})" href="#" class="border-0">Save</a></div><div class="ac-top-line drop-h"  ng-if="ddControl.showUnsaveOptionForNews()"><span class="drop-sprite w-h-13 delete-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'unsave\', feedKey: ddControl.feedKey,ptype:3})" href="#" class="border-0">Unsave</a></div><div class="ac-top-line drop-h" ng-if="ddControl.showSaveOptionForBusiness()"><span class="drop-sprite save-ico w-h-13 feed-font"></span><a rg-click="ddAction()({event: $event, action:\'save\', feedKey: ddControl.feedKey,ptype:4})" href="#" class="border-0">Save</a></div><div class="ac-top-line drop-h"  ng-if="ddControl.showUnsaveOptionForBusiness()"><span class="drop-sprite w-h-13 delete-ico feed-font"></span><a rg-click="ddAction()({event: $event, action:\'unsave\', feedKey: ddControl.feedKey,ptype:4})" href="#" class="border-0">Unsave</a></div></div>',n.actionFeedDropdown=function(t){switch(e.close(t.event),t.event.preventDefault(),t.action){case"edit":n.enableEditor(t.feedKey);break;case"edittag":g();break;case"delete":n.deleteFeed(t.feedKey);break;case"save":n.saveFeed(t.feedKey,1,t.ptype);break;case"unsave":n.saveFeed(t.feedKey,2,t.ptype)}},n.noDownload=function(e){e.preventDefault(),o.show("Currently download option is available in ringID desktop and mobile app version only.")},n.selectAlbum=function(e){return{data:function(){return{media:e}}}},n.enableEditor=function(e){var t,r,o={};t=i.getFeed(e),o.localData={feed:t},t.showMore()?o.remoteData=i.moreFeedText(t):o.remoteData=!1,r=c.open({type:"remote",scope:!1,controller:"FeedEditController",scrollable:!0,resolve:o,templateUrl:"pages/partials/news_feed/edit.html"}),r.result.then(function(e){e.sucs?n.$rgDigest():RingLogger.print("cancelled Edit","FEED_EDIT")})},n.deleteFeed=function(e){var t,r="Are you sure you want to delete?";t=c.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"}),t.result.then(function(t){t&&i.deleteFeed(n.currentUser,e).then(function(e){n.setFeed(!0),o.show(e,"success")},function(e){n.setFeed(!0),o.show(e,"error")})})},n.saveFeed=function(e,t,r){var o;i.saveFeed(e,t,r).then(function(r){var a;r.sucs===!0&&(o=1===t,a=i.getFeed(e),a.setPortalSaveStatus(o),n.$rgDigest())})},n.getShareData=function(){return function(){return{keyid:n.keyid,feed:n.feed.hasSharedFeed()?n.feed.getOrginalFeed():n.feed}}},n.getImageData=function(e,t){return function(){return{image:e,feed:t}}},n.getMediaData=function(e,t){return{data:function(){return{media:e,playlist:t.getAlbum().getContents().all(),feedTime:t.time()}},promise:e.fetchDetails()}},n.getMediaFirstData=function(e){var t,r=e||n.feed;return t=r.getMedias().top(),!!t&&n.getMediaData(t,r)},n.getAudioFirstData=function(e){var t,r=e||n.feed;return t=r.getAudios().top(),!!t&&n.getMediaData(t,r)},n.goToFeed=d,n.isShareAble=function(e){var t=e.hasSharedFeed()?e.getOrginalFeed():e;return t.isShareAble()};function d(e){e&&r.path(e)}function g(){var e=c.open({type:"remote",scope:!1,controller:"feedEditTagController",resolve:{localData:{feed:n.feed},remoteData:function(){return n.feed.hasTagUsers()?i.getTagUsers(n.feed):{}}},templateUrl:"templates/home/feed-tag-user-edit.html"});e.result.then(function(e){e&&(n.feed=e),n.cancelEdit()})}n.openRingBoxLike=function(){return n.feed.getTotalLikes()>0},n.openRingboxShare=function(){return(n.feed.hasSharedFeed()?n.feed.getOrginalFeed().getTotalShare()>0:n.feed.getTotalShare())>0&&!n.feed.isMediaShared()&&!n.feed.isSingleContentFeed()},n.whoShareFalsyFunc=function(){n.feed.isSingleContentFeed()&&o.show("Oops! This feature is coming soon","info")},n.skipSaveScope||(u=n.feed.value?n.feed.value.getKey():n.feed.getKey(),i.addScope(u,n),n.$on("$destroy",function(){i.removeScope(n.feed.getKey())}))}angular.module("ringid.feed").controller("PopupSingleFeedController",PopupSingleFeedController),PopupSingleFeedController.$inject=["$scope","remoteData","$boxInstance","$controller","$$feedMap"];function PopupSingleFeedController(e,t,n,r,i){e.feed=i.create(t.newsFeedList[0]),e.hideSerial=!0,e.showCommentBox=!0,e.showFeedFullContent=!0,RingLogger.print(t,"FEED_MORE"),r("FeedSubController",{$scope:e})}angular.module("ringid.feed").controller("FeedWhoShareController",FeedWhoShareController),FeedWhoShareController.$inject=["$$connector","$scope","$$feedMap","feedFactory","OPERATION_TYPES","$rootScope","Ringalert"];function FeedWhoShareController(e,t,n,r,i,o,a){var s,c,l,u,d,g=i.SYSTEM;t.feeds=[],t.message="",t.boxIsLoading=!t.params.boxIsLoading,t.params&&(d=r.getFeed(t.params.keyid)),t.showMessage=!1,t.shareMenuDisabled=!0,t.singleFeed=!0,t.busy=!1,t.boxHeight=o.windowHeight-20,s=e.subscribe(function(e){var r;if(t.boxIsLoading=!1,t.isReady=!0,t.busy=!1,!e.sucs)return t.$close(),void a.show(e.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error");if(e.newsFeedList.length)for(u=0;u<e.newsFeedList.length;u++)r=n.create(e.newsFeedList[u]),r.getKey()===d.getKey()&&r.setIdenticalFeed(d),t.feeds.push(r);t.$rgDigest()},{action:g.TYPE_WHO_SHARES_LIST});function m(){t.boxIsLoading=!0,t.feeds.length<t.params.feed.getTotalShare()&&!t.busy&&(e.send({actn:g.TYPE_WHO_SHARES_LIST,nfId:t.params.feed.getKey(),st:t.feeds.length},g.REQUEST_TYPE.REQUEST),t.busy=!0,setTimeout(function(){t.busy=t.busy||!1,t.$rgDigest()},3e3),t.$rgDigest())}t.loadMore=m,t.loadMore(),t.$on("$destroy",function(){r.removeIgnoreFilter(c),r.removeIgnoreFilter(l),e.unsubscribe(s)}),t.skipSaveScope=!0}angular.module("ringid.feed").controller("FeedRingboxWhoShareController",FeedRingboxWhoShareController),FeedRingboxWhoShareController.$inject=["$controller","$scope","localData"];function FeedRingboxWhoShareController(e,t,n){t.viewType="ringbox",t.params=n,e("FeedWhoShareController",{$scope:t})}angular.module("ringid.feed").controller("feedShareController",feedShareController),feedShareController.$inject=["$scope","Auth","feedFactory","$rootScope","Ringalert","Utils"];function feedShareController(e,t,n,r,i,o){e.feed=e.params.feed,e.afterShareCallback=e.afterShareCallback||e.params.afterShareCallback,e.updateFeedLocation=f,e.resetFeedLocation=E,e.currentUser=t.currentUser(),E(),g(),d(),c(),u(),e.shareFeed=a;function a(){var t=h();s(),l(),d(),n.shareFeed(t).then(function(t){u(),g(),c(),d(),E(),p(),I(),T(t),e.media?(e.media.share(!0),e.$close()):e.popup?e.$close():e.$parent.$rgDigest()},function(t){u(),c(),_(t),e.$parent.$rgDigest()}),e.$rgDigest()}function s(){e.inputDisabled=!0}function c(){e.inputDisabled=!1}function l(){e.boxIsLoading=!0}function u(){e.boxIsLoading=!1}function d(){e.errorMessage=""}function g(){e.feedText=""}function m(t){e.feedLocation=t}function E(){e.feedLocation=""}function f(t){m(t),e.$rgDigest()}function p(){r.$broadcast("FeedListChanged"),e.$broadcast("cleareditor")}function T(e){i.show(e,"success")}function h(){var t,n=e.media?null:e.feed,r=e.media,i={text:e.feedText,feed:n&&n.hasSharedFeed()?n.getOrginalFeed():n,location:e.feedLocation};if(e.emotions.length&&(i.mdIds=[e.emotions[0].id],e.emotions.length=0),e.tagList.length){for(i.tFrndIds=[],t=0;t<e.tagList.length;t++)i.tFrndIds.push(e.tagList[t].getUtId());e.tagList.length=0}return(r||n&&n.isSingleContentFeed()&&(n.getMedias().length()||n.getAudios().length()))&&(r=r||n.getSingleContent(),i.audio=r.isAudio(),i.cntntIDLst=[r.getKey()],i.addShare=!0,i.user=e.currentUser),i}function I(){e.afterShareCallback&&e.afterShareCallback()}function _(t){var n=o.getReasonMessageFromResponse(t);""===n&&(n="Unable To Share Status. Please Try Again Later"),e.errorMessage=n}e.emotions=[],e.tagList=[],e.addTag=function(t){var n=e.tagList.indexOf(t);n===-1&&e.tagList.push(t)},e.removeTag=function(t){var n=e.tagList.indexOf(t);n>=0&&e.tagList.splice(n,1)},e.chooseEmotion=function(t){e.emotions.length=0,e.emotions.push(t)}}angular.module("ringid.feed").controller("feedRingboxShareController",feedRingboxShareController),feedRingboxShareController.$inject=["$scope","$boxInstance","$controller","localData"];function feedRingboxShareController(e,t,n,r){e.params={feed:r.feed,afterShareCallback:e.$close,showSharePostBox:!0},n("feedShareController",{$scope:e})}angular.module("ringid.feed").controller("feedMediaShareController",feedMediaShareController).controller("feedNewsPortalShareController",feedNewsPortalShareController).controller("feedInlineShareController",feedInlineShareController),feedInlineShareController.$inject=["$scope","$controller"];function feedInlineShareController(e,t){e.params={feed:e.feed,afterShareCallback:e.closeShareBox,showSharePostBox:!0},t("feedShareController",{$scope:e})}feedMediaShareController.$inject=["$scope"];function feedMediaShareController(e){e.params={feed:null},e.afterShareCallback=angular.noop,e.closeShareBox=function(){e.$close()},e.autoAdjustScroll="false"}feedNewsPortalShareController.$inject=["$scope"];function feedNewsPortalShareController(e){e.closeShareBox=function(){e.$close()},e.afterShareCallback=angular.noop,e.autoAdjustScroll="false",e.popup=!0}angular.module("ringid.feed").controller("FeedEditController",FeedEditController),FeedEditController.$inject=["Auth","SystemEvents","$scope","localData","remoteData","feedFactory","Ringalert"];function FeedEditController(e,t,n,r,i,o,a){var s=r.feed;n.emotions=[],n.editorEnabled=!1,n.errorImageEdit=!1,n.feedLocation={},n.ogData=n.ogData||{},n.filterOnProgress=!1,n.ogDataLoading=!1,n.ogShowPreview=!1,n.previousFeedLocation="",n.feedEditChooseEmotion=d,n.cancelEdit=E,n.updateFeed=m,n.selectedFeedLocation=u,n.resetFeedLocation=l,n.getFeedHtml=c,i&&(i.newsFeedList?s.parseMoreText(i.newsFeedList[0]):s.parseMoreText(i)),n.editorEnabled=!0,n.feedText=s.text(),n.feedLocation=angular.copy(s.getLocationInfo()),n.ogData=angular.copy(s.getOgData()),n.ogData.image&&(n.ogData.images=[n.ogData.image]),n.ogShowPreview=s.hasOgData(),n.emotions=s.hasFeelings()?[s.getFeelings()]:[];function c(){return s.getDynamicText()}function l(){n.feedLocation={}}function u(e){n.feedLocation=e,n.$rgDigest()}function d(e){n.emotions.length=0,n.emotions.push(e),n.$rgDigest()}function g(){return!(n.feedText||n.feedLocation.description||n.ogData.url||n.feelings&&n.feelings.id||n.feed.hasMedia()||n.feed.hasTagUsers())}n.sentRequest=!1;function m(){n.feedText=n.feedText.trim(),n.emotions.length?(n.feelings=n.emotions[0],n.emotions.length=0):n.feelings=!1,g()?(n.errorImageEdit=!0,n.editorEnabled=!0):(n.sentRequest=!0,o.updateFeed(e.currentUser(),s,n.feedText,n.feedLocation,n.ogData,n.feelings).then(function(e){RingLogger.print(e,RingLogger.tags.FEED),e.sucs?n.$close({sucs:!0}):(n.sentRequest=!1,a.show(e,"error"),n.$rgDigest())},function(e){a.show(e,"error"),n.$rgDigest()})),n.$rgDigest()}function E(){n.$close({sucs:!1})}RingLogger.tags.DIGEST&&n.$watch(function(){RingLogger.info("from FeedEditController",RingLogger.tags.DIGEST)}),n.contentHightChanged=function(){n.$emit(t.RINGBOX.UPDATE)}}angular.module("ringid.feed").controller("FeedDashboardController",["$scope","$controller","OPERATION_TYPES",function(e,t,n){e.pagekey=n.SYSTEM.TYPE_NEWS_FEED+".all",e.action=n.SYSTEM.TYPE_NEWS_FEED,e.params={actn:n.SYSTEM.TYPE_NEWS_FEED},e.forAdd="my",t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedProfileController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i,o,a=n.uId,s=a;e.currentUser&&e.currentUser.equals(a)?(i="my",o=r.SYSTEM.TYPE_MY_NEWS_FEED):(i="friend",o=r.SYSTEM.TYPE_FRIEND_NEWSFEED),s=o+"."+a,e.pagekey=s,e.action=o,e.params={actn:o,fndId:a},e.forAdd=i,e.sortBy="at",t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedCircleController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="circle",o=n.circleId,a=r.SYSTEM.TYPE_GROUP_NEWS_FEED+"."+o;e.pagekey=a,e.action=r.SYSTEM.TYPE_GROUP_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_GROUP_NEWS_FEED,grpId:o},e.forAdd=i,e.shareMenuDisabled=!0,t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedMediasController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function(e,t,n,r,i){var o="my",a=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED+".medias";e.pagekey=a,e.action=r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,e.params={actn:r.SYSTEM.TYPE_MEDIAS_NEWS_FEED,pvtid:0,st:0,mtf:0},e.a_f_m="f",e.setTrending=function(t){var n=e.a_f_m;e.params.mtf=t,1===t?e.a_f_m="t":e.a_f_m="f",n!==e.a_f_m&&(i.reset(),i.initFeedRequest(e.params),e.$rgDigest())},e.forAdd=o,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("FeedNewsportalController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="newsportal",o=r.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal";e.pagekey=o,e.action=r.SYSTEM.TYPE_NEWS_PORTAL_FEED,e.params={actn:r.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},e.isReady=!0,e.forAdd=i,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("feedTagUserListController",feedTagUserListController),feedTagUserListController.$inject=["$scope","remoteData","userFactory","Api"];function feedTagUserListController(e,t,n,r){var i,o,a=t.fTgLst;if(e.usersUtIds=[],e.users=[],i=a.length)for(e.total=i,o=0;o<a.length;o++)a[o].fn=a[o].nm,e.users.push(n.createByUtId(a[o],!0));e.getMutualFriend=function(e){return{data:function(){return{target:e}},promise:r.user.getMutualFriends(e)}}}angular.module("ringid.feed").filter("filterUserByName",filterUserByName).controller("feedEditTagController",feedEditTagController);function filterUserByName(){return function(e,t){var n,r,i=[];if(e)for(n=new RegExp(t,"i"),r=0;r<e.length;r++)e[r].getName().match(n)&&i.push(e[r]);return i}}feedEditTagController.$inject=["$scope","localData","remoteData","$$connector","feedFactory","OPERATION_TYPES","userFactory","$filter","friendsFactory","Ringalert","Auth"];function feedEditTagController(e,t,n,r,i,o,a,s,c,l,u){var d,g=t.feed,m=!1,E=[],f=[],p=u.currentUser(),T=[];e.users=[],e.filterText="",e.loading=!0,e.currentType="a";function h(){e.users=s("filterUserByName")(T,e.filterText)}function I(){m||(c.searchContact({schPm:e.filterText},!0),e.loading=!0,m=!0)}e.$watch("filterText",function(t,n){h(),e.users.length<5&&t.length>n.length?(m=!1,I()):(m=!1,e.loading=!1)}),e.$watch(c.friends.length(),function(){_(),e.loading=!1,m=!1});function _(){var t;return"a"!==e.currentType?void h():(c.friends.doForAll(function(e){var t=e.getLiteUser();T.contains(t,function(e,t){return e.equals(t,"utId")})===-1&&E.contains(t,function(e,t){return e.equals(t,"utId")})===-1&&T.push(t)}),t=E.filter(function(e){return T.contains(e,function(e,t){return e.equals(t,"utId")})===-1}),T=T.concat(t),void h())}if(n&&n.fTgLst&&n.fTgLst.length){for(d=0;d<n.fTgLst.length;d++)n.fTgLst[d].fn=n.fTgLst[d].nm,E.contains(n.fTgLst[d].utId,function(e,t){return e.equals(t,"utId")})===-1&&(E.push(a.createByUtId(n.fTgLst[d],!0)),f.push(E[d]));_()}e.loading=!1,g.hasTagUsers()||_(),e.toggle=function(t){e.currentType!==t&&(e.currentType=t,"a"===t?(T=[],_()):(T=E,h()))},e.checked=function(e){return E.indexOf(e)>-1},e.loadMore=function(){e.filterText.length?I():(c.getContactDetails(),e.loading=!0)},e.addRemoveTag=function(t,n){var r=E.indexOf(n);r>-1?E.splice(r,1):(E.push(n),e.users.length-E.length<5&&e.loadMore())},e.saveTagUser=function(){var t,n,r=f.difference(E),o=E.difference(f),a={},s={};if(!r.length&&!o.length)return void l.show("Please Make Your Changes Before Submit","warning");if(0===o.length&&r.length===f.length&&!g.validateForUpdateTag())return void l.show("You can't submit an empty feed","warning");if(r.length)for(n=0;n<r.length;n++)a[r[n].getUtId()]=!0;if(o.length)for(n=0;n<o.length;n++)s[o[n].getUtId()]=!0;t={removed:Object.keys(a),new:Object.keys(s)},i.updateFeed(p,g,g.text(),g.getLocationInfo(),!1,g.getFeelings(),t).then(function(t){g.updateTagUser(t),e.$close(g)},function(e){l.show(e,"error")})},e.$on("$destroy",function(){})}angular.module("ringid.feed").directive("rgCommonFeedTop",rgCommonFeedTop),rgCommonFeedTop.$inject=[];function rgCommonFeedTop(){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",hideSerial:"@",showdroparrow:"="},restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgCommonFeedBottom",rgCommonFeedBottom),rgCommonFeedBottom.$inject=[];function rgCommonFeedBottom(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}angular.module("ringid.feed").directive("rgCommonFeedDetails",rgCommonFeedDetails);function rgCommonFeedDetails(){return{restrict:"E",templateUrl:function(e,t){return t.templatepath},link:function(e){e.$rgDigest()}}}!function(e,t){"use strict";e.module("ringid.chat",["ringid.config","ringid.sticker","ngWebSocket","ringid.utils","ringid.connector","angularAudioRecorder"])}(angular,window),function(e){e.CHAT_APP={GLOBALS:{uId:-1,appVersion:-1},Constants:{},PacketFormats:{},AuthPacketSender:{},AuthRequests:{},AuthResponses:{},ChatPacketSender:{},Helpers:{},ResponseHelpers:{},SharedHelpers:{},ChatPacketParser:{},PacketSendFlow:{},ChatSessionPacketSender:{},ChatOnlinePacketSender:{},ChatOfflinePacketSender:{},MODELS:{SESSION_OBJECT:{}},CHAT_CLOCK:{},REQUEST_CACHE:{},RESPONSE_CACHE:{},CHAT_SESSION:{},BROKEN_PACKET_CACHE:{},UTILS:{},ChatConnector:{},AuthConnector:{},getCurrentUserId:function(){return CHAT_APP.GLOBALS.uId},getAppVersion:function(){return CHAT_APP.GLOBALS.appVersion},getOfflineIp:function(){return CHAT_APP.GLOBALS.oIpPort.ip},getOfflinePort:function(){return CHAT_APP.GLOBALS.oIpPort.port},Init:function(){}}}(window),function(e){var t={FRIEND_CHAT_REGISTER:1,FRIEND_CHAT_UNREGISTER:2,FRIEND_CHAT_REGISTER_CONFIRMATION:3,FRIEND_CHAT_IDLE:4,FRIEND_CHAT_TYPING:5,FRIEND_CHAT_MSG:6,FRIEND_CHAT_MSG_EDIT:7,FRIEND_CHAT_BROKEN_MSG:8,FRIEND_CHAT_BROKEN_MSG_EDIT:9,FRIEND_CHAT_MULTIPLE_MSG:10,FRIEND_CHAT_DELIVERED:15,FRIEND_CHAT_SENT:16,FRIEND_CHAT_SEEN:17,FRIEND_CHAT_SEEN_CONFIRMATION:18,FRIEND_CHAT_MULTIPLE_MSG_DELETE:19,FRIEND_CHAT_MSG_DELETE_CONFIRMATION:20,FRIEND_CHAT_BROKEN:24,FRIEND_CHAT_BROKEN_CONFIRMATION:25,FRIEND_CHAT_BLOCK:27,FRIEND_CHAT_UNBLOCK:28,FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION:29},n={TAG_CHAT_TAG_REGISTER:41,TAG_CHAT_TAG_UNREGISTER:42,TAG_CHAT_TAG_REGISTER_CONFIRMATION:43,TAG_CHAT_TAG_INFORMATION:46,TAG_CHAT_TAG_INFORMATION_CONFIRMATION:47,TAG_CHAT_TAG_MEMBER_ADD:51,TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION:52,TAG_CHAT_MEMBER_REMOVE_LEAVE:53,TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION:54,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE:55,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION:56,TAG_CHAT_IDLE:61,TAG_CHAT_TYPING:62,TAG_CHAT_MSG:63,TAG_CHAT_MSG_EDIT:64,TAG_CHAT_BROKEN_MSG:65,TAG_CHAT_BROKEN_MSG_EDIT:66,TAG_CHAT_MULTIPLE_MSG:67,TAG_CHAT_DELIVERED:68,TAG_CHAT_SENT:69,TAG_CHAT_SEEN:70,TAG_CHAT_SEEN_CONFIRMATION:71,TAG_CHAT_MULTIPLE_MSG_DELETE:72,TAG_CHAT_MSG_DELETE_CONFIRMATION:73,TAG_CHAT_GENERAL_BROKEN_PACKET:74,TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION:75},r={OFFLINE_FRIEND_INFORMATION:91,OFFLINE_FRIEND_INFORMATION_CONFIRMATION:92,OFFLINE_GET_REQUEST:93,OFFLINE_GET_REQUEST_CONFIRMATION:94,OFFLINE_FRIEND_UNREAD_MESSAGE:95,OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:96,OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST:97,OFFLINE_FRIEND_HISTORY_MESSAGE:98,OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION:99,OFFLINE_GET_FRIEND_MESSAGE_STATUS:100,OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION:101,OFFLINE_TAG_INFORMATION_ACTIVITY:104,OFFLINE_MY_TAG_LIST:105,OFFLINE_TAG_UNREAD_MESSAGE:106,OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:107,OFFLINE_TAG_CREATE_TAG:108,OFFLINE_TAG_CREATE_TAG_CONFIRMATION:109,OFFLINE_TAG_HISTORY_MESSAGE_REQUEST:110,OFFLINE_TAG_HISTORY_MESSAGE:111,OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS:112,OFFLINE_TAG_INFORMATION_WITH_MEMBERS:113,OFFLINE_TAG_CONFIRMATION:117,OFFLINE_BROKEN_HISTORY_PACKET:118,OFFLINE_BROKEN_PACKET:119,OFFLINE_BROKEN_PACKET_CONFIRMATION:120},i=Object.assign({},t,n,r),o={PACKET_IP_SIZE:4,PACKET_PORT_SIZE:2,PACKET_DYNAMIC_ATTRIBUTE:-1,PACKET_RAW_BYTE_ATTRIBUTE:-2,ONE_BYTE_SIZE:1,TWO_BYTE_SIZE:2,FOUR_BYTE_SIZE:4,EIGHT_BYTE_SIZE:8,PACKET_MAX_SIZE:512,TAG_ID_NO_OF_TIME_DIGIT:10,TAG_ID_NO_OF_USER_ID_DIGIT:6,OFFLINE_PACKET_TYPE_START:91,ATTRIBUTE_TYPE:{INTEGER:1,STRING:2,BYTE:3}},a={LOCAL_CHAT:!1,LOCAL_CHAT_REG_IP:"192.168.1.125",LOCAL_CHAT_REG_PORT:1500,LOCAL_CHAT_OFFLINE_IP:"192.168.1.125",LOCAL_CHAT_OFFLINE_PORT:1200,API_VERSION:3,API_VERSION_PORT_OFFSET:0,AUTH_UID_LIST_LIMIT:15,ACTUAL_TAG_REGISTER_TIMEOUT:180,TAG_REGISTER_TIMEOUT:160,API_FETCH_RETRY_COUNT:5,API_FETCH_RETRY_DELAY:3e3,RETRY_COUNT:5,AUTH_REQUEST_TIMEOUT:2e3,REQUEST_TIMEOUT:15e3,BOX_WAITING_TIME:180,UDP_SERVER_KEEP_ALIVE_INTERVAL:1e4,REQUEST_CACHE_VALIDITY:15e3,RESPONSE_CACHE_VALIDITY:4e3,BROKEN_CACHE_VALIDITY:3e5,TEMP_MESSAGE_CACHE_VALIDITY:12e4,SESSION_TYPES:{FRIEND:1,TAG:2},REQUEST_TYPES:{FRIEND:1,TAG:2},MEMBER_STATUS:{MEMBER:1,ADMIN:2,OWNER:3,REMOVED:4,LEAVE:5},MEMBER_MOODS:{ONLINE:1,AWAY:2,OFFLINE:3,DO_NOT_DISTURB:4},REGISTRATION_TYPES:{CREATE:1,ONLY_REGISTER:2,CHAT_INVITE:3},MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,TEXT:2,EMOTICON_MESSAGE:3,LOCATION_SHARE:4,LINK_SHARE:5,STICKER:6,IMAGE:7,AUDIO:8,VIDEO:9,CAMERA_IMAGE:10,FILE_STREAM:11,CONTACT_SHARE:12,FILE_STREAM_MANIFEST:13,HISTORY_RE_FETCH:14,RING_MEDIA_MESSAGE:15,GROUP_ACTIVITY:20,TYPING:101},STATUS_MESSAGE_TYPES:{TAG_MEMBER_ADD:1,TAG_MEMBER_DELETE:2,TAG_MEMBER_LEAVE:3,TAG_MEMBER_STATUS_CHANGE_OWNER:4,TAG_MEMBER_STATUS_CHANGE_ADMIN:5,TAG_MEMBER_STATUS_CHANGE_MEMBER:6,TAG_NAME_CHANGE:7,TAG_PICTURE_CHANGE:8,TAG_INFO_UPDATED:9,TAG_ADMIN_ADD:10},PAGE_DIRECTION:{UP:1,DOWN:2},PAGE_LIMIT:10,ONLINE_STATUS:{OFFLINE:1,ONLINE:2,AWAY:3},ONLINE_MOOD:{ALIVE:1,DONT_DISTURB:2,BUSY:3,INVISIBLE:4},SECRET_VISIBILITY:{NON_VISIBLE:0,VISIBLE:1},TAG_ACTIVITY_TYPE:{DELETED:0,ADDED:1,LEAVE:2,TAG_RENAME:3,MEMBER_TYPE_CHANGE:4,TAG_URL_RENAME:5,TAG_CREATED:6},USER_PRESENCE:{OFFLINE:1,ONLINE:2,AWAY:3},HISTORY_MAX_MESSAGE:10,
TAB_SYNC_MAX_TIME:18e4,TAB_SYNC_ACTIONS:{AUTH_REQUEST:0,CHAT_REQUEST:1,GENERAL_INFO_UPDATE:3,CHAT_BOX_INFO_UPDATE:4,SECRET_CHAT_TIMER:5,CHAT_HISTORY_REFRESH:6,CHAT_MSESSAGE_UPDATE:7},MAX_TASK_RETRY_COUNT:15,SHARED_WORKER_PATH:"js/worker/chat/shared.js",CHAT_WORKER_PATH:"/js/worker/chat/chat.worker.js"},s={KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},c={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_USER_MOOD_PRESENCE:199,GET_OFFLINE_IP_PORT:83},l={},u={DEBUG:0,AUTH_REQUEST_RESPONSE:1,CHAT_REQUEST_RESPONSE:2,CHAT_DATA_RECEIVED:3,AUTH_DATA_RECEIVED:4,EXCEPTION:5,CHAT_TIMER_UPDATE:6,RE_INIT:7},d={serverTimeDiff:0,serverTime:0,offlineUpdateTime:0},g={version:"2.7"},m={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},E={OFFLINE:1,ONLINE:2},f={MESSAGE_SENDING:{ONLINE_IP_PORT_REQUEST:0,FIRST_ONLINE:1,PRESENCE_REFRESH:2,SECOND_ONLINE:3,ONLINE_IP_PORT_REFRESH:4,THIRD_ONLINE:5,ONLINE_SUCCESS:6,ONLINE_FAILED:7,FIRST_OFFLINE:101,OFFLINE_IP_PORT_REFRESH:102,SECOND_OFFLINE:102,OFFLINE_FAILED:104,OFFLINE_SUCCESS:105,SUCCESS:201,FAILED:202}},p={PERMISSION_DENIED:1},T={},h={};l[c.RECEIVED_F2F_CHAT]=c.START_TAG_CHAT,l[c.RECEIVED_TAG_CHAT]=c.START_TAG_CHAT,h[t.FRIEND_CHAT_REGISTER]=t.FRIEND_CHAT_REGISTER_CONFIRMATION,h[t.FRIEND_CHAT_MSG]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],h[t.FRIEND_CHAT_MSG_EDIT]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],h[t.FRIEND_CHAT_BROKEN_MSG]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],h[t.FRIEND_CHAT_BROKEN_MSG_EDIT]=[t.FRIEND_CHAT_SENT,t.FRIEND_CHAT_DELIVERED,t.FRIEND_CHAT_SEEN],h[t.FRIEND_CHAT_DELIVERED]=[t.FRIEND_CHAT_SEEN,t.FRIEND_CHAT_SEEN_CONFIRMATION],h[t.FRIEND_CHAT_SEEN]=t.FRIEND_CHAT_SEEN_CONFIRMATION,h[t.FRIEND_CHAT_BROKEN]=t.FRIEND_CHAT_BROKEN_CONFIRMATION,h[t.FRIEND_CHAT_MULTIPLE_MSG_DELETE]=t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,h[r.OFFLINE_FRIEND_INFORMATION]=r.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,h[r.OFFLINE_FRIEND_UNREAD_MESSAGE]=r.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,h[r.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]=r.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,h[r.OFFLINE_FRIEND_HISTORY_MESSAGE]=r.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,h[r.OFFLINE_GET_FRIEND_MESSAGE_STATUS]=r.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,h[n.TAG_CHAT_TAG_REGISTER]=n.TAG_CHAT_TAG_REGISTER_CONFIRMATION,h[n.TAG_CHAT_TAG_INFORMATION]=n.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,h[n.TAG_CHAT_TAG_MEMBER_ADD]=n.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,h[n.TAG_CHAT_MULTIPLE_MSG_DELETE]=n.TAG_CHAT_MSG_DELETE_CONFIRMATION,h[n.TAG_CHAT_MEMBER_REMOVE_LEAVE]=n.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,h[n.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]=n.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,h[n.TAG_CHAT_GENERAL_BROKEN_PACKET]=n.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,h[n.TAG_CHAT_MSG]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],h[n.TAG_CHAT_MSG_EDIT]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],h[n.TAG_CHAT_BROKEN_MSG]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],h[n.TAG_CHAT_BROKEN_MSG_EDIT]=[n.TAG_CHAT_SENT,n.TAG_CHAT_DELIVERED,n.TAG_CHAT_SEEN],h[n.TAG_CHAT_DELIVERED]=[n.TAG_CHAT_SEEN,n.TAG_CHAT_SEEN_CONFIRMATION],h[n.TAG_CHAT_SEEN]=n.TAG_CHAT_SEEN_CONFIRMATION,h[r.OFFLINE_TAG_CREATE_TAG]=r.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,h[r.OFFLINE_GET_REQUEST]=r.OFFLINE_GET_REQUEST_CONFIRMATION,h[r.OFFLINE_TAG_UNREAD_MESSAGE]=r.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,h[r.OFFLINE_BROKEN_PACKET]=r.OFFLINE_BROKEN_PACKET_CONFIRMATION,h[r.OFFLINE_BROKEN_HISTORY_PACKET]=r.OFFLINE_BROKEN_PACKET_CONFIRMATION,h[r.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]=r.OFFLINE_TAG_CONFIRMATION,h[r.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]=r.OFFLINE_TAG_CONFIRMATION,function(){var t,n,r,i,o,s,c,l=e.angular&&angular.isObject||e.isObject,u=Object.keys(f.MESSAGE_SENDING);for(r in a)if(a.hasOwnProperty(r)&&(i=a[r],l(i))){a[r+"_VALUE"]=[];for(o in i)i.hasOwnProperty(o)&&(s=i[o],a[r+"_VALUE"][s]=o)}for(t=0,n=u.length;t<n;t++){c=f.MESSAGE_SENDING[u[t]];try{T[c].NAME=u[t]}catch(e){T[c]={},T[c].NAME=u[t]}}}(),e.CHAT_APP.Constants={FRIEND_CHAT_PACKET_TYPE:t,TAG_CHAT_PACKET_TYPE:n,OFFLINE_PACKET_TYPE:r,PACKET_TYPES:i,CONFIRMATION_MAP:h,GENERAL_CONSTANTS:a,PACKET_CONSTANTS:o,WORKER_NOTIFIER_TYPES:u,AUTH_SERVER_ACTIONS:c,AUTH_SERVER_REQUEST_UPDATE_MAP:l,CHAT_STATES:f,CHAT_STATE_INFO:T,CHAT_GLOBAL_VALUES:d,AUTH_REQUEST_TYPE:s,PLATFORM:m,CHAT_VERSION_INFO:g,RESPONSE_REASON_CODES:p,CHAT_SERVER_TYPES:E}}(window),function(e){var t=e.CHAT_APP.Constants,n=t.GENERAL_CONSTANTS;function r(t){return(t||"")+(e._cti||"")+e.Math.floor(e.Math.random()*(new e.Date).getTime())}function i(t,n){var r,i=CHAT_APP.SharedHelpers.getChatServerCurrentTime(),o=e.CHAT_APP.getCurrentUserId();return r=n||t?t:i,r||Logger.debug("alert","Invalid Timestamp","CHAT"),PacketIDGenerator.create(o,r,n)}function o(e,t,n,r,i){var o=0,a=i;function s(){!o||o<r&&!t.call(null,o)?(a>=i&&(e.call(),o++,a=0),a+=200,setTimeout(s,200)):t.call(null,o)||n.call()}s()}function a(e){var t=CHAT_APP.SharedHelpers.getChatServerCurrentTime();return t-e<n.ACTUAL_TAG_REGISTER_TIMEOUT}function s(){var e=this,t={},n={},i={},o=null;function a(e,i,o){var a=r("ctr");return t[a]=e,n[a]={delay:i,count:i,maxIteration:o},a}function s(e){delete t[e],delete n[e],Logger.debug("debug","TIMER DELETED FOR ID "+e,"CHAT_TIMER_DEBUG")}function c(e,t){var n;return i[e]||(i[e]={}),n=r("ccl"),i[e][n]=t,n}function l(e,t){delete i[e][t]}e.setTimeout=function(t,n){var r,i=0;return n>999&&(r=e.hasTimer(),i=a(t,n,1),r||e.start(),Logger.debug("debug","TIMEOUT SET FOR ID "+i,"CHAT_TIMER_DEBUG")),i},e.setInterval=function(t,n,r){var i,o=0;return n>999&&(i=e.hasTimer(),o=a(t,n,r||-1),i||e.start(),Logger.debug("debug","INTERVAL SET FOR ID "+o,"CHAT_TIMER_DEBUG")),o},e.clearTimeout=function(e){s(e)},e.clearInterval=function(e){s(e)},e.hasTimer=function(){return Object.keys(n).length>0},e.on=function(e,t){return c(e,t)},e.off=function(e,t){l(e,t)},e.trigger=function(e,t){var n;i[e]&&(n=Object.keys(i[e]),n.forEach(function(n){i[e][n].call(this,t)}))},e.stop=function(){clearInterval(o)},e.start=function(){o=setInterval(function(){var r,i,o,a;for(e.trigger("TICK"),r=Object.keys(n),a=0;a<r.length;a++)i=r[a],o=n[i],o&&(0===o.maxIteration?s(i):0===o.count||o.maxIteration===-1?(t[i].call(),o.maxIteration!==-1&&(o.count=o.delay)):(o.count--,o.maxIteration!==-1&&o.maxIteration--))},1e3)}}e.CHAT_APP.UTILS={hasChatSession:a,getUUIDPacketId:i,callXTimeAfterYIntervalStopOnSuccess:o,getUniqueId:r,ChatClock:s}}(window),function(e){var t=e.CHAT_APP,n=t.Constants,r=n.CHAT_GLOBAL_VALUES;function i(){var e,t,n;return r.serverTime>0?(e=Date.now()+r.serverTimeDiff,t=e-r.serverTime,n=r.serverTime+t%1e3):n=Date.now(),n}function o(e){var t=Date.now()-i(),n=e+t;return n}e.CHAT_APP.SharedHelpers={getChatServerCurrentTime:i,getClientTimeFromServerTime:o}}(window),function(e){var t=e.CHAT_APP.Constants,n=t.FRIEND_CHAT_PACKET_TYPE,r=t.TAG_CHAT_PACKET_TYPE,i=t.OFFLINE_PACKET_TYPE,o=t.PACKET_CONSTANTS,a={},s={},c={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,LAST_ONLINE_TIME:26,NO_OF_ITEMS:27,BLOCK_UNBLOCK_DATE:28,MESSAGE_STATUS:29,IS_ADD_TO_DB:30,TAG_NAME_LENGTH:31,TAG_NAME:32,TAG_PICTURE_URL_LENGTH:33,TAG_PICTURE_URL:34,TAG_MEMBER_TYPE:35,TAG_MEMBER_ADDED_BY:36,TAG_NO_OF_MEMBERS:37,TAG_NO_OF_BROKEN_PKT:38,TAG_INFORMATION_UPDATE_FLAG:39,TAG_INFORMATION_TAG_NO_OF_MEMBERS:40,REGISTRATION_TYPE:41,PAGE_DIRECTION:42,PAGE_LIMIT:43,ACTIVITY_TYPE:45,ACTIVITY_VALUE_LENGTH:46,ACTIVITY_VALUE:47,CHANGED_BY_USER_ID:48,FRIEND_APP_TYPE:60,FRIEND_DEVICE_TOKEN_LENGTH:61,FRIEND_DEVICE_TOKEN:62,IS_SECRET_VISIBLE:63,APP_VERSION:64,FRIEND_PLATFORM:65,IS_VOIP_CALL:66,RAW_DATA_BYTE:80};s[c.PACKET_TYPE]={ATTRIBUTE_NAME:"PACKET_TYPE",VAR_NAME:"packetType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.USER_ID]={ATTRIBUTE_NAME:"USER_ID",VAR_NAME:"userId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.FRIEND_ID]={ATTRIBUTE_NAME:"FRIEND_ID",VAR_NAME:"friendId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.PACKET_ID_LENGTH]={ATTRIBUTE_NAME:"PACKET_ID_LENGTH",VAR_NAME:"packetIdLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.PACKET_ID]={ATTRIBUTE_NAME:"PACKET_ID",VAR_NAME:"packetId",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.PLATFORM]={ATTRIBUTE_NAME:"PLATFORM",VAR_NAME:"platform",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.CHAT_BINDING_PORT]={ATTRIBUTE_NAME:"CHAT_BINDING_PORT",VAR_NAME:"chatBindingPort",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[c.TAG_ID]={ATTRIBUTE_NAME:"TAG_ID",VAR_NAME:"tagId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.ONLINE_STATUS]={ATTRIBUTE_NAME:"ONLINE_STATUS",VAR_NAME:"onlineStatus",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.USER_MOOD]={ATTRIBUTE_NAME:"USER_MOOD",VAR_NAME:"userMood",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.MESSAGE_TYPE]={ATTRIBUTE_NAME:"MESSAGE_TYPE",VAR_NAME:"messageType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.TIMEOUT]={ATTRIBUTE_NAME:"TIMEOUT",VAR_NAME:"timeout",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.LATITUDE]={ATTRIBUTE_NAME:"LATITUDE",VAR_NAME:"latitude",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[c.LONGITUDE]={ATTRIBUTE_NAME:"LONGITUDE",VAR_NAME:"longitude",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:4},s[c.MESSAGE_LENGTH]={ATTRIBUTE_NAME:"MESSAGE_LENGTH",VAR_NAME:"messageLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.MESSAGE]={ATTRIBUTE_NAME:"MESSAGE",VAR_NAME:"message",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.MESSAGE_DATE]={ATTRIBUTE_NAME:"MESSAGE_DATE",VAR_NAME:"messageDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.NO_OF_MESSAGE]={ATTRIBUTE_NAME:"NO_OF_MESSAGE",VAR_NAME:"messagesLength",VAR_CONTAINER_NAME:"messages",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.FULL_NAME_LENGTH]={ATTRIBUTE_NAME:"FULL_NAME_LENGTH",VAR_NAME:"fullNameLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.FULL_NAME]={ATTRIBUTE_NAME:"FULL_NAME",VAR_NAME:"fullName",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.NO_OF_PACKET]={ATTRIBUTE_NAME:"NO_OF_PACKET",VAR_NAME:"packetsLength",VAR_CONTAINER_NAME:"packets",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.SEQUENCE_NO]={ATTRIBUTE_NAME:"SEQUENCE_NO",VAR_NAME:"sequenceNo",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.NO_OF_MEMBERS]={ATTRIBUTE_NAME:"NO_OF_MEMBERS",VAR_NAME:"membersLength",VAR_CONTAINER_NAME:"members",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.UPDATE_TIME]={ATTRIBUTE_NAME:"UPDATE_TIME",VAR_NAME:"updateTime",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.SERVER_DATE]={ATTRIBUTE_NAME:"SERVER_DATE",VAR_NAME:"serverDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.LAST_ONLINE_TIME]={ATTRIBUTE_NAME:"LAST_ONLINE_TIME",VAR_NAME:"lastOnlineTime",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.NO_OF_ITEMS]={ATTRIBUTE_NAME:"NO_OF_ITEMS",VAR_NAME:"noOfItems",VAR_CONTAINER_NAME:"items",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.BLOCK_UNBLOCK_DATE]={ATTRIBUTE_NAME:"BLOCK_UNBLOCK_DATE",VAR_NAME:"blockUnblockDate",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.MESSAGE_STATUS]={ATTRIBUTE_NAME:"MESSAGE_STATUS",VAR_NAME:"status",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.IS_ADD_TO_DB]={ATTRIBUTE_NAME:"IS_ADD_TO_DB",VAR_NAME:"isAddToDb",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.TAG_NAME_LENGTH]={ATTRIBUTE_NAME:"TAG_NAME_LENGTH",VAR_NAME:"tagNameLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.TAG_NAME]={ATTRIBUTE_NAME:"TAG_NAME",VAR_NAME:"tagName",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.TAG_PICTURE_URL_LENGTH]={ATTRIBUTE_NAME:"TAG_PICTURE_URL_LENGTH",VAR_NAME:"tagPictureUrlLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.TAG_PICTURE_URL]={ATTRIBUTE_NAME:"TAG_PICTURE_URL",VAR_NAME:"tagPictureUrl",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.TAG_MEMBER_TYPE]={ATTRIBUTE_NAME:"TAG_MEMBER_TYPE",VAR_NAME:"status",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.TAG_MEMBER_ADDED_BY]={ATTRIBUTE_NAME:"TAG_MEMBER_ADDED_BY",VAR_NAME:"addedBy",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersLength",VAR_CONTAINER_NAME:"tagMembers",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.TAG_NO_OF_BROKEN_PKT]={ATTRIBUTE_NAME:"TAG_NO_OF_BROKEN_PKT",VAR_NAME:"brokenPacketsLength",VAR_CONTAINER_NAME:"brokenPackets",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.TAG_INFORMATION_UPDATE_FLAG]={ATTRIBUTE_NAME:"TAG_INFORMATION_UPDATE_FLAG",VAR_NAME:"updateFlag",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.TAG_INFORMATION_TAG_NO_OF_MEMBERS]={ATTRIBUTE_NAME:"TAG_INFORMATION_TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersCount",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.REGISTRATION_TYPE]={ATTRIBUTE_NAME:"REGISTRATION_TYPE",VAR_NAME:"registrationType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.PAGE_DIRECTION]={ATTRIBUTE_NAME:"PAGE_DIRECTION",VAR_NAME:"pageDirection",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.PAGE_LIMIT]={ATTRIBUTE_NAME:"PAGE_LIMIT",VAR_NAME:"pageLimit",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.ACTIVITY_TYPE]={ATTRIBUTE_NAME:"ACTIVITY_TYPE",VAR_NAME:"activityType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1,CONDITIONAL:!0},s[c.ACTIVITY_VALUE_LENGTH]={ATTRIBUTE_NAME:"ACTIVITY_VALUE_LENGTH",VAR_NAME:"activityValueLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.ACTIVITY_VALUE]={ATTRIBUTE_NAME:"ACTIVITY_VALUE",VAR_NAME:"activityValue",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.CHANGED_BY_USER_ID]={ATTRIBUTE_NAME:"CHANGED_BY_USER_ID",VAR_NAME:"changedByUserId",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:8},s[c.FRIEND_APP_TYPE]={ATTRIBUTE_NAME:"FRIEND_APP_TYPE",VAR_NAME:"friendAppType",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.FRIEND_DEVICE_TOKEN_LENGTH]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN_LENGTH",VAR_NAME:"friendDeviceTokenLength",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.FRIEND_DEVICE_TOKEN]={ATTRIBUTE_NAME:"FRIEND_DEVICE_TOKEN",VAR_NAME:"friendDeviceToken",VAR_TYPE:o.ATTRIBUTE_TYPE.STRING,SIZE:-1},s[c.IS_SECRET_VISIBLE]={ATTRIBUTE_NAME:"IS_SECRET_VISIBLE",VAR_NAME:"isSecretVisible",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.APP_VERSION]={ATTRIBUTE_NAME:"APP_VERSION",VAR_NAME:"appVersion",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:2},s[c.FRIEND_PLATFORM]={ATTRIBUTE_NAME:"FRIEND_PLATFORM",VAR_NAME:"friendPlatform",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.IS_VOIP_CALL]={ATTRIBUTE_NAME:"IS_VOIP_CALL",VAR_NAME:"isVoidIpCall",VAR_TYPE:o.ATTRIBUTE_TYPE.INTEGER,SIZE:1},s[c.RAW_DATA_BYTE]={ATTRIBUTE_NAME:"RAW_DATA_BYTE",VAR_NAME:"bytes",VAR_TYPE:o.ATTRIBUTE_TYPE.BYTE,SIZE:-2},a[n.FRIEND_CHAT_REGISTER]={PACKET_NAME:"FRIEND_CHAT_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PLATFORM]},a[n.FRIEND_CHAT_UNREGISTER]={PACKET_NAME:"FRIEND_CHAT_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PLATFORM,c.ONLINE_STATUS,c.USER_MOOD]},a[n.FRIEND_CHAT_REGISTER_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.CHAT_BINDING_PORT,c.SERVER_DATE]},a[n.FRIEND_CHAT_IDLE]={PACKET_NAME:"FRIEND_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PLATFORM]},a[n.FRIEND_CHAT_TYPING]={PACKET_NAME:"FRIEND_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PLATFORM]},a[n.FRIEND_CHAT_MSG]={PACKET_NAME:"FRIEND_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE,c.PLATFORM]},a[n.FRIEND_CHAT_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE,c.PLATFORM]},a[n.FRIEND_CHAT_BROKEN_MSG]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE,c.PLATFORM]},a[n.FRIEND_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"FRIEND_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE,c.PLATFORM]},a[n.FRIEND_CHAT_MULTIPLE_MSG]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE]]},a[n.FRIEND_CHAT_DELIVERED]={PACKET_NAME:"FRIEND_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PLATFORM]},a[n.FRIEND_CHAT_SENT]={PACKET_NAME:"FRIEND_CHAT_SENT",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[n.FRIEND_CHAT_SEEN]={PACKET_NAME:"FRIEND_CHAT_SEEN",BROKEN_CONTAINER:"messages",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,[c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_DATE,c.MESSAGE_STATUS],c.PLATFORM]},a[n.FRIEND_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[n.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"FRIEND_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,[c.PACKET_ID_LENGTH,c.PACKET_ID],c.PLATFORM]},a[n.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[n.FRIEND_CHAT_BROKEN]={PACKET_NAME:"FRIEND_CHAT_BROKEN",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.RAW_DATA_BYTE]},a[n.FRIEND_CHAT_BROKEN_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BROKEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.SEQUENCE_NO]},a[n.FRIEND_CHAT_BLOCK]={PACKET_NAME:"FRIEND_CHAT_BLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.BLOCK_UNBLOCK_DATE,c.IS_ADD_TO_DB]},a[n.FRIEND_CHAT_UNBLOCK]={PACKET_NAME:"FRIEND_CHAT_UNBLOCK",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.BLOCK_UNBLOCK_DATE]},a[n.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={PACKET_NAME:"FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_TAG_REGISTER]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PLATFORM]},a[r.TAG_CHAT_TAG_UNREGISTER]={PACKET_NAME:"TAG_CHAT_TAG_UNREGISTER",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.ONLINE_STATUS,c.USER_MOOD]},a[r.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_REGISTER_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.CHAT_BINDING_PORT,c.SERVER_DATE]},a[r.TAG_CHAT_TAG_INFORMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.ACTIVITY_TYPE,c.TAG_NAME_LENGTH,c.TAG_NAME,c.TAG_PICTURE_URL_LENGTH,c.TAG_PICTURE_URL]},a[r.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_TAG_MEMBER_ADD]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.TAG_NO_OF_MEMBERS,[c.USER_ID,c.FULL_NAME_LENGTH,c.FULL_NAME,c.TAG_MEMBER_TYPE]]},a[r.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_MEMBER_REMOVE_LEAVE]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.TAG_NO_OF_MEMBERS,[c.USER_ID]]},a[r.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.TAG_NO_OF_MEMBERS,[c.USER_ID,c.TAG_MEMBER_TYPE]]},a[r.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_IDLE]={PACKET_NAME:"TAG_CHAT_IDLE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PLATFORM]},a[r.TAG_CHAT_TYPING]={PACKET_NAME:"TAG_CHAT_TYPING",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PLATFORM]},a[r.TAG_CHAT_MSG]={PACKET_NAME:"TAG_CHAT_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE]},a[r.TAG_CHAT_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE]},a[r.TAG_CHAT_BROKEN_MSG]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE]},a[r.TAG_CHAT_BROKEN_MSG_EDIT]={PACKET_NAME:"TAG_CHAT_BROKEN_MSG_EDIT",BROKEN_CONTAINER:"message",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE]},a[r.TAG_CHAT_MULTIPLE_MSG]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE]},a[r.TAG_CHAT_DELIVERED]={PACKET_NAME:"TAG_CHAT_DELIVERED",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_SENT]={PACKET_NAME:"TAG_CHAT_SENT",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_SEEN]={PACKET_NAME:"TAG_CHAT_SEEN",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_SEEN_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_SEEN_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_MULTIPLE_MSG_DELETE]={PACKET_NAME:"TAG_CHAT_MULTIPLE_MSG_DELETE",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,[c.PACKET_ID_LENGTH,c.PACKET_ID]]},a[r.TAG_CHAT_MSG_DELETE_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_MSG_DELETE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[r.TAG_CHAT_GENERAL_BROKEN_PACKET]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.RAW_DATA_BYTE]},a[r.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.SEQUENCE_NO]},a[i.OFFLINE_FRIEND_INFORMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.FULL_NAME_LENGTH,c.FULL_NAME,c.FRIEND_PLATFORM,c.ONLINE_STATUS,c.FRIEND_APP_TYPE,c.FRIEND_DEVICE_TOKEN_LENGTH,c.FRIEND_DEVICE_TOKEN,c.USER_MOOD,c.IS_VOIP_CALL,c.PLATFORM]},a[i.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_INFORMATION_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PLATFORM]},a[i.OFFLINE_GET_REQUEST]={PACKET_NAME:"OFFLINE_GET_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.UPDATE_TIME,c.BLOCK_UNBLOCK_DATE,c.APP_VERSION,c.PLATFORM]},a[i.OFFLINE_GET_REQUEST_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_REQUEST_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.SERVER_DATE]},a[i.OFFLINE_FRIEND_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE]]},a[i.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,[c.PACKET_ID_LENGTH,c.PACKET_ID]]},a[i.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PAGE_DIRECTION,c.PAGE_LIMIT,c.PLATFORM]},a[i.OFFLINE_FRIEND_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.TIMEOUT,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE,c.IS_SECRET_VISIBLE,c.MESSAGE_STATUS],c.PAGE_DIRECTION]},a[i.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.FRIEND_ID,c.PACKET_ID,c.PACKET_ID_LENGTH,c.NO_OF_PACKET,[c.PACKET_ID_LENGTH,c.PACKET_ID],c.PLATFORM]},a[i.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={PACKET_NAME:"OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.FRIEND_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,[c.PACKET_ID_LENGTH,c.PACKET_ID]]},a[i.OFFLINE_TAG_INFORMATION_ACTIVITY]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_ACTIVITY",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_ITEMS,[c.ACTIVITY_TYPE,c.USER_ID,c.ACTIVITY_VALUE_LENGTH,c.ACTIVITY_VALUE,c.TAG_MEMBER_TYPE,c.CHANGED_BY_USER_ID,c.UPDATE_TIME]]},a[i.OFFLINE_MY_TAG_LIST]={PACKET_NAME:"OFFLINE_MY_TAG_LIST",BROKEN_CONTAINER:"items",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_ITEMS,[c.TAG_ID,c.TAG_NAME_LENGTH,c.TAG_NAME,c.TAG_PICTURE_URL_LENGTH,c.TAG_PICTURE_URL,c.TAG_MEMBER_ADDED_BY,c.TAG_INFORMATION_TAG_NO_OF_MEMBERS]]},a[i.OFFLINE_TAG_UNREAD_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE]]},a[i.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION",BROKEN_CONTAINER:"packets",CONFIRMATION:!1,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,[c.PACKET_ID_LENGTH,c.PACKET_ID]]},a[i.OFFLINE_TAG_CREATE_TAG]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG",CONFIRMATION:!0,BROKEN:!0,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.TAG_NAME_LENGTH,c.TAG_NAME,c.TAG_PICTURE_URL_LENGTH,c.TAG_PICTURE_URL,c.TAG_NO_OF_MEMBERS,[c.USER_ID,c.FULL_NAME_LENGTH,c.FULL_NAME,c.TAG_MEMBER_TYPE],c.PLATFORM]},a[i.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CREATE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[i.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE_REQUEST",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PAGE_DIRECTION,c.PAGE_LIMIT,c.APP_VERSION,c.PLATFORM]},a[i.OFFLINE_TAG_HISTORY_MESSAGE]={PACKET_NAME:"OFFLINE_TAG_HISTORY_MESSAGE",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_MESSAGE,[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.MESSAGE_TYPE,c.MESSAGE_LENGTH,c.MESSAGE,c.MESSAGE_DATE],c.PAGE_DIRECTION]},a[i.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.PLATFORM]},a[i.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={PACKET_NAME:"OFFLINE_TAG_INFORMATION_WITH_MEMBERS",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.TAG_NAME_LENGTH,c.TAG_NAME,c.TAG_PICTURE_URL_LENGTH,c.TAG_PICTURE_URL,c.TAG_NO_OF_MEMBERS,[c.USER_ID,c.FULL_NAME_LENGTH,c.FULL_NAME,c.TAG_MEMBER_TYPE,c.TAG_MEMBER_ADDED_BY]]},a[i.OFFLINE_TAG_CONFIRMATION]={PACKET_NAME:"OFFLINE_TAG_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.TAG_ID,c.PACKET_ID_LENGTH,c.PACKET_ID]},a[i.OFFLINE_BROKEN_HISTORY_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_HISTORY_PACKET",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.RAW_DATA_BYTE]},a[i.OFFLINE_BROKEN_PACKET]={PACKET_NAME:"OFFLINE_BROKEN_PACKET",BROKEN_CONTAINER:"bytes",CONFIRMATION:!0,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.PACKET_ID_LENGTH,c.PACKET_ID,c.NO_OF_PACKET,c.SEQUENCE_NO,c.RAW_DATA_BYTE,c.USER_ID,c.PLATFORM]},a[i.OFFLINE_BROKEN_PACKET_CONFIRMATION]={PACKET_NAME:"OFFLINE_BROKEN_PACKET_CONFIRMATION",CONFIRMATION:!1,BROKEN:!1,FORMAT:[c.PACKET_TYPE,c.USER_ID,c.PACKET_ID_LENGTH,c.PACKET_ID,c.SEQUENCE_NO]},e.CHAT_APP.PacketFormats={CHAT_PACKET_ATTRIBUTE:c,CHAT_PACKET_ATTRIBUTE_INFO:s,CHAT_PACKET_INFO:a}}(window),function(e){"use strict";function t(){var t=e.CHAT_APP.Constants.PACKET_TYPES,n=e.CHAT_APP.Constants.PLATFORM.WEB,r=e.CHAT_APP.getAppVersion,i=e.CHAT_APP.getCurrentUserId,o=e.CHAT_APP.UTILS.getUUIDPacketId;this.getFriendChatRegisterObject=function(e,r){var a={packetType:t.FRIEND_CHAT_REGISTER,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatUnregisterObject=function(e,r,a,s){var c={packetType:t.FRIEND_CHAT_UNREGISTER,userId:i(),friendId:e,platform:n,onlineStatus:r,userMood:a,packetId:s||o()};return c},this.getFriendChatRegisterConfirmationObject=function(e,n,r,i){
var a={packetType:t.FRIEND_CHAT_REGISTER_CONFIRMATION,friendId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getFriendChatIdleObject=function(e){var r={packetType:t.FRIEND_CHAT_IDLE,userId:i(),friendId:e,platform:n};return r},this.getFriendChatTypingObject=function(e){var r={packetType:t.FRIEND_CHAT_TYPING,userId:i(),friendId:e,platform:n};return r},this.getFriendChatMsgObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatMsgEditObject=function(e,r,a,s,c,l,u){var d={packetType:t.FRIEND_CHAT_MSG_EDIT,userId:i(),friendId:e,messageType:r,timeout:a,message:s,messageDate:c,isSecretVisible:l,platform:n,packetId:u||o()};return d},this.getFriendChatBrokenMsgObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatBrokenMsgEditObject=function(e,r,a,s,c,l,u,d){var g={packetType:t.FRIEND_CHAT_BROKEN_MSG_EDIT,userId:i(),friendId:e,sequenceNo:r,messageType:a,timeout:s,message:c,messageDate:l,isSecretVisible:u,platform:n,packetId:d||o()};return g},this.getFriendChatMultipleMsgObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_MULTIPLE_MSG,userId:i(),friendId:e,messages:n,packetId:r||o()};return a},this.getFriendChatDeliveredObject=function(e,r){var a={packetType:t.FRIEND_CHAT_DELIVERED,userId:i(),friendId:e,platform:n,packetId:r||o()};return a},this.getFriendChatSentObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SENT,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatSeenObject=function(e,r,a){var s={packetType:t.FRIEND_CHAT_SEEN,userId:i(),friendId:e,messages:r,platform:n,packetId:a||o()};return s},this.getFriendChatSeenConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_SEEN_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatMultipleMsgDeleteObject=function(e,r,a){var s={packetType:t.FRIEND_CHAT_MULTIPLE_MSG_DELETE,userId:i(),friendId:e,packets:r,packetId:a||o(),platform:n};return s},this.getFriendChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getFriendChatBrokenObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BROKEN,userId:i(),friendId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getFriendChatBrokenConfirmationObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_BROKEN_CONFIRMATION,userId:i(),friendId:e,sequenceNo:n,packetId:r||o()};return a},this.getFriendChatBlockObject=function(e,n,r,a){var s={packetType:t.FRIEND_CHAT_BLOCK,userId:i(),friendId:e,blockUnblockDate:n,isAddToDb:r,packetId:a||o()};return s},this.getFriendChatUnblockObject=function(e,n,r){var a={packetType:t.FRIEND_CHAT_UNBLOCK,userId:i(),friendId:e,blockUnblockDate:n,packetId:r||o()};return a},this.getFriendChatBlockUnblockConfirmationObject=function(e,n){var r={packetType:t.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION,userId:i(),friendId:e,packetId:n||o()};return r},this.getTagChatTagRegisterObject=function(e,r){var a={packetType:t.TAG_CHAT_TAG_REGISTER,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getTagChatTagUnregisterObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_TAG_UNREGISTER,userId:i(),tagId:e,onlineStatus:n,userMood:r,packetId:a||o()};return s},this.getTagChatTagRegisterConfirmationObject=function(e,n,r,i){var a={packetType:t.TAG_CHAT_TAG_REGISTER_CONFIRMATION,tagId:e,chatBindingPort:n,serverDate:r,packetId:i||o()};return a},this.getTagChatTagInformationObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_TAG_INFORMATION,userId:i(),tagId:e,activityType:n,tagName:r,tagPictureUrl:a,packetId:s||o()};return c},this.getTagChatTagInformationConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberAddObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_ADD,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberAddConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatMemberRemoveLeaveObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatMemberRemoveLeaveConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatTagMemberTypeChangeObject=function(e,n,r){var a={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE,userId:i(),tagId:e,tagMembers:n,packetId:r||o()};return a},this.getTagChatTagMemberTypeChangeConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatIdleObject=function(e){var r={packetType:t.TAG_CHAT_IDLE,userId:i(),tagId:e,platform:n};return r},this.getTagChatTypingObject=function(e){var r={packetType:t.TAG_CHAT_TYPING,userId:i(),tagId:e,platform:n};return r},this.getTagChatMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatMsgEditObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MSG_EDIT,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatBrokenMsgObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatBrokenMsgEditObject=function(e,n,r,a,s,c){var l={packetType:t.TAG_CHAT_BROKEN_MSG_EDIT,userId:i(),tagId:e,sequenceNo:n,messageType:r,message:a,messageDate:s,packetId:c||o()};return l},this.getTagChatMultipleMsgObject=function(e,n,r,a,s){var c={packetType:t.TAG_CHAT_MULTIPLE_MSG,userId:i(),tagId:e,messageType:n,message:r,messageDate:a,packetId:s||o()};return c},this.getTagChatDeliveredObject=function(e,n,r){var a={packetType:t.TAG_CHAT_DELIVERED,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSentObject=function(e,n){var r={packetType:t.TAG_CHAT_SENT,tagId:e,packetId:n||o()};return r},this.getTagChatSeenObject=function(e,n,r){var a={packetType:t.TAG_CHAT_SEEN,userId:i(),friendId:e,tagId:n,packetId:r||o(),boxId:n};return a},this.getTagChatSeenConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_SEEN_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getTagChatMultipleMsgDeleteObject=function(e,n,r){var a={packetType:t.TAG_CHAT_MULTIPLE_MSG_DELETE,userId:i(),tagId:e,packets:n,packetId:r||o()};return a},this.getTagChatMsgDeleteConfirmationObject=function(e,n){var r={packetType:t.TAG_CHAT_MSG_DELETE_CONFIRMATION,userId:i(),tagId:e,packetId:n||o()};return r},this.getTagChatGeneralBrokenPacketObject=function(e,n,r,a){var s={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET,userId:i(),tagId:e,sequenceNo:n,bytes:r,packetId:a||o()};return s},this.getTagChatGeneralBrokenPacketConfirmationObject=function(e,n,r){var a={packetType:t.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,userId:i(),tagId:e,sequenceNo:n,packetId:r||o()};return a},this.getOfflineFriendInformationObject=function(e,r,a,s,c,l,u,d,g){var m={packetType:t.OFFLINE_FRIEND_INFORMATION,userId:i(),friendId:e,fullName:r,onlineStatus:a,friendPlatform:s,friendAppType:c,friendDeviceToken:l,userMood:u,packetId:g||o(),isVoipCall:d,platform:n};return m},this.getOfflineFriendInformationConfirmationObject=function(e,r){var i={packetType:t.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,friendId:e,platform:n,packetId:r||o()};return i},this.getOfflineGetRequestObject=function(e,a,s){var c={packetType:t.OFFLINE_GET_REQUEST,userId:i(),updateTime:e,blockUnblockDate:a,appVersion:r(),platform:n,packetId:s||o()};return c},this.getOfflineGetRequestConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_GET_REQUEST_CONFIRMATION,serverDate:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineFriendUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineFriendHistoryMessageRequestObject=function(e,r,a,s){var c={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,userId:i(),friendId:e,pageDirection:r,pageLimit:a,platform:n,packetId:s||o()};return c},this.getOfflineFriendHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE,friendId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineFriendHistoryMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,friendId:e,packetId:n||o()};return r},this.getOfflineGetFriendMessageStatusObject=function(e,r,a){var s={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS,userId:i(),friendId:e,packets:r,platform:n,packetId:a||o()};return s},this.getOfflineGetFriendMessageStatusConfirmationObject=function(e,n,r){var i={packetType:t.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION,friendId:e,packets:n,packetId:r||o()};return i},this.getOfflineTagInformationActivityObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_INFORMATION_ACTIVITY,tagId:e,noOfItems:n,items:r,packetId:i||o()};return a},this.getOfflineMyTagListObject=function(e,n,r){var i={packetType:t.OFFLINE_MY_TAG_LIST,noOfItems:e,items:n,packetId:r||o()};return i},this.getOfflineTagUnreadMessageObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE,messages:e,packetId:n||o()};return r},this.getOfflineTagUnreadMessageConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,userId:i(),packets:e,packetId:n||o()};return r},this.getOfflineTagCreateTagObject=function(e,r,a,s,c){var l={packetType:t.OFFLINE_TAG_CREATE_TAG,userId:i(),tagId:e,tagName:r,tagPictureUrl:a,tagMembers:s,platform:n,packetId:c||o()};return l},this.getOfflineTagCreateTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineTagHistoryMessageRequestObject=function(e,a,s,c){var l={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,userId:i(),tagId:e,pageDirection:a,pageLimit:s,appVersion:r(),platform:n,packetId:c||o()};return l},this.getOfflineTagHistoryMessageObject=function(e,n,r,i){var a={packetType:t.OFFLINE_TAG_HISTORY_MESSAGE,tagId:e,messages:n,pageDirection:r,packetId:i||o()};return a},this.getOfflineGetTagInformationWithMembersObject=function(e,r){var a={packetType:t.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS,userId:i(),tagId:e,platform:n,packetId:r||o()};return a},this.getOfflineTagInformationWithMembersObject=function(e,n,r,i,a){var s={packetType:t.OFFLINE_TAG_INFORMATION_WITH_MEMBERS,tagId:e,tagName:n,tagPictureUrl:r,tagMembers:i,packetId:a||o()};return s},this.getOfflineTagConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_TAG_CONFIRMATION,tagId:e,packetId:n||o()};return r},this.getOfflineBrokenHistoryPacketObject=function(e,n,r){var i={packetType:t.OFFLINE_BROKEN_HISTORY_PACKET,sequenceNo:e,bytes:n,packetId:r||o()};return i},this.getOfflineBrokenPacketObject=function(e,r,a){var s={packetType:t.OFFLINE_BROKEN_PACKET,sequenceNo:e,bytes:r,userId:i(),platform:n,packetId:a||o()};return s},this.getOfflineBrokenPacketConfirmationObject=function(e,n){var r={packetType:t.OFFLINE_BROKEN_PACKET_CONFIRMATION,userId:i(),sequenceNo:e,packetId:n||o()};return r}}e.CHAT_APP.ChatRequests=new t}(window),function(e){"use strict";var t=e.CHAT_APP,n=t.AUTH_REQUEST_TYPE,r=t.getCurrentUserId;function i(){var e=t.Constants.AUTH_SERVER_ACTIONS;this.getOfflineIpPort=function(t){var n={actn:e.GET_OFFLINE_IP_PORT,rid:r()};return t&&(n.pckId=t),n},this.getTagChatRegisterIpPort=function(t,n,r){var i={actn:e.START_TAG_CHAT,tid:t,uIds:n};return r&&(i.pckId=r),i},this.getFriendChatRegisterIpPort=function(t,n){var i={actn:e.START_F2F_CHAT,fndId:t,uId:r()};return n&&(i.pckId=n),i},this.getTagChatMembersAddObject=function(t,n,r,i,o){var a={actn:e.ADD_TAG_CHAT_MEMBERS,tid:t,uIds:n,chIp:r,chRp:i};return o&&(a.pckId=o),a},this.getOfflineIpPort=function(){var t={actn:e.GET_OFFLINE_IP_PORT,rid:r(),requestType:n.REQUEST};return t},this.getFriendPresenceObject=function(t){var n={actn:e.GET_USER_MOOD_PRESENCE,fndId:t};return n}}e.CHAT_APP.AuthRequests=new i}(window),function(e){var t=0,n=50,r=o(),i=122192928e9;function o(){return Date.UTC(1582,9,15)}function a(e){var t=s(e),n=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&n,hi:n>>>16,timestamp:t}}function s(e){return e-r}function c(){return(new Date).getTime()}function l(e){for(var r,i,o,a=0;a++<n;){if(r=e,r>t){t=r,o=r;break}if(r<t){o=t+1;break}if(i=t+1,o=i,i===t){t=i,o=i;break}}return o}function u(e,t,n){var r,i,o=e;try{o=parseInt(o,10)}catch(e){return RingLogger.log("Invalid User Id Provided for PacketIDGenerator","CHAT"),""}return r=n?t:l(t||c),i=a(r),i.hi=4096|i.hi,g(i.low,i.mid,i.hi,o)}function d(e,t,n){var r,i=n?n:"0",o=String(e);for(r=t-o.length;r>0;r>>>=1,i+=i)1&r&&(o=i+o);return o}function g(e,t,n,r){var i;return e<0&&RingLogger.log("Invalid time in packetIdgen","CHAT"),i=d(e.toString(16),8)+"-"+d(t.toString(16),4)+"-"+d(n.toString(16),4)+"-"+d((0).toString(16),4)+"-"+d(r.toString(16),12)}function m(e){var t,n,r=e.split("-"),o=[r[2].substring(1),r[1],r[0]].join("");return t=parseInt(o,16),t-=i,n=Math.floor(t/1e4)}function E(){}E.prototype.create=u,E.prototype.getTimestamp=m,window.PacketIDGenerator=e||new E}(window.PacketIDGenerator);var ChatApp,CHAT_LANG,TAG_CHAT_LANG={STATUS_MESSAGES:{SELF_ADD_MEMBER:"You added {new_member_name} as Group {new_member_type}.",SELF_ADD_MULTIPLE_MEMBER:"You added {new_member_name} and {rest_count} as Group {new_member_type}.",SELF_REMOVE_MEMBER:"You removed {old_member_name} from the group.",SELF_REMOVE_MULTIPLE_MEMBER:"You removed {old_member_name} and {rest_count} from the group.",OTHER_ADD_MEMBER:"{member_name} added {new_member_name} as Group {new_member_type}.",OTHER_ADD_MULTIPLE_MEMBER:"{member_name} added {new_member_name} and {rest_count} as Group {new_member_type}.",OTHER_REMOVE_MEMBER:"{member_name} removed {old_member_name} from the group.",OTHER_REMOVE_MULTIPLE_MEMBER:"{member_name} removed {old_member_name} and {rest_count} from the group.",SELF_LEAVE_GROUP:"You left this conversation.",OTHER_LEAVE_GROUP:"{member_name} left this conservation.",SELF_RENAME_GROUP:"You named the group {group_name}.",OTHER_RENAME_GROUP:"{member_name} named the group {group_name}.",SELF_CHANGE_GROUP_PIC:"You changed the group photo.",OTHER_CHANGE_GROUP_PIC:"{member_name} changed the group photo.",SELF_UPDATE_GROUP_INFO:"You named the group {group_name} and changed the group photo.",OTHER_UPDATE_GROUP_INFO:"{member_name} named the group {group_name} and changed the group photo.",SELF_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} Group Admin.",OTHER_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} as Admin.",SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} and {rest_count} as Group admin.",SELF_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} from Admin.",OTHER_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} from Group Admin.",SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} and {rest_count} from Group Admin.",SELF_REMOVED_FROM_ADMIN_BY_SELF:"You removed yourself from Admin",OTHER_REMOVED_FROM_ADMIN_BY_SELF:"{admin_name} removed himself/herself from Admin",SELF_USER_ADDED_AS_OWNER:"{member_name} made you owner.",OTHER_USER_ADDED_AS_OWNER:"{member_name} made {admin_name} Owner. ",SELF_NOT_GROUP_MEMBER:"You are no longer member of this group"},DEFAULT_FAILURE_MESSAGE:"Request has not been processed successfully. Please try again",DEFAULT_SUCCESS_MESSAGE:"Request has been processed successfully."};CHAT_LANG={MESSAGE_DELETE_TEXT:"This message has been deleted"},ChatApp=angular.module("ringid.chat"),ChatApp.constant("CHAT_LANG",{TAG:TAG_CHAT_LANG,CHAT:CHAT_LANG}),ChatApp=angular.module("ringid.chat"),ChatApp.constant("CHAT_LANG",{TAG:TAG_CHAT_LANG,CHAT:CHAT_LANG});var app=angular.module("ringid.chat");ChatMessageMap.$inject=["$$stackedMap","$interval","$websocket","$rootScope","$sce","Auth","ChatConnector","userFactory","Utils","tagChatFactory","chatHistoryFactory","settings","tagChatHelper","tagChatStorage","ChatUtilsFactory","rgScrollbarService","chatTabSync","$$mediaMap"],app.factory("ChatMessageMap",ChatMessageMap);function ChatMessageMap(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T){var h=CHAT_APP.Constants,I=h.GENERAL_CONSTANTS;function _(e,t){var n,r,o;e.userId=t,r=A(e),o=s.create({uId:t,fetchDatails:!1}),n={locationInfo:{},ogData:{},seenUserIds:{},deliveredUserIds:{},user:o,parsedMessageText:"",sortBy:a,getTextPartition:l,setTextPartition:u,getMessageTime:d,seenUsersCount:m,deliveredUsersCount:f,addSeenUserId:p,addDeliveredUserId:h,updateLocationInfo:I,updateLinkShareInfo:_,updateMediaInfo:C,updateRingMediaInfo:v,getSafeMapJsUrl:D,refreshStatusMessageText:R},e.usersToChange&&(n.usersToChange=e.usersToChange),e.statusType&&(n.statusType=e.statusType),angular.extend(n,r),S(n),n.parsedMessageText=i.trustAsHtml(n.parsedMessageText);function a(){return e.messageDate}function l(){return n.parsedMessageText}function u(){n.parsedMessageText=E.parseForLE(n.text),n.parsedMessageText=i.trustAsHtml(n.parsedMessageText)}function d(){return e.hrtime}function m(){return Object.keys(n.seenUserIds).length}function f(){return Object.keys(n.deliveredUserIds).length}function p(e){n.seenUserIds[e]=!0}function h(e){n.deliveredUserIds[e]=!0}function I(){var e,t,r;try{e=angular.fromJson(n.text),t=e.la,r=e.lo,n.locationInfo={lat:t,long:r,description:e.loc},n.plainText=e.loc}catch(e){RingLogger.log(e,RingLogger.tags.CHAT)}}function _(){var e;n.ogData={};try{e=angular.fromJson(n.text),n.ogData={lnkDmn:e.u,description:e.d,title:e.t,url:e.u,image:e.i,message:e.m},n.plainText=e.m}catch(e){RingLogger.log(e,RingLogger.tags.CHAT)}}function C(){var e,t,r;try{e=angular.fromJson(n.text),n.mediaInfo={url:e.u,caption:e.c,width:e.w,height:e.h},n.mediaInfo.width?(t=c.getScaledImageSize(n.mediaInfo.width,n.mediaInfo.height,c.viewport.x,c.viewport.y),r=c.getScaledImageSize(n.mediaInfo.width,n.mediaInfo.height,150,300),n.mediaInfo.width=t.width,n.mediaInfo.height=t.height,n.mediaInfo.thumbWidth=r.width,n.mediaInfo.thumbHeight=r.height):(n.mediaInfo.width="400",n.mediaInfo.height="auto",n.mediaInfo.thumbWidth="150",n.mediaInfo.thumbHeight="auto"),n.plainText=e.c}catch(e){RingLogger.alert(e,"CHAT")}}function v(){var e;try{e=angular.fromJson(n.text),n.ringMediaObject=T(e)}catch(e){RingLogger.alert(e,"CHAT")}}function D(){return i.trustAsResourceUrl(n.mapJsEmbededUrl)}function R(){n.parsedMessageText=g.getTagChatStatusMessage(e),n.parsedMessageText=i.trustAsHtml(n.parsedMessageText)}return n}function A(e){var t,n=e.key||e.packetId,r=e.messageDate||(new Date).getTime();return t={key:n.toString(),packetId:n.toString(),text:e.message||e.mg||e.text,hrtime:E.getChatVerbalDateFromServerDate(r),status:e.status||0,fullName:e.fullName,tagName:e.tagName||"",messageDate:r,isDeleted:!1,messageDateString:e.messageDateString||"",timeout:e.timeout,messageType:e.messageType,tag_chat:e.tag_chat||!1,seenSent:e.seenSent||!1,isSecretVisible:e.isSecretVisible,secretTimedOut:!!e.secretTimedOut&&e.secretTimedOut,lastUpdateTime:(new Date).getTime(),userId:e.userId,platform:5,scroll:e.scroll},e.tag_chat?(t.packetType=e.packetType||63,t.brokenPacketType=e.brokenPacketType):(t.packetType=e.packetType||6,t.brokenPacketType=e.brokenPacketType),t.status_text="Pending",e.status&&(t.status_text=e.status),t}function S(e){var t,n;if("status_update"!==e.status)if(e.secretTimedOut!==!0&&"Deleted"===e.status)e.messageType=2,e.parsedMessageText=E.parseForLE(e.text);else switch(e.messageType){case I.MESSAGE_TYPES.DELETE_MESSAGE:e.text="This msg has been deleted",e.setTextPartition();break;case I.MESSAGE_TYPES.TEXT:case I.MESSAGE_TYPES.EMOTICON_MESSAGE:e.parsedMessageText=E.parseForLE(e.text);break;case I.MESSAGE_TYPES.LOCATION_SHARE:e.updateLocationInfo(),t=e.locationInfo.lat,n=e.locationInfo.long,0!==t&&0!==n?(e.mapStaticUrl=c.getGoogleMapStaticUrl(t,n),e.mapJsUrl=c.getGoogleMapJSUrl(t,n),e.mapJsEmbededUrl=c.getGoogleMapJSUrl(t,n,"",!0)):e.parsedMessageText=E.parseForLE(e.text);break;case I.MESSAGE_TYPES.LINK_SHARE:e.updateLinkShareInfo();break;case I.MESSAGE_TYPES.STICKER:e.stickerUrl=d.stickerBase+e.text;break;case I.MESSAGE_TYPES.IMAGE:case I.MESSAGE_TYPES.CAMERA_IMAGE:e.updateMediaInfo();try{e.mediaUrl=d.imBase+e.mediaInfo.url}catch(t){e.mediaUrl=""}e.parsedMessageText="";break;case I.MESSAGE_TYPES.AUDIO:e.updateMediaInfo(),e.isVideo=!1;try{e.mediaUrl=d.mediaBase+e.mediaInfo.url}catch(t){e.mediaUrl=""}break;case I.MESSAGE_TYPES.VIDEO:e.updateMediaInfo(),e.isVideo=!0;try{e.mediaUrl=d.mediaBase+e.mediaInfo.url}catch(t){e.mediaUrl=""}break;case I.MESSAGE_TYPES.RING_MEDIA_MESSAGE:e.updateRingMediaInfo();try{e.plainText=e.ringMediaObject.getCaption(),e.thumbURL=e.ringMediaObject.getThumbForMedia(),e.albumName=e.ringMediaObject.getAlbumName(),e.artistName=e.ringMediaObject.getArtistName(),e.durationText=e.ringMediaObject.getDuration(!0)}catch(t){RingLogger.alert(t,"CHAT"),e.thumbURL=""}break;default:return void RingLogger.log("Skipping UnHandled Chat Message Type.",e.messageType,"CHAT")}else if(e.parsedMessageText=g.getTagChatStatusMessage(e),!e.parsedMessageText)return}return{create:_,getBasicMessageObject:A,processMessage:S}}var app=angular.module("ringid.chat");ChatMap.$inject=["$$stackedMap","$interval","$websocket","$rootScope","$sce","Auth","ChatConnector","userFactory","Utils","tagChatFactory","chatHistoryFactory","settings","tagChatHelper","tagChatStorage","ChatMessageMap","ChatUtilsFactory","rgScrollbarService","chatTabSync","$$mediaMap","SystemEvents"],app.factory("ChatMap",ChatMap);function ChatMap(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T,h,I){var _=CHAT_APP.Constants,A=_.GENERAL_CONSTANTS,S=CHAT_APP.SharedHelpers;return{create:function(n,o){var a,d,g=!1,m=!1,p={},h="",_=n,C=e.createNew(!0,"asc");if(!_)return RingLogger.alert("Invalid Box Id",n,o,RingLogger.tags.CHAT),{};_=String(n),a={messages:C.all(),isTagChat:!1,boxTitle:"",unreadCount:0,messageMaxPacketId:"",messageMinPacketId:"",messageMaxDate:0,messageMinDate:0,latestSeenMessageDate:0,hasHistoryMessage:!1,getTitleString:M,updateUnreadCount:N,getProfileLink:y,checkWaitingTimePassed:b,pushMessage:v,pushDummyMessage:D,sendTabUpdate:O,startTimer:$,updateBoxMessageMinMaxPacketId:R,loadHistoryMessages:w,loadSingleHistoryMessage:F,isConsicutive:G,getTypingText:k,getKey:B,getTagItem:H,getUser:x,getTitle:Y,setTitle:K,isSamePacketId:j,getMessages:V,getMessage:W,getBottomMessage:q,getTopMessage:z,removeMessage:Q,updateMessageStatus:X,isTyping:Z,setTypingBool:J,isFriendTyping:ee,showTypingText:te,hideTypingText:ne,setFriendTypingBool:re},d=o?l.getTag(_):s.create({uId:_});function v(e,t,n){var r,i;return"object"==typeof t?void RingLogger.alert("userId contains object, debug please",RingLogger.tags.CHAT):e.type&&101===e.type?void(g=!0):0===e.type&&0===e.status?(r=C.get(C.packetId),void(r.isDeleted=!0)):(i=E.create(e,String(t)),e.userId=String(t),e.userId!==i.userId&&i.userId!==i.user.getUId()?void RingLogger.alert("userId mismatch in message object, debug please",RingLogger.tags.CHAT):(C.save(i.key,i),e.fromLocalHistory||R(i),u.addMessage(i,_),c.triggerCustomEvent(I.CHAT.MESSAGE_PUSHED,{boxId:_,fromLocalHistory:e.fromLocalHistory||!1,fromHistory:e.fromHistory||!1,msg_status:i.status_text.toLowerCase(),isEdit:e.isEdit}),void(n&&O(i))))}function D(e,t){var n=e.key||e.packetId,r=S.getChatServerCurrentTime(),o=[],a={key:n,text:e.message||e.mg||e.text,hrtime:f.getChatVerbalDateFromServerDate(r),status:e.status||0,messageType:e.messageType,uploading:e.uploading,uploadProgress:e.uploadProgress,messageDate:r,isDeleted:!1,messageDateString:e.messageDateString||"",mediaUrl:e.mediaUrl,mediaInfo:{thumbWidth:150,thumbHeight:63},timeout:e.timeout,isSecretVisible:e.isSecretVisible,user:angular.isObject(t)?t:s.getUser(e.userId),userId:angular.isObject(t)?t.getKey():e.userId,lastUpdateTime:(new Date).getTime(),sortBy:function(){return e.messageDate},getTextPartition:function(){return o},setTextPartition:function(){o=f.parseForLE(a.text),o=i.trustAsHtml(o)}};o=f.parseForLE(a.text),o=i.trustAsHtml(o),C.save(a.key,a),c.triggerCustomEvent(I.CHAT.MESSAGE_PUSHED,{boxId:_,fromLocalHistory:!1,fromHistory:!1,msg_status:a.status})}function R(e){var t=a,n=e.key||e.packetId;if("status_update"===e.status)try{n=n.split("_")[0]}catch(e){RingLogger.alert(e,"CHAT")}t.messageMaxDate<e.messageDate&&(t.messageMaxDate=e.messageDate,t.messageMaxPacketId=n),(!t.messageMinDate||t.messageMinDate>=e.messageDate)&&(t.messageMinDate=e.messageDate,t.messageMinPacketId=n)}function M(){var e=a,t=e.getTitle();return o||t||(t=e.getKey()),e.unreadCount>0&&(t=t+" ("+e.unreadCount+")"),t}function N(){var e=a;e.unreadCount=u.getUnreadMessageCountByBoxId(_)}function y(){var e,t=a;return e=!t.isTagChat&&"/profile/"+t.getUser().getKey()}function b(){var e,t=Math.floor(Date.now()/1e3);return e=t-this.lastCommunicationTime>this.waitingTime}function O(e){T.sendData(A.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:_,messageId:e.key})}function P(e,t){r.$broadcast("timeoutDelete",e.key,t)}function L(e){var n=e.timeout;e.timerStartFlag=!0,L(e),t(function(){P(e,n--)},1e3,n+1)}function U(e,t){var n;return R(t),t.fromLocalHistory=!0,0===t.status&&S.getChatServerCurrentTime()-t.messageDate>12e4&&(t.status="Failed",n=!0),"Seen"===t.stauts&&t.messageDate>e.latestSeenMessageDate&&(e.latestSeenMessageDate=t.messageDate),e.pushMessage(t,t.userId),n}function F(e){var t=a,n=u.getMessage(_,e);n&&U(t,n)}function w(){var e,t,n,r=a,i=!1;if(e=u.getMessages(_))for(t=0;t<e.length;t++)n=e[t],i=U(r,n);i&&u.updateMessages(e,_)}function k(){var e,t,n,r,i;return h="is typing ...",o?(e=l.getTag(a.getKey()),t=Object.keys(p),r=" is typing ...",p.length>3&&(t=p.slice(0,3),r=" and "+(p.length-3)+" others are typing..."),n=[],t.forEach(function(t){i=e.getMember(t),n.push(i.getName())}),h=n.join(",")+r):h=a.getUser().getName()+" "+h,h}function $(){var e,t=a,n=t.getMessages();if(angular.isArray(n)&&n.length>0)for(e=0;e<C.length;e++)if(C[e].value.timeout>0&&t.isMinimized===!1&&t.isHidden===!1&&!C[e].value.timerStartFlag)switch(C[e].value.messageType){case 2:case 3:case 4:case 5:case 6:L(C[e].value)}}function G(e){var t=C.get(e),n=C.previous(e);return!(!n||"status_update"===n.status||n.user.getKey()!==t.user.getKey())}function B(){return n.toString()}function H(){return d||l.getTag(a.getKey())}function x(){return d}function Y(){return o?this.boxTitle=d.getTagName():this.boxTitle=d.getName(),this.boxTitle}function K(e){this.boxTitle=e}function j(e){return!!C.get(e.toString())}function V(){return C.all()}function W(e){return C.get(e.toString())}function q(){return C.bottom()}function z(){return C.top()}function Q(e){C.remove(e.toString())}function X(e,t){var n=C.get(e);return!!n&&(n.status=t,n)}function Z(){return g}function J(e){g=e}function ee(){return m}function te(e){p[e]=!0,g=m=!0}function ne(e){delete p[e],g=m=!1}function re(e){m=e}return a}}}var tagChatApp=angular.module("ringid.chat");tagChatApp.factory("tagChatModels",tagChatModels),tagChatModels.$inject=["$$stackedMap","userFactory","userService","Utils","Auth","settings","SystemEvents","routeService"];function tagChatModels(e,t,n,r,i,o,a,s){var c=CHAT_APP.Constants.GENERAL_CONSTANTS;function l(){var t=this,n={id:0,name:"Group",pictureUrl:"",userId:0,packetId:0,memberCount:0,serverDate:0,serverDateDiff:0,members:e.createNew(),messages:e.createNew(),objectLock:!1,ownerUserId:0,creationTime:0};this.getTagId=function(){return n.id},this.setTagId=function(e){n.id=String(e),n.creationTime=e.toString().substr(0,c.TAG_ID_NO_OF_TIME_DIGIT)},this.getTagCreationTime=function(){return n.creationTime},this.getUserId=function(){return n.userId},this.setUserId=function(e){n.userId=e},this.getPacketId=function(){return n.packetId},this.setPacketId=function(e){n.packetId=e},this.renewPacketId=function(){t.setPacketId(r.getUniqueID("tgrc"))},this.getTagName=function(){return n.name},this.setTagName=function(e){n.name=e},this.setPictureUrl=function(e){n.pictureUrl=e},this.getPictureUrl=function(){return n.pictureUrl.trim()},this.getPictureFullUrl=function(){var e;return e=""!==String(this.getPictureUrl())?o.imBase+this.getPictureUrl():"images/default_cover.jpg"},this.setServerDate=function(e){n.serverDate=e,t.setServerDateDiff(e-parseInt((new Date).getTime(),10))},this.getServerDate=function(){return n.serverDate},this.setServerDateDiff=function(e){n.serverDateDiff=e},this.getServerDateDiff=function(){return n.serverDateDiff},this.getMembersCount=function(){return n.memberCount},this.setMembersCount=function(e){n.memberCount=e},this.isTagSafeToShow=function(){return n.memberCount>0},this.initMembers=function(){n.members=e.createNew()},this.addMember=function(e){n.members||(n.members=t.initMembers()),e.isOwner()&&(n.ownerUserId=e.getId()),n.members.save(e.getId(),e)},this.updateMember=function(e){this.addMember(e)},this.removeMember=function(e){e instanceof u?n.members.remove(e.getId()):n.members.remove(e)},this.membersLength=function(){return n.members?n.members.length():0},this.getMember=function(e){return n.members.get(e)},this.getMemberObjects=function(){return n.members.values()},this.getMemberUserIds=function(){return n.members.keys()},this.getMembersObjectMap=function(){return n.members},this.setMembersObjectMap=function(e){n.members=e},this.initMemberObjects=function(){var e,t,r=n.members.all();for(e=0;e<n.members.length();e++)t=r[e].value,t.initUserObjects()},this.unregisterMemberObjectsListener=function(){var e,t,r=n.members.all();for(e=0;e<n.members.length();e++)t=r[e].value,t.unregisterUserObjectsListener()},this.getSerializedMembers=function(){var e,t,r=n.members.all(),i=[];for(e=0;e<r.length;e++)t=r[e].value,i.push(t.serialize());return i},this.isUserMember=function(e){var t;return t=!!n.members&&!!n.members.get(e)},this.isCurrentUserStatusAdmin=function(e){var t=!!n.members&&n.members.get(e);return!!t&&t.isAdmin()},this.isCurrentUserStatusMember=function(e){var t=!!n.members&&n.members.get(e);return!!t&&t.isMember()},this.setObjectLock=function(){n.objectLock=!0},this.removeObjectLock=function(){n.objectLock=!1},this.hasObjectLock=function(){return n.objectLock},this.setOwnerUserId=function(e){n.ownerUserId=e},this.getOwnerUserId=function(){return n.ownerUserId},this.initMessages=function(){n.messages=e.createNew()},this.addMessage=function(e){n.messages||(n.messages=t.initMessages()),n.messages.save(e.getPacketId(),e)},this.removeMessage=function(e){e instanceof d?n.messages.remove(e.getId()):n.messages.remove(e)},this.messagesLength=function(){return n.messages?n.messages.length():0},this.getMessage=function(e){return n.messages.get(e)},this.getMessageObjects=function(){return n.messages.values()},this.getMessageUserIds=function(){return n.messages.keys()},this.getMessagesObjectMap=function(){return n.messages},this.setMessagesObjectMap=function(e){n.messages=e},this.debug=function(){return n},this.link=function(){return s.getRoute("CHAT_GROUP",{tagId:this.tagId})}}l.prototype.copy=function(){var e=new l;return e.setTagId(this.getTagId()),e.setTagName(this.getTagName()),e.setPictureUrl(this.getPictureUrl()),e.setUserId(this.getUserId()),e.setPacketId(this.getPacketId()),e.setChatBindingPort(this.getChatBindingPort()),
e.setChatIp(this.getChatIp()),e.setChatRegisterPort(this.getChatRegisterPort()),e.setServerDate(this.getServerDate()),e.setMembersObjectMap(this.getMembersObjectMap().copy()),e},l.prototype.update=function(e){e.getTagName()&&this.setTagName(e.getTagName()),e.getPictureUrl()&&this.setPictureUrl(e.getPictureUrl()),e.getUserId()&&this.setUserId(e.getUserId()),e.getPacketId()&&this.setPacketId(e.getPacketId()),e.getServerDate()&&this.setServerDate(e.getServerDate())},l.prototype.sortBy=function(){return this.getTagCreationTime()};function u(){var e=this,s={tagId:0,userId:0,fullName:"",status:0,statusValue:"",addedBy:0,user:{},addedByUser:{},userRegisterKey:null,addedByUserRegisterKey:null};this.initWithUserMapObject=function(t){e.setId(t.getKey()),e.setFullName(t.getName()),e.setUserObj(t)},this.setTagId=function(e){s.tagId=e},this.getTagId=function(){return s.tagId},this.setId=function(e){s.userId=e.toString()},this.getId=function(){return s.userId},this.getKey=function(){return s.userId},this.getUser=function(){return t.getUser(s.userId)},this.setFullName=function(e){s.fullName=e},this.getFullName=function(){return s.fullName},this.getPictureUrl=function(){var t;return t=e.getUser().getUserAvatar?o.imBase+e.getUser().getUserAvatar():"images/prof.png"},this.getName=function(){var t;return t=""!==s.fullName?s.fullName:e.getUser()?e.getUser().getName():s.userId},this.getStatus=function(){return s.status},this.getStatusValue=function(){var e;return e=s.status===c.MEMBER_STATUS.ADMIN?"admin":s.status===c.MEMBER_STATUS.MEMBER?"member":"owner"},this.setStatus=function(e){s.status=e},this.setAddedBy=function(e){s.addedBy=e.toString()},this.getAddedBy=function(){return s.addedBy},this.getAddedByUser=function(){return t.getUser(s.addedBy)},this.getAddedByUserName=function(){return!!e.getAddedByUser()&&e.getAddedByUser().getName()},this.setAddedByUserObj=function(e){s.addedByUser=e},this.setUserObj=function(e){s.user=e},this.unregisterUserObjectsListener=function(){n.unregister(s.userRegisterKey),s.userRegisterKey=null,n.unregister(s.addedByUserRegisterKey),s.addedByUserRegisterKey=null},this.initUserObjects=function(){var t,i=e.getUser();s.userRegisterKey||i&&i.hasDetails()||(s.userRegisterKey=n.register(s.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:s.userId,tagId:s.tagId})})),t=e.getAddedByUser(),s.addedByUserRegisterKey||t&&t.hasDetails()||(s.addedByUserRegisterKey=n.register(s.addedBy,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:s.addedBy,tagId:s.tagId})}))},this.isCurrentUser=function(){return e.getId()===i.currentUser().getKey()},this.isAdmin=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.ADMIN},this.isMember=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.MEMBER},this.isOwner=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.OWNER},this.isRemoved=function(){return parseInt(s.status,10)===c.MEMBER_STATUS.REMOVED},this.makeAdmin=function(){s.status=c.MEMBER_STATUS.ADMIN},this.makeMember=function(){s.status=c.MEMBER_STATUS.MEMBER},this.makeOwner=function(){s.status=c.MEMBER_STATUS.OWNER},this.serialize=function(){return{userId:e.getId(),fullName:e.getName().utf8Encode(),status:e.getStatus(),addedBy:e.getAddedBy()}}}function d(){var e=this,i={tagId:0,text:"",hrtime:"",status:"",messageDate:"",isDeleted:!1,messageDateString:"",timeout:0,userId:0,fullName:"",type:0,packetId:0,user:{},seenPacketSent:!1,deliveredPacketSent:!1,statusType:"",seenUsers:[],deliveredUsers:[],usersToChange:{},usersToChangeName:{},tagName:"",allStatusUserFetched:!1,statusUsersFetchCount:0,userRegisterKey:null};this.getTagId=function(){return i.tagId},this.setTagId=function(e){i.tagId=e},this.getHumanReadableTime=function(){return i.hrtime},this.setHumanReadableTime=function(e){i.hrtime=e},this.setFullName=function(e){i.fullName=e.substring(0,127)},this.getFullName=function(){return i.fullName},this.getPacketId=function(){return i.packetId},this.setPacketId=function(e){i.packetId=e},this.getMessageText=function(){return i.text},this.setMessageText=function(e){i.text=e},this.setStatus=function(e){i.status=e},this.getStatus=function(){return i.status},this.setMessageDate=function(e){i.messageDate=e},this.getMessageDate=function(){return i.messageDate},this.markAsDeleted=function(){i.isDeleted=!0},this.unMarkFromDeleted=function(){i.isDeleted=!1},this.getIsDeleted=function(){return i.isDeleted},this.setMessageDateString=function(e){i.messageDateString=e},this.setTimeout=function(e){i.timeout=e},this.setUserId=function(e){i.userId=e},this.getMessageDateString=function(){return i.messageDateString},this.getTimeout=function(){return i.timeout},this.getUserId=function(){return i.userId},this.getUser=function(){return t.getUser(i.userId)},this.getMessageType=function(){return i.type},this.setMessageType=function(e){i.type=e},this.initUserObjects=function(){var t=e.getUser();i.userRegisterKey||t&&t.hasDetails()||(i.userRegisterKey=n.register(i.userId,function(){r.triggerCustomEvent(a.CHAT.TAG_MEMBER_FETCHED,{userId:i.userId,tagId:i.tagId})}))},this.unregisterUserObjectsListener=function(){n.unregister(i.userRegisterKey),i.userRegisterKey=null},this.getSeenPacketSent=function(){return i.seenPacketSent},this.getDeliveredPacketSent=function(){return i.deliveredPacketSent},this.setSeenPacketSent=function(e){i.seenPacketSent=e},this.setDeliveredPacketSent=function(e){i.deliveredPacketSent=e},this.addSeenUserId=function(e){i.seenUsers.push(e)},this.addDeliveredUserId=function(e){i.deliveredUsers.push(e)},this.setUsersToChange=function(e){i.usersToChange=e},this.getUsersToChange=function(){return i.usersToChange},this.setUsersToChangeName=function(e){i.usersToChangeName=e},this.getUsersToChange=function(){return i.usersToChangeName},this.setStatusType=function(e){i.statusType=e},this.getStatusType=function(){return i.statusType},this.getTagName=function(){return i.tagName},this.setTagName=function(e){i.tagName=e},this.serialize=function(){return{tagId:e.getTagId(),userId:e.getUserId(),user:e.getUserId(),packetId:e.getPacketId(),fullName:e.getFullName().utf8Encode(),status:e.getStatus(),statusType:e.getStatusType(),type:e.getMessageType(),hrtime:e.getHumanReadableTime(),messageDate:e.getMessageDate(),isDeleted:i.isDeleted,timeout:e.getTimeout(),text:e.getMessageText().utf8Encode(),seenPacketSent:e.getSeenPacketSent(),deliveredPacketSent:e.getDeliveredPacketSent(),usersToChange:Object.keys(i.usersToChange),allStatusUserFetched:i.allStatusUserFetched,messageType:e.getMessageType(),tag_chat:!0,tagName:e.getTagName()}}}return d.prototype.update=function(e){e.getFullName()&&this.setFullName(e.getFullName()),e.getStatus()&&this.setStatus(e.getStatus()),e.getStatusType()&&this.setStatusType(e.getStatusType()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getMessageDate()&&this.setMessageDate(e.getMessageDate()),e.getMessageText()&&this.setMessageText(e.getMessageText()),e.getUsersToChange()&&this.setUsersToChange(e.getUsersToChange()),e.getMessageType()&&this.setMessageType(e.getMessageType()),e.getSeenPacketSent()&&this.setSeenPacketSent(e.getSeenPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getDeliveredPacketSent()&&this.setDeliveredPacketSent(e.getDeliveredPacketSent()),e.getTimeout()&&this.setTimeout(e.getTimeout()),e.getIsDeleted()&&this.markAsDeleted(),e.getHumanReadableTime()||this.setHumanReadableTime(e.getHumanReadableTime())},{TagObject:l,TagMember:u,TagMessage:d}}var chatApp;chatApp=angular.module("ringid.chat"),chatApp.factory("ChatResponses",ChatResponses),ChatResponses.$inject=["$rootScope","chatHistoryFactory","SystemEvents","Auth","tagChatFactory","ChatFactory","tagChatManager","Utils","userFactory","ChatResponseProcessor","ChatSeenSend","ChatHelper","ChatConnector"];function ChatResponses(e,t,n,r,i,o,a,s,c,l,u,d,g){var m=window.CHAT_APP,E=m.Constants.PACKET_TYPES,f=m.Constants,p=f.GENERAL_CONSTANTS,T=f.CHAT_GLOBAL_VALUES,h=m.ChatRequests,I={};function _(e){return I[e]}function A(e){switch(e){case p.MESSAGE_TYPES.DELETE_MESSAGE:case p.MESSAGE_TYPES.TEXT:case p.MESSAGE_TYPES.EMOTICON_MESSAGE:case p.MESSAGE_TYPES.LOCATION_SHARE:case p.MESSAGE_TYPES.LINK_SHARE:case p.MESSAGE_TYPES.STICKER:case p.MESSAGE_TYPES.IMAGE:case p.MESSAGE_TYPES.CAMERA_IMAGE:case p.MESSAGE_TYPES.AUDIO:case p.MESSAGE_TYPES.VIDEO:case p.MESSAGE_TYPES.RING_MEDIA_MESSAGE:return!0;default:return!1}}function S(e){var t=e.packetType,n=_(t);if(!n)return RingLogger.warning("M: Packet Processor Not Implemented. Packet Type ",t,"CHAT"),!1;try{n.processor.call(this,e)}catch(e){RingLogger.alert("M: Exception In PACKET Procsessing.",t,e,RingLogger.tags.CHAT)}return!0}function C(e){e.userId,e.friendId,e.packetId}function v(e){var t=e.userId,n=(e.friendId,e.onlineStatus,e.userMood,e.packetId,o.getBoxByUId(t));t===n.getKey()&&o.closeChatBox(n.getKey())}function D(e){var t=e.friendId,n=(e.chatBindingPort,e.serverDate),r=(e.packetId,o.getBoxByUId(t));T.serverTime=n,T.serverTimeDiff=Date.now()-n,r||(r=o.creatNonDomBox(t,!1))}function R(e){var t=e.userId,n=(e.friendId,o.getBoxByUId(t));n&&n.setFriendTypingBool(!1)}function M(e){var t,i;e.userId,e.friendId;t=String(e.userId)===String(r.currentUser().getKey())?e.friendId:e.userId,i=o.getBoxByUId(t),i&&(i.setFriendTypingBool(!0),setTimeout(function(){i.setFriendTypingBool(!1),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:t})},3e3))}function N(e){var i,a,d,g,m,E,f,T=e.userId,g=e.friendId,h=e.messageType,I=e.timeout,_=(e.message,e.messageDate),S=(e.isSecretVisible,e.packetId);A(h)&&(i=e.boxId,a=r.currentUser().getKey(),i||(i=T),String(i)===String(a)&&(i=g),i=i.toString(),t.isInLocalStorageChatMsgMap(i,S)||(m=o.getBoxByUId(i),h===p.MESSAGE_TYPES.DELETE_MESSAGE?l.doOnMessageTypeDeleteMessage(i,T,S,e,m):e.messageType>p.MESSAGE_TYPES.BLANK_MESSAGE&&(m?e.fromHistory||m.nonDomBox||(m.nonDomBox=!0,s.triggerCustomEvent(n.CHAT.BOX_OPENNED,{boxId:i})):o.openChatBox(i),m=o.getBoxByUId(i),m.setFriendTypingBool(!1),e.fromHistory&&e.fromOffline||(m&&!m.isFocused&&m.latestSeenMessageDate<=_?(e.status="Unread",d="unread"):e.status=e.status||"Received"),e.fromHistory?"Unread"!==String(e.status)&&(e.seenSent=!0):d="bottom",e.tag_chat=!1,g=m.getKey(),"Edited"!==String(e.status)&&m.isSamePacketId(S)||(e.user=c.create({uId:T,fetchDatails:!1}),"Unread"===String(e.status)&&(o.increaseUnreadMessageCount(i,e.packetId),m.updateUnreadCount()),m.pushMessage(e,T),e.fromHistory||m.isFocused&&(E=p.MESSAGE_TYPES,f=[{key:e.packetId,value:m.getMessage(e.packetId)}],[E.IMAGE,E.AUDIO,E.VIDEO,E.CAMERA_IMAGE,E.RING_MEDIA_MESSAGE].indexOf(h)===-1&&(u.sendSeenPacket(m,f),I>0&&s.triggerCustomEvent(n.CHAT.WAS_FOCUSED,{box:m,filteredMessages:f}))),t.updateBox(m)))))}function y(e){e.userId,e.friendId,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;e.status="Edited",N(e)}function b(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;N(e)}function O(e){e.userId,e.friendId,e.sequenceNo,e.messageType,e.timeout,e.message,e.messageDate,e.isSecretVisible,e.packetId;y(e)}function P(e){e.userId,e.friendId,e.messages,e.packetId}function L(e){var t,n=e.userId,r=e.friendId,i=e.packetId,o=l.getFriendBoxId(n,r),a=l.getFriendBox(o);t=a.getMessage(i),t&&(l.updateMessageStatusToDelivered(o,t),a.sendTabUpdate(t))}function U(e){var t,n=e.userId,r=e.friendId,i=e.packetId,o=l.getFriendBoxId(n,r),a=l.getFriendBox(o);t=a.getMessage(i),t&&(l.updateMessageStatusToDelivered(a.getKey(),t),a.sendTabUpdate(t))}function F(e){var r,i,o,a=e.userId,c=e.friendId,u=(e.messages,e.packetId,l.getFriendBoxId(a,c)),d=l.getFriendBox(u);for(r=0;r<e.messages.length;r++)i=d.getMessage(e.messages[r].packetId),i&&(o=!1,e.messages[r].status===p.MESSAGE_STATUS.DELETED||(e.messages[r].status===p.MESSAGE_STATUS.SEEN?(i.status="Seen",s.triggerCustomEvent(n.CHAT.DO_START_SECRET_TIMER,{boxId:u,others:!1,messages:[{key:e.messages[r].packetId,value:i}]}),o=!0):e.messages[r].status===p.MESSAGE_STATUS.VIEWED&&(i.status="Viewed",s.triggerCustomEvent(n.CHAT.DO_START_SECRET_TIMER,{boxId:u,others:!0,messages:[{key:e.messages[r].packetId,value:i}]}),o=!0)),o&&(t.updateMessage(i,d.getKey()),d.sendTabUpdate(i)))}function w(e){e.userId,e.friendId,e.packetId}function k(e){var n,i,o,a=e.userId,s=e.friendId,c=e.packets,u=(e.packetId,l.getFriendBoxId(a,s)),d=l.getFriendBox(u);for(n=0;n<c.length;n++)i=c[n].packetId,o=d.getMessage(i),o&&(String(a)!==String(r.currentUser().getKey())?(o.messageType=p.MESSAGE_TYPES.DELETE_MESSAGE,o.text="This message has been deleted",o.setTextPartition(),o.status="Deleted"):d.removeMessage(i),t.updateMessage(o,d.getKey()),d.sendTabUpdate(o))}function $(e){var t=e.userId,n=e.friendId;e.packetId,l.getFriendBoxId(t,n)}function G(e){e.userId,e.friendId,e.sequenceNo,e.rawDataByte,e.packetId}function B(e){e.userId,e.friendId,e.sequenceNo,e.packetId}function H(e){e.userId,e.friendId,e.blockUnblockDate,e.isAddToDb,e.packetId}function x(e){e.userId,e.friendId,e.blockUnblockDate,e.packetId}function Y(e){e.userId,e.friendId,e.packetId}function K(e){e.userId,e.tagId,e.packetId}function j(e){e.userId,e.tagId,e.onlineStatus,e.userMood,e.packetId}function V(e){var t=e.tagId,n=(e.chatBindingPort,e.serverDate),r=(e.packetId,o.getBoxByUId(t));T.serverTime=n,T.serverTimeDiff=Date.now()-n,r||(r=o.creatNonDomBox(t,!0))}function W(e){e.userId,e.tagId,e.activityType,e.tagName,e.tagPictureUrl,e.packetId;l.processTagInformation(e)}function q(e){e.userId,e.tagId,e.packetId}function z(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;l.processTagMemberAddUpdate(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function Q(e){e.userId,e.tagId,e.packetId}function X(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;l.processTagMemberRemoveLeave(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function Z(e){var t=e.userId,i=e.tagId;e.packetId;t===r.currentUser().getKey()&&l.doTagUnregisterTask(i),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:i})}function J(e){var t=(e.userId,e.tagId);e.tagMembers,e.packetId;l.processTagMemberStatusChange(e),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function ee(e){e.userId,e.tagId,e.packetId}function te(e){var t=(e.userId,e.tagId),n=o.getBoxByUId(t);n&&n.setFriendTypingBool(!1)}function ne(e){var t,r,a=e.userId,c=e.tagId;t=o.getBoxByUId(c),t&&(r=i.getTag(c),r&&(t.showTypingText(a),setTimeout(function(){t.hideTypingText(),s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c})},3e3)))}function re(e){var r,d,m,E,f=e.userId,T=e.tagId,I=e.messageType,_=(e.message,e.messageDate),S=e.packetId,C=i.getTag(T),v=o.getBoxByUId(T);A(I)&&(T=T.toString(),!e.fromHistory&&t.isInLocalStorageChatMsgMap(T,S)||(C||(r=h.getOfflineGetTagInformationWithMembersObject(T),g.send(r),C=i.getOrCreateTag(T)),I===p.MESSAGE_TYPES.DELETE_MESSAGE?l.doOnMessageTypeDeleteMessage(T,f,S,e,v):I>p.MESSAGE_TYPES.BLANK_MESSAGE&&(v=a.openTagChatBoxIfClosed(T,v),e.fromHistory||(d="bottom"),e.fromHistory&&e.fromOffline||(v&&!v.isFocused&&v.latestSeenMessageDate<=_?(e.status="Unread",d="unread"):e.status=e.status||"Received"),e.tag_chat=!0,v.isSamePacketId(S)||(e.user=c.create({uId:f,fetchDatails:!1}),!e.fromHistory&&C&&C.isTagSafeToShow()&&(v.nonDomBox||(v.nonDomBox=!0,s.triggerCustomEvent(n.CHAT.BOX_OPENNED,{boxId:T}))),e.fromHistory?("Unread"!==String(e.status)&&(e.seenSent=!0),t.removeUnreadMessageInfo(T,S),v.updateUnreadCount()):"Unread"===String(e.status)&&(o.increaseUnreadMessageCount(T,S),v.updateUnreadCount()),v.pushMessage(e,f),e.fromHistory||v.isFocused&&(m=p.MESSAGE_TYPES,E=[{key:e.packetId,value:v.getMessage(e.packetId)}],[m.IMAGE,m.AUDIO,m.VIDEO,m.CAMERA_IMAGE,m.RING_MEDIA_MESSAGE].indexOf(I)===-1&&u.sendSeenPacket(v,E)),t.updateBox(v)))))}function ie(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId;e.status="Edited",re(e)}function oe(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function ae(e){e.userId,e.tagId,e.sequenceNo,e.messageType,e.message,e.messageDate,e.packetId}function se(e){e.userId,e.tagId,e.messageType,e.message,e.messageDate,e.packetId}function ce(e){var n=(e.userId,e.friendId,e.tagId),r=e.packetId,i=l.getTagChatBox(n),o=i.getMessage(r);o&&("Seen"!==o.status&&(o.status="Delivered"),t.updateMessage(o,i.getKey())),t.updateBox(i)}function le(e){var n=e.tagId,r=e.packetId,i=l.getTagChatBox(n),o=i.updateMessageStatus(r,"Sent");o&&t.updateMessage(o,i.getKey()),t.updateBox(i)}function ue(e){var n=(e.userId,e.friendId,e.tagId),r=e.packetId,i=l.getTagChatBox(n),o=i.updateMessageStatus(r,"Seen");o&&t.updateMessage(o,i.getKey()),t.updateBox(i)}function de(e){e.tagId,e.packetId}function ge(e){var t,n=e.userId,r=e.tagId,i=e.packets,o=(e.packetId,l.getTagChatBox(r));if(angular.isArray(i))for(t=0;t<i.length;t++)l.doOnMessageTypeDeleteMessage(r,n,i[t].packetId,null,o)}function me(e){e.userId,e.tagId,e.packetId}function Ee(e){e.userId,e.tagId,e.sequenceNo,e.rawDataByte,e.packetId}function fe(e){e.userId,e.tagId,e.sequenceNo,e.packetId}function pe(e){e.userId,e.friendId,e.fullName,e.onlineStatus,e.friendAppType,e.friendDeviceToken,e.userMood,e.packetId}function Te(e){e.friendId,e.packetId}function he(e){e.userId,e.updateTime,e.blockUnblockDate,e.packetId}function Ie(e){var t=e.serverDate;e.packetId;T.serverTime=t,T.serverTimeDiff=Date.now()-t}function _e(e){var t,n,r=e.messages;e.packetId;for(t=0;t<r.length;t++)n=r[t],n.messageType!==p.MESSAGE_TYPES.DELETE_MESSAGE?n.status="Unread":n.status="Deleted",n.fromOffline=!0,n.fromHistory=!1,N(n)}function Ae(e){e.userId,e.packets,e.packetId}function Se(e){e.userId,e.friendId,e.pageDirection,e.pageLimit,e.packetId}function Ce(e){var t,i,a,c,u=e.friendId,d=e.messages,g=e.pageDirection,m=(e.packetId,r.currentUser().getKey()),E=[],f=o.getBoxByUId(u);if(f||(f=o.creatNonDomBox(u)),d.length||g===p.PAGE_DIRECTION.DOWN){for(i=!1,a=!1,t=0;t<d.length;t++)c=d[t],c.messageType===p.MESSAGE_TYPES.HISTORY_RE_FETCH||c.messageType===p.MESSAGE_TYPES.DELETE_MESSAGE&&String(c.userId)===String(m)||(i=!0,c.userId.toString()===String(m)?(c.status=l.getMessageStatus(c.status)||"Delivered",c.friendId=u):(c.status===p.MESSAGE_STATUS.DELETED?c.status="Deleted":c.status<p.MESSAGE_STATUS.SEEN?c.status="Unread":c.status="Received",c.friendId=m),c.boxId=u,c.fromOffline=!0,c.fromHistory=!0,N(c)),E.push(c.packetId);i&&(f.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:u,noScroll:!0}),s.triggerCustomEvent(n.CHAT.API_HISTROY_PROCESSED,{boxId:u}))}else f.hasHistoryMessage=!1}function ve(e){e.friendId,e.packetId}function De(e){e.userId,e.friendId,e.packets,e.packetId}function Re(e){e.friendId,e.packets,e.packetId}function Me(e){var t=e.tagId,n=(e.noOfItems,e.items),r=e.packetId;n.forEach(function(e){l.processAGroupActivity(t,r,e)})}function Ne(e){var t,r;e.noOfItems,e.items,e.packetId;for(t=0;t<e.items.length;t++)r=i.createNewTag(e.items[t]),i.addTagObject(r);s.triggerCustomEvent(n.CHAT.MY_TAG_LIST_RECEIVED,{tagId:r.getTagId()})}function ye(e){var t,n;e.messages,e.packetId;for(t=0;t<e.messages.length;t++)n=e.messages[t],n.messageType!==p.MESSAGE_TYPES.DELETE_MESSAGE?n.status="Unread":n.status="Deleted",n.fromUnread=!0,n.fromOffline=!0,n.messageType===p.MESSAGE_TYPES.GROUP_ACTIVITY?l.processGroupActivityMessage(n):re(n)}function be(e){e.userId,e.packets,e.packetId}function Oe(e){e.userId,e.tagId,e.tagName,e.tagPictureUrl,e.tagMembers,e.packetId}function Pe(e){e.tagId,e.packetId}function Le(e){e.userId,e.tagId,e.pageDirection,e.pageLimit,e.packetId}function Ue(e){var t,i,o,a,c=e.tagId,u=e.messages,d=e.pageDirection,g=(e.packetId,r.currentUser().getKey()),m=l.getTagChatBox(c);if(u.length||d===p.PAGE_DIRECTION.DOWN){for(i=!1,o=0;o<u.length;o++)a=u[o],a.tagId=c,a.fromHistory=!0,a.fromOffline=!0,a.messageType===p.MESSAGE_TYPES.GROUP_ACTIVITY?(t=!0,l.processGroupActivityMessage(a)):a.messageType===p.MESSAGE_TYPES.HISTORY_RE_FETCH||a.messageType===p.MESSAGE_TYPES.DELETE_MESSAGE&&String(a.userId)===String(g)||(t=!0,a.status===p.MESSAGE_STATUS.DELETED?a.status="Deleted":String(a.userId)===String(r.currentUser().getKey())?a.status="Seen":a.status="Received",re(a));t&&(m.hasHistoryMessage=!0,s.triggerCustomEvent(n.CHAT.BOX_UPDATED,{boxId:c,noScroll:!0}),s.triggerCustomEvent(n.CHAT.API_HISTROY_PROCESSED,{boxId:c}))}else m.hasHistoryMessage=!1}function Fe(e){e.userId,e.tagId,e.packetId}function we(e){var t=e.tagId,r=(e.tagName,e.tagPictureUrl,e.tagMembers),o=(e.packetId,i.getOrCreateTag(t,e));e.tagMembersCount=r.length,l.addMembersToTagObject(o,e.tagMembers),s.triggerCustomEvent(n.CHAT.TAG_LIST_UPDATED,{tagId:t})}function ke(e){e.tagId,e.packetId}function $e(e){e.sequenceNo,e.rawDataByte,e.packetId}function Ge(e){e.sequenceNo,e.rawDataByte,e.userId,e.packetId}function Be(e){e.userId,e.sequenceNo,e.packetId}return I[E.FRIEND_CHAT_REGISTER]={processor:C},I[E.FRIEND_CHAT_UNREGISTER]={processor:v},I[E.FRIEND_CHAT_REGISTER_CONFIRMATION]={processor:D},I[E.FRIEND_CHAT_IDLE]={processor:R},I[E.FRIEND_CHAT_TYPING]={processor:M},I[E.FRIEND_CHAT_MSG]={processor:N},I[E.FRIEND_CHAT_MSG_EDIT]={processor:y},I[E.FRIEND_CHAT_BROKEN_MSG]={processor:b},I[E.FRIEND_CHAT_BROKEN_MSG_EDIT]={processor:O},I[E.FRIEND_CHAT_MULTIPLE_MSG]={processor:P},I[E.FRIEND_CHAT_DELIVERED]={processor:L},I[E.FRIEND_CHAT_SENT]={processor:U},I[E.FRIEND_CHAT_SEEN]={processor:F},I[E.FRIEND_CHAT_SEEN_CONFIRMATION]={processor:w},I[E.FRIEND_CHAT_MULTIPLE_MSG_DELETE]={processor:k},I[E.FRIEND_CHAT_MSG_DELETE_CONFIRMATION]={processor:$},I[E.FRIEND_CHAT_BROKEN]={processor:G},I[E.FRIEND_CHAT_BROKEN_CONFIRMATION]={processor:B},I[E.FRIEND_CHAT_BLOCK]={processor:H},I[E.FRIEND_CHAT_UNBLOCK]={processor:x},I[E.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={processor:Y},I[E.TAG_CHAT_TAG_REGISTER]={processor:K},I[E.TAG_CHAT_TAG_UNREGISTER]={processor:j},I[E.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={processor:V},I[E.TAG_CHAT_TAG_INFORMATION]={processor:W},I[E.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={processor:q},I[E.TAG_CHAT_TAG_MEMBER_ADD]={processor:z},I[E.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={processor:Q},I[E.TAG_CHAT_MEMBER_REMOVE_LEAVE]={processor:X},I[E.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={processor:Z},I[E.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={processor:J},I[E.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={processor:ee},I[E.TAG_CHAT_IDLE]={processor:te},I[E.TAG_CHAT_TYPING]={processor:ne},I[E.TAG_CHAT_MSG]={processor:re},I[E.TAG_CHAT_MSG_EDIT]={processor:ie},I[E.TAG_CHAT_BROKEN_MSG]={processor:oe},I[E.TAG_CHAT_BROKEN_MSG_EDIT]={processor:ae},I[E.TAG_CHAT_MULTIPLE_MSG]={processor:se},I[E.TAG_CHAT_DELIVERED]={processor:ce},I[E.TAG_CHAT_SENT]={processor:le},I[E.TAG_CHAT_SEEN]={processor:ue},I[E.TAG_CHAT_SEEN_CONFIRMATION]={processor:de},I[E.TAG_CHAT_MULTIPLE_MSG_DELETE]={processor:ge},I[E.TAG_CHAT_MSG_DELETE_CONFIRMATION]={processor:me},I[E.TAG_CHAT_GENERAL_BROKEN_PACKET]={processor:Ee},I[E.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={processor:fe},I[E.OFFLINE_FRIEND_INFORMATION]={processor:pe},I[E.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={processor:Te},I[E.OFFLINE_GET_REQUEST]={processor:he},I[E.OFFLINE_GET_REQUEST_CONFIRMATION]={processor:Ie},I[E.OFFLINE_FRIEND_UNREAD_MESSAGE]={processor:_e},I[E.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={processor:Ae},I[E.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={processor:Se},I[E.OFFLINE_FRIEND_HISTORY_MESSAGE]={processor:Ce},I[E.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={processor:ve},I[E.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={processor:De},I[E.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={processor:Re},I[E.OFFLINE_TAG_INFORMATION_ACTIVITY]={processor:Me},I[E.OFFLINE_MY_TAG_LIST]={processor:Ne},I[E.OFFLINE_TAG_UNREAD_MESSAGE]={processor:ye},I[E.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={processor:be},I[E.OFFLINE_TAG_CREATE_TAG]={processor:Oe},I[E.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={processor:Pe},I[E.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={processor:Le},I[E.OFFLINE_TAG_HISTORY_MESSAGE]={processor:Ue},I[E.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={processor:Fe},I[E.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={processor:we},I[E.OFFLINE_TAG_CONFIRMATION]={processor:ke},I[E.OFFLINE_BROKEN_HISTORY_PACKET]={processor:$e},I[E.OFFLINE_BROKEN_PACKET]={processor:Ge},I[E.OFFLINE_BROKEN_PACKET_CONFIRMATION]={processor:Be},{processUpdates:S}}angular.module("ringid.chat").factory("ChatAuthResponses",ChatAuthResponses),ChatAuthResponses.$inject=["$rootScope","tagChatFactory","ChatFactory","ChatPacketSenderService","userFactory","friendsFactory","chatRequestProcessor","chatHistoryFactory","ChatWorkerCommands","Auth","ChatConnector"];function ChatAuthResponses(e,t,n,r,i,o,a,s,c,l,u){var d=CHAT_APP.Constants,g=d.GENERAL_CONSTANTS.SESSION_TYPES,m=d.RESPONSE_REASON_CODES,E=CHAT_APP.Constants.AUTH_SERVER_ACTIONS,f=d.GENERAL_CONSTANTS.USER_PRESENCE,p=CHAT_APP.ChatRequests,T=function(e){var t=n.getBoxByUId(e);return t||(t=n.creatNonDomBox(e,!1)),t},h={};function I(e){return h[e]}function _(e){var t,n;if(1111===e.rc)return RingLogger.alert("M: Auth Request Failed",e,RingLogger.tags.CHAT),!1;if(t=e.actn,n=I(t),!n)return RingLogger.warning("Packet Processor Not Implemented. Action Id ",t,RingLogger.tags.CHAT),!1;try{n.processor.call(this,e)}catch(e){RingLogger.alert("Exception In PACKET Procsessing.",t,e,RingLogger.tags.CHAT)}return!0}function A(e){var r,i,o=e.tid,a=t.getTag(o);RingLogger.print("M: Received Auth TAG CHAT Start",e,RingLogger.tags.CHAT),a?a=t.getOrCreateTag(o):(r=n.getBoxByUId(o),r||(r=n.creatNonDomBox(o,!0)),i=p.getOfflineGetTagInformationWithMembersObject(o),u.request(i).then(function(e){e.sucs&&(a=t.getTag(o),a&&c.startChatSession(o,g.TAG,a.getMemberUserIds()))}))}function S(e){var r,i,o=e.tid,a=t.getTag(o);RingLogger.print("M: Received Auth Add Member ",e,RingLogger.tags.TAG_CHAT),a?(a=t.getOrCreateTag(o),c.startChatSession(o,g.TAG),e.uIds?angular.forEach(e.uIds,function(e){a.addMember(t.createNewTagMember(a.getTagId(),{userId:e},!0))}):RingLogger.error("No Member Info Send Via Auth Update",e,RingLogger.tags.TAG_CHAT)):(r=n.getBoxByUId(o),r||(r=n.creatNonDomBox(o,!0)),i=p.getOfflineGetTagInformationWithMembersObject(o),u.request(i,10).then(function(e){e.sucs&&(a=t.getTag(o))}))}function C(e){var t,n,r,c=e.fndId,u=c;RingLogger.print("M: Received Auth F2F CHAT Start",e,RingLogger.tags.CHAT),String(u)!==String(l.currentUser().getKey())&&(t=T(u),t.platform=e.dvc,n=i.create({uId:e.fndId,utId:e.utId,fn:e.nm}),o.getContactDetailsByUtIds([e.utId]),r=n.getOnlineStatus(),n.setOnlineStatus(e.psnc),e.mood&&n.setUserMood(e.mood),e.dt&&n.setDeviceToken(e.dt),e.apt&&n.setAppType(e.apt),e.dvc&&n.setPlatform(e.dvc),r!==n.getOnlineStatus()&&a.sendFriendInformation(n),e.sucs===!0&&e.psnc===f.ONLINE?t.offlineStatus=!1:e.rc===m.PERMISSION_DENIED?t.blocked=!0:t.offlineStatus=!0,s.updateBox(t))}function v(e){C(e)}function D(){}function R(e){var t;RingLogger.debug("M: Received Auth USER_MOOD_PRESENCE",e,RingLogger.tags.CHAT),e.fndId?(t=i.getUser(e.fndId),t&&(e.psnc&&t.setOnlineStatus(e.psnc),e.mood&&t.setUserMood(e.mood),e.dvc&&t.setPlatform(e.dvc))):RingLogger.alert("FriendID not present in 199 Response",e,RingLogger.tags.CHAT)}return h[E.START_F2F_CHAT]={processor:v},h[E.GET_USER_MOOD_PRESENCE]={processor:R},h[E.START_TAG_CHAT]={processor:D},h[E.RECEIVED_TAG_CHAT]={processor:A},h[E.ADD_TAG_CHAT_MEMBERS]={processor:S},h[E.RECEIVED_F2F_CHAT]={processor:C},{processUpdates:_}}angular.module("ringid.chat").controller("ChatController",ChatController),ChatController.$inject=["$scope","$rootScope","ChatFactory","ChatHelper","chatRequestProcessor","ChatUtilsFactory","ChatResponses","ChatAuthResponses","settings","SystemEvents","friendsFactory","ChatPacketSenderService","chatTabSync","Utils","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","$location","ChatConnector","ChatWorkerCommands"];function ChatController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T,h,I,_,A){var S,C,v,D,R,M,N=CHAT_APP.Constants,y=N.GENERAL_CONSTANTS,b=y.SESSION_TYPES,O=!1;e.boxes=n.getBoxes(),e.$on("chatDataReceived",function(t,n){a.processUpdates(n.jsonData),m.safeDigest(e)}),e.$on("authDataReceived",function(t,n){s.processUpdates(n.jsonData),m.safeDigest(e)}),e.domBoxLength=function(){for(v=0,D=0;D<e.boxes.length;D++)e.boxes[D].value.nonDomBox===!0&&v++;return v>10&&(v=10),v},e.availableNo=n.getNumberOfAvailableChatBox(),e.getProfileLink=c.baseUrl+"/#/profile/",e.gotoprofile=function(e,t){I.path(t),e.stopPropagation()},e.contactListAction=function(t){t.friend.isLoading()||(u.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()}),e.$rgDigest())},e.$on(l.COMMON.WINDOW_RESIZED,function(t,r){e.availableNo=n.getNumberOfAvailableChatBox(r.x),m.safeDigest(e)}),R=m.onCustomEvent(l.CHAT.TAB_SYNC_NEW_DATA,function(e){RingLogger.information("TAB SYNC DATA",e,RingLogger.tags.TAB_DATA_RECEIVED),e.type===y.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE?(n.refreshBox(e.boxId),m.triggerCustomEvent(l.CHAT.BOX_UPDATED,{boxId:e.boxId})):e.type===y.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE&&(E.loadChatBoxes(),n.openAndAddMessage(e.boxId,e.msg))});function P(){e.$on("NET_SUCCESS",function(){RingLogger.alert("NET WAS DISCONNECTED, REQUESTING OFFLINE MESSAGES",RingLogger.tags.CHAT),i.getUnreadMessagesMultipleTimes()}),window.addEventListener("online",function(){window.navigator.onLine&&(RingLogger.alert("Browser Gets Online From Offline",RingLogger.tags.CHAT),i.getUnreadMessagesMultipleTimes())})}function L(){o.hasOfflineIpPort()?i.getUnreadMessagesMultipleTimes():d.doUpdateOfflineIpPort().then(function(){i.getUnreadMessagesMultipleTimes()})}function U(){var e=E.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t){var r,i=e[t];i.isTagChat||(n.openChatBox(i.boxId),r=n.getBoxByUId(i.boxId),M=E.getBox(i.boxId),angular.extend(r,M),A.startChatSession(i.boxId,b.FRIEND))})}function F(){var e=E.getAllOpenBoxes();e&&Object.keys(e).forEach(function(t){var n=e[t];n.isTagChat&&h.openPreviouslyOpenedBoxes(n.boxId)})}function w(){try{_.initiate(),E.init(),g.init(),L(),P(),S=m.onCustomEvent(l.FRIEND.UTID_LIST_RECEIVED,function(){U()}),C=m.onCustomEvent(l.CHAT.MY_TAG_LIST_RECEIVED,function(){F()})}catch(e){RingLogger.alert("Chat App Init Error",e,RingLogger.tags.CHAT)}}function k(){t.$on("FIRST_FEED_RECEIVED",function(){O||(O=!0,w())}),setTimeout(function(){O||(O=!0,w())},6e3)}T.isLoggedIn()?k():e.$on(l.AUTH.LOGIN,function(e,t){t===!0&&k()}),e.$on("$destroy",function(){m.removeCustomEvent(l.CHAT.TAB_SYNC_NEW_DATA,R),m.removeCustomEvent(l.FRIEND.UTID_LIST_RECEIVED,S),m.removeCustomEvent(l.CHAT.MY_TAG_LIST_RECEIVED,C)})}angular.module("ringid.chat").controller("ChatHistoryController",ChatHistoryController),ChatHistoryController.$inject=["$scope","$rootScope","ChatFactory","Storage","Auth","Api","tagChatFactory","userFactory","Utils","chatHistoryFactory","$$stackedMap","SystemEvents","rgScrollbarService"];function ChatHistoryController(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E,f,p,T=CHAT_APP.Constants,h=T.GENERAL_CONSTANTS,I=CHAT_APP.SharedHelpers;e.selectedLeftBox={key:0,messages:[]},e.boxes=u.createNew(!0),e.recentMessages=u.createNew(!0),e.ready=t.chatHistoryReady||!1,e.selectLeftBox=function(t){e.selectedLeftBox=t};function _(e){var t=I.getClientTimeFromServerTime(e),n=c.verbalDate(t);return n}e.getMessageTime=_;function A(t,n){n&&(t.user=s.create({uId:n}),t.user.requestUserDetails().then(function(){e.$rgDigest()}))}function S(e){var t;return t=e.statusType?"Activity message":e.messageType===h.MESSAGE_TYPES.PLAIN_MESSAGE?e.text:"Received media message."}function C(e){var t;return t="Unread"===String(e.status)||"Received"===String(e.status)&&!e.seenSent}function v(e){return l.getUnreadMessageCountByBoxId(e.key)}function D(e){var t=angular.copy(e);return t.date=_(t.messageDate),t.isUnread=function(){return C(t)},t.messageText=function(){return S(t)},t.user.getKey&&A(t,t.user),t.isSelf=function(){return String(e.userId)===String(i.currentUser().getKey())},t}function R(e){var t=!1;return e.messages&&e.messages.length>0&&(e.messages.sort(function(e,t){return e.messageDate>t.messageDate?1:e.messageDate<t.messageDate?-1:0}),t=e.messages[e.messages.length-1]),
t}function M(t){var n,r=l.getChatBoxes(),i=r[t],o=e.boxes.get(t);o&&(o.messages=i.messages,n=R(o),n&&(o.lastMessage=D(n)))}function N(e){var t,n,r=angular.copy(e),i=R(r);return i&&(r.lastMessage=D(i)),r.unreadCount=function(){return v(e)},r.sortBy=function(){return this.lastMessage.messageDate},r.isTagChat?(t=e.key,n=a.getTag(t),r.getTitle=function(){return n=a.getTag(t),n?n.getTagName():""},r.getCover=function(){return n=a.getTag(t),n?n.getPictureFullUrl():""},r.shouldVisible=function(){return n=a.getTag(t),!!n&&n.isTagSafeToShow()}):(A(r,r.key),r.getTitle=function(){return r.user.getName()},r.getCover=function(){return r.user.avatar("thumb")},r.shouldVisible=function(){return!0}),r}e.initBoxMessages=function(t){var n;t.messages&&angular.forEach(t.messages,function(t){n=D(t),e.recentMessages.add(n.key,n)})},e.initRecentMessages=function(){var t=l.getChatBoxes();t&&angular.forEach(t,function(t){var n=N(t);n.lastMessage&&e.boxes.add(t.key,n)})},e.clearRecentMessages=function(){e.recentMessages.clear()},e.openChatBox=function(e,t){c.triggerCustomEvent(d.CHAT.UNREAD_MESSAGE_INFO_UPDATED),t?n.openTagChatBox(e):n.openChatBox(e)},e.initRecentMessages(),t.chatHistoryReady||setTimeout(function(){e.ready=!0,t.chatHistoryReady=!0,e.$rgDigest(),g.recalculate(e)},3e3),m=c.onCustomEvent(d.CHAT.MY_TAG_LIST_RECEIVED,function(){c.safeDigest(e)}),E=c.onCustomEvent(d.CHAT.TAG_LIST_UPDATED,function(){c.safeDigest(e)}),f=c.onCustomEvent(d.CHAT.MESSAGE_RECEIVED,function(t){M(t.boxId),c.safeDigest(e)}),p=c.onCustomEvent(d.CHAT.MESSAGE_SUBMITTED,function(t){M(t.boxId),c.safeDigest(e)}),e.$on("$destroy",function(){c.removeCustomEvent(d.CHAT.MY_TAG_LIST_RECEIVED,m),c.removeCustomEvent(d.CHAT.TAG_LIST_UPDATED,E),c.removeCustomEvent(d.CHAT.MESSAGE_SUBMITTED,p),c.removeCustomEvent(d.CHAT.MESSAGE_RECEIVED,f)})}angular.module("ringid.chat").controller("ChatMediaUploadController",ChatMediaUploadController),ChatMediaUploadController.$inject=["$scope","fileUploadService","Utils","$boxInstance","localData","SystemEvents"];function ChatMediaUploadController(e,t,n,r,i,o){e.navSection=0,e.sendMedia=function(){var a;e.capturedMedia&&i.boxId&&(a=t.queueFile("chatimage",n.dataURLToBlob(e.capturedMedia)),n.triggerCustomEvent(o.CHAT.BOX_CAM_UPLOAD,{uploadFile:a,boxId:i.boxId}),r.close())}}angular.module("ringid.chat").controller("TagChatController",TagChatController),TagChatController.$inject=["$scope","$templateCache","$timeout","settings","$$connector","routeService","Auth","Ringalert","rgDropdownService","ChatFactory","Utils","tagChatStorage","friendsFactory","tagChatFactory","tagChatManager","chatRequestProcessor","ChatHelper","SystemEvents"];function TagChatController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T){var h,I=this,_=a.currentUser();I.chatRoute=o.getRoute("CHAT_GROUPS"),I.memberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html",I.memberDDActions=v,I.getTagDDControl=A,I.allTags=m.getTags(),I.ready=I.allTags.length()>0,I.groupFilter="groups",I.debug=!1,I.isCurrentUserOwner=function(e){return String(e.getOwnerUserId())===String(_.getKey())},I.isCurrentUserMember=function(e){return e.isUserMember(_.getKey())},I.allTags=m.getTags(),I.changeGroupFilter=function(e){I.groupFilter=e||"groups"},I.showGroupLogs=function(){return"logs"===I.groupFilter},I.showGroups=function(){return"groups"===I.groupFilter},I.getTagPictureImageByMemberAvatars=S,I.getLastMessageOnATag=C,I.imageBase=r.imBase,I.getUserAvatar=function(e){var t;return t=e&&e.avatar()?e.avatar():"images/prof.png"},I.getLastMessageText=function(e){return 2===e.messageType?e.text:[6,7,8,9].indexOf(e.messageType)!==-1&&"Media"},e.shouldShow=function(){return I.ready},e.showSingleMemberAlert=function(){s.show({mg:"Please add a member before leaving the group."},"info")},h=u.onCustomEvent(T.CHAT.TAG_LIST_UPDATED,function(){I.allTags=m.getTags(),I.ready=!0,u.safeDigest(e)});function A(e){return{tagId:e.getTagId(),isOwner:I.isCurrentUserOwner(e)}}function S(e){var t,n,r,i=[],o=e.getMembersObjectMap().all(),a=0;for(n=0;n<o.length&&a<3;n++)t=o[n].value,r=t.getPictureUrl(),""!==r&&(i.push(r),a++);return i}function C(e){var t=d.getLastMessageByTag(e.getTagId());return!!t&&t.value}function v(t){var n,r;switch(t.action){case"edit":case"view":c.close(),r=function(){return{tagId:t.tagId}};break;case"delete":c.close(),n=m.getTag(t.tagId),n.setObjectLock(),E.leaveFromTag(t.tagId,_.getKey()).then(function(){n.removeObjectLock(),e.$rgDigest()},function(t){n.removeObjectLock(),s.show(t,"error"),e.$rgDigest()}),e.$rgDigest();break;default:RingLogger.print("Err. no matching action",RingLogger.tags.CHAT)}return r}e.$on("$destroy",function(){u.removeCustomEvent(T.CHAT.TAG_LIST_UPDATED,h)})}angular.module("ringid.chat").controller("TagChatPopupController",TagChatPopupController),TagChatPopupController.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","profileFactory","rgScrollbarService","CHAT_LANG","SystemEvents"];function TagChatPopupController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p){var T,h,I=f.TAG,_=i.currentUser().getKey(),A=CHAT_APP.Constants.GENERAL_CONSTANTS,S={};t.state={loading:!1,noData:!1},t.friends=c.getFriends("friends"),t.friendName="",t.editMode=!1,t.addToTag=L,t.removeMember=U,t.createChatTag=y,t.updateChatTag=O,t.loadMoreFriends=N,t.cancel=$,t.validateTag=G,t.newOwnerTagMember=!1,t.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:a.generateNewTagId()},t.uploading=!1,t.selectNewOwner=k,t.setNewOwner=w,t.isMemberSelected=F,t.canRemoveMember=R,t.canUpdateTagInfo=M,t.getPicturePreviewUrl=function(){return g.tagChatImBase+t.models.pictureUrl},t.contactListAction=function(e){e.friend.isLoading()||(c.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())},t.uploadAction=function(e){e.uploadFile.fetchMeta(function(){t.models.pictureUrl=e.uploadFile.getPreview(),t.uploading=!0,d.safeDigest(t),e.uploadFile.initUpload().then(function(e){t.uploading=!1,t.models.pictureFileName=e.iurl,t.models.pictureUrl=g.imBase+e.url,d.safeDigest(t)},function(){t.uploading=!1})})};function C(){t.memberList=r.createNew(),t.adminList=r.createNew()}l&&l.tagId?(t.tag=a.getTag(l.tagId),S=t.memberList,T=t.tag.getMembersObjectMap(),T?(t.memberAdminList=T.copy(),C(),t.tag.initMemberObjects(),angular.forEach(t.memberAdminList.all(),function(e){e.value.isMember()?t.memberList.add(e.key,e.value):t.adminList.add(e.key,e.value)})):C(),t.models.tagName=t.tag.getTagName(),t.models.popupTitle="Update Group chat",t.models.pictureUrl=t.tag.getPictureFullUrl(),t.models.pictureFileName=t.tag.getPictureUrl(),t.editMode=!0):C(),h=d.onCustomEvent(p.CHAT.TAG_MEMBER_FETCHED,function(){t.$rgDigest()}),t.$watch(function(){return t.friends.length()-t.adminList.length()-t.memberList.length()},function(e){e<10&&N()});function v(e){return!!e&&e.getOwnerUserId()===i.currentUser().getKey()}function D(){return!0}function R(e){var n;if(e.getId()===_)return!1;if(t.tag&&!v(t.tag)){if(n=e.getAddedBy()!==i.currentUser().getKey(),t.tag.isCurrentUserStatusAdmin(_)&&!e.isMember())return!1;if(t.tag.isCurrentUserStatusMember(_)&&n)return!1}return!0}function M(){return!t.editMode||!t.tag.isCurrentUserStatusMember(_)}t.$watch("friendName",function(e){e&&e.length>1&&(P(!0),c.searchContact({schPm:e},!0).then(function(){t.friends=c.getFriends("friends"),P(!1)},function(){P(!1)}))});function N(){t.state.loading||t.friends.length()===c.totalFriends("friends")||(P(!0),c.getContactDetails().then(function(){t.friends=c.getFriends("friends"),P(!1)},function(){P(!1)}),setTimeout(function(){t.state.loading=!1},3e3))}function y(){var e,r,i,o,a;return G()?(e=t.models.tagName,r=t.memberList.keys(),i=t.adminList.keys(),o=t.models.tagId,a=t.models.pictureFileName,s.createTag({tagName:e,memberUIds:r,adminUIds:i,tagId:o,tagPictureUrl:a}).then(function(){},function(){u.show(I.DEFAULT_FAILURE_MESSAGE,"error")},function(){}),void n.close()):void d.safeDigest(t)}function b(){var e=a.getTag(t.tag.getTagId());e.removeObjectLock()}function O(){var e,r,i,o,c;return G()?(e=a.getTag(t.tag.getTagId()),r=t.models.tagName,i=t.models.pictureFileName,o=t.memberList.keys(),c=t.adminList.keys(),t.tag.setObjectLock(),s.updateTag(e,r,i,o,c).then(function(){b(t.tag.getTagId())},function(){b(t.tag.getTagId()),u.show(I.DEFAULT_FAILURE_MESSAGE,"error")},function(e){e.sucs&&b(t.tag.getTagId())}),t.editMode=!1,d.triggerCustomEvent(p.CHAT.MY_TAG_LIST_RECEIVED),void n.close()):void d.safeDigest(t)}function P(n){e(function(){t.state.loading=n,n||E.recalculate(t)})}function L(e,n){var r,i;return t.memberList.length()+t.adminList.length()>t.friends.length()-10&&N(),r=t.tag?t.tag.getTagId():t.models.tagId,i=a.createNewTagMember(r,{status:"member"===String(n)?A.MEMBER_STATUS.MEMBER:A.MEMBER_STATUS.ADMIN,addedBy:_},!1),D(i)?(t.tag&&i.setTagId(t.tag.getTagId()),i.initWithUserMapObject(e),"admin"===n?t.adminList.add(i.getId(),i):t.memberList.add(i.getId(),i),void d.safeDigest(t)):void u.show("Permission Denied","error")}function U(e){R(e)?(e.isAdmin()?t.adminList.remove(e.getId()):t.memberList.remove(e.getId()),d.safeDigest(t)):u.show("Permission Denied","error")}function F(e){return t.newOwnerTagMember&&e.getId()===t.newOwnerTagMember.getId()}function w(e){t.newOwnerTagMember=e,d.safeDigest(t)}function k(){var e,r,o,a,c=t.newOwnerTagMember,l=t.tag;t.newOwnerTagMember=!1,e=c.getStatus(),c.makeOwner(),r=l.getMember(i.currentUser().getKey()),r.makeMember();function g(){c.setStatus(e),r.makeOwner(),l.removeObjectLock()}o=[c.serialize(),r.serialize()],a=[c,r],l.setObjectLock(),s.changeTagMemberStatus(l.getTagId(),o,a).then(function(){s.leaveFromTag(l.getTagId()).then(function(){l.removeObjectLock()},function(){u.show(I.DEFAULT_FAILURE_MESSAGE,"error"),g()})},function(){u.show(I.DEFAULT_FAILURE_MESSAGE,"error"),g()}),d.safeDigest(t),n.close()}function $(){t.newOwnerTagMember=!1,n.close(),d.safeDigest(t)}function G(){var e;return t.models.tagName.length>100?t.models.errTagName="Maximum 100 alpha numeric characters":t.models.errTagName="",t.memberList.length()+t.adminList.length()<2?t.models.errMemberList=!0:t.models.errMemberList=!1,e=!t.models.errMemberList&&!t.models.errTagName}t.$on("$destroy",function(){d.removeCustomEvent(p.CHAT.TAG_MEMBER_FETCHED,h),t.tag&&t.tag.unregisterMemberObjectsListener()})}!function(){"use strict";angular.module("ringid.chat").controller("TagChatMemberPageController",e),e.$inject=["$timeout","$scope","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","$routeParams","Ringalert","Utils","settings","profileFactory","rgScrollbarService","CHAT_LANG","$location","ChatConnector","SystemEvents","rgDropdownService"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T,h){var I,_,A,S,C,v=r.currentUser(),D=r.currentUser().getKey(),R=E.TAG,M=CHAT_APP.ChatRequests,N=c.tagId;N&&parseInt(N,10)||f.path("/"),t.tag=o.getTag(N),t.memberDDHtml="templates/partials/tag-chat/list-page/member-actions-dropdown.html",t.memberDDActions=V,t.getDDControl=$,t.selectNewOwner=H,t.isCurrentUserOwner=P,t.canRemoveMember=F,t.canChangeType=w,t.hasUserActions=k,t.getUserTypeToChange=L,t.leaveTag=Y,t.isPageReady=!1,t.uploading=!1,t.models={pictureUrl:"/images/default_cover.jpg",pictureFileName:""},t.uploadAction=function(e){switch(e.action){case"groupchatcover":e.uploadFile.fetchMeta(function(){t.models.pictureUrl=e.uploadFile.getPreview(),t.uploading=!0,u.safeDigest(t),e.uploadFile.initUpload().then(function(e){t.uploading=!1,t.models.pictureFileName=e.url,t.models.pictureUrl=d.imBase+e.url,u.safeDigest(t),a.updateTagInformation(t.tag,t.tag.getTagName(),t.models.pictureFileName).then(function(){},function(){l.show(R.DEFAULT_FAILURE_MESSAGE,"error"),u.safeDigest(t)})},function(){t.uploading=!1})});break;case"groupchatprofile":break;default:RingLogger.warning("Case Mismatch",RingLogger.tags.CHAT)}},t.tag?(t.isPageReady=!0,O()):I=u.onCustomEvent(T.CHAT.MY_TAG_LIST_RECEIVED,function(){C=M.getOfflineGetTagInformationWithMembersObject(N),p.request(C).then(function(e){e.sucs&&(t.tag=o.getTag(N),t.isPageReady=!0,O())})}),t.showBack=b;function y(){f.path("/chat/groups")}function b(e,n){var r=n.target.getAttribute("data-is-anchor");r||(t.showBackKey=e,n.preventDefault(),n.stopPropagation(),t.$rgDigest())}function O(){t.memberAdminList=t.tag.getMembersObjectMap(),t.tag.initMemberObjects(),t.models.pictureUrl=t.tag.getPictureFullUrl()}function P(){return t.tag.getOwnerUserId()===v.getKey()}function L(e){return e.isOwner()||e.isAdmin()?{text:"Remove from admin",type:"member"}:{text:"Add as admin",type:"admin"}}function U(e){if(t.tag&&!P(t.tag)){if(_=e.getAddedBy()===D,t.tag.isCurrentUserStatusAdmin(D)&&e.isAdmin()&&!_)return!1;if(t.tag.isCurrentUserStatusMember(D)&&!_&&(e.isAdmin()||e.isMember()&&!_))return!1}return!0}function F(e){return e.getId()!==D&&!e.isOwner()&&U(e)}function w(e){return(e.getId()!==D||!e.isMember())&&U(e)}function k(e){return w(e)||F(e)}function $(e){var n=e.isAdmin()?"member":"admin";return{tagId:t.tag.getTagId(),aMember:e,canRemoveMember:F,memberTypeToChange:n}}function G(e){var t=o.getTag(e);t&&t.removeObjectLock()}function B(e,t,n,r){t.setStatus(r),n.makeOwner(),e.removeObjectLock()}function H(){var e,n,i,o,s=t.newOwnerTagMember,c=t.tag;t.newOwnerTagMember=!1,e=s.getStatus(),s.makeOwner(),n=c.getMember(r.currentUser().getKey()),n.makeMember(),i=[s.serialize(),n.serialize()],o=[s,n],c.setObjectLock(),a.changeTagMemberStatus(c.getTagId(),i,o).then(function(){a.leaveFromTag(c.getTagId()).then(function(){c.removeObjectLock(),y(c.getTagId())},function(){l.show(R.DEFAULT_FAILURE_MESSAGE,"error"),B(c,s,n,e)})},function(){l.show(R.DEFAULT_FAILURE_MESSAGE,"error"),B(c,s,n,e)}),u.safeDigest(t)}function x(e){t.tag.setObjectLock(),a.removeTagMembers(t.tag,[e.serialize()],[e]).then(function(){G(t.tag.getTagId()),t.$rgDigest()},function(){G(t.tag.getTagId()),t.$rgDigest(),l.show(R.DEFAULT_FAILURE_MESSAGE,"error")}),t.$rgDigest()}function Y(){var e=t.tag.getMember(r.currentUser().getKey());t.tag.setObjectLock(),a.removeTagMember(t.tag.getTagId(),[e.serialize()],[e]).then(function(e){G(t.tag.getTagId()),l.show(e,"info"),y()},function(){G(t.tag.getTagId()),t.$rgDigest(),l.show(R.DEFAULT_FAILURE_MESSAGE,"error")}),t.$rgDigest()}function K(e,t){"admin"===t?e.makeAdmin():e.makeMember()}function j(e,n){var r=e.getStatusValue();K(e,n),t.tag.setObjectLock(),a.changeTagMemberStatus(t.tag.getTagId(),[e.serialize()],[e]).then(function(){G(t.tag.getTagId()),t.$rgDigest()},function(){G(t.tag.getTagId()),K(e,r),l.show(R.DEFAULT_FAILURE_MESSAGE,"error"),t.$rgDigest()}),t.$rgDigest()}function V(e){switch(h.close(e.event),e.action){case"type_change":RingLogger.log(e,RingLogger.tags.CHAT),j(e.member,e.type);break;case"remove":x(e.member),RingLogger.log(e,RingLogger.tags.CHAT);break;default:RingLogger.log("Err. no matching action",e,RingLogger.tags.CHAT)}}S=u.onCustomEvent(T.CHAT.TAG_LIST_UPDATED,function(){t.$rgDigest()}),A=u.onCustomEvent("TAG_MEMBER_FETCHED",function(e){e.tagId===N&&t.$rgDigest()}),t.$on("$destroy",function(){u.removeCustomEvent(T.CHAT.MY_TAG_LIST_RECEIVED,I),u.removeCustomEvent(T.CHAT.TAG_MEMBER_FETCHED,A),u.removeCustomEvent(T.CHAT.TAG_LIST_UPDATED,S)})}}(),function(){"use strict";angular.module("ringid.chat").controller("TagChatMemberPagePopupController",e),e.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","Utils","settings","$location","profileFactory","rgScrollbarService","CHAT_LANG","SystemEvents"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T){var h,I,_,A,S,C=p.TAG,v=CHAT_APP.Constants.GENERAL_CONSTANTS,D=i.currentUser().getKey();t.state={loading:!1,noData:!1},t.friendName="",t.editMode=!1,t.addToTag=x,t.removeMember=K,t.createChatTag=$,t.updateChatTag=B,t.loadMoreFriends=k,t.cancel=Q,t.validateTag=X,t.newOwnerTagMember=!1,t.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:a.generateNewTagId(),errCircleName:!1,errMemberList:!1,errAdminList:!1},t.uploading=!1,t.selectNewOwner=z,t.setNewOwner=V,t.isMemberSelected=j,t.canRemoveMember=U,t.canChangeType=F,t.canUpdateTagInfo=w,t.editMode=!1,t.friendsNameFilter="",t.memberfilter="",t.rgWizardData={steps:[{id:0,title:"Group Name",template:"pages/partials/tag-chat/list-page/popups/step1.html",showNextButton:function(){return t.models.tagName.length>2}},{id:1,title:"Select Member",template:"pages/partials/tag-chat/list-page/popups/step2.html",showNextButton:function(){return""!==t.models.tagName&&t.memberList.length()>=1}},{id:2,title:"Select Admin",template:"pages/partials/tag-chat/list-page/popups/step3.html",showNextButton:function(){return""!==t.models.tagName&&t.memberList.length()>=1}}],onFinish:function(){t.editMode?B():$()}},t.friends=c.getFriends("friends"),t.getPicturePreviewUrl=M,t.contactListAction=N,t.uploadAction=y,l.wizardSteps&&(A=[],l.wizardSteps.forEach(function(e){A.push(t.rgWizardData.steps[e])}),t.rgWizardData.steps=A,t.rgWizardData.hideSteps=!0),l.initialStepId&&(t.rgWizardData.initialStepId=l.initialStepId),l&&l.tagId?(t.tag=a.getTag(l.tagId),_=t.tag.getMembersObjectMap(),_?(t.memberAdminList=_.copy(),b(),t.tag.initMemberObjects(),angular.forEach(t.memberAdminList.all(),function(e){e.value.isMember()?t.memberList.add(e.key,e.value):t.adminList.add(e.key,e.value)})):b(),t.models.tagName=t.tag.getTagName(),t.models.popupTitle="Update Group chat",t.models.pictureUrl=t.tag.getPictureFullUrl(),t.models.pictureFileName=t.tag.getPictureUrl(),l.action&&(t.action=l.action),t.editMode=!0):b(),S=d.onCustomEvent("TAG_MEMBER_FETCHED",function(){t.$rgDigest()}),t.$watch("friendName",function(e){e&&e.length>1&&(H(!0),c.searchContact({schPm:e},!0).then(function(){t.friends=c.getFriends("friends"),H(!1)},function(){H(!1)}))}),t.$watch("friendsNameFilter",function(e){e?t.friendDropdown=!0:t.friendDropdown=!1});function R(e){m.path()==="/chat/group/"+e&&m.path("/chat/groups")}function M(){return g.tagChatImBase+t.models.pictureUrl}function N(e){e.friend.isLoading()||(c.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())}function y(e){RingLogger.log(e,RingLogger.tags.CHAT),e.uploadFile.fetchMeta(function(){t.models.pictureUrl=e.uploadFile.getPreview(),t.uploading=!0,d.safeDigest(t),e.uploadFile.initUpload().then(function(e){t.uploading=!1,RingLogger.info("chat image uploaded:"+e,RingLogger.tags.CHAT),t.models.pictureFileName=e.iurl,t.models.pictureUrl=g.imBase+e.url,d.safeDigest(t)},function(e){RingLogger.log(e,RingLogger.tags.CHAT),t.uploading=!1})})}function b(){t.memberList=r.createNew(),t.adminList=r.createNew()}function O(e){return!!e&&e.getOwnerUserId()===i.currentUser().getKey()}function P(){return!0}function L(e){if(t.tag&&!O(t.tag)){if(h=e.getAddedBy()===D,t.tag.isCurrentUserStatusAdmin(D)&&e.isAdmin()&&!h)return!1;if(t.tag.isCurrentUserStatusMember(D)&&!h&&(e.isAdmin()||e.isMember()&&!h))return!1}return!0}function U(e){return e.getId()!==D&&!e.isOwner()&&L(e)}function F(e){return(e.getId()!==D||!e.isMember())&&L(e)}function w(){return!t.editMode||!t.tag.isCurrentUserStatusMember(D)}function k(){t.state.loading||t.friends.length()===c.totalFriends("friends")||(H(!0),c.getContactDetails().then(function(){t.friends=c.getFriends("friends"),H(!1)},function(){H(!1)}),setTimeout(function(){t.state.loading=!1},3e3))}function $(){var e,r,i,o,a;return X()?(e=t.models.tagName,r=t.memberList.keys(),i=t.adminList.keys(),o=t.models.tagId,a=t.models.pictureFileName,s.createTag({tagName:e,memberUIds:r,adminUIds:i,tagId:o,tagPictureUrl:a}).then(function(e){e.sucs&&u.show("Group Created.","success")},function(){u.show(C.DEFAULT_FAILURE_MESSAGE,"error")}),void n.close()):void d.safeDigest(t)}function G(){var e=a.getTag(t.tag.getTagId());e&&e.removeObjectLock()}function B(){var e,r,i,o,c;return X()?(e=a.getTag(t.tag.getTagId()),r=t.models.tagName,i=t.models.pictureFileName,o=t.memberList.keys(),c=t.adminList.keys(),t.tag.setObjectLock(),s.updateTag(e,r,i,o,c).then(function(){G(t.tag.getTagId()),d.triggerCustomEvent(T.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()})},function(){G(t.tag.getTagId()),u.show(C.DEFAULT_FAILURE_MESSAGE,"error")},function(n){n.sucs&&(G(t.tag.getTagId()),d.triggerCustomEvent(T.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()}))}),t.editMode=!1,d.triggerCustomEvent(T.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()}),void n.close()):void d.safeDigest(t)}function H(n){e(function(){t.state.loading=n,n||f.recalculate(t)})}function x(e,n){var r,i;return t.memberList.length()+t.adminList.length()>t.friends.length()-10&&k(),i=t.tag?t.tag.getTagId():t.models.tagId,r=a.createNewTagMember(i,{status:"member"===n?v.MEMBER_STATUS.MEMBER:v.MEMBER_STATUS.ADMIN,addedBy:D},!1),P(r)?(t.tag&&r.setTagId(t.tag.getTagId()),r.initWithUserMapObject(e),"admin"===n?t.adminList.add(r.getId(),r):t.memberList.add(r.getId(),r),t.friendsNameFilter="",void t.$rgDigest()):void u.show("Permission Denied","error")}t.selectMemberAsAdmin=Y;function Y(e){t.memberList.remove(e.getId()),t.adminList.add(e.getId(),e),t.$rgDigest()}function K(e){U(e)?(e.isAdmin()?t.adminList.remove(e.getId()):t.memberList.remove(e.getId()),t.$rgDigest()):u.show("Permission Denied","error")}function j(e){return t.newOwnerTagMember&&e.getId()===t.newOwnerTagMember.getId()}function V(e){t.newOwnerTagMember=e,d.safeDigest(t)}function W(e,n,r){e.setStatus(r),n.makeOwner(),t.tag.removeObjectLock()}function q(e,n,r){"leave"===t.action?s.leaveFromTag(t.tag.getTagId()).then(function(e){t.tag.removeObjectLock(),u.show(e,"info"),R()},function(){u.show(C.DEFAULT_FAILURE_MESSAGE,"error"),W(e,n,r)}):(t.tag.removeObjectLock(),t.$rgDigest())}function z(){var e=t.newOwnerTagMember,r=t.tag,o=e.getStatus(),a=r.getMember(i.currentUser().getKey()),c=[e.serialize(),a.serialize()],l=[e,a];t.newOwnerTagMember=!1,e.makeOwner(),a.makeMember(),r.setObjectLock(),s.changeTagMemberStatus(r.getTagId(),c,l).then(function(){q()},function(){u.show(C.DEFAULT_FAILURE_MESSAGE,"error"),W(e,a,o)}),d.safeDigest(t),n.close()}function Q(){t.newOwnerTagMember=!1,n.close(),d.safeDigest(t)}function X(){var e;return t.models.tagName.length>100?t.models.errTagName="Maximum 100 alpha numeric characters":t.models.errTagName="",t.models.errMemberList=t.memberList.length()+t.adminList.length()<1,e=!t.models.errMemberList&&!t.models.errTagName}I=d.onCustomEvent(T.FRIEND.UTID_LIST_RECEIVED,function(){t.$rgDigest()}),t.$on("$destroy",function(){d.removeCustomEvent(T.FRIEND.UTID_LIST_RECEIVED,I),d.removeCustomEvent("TAG_MEMBER_FETCHED",S),t.selectedMembers=[]})}}(),angular.module("ringid.chat").controller("TagChatDebugInfoController",TagChatDebugInfoController),TagChatDebugInfoController.$inject=["$scope","$boxInstance","Auth","ChatFactory","tagChatFactory","tagChatManager","friendsFactory","localData"];function TagChatDebugInfoController(e,t,n,r,i,o,a,s){e.currentUserUId=n.currentUser().getKey(),e.registerTag=c,e.unregisterTag=l,s&&s.tagId&&(e.tag=i.getTag(s.tagId),e.tagDebugInfo={},e.tagDebugInfo.isTagRegistered=i.isTagRegistered(s.tagId),e.chatBox=r.getBoxByUId(s.tagId));function c(){o.registerTag(e.tag.getTagId())}function l(){}}var chatApp;chatApp=angular.module("ringid.chat"),chatApp.factory("ChatUtilsFactory",ChatUtilsFactory),ChatUtilsFactory.$inject=["Auth","Utils"];function ChatUtilsFactory(e,t){function n(e){var n=t.parseForLE(e,0);return n}function r(){var t=e.loginData,n={ip:"",port:""};return t&&(n.ip=t.oIP,n.port=t.oPrt),n}function i(){var e=r();return!(!e||!e.ip||!e.port)}function o(e){var n=CHAT_APP.SharedHelpers.getClientTimeFromServerTime(e);return t.chatVerbalDate(n)}return{parseForLE:n,getOfflineIpPort:r,hasOfflineIpPort:i,getChatVerbalDateFromServerDate:o}}angular.module("ringid.chat").service("rgRecorderService",rgRecorderService);function __getUserMedia(){var e,t;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(t="new",e=navigator.mediaDevices.getUserMedia):(t="old",e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),{gum:e,version:t}}function rgRecorder(e){var t,n,r=this,i="old",o=null,a={recordedImage:{width:0,height:0,image:""},recordedVideo:{width:0,height:0,video:""},mediaPreview:{width:400,height:400},mediaStream:"",mediaObject:"",isStreaming:!1,text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser"}};angular.extend(a,e),t=function(){},n=function(){},this._callbacks={streamReady:t,error:n};function s(){var e=__getUserMedia();o=e.gum,i=e.version}function c(){r.getMediaObject().readyState>3?r.onCanPlay():r.getMediaObject().addEventListener("canplay",r.onCanPlay,!1)}function l(e){var t=document.createElement("video"),n=window.URL||window.webkitURL;return t.src=n.createObjectURL(e),t.autoplay=!0,t}function u(e){a.mediaStream=e,a.mediaObject=l(e),c()}function d(e){var t;t="DevicesNotFoundError"===e.name||"OverconstrainedError"===e.name?a.text.WEBCAM_DISCONNECTED:"PermissionDeniedError"===e.name?a.text.PERMISSION_DENINED:a.text.GUM_NOT_SUPPORTED,r.triggerEvent("error",{text:t}),RingLogger.alert("rgRecorder failure",e,RingLogger.tags.RG_RECRODER)}r.on=function(e,t){r._callbacks[e]=t},r.triggerEvent=function(e,t){r._callbacks[e]&&r._callbacks[e].call(r,t)},r.getProps=function(){return a},r.getMediaPreview=function(){return a.mediaPreview},r.getMediaObject=function(){return a.mediaObject},r.getStream=function(){return a.mediaStream},r.setStream=function(e){a.mediaStream=e},r.isStreaming=function(e){var t;return e?a.isStreaming=e:t=a.isStreaming,t},r.startRecording=function(){r.getStream().record()},r.stopRecording=function(){var e,t=r.getStream();t.getTracks?(e=t.getTracks(),e.forEach(function(e){e.stop()})):t.stop()},r.getRecordedMedia=function(e){r.getStream().getRecordedData(e)},r.captureImage=function(){var e,t=r.getMediaObject(),n=document.createElement("canvas"),i=n.getContext("2d");return t.width&&t.height?(n.width=t.width,n.height=t.height,i.drawImage(t,0,0,t.width,t.height),e=n.toDataURL("image/jpeg")):e=!1,e},r.onCanPlay=function(){var e,t,n=r.getMediaObject(),i=r.getMediaPreview();r.isStreaming()||(e=i.width,t=n.videoHeight/(n.videoWidth/i.width),isNaN(t)&&(t=e/(4/3)),n.setAttribute("width",i.width),n.setAttribute("height",t),r.isStreaming(!0),r.triggerEvent("streamReady",{stream:r.getStream(),media:n}))},r.openMedia=function(e){if(o)try{"old"===i?o.call(navigator,e,u,d):o.call(navigator.mediaDevices,e).then(u).catch(d)}catch(e){RingLogger.alert(e,"WEBCAM")}else r.triggerEvent("error",{text:a.text.GUM_NOT_SUPPORTED})},r.destroy=function(){var e=r.getMediaObject();e&&e.removeEventListener("canplay",r.onCanPlay),r.getStream()&&(r.stopRecording(),r.setStream(null))};function g(){s()}g()}function rgRecorderService(){var e=!1,t=!1;this.getRecorderInstance=function(e){return new rgRecorder(e)},this.hasUserMediaSupport=function(){return e||(t=!!__getUserMedia().gum,e=!0),t}}var ChatWorker;angular.module("ringid.chat").factory("ChatConnector",ChatConnector),ChatConnector.$inject=["$rootScope","$q","Auth","ChatUtilsFactory","settings","userFactory"];function _updateGobal(e,t){CHAT_APP.GLOBALS[e]=t}function ChatConnector(e,t,n,r,i,o){var a,s=CHAT_APP.Constants,c=CHAT_APP.PacketFormats.CHAT_PACKET_INFO,l=s.WORKER_NOTIFIER_TYPES,u=s.GENERAL_CONSTANTS,d=s.CHAT_GLOBAL_VALUES,g=!1,m={};ChatWorker=new Worker(window.location.origin+u.CHAT_WORKER_PATH);function E(e,t){try{a=c[e.packetType].PACKET_NAME,RingLogger.debug("{1}({0}, {2})".format(e.packetType,a,t.toUpperCase()),e,RingLogger.tags.CHAT_REQUEST)}catch(n){RingLogger.log("{1}({0}, {2})".format(e.packetType,a,t.toUpperCase()),e,RingLogger.tags.CHAT_REQUEST)}}function f(e,t,n){var r=n;m[e]||(m[e]=[]),r=r||null,m[e]={ctx:r,fn:t,ct:Date.now()}}function p(){var e,t;if(!g){if(!RingMessageChannel.port2)return void setTimeout(p,500);e={command:"SETTINGS",url:i.socketProtocol+window.location.host+"/ChatSocket/"+window._cti,tabId:window._cti,salt:Cookies.get("sId"),sKey:Cookies.get("sessionID"),appVersion:i.apiVersion,CLIENT_DATA_SIZE:512};try{t=n.currentUser().getKey(),t&&(e.uId=n.currentUser().getKey()),e.oIpPort=r.getOfflineIpPort()}catch(e){RingLogger.information("Current User Exception ",e,RingLogger.tags.CHAT)}try{ChatWorker.postMessage(e,[RingMessageChannel.port2])}catch(e){RingLogger.alert("Chat Woker Exception ",e,RingLogger.tags.CHAT)}_updateGobal("uId",t),_updateGobal("appVersion",i.apiVersion),g=!0}}return ChatWorker.addEventListener("error",function(e){RingLogger.alert(e,"WORKER_ERROR")}),ChatWorker.addEventListener("message",function(t){var n,r,i,a;switch(t.data.notifier){case l.DEBUG:try{RingLogger[t.data.type].apply(null,t.data.m)}catch(e){RingLogger.alert("Invalid Worker Log Type",RingLogger.tags.CHAT)}break;case l.CHAT_DATA_RECEIVED:t.data.object&&e.$broadcast("chatDataReceived",{jsonData:t.data.object});break;case l.AUTH_DATA_RECEIVED:t.data.object&&e.$broadcast("authDataReceived",{jsonData:t.data.object});break;case l.CHAT_REQUEST_RESPONSE:n=t.data.object.packetId,r=t.data.object,i=m[n],n&&i&&(r.notify?i.fn.notify.call(i.ctx,r):r.sucs?i.fn.resolve.call(i.ctx,r):r.error?(RingLogger.alert("Error : ",r.msg,RingLogger.tags.CHAT),i.fn.resolve.call(i.ctx,r)):r.sucs||i.fn.resolve.call(i.ctx,r)),delete m[n];break;case l.AUTH_REQUEST_RESPONSE:break;case l.CHAT_TIMER_UPDATE:a=t.data.object.serverTime,d.serverTime=a,o.refreshPesence();break;case l.RE_INIT:p();break;case l.EXCEPTION:try{RingLogger[t.data.type].apply(null,t.data.m)}catch(e){RingLogger.alert("Invalid Worker Log Type",RingLogger.tags.CHAT)}}}),{initiate:p,sendCommand:function(e,t){var n={command:e,tabId:window._cti},r=angular.extend({},t,n);ChatWorker.postMessage(r)},sendGlobal:function(e,t){var n;_updateGobal(e,t),n={command:"UPDATE_GLOBALS",tabId:window._cti},n[e]=t,ChatWorker.postMessage(n)},rawSend:function(e){ChatWorker.postMessage({command:"RAW_SEND",tabId:window._cti,object:e})},send:function(e,t){E(e,"send"),ChatWorker.postMessage({command:"SEND",tabId:window._cti,object:e,retryCount:t})},request:function(e,n){var i;return E(e,"request"),i=t.defer(),e.packetId||(e.packetId=r.getUUIDPacketId()),f(e.packetId,i,this),ChatWorker.postMessage({command:"REQUEST",tabId:window._cti,object:e,retryCount:n}),i.promise}}}angular.module("ringid.chat").factory("ChatExceptions",ChatExceptions),ChatExceptions.$inject=[];function ChatExceptions(){function e(e,t){}return{ChatPacketException:e}}angular.module("ringid.chat").factory("ChatFactory",ChatFactory),ChatFactory.$inject=["settings","Storage","$$stackedMap","ChatMap","Auth","Utils","ChatConnector","chatHistoryFactory","userFactory","friendsFactory","tagChatFactory","$interval","SystemEvents","OPERATION_TYPES","$rootScope"];function ChatFactory(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E){var f=null,p=n.createNew();function T(){return f||(f=new CHAT_APP.UTILS.ChatClock),f}function h(e){var t,n;return t=e?e-400-165:o.viewport.x-400-165,n=parseInt(t/310,10)}function I(e){var t={key:e,isMinimized:!1,isHidden:!1,isFocused:!1,blinkOn:!1,timeout:5,secretChat:!1,nonDomBox:!1,closedBox:!1,offlineStatus:!1,blocked:!1,blockedByUtId:[],isSecretVisible:!0,singlePage:!1,lastSeenBar:!0,unreadCount:0,bottomScrolled:!1,chatBoxClass:"chat-body-opened"};return t}function _(e,t,n){var i,o,a,s=e.toString(),l=n;return n||(l={}),a=p.get(s),a!==!1?o=a:a=r.create(s,t),t||(i=c.create({uId:s}),i.fetchPresence()),o=I(s),o.isFocused=!0,o.nonDomBox=!0,o.isTagChat=t,o.lastLogin=a.getUser()&&a.getUser().lastOnline?a.getUser().lastOnline():"",o.offlineStatus=!t&&null,o=angular.extend(a,o,l)}function A(e,t){var n=_(e,t);return p.save(e,n),s.addBox(n),n}function S(e){var t=e.toString(),n=p.get(t);n===!1?(n=A(t,!1),s.addOpenBoxes(t,!1)):(!n.nonDomBox,n.isFocused=!0,n.nonDomBox=!0,n.blinkOn=!1,s.updateBox(n)),setTimeout(function(){E.$rgDigest()})}function C(e){var t=e.toString(),n=p.get(t);return n===!1?(n=A(t,!0),
s.addOpenBoxes(t,!0)):(!n.nonDomBox,n.isFocused=!0,n.nonDomBox=!0,n.blinkOn=!1,s.updateBox(n)),setTimeout(function(){E.$rgDigest()}),n}function v(e,t){var n=e.toString(),i=r.create(n,t),o=I(n);return o.closedBox=!0,o.isTagChat=t,o=angular.extend(i,o),p.save(n,o),s.addBox(o),i}function D(e){var t=e.toString(),n=p.get(t);n!==!1&&(p.remove(t),n.isFocused=!0,p.save(t,n),E.$broadcast("focusOn",t))}function R(e){var t=e.toString(),n=p.get(t);n.closedBox=!0,s.updateBox(n),p.remove(t)}function M(e){var t=e.toString(),n=p.get(t);n.closedBox=!0,s.updateBox(n),p.remove(t)}function N(e){var t=e.toString(),n=p.get(t);n.isMinimized=!n.isMinimized,n.isMinimized?(n.isFocused=!1,n.chatBoxClass="chat-body"):(n.isFocused=!0,n.chatBoxClass="chat-body-opened"),s.updateBox(n)}function y(e){var t,n=s.getBox(e),r=p.get(e);s.loadChatBoxes(),r?n.closedBox?p.remove(e):(angular.extend(r,n),r.loadHistoryMessages()):n.closedBox||(t=_(e,n.isTagChat,n),p.save(e,t),t.loadHistoryMessages())}function b(e,t){var n,r;t&&(n=p.get(e),n?(n.nonDomBox=!0,n.loadSingleHistoryMessage(t)):(n.isTagChat?(r=u.getTag(e),r.isTagSafeToShow()&&C(e)):S(e),n=A(e,n.isTagChat),n.loadHistoryMessages()),o.triggerCustomEvent(g.CHAT.NEW_MESSAGE_PUSHED,{boxId:e,scroll:"bottom"}))}function O(){return p.all()}function P(){return p.nonClosedLength()}function L(e){return p.get(e)}function U(e,t){s.addUnreadMessageInfo(e,t),s.updateUnreadMessageInfos()}function F(e,t){s.removeUnreadMessageInfo(e,t),s.updateUnreadMessageInfos()}function w(){return s.getUnreadMessageCount()}function k(){return s.getUnreadConversationCount()}return{openChatBox:S,openTagChatBox:C,closeTagChatBox:M,creatNonDomBox:v,makeVisibleChatBox:D,closeChatBox:R,refreshBox:y,minimizeBox:N,openAndAddMessage:b,getBoxes:O,getBoxByUId:L,getNumberOfAvailableChatBox:h,getNonClosedLength:P,increaseUnreadMessageCount:U,decreaseUnreadMessageCount:F,getUnreadMessageCount:w,getUnreadConversationCount:k,getChatClock:T}}angular.module("ringid.chat").factory("ChatHelper",ChatHelper),ChatHelper.$inject=["SystemEvents","ChatFactory","OPERATION_TYPES","ChatConnector","ChatWorkerCommands","Auth","$interval","Utils","chatHistoryFactory"];function ChatHelper(e,t,n,r,i,o,a,s,c){return{sendChatSeenConfirmation:T,startTimerText:f,startTimerOthers:p,decreaseUnreadCount:l,increaseUnreadCount:d,deleteMessageFromOwn:g};function l(t,n){n?t.unreadCount-n>0?t.unreadCount-=n:t.unreadCount-n<0?t.unreadCount=0:t.unreadCount=0:u(t),c.updateBox(t),c.removeUnreadMessageInfoByBoxId(t.getKey()),s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}function u(e){e.unreadCount=0}function d(e,t){e&&e.isFocused===!1&&(e.unreadCount+=t)}function g(t,n){var r,i,o;if(t&&n.key){for(t.removeMessage(n.key),c.removeMessage(n.key,t.getKey()),r=t.getMessages(),i=0,o=r.length;i<o;i++)r[i].value.showDate=r[i].value.takeDecisionForShowingDate(),r[i].value.showAvator=r[i].value.takeDecisionForShowingMessageUserAvator();s.triggerCustomEvent(e.CHAT.BOX_UPDATED,{boxId:t.getKey()})}}function m(e,t,n){t.$broadcast("timeoutDelete",e.key,n)}function E(e,t,n){a(function(){m(e,t,n--)},1e3,n+1)}function f(e,t){var n,r,i,o;if(!(t.length<1))for(n=0,r=t.length;n<r;n++)if(t[n].value.timeout>0&&!t[n].value.timerStartFlag)switch(t[n].value.messageType){case 2:case 3:case 4:case 5:case 6:o=t[n].value.timeout,i=t[n].value,t[n].value.timerStartFlag=!0,E(i,e,o)}}function p(e,t){var n,r;if(t[0].value&&t[0].value.timeout>0&&!t[0].value.timerStartFlag)switch(t[0].value.messageType){case 7:case 8:case 9:case 10:n=t[0].value.timeout,r=t[0].value,t[0].value.timerStartFlag=!0,E(r,e,n)}}function T(e,t,n,i,o){var a=CHAT_APP.ChatRequests.getFriendChatSeenConfirmationObject(i,o);r.send(a)}}angular.module("ringid.chat").service("ChatPacketSenderService",ChatPacketSenderService),ChatPacketSenderService.$inject=["Auth","Utils","ChatFactory","tagChatFactory","ChatUtilsFactory","$q","chatHistoryFactory","chatTabSync","ChatConnector","ChatWorkerCommands","SystemEvents"];function ChatPacketSenderService(e,t,n,r,i,o,a,s,c,l,u){var d=this,g=CHAT_APP.Constants,m=CHAT_APP.SharedHelpers,E=g.GENERAL_CONSTANTS,f=g.TAG_CHAT_PACKET_TYPE,p=g.FRIEND_CHAT_PACKET_TYPE,T=g.PLATFORM,h=CHAT_APP.UTILS.getUUIDPacketId;function I(e,t){var n,r;return t&&t.url&&(n=e.message,r={u:t.url,d:t.description,t:t.title,i:t.image,m:n},e.message=angular.toJson(r)),e}function _(e,t){var n;return t&&t.lat&&(e.la=t.lat,e.lo=t.lng,e.loc=t.description,n={lo:e.lo,la:e.la,loc:e.loc},e.message=angular.toJson(n)),e}function A(e,t){var n;return t&&t.url&&(n={u:t.url,c:t.caption,w:t.width,h:t.height},e.message=angular.toJson(n),e.mediaUrl=t.url,e.plainText=t.caption),e}function S(t,n,r){var i,o,a,s,c,l=!1,u=e.currentUser(),d=e.currentUser().getKey(),g=m.getChatServerCurrentTime(),E=t.isTagChat;return t.editMessageKey?(o=t.editMessageKey,t.editMessageKey=void 0,g=parseInt(t.editMessageDate,10),t.editMessageDate=void 0,l=!0,E?(s=f.TAG_CHAT_MSG_EDIT,c=f.TAG_CHAT_BROKEN_MSG_EDIT):(s=p.FRIEND_CHAT_MSG_EDIT,c=p.FRIEND_CHAT_BROKEN_MSG_EDIT)):(o=h(g,!0),E?(s=f.TAG_CHAT_MSG,c=f.TAG_CHAT_BROKEN_MSG):(s=p.FRIEND_CHAT_MSG,c=p.FRIEND_CHAT_BROKEN_MSG)),i={isEdit:l,tag_chat:!1,packetType:s,brokenPacketType:c,fullName:u.getName(),userId:d,messageType:r,messageDate:g,message:n,key:o,packetId:o,isSecretVisible:t.isSecretVisible?1:0,timeout:0,platform:T.WEB},E?(a=t.getKey(),i.tag_chat=!0,i.tagId=a):(i.friendId=t.getUser().getKey(),t.secretChat?i.timeout=t.timeout:i.timeout=0),i}function C(e,n){switch(t.hasEmoticon(e.message)&&(e.messageType=3),e.messageType){case E.MESSAGE_TYPES.LOCATION_SHARE:_(e,n.locationData);break;case E.MESSAGE_TYPES.LINK_SHARE:I(e,n.ogData);break;case E.MESSAGE_TYPES.IMAGE:case E.MESSAGE_TYPES.CAMERA_IMAGE:case E.MESSAGE_TYPES.VIDEO:A(e,n.mediaData)}}function v(e,n,r){var i=e.getMessage(n.packetId);i&&(i.status=r,a.updateMessage(i,e.getKey()),t.triggerCustomEvent(u.CHAT.BOX_UPDATED,{boxId:e.getKey()}))}function D(t,n){var r=e.currentUser();t.pushMessage(n,r.getKey(),!0)}function R(e,t,n,r){var i=S(e,t,n,r);return C(i,r),i}function M(e){var t,r,i=e.boxId,o=e.packetId;i&&o?(t=n.getBoxByUId(i),t?v(t,{packetId:o},"Failed"):(r=a.getMessage(i,o),r.status="Failed",a.updateMessage(r,i))):RingLogger.debug("Handle Failed Message has not boxId",e,"CHAT")}function N(e,t,n,r){var i=R(e,t,n,r);y(e,i)}function y(e,t){return D(e,t),t.message=t.message.utf8Encode(),setTimeout(function(){c.request(t).then(function(t){t.sucs||(t.boxId=e.getKey(),M(t))})}),t}function b(e,t){var n;t.tag_chat?t.tagId=e.getKey():t.friendId=e.getKey(),n=R(e,t.text,t.messageType,t.messageData),n.message=n.message.utf8Encode(),n.packetId=t.packetId,n.key=t.packetId,t.status="Pending",setTimeout(function(){c.request(n).then(function(t){t.sucs||(t.boxId=e.getKey(),M(t))})})}function O(e){var t;t=e.isTagChat?CHAT_APP.ChatRequests.getTagChatTypingObject(e.getKey()):CHAT_APP.ChatRequests.getFriendChatTypingObject(e.getKey()),c.rawSend(t)}function P(e){var t,n=0,r=0;t=e.isTagChat?CHAT_APP.ChatRequests.getFriendChatUnregisterObject(e.getKey(),n,r):CHAT_APP.ChatRequests.getTagChatTagUnregisterObject(e.getKey(),n,r),c.send(t)}function L(e){var t=E.MESSAGE_TYPES.TEXT;return e.locationData.lat?t=E.MESSAGE_TYPES.LOCATION_SHARE:e.ogData.url&&(t=E.MESSAGE_TYPES.LINK_SHARE),t}d.sendMessage=N,d.retryMessage=b,d.sendTypingPacket=O,d.sendChatUnRegisterPacket=P,d.getSendMessageObject=R,d.pushMessageToBox=D,d.getMessageType=L,d.doSendMessage=y}angular.module("ringid.chat").factory("ChatSeenSend",ChatSeenSend),ChatSeenSend.$inject=["ChatWorkerCommands","ChatFactory","chatHistoryFactory","Utils","Auth","tagChatFactory","tagChatManager","ChatHelper","tagChatHelper","$q","ChatUtilsFactory","ChatConnector"];function ChatSeenSend(e,t,n,r,i,o,a,s,c,l,u,d){var g=CHAT_APP.Constants,m=CHAT_APP.ChatRequests,E=g.GENERAL_CONSTANTS,f=g.FRIEND_CHAT_PACKET_TYPE,p=CHAT_APP.SharedHelpers;function T(e,t,n){var r,i,o;for(r=m.getFriendChatSeenObject(e,t),r.brokenPacketType=f.FRIEND_CHAT_SEEN,o=p.getChatServerCurrentTime(),i=0;i<t.length;i++)r.messages[i].packetId=t[i].key,r.messages[i].messageDate=o,r.messages[i].status=S(t[i].messageType);d.request(r).then(function(r){r.sucs&&(RingLogger.print("F2F Seen packet Success",RingLogger.tags.CHAT),I(e,t),n.resolve("success"))},function(){RingLogger.print("F2F Seen packet Failure",RingLogger.tags.CHAT),n.reject("failed")})}function h(e,t){var n,r,i=l.defer(),o=i.promise;return t.length<1?o="":(n=A(t),r=e.getKey(),e.isTagChat?(_(r,n),o=i.resolve({sucs:!0})):T(r,n,i)),l.when(o)}function I(e,r){var i,o,a=t.getBoxByUId(e),s=[];for(i=0;i<r.length;i++)a&&(o=a.getMessage(r[i].key),o&&(o.seenSent=!0,o.status="Received",s.push(o)));n.updateMessages(s,e)}function _(e,t){var n,r,i,a,s=o.getTag(e);if(s){for(n=0;n<t.length;n++)r=t[n].key,i=t[n].senderId,a=m.getTagChatSeenObject(i,e,r),d.send(a);I(e,t)}else RingLogger.print("TagSeen packet not send, tagObject not found.")}function A(e){var t,n=[];for(t=0;t<e.length;t++)n.push({key:e[t].key,messageType:e[t].value.messageType,senderId:e[t].value.user.getKey()});return n}function S(e){var t=0;switch(e){case 2:case 3:case 4:case 5:case 6:t=E.MESSAGE_STATUS.SEEN;break;case 7:case 8:case 9:case 10:t=E.MESSAGE_STATUS.VIEWED}return t}return{sendSeenPacket:h}}var chatApp=angular.module("ringid.chat");chatApp.factory("chatTabSync",chatTabSync);function CrossTab(){var e,t,n,r={};function i(){var e="CrossTab not supported",t=[];throw localStorage||t.push("localStorage not available"),window.addEventListener||t.push("addEventListener not available"),t.length>0&&(e+=": "+t.join(", ")),new Error(e)}function o(){return(new Date).getTime()}function a(n){var i;if(n&&"__CROSSTAB"===n.key){try{i=n.newValue?JSON.parse(n.newValue):{}}catch(e){i={}}i&&i.id&&i.id!==CrossTab.id&&(n.newValue===e&&n.oldValue===t||(e=n.newValue,t=n.oldValue,r.message&&r.message.call(this,i.data)))}}function s(e,t){var r={id:n,data:t,timestamp:o()};localStorage.setItem(e,JSON.stringify(r))}function c(){window.removeEventListener("beforeunload",l,!1),window.addEventListener("unload",l,!1)}function l(){}function u(e,t,n){var r=n||"0",i=e.toString();return i.length>=t?i:new Array(t-i.length+1).join(r)+i}function d(){return o().toString()+u(2147483647*Math.random()|0,10)}function g(e){var t;CrossTab.supported||i(),t={data:e,origin:n},s("__CROSSTAB",t)}this.on=function(e,t){r[e]=t},this.setId=function(e){n=e},this.getId=function(){return n},this.broadcast=g,this.init=function(){CrossTab.supported=!!localStorage&&window.addEventListener,CrossTab.supported?(n=d(),window.addEventListener("storage",a,!1),window.addEventListener("beforeunload",l,!1),window.addEventListener("DOMContentLoaded",c,!1)):CrossTab.broadcast=i}}chatTabSync.$inject=["Storage","Utils","SystemEvents"];function chatTabSync(e,t,n){var r,i,o,a,s=CHAT_APP.Constants.GENERAL_CONSTANTS,c=!!window.SharedWorker,l=!!window.localStorage;function u(e,t){try{i.port.postMessage({origin:r,data:angular.extend(t,{type:e})})}catch(e){}}function d(e,t){try{o.broadcast(angular.extend(t,{type:e}))}catch(e){}}function g(){r=t.getUniqueID("t"),i=new SharedWorker(s.SHARED_WORKER_PATH),i.port.addEventListener("message",function(e){var i=e.data;i.origin!==r&&t.triggerCustomEvent(n.CHAT.TAB_SYNC_NEW_DATA,i.data)},!1),i.port.start()}function m(){o=new CrossTab,o.init(),r=o.getId(),o.on("message",function(e){e.origin!==r&&t.triggerCustomEvent(n.CHAT.TAB_SYNC_NEW_DATA,e.data)})}function E(e,t){a&&a.call(this,e,t)}function f(){c?(g(),a=u):l?(m(),a=d):a=function(){}}return{init:f,sendData:E}}var chatApp=angular.module("ringid.chat");chatApp.service("ChatWorkerCommands",ChatWorkerCommands),ChatWorkerCommands.$inject=["ChatConnector"];function ChatWorkerCommands(e){function t(e){return!!e||(RingLogger.alert("Invalid Chat Session Type",e,RingLogger.tags.CHAT),!1)}this.startChatSession=n;function n(n,r,i){t(r)&&e.sendCommand("START_CHAT_SESSION",{id:n,type:r,uIds:i})}this.endChatSession=r;function r(n,r){t(r)&&e.sendCommand("END_CHAT_SESSION",{id:n,type:r})}this.sendAuthRequest=i;function i(t){e.sendCommand("SEND_AUTH_REQUSET",{object:t,type:"send"})}this.sendTagChatMemberAddAuthRequest=o;function o(t){e.sendCommand("SEND_TAG_CHAT_MEMBER_ADD_AUTH_REQUEST",{object:t,type:"send"})}this.doGetChatHistoryMessages=a;function a(t,n,r,i,o){e.sendCommand("FETCH_HISTORY_MESSAGE",{id:t,type:i,pageDirection:n,limit:r,packetId:o})}}angular.module("ringid.chat").factory("tagChatFactory",tagChatFactory),tagChatFactory.$inject=["$$stackedMap","$$connector","userFactory","friendsFactory","Auth","Utils","tagChatModels"];function tagChatFactory(e,t,n,r,i,o,a){var s=CHAT_APP.Constants,c=CHAT_APP.SharedHelpers,l=s.GENERAL_CONSTANTS,u=s.PACKET_CONSTANTS,d={},g=e.createNew(!0),m=!0;return{createNewTag:h,createNewTagMember:I,createNewTagMessage:_,createTagStatusMessage:A,addTagObject:C,removeTagObject:T,getTags:f,getTag:p,generateNewTagId:E,getOrCreateTag:v,getOrCreateMessage:R,updateTag:D,getTagLastMessageObject:S,setTagChatInitiator:M,resetTagChatInitiator:N,isTagChatInitiator:y,startProcessingRequest:m};function E(){var e=i.currentUser().getKey().toString(),t=(new Date).getTime().toString(),n=t.substr(0,u.TAG_ID_NO_OF_TIME_DIGIT);return n+=e.substr(e.length-u.TAG_ID_NO_OF_USER_ID_DIGIT)}function f(){return g}function p(e){return g.get(e)}function T(e){return g.remove(e)}function h(e,t){var n=t;return n||(n=new a.TagObject),e.tagId?n.setTagId(e.tagId):n.setTagId(E()),e.packetId&&n.setPacketId(e.packetId),e.userId&&n.setUserId(e.userId),e.tagName&&n.setTagName(e.tagName),e.tagPictureUrl&&n.setPictureUrl(e.tagPictureUrl),e.serverDate&&n.setServerDate(e.serverDate),e.tagMembersCount&&n.setMembersCount(e.tagMembersCount),n}function I(e,t){var n=new a.TagMember;return e&&n.setTagId(e),t&&(t.userId&&n.setId(t.userId),t.fullName&&n.setFullName(t.fullName),t.addedBy&&n.setAddedBy(t.addedBy),t.status?n.setStatus(t.status):n.setStatus(l.MEMBER_STATUS.MEMBER)),n}function _(e,t){var n=new a.TagMessage;return e&&n.setTagId(e),t&&(t.userId&&n.setUserId(t.userId),t.user&&n.setUserId(t.user),t.fullName&&n.setFullName(t.fullName),t.message&&n.setMessageText(t.message),t.hrtime&&n.setHumanReadableTime(t.hrtime),t.messageDate&&n.setMessageDate(t.messageDate),t.isDeleted&&n.markAsDeleted(t.isDeleted),t.messageDateString&&n.setMessageDateString(t.messageDateString),t.timeout&&n.setTimeout(t.timeout),t.messageType&&n.setMessageType(t.messageType),t.status&&n.setStatus(t.status),t.packetId&&n.setPacketId(t.packetId),t.usersToChange&&n.setUsersToChange(t.usersToChange),t.usersToChangeName&&n.setUsersToChangeName(t.usersToChangeName),t.statusType&&n.setStatusType(t.statusType),t.tagName&&n.setTagName(t.tagName)),n}function A(e,t,r,i,o,a){var s,l,u,d,g,m,E={},f=p(t);if(f){if(s=a.messageDate?a.messageDate:c.getChatServerCurrentTime(),l=n.getUser(r),u="",l&&""!==l.getName()&&(u=l.getName()),E={message:"",fullName:u,status:"status_update",statusType:i,tagName:a?a.tagName:"",messageDate:s,messageType:2,tag_chat:!0,userId:r,user:r,packetId:e},E.usersToChange={},o.length>0)for(d=0;d<o.length;d++)g=o[d],E.usersToChange[g.userId]=!0;return m=_(t,E)}return!1}function S(e){var t={key:e.key,text:e.text,messageType:e.messageType,messageDate:e.messageDate};return t}function C(e){var t,n;return e instanceof a.TagObject?(t=g.get(e.getTagId()),t?t.update(e):g.add(e.getTagId(),e)):(RingLogger.alert("Please provide tagChatModels.TagObject() Instance",RingLogger.tags.TAG_CHAT),n=!1),n}function v(e,t){var n,r=t;return r||(r={tagId:e}),n=p(e),n=n?h(r,n):h(r),g.save(e,n),n}function D(e,t,n){var r=n;return r||(r=p(e)),r=h(t,r),g.save(e,r),r}function R(e,t){var n,r,i,o=t,a={tagId:e};return o||(o={tagId:e}),n=p(e),n||(n=h(a),g.save(e,n)),i=_(e,o,!0),r=n.getMessage(o.packetId),r?r.update(i):(r=i,n.addMessage(r)),r}function M(e){d[e]=!0,setTimeout(function(){d[e]=!1},l.API_FETCH_RETRY_DELAY)}function N(e){d[e]=!1}function y(e){return!!d[e]}}angular.module("ringid.chat").factory("tagChatHelper",tagChatHelper),tagChatHelper.$inject=["CHAT_LANG","Auth","tagChatFactory","userFactory"];function tagChatHelper(e,t,n,r){var i=CHAT_APP.Constants,o=i.GENERAL_CONSTANTS,a=e.TAG;return{getTagChatStatusMessage:l,getTagEmptyMessageObject:u};function s(e){var t;return e===o.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD?t="member":e===o.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD&&(t="admin"),t}function c(e,t){var n,i,o=e.getMember(t);return o?n=o.getName():(i=r.getUser(t),n=i&&""!==i.getName()?i.getName():t),n}function l(e){var i,l,u,d,g,m,E,f,p,T=t.currentUser(),h="",I="",_="",A=e.fullName,S=e.tagName,C=[],v=0,D={},R=a.STATUS_MESSAGES;if(u=e.tagId,m=n.getOrCreateTag(u),p=T.getKey()===e.userId.toString(),m){switch(A||(A=c(m,e.userId)),e.usersToChange.length>0&&(i=e.usersToChange.length-1,e.usersToChange.forEach(function(e){d=r.getUser(e),d&&""!==d.getName()?(C.push(d.getName()),v++):(g=c(m,e),C.push(g))}),RingLogger.log("Tag Id {0}, Members Count {1}, Fetched User Count {2}".format(u,e.usersToChange.length,C),"CHAT_0"),v===e.usersToChange.length&&(e.allStatusUserFetched=!0),I=C.length>0?C[0]:e.usersToChange[0],_=C.slice(1).join(", ").replace('"',"'")),D={},R=a.STATUS_MESSAGES,e.statusType){case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:case o.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:f=s(e.statusType),D.member_name=A,D.new_member_name=I===T.getName()?"you":I,D.new_member_type=f,D.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(_,i),E=p?i?R.SELF_ADD_MULTIPLE_MEMBER:R.SELF_ADD_MEMBER:i?R.OTHER_ADD_MULTIPLE_MEMBER:R.OTHER_ADD_MEMBER;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE:D.member_name=A,D.old_member_name=I===T.getName()?"you":I,D.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(_,i),E=p?i?R.SELF_REMOVE_MULTIPLE_MEMBER:I===A?R.SELF_LEAVE_GROUP:R.SELF_REMOVE_MEMBER:i?R.OTHER_REMOVE_MULTIPLE_MEMBER:I===A?R.OTHER_LEAVE_GROUP:R.OTHER_REMOVE_MEMBER;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_LEAVE:D.member_name=A,E=p?R.SELF_LEAVE_GROUP:R.OTHER_LEAVE_GROUP;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:D.member_name=A,D.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(_,i),I!==T.getName()?D.old_member_name=I:D.old_member_name="you",E=p?i?R.SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:R.SELF_MEMBER_CHANGE_TO_ADMIN:i?R.OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:R.OTHER_MEMBER_CHANGE_TO_ADMIN;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:D.admin_name=A,I!==T.getName()?D.old_admin_name=I:D.old_admin_name="you",D.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(_,i),E=p?i?R.SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:I===A?R.SELF_REMOVED_FROM_ADMIN_BY_SELF:R.SELF_ADMIN_CHANGE_TO_MEMBER:i?R.OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:I===A?R.OTHER_REMOVED_FROM_ADMIN_BY_SELF:R.OTHER_ADMIN_CHANGE_TO_MEMBER;break;case o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER:D.member_name=A,D.admin_name=I,E=I!==T.getName()?R.OTHER_USER_ADDED_AS_OWNER:R.SELF_USER_ADDED_AS_OWNER;break;case o.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:D.member_name=A,D.group_name=S,E=p?R.SELF_UPDATE_GROUP_INFO:R.OTHER_UPDATE_GROUP_INFO;break;case o.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE:D.member_name=A,D.group_name=S,E=p?R.SELF_RENAME_GROUP:R.OTHER_RENAME_GROUP;break;case o.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE:D.member_name=A,D.group_name=S,E=p?R.SELF_CHANGE_GROUP_PIC:R.OTHER_CHANGE_GROUP_PIC}E&&(h=E.supplant(D)),l=h}else l=null;return l}function u(e){var r,i,a=t.currentUser();return r={tagId:e,userId:a.getKey(),fullName:a.getName(),message:" ",messageDate:(new Date).getTime(),messageType:o.MESSAGE_TYPES.BLANK_MESSAGE,packetId:CHAT_APP.UTILS.getUUIDPacketId()},i=n.createNewTagMessage(e,r)}}angular.module("ringid.chat").factory("tagChatManager",tagChatManager),tagChatManager.$inject=["$$connector","$q","$timeout","Auth","CHAT_LANG","tagChatFactory","ChatWorkerCommands","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","ChatUtilsFactory","ChatConnector","SystemEvents"];function tagChatManager(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T,h,I){var _=CHAT_APP.Constants,A=CHAT_APP.SharedHelpers,S=_.GENERAL_CONSTANTS,C=_.OFFLINE_PACKET_TYPE,v=CHAT_APP.AuthRequests,D=CHAT_APP.ChatRequests,R=CHAT_APP.UTILS.callXTimeAfterYIntervalStopOnSuccess;function M(e){var n,i,s,c,l,u,d,m,E,f,p=r.currentUser(),T=t.defer();for(e.tagMembersCount=e.memberUIds.length+e.adminUIds.length+1,n=o.createNewTag(e),i={userId:p.getKey(),addedBy:p.getKey(),status:S.MEMBER_STATUS.OWNER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s),l=0;l<e.memberUIds.length;l++)u=e.memberUIds[l],i={userId:u,addedBy:p.getKey(),status:S.MEMBER_STATUS.MEMBER},s=o.createNewTagMember(n.getTagId(),i,!0),n.addMember(s);for(d=0;d<e.adminUIds.length;d++)m=e.adminUIds[d],c={userId:m,addedBy:p.getKey(),status:S.MEMBER_STATUS.ADMIN},E=o.createNewTagMember(n.getTagId(),c,!0),n.addMember(E);return n.setObjectLock(),o.addTagObject(n),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:n.getTagId()}),e.uIds=e.adminUIds.concat(e.memberUIds),f=D.getOfflineTagCreateTagObject(n.getTagId(),n.getTagName(),n.getPictureUrl(),n.getSerializedMembers()),f.brokenPacketType=C.OFFLINE_BROKEN_PACKET,h.request(f).then(function(e){n.removeObjectLock(),e.sucs?(T.resolve(e),a.startChatSession(n.getTagId(),S.SESSION_TYPES.TAG,n.getMemberUserIds())):e.error?T.error(e):T.reject(e)}),T.promise}function N(e,t,n){var i,a,s,c,l,u,g,m,E,f,p=r.currentUser(),T=[],h=[],I=[],_=[],A=[],C=[],v={},D={},R={};for(i=e.getMembersObjectMap().copy(),a=i,s=a.all(),angular.forEach(t,function(e){v[e]=!0}),angular.forEach(n,function(e){D[e]=!0}),f=0;f<s.length;f++)c=s[f].value,R[c.getId()]=!0,c.isOwner()||(D[c.getId()]||v[c.getId()]?(l=!1,c.isAdmin()?v[c.getId()]&&(c.makeMember(),l=!0):c.isMember()&&D[c.getId()]&&(c.makeAdmin(),l=!0),l&&(h.push(c.serialize()),C.push(c))):(T.push(c.serialize()),A.push(c)));return angular.forEach(t,function(t){R[t]||t===p.getKey()||(u=d.getUser(t),g=o.createNewTagMember(e.getTagId(),{userId:t,addedBy:p.getKey(),fullName:u.getName(),status:S.MEMBER_STATUS.MEMBER},!0),_.push(g),I.push(g.serialize()))}),angular.forEach(n,function(t){R[t]||t===p.getKey()||(m=d.getUser(t),E=o.createNewTagMember(e.getTagId(),{userId:t,addedBy:p.getKey(),fullName:m.getName(),status:S.MEMBER_STATUS.ADMIN},!0),_.push(E),I.push(E.serialize()))}),{serializedMemberAdminsToRemove:T,serializedMemberAdminsToStatusChange:h,serializedNewMemberAdminsToAdd:I,membersAdminToAddOnSuccess:_,membersAdminToRemoveOnSuccess:A,membersAdminToUpdateOnSuccess:C}}function y(e,n,i){var o,c,l,u=r.currentUser(),d=t.defer();return n.length>0?(l=n.keyValues("userId"),c=v.getTagChatMembersAddObject(e.getTagId(),l),a.sendTagChatMemberAddAuthRequest(c),c=D.getTagChatTagMemberAddObject(e.getTagId(),n),o=A.getChatServerCurrentTime(),h.request(c).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.addMember(t)}),e.setMembersCount(e.getMembersCount()+i.length),s.showTagMembersAddStatusMessage(e.getTagId(),u.getKey(),n,o,!1,t.packetId),d.resolve({sucs:!0,mg:"Member( "+i.length+" ) Added in "+e.getTagName()}))},function(){d.reject({sucs:!1,mg:"Unable to send tag new member add packet to chat server."}),RingLogger.alert("Unable to send tag new member add packet to chat server",e.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})):d.resolve({sucs:!1}),d.promise}function b(e,n,i){var o,a,c=r.currentUser(),l=t.defer();return n.length>0?(a=A.getChatServerCurrentTime(),o=D.getTagChatMemberRemoveLeaveObject(e.getTagId(),n),h.request(o).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.removeMember(t)}),e.setMembersCount(e.getMembersCount()-i.length),s.showTagMembersRemoveStatusMessage(e.getTagId(),c.getKey(),n,a,t.packetId),l.resolve({sucs:!0,mg:"Member( "+i.length+" ) Removed from "+e.getTagName()}))},function(){l.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."}),RingLogger.alert("Unable to send tag  member remove packet to chat server",e.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})):l.resolve({sucs:!1}),l.promise}function O(e,n,i){var o,a,c=r.currentUser(),l=t.defer();return o=A.getChatServerCurrentTime(),n.length>0?(a=D.getTagChatTagMemberTypeChangeObject(e.getTagId(),n),h.request(a).then(function(t){t.sucs&&(angular.forEach(i,function(t){e.updateMember(t)}),s.showMemberTypeChangeStatusMessage(e.getTagId(),c.getKey(),n,o,!1,t.packetId),l.resolve({sucs:!0,mg:"Member( "+i.length+" ) Status Updated for "+e.getTagName()}))},function(){l.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."}),RingLogger.alert("Unable to send tag  member status change packet to chat server",e.getTagId()," tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})):l.resolve({sucs:!1}),l.promise}function P(e,n,i){var o,a,c,l=r.currentUser(),u=t.defer(),d=e.getTagName(),g=e.getPictureUrl(),m=e.getTagName()!==n,E=e.getPictureUrl()!==i,f=m||E;return f?(o=s.getTagInfoChangeStatusMessage(e.getTagId(),{tagName:n||"",tagPictureUrl:i||""}),m&&(e.setTagName(n),c=S.TAG_ACTIVITY_TYPE.TAG_RENAME,a=D.getTagChatTagInformationObject(e.getTagId(),c,n,g),h.request(a).then(function(t){t.sucs&&(s.showTagInfoChangeStatusMessage(e.getTagId(),l.getKey(),{statusMessageType:o,tagName:n},!1),E||u.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(){m&&e.setTagName(d),u.reject({sucs:!1,mg:"Unable to send tag info tag name change packet to chat server."}),RingLogger.alert("Unable to send tag  member info tag name change packet to chat server",e.getTagId()," update-tag-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT)})),E&&(e.setPictureUrl(i),c=S.TAG_ACTIVITY_TYPE.TAG_URL_RENAME,a=D.getTagChatTagInformationObject(e.getTagId(),c,d,i),h.request(a).then(function(t){t.sucs&&(s.showTagInfoChangeStatusMessage(e.getTagId(),l.getKey(),{statusMessageType:o,tagName:n},!1),u.resolve({sucs:!0,mg:"Updated Group Info of "+e.getTagName()}))},function(){E&&e.setPictureUrl(g),u.reject({sucs:!1,mg:"Unable to send tag info tag picture url packet to chat server."}),RingLogger.alert("Unable to send tag info tag picture url packet to chat server",e.getTagId()," update-tag-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT)}))):u.resolve({sucs:!1}),u.promise}function L(e,n,r,i,o){var a,s,c,l,u,d,m,E,f=t.defer();return a=N(e,i,o),s=a.serializedNewMemberAdminsToAdd,c=a.membersAdminToAddOnSuccess,l=a.serializedMemberAdminsToRemove,u=a.membersAdminToRemoveOnSuccess,d=a.serializedMemberAdminsToStatusChange,m=a.membersAdminToUpdateOnSuccess,E=0,y(e,s,c).then(function(e){e.sucs&&(E++,f.notify(e))},f.reject),b(e,l,u).then(function(e){e.sucs&&(E++,f.notify(e))},f.reject),O(e,d,m).then(function(e){e.sucs&&(E++,f.notify(e))},f.reject),P(e,n,r).then(function(e){e.sucs&&(E++,f.notify(e))},f.reject),setTimeout(function(){E?f.resolve({sucs:!0}):f.reject({sucs:!1})},18e3),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e.getTagId()}),f.promise}function U(e){var t=o.getTag(e),n=t.getMember(r.currentUser().getKey());return F(e,[n.serialize()],[n])}function F(e,n,i){var a,s,c,l,u,d=r.currentUser(),m=t.defer(),E=o.getTag(e);return a=D.getTagChatMemberRemoveLeaveObject(e,n),h.request(a).then(function(t){if(t.sucs){for(E=o.getTag(e),s="Member( "+i.length+" ) Removed from "+E.getTagName(),c=!1,l=0;l<i.length&&(u=i[l],u.getId()===d.getKey()&&(s="You left from `"+E.getTagName()+"` chat group.",o.removeTagObject(e),c=!0,m.resolve({sucs:!0,mg:s})),!c);l++)E.removeMember(u);c||m.resolve({sucs:!0,mg:s})}},function(){m.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."}),RingLogger.alert("Unable to send tag  member remove packet to chat server",E.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)}),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e}),m.promise}function w(e,n,r){var i,a=t.defer(),s=o.getTag(e);return i=D.getTagChatTagMemberTypeChangeObject(e,n),h.request(i).then(function(e){e.sucs&&(angular.forEach(r,function(e){s.updateMember(e)}),a.resolve({sucs:!0,mg:"Member( "+n.length+" ) Status Updated for "+s.getTagName()}))},function(){a.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."}),RingLogger.alert("Unable to send tag  member status change packet to chat server",s.getTagId()," tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT)}),g.triggerCustomEvent(I.CHAT.TAG_LIST_UPDATED,{tagId:e}),a.promise}function k(e){R(function(){var t,n=o.getTag(e);n&&n.isTagSafeToShow()&&(t=l.getBoxByUId(e),$(e,t))},function(){var t=o.getTag(e);return!(!t||!t.isTagSafeToShow())},function(){},5,5e3)}function $(e,t){var n,r=t;return r||(n=o.getOrCreateTag(e),n.isTagSafeToShow()?(l.openTagChatBox(e),r=l.getBoxByUId(e),r.setTitle(n.getTagName())):r=l.creatNonDomBox(e,!0),r.setTitle(n.getTagName())),r}return{createTag:M,updateTag:L,leaveFromTag:U,removeTagMembers:b,removeTagMember:F,changeTagMemberStatus:w,updateTagInformation:P,openTagChatBoxIfClosed:$,openPreviouslyOpenedBoxes:k}}angular.module("ringid.chat").factory("tagChatStorage",tagChatStorage),tagChatStorage.$inject=["Storage","Auth","Utils"];function tagChatStorage(e,t,n){var r={packets:{}};function i(){return"tagc-store-"+t.currentUser().getKey()}function o(t){e.setData(i(),angular.toJson(t))}function a(e,t){r.packets[e]=n.arrayBuffer2String(t.buffer.slice(6)),o(r)}function s(e){return n.string2ArrayBuffer(r.packets[e])}function c(){return r.packets}return t.isLoggedIn(),{savePacket:a,getPacket:s,getAllPackets:c}}angular.module("ringid.chat").factory("tagChatUI",tagChatUI),tagChatUI.$inject=["ChatFactory","Utils","chatHistoryFactory","tagChatFactory"];function tagChatUI(e,t,n,r){var i=CHAT_APP.Constants,o=i.GENERAL_CONSTANTS;return{getTagInfoChangeStatusMessage:l,showTagInfoChangeStatusMessage:u,showMemberTypeChangeStatusMessage:c,showTagMembersAddStatusMessage:d,showTagMembersRemoveStatusMessage:g};function a(e){var t;return t="admin"===e?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:"member"===e?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER}function s(e){var t,n,r,i={};for(r=0;r<e.length;r++)t=e[r],n=angular.isString(t.status)?a(t.status):t.status,i[n]||(i[n]=[]),i[n].push(t);return i}function c(t,i,a,c,l,u){var d,g,m,E,f,p=e.getBoxByUId(t),T=s(a),h=u,I={};c&&(h=CHAT_APP.UTILS.getUUIDPacketId(c,!0),I.messageDate=c),d=1;for(E in T)if(T.hasOwnProperty(E)){if(d||(h=h+"_"+d),m="",E=parseInt(E,10),m=E===o.MEMBER_STATUS.ADMIN?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:E===o.MEMBER_STATUS.MEMBER?o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER,g=r.createTagStatusMessage(h,t,i,m,T[E],I),!g)continue;f=g.serialize(),p?(f.fromHistory=l,p.pushMessage(f,i)):n.addMessage(f,t)}}function l(e,t,n){var i,a=n;return a||(a=r.getTag(e)),i=0,a&&(t.tagName&&t.tagPictureUrl&&a.getTagName()!==t.tagName&&a.getPictureUrl()!==t.tagPictureUrl.trim()?i=o.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:(t.tagName&&a.getTagName()!==t.tagName&&(i=o.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE),t.tagPictureUrl&&a.getPictureUrl()!==t.tagPictureUrl.trim()&&(i=o.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE))),i}function u(t,i,o,a,s,c){var u,d,g,m,E=c,f=s;if(E||(E=r.getTag(t)),f||(f=CHAT_APP.UTILS.getUUIDPacketId()),u=o.statusMessageType,u||(u=l(t,o,E)),o.messageDate&&(f=CHAT_APP.UTILS.getUUIDPacketId(o.messageDate,!0)),0!==u){if(d=e.getBoxByUId(t),m=r.createTagStatusMessage(f,t,i,u,[],o),!m)return;g=m.serialize(),d?(g.fromHistory=a,d.pushMessage(g,i)):n.addMessage(g,t)}}function d(t,i,a,c,l,u,d){var g,m,E,f,p,T,h,I,_=d;_||(_=r.getTag(t)),g=e.getBoxByUId(t),m=s(a),h={},c&&(h.messageDate=c);for(E in m)if(m.hasOwnProperty(E)){if(f=u+"_"+E,p="",E=parseInt(E,10),E===o.MEMBER_STATUS.ADMIN?p=o.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:E===o.MEMBER_STATUS.MEMBER?p=o.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:E===o.MEMBER_STATUS.OWNER&&(p=o.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER),
T=r.createTagStatusMessage(f,t,i,p,m[E],h),!T)continue;I=T.serialize(),g?(I.fromHistory=l,g.pushMessage(I,i)):n.addMessage(I,t)}}function g(t,i,a,s,c,l,u){var d,g,m,E,f,p,T=u,h=l;for(T||(T=r.getTag(t)),h||(h=CHAT_APP.UTILS.getUUIDPacketId(s,!0)),d=e.getBoxByUId(t),g=0;g<a.length;g++)m=T.getMember(a[g].userId),m&&(a[g].fullName=m.getName());E={},s&&(E.messageDate=s,h=CHAT_APP.UTILS.getUUIDPacketId(s,!0)),p=r.createTagStatusMessage(h,t,i,o.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE,a,E),p&&(f=p.serialize(),d?(f.fromHistory=c,d.pushMessage(f,i)):n.addMessage(f,t))}}angular.module("ringid.chat").factory("chatRequestProcessor",chatRequestProcessor),chatRequestProcessor.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","Utils","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","CHAT_LANG","ChatUtilsFactory","ChatConnector"];function chatRequestProcessor(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T){var h=window.CHAT_APP,I=h.Constants,_=I.CHAT_GLOBAL_VALUES,A=h.ChatRequests,S=h.SharedHelpers;function C(){var e=_.offlineUpdateTime,t=S.getChatServerCurrentTime(),n=A.getOfflineGetRequestObject(e,0);T.request(n).then(function(e){e.sucs&&(_.offlineUpdateTime=t)})}function v(e,t,n,r){var i=n||h.UTILS.getUUIDPacketId(),o=r||10,a=A.getOfflineTagHistoryMessageRequestObject(e,t,o,i);return T.request(a)}function D(e,t,n,r){var i=n||h.UTILS.getUUIDPacketId(),o=r||10,a=A.getOfflineFriendHistoryMessageRequestObject(e,t,o,i);return T.request(a)}function R(e,t){var n=A.getOfflineTagUnreadMessageConfirmationObject(t);T.send(n)}function M(e,t,n){var r=A.getOfflineFriendUnreadMessageConfirmationObject(n,t);T.send(r)}function N(e){var t;return t=e.isTagChat?v:D}function y(e){var t=A.getOfflineFriendInformationObject(e.getUId(),e.getName(),e.getOnlineStatus(),e.getPlatform(),e.getAppType()||1,e.getDeviceToken(),e.getUserMood(),0);T.send(t)}return{getUnreadMessagesMultipleTimes:C,getTagHistoryMessagesMultipleTimes:v,getFriendHistoryMessagesMultipleTimes:D,getHistoryRequestMethodByBox:N,sendTagUnreadMessageConfirmation:R,sendFriendUnreadMessageOfflineConfirmation:M,sendFriendInformation:y}}var chatApp=angular.module("ringid.chat");chatApp.factory("ChatResponseProcessor",ChatResponseProcessor),ChatResponseProcessor.$inject=["tagChatFactory","Auth","ChatFactory","chatHistoryFactory","CHAT_LANG","Utils","tagChatUI","SystemEvents"];function ChatResponseProcessor(e,t,n,r,i,o,a,s){var c=window.CHAT_APP.Constants,l=c.GENERAL_CONSTANTS,u=CHAT_APP.CHAT_SESSION;function d(e,t,i){var o=n.getBoxByUId(e);return o||(n.creatNonDomBox(e,i),o=n.getBoxByUId(e),o.nonDomBox=t||!1,r.updateBox(o)),o}function g(e){u.UnRegister(e)}function m(e){var t=l.MESSAGE_STATUS_VALUE[e];return t&&(t=t.charAt(0)+t.substr(1).toLowerCase()),t}function E(e,o,a,s,c){var u,d=c,g=!1;d||(d=n.getBoxByUId(e)),o===t.currentUser().getKey()?(d&&d.removeMessage(a),r.removeMessage(a,e)):(u=d?d.getMessage(a):r.getMessage(e,a),u||(u=s,g=!0),u.messageType=l.MESSAGE_TYPES.DELETE_MESSAGE,u.message=i.CHAT.MESSAGE_DELETE_TEXT,u.status="Deleted",d?g&&d.pushMessage(u,o):r.updateMessage(u,e))}function f(e,n){var r;return r=e===t.currentUser().getKey()?n:e}function p(e,t){return d(e,t,!1)}function T(e,t){t&&("Seen"!==t.status&&"Deleted"!==t.status&&"Viewed"!==t.status&&"Played"!==t.status&&(t.status="Delivered"),r.updateMessage(t,e))}function h(e){g(e)}function I(t,n,r){var i,o=r;return o||(o=e.getTag(t)),i=d(t,n,!0),o&&i.setTitle(o.getTagName()),i}function _(e){g(e)}function A(t){var n,r=t.userId,i=t.tagId,o=t.tagMembers,s=t.packetId,c=t.messageDate||null;n=e.getOrCreateTag(i),a.showTagMembersAddStatusMessage(i,r,o,c,t.fromHistory,s,n),n&&!t.fromHistory&&b(n,o,r)}function S(t){var n,r,i=t.userId,o=t.tagId,s=t.tagMembers,c=t.packetId,l=t.messageDate||null;delete t.packetId,n=e.getOrCreateTag(o),a.showTagMembersRemoveStatusMessage(o,i,s,l,t.fromHistory,c,n),t.fromHistory||(r=O(n,s),r&&(y(o),_(o)))}function C(t){var n,r=t.tagId,i=e.getTag(r);i?(a.showTagInfoChangeStatusMessage(r,t.userId,t,t.fromHistory),t.fromHistory||(n=e.updateTag(r,t,i))):t.fromHistory||(n=e.createNewTag(t),e.addTagObject(n)),o.triggerCustomEvent(s.CHAT.TAG_LIST_UPDATED,{tagId:r})}function v(t){var n,r=t.userId,i=t.tagId,o=t.tagMembers,s=t.packetId,c=t.messageDate||null;n=e.getOrCreateTag(i),a.showMemberTypeChangeStatusMessage(i,r,o,c,t.fromHistory,s),t.fromHistory||P(n,o)}function D(e){var t=I(e.tagId);t.updateBoxMessageMinMaxPacketId(e)}function R(e){var t=I(e.tagId);t.updateBoxMessageMinMaxPacketId(e)}function M(e,t,n){if(n.changedByUserId===n.userId&&n.status===l.MEMBER_STATUS.OWNER)return void R({tagId:e});switch(n.activityType){case l.TAG_ACTIVITY_TYPE.DELETED:S({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.ADDED:A({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status,fullName:n.activityValue}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.LEAVE:S({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.TAG_RENAME:C({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,fromHistory:n.fromHistory,statusMessageType:l.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE});break;case l.TAG_ACTIVITY_TYPE.MEMBER_TYPE_CHANGE:v({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagMembers:[{userId:n.userId,status:n.status}],fromHistory:n.fromHistory});break;case l.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:C({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagPictureUrl:n.activityValue,fromHistory:n.fromHistory,statusMessageType:l.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE});break;case l.TAG_ACTIVITY_TYPE.TAG_CREATED:D({userId:n.changedByUserId,packetId:t,tagId:e,messageDate:n.activityDate,tagName:n.activityValue,tagMembers:[],fromHistory:n.fromHistory})}}function N(e){var t,n,r=e.packetType,i=e.tagId,o=e.packetId,a=e.messageDate;RingLogger.information("GROUP ACTIVITY MSG",e,RingLogger.tags.TAG_CHAT_RESPONSE);try{n=angular.fromJson(e.message)}catch(t){return void RingLogger.alert("INVALID JSON IN GROUP ACTIVITY MESSAGE",e.message,RingLogger.tags.TAG_CHAT)}t={changedByUserId:e.userId,userId:n.mId,status:n.mT,activityValue:n.n,activityType:r,activityDate:a,fromHistory:e.fromHistory||!1},M(i,o,t)}function y(e){var t=n.getBoxByUId(e);t&&(n.closeChatBox(t.getKey()),r.removeOpenBox(t.getKey()))}function b(t,n,r){var i,o,a;for(i=0;i<n.length;i++)o=n[i],r&&(o.addedBy=r),a=e.createNewTagMember(t.getTagId(),o,!1),a.isRemoved()||t.addMember(a)}function O(e,t){var n,r,i=!1;for(n=0;n<t.length;n++)r=e.getMember(t[n].userId),r&&(i=r.isCurrentUser(),e.removeMember(r));return i}function P(e,t){var n,r,i;for(n=0;n<t.length;n++)r=t[n],e&&(i=e.getMember(r.userId),i&&i.setStatus(r.status))}return{doFriendUnregisterTask:h,getFriendBoxId:f,getFriendBox:p,updateMessageStatusToDelivered:T,doOnMessageTypeDeleteMessage:E,getMessageStatus:m,doTagUnregisterTask:_,getTagChatBox:I,processAGroupActivity:M,processGroupActivityMessage:N,addMembersToTagObject:b,removeMembersFromTagObject:O,updateMemberStatusInTagObject:P,processTagMemberAddUpdate:A,processTagMemberRemoveLeave:S,processTagInformation:C,processTagMemberStatusChange:v}}angular.module("ringid.chat").directive("rgImageCapture",rgImageCapture),rgImageCapture.$inject=["Utils","rgRecorderService"];function rgImageCapture(e,t){return{link:function(n){var r,i,o={CAPTURE:"Capture",RETAKE:"ReTake"};n.videoId=e.getUniqueID("rgRec"),n.showLoader=!0,n.media=null,n.errorText="",n.connected=!1,n.captureText=o.CAPTURE;function a(){return document.querySelector("#"+n.videoId)}r={text:{PERMISSION_DENINED:"Please enable webcam permission",WEBCAM_DISCONNECTED:"Please connect webcam.",GUM_NOT_SUPPORTED:"Webcam capture not supported in your browser. Please use upgraded browser."}},i=t.getRecorderInstance(r),i.on("streamReady",function(e){n.showLoader=!1,n.connected=!0,n.$rgDigest();try{a().appendChild(e.media),n.media=e.media,e.media.play()}catch(e){RingLogger.alert("Stream Ready Exception",e)}}),i.on("error",function(e){n.errorText=e.text,n.showLoader=!1,n.connected=!1,n.$rgDigest()}),n.connect=function(){n.showLoader=!0,n.connected=!1,i.openMedia({video:!0,audio:!1})},setTimeout(function(){n.connect()},500),n.doCapture=function(){var e;n.captureText===o.CAPTURE?(e=i.captureImage(),e&&(n.capturedMedia=e,n.captureText=o.RETAKE),n.media&&n.media.pause()):(n.capturedMedia=null,n.captureText=o.CAPTURE,n.media.play()),n.$rgDigest()},n.$on("$destroy",function(){i.destroy()})},templateUrl:"templates/partials/recorder/image.html"}}openBox.$inject=["ChatFactory","tagChatFactory","rgDropdownService","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"];function openBox(e,t,n,r,i,o,a,s){return{link:function(c,l,u){l.on("click",function(l){var d,g,m,E,f=CHAT_APP.Constants.GENERAL_CONSTANTS,p=f.SESSION_TYPES,T=!!u.boxId&&u.boxId;T&&String(u.openChatBox)!==String(i.currentUser().getKey())&&(E="true"===String(u.isTagChat),r.safeDigest(c),n.close(l),g=!1,E?(d=t.getTag(T),d&&d.isTagSafeToShow()&&(g=!0,d=t.getTag(T),a.startChatSession(T,p.TAG,d.getMemberUserIds()),e.openTagChatBox(T,!0))):(a.startChatSession(T,p.FRIEND),e.openChatBox(T,!0)),m=e.getBoxByUId(T),m&&(o.decreaseUnreadCount(m),g&&m.setTitle(d.getTagName())),r.safeDigest(c),s.$broadcast("focusOn",T),l.preventDefault(),l.stopPropagation())})}}}openChatBox.$inject=["ChatFactory","Utils","Auth","ChatHelper","ChatWorkerCommands","$rootScope"];function openChatBox(e,t,n,r,i,o){return{link:function(a,s,c){s.on("click",function(s){var l,u,d=c.openChatBox,g=CHAT_APP.Constants.GENERAL_CONSTANTS,m=g.SESSION_TYPES;return d?String(d)===String(n.currentUser().getKey())?void RingLogger.alert("Same User ChatBox",RingLogger.tags.CHAT):(t.safeDigest(a),e.openChatBox(d,!0),l=e.getBoxByUId(d),1===l.getUser().friendshipStatus()?i.startChatSession(d,m.FRIEND):(u=n.getPermission(),1===u.ancht?i.startChatSession(d,m.FRIEND):(l=e.getBoxByUId(d),l.blocked=!0)),l&&r.decreaseUnreadCount(l),o.$broadcast("focusOn",d),s.preventDefault(),void s.stopPropagation()):void RingLogger.alert("Invalid ChatBoxId to open box",RingLogger.tags.CHAT)})}}}openTagChatBox.$inject=["ChatFactory","tagChatFactory","tagChatManager","Auth","$rootScope","ChatHelper","ChatWorkerCommands"];function openTagChatBox(e,t,n,r,i,o,a){return{link:function(n,s,c){s.on("click",function(n){var s,l,u=CHAT_APP.Constants.GENERAL_CONSTANTS,d=u.SESSION_TYPES,g=c.openTagChatBox;g<=0||String(c.openChatBox)!==String(r.currentUser().getKey())&&(s=t.getTag(g),l=e.openTagChatBox(g,!0),l.setTitle(s.getTagName()),s&&s.isTagSafeToShow()&&s&&a.startChatSession(g,d.TAG,s.getMemberUserIds()),l&&o.decreaseUnreadCount(l),i.$broadcast("focusOn",g),n.preventDefault(),n.stopPropagation())})}}}makeVisibleChatBox.$inject=["ChatFactory"];function makeVisibleChatBox(e){return{link:function(t,n,r){n.on("click",function(i){t.rbox.value.isFocused=!0,e.makeVisibleChatBox(r.makeVisibleChatBox),n.parent().parent().children().eq(0).removeClass("blink"),i.preventDefault()})}}}showHiddenBoxes.$inject=["ChatFactory"];function showHiddenBoxes(e){return{link:function(t,n,r){n.on("click",function(){e.openChatBox(r.openChatBox)})}}}closeBox.$inject=["ChatFactory","chatHistoryFactory","tagChatFactory"];function closeBox(e,t,n){return{restrict:"A",link:function(r,i){i.on("click",function(){var i;e.closeChatBox(r.box.value.getKey()),t.removeOpenBox(r.box.value.getKey()),i=n.getTag(r.box.value.getKey()),i&&i.initMessages(),r.$parent.$digest()})}}}minimizeBox.$inject=["ChatFactory","$rootScope"];function minimizeBox(e,t){return{restrict:"A",link:function(n,r){r.on("click",function(r){n.box.value.blinkOn&&!n.box.value.isMinimized?(n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):n.box.value.blinkOn&&n.box.value.isMinimized?(e.minimizeBox(n.box.value.getKey()),n.$broadcast("blinkerOff",n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):n.box.value.blinkOn||n.box.value.isMinimized?!n.box.value.blinkOn&&n.box.value.isMinimized&&(e.minimizeBox(n.box.value.getKey()),t.$broadcast("focusOn",n.box.value.getKey())):(e.minimizeBox(n.box.value.getKey()),t.$broadcast("focusOn",null)),n.$digest(),r.stopPropagation()})}}}tagChatEdit.$inject=["ChatFactory","rgDropdownService"];function tagChatEdit(e,t){return{restrict:"A",link:function(e,t){t.on("click",function(t){e.showDropdown=!e.showDropdown,t.stopPropagation()})},controller:["$scope","tagChatFactory","tagChatManager","Auth","Ringalert","$compile",function(e,n,r,i,o){e.showDropdown=!1,e.hasTagObjectLock=function(e){var t=n.getTag(e);return!!t&&t.hasObjectLock()},e.getTagDDControl=function(e){var t=n.getTag(e),r=t.getMember(i.loginData.uId);return{tagId:e,isOwner:!!r&&r.isOwner()}},e.tagMemberDDActions=a,e.tagMemberDDHtml="templates/partials/tag-chat/member-actions-dropdown.html";function a(e){var a,s;switch(e.action){case"edit":case"view":t.close(e.event),a=function(){return{tagId:e.tagId}};break;case"delete":t.close(e.event),s=n.getTag(e.tagId),s.setObjectLock(),r.leaveFromTag(e.tagId,i.currentUser().getKey()).then(function(e){s.removeObjectLock(),o.show(e,"info")},function(e){s.removeObjectLock(),o.show(e,"error")})}return a}}]}}chatScrollBottom.$inject=["$scrollbar","Utils","SystemEvents","ChatHelper"];function chatScrollBottom(e,t,n,r){return{restrict:"A",link:function(i,o){var a,s,c={minThumbHeight:20},l=e.create(o[0],c);i.$on("ScrollToBottom",function(e,t){String(t)===String(i.box.value.getKey())&&(o[0].scrollTop=o[0].scrollHeight,e.preventDefault())}),i.bottomReached=function(){r.decreaseUnreadCount(i.box.value),i.$rgDigest()};function u(){RingLogger.information("ScrollToUnread Called for ",i.box.value.getKey(),"CHAT"),i.refreshScrollbar(!0,function(){var e=o[0].querySelector(".status-unread-container");e?l.scrollBySelector(".status-unread-container",!0):l.scrollBottom(!0),e=null,i.$rgDigest()})}i.scrollbarFreezed=!1,i.freezeScrollbar=function(){i.scrollbarFreezed=!0,l.freeze()},i.refreshScrollbar=function(e,t){(i.scrollbarFreezed||e)&&(i.scrollbarFreezed=!1,l.reCalculate(!0).then(function(){i.scroll=l.hasScroll,t&&t.call(this)})),i.bottomScrolled||(i.bottomScrolled=!0,u())},a=t.onCustomEvent(n.CHAT.SCROLL_TO_BOTTOM,function(e){String(e.boxId)===String(i.box.value.getKey())&&(RingLogger.information("ScrollToBottom Called for ",e.boxId,"CHAT"),i.refreshScrollbar(!0,function(){l.scrollBottom(!0),i.$rgDigest()}))}),s=t.onCustomEvent(n.CHAT.SCROLL_TO_UNREAD,function(e){String(e.boxId)===String(i.box.value.getKey())&&u()}),i.$on("$destroy",function(){t.removeCustomEvent(n.CHAT.SCROLL_TO_BOTTOM,a),t.removeCustomEvent(n.CHAT.SCROLL_TO_UNREAD,s)})}}}chatBlinker.$inject=["$window","chatHistoryFactory"];function chatBlinker(e,t){return{restrict:"A",link:function(e,n){e.box.value.blinkOn===!0&&n.addClass("blink"),e.$on("blinkerEvent",function(r,i){i.toString()===e.box.value.getKey()&&(e.box.value.isMinimized?e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0):e.box.value.isFocused===!1&&(n.addClass("blink"),e.box.value.blinkOn=!0),t.updateBox(e.box.value))}),e.$on("blinkerOff",function(r,i){i.toString()===e.box.value.getKey()&&(n.removeClass("blink"),e.box.value.blinkOn=!1,t.updateBox(e.box.value))}),e.$on("focusOn",function(t,r){r&&r.toString()===e.box.value.getKey()?n.addClass("chat-active"):(n.removeClass("chat-active"),e.box.value.isFocused=!1),e.$rgDigest()})}}}chatBlinkerH.$inject=["$window","chatHistoryFactory"];function chatBlinkerH(e,t){return{restrict:"A",link:function(e,n){e.$on("blinkerEvent",function(r,i){i.toString()===e.rbox.value.getKey()&&(n.addClass("blink"),n.parent().parent().children().eq(0).addClass("blink"),t.updateBox(e.rbox.value))})}}}chatSelectEmo.$inject=[];function chatSelectEmo(){return{restrict:"A",link:function(e){e.selectEmoticon=function(t){e.messageText=e.messageText+t.symbol()}}}}chatBindOutsideClick.$inject=["$document","Utils"];function chatBindOutsideClick(e,t){return{restrict:"A",link:function(n,r){r.bind("click",function(e){e.stopPropagation()}),e.bind("click",function(){n.showHidden=!1,t.safeDigest(n)})}}}sharedContent.$inject=["Utils"];function sharedContent(e){return{restrict:"A",link:function(t){t.initMessageData=function(){t.messageData={ogData:{},locationData:{}}},t.resetOgInfo=function(){t.messageData.ogData={},t.ogStatus={preview:!1,loading:!1,filterOnProgress:!1}},t.resetMessageLocation=function(){t.messageData.locationData={description:"",lat:"",lng:""}},t.resetMessageText=function(){t.messageText=""},t.resetBottomMenu=function(){t.showBottomMenu=!1},t.resetMessageInput=function(n){t.initMessageData(),t.resetBottomMenu(),t.resetMessageText(),t.resetOgInfo(),t.resetMessageLocation(),n&&e.safeDigest(t)},t.resetMessageInput(!1)}}}angular.module("ringid.chat").directive("openBox",openBox).directive("openChatBox",openChatBox).directive("openTagChatBox",openTagChatBox).directive("makeVisibleChatBox",makeVisibleChatBox).directive("showHiddenBoxes",showHiddenBoxes).directive("closeBox",closeBox).directive("minimizeBox",minimizeBox).directive("tagChatEdit",tagChatEdit).directive("chatScrollBottom",chatScrollBottom).directive("chatBlinker",chatBlinker).directive("chatBlinkerH",chatBlinkerH).directive("chatBindOutsideClick",chatBindOutsideClick).directive("sharedContent",sharedContent);function getMessagePacketIdForHistoryRequest(e){var t=e.key;if("status_update"===String(e.status))try{t=t.split("_")[0]}catch(e){RingLogger.log("Trycatch block demands no empty block","CHAT")}return t}function doHistoryRequest(e,t,n,r,i){var o,a,s,c,l,u=CHAT_APP.Constants.GENERAL_CONSTANTS;n&&n.nonDomBox&&(a=n.messageMinPacketId,o=n.messageMaxPacketId,o||(o=i),a||(a=i),s=t.getHistoryRequestMethodByBox(n),c=String(o)===String(a),l=u.HISTORY_MAX_MESSAGE+2,r&&r!==u.PAGE_DIRECTION.UP||doSendHistoryRequest(e,s,n,u.PAGE_DIRECTION.UP,a,l),c||r||r&&r!==u.PAGE_DIRECTION.DOWN||doSendHistoryRequest(e,s,n,u.PAGE_DIRECTION.DOWN,o,l))}function doSendHistoryRequest(e,t,n,r,i,o){var a=n.getKey();e.historyLoading=!0,t.call(this,a,r,i,o).then(function(t){t.sucs&&(e.historyLoading=!1),e.refreshScrollbar()},function(){e.historyLoading=!1,n.hasHistoryMessage=!0,e.refreshScrollbar()}),setTimeout(function(){e.historyLoading||(e.historyLoading=!1,e.refreshScrollbar())},1e4)}function scrollChatBoxToBottom(e,t,n,r,i){setTimeout(function(){n.bottomScrolled||(n.bottomScrolled=r,e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:n.getKey()}))},i)}chatBoxUi.$inject=["Utils","SystemEvents","ChatFactory","$rootScope","chatRequestProcessor","chatTabSync","StickerFactory","$document"];function chatBoxUi(e,t,n,r,i,o,a,s){var c="templates/chatbox.html";return{restrict:"E",replace:!0,scope:!0,templateUrl:c,link:function(e){setTimeout(a.initStickerData,5e3),s.on("click",function(){r.$broadcast("focusOn",null)}),e.$on("$destroy",function(){})}}}function extraChatBoxes(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/extra-chatboxes.html"}}singleChatBox.$inject=["Utils","$rootScope","SystemEvents","chatTabSync","ChatFactory","chatRequestProcessor"];function singleChatBox(e,t,n,r,i,o){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-chatbox.html",link:function(i){var a,s,c,l,u,d=CHAT_APP.Constants.GENERAL_CONSTANTS,g={},m=!1,E=i.box.value;function f(r){RingLogger.log("BOX CALLBACK",r,"CHAT"),i.refreshScrollbar(!0),e.safeDigest(i),!r.noScroll&&i.bottomScrolled&&e.triggerCustomEvent(n.CHAT.SCROLL_TO_UNREAD,{boxId:r.boxId}),r.blink&&t.$broadcast("blinkerEvent",r.boxId)}function p(t){var n=t.boxId.toString();String(n)===String(i.box.value.getKey())&&(g[n]||(g[n]={}),g[n][t.type]||(g[n][t.type]=e.debounce(function(e){f(e)},500,!1)),g[n][t.type].call(this,t))}l=e.onCustomEvent(n.CHAT.API_HISTROY_PROCESSED,function(t){var r=t.boxId;String(r)===String(i.box.value.getKey())&&(scrollChatBoxToBottom(e,n,i.box.value,!0,0),e.removeCustomEvent(n.CHAT.API_HISTROY_PROCESSED,l))}),s=e.onCustomEvent(n.CHAT.TAG_LIST_UPDATED,function(e){e.type="tag_updated",e.noScroll=!0,e.blink=!1,e.boxId=e.tagId,p(e)}),u=e.onCustomEvent(n.CHAT.MESSAGE_PUSHED,function(e){e.type="pushed",e.noScroll=e.noScroll||e.fromLocalHistory||e.fromHistory||e.isEdit||!1,e.blink=!e.fromHistory||!e.fromLocalHistory||!0,p(e)}),c=e.onCustomEvent(n.CHAT.BOX_UPDATED,function(t){String(t.boxId)===String(i.box.value.getKey())&&e.safeDigest(i)}),i.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.API_HISTROY_PROCESSED,l),e.removeCustomEvent(n.CHAT.MESSAGE_RECEIVED,u),e.removeCustomEvent(n.CHAT.BOX_UPDATED,c),e.removeCustomEvent(n.CHAT.TAG_LIST_UPDATED,s)}),E.loadHistoryMessages(),E.messages.length>=d.HISTORY_MAX_MESSAGE&&(m=!0),E.messages.length<d.HISTORY_MAX_MESSAGE?(a=CHAT_APP.UTILS.getUUIDPacketId(),doHistoryRequest(i,o,E,null,a)):(doHistoryRequest(i,o,E,d.PAGE_DIRECTION.DOWN,a),m=!0),scrollChatBoxToBottom(e,n,E,m,10),r.sendData(d.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE,{boxId:i.box.value.getKey()})}}}function chatBoxTopBar(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar.html"}}function chatBoxTopBarMenu(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar-menu.html",link:function(e){var t=e.box.value;e.hideTopbar=!0,setTimeout(function(){e.hideTopbar=!1,e.$rgDigest()},3e3),e.shouldShowLastOnlineBar=function(){return t.offlineStatus&&t.lastSeenBar&&!!t.getUser().lastOnline&&t.getUser().lastOnline()},e.shouldShowFriendSuggestion=function(){return!t.hideSuggestion&!t.isTagChat&&!!t.getUser()&&1!==t.getUser().friendshipStatus()&&!t.offlineStatus},e.shouldShowChatBoxTopbarMenu=function(){return!t.isTagChat&&(e.shouldShowLastOnlineBar()||e.shouldShowFriendSuggestion())}}}}function chatBoxUrlPreview(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-url-preview.html"}}chatBoxBottom.$inject=["Utils","$document"];function chatBoxBottom(e){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-bottom.html",link:function(t){t.toggleMenu=function(){t.showBottomMenu=!t.showBottomMenu,e.safeDigest(t)}}}}function chatBoxLocationInfo(){return{restrict:"E",replace:!0,link:function(){},templateUrl:"templates/partials/chat/chatbox-location-info.html"}}chatBoxBottomMenu.$inject=["Utils","rgRecorderService"];function chatBoxBottomMenu(e,t){return{restrict:"E",replace:!0,link:function(e,n){e.showMediaButton=t.hasUserMediaSupport(),n.on("mouseover",function(){e.$parent.bottomMenuHover=!0}),n.on("mouseleave",function(){e.$parent.bottomMenuHover=!1})},templateUrl:"templates/partials/chat/chatbox-bottom-menu.html"}}chatBoxMiddle.$inject=["$rootScope","Utils"];function chatBoxMiddle(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-middle.html",link:function(){}}}chatSingleMessage.$inject=["Utils","$ringbox","SystemEvents","$$mediaMap"];function chatSingleMessage(e,t,n){return{restrict:"E",replace:!0,link:function(r){var i,o,a;i=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,function(t){var n=t.message;String(n.key)===String(r.message.key)&&e.safeDigest(r)}),r.openRingboxContent=function(n){o=t.open({type:"remote",scopeData:{message:n,viewport:e.viewport},resolve:{data:{}},onBackDropClickClose:!0,templateUrl:"templates/partials/chat/media-preview.html"})},r.getMediaData=function(e){return{data:function(){return{media:e}},promise:e.fetchDetails()}},a=e.onCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,function(){o&&o.close()}),r.$on("$destroy",function(){e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_UPDATED,i),e.removeCustomEvent(n.CHAT.SINGLE_MESSAGE_TIMEOUT,a)})},templateUrl:"templates/partials/chat/message/single.html"}}function chatFileUploadProgress(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/message/upload-progress.html"}}singleMessageStatus.$inject=["Utils","ChatUtilsFactory"];function singleMessageStatus(e,t){function n(e,t){var n=t?t:"Pending";return"Sent"===n&&(n="Delivered"),n}function r(e){return t.getChatVerbalDateFromServerDate(e)}return{restrict:"E",replace:!0,link:function(e){e.$watch("message.status",function(){e.message.statusText=n(e.box.value.isTagChat,e.message.status),e.message.statusDate=r(e.message.messageDate),e.message.statusUserName=e.message.user.getName()})},templateUrl:"templates/partials/chat/message/status.html"}}chatHistoryLoader.$inject=["chatRequestProcessor"];function chatHistoryLoader(e){return{restrict:"E",replace:!0,link:function(t,n){var r=CHAT_APP.Constants.GENERAL_CONSTANTS;t.historyLoading=!1,n.on("click",function(){var n=CHAT_APP.UTILS.getUUIDPacketId();t.freezeScrollbar(),doHistoryRequest(t,e,t.box.value,r.PAGE_DIRECTION.UP,n)})},templateUrl:"templates/partials/chat/history-loader-view.html"}}function singlePageChatUI(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}}function chatSinglePageTop(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/top.html"}}function chatSinglePageLeft(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/left.html"}}function chatSinglePageRight(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/right.html"}}function chatLeftSingleBox(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/left-single-box.html"}}function chatRightSingleBox(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/right-single-box.html"}}function chatMessageBox(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/single-page/message-box.html"}}function chatBoxTopBarStatus(){return{restrict:"E",replace:!0,templateUrl:"templates/partials/chat/chatbox-topbar-status.html",link:function(){}}}angular.module("ringid.chat").directive("chatBoxUi",chatBoxUi).directive("chatBoxTopBar",chatBoxTopBar).directive("chatBoxMiddle",chatBoxMiddle).directive("chatBoxBottom",chatBoxBottom).directive("extraChatBoxes",extraChatBoxes).directive("chatBoxUrlPreview",chatBoxUrlPreview).directive("chatBoxTopBarStatus",chatBoxTopBarStatus).directive("chatBoxTopBarMenu",chatBoxTopBarMenu).directive("chatBoxBottomMenu",chatBoxBottomMenu).directive("chatBoxLocationInfo",chatBoxLocationInfo).directive("chatSingleMessage",chatSingleMessage).directive("chatFileUploadProgress",chatFileUploadProgress).directive("singleMessageStatus",singleMessageStatus).directive("chatHistoryLoader",chatHistoryLoader).directive("singleChatBox",singleChatBox).directive("chatSinglePageTop",chatSinglePageTop).directive("chatSinglePageLeft",chatSinglePageLeft).directive("chatLeftSingleBox",chatLeftSingleBox).directive("chatSinglePageRight",chatSinglePageRight).directive("chatRightSingleBox",chatRightSingleBox).directive("chatMessageBox",chatMessageBox).directive("singlePageChatUI",singlePageChatUI);var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){RingLogger.log("trycatch block, no empty block allowed by eslint","CHAT")}chatApp.directive("chatFocus",chatFocusDirective),chatFocusDirective.$inject=["fileUploadService","chatHistoryFactory","$document","$rootScope","Utils","Auth","ChatHelper","SystemEvents","settings","ChatSeenSend","ChatPacketSenderService","chatTabSync","Ringalert","ChatConnector","ChatUtilsFactory"],chatFocusDirectiveControllerFunction.$inject=["$scope","ChatSeenSend","ChatHelper","Auth","rgScrollbarService","ChatUtilsFactory","SystemEvents","Utils"];function chatFocusDirectiveControllerFunction(e,t,n,r,i,o,a,s){e.onViewedCalled=function(i){var o,a=e.box.value,s=e.box.value.isTagChat,c=[{key:i.key,value:i}],l=function(e){var t,n,i=[];for(t=0,n=e.length;t<n;t++)e[t].value.user.getKey()!==r.loginData.uId&&"Deleted"!==e[t].value.status&&"Played"!==e[t].value.status&&"Viewed"!==e[t].value.status&&"status_update"!==e[t].value.status&&"true"!==String(e[t].value.seenSent)&&i.push(e[t]);return i};if(angular.isArray(c)&&c.length>0){if(c=l(c),c.length<1)return;o=t.sendSeenPacket(a,c),o&&o.then(function(){e.$rgDigest()}),s||n.startTimerOthers(e,c)}},e.showUnreadMessages=function(){var t=e.box.value;RingLogger.print("Unread Messages shown",RingLogger.tags.CHAT),n.decreaseUnreadCount(t),s.triggerCustomEvent(a.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey(),topAlign:!0})}}function chatFocusDirective(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E){var f=CHAT_APP.Constants,p=f.GENERAL_CONSTANTS,T=CHAT_APP.SharedHelpers;return{controller:chatFocusDirectiveControllerFunction,link:function(n,m){var f,h,I,_,A,S,C,v,D=n.box.value.getKey();n.uploadBoxValue=n.box.value.getKey(),n.uploadAction=function(t){var r=i.getUniqueID("ring");RingLogger.print(t,RingLogger.tags.CHAT);function a(t){var o,a;RingLogger.print(t,RingLogger.tags.CHAT),e.removeScope(n),t.sucs&&(v=n.box.value,C=v.isTagChat,o={url:t.url,caption:t.caption,width:t.iw,height:t.ih},a=c.imBase+t.url,v.removeMessage(r),i.safeDigest(n),u.sendMessage(v,a,p.MESSAGE_TYPES.IMAGE,{mediaData:o}),n.resetMessageInput(),i.safeDigest(n))}function s(){g.show({mg:"Image Upload Failed, please try again"},"error"),v.removeMessage(r),n.$rgDigest()}t.uploadFile.fetchMeta(function(){var c={key:r,uploadProgress:t.uploadFile.getProgress,uploading:!0,message:" ",mediaUrl:t.uploadFile.getPreview(),messageDate:T.getChatServerCurrentTime(),messageType:p.MESSAGE_TYPES.IMAGE,packetId:r,sessionId:i.getToken,timeout:0,status:0,userId:o.currentUser().getKey(),getMessageTime:function(){return E.getChatVerbalDateFromServerDate(c.messageDate)},fileUploadObject:t.uploadFile};n.box.value.pushDummyMessage(c,o.currentUser(),!0),e.setScopeForDigest(n),i.safeDigest(n),t.uploadFile.initUpload().then(function(e){c.uploading=!1,a(e)},function(e){c.uploading=!1,s(e)})})},f=i.onCustomEvent(s.CHAT.BOX_CAM_UPLOAD,function(e){String(n.box.value.getKey())===String(e.boxId)&&n.uploadAction(e)}),S=n.box.value.getMessages(),v=n.box.value,C=n.box.value.isTagChat;function R(e){var t,n,r=[];for(t=0,n=e.length;t<n;t++)switch(e[t].value.messageType){case 2:case 3:case 4:case 5:case 6:r.push(e[t])}return r}function M(e){var t,n,r=[];for(t=0,n=e.length;t<n;t++)String(e[t].value.user.getKey())!==o.loginData.uId&&"Deleted"!==String(e[t].value.status)&&"Played"!==String(e[t].value.status)&&"Viewed"!==String(e[t].value.status)&&"status_update"!==String(e[t].value.status)&&Boolean(e[t].value.seenSent)!==!0&&r.push(e[t]);return r}function N(e){var n,r,i=[];for(n=0,r=e.length;n<r;n++)"Unread"!==String(e[n].value.status)||e[n].value.timeout&&0!==e[n].value.timeout||(e[n].value.status="Received",i.push(e[n].value));t.updateMessages(i,v.getKey())}function y(e){t.removeUnreadMessageInfoByBoxId(e)}A=i.onCustomEvent(s.CHAT.TAB_SYNC_NEW_DATA,function(e){var t;if(p.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER===e.type&&(RingLogger.information("TAB_FOCUS_TIMER",e,RingLogger.tags.CHAT),String(e.boxId)===String(v.getKey())&&angular.isArray(S)&&S.length>0)){if(t=M(S),t=R(t),t.length<1)return;N(S),y(e.boxId),v.updateUnreadCount(),C||a.startTimerText(n,t)}}),_=i.onCustomEvent(s.CHAT.WAS_FOCUSED,function(e){var t,r;e&&e.box&&(t=e.box,r=e.filteredMessages,String(t.getKey())===String(v.getKey())&&(t.isTagChat||a.startTimerText(n,r),d.sendData(p.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:t.getKey()})))}),I=i.onCustomEvent(s.CHAT.DO_START_SECRET_TIMER,function(e){e&&String(e.boxId)===String(D)&&(e.others?a.startTimerOthers(n,e.messages):a.startTimerText(n,e.messages))}),h=function(e){var t,o,s;for(e.stopPropagation(),D=n.box.value.getKey(),v=n.box.value,t=!1,v.unreadCount>0&&(y(D),v.updateUnreadCount(),t=!0),RingLogger.print("Focus Called",RingLogger.tags.CHAT_0),n.bottomMenuHover||n.bottomMenuButtonHover||(n.showBottomMenu=!1,t=!0),t&&i.safeDigest(n),o=0;o<n.boxes.length;o++)n.boxes[o].value.isFocused=!1;if(v.isMinimized===!0?v.isFocused=!1:v.isFocused=!0,n.$broadcast("blinkerOff",D),r.$broadcast("focusOn",D),
angular.isArray(S)&&S.length>0){if(s=M(S),s=R(s),s.length<1)return;N(S),l.sendSeenPacket(v,s),C||a.startTimerText(n,s),d.sendData(p.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:v.getKey()})}},m.on("click",h),n.$on("$destroy",function(){i.removeCustomEvent(s.CHAT.BOX_CAM_UPLOAD,f),i.removeCustomEvent(s.CHAT.DO_START_SECRET_TIMER,I),i.removeCustomEvent(s.WAS_FOCUSED,_),i.removeCustomEvent(s.CHAT.TAB_SYNC_NEW_DATA,A)})}}}var chatApp,ChatRequests;chatApp=angular.module("ringid.chat"),ChatRequests=CHAT_APP.ChatRequests,chatMessageDirective.$inject=["Auth","$compile","chatHistoryFactory","$interval","ChatHelper","Utils","userFactory","userService","SystemEvents"];function chatMessageDirective(e,t,n,r,i,o,a,s,c){return{restrict:"A",scope:!0,link:function(r,l,u){var d,g,m,E,f,p=r.$eval(u.messageBox),T=r.$eval(u.messageMsg),h=[],I=[];p=p.value;function _(){var e;return e=!p.isConsicutive(T.key)}r.message.takeDecisionForShowingMessageUserAvator=_,r.message.showAvator=_(),T.user.isCurrentUser()?(l.addClass("cm-box-r"),"status_update"!==T.status&&(f='<img ng-show="message.showAvator" title="',f+=T.user.getName(),f+='" class="chat-img-r chat-img" src="'+T.user.avatar("thumb")+'" />',d=angular.element(f),g=t(d)(r),l.append(g))):(l.addClass("cm-box"),"status_update"!==T.status&&(f='<img ng-show="message.showAvator" title="',f+=T.user.getName(),f+='" class="chat-img-l chat-img" src="'+T.user.avatar("thumb")+'" />',d=angular.element(f),g=t(d)(r),l.prepend(g)));function A(){var e,t=Math.floor(T.messageDate/864e5);return p.previousDate!==t?(p.previousDate=t,e=!0):e=!1,e}r.message.takeDecisionForShowingDate=A,r.message.showDate=A(),m=angular.element('<div class="line" ng-show="message.showDate"><div class="line-m">{{ message.messageDate | date }}</div></div><div ng-show="message.showDate" class="clear"></div>'),E=t(m)(r),l.prepend(E),r.$on("timeoutDelete",function(t,a,s){var l;if(a===T.key)if(RingLogger.debug(a+":"+s,"CHAT"),s>0)r.message.timeout=s;else if(l=T.user.getKey(),String(l)===String(e.loginData.uId)){switch(r.message.timeout=0,r.message.secretTimedOut=!0,r.message.messageType){case 2:case 3:case 4:case 5:case 6:r.message.status="Deleted";break;case 8:r.message.status="Played";break;case 7:case 9:case 10:r.message.status="Viewed"}n.updateMessage(r.message,p.getKey())}else i.deleteMessageFromOwn(p,T),o.triggerCustomEvent(c.CHAT.SINGLE_MESSAGE_TIMEOUT,{box:p})}),I.push(r.message.userId),"status_update"===String(r.message.status)&&angular.extend(I,r.message.usersToChange),I.forEach(function(e){var t,n=a.getUser(e);n&&n.hasDetails()||(t=s.register(e,o.debounce(function(){"status_update"===String(r.message.status)&&r.message.refreshStatusMessageText(),r.$rgDigest()},300,!1)),h.push(t))}),r.$on("$destroy",function(){h.forEach(function(e){s.unregister(e)})})}}}chatEditMessage.$inject=["$rootScope"];function chatEditMessage(e){return{restrict:"EA",link:function(t,n,r){var i=CHAT_APP.SharedHelpers;n.on("click",function(){e.$broadcast("editMessageEvent",r.editMessage,t.message),n.parent().parent().parent().addClass("editing-highlight")});function o(e){var t,n=i.getClientTimeFromServerTime(e),r=Math.floor(Date.now()),o=r-n,a=36e5;return t=!(o>a)}t.message.canEdit=function(){return t.message.user.isCurrentUser()&&o(t.message.messageDate)&&[4,6,7,8,9,10].indexOf(t.message.messageType)===-1&&!(t.message.timeout>0||Boolean(t.message.secretTimedOut)===!0)&&["Deleted","status_update","Viewed","Played"].indexOf(t.message.status)===-1}}}}chatRetryMessage.$inject=["ChatPacketSenderService"];function chatRetryMessage(e){return{restrict:"EA",link:function(t,n){n.on("click",function(){e.retryMessage(t.box.value,t.message,t.messageData)})}}}chatDeleteMessage.$inject=["Storage","Utils","Auth","ChatConnector","ChatHelper"];function chatDeleteMessage(e,t,n,r,i){return{restrict:"EA",link:function(e,t){e.message.canDelete=function(){return["status_update"].indexOf(e.message.status)===-1},t.on("click",function(){var t,o,a,s;i.deleteMessageFromOwn(e.box.value,e.message),e.message.user.getKey().toString()===n.loginData.uId.toString()&&(e.box.value.isTagChat?(t=e.box.value.getKey(),o=[{packetId:e.message.key}],s=ChatRequests.getTagChatMultipleMsgDeleteObject(t,o),r.send(s)):(Boolean(e.message.secretTimedOut)!==!0||e.message.timeout>0)&&(e.box.value.sendTabUpdate(e.message),a=e.box.value.getKey(),o=[{packetId:e.message.key}],s=ChatRequests.getFriendChatMultipleMsgDeleteObject(a,o),r.send(s)))})}}}chatMessageReact.$inject=["Api","userFactory","Utils"];function chatMessageReact(e,t,n){return{restrict:"A",link:function(r,i,o){var a=r.$eval(o.chatMessageReact),s=["status_pending","status_delivered","status_seen","status_sent"];function c(){"status_update"===String(a.status)?i.addClass("status_update"):a.user.isCurrentUser()?i.addClass("status_received"):s[a.status]&&i.addClass(s[a.status])}angular.isObject(a.user)?c():e.user.getUserDetailsByUId({uId:a.user}).then(function(e){e&&(a.user=t.create(e),c(),n.safeDigest(r))})}}}sendMessageDirective.$inject=["ChatFactory","$timeout","ChatConnector","tagChatFactory","tagChatManager","$$connector","OPERATION_TYPES","ChatPacketSenderService","ChatHelper","Utils","SystemEvents","Ringalert"];function sendMessageDirective(e,t,n,r,i,o,a,s,c,l,u,d){return{restrict:"A",link:function(e,t){var n=CHAT_APP.Constants.GENERAL_CONSTANTS;e.messageText="";function r(e){var t,n=0,r={startPos:0,endPos:0,selectionLength:0};return document.selection?(e.focus(),t=document.selection.createRange(),t.moveStart("character",-e.value.length),n=t.text.length,r.selectionLength=n):(e.selectionStart||"0"===String(e.selectionStart))&&(n=e.selectionStart,r.startPos=e.selectionStart,r.endPos=e.selectionEnd,r.selectionLength=Math.abs(e.selectionStart-e.selectionEnd)),r}function i(e,t,n){var r,i,o=e.value;return e.value=e.value,null!==e&&(e.createTextRange?(i=e.createTextRange(),e.value=o.slice(0,t.startPos)+n+o.slice(t.endPos),i.move("character",t.startPos+n.length),i.select(),r=!0):e.selectionStart||0===e.selectionStart?(e.focus(),e.value=o.slice(0,t.startPos)+n+o.slice(t.endPos),e.setSelectionRange(t.startPos+n.length,t.startPos+n.length),r=!0):(e.focus(),r=!1)),r}e.selectedLocation=function(){l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()}),l.getUserLocation().then(function(t){t.sucs?(e.messageData.locationData=t,t.lat&&9999!==t.lat?s.sendMessage(e.box.value,"",n.MESSAGE_TYPES.LOCATION_SHARE,e.messageData):RingLogger.alert("Location Lat not found.",t,RingLogger.tags.CHAT),e.$rgDigest()):(d.show({mg:"Please Enable Browser Location Tracking."},"error"),RingLogger.alert(t.error,RingLogger.tags.CHAT)),e.resetMessageInput(!0)})},e.selectEmoticonChat=function(n){n.isSticker()||n.isLargeEmoticon()?(e.resetMessageInput(),s.sendMessage(e.box.value,n.srcWithoutBase(),6),l.triggerCustomEvent(u.CHAT.MESSAGE_SUBMITTED,{boxId:e.box.value.getKey()}),e.messageText="",l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()})):(e.messageText=e.messageText+""+n.symbol(),t[0].focus())};function o(){function n(){e.box.value.isTyping()===!1&&(s.sendTypingPacket(e.box.value),e.box.value.setTypingBool(!0),setTimeout(function(){e.box.value.setTypingBool(!1),l.triggerCustomEvent(u.CHAT.BOX_UPDATED,{boxId:e.box.value.getKey()})},5e3))}function o(){e.box.value.isTagChat?n():e.box.value.offlineStatus===!1&&n()}t.on("keyup",function(n){var a,c,d;13===n.which&&n.ctrlKey&&(c=t[0],d=r(c),i(c,d,"\n"),e.messageText=c.value),13!==n.which||13===n.which&&n.ctrlKey?o():(t.attr("messageKey")&&(e.box.value.editMessageKey=t.attr("messageKey"),t.removeAttr("messageKey"),e.box.value.editMessageDate=t.attr("messageDate"),t.removeAttr("messageDate"),t.removeClass("editing"),t.removeClass("editing-highlight")),a=s.getMessageType(e.messageData),""!==e.messageText&&(e.messageText=e.messageText.replace(/^\s+|\s+$/g,""),e.messageText=e.messageText.replace(/\n\n+/g,"\n\n"),e.box.value.editMessageKey||l.triggerCustomEvent(u.CHAT.SCROLL_TO_BOTTOM,{boxId:e.box.value.getKey()}),s.sendMessage(e.box.value,e.messageText,a,e.messageData),e.resetMessageInput(!0),l.triggerCustomEvent(u.CHAT.MESSAGE_SUBMITTED,{boxId:e.box.value.getKey()})))})}function a(){t.off("keyup")}o(),e.$on("$destroy",a),e.box.value.isFocused===!0&&t[0].focus(),e.$on("editMessageEvent",function(r,i,o){if(String(e.box.value.getKey())===String(i)){switch(o.messageType){case n.MESSAGE_TYPES.TEXT:e.messageText=o.text;break;case n.MESSAGE_TYPES.LOCATION_SHARE:e.locationData=o.locationInfo;break;case n.MESSAGE_TYPES.LINK_SHARE:e.messageText=o.ogData.message||o.ogData.description}t.addClass("editing"),t.attr("messageKey",o.key),t.attr("messageDate",o.messageDate),l.safeDigest(e),t[0].focus()}})}}}chatImage.$inject=["Utils","SystemEvents"];function chatImage(e,t){return{restrict:"A",link:function(n,r,i){r[0].onload=function(){n.message.scroll&&e.triggerCustomEvent(t.CHAT.SCROLL_TO_BOTTOM,{boxId:i.boxid})},r[0].src=i.chatimgsrc}}}chatApp.directive("messageDirective",chatMessageDirective),chatApp.directive("editMessage",chatEditMessage),chatApp.directive("retryMessage",chatRetryMessage),chatApp.directive("deleteMessage",chatDeleteMessage),chatApp.directive("chatMessageReact",chatMessageReact),chatApp.directive("sendMessageDirective",sendMessageDirective),chatApp.directive("chatImage",chatImage);var chatApp;chatApp=angular.module("ringid.chat"),chatApp.directive("setTimeout",["ChatFactory","$compile","$document",function(e,t,n){return{restrict:"EA",template:'<a><span class="img_sprite w-h-22px icon-timer-s"></span></a>',link:function(e,r){var i,o;function a(){e.showTimeout=!0,e.closeSettingPopup(),n.bind("click",s),o=angular.element("<set-timeout-bar ></set-timeout-bar>"),i=t(o)(e),r.parent().parent().parent().next().prepend(i)}function s(){e.showTimeout=!1,n.unbind("click",s),i&&i.remove()}e.closeTimeoutPopup=s,e.showTimeout=!1,r.on("click",function(t){e.showTimeout?s():a(),t.stopPropagation()})}}}]).directive("setTimeoutBar",["ChatFactory","$compile",function(e,t){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="enable-secret-chat">Enable Secret Chat:</span><div class="switchnew">\n<input class="float-left" ng-model="box.value.secretChat" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n<a href="#" ng-click="showValueBox($event)" class="img_sprite timeout-sec icon-time"><p>sec</p><span>{{ timeout>4 ? timeout : 5}}</span></a></div></div>',link:function(e,n){var r,i;e.timeout=e.box.value.timeout,e.showTimeoutBox=!1,e.cancel=function(t){e.closeTimeoutPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.showValueBox=function(o){e.showTimeoutBox?e.hideValueBox():(e.showTimeoutBox=!0,i=angular.element("<set-timeout-Value ></set-timeout-Value>"),r=t(i)(e),n.children(0).append(r)),o&&(o.preventDefault(),o.stopPropagation())},e.hideValueBox=function(t){e.showTimeoutBox=!1,r&&r.remove(),t&&(t.preventDefault(),t.stopPropagation())},n.on("click",function(e){e.stopPropagation()})}}}]).directive("setTimeoutValue",function(){return{restrict:"EA",templateUrl:"templates/partials/chat-timeout-value-box.html",link:function(e){e.selectTimeout=function(t,n){e.box.value.timeout=e.timeout=n,e.hideValueBox(t)}}}});var chatApp;chatApp=angular.module("ringid.chat"),chatApp.directive("setting",["ChatFactory","$compile","$document",function(e,t,n){return{restrict:"EA",template:'<a><span class="img_sprite icon-g-settings"></span></a>',link:function(e,r){var i,o,a=function(){e.showSetting=!0,e.closeTimeoutPopup(),n.bind("click",s),o=angular.element("<setting-bar ></setting-bar>"),i=t(o)(e),r.parent().parent().parent().next().prepend(i)},s=function t(){e.showSetting=!1,n.unbind("click",t),i&&i.remove()};e.closeSettingPopup=s,e.showSetting=!1,r.on("click",function(t){e.showSetting?s():a(),t.stopPropagation()})}}}]).directive("settingBar",["ChatFactory","$compile","profileFactory","tagChatFactory","ChatUtilsFactory","Auth","ChatConnector","PLATFORM",function(e,t,n,r,i,o){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="secret-visible">Timer:</span><div class="switch-secret-visible"><input class="float-left" ng-model="box.value.isSecretVisible" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="img_sprite w-h-22px correct-sec icon-close-b"></a>\n</div></div>',link:function(e,t){var n=(CHAT_APP.SharedHelpers,CHAT_APP.UTILS.getUUIDPacketId,o.currentUser());n.getUtId();e.cancel=function(t){e.closeSettingPopup(),t&&(t.preventDefault(),t.stopPropagation())},e.blockUnblock=function(e){},t.on("click",function(e){e.stopPropagation()})}}}]),angular.module("ringid.chat").directive("rgTagChatList",function(){return{restrict:"E",templateUrl:"templates/partials/tag-chat/tag-chat-list.html"}}),function(e,t){"use strict";e.module("ringid.sticker",["ringid.config"])}(angular,window),angular.module("ringid.sticker").factory("StickerHelper",StickerHelper),StickerHelper.$inject=["STICKER_IMAGE_TYPE","$$stickerMap"];function StickerHelper(e,t){var n=function(n,r,i){var o,a,s,c;return o={type:e.STICKER,imageList:[]},a=n.imagesList,angular.isArray(a)&&(s=a[0].sCtId,c=i[s],o.collectionId=c.getCollectionId(),o.categoryId=s,angular.forEach(a,function(n){o.imageList.push({name:n.imUrl,type:e.STICKER,id:n.imId}),r[n.sCtId]=t.create(o)})),r};return{parseCategoryStickerData:n}}angular.module("ringid.sticker").controller("StickerPopupController",StickerPopupController),StickerPopupController.$inject=["$boxInstance","localData","$scope","StickerFactory"];function StickerPopupController(e,t,n,r){n.stickerCategories=r.getStickerCategories(),RingLogger.print(n.stickerCategories,RingLogger.tags.STICKER),n.stickerCollections=r.getStickerCollections(),t&&t.stickerKey&&(n.sticker=r.getStickerCategoryObject(t.stickerKey),n.$rgDigest()),n.addSticker=i;function i(e){r.addMySticker(e.getKey()),n.$rgDigest()}n.removeSticker=o;function o(e){r.removeMySticker(e.getKey()),n.$rgDigest()}n.isInstalled=a;function a(e){return r.isDownloaded(e)}n.close=s;function s(t){e.close(),t&&(t.preventDefault(),t.stopPropagation())}}angular.module("ringid.sticker").factory("StickerCategoryModel",StickerCategoryModel),StickerCategoryModel.$inject=["settings"];function StickerCategoryModel(e){return{keyString:"sCtId",getKeyString:function(){return StickerCategoryModel.keyString},create:function(t){var n={sCtId:0,sctName:"",sClId:0,cgBnrImg:"",rnk:1,dtlImg:"",thmColor:"",txtColor:"",cgNw:0,icn:"",prz:0,free:0,dcpn:""};function r(e){var t=angular.extend({},n,e);return t}return angular.isObject(t)&&(n=r(t)),{getCategoryId:function(){return n.sCtId},setCategoryId:function(e){n.sCtId=e},getCollectionId:function(){return n.sClId},setCollectionId:function(e){n.sClId=e},getKey:function(){return this.getCategoryId()},setKey:function(e){this.setCategoryId(e)},getName:function(){return n.sctName},setName:function(e){n.sctName=e},getTextColor:function(){return n.txtColor},setTextColor:function(e){n.txtColor=e},getBannerImage:function(){return n.bnrImg},setBannerImage:function(e){n.cgBnrImg=e},getRank:function(){return n.rnk},setRank:function(e){n.rnk=e},getDetailImage:function(){return n.dtlImg},getDetailImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getDetailImage();return t},setDetailImage:function(e){n.dtlImg=e},getNewCategory:function(){return n.cgNw},setNewCategory:function(e){n.cgNw=e},getIconImage:function(){return n.icn},setIconImage:function(e){n.icn=e},getIconImageUrl:function(){var t=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getIconImage();return t},getCaptionImageUrl:function(t){var n=e.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/";return n+=t?"ca.png":"c.png"},getPrice:function(){return n.prz},setPrice:function(e){n.prz=e},isFree:function(){return n.free},setIsFree:function(e){n.free=e},getDescription:function(){return n.dcpn},setDescription:function(e){n.dcpn=e},getThumbColor:function(){return n.thmColor},setThumbColor:function(e){n.thmColor=e}}}}}angular.module("ringid.sticker").factory("StickerCollectionModel",StickerCollectionModel),StickerCollectionModel.$inject=["settings"];function StickerCollectionModel(e){return{create:function(t){var n={sClId:0,name:"",txtColor:"",bnrImg:"",thmColor:"",categories:[]};function r(e){var t=angular.extend({},n,e);return t}return angular.isObject(t)&&(n=r(t)),{getId:function(){return n.sClId},setId:function(e){n.sClId=e},getKey:function(){return this.getId()},setKey:function(e){this.setId(e)},getName:function(){return n.name},setName:function(e){n.name=e},getTextColor:function(){return n.txtColor},setTextColor:function(e){n.txtColor=e},getBannerImage:function(){return n.bnrImg},setBannerImage:function(e){n.bnrImg=e},getBannerImageUrl:function(){var t=e.stickerBase+this.getId()+"/"+this.getBannerImage();return t},getThumbColor:function(){return n.thmColor},setThumbColor:function(e){n.thmColor=e},addCategories:function(e){n.categories.push(e)},removeCategories:function(e){n.categories.splice(e,1)},getCategories:function(){return n.categories}}}}}angular.module("ringid.sticker").service("stickerHttpService",stickerHttpService),stickerHttpService.$inject=["$ringhttp","$$connector","settings","OPERATION_TYPES"];function stickerHttpService(e,t,n,r){var i=r.STICKER,o=r.SYSTEM.REQUEST_TYPE,a=this;a.go=s;function s(t,n,r){return e[n||"get"](t,r||[])}a.getAll=c;function c(){var e=n.stickerApi+"all=1";return a.go(e)}a.getStickerCategoriesByCollectionId=l;function l(e){var t=n.stickerApi+"collectionId="+e;return a.go(t)}a.getStickersByCatId=u;function u(e){var t=n.stickerApi+"categoryId="+e;return a.go(t)}a.getMyStickers=d;function d(){var e={actn:i.GET_MY_STICKER};return t.request(e,o.REQUEST)}a.addSticker=g;function g(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.ADD_JT_VALUE};return t.request(n,o.UPDATE)}a.removeSticker=m;function m(e){var n={actn:i.ADD_REMOVE_STICKER,catId:e.catId,jt:i.REMOVE_JT_VALUE};return t.request(n,o.UPDATE)}}angular.module("ringid.sticker").factory("StickerFactory",StickerFactory).factory("$$stickerMap",$$stickerMapDefination).factory("$$stickerImageMap",$$stickerImageMapDefnation),$$stickerImageMapDefnation.$inject=["settings","STICKER_IMAGE_TYPE"];function $$stickerImageMapDefnation(e,t){return{create:function(n,r,i){var o={id:n.id||0,name:n.name||"",symbol:n.symbol||n.name,type:n.type||0,src:1===r?e.emoticonBase+n.name:i+n.name,isEmoticon:r===t.EMOTICON,isLargeEmoticon:r===t.LARGE_EMOTICON,isSticker:r===t.STICKER};return{getKey:function(){return o.id},src:function(){return o.src},symbol:function(){return o.symbol},getName:function(){return o.name},srcWithoutBase:function(){return o.src.replace(e.stickerBase,"")},isEmoticon:function(){return o.isEmoticon},isLargeEmoticon:function(){return o.isLargeEmoticon},isSticker:function(){return o.isSticker}}}}}$$stickerMapDefination.$inject=["$$stackedMap","$$stickerImageMap","settings"];function $$stickerMapDefination(e,t,n){return{create:function(r,i){var o,a,s,c;for(o=n.stickerBase+r.collectionId+"/"+r.categoryId+"/",c={categoryId:r.categoryId||0,collectionId:r.collectionId||0,imageListMap:e.createNew(),type:r.type||0,isEmoticon:1===r.type,isLargeEmoticon:2===r.type,isSticker:3===r.type,regularUrl:1===r.type?"/images/emoticon/c.png":+o+"c.png",hoverUrl:1===r.type?"/images/emoticon/ca.png":o+"ca.png",installed:i||!1},s=0;s<r.imageList.length;s++)a=t.create(r.imageList[s],c.type,o),c.imageListMap.add(a.getKey(),a);return{sortBy:function(){return c.categoryId},isInstalled:function(){return c.installed},setInstalled:function(e){c.installed=e},isEmoticon:function(){return c.isEmoticon},isLargeEmoticon:function(){return c.isLargeEmoticon},isSticker:function(){return c.isSticker},getKey:function(){return c.categoryId},getImages:function(){return c.imageListMap},getType:function(){return c.type},link:function(){return c.regularUrl},hoverLink:function(){return c.hoverUrl}}}}}StickerFactory.$inject=["$$stackedMap","$$stickerMap","stickerHttpService","StickerEmoticonFactory","StickerHelper","StickerCategoryModel","StickerCollectionModel","STICKER_IMAGE_TYPE","$$q","Storage"];function StickerFactory(e,t,n,r,i,o,a,s,c,l){var u,d="stickerData",g="myStickers",m={},E={},f={free:[],new:[],top:[]},p={},T={},h=r.getAllEmoticons(),I=t.create(h,!0),_=!1;function A(e){var t=c.defer();return E[e]||n.getStickersByCatId(e).success(function(e){e&&e.sucs===!0&&(i.parseCategoryStickerData(e,E,m),t.resolve(e))}).error(function(e){t.reject(e)}),t.promise}function S(e){var t,r,i;try{t=e.getKey(),n.getStickerCategoriesByCollectionId(t).success(function(t){t&&t.sucs===!0&&t.categoriesList&&(i=t.categoriesList,angular.isArray(i)&&angular.forEach(i,function(t){var n=t[o.getKeyString()];r=m[n],r||(r=o.create(t),m[r.getKey()]=r),e.addCategories(r.getKey())}))})}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}}function C(e){var t,n;try{angular.forEach(e.freeCategoriesList,function(e){t=o.create(e),m[t.getKey()]=t,f.free.push(t.getKey())})}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}try{angular.forEach(e.topCategoriesList,function(e){t=o.create(e),m[t.getKey()]=t,f.top.push(t.getKey())})}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}try{angular.forEach(e.stNewCategoriesList,function(e){t=o.create(e),m[t.getKey()]=t,f.new.push(t.getKey())})}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}try{angular.forEach(e.stickerCollectionsList,function(e){n=a.create(e),p[n.getKey()]=n,S(n)})}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}}function v(){n.getAll().success(function(e){try{e&&e.sucs===!0&&(R(e),C(e),N())}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}})}function D(){try{return l.getData(d)}catch(e){return!1}}function R(e){l.setData(d,e)}function M(){l.setData(g,T)}function N(){T=l.getData(g),_&&T||(T={},n.getMyStickers().then(function(e){e.sucs===!0&&(angular.forEach(e.catIds,function(e){T[e]=1,E[e]&&E[e].setInstalled(!0)}),M())}))}function y(e){try{C(e)}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}}function b(e){try{return m[e]}catch(e){return RingLogger.log(e,RingLogger.tags.STICKER),{}}}return{initStickerData:function(e){e===!0?v():(u=D(),angular.isObject(u)?(y(u),N()):v())},getNoOfMyStickers:function(){return T?Object.keys(T).length:0},getStickerCategories:function(e){return e?f[e]:f},getStickerCollections:function(){return p},getMyStickerCatIds:function(){return T?Object.keys(T):[]},getStickerMapByCatId:function(e){var t=c.defer();return E[e]?t.resolve(E[e]):A(e).then(function(){t.resolve(E[e])},function(e){t.reject(e)}),t.promise},isDownloaded:function(e){return!!T[e]},getStickerCategoryObject:function(e){return b(e)},getEmoticonMap:function(){return I},getMyStickers:function(){return n.getMyStickers()},addMySticker:function(e){try{T[e]=1,M(),E[e]&&E[e].setInstalled(!0)}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}n.addSticker({catId:e}).then(function(t){t.sucs!==!0&&(T[e]=0,E[e].setInstalled(!1))},function(e){RingLogger.log(e,RingLogger.tags.STICKER)})},removeMySticker:function(e){try{delete T[e],M(),E[e]&&E[e].setInstalled(!1)}catch(e){RingLogger.log(e,RingLogger.tags.STICKER)}n.removeSticker({catId:e}).then(function(t){t.sucs!==!0&&(T[e]=1,E[e].setInstalled(!0))},function(e){RingLogger.log(e,RingLogger.tags.STICKER)})}}}angular.module("ringid.sticker").directive("rgStickerCategory",rgStickerCategory),rgStickerCategory.$inject=["StickerFactory"];function rgStickerCategory(e){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category.html",scope:{categories:"=categories"},link:function(t){t.getStickerCategory=e.getStickerCategoryObject,t.showPreview=n;function n(e){return function(){return{stickerKey:e}}}t.isInstalled=r;function r(t){return e.isDownloaded(t)}t.addSticker=i;function i(n){e.addMySticker(n),t.$rgDigest()}t.removeSticker=o;function o(n){e.removeMySticker(n),t.$rgDigest()}}}}angular.module("ringid.sticker").directive("rgStickerCategoryList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-category-list.html",scope:{categories:"=categories"}}}),angular.module("ringid.sticker").directive("rgStickerCollectionList",function(){return{restrict:"E",templateUrl:"templates/partials/stickers/sticker-collection-list.html",scope:{collections:"="},link:function(e){e.currentCollectionIdToShow=0,e.shouldShowCollectionCategories=t;function t(t){return e.currentCollectionIdToShow===t}e.showCollectionCategories=n;function n(t){e.displayingCollections=!e.displayingCollections,e.currentCollectionIdToShow=t,e.$rgDigest()}e.displayingCollections=!0}}}),function(e,t){"use strict";e.module("ringid.controllers",["ringid.config"])}(angular,window),angular.module("ringid.controllers").controller("AlbumlistController",AlbumlistController),AlbumlistController.$inject=["APP_CONSTANTS","$scope","Media","Ringalert","OPERATION_TYPES","$$connector","$ringbox","fileUploadService"];function AlbumlistController(e,t,n,r,i,o,a,s){var c,l,u=i.SYSTEM.MEDIA,d=[],g=e;t.selectedAlbum=null,t.albumName="",t.media=t.params.media,t.selectAlbum=E,t.createAlbumPopup=m,t.existsInAlbum=function(e){return t.selectedAlbum?t.selectedAlbum.getId()===e||d.indexOf(e)>-1:d.indexOf(e)>-1},t.addToAlbum=function(){t.media&&t.selectedAlbum?t.selectedAlbum.addNewContent(t.media):t.selectedAlbum&&s.setUploadAlbum(t.selectedAlbum.getId()),t.close()},t.getAlbums=function(){return n.getAlbums(!0,c)};function m(){var e=a.open({type:"remote",resolve:{localData:{mdaT:"audio"===c?g.NEWS_FEED_MEDIA_TYPE_AUDIO:g.NEWS_FEED_MEDIA_TYPE_VIDEO}},scope:!1,controller:"AlbumCreateController",templateUrl:"templates/popups/create-album-popup.html"});e.result.then(function(e){e&&(t.selectedAlbum=e,t.$rgDigest())})}function E(e){switch(e.action){case"select":if(t.selectedAlbum&&t.selectedAlbum.getKey()===e.albumMap.getKey())break;d.indexOf(e.albumMap.getKey())>-1?t.selectedAlbum=null:(t.selectedAlbum=e.albumMap,RingLogger.information("Selected Album: "+t.selectedAlbum.getName(),RingLogger.tags.UPLOAD))}t.$rgDigest()}function f(){n.init(),l=o.subscribe(function(){setTimeout(function(){t.$rgDigest()},500)},{action:[u.ACTION_MEDIA_ALBUM_LIST]}),t.media?(c=t.media.isAudio()?"audio":"video",n.makeApiCall("mediaInAlbums",{strmURL:t.media.getStreamUrlOnly()}).then(function(e){RingLogger.print(e,RingLogger.tags.MEDIA),e.sucs===!0&&(d=e.albIds,t.$rgDigest())})):c=t.params.mediaType}f(),t.$on("$destroy",function(){o.unsubscribe(l)})}angular.module("ringid.controllers").controller("AlbumCreateController",AlbumCreateController),AlbumCreateController.$inject=["$scope","Media","APP_CONSTANTS","$boxInstance","localData"];function AlbumCreateController(e,t,n,r,i){e.albumName="",e.createAlbum=function(){e.albumName.length>0&&(RingLogger.information("Create Album: "+e.albumName,RingLogger.tags.UPLOAD),t.createAlbum({albn:e.albumName,mdaT:i.mdaT},!0).then(function(e){e&&r.close(e)}))}}angular.module("ringid.controllers").controller("RingBoxAlbumlistController",RingBoxAlbumlistController),RingBoxAlbumlistController.$inject=["$scope","$boxInstance","$controller","localData"];function RingBoxAlbumlistController(e,t,n,r){e.close=t.close,e.params=r,n("AlbumlistController",{$scope:e})}angular.module("ringid.controllers").controller("RingBoxConfirmController",RingBoxConfirmController),RingBoxConfirmController.$inject=["$scope","$boxInstance","localData"];function RingBoxConfirmController(e,t,n){e.close=r,e.params=n;function r(e){t.close(e)}}angular.module("ringid.controllers").controller("SingleImageController",SingleImageController),SingleImageController.$inject=["$scope","$routeParams","$controller","Auth"];function SingleImageController(e,t,n,r){e.params={},e.params.imgId=t.imageId,e.isReady=!1,e.currentUser=r.currentUser(),n("ImagePopupController",{$scope:e}),e.showCommentBox=!0}!function(e,t){"use strict";e.module("ringid.media",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.media").directive("rgMedia",rgMedia),rgMedia.$inject=["$window","$document","Media","$routeParams"];function rgMedia(e,t,n,r){i.$inject=["profileFactory","Auth","fileUploadService","SystemEvents","$rootScope","$scope","$location","$attrs","Storage","OPERATION_TYPES","$$connector","routeService","userFactory","$$mediaAlbumMap","$$stackedMap","mapFilterFilter","$ringbox"];function i(e,t,i,o,a,s,c,l,u,d,g,m,E,f,p,T,h){var I,_=d.SYSTEM.MEDIA,A=e.getProfile(r.uId||0);s.profilePage=l.inProfile,s.showMediaPreview=!1,s.activeAlbum=null,s.state=n.state,s.selectedPlaylist=p.createNew(),s.getAlbums=v,s.deleteMedia=D,s.toggleAlbumPreview=R,s.getMediaData=N,s.selectMedia=M,s.loadMoreContent=y,s.activeTab="audio",s.showAlbumContents=!1,r.albumId&&(s.showAlbumContents=!0,s.$rgDigest()),s.activateTab=S;function S(e){s.activeTab=e,s.$rgDigest()}function C(e,t){"false"!==s.profilePage&&("album"===t?s.state.albumsLoading=e:s.state.contentsLoading=e,s.$rgDigest())}function v(e){return"true"===s.profilePage?n.getAlbums(A.isCurrentUser(),e):n.getAlbums(!0,e)}function D(e){var t,r;t="Are you sure you want to delete?",r=h.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:t}},templateUrl:"templates/partials/ringbox-confirm.html"}),r.result.then(function(t){t&&n.deleteMedia(e)})}function R(e,t){var n,r=[];if("false"===s.profilePage)switch(r.push(e.getName()),r.push(e.getContentCount()),u.setData("albumname",r),t){case"audio":n="media/"+t+"/"+e.getALbumUtId()+"/"+e.getKey(),c.path(n);break;case"video":n="media/"+t+"/"+e.getALbumUtId()+"/"+e.getKey(),c.path(n);break;default:n="media",c.path(n)}else e?window.location=e.link(A):window.location=m.getRoute("PROFILE",{uId:A.getUId(),utId:A.getUtId(),subpage:"media"})}function M(e,t){t?s.selectedPlaylist.add(e.getKey(),e):s.selectedPlaylist.remove(e.getKey())}function N(e,t){var n,r;return n=e?s.activeAlbum.getContents().all():s.selectedPlaylist.all(),r=t||n[0].value,{data:function(){return{media:r,playlist:n,popupForm:"profile"}},promise:r.fetchDetails(A)}}function y(e){(e||!s.state.contentsLoading&&s.activeAlbum&&s.activeAlbum.getContents().length()<s.activeAlbum.getContentCount())&&(C(!0),n.fetchAlbumContents({albId:s.activeAlbum.getKey(),utId:A.getUtId(),st:s.activeAlbum.getContents().length()}))}function b(){I=g.subscribe(function(e){switch(e.actn){case _.ACTION_MEDIA_ALBUM_LIST:e.utId===A.getUtId()&&setTimeout(function(){s.showMediaPreview||(s.activeAlbum=n.getAlbum(r.albumId),s.activeAlbum&&y(!0)),C(!1,"album")},2e3);break;case _.ACTION_MEDIA_ALBUM_CONTENT_LIST:n.processResponse(e),setTimeout(function(){C(!1)},1e3)}},{action:[_.ACTION_MEDIA_ALBUM_LIST,_.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),r.albumId?(s.showMediaPreview=!1,s.activeAlbum=n.getAlbum(r.albumId),s.activeAlbum&&y(!0),C(!0)):s.showMediaPreview=!0,A.isCurrentUser()||(n.fetchAllAlbums(A.getUtId()),C(!0,"album")),n.init()&&C(!0,"album")}b(),"false"===s.profilePage?s.limitItem=4:s.limitItem="Infinity",s.$on("$destroy",function(){g.unsubscribe(I),n.resetMediaAlbums()})}function o(n){function r(){n.showMediaPreview||e.innerHeight+e.scrollY>=t[0].body.offsetHeight&&n.loadMoreContent(!0)}e.addEventListener("scroll",r),n.$on("$destroy",function(){e.removeEventListener("scroll",r)})}return{restrict:"E",controller:i,link:o,templateUrl:function(e,t){return t.templatepath}}}angular.module("ringid.media").directive("rgMediaSearch",rgMediaSearch),rgMediaSearch.$inject=[];function rgMediaSearch(){e.$inject=["$$stackedMap","$$mediaMap","Storage","OPERATION_TYPES","Auth","$scope","Media","userFactory","$$mediaAlbumMap","$location","rgDropdownService","$ringbox","Ringalert"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g){var m,E=[];n.setData("albumname",E),o.medias=e.createNew(!0,"desc"),o.popupmedias=e.createNew(!0,"desc"),o.recentMediaDropdown="templates/dropdowns/recent-media-dropdown.html",o.searchedMedia=e.createNew(),o.trendingArr=[],o.nodatafound=!1,o.noaudiofound=!1,
o.activeNav="recent",m=i.currentUser(),o.utId=m.getUtId(),a.fetchAllAlbums();function f(){var e,r,i;for(e=n.getData("mediaRecent"),r=0;r<e.length;r++)i=t(e[r]),o.medias.save(i.getKey(),i)}f(),o.getRecentMediaData=function(e){return{data:function(){return{media:e,playlist:o.medias.all()}},promise:e.fetchDetails()}},o.getTaggedMedia=function(e){a.getTaggedMedia(e)},o.goToMyAlbums=function(e){var t="media/"+e;l.path(t)},o.selectAlbum=function(e){return{data:function(){return{media:e}}}},o.actionRecentMediaDropdown=function(e){var t;switch(e.action){case"addtoalbum":d.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"RingBoxAlbumlistController",resolve:{localData:{media:e.data.obj}},templateUrl:"templates/dropdowns/popup-album-dropdown.html"});break;case"sendtofriend":break;case"shareatringid":t=d.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:e.data.obj},onBackDropClickClose:!0,templateUrl:"templates/home/share-media.html"}),t.result.then(function(){o.$rgDigest()});break;case"shareatfb":break;case"download":g.show("Currently download option is available in ringID desktop and mobile app version only","info")}},o.$on("$destroy",function(){a.resetMediaAlbums()})}function t(e,t){t.bind("click",function(){})}return{restrict:"E",controller:e,link:t,templateUrl:"templates/partials/media-search.html"}}angular.module("ringid.media").directive("rgMediaSearchDirective",rgMediaSearchDirective),rgMediaSearchDirective.$inject=[];function rgMediaSearchDirective(){e.$inject=["$rootScope","OPERATION_TYPES","$scope","Media","$location","rgScrollbarService"];function e(e,t,n,r,i,o){var a=t.SYSTEM.MEDIA;n.showDropdown=!1,n.stoploader=!1,n.showTrending=!1,n.searchResult=[],n.trendingArr=[],n.doSearch=function(){n.searchResult=[],n.stoploader=!1,n.searchParam?(n.showTrending=!1,r.fetchSearchResult(n.searchParam).then(s),n.showDropdown=!0):(n.showDropdown=!1,n.showTrending=!0)},n.doContentSearch=function(t){var r;switch(n.showDropdown=!1,t.sugt){case 1:r="/media/songs/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 2:r="/media/albums/"+t.sk,i.path(encodeURI(r)),e.$rgDigest();break;case 3:r="/media/tags/"+t.sk,i.path(encodeURI(r)),e.$rgDigest()}},n.fetchTrendingKeyword=function(){return n.showDropdown=!0,n.trendingArr.length>0?(n.showTrending=!0,void n.$rgDigest()):void r.getSearchTrends().then(function(e){var t;if(e.sucs===!0){for(t=0;t<e.sgstn.length;t++){switch(e.sgstn[t].sugt){case 1:e.sgstn[t].searchtype="songs";break;case 2:e.sgstn[t].searchtype="albums";break;case 3:e.sgstn[t].searchtype="tags"}n.trendingArr.push(e.sgstn[t])}n.showTrending=!0}n.$rgDigest()})},n.hideDropdown=function(){n.showDropdown=!1,n.showTrending=!1,n.searchParam="",n.searchResult=[]},n.$on("$destroy",function(){n.trendingArr=[],n.searchResult=[]});function s(e){var t;switch(e.actn){case a.ACTION_MEDIA_SEARCH_RESULT:if(e.sucs===!0)for(n.showDropdown=!0,t=0;t<e.sgstn.length;t++)n.searchResult.push(e.sgstn[t]);else n.stoploader=!0;o.recalculate(n)}n.$rgDigest()}}function t(e,t){var n;t.bind("click",function(){}),n=t.find("input"),e.activeId=0,e.setActiveId=function(t){e.activeId=t},n.on("keydown",function(t){13===t.keyCode&&e.searchParam&&e.doContentSearch({sk:e.searchParam,sugt:1})}),t.on("keydown",function(t){var n;13===t.keyCode?e.searchResult.length&&(n=e.searchResult[e.activeId],e.doContentSearch({sk:n.sk,sugt:n.sugt})):38===t.keyCode?(e.activeId=Math.max(e.activeId-1,0),e.$rgDigest()):40===t.keyCode&&(e.activeId=Math.min(e.activeId+1,e.searchResult.length-1),e.$rgDigest())})}return{restrict:"E",controller:e,link:t,templateUrl:"templates/mediasearch/media-search-directive.html"}}angular.module("ringid.media").directive("rgTabNav",rgTabNav),rgTabNav.$inject=[];function rgTabNav(){e.$inject=["$scope","$location"];function e(e,t){e.isCurrentPath=function(e,n){var r;if(1===e.length)return n?t.path().indexOf(e[0])>-1:t.path()===e[0];for(r=0;r<e.length;r++)if(t.path().indexOf(e[r])>-1)return n?t.path().indexOf(e[r])>-1:t.path()===e[r];return!1}}function t(){}return{restrict:"E",controller:e,link:t,templateUrl:"templates/partials/media.tabnav.dir.html"}}angular.module("ringid.media").directive("rgMediaSlider",rgMediaSlider),rgMediaSlider.$inject=["$document","SystemEvents"];function rgMediaSlider(e,t){n.$inject=["$scope","Media","$$mediaAlbumMap","$$stackedMap","Storage"];function n(e,n,r,i,o){var a,s,c,l;e.sliderImages=i.createNew(),n.fetchSliderImage({mdaT:1}).then(function(n){if(n.sucs===!0)for(c=0;c<n.mediaAlbumList.length;c++)a=r.createAlbum(n.mediaAlbumList[c]),e.sliderImages.save(a.getKey(),a);e.$broadcast(t.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()}),n.fetchSliderImage({mdaT:2}).then(function(n){if(n.sucs===!0)for(l=0;l<n.mediaAlbumList.length;l++)s=r.createAlbum(n.mediaAlbumList[l]),e.sliderImages.save(s.getKey(),s);e.$broadcast(t.MEDIA.SLIDER_IMAGE_LOADED),e.$rgDigest()}),e.setAlbumName=function(e){var t=[];t.push(e.name),t.push(e.count),o.setData("albumname",t)},e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}function r(e,n){var r,i,o,a,s=1,c=!0,l=0;e.showLeftArrow=!1,e.showRightArrow=!0,r=n[0].querySelector(".media-slider"),i=n[0].querySelector(".photobanner"),o=r.clientWidth,e.imageWidth=o/2,e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(){a&&clearTimeout(a),a=setTimeout(function(){l=1,i.style.display="none",e.$parent.$rgDigest(),c=!0,o=r.clientWidth,e.imageWidth=o/2,i.style.width=e.sliderImages.length()*e.imageWidth+"px",i.style.marginLeft="-"+(s-l)*e.imageWidth+"px",i.style.display="",e.$parent.$rgDigest()},500)}),e.$on(t.MEDIA.SLIDER_IMAGE_LOADED,function(){i.style.display="none",e.$parent.$rgDigest(),i.style.width=e.sliderImages.length()*e.imageWidth+"px",i.style.display="",e.$parent.$rgDigest()}),e.right=function(){c&&(i.style.width=e.sliderImages.length()*e.imageWidth+"px",c=!1),i.style.marginLeft="-"+s*e.imageWidth+"px",s++,l=0,s>1&&(e.showLeftArrow=!0),s===e.sliderImages.length()-1&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){s--,l=0,1===s&&(e.showLeftArrow=!1),s<e.sliderImages.length()-1&&(e.showRightArrow=!0),i.style.marginLeft="-"+(s-1)*e.imageWidth+"px",e.$parent.$rgDigest()}}return{restrict:"E",controller:n,link:r,templateUrl:"templates/mediasearch/media-slider-directive.html"}}angular.module("ringid.media").controller("mSearchResultController",mSearchResultController),mSearchResultController.$inject=["Auth","Storage","userFactory","$routeParams","$$mediaAlbumMap","$$stackedMap","$$mediaMap","$scope","Media","$location","$$connector","OPERATION_TYPES"];function mSearchResultController(e,t,n,r,i,o,a,s,c,l,u,d){var g,m,E,f,p=[],T=[],h=[],I=o.createNew(),_=o.createNew();switch(t.setData("albumname",p),s.stype=r.stype,s.searchkey=decodeURI(r.sk),m=d.SYSTEM.MEDIA,s.loadMoreSongs=!1,s.loadMoreAlbums=!1,s.showSearchTitle=!0,s.searchedTagArr=[],s.searchedSongs=function(){return I},s.searchedAlbums=function(){return _},r.stype){case"songs":g=1;break;case"albums":g=2;break;case"tags":g=3;break;default:g=1}switch(s.showSearchDropdown=!1,s.searchsongsection=!1,s.searchalbumsection=!1,s.searchtagsection=!1,s.noresultsection=!1,"tag"!==s.stype&&(E={sk:s.searchkey,sugt:g},c.fetchContent(E)),s.stype){case"songs":s.searchsongsection=!0;break;case"albums":s.searchalbumsection=!0;break;case"tags":s.searchtagsection=!0;break;case"tag":s.searchsongsection=!0,s.showSearchTitle=!1,isNaN(s.searchkey)||c.getTaggedMedia(parseInt(s.searchkey,10))}s.searchedTags=c.getSearchedTagArr(),s.cntntidarray=c.getContentIdArray,s.albumidarray=c.getAlbumIdArray,s.noresultfound=!1,s.loadMoreSuggestedSongs=function(){var e;s.loadMoreSongs=!0,e={sk:s.searchkey,sugt:g,pvtid:T.pop(),scl:2},c.fetchContent(e),c.resetContentIdArray(),s.$rgDigest()},s.loadMoreSuggestedAlbums=function(){var e;s.loadMoreAlbums=!0,e={sk:s.searchkey,sugt:g,pvtid:h.pop(),scl:2},c.fetchContent(e),c.resetAlbumIdArray(),s.$rgDigest()},s.getTaggedMedia=function(e){var t;t="media/tag/"+e.htid,l.path(encodeURI(t))},s.goToAlbum=function(e){var n;switch(p.push(e.name),p.push(e.mc),t.setData("albumname",p),e.type){case"audio":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;case"video":n="media/"+e.type+"/"+e.utid+"/"+e.albumid,l.path(n);break;default:n="media",l.path(n)}},s.getMediaData=function(e){return{data:function(){return{media:e,playlist:[{key:e.getKey(),value:e}]}},promise:e.fetchDetails()}},f=u.subscribe(A,{action:[m.ACTION_SPECIFIC_MEDIA_RESULT,m.ACTION_GET_TAGGED_MEDIA_SONGS]});function A(e){var t,n;switch(s.loadMoreSongs=!1,s.loadMoreAlbums=!1,e.actn){case m.ACTION_SPECIFIC_MEDIA_RESULT:if(s.noresultfound=!1,e.sucs===!0)for(10===e.tr?n=e.mdaLst.length-1:(n=e.mdaLst.length,s.noresultfound=!0),t=0;t<n;t++)1===e.mdaLst[t].sugt&&(T.push(e.mdaLst[t].cntntId),e.mdaLst[t].viewtime=(new Date).getTime(),E=a(e.mdaLst[t]),I.save(E.getKey(),E)),2===e.mdaLst[t].sugt&&(h.push(e.mdaLst[t].albId),E=i.createAlbum(e.mdaLst[t]),_.save(E.getKey(),E)),3===e.mdaLst[t].sugt&&s.searchedTagArr.push(e.mdaLst[t]);else s.noresultfound=!0;break;case m.ACTION_GET_TAGGED_MEDIA_SONGS:if(s.noresultfound=!1,e.sucs===!0)for(t=0;t<e.mdaLst.length;t++)E=a(e.mdaLst[t]),I.save(E.getKey(),E);else s.noresultfound=!0}s.$rgDigest()}s.$on("$destroy",function(){u.unsubscribe(f),I.reset(),_.reset()})}angular.module("ringid.media").controller("allAlbumTypeController",allAlbumTypeController),allAlbumTypeController.$inject=["$$stackedMap","$$mediaMap","$$mediaAlbumMap","Storage","userFactory","Auth","$routeParams","OPERATION_TYPES","$scope","Media","$location","$$connector","Ringalert"];function allAlbumTypeController(e,t,n,r,i,o,a,s,c,l,u,d){var g,m,E=s.SYSTEM.MEDIA,f=o.currentUser();c.albumName=r.getData("albumname")[0],c.mediaCount=r.getData("albumname")[1],c.albumtype=a.albumtype,c.utid=a.utid,c.albumid=a.albumid,c.songsArray=[],c.songs=e.createNew(),c.selectedPlaylist=e.createNew(),c.myAlbumsMap=e.createNew(),c.userallalbum=!1,c.showSearchDropdown=!1,c.stoploader=!1,c.loadMoreSong=!1,a.utid||a.albumid||(c.utid=f.getUtId(),"audio"===a.albumtype?g=1:"video"===a.albumtype?g=2:u.path("media"),l.fetchAllAlbums(c.utid,c.albumtype),c.userallalbum=!0),isNaN(c.utid)&&isNaN(c.albumid)&&u.path("media"),c.goToAlbum=function(e){var t,n;switch(n.push(e.name),n.push(e.mc),r.setData("albumname",n),e.type){case"audio":t="media/"+e.type+"/"+e.utid+"/"+e.albumid,u.path(t);break;case"video":t="media/"+e.type+"/"+e.utid+"/"+e.albumid,u.path(t);break;default:t="media",u.path(t)}},c.loadMoreMedia=function(e){c.loadMoreSong=!0,l.fetchAlbumContents({albId:c.albumid,utId:c.utid,st:e})},c.utid&&c.albumid&&(l.fetchAlbumContents({albId:c.albumid,utId:c.utid}),c.albumMap=n.createAlbum({albn:c.albumName,albId:c.albumid,utId:c.utid})),c.selectMedia=p;function p(e,t){t?c.selectedPlaylist.add(e.getKey(),e):c.selectedPlaylist.remove(e.getKey())}c.getMediaData=T;function T(e,t){var n,r;return n=e?c.songs.all():c.selectedPlaylist.all(),r=t||n[0].value,{data:function(){return{media:r,playlist:n}},promise:r.fetchDetails()}}c.$on("$destroy",function(){d.unsubscribe(m)}),m=d.subscribe(h,{action:[E.ACTION_MEDIA_ALBUM_CONTENT_LIST,E.ACTION_MEDIA_ALBUM_LIST]});function h(e){var r,i,o;switch(e.actn){case E.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(e.sucs===!0){for(r=0;r<e.mdaCntntLst.length;r++)e.mdaCntntLst[r].utId=c.utid,i=t(e.mdaCntntLst[r]),c.songs.save(i.getKey(),i);c.loadMoreSong=!1}else c.loadMoreSong=!1,c.stoploader=!0;break;case E.ACTION_MEDIA_ALBUM_LIST:if(e.sucs===!0)for(r=0;r<e.mediaAlbumList.length;r++)e.mediaAlbumList[r].mdaT===g&&(o=n.createAlbum(e.mediaAlbumList[r]),c.myAlbumsMap.save(o.getKey(),o));else c.stoploader=!0}c.$rgDigest()}}angular.module("ringid.media").controller("MediaPostController",MediaPostController),MediaPostController.$inject=["$scope","$location","RING_ROUTES"];function MediaPostController(e,t,n){e.setFeed=r;function r(r){r&&r.sucs===!0&&(t.path(n.MEDIA_FEEDS),e.$rgDigest())}}!function(e,t){"use strict";e.module("ringid.newsportal",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.newsportal").controller("portalFollowingController",portalFollowingController),portalFollowingController.$inject=["$scope","SystemEvents","$$stackedMap","$$newsPortalMap","portalHttpService","$ringbox","rgDropdownService","MESSAGES"];function portalFollowingController(e,t,n,r,i,o,a,s){var c,l;e.portalFollowMap=n.createNew(),e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="pages/dropdowns/portal-follow-action-dropdown.html",i.getPortalFollowingList().then(function(t){var n;if(t.sucs===!0){for(n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.portalFollowMap.save(c.getKey(),c);l=e.portalFollowMap.length()}else e.isEmptyFollow=!0;e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:i.getPortalCatList(e.getKey())}},e.loadMoreFollowingPortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getPortalFollowingList(l).then(function(t){var n;if(t.sucs===!0){for(n=0;n<t.npList.length;n++)c=r.create(t.npList[n]),e.portalFollowMap.save(c.getKey(),c);l=e.portalFollowMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.$rgDigest(),e.actionFollowingDropdown=function(t){var n,r;switch(t.action){case"edit":a.close(t.event),e.$rgDigest(),n=o.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal.value},remoteData:function(){return i.getPortalCatList(t.data.portal.value.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":a.close(t.event),e.$rgDigest(),r=s.NEWSPORTAL.C_UNFOLLOW,n=o.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:r}},templateUrl:"templates/partials/ringbox-confirm.html"}),n.result.then(function(n){n&&i.unFollowPortal(t.data.portal.value.getKey()).then(function(t){t.sucs===!0&&(e.portalFollowMap.remove(t.id),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()),e.$rgDigest()})})}},e.$on(t.PORTAL.UNFOLLOW_PORTAL,function(t,n){e.portalFollowMap.remove(n.id),e.portalFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()}),e.$on("$destroy",function(){e.portalFollowMap.reset()})}angular.module("ringid.newsportal").controller("portalDiscoverController",portalDiscoverController),portalDiscoverController.$inject=["$scope","SystemEvents","$$newsPortalMap","$$stackedMap","portalHttpService"];function portalDiscoverController(e,t,n,r,i){var o,a;e.portalDiscoverMap=r.createNew(),e.searchResultMap=r.createNew(),e.searching=!1,e.nodata=!1,e.loadmore=!0,e.showloadmore=!1,e.selected=null,i.getPortalDiscoverList().then(function(t){var r;if(t.sucs===!0){for(r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.portalDiscoverMap.save(o.getKey(),o);a=e.portalDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getDiscoverPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.getSearchPortalCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:i.getPortalCatList(e.getKey())}},e.loadMorePortal=function(){e.showloadmore=!0,e.$rgDigest(),i.getPortalDiscoverList(a).then(function(t){var r;if(t.sucs===!0){for(r=0;r<t.npList.length;r++)o=n.create(t.npList[r]),e.portalDiscoverMap.save(o.getKey(),o);a=e.portalDiscoverMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.doSearch=function(){e.searchParam?(e.searching=!0,e.nodata=!1,e.searchResultMap.reset(),e.$rgDigest(),i.searchNewsPortal(e.searchParam).then(function(t){var r;if(t.sucs===!0)for(r=0;r<t.searchedcontaclist.length;r++)o=n.create(t.searchedcontaclist[r].npDTO),e.searchResultMap.save(o.getKey(),o);else e.nodata=!0;e.$rgDigest()})):(e.searching=!1,e.nodata=!1,e.$rgDigest())},e.$on(t.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){var r;e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r),r=setTimeout(function(){e.searchResultMap.length()>0?(e.searchResultMap.remove(n.id),0===e.searchResultMap.length()&&(e.searchParam="",e.searching=!1,e.$rgDigest())):e.portalDiscoverMap.remove(n.id),e.selected=null,e.$rgDigest()},1e3),e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset(),e.searchResultMap.reset()})}angular.module("ringid.newsportal").controller("portalSaveController",portalSaveController),portalSaveController.$inject=["$scope","$controller","OPERATION_TYPES"];function portalSaveController(e,t,n){var r="newsportal_saved",i=n.SYSTEM.TYPE_NEWS_PORTAL_FEED+".newsportal_saved";e.pagekey=i,e.params={actn:n.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0,svd:!0},e.forAdd=r,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}angular.module("ringid.newsportal").controller("portalFollowController",portalFollowController),portalFollowController.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","portalHttpService","SystemEvents","$ringbox"];function portalFollowController(e,t,n,r,i,o,a,s){var c,l,u=[],d=[],g=[],m=[],E=0;for(e.portalName=r.target.getFullName(),e.portalId=r.target.getKey(),c=0;c<n.nCatList.length;c++)u.push(n.nCatList[c]),m.push(n.nCatList[c].id),n.nCatList[c].subsc&&d.push(n.nCatList[c].id);if(n.nCatList.length===d.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=u,0===d.length){for(e.selectall=!0,l=0;l<e.categoryList.length;l++)e.categoryList[l].subsc=e.selectall;d=m,e.$rgDigest()}e.selectPortalCat=function(e){var t=d.indexOf(e.id),n=g.indexOf(e.id);e.subsc?(n!==-1&&g.splice(n,1),t===-1&&d.push(e.id)):(t!==-1&&d.splice(t,1),n===-1&&g.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.portalId,d,g,E).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.PORTAL.DONE_FOLLOW_PORTAL,n),0===d.length&&t.$broadcast(a.PORTAL.UNFOLLOW_PORTAL,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){var t;for(e.selectall?(E=2,d=m,g=[],e.$rgDigest()):(E=1,d=[],g=m,e.$rgDigest()),t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){u=[]})}angular.module("ringid.feed").controller("PortalProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","portalHttpService","$$newsPortalMap","SystemEvents","$ringbox",function(e,t,n,r,i,o,a,s,c,l){var u,d,g=r.portalid,m=g;u="newsportal",d=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="pages/dropdowns/portal-cover-follow-action-dropdown.html",m=d+"."+g+".3",e.pagekey=m,e.action=d,e.params={actn:d,fndId:g,pType:3},e.forAdd=u,e.sortBy="at",a.getPortalShortDetails(g).then(function(t){t.sucs===!0&&(t.userDetails.npDTO.utId=t.userDetails.utId,t.userDetails.npDTO.prIm=t.userDetails.prIm,e.portalMap=s.create(t.userDetails.npDTO)),e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:a.getPortalCatList(e.getKey())}},e.actionFollowingDropdown=function(t){switch(t.action){case"edit":i.close(t.event),e.$rgDigest(),l.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal},remoteData:function(){return a.getPortalCatList(t.data.portal.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":i.close(t.event),e.$rgDigest(),a.unFollowPortal(t.data.portal.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.PORTAL.UNFOLLOW_PORTAL,t),e.portalMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.PORTAL.DONE_FOLLOW_PORTAL,function(){e.portalMap.setIfSubscribed(!0),e.$rgDigest()}),t("FeedMainController",{$scope:e})}]),angular.module("ringid.feed").controller("PortalFeedPopUpController",["$$feedMap","$scope","$controller","localData","$routeParams","remoteData","feedFactory","Auth","SystemEvents","$location","$boxInstance","Utils",function(e,t,n,r,i,o,a,s,c,l,u,d){t.feed=e.create(o),t.$rgDigest(),t.imageSize=d.getScaledImageSize(t.feed.getImages()[0].value.getIw(),t.feed.getImages()[0].value.getIh(),520,420),t.$rgDigest(),t.singleFeed=!0,t.ogData={},t.currentUser=s.currentUser(),t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.imageShowMoreLength=t.feed.getTotalImage()-1,t.showCommentBox=!0,n("FeedSubController",{$scope:t}),t.$rgDigest(),u.hideLoader()}]),angular.module("ringid.newsportal").directive("rgPortalTabNav",rgPortalTabNav),rgPortalTabNav.$inject=[];function rgPortalTabNav(){e.$inject=["$scope","$location"];function e(e,t){e.isCurrentPath=function(e,n){return n?t.path().indexOf(e)>-1:t.path()===e}}return{restrict:"E",controller:e,templateUrl:"pages/newsportal/portal.tabnav.directive.html"}}angular.module("ringid.newsportal").directive("rgPortalSlider",rgPortalSlider),rgPortalSlider.$inject=["$document","SystemEvents","Utils"];function rgPortalSlider(e,t,n){var r;i.$inject=["$scope","$$stackedMap","$$newsPortalMap","portalHttpService"];function i(e,n,r,i){var o;e.sliderImages=n.createNew(),e.showLeftArrow=!1,e.showRightArrow=!1,i.getPortalDiscoverList().then(function(t){var n;if(t.sucs===!0){for(n=0;n<t.npList.length;n++)o=r.create(t.npList[n]),e.sliderImages.save(o.getKey(),o);e.sliderImages.length()>4&&(e.showRightArrow=!0)}e.$rgDigest()}),e.getPortalCatList=function(e){return{data:function(){return{target:e}},promise:i.getPortalCatList(e.getKey())}},e.$on(t.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){var r=e.sliderImages.get(n.id);r&&r.setIfSubscribed(!0),e.$rgDigest()}),e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}return r=function(e,r){var i,o=r[0].querySelector(".news_banner_wrap"),a=r[0].querySelector(".news_banner_con"),s=1,c=!0,l=0;function u(){var t=o.clientWidth;n.viewport.x>=1600&&(e.imageWidth=t/4,e.$parent.$rgDigest()),n.viewport.x>=1270&&n.viewport.x<1600&&(e.imageWidth=t/3,e.$parent.$rgDigest()),n.viewport.x>980&&n.viewport.x<1270&&(e.imageWidth=t/2,e.$parent.$rgDigest())}u(),e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(){i&&clearTimeout(i),i=setTimeout(function(){l=1,a.style.display="none",e.$parent.$rgDigest(),c=!0,u(),a.style.width=e.sliderImages.length()*e.imageWidth+"px",a.style.marginLeft="-"+((s-l)*e.imageWidth+5*s)+"px",a.style.display="",e.$parent.$rgDigest()},500)}),e.$on(t.MEDIA.SLIDER_IMAGE_LOADED,function(){a.style.display="none",e.$parent.$rgDigest(),a.style.width=e.sliderImages.length()*e.imageWidth+"px",a.style.display="",e.$parent.$rgDigest()}),e.right=function(){c&&(a.style.width=e.sliderImages.length()*e.imageWidth+"px",c=!1),a.style.marginLeft="-"+(s*e.imageWidth+5*s)+"px",s++,l=0,s>1&&(e.showLeftArrow=!0),s===e.sliderImages.length()-4&&(e.showRightArrow=!1),e.sliderImages.length()-4===1&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){s--,l=0,1===s&&(e.showLeftArrow=!1),s<e.sliderImages.length()-1&&(e.showRightArrow=!0),a.style.marginLeft="-"+((s-1)*e.imageWidth+5*s)+"px",e.$parent.$rgDigest()}},{restrict:"E",controller:i,link:r,templateUrl:"pages/newsportal/portal-slider-directive.html"}}angular.module("ringid.newsportal").directive("rgDiscoverPortal",rgDiscoverPortal),rgDiscoverPortal.$inject=[];function rgDiscoverPortal(){e.$inject=["$scope","$$stackedMap","$$newsPortalMap","portalHttpService","SystemEvents","feedFactory","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){var s;e.portalDiscoverMap=t.createNew(),e.nodata=!1,e.selected=null,e.params={actn:a.SYSTEM.TYPE_NEWS_PORTAL_FEED,scl:2,lmt:10,tm:0},r.getPortalDiscoverList().then(function(t){var r;if(t.sucs===!0){for(r=0;r<t.npList.length;r++)s=n.create(t.npList[r]),e.portalDiscoverMap.save(s.getKey(),s);e.portalDiscoverMap.length()}e.$rgDigest()}),e.$rgDigest(),e.getCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:r.getPortalCatList(e.getKey())}},e.$on(i.PORTAL.DONE_FOLLOW_PORTAL,function(t,n){var r;e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r),r=setTimeout(function(){e.portalDiscoverMap.remove(n.id),e.selected=null,o.initFeedRequest(e.params),e.$rgDigest()},1e3),e.$rgDigest()}),e.$on("$destroy",function(){e.portalDiscoverMap.reset()})}return{restrict:"E",controller:e,templateUrl:"pages/newsportal/discover.portal.directive.html"}}angular.module("ringid.newsportal").directive("rgBreakingNews",rgBreakingNews),rgBreakingNews.$inject=[];function rgBreakingNews(){e.$inject=["$scope","portalHttpService"];function e(e,t){t.getBreakingNews().then(function(t){var n;if(e.newsItems=[],t.sucs===!0)for(n=0;n<t.brNPFeeds.length;n++)e.newsItems.push(t.brNPFeeds[n]);e.$rgDigest()})}function t(e){var t;e.resetInterval=i,e.startInterval=o,e.activeId=0,e.next=function(){e.activeId<e.newsItems.length-1?e.activeId++:e.activeId=0},e.prev=function(){e.activeId>0?e.activeId--:e.activeId=e.newsItems.length-1};function n(){t=setInterval(r,5e3)}function r(){e.next(),e.$rgDigest()}function i(){t&&clearInterval(t)}function o(){n()}n()}return{restrict:"E",controller:e,link:t,templateUrl:"pages/newsportal/breaking-news.directive.html"}}!function(e,t){"use strict";e.module("ringid.business",["ringid.filters","ringid.config","ringid.controllers"])}(angular,window),angular.module("ringid.business").controller("FeedBusinessPortalController",["$scope","$controller","$routeParams","OPERATION_TYPES",function(e,t,n,r){var i="business",o=r.SYSTEM.TYPE_BUSINESS_PAGE_FEED+".business";e.pagekey=o,e.action=r.SYSTEM.TYPE_BUSINESS_PAGE_FEED,e.params={actn:r.SYSTEM.TYPE_BUSINESS_PAGE_FEED,scl:2,lmt:10,tm:0},e.isReady=!0,e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.forAdd=i,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}]),angular.module("ringid.business").controller("businessFollowController",businessFollowController),businessFollowController.$inject=["$scope","$rootScope","remoteData","localData","rgScrollbarService","businessHttpService","SystemEvents","$ringbox"];function businessFollowController(e,t,n,r,i,o,a,s){var c,l,u=[],d=[],g=[],m=[],E=0;for(e.portalName=r.target.getFullName(),e.businessId=r.target.getKey(),c=0;c<n.nCatList.length;c++)u.push(n.nCatList[c]),m.push(n.nCatList[c].id),n.nCatList[c].subsc&&d.push(n.nCatList[c].id);if(n.nCatList.length===d.length&&(e.selectall=!0,e.$rgDigest()),e.categoryList=u,0===d.length){for(e.selectall=!0,l=0;l<e.categoryList.length;l++)e.categoryList[l].subsc=e.selectall;d=m,e.$rgDigest()}e.selectPortalCat=function(e){var t,n;t=d.indexOf(e.id),n=g.indexOf(e.id),e.subsc?(n!==-1&&g.splice(n,1),t===-1&&d.push(e.id)):(t!==-1&&d.splice(t,1),n===-1&&g.push(e.id))},e.doneFollow=function(){o.doneFollowing(e.businessId,d,g,E).then(function(n){n.sucs===!0?(n.index=r.index,t.$broadcast(a.BUSINESS.DONE_FOLLOW_BUSINESS,n),0===d.length&&t.$broadcast(a.BUSINESS.UNFOLLOW_BUSINESS,n),s.close()):s.close(),e.$rgDigest()})},e.cancelFollow=function(){e.$close()},e.selectAllCat=function(){var t;for(e.selectall?(E=2,d=m,g=[],e.$rgDigest()):(E=1,d=[],g=m,e.$rgDigest()),t=0;t<e.categoryList.length;t++)e.categoryList[t].subsc=e.selectall;e.$rgDigest()},e.$on("$destroy",function(){u=[]})}angular.module("ringid.business").controller("businessDiscoverController",businessDiscoverController),businessDiscoverController.$inject=["$rootScope","$scope","SystemEvents","$$businessPageMap","$$stackedMap","businessHttpService"];function businessDiscoverController(e,t,n,r,i,o){var a,s,c;t.businessDiscoverMap=i.createNew(),t.searchResultMap=i.createNew(),t.searching=!1,t.nodata=!1,t.loadmore=!0,t.showloadmore=!1,t.selected=null,o.getBusinessDiscoverList().then(function(e){if(e.sucs===!0){for(c=0;c<e.npList.length;c++)a=r.create(e.npList[c]),t.businessDiscoverMap.save(a.getKey(),a);s=t.businessDiscoverMap.length()}t.$rgDigest()}),t.$rgDigest(),t.getDiscoverBusinessCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:o.getBusinessCatList(e.getKey())}},t.getSearchBusinessCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:o.getBusinessCatList(e.getKey())}},t.followPage=function(t,r){o.followBusinessPage(t.getKey()).then(function(t){t.sucs===!0&&(t.index=r,e.$broadcast(n.BUSINESS.DONE_FOLLOW_BUSINESS,t))})},t.loadMorePortal=function(){t.showloadmore=!0,t.$rgDigest(),o.getBusinessDiscoverList(s).then(function(e){if(e.sucs===!0){for(c=0;c<e.npList.length;c++)a=r.create(e.npList[c]),t.businessDiscoverMap.save(a.getKey(),a);s=t.businessDiscoverMap.length(),t.showloadmore=!1,t.$rgDigest()}e.npList.length<10&&(t.loadmore=!1),t.$rgDigest()})},t.doSearch=function(){var e;t.searchParam?(t.searching=!0,t.nodata=!1,t.searchResultMap.reset(),t.$rgDigest(),o.searchBusinessPortal(t.searchParam).then(function(n){if(n.sucs===!0)for(e=0;e<n.searchedcontaclist.length;e++)a=r.create(n.searchedcontaclist[e].npDTO),t.searchResultMap.save(a.getKey(),a);else t.nodata=!0;t.$rgDigest()})):(t.searching=!1,t.nodata=!1,t.$rgDigest())},t.$on(n.BUSINESS.DONE_FOLLOW_BUSINESS,function(e,n){var r;t.selected=n.index,t.$rgDigest(),r&&clearTimeout(r),r=setTimeout(function(){t.searchResultMap.length()>0?(t.searchResultMap.remove(n.id),0===t.searchResultMap.length()&&(t.searchParam="",t.searching=!1,t.$rgDigest())):t.businessDiscoverMap.remove(n.id),t.selected=null,t.$rgDigest()},1e3),t.$rgDigest()}),t.$on("$destroy",function(){t.businessDiscoverMap.reset(),t.searchResultMap.reset()})}angular.module("ringid.newsportal").controller("businessFollowingController",businessFollowingController),businessFollowingController.$inject=["$scope","SystemEvents","$$stackedMap","$$businessPageMap","businessHttpService","$ringbox","rgDropdownService","MESSAGES"];function businessFollowingController(e,t,n,r,i,o,a,s){var c,l,u;e.businessFollowMap=n.createNew(),e.loadmore=!0,e.showloadmore=!1,e.isEmptyFollow=!1,e.ddActionHtml="pages/dropdowns/portal-follow-action-dropdown.html",i.getBusinessFollowingList().then(function(t){if(t.sucs===!0){for(u=0;u<t.npList.length;u++)c=r.create(t.npList[u]),e.businessFollowMap.save(c.getKey(),c);l=e.businessFollowMap.length()}else e.isEmptyFollow=!0;e.$rgDigest()}),e.getBusinessCatList=function(e){return{data:function(){return{target:e}},promise:i.getBusinessCatList(e.getKey())}},e.loadMoreFollowingBusiness=function(){e.showloadmore=!0,e.$rgDigest(),i.getBusinessFollowingList(l).then(function(t){if(t.sucs===!0){for(u=0;u<t.npList.length;u++)c=r.create(t.npList[u]),e.businessFollowMap.save(c.getKey(),c);l=e.businessFollowMap.length(),e.showloadmore=!1,e.$rgDigest()}t.npList.length<10&&(e.loadmore=!1),e.$rgDigest()})},e.$rgDigest(),e.actionFollowingDropdown=function(t){var n,r;switch(t.action){case"edit":a.close(t.event),e.$rgDigest(),o.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"businessFollowController",resolve:{localData:{target:t.data.business.value},remoteData:function(){return i.getBusinessCatList(t.data.business.value.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":a.close(t.event),e.$rgDigest(),n=s.NEWSPORTAL.C_UNFOLLOW,r=o.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"}),r.result.then(function(n){n&&i.unFollowBusiness(t.data.business.value.getKey()).then(function(t){t.sucs===!0&&(e.businessFollowMap.remove(t.id),e.businessFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()),e.$rgDigest()})})}},e.$on(t.BUSINESS.UNFOLLOW_BUSINESS,function(t,n){e.businessFollowMap.remove(n.id),e.businessFollowMap.length()<1&&(e.isEmptyFollow=!0,e.$rgDigest()),e.$rgDigest()}),e.$on("$destroy",function(){e.businessFollowMap.reset()})}angular.module("ringid.business").controller("businessSaveController",businessSaveController),businessSaveController.$inject=["$scope","$controller","$routeParams","OPERATION_TYPES"];function businessSaveController(e,t,n,r){var i="business_saved",o=r.SYSTEM.TYPE_BUSINESS_PAGE_FEED+".business_saved";e.pagekey=o,e.params={actn:r.SYSTEM.TYPE_BUSINESS_PAGE_FEED,scl:2,lmt:10,tm:0,svd:!0},e.getFeedInfo=function(e){
return{data:function(){return{target:e}}}},e.forAdd=i,e.shareMenuDisabled=!0,e.showPostBox=function(){return!1},e.showSpecialFeed=function(){return!1},t("FeedMainController",{$scope:e})}angular.module("ringid.feed").controller("businessProfileController",["$scope","$controller","$rootScope","$routeParams","rgDropdownService","OPERATION_TYPES","businessHttpService","$$businessPageMap","SystemEvents","$ringbox",function(e,t,n,r,i,o,a,s,c,l){var u,d,g=r.portalid,m=g;u="business",d=o.SYSTEM.TYPE_FRIEND_NEWSFEED,e.ddActionHtml="pages/dropdowns/portal-cover-follow-action-dropdown.html",m=d+"."+g+".4",e.pagekey=m,e.action=d,e.params={actn:d,fndId:g,pType:4},e.forAdd=u,e.sortBy="at",a.getBusinessShortDetails(g).then(function(t){t.sucs===!0&&(t.userDetails.npDTO.utId=t.userDetails.utId,t.userDetails.npDTO.prIm=t.userDetails.prIm,e.businessMap=s.create(t.userDetails.npDTO)),e.$rgDigest()}),e.getBusinessCatList=function(e){return{data:function(){return{target:e}},promise:a.getBusinessCatList(e.getKey())}},e.getFeedInfo=function(e){return{data:function(){return{target:e}}}},e.actionFollowingDropdown=function(t){switch(t.action){case"edit":i.close(t.event),e.$rgDigest(),l.open({type:"remote",scope:!1,onBackDropClickClose:!0,controller:"portalFollowController",resolve:{localData:{target:t.data.portal},remoteData:function(){return a.getBusinessCatList(t.data.portal.getKey())}},templateUrl:"pages/newsportal/portal-follow.popup.html"});break;case"unfollow":i.close(t.event),e.$rgDigest(),a.unFollowBusiness(t.data.portal.getKey()).then(function(t){t.sucs===!0&&(n.$broadcast(c.BUSINESS.UNFOLLOW_BUSINESS,t),e.businessMap.setIfSubscribed(!1),e.$rgDigest())})}},e.$on(c.BUSINESS.DONE_FOLLOW_BUSINESS,function(){e.businessMap.setIfSubscribed(!0),e.$rgDigest()}),t("FeedMainController",{$scope:e})}]),angular.module("ringid.business").controller("businessFeedPopupController",["$$feedMap","$scope","$controller","localData","$routeParams","feedFactory","Auth","SystemEvents","$location","$boxInstance","remoteData",function(e,t,n,r,i,o,a,s,c,l,u){t.feed=e.create(u),t.$rgDigest(),t.singleFeed=!0,t.ogData={},t.currentUser=a.currentUser(),t.feedstatus=t.feed.text(),t.keyid=t.feed.getKey(),t.imageslength=t.feed.getImages().length,t.imageShowMoreLength=t.feed.getTotalImage()-1,t.showCommentBox=!0,n("FeedSubController",{$scope:t}),t.$rgDigest(),l.hideLoader();try{t.audio=t.feed.getAudios().all()[0].value}catch(e){t.audio=null}try{t.media=t.feed.getMedias().all()[0].value}catch(e){t.media=null}}]),angular.module("ringid.business").directive("rgBusinessTabNav",rgBusinessTabNav),rgBusinessTabNav.$inject=["routeService"];function rgBusinessTabNav(e){t.$inject=["$scope","$location"];function t(t,n){t.routes={pages:e.getRoute("PAGES_FEED"),discover:e.getRoute("PAGES_DISCOVER"),following:e.getRoute("PAGES_FOLLOWING"),saved:e.getRoute("PAGES_SAVED")},t.isCurrentPath=function(e,t){return t?n.path().indexOf(e)>-1:n.path()===e}}return{restrict:"E",controller:t,templateUrl:"pages/business/business.tabnav.directive.html"}}angular.module("ringid.business").directive("rgBusinessSlider",rgBusinessSlider),rgBusinessSlider.$inject=["$document","SystemEvents","Utils"];function rgBusinessSlider(e,t,n){r.$inject=["$scope","$$stackedMap","$$businessPageMap","businessHttpService"];function r(e,n,r,i){var o,a;e.sliderImages=n.createNew(),e.showLeftArrow=!1,e.showRightArrow=!1,i.getBusinessDiscoverList().then(function(t){if(t.sucs===!0)for(a=0;a<t.npList.length;a++)o=r.create(t.npList[a]),e.sliderImages.save(o.getKey(),o);e.sliderImages.length()>4&&(e.showRightArrow=!0),e.$rgDigest()}),e.getCatList=function(e){return{data:function(){return{target:e}},promise:i.getBusinessCatList(e.getKey())}},e.$on(t.BUSINESS.DONE_FOLLOW_BUSINESS,function(t,n){var r=e.sliderImages.get(n.id);r&&r.setIfSubscribed(!0),e.$rgDigest()}),e.$rgDigest(),e.$on("$destroy",function(){e.sliderImages.reset()})}function i(e,r){var i,o,a,s=1,c=!0,l=0;i=r[0].querySelector(".news_banner_wrap"),o=r[0].querySelector(".news_banner_con");function u(){var t=i.clientWidth;n.viewport.x>=1600&&(e.imageWidth=t/4,e.$parent.$rgDigest()),n.viewport.x>=1270&&n.viewport.x<1600&&(e.imageWidth=t/3,e.$parent.$rgDigest()),n.viewport.x>980&&n.viewport.x<1270&&(e.imageWidth=t/2,e.$parent.$rgDigest())}u(),e.$rgDigest(),e.$on(t.COMMON.WINDOW_RESIZED,function(){a&&clearTimeout(a),a=setTimeout(function(){l=1,o.style.display="none",e.$parent.$rgDigest(),c=!0,u(),o.style.width=e.sliderImages.length()*e.imageWidth+"px",o.style.marginLeft="-"+((s-l)*e.imageWidth+5*s)+"px",o.style.display="",e.$parent.$rgDigest()},500)}),e.right=function(){c&&(o.style.width=e.sliderImages.length()*e.imageWidth+"px",c=!1),o.style.marginLeft="-"+(s*e.imageWidth+5*s)+"px",s++,l=0,s>1&&(e.showLeftArrow=!0),s===e.sliderImages.length()-4&&(e.showRightArrow=!1),e.sliderImages.length()-4===1&&(e.showRightArrow=!1),e.$parent.$rgDigest()},e.left=function(){s--,l=0,1===s&&(e.showLeftArrow=!1),s<e.sliderImages.length()-1&&(e.showRightArrow=!0),o.style.marginLeft="-"+((s-1)*e.imageWidth+5*s)+"px",e.$parent.$rgDigest()}}return{restrict:"E",controller:r,link:i,templateUrl:"pages/business/business-slider-directive.html"}}angular.module("ringid.business").directive("rgDiscoverBusiness",rgDiscoverBusiness),rgDiscoverBusiness.$inject=[];function rgDiscoverBusiness(){e.$inject=["$scope","$$stackedMap","$$businessPageMap","businessHttpService","SystemEvents","feedFactory","OPERATION_TYPES","$rootScope"];function e(e,t,n,r,i,o,a,s){var c,l;e.businessDiscoverMap=t.createNew(),e.nodata=!1,e.selected=null,e.params={actn:a.SYSTEM.TYPE_BUSINESS_PAGE_FEED,scl:2,lmt:10,tm:0},r.getBusinessDiscoverList().then(function(t){if(t.sucs===!0)for(l=0;l<t.npList.length;l++)c=n.create(t.npList[l]),e.businessDiscoverMap.save(c.getKey(),c);e.$rgDigest()}),e.$rgDigest(),e.getCatList=function(e,t){return{data:function(){return{target:e,index:t}},promise:r.getBusinessCatList(e.getKey())}},e.followPage=function(e,t){r.followBusinessPage(e.getKey()).then(function(e){e.sucs===!0&&(e.index=t,s.$broadcast(i.BUSINESS.DONE_FOLLOW_BUSINESS,e))})},e.$on(i.BUSINESS.DONE_FOLLOW_BUSINESS,function(t,n){var r;e.selected=n.index,e.$rgDigest(),r&&clearTimeout(r),r=setTimeout(function(){e.businessDiscoverMap.remove(n.id),e.selected=null,o.initFeedRequest(e.params),e.$rgDigest()},1e3),e.$rgDigest()}),e.$on("$destroy",function(){e.businessDiscoverMap.reset()})}return{restrict:"E",controller:e,templateUrl:"pages/business/discover.business.directive.html"}}!function(e,t){"use strict";e.module("ringid.profile",["ringid.config","ringid.digits","ringid.global_services","ringid.auth","ringid.media","ui.bootstrap","angular-svg-round-progress"])}(angular,window),angular.module("ringid.profile").service("profileHttpService",profileHttpService),profileHttpService.$inject=["$$connector","OPERATION_TYPES","Utils"];function profileHttpService(e,t,n){var r=this,i=t.SYSTEM.PROFILE,o=t.SYSTEM.REQUEST_TYPE;function a(t,n){var r;return r=n?{actn:i.TYPE_ACTION_CURRENT_USER_BASICINFO}:{actn:i.TYPE_ACTION_OTHER_USER_BASICINFO,utId:t},e.request(r,o.REQUEST)}function s(t,n){var r={actn:i.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!n};return angular.extend(r,t),e.request(r,o.REQUEST,!0)}function c(t){var n={actn:i.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:t};return e.request(n,o.REQUEST)}function l(t){var n={actn:i.TYPE_ACTION_USER_MOOD,mood:t};return e.request(n,o.AUTHENTICATION)}function u(t){var n={actn:i.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:t};return e.request(n,o.REQUEST)}function d(t){var n;return n=t?{actn:i.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS,utId:t}:{actn:i.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS},e.send(n,o.REQUEST)}function g(t,n,r,a){var s,c=a;return 1!==c&&(c=c.getTime()),s={actn:i.TYPE_ACTION_MODIFY_USER_PROFILE,nOfHd:7,fn:n.fn.utf8Encode(),hc:n.hc?n.hc.utf8Encode():" ",cc:n.cc?n.cc.utf8Encode():" ",gr:n.gr,am:n.am.utf8Encode(),bDay:r?r.getTime():1,mDay:c},e.request(s,o.UPDATE)}function m(){var t={actn:i.TYPE_ACTION_MODIFY_PRIVACY_SETTINGS,pvc:[3,3,3,3,3]};return e.request(t,o.UPDATE)}function E(t){var n={actn:i.TYPE_ACTION_ADD_EDUCATION,request_type:o.UPDATE,edu:{af:1,cntn:t.cntn?t.cntn.utf8Encode():"",desc:t.desc?t.desc.utf8Encode():"",dgr:t.dgr?t.dgr.utf8Encode():"",grtd:t.grtd,iss:t.iss,scl:t.scl.utf8Encode(),ft:t.ft?t.ft:1,tt:t.tt?t.tt:1,ut:0}};return e.request(n,o.UPDATE)}function f(t){var n={actn:i.TYPE_ACTION_REMOVE_EDUCATION,id:t};return e.request(n,o.UPDATE)}function p(t){var n={actn:i.TYPE_ACTION_UPDATE_EDUCATION,edu:{id:t.id,scl:t.scl.utf8Encode(),ft:t.ft?t.ft:1,tt:t.tt?t.tt:1,desc:t.desc?t.desc.utf8Encode():"",af:t.af,grtd:t.grtd,iss:t.iss,cntn:t.cntn?t.cntn.utf8Encode():"",dgr:t.dgr?t.dgr.utf8Encode():""}};return e.request(n,o.UPDATE)}function T(){var t={actn:230};return e.request(t,o.REQUEST)}function h(t){var n={actn:i.TYPE_ACTION_ADD_SKILL,skill:{skl:t.skl.utf8Encode(),desc:t.desc.utf8Encode()}};return e.request(n,o.UPDATE)}function I(t){var n={actn:i.TYPE_ACTION_UPDATE_SKILL,skill:{id:t.id,skl:t.skl.utf8Encode(),desc:t.desc.utf8Encode()}};return e.request(n,o.UPDATE)}function _(t){var n={actn:i.TYPE_ACTION_REMOVE_SKILL,id:t};return e.request(n,o.UPDATE)}function A(t){var n={actn:i.TYPE_ACTION_ADD_WORK,request_type:o.UPDATE,wrk:{pstn:t.pstn?t.pstn.utf8Encode():"",desc:t.desc?t.desc.utf8Encode():"",cnm:t.cnm.utf8Encode(),tt:t.tt||1,ft:t.ft||1}};return e.request(n,o.UPDATE)}function S(t){var n={actn:i.TYPE_ACTION_UPDATE_WORK,wrk:{id:t.id,pstn:t.pstn.utf8Encode(),cnm:t.cnm.utf8Encode(),desc:t.desc.utf8Encode(),tt:t.tt||1,ft:t.ft||1}};return e.request(n,o.UPDATE)}function C(t){var n={actn:i.TYPE_ACTION_REMOVE_WORK,id:t};return e.request(n,o.UPDATE)}function v(t){var n={actn:i.TYPE_CHANGE_PROFILE_PIC,type:1,imT:2,pimX:t.pimX,pimY:t.pimY,ih:t.ih,iw:t.iw,iurl:t.iurl};return e.request(n,o.UPDATE)}function D(t){var n={actn:i.TYPE_CHANGE_COVER_PIC,type:1,imT:3,cimX:t.cimX,cimY:t.cimY,ih:t.ih,iw:t.iw,iurl:t.iurl};return e.request(n,o.UPDATE)}function R(t,n){var r={actn:i.CHANGE_PASSWORD,oPw:t,nPw:n};return e.request(r,o.UPDATE)}function M(t){var n={actn:i.SEND_VERIFICATION_CODE_TO_MAIL,el:t.email};return e.request(n,o.REQUEST)}function N(t){var n={actn:i.SEND_VERIFICATION_CODE_TO_MAIL,el:t.email,vc:t.code};return e.request(n,o.REQUEST)}function y(t){var n={actn:t.utId,sn:t.sn,sv:t.sv};return t.hasOwnProperty("utId")&&(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function b(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function O(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function P(t){var n={actn:t.actn,sn:t.sn,sv:t.sv};return t.isCurrent||(n.utId=t.utId),e.request(n,o.UPDATE,!0)}function L(t){var r={actn:i.ADD_SOCIAL_NETWORK,it:t.access_token,smid:t.id,wk:n.getUniqueID()};return"facebook"===t.platform?r.smt=4:"twitter"===t.platform&&(r.smt=5),e.request(r,o.AUTHENTICATION)}function U(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}function F(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}function w(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}function k(t){var n={actn:i.TYPE_CHANGE_PRIVACY,sn:t.sn,sv:t.sv};return e.request(n,o.UPDATE,!0)}r.basicAndPrivacy=a,r.getUserDetails=s,r.fetchPresenceAndMood=c,r.changeMood=l,r.getMutualFriends=u,r.getUserProfileData=d,r.updateProfile=g,r.updateProfilePrivacy=m,r.submitNewEducation=E,r.deleteEducation=f,r.updateEducationById=p,r.getAllSkill=T,r.submitNewSkill=h,r.updateSkill=I,r.deleteSkill=_,r.submitNewWork=A,r.updateWork=S,r.deleteWork=C,r.changeProfilePicture=v,r.changeCoverPicture=D,r.changePassword=R,r.sendCode=M,r.verifyCode=N,r.changePrivacy=y,r.saveCallPvcEdit=b,r.saveChatPvcEdit=O,r.saveFeedPvcEdit=P,r.addSocialAccount=L,r.saveAchatSetting=U,r.saveAinfndreqSettings=F,r.saveAfamSettings=w,r.saveAafSetting=k}angular.module("ringid.profile").directive("rgImgReposition",rgImgReposition),rgImgReposition.$inject=["imageQuality","fileUploadService","$document","APP_CONSTANTS","GlobalEvents","SystemEvents"];function rgImgReposition(e,t,n,r,i,o){function a(e,t,n,r){if(3===arguments.length||r){if(n<e)return e;if(n>t)return t}return n}function s(e,n){var s,c,l,u,d=n[0].clientWidth,g=n[0].clientHeight,m="profilephoto"===e.imgType?r.PROFILE_PIC_CROP_WIDTH:r.COVER_PIC_CROP_WIDTH,E="profilephoto"===e.imgType?r.PROFILE_PIC_CROP_WIDTH:r.COVER_PIC_CROP_HEIGHT,f=1,p="",T=1,h=!1,I={bound:!0},_={width:0,height:0};e.selectFromAlbum=t.selectFromAlbum;function A(){var e;d=n[0].clientWidth,e=Math.ceil(r.COVER_PIC_CROP_HEIGHT*d/r.COVER_PIC_CROP_WIDTH),n[0].style.height=e+"px",g=e}"coverphoto"===e.imgType&&(A(!0),e.$on(o.COMMON.WINDOW_RESIZED,A)),e.$watch("enabled",function(e){e?R():S(!1)});function S(t){t||e.enabled?(n.bind("mousedown",C),n.bind("mouseup",D)):(n.unbind("mousedown",C),n.unbind("mouseup",D)),e.$rgDigest()}function C(t){e.enabled&&(1===t.which&&(l=t.clientX,u=t.clientY,h=!0),n.bind("mousemove",v))}function v(t){var r,i,o;e.enabled&&h&&(r=e.elemStyle.backgroundPosition.match(/(-?\d+).*?\s(-?\d+)/)||[],i=t.clientX,o=t.clientY,s=parseInt(r[1],10)||0,c=parseInt(r[2],10)||0,s=a(d-_.width,0,s+i-l,I.bound),c=a(g-_.height,0,c+o-u,I.bound),RingLogger.information("xPos: "+s," yPos:"+c,RingLogger.tags.UPLOAD),n.css({backgroundPosition:s+"px "+c+"px"}))}function D(){e.enabled&&h&&(void 0!==s&&void 0!==c&&(e.elemStyle.backgroundPosition=s+"px "+c+"px",RingLogger.print("yPos: "+c+" xpos: "+s,RingLogger.tags.PROFILE),RingLogger.print("REPOSITION SCALE: "+T,RingLogger.tags.PROFILE),t.setReposition({cimX:Math.ceil(Math.abs(s)/T)||0,cimY:Math.ceil(Math.abs(c)/T)||0},e.imgType)),h=!1,s=void 0,c=void 0,n.unbind("mousemove",v))}function R(){var t,n=e.elemStyle.backgroundImage;p=(n.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],p&&(t=new Image,t.onload=M,t.src=p)}function M(){var n=this;e.toggleResizeShow()(e.imgType,!1),_.width=n.width,_.height=n.height,_.width/m<=_.height/E?(T=d/_.width,_.width=d,_.height=Math.floor(_.height*T),f=n.width/m,t.setReposition({iw:Math.ceil(n.width),ih:Math.ceil(E*f)},e.imgType)):(T=g/_.height,_.height=g,_.width=Math.floor(_.width*T),f=n.height/E,t.setReposition({ih:Math.ceil(n.height),iw:Math.ceil(m*f)},e.imgType)),S(!0),RingLogger.print("repositionScale: "+T,RingLogger.tags.PROFILE),RingLogger.print("elementW: "+d+" elementH: "+g,RingLogger.tags.PROFILE),RingLogger.print("cropMinW: "+m+" cropMinH: "+E,RingLogger.tags.PROFILE),RingLogger.print("imageW: "+_.width+" imageH: "+_.height,RingLogger.tags.PROFILE)}function N(){"coverphoto"===e.imgType&&i.unbindHandler("window","resize",A),e.enabled&&(n.unbind("mousedown",C),n.unbind("mouseup",D))}e.$on("$destroy",N)}return{restrict:"A",replace:!1,scope:{elemStyle:"=",enabled:"=",imgType:"@",toggleResizeShow:"&"},link:s}}angular.module("ringid.profile").directive("rgProfile",rgProfile);function rgProfile(){e.$inject=["$ringbox","$scope","Notification","Storage","friendsFactory","routeService","$routeParams","Auth","profileFactory","fileUploadService","imageQuality","AlbumFactory","SystemEvents","Utils","Ringalert","languageConstant","$rootScope","rgDropdownService","GlobalEvents"];function e(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p,T,h){var I,_,A,S=a.uId;t.viewport=m.viewport,t.isOwner=s.currentUser().getKey()===S,t.consType=f.get(),t.profilePicDragEnable=!1,t.coverPicDragEnable=!1,t.processing=!1,t.profileDdControl={showOnHover:!0,enableCoverReposition:!0,enableProfileReposition:!0},t.showCoverDD=!1,t.coverPhotoStyle={backgroundSize:"cover"},t.profilePhotoStyle={backgroundSize:"cover"},t.routes={friends:o.getRoute("PROFILE",{uId:a.uId,subpage:"friends"}),photos:o.getRoute("PROFILE",{uId:a.uId,subpage:"photos"}),media:o.getRoute("PROFILE",{uId:a.uId,subpage:"media"}),post:o.getRoute("PROFILE",{uId:a.uId}),about:o.getRoute("PROFILE",{uId:a.uId,subpage:"about"})},t.profileObj=c.getProfile(S),t.frndAction=M,t.toggleResizeShow=b,t.uploadAction=O,t.uploadPicture=P,t.toggleCoverPhotoReposition=L,t.toggleProfilePhotoReposition=U,t.getImageData=F,t.repositionExisting=!1,t.coverDdHtml="templates/dropdowns/coverphoto-dropdown.html",t.coverDdAction=N,t.profileDdHtml="templates/dropdowns/profilephoto-dropdown.html",t.frndActionTemplate='<div class="action fr-drop-w z-in-110"><div class="ac-top-line drop-h" ng-if="ddControl.friendshipStatus()==0 && !ddControl.isCurrentUser()" rg-click="ddAction()({ action: \'addfriend\', friend: ddControl, event:$event})"><div class="drop-sprite fr-request-mar w-h-19 remove-member-ico feed-font"></div><a class="drop-h mar-top-8" href="#">{{consType.add_friend}}</a></div><div class="ac-top-line drop-h" ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl, event:$event})"><div class="drop-sprite fr-request-mar w-h-19 remove-member-ico feed-font"></div><a class="drop-h mar-top-8" href="#">{{consType.unfriend}}</a></div><div class="ac-top-line drop-h" ng-if="ddControl.friendshipStatus()==2" rg-click="ddAction()({ action: \'accept\', friend: ddControl, event:$event})"><div class="drop-sprite fr-request-mar w-h-19 request-accept-ico feed-font"></div><a class="drop-h mar-top-8" href="#">{{consType.accept}}</a></div><div class="ac-top-line drop-h" ng-if="ddControl.friendshipStatus()==3" rg-click="ddAction()({ action: \'remove\', friend: ddControl, event:$event})"><div class="drop-sprite w-h-19 fr-request-mar request-cancel-ico feed-font"></div><a class="drop-h mar-top-8" href="#">Cancel Request</a></div><div class="ac-top-line drop-h" ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl, event:$event})"><div class="drop-sprite fr-request-mar w-h-19 block-ico feed-font"></div><a class="drop-h mar-top-8" href="#">{{consType.block}}</a></div><div class="ac-top-line drop-h" ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl, event:$event})"><div class="drop-sprite w-h-19 unblock-ico feed-font"></div><a class="drop-h mar-top-8" href="#">{{consType.unblock}}</a></div><div class="ac-top-line drop-h" ng-if="!ddControl.isCurrentUser()"><div class="drop-sprite fr-request-mar w-h-13 report-ico feed-font"></div><a class="drop-h mar-top-8 mar-left-2" rg-report spam-type="user" spam-id="ddControl.getUtId()">Report</a></div></div>',t.profileDdAction=y,t.cvUploadProgressShow=!1,t.cvResizeProgressShow=!1,t.ppResizeProgressShow=!1,t.uploadStyle=w,t.roundProgressBarStyle={dataRoundProgressWidth:"200",dataRoundProgressHeight:"200",dataRoundProgressOuterCircleWidth:"4",dataRoundProgressInnerCircleWidth:"8",dataRoundProgressOuterCircleRadius:"85",dataRoundProgressInnerCircleRadius:"85",dataRoundProgressLabelFont:"24",dataRoundProgressOuterCircleBackgroundColor:"#fff",dataRoundProgressOuterCircleForegroundColor:"#f47727",dataRoundProgressInnerCircleColor:"#fff",dataRoundProgressLabelColor:"#fff"},t.ppUploadProgressShow=!1,t.uploadImageFileSize=k,t.getRoundedProgressTextStyle=$,t.roundProgressData=G,t.openRingbox=B,t.showMenuItems=!1,t.toggleMenuItem=C;function C(){t.showMenuItems=!t.showMenuItems,t.$rgDigest()}t.closeDropdown=v;function v(){t.showMenuItems=!1,t.$rgDigest()}function D(){t.profileObj&&(RingLogger.print("Page title from profile change",RingLogger.tags.PAGETITLE),m.setPageTitle(t.profileObj.getName(),!0)),void 0===a.subpage?t.subPage="post":(t.subPage=a.subpage,"about"===t.subPage&&(t.activeNav="basic")),t.subPageLink="templates/profile/profile."+t.subPage+".html",c.init(t.profileObj).then(function(){R("coverphoto"),R("profilephoto")}),R("coverphoto"),R("profilephoto"),t.$on(g.IMAGE.DO_REPOSITION,function(n,r){t.toggleResizeShow(l.uploadType,!0),t.uploadAction({action:l.uploadType,uploadFile:l.queueFile(l.uploadType,r.image)}),e.closeAll()}),t.$watch("profilePicDragEnable",function(e){e||t.ppUploadProgressShow||R("profilephoto")}),t.$watch("coverPicDragEnable",function(e){e||t.cvUploadProgressShow||R("coverphoto")}),t.$on(g.FILE_UPLOAD.PROGRESS_UPDATE,function(){t.$rgDigest()}),h.bindHandler("window","resize",H)}D();function R(e){"profilephoto"===e?(t.profilePhotoStyle.backgroundImage="url("+t.profileObj.avatar("thumb")+")",t.profilePhotoStyle.backgroundPosition="50% 50%",t.profilePhotoStyle.backgroundImage.indexOf("prof.png")>-1?t.profileDdControl.enableProfileReposition=!1:t.profileDdControl.enableProfileReposition=!0):(t.coverPhotoStyle.backgroundImage="url("+t.profileObj.getCover()+")",t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage.indexOf("default_cover")>-1?t.profileDdControl.enableCoverReposition=!1:t.profileDdControl.enableCoverReposition=!0),t.$rgDigest()}function M(e){T.close(e.event),e.friend.isLoading()||(i.friendAction(e,!0).then(function(){t.$rgDigest()},function(){t.$rgDigest()}),t.$rgDigest())}function N(e){switch(T.close(e.event),e.action){case"coverphoto":t.repositionExisting=!1,t.toggleResizeShow("coverphoto",!0),t.uploadAction(e);break;case"toggleReposition":t.repositionExisting=!0,t.toggleResizeShow("coverphoto",!0),t.uploadAction({action:"coverphoto",uploadFile:l.queueFile("coverphoto",t.profileObj.getCover("original"))});break;case"popupData":return l.uploadType="coverphoto",function(){return{popupType:"coverphoto"}};default:RingLogger.warning("Case Mismatch",RingLogger.tags.UPLOAD)}return!0}function y(e){switch(T.close(e.event),e.action){case"profilephoto":t.repositionExisting=!1,t.toggleResizeShow("profilephoto",!0),t.uploadAction(e);break;case"toggleReposition":t.toggleResizeShow("profilephoto",!0),t.repositionExisting=!0,t.uploadAction({action:"profilephoto",uploadFile:l.queueFile("profilephoto",t.profileObj.avatar("original"))});break;case"popupData":return l.uploadType="profilephoto",function(){return{popupType:"profilephoto"}};default:RingLogger.warning("Case Mismatch",RingLogger.tags.PROFILE)}return!0}function b(e,n){"coverphoto"===e?t.cvResizeProgressShow=n||!1:t.ppResizeProgressShow=n||!1,t.$rgDigest()}function O(e){var n;"coverphoto"===e.action?(_=e.uploadFile,n=_):(A=e.uploadFile,n=A),n&&(p.$broadcast(g.LOADING,!0),n.fetchMeta(function(r){p.$broadcast(g.LOADING,!1),r.success?"coverphoto"===e.action?t.toggleCoverPhotoReposition(n.getPreview()):t.toggleProfilePhotoReposition(n.getPreview()):(t.toggleResizeShow(e.action,!1),E.show(r.message,"error")),t.$rgDigest()})),t.$rgDigest()}function P(e,n){var r;"coverphoto"===e?(t.cvUploadProgressShow=!0,t.coverPicDragEnable=!1,r=_):"profilephoto"===e&&(t.ppUploadProgressShow=!0,t.profilePicDragEnable=!1,r=A),p.$broadcast(g.LOADING,!0),r.initUpload().then(function(n){t.cvUploadProgressShow=!1,t.ppUploadProgressShow=!1,n.sucs===!0?"profilephoto"===e?c.changeProfilePicture(n).then(function(){p.$broadcast(g.LOADING,!1),p.$rgDigest(),R(e)}):"coverphoto"===e&&c.changeCoverPicture(n).then(function(){p.$broadcast(g.LOADING,!1),p.$rgDigest(),R(e)}):(R(e),p.$broadcast(g.LOADING,!1))},function(){R(e)}),n&&n.stopPropagation(),t.$rgDigest()}function L(e,n){var r,i="",o=e||!1,a=t.profileObj.getCoverXY();t.coverPicDragEnable?(t.coverPicDragEnable=!1,R("coverphoto")):(o?i=o:(o=t.profileObj.getCover(),r=o.slice(o.lastIndexOf("/")+1,o.length),i=o.replace(r,r.replace("crp",""))),t.repositionExisting?t.coverPhotoStyle.backgroundPosition=-a.x+"px "+-a.y+"px":t.coverPhotoStyle.backgroundPosition="0px 0px",t.coverPhotoStyle.backgroundImage="url("+i+")",t.coverPicDragEnable=!0,t.$rgDigest()),n&&n.stopPropagation()}function U(e,n){var r,i,o="",a=e||!1,s=t.profileObj.getAvatarXY();t.profilePicDragEnable?(t.profilePicDragEnable=!1,R("profilephoto")):(a?o=a:(a=t.profileObj.avatar("original"),r=a.slice(a.lastIndexOf("/")+1,a.length),o=a.replace(r,r.replace(i,""))),t.repositionExisting?t.profilePhotoStyle.backgroundPosition=-s.x+"px "+-s.y+"px":t.profilePhotoStyle.backgroundPosition="0px 0px",t.profilePhotoStyle.backgroundImage="url("+o+")",t.profilePicDragEnable=!0,t.$rgDigest()),n&&n.stopPropagation()}function F(e){return{data:function(){return{imgId:e}},promise:d.getImageDetails(e)}}function w(){return{width:l.progress+"%"}}function k(){return l.currentUploadImageSize}function $(){return{top:"50%",bottom:"auto",left:"50%",transform:"translateY(-50%) translateX(-50%)","font-size":100/3.5+"px",position:"absolute"}}function G(){return{label:l.progress+"%",percentage:l.progress,dataLoaded:l.dataLoaded}}function B(e){return"cover"===e?!t.coverPicDragEnable&&!t.cvResizeProgressShow&&!t.cvUploadProgressShow&&t.profileDdControl.enableCoverReposition:!t.profilePicDragEnable&&!t.ppResizeProgressShow&&!t.ppUploadProgressShow&&t.profileDdControl.enableProfileReposition}function H(){I||setTimeout(function(){t.$rgDigest(),I=!1})}function x(){h.unbindHandler("window","resize",H),"about"===a.subPage&&c.removeProfileData(t.profileObj.getUtId())}t.$on("$destroy",x)}function t(e,t){function n(){e.showCoverDD=!e.showCoverDD,e.$rgDigest()}t.on("mouseenter",n),t.on("mouseleave",n),e.$on("$destroy",function(){t.off("mouseenter",n),t.off("mouseleave",n)})}return{restrict:"E",scope:!0,templateUrl:"templates/profile/profile-header.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileBasic",rgProfileBasic);function rgProfileBasic(){e.$inject=["Storage","$scope","Utils","profileFactory","Ringalert","$rootScope"];function e(e,t,n,r,i,o){var a,s,c,l=/[!@#$%^&*~`()_+\-=\[\]{};':"\\|,.<>\/?]/gi;t.isEditProfile=!1,t.processing=!1,t.nameError=!1,t.$watch("tmpBasic.fn",function(e){e&&(a=e.match(l)||[],s=e.replace(/\s/g,""),s.length===a.length?t.nameError=!0:t.nameError=!1),t.$rgDigest()}),t.enableEditBasic=u,t.updateMyBasicInfo=g,t.cancelUpdateMyBasicInfo=d;function u(e){e.preventDefault(),t.tmpBasic=angular.copy(t.profileObj.getBasicInfo()),1!==t.tmpBasic.mDay&&"1"!==t.tmpBasic.mDay||(t.tmpBasic.marriageDay=null),1!==t.tmpBasic.birthDay&&"1"!==t.tmpBasic.birthDay||(t.tmpBasic.birthday=null),t.isEditProfile=!0,t.$rgDigest()}function d(){t.isEditProfile=!1,t.$rgDigest()}function g(){var c,u,d,g,m,E,f,p,T;return a=t.tmpBasic.fn.match(l)||[],s=t.tmpBasic.fn.replace(/\s/g,""),s.length===a.length?void(t.nameError=!0):(t.processing=!0,c=t.tmpBasic.marriageDay,null==c&&(c=1),d=typeof t.tmpBasic.birthday,g=typeof c,"string"===d?(m=t.tmpBasic.birthday.split("-"),E=parseInt(m[0],10)+","+parseInt(m[1],10)+","+parseInt(m[2],10),u=new Date(E)):(u=t.tmpBasic.birthday,1!==t.tmpBasic.birthDay&&"1"!==t.tmpBasic.birthDay&&(f=n.profileVerbalDate(t.tmpBasic.birthDay),t.tmpBasic.birthday=f)),"string"===g&&(p=c.split("-"),T=parseInt(p[0],10)+","+parseInt(p[1],10)+","+parseInt(p[2],10),c=new Date(T)),void r.updateUserProfile(t.uId,t.tmpBasic,u,c).then(function(n){n.sucs===!0?(t.tmpBasic.birthDay=u?u.getTime():"1","object"==typeof u?t.currentUser.setBirthday(t.tmpBasic.birthDay):t.currentUser.setBirthday("1"),"object"===g?t.currentUser.setMarriageday(c.getTime()):t.currentUser.setMarriageday("1"),t.profileObj.getBasicInfo().birthDay=t.tmpBasic.birthDay,t.currentUser.setName(t.tmpBasic.fn),t.currentUser.setHomeCity(t.tmpBasic.hc),t.currentUser.setCurrentCity(t.tmpBasic.cc),t.currentUser.setAboutMe(t.tmpBasic.am),e.updateLoginData("fn",t.tmpBasic.fn),t.currentUser.setGender(t.tmpBasic.gr),i.show("Successfully updated","success"),t.isEditProfile=!1):(t.isEditProfile=!1,i.show(n.mg,"error")),t.processing=!1,o.$rgDigest()}))}t.isDatePickerOpen=!1,t.model={},t.open=function(e,n){switch(e.preventDefault(),e.stopPropagation(),n){case"wcalendar":t.model.wcalendarTo=!1;break;case"wcalendarTo":t.model.wcalendar=!1;break;case"ecalendar":t.model.ecalendarTo=!1;break;case"ecalendarTo":t.model.ecalendar=!1;break;case"mcalendar":t.model.mcalendar=!1}t.model[n]=!t.model[n]},t.dateOptions={showWeeks:"false",startingDay:1},c=new Date,c.setMonth(c.getMonth()+6),t.minDate=new Date,t.maxBirthDate=new Date(c.getFullYear(),c.getMonth(),c.getDate()),t.maxWeddingDate=new Date(c.getFullYear()+20,c.getMonth(),c.getDate())}return{restrict:"E",templateUrl:"templates/profile/profile.about-basic.html",controller:e}}angular.module("ringid.profile").directive("rgProfilePrivacy",rgProfilePrivacy);function rgProfilePrivacy(){e.$inject=["Auth","Storage","$timeout","$scope","friendsFactory","profileFactory"];function e(e,t,n,r,i,o){r.isEditProfilePrivacy=!1,r.callPvcEdit=!1,r.chatPvcEdit=!1,r.feedPvcEdit=!1,r.fPrivacyInfo={callPrivacy:0,chatPrivacy:0,feedPrivacy:0},r.enablePrivacyEditMode=a,r.savePvcEdit=s,r.cancelPvcEdit=c,r.profileObj.isCurrentUser()?e.fetchPrivacy().then(function(e){e.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.cla,r.fPrivacyInfo.chatPrivacy=e.chta,r.fPrivacyInfo.feedPrivacy=e.fda),r.$rgDigest()}):(r.access=r.profileObj.getAccess,r.fPrivacyInfo.callPrivacy=r.profileObj.getAccess().cla,r.fPrivacyInfo.chatPrivacy=r.profileObj.getAccess().chta,r.fPrivacyInfo.feedPrivacy=r.profileObj.getAccess().fda,r.fPrivacyInfo.callPrivacy||r.fPrivacyInfo.chatPrivacy||r.fPrivacyInfo.feedPrivacy||r.profileObj.setBlock(1),r.$rgDigest());function a(e){e.preventDefault(),r.isEditProfilePrivacy=!0,r.$rgDigest()}function s(e){var t,n,i;r.isEditProfilePrivacy=!1,t=r.profileObj.isCurrentUser()?{actn:216,sv:e.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:e.callPrivacy,sn:6,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.callPrivacy=e.callPrivacy,o.saveCallPvcEdit(t).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.callPrivacy=e.callPrivacy)}),n=r.profileObj.isCurrentUser()?{actn:216,sv:e.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:e.chatPrivacy,sn:7,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.chatPrivacy=e.chatPrivacy,o.saveChatPvcEdit(n).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.chatPrivacy=e.chatPrivacy)}),i=r.profileObj.isCurrentUser()?{actn:216,sv:e.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:e.feedPrivacy,sn:8,utId:r.profileObj.getUtId(),isCurrent:!1},r.fPrivacyInfo.feedPrivacy=e.feedPrivacy,o.saveFeedPvcEdit(i).then(function(t){t.sucs===!0&&(r.fPrivacyInfo.feedPrivacy=e.feedPrivacy)}),r.$rgDigest()}function c(){r.isEditProfilePrivacy=!1,r.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-privacy.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileEducation",rgProfileEducation);function rgProfileEducation(){e.$inject=["Ringalert","$scope","Utils","profileFactory","$routeParams","rgDropdownService","OPERATION_TYPES","$$connector"];function e(e,t,n,r,i,o,a,s){var c,l,u,d=a.SYSTEM.PROFILE,g={};t.profileObj.isCurrentUser()?t.isOwner=!0:t.isOwner=!1,r.getUserProfileData({uId:i.uId},t.profileObj.isCurrentUser()),t.getProfileData=r.getProfileData,t.educationlist=[],t.edusclerror=!1,t.edudgrerror=!1,t.educntnerror=!1,t.$watch("eduObjInfo.scl",function(e){e&&(t.edusclerror=!1)}),t.$watch("eduObjInfo.dgr",function(e){e&&(t.edudgrerror=!1)}),t.$watch("eduObjInfo.cntn",function(e){e&&(t.educntnerror=!1)}),t.ddActionHtml="templates/dropdowns/action-dropdown.html",t.actionEduDropdown=function(e){switch(o.close(e.event),e.action){case"edit":E(e.data.index,e.data.obj);break;case"delete":I(e.data.index,e.data.obj)}},t.isaddNewEducation=!1,t.isEditEducation=-1,t.eduObjInfo={},t.addNewEducation=m,t.submitNewEducation=h,t.updateEducation=T,t.cancelAddEducation=f,t.cancelUpdateEducation=p;function m(){c&&(t.educationlist[l]=c),t.isEditEducation=-1,t.eduObjInfo.scl="",t.eduObjInfo.dgr="",t.eduObjInfo.cntn="",t.eduObjInfo.toTimeE="",t.eduObjInfo.fromTimeE="",t.isaddNewEducation=!0,t.$rgDigest()}function E(e){l=e,t.eduObjInfo=t.educationlist[e],c=angular.copy(t.educationlist[e]),1===t.eduObjInfo.tt&&(t.eduObjInfo.toTimeE=null),1===t.eduObjInfo.ft&&(t.eduObjInfo.fromTimeE=null),t.isaddNewEducation=!1,t.isEditEducation=e,t.$rgDigest()}function f(){c&&(t.educationlist[l]=c),t.isaddNewEducation=!1,t.isEditEducation=-1,t.$rgDigest()}function p(){t.educationlist[l]=c,t.isEditEducation=-1,t.$rgDigest()}function T(){var i,o;if(t.eduObjInfo.scl||(t.edusclerror=!0,t.$rgDigest()),t.eduObjInfo.dgr||(t.edudgrerror=!0,t.$rgDigest()),t.eduObjInfo.cntn||(t.educntnerror=!0,t.$rgDigest()),!(t.edusclerror||t.edudgrerror||t.educntnerror)){
if(t.processing=!0,t.eduObjInfo.fromTimeE&&t.eduObjInfo.toTimeE){if(i=t.eduObjInfo.fromTimeE,o=t.eduObjInfo.toTimeE,"string"==typeof i&&(i=new Date(i)),"string"==typeof o&&(o=new Date(o)),i>o)return e.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.$rgDigest()}t.eduObjInfo.fromTimeE?t.eduObjInfo.ft=new Date(t.eduObjInfo.fromTimeE).getTime():t.eduObjInfo.ft=1,t.eduObjInfo.toTimeE?t.eduObjInfo.tt=new Date(t.eduObjInfo.toTimeE).getTime():t.eduObjInfo.tt=1,r.updateEducation(t.eduObjInfo).then(function(r){r.sucs===!0?(t.eduObjInfo.fromTimeE?t.eduObjInfo.fromTimeE=n.profileVerbalDate(t.eduObjInfo.ft):(t.eduObjInfo.ft=1,t.eduObjInfo.fromTimeE=""),t.eduObjInfo.toTimeE?t.eduObjInfo.toTimeE=n.profileVerbalDate(t.eduObjInfo.tt):(t.eduObjInfo.tt=1,t.eduObjInfo.toTimeE=""),t.isEditEducation=-1,e.show("Successfully updated","success")):(t.isEditEducation=-1,e.show("Request did not process successfully","error")),t.processing=!1,t.$rgDigest()})}}function h(){if(t.eduObjInfo.scl||(t.edusclerror=!0,t.$rgDigest()),t.eduObjInfo.dgr||(t.edudgrerror=!0,t.$rgDigest()),t.eduObjInfo.cntn||(t.educntnerror=!0,t.$rgDigest()),!(t.edusclerror||t.edudgrerror||t.educntnerror)){if(t.processing=!0,t.eduObjInfo.fromTimeE&&t.eduObjInfo.toTimeE&&t.eduObjInfo.fromTimeE>t.eduObjInfo.toTimeE)return e.show("Your end date can't be earlier than your start date. Please try again","info"),void(t.processing=!1);t.eduObjInfo.fromTimeE?t.eduObjInfo.ft=new Date(n.profileVerbalDate(t.eduObjInfo.fromTimeE)).getTime():t.eduObjInfo.ft=1,t.eduObjInfo.toTimeE?t.eduObjInfo.tt=new Date(n.profileVerbalDate(t.eduObjInfo.toTimeE)).getTime():t.eduObjInfo.tt=1,t.eduObjInfo.ut=(new Date).getTime(),t.eduObjInfo.af=1,t.eduObjInfo.grtd=!1,t.eduObjInfo.iss=!0,r.submitNewEducation(t.eduObjInfo).then(function(n){var r;n.sucs===!0?(t.eduObjInfo.id=n.id,r=angular.copy(t.eduObjInfo),t.educationlist.push(r),e.show("Education info added successfully","success"),t.isaddNewEducation=!1,t.isEditEducation=-1):(e.show("Request did not process successfully","error"),t.isaddNewEducation=!1,t.isEditEducation=-1),t.isaddNewEducation=!1,t.isEditEducation=-1,t.processing=!1,t.$rgDigest()})}}function I(n,i){var o=i.id;t.isEditEducation=-1,r.deleteEducation(o).then(function(r){r.sucs===!0?(t.educationlist.splice(n,1),e.show("Successfully deleted","success")):e.show("Request did not process successfully","error"),t.$rgDigest()})}function _(e){var r,i,o,a,s,c=[];if(e.sucs===!0){for(r=0;r<e.educationList.length;r++)s=e.educationList[r],g[s.id]=s;for(i=Object.keys(g),a=0;a<i.length;a++)o=g[i[a]],o.fromTime=new Date(o.ft),o.toTime=new Date(o.tt),o.fromTimeE=n.profileVerbalDate(o.ft),o.toTimeE=n.profileVerbalDate(o.tt),c.push(o);t.educationlist=c}else RingLogger.warning("failed to get Education list for user :"+e.utId,RingLogger.tags.PROFILE),RingLogger.log(e,RingLogger.tags.PROFILE);t.$rgDigest()}u=s.subscribe(_,{action:[d.TYPE_ACTION_GET_EDUCATION]}),t.$on("$destroy",function(){s.unsubscribe(u),t.educationlist=[]})}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-education.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileWork",rgProfileWork);function rgProfileWork(){e.$inject=["$scope","Utils","profileFactory","$routeParams","rgDropdownService","Ringalert","OPERATION_TYPES","$$connector"];function e(e,t,n,r,i,o,a,s){var c,l,u,d=a.SYSTEM.PROFILE,g={};e.profileObj.isCurrentUser()?e.isOwner=!0:e.isOwner=!1,n.getUserProfileData({uId:r.uId},e.profileObj.isCurrentUser()),e.getProfileData=n.getProfileData,e.worklist=[],e.ddActionHtml="templates/dropdowns/action-dropdown.html",e.actionWorkDropdown=p,e.isAddNewWork=!1,e.isEditWork=-1,e.workObjInfo={},e.addNewWork=m,e.cancelNewWork=E,e.submitNewWork=f,e.cancelUpdateWork=I,e.updateWork=h,e.workcnmerror=!1,e.workpstnerror=!1,e.$watch("workObjInfo.cnm",function(t){t&&(e.workcnmerror=!1)}),e.$watch("workObjInfo.pstn",function(t){t&&(e.workpstnerror=!1)}),e.$watch("workObjInfo.status",function(){e.workObjInfo.toTimeE=""});function m(){c&&(e.worklist[l]=c),e.isEditWork=-1,e.workObjInfo.cnm="",e.workObjInfo.pstn="",e.workObjInfo.desc="",e.workObjInfo.fromTimeE="",e.workObjInfo.toTimeE="",e.workObjInfo.ft="",e.workObjInfo.tt="",e.isAddNewWork=!0,e.$rgDigest()}function E(){c&&(e.worklist[l]=c),e.isAddNewWork=!1,e.$rgDigest()}function f(){var r;if(e.workObjInfo.cnm||(e.workcnmerror=!0,e.$rgDigest()),e.workObjInfo.pstn||(e.workpstnerror=!0,e.$rgDigest()),!e.workcnmerror&&!e.workpstnerror){if(e.processing=!0,e.workObjInfo.fromTimeE&&e.workObjInfo.toTimeE&&e.workObjInfo.fromTimeE>e.workObjInfo.toTimeE)return o.show("Your end date can't be earlier than your start date. Please try again","info"),void(e.processing=!1);e.workObjInfo.status===!0?(e.workObjInfo.tt="0",e.workObjInfo.status=!0,e.workObjInfo.date_info="Present"):e.workObjInfo.toTimeE?e.workObjInfo.tt=new Date(e.workObjInfo.toTimeE).getTime():e.workObjInfo.tt=1,e.workObjInfo.fromTimeE?e.workObjInfo.ft=new Date(e.workObjInfo.fromTimeE).getTime():e.workObjInfo.ft=1,n.submitNewWork(e.workObjInfo).then(function(n){n.sucs===!0?(e.workObjInfo.id=n.id,e.workObjInfo.ft?e.workObjInfo.fromTimeE=t.profileVerbalDate(e.workObjInfo.ft):e.workObjInfo.ft=1,e.workObjInfo.tt?e.workObjInfo.toTimeE=t.profileVerbalDate(e.workObjInfo.tt):e.workObjInfo.tt=1,r=angular.copy(e.workObjInfo),e.worklist.push(r),o.show("Career info added successfully","success"),e.isAddNewWork=!1,e.isEditWork=-1):(o.show("Request did not process successfully","error"),e.isAddNewWork=!1,e.isEditWork=-1),e.processing=!1,e.$rgDigest()})}}function p(e){switch(e.action){case"edit":T(e.data.index),i.close(e.event);break;case"delete":_(e.data.index,e.data.obj),i.close(e.event)}}function T(t){l=t,e.workObjInfo=e.worklist[t],c=angular.copy(e.worklist[t]),1!==e.workObjInfo.tt&&"0"!==e.workObjInfo.tt&&0!==e.workObjInfo.tt||(e.workObjInfo.toTimeE=null),1===e.workObjInfo.ft&&(e.workObjInfo.fromTimeE=null),e.isAddNewWork=!1,e.isEditWork=t,e.$rgDigest()}function h(){var r,i;if(e.workObjInfo.cnm||(e.workcnmerror=!0,e.$rgDigest()),e.workObjInfo.pstn||(e.workpstnerror=!0,e.$rgDigest()),!e.workcnmerror&&!e.workpstnerror){if(e.processing=!0,e.workObjInfo.fromTimeE&&e.workObjInfo.toTimeE){if(r=e.workObjInfo.fromTimeE,i=e.workObjInfo.toTimeE,"string"==typeof r&&(r=new Date(r)),"string"==typeof i&&(i=new Date(i)),r>i)return o.show("Your end date can't be earlier than your start date. Please try again","info"),void(e.processing=!1);e.$rgDigest()}e.workObjInfo.fromTimeE?e.workObjInfo.ft=new Date(e.workObjInfo.fromTimeE).getTime():e.workObjInfo.ft=1,e.workObjInfo.toTimeE?e.workObjInfo.tt=new Date(e.workObjInfo.toTimeE).getTime():e.workObjInfo.tt=1,e.workObjInfo.status===!0&&(e.workObjInfo.tt="0",e.workObjInfo.status=!0,e.workObjInfo.date_info="Present"),n.updateWork(e.workObjInfo).then(function(n){n.sucs===!0?(e.workObjInfo.ft?e.workObjInfo.fromTimeE=t.profileVerbalDate(e.workObjInfo.ft):e.workObjInfo.ft=1,e.workObjInfo.tt?e.workObjInfo.toTimeE=t.profileVerbalDate(e.workObjInfo.tt):e.workObjInfo.tt=1,e.workObjInfo.status===!0&&(e.workObjInfo.tt=0,e.date_info="Present"),o.show("Updated successfully","success"),e.isEditWork=-1):(e.isEditWork=-1,o.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()})}}function I(){e.worklist[l]=c,e.isEditWork=-1,e.$rgDigest()}function _(t,r){var i=r.id;e.isEditWork=-1,n.deleteWork(i).then(function(n){n.sucs===!0?(e.worklist.splice(t,1),o.show("Successfully deleted","success")):o.show("Request did not process successfully","error"),e.$rgDigest()})}function A(n){var r,i,o,a,s,c=[];if(n.sucs===!0){for(r=0;r<n.workList.length;r++)i=n.workList[r],g[i.id]=i;for(o=Object.keys(g),s=0;s<o.length;s++)a=g[o[s]],a.fromTime=new Date(a.ft),a.toTime=new Date(a.tt),0===a.tt?(a.status=!0,a.date_info="Present"):a.toTimeE=t.profileVerbalDate(a.tt),a.fromTimeE=t.profileVerbalDate(a.ft),c.push(a);e.worklist=c}else RingLogger.warning("failed to get Work list for user :"+n.utId,RingLogger.tags.PROFILE),RingLogger.log(n,RingLogger.tags.PROFILE);e.$rgDigest()}u=s.subscribe(A,{action:[d.TYPE_ACTION_GET_WORK]}),e.$on("$destroy",function(){s.unsubscribe(u),e.worklist=[]})}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-work.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileSkill",rgProfileSkill);function rgProfileSkill(){e.$inject=["$scope","profileFactory","$routeParams","rgDropdownService","Ringalert","$$connector","OPERATION_TYPES"];function e(e,t,n,r,i,o,a){var s,c,l,u=a.SYSTEM.PROFILE,d={};e.skilllist=[],e.profileObj.isCurrentUser()?e.isOwner=!0:e.isOwner=!1,e.skillsklerror=!1,e.skilldescerror=!1,e.$watch("skillObjInfo.skl",function(t){t&&(e.skillsklerror=!1)}),e.$watch("skillObjInfo.desc",function(t){t&&(e.skilldescerror=!1)}),t.getUserProfileData({uId:n.uId},e.profileObj.isCurrentUser()),e.getProfileData=t.getProfileData,e.addNewSkill=g,e.submitNewSkill=m,e.cancelNewSkill=E,e.updateSkill=f,e.cancelUpdateSkill=h,e.skillObjInfo={},e.ddActionHtml="templates/dropdowns/action-dropdown.html",e.actionSkillDropdown=function(e){switch(e.action){case"edit":T(e.data.index);break;case"delete":p(e.data.index,e.data.obj)}r.close(e.event)},e.isAddNewSkill=!1;function g(){s&&(e.skilllist[c]=s),e.isEditSkill=-1,e.skillObjInfo.skl="",e.skillObjInfo.desc="",e.isAddNewSkill=!0,e.$rgDigest()}function m(){e.skillObjInfo.desc||(e.skilldescerror=!0,e.$rgDigest()),e.skillObjInfo.skl||(e.skillsklerror=!0,e.$rgDigest()),e.skillsklerror||e.skilldescerror||(e.processing=!0,t.submitNewSkill(e.skillObjInfo).then(function(t){var n;t.sucs===!0?(e.skillObjInfo.id=t.id,n=angular.copy(e.skillObjInfo),e.skilllist.push(n),i.show("Skill info added successfully","success"),e.isAddNewSkill=!1):(e.isAddNewSkill=!1,i.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()}))}function E(){s&&(e.skilllist[c]=s),e.isAddNewSkill=!1,e.$rgDigest()}function f(){e.skillObjInfo.desc||(e.skilldescerror=!0,e.$rgDigest()),e.skillObjInfo.skl||(e.skillsklerror=!0,e.$rgDigest()),e.skillsklerror||e.skilldescerror||(e.processing=!0,t.updateSkill(e.skillObjInfo).then(function(t){t.sucs===!0?(e.isEditSkill=-1,i.show("Successfully updated","success")):(e.isEditSkill=-1,i.show("Request did not process successfully","error")),e.processing=!1,e.$rgDigest()}))}function p(n,r){var o=r.id;e.isEditSkill=-1,t.deleteSkill(o).then(function(t){t.sucs===!0?(e.skilllist.splice(n,1),i.show("Successfully deleted","success")):i.show("Request did not process successfully","error"),e.$rgDigest()})}function T(t){c=t,e.skillObjInfo=e.skilllist[t],s=angular.copy(e.skilllist[t]),e.isAddNewSkill=!1,e.isEditSkill=t,e.$rgDigest()}function h(){e.skilllist[c]=s,e.isEditSkill=-1,e.$rgDigest()}function I(t){var n,r,i,o,a,s=[];if(t.sucs===!0){for(n=0;n<t.skillList.length;n++)r=t.skillList[n],d[r.id]=r;for(i=Object.keys(d),a=0;a<i.length;a++)o=d[i[a]],s.push(o);e.skilllist=s}else RingLogger.warning("failed to get skill list for user :"+t.utId,RingLogger.tags.PROFILE),RingLogger.log(t,RingLogger.tags.PROFILE);e.$rgDigest()}l=o.subscribe(I,{action:[u.TYPE_ACTION_GET_SKILL]}),e.$on("$destroy",function(){o.unsubscribe(l),e.skilllist=[]})}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-skill.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfilePassword",rgProfilePassword);function rgProfilePassword(){e.$inject=["$scope","Ringalert","profileFactory"];function e(e,t,n){e.enablePassEdit=r,e.updatePassword=o,e.cancelUpdatePassword=i,e.showMessage=!0,e.showPassEdit=!1,e.IsMatch=!1,e.oldError=!1;function r(t){t.preventDefault(),e.showPassEdit===!1&&(e.showPassEdit=!0,e.showMessage=!1),e.$rgDigest()}function i(){e.showPassEdit=!1,e.showMessage=!0,e.IsMatch=!1,e.$rgDigest()}function o(r){var i=r;i.newpassword!==i.repassword?e.IsMatch=!0:i.newpassword===i.repassword&&(e.IsMatch=!1,e.oldError=!1,n.changePassword(i.oldpassword,i.newpassword).then(function(n){n.sucs===!0?(i={oldpassword:"",newpassword:"",repassword:""},e.showPassEdit=!1,e.showMessage=!0,t.show("Password Changed Successfully","success")):t.show(n.mg,"info")},function(){e.oldError=!0})),e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-password.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileRecovery",rgProfileRecovery);function rgProfileRecovery(){e.$inject=["rgDropdownService","Api","$scope","Ringalert","profileFactory"];function e(e,t,n,r,i){var o;n.emailVerified=!1,n.phoneVerified=!1,n.isAddEmail=!1,n.isAddPhone=!1,n.addEmail=a,n.isAddCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.cancelAddEmail=s,n.cancelAddPhone=c,n.sendCode=l,n.verifyCode=d,n.verifyThePhoneNum=u,n.verifierEnabled=!1,n.enableVerifier=function(){n.verifierEnabled=!0},n.emailValue="Verify Email",n.emailTitle="Click here to verify your Email",n.phoneValue="Verify Phone",n.phoneTitle="Click here to verify your Phone",n.profileObj.isEmailVerified()&&(n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.emailVerified=!0,n.vemail=n.profileObj.getEmail()),n.profileObj.isMobileVerified()&&(n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified.",n.phoneVerified=!0,n.vnumber=n.profileObj.getMobileNumber()),n.cancelVerification=function(){n.isAddCode=!1,n.isAddPhnCode=!1,n.showAddEmailButton=!0,n.showAddPhoneButton=!0,n.$rgDigest()},n.resendCodeToMail=function(){i.sendCode({email:o}).then(function(e){e.sucs===!0?(o=e.el,r.show(e.mg,"info")):r.show(e.mg,"info"),n.$rgDigest()})};function a(){n.isAddEmail=!0,n.showAddEmailButton=!1,n.$rgDigest()}function s(){n.isAddEmail=!1,n.showAddEmailButton=!0,n.$rgDigest()}function c(){n.isAddPhone=!1,n.showAddPhoneButton=!0,n.$rgDigest()}function l(e){i.sendCode(e).then(function(t){t.sucs===!0?(o=t.el,n.isAddEmail=!1,n.isAddCode=!0,n.vemail="",n.emailVerified=!1,n.emailTitle="Click here to verify your Email",e.email=""):r.show(t.mg,"info"),n.$rgDigest()})}function u(e){n.verifierEnabled=!1,t.user.verifyPhoneNo(e).then(function(t){t.sucs===!0?(n.phoneNumber=e.mblDc+e.mbl,n.vnumber=n.phoneNumber,n.phoneVerified=!0,n.phoneValue="Verified Phone",n.phoneTitle="Your Phone is verified."):r.show(t.mg,"error"),n.$rgDigest()})}function d(e){e.email=o,i.verifyCode(e).then(function(t){t.sucs===!0?(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!0,n.emailValue="Verified Email",n.emailTitle="Your Email is verified.",n.vemail=t.el,e.code="",e.email="",r.show(t.mg,"success")):(n.isAddEmail=!1,n.isAddCode=!1,n.showAddEmailButton=!0,n.emailVerified=!1,n.vemail="",r.show(t.mg,"info")),n.$rgDigest()})}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-recovery.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAchat",rgProfileAchat);function rgProfileAchat(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditSetting=!1,e.settings={achat:n.getPermission().ancht,ainfndreq:n.getPermission().aifr,afam:n.getPermission().afam,aaf:n.getPermission().aaf},e.enableSettingsEditMode=r,e.saveSettings=i,e.cancelSettings=o;function r(t){t.preventDefault(),e.isEditSetting=!0,e.$rgDigest()}function i(r){var i,o,a,s;e.isEditSetting=!1,e.profileObj.isCurrentUser()&&(i={sv:r.achat,sn:10},o={sv:r.ainfndreq,sn:11},a={sv:r.afam,sn:12},s={sv:r.aaf,sn:13}),e.settings.achat=r.achat,e.settings.ainfndreqobj=r.ainfndreq,e.settings.afam=r.afam,e.settings.aaf=r.aaf,t.saveAchatSetting(i).then(function(t){t.sucs===!0?(e.settings.achat=r.achat,n.setAchatPermission(r.achat)):e.settings.achat=0}),e.$rgDigest(),t.saveAinfndreqSettings(o).then(function(t){t.sucs===!0?(e.settings.ainfndreq=r.ainfndreq,n.setAinfndreqPermission(r.ainfndreq)):e.settings.ainfndreq=0}),e.$rgDigest(),t.saveAfamSettings(a).then(function(t){t.sucs===!0?(e.settings.afam=r.afam,n.setAfamPermission(r.afam)):e.settings.afam=0}),e.$rgDigest(),t.saveAafSetting(s).then(function(t){t.sucs===!0?(e.settings.aaf=r.aaf,n.setAafPermission(r.aaf)):e.settings.aaf=0}),e.$rgDigest()}function o(){e.isEditSetting=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-achat.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAinfndreq",rgProfileAinfndreq);function rgProfileAinfndreq(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAinfndreq=!1,e.incomingfndreqsettings={ainfndreq:n.getPermission().aifr},e.enableAinfndreqEditMode=r,e.saveAinfndreqSettings=i,e.cancelAinfndreqSettings=o;function r(t){t.preventDefault(),e.isEditAinfndreq=!0,e.$rgDigest()}function i(r){var i;e.isEditAinfndreq=!1,e.profileObj.isCurrentUser()&&(i={sv:r.ainfndreq,sn:11}),e.incomingfndreqsettings.ainfndreqobj=r.ainfndreqobj,t.saveAinfndreqSettings(i).then(function(t){t.sucs===!0?(e.incomingfndreqsettings.ainfndreq=r.ainfndreq,n.setAinfndreqPermission(r.ainfndreq)):e.incomingfndreqsettings.ainfndreq=0}),e.$rgDigest()}function o(){e.isEditAinfndreq=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-incoming-frnd-req.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAllowaddme",rgProfileAllowaddme);function rgProfileAllowaddme(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAfam=!1,e.afamsettings={afam:n.getPermission().afam},e.enableAfamEditMode=r,e.saveAfamSettings=i,e.cancelAfamSettings=o;function r(t){t.preventDefault(),e.isEditAfam=!0,e.$rgDigest()}function i(r){var i;e.isEditAfam=!1,e.profileObj.isCurrentUser()&&(i={sv:r.afam,sn:12}),e.afamsettings.afam=r.afam,t.saveAfamSettings(i).then(function(t){t.sucs===!0?(e.afamsettings.afam=r.afam,n.setAfamPermission(r.afam)):e.afamsettings.afam=0}),e.$rgDigest()}function o(){e.isEditAfam=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-afam.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgProfileAutoaddfrnd",rgProfileAutoaddfrnd);function rgProfileAutoaddfrnd(){e.$inject=["$scope","profileFactory","Auth"];function e(e,t,n){e.isEditAaf=!1,e.aafsettings={aaf:n.getPermission().aaf},e.enableAafEditMode=r,e.saveAafSettings=i,e.cancelAafSettings=o;function r(t){t.preventDefault(),e.isEditAaf=!0,e.$rgDigest()}function i(r){var i;e.isEditAaf=!1,e.profileObj.isCurrentUser()&&(i={sv:r.aaf,sn:13}),e.aafsettings.aaf=r.aaf,t.saveAafSetting(i).then(function(t){t.sucs===!0?(e.aafsettings.aaf=r.aaf,n.setAafPermission(r.aaf)):e.aafsettings.aaf=0}),e.$rgDigest()}function o(){e.isEditAaf=!1,e.$rgDigest()}}function t(){}return{restrict:"E",templateUrl:"templates/profile/profile.about-aaf.html",controller:e,link:t}}angular.module("ringid.profile").directive("rgRelocateTemplate",function(){return{restrict:"E",template:'<ng-include src="template"></ng-include>',link:function(e,t,n){var r=n.twocol,i=n.threecol;e.template=i,window.innerWidth>1800||window.innerWidth<1200&&e.template!==i?e.template=i:window.innerWidth>1200&&window.innerWidth<1800&&e.template!==r&&(e.template=r),window.onresize=function(){window.innerWidth>1800||window.innerWidth<1200&&e.template!==i?(e.template=i,e.$apply()):window.innerWidth>1200&&window.innerWidth<1800&&e.template!==r&&(e.template=r,e.$apply())}}}}),angular.module("ringid.profile").service("profileFactory",profileFactory),profileFactory.$inject=["$routeParams","Storage","Auth","$$connector","$$q","Ringalert","profileHttpService","userFactory","OPERATION_TYPES","fileUploadService","Utils"];function profileFactory(e,t,n,r,i,o,a,s,c,l,u){var d=n.currentUser(),g={},m={};function E(e,t){var n=e;n.fromTime=new Date(n.ft),n.toTime=new Date(n.tt),n.fromTimeE=u.profileVerbalDate(n.ft),n.toTimeE=u.profileVerbalDate(n.tt),m[t].educationList.push(n)}function f(e,t){var n=e;n.fromTime=new Date(n.ft),n.toTime=new Date(n.tt),0===n.tt?(n.status=!0,n.date_info="Present"):n.toTimeE=u.profileVerbalDate(n.tt),n.fromTimeE=u.profileVerbalDate(n.ft),m[t].workList.push(n)}function p(e,t){var n=e;m[t].skillList.push(n)}function T(e,t,n){if(m.hasOwnProperty(n))switch(e){case"educationList":E(t,n);break;case"workList":f(t,n);break;case"skillList":p(t,n)}}function h(e,t){return m.hasOwnProperty(t)?m[t][e]:[]}function I(e){delete m[e]}function _(e){return d||(d=n.currentUser()),e===d.getKey()?d:g=s.create({uId:e})}function A(e){var t=i.defer();return a.basicAndPrivacy(e.getUtId(),e.isCurrentUser()).then(function(n){n.sucs===!0?(e.isCurrentUser()?d=s.create(angular.extend({},n,{uId:e.getKey()}),!0,!0):(g=s.create(n.userDetails,!0,!1),a.fetchPresenceAndMood(e.getKey()).then(function(e){g.updateUserObj(e)})),t.resolve()):t.reject()}),t.promise}function S(e){a.getMutualFriends(e).then(function(e){e.sucs===!0&&g.updateUserObj({nmf:e.mfIDs.length})},function(e){RingLogger.warning(e,RingLogger.tags.PROFILE)})}function C(e,t){var n;n=t?d:s.create(e),m.hasOwnProperty(n.getUtId())||(m[n.getUtId()]={workList:[],educationList:[],skillList:[]},t?a.getUserProfileData():a.getUserProfileData(n.getUtId()))}function v(e){var n=e,r=i.defer();return n||(n={iurl:d.avatar("iurl")}),n=angular.extend({},n,l.getReposition("profilephoto")),a.changeProfilePicture(n).then(function(e){e.sucs===!0?(t.updateLoginData("prIm",n.iurl),t.updateLoginData("prImId",e.imgId),d.setProfileImage(n.iurl,e.imgId),r.resolve(e)):r.reject(e)},function(e){r.reject(e)}),r.promise}function D(e){var t=e,n=i.defer();return t||(t={iurl:d.getCover("iurl")}),t=angular.extend({},t,l.getReposition("coverphoto")),a.changeCoverPicture(t).then(function(e){e.sucs?(d.setCover(angular.extend(t,{cImId:e.imgId})),n.resolve()):n.reject()},function(e){n.reject(e)}),n.promise}return{init:A,getProfile:_,getMutualFriends:S,getUserProfileData:C,changeProfilePicture:v,changeCoverPicture:D,updateUserProfile:a.updateProfile,savePvcEdit:a.updateUserPrivacy,submitNewEducation:a.submitNewEducation,saveAchatSetting:a.saveAchatSetting,saveAinfndreqSettings:a.saveAinfndreqSettings,saveAfamSettings:a.saveAfamSettings,saveAafSetting:a.saveAafSetting,getProfileData:h,setProfileData:T,removeProfileData:I,deleteEducation:a.deleteEducation,getAllEducation:a.getEducationData,updateEducation:a.updateEducationById,submitNewSkill:a.submitNewSkill,updateSkill:a.updateSkill,deleteSkill:a.deleteSkill,submitNewWork:a.submitNewWork,updateWork:a.updateWork,deleteWork:a.deleteWork,changePassword:a.changePassword,verifyCheck:a.verifyCheck,sendCode:a.sendCode,verifyCode:a.verifyCode,changePrivacy:a.changePrivacy,saveCallPvcEdit:a.saveCallPvcEdit,saveChatPvcEdit:a.saveChatPvcEdit,saveFeedPvcEdit:a.saveFeedPvcEdit,moodChange:a.moodChange,addSocialAccount:a.addSocialAccount}}!function(e,t){"use strict";e.module("ringid.circle",["ringid.global_services","ringid.global_directives","ringid.shared"])}(angular,window),angular.module("ringid.circle").controller("CirclePopupController",CirclePopupController),CirclePopupController.$inject=["$scope","$rootScope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","Ringalert","Auth","rgScrollbarService","$location"];function CirclePopupController(e,t,n,r,i,o,a,s,c,l,u){e.circleAddMode=!1,e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleNameSection=!0,e.circleMemberSection=!1,e.circleAdminSection=!1,e.friendDropdown=!1;function d(t){t?e.friendDropdown=!0:e.friendDropdown=!1}e.$watch("friendsNameFilter",d),e.closeFriendDd=g;function g(){e.friendDropdown=!1,e.$rgDigest()}e.friendlistNameFilter="",e.memberfilter="",e.nextPart=m;function m(t){switch(t){case"setname":e.circleNameSection=!0,e.circleMemberSection=!1,e.circleAdminSection=!1,e.$rgDigest();break;case"setmembers":e.circleNameSection=!1,e.circleMemberSection=!0,e.circleAdminSection=!1,e.$rgDigest();break;case"setadmins":e.circleNameSection=!1,e.circleMemberSection=!1,e.circleAdminSection=!0,e.$rgDigest()}}function E(){e.friendlist.reset(),e.selectedMembers=[]}e.$on("$destroy",E),e.friendlist=i.getFriends("friends"),e.models={errCircleName:!1,errMemberList:!1,errAdminList:!1},a.circleId||(e.circleAddMode=!0),e.editMode=!1,a&&a.circleId?(e.circle=n.getCircle(a.circleId),e.memberList=e.circle.getMembers(),e.adminList=e.circle.getAdmins(),e.isCurrentUserSuperAdmin=e.circle.isSuperAdmin(c.currentUser().getKey()),e.models.popupTitle="Edit Group",e.models.circleName=e.circle.getName(),e.editMode=!0):(e.models.popupTitle="Create New Circle",e.models.circleName="",e.memberList=o.createNew(),e.adminList=o.createNew()),e.addToCircle=T,e.addToAdmin=I,e.removeMember=h,e.removeAdmin=_,e.createCircle=f,e.updateCircle=p,e.close=r.close,e.loadMoreFriends=C;function f(){var t,i,o,a,s=[],l=[];for(t=0;t<e.memberList.length();t++)s[t]={admin:"false",uId:e.memberList.all()[t].value.user.uId};for(i=0;i<e.adminList.length();i++)l[i]={admin:"true",uId:e.adminList.all()[i].value.user.uId};o=l.concat(s),a={tg:e.models.circleName,alluser:o,uId:c.currentUser().getUId()};function d(e){e.sucs===!0&&(r.closeAll(),u.path("/circle/"+e.grpId))}n.createCircle(a).then(d)}function p(){var t,r,i,o,a,c,l,u,d,g;t=e.memberList.keys(),r=e.adminList.keys(),i=e.circle.getMemberIds(),o=e.circle.getAdminIds(),a=t.difference(i),c=i.difference(t),l=r.difference(o),u=o.difference(r),g=[];function m(e){g.push({admin:!1,uId:e})}angular.forEach(a,m);function E(e){g.push({admin:!0,uId:e})}angular.forEach(l,E),g.length>0&&n.addMembers(g,e.circle),d=c,d=d.concat(u),d.length>0&&n.removeMembers(d,e.circle),s.show("Circle Updated","success"),e.close()}function T(t){e.memberList.add(t.getKey(),t),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function h(t){e.memberList.remove(t.getKey()),e.$rgDigest()}function I(t){e.adminList.add(t.getKey(),t),e.memberList.remove(t.getKey()),e.$rgDigest()}function _(t){e.adminList.remove(t.getKey()),e.memberList.add(t.getKey(),t),e.$rgDigest()}function A(t){e.state.loading=t,t||l.recalculate(e),e.$$phase||e.$root.$$phase||e.$digest()}function S(t){function n(){e.friendlist=i.getFriends("friends"),A(!1),e.$rgDigest()}function r(){A(!1),e.$rgDigest()}t&&t.length>1?(A(!0),i.searchContact({schPm:t},!0).then(n,r)):(e.friendlist=i.getFriends("friends").copy(),e.$rgDigest())}e.$watch("friendName",S);function C(){function t(){e.friendlist=i.getFriends("friends"),RingLogger.information("FRIENDS LENGTH: "+e.friendlist.length(),RingLogger.tags.FRIEND),A(!1)}function n(){A(!1)}function r(){e.state.loading=!1}e.state.loading||e.friendlist.length()===i.totalFriends("friends")||(A(!0),i.getContactDetails().then(t,n),setTimeout(r,3e3),e.$rgDigest())}}angular.module("ringid.circle").controller("circleEditPopupController",circleEditPopupController),circleEditPopupController.$inject=["$scope","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","remoteData","Ringalert"];function circleEditPopupController(e,t,n,r,i,o,a,s){e.selectedMembers=[],e.state={loading:!1,noData:!1},e.circleMemberSection=!1,e.friendDropdown=!1;function c(t){t?e.friendDropdown=!0:e.friendDropdown=!1}e.$watch("friendsNameFilter",c),e.closeFriendDd=l;function l(){e.friendDropdown=!1,e.$rgDigest()}e.friendsNameFilter="",e.memberfilter="",e.$on("$destroy",function(){e.friendlist.reset(),e.selectedMembers=[]}),e.friendlist=r.getFriends("friends").copy(),e.memberList=i.createNew(),e.addToCircle=d,e.removeMember=g,e.updateCircle=u,e.close=n.close;function u(){var n,r=[];for(n=0;n<e.memberList.length();n++)r[n]={admin:"false",uId:e.memberList.all()[n].value.user.uId};t.addMembers(r,o.target).then(function(n){n.sucs===!0?t.getSingleCircleInfo(o.target,o.circleObj):(s.show(n.mg,"error"),e.$rgDigest()),e.close()})}function d(t){e.memberList.add(t.getUtId(),t),e.selectedMembers.push(t),e.friendlist.remove(t.getUtId()),e.friendDropdown=!1,e.friendsNameFilter="",e.$rgDigest()}function g(t){e.memberList.remove(t.getUtId()),e.$rgDigest()}}angular.module("ringid.circle").controller("CirclePageController",CirclePageController),CirclePageController.$inject=["$scope","$routeParams","$location","circlesManager","friendsFactory","Auth","$ringbox","SystemEvents","$$connector","OPERATION_TYPES","circleHttpService","$timeout","APP_CONSTANTS","Ringalert","rgDropdownService","$rootScope","Utils"];function CirclePageController(e,t,n,r,i,o,a,s,c,l,u,d,g,m,E,f,p){var T,h,I=this;T=t.circleId,h=t.subpage,e.loadMoreCircleMember=!1,e.showSearchLoader=!1,e.hideLoadButton=!1,e.currentUserUId=o.currentUser().getUId(),r.getCirclePromise(T).then(function(t){t?(I.circle=t,p.setPageTitle(t.getName(),!0),e.isCurrentUserAdmin=I.circle.isAdmin(),e.isCurrentUserSuperAdmin=I.circle.isSuperAdmin(e.currentUserUId),"members"===h&&(e.showBackKey=0,e.showBack=function(t,n){var r=n.target.getAttribute("data-is-anchor");r||(e.showBackKey=t,n.preventDefault(),n.stopPropagation(),e.$rgDigest())},C()),_()):r.redirectHome()},function(){r.redirectHome()}),e.showComingSoon=function(e){e.preventDefault(),e.stopPropagation(),m.show("Coming soon","info")},I.ddHtml="templates/dropdowns/circle-edit-dropdown.html",I.ddAction=R,I.ddControl={isAdmin:e.isCurrentUserAdmin,isSuperAdmin:e.isCurrentUserSuperAdmin,getCircleData:function(){return E.close(),{circleId:T}}},I.ddMemberHtml="templates/dropdowns/circle-member-dropdown.html",I.ddMemberAction=D,I.removeMember=v,angular.isUndefined(t.subpage)?I.subPage="post":I.subPage=t.subpage,I.subPageLink="templates/home/circle."+I.subPage+".html",I.isCurrentUserAdmin=!1,I.isCurrentUserSuperAdmin=!1,I.getFriendType=function(e){return e.friendshipStatus()},I.circle?(e.isPageReady=!1,e.circleMembers.length||C()):e.isPageReady=!1,I.shouldShowMemberEditMenu=function(e){return!e.isCurrentUser()&&(I.isCurrentUserSuperAdmin||I.isCurrentUserAdmin&&!e.isAdmin(T))&&!I.circle.isSuperAdmin(e.getKey())},I.memberListSubscriptionKey=c.subscribe(r.processCircleMembersData,{action:l.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_LIST}),I.searchListSubscriptionKey=c.subscribe(r.processCircleSearchMembersData,{action:l.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_SEARCH_RESULT}),e.$on(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,function(t,n){RingLogger.print(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,RingLogger.tags.CIRCLE),e.loadMoreCircleMember=!1,e.showSearchLoader=!1,n.success?e.hideLoadButton=!1:e.hideLoadButton=!0,_(),e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_UPDATE_MEMBER_COUNT,function(){e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,function(){S(),e.$rgDigest()}),e.$on(s.CIRCLE.MY_CIRCLE_REMOVED,function(e,r){r.circleId===t.circleId&&(m.show("Circle has been Removed OR You have been removed from the circle.","error"),d(function(){n.path("/")}))}),e.cMemberSearch=function(){I.searchParam?(e.showSearchLoader=!0,r.getMemberResult(I.searchParam,T)):e.hideLoadButton=!1,e.$rgDigest()},e.loadMoreMembers=function(){var t;I.searchParam?(e.showSearchLoader=!0,r.getMemberResult(I.searchParam,T)):(t=20,e.loadMoreCircleMember=!0,r.getCircleMembers(T,null,t)),e.$rgDigest()},e.getCircleId=function(){return{data:function(){return{target:T,circleObj:I.circle}}}},e.$on("$destroy",function(){I.circle&&I.circle.resetMembers(),c.unsubscribe(I.memberListSubscriptionKey),c.unsubscribe(I.searchListSubscriptionKey)});function _(){I.circle&&(e.isPageReady=!0,S(),A()),e.$rgDigest()}function A(){I.isCurrentUserAdmin=e.currentUser.isAdmin(I.circle.getKey()),I.isCurrentUserSuperAdmin=I.circle.isSuperAdmin(o.currentUser().getKey()),I.ddControl.isAdmin=I.isCurrentUserAdmin,I.ddControl.isSuperAdmin=I.isCurrentUserSuperAdmin}function S(){e.circleMembers=I.circle.getAllMembers(),e.$rgDigest()}function C(){r.getCircleMembers(T,0)}function v(e){r.removeMember(e,I.circle)}function D(t){switch(RingLogger.print(t,RingLogger.tags.CIRCLE),E.close(t.event),t.action){case"remove":r.removeMember(t.member.getKey(),I.circle);break;case"changemember":r.toggleMembership({grpId:I.circle.getKey(),uId:t.member.getKey(),admin:Boolean(t.admin)},I.circle);break;case"addfriend":case"accept":case"reject":t.friend.isLoading()||i.friendAction(t,!0).then(function(){e.$rgDigest()},function(){e.$rgDigest()})}e.$rgDigest()}function R(e){
var t,n;n="Are you sure you want to "+e.action+" "+I.circle.getName()+"?",E.close(e.event),t=a.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:n}},templateUrl:"templates/partials/ringbox-confirm.html"}),t.result.then(function(t){t&&M(e)})}function M(t){switch(t.action){case"delete":r.deleteCircle(I.circle).then(function(t){t.sucs===!0?n.path("/"):e.$rgDigest()},function(){e.$rgDigest()});break;case"leave":r.leaveGroup(I.circle).then(function(t){t.sucs===!0&&(n.path("/"),f.$rgDigest()),e.$rgDigest()},function(){e.$rgDigest()})}}}angular.module("ringid.circle").controller("allCirclePopupController",allCirclePopupController),allCirclePopupController.$inject=["$scope","OPERATION_TYPES","$$connector","circlesManager","rgScrollbarService"];function allCirclePopupController(e,t,n,r,i){var o,a;r.init(),e.getCircles=s;function s(e){return"true"===e||e===!0?r.getCircles(!0):r.getCircles(!1)}a=n.subscribe(function(){o||(o=setTimeout(function(){clearTimeout(o),i.recalculate(e),e.$rgDigest()}))},{action:[t.SYSTEM.CIRCLE.TYPE_GROUP_LIST]}),e.$on("$destroy",function(){n.unsubscribe(a)})}!function(e,t){"use strict";e.module("ringid",["ngRoute","ringid.config","ui-notification","ringid.language","ringid.connector","ringid.global_services","ringid.global_directives","ringid.auth","ringid.filters","ringid.shared","ringid.utils","ringid.directives","ringid.ui_editor","ringid.ui_scrollbar","ringid.ui_ringbox","ringid.ui_player","ringid.header","ringid.friend","ringid.directives","ringid.controllers","ringid.feed","ringid.sticker","ringid.profile","ringid.circle","ringid.chat","ringid.newsportal","ringid.business","oc.lazyLoad"])}(angular,window);var app;app=angular.module("ringid").controller("ApplicationController",ApplicationController),ApplicationController.$inject=["SystemEvents","$scope","$rootScope","$$connector","Storage","Auth","OPERATION_TYPES","ChatConnector"];function ApplicationController(e,t,n,r,i,o,a,s){var c=a.SYSTEM.AUTH,l=!0;t.openSignIn=g,t.activePath=null,t.currentUser=o.currentUser(),t.templatePath="templates/index-login.html",t.isLoggedIn=!1,t.isPending=d,t.showFriendsBar=!1,t.toggleFriendsBar=u;function u(){t.showFriendsBar=!t.showFriendsBar,t.$rgDigest()}function d(){return l}function g(){return{data:function(){return{fromPopup:!0}}}}function m(){t.isLoggedIn=o.isLoggedIn(),r.init(),t.isLoggedIn?(RingLogger.warning("USER LOGGED IN appInit()",RingLogger.tags.AUTH),t.currentUser=o.currentUser(),t.templatePath="templates/index-dashboard.html",r.resume(),r.keepAlive(),s.sendGlobal("uId",o.currentUser().getKey())):(RingLogger.warning("USER NOT LOGGED IN appInit()",RingLogger.tags.AUTH),t.templatePath="templates/index-login.html"),t.$rgDigest(),setTimeout(function(){l=!1,t.$rgDigest()})}t.$on(e.AUTH.LOGIN,function(){RingLogger.information("AUTH LOGIN EVENT: ",RingLogger.tags.AUTH),m()}),t.$on("CONNECTION_ERROR",function(){var e=i.getCookie("reloaded");e?r.reset():i.setCookie("reloaded",1)}),t.$on("$locationChangeStart",function(e,t){t&&r.notifyRouteChange()});function E(){r.subscribe(o.handleInvalidSession,{action:[c.TYPE_SESSION_VALIDATION,c.TYPE_INVALID_LOGIN_SESSION,c.TYPE_MULTIPLE_SESSION]}),o.ensureLoginState(),t.$rgDigest()}E(),RingLogger.tags.DIGEST&&n.$watch(function(){RingLogger.info("from ROOTSCOPE",RingLogger.tags.DIGEST)}),RingLogger.tags.DIGEST&&t.$watch(function(){RingLogger.info("from AppController",RingLogger.tags.DIGEST)}),t.send=function(e,t){var n,i=t||a.SYSTEM.REQUEST_TYPE.REQUEST;angular.isString(n)&&(n=angular.fromJson(e)),r.send(n,i)},t.$on("ocLazyLoad.moduleLoaded",function(e,t){RingLogger.print("module loaded",t,RingLogger.tags.OCLOADER)})}var app;app=angular.module("ringid").run(["$rootScope","$window","$document","$$connector","$ringhttp","settings",function(e,t,n,r,i,o){var a,s,c=angular.element(t);r.init();function l(t){"inactive"!==s&&e.$broadcast("ringInactive",t),s="inactive"}function u(t){"active"!==s&&e.$broadcast("ringActive",t),s="active"}c.on("inactive",l),c.on("active",u);function d(t){this[a?a+"Hidden":"hidden"]&&"inactive"!==s?(e.$broadcast("ringInactive",t),s="inactive"):"active"!==s&&(e.$broadcast("ringActive",t),s="active")}"hidden"in n?a="":angular.forEach(["moz","webkit","ms"],function(e){e+"Hidden"in n[0]&&(a=e)}),angular.isDefined(a)&&""!==a&&n[0].addEventListener(a+"visibilitychange",d),i.get(o.constantServer).success(function(e){var t=angular.fromJson(e);t.sucs===!0&&o.updateUrlBase(t),t=null})}]);var app=angular.module("ringid");app.config(appConfig),appConfig.$inject=["$compileProvider","$routeProvider","$locationProvider","$httpProvider","RING_ROUTES","settings"];function appConfig(e,t,n,r,i,o){r.useApplyAsync(!0),e.debugInfoEnabled(o.debugEnabled),r.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";function a(e){var t,n,r,i,o,s,c,l="";for(t in e)if(e.hasOwnProperty(t))if(n=e[t],n instanceof Array)for(c=0;c<n.length;++c)o=n[c],r=t+"["+c+"]",s={},s[r]=o,l+=a(s)+"&";else if(n instanceof Object)for(i in n)n.hasOwnProperty(i)&&(o=n[i],r=t+"["+i+"]",s={},s[r]=o,l+=a(s)+"&");else void 0!==n&&null!==n&&(l+=encodeURIComponent(t)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l}r.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?a(e):e}],t.when(i.HOME,{templateUrl:"templates/index.html"}).when(i.LOGIN_SOCIAL,{templateUrl:"templates/index.html"}).when(i.SIGNUP_SOCIAL,{templateUrl:"templates/index.html"}).when(i.PROFILE,{templateUrl:"templates/profile/profile.html",resolve:{user:["Api","userFactory","$route","$location","$q","Ringalert","Auth",function(e,t,n,r,i,o,a){var s,c=i.defer();return a.isPendingAsync().then(function(){s=t.getUser(n.current.params.uId),s&&s.hasDetails()?c.resolve(s):e.user.getUserDetails({uId:n.current.params.uId}).then(function(e){c.resolve(t.create(e.userDetails))},function(){o.show("User not found","error"),r.path().indexOf("profile")>-1&&r.path("/"),c.reject()})}),c.promise}]}}).when(i.CIRCLE,{templateUrl:"templates/home/circle.html"}).when(i.SINGLE_FEED,{templateUrl:"templates/index-singlefeed.html"}).when(i.MEDIA_FEEDS,{templateUrl:"templates/home/media.feed.html"}).when(i.WHO_SHARED_FEED,{templateUrl:"templates/index-who-sharedfeed.html"}).when(i.MEDIA_CLOUD,{templateUrl:"templates/media-list.html"}).when(i.MEDIA_CLOUD_MYALBUM,{templateUrl:"templates/mediasearch/my.albums.html"}).when(i.MEDIA_POST,{templateUrl:"templates/mediasearch/media.upload.html",controller:"MediaPostController"}).when(i.MEDIA_CLOUD_ALBUM,{templateUrl:"templates/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when(i.MEDIA_CLOUD_SEARCH,{templateUrl:"templates/mediasearch/search.result.html",controller:"mSearchResultController"}).when(i.MEDIA_CLOUD_USERMEDIA,{templateUrl:"templates/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when(i.CHAT,{templateUrl:"templates/partials/chat/single-page/home.html",controller:"ChatHistoryController"}).when(i.CHAT_GROUPS,{templateUrl:"pages/partials/tag-chat/list-page/tag-list.html",controller:"TagChatController",controllerAs:"tcc"}).when(i.CHAT_GROUP,{templateUrl:"pages/partials/tag-chat/list-page/home.html",controller:"TagChatMemberPageController",controllerAs:"tcc"}).when(i.CIRCLE_LIST,{templateUrl:"templates/circle-partials/all-circle.html",controller:"allCirclePopupController"}).when(i.NEWSPORTAL_FEED,{templateUrl:"pages/newsportal/portal-index.html",controller:"FeedNewsportalController"}).when(i.NEWSPORTAL_FOLLOWING,{templateUrl:"pages/newsportal/following.html",controller:"portalFollowingController"}).when(i.NEWSPORTAL_DISCOVER,{templateUrl:"pages/newsportal/discover.html",controller:"portalDiscoverController"}).when(i.NEWSPORTAL_SAVED,{templateUrl:"pages/newsportal/saved.html",controller:"portalSaveController"}).when(i.NEWSPORTAL,{templateUrl:"pages/newsportal/profilenews.html"}).when(i.PAGES_FEED,{templateUrl:"pages/business/business-index.html",controller:"FeedBusinessPortalController"}).when(i.PAGES_DISCOVER,{templateUrl:"pages/business/business-discover.html",controller:"businessDiscoverController"}).when(i.PAGES_FOLLOWING,{templateUrl:"pages/business/business-following.html",controller:"businessFollowingController"}).when(i.PAGES_SAVED,{templateUrl:"pages/business/business-saved.html",controller:"businessSaveController"}).when(i.PAGE,{templateUrl:"pages/business/business-news.html"}).when(i.NOTIFICATIONS,{templateUrl:"templates/partials/all-notification.html"}).when(i.FRIEND_REQUESTS,{templateUrl:"templates/partials/all-friend-request.html"}).when("/medianew",{templateUrl:"templates/mediapage.html"}).when(i.FAQ,{redirectTo:function(){window.location.href=location.protocol+"//"+location.host+"/faq.xhtml"}}).otherwise({redirectTo:"/"}),n.html5Mode(o.html5Mode)}appRun.$inject=["$rootScope","$location","Auth","rgDropdownService","rgSearchService","$ringbox","PAGE_TITLES","Utils"],app.run(appRun);function appRun(e,t,n,r,i,o,a,s){var c,l=0,u=[],d=Object.getPrototypeOf(e),g=[];e.$on("$routeChangeSuccess",function(e,t){RingLogger.print("page title from global change",RingLogger.tags.PAGETITLE),a[t.$$route.originalPath]?s.setPageTitle(a[t.$$route.originalPath],l>0):s.setPageTitle(a.DEFAULT),l++}),e.$on("$routeChangeStart",function(){n.isPending()||n.isLoggedIn()||e.doingSilentLogin||"/"===t.url()?(o.closeAll(),r.close(),i.close(),m(!0)):(t.path("/"),m(!0))}),requestAnimationFrame(function(){}),e.$ignoreScopes=[],d.$coreDigest=d.$digest;function m(t){for(c=0;c<e.$ignoreScopes.length;c++)g[e.$ignoreScopes[c].$id]&&(e.$ignoreScopes[c].$$childHead=g[e.$ignoreScopes[c].$id]);g=[],t&&(e.$ignoreScopes=[])}d.$rgDigest=function(){var t,n,r,i,o=[];if(e.$$phase){if(u.indexOf(this)===-1&&1!==this.$id){for(u.push(this),u.sort(function(e,t){return e.$id-t.$id});u.length>1;){for(n=u.pop(),t=u.length-1;t>=0;t--){for(r=u[t],i=n.$parent;i!==r&&null!==i;)i=i.$parent;if(null!=i)break}null==i&&o.push(n)}for(;n=o.pop();)u.push(n)}e.$$postDigest(function(){RingLogger.print("$rootScope.postDigest",RingLogger.tags.DIGEST),u.length>0&&u.pop().$rgDigest()})}else{if(1===parseInt(this.$id,10)&&e.$ignoreScopes.length>0){for(t=0;t<e.$ignoreScopes.length;t++)g[e.$ignoreScopes[t].$id]=e.$ignoreScopes[t].$$childHead,e.$ignoreScopes[t].$$childHead=null;e.$$postDigest(function(){m()})}this.$coreDigest()}},d.$digest=function(){this.$rgDigest()},d.addIgnore=function(){e.$ignoreScopes.indexOf(this)===-1&&e.$ignoreScopes.push(this)},d.removeIgnore=function(){var t;(t=e.$ignoreScopes.indexOf(this))>-1&&e.$ignoreScopes.splice(t,1)},d.calc=function(){var e,t,n;e=this,t=e;do if(!(n=t.$$childHead||t!==e&&t.$$nextSibling))for(;t!==e&&!(n=t.$$nextSibling);)t=t.$parent;while(t=n)}}