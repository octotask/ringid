/*! Ringid.com 2016-03-08 */
!function(window,DataView){"use strict";window.emojiSupported=function(){var node=document.createElement("canvas");if(!node.getContext||!node.getContext("2d")||"function"!=typeof node.getContext("2d").fillText)return!1;var ctx=node.getContext("2d");return ctx.textBaseline="top",ctx.font="32px Arial",ctx.fillText("\ud83d\ude03",0,0),0!==ctx.getImageData(16,16,1,1).data[0]}(),window.eventFix=function(e){e=e||window.event;var pageX=e.pageX,pageY=e.pageY;void 0===pageX&&(pageX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,pageY=e.clientY+document.body.scrollTop+document.documentElerment.scrollTop)},window.scrollToYOffset=function(targetYOffset,scrollDuration){var scrollStep=targetYOffset/(scrollDuration/15),scrollInterval=setInterval(function(){window.scrollY<targetYOffset?window.scrollBy(0,scrollStep):clearInterval(scrollInterval)},15)},Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(fNOP.prototype=this.prototype),fBound.prototype=new fNOP,fBound}),String.prototype.format||(String.prototype.format=function(){var args="[object Array]"===Object.prototype.toString.call(arguments[0])?arguments[0]:arguments;return this.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})}),String.prototype.supplant||(String.prototype.supplant=function(o){return this.replace(/\{([^{}]*)\}/g,function(a,b){var r=o[b];return"string"==typeof r||"number"==typeof r?r:a})}),String.prototype.repeat||(String.prototype.repeat=function(count){return Array(count+1).join(this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))},String.prototype.toCharCodeArray=function(){for(var codes=[],i=0;i<this.length;i++)codes.push(this.charCodeAt(i));return codes},Array.prototype.indexOf||(Array.prototype.indexOf=function(elt){var len=this.length>>>0,from=Number(arguments[1])||0;for(from=0>from?Math.ceil(from):Math.floor(from),0>from&&(from+=len);len>from;from++)if(from in this&&this[from]===elt)return from;return-1}),Array.prototype.contains||(Array.prototype.contains=function(val,fn){if(!fn)return this.indexOf(val);var len=this.length>>>0,from=Number(arguments[1])||0;for(from=0>from?Math.ceil(from):Math.floor(from),0>from&&(from+=len);len>from;from++)if(from in this&&fn.call(this,this[from],val))return from;return-1}),Array.prototype.filter||(Array.prototype.filter=function(fun){if(void 0===this||null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var res=[],thisArg=arguments.length>=2?arguments[1]:void 0,i=0;len>i;i++)if(i in t){var val=t[i];fun.call(thisArg,val,i,t)&&res.push(val)}return res}),Array.prototype.keyValues||(Array.prototype.keyValues=function(key){var index,values=[];for(index=0;index<this.length;index++)this[index][key]&&values.push(this[index][key]);return values}),Array.prototype.values||(Array.prototype.values=function(){var index,values=[];for(index=0;index<this.length;index++)values.push(this[index]);return values}),Array.prototype.joinAsDataView=function(){var buffer,view,self=this,currentIndex=0,dataViewLength=0;if(!self.length)return new DataView(new ArrayBuffer(0));for(var i=0;i<self.length;i++)self[i]instanceof DataView&&(dataViewLength+=self[i].byteLength);if(!dataViewLength)return new DataView(new ArrayBuffer(0));buffer=new ArrayBuffer(dataViewLength),view=new DataView(buffer);for(var i=0;i<self.length;i++)if(self[i]instanceof DataView)for(var j=0;j<self[i].byteLength;j++)view.setUint8(currentIndex++,self[i].getUint8(j));return view},Array.prototype.difference=function(elementsToRemove){if(!elementsToRemove||!elementsToRemove.length||!this.length)return this;for(var mapElementsToRemove={},outputArray=[],index=0;index<elementsToRemove.length;)mapElementsToRemove[elementsToRemove[index]]=!0,index++;for(index=0;index<this.length;index++)mapElementsToRemove[this[index]]||outputArray.push(this[index]);return outputArray},DataView.prototype.copy=function(offset,length){return new DataView(this.buffer,offset,length)},DataView.prototype.merge=function(from,fromLength,toview,to,toLength){var i,j,mergea=new DataView(this.buffer,from,fromLength),buf=new ArrayBuffer(mergea.byteLength+(toLength-to+1)),view=new DataView(buf);for(i=0;i<mergea.byteLength;i++)view.setUint8(i,mergea.getUint8(i));for(j=i;j<view.byteLength;j++)view.setUint8(j,toview.getUint8(to++));return view},DataView.prototype.addAttributeInt=function(i,code,len,value){switch(this.setUint8(i++,code),this.setUint8(i++,len),len){case 1:this.setUint8(i++,value);break;case 2:this.setUint16(i,value),i+=2;break;case 4:this.setUint32(i,value),i+=4}return i},DataView.prototype.addAttributeString=function(i,code,value){this.setUint8(i++,code),this.setUint8(i++,value.length);for(var j=0;j<value.length;j++)this.setUint8(i++,value.charCodeAt(j));return i},DataView.prototype.addAttributeData=function(i,code,view,fromIndex,length){fromIndex=fromIndex||0,length=length||view.byteLength,this.setUint8(i++,code),this.setUint16(i,length),i+=2;for(var j=0;length>j;j++)this.setUint8(i++,view.getUint8(fromIndex++));return i},DataView.prototype.print_r=function(debug,starting,length){starting=starting||0,length=length||this.byteLength;for(var c,inte,str="Index		Binary		Integer		Char\n",full="",i=starting;length>i;i++)inte=this.getUint8(i),c=String.fromCharCode(inte),str+=i+"		 		"+inte.toString(2)+"				"+inte+"				"+c+"\n",full+=c;return debug&&"string"!=typeof debug?void 0:full},DataView.prototype.printBytes=function(){for(var bytes=[],i=0;i<this.byteLength;i++)bytes.push(this.getUint8(i));bytes.push(-1e3)},DataView.prototype.getString=function(offset,length){var firstByte,highSurrogate,lowSurrogate,codePoint,self=this,bitArray=[];for(length=length||self.byteLength;length>0;)firstByte=self.getUint8(offset),self.getUint8(offset)<=127?(bitArray.push(self.getUint8(offset++)),length--):self.getUint8(offset)>=128&&self.getUint8(offset)<=223?(bitArray.push((31&self.getUint8(offset++))<<6|63&self.getUint8(offset++)),length-=2):self.getUint8(offset)>=224&&self.getUint8(offset)<=239?(bitArray.push((31&self.getUint8(offset++))<<12|((63&self.getUint8(offset++))<<6|63&self.getUint8(offset++))),length-=3):(codePoint=(7&self.getUint8(offset++))<<18|((63&self.getUint8(offset++))<<12|((63&self.getUint8(offset++))<<6|63&self.getUint8(offset++))),codePoint-=65536,highSurrogate=(codePoint>>10)+55296,lowSurrogate=codePoint%1024+56320,bitArray.push(highSurrogate,lowSurrogate),length-=4);return String.fromCharCode.apply(null,bitArray)},DataView.prototype.getStringUtf16=function(length,offset,bom){offset=0|offset,length=length||this.byteLength-offset;var littleEndian=!1,str="",useBuffer=!1;if("undefined"!=typeof Buffer&&(str=[],useBuffer=!0),0>length&&(length+=this.byteLength),bom){var bomInt=this.getUint16(offset);65534===bomInt&&(littleEndian=!0),offset+=2,length-=2}for(var i=offset;offset+length>i;i+=2){var ch=this.getUint16(i,littleEndian);ch>=0&&55295>=ch||ch>=57344&&65535>=ch?useBuffer?str.push(ch):str+=String.fromCharCode(ch):ch>=65536&&1114111>=ch&&(ch-=65536,useBuffer?(str.push(((1047552&ch)>>10)+55296),str.push((1023&ch)+56320)):str+=String.fromCharCode(((1047552&ch)>>10)+55296)+String.fromCharCode((1023&ch)+56320))}return useBuffer?str.toString():decodeURIComponent(escape(str))},DataView.prototype.getIntByByte=function(offset,length){var self=this;switch(length){case 1:return self.getUint8(offset);case 2:return self.getUint16(offset);case 4:return self.getUint32(offset);case 6:case 8:var i,tempInt,str="";for(i=offset;offset+length>i;i++)tempInt=self.getUint8(i).toString(2),str+=tempInt.length<8?"0".repeat(8-tempInt.length)+tempInt:tempInt;return parseInt(str,2);default:return self.getUint8(offset)}},DataView.prototype.getSynch=function(num){for(var out=0,mask=2130706432;mask;)out>>=1,out|=num&mask,mask>>=8;return out},Number.isInteger=Number.isInteger||function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value},ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(begin,end){if(void 0===begin&&(begin=0),void 0===end&&(end=this.byteLength),begin=Math.floor(begin),end=Math.floor(end),0>begin&&(begin+=this.byteLength),0>end&&(end+=this.byteLength),begin=Math.min(Math.max(0,begin),this.byteLength),end=Math.min(Math.max(0,end),this.byteLength),0>=end-begin)return new ArrayBuffer(0);var result=new ArrayBuffer(end-begin),resultBytes=new Uint8Array(result),sourceBytes=new Uint8Array(this,begin,end-begin);return resultBytes.set(sourceBytes),result}),DataView.prototype.setUint64=function(offset,value){var self=this,binary=Number.isInteger(value)?value.toString(2):parseInt(value).toString(2);binary=binary.length<64?"0".repeat(64-binary.length)+binary:binary;for(var binaryArray=binary.match(/.{1,32}/g),intArray=binaryArray.map(function(binaryByte){return parseInt(binaryByte,2)}),i=0;i<intArray.length;i++)self.setUint32(offset+4*i,intArray[i])},DataView.prototype.getBool=function(offset){return 1===this.getUint8(offset)},window.Element&&function(ElementPrototype){ElementPrototype.matches=ElementPrototype.matches||ElementPrototype.matchesSelector||ElementPrototype.webkitMatchesSelector||ElementPrototype.msMatchesSelector||function(selector){for(var node=this,nodes=(node.parentNode||node.document).querySelectorAll(selector),i=-1;nodes[++i]&&nodes[i]!=node;);return!!nodes[i]}}(window.Element.prototype),window.Element&&function(ElementPrototype){ElementPrototype.closest=ElementPrototype.closest||function(selector){for(var el=this;el.matches&&!el.matches(selector);)el=el.parentNode;return el.matches?el:null}}(window.Element.prototype),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,DataView.prototype.getUint24=function(offset,littleEndian){return littleEndian?this.getUint8(offset)+(this.getUint8(offset+1)<<8)+(this.getUint8(offset+2)<<16):this.getUint8(offset+2)+(this.getUint8(offset+1)<<8)+(this.getUint8(offset)<<16)},Math.easeIn=function(t,b,c,d){return t/=d/2,1>t?c/2*t*t+b:(t--,-c/2*(t*(t-2)-1)+b)}}(window,DataView),function(){"use strict";angular.module("ringid.config",[])}(),function(){"use strict";function setUrlBase(ob){settings.signupInit=ob.ac+"ringid?",settings.signupSocialInit=ob.ac+"comports?",settings.imBase=ob.imsres,settings.imServer=ob.ims+"ringmarket/",settings.mediaServer=ob.vodapi+"/stream/",settings.mediaBase=ob.vodres,settings.stickerBase=ob.stmres+"stickermarket/d5/",settings.stickerApi=ob.stmapi+"ringmarket/StickerHandler/"}var server=location.href.split("/")[2],protocol="http://",baseUrl=location.protocol+"//"+location.host+"/",setting_default={ac:"http://devauth.ringid.com/rac/",ims:"http://devimages.ringid.com/",imsres:"http://devimagesres.ringid.com/",stmapi:"http://devsticker.ringid.com/",stmres:"http://devstickerres.ringid.com/",vodapi:"http://devvod.ringid.com/",vodres:"http://devvodres.ringid.com/",apiVersion:139},settings={apiVersion:setting_default.apiVersion,constantServer:"http://auth.ringid.com/cnstnts?pf=2&v="+setting_default.apiVersion+"&apt=1",socketProtocol:"ws://",secure:!1,httpsUrl:"https://"+server,siteUrl:server,baseUrl:baseUrl,base:location.host,chatImBase:protocol+"image.ringid.com/chatContens/",chatVideoBase:protocol+"image.ringid.com/chatContens/",chatAudioBase:protocol+"image.ringid.com/chatContens/",tagChatImBase:protocol+"image.ringid.com/groupContents/",chatHeartBeatUrl:baseUrl+"images/ping.jpg",emotionServer:setting_default.imsres+"/emoticon/d5/",emoticonBase:protocol+server+"/images/emoticon/",stickerBase:setting_default.stmres+"stickermarket/d5/",stickerApi:setting_default.stmapi+"ringmarket/StickerHandler/",imMediaBase:protocol+"image.ringid.com/ringmarket/ChatImageHandler",twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",ogServiceUrl:protocol+server+"/OGService",FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE"};settings.updateUrlBase=setUrlBase,settings.updateUrlBase(setting_default);var PLATFORM={DESKTOP:1,ANDROID:2,IPHONE:3,WINDOWS:4,WEB:5},RING_ROUTES={HOME:"/",USER_PROFILE:"/profile/:uId/:subpage?/:albumId?",CIRCLE_HOME:"/circle/:circleId/:subpage?",WHO_SHARED_FEED:"/feed_shares/:feedId/:commentId?",SINGLE_FEED:"/feed/:feedId/:commentId?/:shared?",SINGLE_IMAGE:"/image/:imageId/:commentId?",SINGLE_MEDIA:"/media/:mediaId/:commentId?",LOGIN_SOCIAL:"/social/:operation/:platform/:token",SIGNUP_SOCIAL:"/social/:operation/:platform/:token",FAQ:"/faq",API_DASHBOARD:"/apidashboard"};angular.module("ringid.config").value("settings",settings).constant("PLATFORM",PLATFORM).constant("RING_ROUTES",RING_ROUTES).constant("MIN_TIMESTAMP",0xe87c62b0141)}(),function(){"use strict";var ATTRIBUTE_CODES={AUTHIP:1001,AUTHPORT:1002,AUTH_E_USERNAME:1003,AUTH_E_PASSWORD:1004,AUTH_E_SALT:1005,ACTION:1,SERVER_PACKET_ID:2,SESSION_ID:3,TOTAL_PACKET:4,PACKET_NUMBER:5,UNIQUE_KEY:6,USER_ID:7,FRIEND_ID:8,DEVICE:9,CLIENT_PACKET_ID:10,CALL_ID:11,FRIEND_IDENTITY:12,CALL_TIME:13,PRESENCE:14,IS_DEVIDED_PACKET:15,USER_IDENTITY:16,USER_NAME:17,TOTAL_RECORDS:18,USER_TABLE_IDS:19,SUCCESS:20,MESSAGE:21,REASON_CODE:22,STATUS:23,DELETED:24,WEB_UNIQUE_KEY:28,WEB_TAB_ID:29,DATA:127,CONTACT:101,CONTACT_TYPE:102,NEW_CONTACT_TYPE:103,FRIENDSHIP_STATUS:104,BLOCK_VALUE:105,CHANGE_REQUESTER:106,CONTACT_UPDATE_TIME:107,MUTUAL_FRIEND_COUNT:108,CALL_ACCESS:110,CHAT_ACCESS:111,FEED_ACCESS:112,ANONYMOUS_CALL:9,PASSWORD:128,RESET_PASSWORD:129,EMAIL:130,DEVICE_UNIQUE_ID:131,DEVICE_TOKEN:132,MOBILE_PHONE:133,BIRTH_DATE:134,MARRIAGE_DAY:135,GENDER:136,COUNTRY_ID:137,CURRENT_CITY:138,HOME_CITY:139,LANGUAGE_ID:140,REGISTRATION_DATE:141,DIALING_CODE:142,IS_MY_NUMBER_VERIFIED:143,IS_EMAIL_VERIFIED:145,MY_NUMBER_VERIFICATION_CODE:146,MYNUMBER_VERIFICATION_CODE_SENT_TIME:147,EMAIL_VERIFICATION_CODE:148,RECOVERY_VERIFICATION_CODE:149,RECOVERY_VERIFICATION_CODE_SENT_TIME:150,PROFILE_IMAGE:151,PROFILE_IMAGE_ID:152,COVER_IMAGE:153,COVER_IMAGE_ID:154,COVER_IMAGE_X:155,COVER_IMAGE_Y:156,ABOUT_ME:157,TOTAL_FRIENDS:158,RING_EMAIL:159,UPDATE_TIME:160,NOTIFICATION_VALIDITY:161,WEB_LOGIN_ENABLED:162,PC_LOGIN_ENABLED:163,COMMON_FRIEND_SUGGESTION:164,PHONE_NUMBER_SUGGESTION:165,CONTACT_LIST_SUGGESTION:166,ADDED_TIME:168};angular.module("ringid.config").constant("ATTRIBUTE_CODES",ATTRIBUTE_CODES)}(),function(){"use strict";angular.module("ringid.config").constant("REASON_CODES",{NONE:0,PERMISSION_DENIED:1,PASSCODE_SENT_INTERVAL:2,DONT_DISTURB_MODE:3,ALREADY_SHARED:4,NOT_TAG_MEMBER:5,TAG_DOES_NOT_EXIST:6,SMS_SENDING_FAILED:7,EMAIL_SENDING_FAILED:8,FRIEND_OFFLINE:9,NOT_FRIEND:10,USERID_FRIENDID_SAME:11,ALREADY_FRIEND_REQUESTED:12,EXCEPTION_OCCURED:13,DATABASE_ROLL_BACKED:14,CANT_SHARE_OWN_FEED:15,FRIEND_DID_NOT_FOUND:16,SMS_SEND_RETRY_LIMIT_OVER:17,NO_MORE_FEED:18,NOT_FOUND:404}).constant("MESSAGES",{REQUEST_PROCESSED:"Your Request Was Successfully Processed",REQUEST_FAILED:"Your Request Was Failed ! Please Try Later.",RC0:"NONE.",RC1:"PERMISSION_DENIED",RC2:"PASSCODE_SENT_INTERVAL",RC3:"DONT_DISTURB_MODE",RC4:"You have already shared this post.",RC5:"NOT_TAG_MEMBER.",RC6:"TAG_DOES_NOT_EXIST.",RC7:"SMS_SENDING_FAILED.",RC8:"EMAIL_SENDING_FAILED.",RC9:"FRIEND_OFFLINE",RC10:"You are not permitted to share this post",RC11:"USERID_FRIENDID_SAME",RC12:"ALREADY_FRIEND_REQUESTED",RC13:"EXCEPTION_OCCURED",RC14:"DATABASE_ROLL_BACKED",RC15:"You Can't Share Your Own Post",RC16:"FRIEND_DID_NOT_FOUND",RC17:"SMS_SEND_RETRY_LIMIT_OVER",RC18:"NO_MORE_FEED",RC19:"UNKNOWN",RC20:"UNKNOWN",RC21:"LOGGED_IN_FROM_ANOTHER_DEVICE",RC22:"UNKNOWN",RC23:"UNKNOWN",RC26:"USER_EXIST",RC27:"DUPLICATE_DATA",RC33:"THIS_IS_SPECIAL_FRIEND",RC37:"ANONYMOUS_CHAT_PERMISSION_DENIED",RC24:"Wrong Password.",RC38:"Could not find DeviceID!",RC39:"This phone number is not verified.",RC40:"This email is not verified.",RC41:"Your facebook ID is not verified.",RC42:"Your twitter ID is not verified.",RC43:"Could not find Your facebook ID.",RC44:"Could not find Your twitter ID.",RC45:"Wrong RingID!",RC46:"Wrong Phone number!",RC47:"Wrong Email!",RC48:"Device Id required!",RC49:"Password required",RC50:"Login Type required",RC51:"Phone country code required!",RC52:"Phone number required!",RC53:"RingID required!",RC54:"Email required!",RC55:"Version required!",RC56:"Device required!",RC57:"Wrong information",RC404:"NOT_FOUND",CRCFS1:"Wall post cann't be shared",CRCFS2:"Group post cann't be shared",CRCFS3:"You already shared this post",FEED:{ACT_1:"{0} liked this post",ACT_2:"{0} commented on this post",ACT_3:"{0} shared this post",TYPE_0:"{0}",TYPE_11:"{0}",TYPE_11C:"{0} posted",TYPE_11F:"{0} posted",TYPE_12:"{0} have||has updated profile picture",TYPE_13:"{0} have||has updated cover picture",TYPE_2:"{0}",TYPE_2C:"{0} posted",TYPE_2F:"{0} posted",TYPE_3:"{0} have||has added {1} photos",TYPE_4:"{0} created a album",TYPE_50:"{0} added audio",TYPE_51:"{0} shared {1}'s audio",TYPE_60:"{0} added video",TYPE_62:"{0} shared {1}'s video",TYPE_D:"{0}",C_POSTFIX:" in {0}",F_POSTFIX:" on {0}'s timeline",TYPE_SHARE:"{0} shared {1}'s feed"}}).constant("APP_CONSTANTS",{NOT_FRIEND:0,FRIEND:1,INCOMING_FRIEND:2,OUTGOING_FRIEND:3,TYPE_SEARCH_BY_ALL:0,TYPE_SEARCH_BY_NAME:1,TYPE_SEARCH_BY_PHONE:2,TYPE_SEARCH_BY_EMAIL:3,TYPE_SEARCH_BY_RINGID:4,TYPE_SEARCH_BY_LOCATION:5,IMAGE_UPLOAD_LIMIT:40,VIDEO_UPLOAD_LIMIT:5,AUDIO_UPLOAD_LIMIT:5,COVER_PIC_UPLOAD_MAXIMUM_WIDTH:1480,COVER_PIC_UPLOAD_MAXIMUM_HEIGHT:2048,COVER_PIC_UPLOAD_MINIMUM_WIDTH:740,COVER_PIC_UPLOAD_MINIMUM_HEIGHT:280,PROFILE_PIC_UPLOAD_MINIMUM_WIDTH:100,PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT:100,COVER_PIC_CROP_WIDTH:1480,COVER_PIC_CROP_HEIGHT:547,PROFILE_PIC_CROP_WIDTH:200,IMAGE_UPLOAD_MIN_WIDTH:10,IMAGE_UPLOAD_MIN_HEIGHT:10,MEDIA_UPLOAD_SIZE_LIMIT:524288e3,FEED_LIMIT:6,LEFT_BAR_WIDTH:200,RIGHT_BAR_WIDTH:200,CELL_MARGIN:10,GOOGLE_MAP_KEY:"AIzaSyCHl88HAklaOu6Q0TSfX5N5eA0vjdlBNuE",NEWS_FEED_MEDIA_TYPE_AUDIO:1,NEWS_FEED_MEDIA_TYPE_VIDEO:2}).constant("PrivacySet",{PVC1:{icon:"post-ico only-i",text:"Only me",value:1},PVC2:{icon:"post-ico fri-i",text:"Friends",value:2},PVC3:{icon:"post-ico pub-i",text:"Public",value:3}}).constant("CLIENT_DATA_SIZE",460).constant("AUTH_SERVER_CONFIG",{REQUEST_DELAY:200}).value("DATE_FORMAT","MMM d, y h:mm a")}(),function(){"use strict";angular.module("ringid.config").constant("OPERATION_TYPES",{SYSTEM:{REQUEST_TYPE:{KEEP_ALIVE:1,CONFIRMATION:2,AUTHENTICATION:3,UPDATE:4,REQUEST:5,CALL:6,CHAT:7},TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:114,TYPE_NEWS_FEED:88,TYPE_MY_NEWS_FEED:94,TYPE_FRIEND_NEWSFEED:110,TYPE_GROUP_NEWS_FEED:198,TYPE_COMMENTS_FOR_STATUS:84,ACTION_SHARE_STATUS:191,ACTION_GET_FULL_COMMENT:137,TYPE_ADD_MULTI_IMAGE:117,TYPE_ADD_STATUS:177,NEWS_FEED_TYPE_IMAGE:1,NEWS_FEED_TYPE_STATUS:2,NEWS_FEED_TYPE_MULTIPLE_IMAGE:3,NEWS_FEED_TYPE_ALBUM:4,NEWS_FEED_TYPE_AUDIO:5,NEWS_FEED_TYPE_VIDEO:6,TYPE_SINGLE_IMAGE_STATUS:1,TYPE_TEXT_STATUS:2,TYPE_MULTI_IMAGE_STATUS:3,TYPE_DELETE_STATUS:179,TYPE_EDIT_STATUS:178,TYPE_LIKE_STATUS:184,TYPE_UNLIKE_STATUS:186,TYPE_ADD_STATUS_COMMENT:181,TYPE_LIKE_COMMENT:123,TYPE_UNLIKE_COMMENT:125,TYPE_DELETE_STATUS_COMMENT:183,TYPE_EDIT_STATUS_COMMENT:189,TYPE_LIKES_FOR_STATUS:92,TYPE_LIST_LIKES_OF_COMMENT:116,TYPE_TAG_USER_LIST:274,TYPE_WHO_SHARES_LIST:249,TYPE_UPDATE_ADD_STATUS:377,TYPE_UPDATE_EDIT_STATUS:378,ACTION_UPDATE_SHARE_STATUS:391,TYPE_UPDATE_LIKE_STATUS:384,TYPE_UPDATE_UNLIKE_STATUS:386,TYPE_UPDATE_DELETE_STATUS:379,TYPE_UPDATE_ADD_STATUS_COMMENT:381,TYPE_UPDATE_LIKE_COMMENT:323,TYPE_UPDATE_UNLIKE_COMMENT:325,TYPE_UPDATE_DELETE_STATUS_COMMENT:383,TYPE_UPDATE_EDIT_STATUS_COMMENT:389,ALBUM:{TYPE_UPLOAD_ALBUM_IMAGE:85,TYPE_UPDATE_UPLOAD_ALBUM_IMAGE:90,TYPE_DELETE_ALBUM_IMAGE:176,TYPE_UPDATE_DELETE_ALBUM_IMAGE:376},AUTH:{TYPE_INVALID_LOGIN_SESSION:19,TYPE_SIGN_IN:20,TYPE_SIGN_OUT:22,TYPE_SIGN_UP:21,TYPE_SESSION_VALIDATION:76,TYPE_MULTIPLE_SESSION:75,SIGNUP_SEND_CODE_EMAIL:220,SIGNUP_SEND_CODE_PHONE:100,SIGNUP_REGISTER:126,PASSWORD_RECOVER_SEND_CODE:217,PASSWORD_RECOVER_VERIFY_CODE:218,PASSWORD_RECOVER:219},FRIENDS:{TYPE_CONTACT_UTIDS:29,TYPE_CONTACT_LIST:23,TYPE_PEOPLE_YOU_MAY_KNOW:31,TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:32,TYPE_FRIEND_CONTACT_LIST:107,TYPE_CONTACT_SEARCH:34,ACTION_FRIEND_SEARCH:35,TYPE_ADD_FRIEND:127,TYPE_UPDATE_ADD_FRIEND:327,TYPE_DELETE_FRIEND:128,TYPE_UPDATE_DELETE_FRIEND:328,TYPE_ACCEPT_FRIEND:129,TYPE_UPDATE_ACCEPT_FRIEND:329,TYPE_ACTION_BLOCK_UNBLOCK_FRIEND:243,TYPE_ACTION_CHANGE_FRIEND_ACCESS:244},NOTIFICATION:{TYPE_MY_NOTIFICATIONS:111,TYPE_SINGLE_NOTIFICATION:113,CLEAR_NOTIFICATION_COUNTER:195,MSG_TYPE_UPDATE_PROFILE_IMAGE:1,MSG_TYPE_UPDATE_COVER_IMAGE:2,MSG_TYPE_ADD_FRIEND:3,MSG_TYPE_ACCEPT_FRIEND:4,MSG_TYPE_ADD_GROUP_MEMBER:5,MSG_TYPE_ADD_STATUS_COMMENT:6,MSG_TYPE_LIKE_STATUS:7,MSG_TYPE_LIKE_COMMENT:8,MSG_TYPE_ADD_COMMENT_ON_COMMENT:9,MSG_TYPE_SHARE_STATUS:10,MSG_TYPE_LIKE_IMAGE:11,MSG_TYPE_IMAGE_COMMENT:12,MSG_TYPE_LIKE_IMAGE_COMMENT:13,MSG_TYPE_LIKE_AUDIO_MEDIA:17,MSG_TYPE_AUDIO_MEDIA_COMMENT:18,MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:19,MSG_TYPE_AUDIO_MEDIA_VIEW:20,MSG_TYPE_LIKE_VIDEO_MEDIA:21,MSG_TYPE_VIDEO_MEDIA_COMMENT:22,MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:23,MSG_TYPE_VIDEO_MEDIA_VIEW:24,MSG_TYPE_YOU_HAVE_BEEN_TAGGED:25,MSG_TYPE_UPGRADE_FRIEND_ACCESS:14,MSG_TYPE_ACCEPT_FRIEND_ACCESS:15,MSG_TYPE_DOWNGRADE_FRIEND_ACCESS:16},CIRCLE:{TYPE_CREATE_GROUP:50,TYPE_GROUP_DETAILS:52,TYPE_LEAVE_GROUP:53,TYPE_GROUP_LIST:70,TYPE_GROUP_MEMBERS_LIST:99,TYPE_GROUP_MEMBERS_SEARCH_RESULT:101,TYPE_DELETE_GROUP:152,TYPE_REMOVE_GROUP_MEMBER:154,TYPE_ADD_GROUP_MEMBER:156,TYPE_EDIT_GROUP_MEMBER:158,TYPE_UPDATE_ADD_GROUP:352,TYPE_UPDATE_DELETE_GROUP:352,TYPE_UPDATE_REMOVE_GROUP_MEMBER:354,TYPE_UPDATE_ADD_GROUP_MEMBER:356,TYPE_UPDATE_EDIT_GROUP_MEMBER:358,TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:51},CHAT:{FRIEND_CHAT_REQUEST:175,FRIEND_CHAT_UPDATE:375},TAG_CHAT:{TAG_CHAT_REQUEST_START:134,TAG_CHAT_UPDATE_START:334,TAG_CHAT_REQUEST_ADD_MEMBER:135,TAG_CHAT_UPDATE_ADD_MEMBER:335},MEDIA:{ACTION_ADD_MEDIA_CONTENT:258,ACTION_UPDATE_MEDIA_CONTENT:259,ACTION_DELETE_MEDIA_CONTENT:260,ACTION_MEDIA_ALBUM_CONTENT_LIST:261,ACTION_MEDIA_CONTENT_DETAILS:262,ACTION_ADD_MEDIA_ALBUM:253,ACTION_UPDATE_MEDIA_ALBUM:254,ACTION_DELETE_MEDIA_ALBUM:255,ACTION_MEDIA_ALBUM_LIST:256,ACTION_MEDIA_ALBUM_DETAILS:257,ACTION_MEDIA_SEARCH_RESULT:277,ACTION_SPECIFIC_MEDIA_RESULT:278,ACTION_GET_TAGGED_MEDIA_SONGS:279,ACTION_GET_HASHTAG_SUGGESTION:280,ACTION_GET_TRENDING_KEYWORDS:281,ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT:272,ACTION_ADD_COMMENT_ON_MEDIA:265,ACTION_LIKE_UNLIKE_MEDIA:264,ACTION_EDIT_COMMENT_ON_MEDIA:266,ACTION_MEDIA_COMMENT_LIST:270,ACTION_MEDIA_LIKE_LIST:269,ACTION_DELETE_COMMENT_ON_MEDIA:267,ACTION_LIKE_UNLIKE_MEDIA_COMMENT:268,ACTION_MEDIACOMMENT_LIKE_LIST:271,ACTION_UPDATE_LIKE_UNLIKE_MEDIA:464,ACTION_UPDATE_ADD_MEDIA_COMMENT:465,ACTION_UPDATE_EDIT_MEDIA_COMMENT:466,ACTION_UPDATE_DELETE_MEDIA_COMMENT:467,ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:468,ACTION_UPDATE_INCREASE_MEDIA_CONTENT_VIEW_COUNT:472},IMAGE:{PROFILE_IMAGE_ALBUM_ID:"profileimages",COVER_IMAGE_ALBUM_ID:"coverimages",FEED_IMAGE_ALBUM_ID:"default",TYPE_FRIEND_ALBUM_IMAGES:109,FETCH_ALBUM_LIST:96,FETCH_FRIEND_ALBUM_LIST:108,TYPE_ALBUM_IMAGES:97,TYPE_COMMENTS_FOR_IMAGE:89,TYPE_LIKES_FOR_IMAGE:93,TYPE_IMAGE_COMMENT_LIKES:196,TYPE_LIKE_IMAGE:185,TYPE_UNLIKE_IMAGE:187,TYPE_IMAGE_DETAILS:121,TYPE_EDIT_IMAGE_COMMENT:194,TYPE_ADD_IMAGE_COMMENT:180,TYPE_LIKE_UNLIKE_IMAGE_COMMENT:197,TYPE_DELETE_IMAGE_COMMENT:182,DELETE_IMAGE:246,TYPE_UPDATE_ADD_IMAGE_COMMENT:380,TYPE_UPDATE_EDIT_IMAGE_COMMENT:394,TYPE_UPDATE_DELETE_IMAGE_COMMENT:382,TYPE_UPDATE_LIKE_IMAGE:385,TYPE_UPDATE_UNLIKE_IMAGE:387,TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:397},PROFILE:{TYPE_CHANGE_COVER_PIC:103,TYPE_CHANGE_PROFILE_PIC:63,TYPE_REMOVE_PROFILE_IMAGE:43,TYPE_REMOVE_COVER_IMAGE:104,TYPE_ACTION_USER_MOOD:193,TYPE_ACTION_USER_MOOD_PRESENCE:199,FETCH_FRIEND_MUTUAL_FRIEND_LIST:118,CHANGE_PASSWORD:130,ACTION_USERS_PRESENCE_DETAILS:136,ACTION_USERS_PRESENCE_DETAILS_DATA:336,TYPE_ACTION_CURRENT_USER_BASICINFO:21,TYPE_ACTION_OTHER_USER_BASICINFO:95,PHN_MAIL_VERIFICATION_CHECK:28,TYPE_ACTION_GET_USER_DETAILS:204,TYPE_ACTION_LIST_WORK_AND_EDUCATIONS:230,TYPE_ACTION_MODIFY_USER_PROFILE:25,TYPE_ACTION_MODIFY_PRIVACY_SETTINGS:74,TYPE_CHANGE_PRIVACY:216,TYPE_CHANGE_FRIEND_PRIVACY:82,SEND_VERIFICATION_CODE_TO_MAIL:221,SEND_VERIFICATION_CODE_TO_PHONE:212,TYPE_ACTION_ADD_EDUCATION:231,TYPE_ACTION_UPDATE_EDUCATION:232,TYPE_ACTION_REMOVE_EDUCATION:233,TYPE_ACTION_GET_WORK:234,TYPE_ACTION_GET_EDUCATION:235,TYPE_ACTION_GET_SKILL:236,TYPE_ACTION_ADD_SKILL:237,TYPE_ACTION_UPDATE_SKILL:238,TYPE_ACTION_REMOVE_SKILL:239,TYPE_ACTION_ADD_WORK:227,TYPE_ACTION_UPDATE_WORK:228,TYPE_ACTION_REMOVE_WORK:229,ADD_SOCIAL_NETWORK:276},FETCH_EMOTION_LIST:273},STICKER:{GET_MY_STICKER:206,ADD_REMOVE_STICKER:207,ADD_JT_VALUE:1,REMOVE_JT_VALUE:3}})}(),function(){"use strict";angular.module("ringid.langugae.default",[]).constant("DF_KEY_VALUES",{add_friend:"Add Friend",remove_friend:"Remove Friend",common_friend:"Common Friend",request_sent:"Request Sent",unfriend:"Unfriend",block:"Block",unblock:"UnBlock",edit:"Edit",update:"Update","delete":"Delete",cancel:"Cancel",save:"Save",text_add:"Add",accept:"Accept",remove:"Remove",change:"Change",send:"Send",verify:"verify",add:"Add"})}(),function(){"use strict";angular.module("ringid.language",["ringid.langugae.default"]).factory("languageConstant",["DF_KEY_VALUES",function(DF_KEY_VALUES){var languages={"default":DF_KEY_VALUES};return{set:function(lang){languages[lang]={}},get:function(key,lang){return key=key||"default",languages[key]}}}])}(),function(){"use strict";angular.module("ringid.common.stacked_map",[]).factory("$$stackedMap",function(){return{createNew:function(dosort,order){function sortIt(prop_index){prop_index=prop_index||"sortBy";var gt=-1,lt=1;"desc"===order&&(gt=1,lt=-1),stack.sort(function(a,b){return b.value[prop_index]()>a.value[prop_index]()?gt:a.value[prop_index]()>b.value[prop_index]()?lt:0})}function getIndex(key){for(var i=0;i<stack.length;i++)if(key==stack[i].key)return i;return-1}function navigateNext(key){var index=getIndex(key);return-1===index||index===stack.length-1?!1:stack[index+1].value}function navigatePrevious(key){var index=getIndex(key);return-1===index||0===index?!1:stack[index-1].value}var stack=[],self=this;dosort=dosort||!1,order=order||"desc";var ObjectToReturn={concat:function(stackedMap){stack=stack.concat(stackedMap)},reset:function(){stack=[]},all:function(){return stack},setStack:function(st){stack=st},add:function(key,value){return stack.push({key:key,value:value}),dosort!==!1&&sortIt(),!1},next:function(key){return navigateNext(key)},previous:function(key){return navigatePrevious(key)},getByIndex:function(i,withIndex){return stack.length&&(i>=0||i<stack.length)?withIndex?stack[i]:stack[i].value:!1},getIndex:function(key){return getIndex(key)},get:function(key){var i=getIndex(key);return i>=0?stack[i].value:!1},save:function(key,value){var idx;idx=getIndex(key),-1===idx?ObjectToReturn.add(key,value):stack[idx]={key:key,value:value},dosort!==!1&&sortIt()},sort:function(type,prop_index){type&&(order=type),sortIt(prop_index)},keys:function(){for(var keys=[],i=0;i<stack.length;i++)keys.push(stack[i].key);return keys},values:function(){for(var values=[],i=0;i<stack.length;i++)values.push(stack[i].value);return values},top:function(withIndex){return stack.length?(withIndex=!!withIndex,withIndex?stack[stack.length-1]:stack[stack.length-1].value):!1},bottom:function(withIndex){return stack.length?(withIndex=!!withIndex,withIndex?stack[0]:stack[0].value):!1},sliceBy:function(length,starting_index){return starting_index||(starting_index=0),(length>stack.length||!length)&&(length=stack.length),stack.slice(starting_index,length)},remove:function(key){var idx=getIndex(key);return idx>-1?(stack.splice(idx,1),!0):!1},removeTop:function(){return stack.splice(stack.length-1,1)[0]},length:function(){return stack.length},nonClosedLength:function(){var count=0;return angular.forEach(stack,function(box,key){count+=box.closedBox?1:0}),count},copy:function(){for(var ob=self.createNew(dosort,order),i=0;i<stack.length;i++)ob.add(stack[i].key,stack[i].value);return ob},doForAll:function(fn){for(var i=0;i<stack.length;i++)fn.call(null,stack[i].value)}};return ObjectToReturn}}})}(),function(){"use strict";function StorageFactory(){function _init(loginData){function initStorage(){if(_getData("contacts")||_setData("contacts",{}),_getData("chatOpenedBoxes")||_setData("chatOpenedBoxes",{}),_getData("chatBoxes")||_setData("chatBoxes",{}),_getData("unreadMessageIds")||_setData("unreadMessageIds",[]),_getData("mediaRecent")||_setData("mediaRecent",[]),gotStore){for(var removeKeys=[],i=0,len=storage.length;len>i;++i)regExMatch=storage.key(i).match(/(\d+)-([a-z]+)/i),regExMatch&&regExMatch.length>1&&regExMatch[1]!=_storeKey&&removeKeys.push(storage.key(i));removeKeys.forEach(function(key){_clearData(key)})}}var regExMatch;loginData?(loginData=angular.fromJson(loginData),_setKey(loginData.utId),_setData("loginData",loginData),initStorage()):Cookies.get("utId")&&(_setKey(Cookies.get("utId")),initStorage())}var _storeKey,storage,gotStore=!1,_storageAvailable=function(type){try{var testStorage=window[type],x="__storage_test__";return testStorage.setItem(x,x),testStorage.removeItem(x),gotStore=!0,window[type]}catch(e){return gotStore=!1,{}}};storage=_storageAvailable("localStorage");var _setKey=function(key){_storeKey=key,angular.isDefined(storage[_storeKey])&&_setData(_storeKey,{})},_getKey=function(key){switch(key){case"loginData":case"country":case"remInfo":case"stickerData":break;case"chatOpenedBoxes":case"chatBoxes":case"cgInf":case"cts":case"unreadMessageIds":case"mood":case"utIds":case"incomingUtIds":case"outgoingUtIds":case"suggestionUtIds":case"contacts":case"notikeys":case"notiseen":case"mediaRecent":case"albumname":case"circledata":case"circleut":case"myStickers":key=_storeKey+"-"+key}return key},_setData=function(key,data){key=_getKey(key),gotStore?storage.setItem(key,angular.toJson(data)):storage[key]=angular.toJson(data)},_getData=function(key){return key=_getKey(key),gotStore?angular.fromJson(storage.getItem(key)):angular.fromJson(storage[key])},_clearData=function(key){key=_getKey(key),gotStore?storage.removeItem(key):delete storage[key]},_asyncSetData=function(key,value){setTimeout(function(){_setData(key,value)},200)};return _init(_getData("loginData")),{init:function(loginData){_init(loginData)},reset:function(){_clearData("loginData"),_clearData("remInfo"),_clearData("contacts"),_clearData("chatOpenedBoxes"),_clearData("suggestionUtIds")},setData:function(key,value,async){async?_asyncSetData(key,value):_setData(key,value)},getData:function(key){return _getData(key)},deleteData:function(key){_clearData(key)},setContact:function(utId,contact){if(utId){var contacts=_getData("contacts")||{};contacts.hasOwnProperty(utId)?contacts[utId]=angular.extend({},contacts[utId],contact):contacts[utId]=contact,_setData("contacts",contacts)}},getContact:function(utId){var contacts=_getData.contacts;return contacts&&contacts[utId]?contacts[utId]:null},updateLoginData:function(key,value){var loginData=_getData("loginData");loginData[key]=value,_setData("loginData",loginData)},setCookie:function(key,val,days){days?Cookies.set(key,val,{expires:days}):Cookies.set(key,val)},getCookie:function(key){return Cookies.get(key)},removeCookie:function(key){return Cookies.remove(key)}}}angular.module("ringid.common.storage_factory",[]).factory("Storage",StorageFactory),StorageFactory.$inject=[];
}(),function(){"use strict";angular.module("ringid.sticker",["ringid.config"]).value("STICKER_IMAGE_TYPE",{EMOTICON:1,LARGE_EMOTICON:2,STICKER:3}).value("STICKER_COLLECTION_CATEGORY_PRE_FETCH_COUNT",5)}(),function(){"use strict";function StickerHelper(STICKER_IMAGE_TYPE,$$stickerMap){var parseCategoryStickerData=function(data,stickersByCatIdMap,allStickerIdMap){var allStickers={type:STICKER_IMAGE_TYPE.STICKER,imageList:[]},stickerImages=data.imagesList;if(angular.isArray(stickerImages)){var catId=stickerImages[0].sCtId,stickerFactoryObj=allStickerIdMap[catId];allStickers.collectionId=stickerFactoryObj.getCollectionId(),allStickers.categoryId=catId,angular.forEach(stickerImages,function(aStickerObj){allStickers.imageList.push({name:aStickerObj.imUrl,type:STICKER_IMAGE_TYPE.STICKER,id:aStickerObj.imId}),stickersByCatIdMap[aStickerObj.sCtId]=$$stickerMap.create(allStickers)})}return stickersByCatIdMap};return{parseCategoryStickerData:parseCategoryStickerData}}angular.module("ringid.sticker").factory("StickerHelper",StickerHelper),StickerHelper.$inject=["STICKER_IMAGE_TYPE","$$stickerMap"]}(),function(){"use strict";function StickerPopupController($boxInstance,localData,$scope,StickerFactory){$scope.stickerCategories=StickerFactory.getStickerCategories(),$scope.stickerCollections=StickerFactory.getStickerCollections(),localData&&localData.stickerKey&&($scope.sticker=StickerFactory.getStickerCategoryObject(localData.stickerKey),$scope.$rgDigest()),$scope.addSticker=function(sticker){StickerFactory.addMySticker(sticker.getKey()),$scope.$rgDigest()},$scope.removeSticker=function(sticker){StickerFactory.removeMySticker(sticker.getKey()),$scope.$rgDigest()},$scope.isInstalled=function(stickerId){return StickerFactory.isDownloaded(stickerId)},$scope.close=function($event){$boxInstance.close(),$event&&($event.preventDefault(),$event.stopPropagation())}}angular.module("ringid.sticker").controller("StickerPopupController",StickerPopupController),StickerPopupController.$inject=["$boxInstance","localData","$scope","StickerFactory"]}(),function(){"use strict";function StickerCategoryModel(settings){return{keyString:"sCtId",getKeyString:function(){return StickerCategoryModel.keyString},create:function(apiObject){var factoryObject={sCtId:0,sctName:"",sClId:0,cgBnrImg:"",rnk:1,dtlImg:"",thmColor:"",txtColor:"",cgNw:0,icn:"",prz:0,free:0,dcpn:""},collectionObjectAdaptor=function(apiObject){var newfactoryObject=angular.extend({},factoryObject,apiObject);return newfactoryObject};return angular.isObject(apiObject)&&(factoryObject=collectionObjectAdaptor(apiObject)),{getCategoryId:function(){return factoryObject.sCtId},setCategoryId:function(sCategoryId){factoryObject.sCtId=sCategoryId},getCollectionId:function(){return factoryObject.sClId},setCollectionId:function(collectionId){factoryObject.sClId=collectionId},getKey:function(){return this.getCategoryId()},setKey:function(sCategoryId){this.setCategoryId(sCategoryId)},getName:function(){return factoryObject.sctName},setName:function(sCategoryName){factoryObject.sctName=sCategoryName},getTextColor:function(){return factoryObject.txtColor},setTextColor:function(textColor){factoryObject.txtColor=textColor},getBannerImage:function(){return factoryObject.bnrImg},setBannerImage:function(bannerImage){factoryObject.cgBnrImg=bannerImage},getRank:function(){return factoryObject.rnk},setRank:function(rank){factoryObject.rnk=rank},getDetailImage:function(){return factoryObject.dtlImg},getDetailImageUrl:function(){var url=settings.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getDetailImage();return url},setDetailImage:function(detailImage){factoryObject.dtlImg=detailImage},getNewCategory:function(){return factoryObject.cgNw},setNewCategory:function(newCategory){factoryObject.cgNw=newCategory},getIconImage:function(){return factoryObject.icn},setIconImage:function(iconImage){factoryObject.icn=iconImage},getIconImageUrl:function(){var url=settings.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/"+this.getIconImage();return url},getCaptionImageUrl:function(isHover){var url=settings.stickerBase+this.getCollectionId()+"/"+this.getCategoryId()+"/";return isHover?url+"ca.png":url+"c.png"},getPrice:function(){return factoryObject.prz},setPrice:function(price){factoryObject.prz=price},isFree:function(){return factoryObject.free},setIsFree:function(isFree){factoryObject.free=isFree},getDescription:function(){return factoryObject.dcpn},setDescription:function(description){factoryObject.dcpn=description},getThumbColor:function(){return factoryObject.thmColor},setThumbColor:function(thumbColor){factoryObject.thmColor=thumbColor}}}}}angular.module("ringid.sticker").factory("StickerCategoryModel",StickerCategoryModel),StickerCategoryModel.$inject=["settings"]}(),function(){"use strict";function StickerCollectionModel(settings,$$stackedMap){return{create:function(apiObject){var factoryObject={sClId:0,name:"",txtColor:"",bnrImg:"",thmColor:"",categories:[]},collectionObjectAdaptor=function(apiObject){var newfactoryObject=angular.extend({},factoryObject,apiObject);return newfactoryObject};return angular.isObject(apiObject)&&(factoryObject=collectionObjectAdaptor(apiObject)),{getId:function(){return factoryObject.sClId},setId:function(sClId){factoryObject.sClId=sClId},getKey:function(){return this.getId()},setKey:function(key){this.setId(key)},getName:function(){return factoryObject.name},setName:function(name){factoryObject.name=name},getTextColor:function(){return factoryObject.txtColor},setTextColor:function(textColor){factoryObject.txtColor=textColor},getBannerImage:function(){return factoryObject.bnrImg},setBannerImage:function(bannerImage){factoryObject.bnrImg=bannerImage},getBannerImageUrl:function(){var url=settings.stickerBase+this.getId()+"/"+this.getBannerImage();return url},getThumbColor:function(){return factoryObject.thmColor},setThumbColor:function(thumbColor){factoryObject.thmColor=thumbColor},addCategories:function(aCategoryId){factoryObject.categories.push(aCategoryId)},removeCategories:function(catId){factoryObject.categories.splice(catId,1)},getCategories:function(){return factoryObject.categories}}}}}angular.module("ringid.sticker").factory("StickerCollectionModel",StickerCollectionModel),StickerCollectionModel.$inject=["settings","$$stackedMap"]}(),function(){"use strict";function stickerHttpService($ringhttp,$$connector,settings,OPERATION_TYPES){var STICKER_OPERATION_TYPES=OPERATION_TYPES.STICKER,SYSTEM_REQUEST_TYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE,self=this;self.go=function(url,method,data){return method=method||"get",data=data||[],$ringhttp[method](url,data)},self.getAll=function(){var url=settings.stickerApi+"?all=1";return self.go(url)},self.getStickerCategoriesByCollectionId=function(collectionId){var url=settings.stickerApi+"?collectionId="+collectionId;return self.go(url)},self.getStickersByCatId=function(catId){var url=settings.stickerApi+"?categoryId="+catId;return self.go(url)},self.getMyStickers=function(){var payload={actn:STICKER_OPERATION_TYPES.GET_MY_STICKER};return $$connector.request(payload,SYSTEM_REQUEST_TYPE.REQUEST)},self.addSticker=function(obj){var payload={actn:STICKER_OPERATION_TYPES.ADD_REMOVE_STICKER,catId:obj.catId,jt:STICKER_OPERATION_TYPES.ADD_JT_VALUE};return $$connector.request(payload,SYSTEM_REQUEST_TYPE.UPDATE)},self.removeSticker=function(obj){var payload={actn:STICKER_OPERATION_TYPES.ADD_REMOVE_STICKER,catId:obj.catId,jt:STICKER_OPERATION_TYPES.REMOVE_JT_VALUE};return $$connector.request(payload,SYSTEM_REQUEST_TYPE.UPDATE)}}angular.module("ringid.sticker").service("stickerHttpService",stickerHttpService),stickerHttpService.$inject=["$ringhttp","$$connector","settings","OPERATION_TYPES"]}(),function(){"use strict";function StickerEmoticonService(STICKER_IMAGE_TYPE,settings){function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var self=this,emoMap={":D":"awesome.png",":<3":"loved.png","*D*":"excited.png",":)":"happy.png",":-(":"alone.png","(cool)":"cool.png","x=(":"angry.png","o_-":"fresh.png",":>s":"sick.png",":?":"confused.png",";|":"thoughtful.png",":*":"fantastic.png",":=(":"upset.png",">u<":"blah.png","(amused)":"amused.png","(hot)":"hot.png","(-_^)":"motivated.png","(^_^)":"satisfied.png",">=<":"hurt.png",":(s":"ill.png","(cute)":"cute.png","I=)":"relived.png",":O":"shoked.png","(beautiful)":"beautiful.png",":|p":"hyper.png","(pumped)":"pumped.png","%)":"drunk.png","o(":"impatient.png","(restless)":"restless.png",":-)":"emotional.png","(hungry)":"hungry.png","(nostalgic)":"nostalgic.png","(blessed)":"blessed.png","</3":"heartboken.png","(naughty)":"naughty.png","(entertained)":"entertained.png","(broken)":"broken.png","(cold)":"cold.png","(down)":"down.png","(sorry)":"sorry.png","(frustrated)":"frustrated.png",":-s":"scared.png",":@":"fuming.png",NN:"run.png",":'q":"crying.png",":'D":"laughing.png",":'(":"soreness.png","(boiling)":"boiling.png",":x":"xmode.png",":p":"cheeky.png",":=0":"laughing-inside.png","|-O":"yawn.png",":6":"devil.png",":-#":"zipped-lip.png","(clap)":"clap.png","<3":"heart.png","(pink-heart)":"pink-heart.png","(k)":"pink-lip.png","(#)":"sun.png","(*)":"star.png","(g)":"gift.png","(K)":"red-lip.png","(f)":"rose.png"},largeEmoMap=angular.extend({":&lt;3":"loved.png","&lt;/3":"heartboken.png","&gt;=&lt;":"hurt.png","&gt;u&lt;":"blah.png",":&gt;s":"sick.png","&lt;3":"heart.png"},emoMap),retstr=[];for(var key in largeEmoMap)largeEmoMap.hasOwnProperty(key)&&retstr.push(escapeRegExp(key));var emoPattern=new RegExp(retstr.join("|"),"g");self.getEmoImageName=function(symbolKey){try{return emoMap[symbolKey]}catch(e){return"default.png"}},self.getAllEmoticons=function(){var allEmoticons={type:STICKER_IMAGE_TYPE.EMOTICON,imageList:[]};return angular.forEach(emoMap,function(anEmoImageName,emoSymbol){allEmoticons.imageList.push({name:anEmoImageName,symbol:emoSymbol,type:STICKER_IMAGE_TYPE.EMOTICON})}),allEmoticons},self.getEmoticonUrlMap=function(){var emoticonUrlMap={};return angular.forEach(emoMap,function(anEmoImageName,emoSymbol){emoticonUrlMap[emoSymbol]=settings.emoticonBase+anEmoImageName}),emoticonUrlMap},self.getEmoticonUrlMapWithHtmlEncode=function(){var emoticonUrlMap={};return angular.forEach(largeEmoMap,function(anEmoImageName,emoSymbol){emoticonUrlMap[emoSymbol]=settings.emoticonBase+anEmoImageName}),emoticonUrlMap},self.getEmoticonPattern=function(){return emoPattern}}function StickerEmoticonFactory(StickerEmoticonService){function getAllEmoticons(){return StickerEmoticonService.getAllEmoticons()}function getEmoImageName(symbolKey){return StickerEmoticonService.getEmoImageName(symbolKey)}function getStickerImageUrl(collectionId,categoryId,imageName){var url=settings.stickerBase+collectionId+"/"+categoryId+"/"+imageName;return url}return{getAllEmoticons:getAllEmoticons,getEmoImageName:getEmoImageName,getStickerImageUrl:getStickerImageUrl,getEmoticonUrlMap:StickerEmoticonService.getEmoticonUrlMap,getEmoticonUrlMapWithHtmlEncode:StickerEmoticonService.getEmoticonUrlMapWithHtmlEncode,getEmoticonPattern:StickerEmoticonService.getEmoticonPattern}}angular.module("ringid.sticker").service("StickerEmoticonService",StickerEmoticonService).factory("StickerEmoticonFactory",StickerEmoticonFactory),StickerEmoticonService.$inject=["STICKER_IMAGE_TYPE","settings"],StickerEmoticonFactory.$inject=["StickerEmoticonService"]}(),function(){"use strict";function $$stickerImageMap(settings,STICKER_IMAGE_TYPE){return{create:function(ob,stickerType,stickerSrcBaseUrl){var image={id:ob.id||0,name:ob.name||"",symbol:ob.symbol||ob.name,type:ob.type||0,src:1===stickerType?settings.emoticonBase+ob.name:stickerSrcBaseUrl+ob.name,isEmoticon:stickerType===STICKER_IMAGE_TYPE.EMOTICON,isLargeEmoticon:stickerType===STICKER_IMAGE_TYPE.LARGE_EMOTICON,isSticker:stickerType===STICKER_IMAGE_TYPE.STICKER};return{getKey:function(){return image.id},src:function(){return image.src},symbol:function(){return image.symbol},getName:function(){return image.name},srcWithoutBase:function(){return image.src.replace(settings.stickerBase,"")},isEmoticon:function(){return image.isEmoticon},isLargeEmoticon:function(){return image.isLargeEmoticon},isSticker:function(){return image.isSticker}}}}}function $$stickerMap($$stackedMap,$$stickerImageMap,settings){return{create:function(ob,installed){var stickerSrcBaseUrl=settings.stickerBase+ob.collectionId+"/"+ob.categoryId+"/";RingLogger.information("$$stickerMap",RingLogger.tags.STICKER),RingLogger.print(ob,RingLogger.tags.STICKER);for(var image,sticker={categoryId:ob.categoryId||0,collectionId:ob.collectionId||0,imageListMap:$$stackedMap.createNew(),type:ob.type||0,isEmoticon:1===ob.type,isLargeEmoticon:2===ob.type,isSticker:3===ob.type,regularUrl:1===ob.type?"/images/emoticon/c.png":+stickerSrcBaseUrl+"c.png",hoverUrl:1===ob.type?"/images/emoticon/ca.png":stickerSrcBaseUrl+"ca.png",installed:installed||!1},key=0;key<ob.imageList.length;key++)image=$$stickerImageMap.create(ob.imageList[key],sticker.type,stickerSrcBaseUrl),sticker.imageListMap.add(image.getKey(),image);return{sortBy:function(){return sticker.categoryId},isInstalled:function(){return sticker.installed},setInstalled:function(isInstalled){sticker.installed=isInstalled},isEmoticon:function(){return sticker.isEmoticon},isLargeEmoticon:function(){return sticker.isLargeEmoticon},isSticker:function(){return sticker.isSticker},getKey:function(){return sticker.categoryId},getImages:function(){return sticker.imageListMap},getType:function(){return sticker.type},link:function(){return sticker.regularUrl},hoverLink:function(){return sticker.hoverUrl}}}}}function StickerFactory($$stackedMap,$$stickerMap,stickerHttpService,StickerEmoticonFactory,StickerHelper,StickerCategoryModel,StickerCollectionModel,STICKER_IMAGE_TYPE,$q,Storage){function initCollectionCategories(collectionFactoryObject){try{var collectionId=collectionFactoryObject.getKey();stickerHttpService.getStickerCategoriesByCollectionId(collectionId).success(function(data){if(RingLogger.print(data,RingLogger.tags.STICKER),data&&data.sucs===!0&&data.categoriesList){var categoryList=data.categoriesList;angular.isArray(categoryList)&&angular.forEach(categoryList,function(aCategory){var keyString=aCategory[StickerCategoryModel.getKeyString()],stickerCategoryFactoryObject=allStickerIdMap[keyString];stickerCategoryFactoryObject||(stickerCategoryFactoryObject=StickerCategoryModel.create(aCategory),allStickerIdMap[stickerCategoryFactoryObject.getKey()]=stickerCategoryFactoryObject),collectionFactoryObject.addCategories(stickerCategoryFactoryObject.getKey())})}else RingLogger.error("ERROR IN COLLECTION CATEGORY FETCH, INVALID RESPONSE",RingLogger.tags.STICKER)}).error(function(response){RingLogger.error("ERROR COLLECTION CATEGORY FETCH",response,RingLogger.tags.STICKER)})}catch(e){RingLogger.error("PARSING ERROR IN COLLECTION CATEGORY LIST",RingLogger.tags.STICKER)}}function initStickerCollectionAndCategories(dataList){try{angular.forEach(dataList.freeCategoriesList,function(aCategory){var aStickerCategoryFactoryObject=StickerCategoryModel.create(aCategory);allStickerIdMap[aStickerCategoryFactoryObject.getKey()]=aStickerCategoryFactoryObject,stickerCategories.free.push(aStickerCategoryFactoryObject.getKey())})}catch(e){RingLogger.error("PARSING ERROR STICKER FREE CATEGORY LIST",e,RingLogger.tags.STICKER)}try{angular.forEach(dataList.topCategoriesList,function(aCategory){var aStickerCategoryFactoryObject=StickerCategoryModel.create(aCategory);allStickerIdMap[aStickerCategoryFactoryObject.getKey()]=aStickerCategoryFactoryObject,stickerCategories.top.push(aStickerCategoryFactoryObject.getKey())})}catch(e){RingLogger.error("PARSING ERROR STICKER Top CATEGORY LIST",e,RingLogger.tags.STICKER)}try{angular.forEach(dataList.stNewCategoriesList,function(aCategory){var aStickerCategoryFactoryObject=StickerCategoryModel.create(aCategory);allStickerIdMap[aStickerCategoryFactoryObject.getKey()]=aStickerCategoryFactoryObject,stickerCategories["new"].push(aStickerCategoryFactoryObject.getKey())})}catch(e){RingLogger.error("PARSING ERROR STICKER New CATEGORY LIST",e,RingLogger.tags.STICKER)}try{angular.forEach(dataList.stickerCollectionsList,function(aCollection){var aStickerCollectionFactoryObject=StickerCollectionModel.create(aCollection);stickerCollections[aStickerCollectionFactoryObject.getKey()]=aStickerCollectionFactoryObject,initCollectionCategories(aStickerCollectionFactoryObject)})}catch(e){RingLogger.error("PARSING ERROR STICKER FREE CATEGORY LIST",e,RingLogger.tags.STICKER)}}function fetchAllStickerData(){stickerHttpService.getAll().success(function(data){try{data&&data.sucs===!0&&(saveStickerData(data),initStickerCollectionAndCategories(data),initMyStickers())}catch(e){RingLogger.information(e,RingLogger.tags.STICKER)}}).error(function(response){RingLogger.information(response,RingLogger.tags.STICKER)})}function getStickerData(){try{return Storage.getData(localStorageKey)}catch(e){return!1}}function saveStickerData(data){Storage.setData(localStorageKey,data)}function saveMyStickers(){Storage.setData(myStickerLocalStorageKey,myStickerList)}function initMyStickers(){myStickerList=Storage.getData(myStickerLocalStorageKey),myStickerRefreshed&&myStickerList||(myStickerList={},stickerHttpService.getMyStickers().then(function(response){response.sucs===!0&&(angular.forEach(response.catIds,function(aCatId){myStickerList[aCatId]=1,stickersByCatIdMap[aCatId]&&stickersByCatIdMap[aCatId].setInstalled(!0)}),saveMyStickers())}))}function initStickerData(allData){try{initStickerCollectionAndCategories(allData)}catch(e){RingLogger.error("ERROR IN INIT STICKER DATA",RingLogger.tags.STICKER)}}function getStickerObjectById(stickerId){try{return allStickerIdMap[stickerId]}catch(e){return RingLogger.information("ERROR IN GETTING STICKER BY ID",RingLogger.tags.STICKER),{}}}var localStorageKey="stickerData",myStickerLocalStorageKey="myStickers",allStickerIdMap={},stickersByCatIdMap={},stickerCategories={free:[],"new":[],top:[]},stickerCollections={},myStickerList={},allEmoticon=StickerEmoticonFactory.getAllEmoticons(),emoticonMap=$$stickerMap.create(allEmoticon,!0),myStickerRefreshed=!1,initStickersByCatId=function(catId){var deferred=$q.defer();return stickersByCatIdMap[catId]||stickerHttpService.getStickersByCatId(catId).success(function(data){data&&data.sucs===!0?(StickerHelper.parseCategoryStickerData(data,stickersByCatIdMap,allStickerIdMap),deferred.resolve(data)):RingLogger.information("ERROR IN STICKER DETAIL INIT FOR INVALID DATA",RingLogger.tags.STICKER)}).error(function(response){RingLogger.information("ERROR IN STICKER DETAIL INTT BY CAT ID",RingLogger.tags.STICKER),deferred.reject(response)}),deferred.promise};return{initStickerData:function(refresh){if(refresh===!0)fetchAllStickerData();else{var localData=getStickerData();angular.isObject(localData)?(initStickerData(localData),initMyStickers()):fetchAllStickerData()}},getNoOfMyStickers:function(){return myStickerList?Object.keys(myStickerList).length:0},getStickerCategories:function(type){return type?stickerCategories[type]:stickerCategories},getStickerCollections:function(){return stickerCollections},getMyStickerCatIds:function(){return myStickerList?Object.keys(myStickerList):[]},getStickerMapByCatId:function(catId){var deferred=$q.defer();return stickersByCatIdMap[catId]?deferred.resolve(stickersByCatIdMap[catId]):initStickersByCatId(catId).then(function(){deferred.resolve(stickersByCatIdMap[catId])},function(response){deferred.reject(response)}),deferred.promise},isDownloaded:function(stickerCatId){return!!myStickerList[stickerCatId]},getStickerCategoryObject:function(key){return getStickerObjectById(key)},getEmoticonMap:function(){return emoticonMap},getMyStickers:function(){return stickerHttpService.getMyStickers()},addMySticker:function(stickerCatId){try{myStickerList[stickerCatId]=1,saveMyStickers(),stickersByCatIdMap[stickerCatId]&&stickersByCatIdMap[stickerCatId].setInstalled(!0)}catch(e){RingLogger.error("ERROR IN ADD MY STICKER",e,RingLogger.tags.STICKER)}stickerHttpService.addSticker({catId:stickerCatId}).then(function(data){data.sucs!==!0&&(myStickerList[stickerCatId]=0,stickersByCatIdMap[stickerCatId].setInstalled(!1))},function(errData){RingLogger.information(errData,RingLogger.tags.STICKER)})},removeMySticker:function(stickerCatId){try{delete myStickerList[stickerCatId],saveMyStickers(),stickersByCatIdMap[stickerCatId]&&stickersByCatIdMap[stickerCatId].setInstalled(!1)}catch(e){RingLogger.error("ERROR IN ADD MY STICKER",e,RingLogger.tags.STICKER)}stickerHttpService.removeSticker({catId:stickerCatId}).then(function(data){data.sucs!==!0&&(myStickerList[stickerCatId]=1,stickersByCatIdMap[stickerCatId].setInstalled(!0))},function(errData){RingLogger.information(errData,RingLogger.tags.STICKER)})}}}angular.module("ringid.sticker").factory("StickerFactory",StickerFactory).factory("$$stickerMap",$$stickerMap).factory("$$stickerImageMap",$$stickerImageMap),$$stickerImageMap.$inject=["settings","STICKER_IMAGE_TYPE"],$$stickerMap.$inject=["$$stackedMap","$$stickerImageMap","settings"],StickerFactory.$inject=["$$stackedMap","$$stickerMap","stickerHttpService","StickerEmoticonFactory","StickerHelper","StickerCategoryModel","StickerCollectionModel","STICKER_IMAGE_TYPE","$$q","Storage"]}(),function(){"use strict";function rgStickerCategory(StickerFactory){return{restrict:"E",templateUrl:"pages/partials/stickers/sticker-category.html",scope:{categories:"=categories"},link:function(scope){scope.getStickerCategory=StickerFactory.getStickerCategoryObject,scope.showPreview=function(stickerId){return function(){return{stickerKey:stickerId}}},scope.isInstalled=function(stickerId){return StickerFactory.isDownloaded(stickerId)},scope.addSticker=function(stickerId){StickerFactory.addMySticker(stickerId),scope.$rgDigest()},scope.removeSticker=function(stickerId){StickerFactory.removeMySticker(stickerId),scope.$rgDigest()}}}}angular.module("ringid.sticker").directive("rgStickerCategory",rgStickerCategory),rgStickerCategory.$inject=["StickerFactory"]}(),function(){"use strict";angular.module("ringid.sticker").directive("rgStickerCategoryList",function(){return{restrict:"E",templateUrl:"pages/partials/stickers/sticker-category-list.html",scope:{categories:"=categories"}}})}(),function(){"use strict";angular.module("ringid.sticker").directive("rgStickerCollectionList",function(){return{restrict:"E",templateUrl:"pages/partials/stickers/sticker-collection-list.html",scope:{collections:"="},link:function(scope){scope.currentCollectionIdToShow=0,scope.shouldShowCollectionCategories=function(collectionId){return scope.currentCollectionIdToShow==collectionId},scope.showCollectionCategories=function(collectionId){scope.displayingCollections=!scope.displayingCollections,scope.currentCollectionIdToShow=collectionId,scope.$rgDigest()},scope.displayingCollections=!0}}})}(),function(){"use strict";angular.module("rg.custom.compiler.directive",[],["$compileProvider",function($compileProvider){$compileProvider.directive("rgCompile",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.rgCompile)},function(value){element.html(value),$compile(element.contents())(scope)})}}])}])}(),function(){"use strict";angular.module("ringid.utils",["ringid.config","ringid.common.stacked_map","ringid.sticker","rg.custom.compiler.directive"])}(),function(){"use strict";function utilsFactory($window,$document,APP_CONSTANTS,settings,$filter,StorageFactory,StickerEmoticonFactory,RING_ROUTES,MESSAGES,$ringhttp,$q,Storage){function getDefaultColumn(){returnOb.viewport||(returnOb.viewport=viewportsize());var windowWidth=returnOb.viewport.x;return 1245>=windowWidth?1:windowWidth>=1245&&1800>=windowWidth?2:windowWidth>1800?3:void 0}function feedColumn(){var default_col=getDefaultColumn(),col=parseInt(Storage.getCookie("col"));return!col||col>default_col?default_col=default_col>2?2:default_col:col}function cellWidthByCss(col){var width=returnOb.viewport.x;return 1===col&&width>=1280?600:width>=768&&799>=width?329:width>=800&&979>=width?361:width>=980&&1279>=width?541:width>=1280&&1349>=width?423:width>=1350&&1399>=width?458:width>=1400&&1499>=width?475:width>=1500&&1649>=width?510:width>=1650&&1799>=width?560:1920>=width?487:2650>=width?487:(RingLogger.alert("viewport else occured should not occur","ERROR"),500)}function FeedCellWidth(){var feedCol=feedColumn();return feedCol=parseInt(feedCol),1===feedCol?600:cellWidthByCss(feedCol)}function _getOGDetails(url){return $ringhttp.get(settings.ogServiceUrl+"?url="+encodeURIComponent(url))}function _getReasonMessageFromResponse(responseObj){return responseObj.mg?responseObj.mg:_getReasonMessage(responseObj.rc)}function _getReasonMessage(reasonCode){return MESSAGES["RC"+reasonCode]?MESSAGES["RC"+reasonCode]:""}function _debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}function _getImageUrlDimension(imgUrl){var defer=$q.defer(),img=new Image;return img.onload=function(){defer.resolve({imgUrl:this.src,width:this.width,height:this.height})},img.src=imgUrl,setTimeout(function(){defer.resolve({width:0,height:0})},15e3),defer.promise}function _dataURLToBlob(dataURL){var parts,contentType,binary,BASE64_MARKER=";base64,";if(-1==dataURL.indexOf(BASE64_MARKER))return parts=dataURL.split(","),contentType=parts[0].split(":")[1],binary=decodeURIComponent(parts[1]),new Blob([binary],{type:contentType});parts=dataURL.split(BASE64_MARKER),contentType=parts[0].split(":")[1],binary=window.atob(parts[1]);for(var uInt8Array=new Uint8Array(binary.length),i=0;i<binary.length;++i)uInt8Array[i]=binary.charCodeAt(i);return new Blob([uInt8Array],{type:contentType})}function _filterImagesByDimentions(imageUrls,lowestDimension){var defer=$q.defer(),allImageDimensionPromises=[],filteredImages=[];return lowestDimension.width||(lowestDimension.width=0),lowestDimension.height||(lowestDimension.height=0),angular.forEach(imageUrls,function(anImageUrl){allImageDimensionPromises.push(_getImageUrlDimension(anImageUrl))}),$q.all(allImageDimensionPromises).then(function(allImageDimensions){return angular.forEach(allImageDimensions,function(anImageDimension){var widthValid,heightValid;anImageDimension.width&&anImageDimension.width>=lowestDimension.width&&(widthValid=!0),anImageDimension.height&&anImageDimension.height>=lowestDimension.height&&(heightValid=!0),widthValid&&heightValid&&filteredImages.push(anImageDimension.imgUrl)}),defer.resolve(filteredImages)}),setTimeout(function(){defer.resolve([])},2e4),defer.promise}function _callXTimeAfterYIntervalStopOnSuccess(callback,successChecker,onFailCallback,maxExecutionCount,interval){var currentExecutionCount=0,doExecute=function(){!currentExecutionCount||maxExecutionCount>currentExecutionCount&&!successChecker.call(null,currentExecutionCount)?(callback.call(),currentExecutionCount++,setTimeout(doExecute,interval)):successChecker.call(null,currentExecutionCount)||onFailCallback.call()};doExecute()}function _triggerCustomEvent(eventName,data){var event=document.createEvent("Event");event.initEvent(eventName,!0,!0),event.data=data,document.dispatchEvent(event)}function _onCustomEvent(eventName,callback){var funcRef=function(response){callback.call(this,response.data)};return document.addEventListener(eventName,funcRef),funcRef}function _removeCustomEvent(eventName,callback){document.removeEventListener(eventName,callback)}function getSelection(){var sel;if(sel=window.getSelection(),sel.getRangeAt)return sel.getRangeAt(0);if(document.selection&&document.selection.createRange){var range=document.createRange();return range.setStart(selection.anchorNode,selection.anchorOffset),range.setEnd(selection.focusNode,selection.focusOffset),range}return null}function _string2ArrayBuffer(str){var arr=str.split(","),view=new Uint8Array(arr);return view.buffer}function _arrayBuffer2String(buf){var view=new Uint8Array(buf);return Array.prototype.join.call(view,",")}function safeDigest($scope){$scope.$parent&&1!==$scope.$parent.$id?$scope.$parent.$rgDigest():$scope.$rgDigest()}function generateUUID(){var d=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(d+=performance.now());var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)});return uuid}function _resetScroll(){animationStart=document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop,animationCurrentTime=0,animationChange=-1*animationStart}function _animateScroll(){animationCurrentTime+=25;var val=Math.easeIn(animationCurrentTime,animationStart,animationChange,animationDuration);document.documentElement.scrollTop=val,document.body.parentNode.scrollTop=val,document.body.scrollTop=val,animationDuration>animationCurrentTime&&requestAnimationFrame(_animateScroll)}function getScrollBarWidth(){var inner=document.createElement("p");inner.style.width="100%",inner.style.height="200px";var outer=document.createElement("div");outer.style.position="absolute",outer.style.top="0px",outer.style.left="0px",outer.style.visibility="hidden",outer.style.width="200px",outer.style.height="150px",outer.style.overflow="hidden",outer.appendChild(inner),document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="scroll";var w2=inner.offsetWidth;return w1==w2&&(w2=outer.clientWidth),document.body.removeChild(outer),inner=outer=null,w1-w2}function _getUserLocation(){var defer=$q.defer();return navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){var lat=position.coords.latitude,lng=position.coords.longitude,latLng={lat:lat,lng:lng},geocoder=new google.maps.Geocoder;geocoder.geocode({location:latLng},function(results,status){status===google.maps.GeocoderStatus.OK?defer.resolve({sucs:!0,lat:lat,lng:lng,description:results[1].formatted_address}):defer.resolve({sucs:!0,lat:lat,lng:lng})})},function(error){defer.resolve({sucs:!1,error:error})}),defer.promise}function getRingRoute(name,params){if(!RING_ROUTES[name])return"";var routeString=RING_ROUTES[name];switch(name){case"HOME":case"FAQ":break;case"SINGLE_FEED":params.feedId&&(routeString=routeString.replace(":feedId",params.feedId));var shared=params.shared?"shared":"";routeString=routeString.replace(":shared?",shared);var commentId;shared?(commentId=params.commentId||0,routeString=routeString.replace(":commentId?",commentId)):(commentId=params.commentId||"",routeString=routeString.replace(":commentId?/",commentId));break;case"WHO_SHARED_FEED":params.feedId&&(routeString=routeString.replace(":feedId",params.feedId));var commentId=params.commentId||"";routeString=routeString.replace(":commentId?",commentId);break;case"SINGLE_IMAGE":params.imageId&&(routeString=routeString.replace(":imageId",params.imageId));var commentId=params.commentId||"";routeString=routeString.replace(":commentId?",commentId);break;case"SINGLE_MEDIA":params.mediaId&&(routeString=routeString.replace(":mediaId",params.mediaId));var commentId=params.commentId||"";routeString=routeString.replace(":commentId?",commentId);break;case"USER_PROFILE":params.uId?routeString=routeString.replace(":uId",params.uId):(RingLogger.print(params,RingLogger.tags.PROFILE),RingLogger.print("Invalid Route Params Provided",RingLogger.tags.PROFILE)),routeString=params.utId?routeString.replace(":utId",params.utId):routeString.replace("/:utId",""),routeString=params.albumId?routeString.replace(":albumId?",params.albumId):routeString.replace("/:albumId?","");break;case"CIRCLE_HOME":params.circleId&&(routeString=routeString.replace(":circleId",params.circleId))}return routeString=params.subpage?routeString.replace(":subpage?",params.subpage):routeString.replace("/:subpage?",""),"#"+routeString;
}var ThisTabId,animationStart,animationCurrentTime,animationChange,returnOb={},urlPattern=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/gi,emopattern=StickerEmoticonFactory.getEmoticonPattern(),Emomapper=StickerEmoticonFactory.getEmoticonUrlMapWithHtmlEncode(),viewportsize=function(){var w=$window,d=$document,e=d[0].documentElement,g=d[0].getElementsByTagName("body")[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,yo=w.pageYOffset;return{x:x,y:y,yo:yo}},htmlentityencode=function(html){return String(html).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},addHttps=function(url){return/^(f|ht)tps?:\/\//i.test(url)||(url="http://"+url),url},textParseForLinkAndEmo=function(text,flag){text=htmlentityencode(text);var out=text,utfEmo=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return flag||(flag=0),"blob:http"===out.substring(0,9)&&(out='<img width="100%" src="'+out+'" />',flag=2),0===flag&&(out=out.replace(urlPattern,function(match){var url=addHttps(match);return'<a class="feedanchor" target="_blank" href="'+url+'"> '+match+"</a>"})),out=out.replace(emopattern,function(match){return'<img class="feed_emo" title="'+match+'" src="'+Emomapper[match]+'" />'}),window.emojiSupported||(out=out.replace(utfEmo,function(match){var hi,low,hex;return hi=match.charCodeAt(0),low=match.charCodeAt(1),hex=(1024*(hi-55296)+(low-56320)+65536).toString(16),'<u class="emo_list U_'+hex+'"></u>'})),1===flag&&(out=text),out},getTabId=function(){if(ThisTabId)return ThisTabId;var current,currentTopId=StorageFactory.getCookie("top");return currentTopId?(current=parseInt(currentTopId)+1,current>255&&(current=1)):current=1,ThisTabId=current,StorageFactory.setCookie("top",ThisTabId),current},getUniqueId=function(prefix){return prefix||(prefix=""),prefix+ThisTabId+$window.Math.floor($window.Math.random()*(new $window.Date).getTime())},hasEmoticon=function(text){var utfEmo=/\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g;return text?utfEmo.test(text)||emopattern.test(text):!1},getGoogleMapStaticUrl=function(lat,lng){var url="https://maps.googleapis.com/maps/api/staticmap?center={0},{1}&zoom=13&size=640x400&key={2}&markers=color:orange|{0},{1}";return url=url.format(lat,lng,APP_CONSTANTS.GOOGLE_MAP_KEY)},getGoogleMapJSUrl=function(lat,lng,location,embed){var url;return url=lat&&lng?"https://maps.google.com/maps?q={0},{1}&hl=es;z=14".format(lat,lng):"http://maps.google.com?q={0}".format(location),embed&&(url+="&output=embed"),url},_requestMultipleTime=function(func,args){var defer=$q.defer(),success=!1;return _callXTimeAfterYIntervalStopOnSuccess(function(){var response=func.apply(this,args);response.then?response.then(function(response){success=!0,defer.resolve(response)},function(response){success=!0,defer.reject(response)}):(defer.reject({sucs:!1,rc:"Invalid"}),RingLogger.alert("RequestMultipleTime Expect `func` as promise",RingLogger.tags.DEBUG))},function(){return success},function(){success||defer.reject({timeout:!0,sucs:!1})},5,3e3),defer.promise},animationDuration=500;return getTabId(),returnOb={generateUUID:generateUUID,getRingRoute:getRingRoute,getOGDetails:_getOGDetails,getReasoneMessage:_getReasonMessage,getReasonMessageFromResponse:_getReasonMessageFromResponse,debounce:_debounce,tabId:ThisTabId,getTabId:getTabId,animateScroll:_animateScroll,resetScroll:_resetScroll,viewport:viewportsize(),viewportsize:viewportsize,scrollbarWidth:getScrollBarWidth(),feedCellWidth:FeedCellWidth(),string2ArrayBuffer:_string2ArrayBuffer,arrayBuffer2String:_arrayBuffer2String,setFeedCellWidth:function(){returnOb.feedCellWidth=FeedCellWidth()},hasSocket:function(){return!0},parseForLE:function(text,flag){return textParseForLinkAndEmo(text,flag)},init:function(){},feedColumn:feedColumn,getDefaultColumn:getDefaultColumn,setFeedColumn:function(num){Storage.setCookie("col",parseInt(num))},getUniqueID:function(prefix){return getUniqueId(prefix)},getRandomString:function(length){for(var result="",chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=length;i>0;--i)result+=chars[Math.round(Math.random()*(chars.length-1))];return result},getToken:"234",chatVerbalDate:function(timestamp){return $filter("date")(timestamp,"h:mm a")},profileVerbalDate:function(timestamp){return $filter("date")(timestamp,"yyyy-MM-dd")},verbalDate:function(timestamp,fromTimeStamp){var date,diff,day_diff,Math=$window.Math;if(fromTimeStamp=fromTimeStamp||Date.now(),isNaN(timestamp)&&(date=new Date((timestamp||"").replace(/-/g,"/").replace(/[TZ]/g," ")),timestamp=date.getTime()),diff=(fromTimeStamp-timestamp)/1e3,day_diff=Math.floor(diff/86400),isNaN(day_diff))return"";switch(!0){case 1>day_diff:switch(!0){case 60>diff:return"just now";case 120>diff:return"1 minute ago";case 3600>diff:return Math.floor(diff/60)+" minutes ago";case 7200>diff:return"1 hour ago";case 86400>diff:return Math.floor(diff/3600)+" hours ago";default:return $filter("date")(timestamp,"MMM d, h:mm a")}break;case 1===day_diff:return"yesterday at "+$filter("date")(timestamp,"h:mm a");case 7>day_diff:return $filter("date")(timestamp,"EEEE 'at' h:mm a");case 365>day_diff:return $filter("date")(timestamp,"MMMM d yyyy 'at' h:mm a");default:return $filter("date")(timestamp,"MMM d, yyyy")}},getUserLocation:_getUserLocation,getImageUrlDimension:_getImageUrlDimension,filterImagesByDimentions:_filterImagesByDimentions,dataURLToBlob:_dataURLToBlob,callXTimeAfterYIntervalStopOnSuccess:_callXTimeAfterYIntervalStopOnSuccess,requestMultipleTime:_requestMultipleTime,triggerCustomEvent:_triggerCustomEvent,onCustomEvent:_onCustomEvent,removeCustomEvent:_removeCustomEvent,getSelection:getSelection,getGoogleMapStaticUrl:getGoogleMapStaticUrl,getGoogleMapJSUrl:getGoogleMapJSUrl,hasEmoticon:hasEmoticon,safeDigest:safeDigest}}var app;app=angular.module("ringid.utils"),app.factory("utilsFactory",utilsFactory),utilsFactory.$inject=["$window","$document","APP_CONSTANTS","settings","$filter","Storage","StickerEmoticonFactory","RING_ROUTES","MESSAGES","$ringhttp","$$q","Storage"]}(),function(){"use strict";function rgScroll(utilsFactory,$window){return function(scope,element,attr){var wEl=angular.element($window);wEl.bind("scroll",function(){requestAnimationFrame(function(){var newValue=utilsFactory.viewportsize();utilsFactory.viewport.x=newValue.x,utilsFactory.viewport.y=newValue.y,utilsFactory.viewport.yo=newValue.yo})})}}var app;app=angular.module("ringid.utils"),app.directive("rgKeyUp",function(){return function(scope,element,attr){function process(e){try{scope[attr.rgKeyUp](e)}catch(err){RingLogger.alert(err,"DEBUG")}}element.bind("keyup",process),scope.$on("$destroy",function(){element.unbind("keyup",process)})}}),app.directive("rgScroll",rgScroll),rgScroll.$inject=["utilsFactory","$window"]}(),function(){"use strict";function rgResize(utilsFactory,$window,$rootScope,SystemEvents){return function(scope,element,attr){var wEl=angular.element($window);wEl.bind("resize",function(){requestAnimationFrame(function(){var newValue=utilsFactory.viewportsize();$rootScope.windowHeight=newValue.y,$rootScope.windowWidth=newValue.x,utilsFactory.viewport.x=newValue.x,utilsFactory.viewport.y=newValue.y,utilsFactory.viewport.yo=newValue.yo,utilsFactory.setFeedCellWidth(),$rootScope.$broadcast(SystemEvents.COMMON.WINDOW_RESIZED,utilsFactory.viewport)})})}}var app;app=angular.module("ringid.utils"),app.directive("rgResize",rgResize),rgResize.$inject=["utilsFactory","$window","$rootScope","SystemEvents"]}(),function(){"use strict";function windowFocusHandler($window,utilsFactory,$$stackedMap){var fns=$$stackedMap.createNew(),process=function(){fns.doForAll(function(fn){fn.call(null)})};return $window.onfocus=process,{add:function(fn){var key=utilsFactory.getUniqueID();return fns.add(key,fn),key},remove:function(key){return fns.remove(key)},fire:function(){process()}}}function windowBlurHandler($window,utilsFactory,$$stackedMap){var fns=$$stackedMap.createNew(),process=function(){fns.doForAll(function(fn){fn.call(null)})};return $window.onblur=process,{add:function(fn){var key=utilsFactory.getUniqueID();return fns.add(key,fn),key},remove:function(key){return fns.remove(key)},fire:function(){process()}}}var app;app=angular.module("ringid.utils"),app.factory("windowFocusHandler",windowFocusHandler),windowFocusHandler.$inject=["$window","utilsFactory","$$stackedMap"],app.factory("windowBlurHandler",windowBlurHandler),windowBlurHandler.$inject=["$window","utilsFactory","$$stackedMap"]}(),function(){"use strict";function rgSynchar($$stackedMap,$rootScope,utilsFactory){var syncfns=$$stackedMap.createNew(),_synch=function(){syncfns.length()>0&&process()},process=function(){var scopeToDigest;syncfns.doForAll(function(fn){scopeToDigest=fn.call(null),scopeToDigest&&!scopeToDigest.$$phase&&scopeToDigest.$digest()})};return $rootScope.$on("ringActive",_synch),{add:function(fn){var key=utilsFactory.getUniqueID();return syncfns.add(key,fn),key},remove:function(key){return syncfns.remove(key)},synch:_synch}}angular.module("ringid.syncher",["ringid.common.stacked_map","ringid.utils"]).factory("$$rgsyncher",rgSynchar),rgSynchar.$inject=["$$stackedMap","$rootScope","utilsFactory"]}(),function(DataView,String){"use strict";angular.module("ringid.connector",["ngWebSocket","ringid.utils","ringid.config","ringid.common.stacked_map","ringid.syncher"])}(DataView,String),function(){"use strict";function RingParser(ATTRIBUTE_CODES,parserService){var ReturnObject,packetDataStorage={},ByteParsers={},parseHeader=function(dataViewObject,offset){var index,len,attribute,val,headerObject={};for(index=offset;index<dataViewObject.byteLength;){switch(attribute=dataViewObject.getUint16(index),index+=2,len=dataViewObject.getUint8(index++),val=dataViewObject.getIntByByte(index,len),attribute){case ATTRIBUTE_CODES.ACTION:headerObject.actn=val;break;case ATTRIBUTE_CODES.SERVER_PACKET_ID:headerObject.pckFs=val;break;case ATTRIBUTE_CODES.CLIENT_PACKET_ID:headerObject.pckId=dataViewObject.getString(index,len);break;case ATTRIBUTE_CODES.WEB_UNIQUE_KEY:break;case ATTRIBUTE_CODES.WEB_TAB_ID:headerObject.tabId=val;break;case ATTRIBUTE_CODES.AUTHIP:headerObject.authServer=dataViewObject.getString(index,len);break;case ATTRIBUTE_CODES.AUTHPORT:headerObject.comPort=val;break;case ATTRIBUTE_CODES.AUTH_E_USERNAME:headerObject.authEUsername=dataViewObject.getString(index,len);break;case ATTRIBUTE_CODES.AUTH_E_PASSWORD:headerObject.authEPassword=dataViewObject.getString(index,len);break;case ATTRIBUTE_CODES.AUTH_E_SALT:headerObject.authESalt=dataViewObject.getString(index,len);break;case ATTRIBUTE_CODES.TOTAL_PACKET:headerObject.total=val;break;case ATTRIBUTE_CODES.PACKET_NUMBER:headerObject.current=val;break;case ATTRIBUTE_CODES.UNIQUE_KEY:headerObject.key=val;break;default:return index-=3,headerObject.headerLength=index,headerObject}index+=len}return headerObject},parseBrokenPacketHeader=function(dataViewObject,offset){var index,len,attribute,val,headerObject={actn:0,pckFs:0,total:0,current:0,key:0};for(offset=offset||1,index=offset;index<dataViewObject.byteLength;){switch(attribute=dataViewObject.getUint8(index++),len=dataViewObject.getUint8(index++),val=dataViewObject.getIntByByte(index,len),attribute){case ATTRIBUTE_CODES.ACTION:headerObject.actn=val;break;case ATTRIBUTE_CODES.SERVER_PACKET_ID:headerObject.pckFs=val;break;case ATTRIBUTE_CODES.TOTAL_PACKET:headerObject.total=val;break;case ATTRIBUTE_CODES.PACKET_NUMBER:headerObject.current=val;break;case ATTRIBUTE_CODES.UNIQUE_KEY:headerObject.key=val;break;case ATTRIBUTE_CODES.DATA:index--,len=dataViewObject.getUint16(index),index+=2,headerObject.data=dataViewObject.copy(index,len);break;case ATTRIBUTE_CODES.WEB_UNIQUE_KEY:break;case ATTRIBUTE_CODES.WEB_TAB_ID:headerObject.tabId=val}index+=len}return headerObject},parse=function(DataViewObject){var packet_type,header,bp_header,return_data,full_packet;switch(packet_type=DataViewObject.getUint8(0)){case 0:case 2:if(header=parseHeader(DataViewObject,1),200===header.actn)return RingLogger.info(header.pckId,"ACKNWOLEDGED"),!1;if(0===packet_type){return_data=DataViewObject.getString(header.headerLength,DataViewObject.byteLength-header.headerLength);try{return_data=angular.fromJson(return_data),return_data=angular.extend({},header,return_data)}catch(e){return return_data=!1,!1}return return_data}return return_data=parserService.parseData(DataViewObject,header.headerLength),return_data?angular.extend({},header,return_data):!1;case 1:case 3:if(bp_header=parseBrokenPacketHeader(DataViewObject,1),RingLogger.print("join as data view should get called for byte broken data","Parser"),!bp_header.key)return!1;if(packetDataStorage[bp_header.key]?packetDataStorage[bp_header.key].packetLength++:(packetDataStorage[bp_header.key]=[],packetDataStorage[bp_header.key].packetLength=1),packetDataStorage[bp_header.key][bp_header.current]=bp_header.data,bp_header.total===packetDataStorage[bp_header.key].packetLength){if(full_packet=packetDataStorage[bp_header.key].joinAsDataView(),delete packetDataStorage[bp_header.key],header=parseHeader(full_packet,0),1===packet_type){return_data=full_packet.getString(header.headerLength,full_packet.byteLength-header.headerLength);try{return_data=angular.fromJson(return_data),return_data=angular.extend({},header,return_data)}catch(e){return return_data=!1,!1}return return_data}return return_data=parserService.parseData(full_packet,header.headerLength),return_data?angular.extend({},header,return_data):!1}return!1}};return ReturnObject={parse:function(viewob){return parse(viewob)},addParser:function(action,fn){ByteParsers[action]=fn}}}function parserService(OPERATION_TYPES,ATCODE,$$stackedMap){var self=this,attrMap=[];attrMap[ATCODE.SUCCESS]="sucs",attrMap[ATCODE.REASON_CODE]="reasonCode",attrMap[ATCODE.MESSAGE]="message",attrMap[ATCODE.TOTAL_PACKET]="totalPacket",attrMap[ATCODE.PACKET_NUMBER]="packetNo",attrMap[ATCODE.TOTAL_RECORDS]="totalRecord",attrMap[ATCODE.USER_TABLE_IDS]="utIds",attrMap[ATCODE.USER_ID]="utId",attrMap[ATCODE.USER_IDENTITY]="uId",attrMap[ATCODE.USER_NAME]="fn",attrMap[ATCODE.PROFILE_IMAGE]="prIm",attrMap[ATCODE.PROFILE_IMAGE_ID]="prImId",attrMap[ATCODE.UPDATE_TIME]="ut",attrMap[ATCODE.CONTACT_UPDATE_TIME]="cut",attrMap[ATCODE.CONTACT_TYPE]="ct",attrMap[ATCODE.NEW_CONTACT_TYPE]="nct",attrMap[ATCODE.DELETED]="deleted",attrMap[ATCODE.BLOCK_VALUE]="bv",attrMap[ATCODE.FRIENDSHIP_STATUS]="frnS",attrMap[ATCODE.CHANGE_REQUESTER]="changeRequester",attrMap[ATCODE.CONTACT]="contacts",attrMap[ATCODE.CALL_ACCESS]="cla",attrMap[ATCODE.CHAT_ACCESS]="chta",attrMap[ATCODE.FEED_ACCESS]="fda",attrMap[ATCODE.ANONYMOUS_CALL]="anc",attrMap[ATCODE.ADDED_TIME]="adt",attrMap[ATCODE.SESSION_ID]="sessionId",attrMap[ATCODE.MUTUAL_FRIEND_COUNT]="mutualFriends",self.parseData=function(dataView,offset){for(var attribute,length,Data={},index=offset;index<dataView.byteLength;){switch(attribute=dataView.getUint16(index),index+=2,length=0,attribute){case ATCODE.SUCCESS:length=dataView.getUint8(index++),Data[attrMap[attribute]]=dataView.getBool(index);break;case ATCODE.REASON_CODE:case ATCODE.TOTAL_PACKET:case ATCODE.PACKET_NUMBER:case ATCODE.TOTAL_RECORDS:case ATCODE.USER_ID:case ATCODE.PROFILE_IMAGE_ID:case ATCODE.UPDATE_TIME:case ATCODE.CONTACT_UPDATE_TIME:case ATCODE.CONTACT_TYPE:case ATCODE.NEW_CONTACT_TYPE:case ATCODE.DELETED:case ATCODE.BLOCK_VALUE:case ATCODE.FRIENDSHIP_STATUS:case ATCODE.CHANGE_REQUESTER:case ATCODE.MUTUAL_FRIEND_COUNT:case ATCODE.CALL_ACCESS:case ATCODE.CHAT_ACCESS:case ATCODE.FEED_ACCESS:case ATCODE.ADDED_TIME:length=dataView.getUint8(index++),Data[attrMap[attribute]]=dataView.getIntByByte(index,length);break;case ATCODE.MESSAGE:case ATCODE.USER_NAME:case ATCODE.USER_IDENTITY:case ATCODE.PROFILE_IMAGE:case ATCODE.SESSION_ID:case ATCODE.ADDED_TIME:length=dataView.getUint8(index++),Data[attrMap[attribute]]=dataView.getString(index,length);break;case ATCODE.USER_TABLE_IDS:length=dataView.getUint16(index),index+=2,Data[attrMap[attribute]]=[];for(var utId,contactType,matchBy,frnS,i=index;index+length>i;)utId=dataView.getIntByByte(i,8),i+=8,contactType=dataView.getUint8(i++),matchBy=dataView.getUint8(i++),frnS=dataView.getUint8(i++),Data[attrMap[attribute]].push({key:utId,value:{ct:contactType,mb:matchBy,frnS:frnS}});break;case ATCODE.CONTACT:length=dataView.getUint16(index),index+=2,angular.isArray(Data[attrMap[attribute]])||(Data[attrMap[attribute]]=[]),Data[attrMap[attribute]].push(self.parseData(dataView.copy(index,length),0));break;default:length=dataView.getUint8(index++)}index+=length}return Data}}function mergerService($q){var ob={defer:function(){var defer=$q.defer(),PACKET_DATA={};return{resolve:function(json){var key,seperatorPos,pack_no,pack_count;if(RingLogger.print(json,"Merger"),json.seq||json.totalPacket){if(key=json.pckId,PACKET_DATA[json.pckId]||(PACKET_DATA[json.pckId]=[]),defer.notify(json),json.seq?(seperatorPos=json.seq.lastIndexOf("/"),pack_no=json.seq.substr(0,seperatorPos),pack_count=json.seq.substr(seperatorPos+1,json.seq.length)):(pack_no=json.packetNo,pack_count=json.totalPacket),PACKET_DATA[json.pckId]["sq"+pack_no])return;if(PACKET_DATA[json.pckId]["sq"+pack_no]=!0,PACKET_DATA[json.pckId].push(json),pack_count!=PACKET_DATA[json.pckId].length)return!0;for(var obj={},i=0;i<PACKET_DATA[json.pckId].length;i++)for(key in PACKET_DATA[json.pckId][i])PACKET_DATA[json.pckId][i][key]instanceof Array?obj[key]=(obj[key]||[]).concat(PACKET_DATA[json.pckId][i][key]):obj[key]=PACKET_DATA[json.pckId][i][key];defer.resolve(obj),delete PACKET_DATA[json.pckId]}else defer.resolve(json)},promise:defer.promise}}};return ob}angular.module("ringid.connector").factory("RingParser",RingParser).service("parserService",parserService).service("mergerService",mergerService),RingParser.$inject=["ATTRIBUTE_CODES","parserService"],parserService.$inject=["OPERATION_TYPES","ATTRIBUTE_CODES","$$stackedMap"],mergerService.$inject=["$$q"]}(),function(DataView){"use strict";function $$connector(settings,RingParser,Storage,$rootScope,$websocket,$$stackedMap,ATTRIBUTE_CODES,utilsFactory,$q,OPERATION_TYPES,CLIENT_DATA_SIZE,mergerService){function getMessageFilterByActionNumber(action_number){return function(message){if(!message||!message.actn)return!1;if(!angular.isArray(action_number))return message.actn===action_number;for(var i=0;i<action_number.length;i++)if(message.actn===action_number[i])return!0;return!1}}function parseMessageData(DataViewObject){return DataViewObject?RingParser.parse(DataViewObject):{}}function resolvePendingRequest(message){if(deferToBeResolved[message.pckId]===!0)return!0;if(deferToBeResolved[message.pckId]){var a=deferToBeResolved[message.pckId].resolve.call(deferToBeResolved[message.pckId],message);return a||(deferToBeResolved[message.pckId]=!!a,setTimeout(function(){delete deferToBeResolved[message.pckId]},3e3)),!0}return!1}function broadcastUpdates(message){var foundSubscriber=!1;return subscribers.length()>0&&(subscribers.doForAll(function(currentCallBackObject){var should_call_with,pattern=currentCallBackObject.filter;pattern?angular.isFunction(pattern)&&(should_call_with=pattern.call(null,message),should_call_with&&(foundSubscriber=!0,currentCallBackObject.fn.call(currentCallBackObject,message))):(currentCallBackObject.fn.call(null,message),RingLogger.print("No Filter Found",currentCallBackObject,RingLogger.tags.CONNECTION))}),foundSubscriber||RingLogger.print("Not Found Subscriber For",message,RingLogger.tags.CONNECTION)),foundSubscriber}function processOnMessageListners(json){if(json){var MadeRquest,resolved;if(json.actn===OPERATION_TYPES.SYSTEM.AUTH.TYPE_INVALID_LOGIN_SESSION)return void broadcastUpdates(json);if(json.hasOwnProperty("pckId")&&(MadeRquest=resolvePendingRequest(json)),json.hasOwnProperty("pckFs")){var pack=json.pckFs;resolvedPacket[pack]||(broadcastUpdates(json),resolvedPacket[pack]=!0)}else MadeRquest||(resolved=broadcastUpdates(json),resolved||UnresolvedData.push(json))}}function MainOnMessageHandler(message){var DataViewObject;try{if(DataViewObject=new DataView(message.data||message),!DataViewObject.byteLength)throw new Error("Byte Length of Zero")}catch(e){return void RingLogger.err("Invalid Array Buffer to Parse : "+e.message,RingLogger.tags.RECEIVED)}message=parseMessageData(DataViewObject),RingLogger.information(angular.toJson(message),RingLogger.tags.RECEIVED),processOnMessageListners(message)}function getKeepAlivePacket(){var sess=Storage.getCookie("sId")||"",index=2;if(!sess.length)return!1;var dataTosend=new ArrayBuffer(sess.length+2),dataview=new DataView(dataTosend);return dataview.setUint8(0,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.KEEP_ALIVE),dataview.setUint8(1,0),angular.forEach(sess.toCharCodeArray(),function(val){dataview.setUint8(index++,val)}),dataview}function init(){if(angular.isObject(socket))return void(socket.isOpen()||0===socket.readyState||socket.reconnect());if(!utilsFactory.hasSocket())return void alert("Your browser seem back dated. To use RingId with greater user experience we advice you to use modern browser. ");try{if(socket=$websocket(settings.socketProtocol+settings.siteUrl+"/DataSocket/"+utilsFactory.tabId),!1===socket)return;socket.onError(function(e){ga("send","event","Socket","Socket Failed: "+JSON.stringify(e),"Browser OS "+navigator.userAgent||"Unknown Browser"),reconnectCountError>2?$rootScope.$broadcast("CONNECTION_ERROR"):reconnectCountError++}),socket.onOpen(function(){Storage.removeCookie("reloaded"),sendQueue.length&&send()}),socket.onClose(function(e){RingLogger.print("SOCKET CLOSED : ",e,RingLogger.tags.CONNECTION)}),window.onbeforeunload=function(){return RingLogger.print("On before unload connection closed",RingLogger.tags.CONNECTION),$rootScope.unloadWarn?"You have unsaved changes.  Do you want to leave this page and lose your changes?":void closeConnection()}}catch(e){RingLogger.alert("CONNECTION_ERROR"+e.message,RingLogger.tags.CONNECTION)}socket.onMessage(MainOnMessageHandler,{})}function initInterval(){var kpPacket=getKeepAlivePacket();kpPacket&&(kpPacket.keepalive=!0,keepAliveSender=window.setInterval(function(kpPacket){return processIntervals(),kpPacket?void send(kpPacket):void stopInterVal()}.bind(null,kpPacket),5e3))}function connectionReset(){stopInterVal(),socket.close(),socket=null,stopSending=!0,init(),stopSending=!1,keepAlive&&initInterval()}function closeConnection(){keepAliveSender&&window.clearInterval(keepAliveSender),socket.isOpen()?socket.close():0===socket.socket.readyState&&socket.onOpen(function(){socket.close()})}function stopInterVal(){window.clearInterval(keepAliveSender)}function sendBrokenPacket(request_type,messageViewArray,data,packetId){var hi,i,full_packet,packet_end,header,headbuf,now,packets=[],headerLength=129,packet_start=0,len=messageViewArray.byteLength,last_sent=Date.now(),sId=Storage.getCookie("sId"),totalPacket=Math.ceil(len/CLIENT_DATA_SIZE),uniqueKey=(CurrentuId||"")+utilsFactory.tabId+utilsFactory.getUniqueID().toString(),glu=128>totalPacket?1:2;for(i=0;totalPacket>i;i++)packet_end=CLIENT_DATA_SIZE*(i+1)-1,packet_end>len&&(packet_end=len-1),headbuf=new ArrayBuffer(headerLength+(packet_end-packet_start+1)),header=new DataView(headbuf),header.setUint8(0,request_type),header.setUint8(1,1),hi=2,data.actn&&(hi=header.addAttributeInt(hi,ATTRIBUTE_CODES.ACTION,2,data.actn)),packetId&&(packetId=packetId.toString(),hi=header.addAttributeString(hi,ATTRIBUTE_CODES.CLIENT_PACKET_ID,packetId)),hi=header.addAttributeInt(hi,ATTRIBUTE_CODES.TOTAL_PACKET,glu,totalPacket),hi=header.addAttributeInt(hi,ATTRIBUTE_CODES.PACKET_NUMBER,glu,i),hi=header.addAttributeInt(hi,ATTRIBUTE_CODES.WEB_TAB_ID,1,utilsFactory.tabId),hi=header.addAttributeString(hi,ATTRIBUTE_CODES.UNIQUE_KEY,uniqueKey),sId&&(hi=header.addAttributeString(hi,ATTRIBUTE_CODES.WEB_UNIQUE_KEY,sId)),hi=header.addAttributeData(hi,ATTRIBUTE_CODES.DATA,messageViewArray,packet_start,packet_end-packet_start+1),packet_start=packet_end+1,full_packet=header.copy(0,hi),packets.push(full_packet);var sendPacket=function sendPackInner(){for(;packets.length;){var pack;if(now=Date.now(),!(now-last_sent>=180))return void setTimeout(sendPackInner,180);pack=packets.shift(),send(pack),last_sent=now}};return sendPacket(),!1}function changeMessageToByte(message,packetType,request_type){angular.isString(message)||(message=angular.toJson(message));var buffer,messageViewArray,index=0,len=packetType?message.length:message.length+2;return buffer=new ArrayBuffer(len),messageViewArray=new DataView(buffer),packetType||(messageViewArray.setUint8(index++,request_type),messageViewArray.setUint8(index++,0)),message.length&&angular.forEach(message.toCharCodeArray(),function(val){messageViewArray.setUint8(index++,val)}),messageViewArray}function buildPacketToSend(packetId,data,request_type){var message,messageViewArray,sId=Storage.getCookie("sId");return data=data||{},data.pckId=packetId,sId&&(data.sId=sId),data.tbid=utilsFactory.tabId,data.dvc=5,message=angular.toJson(data),message.length+2>CLIENT_DATA_SIZE&&23!==data.actn&&25!==data.actn&&3!==request_type?(messageViewArray=changeMessageToByte(message,1,request_type),sendBrokenPacket(request_type,messageViewArray,data,packetId)):changeMessageToByte(message,0,request_type)}function sendData(data,request_type,defer){var message,packetId;return packetId=data.pckId||utilsFactory.getUniqueID(),message=buildPacketToSend(packetId,data,request_type),defer&&(deferToBeResolved[packetId]=defer),message?send(message,request_type===OPERATION_TYPES.SYSTEM.REQUEST_TYPE.AUTHENTICATION):void 0}function initDeferRequest(data,request_type,mergeData){var res,defer=mergeData?mergerService.defer():$q.defer();return res=sendData(data,request_type,defer),defer.promise}function initDeferRequestSafeMode(data,request_type,mergeData){var defer=mergeData?mergerService.defer():$q.defer();return floodingData[data.actn]||(floodingData[data.actn]=[]),floodingData[data.actn].push(sendData.bind(null,data,request_type,defer)),floodingDataInterval||(floodingDataInterval=setInterval(processSafeModeSender,300)),defer.promise}function processSafeModeSender(){var actn,fn,floodingFlag=!1;for(actn in floodingData)floodingData.hasOwnProperty(actn)&&floodingData[actn].length&&(fn=floodingData[actn].shift(),fn.call(),floodingData[actn].length?floodingFlag=!0:delete floodingData[actn]);!floodingFlag&&floodingDataInterval&&(clearInterval(floodingDataInterval),floodingDataInterval=angular.noop())}function processIntervals(){intervalFunctions.doForAll(function(f){f.call(null)})}var ObjectToBeReturn,socket,keepAliveSender,floodingDataInterval,CurrentuId=(Storage.getCookie("sessionID"),Storage.getCookie("uId")),deferToBeResolved={},resolvedPacket={},stopSending=!1,sendQueue=[],lastSendingTime=Date.now(),keepAlive=!1,subscribers=$$stackedMap.createNew(),floodingData={},reconnectCountError=0,UnresolvedData=[],intervalFunctions=$$stackedMap.createNew(),send=function(data,force){if(data&&sendQueue.push(data),(!stopSending||force)&&0!==socket.socket.readyState){if(!socket.isOpen()&&0!==socket.socket.readyState)return void socket.reconnect();for(;sendQueue.length;){var now=Date.now(),timediff=now-lastSendingTime,tempdata=sendQueue.shift();RingLogger.information("socket state :"+socket.socket.readyState+" time diff : "+timediff/1e3,RingLogger.tags.CONNECTION),RingLogger.infoblack(tempdata.print_r("return"),tempdata.keepalive?RingLogger.tags.KEEPALIVE:RingLogger.tags.SEND),socket.send(tempdata),lastSendingTime=now}}};return ObjectToBeReturn={init:init,close:closeConnection,send:function(data,request_type){sendData(data,request_type)},request:function(data,request_type,flooding){return flooding?initDeferRequestSafeMode(data,request_type):initDeferRequest(data,request_type)},pull:function(data,request_type,flooding){return flooding?initDeferRequestSafeMode(data,request_type,!0):initDeferRequest(data,request_type,!0)},subscribe:function(callback,options){var i,should_call_with,backUp=[];if(options=options||{},options.key=options.key||utilsFactory.getUniqueID(),options.scope=options.scope||$rootScope,options.autoApply=!1,options.fn=callback||angular.noop,!options.filter&&options.action&&(options.filter=getMessageFilterByActionNumber(options.action)),subscribers.add(options.key,options),options.callWithUnresolved){for(i=0;i<UnresolvedData.length;i++)should_call_with=options.filter.call(null,UnresolvedData[i]),should_call_with?options.fn.call(null,UnresolvedData[i]):backUp.push(UnresolvedData[i]);UnresolvedData.length=0,UnresolvedData=backUp}return options.key},unsubscribe:function(key){subscribers.remove(key)},stop:function(){stopSending=!0},resume:function(){stopSending=!1,socket.isOpen()||0===socket.socket.readyState||socket.reconnect(),send()},reset:function(){connectionReset(),send()},addInterval:function(func){var key=utilsFactory.getUniqueID();return intervalFunctions.add(key,func),key},removeInterval:function(key){intervalFunctions.remove(key)},keepAlive:function(){keepAlive=!0,initInterval()}},$rootScope.$on("ringInactive",function(event){}),$rootScope.$on("$locationChangeStart",function(event){}),ObjectToBeReturn}angular.module("ringid.connector").factory("$$connector",$$connector),$$connector.$inject=["settings","RingParser","Storage","$rootScope","$websocket","$$stackedMap","ATTRIBUTE_CODES","utilsFactory","$$q","OPERATION_TYPES","CLIENT_DATA_SIZE","mergerService"]}(DataView),function(DataView){"use strict";function mediaMetadata($q,Ringalert,utilsFactory){function fetchVideoMeta(thisVideo){var thumb={drtn:Math.floor(thisVideo.duration),tiw:thisVideo.videoHeight,tih:thisVideo.videoWidth,artst:"",ttl:thisVideo.nameFromFile.substr(0,thisVideo.nameFromFile.lastIndexOf("."))||thisVideo.nameFromFile};window.URL.revokeObjectURL(thisVideo.src),thisVideo.deferObj.resolve(thumb)}function parseFrameLegacy(buffer){var encoding,dv=new DataView(buffer),result={tag:null,value:null},header={id:dv.getString(0,3),type:dv.getString(0,1),size:dv.getUint24(3)};if(RingLogger.print(header,RingLogger.tags.UPLOAD),!(header.id in frameTypes))return!1;if(result.tag=frameTypes[header.id],"T"===header.type)encoding=dv.getUint8(7),RingLogger.information("encoding: "+encoding,RingLogger.tags.UPLOAD),result.value=dv.getString(7,dv.byteLength-7);else if("PIC"===header.id){encoding=dv.getUint8(6);var image={type:null,mime:"image/"+dv.getString(7,3).toLowerCase(),description:null,data:null};image.type=frameImageTypes[dv.getUint8(11)]||"other";for(var variableStart=11,variableLength=0,i=variableStart;;i++)if(0===dv.getUint8(i)){variableLength=i-variableStart;break}image.description=0===variableLength?null:dv.getString(variableStart,variableLength),result.value=new Blob(new Uint8Array(buffer.slice(variableStart+1)),{type:image.mime})}return result.tag?result:!1}function parseFrame(buffer,major,minor){if(minor=minor||0,major=major||4,3>major)return parseFrameLegacy(buffer);var encoding,dv=new DataView(buffer),result={tag:null,value:null},header={id:dv.getString(0,4),type:dv.getString(0,1),size:dv.getSynch(dv.getUint32(4)),
flags:[dv.getUint8(8),dv.getUint8(9)]};if(RingLogger.print(header,RingLogger.tags.UPLOAD),0!==header.flags[0]||!(header.id in frameTypes))return!1;if(result.tag=frameTypes[header.id],"T"===header.type)if(encoding=dv.getUint8(10),0===encoding||3===encoding)result.value=dv.getString(11,dv.byteLength-11);else if(1===encoding)result.value=dv.getStringUtf16(-11,11,!0);else{if(2!==encoding)return!1;result.value=dv.getStringUtf16(-11,11)}else if("APIC"===header.id){encoding=dv.getUint8(10);for(var image={type:null,mime:null,description:null,data:null},variableStart=11,variableLength=0,i=variableStart;;i++)if(0===dv.getUint8(i)){variableLength=i-variableStart;break}image.mime=dv.getString(variableStart,variableLength),image.type=frameImageTypes[dv.getUint8(variableStart+variableLength+1)]||"other",variableStart+=variableLength+2,variableLength=0;for(var i=variableStart;;i++)if(0===dv.getUint8(i)){variableLength=i-variableStart;break}image.description=0===variableLength?null:dv.getString(variableStart,variableLength),result.value=new Blob(new Uint8Array(buffer.slice(variableStart+1)),{type:image.mime})}return result.tag?result:!1}function readID3Tags(buffer,meta){var tagVersion,tagFlags,dv=new DataView(buffer),metaV2={},tagSize=0,headerSize=10,offset=dv.byteLength-128;if("TAG"===dv.getString(offset,3)?(offset+=3,meta.ttl=dv.getString(offset,30).trim()||null,offset+=30,meta.artst=dv.getString(offset,30).trim()||null):RingLogger.warning("ID3V1 MISSING",RingLogger.tags.UPLOAD),tagVersion=dv.getUint8(3),tagFlags=dv.getUint8(5),tagSize+=dv.getSynch(dv.getUint32(6)),RingLogger.information("tagVersion: "+tagVersion,RingLogger.tags.UPLOAD),RingLogger.information("tagFlags: "+tagFlags,RingLogger.tags.UPLOAD),tagSize>dv.byteLength||"ID3"!==dv.getString(0,3)||tagVersion>4||0!==(128&tagFlags))RingLogger.information("NO ID3V2 TAG",RingLogger.tags.UPLOAD);else for(0!==(64&tagFlags)&&(headerSize+=dv.getSynch(dv.getUint32(11)));tagSize>headerSize;){RingLogger.information("headerSize: "+headerSize,RingLogger.tags.UPLOAD),RingLogger.information("tagSize: "+tagSize,RingLogger.tags.UPLOAD);for(var frame,slice,frameBit,isFrame=!0,i=0;3>i;i++)frameBit=dv.getUint8(headerSize+i),(65>frameBit||frameBit>90)&&(48>frameBit||frameBit>57)&&(isFrame=!1);if(!isFrame){RingLogger.warning("NO FRAME FOUND FOR MP3",RingLogger.tags.UPLOAD);break}slice=3>tagVersion?buffer.slice(headerSize,headerSize+6+dv.getUint24(headerSize+3)):buffer.slice(headerSize,headerSize+10+dv.getSynch(dv.getUint32(headerSize+4))),frame=parseFrame(slice,tagVersion),RingLogger.print(frame,RingLogger.tags.UPLOAD),frame&&(metaV2[frame.tag]=frame.value),headerSize+=slice.byteLength}meta.ttl=metaV2.title||meta.ttl||"",meta.artst=metaV2.artist||metaV2["original-artist"]||meta.artst||""}function fetchAudioMeta(){var thisAudio=this,meta={drtn:Math.floor(thisAudio.duration),tiw:0,tih:0,artst:"",ttl:thisAudio.nameFromFile.substr(0,thisAudio.nameFromFile.lastIndexOf("."))||thisAudio.nameFromFile,thmbURL:""};RingLogger.log(meta,RingLogger.tags.MEDIA);var reader=new FileReader;reader.onload=function(){readID3Tags(this.result,meta),RingLogger.print(meta,RingLogger.tags.UPLOAD),thisAudio.deferObj.resolve(meta)},reader.readAsArrayBuffer(thisAudio.fileObj)}function errorHandler(cause){RingLogger.error(cause,RingLogger.tags.MEDIA),this.deferObj.reject()}var self=this;self.generateMeta=function(uploadFile,mediaType){var mediaElement,defer=$q.defer();return"audio"===mediaType?(mediaElement=document.createElement("audio"),mediaElement.addEventListener("loadeddata",fetchAudioMeta),mediaElement.fileObj=uploadFile):(mediaElement=document.createElement("video"),mediaElement.addEventListener("loadeddata",function(){function fetchMeta(){mediaElement.removeEventListener("timeupdate",fetchMeta),fetchVideoMeta(thisVideo)}var thisVideo=this;thisVideo.currentTime=thisVideo.duration>20?10:thisVideo.duration/2,mediaElement.addEventListener("timeupdate",fetchMeta)})),mediaElement.deferObj=defer,mediaElement.nameFromFile=uploadFile.name,mediaElement.addEventListener("onerror",errorHandler),mediaElement.src=window.URL.createObjectURL(uploadFile),defer.promise}}var frameTypes={TIT2:"title",TOPE:"original-artist",TPE1:"artist",TOA:"original-artist",TP1:"artist",TT2:"title",APIC:"image",PIC:"image"},frameImageTypes=["other","file-icon","icon","cover-front","cover-back","leaflet","media","artist-lead","artist","conductor","band","composer","writer","location","during-recording","during-performance","screen","fish","illustration","logo-band","logo-publisher"];angular.module("ringid.common.media_metadata_service",["ringid.utils"]).service("mediaMetadata",mediaMetadata),mediaMetadata.$inject=["$$q","Ringalert","utilsFactory"]}(DataView),function(){"use strict";function fileUploadService($q,StorageFactory,settings,$rootScope,SystemEvents,Ringalert,utilsFactory,$ringhttp,imageQuality,mediaMetadata){function getByteResponse(xhrResponse){var success,response,responseLength,DataViewObject=new DataView(xhrResponse);return DataViewObject.byteLength?(success=DataViewObject.getBool(0),success===!1?(responseLength=DataViewObject.getUint8(1),response={sucs:!1,mg:DataViewObject.getString(2,responseLength)}):success===!0&&(responseLength=DataViewObject.getUint8(1),response={sucs:!0,url:DataViewObject.getString(2,responseLength)})):(response={sucs:!1,mg:"Failed. Response unreadable"},response={sucs:!1,mg:"Failed. Response unreadable"}),response}function UploadFile(uploadType,file,safeDigest){function onProgress(progress){fileObj.progressVal=progress,"coverphoto"!==fileObj.uploadType&&"profilephoto"!==fileObj.uploadType||(self.progress=fileObj.progressVal),$rootScope.$broadcast(SystemEvents.FILE_UPLOAD.PROGRESS_UPDATE),safeDigest()}function deleteGarbage(){delete fileObj.file}function onLoad(responseData){var response;switch(fileObj.uploadType){case"chatimage":response=getByteResponse(responseData),response.sucs===!0&&(response.url=response.url),self.uploadProgress=!1,angular.extend(response,fileObj.meta||{});break;case"tagchatimage":response=angular.fromJson(responseData),response.sucs===!0&&(response.url=response.iurl),self.uploadProgress=!1,angular.extend(response,fileObj.meta||{});break;case"video":response=getByteResponse(responseData),fileObj.meta.thmbURL=response.url?response.url.substr(0,response.url.lastIndexOf("."))+".jpg":"",fileObj.previewUrl=response.url?settings.mediaBase+fileObj.meta.thmbURL:"";break;case"audio":response=getByteResponse(responseData);break;case"coverphoto":case"profilephoto":response=angular.fromJson(responseData),response.ih=fileObj.meta.ih,response.iw=fileObj.meta.iw,self.uploadProgress=!1;break;case"image":response=angular.fromJson(responseData),fileObj.previewUrl=response.iurl?settings.imBase+response.iurl.substr(0,response.iurl.lastIndexOf("/")+1)+"pthumb"+response.iurl.substr(response.iurl.lastIndexOf("/")+1):"";break;case"thumb":response=getByteResponse(responseData);break;default:response=angular.fromJson(responseData)}fileObj.response=angular.extend({},fileObj.response,response),response.sucs===!0?fileObj.uploadComplete=!0:fileObj.uploadFail=!0,RingLogger.print(angular.toJson(response),RingLogger.tags.UPLOAD),response.sucs!==!0&&Ringalert.show(response.mg||"Failed","error"),deferred.resolve(response),deleteGarbage()}function onAbort(){safeDigest(),deferred.reject()}function onError(response){response&&response.mg&&Ringalert.show(response.mg,"error"),deferred.reject()}function fetchMeta(callBack){switch(fileObj.fileType){case"video":case"audio":mediaMetadata.generateMeta(fileObj.file,fileObj.fileType).then(function(meta){fileObj.meta=meta,callBack({success:!0}),safeDigest()},function(errMsg){Ringalert(errMsg,"error"),fileObj.uploadFail=!0,deferred?deferred.reject(errMsg):callBack({success:!1,message:errMsg}),safeDigest()});break;case"image":imageQuality.resizeImage(fileObj.file,fileObj.uploadType).then(function(meta){fileObj.file=meta.file,fileObj.meta.ih=meta.ih,fileObj.meta.iw=meta.iw,fileObj.previewUrl=meta.previewUrl,callBack({success:!0}),safeDigest()},function(errMsg){fileObj.uploadFail=!0,deferred?(Ringalert.show(errMsg,"error"),deferred.reject(errMsg)):callBack({success:!1,message:errMsg}),safeDigest()})}fileObj.gotMeta=!0,safeDigest()}var deferred,uploadPath="",fileObj={uniqueId:utilsFactory.getUniqueID(),uploadType:uploadType,file:file||null,fileType:file.type?file.type.substr(0,file.type.indexOf("/")):"image",response:{url:""},meta:{ttl:"status"!==uploadType&&"image"!==uploadType&&file.name?file.name.substr(0,file.name.lastIndexOf("."))||file.name:""},gotMeta:!1,previewUrl:"",progressVal:0,queued:!1,uploadComplete:!1,uploadFail:!1};return fileObj.previewUrl=settings.baseUrl+"images/"+fileObj.fileType+"-preview.jpg","profilephoto"!==uploadType&&"coverphoto"!==uploadType||(fileObj.repositionD={ih:0,iw:0,cimX:0,cimY:0}),{getKey:function(){return fileObj.uniqueId},setRepositionData:function(obj){RingLogger.information("Set Reposition to : "+angular.toJson(obj),RingLogger.tags.UPLOAD),fileObj.repositionD=angular.extend({},fileObj.repositionD||{},obj)},getRepositionData:function(){return"profilephoto"===fileObj.uploadType?{pimX:fileObj.repositionD.cimX,pimY:fileObj.repositionD.cimY}:{cimX:fileObj.repositionD.cimX,cimY:fileObj.repositionD.cimY}},getFile:function(){return fileObj.file},getName:function(){return fileObj.file.name},fetchMeta:fetchMeta,initUpload:function(){function sendFile(){"coverphoto"!==fileObj.uploadType&&"profilephoto"!==fileObj.uploadType||Object.keys(fileObj.repositionD).forEach(function(key){formData.append(key,fileObj.repositionD[key])}),formData.append("file",fileObj.file,fileObj.file.name||"imagefile.jpg"),fileObj.xhr=$ringhttp.post(uploadPath,formData,responseType).success(onLoad).error(onError).progress(onProgress).abort(onAbort)}var formData=new FormData,responseType="text";switch(deferred=$q.defer(),fileObj.queued=!0,formData.append("sId",StorageFactory.getCookie("sId")),formData.append("uId",StorageFactory.getCookie("uId")),formData.append("authServer",StorageFactory.getCookie("authServer")),formData.append("comPort",StorageFactory.getCookie("comPort")),formData.append("x-app-version",settings.apiVersion),fileObj.uploadType){case"profilephoto":uploadPath=settings.imServer+"ImageUploadHandler";break;case"coverphoto":uploadPath=settings.imServer+"CoverImageUploadHandler";break;case"tagchatimage":uploadPath=settings.imServer+"GroupContentHandler";break;case"chatimage":uploadPath=settings.imServer+"ChatImageHandler",responseType="arraybuffer";break;case"image":uploadPath=settings.imServer+"AlbumImageUploadHandler";break;case"video":uploadPath=settings.mediaServer+"Mp4UploadHandler",responseType="arraybuffer";break;case"audio":uploadPath=settings.mediaServer+"Mp3UploadHandler",responseType="arraybuffer";break;case"thumb":uploadPath=settings.mediaServer+"ThumbImageHandler",responseType="arraybuffer",fileObj.gotMeta=!0;break;default:RingLogger.warning("Can not Determine File upload Path: "+uploadType,RingLogger.tags.UPLOAD)}return fileObj.gotMeta?sendFile():fetchMeta(sendFile),deferred.promise},cptn:function(newCaption){return arguments.length?fileObj.meta.ttl=newCaption:fileObj.meta.ttl},getPreview:function(){return fileObj.previewUrl},cancelUpload:function(){fileObj.uploadFail=!0,fileObj.xhr?fileObj.xhr.abortRequest():fileObj.deferred&&fileObj.deferred.reject()},setPreview:function(previewUrl){fileObj.previewUrl=previewUrl},getProgress:function(){return fileObj.progressVal},uploadCompleted:function(){return fileObj.uploadComplete},uploadFailed:function(){return fileObj.uploadFail},getQueued:function(){return fileObj.queued},setQueued:function(bool){fileObj.queued=bool||!0},setMeta:function(metaObj){fileObj.meta=metaObj},getMeta:function(){return fileObj.hasOwnProperty("meta")?fileObj.meta:!1},getAuthData:function(addTagList){var returnObj={};switch(fileObj.fileType){case"image":returnObj={ih:fileObj.meta.ih,iw:fileObj.meta.iw,iurl:fileObj.response.iurl,cptn:fileObj.meta.ttl.utf8Encode()};break;case"video":case"audio":if(returnObj={strmURL:fileObj.response.url,tiw:fileObj.meta.tiw,tih:fileObj.meta.tih,drtn:fileObj.meta.drtn,thmbURL:fileObj.meta.thmbURL,artst:fileObj.meta.artst.utf8Encode(),ttl:fileObj.meta.ttl.utf8Encode()},addTagList){for(var i=0;i<self.tagList.length;i++)self.tagList[i].sk=self.tagList[i].sk.utf8Encode();returnObj.htgLst=self.tagList}break;default:returnObj=fileObj.response,RingLogger.warning("File type for getAuthData did not match: "+fileObj.fileType)}return returnObj}}}function safeDigest(){var digestScope;for(var key in SCOPES)SCOPES.hasOwnProperty(key)&&(digestScope=SCOPES[key],digestScope&&digestScope.$id&&!digestScope.$$destroyed&&digestScope.$rgDigest())}var SCOPES={},self=this,_albumId=-1;self.resetUpload=function(){self.progress=0,self.tagList=[],self.uploadProgress=!1,self.profileImageFile=null,self.coverImageFile=null,self.imageFiles=[],self.videoFiles=[],self.audioFiles=[],self.chatImageFiles={},self.selectFromAlbum=!1},self.resetUpload(),self.createUploadFile=function(uploadType,obj){return new UploadFile(uploadType,obj,safeDigest)},self.statusMediaCount=function(uploadWhat){return uploadWhat?self[uploadWhat+"Files"].length:0},self.setUploadAlbum=function(albumId){_albumId=albumId},self.getUploadAlbum=function(){return _albumId},self.queueFile=function(uploadType,fileObj){switch(uploadType){case"profilephoto":return RingLogger.information("PROFILE UPLOAD FILE QUEEUD",RingLogger.tags.UPLOAD),self.progress=0,self.profileImageFile=new UploadFile(uploadType,fileObj,safeDigest),self.profileImageFile;case"coverphoto":return RingLogger.information("COVER UPLOAD FILE QUEEUD",RingLogger.tags.UPLOAD),self.progress=0,self.coverImageFile=new UploadFile(uploadType,fileObj,safeDigest),self.coverImageFile;case"tagchatimage":case"chatimage":return new UploadFile(uploadType,fileObj,safeDigest);case"image":self.imageFiles.push(new UploadFile(uploadType,fileObj,safeDigest));break;case"video":self.videoFiles.push(new UploadFile(uploadType,fileObj,safeDigest));break;case"audio":self.audioFiles.push(new UploadFile(uploadType,fileObj,safeDigest));break;default:RingLogger.warning("Could not queu file. uploadType did not match: "+uploadType,RingLogger.tags.UPLOAD)}safeDigest()},self.setReposition=function(dimension,uploadType){"coverphoto"===uploadType?self.coverImageFile.setRepositionData(dimension):"profilephoto"===uploadType?self.profileImageFile.setRepositionData(dimension):RingLogger.warning("UPLOADTYPE: "+uploadType,RingLogger.tags.UPLOAD)},self.getReposition=function(uploadType){return"coverphoto"===uploadType?self.coverImageFile.getRepositionData():"profilephoto"===uploadType?self.profileImageFile.getRepositionData():(RingLogger.warning("UPLOADTYPE: "+uploadType,RingLogger.tags.UPLOAD),{})},self.uploadQueue=function(uploadType,startIndex){function removeFailed(startFromZero){for(var start=startFromZero?0:startIndex,removeCounter=0,i=start,l=self[whichFiles].length;l>i;i++)self[whichFiles][i]&&self[whichFiles][i].uploadFailed()&&(self[whichFiles].splice(i,1),removeCounter++,i--,l--);return removeCounter>0&&safeDigest(),removeCounter}var endIndex,promises=[],whichFiles=uploadType+"Files";if(startIndex<self[whichFiles].length){endIndex=startIndex+2<self[whichFiles].length?startIndex+2:self[whichFiles].length;for(var i=startIndex;endIndex>i;i++)!self[whichFiles][i]||self[whichFiles][i].getQueued()||self[whichFiles][i].uploadFailed()?RingLogger.warning("File alread queued for upload but FAILED",RingLogger.tags.UPLOAD):promises.push(self[whichFiles][i].initUpload());if(0===promises.length)return void self.uploadQueue(uploadType,endIndex);$q.all(promises).then(function(){removeFailed(),self.uploadQueue(uploadType,endIndex)},function(errData){endIndex-=removeFailed(),self.uploadQueue(uploadType,endIndex)})}else var interval=setInterval(function(){self.uploadProgress=!1,removeFailed(!0);for(var i=0;i<self[whichFiles].length;i++)if(!self[whichFiles][i].uploadCompleted()){self.uploadProgress=!0;break}self.uploadProgress||(clearInterval(interval),$rootScope.$broadcast(SystemEvents.FILE_UPLOAD.QUEUE_COMPLETE,uploadType),self[whichFiles].length>0&&Ringalert.show("All files uploaded","success"),safeDigest())},2e3)},self.setScopeForDigest=function(scope){SCOPES[scope.$id]=scope},self.removeScope=function(scope){SCOPES[scope.$id]&&(SCOPES[scope.$id]=null)}}angular.module("ringid.common.file_upload_service",["ringid.utils"]).service("fileUploadService",fileUploadService),fileUploadService.$inject=["$$q","Storage","settings","$rootScope","SystemEvents","Ringalert","utilsFactory","$ringhttp","imageQuality","mediaMetadata"]}(),function(){"use strict";function imageQuality($q,APP_CONSTANTS,Ringalert,utilsFactory){var self=this,coverMinW=APP_CONSTANTS.COVER_PIC_UPLOAD_MINIMUM_WIDTH,coverMinH=APP_CONSTANTS.COVER_PIC_UPLOAD_MINIMUM_HEIGHT,coverMaxW=APP_CONSTANTS.COVER_PIC_UPLOAD_MAXIMUM_WIDTH,coverMaxH=APP_CONSTANTS.COVER_PIC_UPLOAD_MAXIMUM_HEIGHT,profileMinW=APP_CONSTANTS.PROFILE_PIC_UPLOAD_MINIMUM_WIDTH,profileMinH=APP_CONSTANTS.PROFILE_PIC_UPLOAD_MINIMUM_HEIGHT,imageMinH=APP_CONSTANTS.IMAGE_UPLOAD_MIN_HEIGHT,imageMinW=APP_CONSTANTS.IMAGE_UPLOAD_MIN_WIDTH;self.resizeImage=function(imageFile,uploadType){function imageLoaded(){function resizeInCanvas(imgQuality){canvas=document.createElement("canvas"),canvas.width=meta.iw,canvas.height=meta.ih,ctx=canvas.getContext("2d"),ctx.drawImage(imgObj,0,0,meta.iw,meta.ih),imgQuality&&(meta.imQ=imgQuality.qualityIM.quality),meta.previewUrl=canvas.toDataURL("image/jpeg"),meta.file=utilsFactory.dataURLToBlob(meta.previewUrl),meta.file.name=imageFile.name||uploadType+".jpg",defer.resolve(meta)}var canvas,ctx,imgObj=this,scale=1,imageWidth=imgObj.width,imageHeight=imgObj.height;imageWidth>coverMaxW||imageHeight>coverMaxH?imageWidth/coverMaxW>imageHeight/coverMaxH?(scale=coverMaxW/imageWidth,meta.iw=coverMaxW,meta.ih=Math.floor(scale*imageHeight)):(scale=coverMaxH/imageHeight,meta.ih=coverMaxH,meta.iw=Math.floor(scale*imageWidth)):(meta.iw=imageWidth,meta.ih=imageHeight),RingLogger.print("Resize scale: "+scale,RingLogger.tags.UPLOAD),RingLogger.print("image.Width: "+imageWidth+" image.Height: "+imageHeight,RingLogger.tags.UPLOAD),RingLogger.print("resized.Width: "+meta.iw+" resized.Height: "+meta.ih,RingLogger.tags.UPLOAD);var minimumH=imageMinH,minimumW=imageMinW;switch(uploadType){case"profilephoto":(meta.iw<profileMinW||meta.ih<profileMinH)&&(minimumH=profileMinH,minimumW=profileMinW,limitCross=!0);break;case"coverphoto":(meta.iw<coverMinW||meta.ih<coverMinH)&&(minimumH=coverMinH,minimumW=coverMinW,limitCross=!0);break;case"status":case"chatimage":case"tagchatimage":(meta.iw<imageMinW||meta.ih<imageMinH)&&(limitCross=!0);break;default:RingLogger.warn(": "+uploadType,RingLogger.tags.UPLOAD)}limitCross?defer.reject("Image Size below Minimum("+minimumW+"px by "+minimumH+"px) :"+imageFile.name):resizeInCanvas(!1)}function imageError(){RingLogger.warning("invalid image error: "+imageFile.name,RingLogger.tags.UPLOAD),defer.reject("Image invalid: "+imageFile.name)}var image=new Image,limitCross=!1,defer=$q.defer(),meta={ih:0,iw:0,previewUrl:"",file:""},URL=window.URL||window.webkitURL;return"string"==typeof imageFile?(image.setAttribute("crossOrigin","anonymous"),image.src=imageFile):image.src=URL.createObjectURL(imageFile),image.onload=imageLoaded,image.onerror=imageError,defer.promise}}angular.module("ringid.common.image_quality_service",["ringid.common.file_upload_service","ringid.utils"]).service("imageQuality",imageQuality),imageQuality.$inject=["$$q","APP_CONSTANTS","Ringalert","utilsFactory"]}(),function(){"use strict";function countryListService($ringhttp,settings){return{getList:function(forSignup){return $ringhttp.get(settings.baseUrl+"/resources/countries.json")}}}angular.module("ringid.common.services",["ringid.common.media_metadata_service","ringid.common.file_upload_service","ringid.common.image_quality_service","ringid.config","ngWebSocket"]).factory("countryListService",countryListService),countryListService.$inject=["$ringhttp","settings"]}(),function(){"use strict";function imageHttpService($q,settings,$$connector,OPERATION_TYPES){var self=this,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE,OTYPES=OPERATION_TYPES.SYSTEM.IMAGE;OPERATION_TYPES.SYSTEM.FRIENDS;self.getAlbumList=function(fndId){var payload={};return fndId?(payload.actn=OTYPES.FETCH_FRIEND_ALBUM_LIST,payload.fndId=fndId):payload.actn=OTYPES.FETCH_ALBUM_LIST,$$connector.request(payload,REQTYPE.REQUEST)},self.getAlbumImages=function(obj){var payload={};return obj.fndId?(payload.actn=OTYPES.TYPE_FRIEND_ALBUM_IMAGES,payload.fndId=obj.fndId):payload.actn=OTYPES.TYPE_ALBUM_IMAGES,payload.st=obj.st||0,payload.albId=obj.albId,$$connector.pull(payload,REQTYPE.REQUEST,!0)},self.deleteImage=function(imgId){return $$connector.request({actn:OTYPES.DELETE_IMAGE,imgIds:[imgId]},REQTYPE.UPDATE)},self.getImageDetails=function(imgId){return $$connector.request({actn:OTYPES.TYPE_IMAGE_DETAILS,imgId:imgId},REQTYPE.REQUEST)},self.getProfilePicORCoverPicImageDetails=function(obj){var defer=$q.defer();return self.go({actn:OTYPES.GET_CP_OR_PP_DETAIL,type:obj.type}).then(function(data){defer.resolve(data)},function(reason){defer.reject(reason)}),defer.promise},self.getFeedImages=function(nfId){var payload={actn:OPERATION_TYPES.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:nfId};return $$connector.request(payload,REQTYPE.REQUEST)}}angular.module("ringid.common.services").service("imageHttpService",imageHttpService),imageHttpService.$inject=["$$q","settings","$$connector","OPERATION_TYPES"]}(),function(){"use strict";function ringhttp(settings,$templateCache){function XHR(type,url,data,responseType){var templateRequest=!1,methods={success:function(){},error:function(){},abort:function(){},progress:function(){}},templateIndex=url;url=/^(http|https):\/\//.test(url)?url:settings.baseUrl+url;var ajaxRequest={success:function(callback){return methods.success=callback,ajaxRequest},error:function(callback){return methods.error=callback,ajaxRequest},abort:function(callback){return methods.abort=callback,ajaxRequest},progress:function(callback){return methods.progress=callback,ajaxRequest},abortRequest:function(){xhr.abort()}};try{var xhr=new XMLHttpRequest;templateRequest="GET"===type&&/\.html$/.test(url),templateRequest&&requestQueue.hasOwnProperty(templateIndex)?requestQueue[templateIndex].push(methods):(templateRequest&&(url=url+"?time="+(new Date).getTime(),requestQueue[templateIndex]=[],requestQueue[templateIndex].push(methods)),xhr.open(type,url,!0),xhr.responseType=responseType||"text",xhr.onreadystatechange=function(){var response;4===xhr.readyState&&(response=parse(xhr),200===xhr.status?templateRequest?($templateCache.put(templateIndex,response[0]),requestQueue[templateIndex].forEach(function(methods){methods.success.apply(methods,[$templateCache.get(templateIndex),xhr])}),delete requestQueue[templateIndex]):(methods.progress.apply(methods,[100]),methods.success.apply(methods,response)):methods.error.apply(methods,response))},xhr.upload.onabort=function(){methods.abort.apply(methods)},xhr.upload.onprogress=function(e){methods.progress.apply(methods,[Math.round(e.loaded/e.total*100)-1])},xhr.send(data))}catch(e){RingLogger.alert("xmlhttprequest not available")}return ajaxRequest}var requestQueue={},parse=function(req){var result;try{result=JSON.parse(req.responseText)}catch(e){result=req.response}return[result,req]};return{get:function(url,headers,responseType){return XHR("GET",url,headers,responseType)},post:function(url,data,responseType){return XHR("POST",url,data,responseType)},getTemplatePromise:function(url,headers,responseType){}}}angular.module("ringid.common.services").factory("$ringhttp",ringhttp),ringhttp.$inject=["settings","$templateCache"]}(),function(){"use strict";angular.module("ringid.common.imagepopup_controller",["ringid.config","ringid.ringbox","ringid.common.image_factory","ringid.common.imagemap_factory"]).controller("ImagePopupController",["$routeParams","$scope","Auth","ImageFactory","$$imageMap","$$stackedMap","AlbumFactory","$$connector","OPERATION_TYPES",function($routeParams,$scope,Auth,ImageFactory,$$imageMap,$$stackedMap,AlbumFactory,$$connector,OPERATION_TYPES){function initImageDetails(showalert){$scope.boxIsLoading=!1,$scope.isReady=!0}function getImages(nfId){if(nfId)ImageFactory.getFeedImages(nfId).then(function(response){if(response.sucs===!0){for(var image,imageArray=response.newsFeedList[0].imageList,i=0,lt=imageArray.length;lt>i;i++)imageArray[i].nfId=response.nfId,imageArray[i].imgId===$scope.image.getKey()?($scope.image.updateImage(imageArray[i]),imageList.save($scope.image.getKey(),$scope.image)):(image=$$imageMap.create(imageArray[i]),imageList.save(image.getKey(),image));setRotation()}});else{var albums=AlbumFactory.albums($routeParams.uId);imageList=albums.get($scope.image.getAlbumId()).getImages(),setRotation()}}function setRotation(){imageList.length()>1&&($scope.nextImg=!!imageList.next($scope.image.getKey())||!!imageList.bottom(),$scope.prevImg=!!imageList.previous($scope.image.getKey())||!!imageList.top()),$scope.$rgDigest()}function preloadImage(direction){var imgObj,img=new Image;imgObj="next"===direction?imageList.next($scope.image.getKey()):imageList.previous($scope.image.getKey()),setTimeout(function(){img.src=imgObj?imgObj.src():""},200)}function changeImage(direction){"next"===direction?"profile"===$scope.params.popupFrom?imageList.previous($scope.image.getKey())?$scope.image=imageList.next($scope.image.getKey())||imageList.bottom():AlbumFactory.loadMoreImage($scope.image.getAlbumId(),$routeParams.uId).then(function(){imageList=AlbumFactory.albums($routeParams.uId).get($scope.image.getAlbumId()).getImages(),$scope.image=imageList.next($scope.image.getKey())||imageList.bottom(),$scope.$rgDigest()}):$scope.image=imageList.next($scope.image.getKey())||imageList.bottom():$scope.image=imageList.previous($scope.image.getKey())||imageList.top(),initImageDetails(),preloadImage(direction),$scope.$rgDigest()}var commentUpdateSubcriber,imageList=$$stackedMap.createNew(),OTYPES=OPERATION_TYPES.SYSTEM.IMAGE;$scope.currentUser=Auth.currentUser(),$scope.boxIsLoading=!0,$scope.showCommentBox=!0,$scope.changeImage=changeImage,$scope.nextImg=!1,$scope.prevImg=!1,$scope.params.image?($scope.image=$scope.params.image,initImageDetails(!1)):$scope.params.imgId&&($scope.remoteData?($scope.image=$scope.remoteData,initImageDetails()):ImageFactory.getImageDetails($scope.params.imgId).then(function(imageMap){$scope.image=imageMap,initImageDetails()})),$scope.params.feed&&($scope.feed=$scope.params.feed,getImages($scope.feed.getKey())),"profile"===$scope.params.popupFrom&&getImages(),$scope.openRingboxLike=function(){return $scope.image&&$scope.image.getLikes()>0},commentUpdateSubcriber=$$connector.subscribe(function(message){$scope.image&&$scope.image.getKey()===message.imgId&&($scope.image.setTotalComment(message.loc),$scope.$rgDigest())},{action:[OTYPES.TYPE_UPDATE_ADD_IMAGE_COMMENT,OTYPES.TYPE_UPDATE_DELETE_IMAGE_COMMENT]}),$scope.$on("$destroy",function(){commentUpdateSubcriber&&$$connector.unsubscribe(commentUpdateSubcriber)})}])}(),function(){"use strict";function MediaController(APP_CONSTANTS,fileUploadService,$routeParams,$scope,Auth,rgDropdownService,Media,$$connector,OPERATION_TYPES,Ringalert,feedFactory,$ringbox){function initMedia(){$scope.media.increaseView().then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()})}function selectAlbum(actionObj){switch(actionObj.action){case"select":$scope.ddControl.selectedAlbum=actionObj.albumMap,$scope.ddControl.selectedAlbum.addNewContent($scope.media),RingLogger.information("Selected Album: "+$scope.ddControl.selectedAlbum.getName(),RingLogger.tags.UPLOAD),rgDropdownService.close();break;case"toggleCreate":$scope.ddControl.createAlbum=!$scope.ddControl.createAlbum;break;case"create":if(0===$scope.ddControl.albumName.length)break;$scope.ddControl.createAlbum=!1,RingLogger.information("Create Album: "+$scope.ddControl.albumName,RingLogger.tags.UPLOAD),Media.createAlbum({albn:$scope.ddControl.albumName,mdaT:"audio"===$scope.ddControl.uploadWhat?AC.NEWS_FEED_MEDIA_TYPE_AUDIO:AC.NEWS_FEED_MEDIA_TYPE_VIDEO},!0).then(function(albumMap){$scope.ddControl.createAlbum=!1,$scope.ddControl.albumName="",$scope.ddControl.selectedAlbum=albumMap,$scope.ddControl.selectedAlbum.addNewContent($scope.media),rgDropdownService.close()})}$scope.$rgDigest()}function changeMedia(media){$scope.media=media,$scope.ddControl.uploadWhat=$scope.media.isAudio()?"audio":"video",Media.fetchContentDetails($scope.media.getKey(),!1,$scope.media.owner()),initMedia()}var commentUpdateSubcriber,OTYPES=OPERATION_TYPES.SYSTEM.MEDIA,AC=APP_CONSTANTS;$scope.currentUser=Auth.currentUser(),$scope.showCommentBox=!0,$scope.changeMedia=changeMedia,$scope.params&&"notification"===$scope.params.popupFrom?($scope.media=$scope.remoteData,$scope.album=Media.getAlbum($scope.media.getAlbumId())):($scope.media=$scope.remoteData,$scope.album=$scope.params.album),initMedia(),$scope.ddControl={Media:Media,uploadWhat:$scope.media.isAudio()?"audio":"video",createAlbum:!1,albumName:"",selectedAlbum:0},$scope.ddHtml="pages/dropdowns/popup-album-dropdown.html",$scope.ddAction=selectAlbum,$scope.shareMedia=function(){var instance=$ringbox.open({type:"remote",scope:!1,controller:"feedMediaShareController",scopeData:{media:$scope.media},onBackDropClickClose:!0,templateUrl:"pages/home/share-media.html"});instance.result.then(function(){$scope.$rgDigest()})},commentUpdateSubcriber=$$connector.subscribe(function(message){$scope.media&&$scope.media.getKey()===message.cntntId&&$scope.media.setTotalComment(message.loc)},{action:[OTYPES.ACTION_UPDATE_ADD_MEDIA_COMMENT,OTYPES.ACTION_UPDATE_DELETE_MEDIA_COMMENT]}),$scope.$on("$destroy",function(){commentUpdateSubcriber&&$$connector.unsubscribe(commentUpdateSubcriber)})}angular.module("ringid.common.media_controller",["ringid.config","ringid.ringbox"]).controller("MediaController",MediaController),MediaController.$inject=["APP_CONSTANTS","fileUploadService","$routeParams","$scope","Auth","rgDropdownService","Media","$$connector","OPERATION_TYPES","Ringalert","feedFactory","$ringbox"]}(),function(){"use strict";function RingBoxImagePopupController($scope,$boxInstance,$controller,localData,remoteData,feedFactory){$scope.close=$boxInstance.close,localData&&localData.imgId&&($scope.templateType=localData.templateType),$scope.params=localData,$scope.remoteData=remoteData,localData.noti&&localData.noti.getCommentId()>0&&($scope.activeCommentId=localData.noti.getCommentId()),$controller("ImagePopupController",{$scope:$scope})}angular.module("ringid.common.ringbox_imagepopup_controller",["ringid.common.imagepopup_controller"]).controller("RingBoxImagePopupController",RingBoxImagePopupController),RingBoxImagePopupController.$inject=["$scope","$boxInstance","$controller","localData","remoteData","feedFactory"]}(),function(){"use strict";function RingBoxMediaController($scope,$boxInstance,$controller,localData,remoteData,Media){function close(){$scope.destroyPlayer(),$boxInstance.close()}$scope.close=close,RingLogger.log(remoteData,"medoacontroller"),localData&&localData.mediaId&&($scope.templateType=localData.templateType),RingLogger.print(localData,"MEDIA_POPUP"),$scope.params=localData,$scope.remoteData=remoteData,$controller("MediaController",{$scope:$scope}),$scope.destroyPlayer=angular.noop}angular.module("ringid.common.ringbox_media_controller",["ringid.common.media_controller"]).controller("RingBoxMediaController",RingBoxMediaController),RingBoxMediaController.$inject=["$scope","$boxInstance","$controller","localData","remoteData","Media"]}(),function(){"use strict";function RingBoxConfirmController($scope,$boxInstance,localData){function close(confirmed){$boxInstance.close(confirmed)}$scope.close=close,$scope.params=localData}angular.module("ringid.common.ringbox_confirm_controller",[]).controller("RingBoxConfirmController",RingBoxConfirmController),RingBoxConfirmController.$inject=["$scope","$boxInstance","localData"];
}(),function(){"use strict";function SingleImageController($scope,$routeParams,$controller,Auth){$scope.params={},$scope.params.imgId=$routeParams.imageId,$scope.isReady=!1,$scope.currentUser=Auth.currentUser(),$controller("ImagePopupController",{$scope:$scope}),$scope.showCommentBox=!0}angular.module("ringid.common.singleimage_controller",["ringid.common.imagepopup_controller"]).controller("SingleImageController",SingleImageController),SingleImageController.$inject=["$scope","$routeParams","$controller","Auth"]}(),function(){"use strict";function allSuggestionController($scope,$boxInstance,localData,friendsFactory,InviteFactory,OPERATION_TYPES,$$connector,rgScrollbarService){function processPeople(data){data&&(InviteFactory.noOfSuggestions()>totalFriend&&(rgScrollbarService.recalculate($scope),$scope.$rgDigest()),totalFriend=InviteFactory.noOfSuggestions())}$scope.users=[];var OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS;$scope.state=InviteFactory.state,$boxInstance.opened.then(function(){$scope.users=localData.target.all(),$scope.$rgDigest()});var totalFriend=localData.target.length();$scope.$watch("state.isRequestsLoading",function(n,o){$scope.$rgDigest()}),$scope.contactListAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())},$scope.loadmorefriend=function(){InviteFactory.getSuggestionContactsDetails(5),$scope.$rgDigest()},$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}};var subscriptionKey=$$connector.subscribe(processPeople,{action:[OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]});$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey)})}angular.module("ringid.common.all_suggestions_controller",[]).controller("allSuggestionController",allSuggestionController),allSuggestionController.$inject=["$scope","$boxInstance","localData","friendsFactory","InviteFactory","OPERATION_TYPES","$$connector","rgScrollbarService"]}(),function(){"use strict";function mutualFriendsController($scope,remoteData,friendsFactory,userFactory,InviteFactory,rgScrollbarService){var mutualIds=remoteData.mfIDs;$scope.mutualfriends=[],$scope.state=InviteFactory.state,friendsFactory.getContactDetailsByUtIds(mutualIds).then(function(data){if($scope.mutualfriends=[],data.sucs===!0){for(var i=0;i<data.contacts.length;i++)$scope.mutualfriends.push(userFactory.create(data.contacts[i]));$scope.$rgDigest()}rgScrollbarService.recalculate($scope),$scope.$rgDigest()}),$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}}}angular.module("ringid.common.mutualfriends_controller",[]).controller("mutualFriendsController",mutualFriendsController),mutualFriendsController.$inject=["$scope","remoteData","friendsFactory","userFactory","InviteFactory","rgScrollbarService"]}(),function(){"use strict";function allNotificationController(NotificationFactory,$location,circlesManager,ImageFactory,Auth,Media,rgDropdownService,Ringalert,Storage,$scope,rgScrollbarService,OPERATION_TYPES,$$connector,notificationHttpService){}angular.module("ringid.common.all_notification_controller",[]).controller("allNotificationController",allNotificationController),allNotificationController.$inject=["NotificationFactory","$location","circlesManager","ImageFactory","Auth","Media","rgDropdownService","Ringalert","Storage","$scope","rgScrollbarService","OPERATION_TYPES","$$connector","notificationHttpService"]}(),function(){"use strict";function HeaderController($scope,$rootScope,$location,rgDropdownService,$$connector,OPERATION_TYPES,friendsFactory,NotificationFactory,Auth,rgScrollbarService,ChatFactory,utilsFactory,SystemEvents){function setActiveMenu(name){active_menu=name&&""!==name?name:"/"===$location.path()?"home":"none",$scope.$rgDigest()}function getActiveMenu(){return active_menu}var vm=this,OTYPES=OPERATION_TYPES.SYSTEM,active_menu=setActiveMenu();vm.getActiveMenu=getActiveMenu,vm.logout={ddHtml:"pages/dropdowns/logout-dropdown.html",ddControl:Auth,ddAction:function(){rgDropdownService.close(),Auth.logout()},ddOpened:function(){setActiveMenu("logout")},ddBeforeClose:function(){setActiveMenu("")}},vm.freq={ddTemplate:'<rg-requests load-on-scroll="true" load-count="10" ></rg-requests>',ddOpened:function(){setActiveMenu("friend_request")},ddBeforeClose:function(){setActiveMenu("")}},vm.requestCount=friendsFactory.getRequestCount,vm.chatHistory={ddHtml:"pages/partials/chat/chat-history-dropdown.html",ddOpened:function(){setActiveMenu("chat_history")},ddBeforeClose:function(){setActiveMenu("")}},vm.unreadChatCount=ChatFactory.getUnreadMessageCount,utilsFactory.onCustomEvent(SystemEvents.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){$scope.$rgDigest()}),vm.noti={ddTemplate:'<rg-notification load-count="10" template-url="pages/dropdowns/notification-dropdown.html"></rg-notification>',ddOpened:function(){setActiveMenu("notification"),NotificationFactory.clearCounter()},ddBeforeClose:function(){setActiveMenu("")}},vm.notiCount=NotificationFactory.getNotiCount;var subscriptionKey=$$connector.subscribe(function(){setTimeout(function(){$scope.$rgDigest()},200)},{action:[OTYPES.FRIENDS.TYPE_UPDATE_ADD_FRIEND,OTYPES.FRIENDS.TYPE_UPDATE_DELETE_FRIEND,OTYPES.NOTIFICATION.TYPE_MY_NOTIFICATIONS,OTYPES.NOTIFICATION.TYPE_SINGLE_NOTIFICATION]});vm.defaultSpan=utilsFactory.getDefaultColumn,$rootScope.$on("$routeChangeStart",function(){setActiveMenu(),$$connector.unsubscribe(subscriptionKey)}),$scope.$on(SystemEvents.COMMON.WINDOW_RESIZED,function(){$scope.$rgDigest()}),RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from HeaderController",RingLogger.tags.DIGEST)})}angular.module("ringid.common.header_controller",["ringid.auth","ringid.common.image_factory","ringid.media","ringid.friend.friends_factory","ringid.common.rgscrollbar_directive","ringid.notification","ringid.profile","ringid.config"]).controller("HeaderController",HeaderController),HeaderController.$inject=["$scope","$rootScope","$location","rgDropdownService","$$connector","OPERATION_TYPES","friendsFactory","NotificationFactory","Auth","rgScrollbarService","ChatFactory","utilsFactory","SystemEvents"]}(angular),function(){"use strict";function MenuController($scope,$location,circlesManager,rgScrollbarService,$$connector,circleHttpService,OPERATION_TYPES,$timeout){function gotCircleData(){$scope.$rgDigest()}function getCircles(own){return"true"===own||own===!0?circlesManager.getCircles(!0):circlesManager.getCircles(!1)}var subkey,circleUpdateSubscribeKey,OTYPES=OPERATION_TYPES.SYSTEM.CIRCLE,vm=this;subkey=$$connector.subscribe(gotCircleData,{action:OTYPES.TYPE_GROUP_LIST}),circleUpdateSubscribeKey=$$connector.subscribe(gotCircleData,{filter:circlesManager.circleUpdateFilter}),vm.ddHtml="pages/dropdowns/circle-list-dropdown.html",vm.ddControl={getCircles:getCircles},$scope.isCurrentPath=function(path,contain){return contain?$location.path().indexOf(path)>-1:$location.path()==path},$scope.$on("$destroy",function(){$$connector.unsubscribe(subkey),$$connector.unsubscribe(circleUpdateSubscribeKey)})}angular.module("ringid.common.menu_controller",["ringid.circle","ringid.ringbox","ringid.friend.friends_factory","ringid.common.rgscrollbar_directive"]).controller("MenuController",MenuController),MenuController.$inject=["$scope","$location","circlesManager","rgScrollbarService","$$connector","circleHttpService","OPERATION_TYPES","$timeout"]}(),function(){"use strict";angular.module("ringid.common.controllers",["ringid.common.header_controller","ringid.common.menu_controller","ringid.common.mutualfriends_controller","ringid.common.all_suggestions_controller","ringid.common.imagepopup_controller","ringid.common.media_controller","ringid.common.ringbox_confirm_controller","ringid.common.ringbox_imagepopup_controller","ringid.common.ringbox_media_controller","ringid.common.singleimage_controller","ringid.common.all_notification_controller"])}(),function(){"use strict";function validProfileImage(settings){return function(item){return item.indexOf("prof.png")>0?item:settings.imBase+item}}function stackMapFilter(){return function(items,filterItems){if(items){for(var i=0;i<items.length;i++)filterItems.get(items[i].key);return items}}}function friendListFilter(APP_CONSTANTS){return function(items,obj){if(items){for(var filtered=[],nameMatch=obj.name.toLowerCase(),i=0;i<items.length;i++)obj.showMutual&&items[i].value.friendshipStatus()!==APP_CONSTANTS.FRIEND||items[i].value.getName().toLowerCase().indexOf(nameMatch)>-1&&filtered.push(items[i]);return filtered}}}function mapListFilter(){return function(items,filterList){if(items){for(var filtered=[],i=0;i<items.length;i++)filterList.get(items[i].value.getKey())||filtered.push(items[i]);return filtered}}}function ymdDateFilter(){return function(date){var d=new Date(date),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();return month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),[year,month,day].join("-")}}function mediaFilter(){return function(items,mediaType){if(items){for(var filtered=[],i=0;i<items.length;i++)items[i].value.getType()===mediaType&&filtered.push(items[i]);return filtered}}}function mapFilter(){return function(items,obj){if(items){for(var filtered=[],nameToMatch=obj.value?obj.value.toLowerCase():"",i=0;i<items.length;i++)items[i].value[obj.mapApi]().toLowerCase().indexOf(nameToMatch)>-1&&filtered.push(items[i]);return filtered}}}function objectFilter(){function compareString(compareTo,compareThis){return compareTo.indexOf(compareThis)>-1}function compareDefault(compareTo,compareThis){return compareThis===compareTo}return function(items,obj){var compareFunc,filtered=[];if(items&&items.length>0){switch(obj.compare){case"string":compareFunc=compareString;break;default:compareFunc=compareDefault}for(var i=0;i<items.length;i++)compareFunc(items[i][obj.prop],obj.value)&&filtered.push(items[i]);return filtered}}}angular.module("ringid.filters",["ringid.config"]).filter("validProfileImage",validProfileImage).filter("friendListFilter",friendListFilter).filter("mapListFilter",mapListFilter).filter("stackMapFilter",stackMapFilter).filter("ymdDateFilter",ymdDateFilter).filter("mediaFilter",mediaFilter).filter("mapFilter",mapFilter).filter("objectFilter",objectFilter),validProfileImage.$inject=["settings"],friendListFilter.$inject=["APP_CONSTANTS"]}(),angular.module("ringid.ringbox",["ringid.common.stacked_map","ringid.utils"]).provider("$ringbox",function(){var $ringboxProvider={boxes:[],boxeScopes:[],boxeDeferred:[],template:'<div class="ringbox"><div class="ringbox-overlay"></div><div class="ringbox-outerContainer"><div class="ringbox-content"><div class="ringbox-inner"></div><div class="ringbox-loader"><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div></div></div></div>',init:function(){var boxDom=angular.element(this.template);return document.body.appendChild(boxDom[0]),document.body.className=document.body.className.replace("ringbox-opened",""),document.body.className=document.body.className.trim()+" ringbox-opened",this.boxes.push(boxDom),boxDom},adjustBoxes:function(){for(var i=0;i<this.boxes.length;i++)this.boxes[i].removeClass("rl_"+i);for(var i=0;i<this.boxes.length;i++)this.boxes[i].addClass("rl_"+i)},$get:["$injector","$rootScope","$$q","$templateCache","$controller","$compile","$document","$player","$ringhttp","$sniffer","Notification","SystemEvents","utilsFactory",function($injector,$rootScope,$q,$templateCache,$controller,$compile,$document,$player,$ringhttp,$sniffer,Notification,SystemEvents,utilsFactory){function getTemplatePromise(options){if(options.template)return $q.when(options.template);var url=angular.isFunction(options.templateUrl)?options.templateUrl():options.templateUrl;if($templateCache.get(url))return $q.when($templateCache.get(url));var defer=$q.defer();return $ringhttp.get(url).success(function(result){$templateCache.put(url,result),defer.resolve(result)}).error(function(){defer.reject()}),defer.promise}function getResolvePromises(resolves){var promisesArr=[];return angular.forEach(resolves,function(value){angular.isDefined(value.promise)?promisesArr.push(value.promise):angular.isFunction(value)?promisesArr.push($q.when($injector.invoke(value))):(angular.isArray(value)||angular.isObject(value))&&promisesArr.push(value)}),promisesArr}var $ringbox={},$this=this,prefix=$sniffer.vendorPrefix.toLowerCase();$ringbox.minimizedBox={dom:null,scope:null,deferred:null},$ringbox.clear=function(scope,defer,param){0==$this.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened","").trim()),scope&&scope.$destroy(),defer&&defer.resolve.apply(null,param),$player.miniPlayer.player||0!=$this.boxes.length||$player.destroyAll()},$ringbox.close=function(event){event&&event.stopPropagation&&event.stopPropagation(),$this.boxes.length>0&&($this.boxes.pop().remove(),$ringbox.clear($this.boxeScopes.pop(),$this.boxeDeferred.pop(),arguments))},$ringbox.closeAll=function(){for(var i=$this.boxes.length-1;i>=0;i--)$this.boxes.pop().remove(),$ringbox.clear($this.boxeScopes.pop(),$this.boxeDeferred.pop(),arguments)};var eventTranstionEnd=function(){$ringbox.minimizedBox.dom[0].style.display="none",$player.showMiniPlayer(),0==$this.boxes.length&&(document.body.className=document.body.className.replace("ringbox-opened",""))};return $ringbox.removeMinimize=function(){$ringbox.minimizedBox.dom&&$ringbox.minimizedBox.dom.remove(),$ringbox.minimizedBox.scope&&$ringbox.minimizedBox.scope.$destroy()},$ringbox.minimize=function(){if($this.boxes.length>0){$ringbox.minimizedBox.dom=$this.boxes.pop(),$ringbox.minimizedBox.scope=$this.boxeScopes.pop(),$ringbox.minimizedBox.deferred=$this.boxeDeferred.pop();var boxcontainer=$ringbox.minimizedBox.dom[0].querySelector(".ringbox-content"),x=boxcontainer.offsetLeft+(boxcontainer.offsetWidth-335)/2-200,y=window.innerHeight-(boxcontainer.offsetTop+(boxcontainer.offsetHeight-150)/2)-120,transfrom="translate(-"+x+"px,"+y+"px) scale(0.35,0.24)";$ringbox.minimizedBox.dom[0].querySelector(".pv-profile").style.display="none",boxcontainer.style.webkitTransition="transform 0.5s",boxcontainer.style.MozTransition="transform 0.5s",boxcontainer.style.msTransition="transform 0.5s",boxcontainer.style.OTransition="transform 0.5s",boxcontainer.style.transition="transform 0.5s",boxcontainer.style.webkitTransform=transfrom,boxcontainer.style.MozTransform=transfrom,boxcontainer.style.msTransform=transfrom,boxcontainer.style.OTransform=transfrom,boxcontainer.style.transform=transfrom,boxcontainer.addEventListener(prefix+"TransitionEnd",eventTranstionEnd),boxcontainer.addEventListener("transitionend",eventTranstionEnd)}},$ringbox.maximize=function(parent,content){if($ringbox.minimizedBox.dom){var boxcontainer=$ringbox.minimizedBox.dom[0].querySelector(".ringbox-content");$ringbox.minimizedBox.dom[0].querySelector("div.ringbox-overlay");$ringbox.minimizedBox.dom[0].querySelector(".pv-profile").style.display="block",$ringbox.minimizedBox.dom[0].style.display="table",parent.appendChild(content),boxcontainer.style.webkitTransform="initial",boxcontainer.style.MozTransform="initial",boxcontainer.style.msTransform="initial",boxcontainer.style.OTransform="initial",boxcontainer.style.transform="initial",$this.boxes.push($ringbox.minimizedBox.dom),$this.boxeScopes.push($ringbox.minimizedBox.scope),$this.boxeDeferred.push($ringbox.minimizedBox.deferred),1==$this.boxes.length&&(document.body.className=document.body.className.trim()+" ringbox-opened"),$ringbox.minimizedBox={dom:null,scope:null,deferred:null},boxcontainer.removeEventListener(prefix+"TransitionEnd",eventTranstionEnd),boxcontainer.removeEventListener("transitionend",eventTranstionEnd)}},$ringbox.open=function(boxOptions){var margin,boxResultDeferred=$q.defer(),boxOpenedDeferred=$q.defer(),boxTimer=!1,boxDom=$this.init(),boxContentDom=angular.element(boxDom[0].querySelector("div.ringbox-content")),boxLoaderDom=angular.element(boxContentDom[0].querySelector("div.ringbox-loader")),boxInnerDom=angular.element(boxContentDom[0].querySelector("div.ringbox-inner")),boxOverlayDom=angular.element(boxDom[0].querySelector("div.ringbox-overlay")),boxOffsetHeight=boxContentDom[0].offsetHeight;boxContentDom.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"}),boxOptions.animation&&boxContentDom.addClass("animation"),$this.adjustBoxes(),boxOptions=angular.extend({},boxOptions);var boxScope=(boxOptions.scope||$rootScope).$new();boxScope.boxIsLoading=!0,angular.forEach($ringboxProvider.options,function(value,key){boxScope[key]=boxOptions[key]}),angular.isObject(boxOptions.scopeData)&&angular.forEach(boxOptions.scopeData,function(value,key){boxScope[key]=boxOptions.scopeData[key]}),$this.boxeScopes.push(boxScope),$this.boxeDeferred.push(boxResultDeferred);var showLoader=function(){boxLoaderDom.css({display:"block"}),boxInnerDom.css({display:"none"}),boxContentDom.css({width:"200px",height:"95px","max-width":"200px","max-height":"95px"})},hideLoader=function(){setTimeout(function(){boxLoaderDom.css({display:"none"}),boxInnerDom.css({display:"inline-block"}),boxContentDom.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"})},100)},fastdomFrame=null;boxScope.$watch(heightChagned),boxScope.$on(SystemEvents.FEED.HEIGHT,function($event,key){heightChagned()});var heightChagned=function(){return fastdomFrame?void 0:(fastdomFrame=fastdom.defer(function(){boxContentDom&&boxOptions.scrollable&&(boxOffsetHeight=boxContentDom[0].offsetHeight,margin=Math.max(utilsFactory.viewport.y/2-boxOffsetHeight/2,40),boxContentDom.css({"margin-top":margin+"px"}),boxOffsetHeight>utilsFactory.viewport.y?boxOverlayDom.css({right:utilsFactory.scrollbarWidth+"px"}):boxOverlayDom.css({right:"0px"}),fastdomFrame=null)},2),boxOffsetHeight)};if(!boxOptions.template&&!boxOptions.templateUrl)throw new Error("One of template or templateUrl options is required.");var templateAndResolvePromise=$q.all([getTemplatePromise(boxOptions)].concat(getResolvePromises(boxOptions.resolve))),boxlInstance={result:boxResultDeferred.promise,opened:boxOpenedDeferred.promise,close:$ringbox.close,closeAll:$ringbox.closeAll,showLoader:showLoader,hideLoader:hideLoader};return templateAndResolvePromise.then(function(tplAndVars){if(boxScope.boxIsLoading=!1,boxScope.$close=$ringbox.close,boxInnerDom){boxTimer&&clearTimeout(boxTimer);var ctrlInstance,ctrlLocals={},resolveIter=1;if(boxOptions.controller){ctrlLocals.$scope=boxScope,ctrlLocals.$boxInstance=boxlInstance;for(var key in boxOptions.resolve)boxOptions.resolve.hasOwnProperty(key)&&(ctrlLocals[key]=tplAndVars[resolveIter++]);ctrlInstance=$controller(boxOptions.controller,ctrlLocals),boxOptions.controllerAs&&(boxScope[boxOptions.controllerAs]=ctrlInstance)}boxInnerDom.html(tplAndVars[0]),$compile(boxInnerDom.contents())(boxScope),boxContentDom.css({width:"auto",height:"auto","max-width":"100%","max-height":"100%"}),hideLoader(),boxOptions.scrollable&&(fastdom.read(function(){boxOffsetHeight=boxContentDom[0].offsetHeight,margin=Math.max(utilsFactory.viewport.y/2-boxOffsetHeight/2,40),fastdom.write(function(){boxContentDom.css({"margin-top":margin+"px"})})}),boxOffsetHeight>utilsFactory.viewport.y&&boxOverlayDom.css({right:utilsFactory.scrollbarWidth+"px"})),boxScope.$parent.$rgDigest(),RingLogger.info("from ringbox",RingLogger.tags.DIGEST)}},function(reason){boxResultDeferred.reject(reason),$ringbox.close()}),templateAndResolvePromise.then(function(){boxOpenedDeferred.resolve(!0)},function(){boxOpenedDeferred.reject(!1)}),boxOptions.scrollable&&(boxDom.addClass("scrollable"),margin=utilsFactory.viewport.y/2-boxOffsetHeight/2,boxContentDom.css({"margin-top":margin+"px"})),boxOptions.onBackDropClickClose&&(boxOverlayDom.on("click",function(){$ringbox.close()}),boxOptions.scrollable&&$document.bind("click",function boxClick(evt){-1!=evt.target.className.indexOf("ringbox-outerContainer")&&($document.unbind("click",boxClick),$ringbox.close())})),boxOptions.onEscape&&$document.bind("keyup",function boxKeyup(evt){var keyCode=evt.which||evt.keyCode||evt.key;if(32!=keyCode&&evt.stopImmediatePropagation(),27==keyCode){if($player.escapeKey)return void($player.escapeKey=!1);$document.unbind("keyup",boxKeyup),$ringbox.close()}return!1}),boxOptions.scrollable&&boxDom.bind("scroll",function(evt){boxDom[0].scrollHeight-(boxDom[0].offsetHeight+boxDom[0].scrollTop)<100&&(angular.isFunction(boxScope.onScroll)&&boxScope.onScroll(),angular.isFunction(boxScope.loadMore)&&boxScope.loadMore())}),boxScope.$on("$destroy",function(){boxDom=null,boxContentDom=null,boxLoaderDom=null,boxInnerDom=null,boxlInstance=null,boxOptions=null,boxOverlayDom=null,templateAndResolvePromise=null}),boxTimer=setTimeout(function(){boxScope&&boxScope.boxIsLoading&&(Notification.error({message:"Something went wrong! Please try again."}),$ringbox.close())},1e4),boxlInstance},$ringbox}]};return $ringboxProvider}).directive("rgRingbox",["$ringbox",function($ringbox){return{restrict:"EA",scope:{ringboxData:"&",scopeData:"&",onRingBoxOpen:"&",onRingBoxClose:"&",onScroll:"&",ringboxFalsyFunc:"&",ringboxOpen:"&"},link:function(scope,element,attr){function mainFunction(event){event.preventDefault();var type,target,items={},scopeDataItems={};type=attr.ringboxType,type||(type="html"),attr.ringboxData&&(items=angular.isFunction(scope.ringboxData)?scope.ringboxData():scope.ringboxData),attr.scopeData&&(scopeDataItems=angular.isFunction(scope.scopeData)?scope.scopeData():scope.scopeData);var tempitems=items.data?items.data:items,ringOb={type:type,scrollable:attr.ringboxScrollable&&("true"==attr.ringboxScrollable||1==attr.ringboxScrollable),scope:attr.ringboxScope?scope:!1,scopeData:scopeDataItems||{},controller:attr.ringboxController||"",resolve:{localData:tempitems,remoteData:items.promise?items:angular.noop},onBackDropClickClose:!attr.ringBackdropClose||"false"!=attr.ringBackdropClose&&0!=attr.ringBackdropClose,animation:!attr.ringboxAnimation||"false"!=attr.ringboxAnimation&&0!=attr.ringboxAnimation,onEscape:!attr.ringCloseEscape||"false"!=attr.ringCloseEscape&&0!=attr.ringCloseEscape};if("remote"===type)ringOb.templateUrl=attr.ringboxTarget||scope.ringboxTarget||attr.href||attr.src;else if("video"===type);else if("inline"===type)ringOb.template=attr.ringboxTarget||scope.ringboxTarget;else if(type="html",target=attr.ringboxTarget||scope.ringboxTarget){if(ringOb.template=angular.element(document.querySelector(target)),!(ringOb.template.length>0))throw new Error("Opps ! Your Provideed Target element Does Not Exist!");ringOb.template=ringOb.template[0].outerHTML}else ringOb.template=element.html();var boxInstance=$ringbox.open(ringOb);boxInstance.result.then(function(selectedItem){angular.isDefined(scope.onRingBoxClose)&&angular.isFunction(scope.onRingBoxClose)&&scope.onRingBoxClose()}),boxInstance.opened.then(function(){angular.isDefined(scope.onRingBoxOpen)&&angular.isFunction(scope.onRingBoxOpen)&&scope.onRingBoxOpen()})}function bindEvent(fn){element.on("click",fn),scopeOffEvent=scope.$on("$destroy",function(){element.off("click",fn)})}function bindFalsyEvent(e){e.preventDefault(),e.stopPropagation(),angular.isFunction(scope.ringboxFalsyFunc)&&scope.ringboxFalsyFunc()}var scopeOffEvent;attr.ringboxOpen?scope.$watch("ringboxOpen()",function(newValue){scopeOffEvent&&(element.off("click"),scopeOffEvent()),bindEvent(newValue?mainFunction:bindFalsyEvent)}):bindEvent(""===attr.rgRingbox||"true"===attr.rgRingbox||attr.rgRingbox===!0?mainFunction:bindFalsyEvent)}}}]),function(){"use strict";function ContactsFactory(settings,$$stackedMap,utilsFactory,Storage){var utIdMap={utIds:$$stackedMap.createNew(),incomingUtIds:$$stackedMap.createNew(),outgoingUtIds:$$stackedMap.createNew()},tempUtIds=$$stackedMap.createNew();return{init:function(){tempUtIds.setStack([])},initStorage:function(){},utIds:function(){return utIdMap.utIds},outgoingUtIds:function(){return utIdMap.outgoingUtIds},incomingUtIds:function(){return utIdMap.incomingUtIds},remove:function(utidType,utid){return utIdMap[utidType].remove(utid)},add:function(utidType,utid,frnsObj){utIdMap[utidType].save(utid,frnsObj)},getFrns:function(utId){return utIdMap.utIds.get(utId)||utIdMap.incomingUtIds.get(utId)||utIdMap.outgoingUtIds.get(utId)||{frnS:0}}}}angular.module("ringid.common.contacts_factory",["ringid.config","ringid.common.stacked_map"]).factory("Contacts",ContactsFactory),ContactsFactory.$inject=["settings","$$stackedMap","utilsFactory","Storage"]}(),function(){"use strict";function GlobalEvents($document){var handlers=[],handleClick=function(event){if(3!==event.which&&0!==handlers.length){RingLogger.warn("CLICKED ON WINDOW"),RingLogger.log(handlers);for(var i=0,l=handlers.length;l>i;i++)handlers[i].call(null,event);event.preventDefault()}};return{bindHandler:function(attachTo,eventType,handler){handlers.push(handler),1===handlers.length&&$document.bind("click",handleClick)},unbindHandler:function(removeFrom,eventType,handler){setTimeout(function(){handlers.splice(handlers.indexOf(handler),1),0===handlers.length&&$document.unbind("click",handleClick)})}}}angular.module("ringid.common.global_events_factory",[]).factory("GlobalEvents",GlobalEvents),GlobalEvents.$inject=["$document"]}(),function(){"use strict";function SystemEvents(){return{COMMON:{WINDOW_RESIZED:"WINDOW_RESIZED",COLUMN_CHANGED:"COLUMN_CHANGED",LOADING:"LOADING"},CIRCLE:{MY_CIRCLE_LIST_FETCH_COMPLETE:"MY_CIRCLE_LOAD_COMPLETE",MY_CIRCLE_LIST_PROCESS_COMPLETE:"MY_CIRCLE_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE:"MY_CIRCLE_MEMBER_LIST_FETCH_COMPLETE",MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE:"MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE",MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE:"MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE",MY_CIRCLE_MEMBER_REMOVED:"MY_CIRCLE_MEMBER_REMOVED",MY_CIRCLE_REMOVED:"MY_CIRCLE_REMOVED"},FILE_UPLOAD:{PROGRESS_UPDATE:"PROGRESS_UPDATE",QUEUE_START:"QUEUE_START",QUEUE_COMPLETE:"QUEUE_COMPLETE",UPLOADS_POSTED:"UPLOADS_POSTED"},ALBUM:{PHOTOS_SELECTED:"PHOTOS_SELECTED"},IMAGE:{DO_REPOSITION:"DO_REPOSITION",RESIZE:"RESIZE"},FEED:{UPDATED:"UPDATED",CREATED:"CREATED",DELETED:"DELETED",RESET:"RESET",HEIGHT:"HEIGHT",BUSY:"BUSY"},AUTH:{LOGIN:"LOGIN"},CHAT:{CHAT_REGISTER:"CHAT_REGISTER",MESSAGE_RECEIVED:"MESSAGE_RECEIVED",MESSAGE_SUBMITTED:"MESSAGE_SUBMITTED",TAB_SYNC:"TAB_SYNC",TAB_SYNC_NEW_DATA:"TAB_SYNC_NEW_DATA",UNREAD_MESSAGE_INFO_UPDATED:"UNREAD_MESSAGE_INFO_UPDATED"}}}angular.module("ringid.common.events_factory",[]).factory("SystemEvents",SystemEvents),SystemEvents.$inject=["$rootScope"]}(),function(){"use strict";angular.module("ringid.common.user_factory",["ringid.config","ringid.common.stacked_map","ringid.common.contacts_factory"]).factory("$$userMap",["profileHttpService","settings","$$stackedMap","$filter","utilsFactory","Storage","Contacts","$$q",function(profileHttpService,settings,$$stackedMap,$filter,utilsFactory,Storage,Contacts,$q){var DEVICES={0:"p",1:"desktop",2:"android",3:"iphone",4:"windows",5:"web"};return{create:function(obj,isProfile,isCurrent,usersByUtId,withMfc){function createAvatar(size){var imageLink=user.prIm||"";if("iurl"===size)return imageLink;if("original"===size)return settings.imBase+imageLink;if(imageLink.indexOf("prof.png")>0)return imageLink;imageLink=imageLink.replace("profileimages/",""),"original"===size?size="":size||(size="crp"),size=(/\/uploaded\//.test(imageLink)?"":"p")+size;var position=imageLink.lastIndexOf("/")+1;return imageLink=[settings.imBase,imageLink.slice(0,position),size,imageLink.slice(position)].join(""),imageLink.indexOf("prof.png")>0?user.prIm:imageLink}function requestUserDetails(mfc){var promise,reqData={};return user.utId?reqData.utId=user.utId:user.uId&&(reqData.uId=user.uId),reqData.utId||reqData.uId?(mfc&&(requestedMutualFriend=!0),promise=profileHttpService.getUserDetails(reqData,!!mfc),promise.then(function(json){json.sucs&&updateUser(json.userDetails),user.utId&&usersByUtId&&!usersByUtId[user.utId]&&(usersByUtId[user.utId]=ObjectToReturn)}),promise):void 0}var user={fn:"",uId:0,cnty:"",el:"",gr:"",am:"",mblDc:"",prIm:"images/prof.png",cIm:"images/default_cover.jpg",prImId:0,cImId:0,cimX:0,cimY:0,bDay:"",blc:0,re:"",utId:0,tf:0,nmf:0,chta:0,cla:0,fda:0,cc:"",hc:"",adt:0,psnc:0,lot:0,mood:0,apt:0,dt:"",groups:{},frnS:0,ct:0,nct:0,pimX:0,pimY:0,bv:0,owner:0,basicInfo:!1,privacyInfo:{},isCurrent:!1,loading:!1};user.isCurrent=isCurrent,user.isProfile=isProfile,user.psnc=isCurrent?2:user.psnc,user.dvc=isCurrent?5:user.dvc,obj.hasOwnProperty("grpId")&&(user.groups[obj.grpId]=obj.admin);var updateUser=function(o){var userObj=o||obj;user=angular.extend({},user,userObj),userObj.grpId&&(user.groups[userObj.grpId]=userObj.admin),""===user.prIm&&(user.prIm="images/prof.png"),""===user.cIm&&(user.cIm="images/default_cover.jpg"),0===user.frnS&&(user.frnS=Contacts.getFrns(user.utId).frnS||user.frnS),userObj.mfc&&(user.nmf=userObj.mfc),userObj.mutualFriends&&(user.nmf=userObj.mutualFriends)};angular.isObject(obj)&&(obj.utId||RingLogger.warning("CAN NOT DETERMINE FRNS NO utId",RingLogger.tags.FRIEND),updateUser()),user.prIm&&user.uId&&user.utId&&(user.nmf||!withMfc)||requestUserDetails(!!withMfc);var requestedMutualFriend=!1,liteUser={getName:function(type){return user.fn},avatar:createAvatar,getKey:function(){return user.uId||user.utId},getUId:function(){return user.uId},setUid:function(uid){user.uId=uid},getUtId:function(){return+user.utId},updateUserObj:function(obj){updateUser(obj)},equals:function(u,check){return check||(check="uId"),angular.isObject(u)&&(u="uId"===check?u.getKey():u.getUtId()),user[check]===u},link:function(){return user.uId||user.utId?settings.baseUrl+utilsFactory.getRingRoute("USER_PROFILE",{uId:user.uId,utId:user.utId})+(1===user.frnS||user.isCurrent?"":"/about"):""},navActiveLink:function(){if(user.uId||user.utId){var url="/profile/"+user.uId+"/post";return url}return""},toString:function(){return user.uId},getRingNumber:function(){return user.uId.replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")},friendshipStatus:function(){return user.frnS},isLoading:function(bool){return"undefined"==typeof bool?user.loading:(user.loading=bool,user.loading)},commonFriends:function(force,returnPromise){var promise;return(!user.nmf&&!requestedMutualFriend||force)&&(promise=requestUserDetails(!0,returnPromise)),returnPromise?promise||$q.when(user.nmf):user.nmf},isCurrentUser:function(){return user.isCurrent}},ObjectToReturn={sortBy:function(){return user.adt},getLiteUser:function(){return liteUser},isAdmin:function(grpId){return user.groups.hasOwnProperty(grpId)?user.groups[grpId]:!1},setGroupAdmin:function(groupId){user.groups[groupId]=!0},removeGroupAdmin:function(groupId){delete user.groups[groupId]},updateUserObj:function(obj){updateUser(obj)},overwriteInfo:function(ob){user.prIm=ob.prIm||user.prIm},haveProfileData:function(){return user.isProfile},getBasicInfo:function(){var frTime=utilsFactory.profileVerbalDate(user.bDay),mTime=utilsFactory.profileVerbalDate(user.mDay);return{fn:user.fn||"",birthDay:user.bDay||"",mDay:user.mDay||"",birthday:frTime,marriageDay:mTime,el:user.el||"",hc:user.hc||"",cc:user.cc||"",gr:user.gr||"",am:user.am||"",uId:user.uId.toString().substring(2)||""}},setBasicInfo:function(basicInfoObj){},resetCover:function(){user.cIm="images/default_cover.jpg"},getCover:function(size){var prefix,position,cIm=user.cIm;return"iurl"===size?cIm:size&&"original"===size?settings.imBase+cIm:cIm?cIm.indexOf("default")>0?cIm:cIm.indexOf("web")>0?settings.imBase+cIm:(prefix=(/\/uploaded\//.test(cIm)?"":"p")+(size||"crp"),position=cIm.lastIndexOf("/")+1,cIm=[settings.imBase,cIm.slice(0,position),prefix,cIm.slice(position)].join("")):"images/default_cover.jpg"},getCoverXY:function(){return{x:user.cimX,y:user.cimY}},setCover:function(obj){user.cIm=obj.iurl,user.cimX=obj.cimX,user.cimY=obj.cimY,user.cImId=obj.cImId},getAvatarXY:function(){return{x:user.pimX,
y:user.pimY}},setProfileImage:function(prImg,prImId){user.prIm=prImg,user.prImId=prImId},setName:function(fn){user.fn=fn},setAboutMe:function(am){user.am=am},setHomeCity:function(hc){user.hc=hc},setCurrentCity:function(cc){user.cc=cc},setGender:function(gr){user.gr=gr},setBirthday:function(bd){user.bDay=bd},setMarriageday:function(md){user.mDay=md},getEmail:function(){return user.el},getCountry:function(){return user.cnty},friendshipStatus:function(){return user.frnS},isLoading:function(bool){return"undefined"==typeof bool?user.loading:(user.loading=bool,user.loading)},friendType:function(){return user.ct},setFriendType:function(ct){user.ct=ct},newFriendType:function(){return user.nct},getLink:function(attrs){var attrsStr="";if(attrs)for(var key in attrs)attrs.hasOwnProperty(key)&&(attrsStr+=key+'="'+attrs[key]+'" ');return"<a "+attrsStr+' href="'+liteUser.link()+'">'+user.fn+"</a>"},isCurrentUser:function(){return user.isCurrent},resetAvatar:function(){user.prIm="images/prof.png"},avatarXY:function(){return{x:user.pimX,y:user.pimY}},getBday:function(){return user.bDay},getUserMood:function(){return user.mood},setUserMood:function(mood){user.mood=mood},getAppType:function(){return user.apt},setAppType:function(appType){user.apt=appType},getDeviceToken:function(){return user.dt},setDeviceToken:function(deviceToken){user.dt=deviceToken},getRingNumber:function(){return user.uId.replace(/(\d{2})(\d{4})(\d+?)/,"$2 $3")},isBlocked:function(){return user.bv},setBlock:function(block){user.bv=block},isFriend:function(){return 1===user.frnS},unFriend:function(){user.frnS=0},getAccess:function(){return{chta:user.chta,cla:user.cla,fda:user.fda}},canChat:function(){return 1===user.chta},canSeeFeed:function(){return 1===user.fda},setOnlineStatus:function(status){user.psnc=status},getOnlineStatus:function(){return user.psnc},isOnline:function(){return 2===user.psnc&&1===user.mood},onlineDevice:function(){return DEVICES[user.dvc]},getPlatform:function(){return user.dvc},setPlatform:function(platfrom){user.dvc=platfrom},lastOnline:function(){return 0===user.lot?!1:utilsFactory.verbalDate(user.lot)},getProfileImageId:function(){return user.prImId},getCoverImageId:function(){return user.cImId},toggleMood:function(mood){user.mood=mood?1:2,profileHttpService.changeMood(user.mood).then(function(json){json.sucs!==!0&&(user.mood=json.mood)})}};return angular.extend(ObjectToReturn,liteUser),ObjectToReturn}}}]).factory("userFactory",["$$userMap","$$stackedMap",function($$userMap,$$stackedMap){var users=$$stackedMap.createNew(),usersByUtId={},prefix="ru_",ObjectToReturn={getSortIndex:function(){return"adt"},create:function(ob,isProfile,isCurrent){isProfile=!!isProfile,isCurrent=!!isCurrent;var key,user;return angular.isObject(ob)?ob.uId?(key=ob.uId,key=prefix+key,user=users.get(key)):ob.utId?(user=usersByUtId[ob.utId],user||(user=!1)):user=!1:(key=prefix+ob,user=users.get(key)),user===!1?ob.utId&&usersByUtId[ob.utId]?(user=usersByUtId[ob.utId],key=prefix+ob.uId,users.save(key,user),user.updateUserObj(ob)):(user=$$userMap.create(ob,isProfile,isCurrent,usersByUtId),user.getUtId()&&(usersByUtId[user.getUtId()]=user)):user.updateUserObj(ob),users.save(key,user),user},createByUtId:function(ob,returnLite,withMfc){return usersByUtId[ob.utId]||(usersByUtId[ob.utId]=$$userMap.create(ob,!1,!1,usersByUtId,withMfc)),returnLite?usersByUtId[ob.utId].getLiteUser():usersByUtId[ob.utId]},getUser:function(key){return key=prefix+key,users.get(key)},getByUtId:function(utId){return utId&&usersByUtId[utId]||!1},getAllUtIds:function(){return Object.keys(usersByUtId)},getUIdByUtId:function(utId){return usersByUtId[utId]&&usersByUtId[utId].getUId()},getUtIdByUId:function(uId){var user;try{user=ObjectToReturn.getUser(uId)}catch(e){RingLogger.warn(e,RingLogger.tags.FRIEND)}return user&&user.getUtId()}};return ObjectToReturn}])}(),function(){angular.module("ringid.common.comment_factory",["ringid.config","ringid.common.stacked_map"]).factory("$$commentMap",["$$stackedMap","settings","$filter","DATE_FORMAT","userFactory","utilsFactory","$$stickerMap","$sce",function($$stackedMap,settings,$filter,DATE_FORMAT,userFactory,utilsFactory,$$stickerMap,$sce){return{getSortIndex:function(){return"tm"},create:function(ob,user){function updateTime(){comment.tm?comment.time=utilsFactory.verbalDate(comment.tm):comment.time={}}function updateComment(json){comment=angular.extend({},comment,json),updateTime(),setCommentTextPortions()}var comment={cmn:"",cmnId:0,deleted:!1,edited:!1,fn:"",il:0,isNew:1,ln:"",nfId:0,imageId:0,tl:0,tm:"",uId:"",prIm:"",pending:!1},commentTextHtml="";angular.isObject(ob)&&(comment=angular.extend({},comment,ob)),user?(comment.user=user,comment.fn=comment.user.getName("f"),comment.fn=comment.user.getName("l"),comment.uId=comment.user.getKey(),comment.tm=(new Date).getTime()):comment.user=userFactory.create({fn:comment.fn,ln:comment.ln,uId:comment.uId,prIm:comment.prIm}),updateTime();var setCommentTextPortions=function(){commentTextHtml=$sce.trustAsHtml(utilsFactory.parseForLE(comment.cmn))};return setCommentTextPortions(),{user:function(){return comment.user},isOwner:function(userKey){return userKey===comment.user.getKey()},text:function(){return comment.cmn},setComment:function(commentText){comment.cmn=commentText,setCommentTextPortions()},setText:function(txt){comment.cmn=txt},getDynamicText:function(){return commentTextHtml},getByProperty:function(property_name,return_default){return return_default=return_default||!1,comment.hasOwnProperty(property_name)?comment[property_name]:return_default},sortBy:function(){return comment.tm},getKey:function(){return comment.cmnId},setKey:function(key){comment.cmnId=key},getFeedKey:function(){return comment.nfId},setFeedKey:function(key){comment.nfId=key},getImageKey:function(){return comment.imageId},setImageKey:function(key){comment.imageId=key},updateComment:function(json){updateComment(json)},getTimestamp:function(){return comment.tm},setTime:function(tm){comment.tm=tm,updateTime()},getTimeUpdate:function(){return updateTime(),comment.time},time:function(){return comment.time},like:function(dolike,totalLike){return dolike?(comment.il=1^comment.il,totalLike?comment.tl=totalLike:comment.tl=0==comment.il?comment.tl-1:comment.tl+1,comment.il):comment.il},getTotalLikes:function(){return comment.tl},getLikes:function(){},incomingLike:function(tl){comment.tl=tl},edit:function(){},"delete":function(){},isPending:function(val){return void 0!==val&&(comment.pending=!!val),comment.pending}}}}}])}(),function(){"use strict";function $$imageMap(settings,$$stackedMap,userFactory,utilsFactory){return{create:function(obj,user){var image={albId:"",albn:"",cptn:"",nfId:0,ic:0,ih:0,il:0,imT:0,imgId:0,iurl:"",iw:0,nc:0,nl:0,tm:0,user:null};image.key="im"+obj.imgId;var updateImageObj=function(imgObj){angular.isObject(imgObj)&&(image=angular.extend({},image,imgObj)),image.tm?image.time=utilsFactory.verbalDate(image.tm):image.time={},imgObj.hasOwnProperty("uId")?image.user=userFactory.create({uId:imgObj.uId,fn:imgObj.fn||""}):user&&(image.user=user)};updateImageObj(obj);var ObjectToReturn={updateImage:function(obj){updateImageObj(obj)},user:function(){return image.user},src:function(size){if("iurl"===size)return image.iurl;var position=image.iurl.lastIndexOf("/")+1,progressive=/\/uploaded\//.test(image.iurl)?"":"p";return void 0!==size?[settings.imBase,image.iurl.slice(0,position),progressive,size,image.iurl.slice(position)].join(""):[settings.imBase,image.iurl.slice(0,position),progressive,image.iurl.slice(position)].join("")},getByProperty:function(property_name,returndefault){return returndefault=returndefault||!1,image.hasOwnProperty(property_name)?user[property_name]:returndefault},sortBy:function(){return image.imgId},getIh:function(){return image.ih},getIw:function(){return image.iw},sortByTime:function(){return image.tm},getAlbumName:function(){return image.albn},getAlbumId:function(){return image.albId},getCaption:function(){return image.cptn},getKey:function(){return image.imgId},getMapKey:function(){return image.key},getFeedKey:function(){return image.nfId},setFeedKey:function(key){image.nfId=key},time:function(){return image.time},like:function(dolike,totalLike){return dolike?(image.il=1^image.il,totalLike?image.nl=totalLike:image.nl=0==image.il?image.nl-1:image.nl+1,image.il):image.il},getLikes:function(){return image.nl},getTotalLikes:function(){return image.nl},getImageType:function(){return image.imT},incomingLike:function(type){return type&&++image.nl||--image.nl},offset:function(){return{width:image.iw,height:image.ih}},selfComment:function(){return image.ic},getTotalComment:function(){return image.nc},setTotalComment:function(total,ic){image.nc=total,angular.isDefined(ic)&&(image.ic=ic)},getUrl:function(){return"/image/"+ObjectToReturn.getKey()},getRelativeHeight:function(width){try{return image.ih/image.iw*width}catch(e){return image.ih}}};return ObjectToReturn}}}angular.module("ringid.common.imagemap_factory",["ringid.config","ringid.utils","ringid.common.stacked_map","ringid.common.comment_factory","ringid.common.user_factory"]).factory("$$imageMap",$$imageMap),$$imageMap.$inject=["settings","$$stackedMap","userFactory","utilsFactory"]}(),function(){"use strict";function Ringalert($ringbox,Notification,MESSAGES){var defaultNotificationOptions={delay:3e3,positionX:"right",positionY:"top",replaceMessage:!0},defaultAlertOptions={title:"Warning",message:"Click ok to continue",showOk:!0,showCancel:!0,craac:!1,textOk:"OK",textCancel:"Cancel",okCallback:angular.noop,cencelCallback:angular.noop};return{show:function(messageObject,type){type=type||"info",angular.isString(messageObject)&&(messageObject={message:messageObject}),messageObject.message=messageObject.message||messageObject.mg,messageObject.message||("success"===type?messageObject.message=MESSAGES.REQUEST_PROCESSED:"error"===type&&(messageObject.message=MESSAGES.REQUEST_FAILED));try{Notification[type](angular.extend({},defaultNotificationOptions,messageObject))}catch(e){}},clear:function(){Notification.clearAll()},alert:function(ob){ob=ob||{},ob=angular.extend({},defaultAlertOptions,ob);var boxInstance=$ringbox.open({type:"remote",scope:!1,scopeData:ob,templateUrl:"pages/popups/ring-alert.html"});boxInstance.result.then(function(sts){"ok"===sts&&angular.isFunction(ob.okCallback)?ob.okCallback.call(null):ob.cencelCallback.call(null)})}}}angular.module("ringid.common.ringalert",["ui-notification","ringid.ringbox"]).factory("Ringalert",Ringalert),Ringalert.$inject=["$ringbox","Notification","MESSAGES"]}(),function(){"use strict";function ImageFactory(utilsFactory,imageHttpService,$q,$$imageMap,Ringalert){return{process:function(json,image){processorFunctions[json.actn]&&processorFunctions[json.actn](json,image)},getImageDetails:function(imgId,nfId){var defer=$q.defer();return imageHttpService.getImageDetails(imgId).then(function(response){response.sucs===!0?(nfId&&!response.nfId&&(response.nfId=nfId),defer.resolve($$imageMap.create(response))):Ringalert.show(response,"error")},function(errData){defer.reject(),Ringalert.show(errData,"error")}),defer.promise},getFeedImages:function(nfId){return imageHttpService.getFeedImages(nfId)}}}angular.module("ringid.common.image_factory",["ringid.config","ringid.common.stacked_map","ringid.utils","ringid.connector"]).factory("ImageFactory",ImageFactory),ImageFactory.$inject=["utilsFactory","imageHttpService","$$q","$$imageMap","Ringalert"]}(),function(){"use strict";function AlbumFactory($q,settings,Auth,$$imageMap,$$stackedMap,$$connector,OPERATION_TYPES,imageHttpService,profileFactory){var loadMoreImageRequestTimeout,OTYPES=OPERATION_TYPES.SYSTEM.IMAGE,ownImages=$$stackedMap.createNew(),userImages=$$stackedMap.createNew(),fetchAlbumListRequest=!1,loadMoreImageRequest=!1,CreateAlbum=function(obj,albumOwnerUid){function pushImages(obj){for(var imageObj,i=0,lt=obj.imageList.length;lt>i;i++)imageObj=angular.extend({},obj.imageList[i],{albId:album.albId}),image=$$imageMap.create(imageObj,albumOwner),album.images.save(image.getKey(),image),album.ut<obj.imageList[i].tm&&(album.ut=obj.imageList[i].tm)}var image,albumOwner,album={albId:obj.albId,timg:obj.timg,images:$$stackedMap.createNew(),ut:0};return albumOwner=profileFactory.getProfile(albumOwnerUid),album=angular.extend({},album,obj),obj.imageList&&obj.imageList.length>0&&pushImages(obj),{getKey:function(){return album.albId},pushImages:function(obj){pushImages(obj)},removeImage:function(imageKey){album.images.remove(imageKey)&&(album.tn=album.tn-1)},getName:function(){return album.albn},getCoverImage:function(size){var position=album.cvImg.lastIndexOf("/")+1;return size="p"+size,[settings.imBase,album.cvImg.slice(0,position),size,album.cvImg.slice(position)].join("")},getTotalImageCount:function(){return album.tn},getUpdateTime:function(){return album.tm},getImages:function(){return album.images}}},processResponse=function(json){var album;switch(json.actn){case OTYPES.TYPE_ALBUM_IMAGES:RingLogger.information("got Album images for album: "+json.albId+" success: "+json.sucs,RingLogger.tags.IMAGE),loadMoreImageRequest=!1,clearTimeout(loadMoreImageRequestTimeout),json.sucs===!0?ownImages.get(json.albId)?ownImages.get(json.albId).pushImages(json):(album=new CreateAlbum(json),ownImages.save(album.getKey(),album)):RingLogger.alert("Album request failed",RingLogger.tags.IMAGE);break;case OTYPES.TYPE_FRIEND_ALBUM_IMAGES:loadMoreImageRequest=!1,clearTimeout(loadMoreImageRequestTimeout),RingLogger.information("got Album images for album: "+json.albId+" success: "+json.sucs,RingLogger.tags.IMAGE),json.sucs===!0?userImages.get(json.albId)?userImages.get(json.albId).pushImages(json):(album=new CreateAlbum(json),userImages.save(album.getKey(),album)):RingLogger.alert("Album request failed",RingLogger.tags.IMAGE)}};return{resetUserImages:function(own){own?ownImages.reset():userImages.reset()},imagesLoading:function(){return loadMoreImageRequest},albumsLoading:function(){return fetchAlbumListRequest},deleteImage:function(imageMap){imageHttpService.deleteImage(imageMap.getKey()).then(function(response){RingLogger.print(response,RingLogger.tags.IMAGE),response.sucs===!0?ownImages.get(imageMap.getAlbumId()).removeImage(imageMap.getKey()):RingLogger.warning("Image Delete failed",RingLogger.tags.IMAGE)})},albums:function(uId){return Auth.currentUser().getKey()===uId?ownImages:userImages},loadMoreImage:function(albId,uId){var deferred=$q.defer();RingLogger.information("load more images for album: "+albId+" uId: "+uId,RingLogger.tags.IMAGE);var fndId=!1,st=0;if(!loadMoreImageRequest){if(loadMoreImageRequest=!0,loadMoreImageRequestTimeout=setTimeout(function(){loadMoreImageRequest=!1,clearTimeout(loadMoreImageRequestTimeout)},3e3),Auth.currentUser().getKey()===uId){if(st=ownImages.get(albId)?ownImages.get(albId).getImages().length():0,0!==st&&st>=ownImages.get(albId).getTotalImageCount())return}else if(fndId=uId,st=userImages.get(albId)?userImages.get(albId).getImages().length():0,0!==st&&st>=userImages.get(albId).getTotalImageCount())return;return imageHttpService.getAlbumImages({fndId:fndId,albId:albId,st:st}).then(function(json){json.sucs===!0?(processResponse(json),deferred.resolve()):deferred.reject()}),deferred.promise}},getAllAlbums:function(uId){var album,fndId=!1,deferred=$q.defer();return Auth.currentUser().getKey()!==uId&&(fndId=uId),imageHttpService.getAlbumList(fndId).then(function(response){if(RingLogger.print(response,RingLogger.tags.IMAGE),response.sucs===!0){for(var i=0,len=response.albumList.length;len>i;i++)album=new CreateAlbum(response.albumList[i],uId),fndId?userImages.save(album.getKey(),album):ownImages.save(album.getKey(),album);deferred.resolve()}else deferred.reject()}),deferred.promise}}}angular.module("ringid.common.album_factory",["ringid.config","ringid.common.imagemap_factory","ringid.common.stacked_map","ringid.utils","ringid.connector","ringid.common.services","ringid.profile"]).factory("AlbumFactory",AlbumFactory),AlbumFactory.$inject=["$$q","settings","Auth","$$imageMap","$$stackedMap","$$connector","OPERATION_TYPES","imageHttpService","profileFactory"]}(),function(){"use strict";angular.module("ringid.common.emotion_factory",[]).factory("EmotionFactory",["$$connector","settings","OPERATION_TYPES",function($$connector,settings,OPERATION_TYPES){function createEmotion(ob){return{id:ob.id,title:ob.nm,nm:ob.nm,url:settings.emotionServer+ob.url,cat:ob.cat}}function process(message){var i;if(message.sucs&&message.mdLst.length)for(i=0;i<message.mdLst.length;i++)emotions[message.mdLst[i].id]=createEmotion(message.mdLst[i]),count++;safeDigest()}function getEmotions(){var arr=[];for(var key in emotions)emotions.hasOwnProperty(key)&&arr.push(emotions[key]);return arr}function safeDigest(){var digestScope;for(var key in SCOPES)digestScope=SCOPES[key],digestScope&&digestScope.$id&&!digestScope.$$destroyed&&digestScope.setEmotion.call(digestScope,getEmotions())}function init(){count?safeDigest():$$connector.send({actn:OTYPES.FETCH_EMOTION_LIST},OTYPES.REQUEST_TYPE.REQUEST)}var emotions={},OTYPES=OPERATION_TYPES.SYSTEM,count=0,SCOPES={};$$connector.subscribe(process,{action:OTYPES.FETCH_EMOTION_LIST});return{init:init,getEmotions:getEmotions,getLength:function(){return count},getEmotion:function(ob,createIfNotExist){var id=angular.isObject(ob)?ob.id:ob;return createIfNotExist?emotions[id]?emotions[id]:angular.isObject(ob)?createEmotion(ob):!1:emotions[id]||!1},setScopeForDigest:function(scope){SCOPES[scope.$id]=scope},removeScope:function(scope){SCOPES[scope.$id]&&(SCOPES[scope.$id]=null)}}}])}(),function(){"use strict";function InviteFactory($timeout,$$connector,OPERATION_TYPES,userFactory,Storage,friendsFactory,$$stackedMap,$q,Auth,$rootScope){function _processResponse(json){switch(json.actn){case OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW:if(json.sucs===!0){for(var i=0;i<json.contactIds.length;i++)_utIds.push(json.contactIds[i]);getSuggestionContactsDetails()}break;case OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS:if(json.sucs===!0){Factory.state.isRequestsLoading=!0;for(var i=0;i<json.contactList.length;i++)void 0===json.contactList[i].frnS&&(user=userFactory.create(json.contactList[i]),Factory.suggestionFriends.save(user.getUtId(),user),_utIds.splice(_utIds.indexOf(json.contactList[i].utId),1))}else RingLogger.information("form rgInviteResponse",RingLogger.tags.DIGEST),Factory.state.isRequestsLoading=!1;Factory.state.isRequestsLoading=!1}}function _getSuggestionUtids(){return $$connector.send({actn:OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW},REQTYPE.REQUEST)}function getSuggestionContactsDetails(count){if(count=count||10,!Factory.state.isRequestsLoading){RingLogger.information("form rgInvite",RingLogger.tags.DIGEST),Factory.state.isRequestsLoading=!0,setTimeout(function(){RingLogger.information("form rgInvite3",RingLogger.tags.DIGEST),Factory.state.isRequestsLoading=!1},3e3);var payload={actn:OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS,idList:_utIds.slice(0,count)};return RingLogger.print(payload,RingLogger.tags.DEFAULT,RingLogger.tags.INVITE),$$connector.send(payload,REQTYPE.REQUEST)}}function getMutualFriend(user){var params={actn:REQPRF.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:user.getUId()};return $$connector.pull(params,REQTYPE.REQUEST)}function removeSuggestion(utid,action){var defer=$q.defer(),payload={actn:33,utId:utid};return RingLogger.print(payload,RingLogger.tags.INVITE),$$connector.request(payload,REQTYPE.REQUEST).then(function(json){RingLogger.print(json,RingLogger.tags.INVITE),RingLogger.print("REMOVE SUGGESTION DATA",RingLogger.tags.INVITE),RingLogger.print(json.utId,RingLogger.tags.INVITE),json.sucs===!0&&("remove"!==action&&(RingLogger.print("not remove",RingLogger.tags.INVITE),friendsFactory.addToUtIdList("outgoingUtIds",json.utId)),Factory.suggestionFriends.length()<5&&getSuggestionContactsDetails(),defer.resolve(json))},function(errData){defer.reject(errData)}),defer.promise}var user,_utIds=[],OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE,REQPRF=OPERATION_TYPES.SYSTEM.PROFILE,Factory={state:{isRequestsLoading:!1},suggestionFriends:$$stackedMap.createNew(),getSuggestionContactsDetails:getSuggestionContactsDetails,removeSuggestion:removeSuggestion,getMutualFriend:getMutualFriend,allSuggestionFriends:$$stackedMap.createNew(),noOfSuggestions:function(){return Factory.suggestionFriends.length()}};return $$connector.subscribe(_processResponse,{action:[OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW,OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),Auth.isLoggedIn()?setTimeout(function(){_getSuggestionUtids()},5e3):$rootScope.$on(SystemEvents.AUTH.LOGIN,function(){setTimeout(function(){_getSuggestionUtids()},5e3)}),Factory}angular.module("ringid.common.invite_factory",["ringid.config","ringid.common.stacked_map","ringid.common.user_factory","ringid.utils","ringid.connector"]).factory("InviteFactory",InviteFactory),InviteFactory.$inject=["$timeout","$$connector","OPERATION_TYPES","userFactory","Storage","friendsFactory","$$stackedMap","$$q","Auth","$rootScope"]}(),function(){"use strict";angular.module("ringid.common.factories",["ringid.common.global_events_factory","ringid.common.storage_factory","ringid.common.events_factory","ringid.common.user_factory","ringid.common.stacked_map","ringid.common.image_factory","ringid.common.imagemap_factory","ringid.common.album_factory","ringid.common.comment_factory","ringid.common.emotion_factory","ringid.common.invite_factory"])}(),angular.module("ringid.common.rground_progress_directive",[]).directive("rgRoundProgress",[function(){var compilationFunction=function(templateElement,templateAttributes,transclude){if(1===templateElement.length){var width,height,outerCircleWidth,innerCircleWidth,outerCircleBackgroundColor,outerCircleForegroundColor,innerCircleColor,labelColor,outerCircleRadius,innerCircleRadius,labelFont,node=templateElement[0],canvas=document.createElement("canvas");return{pre:function(scope,instanceElement,instanceAttributes,controller){var scale=(window.outerWidth-20)/1920;width=+(scope.roundProgressBarStyle.dataRoundProgressWidth||"200")*scale,height=+(scope.roundProgressBarStyle.dataRoundProgressHeight||"200")*scale,canvas.setAttribute("width",width),canvas.setAttribute("height",height),canvas.setAttribute("data-round-progress-model",node.getAttribute("data-round-progress-model")),node.parentNode.replaceChild(canvas,node),outerCircleWidth=+(scope.roundProgressBarStyle.dataRoundProgressOuterCircleWidth||"4")*scale,innerCircleWidth=+(scope.roundProgressBarStyle.dataRoundProgressInnerCircleWidth||"8")*scale,outerCircleRadius=+(scope.roundProgressBarStyle.dataRoundProgressOuterCircleRadius||"85")*scale,innerCircleRadius=+(scope.roundProgressBarStyle.dataRoundProgressInnerCircleRadius||"85")*scale,labelFont=+(scope.roundProgressBarStyle.dataRoundProgressLabelFont||"24")*scale+"px Arial",outerCircleBackgroundColor=scope.roundProgressBarStyle.dataRoundProgressOuterCircleBackgroundColor||"#505769",outerCircleForegroundColor=scope.roundProgressBarStyle.dataRoundProgressOuterCircleForegroundColor||"#13A8E8",innerCircleColor=scope.roundProgressBarStyle.dataRoundProgressInnerCircleColor||"#505769",labelColor=scope.roundProgressBarStyle.dataRoundProgressLabelColor||"#fff"},post:function(scope,instanceElement,instanceAttributes,controller){var expression=canvas.getAttribute("data-round-progress-model");scope.$watch(expression,function(newValue,oldValue){var ctx=canvas.getContext("2d");ctx.clearRect(0,0,width,height);var x=width/2,y=height/2;ctx.beginPath(),ctx.arc(x,y,parseInt(innerCircleRadius),0,2*Math.PI,!1),ctx.lineWidth=parseInt(innerCircleWidth),ctx.strokeStyle="rgba(255,255,255,0.5)",ctx.globalCompositeOperation="source-over",ctx.stroke(),ctx.font=labelFont,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle=labelColor,ctx.fillText(newValue.label+"%",x,y);var startAngle=-(Math.PI/2),endAngle=2*Math.PI*newValue.percentage-Math.PI/2,anticlockwise=!1;ctx.beginPath(),ctx.arc(x,y,parseInt(outerCircleRadius),startAngle,endAngle,anticlockwise),ctx.lineWidth=parseInt(outerCircleWidth),ctx.strokeStyle=outerCircleForegroundColor,ctx.stroke()},!0)}}}},roundProgress={compile:compilationFunction,replace:!0};return roundProgress}]),angular.module("ringid.common.rgfocus_directive",[]).directive("rgFocus",["$timeout",function($timeout){var checkDirectivePrerequisites=function(attrs){if(!attrs.rgFocus&&""!=attrs.rgFocus)throw"FocusOnCondition missing attribute to evaluate"};return{restrict:"A",link:function(scope,element,attrs,ctrls){checkDirectivePrerequisites(attrs),scope.$watch(attrs.rgFocus,function(currentValue,lastValue){1==currentValue&&(element[0].focus(),RingLogger.print("current focus value"+currentValue,"rgFocus"))})}}}]),function(){"use strict";function rgPageTitle($rootScope,ChatFactory,utilsFactory,SystemEvents){var timerRef,blinkerInterval=1e3,currentTitle=document.title,getPageInActiveTitle=function(){var unreadMessageCount=ChatFactory.getUnreadMessageCount();return unreadMessageCount>0?"("+unreadMessageCount+") "+currentTitle:currentTitle},getPageActiveTitle=getPageInActiveTitle;return{link:function(scope,elem,attrs){$rootScope.$on("ringActive",function(){clearInterval(timerRef),document.title=getPageActiveTitle()}),$rootScope.$on("ringInactive",function(){timerRef=setInterval(function(){var inActivePageTitle=getPageInActiveTitle();document.title=document.title===inActivePageTitle?currentTitle:inActivePageTitle},blinkerInterval)}),utilsFactory.onCustomEvent(SystemEvents.CHAT.UNREAD_MESSAGE_INFO_UPDATED,function(){document.title=getPageActiveTitle()})}}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){return}ringUtilsModule.directive("rgPageTitle",rgPageTitle),rgPageTitle.$inject=["$rootScope","ChatFactory","utilsFactory","SystemEvents"]}(),function(){"use strict";function rgUrlOgPreview($ringhttp,$templateCache,$compile,utilsFactory){return{restrict:"E",replace:!0,scope:{onClick:"&",ogData:"=",showPreview:"=",loadingData:"=",filterOnProgress:"=",editMode:"@"},templateUrl:"",link:function(scope,element,attr){var templateUrl="pages/partials/url-og-preview.html";attr.template&&(templateUrl=attr.template),$ringhttp.get(templateUrl).success(function(tplContent){element.append($compile(tplContent)(scope)),scope.$rgDigest()})},controller:["$scope","$sce","settings",function($scope,$sce,settings){function onClick(){if($scope.ogData&&!$scope.ogData.images){var url=$scope.ogData.url;url&&window.open(url,"_blank")}}function setImageInOgInfo(){$scope.ogData.images&&($scope.ogData.image=$scope.ogData.images[$scope.selectedOgImageIndex])}function resetImageInOgInfo(){$scope.ogData.image=""}function resetTitleInOgInfo(){$scope.ogData.title=""}function resetDescriptionInOgInfo(){$scope.ogData.description=""}function resetUrlInOgInfo(){$scope.ogData.url=""}function resetLnkDmnInOgInfo(){$scope.ogData.lnkDmn=""}function setUrlMetaData(key,value){$scope.ogData.meta[key]=value}function initUrlMetaData(key,value){$scope.ogData.meta={youtube:!1,youtube_id:""}}function selectNextImage(){$scope.selectedOgImageIndex<$scope.ogData.images.length-1&&($scope.selectedOgImageIndex+=1),setImageInOgInfo(),utilsFactory.safeDigest($scope)}function selectPreviousImage(){$scope.selectedOgImageIndex>0&&($scope.selectedOgImageIndex-=1),setImageInOgInfo(),utilsFactory.safeDigest($scope)}function onImageCloseClick($event){$event.preventDefault(),$event.stopPropagation(),resetImageInOgInfo(),utilsFactory.safeDigest($scope)}function onDetailCloseClick($event){$event.preventDefault(),$event.stopPropagation(),resetTitleInOgInfo(),resetDescriptionInOgInfo(),resetUrlInOgInfo(),resetLnkDmnInOgInfo(),utilsFactory.safeDigest($scope)}function shouldShowNextButton(){return!!$scope.ogData.images&&$scope.selectedOgImageIndex<$scope.ogData.images.length-1}function shouldShowPreviousButton(){return $scope.selectedOgImageIndex>0}function isYoutubeUrl(){return!$scope.ogData.meta&&$scope.ogData.url&&(initUrlMetaData(),processUrl($scope.ogData.url)),!!$scope.ogData.meta&&$scope.ogData.meta.youtube}function getYoutubeId(){return $scope.ogData.meta.youtube_id}function getYoutubeUrl(){return $sce.trustAsResourceUrl("https://www.youtube.com/embed/"+getYoutubeId()+"?autoplay=0&autohide=1&border=0&wmode=opaque&enablejsapi=1")}function processUrl(url){var FULL_YOUTUBE_URL_REGX=/((http|https):\/{2})+((www\.)?youtube\.com)([?&]?([^=]+)=([^&]*))?/im;if(url){var matches=url.match(FULL_YOUTUBE_URL_REGX);matches&&matches[3]&&matches[7]?(setUrlMetaData("youtube",!0),setUrlMetaData("youtube_id",matches[7])):setUrlMetaData("youtube",!1)}}$scope.selectedOgImageIndex=0,$scope.onClick=onClick,$scope.onImageCloseClick=onImageCloseClick,$scope.onDetailCloseClick=onDetailCloseClick,$scope.selectPreviousImage=selectPreviousImage,$scope.selectNextImage=selectNextImage,$scope.shouldShowNextButton=shouldShowNextButton,$scope.shouldShowPreviousButton=shouldShowPreviousButton,$scope.isYoutubeUrl=isYoutubeUrl,$scope.getYoutubeUrl=getYoutubeUrl,initUrlMetaData(),processUrl($scope.ogData.url),$scope.ogData.url&&(/^https?:\/\//.test($scope.ogData.url)||($scope.ogData.url="http://"+$scope.ogData.url)),$scope.ogData.image&&(/^https?:\/\//.test($scope.ogData.image)||($scope.ogData.image="http://"+$scope.ogData.image),settings.secure&&/^http:/.test($scope.ogData.image)&&($scope.ogData.image=settings.httpsUrl+"/ImageProxy.png?url="+$scope.ogData.image.replace(/http:\/\//,"")))}]}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){return}ringUtilsModule.directive("rgUrlOgPreview",rgUrlOgPreview),rgUrlOgPreview.$inject=["$ringhttp","$templateCache","$compile","utilsFactory"]}(),function(){"use strict";function rgUrlOgFetcher($compile){return{restrict:"E",scope:{fetchedOgInfo:"=",editorContent:"=",showPreview:"=",filterOnProgress:"=",loadingData:"="},link:function(scope,element,attr){scope.fetchedOgInfo=scope.fetchedOgInfo||{},scope.filterOnProgress&&(scope.filterOnProgress=!1)},controller:["$scope","$rootScope","$timeout","utilsFactory",function($scope,$rootScope,$timeout,utilsFactory){function processModelUpdate(newValue,oldValue){if(shouldProcessModelChange(newValue,oldValue)){if(newValue&&URL_DETECTION_REGEX.test(newValue)){var matches=newValue.match(URL_DETECTION_REGEX),firstUrl=matches[1];if(firstUrl){var firstUrlDomain=matches[5]?matches[5]:"";if(/^https?:\/\//.test(firstUrl)||(firstUrl="http://"+firstUrl),!shouldProcessChange(firstUrl))return;var cachedValue=getFromUrlCache(firstUrl);cachedValue?(setFetchedOgInfo(cachedValue),showUrlOgInfoPreview(),emitFeedBoxHeightChange()):(showLoading(),emitFeedBoxHeightChange(),utilsFactory.getOGDetails(firstUrl).success(function(data){hideLoading(),data&&data.sucs?(setToUrlCache(firstUrl,data),data.lnkDmn=firstUrlDomain,data.url=firstUrl,data=fixFetchedOgInfo(data,firstUrl),setFetchedOgInfo(data),filterImages(),showUrlOgInfoPreview()):(resetFetchedOgInfo(),resetFilterOnProgress(),hideUrlOgInfoPreview()),emitFeedBoxHeightChange(),$scope.$parent.$rgDigest()}).error(function(data){resetFetchedOgInfo(),resetFilterOnProgress(),resetLastDetectedUrl(),hideUrlOgInfoPreview(),hideLoading(),emitFeedBoxHeightChange(),$scope.$parent.$rgDigest()}))}}else resetFetchedOgInfo(),hideUrlOgInfoPreview();$scope.$parent.$rgDigest()}}function shouldProcessChange(url){return $scope.fetchedOgInfo&&lastDetectedUrl==url?!1:(lastDetectedUrl=url,!0)}function setToUrlCache(url,data){urlCache[url]=data}function getFromUrlCache(url){urlCache[url]}function setFetchedOgInfo(fetchedOgInfo){$scope.fetchedOgInfo=fetchedOgInfo}function resetFetchedOgInfo(){$scope.fetchedOgInfo={}}function showLoading(){$scope.loadingData=!0}function hideLoading(){$scope.loadingData=!1}function isLoading(){return $scope.loadingData}function showUrlOgInfoPreview(){$scope.showPreview=!0}function hideUrlOgInfoPreview(){$scope.showPreview=!1}function setFilterOnProgress(){$scope.filterOnProgress=!0}function resetFilterOnProgress(){$scope.filterOnProgress=!1}function resetLastDetectedUrl(){lastDetectedUrl=""}function fixFetchedOgInfo(fetchedOgInfo,requestedUrl){
var fixedOgInfo=angular.extend({},fetchedOgInfo);return fixedOgInfo.url||(fixedOgInfo.url=requestedUrl),fixedOgInfo.title||(fixedOgInfo.title=fixedOgInfo.lnkDmn),fixedOgInfo}function emitFeedBoxHeightChange(){$timeout(function(){$rootScope.$broadcast("statusHeightChange")})}function setActiveImageInOgInfo(images){images.length>0&&($scope.fetchedOgInfo.image=images[0])}function setImagesInOgInfo(images){$scope.fetchedOgInfo.images=images}function filterImages(){var imageUrls=$scope.fetchedOgInfo.images;setFilterOnProgress(),utilsFactory.filterImagesByDimentions(imageUrls,{width:200}).then(function(filteredImages){$scope.filterOnProgress&&(setImagesInOgInfo(filteredImages),setActiveImageInOgInfo(filteredImages),resetFilterOnProgress()),$scope.$parent.$rgDigest()})}function shouldProcessModelChange(newValue,oldValue){return isLoading()?!1:$scope.fetchedOgInfo&&($scope.fetchedOgInfo.image||$scope.fetchedOgInfo.title||$scope.fetchedOgInfo.description)?!1:(resetLastDetectedUrl(),!0)}var URL_DETECTION_REGEX=/(((http|https):\/{2})?((([0-9a-z_-]+\.)+(aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mn|mn|mo|mp|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|nom|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ra|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw|arpa)|(0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.0*([1-9]?\d|1\d\d|2[0-4]\d|25[0-5])))(:[0-9]+)?((\/([~0-9a-zA-Z\#\+\%@\.\/_-]+))?(\?[0-9a-zA-Z\+\%@\/&\[\];=_-]+)?(\?[\w|\W]+)?)?))\b/im,urlCache={},lastDetectedUrl="";$scope.$watch("editorContent",utilsFactory.debounce(function(newValue,oldValue){processModelUpdate(newValue,oldValue),utilsFactory.safeDigest($scope)},500))}]}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){return}ringUtilsModule.directive("rgUrlOgFetcher",rgUrlOgFetcher),rgUrlOgFetcher.$inject=["$compile"]}(),function(){"use strict";function rgLoaderView(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"pages/partials/loading_view.html"}}function rgLoaderView1(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"pages/partials/loading_view1.html"}}function rgLoaderView2(){return{restrict:"E",replace:!0,scope:{isLoading:"="},templateUrl:"pages/partials/loading_view2.html"}}var ringUtilsModule;try{ringUtilsModule=angular.module("ringid.utils")}catch(e){return}ringUtilsModule.directive("rgLoaderView",rgLoaderView),ringUtilsModule.directive("rgLoaderView1",rgLoaderView1),ringUtilsModule.directive("rgLoaderView2",rgLoaderView2)}(),function(){"use strict";function Player(){this.dicts={maximize:"Back to normal view",minimize:"Go to small view",fullScreen:"Full Screen",playlist:"Playlist",auto:"Auto Play"},this.instances=[],this.template='<div class="rg-player"><div class="container"><div class="play-info"></div><div class="play-error"></div> <div class="music-bars"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><div class="big-play"><span class="icon-player"></span></div><div class="loader"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div></div><div class="player-poster"><img class="poster" /></div></div><div class="playlist-wrapper"></div><div class="media-control"><div class="media-tip"></div><div class="media-control-bg"></div><div class="media-control-layer"><div class="bar-panel"><div class="bar-container"><div class="bar-background"><div class="bar-fill-1"></div><div class="bar-fill-2"></div><div class="bar-hover"></div></div><div class="bar-scrubber"><div class="bar-scrubber-icon"></div></div><div class="seek-time"><div class="timer"></div></div></div></div><div class="control-left"><div class="play-btns"><button class="icon-previous-p control-btn prev-btn"></button><button class="icon-play-p control-btn start-btn"></button><button class="icon-next-p control-btn next-btn"></button></div><div class="volume-bar"><div class="icon-speaker-fill volume-icon unmute"></div><div class="volume-bar-container volume-bar-hide"><div class="bar fill"></div><div class="bar fill"></div><div class="bar fill"></div><div class="bar fill"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div></div><div class="time-indicator time-running"></div><div class="time-indicator time-total"></div></div><div class="control-right"><button class="control-btn hd">HD</button><button class="icon-minimize control-btn minimize" tooltip="'+this.dicts.minimize+'"></button><button class="icon-screen-f control-btn full-screen" tooltip="'+this.dicts.fullScreen+'"></button><button class="icon-play-list control-btn playlist-btn" tooltip="'+this.dicts.playlist+'"></button><button class="control-btn auto" tooltip="'+this.dicts.auto+'">AUTO</button></div></div></div></div>',this.trackTemplate='<a rel="data-rel" href="#"><span class="list-thumb"><img src="data-thumb" /></span><span class="list-title">data-caption<b>data-duration</b></span></a>',this.secToTime=function(seconds){seconds=Math.floor(seconds);var hours=parseInt(seconds/3600)%24,minutes=parseInt(seconds/60)%60,seconds=0>seconds?0:seconds%60,result="";return hours>0&&(result+=10>hours?"0"+hours:hours),result+=(10>minutes?"0"+minutes:minutes)+":"+(10>seconds?"0"+seconds:seconds)},this.findPos=function(el){var x=0,y=0;if(el.offsetParent)do x+=el.offsetLeft,y+=el.offsetTop;while(el=el.offsetParent);return{x:x,y:y}},this.destroy=function(instance){try{instance.removeEvent(),instance.provider.pause(),instance.provider.src="",instance.dom=null,delete instance.provider}catch(e){RingLogger.print("rg-player "+e.message,"DEFAULT")}},this.addRemoveClass=function(el,add,remove){var i;for(i=0;i<remove.length;i++)el.className=el.className.replace(remove[i],"").trim();for(i=0;i<add.length;i++)el.className+=" "+add[i]},this.createMediaObject=function(type){return"audio"==type?document.createElement("audio"):document.createElement("video")},this.getDefaultThumb=function(thumb){return thumb&&"images/audio-preview.jpg"!=thumb||(thumb="images/player-audio.png"),thumb},this.$get=["$compile","$document",function($compile,$document){var $this=this,$playerProvider={};return $playerProvider.escapeKey=!1,$playerProvider.miniPlayer={dom:null,parent:null,player:null},$playerProvider.wh=window.innerHeight,$playerProvider.destroy=function(){$this.instances.length>0&&$this.destroy($this.instances.pop())},$playerProvider.destroyAll=function(){for(var i=$this.instances.length-1;i>=0;i--)$this.destroy($this.instances.pop())},$playerProvider.showMiniPlayer=function(){$playerProvider.miniPlayer.player&&($playerProvider.miniPlayer.dom.appendChild($playerProvider.miniPlayer.player.parent),$playerProvider.miniPlayer.dom.style.display="block","PLAYING"==$playerProvider.miniPlayer.player.playingState&&$playerProvider.miniPlayer.player.provider.play())},$playerProvider.closeMiniPlayer=function(){$playerProvider.miniPlayer.player&&($playerProvider.ringboxRemove(),$playerProvider.destroy(),$playerProvider.miniPlayer.dom.parentNode.removeChild($playerProvider.miniPlayer.dom),$playerProvider.miniPlayer.dom=null,$playerProvider.miniPlayer.player=null)},$playerProvider.addToPlaylist=function(playlist){for(var i=$this.instances.length-1;i>=0;i--)if($this.instances[i].chat){$this.instances[i].AddToPlaylist(playlist);break}},$playerProvider.player=function(option){$playerProvider.ringboxRemove=option.ringboxRemove?option.ringboxRemove:function(){},option.chatVersion||$playerProvider.closeMiniPlayer();var $player={};$player.source=option.source||"",$player.autoPlay=option.autoPlay||!1,$player.auto=option.auto||!1,$player.parent=document.getElementById(option.parentId),$player.poster=option.poster||"",$player.mediaType=option.type||"video",$player.dom={},$player.playingState=this.autoPlay?"INIT":"STOPPED",$player.screenState="NORMAL",$player.volumeState="UNMUTE",$player.volume=5,$player.duration=0,$player.currentTrack=0,$player.playlist=option.playlist||[],$player.title=option.title||"",$player.playlistState=!1,$player.hd=!1,$player.isMouseDown=!1,$player.isLoading=$player.autoPlay,$player.isFirefox=!!navigator.userAgent.match(/firefox/i),$player.canPlay=!0,$player.chat=!!option.chatVersion,$player.provider=$this.createMediaObject($player.mediaType),$player.parent.innerHTML=$this.template,$player.dom.player=$player.parent.querySelector(".rg-player"),$player.dom.container=$player.parent.querySelector(".container"),$player.dom.playlistWrap=$player.parent.querySelector(".playlist-wrapper"),$player.dom.control=$player.parent.querySelector(".media-control"),$player.dom.bigBlay=$player.dom.container.querySelector(".big-play"),$player.dom.bigBlayIcon=$player.dom.bigBlay.querySelector("span"),$player.dom.playError=$player.dom.container.querySelector(".play-error"),$player.dom.playInfo=$player.dom.container.querySelector(".play-info"),$player.dom.musicBar=$player.dom.container.querySelector(".music-bars"),$player.dom.loader=$player.dom.container.querySelector(".loader"),$player.dom.poster=$player.dom.container.querySelector(".player-poster"),$player.dom.posterImg=$player.dom.poster.querySelector(".poster"),$player.dom.barContainer=$player.dom.control.querySelector(".bar-container"),$player.dom.barScrubber=$player.dom.control.querySelector(".bar-scrubber"),$player.dom.barLoaded=$player.dom.control.querySelector(".bar-fill-1"),$player.dom.barPosition=$player.dom.control.querySelector(".bar-fill-2"),$player.dom.barHover=$player.dom.control.querySelector(".bar-hover"),$player.dom.controlLayer=$player.dom.control.querySelector(".media-control-layer"),$player.dom.controlBG=$player.dom.control.querySelector(".media-control-bg"),$player.dom.controlTip=$player.dom.control.querySelector(".media-tip"),$player.dom.playBtn=$player.dom.control.querySelector(".start-btn"),$player.dom.nextBtn=$player.dom.control.querySelector(".next-btn"),$player.dom.prevBtn=$player.dom.control.querySelector(".prev-btn"),$player.dom.timeRunning=$player.dom.control.querySelector(".time-running"),$player.dom.timeTotal=$player.dom.control.querySelector(".time-total"),$player.dom.hd=$player.dom.control.querySelector(".hd"),$player.dom.playlistBtn=$player.dom.control.querySelector(".playlist-btn"),$player.dom.minimize=$player.dom.control.querySelector(".minimize"),$player.dom.auto=$player.dom.control.querySelector(".auto"),$player.dom.volumeIcon=$player.dom.control.querySelector(".volume-icon"),$player.dom.volumeBarContainer=$player.dom.control.querySelector(".volume-bar-container"),$player.dom.volumeBars=$player.dom.volumeBarContainer.querySelectorAll(".bar"),$player.dom.fullScreenBtn=$player.dom.control.querySelector(".full-screen"),$player.dom.seekTimer=$player.dom.control.querySelector(".seek-time"),$player.dom.timer=$player.dom.control.querySelector(".timer"),$player.dom.playlist=null,$player.dom.player.style.width=option.width?option.width+"px":"100%",$player.dom.player.style.height=option.height?option.height+"px":"100%",$player.dom.timeRunning.innerHTML="00:00",$player.dom.timeTotal.innerHTML="00:00",option.chatVersion&&($player.dom.minimize.style.display="none"),$player.dom.poster.appendChild($player.provider),$playerProvider.miniPlayer.parent=$player.parent.parentNode;var playerFullScreen=function(){var isFullScreen=document.mozFullScreen||document.webkitIsFullScreen;isFullScreen||"FULL"!=$player.screenState||$player.fullScreen()},playerKeyEvt=function(evt){var keyCode=evt.which||evt.keyCode||evt.key;32===keyCode&&$player.playPause()};return $player.initEvent=function(){$player.dom.playBtn.addEventListener("click",function(e){e.stopPropagation(),$player.playPause()},!1),$player.dom.nextBtn.addEventListener("click",function(e){e.stopPropagation(),$player.playNext()},!1),$player.dom.prevBtn.addEventListener("click",function(e){e.stopPropagation(),$player.playPrev()},!1),$player.dom.volumeIcon.addEventListener("click",function(e){e.stopPropagation(),$player.muteUnmute()},!1),$player.dom.fullScreenBtn.addEventListener("click",function(e){e.stopPropagation(),$player.fullScreen()},!1),$player.dom.minimize.addEventListener("click",function(e){e.stopPropagation(),$player.minimize()},!1),$player.dom.barContainer.addEventListener("mousemove",function(e){$player.timeInfo(e),$player.isMouseDown&&$player.setPosition(e,!1)},!1),$player.dom.barContainer.addEventListener("mousedown",function(e){$player.isMouseDown=!0,$this.addRemoveClass($player.dom.barContainer,["down"],[])},!1),$player.dom.barContainer.addEventListener("mouseup",function(e){$player.isMouseDown=!1,$player.setPosition(e,!0),$this.addRemoveClass($player.dom.barContainer,[],["down"])},!1),$player.dom.barContainer.addEventListener("mouseleave",function(e){$player.isMouseDown=!1,$this.addRemoveClass($player.dom.barContainer,[],["down"])},!1),$player.dom.container.addEventListener("click",function(e){return e.stopPropagation(),$player.playlistState?void $player.showPlaylist(!1):void $player.playPause()},!1),$player.dom.player.addEventListener("mouseover",function(e){e.stopPropagation(),$player.showControl(!0)},!1),$player.dom.player.addEventListener("mouseleave",function(e){e.stopPropagation(),$player.showControl(!1)},!1),$player.dom.playlistBtn.addEventListener("click",function(e){e.stopPropagation(),$playerProvider.miniPlayer.player&&$player.maximize(),$player.showPlaylist()},!1),$player.dom.auto.addEventListener("click",function(e){e.stopPropagation(),$player.setAuto()},!1);for(var i=0;i<$player.dom.volumeBars.length;i++)!function(i){$player.dom.volumeBars[i].addEventListener("click",function(e){e.stopPropagation(),$player.changeVolume(i)})}(i);$player.dom.auto.addEventListener("mouseover",function(e){e.stopPropagation(),$player.showTootip(e,this.getAttribute("tooltip"))},!1),$player.dom.auto.addEventListener("mouseleave",function(e){e.stopPropagation(),$player.dom.controlTip.style.display="none"},!1),$player.dom.minimize.addEventListener("mouseover",function(e){e.stopPropagation(),$player.showTootip(e,this.getAttribute("tooltip"))},!1),$player.dom.minimize.addEventListener("mouseleave",function(e){e.stopPropagation(),$player.dom.controlTip.style.display="none"},!1),$player.dom.fullScreenBtn.addEventListener("mouseover",function(e){e.stopPropagation(),$player.showTootip(e,this.getAttribute("tooltip"))},!1),$player.dom.fullScreenBtn.addEventListener("mouseleave",function(e){e.stopPropagation(),$player.dom.controlTip.style.display="none"},!1),$player.dom.playlistBtn.addEventListener("mouseover",function(e){e.stopPropagation(),$player.showTootip(e,this.getAttribute("tooltip"))},!1),$player.dom.playlistBtn.addEventListener("mouseleave",function(e){e.stopPropagation(),$player.dom.controlTip.style.display="none"},!1),document.addEventListener("mozfullscreenchange",playerFullScreen,!1),document.addEventListener("webkitfullscreenchange",playerFullScreen,!1),document.addEventListener("fullscreenchange",playerFullScreen,!1),document.addEventListener("keyup",playerKeyEvt,!1),$player.setMediaEvent(),$player.createPlaylist(),$player.showPoster(!0),$player.auto&&$player.setAuto(!0)},$player.setMediaEvent=function(){$player.provider.addEventListener("loadedmetadata",function(event,data){$player.initTime($player.provider.duration),$player.autoPlay&&$player.play()}),$player.provider.addEventListener("progress",function(){var buffered=$player.provider.buffered.length>0?$player.provider.buffered.end($player.provider.buffered.length-1):0,bufferState=$player.provider.currentTime+.05>=buffered?"BUFFERING":"PLAYING_BUFFERING";$player.showBuffered(buffered,$player.provider.duration),$player.stateChanged(bufferState)}),$player.provider.addEventListener("timeupdate",function(){$player.provider&&!$player.isMouseDown&&$player.showPosition($player.provider.currentTime,$player.provider.duration)}),$player.provider.addEventListener("play",function(){$player.stateChanged("PLAYING"),"video"==$player.mediaType&&$player.showPoster(!1),angular.isFunction(option.scope.onStart())&&option.scope.onStart()()}),$player.provider.addEventListener("pause",function(){$player.stateChanged("PAUSED"),"video"==$player.mediaType&&$player.showPoster(!1)}),$player.provider.addEventListener("ended",function(){$player.stateChanged("ENDED"),"video"==$player.mediaType&&$player.showPoster(!1),angular.isFunction(option.scope.onEnded())&&option.scope.onEnded()()}),$player.provider.addEventListener("stalled",function(){!$player.provider}),$player.provider.addEventListener("error",function(){$player.provider&&($player.error=$player.provider.error.code,$player.canPlay=!1,$player.showError())})},$player.removeEvent=function(){document.removeEventListener("mozfullscreenchange",playerFullScreen),document.removeEventListener("webkitfullscreenchange",playerFullScreen),document.removeEventListener("fullscreenchange",playerFullScreen),document.removeEventListener("keyup",playerKeyEvt)},$player.maximize=function(){return $playerProvider.miniPlayer.player?(option.ringboxMaximize($playerProvider.miniPlayer.parent,$player.parent),"PLAYING"==$player.playingState&&$player.provider.play(),$playerProvider.miniPlayer.dom.parentNode.removeChild($playerProvider.miniPlayer.dom),$playerProvider.miniPlayer.dom=null,$playerProvider.miniPlayer.player=null,$this.addRemoveClass($player.dom.minimize,["icon-minimize"],["icon-maximize"]),$player.dom.fullScreenBtn.style.display="block",void $player.dom.minimize.setAttribute("tooltip",$this.dicts.minimize)):void 0},$player.minimize=function(){if($playerProvider.miniPlayer.player)return void $player.maximize();var doc,wh,mouseMove=!1,fromMouseMove=!1,mouseResize=!1,mini=document.createElement("div"),mini_move=document.createElement("div"),mini_resize=document.createElement("div"),mini_close=document.createElement("a"),pw=350,ph=120;mini_close.setAttribute("class","mini-close"),mini_close.innerHTML='<div class="icon-close pop-close"></div>',mini_move.setAttribute("class","move-player"),mini_move.appendChild(mini_close),mini.setAttribute("id","mini-player"),mini.setAttribute("class","mini-player"),mini_resize.setAttribute("class","resize-player"),mini.style.display="none",mini.appendChild(mini_move),mini.appendChild(mini_resize),document.body.appendChild(mini),$player.showPlaylist(!0),$playerProvider.miniPlayer.dom=mini,$playerProvider.miniPlayer.player=$player,$player.dom.minimize.setAttribute("tooltip",$this.dicts.maximize),option.ringboxMinimize(),doc=angular.element(document),wh="FULL"==$player.screenState?$playerProvider.wh:window.innerHeight,mini.style.top=wh-ph+"px",$this.addRemoveClass($player.dom.minimize,["icon-maximize"],["icon-minimize"]),$player.dom.fullScreenBtn.style.display="none",mini_close.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),$playerProvider.closeMiniPlayer()}),mini_move.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),mouseMove=!0;var ww=window.innerWidth,wh=window.innerHeight,ol=mini.offsetLeft-e.clientX,ot=mini.offsetTop-e.clientY;doc.on("mousemove",function(event){fromMouseMove=!0,mouseMove&&fastdom.read(function(){mini_resize&&(document.body.style.cursor="move",mini_resize.style.cursor="move",$player.dom.container.style.cursor="move",fastdom.write(function(){event.clientX+ol>=200&&event.clientX+ol<=ww-pw-210&&(mini.style.left=event.clientX+ol+"px"),event.clientY+ot>=50&&event.clientY+ot<=wh-ph&&(mini.style.top=event.clientY+ot+"px")}))})}),doc.on("mouseup",function(event){event.stopPropagation(),mouseMove=!1,document.body.style.cursor="default",mini_resize.style.cursor="ns-resize",$player.dom.container.style.cursor="pointer",doc.off("mousemove"),doc.off("mouseup")})}),mini_move.addEventListener("click",function(e){return fromMouseMove?void(fromMouseMove=!1):void $player.playPause()},!1),mini_resize.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),mouseResize=!0;var y=(window.innerWidth,window.innerHeight,e.clientY);doc.on("mousemove",function(event){mouseResize&&fastdom.read(function(){if(mini){var height=mini.offsetHeight,top=parseInt(mini.style.top.replace("px",""));fastdom.write(function(){document.body.style.cursor="ns-resize",mini_move.style.cursor="ns-resize",$player.dom.container.style.cursor="ns-resize",y>=event.clientY&&250>height&&(height+=3,top-=3,mini.style.height=height+"px",mini.style.top=top+"px",y=event.clientY),y<event.clientY&&height>120&&(height-=3,top+=3,mini.style.height=height+"px",mini.style.top=top+"px",y=event.clientY)})}})}),doc.on("mouseup",function(event){event.stopPropagation(),mouseResize=!1,document.body.style.cursor="default",mini_move.style.cursor="move",$player.dom.container.style.cursor="pointer",doc.off("mousemove"),doc.off("mouseup"),doc.off("blur")})})},$player.playPause=function(){return $player.canPlay?"PLAYING"==$player.playingState?($player.pause(),$player.showLoader(),$player.showBigPlay(),$player.showControl(!1),$player.showPlaylist(!0),void $player.showInfo(!0)):"PAUSED"==$player.playingState?($player.resume(),$player.showLoader(),$player.showBigPlay(),void $player.showInfo()):"STOPPED"==$player.playingState?($player.play(),$player.showLoader(),$player.showBigPlay(),$player.showPlaylist(!0),void $player.showInfo()):void 0:void 0},$player.muteUnmute=function(){return"UNMUTE"==$player.volumeState?($player.setVolume(0),$this.addRemoveClass($player.dom.volumeIcon,["icon-speaker-m"],["icon-speaker-fill"]),void($player.volumeState="MUTE")):"MUTE"==$player.volumeState?($player.setVolume($player.volume),$this.addRemoveClass($player.dom.volumeIcon,["icon-speaker-fill"],["icon-speaker-m"]),void($player.volumeState="UNMUTE")):void 0},$player.initTime=function(duration){$player.dom.timeTotal.innerHTML=$this.secToTime(duration),$player.duration=duration},$player.showPosition=function(position,duration){0==$player.duration&&duration>0&&$player.initTime(duration),position>duration&&$player.initTime(position),$player.dom.timeRunning.innerHTML=$this.secToTime(position),$player.dom.barScrubber.style.left=0==$player.duration?"-"+$player.dom.barScrubber.offsetWidth/2+"px":"calc("+position/$player.duration*100+"% - "+$player.dom.barScrubber.offsetWidth/2+"px)",$player.dom.barPosition.style.width=0==$player.duration?"0%":position/$player.duration*100+"%"},$player.showBuffered=function(buffered,duration){0==$player.duration&&duration>0&&$player.initTime(duration),$player.dom.barLoaded.style.width=0==$player.duration?"0%":buffered/$player.duration*100+"%"},$player.timeInfo=function(event){var pos="FULL"==$player.screenState?{x:0,y:0}:$this.findPos($player.dom.barContainer),diff=event.pageX-pos.x,curTime=Math.round(diff*$player.duration/$player.dom.barContainer.offsetWidth);0>curTime&&(curTime=0),$player.dom.timer.innerHTML=$this.secToTime(curTime),$player.dom.seekTimer.style.left=diff-$player.dom.seekTimer.offsetWidth/2+"px",$player.dom.barHover.style.left=diff-$player.dom.barHover.offsetWidth/2+"px"},$player.showTootip=function(event,text){var pos="FULL"==$player.screenState?{x:0,y:0}:$this.findPos($player.dom.barContainer),diff=event.pageX-pos.x;$player.dom.controlTip.innerHTML=text,$player.dom.controlTip.style.display="block";var pw=$player.dom.barContainer.offsetWidth,tw=$player.dom.controlTip.offsetWidth;diff=tw/2+diff>=pw?pw-tw/2:diff,$player.dom.controlTip.style.left=diff-tw/2+"px"},$player.setPosition=function(event,seek){if("STOPPED"!=$player.playingState&&$player.canPlay){var pos="FULL"==$player.screenState?{x:0,y:0}:$this.findPos($player.dom.barContainer),diff=event.pageX-pos.x,curTime=Math.round(diff*$player.duration/$player.dom.barContainer.offsetWidth);seek&&$player.seek(curTime),$player.showPosition(curTime)}},$player.changeVolume=function(volume){var i;for(i=0;i<$player.dom.volumeBars.length;i++)$this.addRemoveClass($player.dom.volumeBars[i],[],["fill"]);for(i=0;volume>=i;i++)$this.addRemoveClass($player.dom.volumeBars[i],["fill"],[]);return $player.volume=volume+1,"MUTE"==$player.volumeState?void $player.muteUnmute():void $player.setVolume($player.volume)},$player.showHD=function(){$player.hd?$player.dom.hd.style.display="inline-block":$player.dom.hd.style.display="none"},$player.showPoster=function(show){""!=$player.poster&&(show?($player.dom.posterImg.src=$player.poster,$player.dom.posterImg.style.display="inline-block"):$player.dom.posterImg.style.display="none")},$player.showInfo=function(force){if(""==$player.title||"audio"!=$player.mediaType||force?$player.dom.playInfo.style.display="none":($player.dom.playInfo.innerHTML=$player.title,$player.dom.playInfo.style.display="block"),$player.playlist.length>0){var thumb=$player.playlist[$player.currentTrack].value.getThumb();thumb=$this.getDefaultThumb(thumb),$player.poster=thumb,"audio"==$player.mediaType&&$player.showPoster(!0)}},$player.showLoader=function(){$player.isLoading&&$player.canPlay?$player.dom.loader.style.display="block":$player.dom.loader.style.display="none",$player.showMusicBar(),$player.showBigPlay()},$player.showError=function(){$player.dom.playError.innerHTML="Sorry, your browser does not support this media format.",$player.showLoader(),$player.canPlay?$player.dom.playError.style.display="none":($player.showPoster(!1),$player.dom.playError.style.display="block")},$player.showBigPlay=function(replay){return $player.canPlay?(replay?$this.addRemoveClass($player.dom.bigBlayIcon,["icon-reload-p"],[]):$this.addRemoveClass($player.dom.bigBlayIcon,[],["icon-reload-p"]),"PAUSED"!=$player.playingState&&"STOPPED"!=$player.playingState||$player.isLoading?$player.dom.bigBlay.style.display="none":$player.dom.bigBlay.style.display="block",void $player.showMusicBar()):void($player.dom.bigBlay.style.display="none")},$player.initPlaylist=function(){$player.playlist.length>1?($player.dom.playlistBtn.style.display="inline-block",$player.dom.prevBtn.style.display="inline-block",$player.dom.nextBtn.style.display="inline-block",$player.dom.auto.style.display="inline-block"):($player.dom.playlistBtn.style.display="none",$player.dom.prevBtn.style.display="none",$player.dom.nextBtn.style.display="none",$player.dom.auto.style.display="none"),$player.dom.playlistWrap.style.right="-250px"},$player.showPlaylist=function(forceHide){return $player.playlistState||forceHide?($player.dom.playlistWrap.style.right="-250px",$player.dom.playlistWrap.style.zIndex=999,void($player.playlistState=!1)):$player.playlistState?void 0:($player.dom.playlistWrap.style.right="0",$player.dom.playlistWrap.style.zIndex=1e4,void($player.playlistState=!0))},$player.createPlaylist=function(){if(!($player.playlist.length<2)){for(var thumb,track,playlist='<div class="playlist-scrollbar-wrapper"><div rg-scrollbar="true" class="playlist-scrollbar"><ul class="playlist">',i=0;i<$player.playlist.length;i++)thumb=$player.playlist[i].value.getThumb(),thumb=$this.getDefaultThumb(thumb),track=$this.trackTemplate.replace(/data-rel/g,i),track=track.replace(/data-thumb/g,thumb),track=track.replace(/data-caption/g,$player.playlist[i].value.getCaption()),track=track.replace(/data-duration/g,$this.secToTime($player.playlist[i].value.getDuration())),$player.source==$player.playlist[i].value.getStreamUrl()&&($player.currentTrack=i),playlist+="<li>"+track+"</li>";playlist+="</ul></div></div>",$player.dom.playlistWrap.innerHTML="",$player.dom.playlistWrap.appendChild($compile(playlist)(option.scope)[0]),$player.dom.playlistUL=$player.dom.playlistWrap.querySelector(".playlist"),$player.dom.playlist=$player.dom.playlistWrap.querySelectorAll("ul.playlist > li > a"),option.scope.$parent.$rgDigest(),RingLogger.info("from player",RingLogger.tags.DIGEST);for(var i=0;i<$player.dom.playlist.length;i++)$player.dom.playlist[i].addEventListener("click",function(e){e.preventDefault(),$player.currentTrack=this.getAttribute("rel"),$player.title=$player.playlist[$player.currentTrack].value.getCaption(),$player.load($player.playlist[$player.currentTrack].value.getStreamUrl())})}},$player.updatePlaylist=function(playlist){playlist&&($player.playlist=playlist,$player.createPlaylist())},$player.AddToPlaylist=function(playlist){var thumb,track;if(!$player.dom.playlistUL)return void $player.updatePlaylist(playlist);if(playlist&&$player.dom.playlistUL)for(var i=0;i<playlist.length;i++){var li=document.createElement("li");thumb=playlist[i].value.getThumb(),thumb=$this.getDefaultThumb(thumb),track=$this.trackTemplate.replace(/data-rel/g,i),track=track.replace(/data-thumb/g,thumb),track=track.replace(/data-caption/g,playlist[i].value.getCaption()),track=track.replace(/data-duration/g,$this.secToTime(playlist[i].value.getDuration())),li.innerHTML=track,$player.dom.playlistUL.appendChild(li)}},$player.dom.playlistUL,$player.setTrack=function(){if(!($player.playlist.length<2)){0==$player.currentTrack?$this.addRemoveClass($player.dom.prevBtn,["disabled"],[]):$this.addRemoveClass($player.dom.prevBtn,[],["disabled"]),$player.currentTrack==$player.playlist.length-1?$this.addRemoveClass($player.dom.nextBtn,["disabled"],[]):$this.addRemoveClass($player.dom.nextBtn,[],["disabled"]);for(var i=0;i<$player.dom.playlist.length;i++)i==$player.currentTrack?$this.addRemoveClass($player.dom.playlist[i],["active"],["active"]):$this.addRemoveClass($player.dom.playlist[i],[],["active"]);$player.showInfo()}},$player.setAuto=function(force){return force?void $this.addRemoveClass($player.dom.auto,["enbled"],[]):$player.auto?($player.auto=!1,void $this.addRemoveClass($player.dom.auto,[],["enbled"])):$player.auto?void 0:($player.auto=!0,void $this.addRemoveClass($player.dom.auto,["enbled"],[]))},$player.showMusicBar=function(){"audio"!=$player.mediaType||"PLAYING"!=$player.playingState||$player.isLoading?$player.dom.musicBar.style.display="none":$player.dom.musicBar.style.display="block"},$player.showControl=function(show){$playerProvider.miniPlayer.player||("PLAYING"==$player.playingState&&show?($player.dom.controlLayer.style.bottom="0px",$player.dom.controlBG.style.opacity=1):($player.dom.controlLayer.style.bottom="-60px",$player.dom.controlBG.style.opacity=0))},$player.stateChanged=function(state){"BUFFERING"==state?$player.isLoading=!0:$player.isLoading=!1,$player.showLoader(),"PLAYING"==state&&($player.playingState="PLAYING",$player.showBigPlay(),$this.addRemoveClass($player.dom.playBtn,["icon-pause-p"],["icon-play-p"])),"ENDED"!=state&&"IDLE"!=state||($player.playingState="STOPPED",$player.showBigPlay(!0),$player.showPlaylist(!0),$this.addRemoveClass($player.dom.playBtn,["icon-play-p"],["icon-pause-p"]),$player.initTime(0),$player.showPosition(0),$player.showInfo(!0),$player.auto&&$player.playlist.length>0&&$player.playNext())},$player.reset=function(){$player.isLoading=!0,$player.initTime(0),$player.showPosition(0),$player.showBuffered(0),$player.showLoader(),$player.showInfo()},$player.fullScreen=function(){if("NORMAL"==$player.screenState){if($player.dom.player.requestFullscreen)$player.dom.player.requestFullscreen();else if($player.dom.player.mozRequestFullScreen)$player.dom.player.mozRequestFullScreen();else{if(!$player.dom.player.webkitRequestFullScreen)return!1;$player.dom.player.webkitRequestFullScreen()}return $player.screenState="FULL",$player.showControl(!0),$this.addRemoveClass($player.dom.player,["full"],[]),$this.addRemoveClass($player.dom.fullScreenBtn,["icon-screen-fe"],["icon-screen-f"]),
$playerProvider.miniPlayer.dom&&$this.addRemoveClass($playerProvider.miniPlayer.dom,["full"],[]),$player.dom.fullScreenBtn.setAttribute("tooltip",$this.dicts.maximize),!0}return"FULL"==$player.screenState?(document.cancelFullscreen?document.cancelFullscreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),$this.addRemoveClass($player.dom.player,[],["full"]),$this.addRemoveClass($player.dom.fullScreenBtn,["icon-screen-f"],["icon-screen-fe"]),$playerProvider.miniPlayer.dom&&$this.addRemoveClass($playerProvider.miniPlayer.dom,[],["full"]),$player.showControl(!1),$player.screenState="NORMAL",$playerProvider.escapeKey=!0,$player.dom.fullScreenBtn.setAttribute("tooltip",$this.dicts.fullScreen),!0):void 0},$player.playNext=function(){$player.currentTrack!=$player.playlist.length-1&&($player.currentTrack++,$player.title=$player.playlist[$player.currentTrack].value.getCaption(),$player.load($player.playlist[$player.currentTrack].value.getStreamUrl()),option.onNext&&option.onNext.apply(option.scope))},$player.playPrev=function(){0!=$player.currentTrack&&($player.currentTrack--,$player.title=$player.playlist[$player.currentTrack].value.getCaption(),$player.load($player.playlist[$player.currentTrack].value.getStreamUrl()),option.onNext&&option.onNext.apply(option.scope))},$player.getPlaylistUI=function(){return $player.dom.playlistWrap},$player.getNextUI=function(){return $player.dom.nextBtn},$player.getPrevUI=function(){return $player.dom.prevBtn},$player.load=function(url){$player.reset(),$player.setTrack(),$player.provider.pause(),$player.seek(0),$player.provider.src=url,$player.source=url,angular.isFunction(option.scope.onChange())&&$player.playlist.length>0&&option.scope.onChange()($player.playlist[$player.currentTrack].value)},$player.play=function(){$player.provider.play(),$player.playingState="PLAYING",$this.addRemoveClass($player.dom.playBtn,["icon-pause-p"],["icon-play-p"])},$player.pause=function(){$player.provider.pause(),$player.playingState="PAUSED",$this.addRemoveClass($player.dom.playBtn,["icon-play-p"],["icon-pause-p"])},$player.resume=function(){$player.provider.play(),$player.playingState="PLAYING",$this.addRemoveClass($player.dom.playBtn,["icon-pause-p"],["icon-play-p"])},$player.seek=function(offset){try{$player.provider.currentTime=offset}catch(e){}},$player.stop=function(){$player.provider.pause(),$player.seek(0),$player.playingState="STOPPED",$this.addRemoveClass($player.dom.playBtn,["icon-play-p"],["icon-pause-p"])},$player.setVolume=function(volume){$player.provider.volume=volume/10},$player.initEvent(),$player.showControl(),$player.showLoader(),$player.showBigPlay(),$player.showError(),$player.showInfo(),$player.showMusicBar(),$player.initPlaylist(),$player.showHD(),$player.playingState="STOPPED",$player.provider.autoPlay=!1,$player.load(option.source),$player.setVolume($player.volume),$this.instances.push($player),$player},$playerProvider}]}function rgPlayer($compile,$player,$ringbox){function link(scope,element,attrs){var id=attrs.id?attrs.id:"player_1",width=attrs.width?attrs.width:"100%",height=attrs.height?attrs.height:"100%",auto="false"!=attrs.auto&&0!=attrs.auto,src=attrs.url?attrs.url:"",title=attrs.title?attrs.title:"",type="true"==attrs.isVideo||0==attrs.isVideo?"video":"audio",poster=attrs.poster?attrs.poster:"audio"==type?"images/player-audio.png":"",autoPlay="false"!=attrs.autoPlay&&0!=attrs.autoPlay,chat="true"==attrs.chat||1==attrs.chat,player=null;poster&&"images/audio-preview.jpg"!=poster||(poster="images/player-audio.png");var tpl='<div id="player_'+id+'" class="player '+type+'"></div>';element.append(tpl),setTimeout(function(){player=$player.player({source:src,title:title,playlist:scope.playlist,auto:auto,type:type,parentId:"player_"+id,autoPlay:autoPlay,chatVersion:chat,width:width,height:height,poster:poster,ringboxMinimize:$ringbox.minimize,ringboxMaximize:$ringbox.maximize,ringboxRemove:$ringbox.removeMinimize,scope:scope})})}return{restrict:"E",scope:{onChange:"&",onStart:"&",onEnded:"&",playlist:"="},link:link}}angular.module("ringid.common.rgplayer_directive",[]).provider("$player",Player).directive("rgPlayer",rgPlayer),rgPlayer.$inject=["$compile","$player","$ringbox"]}(),function(){"use strict";function rgLoading($rootScope,SystemEvents){return{restrict:"E",template:'<a class="glo-l ng-cloak"> <span class="load-circle"><span class="ld-cir1 glo-cir"></span><span class="ld-cir2 glo-cir"></span><span class="ld-cir3 glo-cir"></span><span class="ld-cir4 glo-cir"></span><span class="ld-cir5 glo-cir"></span><span class="ld-cir6 glo-cir"></span><span class="ld-cir7 glo-cir"></span><span class="ld-cir8 glo-cir"></span><span class="ld-cir9 glo-cir"></span><span class="ld-cir10 glo-cir"></span><span class="ld-cir11 glo-cir"></span><span class="ld-cir12 glo-cir"></span></span><span class="glo-type">Processing...</span></a>',scope:{rgLoadingObj:"="},link:function(scope,element){$rootScope.$on(SystemEvents.AUTH.LOGIN,function(){element[0].style.display="none",scope.$rgDigest()}),$rootScope.$on(SystemEvents.LOADING,function(event,bool){bool?element[0].style.display="block":element[0].style.display="none"}),element[0].style.display="none"}}}angular.module("ringid.common.rgloading_directive",[]).directive("rgLoading",rgLoading),rgLoading.$inject=["$rootScope","SystemEvents"]}(),function(){"use strict";function rgRecorder(user_props){var self=this,_props={recordedImage:{width:0,height:0,image:""},recordedVideo:{width:0,height:0,video:""},mediaPreview:{width:400,height:400},mediaStream:"",mediaObject:"",isStreaming:!1};angular.extend(_props,user_props),this._callbacks={streamReady:_streamReady,error:_onError};var _streamReady=function(){},_onError=function(){},initNavigatorMedia=function(){navigator.getMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia},initMediaEvents=function(){self.getMediaObject().addEventListener("canplay",self.onCanPlay,!1)},getVideoObjectFromStream=function(stream){var video=document.createElement("video");if(navigator.mozGetUserMedia)video.mozSrcObject=stream;else{var vendorURL=window.URL||window.webkitURL;video.src=vendorURL.createObjectURL(stream)}return video},processMediaStream=function(stream){_props.mediaStream=stream,_props.mediaObject=getVideoObjectFromStream(stream),initMediaEvents()},onFailure=function(e){self.triggerEvent("error",{text:"Please Enable Webcam Permission"}),RingLogger.alert("rgRecorder failure",e,RingLogger.tags.RG_RECRODER)};self.on=function(eventName,func){self._callbacks[eventName]=func},self.triggerEvent=function(eventName,data){self._callbacks[eventName]&&self._callbacks[eventName].call(self,data)},self.getProps=function(){return _props},self.getMediaPreview=function(){return _props.mediaPreview},self.getMediaObject=function(){return _props.mediaObject},self.getStream=function(){return _props.mediaStream},self.setStream=function(stream){_props.mediaStream=stream},self.isStreaming=function(isStreaming){return isStreaming?void(_props.isStreaming=isStreaming):_props.isStreaming},self.startRecording=function(){self.getStream().record()},self.stopRecording=function(){self.getStream().stop()},self.getRecordedMedia=function(callback){self.getStream().getRecordedData(callback)},self.captureImage=function(){var mediaObject=self.getMediaObject(),canvas=document.createElement("canvas"),context=canvas.getContext("2d");return mediaObject.width&&mediaObject.height?(canvas.width=mediaObject.width,canvas.height=mediaObject.height,context.drawImage(mediaObject,0,0,mediaObject.width,mediaObject.height),canvas.toDataURL("image/jpeg")):!1},self.onCanPlay=function(ev){var mediaObject=self.getMediaObject(),mediaPreview=self.getMediaPreview();if(!self.isStreaming()){var height=mediaObject.videoHeight/(mediaObject.videoWidth/mediaPreview.width);isNaN(height)&&(height=width/(4/3)),mediaObject.setAttribute("width",mediaPreview.width),mediaObject.setAttribute("height",height),self.isStreaming(!0),self.triggerEvent("streamReady",{stream:self.getStream(),media:mediaObject})}},self.openMedia=function(props){navigator.getMedia_?navigator.getMedia_(props,processMediaStream,onFailure):self.triggerEvent("error",{text:"Webcam Capture Not Supported In Your Browser"})},self.destroy=function(){var mediaObject=self.getMediaObject();mediaObject&&mediaObject.removeEventListener("canplay",self.onCanPlay),self.getStream()&&(self.getStream().stop(),self.setStream(null))};var init=function(){initNavigatorMedia()};init()}function rgImageCapture(utilsFactory){return{link:function(scope,elem,attr){var _TEXT={CAPTURE:"Capture",RETAKE:"ReTake"};scope.videoId=utilsFactory.getUniqueID("rgRec"),scope.showLoader=!0,scope.media=null,scope.errorText="",scope.captureText=_TEXT.CAPTURE;var getVideoContainerElement=function(){return document.querySelector("#"+scope.videoId)},recorder=new rgRecorder;recorder.on("streamReady",function(data){scope.showLoader=!1,scope.$rgDigest();try{getVideoContainerElement().appendChild(data.media),scope.media=data.media,data.media.play()}catch(e){}}),recorder.on("error",function(e){scope.errorText=e.text,scope.showLoader=!1,scope.$rgDigest()}),recorder.openMedia({video:!0,audio:!1}),scope.doCapture=function(){if(scope.captureText==_TEXT.CAPTURE){var image=recorder.captureImage();image&&(scope.capturedMedia=image,scope.captureText=_TEXT.RETAKE),scope.media&&scope.media.pause()}else scope.capturedMedia=null,scope.captureText=_TEXT.CAPTURE,scope.media.play();scope.$rgDigest()},scope.$on("$destroy",function(){recorder.destroy()})},templateUrl:"pages/partials/recorder/image.html"}}angular.module("ringid.common.rgRecorder",[]).directive("rgImageCapture",rgImageCapture),rgImageCapture.$inject=["utilsFactory"]}(),function(){"use strict";angular.module("ringid.media",["ringid.filters","ringid.profile","ringid.config","ringid.common.stacked_map","ringid.ringbox","ringid.common.controllers"])}(),function(){"use strict";function mediaHttpService(OPERATION_TYPES,$$connector){var self=this,OTYPES=OPERATION_TYPES.SYSTEM.MEDIA,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE;self.fetchMediaAlbums=function(obj){var payload={actn:OTYPES.ACTION_MEDIA_ALBUM_LIST,mdaT:obj.mdaT||1,utId:obj.utId};$$connector.send(payload,REQTYPE.REQUEST)},self.fetchHashtagSuggestion=function(schPm){return $$connector.pull({actn:OTYPES.ACTION_GET_HASHTAG_SUGGESTION,schPm:schPm.utf8Encode()},REQTYPE.REQUEST)},self.fetchSearchResult=function(param){var payload={actn:OTYPES.ACTION_MEDIA_SEARCH_RESULT,schPm:param.utf8Encode()};return $$connector.pull(payload,REQTYPE.REQUEST)},self.fetchContent=function(param){var payload={actn:OTYPES.ACTION_SPECIFIC_MEDIA_RESULT,schPm:param.sk.utf8Encode(),sugt:param.sugt,pvtid:param.pvtid||0,scl:param.scl||1};return $$connector.send(payload,REQTYPE.REQUEST)},self.fetchAlbumDetails=function(albId){var payload={actn:OTYPES.ACTION_MEDIA_ALBUM_DETAILS,albId:albId};return $$connector.request(payload,REQTYPE.REQUEST)},self.addMediaAlbum=function(obj){var payload={actn:OTYPES.ACTION_ADD_MEDIA_ALBUM,imgURL:obj.imgURL,albn:obj.albn,mdaT:obj.mdaT};return $$connector.request(payload,REQTYPE.UPDATE)},self.updateMediaAlbum=function(obj){var payload={actn:OTYPES.ACTION_UPDATE_MEDIA_ALBUM,albId:obj.albId,imgURL:obj.imgURL,mdaT:obj.mdaT,albn:obj.albn.utf8Encode()};return $$connector.request(payload,REQTYPE.UPDATE)},self.deleteAlbum=function(albId){var payload={actn:OTYPES.ACTION_DELETE_MEDIA_ALBUM,albId:albId};return $$connector.request(payload,REQTYPE.UPDATE)},self.fetchAlbumContents=function(obj){var payload={actn:OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:obj.albId,utId:obj.utId,st:obj.st||0};$$connector.send(payload,REQTYPE.REQUEST)},self.fetchAlbumContentsForpopup=function(obj){var payload={actn:OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST,albId:obj.albId||obj.id,utId:obj.utId,st:obj.st||0};return $$connector.pull(payload,REQTYPE.REQUEST)},self.fetchContentDetails=function(obj){var payload={actn:OTYPES.ACTION_MEDIA_CONTENT_DETAILS,cntntId:obj.cntntId,utId:obj.utId};return $$connector.request(payload,REQTYPE.REQUEST)},self.addMediaToAlbum=function(obj){var payload={actn:OTYPES.ACTION_ADD_MEDIA_CONTENT,albId:obj.albId,mdaLst:obj.mdaLst,mdaT:obj.mdaT};return $$connector.request(payload,REQTYPE.UPDATE)},self.updateMediaAlbum=function(obj){var payload={actn:OTYPES.ACTION_UPDATE_MEDIA_CONTENT,mdaCntntDTO:obj.mdaCntntDTO};return $$connector.request(payload,REQTYPE.UPDATE)},self.deleteAlbumContent=function(cntntId){var payload={actn:OTYPES.ACTION_DELETE_MEDIA_CONTENT,cntntId:cntntId};return $$connector.request(payload,REQTYPE.UPDATE)},self.increaseViewCount=function(cntntId,nfId){var payload={actn:OTYPES.ACTION_INCREASE_MEDIA_CONTENT_VIEW_COUNT,cntntId:cntntId};return nfId&&(payload.nfId=nfId),$$connector.request(payload,REQTYPE.UPDATE)},self.getSearchTrends=function(){var payload={actn:281};return $$connector.pull(payload,REQTYPE.REQUEST)},self.getTaggedMedia=function(param){var payload={actn:OTYPES.ACTION_GET_TAGGED_MEDIA_SONGS,htid:param,pvtid:0,scl:2};return $$connector.send(payload,REQTYPE.REQUEST)}}angular.module("ringid.media").service("mediaHttpService",mediaHttpService),mediaHttpService.$inject=["OPERATION_TYPES","$$connector"]}(),function(){"use strict";function $$mediaMap(Utils,User,Auth,$$stackedMap,settings,APP_CONSTANTS,mediaHttpService,$q){function __setMediaUser(media,_d,user){if(angular.isDefined(user))media.user=user;else if(_d.utId?media.user=User.getByUtId(_d.utId):_d.uId?media.user=User.getUser(_d.uId):media.user=!1,!media.user){var uOb={};_d.uId&&(uOb.uId=_d.uId),_d.utId&&(uOb.utId=_d.utId),_d.fn&&(uOb.fn=_d.fn),_d.prIm&&(uOb.prIm=_d.prIm),media.user=User.create(uOb)}}var AC=APP_CONSTANTS;return{createMedia:function(obj,userMap){var media={ac:0,albId:0,cc:0,ic:0,il:0,lc:0,is:0,ns:0,nfId:0,albn:"",artst:"",cntntId:0,drtn:0,mdaT:1,strmURL:"",thmbURL:"",ttl:"",tih:0,tiw:0,user:null,viewtime:0,utId:"",autoplay:!1},updatemediaObj=function(mediaObj){angular.isObject(mediaObj)?(angular.extend(media,mediaObj),media.key=media.cntntId,mediaObj.thmbURL&&mediaObj.thmbURL.length>1?media.poster=settings.imBase+mediaObj.thmbURL:(media.poster=media.mdaT===AC.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/audio-preview.jpg":"images/video-preview.jpg",media.feedThumb=media.poster,media.tih=330,media.tiw=600)):(RingLogger.warn("not valid json object media",RingLogger.tags.MEDIA),RingLogger.print(mediaObj,RingLogger.tags.MEDIA))};return updatemediaObj(obj),__setMediaUser(media,obj,userMap),{sortBy:function(){return media.viewtime},getMediaUtId:function(){return media.utId},getAlbumId:function(){return media.albId},getAlbumName:function(){return media.albn},getKey:function(){return media.key},getFeedKey:function(){return media.nfId},setFeedKey:function(nfId){return media.nfId=nfId},isAudio:function(){return media.mdaT===AC.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return media.mdaT===AC.NEWS_FEED_MEDIA_TYPE_VIDEO},owner:function(){return media.user},user:function(){return media.user},getId:function(){return media.cntntId},setIsAutoPlay:function(param){media.autoplay=param},getIsAutoPlay:function(){return media.autoplay},getViewCount:function(){return media.ac>1?"Views : "+media.ac:"View : "+media.ac},getViewCountOnly:function(){return media.ac},getDuration:function(formated){if(formated){var minutes=media.drtn/60===0?"00":Math.floor(media.drtn/60),seconds=media.drtn%60===0?"00":Math.floor(media.drtn%60);return minutes=10>minutes&&"00"!==minutes?"0"+minutes:minutes,seconds=10>seconds&&"00"!==seconds?"0"+seconds:seconds,minutes+":"+seconds}return media.drtn},getCaption:function(){return media.ttl},getStreamUrl:function(){return settings.mediaBase+media.strmURL},getStreamUrlOnly:function(){return media.strmURL},getThumb:function(){return media.poster},getThumbForMedia:function(){return""===media.thmbURL?1===media.mdaT?"images/audio-preview.jpg":"images/video-preview.jpg":media.poster},getThumbForMediaOnly:function(){return""===media.thmbURL?1===media.mdaT?"images/n-audio.jpg":"images/n-video.jpg":media.poster},feedThumb:function(){return media.feedThumb},iLiked:function(){return media.il},like:function(dolike,totalLike){return dolike?(media.il=1^media.il,totalLike?media.lc=totalLike:media.lc=0==media.il?media.lc-1:media.lc+1,media.il):media.il},getLikes:function(){return media.lc},getTotalLikes:function(){return media.lc},setTotalComment:function(cc,ic){media.cc=cc,angular.isDefined(ic)&&(media.ic=ic)},selfComment:function(){return media.ic},getTotalComment:function(){return media.cc},getTotalShare:function(){return media.ns},setTotalShare:function(v){media.ns=v},share:function(doShare){return doShare?(media.is=1^media.is,media.ns=media.is?media.ns+1:media.ns-1,media.is):media.is},thumbOffset:function(dimension){return dimension?"height"===dimension?media.tih:media.tiw:{width:media.tiw,height:media.tih}},updateMedia:function(obj){updatemediaObj(obj)},addToAlbumData:function(){return{strmURL:media.strmURL,tiw:media.tiw,tih:media.tih,drtn:media.drtn,thmbURL:media.thmbURL,artst:media.artst,ttl:media.ttl.utf8Encode()}},increaseView:function(){var deferred=$q.defer();return mediaHttpService.increaseViewCount(media.cntntId).then(function(json){RingLogger.print(json,RingLogger.tags.MEDIA),json.sucs===!0&&media.ac++,deferred.resolve()}),deferred.promise}}}}}angular.module("ringid.media").factory("$$mediaMap",$$mediaMap),$$mediaMap.$inject=["utilsFactory","userFactory","Auth","$$stackedMap","settings","APP_CONSTANTS","mediaHttpService","$$q"]}(),function(){"use strict";function $$mediaAlbumMap(Ringalert,Auth,settings,fileUploadService,$$stackedMap,$$mediaMap,APP_CONSTANTS,mediaHttpService,utilsFactory){function createAlbumKey(obj){return parseInt(obj.id)||parseInt(obj.albId)}var AC=APP_CONSTANTS;return{createKey:function(obj){return createAlbumKey(obj)},createAlbum:function(obj,user){function pushContents(contentJson,owner,nfId,tempMediaMap){var mediaMap,tempMediaMap=tempMediaMap||$$stackedMap.createNew();owner=owner||album.owner;for(var i=0,l=contentJson.length;l>i;i++)nfId&&(contentJson[i].nfId=nfId),mediaMap=$$mediaMap.createMedia(angular.extend(contentJson[i],{albId:album.id}),owner),album.contents.save(mediaMap.getKey(),mediaMap),tempMediaMap.save(mediaMap.getKey(),mediaMap);return RingLogger.print("CONTENTS ADDED : "+album.contents.length(),RingLogger.tags.MEDIA),tempMediaMap}var album={albn:"",albId:0,mc:0,mdc:0,mdaT:1,sts:0,utId:0,imgURL:"",contents:$$stackedMap.createNew(),uniqueKey:utilsFactory.getUniqueID(),cover:"",key:0,type:"",owner:0},updatealbumObj=function(albumObj){angular.isObject(albumObj)?(album=angular.extend({},album,albumObj),album.albId=parseInt(albumObj.id)||parseInt(albumObj.albId),album.owner=user,album.key=createAlbumKey(albumObj),albumObj.imgURL&&albumObj.imgURL.length>1?album.cover=settings.imBase+albumObj.imgURL:album.cover=obj.mdaT===AC.NEWS_FEED_MEDIA_TYPE_AUDIO?"images/n-audio.jpg":"images/n-video.jpg",album.type=obj.mdaT===AC.NEWS_FEED_MEDIA_TYPE_AUDIO?"audio":"video"):RingLogger.warning("not valid json object album",RingLogger.tags.MEDIA)};return updatealbumObj(obj),{getKey:function(){return album.key},getType:function(){return album.type},isAudio:function(){return album.mdaT===AC.NEWS_FEED_MEDIA_TYPE_AUDIO},isVideo:function(){return album.mdaT===AC.NEWS_FEED_MEDIA_TYPE_VIDEO},getId:function(){return album.albId},getName:function(){return album.albn},getCover:function(){return album.cover},getContentCount:function(){return album.mc||album.mdc},getContents:function(){return album.contents},updateAlbum:function(obj){updatealbumObj(obj)},pushContent:function(contentJson,owner,nfId){return pushContents(contentJson,owner,nfId)},getALbumUtId:function(){return album.utId},link:function(user,onlyPath){if(user.getUId()||user.getUtId()){var link=utilsFactory.getRingRoute("USER_PROFILE",{uId:user.getUId(),utId:user.getUtId(),subpage:"media",albumId:album.albId});return onlyPath?link.replace("#",""):settings.baseUrl+link}return""},addNewContent:function(mediaMap){var index,limit,whichFiles="audio"===album.type?"audioFiles":"videoFiles",payload={albId:album.albId,mdaLst:[],mdaT:album.mdaT};if(mediaMap){if(album.contents.get(mediaMap.getKey()))return void Ringalert.show("Content Already Added","warning");payload.mdaLst.push(mediaMap.addToAlbumData()),RingLogger.information("ADDING CONTENT FROM OTHER USER",RingLogger.tags.MEDIA)}else for(index=0,limit=fileUploadService[whichFiles].length;limit>index;index++)RingLogger.print(fileUploadService[whichFiles][index].getAuthData(),RingLogger.tags.MEDIA),payload.mdaLst.push(fileUploadService[whichFiles][index].getAuthData());mediaHttpService.addMediaToAlbum(payload).then(function(json){if(RingLogger.print(angular.toJson(json),RingLogger.tags.MEDIA),json.sucs===!0){for(album.mc+=json.mdaIds.length,index=0,limit=json.mdaIds.length;limit>index;index++)payload.mdaLst[index].id=json.mdaIds[index];pushContents(payload.mdaLst),mediaMap&&Ringalert.show("Content Added to album","success")}})},deleteContent:function(mediaMap){mediaHttpService.deleteAlbumContent(mediaMap.getId()).then(function(json){RingLogger.print(angular.toJson(json),RingLogger.tags.MEDIA),json.sucs===!0?(album.contents.remove(mediaMap.getKey()),album.mc--):RingLogger.warning("MEDIA CONTENT DELETE FAILED: "+json.mg,RingLogger.tags.MEDIA)})},fetchContentDetails:function(){function timedCall(mediaMap,time){setTimeout(function(){mediaHttpService.likeList(mediaMap.getId()).then(function(json){RingLogger.print(angular.toJson(json),RingLogger.tags.MEDIA)})},time)}for(var items=album.contents.all(),i=0,l=items.length;l>i;i++)timedCall(items[i].value,200*i+200)}}}}}angular.module("ringid.media").factory("$$mediaAlbumMap",$$mediaAlbumMap),$$mediaAlbumMap.$inject=["Ringalert","Auth","settings","fileUploadService","$$stackedMap","$$mediaMap","APP_CONSTANTS","mediaHttpService","utilsFactory"]}(),function(){"use strict";function MediaFactory(mapFilterFilter,utilsFactory,Ringalert,User,Auth,$routeParams,Storage,profileFactory,OPERATION_TYPES,APP_CONSTANTS,mediaHttpService,$$mediaAlbumMap,$$mediaMap,$$stackedMap,$q,$$connector,SystemEvents,$rootScope){function _processResponse(json){RingLogger.print(json,RingLogger.tags.MEDIA);var album,i,l,obj;switch(json.actn){case OTYPES.ACTION_MEDIA_ALBUM_LIST:if(_state.mediaLoading=!1,json.sucs===!0&&json.mediaAlbumList)for(_albumOwner=Auth.currentUser().getUtId()===json.utId?Auth.currentUser():User.create({utId:json.utId}),i=0,l=json.mediaAlbumList.length;l>i;i++)album=$$mediaAlbumMap.createAlbum(json.mediaAlbumList[i],_albumOwner),_albumOwner&&_albumOwner.isCurrentUser()?(RingLogger.information("OWN Album added id:"+album.getKey(),RingLogger.tags.MEDIA),_albums.save(album.getKey(),album)):(RingLogger.information("FRIEND Album added id:"+album.getKey(),RingLogger.tags.MEDIA),_userAlbums.save(album.getKey(),album));else RingLogger.warning("ALBUM LISTFETCH FAIL: "+json.mg,RingLogger.tags.MEDIA);break;case OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(_state.mediaContentLoading=!1,json.sucs===!0&&json.mdaCntntLst){var key=$$mediaAlbumMap.createKey(json);album=_albums.get(key)||_userAlbums.get(key),album?(RingLogger.information(json.mdaCntntLst.length+" CONTENT ADDED to album: "+album.getKey(),RingLogger.tags.MEDIA),album.pushContent(json.mdaCntntLst)):RingLogger.warning("No Albumap Found. You left profile page and useralbum list got reset: ",RingLogger.tags.MEDIA)}else RingLogger.warning("ALBUM CONTENT FETCH FAIL: "+json.mg,RingLogger.tags.MEDIA);break;case OTYPES.ACTION_SPECIFIC_MEDIA_RESULT:if(_state.noresultfound=!1,json.sucs===!0)for(i=0;i<json.mdaLst.length;i++)1===json.mdaLst[i].sugt&&(contentIdArray.push(json.mdaLst[i].cntntId),json.mdaLst[i].viewtime=(new Date).getTime(),obj=$$mediaMap.createMedia(json.mdaLst[i]),_searchesongs.save(obj.getKey(),obj)),2===json.mdaLst[i].sugt&&(albumIdArray.push(json.mdaLst[i].albId),obj=$$mediaAlbumMap.createAlbum(json.mdaLst[i]),_searchedAlbums.save(obj.getKey(),obj)),3===json.mdaLst[i].sugt&&searchedTagArr.push(json.mdaLst[i]);else _state.noresultfound=!0;break;case OTYPES.ACTION_GET_TAGGED_MEDIA_SONGS:if(_state.noresultfound=!1,json.sucs===!0)for(i=0;i<json.mdaLst.length;i++)obj=$$mediaMap.createMedia(json.mdaLst[i]),_searchesongs.save(obj.getKey(),obj);else _state.noresultfound=!0;break;default:RingLogger.warning("MEDIA _processResponse json.actn did not match",RingLogger.tags.MEDIA)}}function _subscribeMediaData(actions){return actions&&actions.length>0?$$connector.subscribe(_processResponse,{action:actions}):void(subscriptionKey=$$connector.subscribe(_processResponse,{action:[OTYPES.ACTION_SPECIFIC_MEDIA_RESULT,OTYPES.ACTION_GET_TAGGED_MEDIA_SONGS,OTYPES.ACTION_MEDIA_SEARCH_RESULT]}))}function fetchAllAlbums(utId){utId=utId||(Auth.currentUser()?Auth.currentUser().getUtId():!1),utId&&(mediaHttpService.fetchMediaAlbums({utId:utId,mdaT:AC.NEWS_FEED_MEDIA_TYPE_AUDIO}),setTimeout(function(){mediaHttpService.fetchMediaAlbums({utId:utId,mdaT:AC.NEWS_FEED_MEDIA_TYPE_VIDEO})},200))}var _albumOwner,subscriptionKey,_state={mediaLoading:!1,mediaContentLoading:!1,noresultfound:!1},_albums=$$stackedMap.createNew(),_userAlbums=$$stackedMap.createNew(),_searchedAlbums=$$stackedMap.createNew(),_searchesongs=$$stackedMap.createNew(),_utId=0,OTYPES=OPERATION_TYPES.SYSTEM.MEDIA,AC=APP_CONSTANTS,searchedTagArr=[],contentIdArray=[],albumIdArray=[],mediaRecent=Storage.getData("mediaRecent");return _subscribeMediaData(),fetchAllAlbums(),$rootScope.$on(SystemEvents.AUTH.LOGIN,function(){setTimeout(fetchAllAlbums,5e3)}),{state:function(){return _state},getAlbum:function(albumId){return albumId=parseInt(albumId),_albums.get(albumId)||_userAlbums.get(albumId)},fetchAllAlbums:function(utId,albumType){_state.mediaLoading=!0,_utId=utId,albumType?"audio"===albumType?mediaHttpService.fetchMediaAlbums({utId:utId,mdaT:AC.NEWS_FEED_MEDIA_TYPE_AUDIO}):"video"===albumType&&mediaHttpService.fetchMediaAlbums({utId:utId,mdaT:AC.NEWS_FEED_MEDIA_TYPE_VIDEO}):fetchAllAlbums(_utId)},createAlbum:function(albumObj,newAlbum){var albumMap,defer;return newAlbum&&(albumObj.id=utilsFactory.getUniqueID(),defer=$q.defer()),albumMap=$$mediaAlbumMap.createAlbum(albumObj),_albums.save(albumMap.getKey(),albumMap),newAlbum&&mediaHttpService.addMediaAlbum(albumObj).then(function(json){RingLogger.print(angular.toJson(json),RingLogger.tags.MEDIA),json.sucs===!0?(albumMap.updateAlbum({id:json.albId}),newAlbum&&defer.resolve(albumMap)):(_albums.remove(albumObj.id),RingLogger.warning("CREATE NEW ALBUM FAILED: "+json.mg,RingLogger.tags.MEDIA),newAlbum&&defer.reject())}),newAlbum?defer.promise:albumMap},deleteAlbum:function(albumMap){mediaHttpService.deleteAlbum(albumMap.getId()).then(function(json){RingLogger.print(angular.toJson(json),RingLogger.tags.MEDIA),json.sucs===!0?_albums.remove(albumMap.getKey()):RingLogger.warn("Delete Album  Failed: "+json.mg,RingLogger.tags.MEDIA)})},fetchAlbumContents:function(obj){_state.mediaContentLoading=!0,mediaHttpService.fetchAlbumContents(obj)},fetchAlbumContentsForpopup:function(obj){return _state.mediaContentLoading=!0,mediaHttpService.fetchAlbumContentsForpopup(obj)},resetMediaAlbums:function(){_userAlbums.reset()},getUserAlbums:function(type){return type?mapFilterFilter(_userAlbums.all(),{mapApi:"getType",value:type,compare:"regex"}):_userAlbums},getAlbums:function(type){return type?mapFilterFilter(_albums.all(),{mapApi:"getType",value:type,compare:"regex"}):_albums},getSearchedSongs:function(){return _searchesongs},getSearchedAlbums:function(){return _searchedAlbums},getContentIdArray:function(){return contentIdArray},resetContentIdArray:function(){contentIdArray=[]},getAlbumIdArray:function(){return albumIdArray},resetAlbumIdArray:function(){albumIdArray=[]},getSearchedTagArr:function(){return searchedTagArr},resetSearchedSongs:function(){return _searchesongs.reset()},resetSearchedAlbum:function(){return _searchedAlbums.reset()},resetSearchedTagArr:function(){searchedTagArr=[]},getSearchTrends:function(){return mediaHttpService.getSearchTrends()},getTaggedMedia:function(obj){mediaHttpService.getTaggedMedia(obj)},fetchSearchResult:function(param){return mediaHttpService.fetchSearchResult(param)},fetchHashtagSuggestion:mediaHttpService.fetchHashtagSuggestion,fetchContent:function(param){return _state.noresultfound=!1,mediaHttpService.fetchContent(param)},fetchContentDetails:function(cntntId,forPopup,user,utid){var albumMap,mediaMap,defer=$q.defer(),reqData={cntntId:cntntId};return user&&(reqData.utId=user.getUtId()),utid&&(reqData.utId=utid),mediaHttpService.fetchContentDetails(reqData).then(function(json){if(RingLogger.print(json,RingLogger.tags.MEDIA),user||Auth.currentUser().getUtId()!==json.utId||(user=Auth.currentUser()),json.sucs===!0){if(!json.mdaCntntDTO)return defer.reject(json),void Ringalert.show("Content Not Found","info");var albumid=json.mdaCntntDTO.albId,mdatype=json.mdaCntntDTO.mdaT,alname=json.mdaCntntDTO.albn;albumMap||(albumMap=$$mediaAlbumMap.createAlbum({albId:albumid,mdaT:mdatype,albn:alname}),_albums.save(albumMap.getKey(),albumMap));var arrIndex,t=new Date,mediaObj={ac:json.mdaCntntDTO.ac,albId:json.mdaCntntDTO.albId,albn:json.mdaCntntDTO.albn,cntntId:json.mdaCntntDTO.cntntId,mdaT:json.mdaCntntDTO.mdaT,strmURL:json.mdaCntntDTO.strmURL,thmbURL:json.mdaCntntDTO.thmbURL,ttl:json.mdaCntntDTO.ttl,utId:json.utId,viewtime:t.getTime()};if(mediaRecent=Storage.getData("mediaRecent"),mediaRecent.length>0){for(var i=0;i<mediaRecent.length;i++)mediaRecent[i].cntntId===json.mdaCntntDTO.cntntId&&(arrIndex=i);arrIndex?(mediaRecent.splice(arrIndex,1),mediaRecent.push(mediaObj),mediaRecent.length>6&&mediaRecent.shift()):mediaRecent.push(mediaObj)}else mediaRecent.push(mediaObj);Storage.setData("mediaRecent",mediaRecent),mediaMap=albumMap.pushContent([angular.extend(json.mdaCntntDTO,{utId:json.utId,cntntId:json.cntntId})],user),defer.resolve(mediaMap.top())}else defer.reject(json),Ringalert.show(json.mg,"info")}),defer.promise}}}angular.module("ringid.media").factory("Media",MediaFactory),MediaFactory.$inject=["mapFilterFilter","utilsFactory","Ringalert","userFactory","Auth","$routeParams","Storage","profileFactory","OPERATION_TYPES","APP_CONSTANTS","mediaHttpService","$$mediaAlbumMap","$$mediaMap","$$stackedMap","$$q","$$connector","SystemEvents","$rootScope"]}(),function(){"use strict";function rgMedia($window,$document,Media,$routeParams){function MediaController(profileFactory,Auth,fileUploadService,SystemEvents,$rootScope,$scope,Media,$location,OPERATION_TYPES,$$connector,utilsFactory,User,$$mediaAlbumMap,$$stackedMap,mapFilterFilter){function toggleLoading(bool,type){"album"===type?(clearTimeout(albumTimeout),$scope.state.albumsLoading=bool):(clearTimeout(contentTimeout),$scope.state.contentsLoading=bool),$scope.$digest()}function showAlbumContents(albumMap){albumMap&&!uploadProgress?($scope.activeAlbum=albumMap,$scope.loadMoreImage(),$scope.showMediaPreview=!1):($scope.showMediaPreview=!0,$scope.activeAlbum=null)}var subscriptionKey,albumTimeout,contentTimeout,_albums=$$stackedMap.createNew(),uploadProgress=!1,OTYPES=OPERATION_TYPES.SYSTEM.MEDIA,currentUser=profileFactory.getProfile($routeParams.uId);if($scope.showMediaPreview=!1,$scope.activeAlbum=null,$scope.state={noresultfound:!1,contentsLoading:!1,albumsLoading:!1},subscriptionKey=$$connector.subscribe(function(json){var i,_albumOwner,l,album;switch(json.actn){case OTYPES.ACTION_MEDIA_ALBUM_LIST:if(json.sucs===!0&&json.mediaAlbumList)for(_albumOwner=Auth.currentUser().getUtId()===json.utId?Auth.currentUser():User.create({utId:json.utId}),i=0,l=json.mediaAlbumList.length;l>i;i++)album=$$mediaAlbumMap.createAlbum(json.mediaAlbumList[i],_albumOwner),_albums.save(album.getKey(),album);else RingLogger.warning("ALBUM LISTFETCH FAIL: "+json.mg,RingLogger.tags.MEDIA);toggleLoading(!1,"album"),RingLogger.information("MEDIAALBUMLOADING DONE",RingLogger.tags.MEDIA);break;case OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(json.sucs===!0&&json.mdaCntntLst){var key=$$mediaAlbumMap.createKey(json);
album=_albums.get(key),album?(RingLogger.information(json.mdaCntntLst.length+" CONTENT ADDED to album: "+album.getKey(),RingLogger.tags.MEDIA),album.pushContent(json.mdaCntntLst)):RingLogger.warning("No Albumap Found. You left profile page and useralbum list got reset: ",RingLogger.tags.MEDIA)}else RingLogger.warning("ALBUM CONTENT FETCH FAIL: "+json.mg,RingLogger.tags.MEDIA);toggleLoading(!1),RingLogger.information("MEDIACCONTENTSLOADING DONE: "+$scope.activeAlbum.getContents().length(),RingLogger.tags.MEDIA)}},{action:[OTYPES.ACTION_MEDIA_ALBUM_LIST,OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST]}),toggleLoading(!0,"album"),currentUser.isCurrentUser()?Media.fetchAllAlbums():Media.fetchAllAlbums(currentUser.getUtId()),albumTimeout=setTimeout(function(){toggleLoading(!1,"album")},5e3),$routeParams.albumId){toggleLoading(!0),$scope.showMediaPreview=!1;var albumMap,intervalCount=0;RingLogger.information("Fetch album details and show album contents: "+$routeParams.albumId,RingLogger.tags.MEDIA);var interval=setInterval(function(){intervalCount++,albumMap=_albums.get($routeParams.albumId),albumMap?(clearInterval(interval),showAlbumContents(albumMap)):intervalCount>12&&clearInterval(interval)},400);$scope.$rgDigest()}else $scope.showMediaPreview=!0;$scope.getAlbums=function(type){return type?mapFilterFilter(_albums.all(),{mapApi:"getType",value:type,compare:"regex"}):_albums},$scope.deleteMedia=function(mediaMap){Media.deleteMedia(mediaMap)},$scope.goToAlbum=function(event,mediaMap){event.stopPropagation(),window.location=mediaMap.link(currentUser)},$scope.enableAlbumPreview=function(){window.location=utilsFactory.getRingRoute("USER_PROFILE",{uId:currentUser.getUId(),utId:currentUser.getUtId(),subpage:"media"})},$scope.getMediaData=function(mediaMap,album){return{data:function(){return{media:mediaMap,album:album,popupForm:"profile"}},promise:Media.fetchContentDetails(mediaMap.getKey(),!0,currentUser)}},$scope.uploadAction=function(){uploadProgress=!0},$rootScope.$on(SystemEvents.FILE_UPLOAD.QUEUE_COMPLETE,function(){uploadProgress&&(uploadProgress=!1,$scope.activeAlbum.addNewContent(),$scope.$rgDigest())}),$scope.loadMoreImage=function(){var contentLength=$scope.activeAlbum.getContents().length(),totalContentLength=$scope.activeAlbum.getContentCount();$scope.activeAlbum&&totalContentLength>contentLength?(toggleLoading(!0),RingLogger.information("FETCH MORE MEDIA CONTENT: ",RingLogger.tags.MEDIA),Media.fetchAlbumContents({albId:$scope.activeAlbum.getKey(),utId:currentUser.getUtId(),st:contentLength}),contentTimeout=setTimeout(function(){toggleLoading(!1)},5e3)):toggleLoading(!1)},$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey),Media.resetMediaAlbums()})}MediaController.$inject=["profileFactory","Auth","fileUploadService","SystemEvents","$rootScope","$scope","Media","$location","OPERATION_TYPES","$$connector","utilsFactory","userFactory","$$mediaAlbumMap","$$stackedMap","mapFilterFilter"];var linkFunc=function(scope){function handleScroll(){scope.showMediaPreview||$window.innerHeight+$window.scrollY>=$document[0].body.offsetHeight&&scope.loadMoreImage()}$window.addEventListener("scroll",handleScroll),scope.$on("$destroy",function(){$window.removeEventListener("scroll",handleScroll)})};return{restrict:"E",controller:MediaController,link:linkFunc,templateUrl:"pages/partials/media.html"}}angular.module("ringid.media").directive("rgMedia",rgMedia),rgMedia.$inject=["$window","$document","Media","$routeParams"]}(),function(){"use strict";function rgMediaSearch($document,Media,$routeParams){function MediaSearchController($$stackedMap,$$connector,$$mediaMap,settings,Storage,OPERATION_TYPES,Auth,$scope,Media,userFactory,$$mediaAlbumMap,$location){function mediaSearchResult(data){var i;switch(data.actn){case OTYPES.ACTION_MEDIA_ALBUM_LIST:if(data.sucs===!0){for(i=0;i<data.mediaAlbumList.length;i++){var anMediaAlbumObject=data.mediaAlbumList[i];musicArrayMap[anMediaAlbumObject.id]=anMediaAlbumObject}var val,keys=Object.keys(musicArrayMap),audioArray=[],videoArray=[];for(i=0;i<keys.length;i++)val=musicArrayMap[keys[i]],1===val.mdaT?(val.imgURL?val.imgURL=settings.imBase+val.imgURL:val.imgURL="",audioArray.push(val)):(val.imgURL?val.imgURL=settings.imBase+val.imgURL:val.imgURL="",videoArray.push(val));$scope.audioAlbum=audioArray,$scope.videoAlbum=videoArray}else 1===data.mdaT&&($scope.noaudiofound=!0),2===data.mdaT&&($scope.novideofound=!0)}$scope.$rgDigest()}var albumname=[];Storage.setData("albumname",albumname),$scope.medias=$$stackedMap.createNew(!0,"desc"),$scope.popupmedias=$$stackedMap.createNew(!0,"desc");var OTYPES=OPERATION_TYPES.SYSTEM.MEDIA;$scope.searchedMedia=$$stackedMap.createNew(),$scope.trendingArr=[],$scope.nodatafound=!1,$scope.noaudiofound=!1;var userMap=Auth.currentUser();$scope.utId=userMap.getUtId(),Media.fetchAllAlbums();for(var mediaArr=Storage.getData("mediaRecent"),i=0;i<mediaArr.length;i++){var media=$$mediaMap.createMedia(mediaArr[i]);$scope.medias.save(media.getKey(),media)}$scope.getMediaData=function(mediaMap){var albumObj={albn:mediaMap.getAlbumName(),id:mediaMap.getAlbumId(),utId:mediaMap.getMediaUtId()},mediaObj={ac:mediaMap.getViewCountOnly(),cntntId:mediaMap.getId(),strmURL:mediaMap.getStreamUrl(),ttl:mediaMap.getCaption()},albumowner=userFactory.create({utId:albumObj.utId}),useralbum=$$mediaAlbumMap.createAlbum(albumObj,albumowner);return useralbum.pushContent([mediaObj]),{data:function(){return{media:mediaMap,album:useralbum}},promise:Media.fetchContentDetails(mediaMap.getKey(),!0,albumowner,mediaMap.getMediaUtId())}},$scope.recentMedias=function(){for(var mediaArr=Storage.getData("mediaRecent"),i=0;i<mediaArr.length;i++){var media=$$mediaMap.createMedia(mediaArr[i]);$scope.medias.save(media.getKey(),media)}return $scope.medias},$scope.getTaggedMedia=function(obj){Media.getTaggedMedia(obj)},$scope.goToMyAlbums=function(param){var path="media/"+param;$location.path(path)},$scope.goToAlbum=function(obj){var url;switch(albumname.push(obj.name),albumname.push(obj.mc),Storage.setData("albumname",albumname),obj.type){case"audio":url="media/"+obj.type+"/"+obj.utid+"/"+obj.albumid,$location.path(url);break;case"video":url="media/"+obj.type+"/"+obj.utid+"/"+obj.albumid,$location.path(url);break;default:url="media",$location.path(url)}};var subscriptionKey=$$connector.subscribe(mediaSearchResult,{action:[OTYPES.ACTION_MEDIA_ALBUM_LIST]}),musicArrayMap={};Media.getSearchTrends().then(function(data){if(data.sucs===!0)for(i=0;i<data.sgstn.length;i++){switch(data.sgstn[i].sugt){case 1:data.sgstn[i].searchtype="songs";break;case 2:data.sgstn[i].searchtype="albums";break;case 3:data.sgstn[i].searchtype="tags"}$scope.trendingArr.push(data.sgstn[i])}$scope.$rgDigest()}),$scope.$on("$destroy",function(){$scope.trendingArr=[],Media.resetMediaAlbums(),$$connector.unsubscribe(subscriptionKey)})}MediaSearchController.$inject=["$$stackedMap","$$connector","$$mediaMap","settings","Storage","OPERATION_TYPES","Auth","$scope","Media","userFactory","$$mediaAlbumMap","$location"];var linkFunc=function(scope,element){element.bind("click",function(){})};return{restrict:"E",controller:MediaSearchController,link:linkFunc,templateUrl:"pages/partials/media-search.html"}}angular.module("ringid.media").directive("rgMediaSearch",rgMediaSearch),rgMediaSearch.$inject=["$document","Media","$routeParams"]}(),function(){"use strict";function rgMediaSearchDirective($document,Media){function searchDirectiveController(OPERATION_TYPES,$scope,Media,$location,rgScrollbarService,GlobalEvents){function mediaSearchResultProcess(data){var i;switch(data.actn){case OTYPES.ACTION_MEDIA_SEARCH_RESULT:if(data.sucs===!0)for($scope.showDropdown=!0,i=0;i<data.sgstn.length;i++)$scope.searchResult.push(data.sgstn[i]);else $scope.stoploader=!0;rgScrollbarService.recalculate($scope)}$scope.$rgDigest()}var OTYPES=OPERATION_TYPES.SYSTEM.MEDIA,self=this;$scope.showDropdown=!1,$scope.stoploader=!1,$scope.searchResult=[],$scope.doSearch=function(){$scope.searchResult=[],$scope.stoploader=!1,$scope.searchParam?(Media.fetchSearchResult($scope.searchParam).then(mediaSearchResultProcess),$scope.showDropdown=!0):$scope.showDropdown=!1,GlobalEvents.bindHandler("document","click",self.closeDropdown)},$scope.doContentSearch=function(obj){var searchurl;switch($scope.showDropdown=!1,obj.sugt){case 1:searchurl="media/songs/"+obj.sk,$location.path(encodeURI(searchurl));break;case 2:searchurl="media/albums/"+obj.sk,$location.path(encodeURI(searchurl));break;case 3:searchurl="media/tags/"+obj.sk,$location.path(encodeURI(searchurl))}},self.closeDropdown=function(){$scope.searchParam="",$scope.showDropdown=!1,GlobalEvents.unbindHandler("document","click",self.closeDropdown),$scope.$rgDigest()}}searchDirectiveController.$inject=["OPERATION_TYPES","$scope","Media","$location","rgScrollbarService","GlobalEvents"];var linkFunc=function(scope,element){element.bind("click",function(){});var input=element.find("input");input.on("keypress",function(event){13===event.keyCode&&scope.doSearch()})};return{restrict:"E",controller:searchDirectiveController,link:linkFunc,templateUrl:"pages/mediasearch/media-search-directive.html"}}angular.module("ringid.media").directive("rgMediaSearchDirective",rgMediaSearchDirective),rgMediaSearchDirective.$inject=["$document","Media"]}(),function(){"use strict";function mSearchResultController(Auth,Storage,userFactory,$routeParams,$$mediaAlbumMap,$scope,Media,$location,$$connector,OPERATION_TYPES){function searchContentProcess(data){data.sucs===!0,$scope.$rgDigest()}var albumname=[];Storage.setData("albumname",albumname),$scope.stype=$routeParams.stype,$scope.searchkey=decodeURI($routeParams.sk);var sugt,OTYPES=OPERATION_TYPES.SYSTEM.MEDIA;switch($routeParams.stype){case"songs":sugt=1;break;case"albums":sugt=2;break;case"tags":sugt=3;break;default:sugt=1}$scope.showSearchDropdown=!1;Auth.currentUser();if($scope.searchsongsection=!1,$scope.searchalbumsection=!1,$scope.searchtagsection=!1,$scope.noresultsection=!1,Media.resetSearchedSongs(),Media.resetSearchedAlbum(),Media.resetSearchedTagArr(),"tag"!==$scope.stype){var obj={sk:$scope.searchkey,sugt:sugt};Media.fetchContent(obj)}switch($scope.stype){case"songs":$scope.searchsongsection=!0;break;case"albums":$scope.searchalbumsection=!0;break;case"tags":$scope.searchtagsection=!0;break;case"tag":$scope.searchsongsection=!0,isNaN($scope.searchkey)||Media.getTaggedMedia(parseInt($scope.searchkey))}$scope.searchedSongs=Media.getSearchedSongs,$scope.searchedAlbums=Media.getSearchedAlbums,$scope.searchedTags=Media.getSearchedTagArr(),$scope.cntntidarray=Media.getContentIdArray,$scope.albumidarray=Media.getAlbumIdArray,$scope.state=Media.state(),$scope.loadMoreSuggestedSongs=function(){var reqData={sk:$scope.searchkey,sugt:sugt,pvtid:$scope.cntntidarray().pop(),scl:2};Media.fetchContent(reqData),Media.resetContentIdArray()},$scope.loadMoreSuggestedAlbums=function(){var reqData={sk:$scope.searchkey,sugt:sugt,pvtid:$scope.albumidarray().pop(),scl:2};Media.fetchContent(reqData),Media.resetAlbumIdArray()},$scope.getTaggedMedia=function(obj){var searchurl="media/tag/"+obj.htid;$location.path(encodeURI(searchurl))},$scope.goToAlbum=function(obj){var url;switch(albumname.push(obj.name),albumname.push(obj.mc),Storage.setData("albumname",albumname),obj.type){case"audio":url="media/"+obj.type+"/"+obj.utid+"/"+obj.albumid,$location.path(url);break;case"video":url="media/"+obj.type+"/"+obj.utid+"/"+obj.albumid,$location.path(url);break;default:url="media",$location.path(url)}},$scope.getMediaData=function(mediaMap){var albumObj={albn:mediaMap.getAlbumName(),id:mediaMap.getAlbumId(),utId:mediaMap.getMediaUtId()},mediaObj={ac:mediaMap.getViewCountOnly(),cntntId:mediaMap.getId(),strmURL:mediaMap.getStreamUrl(),ttl:mediaMap.getCaption()},albumowner=userFactory.create({utId:albumObj.utId}),useralbum=$$mediaAlbumMap.createAlbum(albumObj,albumowner);return useralbum.pushContent([mediaObj]),{data:function(){return{media:mediaMap,album:useralbum}},promise:Media.fetchContentDetails(mediaMap.getKey(),!0,albumowner,mediaMap.getMediaUtId())}};var subscriptionKey=$$connector.subscribe(searchContentProcess,{action:[OTYPES.ACTION_SPECIFIC_MEDIA_RESULT,OTYPES.ACTION_GET_TAGGED_MEDIA_SONGS]});$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey)})}angular.module("ringid.media").controller("mSearchResultController",mSearchResultController),mSearchResultController.$inject=["Auth","Storage","userFactory","$routeParams","$$mediaAlbumMap","$scope","Media","$location","$$connector","OPERATION_TYPES"]}(),function(){"use strict";function allAlbumTypeController($$stackedMap,$$mediaMap,$$mediaAlbumMap,Storage,userFactory,Auth,$routeParams,OPERATION_TYPES,$scope,Media,$location,$$connector,$ringbox,Ringalert){function albumContentProcess(data){var i;switch(data.actn){case OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST:if(data.sucs===!0){for(i=0;i<data.mdaCntntLst.length;i++){thealbum.pushContent(data.mdaCntntLst),data.mdaCntntLst[i].utId=$scope.utid;var media=$$mediaMap.createMedia(data.mdaCntntLst[i]);$scope.songs.save(media.getKey(),media)}$scope.thealbum=thealbum,$scope.loadMoreSong=!1}else $scope.loadMoreSong=!1,$scope.stoploader=!0;break;case OTYPES.ACTION_MEDIA_ALBUM_LIST:if(data.sucs===!0){for(i=0;i<data.mediaAlbumList.length;i++)if(data.mediaAlbumList[i].mdaT===mdaType){var albumMap=$$mediaAlbumMap.createAlbum(data.mediaAlbumList[i]);$scope.myAlbumsMap.save(albumMap.getKey(),albumMap)}}else $scope.stoploader=!0}$scope.$rgDigest()}$scope.albumName=Storage.getData("albumname")[0],$scope.mediaCount=Storage.getData("albumname")[1],$scope.albumtype=$routeParams.albumtype,$scope.utid=$routeParams.utid,$scope.albumid=$routeParams.albumid,$scope.songsArray=[],$scope.songs=$$stackedMap.createNew(),$scope.popupmedias=$$stackedMap.createNew(),$scope.myAlbumsMap=$$stackedMap.createNew();var OTYPES=OPERATION_TYPES.SYSTEM.MEDIA;$scope.userallalbum=!1,$scope.showSearchDropdown=!1,$scope.stoploader=!1,$scope.loadMoreSong=!1;var mdaType;if(!$routeParams.utid&&!$routeParams.albumid){var currentUser=Auth.currentUser();$scope.utid=currentUser.getUtId(),"audio"===$routeParams.albumtype?mdaType=1:"video"===$routeParams.albumtype?mdaType=2:$location.path("media"),Media.fetchAllAlbums($scope.utid,$scope.albumtype),$scope.userallalbum=!0}isNaN($scope.utid)&&isNaN($scope.albumid)&&$location.path("media"),$scope.goToAlbum=function(obj){var url,albumname=[];switch(albumname.push(obj.name),albumname.push(obj.mc),Storage.setData("albumname",albumname),obj.type){case"audio":url="media/"+obj.type+"/"+obj.utid+"/"+obj.albumid,$location.path(url);break;case"video":url="media/"+obj.type+"/"+obj.utid+"/"+obj.albumid,$location.path(url);break;default:url="media",$location.path(url)}},$scope.loadMoreMedia=function(songcount){$scope.loadMoreSong=!0,Media.fetchAlbumContents({albId:$scope.albumid,utId:$scope.utid,st:songcount})},$scope.utid&&$scope.albumid&&(Media.fetchAlbumContents({albId:$scope.albumid,utId:$scope.utid}),$scope.albumMap=$$mediaAlbumMap.createAlbum({albn:$scope.albumName,albId:$scope.albumid,utId:$scope.utid})),$scope.mediaPlayerPopup=function(obj,mediaMap){var albumObj={albn:obj.getName(),id:mediaMap.getAlbumId(),utId:mediaMap.getMediaUtId()},mediaObj={ac:mediaMap.getViewCountOnly(),cntntId:mediaMap.getId(),strmURL:mediaMap.getStreamUrl(),ttl:mediaMap.getCaption()},albumowner=userFactory.create({utId:albumObj.utId}),useralbum=$$mediaAlbumMap.createAlbum(albumObj,albumowner);useralbum.pushContent([mediaObj]),$ringbox.open({type:"remote",scope:!1,controller:"RingBoxMediaController",resolve:{localData:{media:mediaMap,album:useralbum},remoteData:function(){return Media.fetchContentDetails(mediaMap.getKey(),!0,albumowner,mediaMap.getMediaUtId())}},templateUrl:"pages/partials/notification/media-popup.html"})};var keys,albumObj={albn:$scope.albumName,id:$scope.albumid,utId:$scope.utId},albumUser=Auth.currentUser().getUtId()===$scope.utid?Auth.currentUser():userFactory.create({utId:$scope.utid}),thealbum=$$mediaAlbumMap.createAlbum(albumObj,albumUser),selectedSongAlbum=$$mediaAlbumMap.createAlbum(albumObj,albumUser),selectedSongMap={};$scope.selectSongs=function(obj,status){if(status){var anMediaObject=obj;selectedSongMap[anMediaObject.cntntId]=anMediaObject,keys=Object.keys(selectedSongMap)}else delete selectedSongMap[obj.cntntId],keys=Object.keys(selectedSongMap)},$scope.shouldOpenRingbox=function(){return keys&&!(keys.length<1)},$scope.playSelected=function(){var selectedArray=[];if(selectedSongAlbum.getContents().reset(),!keys||keys.length<1)return void Ringalert.show("Please select songs first !","info");for(var i=0;i<keys.length;i++){var songobj=selectedSongMap[keys[i]];selectedArray.push(songobj)}selectedSongAlbum.pushContent(selectedArray);var topsongMap=selectedSongAlbum.getContents().all()[0].value;return topsongMap.setIsAutoPlay(!0),{data:function(){return{media:topsongMap,album:selectedSongAlbum}},promise:Media.fetchContentDetails(topsongMap.getId(),!0,albumUser,topsongMap.getMediaUtId())}},$scope.playallsongs=function(albumsongs){var topmediaMap=albumsongs.getContents().all()[0].value;return topmediaMap.setIsAutoPlay(!0),{data:function(){return{media:topmediaMap,album:albumsongs}},promise:Media.fetchContentDetails(topmediaMap.getKey(),!0,albumUser,topmediaMap.getMediaUtId())}},$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey)});var subscriptionKey=$$connector.subscribe(albumContentProcess,{action:[OTYPES.ACTION_MEDIA_ALBUM_CONTENT_LIST,OTYPES.ACTION_MEDIA_ALBUM_LIST]})}angular.module("ringid.media").controller("allAlbumTypeController",allAlbumTypeController),allAlbumTypeController.$inject=["$$stackedMap","$$mediaMap","$$mediaAlbumMap","Storage","userFactory","Auth","$routeParams","OPERATION_TYPES","$scope","Media","$location","$$connector","$ringbox","Ringalert"]}(),function(){"use strict";angular.module("ringid.social",[])}(),function(){"use strict";angular.module("ringid.social").service("socialUtils",function(){var _self=this;_self.camelCase=function(name){return name.replace(/([\:\-\_]+(.))/g,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter})},_self.parseQueryString=function(keyValue){var key,value,obj={};return angular.forEach((keyValue||"").split("&"),function(keyValue){keyValue&&(value=keyValue.split("="),key=decodeURIComponent(value[0]),obj[key]=angular.isDefined(value[1])?decodeURIComponent(value[1]):!0)}),obj},_self.joinUrl=function(baseUrl,url){if(/^(?:[a-z]+:)?\/\//i.test(url))return url;var joined=[baseUrl,url].join("/"),normalize=function(str){return str.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return normalize(joined)},_self.merge=function(obj1,obj2){var result={};for(var i in obj1)obj1.hasOwnProperty(i)&&(i in obj2&&"object"==typeof obj1[i]&&null!==i?result[i]=_self.merge(obj1[i],obj2[i]):result[i]=obj1[i]);for(i in obj2)if(obj2.hasOwnProperty(i)){if(i in result)continue;result[i]=obj2[i]}return result}})}(),function(){"use strict";angular.module("ringid.social").constant("socialConfig",{providers:{facebook:{name:"facebook",url:"/auth/facebook",clientId:"477404429103451",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:window.location.origin+"/static-index.html",requiredUrlParams:["access_code"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:680,height:500}},twitter:{twitterApiURL:"https://api.twitter.com/1.1/account/verify_credentials.json",name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:window.location.origin+"/static-index.html",type:"1.0",serverUrl:window.location.origin+"/TwiteerLoginService",popupOptions:{width:595,height:745}}}})}(),function(){"use strict";function socialPopup($q,$interval,$window,socialConfig,socialUtils,utilsFactory){var Popup={};return Popup.url="",Popup.popupWindow=null,Popup.open=function(url,name,options){Popup.url=url;var stringifiedOptions=Popup.stringifyOptions(Popup.prepareOptions(options)),UA=$window.navigator.userAgent,windowName=socialConfig.cordova||UA.indexOf("CriOS")>-1?"_blank":name;return Popup.popupWindow=$window.open(url,windowName,stringifiedOptions),$window.popup=Popup.popupWindow,Popup.popupWindow&&Popup.popupWindow.focus&&Popup.popupWindow.focus(),Popup},Popup.eventListener=function(redirectUri){var deferred=$q.defer();return Popup.popupWindow.addEventListener("loadstart",function(event){if(0===event.url.indexOf(redirectUri)){var parser=document.createElement("a");if(parser.href=event.url,parser.search||parser.hash){var queryParams=parser.search.substring(1).replace(/\/$/,""),hashParams=parser.hash.substring(1).replace(/\/$/,""),hash=socialUtils.parseQueryString(hashParams),qs=socialUtils.parseQueryString(queryParams);angular.extend(qs,hash),qs.error||deferred.resolve(qs),Popup.popupWindow.close()}}}),Popup.popupWindow.addEventListener("loaderror",function(){deferred.reject({rc:0,mg:"Error Loading Authorization URL"})}),Popup.popupWindow.addEventListener("onbeforeunload",function(){deferred.reject({rc:0,mg:"Popup closed unexpectedly"})}),deferred.promise},Popup.pollPopup=function(){var deferred=$q.defer(),polling=$interval(function(){try{var documentOrigin=document.location.host,popupWindowOrigin=Popup.popupWindow.location.host;if(popupWindowOrigin===documentOrigin&&(Popup.popupWindow.location.search||Popup.popupWindow.location.hash)){RingLogger.information("calback url: "+Popup.popupWindow.location,RingLogger.tags.AUTH);var queryParams=Popup.popupWindow.location.search.substring(1).replace(/\/$/,""),hashParams=Popup.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),hash=socialUtils.parseQueryString(hashParams),qs=socialUtils.parseQueryString(queryParams);angular.extend(qs,hash),qs.error?deferred.reject(qs):deferred.resolve(qs),$interval.cancel(polling),Popup.popupWindow.close()}}catch(error){}Popup.popupWindow&&!Popup.popupWindow.closed&&void 0!==Popup.popupWindow.closed||$interval.cancel(polling)},50);return deferred.promise},Popup.prepareOptions=function(options){options=options||{};var width=options.width||500,height=options.height||500;return angular.extend({width:width,height:height,left:$window.screenX+($window.outerWidth-width)/2,top:$window.screenY+($window.outerHeight-height)/2.5},options)},Popup.stringifyOptions=function(options){var parts=[];return angular.forEach(options,function(value,key){parts.push(key+"="+value)}),parts.join(",")},Popup}angular.module("ringid.social").factory("socialPopup",socialPopup),socialPopup.$inject=["$$q","$interval","$window","socialConfig","socialUtils","utilsFactory"]}(),function(){"use strict";function socialOauth(socialConfig,socialOauth1,socialOauth2){var Oauth={};return Oauth.authenticate=function(name,credentials){var provider="1.0"===socialConfig.providers[name].type?new socialOauth1:new socialOauth2;return provider.open(socialConfig.providers[name],credentials)},Oauth}function socialOauth2($q,$window,utils,config,Storage,utilsFactory,socialPopup,$ringhttp){return function(){function buildQueryString(){var keyValuePairs=[],urlParams=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return angular.forEach(urlParams,function(params){angular.forEach(defaults[params],function(paramName){var camelizedName=utils.camelCase(paramName),paramValue=angular.isFunction(defaults[paramName])?defaults[paramName]():defaults[camelizedName];keyValuePairs.push([paramName,paramValue])})}),keyValuePairs.map(function(pair){return pair.join("=")}).join("&")}var Oauth2={},defaults={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"token",responseParams:{token:"token",clientId:"clientId",redirectUri:"redirectUri"}};return Oauth2.open=function(options,whatFor){var defer=$q.defer();defaults=angular.extend({},options,defaults);var url,openPopup,stateName=defaults.name+"_state";angular.isFunction(defaults.state)?Storage.setData(stateName,defaults.state()):angular.isString(defaults.state)&&Storage.setData(stateName,defaults.state),url=[defaults.authorizationEndpoint,buildQueryString(whatFor)].join("?"),RingLogger.information("authorization url: "+url,RingLogger.tags.AUTH),openPopup=socialPopup.open(url,defaults.name,defaults.popupOptions,defaults.redirectUri);var interval=setInterval(function(){openPopup.popupWindow.closed&&(clearInterval(interval),defer.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return openPopup.pollPopup().then(function(authData){clearInterval(interval),$ringhttp.get("https://graph.facebook.com/me?access_token="+authData.access_token).success(function(userData){RingLogger.information("SOCIAL USER DATA: ",RingLogger.tags.AUTH),RingLogger.print(userData,RingLogger.tags.AUTH),userData.id?defer.resolve({platform:defaults.name,id:userData.id,name:userData.name,access_token:authData.access_token}):defer.reject()}).error(function(){defer.reject()})},function(){defer.reject({mg:"Popup blocked by Browser. Please unblock."})}),defer.promise},Oauth2}}function socialOauth1($q,socialConfig,socialUtils,socialPopup,$ringhttp){return function(){function exchangeForToken(data,credentials){credentials.uId=credentials.uId.toString();var queryString="?step=3&oauth_token="+data.oauth_token+"&verifier="+data.oauth_verifier+(credentials.uId&&credentials.uId.length>2?"&uId="+credentials.uId:"")+"&time="+(new Date).getTime();return RingLogger.information("exhcangeForToken URL: "+defaults.serverUrl+queryString,RingLogger.tags.AUTH),$ringhttp.get(defaults.serverUrl+queryString)}function exchangeForRequest(){return RingLogger.information("exchangeForRequest URL: "+defaults.serverUrl+"?step=1&callback="+defaults.redirectUri,RingLogger.tags.AUTH),$ringhttp.get(defaults.serverUrl+"?step=1&callback="+defaults.redirectUri+"&time="+(new Date).getTime())}function buildQueryString(obj){var str=[];return angular.forEach(obj,function(value,key){str.push(key+"="+value)}),str.join("&")}var Oauth1={},defaults={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return Oauth1.open=function(options,credentials){var popupWindow,defer=$q.defer();angular.extend(defaults,options),RingLogger.print(defaults,RingLogger.tags.AUTH),popupWindow=socialPopup.open("",defaults.name,defaults.popupOptions,defaults.redirectUri);var interval=setInterval(function(){popupWindow.popupWindow.closed&&(clearInterval(interval),defer.reject({sucs:!1,mg:"Popup Closed unexpectedly!"}))},1e3);return exchangeForRequest().success(function(response){if(response.sucs===!0){var tokenData=response.data,auth_url=[defaults.authorizationEndpoint,buildQueryString({oauth_token:tokenData.token,callback_url:defaults.redirectUri})].join("?");popupWindow.popupWindow?(popupWindow.popupWindow.location=auth_url,RingLogger.information("TWITTER authorize url: "+auth_url,RingLogger.tags.AUTH),RingLogger.print("REQUEST TOKEN DATA: ",tokenData,RingLogger.tags.AUTH),popupWindow.pollPopup().then(function(authData){clearInterval(interval),exchangeForToken(authData,credentials).success(function(response){if(response.sucs===!0||2===response.rc){var accessData=response.data.members;RingLogger.print("ACCESS TOKEN DATA: ",authData,accessData,RingLogger.tags.AUTH);var userDetails=JSON.parse(accessData.userDetails),accessToken=JSON.parse(accessData.accessToken);defer.resolve({platform:defaults.name,id:userDetails.id_str,name:userDetails.name,access_token:accessToken.token,oauthParameters:accessToken.oauthParameters,oauth_token:authData.oauth_token,oauth_verifier:authData.oauth_verifier})}else defer.reject({mg:"exchangeForRequest failed"})}).error(function(){defer.reject({mg:"exchangeForRequest failed. Server error"})})})):defer.reject({mg:"Popup blocked by Browser. Please unblock."})}else defer.reject({mg:"exchangeForRequest failed"})}).error(function(){RingLogger.alert("twitter oauth request token fetch fail",RingLogger.tags.AUTH),defer.reject({mg:"exchangeForRequest failed. Server error"})}),defer.promise},Oauth1}}angular.module("ringid.social").factory("socialOauth",socialOauth).factory("socialOauth1",socialOauth1).factory("socialOauth2",socialOauth2),socialOauth.$inject=["socialConfig","socialOauth1","socialOauth2"],socialOauth2.$inject=["$$q","$window","socialUtils","socialConfig","Storage","utilsFactory","socialPopup","$ringhttp"],socialOauth1.$inject=["$q","socialConfig","socialUtils","socialPopup","$ringhttp"]}(),function(){"use strict";angular.module("ringid.social").provider("$authSocial",["socialConfig",function(socialConfig){angular.forEach(Object.keys(socialConfig.providers),function(provider){this[provider]=function(params){return angular.extend(socialConfig.providers[provider],params)}},this);var oauth=function(params){socialConfig.providers[params.name]=socialConfig.providers[params.name]||{},angular.extend(socialConfig.providers[params.name],params)};this.oauth1=function(params){oauth(params),socialConfig.providers[params.name].type="1.0"},this.oauth2=function(params){oauth(params),socialConfig.providers[params.name].type="2.0"},this.$get=["$$q","socialOauth",function($q,oauth){var $authSocial={};return $authSocial.login=function(platform){var authData,deferred=$q.defer();return authData?deferred.resolve(authData):oauth.authenticate(platform,"login").then(function(authData){deferred.resolve(authData)},function(err){deferred.reject(err)}),deferred.promise},$authSocial.authenticate=function(platform,credentials){var defer=$q.defer();return oauth.authenticate(platform,credentials).then(function(authData){defer.resolve(authData)},function(err){defer.reject(err)}),defer.promise},$authSocial}]}])}(),function(){"use strict";angular.module("ringid.auth",["ringid.config","ringid.connector","ringid.common.services","ringid.common.factories","ringid.utils","ringid.social"])}(),function(){"use strict";function authHttpService($$connector,$ringhttp,settings,utilsFactory,OPERATION_TYPES){var self=this,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE,OTYPES=OPERATION_TYPES.SYSTEM,OTYPES_AUTH=OPERATION_TYPES.SYSTEM.AUTH;self.login=function(obj){var payload={usrPw:obj.password,actn:OTYPES.AUTH.TYPE_SIGN_IN,lt:1,vsn:settings.apiVersion,wk:utilsFactory.getUniqueID(),dvc:5,tbid:utilsFactory.tabId,did:obj.did};switch(obj.authMethod){case"ringid":payload.lt=1,payload.uId=obj.remember?obj.ringid:"21"+obj.ringid;break;case"email":payload.lt=3,payload.el=obj.email.utf8Encode();break;case"facebook":payload.uId=obj.uId,payload.pen=1,payload.lt=4,payload.apt=1,payload.smid=obj.id,payload.it=obj.access_token,delete payload.usrPw;break;case"twitter":payload.uId=obj.uId,delete payload.usrPw,payload.smid=obj.id,payload.it=obj.access_token,payload.lt=5;break;default:payload.lt=2,payload.mbl=obj.mbl,payload.mblDc=obj.mblDc}return obj.salt&&obj.sId&&(payload.salt=obj.salt,payload.sId=obj.sId),$$connector.request(payload,REQTYPE.AUTHENTICATION)},self.recoverySendCode=function(obj,sendSms){var payload={actn:OTYPES_AUTH.PASSWORD_RECOVER_SEND_CODE,wk:utilsFactory.getUniqueID()};return sendSms?(payload.lt=2,payload.rb=obj.mbl,payload.mbl=obj.mbl,payload.mblDc=obj.mblDc):(payload.lt=3,payload.rb=obj.email,payload.el=obj.email.utf8Encode()),$$connector.request(payload,REQTYPE.AUTHENTICATION)},self.recoveryVerifyCode=function(obj){var payload={actn:OTYPES_AUTH.PASSWORD_RECOVER_VERIFY_CODE,uId:obj.uId,vc:obj.vc,wk:utilsFactory.getUniqueID(),lt:1};return $$connector.request(payload,REQTYPE.AUTHENTICATION)},self.resetPassword=function(obj){var payload={actn:OTYPES_AUTH.PASSWORD_RECOVER,uId:obj.uId,nPw:obj.password,wk:utilsFactory.getUniqueID(),lt:1};return $$connector.request(payload,REQTYPE.AUTHENTICATION)},self.logout=function(){var payload={actn:OTYPES_AUTH.TYPE_SIGN_OUT};return $$connector.request(payload,REQTYPE.AUTHENTICATION)},self.isValidSession=function(obj){return $$connector.request({actn:OTYPES_AUTH.TYPE_SESSION_VALIDATION,dvcc:5,utId:obj.utId,did:obj.did},REQTYPE.AUTHENTICATION)},self.signupInit=function(did){return $ringhttp.get(settings.signupInit+"did="+did+"&time="+(new Date).getTime())},self.signupSendCode=function(obj){
var emailSignup="email"===obj.authMethod,payload={actn:emailSignup?OTYPES_AUTH.SIGNUP_SEND_CODE_EMAIL:OTYPES_AUTH.SIGNUP_SEND_CODE_PHONE,wk:utilsFactory.getUniqueID(),uId:obj.uId,did:obj.did,lt:1};return emailSignup?payload.el=obj.email.utf8Encode():(payload.mbl=obj.mbl,payload.mblDc=obj.mblDc),$$connector.request(payload,REQTYPE.AUTHENTICATION)},self.signupVerifyCode=function(obj){var emailSignup="email"===obj.authMethod,payload={actn:emailSignup?OTYPES_AUTH.SIGNUP_SEND_CODE_EMAIL:OTYPES_AUTH.SIGNUP_SEND_CODE_PHONE,wk:utilsFactory.getUniqueID(),uId:obj.uId,did:obj.did,lt:1};return emailSignup?(payload.el=obj.email.utf8Encode(),payload.evc=obj.vc):(payload.mbl=obj.mbl,payload.mblDc=obj.mblDc,payload.vc=obj.vc),$$connector.request(payload,REQTYPE.AUTHENTICATION)},self.signup=function(obj){var payload={actn:OTYPES_AUTH.SIGNUP_REGISTER,wk:utilsFactory.getUniqueID(),uId:obj.uId,did:obj.did,nm:obj.name.utf8Encode(),usrPw:obj.password,lt:1,ispc:0,mbl:obj.mbl,mblDc:obj.mblDc};switch(obj.authMethod){case"email":payload.el=obj.email.utf8Encode(),payload.evc=obj.vc;break;case"facebook":payload.fb=obj.id,payload.it=obj.access_token,payload.lt=4;break;case"twitter":payload.twtr=obj.id,payload.it=obj.access_token,payload.lt=5;break;default:payload.mbl=obj.mbl,payload.mblDc=obj.mblDc,payload.vc=obj.vc}return $$connector.request(payload,REQTYPE.AUTHENTICATION)},self.validMobileNo=function(obj){return $ringhttp.get(settings.signupSocialInit+"lt="+obj.lt+"&mblDc="+obj.mblDc+"&mbl="+obj.mbl+"&apt=1&t"+(new Date).getTime())},self.validSocialId=function(obj){var url;return"facebook"===obj.platform?url=settings.signupSocialInit+"fb="+obj.id+"&lt=4":"twitter"===obj.platform&&(url=settings.signupSocialInit+"twtr="+obj.id+"&lt=5"),$ringhttp.get(url+"&time="+(new Date).getTime())}}angular.module("ringid.auth").service("authHttpService",authHttpService),authHttpService.$inject=["$$connector","$ringhttp","settings","utilsFactory","OPERATION_TYPES"]}(),function(){"use strict";function AuthFactory(SystemEvents,$rootScope,Storage,utilsFactory,$q,$ringhttp,settings,userFactory,authHttpService,$ringbox,Ringalert,profileHttpService,countryListService){function save(user){return Service._currentUser=user,user}function updateLocalStorageLoginData(loginData){loginData&&(Service.loginData=loginData,Storage.setData("loginData",loginData))}function _saveDataForRememberMe(credentials,loginData,days){try{var remData={eUser:loginData.authEUsername,ePass:loginData.authEPassword,eSalt:loginData.authESalt,sId:loginData.sId,lt:credentials.login_type};Storage.setData("remInfo",remData);var sessionId=Storage.getCookie("sessionID");Storage.setCookie("sessionID",sessionId,days)}catch(e){}}function initializeSignup(credentials,isSocial){var defer=$q.defer();return authHttpService.signupInit(_did).success(function(response){response.success===!0?(setCookies({uId:response.ringID,authServer:response.authServerIP,comPort:response.comPort}),credentials=angular.extend(credentials,{uId:response.ringID,did:_did}),isSocial?defer.resolve(credentials):authHttpService.signupSendCode(credentials).then(function(json){defer.resolve(angular.extend(json,{uId:response.ringID}))},function(errJson){RingLogger.print(errJson,RingLogger.tags.AUTH),defer.reject(errJson)})):defer.reject(response)}).error(function(){RingLogger.alert("fetching new ringid failed",RingLogger.tags.AUTH),defer.reject()}),defer.promise}function requestLogin(loginRequestData,defer){loginRequestData.did=_did,requestCount++;var loginTimeout=setTimeout(function(){requestCount=0,clearTimeout(loginTimeout),defer.reject({sucs:!1,mg:"Reqeust Failed"})},1e4);authHttpService.login(loginRequestData).then(function(json){clearTimeout(loginTimeout),requestCount=0,json.sucs===!0?(loginRequestData.remember&&_saveDataForRememberMe(loginRequestData,json,30),doLoginTasks(json,!0),defer.resolve(json)):defer.reject(json)},function(){clearTimeout(loginTimeout),requestCount=0,defer.reject({sucs:!1,mg:"Reqeust Failed"})})}function preLoad(templateUrl){setTimeout(function(){$ringhttp.get(templateUrl).success(function(){RingLogger.information("TEMPLATE PRELOADED: "+templateUrl,RingLogger.tags.DEFAULT)})},100)}function doLoginTasks(loginData,fromLogin){Service.loginData=loginData,setCookies(loginData,fromLogin?30:!1),save(userFactory.create(loginData,!0,!0)),Storage.init(loginData),setTimeout(preloadTemplates.forEach(preLoad),2e3),profileHttpService.verifyCheck().then(function(json){_permission=json,RingLogger.information(json,RingLogger.tags.PROFILE)},function(){RingLogger.warning("User Permission fetch fail",RingLogger.tags.PROFILE)}),$rootScope.$broadcast(SystemEvents.AUTH.LOGIN,{silent:!!loginData.silent})}var sessionID=Storage.getCookie("sessionID"),requestCount=0,_permission={},_countryList=[],_countryData={login_type:"+880",countryFlag:"b880"},_sId=Storage.getCookie("sId"),_uId=Storage.getCookie("uId"),_utId=Storage.getCookie("utId"),_did=utilsFactory.generateUUID();$rootScope.$on("ringActive",function(){RingLogger.print("ringactive Fired "+sessionID,"ringactiveTest"),RingLogger.print("ringactive cookie"+Cookies.get("sessionID"),"ringactiveTest"),Cookies.get("sessionID")!==sessionID&&(RingLogger.print("ringactive reloaded","ringactiveTest"),window.location.reload())});var delete_cookie=function(name){document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},clearCookies=function(keepSessionId){delete_cookie("uId"),delete_cookie("sId"),keepSessionId||(delete_cookie("sessionID"),sessionID=void 0),delete_cookie("la"),RingLogger.print("cookie deleted : keepSessionId:"+keepSessionId,RingLogger.tags.AUTH)},setCookies=function(loginData,days){Storage.setCookie("uId",loginData.uId||"",days),Storage.setCookie("sId",loginData.sId||"",days),Storage.setCookie("utId",loginData.utId||"",days),Storage.setCookie("la",(new Date).getTime(),days),loginData.authServer&&Storage.setCookie("authServer",loginData.authServer||"",days),loginData.comPort&&Storage.setCookie("comPort",loginData.comPort||"",days)},reloadHome=function(timeout,withRand){timeout&&(clearCookies(),Storage.reset()),withRand?setTimeout(function(){window.location="/?rand="+utilsFactory.getUniqueID()},timeout):setTimeout(function(){window.location="/"},timeout)},Service={_currentUser:null,_validSession:!1,indexTemplate:"pages/index-login.html",sendCode:initializeSignup,updateLocalStorageLoginData:updateLocalStorageLoginData,verifyCode:function(credentials){return credentials=angular.extend({},credentials,{did:_did}),authHttpService.signupVerifyCode(credentials)},signup:function(credentials){var deferred=$q.defer();return angular.extend(credentials,{did:_did}),authHttpService.signup(credentials).then(function(json){RingLogger.print(json,RingLogger.tags.AUTH),deferred.resolve(json)},function(){deferred.reject()}),deferred.promise},openSignup:function(socialData,credentials){var deferred=$q.defer();return authHttpService.validSocialId(socialData).success(function(response){RingLogger.print(response,RingLogger.tags.AUTH),response.success===!1&&2===response.rc?($ringbox.open({type:"remote",scope:!1,controller:"SignUpController",resolve:{localData:{socialData:socialData,credentials:credentials},remoteData:angular.noop},templateUrl:"pages/welcome/ring-signup-popup.html"}),deferred.resolve()):deferred.reject({rc:"dologin",mg:"Already Registered Social ID"})}).error(function(){deferred.reject({rc:0,mg:"Request Failed"})}),deferred.promise},login:function(loginRequestData,isSocial){var defer=$q.defer();if(isSocial)authHttpService.validSocialId(angular.extend(loginRequestData,{did:_did})).success(function(json){RingLogger.print(json,RingLogger.tags.AUTH),json.success===!0||"true"===json.success?(setCookies({uId:json.ringID,authServer:json.authServerIP,comPort:json.comPort}),loginRequestData.uId=json.ringID,loginRequestData.login_type=loginRequestData.platform,requestLogin(loginRequestData,defer)):defer.reject({rc:"invalidsocialid",mg:"Unregistered Social ID. Please Register."})}).error(function(){defer.reject({rc:0,mg:"Request Failed"})});else{switch(loginRequestData.remember||Storage.deleteData("remInfo"),loginRequestData.authMethod){case"email":Storage.setData("autoFill",loginRequestData.email);break;case"ringid":Storage.setData("autoFill",loginRequestData.ringid);break;case"phone":Storage.setData("autoFill",loginRequestData.mbl)}requestLogin(loginRequestData,defer)}return defer.promise},logout:function(force){Service.isLoggedIn()&&($rootScope.$broadcast(SystemEvents.LOADING,!0),authHttpService.logout().then(function(response){$rootScope.$broadcast(SystemEvents.LOADING,!1),RingLogger.information(response,RingLogger.tags.AUTH),reloadHome(1)})),reloadHome(force?1:1e3)},clearCookies:function(keepSessionId){clearCookies(keepSessionId)},loginFromLocalData:function(){var defer=$q.defer(),remInfo=Storage.getData("remInfo",!0);if(remInfo){var loginRequestParams={username:remInfo.eUser,password:remInfo.ePass,salt:remInfo.eSalt,remember:!0,login_type:remInfo.lt,sId:remInfo.sId,silent:!0};Service.login(loginRequestParams).then(function(json){json.sucs?(RingLogger.print("Auto Login Success",RingLogger.tags.AUTH),defer.resolve(!0)):(RingLogger.print("Auto Login Failed",RingLogger.tags.AUTH),defer.reject(!1))},function(errData){RingLogger.print(errData,RingLogger.tags.AUTH),defer.reject(!1)})}else setTimeout(function(){defer.reject(!1)});return defer.promise},currentUser:function(){return Service._currentUser},isLoggedIn:function(){return!!Service._currentUser&&!!Storage.getCookie("sId")&&!!Storage.getCookie("sessionID")},isValidSession:function(){var defer=$q.defer();return Service._currentUser?authHttpService.isValidSession({did:_did,utId:Service._currentUser.getUtId()}).then(function(response){response.sucs?(Service._validSession=!0,defer.resolve(!0)):(Service._validSession=!1,defer.reject(!1))},function(){defer.reject(Service._validSession)}):setTimeout(function(){defer.reject(Service._validSession)},100),defer.promise},reloadHome:reloadHome,getCountry:function(){var countryData=Storage.getData("country");return countryData&&countryData.country&&(_countryData.login_type=countryData.code,_countryData.countryFlag=countryData.flagcode),_countryData},getCountryList:function(){return _countryList},getPermission:function(){return _permission},setAchatPermission:function(param){_permission.ancht=param}},preloadTemplates=["pages/dropdowns/notification-dropdown.html","pages/dropdowns/friend-request-dropdown.html","pages/partials/emoticon-window.html","pages/dropdowns/circle-list-dropdown.html","pages/dropdowns/search-dropdown.html","pages/partials/hovercards/profile-hover.html","pages/partials/notification/image-popup.html","pages/partials/notification/media-popup.html","pages/partials/notification/feed-popup_with_image.html","pages/partials/stickers/popups/sticker-market.html"],loginData=Storage.getData("loginData");return loginData?doLoginTasks(loginData):_uId&&_utId&&_sId?(Service._currentUser=userFactory.create({uId:_uId,utId:_utId},!0,!0),profileHttpService.getUserDetails({uId:_uId}).then(function(json){json.sucs===!0&&doLoginTasks(angular.extend(json.userDetails,{uId:_uId,sId:_sId,utId:_utId}))})):countryListService.getList().success(function(data){_countryList=data;var country=Storage.getData("country");country&&country.country?(_countryData.login_type=country.code,_countryData.countryFlag=country.flagcode):$ringhttp.get(settings.baseUrl+"country").success(function(country){if(country&&country.length>0){country=country.toLowerCase();for(var i=0;i<_countryList.length;i++)if(_countryList[i].country.toLowerCase()===country){_countryData.login_type=_countryList[i].code,_countryData.countryFlag=_countryList[i].flagcode,Storage.setData("country",_countryList[i]);break}}})}),Service}angular.module("ringid.auth").factory("Auth",AuthFactory),AuthFactory.$inject=["SystemEvents","$rootScope","Storage","utilsFactory","$q","$ringhttp","settings","userFactory","authHttpService","$ringbox","Ringalert","profileHttpService","countryListService"]}(),function(){"use strict";function AuthController(rgDropdownService,Storage,Auth,$scope,$$connector,countryListService,$rootScope,Ringalert){function activateTab(tabName){if(!$scope.disableForm){switch($scope.errorMsg="",$scope.activeTab=tabName,Storage.setData("activeTab",tabName),$scope.activeTab){case"email":$scope.credentials.authMethod="email",$scope.formStyle.left="-800px";break;case"ringid":$scope.credentials.authMethod="ringid",$scope.formStyle.left="-400px";break;case"social":$scope.credentials.authMethod="social",$scope.formStyle.left="-1200px";break;default:$scope.credentials.authMethod="phone",$scope.formStyle.left="0px",$scope.credentials.login_type=$scope.country?$scope.country.login_type:"+880"}$scope.$rgDigest()}}function setPrefix(actionObj){actionObj.event&&rgDropdownService.close(actionObj.event),Storage.setData("country",actionObj.item),$scope.credentials.mblDc=actionObj.item.code,$scope.credentials.countryFlag=actionObj.item.flagcode,$scope.$rgDigest()}function login(formValid,event){event&&event.preventDefault(),formValid&&($scope.requestFailed(!1),Auth.login($scope.credentials).then(function(loginData){loginData.sucs!==!0&&"true"!==loginData.sucs||($rootScope.$rgDigest(),$scope.closeAll()),$scope.requestFailed(loginData,$scope.credentials.authMethod,"signin")},function(errData){$scope.requestFailed(errData,$scope.credentials.authMethod,"signin")}))}$$connector.init(),$$connector.resume();var errMsg={signin:{email:"Login failed. Make sure you're entering your verified email and correct password.",phone:"Login failed. Make sure you're entering your verified phone and correct password.",ringid:"Login failed. Make sure you're entering correct ringID and password.",other:"Sorry, we are unable to complete your request. Please try again later."},signup:{sendcode:"Verification code has been sent to your email. Please check your spam folder also.",verify:"",signup:""},recovery:{email:"Sorry! we did not find your email. Make sure you're entering your verified email.",phone:"Sorry! we did not find your phone number. Make sure you're entering your verified phone number."}};$scope.socialRequestFailed=function(errData,which,whichOf){$scope.disableForm=!1,ga("send","event",location.hostname+":"+which,whichOf+" Message:"+errData.mg||"UNKNOWN"),Ringalert.show(errData.mg||"Request Failed","error"),RingLogger.print(errData,RingLogger.tags.AUTH),$scope.$rgDigest()},$scope.requestFailed=function(errData,which,whichOf,showOriginal){var analytics={signup:{success:{label:"Signup Success",value:"Auth Method: "+$scope.credentials.authMethod},fail:{label:"Signup Failed",value:"Auth Method: "+$scope.credentials.authMethod}},signin:{success:{label:"Signin Success",value:"Auth Method: "+$scope.credentials.authMethod},fail:{label:"Signin Failed",value:"Auth Method: "+$scope.credentials.authMethod}},recovery:{success:{label:"Recovery Success",value:"Auth Method: "+$scope.credentials.authMethod},fail:{label:"Recovery Failed",value:"Auth Method: "+$scope.credentials.authMethod}}};errData?($scope.disableForm=!1,errData.sucs===!0||"true"===errData.sucs?(ga("send","event",location.hostname+":"+analytics[whichOf].success.label+" :"+which,analytics[whichOf].success.value+" Message:"+errData.mg||"UNKNOWN"),$scope.requestSuccess=!0):(ga("send","event",location.hostname+":"+analytics[whichOf].fail.label+" :"+which,analytics[whichOf].fail.value+" Message:"+errData.mg||"UNKNOWN"),$scope.requestSuccess=!1),showOriginal||errData.hasOwnProperty("sucs")&&errData.sucs!==!0?$scope.errorMsg=errData.mg||"Request Failed":$scope.errorMsg=errMsg[whichOf][which]||errData.mg,RingLogger.print(errData,RingLogger.tags.AUTH)):($scope.disableForm=!0,$scope.requestSuccess=!0,$scope.errorMsg=""),$scope.$rgDigest()},$scope.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" ><li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',$scope.ddControl={append:!1,countryList:Auth.getCountryList},$scope.activeTab="phone",$scope.credentials={authMethod:"phone",uId:"",lt:2,mbl:"",mblDc:Auth.getCountry().login_type,email:"",ringid:"",password:"",remember:!1,countryFlag:Auth.getCountry().countryFlag},$scope.errorMsg="",$scope.requestSuccess=!1,$scope.disableForm=!1,$scope.formStyle={left:"0px"},$scope.activateTab=activateTab,$scope.setPrefix=setPrefix,$scope.login=login;var tempActive=Storage.getData("activeTab");if(tempActive){var tempAutofill=Storage.getData("autoFill");switch(tempActive){case"phone":$scope.credentials.mbl=tempAutofill,$scope.credentials.lt=2;break;case"email":$scope.credentials.lt=3,$scope.credentials.email=tempAutofill;break;case"ringid":$scope.credentials.ringid=tempAutofill,$scope.credentials.lt=1}activateTab(tempActive)}}angular.module("ringid.auth").controller("AuthController",AuthController),AuthController.$inject=["rgDropdownService","Storage","Auth","$scope","$$connector","countryListService","$rootScope","Ringalert"]}(),function(){"use strict";function SignInController($authSocial,$controller,$scope,$boxInstance,Auth,Ringalert,$rootScope){function authenticateUser(platform){$authSocial.authenticate(platform,$scope.credentials).then(function(authData){Auth.login(angular.extend(authData,$scope.credentials),!0).then(function(){ga("send","event","Signin Success. ","Auth Method: "+platform),$scope.close(),$rootScope.$rgDigest()},function(err){switch(err.rc){case"invalidsocialid":$scope.socialRequestFailed(err,platform,"Unregistered Social ID"),$boxInstance.showLoader(),Auth.sendCode($scope.credentials,!0).then(function(){$scope.close(),Auth.openSignup(authData,$scope.credentials)});break;default:$boxInstance.hideLoader(),$scope.socialRequestFailed(err,platform,"Something went wrong")}})},function(err){$boxInstance.hideLoader(),$scope.socialRequestFailed(err,platform,"Authentication Failed")})}angular.extend(this,$controller("AuthController",{$scope:$scope})),$scope.close=$boxInstance.close,$scope.closeAll=$boxInstance.closeAll,$scope.signIn=!0,$scope.noSignupAllowed=function(){Ringalert.alert({title:"Sign Up",message:"Please sign up from your iOS, Android, Windows enabled device or Desktop prior to logging in from the Web version.",showCancel:!1,okCallback:angular.noop})},$scope.socialLogin=function(platform){$scope.credentials.authMethod=platform,$boxInstance.showLoader(),authenticateUser("twitter"===platform?platform:platform)}}angular.module("ringid.auth").controller("SignInController",SignInController),SignInController.$inject=["$authSocial","$controller","$scope","$boxInstance","Auth","Ringalert","$rootScope"]}(),function(){"use strict";function SignUpController(countryListService,Ringalert,Auth,$scope,$controller,$boxInstance,$authSocial,remoteData,localData,Storage,rgDropdownService){function signupData(type){return{data:function(){return{signupType:type,login_type:"phone"===type?$scope.credentials.mblDc:"Email",countryFlag:"phone"===type?$scope.credentials.countryFlag:"remail"}}}}function sendCode(formValid,event){event.preventDefault(),$scope.disableForm?RingLogger.information("form already submitted",RingLogger.tags.AUTH):($scope.requestFailed(!1),Auth.sendCode($scope.credentials).then(function(json){json.sucs===!0&&($scope.credentials.uId=json.uId,$scope.newUid=json.uId.toString().substr(2),$scope.signupStep=2,$scope.formStyle.left="-350px"),$scope.requestFailed(json,"sendcode","signup")},function(errData){$scope.requestFailed(angular.extend(errData,{sucs:!1}),"sendcode","signup")}))}function verifyCode(formValid,event){event.preventDefault(),$scope.disableForm?RingLogger.information("form already submitted",RingLogger.tags.AUTH):($scope.requestFailed(!1),Auth.verifyCode($scope.credentials).then(function(json){json.sucs===!0&&($scope.signupStep=3,$scope.formStyle.left="-700px"),$scope.requestFailed(json,"verify","signup")},function(errData){$scope.requestFailed(angular.extend(errData,{sucs:!1}),"verify","signup")}))}function signup(formValid,event){event.preventDefault(),$scope.disableForm||$scope.credentials.password!==$scope.credentials.repassword?RingLogger.information("form already submitted"):($scope.requestFailed(!1),Auth.signup($scope.credentials).then(function(json){json.sucs===!0&&($scope.login(!0),Ringalert.show("Registraion succesful. You can login now","success"),$boxInstance.closeAll()),$scope.requestFailed(json,"sendCode","signup")},function(errData){$scope.requestFailed(angular.extend(errData,{sucs:!1}),"signup","signup")}))}angular.extend(this,$controller("AuthController",{$scope:$scope})),$scope.close=$boxInstance.close,$scope.closeAll=$boxInstance.closeAll,$scope.newUid="",$scope.credentials.repassword="",$scope.credentials.vc="",$scope.credentials.name="",$scope.signupStep=1,$scope.signupData=signupData,$scope.sendCode=sendCode,$scope.verifyCode=verifyCode,$scope.signup=signup,localData&&($scope.formStyle.left="0px",$scope.credentials.mbl="",$scope.credentials.email="",$scope.credentials.ringid="",$scope.credentials.password="",localData.signupData&&($scope.credentials.authMethod=localData.signupData.signupType,$scope.credentials.countryFlag=localData.signupData.countryFlag),localData.socialData&&(angular.extend($scope.credentials,localData.credentials),$scope.newUid=localData.credentials.uId.toString().substr(2),$scope.credentials.authMethod=localData.socialData.platform,$scope.credentials.id=localData.socialData.id,$scope.credentials.name=localData.socialData.name,$scope.credentials.access_token=localData.socialData.access_token,$scope.signupStep=3,$scope.formStyle.left="-700px")),remoteData&&($scope.newUid=remoteData.uId.toString().substr(2))}angular.module("ringid.auth").controller("SignUpController",SignUpController),SignUpController.$inject=["countryListService","Ringalert","Auth","$scope","$controller","$boxInstance","$authSocial","remoteData","localData","Storage","rgDropdownService"]}(),function(){"use strict";function SignUpSelectController(Auth,$scope,$controller,$boxInstance,$authSocial,Ringalert){angular.extend(this,$controller("AuthController",{$scope:$scope})),$scope.close=$boxInstance.close,$scope.closeAll=$boxInstance.closeAll,$scope.socialSignup=function(platform){$boxInstance.showLoader(),Auth.sendCode($scope.credentials,!0).then(function(){$authSocial.authenticate(platform,$scope.credentials).then(function(authData){ga("send","event","Signup Success. ","Auth Method: "+platform+" Social Authorization done"),RingLogger.print(authData,RingLogger.tags.AUTH),Auth.openSignup(authData,$scope.credentials).then(angular.noop,function(err){"dologin"===err.rc?(Ringalert.show("Existing User! Login in as "+authData.name,"warning"),$scope.credentials.authMethod=platform,$boxInstance.showLoader(),Auth.login(angular.extend(authData,$scope.credentials),!0).then(function(){ga("send","event","Signin Success. ","Auth Method: "+platform),$scope.closeAll()},function(err){$boxInstance.hideLoader(),$scope.socialRequestFailed(err,platform,"Social Login Failed")})):($boxInstance.hideLoader(),$scope.socialRequestFailed(err,platform,"Authentication Failed"))})},function(err){$boxInstance.hideLoader(),$scope.socialRequestFailed(err,platform,"Authentication Failed")})},function(err){$boxInstance.hideLoader(),$scope.socialRequestFailed(err,platform,"Authentication Failed")})},$scope.signupData=function(type){return{data:function(){return{signupData:{signupType:type,login_type:"phone"===type?Auth.getCountry().login_type:"Email",countryFlag:"phone"===type?Auth.getCountry().countryFlag:"remail"}}},promise:Auth.sendCode($scope.credentials)}}}angular.module("ringid.auth").controller("SignUpSelectController",SignUpSelectController),SignUpSelectController.$inject=["Auth","$scope","$controller","$boxInstance","$authSocial","Ringalert"]}(),function(){"use strict";function PasswordRecoverController($controller,Auth,$scope,$boxInstance,authHttpService,Ringalert){function sendCode(formValid,$event,phone){sendSms=phone,$event.preventDefault(),$scope.disableForm||($scope.requestFailed(!1),RingLogger.information($scope.credentials,RingLogger.tags.AUTH),authHttpService.recoverySendCode($scope.credentials,sendSms).then(function(json){json.sucs===!0&&($scope.activeForm="verifycode",$scope.credentials.uId=json.uId),$scope.requestFailed(json,sendSms?"phone":"email","recovery",!0)},function(errData){$scope.requestFailed(angular.extend(errData,{sucs:!1}),sendSms?"phone":"email","recovery")}))}function verifyCode(formValid,$event){$event.preventDefault(),$scope.disableForm||($scope.requestFailed(!1),RingLogger.information($scope.credentials,RingLogger.tags.AUTH),authHttpService.recoveryVerifyCode($scope.credentials).then(function(json){json.sucs===!0&&($scope.activeForm="resetpassword"),$scope.requestFailed(json,"verify","recovery",!0)},function(errData){$scope.requestFailed(angular.extend(errData,{sucs:!1}),"verify","recovery",!0)}))}function resetPassword(formValid,$event){$event.preventDefault(),$scope.disableForm||$scope.credentials.password!==$scope.credentials.repassword||($scope.requestFailed(!1),RingLogger.information($scope.credentials,RingLogger.tags.AUTH),authHttpService.resetPassword($scope.credentials).then(function(json){RingLogger.print(json,RingLogger.tags.AUTH),$scope.disableForm=!1,$scope.errorMsg=json.mg,json.sucs===!0&&(Ringalert.show("Reset succesful. You can login now","success"),$scope.close(),RingLogger.print("PASSWORD RESET SUCCESSFUL. YOU CAN LOGIN NOW",RingLogger.tags.AUTH)),$scope.requestFailed(json,"reset","recovery",!0)},function(errData){$scope.requestFailed(angular.extend(errData,{sucs:!1}),"reset","recovery",!0)}))}function activateTab(tabName){$scope.disableForm||"sendcode"!==$scope.activeForm||($scope.activeTab=tabName,"email"===$scope.activeTab?($scope.credentials.authMethod="email",$scope.formStyle.left="0px"):($scope.credentials.authMethod="phone",$scope.formStyle.left="-350px"),$scope.$rgDigest())}angular.extend(this,$controller("AuthController",{$scope:$scope})),$scope.close=$boxInstance.close;var sendSms;$scope.activeTab="email",$scope.activeForm="sendcode",$scope.activateTab=activateTab,$scope.activateTab($scope.activeTab),$scope.credentials.email="",$scope.credentials.mbl="",$scope.sendCode=sendCode,$scope.verifyCode=verifyCode,$scope.resetPassword=resetPassword}angular.module("ringid.auth").controller("PasswordRecoverController",PasswordRecoverController),PasswordRecoverController.$inject=["$controller","Auth","$scope","$boxInstance","authHttpService","Ringalert"]}(),function(){"use strict";angular.module("ringid.notification",["ringid.common.stacked_map","ringid.config","ringid.utils"])}(),function(){"use strict";function $$notiMap(circlesManager,OPERATION_TYPES,utilsFactory,settings){function setNotiMessage(noti){function othersHandler(){var counter=noti.uIdList.length-1;return counter>1?" and "+counter+" others ":1===counter?" and "+counter+" other ":""}var gName="",messageAndPopup={message:"",popupType:"",mayMerge:1};switch(noti.mt){case OTYPES.MSG_TYPE_UPDATE_PROFILE_IMAGE:messageAndPopup.message=noti.fndN+" updated his profile photo",messageAndPopup.popupType="image",messageAndPopup.mayMerge=2;break;case OTYPES.MSG_TYPE_UPDATE_COVER_IMAGE:messageAndPopup.message=noti.fndN+" updated his cover photo",messageAndPopup.popupType="image",messageAndPopup.mayMerge=2;break;case OTYPES.MSG_TYPE_LIKE_IMAGE:messageAndPopup.message=noti.fndN+othersHandler()+" liked your image",messageAndPopup.popupType="image";break;case OTYPES.MSG_TYPE_IMAGE_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" commented on your image",messageAndPopup.popupType="image";break;case OTYPES.MSG_TYPE_LIKE_IMAGE_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" liked your comment",messageAndPopup.popupType="image";break;case OTYPES.MSG_TYPE_ADD_FRIEND:messageAndPopup.message=noti.fndN+" wants to be friends with you",messageAndPopup.popupType="profile";break;case OTYPES.MSG_TYPE_ACCEPT_FRIEND:messageAndPopup.message=noti.fndN+" has accepted your friend request",messageAndPopup.popupType="profile";break;case OTYPES.MSG_TYPE_ADD_GROUP_MEMBER:gName=circlesManager.getCircle(noti.acId)?circlesManager.getCircle(noti.acId).getName():"",messageAndPopup.message=noti.fndN+" has added you in a group "+gName,messageAndPopup.popupType="group",messageAndPopup.mayMerge=0;break;case OTYPES.MSG_TYPE_ADD_STATUS_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" commented on your status",messageAndPopup.popupType="feed";break;case OTYPES.MSG_TYPE_LIKE_STATUS:messageAndPopup.message=noti.fndN+othersHandler()+" liked your status",messageAndPopup.popupType="feed";break;case OTYPES.MSG_TYPE_LIKE_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" liked your comment",messageAndPopup.popupType="feed";break;case OTYPES.MSG_TYPE_SHARE_STATUS:messageAndPopup.message=noti.fndN+othersHandler()+" shared your status",messageAndPopup.popupType="feed";break;case OTYPES.MSG_TYPE_LIKE_AUDIO_MEDIA:messageAndPopup.message=noti.fndN+othersHandler()+" Liked your audio",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_AUDIO_MEDIA_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" commented on your audio",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_LIKE_AUDIO_MEDIA_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" liked your comment on audio",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_AUDIO_MEDIA_VIEW:messageAndPopup.message=noti.fndN+othersHandler()+" viewed you audio",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_LIKE_VIDEO_MEDIA:messageAndPopup.message=noti.fndN+othersHandler()+" liked your video",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_VIDEO_MEDIA_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" commented on your video",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_LIKE_VIDEO_MEDIA_COMMENT:messageAndPopup.message=noti.fndN+othersHandler()+" like your comment on video",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_VIDEO_MEDIA_VIEW:messageAndPopup.message=noti.fndN+othersHandler()+" viewed you video",messageAndPopup.popupType="media";break;case OTYPES.MSG_TYPE_YOU_HAVE_BEEN_TAGGED:messageAndPopup.message=noti.fndN+" tagged you in a status",messageAndPopup.popupType="feed";break;default:messageAndPopup.popupType="nomatch",RingLogger.warn("messageAndPopup.message TYPE NOT FOUND"),messageAndPopup.mayMerge=0}return messageAndPopup}var OTYPES=OPERATION_TYPES.SYSTEM.NOTIFICATION;return{getSortIndex:function(){return"ut"},create:function(obj){var noti={acId:0,cmnId:0,fndId:0,fndN:"",id:0,imgId:0,loc:0,mt:0,nfId:0,ut:0,nt:0,prIm:0,uIdList:[],message:"",updateTime:"",popupType:"",groupId:0,user:null,seen:!1,mayMerge:1,othersCounter:0};angular.isObject(obj)&&(noti=angular.extend({},noti,obj),noti.updateTime=utilsFactory.verbalDate(obj.ut)||noti.ut);var msgPopup=setNotiMessage(noti);return noti.message=msgPopup.message,noti.popupType=msgPopup.popupType,noti.mayMerge=msgPopup.mayMerge,noti.fndId&&noti.uIdList.push(noti.fndId),{sortBy:function(){return noti.ut},getName:function(){return noti.fndN},isInUidList:function(uId){return noti.uIdList.indexOf(uId)>-1},uIdList:function(uId){return uId&&uId.length?void uId.forEach(function(u){-1===noti.uIdList.indexOf(u)&&noti.uIdList.push(u)}):noti.uIdList},getUid:function(){return noti.fndId},getUserAvatar:function(){if(noti.user)return noti.user.avatar("thumb");if(noti.prIm){var position=noti.prIm.lastIndexOf("/")+1;return[settings.imBase,noti.prIm.slice(0,position),"pthumb",noti.prIm.slice(position)].join("")}return"images/prof.png"},getMessage:function(){return noti.message},getTime:function(original){return original?noti.ut:noti.updateTime},updateNotiTime:function(){noti.updateTime=utilsFactory.verbalDate(noti.ut)},getKey:function(){return noti.id},getPopupType:function(){return noti.popupType;
},getMessageType:function(){return noti.mt},getNotiType:function(){return noti.nt},getActivityId:function(){return noti.acId},getNewsFeedId:function(){return noti.nfId},getLink:function(){var link="",params={};switch(noti.popupType){case"image":params.mediaId=noti.imgId,noti.cmnId&&(params.commentId=noti.cmnId),link=utilsFactory.getRingRoute("SINGLE_IMAGE",params);break;case"media":params.mediaId=noti.imgId,noti.cmnId&&(params.commentId=noti.cmnId),link=utilsFactory.getRingRoute("SINGLE_MEDIA",params);break;case"profile":link=utilsFactory.getRingRoute("USER_PROFILE",{uId:noti.fndId});break;case"group":link=utilsFactory.getRingRoute("CIRCLE_HOME",{circleId:noti.acId});break;case"feed":params.feedId=noti.nfId,noti.cmnId&&(params.commentId=noti.cmnId),link=utilsFactory.getRingRoute("SINGLE_FEED",params);break;default:link=""}return link},getImgId:function(){return noti.imgId},getCommentId:function(){return noti.cmnId},getSeenStatus:function(){return noti.seen},updateSeenStatus:function(seen){noti.seen=seen},canMerge:function(){return noti.mayMerge},setNotiMessage:function(mergeCounter){noti.othersCounter+=mergeCounter;var modified=setNotiMessage(noti);noti.message=modified.message},getRingboxTemplate:function(){var templatePath="";switch(noti.popupType){case"image":templatePath="pages/partials/notification/image-popup.html";break;case"media":templatePath="pages/partials/notification/media-popup.html";break;case"feed":templatePath="pages/partials/notification/feed-popup_with_image.html";break;default:templatePath=""}return templatePath},getControllerName:function(){return"image"===noti.popupType&&"RingBoxImagePopupController"||"feed"===noti.popupType&&"NotiPopupController"||"media"===noti.popupType&&"RingBoxMediaController"},showRingbox:function(){return"feed"===noti.popupType||"image"===noti.popupType||"media"===noti.popupType}}}}}angular.module("ringid.notification").factory("$$notiMap",$$notiMap),$$notiMap.$inject=["circlesManager","OPERATION_TYPES","utilsFactory","settings"]}(),function(){"use strict";function notificationHttpService($$connector,settings,OPERATION_TYPES){var self=this,OTYPES=OPERATION_TYPES.SYSTEM.NOTIFICATION,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE;self.requestNotification=function(obj){var payload={actn:OTYPES.TYPE_MY_NOTIFICATIONS};return obj&&obj.from_index>0&&(payload=angular.extend({},payload,obj)),RingLogger.print(payload,RingLogger.tags.NOTIFICATION),$$connector.pull(payload,REQTYPE.REQUEST)},self.clearNotiCount=function(){var d=new Date,t=d.getTime(),payload={actn:OTYPES.CLEAR_NOTIFICATION_COUNTER,ut:t};return RingLogger.print(payload,RingLogger.tags.NOTIFICATION),$$connector.request(payload,REQTYPE.REQUEST)},self.getNotificationDetails=function(obj){var payload={actn:OPERATION_TYPES.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:obj.activityId};return RingLogger.print(payload,RingLogger.tags.NOTIFICATION),$$connector.request(payload,REQTYPE.REQUEST)},self.getImageAlbumDetails=function(obj){var payload={actn:OPERATION_TYPES.SYSTEM.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,request_type:REQTYPE.REQUEST,imgId:obj.imgId};return RingLogger.print(payload,RingLogger.tags.NOTIFICATION),$$connector.request(payload,REQTYPE.REQUEST)}}angular.module("ringid.notification").service("notificationHttpService",notificationHttpService),notificationHttpService.$inject=["$$connector","settings","OPERATION_TYPES"]}(),function(){"use strict";function NotificationFactory($$connector,$q,Storage,notificationHttpService,$$stackedMap,$$notiMap,OPERATION_TYPES,$rootScope,SystemEvents,Auth){var updateTime,$notification=$$stackedMap.createNew(!0,"desc"),OTYPES=OPERATION_TYPES.SYSTEM.NOTIFICATION,from_index=0,notiCounter=0,minUpdateTime=-1,requestCounter=0,state={loading:!1,noData:!1},seenarr=Storage.getData("notiseen");seenarr||(seenarr=[],Storage.setData("notiseen",seenarr));var process=function(json){function mergeNoti(n){function processMerge(merge){n.value.getTime(!0)<noti.getTime(!0)?(RingLogger.information("DELETING OLD NOTIfication: "+n.value.getMessage()+" merging: "+merge,RingLogger.tags.NOTIFICATION),notiCounter=notiCounter>0?notiCounter-1:0,noti.uIdList(n.value.uIdList()),noti.setNotiMessage(),$notification.remove(n.value.getKey())):(saveNewNoti=!1,RingLogger.information("not saving new OTIFICATION: "+noti.getMessage()+" merging: "+merge,RingLogger.tags.NOTIFICATION),n.value.uIdList(noti.uIdList()),n.value.setNotiMessage())}if(n.value.getMessageType()===noti.getMessageType())if(1===n.value.canMerge())switch(n.value.getPopupType()){case"feed":n.value.getNewsFeedId()===noti.getNewsFeedId()&&processMerge(n.value.isInUidList(noti.getUid())?!1:!0);break;case"image":case"media":n.value.getImgId()===noti.getImgId()&&processMerge(n.value.isInUidList(noti.getUid())?!1:!0)}else 2===n.value.canMerge()&&n.value.getUid()===noti.getUid()&&processMerge(!1)}var noti,saveNewNoti=!0;switch(json.actn){case OTYPES.TYPE_MY_NOTIFICATIONS:if(RingLogger.print(json,RingLogger.tags.NOTIFICATION),json.sucs===!0||"true"===json.sucs){var timeArray=[];from_index+=json.nList.length,notiCounter=json.tn;for(var i=0;i<json.nList.length;i++)if(saveNewNoti=!0,noti=$$notiMap.create(json.nList[i]),$notification.all().forEach(mergeNoti),updateTime=json.nList[i].ut,timeArray.push(updateTime),saveNewNoti){for(var j=0;j<seenarr.length;j++)seenarr[j]===json.nList[i].id&&noti.updateSeenStatus(!0);$notification.save(noti.getKey(),noti)}else notiCounter=notiCounter>0?notiCounter-1:0;var sortedTime=timeArray.sort();minUpdateTime=sortedTime[0]}else RingLogger.warning("Notification list request failed",RingLogger.tags.NOTIFICATION);break;case OTYPES.TYPE_SINGLE_NOTIFICATION:from_index++,saveNewNoti=!0,noti=$$notiMap.create(json),$notification.all().forEach(mergeNoti),RingLogger.information("got new notification: "+noti.getMessage(),RingLogger.tags.NOTIFICATION),saveNewNoti&&($notification.save(noti.getKey(),noti),notiCounter++);break;default:RingLogger.warning("Notification Subscriber action did not match: "+json.actn,RingLogger.tags.NOTIFICATION)}},loadMoreNoti=function(toIndex){toIndex=toIndex||10;var deferred=$q.defer();requestCounter++,state.noData=requestCounter>1;var obj={from_index:from_index>0?from_index:0,to_index:from_index>0?from_index+toIndex:toIndex,scl:2,ut:minUpdateTime};return notificationHttpService.requestNotification(obj).then(function(json){json.sucs===!0||"true"===json.sucs?(requestCounter=0,deferred.resolve()):(state.noData=!0,deferred.reject())},function(){deferred.reject()}),deferred.promise};return $$connector.subscribe(process,{action:[OTYPES.TYPE_MY_NOTIFICATIONS,OTYPES.TYPE_SINGLE_NOTIFICATION]}),Auth.isLoggedIn()?loadMoreNoti():$rootScope.$on(SystemEvents.AUTH.LOGIN,function(){setTimeout(function(){loadMoreNoti()},5e3)}),{state:state,loadMoreNoti:loadMoreNoti,process:process,getNotifications:function(){return $notification},getNotification:function(key){return $notification.get(key)},clearCounter:function(){notiCounter>0&&notificationHttpService.clearNotiCount().then(function(json){RingLogger.information("NOTIFICATION COUNT CLEAR RESPONSE",RingLogger.tags.NOTIFICATION),RingLogger.print(json,RingLogger.tags.NOTIFICATION),notiCounter=0});for(var i=0;i<$notification.length();i++){var timediff=Date.now()-$notification.all()[i].value.sortBy();36e5>timediff&&$notification.all()[i].value.updateNotiTime()}},getNotiCount:function(){return notiCounter>99?"99+":notiCounter}}}angular.module("ringid.notification").factory("NotificationFactory",NotificationFactory),NotificationFactory.$inject=["$$connector","$q","Storage","notificationHttpService","$$stackedMap","$$notiMap","OPERATION_TYPES","$rootScope","SystemEvents","Auth"]}(),function(){"use strict";function rgNotification($window,$document,$ringhttp,$compile){function NotificationController(NotificationFactory,$location,circlesManager,ImageFactory,Auth,Media,rgDropdownService,Ringalert,Storage,$scope,rgScrollbarService,OPERATION_TYPES,$$connector,notificationHttpService){function getRingboxData(noti){switch(noti.value.getPopupType()){case"image":return notificationAction({action:"image",noti:noti.value,nfId:noti.value.getNewsFeedId(),imgId:noti.value.getImgId(),templateType:"image"});case"media":return notificationAction({action:"media",noti:noti.value,nfId:noti.value.getNewsFeedId(),mediaId:noti.value.getImgId(),templateType:"media"});case"feed":return notificationAction({action:"ringbox",nfId:noti.value.getNewsFeedId(),noti:noti.value,templateType:"feed_with_text"})}}function notificationAction(actionObj){rgDropdownService.close();var seenarr=Storage.getData("notiseen");switch(-1===seenarr.indexOf(actionObj.noti.getKey())&&(seenarr.push(actionObj.noti.getKey()),actionObj.noti.updateSeenStatus(!0),seenarr.length>150&&seenarr.shift()),Storage.setData("notiseen",seenarr),actionObj.action){case"redirect":var circle=circlesManager.getCircle(actionObj.circleId);if(circle){var loc=actionObj.link.slice(1);$location.path(loc)}else Ringalert.show("Circle does not exist!","error");break;case"ringbox":return{data:function(){return{notiKey:actionObj.noti.getKey(),noti:actionObj.noti,templateType:actionObj.templateType}},promise:notificationHttpService.getNotificationDetails({activityId:actionObj.nfId})};case"media":return{data:function(){return{notiKey:actionObj.noti.getKey(),noti:actionObj.noti,mediaId:actionObj.mediaId,popupFrom:"notification",templateType:actionObj.templateType}},promise:Media.fetchContentDetails(actionObj.mediaId,!0,Auth.currentUser())};case"image":return{data:function(){return{notiKey:actionObj.noti.getKey(),noti:actionObj.noti,imgId:actionObj.imgId,popupFrom:"notification",templateType:actionObj.templateType}},promise:ImageFactory.getImageDetails(actionObj.imgId,actionObj.nfId)};default:RingLogger.log("NO MATCHING ACTION")}}function toggleLoading(bool){$scope.state.loading=bool,bool||rgScrollbarService.recalculate($scope),$scope.$rgDigest()}function loadMoreNotification(){$scope.state.loading||$scope.state.noData||(clearTimeout(requestTimeout),toggleLoading(!0),RingLogger.information("Load Notification",RingLogger.tags.NOTIFICATION),NotificationFactory.loadMoreNoti(loadCount).then(function(){$scope.notifications.length()<loadCount&&loadMoreNotification(),toggleLoading(!1)},function(){RingLogger.alert("Notification Fetch Fail",RingLogger.tags.NOTIFICATION),toggleLoading(!1)}),requestTimeout=setTimeout(function(){toggleLoading(!1)},3e3))}var requestTimeout,loadCount=parseInt($scope.loadCount),OTYPES=OPERATION_TYPES.SYSTEM.NOTIFICATION;$scope.state=NotificationFactory.state,$scope.notifications=NotificationFactory.getNotifications(),$scope.loadMoreNotification=loadMoreNotification,$scope.getRingboxData=getRingboxData,$scope.notificationAction=NotificationFactory.notificationAction,$scope.getAllNotifications=function(){},$scope.notifications.length()<loadCount&&loadMoreNotification();var subscriptionKey=$$connector.subscribe(function(){setTimeout(function(){$scope.$rgDigest()})},{action:[OTYPES.TYPE_MY_NOTIFICATIONS,OTYPES.TYPE_SINGLE_NOTIFICATION]});$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey)})}function linkFunc(scope,element,attr){var templateUrl=attr.templateUrl?attr.templateUrl:"pages/dropdowns/notification-dropdown.html";$ringhttp.get(templateUrl).success(function(template){element.append($compile(template)(scope)),scope.$rgDigest()})}return NotificationController.$inject=["NotificationFactory","$location","circlesManager","ImageFactory","Auth","Media","rgDropdownService","Ringalert","Storage","$scope","rgScrollbarService","OPERATION_TYPES","$$connector","notificationHttpService"],{restrict:"AE",controller:NotificationController,scope:{loadCount:"@",templateUrl:"@"},link:linkFunc}}angular.module("ringid.notification").directive("rgNotification",rgNotification),rgNotification.$inject=["$window","$document","$ringhttp","$compile"]}(),function(){"use strict";function NotiPopupController($$connector,OPERATION_TYPES,Auth,$scope,localData,remoteData,notificationFactory,$$feedMap,feedFactory,rgDropdownService,Ringalert,MESSAGES,Media){function getMediaData(media,feed){return feed||(feed=$scope.feed),{data:function(){return{media:media,album:feed.getAlbum(),feedTime:feed.time()}},promise:Media.fetchContentDetails(media.getKey(),!0,feed.user())}}var showWhoShare=(OPERATION_TYPES.SYSTEM,OPERATION_TYPES.SYSTEM.NOTIFICATION,!0);if($scope.currentUser=Auth.currentUser(),$scope.feed={},$scope.focused=!1,$scope.showCommentBox=!0,$scope.nocontent=!1,$scope.ddHtml="pages/dropdowns/feed-edit-dropdown.html",$scope.getMediaData=getMediaData,localData&&localData.notiKey&&($scope.key=localData.notiKey,$scope.noti=localData.noti,$scope.templateType=localData.templateType),$scope.boxIsLoading=!1,remoteData.sucs===!1)return $scope.nocontent=!0,Ringalert.show(remoteData,"error"),$scope.$close(),!1;RingLogger.debug(remoteData.newsFeedList,RingLogger.tags.NOTIFICATION);var shareData=angular.fromJson(remoteData.newsFeedList);if(showWhoShare&&shareData[0]&&shareData[0].orgFd){$scope.feed=$$feedMap.create(shareData[0]);var _d1=$$feedMap.create(shareData[0].orgFd);$scope.feed.shares(_d1)}else $scope.feed=$$feedMap.create(remoteData.newsFeedList[0]);$scope.keyid=$scope.feed&&$scope.feed.getKey(),($scope.feed.hasMedia()||$scope.feed.hasSharedFeed()&&$scope.feed.getOrginalFeed().getImages().length)&&($scope.templateType="feed_with_image"),$scope.noti.getCommentId()>0&&($scope.activeCommentId=$scope.noti.getCommentId()),$scope.shareMenuDisabled=$scope.shareMenuDisabled?$scope.shareMenuDisabled:!1;$scope.toggleCommentBox=function(event){event.stopPropagation(),$scope.showCommentBox=!$scope.showCommentBox,$scope.showCommentBox&&($scope.showShareBox=!1)},$scope.toggleShareBox=function(event){event.stopPropagation();var f=$scope.feed.hasSharedFeed()?$scope.feed.getOrginalFeed():$scope.feed,shareablle=f.isShareAble(!0);shareablle.sucs?($scope.showShareBox=!$scope.showShareBox,$scope.showShareBox&&($scope.showCommentBox=!1)):Ringalert.show(MESSAGES[shareablle.rc],"warning")},$scope.getImageData=function(image,feed){return function(){return{image:image,feed:feed}}}}angular.module("ringid.notification").controller("NotiPopupController",NotiPopupController),NotiPopupController.$inject=["$$connector","OPERATION_TYPES","Auth","$scope","localData","remoteData","NotificationFactory","$$feedMap","feedFactory","rgDropdownService","Ringalert","MESSAGES","Media"]}(),function(){"use strict";function friendsFactory($q,Contacts,APP_CONSTANTS,Auth,Storage,$$connector,OPERATION_TYPES,userFactory,friendsHttpService,$$stackedMap,Ringalert){function initFriends(scope){$$connector.subscribe(fFactory.process,{action:[OTYPES.TYPE_CONTACT_UTIDS,OTYPES.TYPE_UPDATE_ADD_FRIEND,OTYPES.TYPE_UPDATE_DELETE_FRIEND,OTYPES.TYPE_UPDATE_ACCEPT_FRIEND],scope:scope}),Contacts.init(),friendsHttpService.getContactList();var retryCount=0,interval=setInterval(function(){retryCount++,0===Contacts.utIds().length()&&30>retryCount?friendsHttpService.getContactList():clearInterval(interval)},2e3)}function addToUtIdList(which,utid){switch(which){case"utIds":Contacts.utIds().save(utid,{frnS:AC.FRIEND});break;case"incomingUtIds":Contacts.incomingUtIds().save(utid,{frnS:AC.INCOMING_FRIEND});break;case"outgoingUtIds":Contacts.outgoingUtIds().save(utid,{frnS:AC.OUTGOING_FRIEND})}}var intervalContactList,OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS,AC=APP_CONSTANTS,userFriendsCount=0,userFriendsSt=0,utIdRequest={totalPacket:0,complete:!1},_utIDsToByteArray=function(utIds){var i,l,index,byteArray=[],contactList=[],requestedUtIds=[];for(i=0,l=utIds.length;l>i;i++)utIds[i]!==Auth.currentUser().getUtId()&&(Storage.getContact(utIds[i])?contactList.push(Storage.getContact(utIds[i])):requestedUtIds.push(utIds[i]));contactList.lenght>0&&_setContacts(contactList);var buf=new ArrayBuffer(8*requestedUtIds.length),utIDsArray=new DataView(buf);for(i=0,index=0,l=requestedUtIds.length;l>i;i++)utIDsArray.setInt32(index,0),index+=4,utIDsArray.setInt32(index,requestedUtIds[i]),index+=4;for(i=0;i<utIDsArray.byteLength;i++)byteArray.push(utIDsArray.getInt8(i));return byteArray},_clearUtId=function(utId,removeContacts,removeAll){var success=Contacts.remove("utIds",utId);removeContacts&&fFactory.friends.remove(utId),success&&!removeAll||(success=Contacts.remove("incomingUtIds",utId),removeContacts&&fFactory.incomingFriends.remove(utId),success&&!removeAll||(success=Contacts.remove("outgoingUtIds",utId),removeContacts&&fFactory.outgoingFriends.remove(utId)))},_setContacts=function(contactList){for(var friend,frnS,i=0,l=contactList.length;l>i;i++)friend=userFactory.create(contactList[i]),frnS=friend.friendshipStatus(),frnS===AC.FRIEND?fFactory.friends.save(friend.getUtId(),friend):frnS===AC.INCOMING_FRIEND?fFactory.incomingFriends.save(friend.getUtId(),friend):frnS===AC.OUTGOING_FRIEND?fFactory.outgoingFriends.save(friend.getUtId(),friend):(RingLogger.warning("Friendship Status not matched: "+friend.getName()+" frnS: "+friend.friendshipStatus(),RingLogger.tags.FRIEND),RingLogger.print(contactList[i],RingLogger.tags.FRIEND)),_clearUtId(contactList[i].utId,!1,!0)},processResponse=function(json){var friend,i,l;switch(json.actn){case OTYPES.TYPE_CONTACT_UTIDS:if(json.sucs===!0){for(clearInterval(intervalContactList),0!==utIdRequest.totalPacket||utIdRequest.complete||(utIdRequest.totalPacket=json.totalPacket),utIdRequest.totalPacket--,i=0,l=json.utIds.length;l>i;i++)switch(json.utIds[i].value.frnS){case AC.FRIEND:Contacts.add("utIds",json.utIds[i].key,json.utIds[i].value);break;case AC.INCOMING_FRIEND:Contacts.add("incomingUtIds",json.utIds[i].key,json.utIds[i].value);break;case AC.OUTGOING_FRIEND:Contacts.add("outgoingUtIds",json.utIds[i].key,json.utIds[i].value);break;default:RingLogger.information("contact not needed: "+json.utIds[i].value.frnS,RingLogger.tags.FRIEND)}0===utIdRequest.totalPacket&&(utIdRequest.complete=!0,Contacts.initStorage(),RingLogger.information("contact friend: "+Contacts.utIds().length(),RingLogger.tags.FRIEND),RingLogger.information("contact incoming: "+Contacts.incomingUtIds().length(),RingLogger.tags.FRIEND),RingLogger.information("contact outgoing: "+Contacts.outgoingUtIds().length(),RingLogger.tags.FRIEND))}else RingLogger.warning("Contact List utID Request response fail",RingLogger.tags.FRIEND);break;case OTYPES.TYPE_UPDATE_ADD_FRIEND:RingLogger.information("TYPE_UPDATE_ADD_FRIEND",RingLogger.tags.FRIEND),json.sucs===!0&&Contacts.add("incomingUtIds",json.utId,{frns:AC.INCOMING_FRIEND});break;case OTYPES.TYPE_UPDATE_DELETE_FRIEND:RingLogger.information("TYPE_UPDATE_DELETE_FRIEND",RingLogger.tags.FRIEND),json.sucs===!0&&(json.utId?(_clearUtId(json.utId,!0,!0),friend=userFactory.create(json),friend.updateUserObj({frnS:AC.NOT_FRIEND})):RingLogger.warning("missing utId",RingLogger.tags.FRIEND));break;case OTYPES.TYPE_UPDATE_ACCEPT_FRIEND:RingLogger.information("TYPE_UPDATE_ACCEPT_FRIEND",RingLogger.tags.FRIEND),json.sucs===!0&&(_clearUtId(json.utId,!0),fFactory.friends.add(json.utId,userFactory.create(json)));break;default:RingLogger.warning("Friends Factory subscriber process case missmatch for action: "+json.actn,RingLogger.tags.FRIEND)}},getFriends=function(type){switch(type){case"friendslist":case"friends":return fFactory.friends;case"incoming":return fFactory.incomingFriends;case"outgoing":return fFactory.outgoingFriends;case"userfriends":return fFactory.userFriends}},resetUserFriends=function(){userFriendsCount=0,fFactory.userFriends.reset()},getUserContacts=function(utId){var friend,defer=$q.defer();return friendsHttpService.getUserContacts(utId,userFriendsSt).then(function(json){if(userFriendsCount=0===userFriendsCount?json.tf:userFriendsCount,json.sucs===!0){RingLogger.print(json,RingLogger.tags.FRIEND),userFriendsSt+=json.contactList.length;for(var i=0;i<json.contactList.length;i++)friend=userFactory.create(json.contactList[i]),fFactory.userFriends.save(friend.getKey(),friend);defer.resolve()}else RingLogger.alert("FRIENDS FRIENDLIST FETCH FAIL",RingLogger.tags.FRIEND),defer.reject()},function(){RingLogger.warning("friends friendlist fetch fail",RingLogger.tags.FRIEND)}),defer.promise},getContactDetails=function(type,getRecord){var i,utidByteArray=[],defer=$q.defer();switch(getRecord=getRecord?getRecord:20,type=type?type:"utIds"){case"friends":case"friendslist":case"utIds":utidByteArray=_utIDsToByteArray(Contacts.utIds().keys().slice(0,getRecord)),fFactory.state.isFriendsLoading=utidByteArray.length>0;break;case"userfriends":RingLogger.warning("FETCH USER FRIEND LIST",RingLogger.tags.FRIEND);break;case"incoming":case"incomingUtIds":utidByteArray=_utIDsToByteArray(Contacts.incomingUtIds().keys().slice(0,getRecord)),RingLogger.print(utidByteArray,RingLogger.tags.FRIEND);break;case"outgoing":case"outgoingUtIds":utidByteArray=_utIDsToByteArray(Contacts.outgoingUtIds().keys().slice(0,getRecord))}return utidByteArray.length>0?friendsHttpService.getContactListDetails({utIDs:utidByteArray,uo:!1}).then(function(json){if(RingLogger.information("success data",RingLogger.tags.FRIEND),RingLogger.print(json,RingLogger.tags.FRIEND),json.sucs===!0){for(i=0;i<json.contacts.length;i++)Storage.setContact(json.contacts[i].utId,json.contacts[i]);_setContacts(json.contacts),defer.resolve(json)}else RingLogger.warning("Contact List Detail Request fail",RingLogger.tags.FRIEND),defer.reject(json)},function(errData){RingLogger.informaiton("error data",RingLogger.tags.FRIEND),RingLogger.print(errData,RingLogger.tags.FRIEND),defer.reject()}):defer.reject(),defer.promise},getContactDetailsByUtIds=function(utIds){if(utIds.length>0){var utidByteArray=_utIDsToByteArray(utIds);if(utidByteArray.length>0)return friendsHttpService.getContactListDetails({utIDs:utidByteArray,uo:!1})}},peopleYouMayKnowList=function(obj){return friendsHttpService.getPeopleYouMayKnow(obj||{})},friendAction=function(obj,returnPromise){switch(obj.friend.isLoading(!0),obj.action){case"remove":case"unfriend":return removeFriend(obj,returnPromise);case"add":case"addfriend":return addFriend(obj,returnPromise);case"accept":return acceptFriendRequest(obj,returnPromise);case"incoming_reject":case"outgoing_reject":case"reject":return rejectFriendRequest(obj,returnPromise);case"block":return obj.block=1,obj.bv=0,blockFriend(obj,returnPromise);case"unblock":return obj.block=0,obj.bv=1,blockFriend(obj,returnPromise);default:return obj.friend.isLoading(!1),RingLogger.warning("FRIEND ACTION DID NO MATCH",RingLogger.tags.FRIEND),!1}},addFriend=function(obj,returnPromise){var defer=returnPromise?$q.defer():!1,utId=obj.friend.getUtId();utId||RingLogger.warning("missing UtId",RingLogger.tags.FRIEND);var timeOut=setTimeout(function(){obj.friend.isLoading(!1),returnPromise&&defer.reject({sucs:!1,mg:"Reqeust Failed"})},5e3);return friendsHttpService.sendFriendRequest({uId:obj.friend.getKey()}).then(function(json){clearTimeout(timeOut),obj.friend.isLoading(!1),json.sucs===!0&&(Ringalert.show("Friend request sent","success"),Contacts.add("outgoingUtIds",utId,{frns:AC.OUTGOING_FRIEND}),returnPromise&&defer.resolve(json),obj.friend.updateUserObj(angular.extend({},json,{frns:AC.OUTGOING_FRIEND})))},function(errData){clearTimeout(timeOut),obj.friend.isLoading(!1),Ringalert.show("Friend request sent failed","error"),returnPromise&&defer.reject(errData)}),returnPromise?defer.promise:void 0},acceptFriendRequest=function(obj,returnPromise){var defer=returnPromise?$q.defer():!1,utId=obj.friend.getUtId(),timeOut=setTimeout(function(){obj.friend.isLoading(!1),returnPromise&&defer.reject({sucs:!1,mg:"Reqeust Failed"})},5e3);return friendsHttpService.acceptFriendRequest({friendId:obj.friend.getKey(),utId:obj.friend.getUtId()}).then(function(json){clearTimeout(timeOut),RingLogger.print(json,RingLogger.tags.FRIEND),obj.friend.isLoading(!1),json.sucs===!0?(_clearUtId(utId,!0),obj.friend.updateUserObj(angular.extend({},json,{frnS:AC.FRIEND})),fFactory.friends.save(utId,obj.friend),Ringalert.show("You have become friends with "+obj.friend.getName(),"success"),returnPromise&&defer.resolve(json)):(Ringalert.show("Request failed","error"),returnPromise&&defer.reject())},function(){clearTimeout(timeOut),obj.friend.isLoading(!1),returnPromise&&defer.reject()}),returnPromise?defer.promise:void 0},removeFriend=function(obj,returnPromise){var defer=returnPromise?$q.defer():!1,utId=obj.friend.getUtId(),timeOut=setTimeout(function(){obj.friend.isLoading(!1),returnPromise&&defer.reject({sucs:!1,mg:"Reqeust Failed"})},5e3);return friendsHttpService.unFriend({friendId:obj.friend.getKey()}).then(function(json){clearTimeout(timeOut),RingLogger.print(json,RingLogger.tags.FRIEND),obj.friend.isLoading(!1),json.sucs===!0?(Ringalert.show("Friend removed succesfully","success"),_clearUtId(utId,!0,!0),obj.friend.updateUserObj(angular.extend({},json,{frnS:AC.NOT_FRIEND})),returnPromise&&defer.resolve(json)):(Ringalert.show("Friend remove Failed","error"),returnPromise&&defer.reject())},function(){clearTimeout(timeOut),obj.friend.isLoading(!1),returnPromise&&defer.reject()}),returnPromise?defer.promise:void 0},rejectFriendRequest=function(obj,returnPromise){var defer=returnPromise?$q.defer():!1,utId=obj.friend.getUtId();utId||RingLogger.warning("missing UtId",RingLogger.tags.FRIEND);var timeOut=setTimeout(function(){obj.friend.isLoading(!1),returnPromise&&defer.reject({sucs:!1,mg:"Reqeust Failed"})},5e3);return friendsHttpService.unFriend({friendId:obj.friend.getKey()}).then(function(json){clearTimeout(timeOut),obj.friend.isLoading(!1),json.sucs===!0?(Ringalert.show("Rejected succesfully","success"),obj.friend.updateUserObj(angular.extend({},json,{frnS:AC.NOT_FRIEND})),_clearUtId(utId,!0,!0),returnPromise&&defer.resolve(json)):(Ringalert.show("Reqeust Failed","error"),returnPromise&&defer.reject())},function(){clearTimeout(timeOut),returnPromise&&defer.reject(),obj.friend.isLoading(!1)}),returnPromise?defer.promise:void 0},blockFriend=function(obj,returnPromise){var defer=returnPromise?$q.defer():!1,timeOut=setTimeout(function(){obj.friend.isLoading(!1),returnPromise&&defer.reject({sucs:!1,mg:"Reqeust Failed"})},5e3);return friendsHttpService.blockFriend(obj).then(function(json){clearTimeout(timeOut),obj.friend.isLoading(!1),json.sucs===!0?(Ringalert.show("Friend "+(0===obj.bv?"blocked":"unblocked")+" successfully","success"),obj.friend.setBlock(obj.block)):Ringalert.show("Friend "+(0===obj.bv?"blocked":"unblocked")+" successfully","error"),returnPromise&&defer.resolve()},function(){clearTimeout(timeOut),obj.friend.isLoading(!1),returnPromise&&defer.reject()}),returnPromise?defer.promise:void 0},getIds=function(){for(var keys="",i=0;i<fFactory.friends.size();i++)keys+=",".fFactory.friends[i].getKey();return keys},searchContact=function(searchVal,friendOnly){if(friendOnly){var defer=$q.defer();return friendsHttpService.searchContact(searchVal,friendOnly).then(function(json){json.sucs?defer.resolve():(RingLogger.alert("FRIEND SEARCH RETURNED false",RingLogger.tags.FRIEND),defer.reject())},function(){RingLogger.alert("FRIEND SEARCH RETURNED error",RingLogger.tags.FRIEND),defer.reject()},function(json){if(json.sucs===!0){for(var i=0;i<json.searchedcontaclist.length;i++)Storage.setContact(json.searchedcontaclist[i].utId,json.searchedcontaclist[i]);_setContacts(json.searchedcontaclist)}else RingLogger.alert("FRIEND SEARCH RETURNED false",RingLogger.tags.FRIEND),defer.reject()}),defer.promise}return friendsHttpService.searchContact(searchVal,!1)},fFactory={state:{noFriends:!1,isFriendsLoading:!1,isUserFriendsLoading:!1,isRequestsLoading:!1},getRequestCount:function(){var count=Contacts.incomingUtIds().length()+fFactory.incomingFriends.length();return count>99?"99+":count},getPendingCount:function(){return Contacts.outgoingUtIds().length()+fFactory.outgoingFriends.length()},totalFriends:function(friendType){return"userfriends"===friendType?userFriendsCount:Contacts.utIds().length()+fFactory.friends.length()},totalUserFriends:function(){return userFriendsCount},friends:$$stackedMap.createNew(),userFriends:$$stackedMap.createNew(),incomingFriends:$$stackedMap.createNew(),outgoingFriends:$$stackedMap.createNew(),process:processResponse,getFriends:getFriends,resetUserFriends:resetUserFriends,getUserContacts:getUserContacts,getContactDetails:getContactDetails,getContactDetailsByUtIds:getContactDetailsByUtIds,peopleYouMayKnowList:peopleYouMayKnowList,removeFriend:removeFriend,friendAction:friendAction,addFriend:addFriend,rejectFriendRequest:rejectFriendRequest,acceptFriendRequest:acceptFriendRequest,searchContact:searchContact,initFriends:initFriends,addToUtIdList:addToUtIdList,blockFriend:blockFriend,getIds:getIds,getCurrentUser:function(){return Auth.currentUser},utIDsToByteArray:_utIDsToByteArray};return fFactory}angular.module("ringid.friend.friends_factory",["ringid.auth","ringid.common.stacked_map","ringid.common.contacts_factory","ringid.common.user_factory","ringid.common.services","ringid.common.factories"]).factory("friendsFactory",friendsFactory),friendsFactory.$inject=["$$q","Contacts","APP_CONSTANTS","Auth","Storage","$$connector","OPERATION_TYPES","userFactory","friendsHttpService","$$stackedMap","Ringalert"]}(),function(){"use strict";function friendsHttpService($$connector,OPERATION_TYPES,APP_CONSTANTS){var self=this,OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS,AC=APP_CONSTANTS,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE;self.searchContact=function(obj,friendOnly){var payload={actn:friendOnly?OTYPES.ACTION_FRIEND_SEARCH:OTYPES.TYPE_CONTACT_SEARCH,scat:AC.TYPE_SEARCH_BY_ALL,schPm:obj.schPm.utf8Encode(),st:obj.st||0},regexEmail=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return regexEmail.test(obj.schPm)&&(payload.scat=AC.TYPE_SEARCH_BY_EMAIL),$$connector.pull(payload,REQTYPE.REQUEST,!0)},self.getContactList=function(ut){var payload={actn:OTYPES.TYPE_CONTACT_UTIDS,cut:-1,ut:ut||-1};return $$connector.send(payload,REQTYPE.REQUEST)},self.getContactListDetails=function(obj){var payload={actn:OTYPES.TYPE_CONTACT_LIST,uo:obj.uo||!1,utIDs:obj.utIDs};return $$connector.pull(payload,REQTYPE.REQUEST,!0)},self.getUserContacts=function(utId,st){var payload={actn:OTYPES.TYPE_FRIEND_CONTACT_LIST,utId:utId,st:st||0};return $$connector.pull(payload,REQTYPE.REQUEST)},self.unFriend=function(obj){var payload={actn:OTYPES.TYPE_DELETE_FRIEND,uId:obj.friendId};return $$connector.request(payload,REQTYPE.UPDATE,!0)},self.changeFriendType=function(obj){var payload={actn:OTYPES.TYPE_ACTION_CHANGE_FRIEND_ACCESS,ct:obj.ct,utId:obj.utId};return $$connector.request(payload,REQTYPE.UPDATE)},self.sendFriendRequest=function(obj){var payload={actn:OTYPES.TYPE_ADD_FRIEND,uId:obj.uId};return $$connector.request(payload,REQTYPE.UPDATE,!0)},self.blockFriend=function(obj){var payload={actn:OTYPES.TYPE_ACTION_BLOCK_UNBLOCK_FRIEND,idList:[obj.friend.getUtId()],bv:obj.bv};return $$connector.request(payload,REQTYPE.REQUEST)},self.saveCallPvcEdit=function(obj){var payload={actn:obj.actn,sn:obj.callsn,sv:obj.sv,utId:obj.friend.getUtId()};return $$connector.request(payload,REQTYPE.UPDATE)},self.saveChatPvcEdit=function(obj){var payload={actn:obj.actn,sn:obj.chatsn,sv:obj.sv,utId:obj.friend.getUtId()};return $$connector.request(payload,REQTYPE.UPDATE)},self.saveFeedPvcEdit=function(obj){var payload={actn:obj.actn,sn:obj.feedsn,sv:obj.sv,utId:obj.friend.getUtId()};return $$connector.request(payload,REQTYPE.UPDATE)},self.acceptFriendRequest=function(obj){var payload={actn:OTYPES.TYPE_ACCEPT_FRIEND,utId:obj.utId};return $$connector.request(payload,REQTYPE.UPDATE,!0)}}angular.module("ringid.friend.friends_factory").service("friendsHttpService",friendsHttpService),friendsHttpService.$inject=["$$connector","OPERATION_TYPES","APP_CONSTANTS"]}(),function(){"use strict";angular.module("ringid.friend",["ringid.config","ringid.friend.friends_factory"])}(),function(){"use strict";function rgFriends(friendsFactory,$ringhttp,$compile,$routeParams,$window,$document,Contacts,APP_CONSTANTS){function FriendsController($scope,$attrs,profileFactory,$document,InviteFactory,rgScrollbarService,Contacts,User,$$stackedMap,rgDropdownService,$$connector,OPERATION_TYPES,Ringalert){
function setDropdown(){$scope.ddTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==0 && !ddControl.isCurrentUser()" rg-click="ddAction()({ action: \'addfriend\', friend: ddControl})" href="#"><span class="icon-addf f-16"></span><span class="txt">{{consType.add_friend}}</span></a><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl})" href="#"> <span class="icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.friendshipStatus()==2" rg-click="ddAction()({ action: \'accept\', friend: ddControl})" href="#"><span class="icon-incoming f-16"></span><span class="txt">{{consType.accept}}</span></a><a  ng-if="ddControl.friendshipStatus()==3" rg-click="ddAction()({ action: \'remove\', friend: ddControl})" href="#"><span class="icon-minus-cr f-14"></span><span class="txt">{{consType.remove}}</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl})" class="border-0" href="#"><span class="icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl})" class="border-0" href="#"><span class="icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a></div>',$scope.ddAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),rgDropdownService.close())}}function loadMutualFriends(){var friend;mutualFriends.length>0&&(toggleLoading(!0),friendsFactory.getContactDetailsByUtIds(mutualFriends.splice(0,10),!0).then(function(json){if(RingLogger.print(json,RingLogger.tags.FRIEND),json.sucs===!0)for(var i=0;i<json.contacts.length;i++)friend=User.create(json.contacts[i]),$scope.friends.save(friend.getKey(),friend);toggleLoading(!1)}))}function toggleLoading(bool){clearTimeout(timeOut),$scope.state.loading=!!bool,bool||rgScrollbarService.recalculate($scope),$scope.state.loading?RingLogger.warning("FRIENDS LOADING.........",RingLogger.tags.FRIEND):RingLogger.warning("END FRIENDS LOADING.........",RingLogger.tags.FRIEND),$scope.$rgDigest()}function searchContact(){("friends"===$scope.rgFriendsType||"friendslist"===$scope.rgFriendsType)&&$scope.friendName&&$scope.friendName.length>0&&(toggleLoading(!0),friendsFactory.searchContact({schPm:$scope.friendName},!0).then(function(){toggleLoading(!1)},function(){toggleLoading(!1)}))}function loadMoreFriends(force){var whatToCall,param;$scope.showMutual?loadMutualFriends():$scope.showPending?(toggleLoading(!0),friendsFactory.getContactDetails("outgoing").then(function(){toggleLoading(!1)},function(){toggleLoading(!1)})):(force||!$scope.state.loading&&$scope.friends.length()!==$scope.totalFriends($scope.rgFriendsType))&&(toggleLoading(!0),"userfriends"===$scope.rgFriendsType?(whatToCall=friendsFactory.getUserContacts,param=$scope.profileObj.getUtId()):whatToCall=friendsFactory.getContactDetails,whatToCall(param).then(function(){RingLogger.information("FRIENDS LENGTH: "+$scope.friends.length(),RingLogger.tags.FRIEND),$scope.friends.length()<20&&$scope.friends.length()<$scope.totalFriends($scope.rgFriendsType)?(RingLogger.warning("NEED TO PULL MORE FRIENDS",RingLogger.tags.FRIEND),loadMoreFriends()):toggleLoading(!1)},function(){toggleLoading(!1),RingLogger.alert("friend Details fetch fail",RingLogger.tags.FRIEND)}),timeOut=setTimeout(toggleLoading,5e3))}function getMutualFriend(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}}var timeOut,intervalTrack,OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS,intervalCount=0,mutualFriends=[];switch($scope.isOwner=!1,$scope.showMutual=!1,$scope.showPending=!1,$scope.friendName="",$scope.state={loading:!1,noData:!1},$scope.friends=friendsFactory.getFriends($scope.rgFriendsType),$scope.totalFriends=friendsFactory.totalFriends,$scope.getPendingCount=friendsFactory.getPendingCount,$scope.rgFriendsType){case"friendslist":friendsFactory.initFriends($scope),intervalTrack=setInterval(function(){intervalCount++,Contacts.utIds().length()>0?(RingLogger.warning("FRIEND LOAD INTERVAL.....",RingLogger.tags.FRIEND),loadMoreFriends(!0),clearInterval(intervalTrack)):intervalCount>30?(RingLogger.warning("FRIEND LOAD INTERVAL LIMIT REACHED...",RingLogger.tags.FRIEND),$scope.state.noData=!0,toggleLoading(!1),clearInterval(intervalTrack)):(RingLogger.warning("CAN NOT LOAD INTERVAL. EMPTY utid list",RingLogger.tags.FRIEND),toggleLoading(!0))},2e3);break;case"friends":$scope.isOwner=!0,$scope.pendingRequests=friendsFactory.getFriends("outgoing"),setDropdown();var retryCount=0;$scope.friends.length()<5&&(toggleLoading(!0),intervalTrack=setInterval(function(){retryCount++,$scope.friends.length()<20&&Contacts.utIds().length()>1?loadMoreFriends(!0):retryCount>30&&(toggleLoading(!1),clearInterval(intervalTrack))},2e3));break;case"userfriends":toggleLoading(!0),setDropdown(),$scope.profileObj=profileFactory.getProfile($routeParams.uId),friendsFactory.getUserContacts($scope.profileObj.getUtId()).then(function(){toggleLoading(!1)}),$scope.totalUserFriends=friendsFactory.totalUserFriends,InviteFactory.getMutualFriend($scope.profileObj).then(function(json){RingLogger.print(json,RingLogger.tags.FRIEND),$scope.profileObj.updateUserObj({nmf:json.mfIDs.length}),mutualFriends=json.mfIDs,$scope.$rgDigest()});break;default:RingLogger.alert("Friend type not found ",RingLogger.tags.FRIEND)}$scope.toggleShowMutual=function(bool){$scope.showMutual=!!bool,$scope.showMutual&&loadMutualFriends(),$scope.$rgDigest()},$scope.toggleShowPending=function(bool){$scope.showPending=!!bool,$scope.showPending?($scope.friends=friendsFactory.getFriends("outgoing"),toggleLoading(!0),friendsFactory.getContactDetails("outgoing").then(function(){toggleLoading(!1)},function(){toggleLoading(!1)})):$scope.friends=friendsFactory.getFriends($scope.rgFriendsType),$scope.$rgDigest()},$scope.loadMoreFriends=loadMoreFriends,$scope.getMutualFriend=getMutualFriend,$scope.searchContact=searchContact,$scope.showComingSoon=function($event){$event.preventDefault(),Ringalert.show("Coming soon","info")};var subscriptionKey=$$connector.subscribe(function(){setTimeout(function(){$scope.state.noData=0===$scope.friends.length(),$scope.$rgDigest()},200)},{action:[OTYPES.TYPE_UPDATE_ADD_FRIEND,OTYPES.TYPE_UPDATE_DELETE_FRIEND]});$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey)})}function linkFunc(scope,element,attrs){function loadMore(){$window.innerHeight+$window.scrollY>=$document[0].body.offsetHeight&&scope.loadMoreFriends()}var utids;$ringhttp.get(attrs.rgFriendsTpl).success(function(template){element.append($compile(template)(scope)),scope.$rgDigest()}),"friends"!==scope.rgFriendsType&&"userfriends"!==scope.rgFriendsType||(RingLogger.information("enable scroll event:",RingLogger.tags.FRIEND),angular.element($window).on("scroll",loadMore)),scope.$on("$destroy",function(){switch("userfriends"===scope.rgFriendsType&&friendsFactory.resetUserFriends(),scope.rgFriendsType){case"friends":utids=friendsFactory.outgoingFriends.keys();for(var i=0;i<utids.length;i++)Contacts.add("outgoingUtIds",utids[i],{frnS:APP_CONSTANTS.INCOMING_FRIEND});friendsFactory.outgoingFriends.reset();case"userFriends":angular.element($window).off("scroll",loadMore)}})}return FriendsController.$inject=["$scope","$attrs","profileFactory","$document","InviteFactory","rgScrollbarService","Contacts","userFactory","$$stackedMap","rgDropdownService","$$connector","OPERATION_TYPES","Ringalert"],{restrict:"AE",scope:{rgFriendsType:"@"},controller:FriendsController,link:linkFunc}}angular.module("ringid.friend").directive("rgFriends",rgFriends),rgFriends.$inject=["friendsFactory","$ringhttp","$compile","$routeParams","$window","$document","Contacts","APP_CONSTANTS"]}(),function(){"use strict";function rgRequests(friendsFactory,$compile,$routeParams,$window,$document,$ringhttp){function RequestsController($scope,profileFactory,InviteFactory,rgScrollbarService,Contacts,OPERATION_TYPES,$$connector,userFactory,Ringalert){function toggleLoading(bool){$scope.state.loading=bool,rgScrollbarService.recalculate($scope),$scope.$rgDigest()}function loadMoreRequests(force){var timeout;(force||!$scope.state.noData&&!$scope.state.loading)&&(toggleLoading(!0),friendsFactory.getContactDetails("incoming",loadCount).then(function(){clearTimeout(timeout),RingLogger.information("FRIENDS LENGTH: "+$scope.requests.length(),RingLogger.tags.FRIEND),toggleLoading(!1)},function(){clearTimeout(timeout),$scope.state.noData=0===Contacts.incomingUtIds().length(),toggleLoading(!1),RingLogger.warning("friend Details fetch fail",RingLogger.tags.FRIEND)}),timeout=setTimeout(function(){toggleLoading(!1)},3e3))}function getMutualFriend(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}}var subscriptionKey,intervalTrack,OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS,loadCount=parseInt($scope.loadCount),intervalCount=0;$scope.state={loading:!1,noData:!1},$scope.requests=friendsFactory.getFriends("incoming"),$scope.friendAction=function(actionObj){actionObj.friend.isLoading()||friendsFactory.friendAction(actionObj,!0).then(function(){$scope.requests.length()<loadCount&&loadMoreRequests(),$scope.$rgDigest()},function(){$scope.requests.length()<loadCount&&loadMoreRequests(),$scope.$rgDigest()})},$scope.loadMoreRequests=loadMoreRequests,$scope.getMutualFriend=getMutualFriend,$scope.getRequestCount=friendsFactory.getRequestCount,$scope.getIncomingRequest=function(){var testobj={};return{data:function(){return{target:testobj}},promise:friendsFactory.getContactDetails("incoming",30)}},subscriptionKey=$$connector.subscribe(function(){setTimeout(function(){$scope.state.noData=$scope.requests.length()>0,$scope.$rgDigest()},500)},{action:[OTYPES.TYPE_UPDATE_ADD_FRIEND,OTYPES.TYPE_UPDATE_DELETE_FRIEND]}),$scope.requests.length()<loadCount&&(toggleLoading(!0),intervalTrack=setInterval(function(){intervalCount++,Contacts.incomingUtIds().length()>0?(loadMoreRequests(!0),clearInterval(intervalTrack)):intervalCount>6&&(toggleLoading(!1),$scope.state.noData=0===Contacts.incomingUtIds().length(),$scope.$rgDigest(),clearInterval(intervalTrack))},500)),$scope.$on("$destroy",function(){$$connector.unsubscribe(subscriptionKey)})}function linkFunc(scope,element,attr){var templateUrl=attr.templateUrl?attr.templateUrl:"pages/dropdowns/friend-request-dropdown.html";$ringhttp.get(templateUrl).success(function(template){element.append($compile(template)(scope)),scope.$rgDigest()})}return RequestsController.$inject=["$scope","profileFactory","InviteFactory","rgScrollbarService","Contacts","OPERATION_TYPES","$$connector","userFactory","Ringalert"],{restrict:"AE",scope:{loadOnScroll:"@",loadCount:"@",templateUrl:"@"},link:linkFunc,controller:RequestsController}}angular.module("ringid.friend").directive("rgRequests",rgRequests),rgRequests.$inject=["friendsFactory","$compile","$routeParams","$window","$document","$ringhttp"]}(),function(){"use strict";function rgUpload($compile,fileUploadService,Media){function UploadController(Auth,$scope,mediaMetadata,imageQuality,APP_CONSTANTS,SystemEvents,Ringalert,$q,$rootScope,rgDropdownService){function resetUpload(){totalFileSize=0,$scope.previewStartAt=0,$scope.ddControl.uploadWhat="image",$scope.ddControl.createAlbum=!1,$scope.ddControl.albumName="",$scope.ddControl.selectedAlbum=0,fileUploadService.resetUpload(),$scope.tagList=fileUploadService.tagList,$scope.$rgDigest()}function getMedia(){return fileUploadService[$scope.ddControl.uploadWhat+"Files"].slice($scope.previewStartAt,$scope.previewStartAt+3)}function removeMedia(index){RingLogger.warning("REMOVING MEDIA FROM UPLOAD: "+fileUploadService[$scope.ddControl.uploadWhat+"Files"][index].cptn()),fileUploadService[$scope.ddControl.uploadWhat+"Files"][index].getQueued()?fileUploadService[$scope.ddControl.uploadWhat+"Files"][index].cancelUpload():fileUploadService[$scope.ddControl.uploadWhat+"Files"].splice($scope.previewStartAt+index,1),0===fileUploadService[$scope.ddControl.uploadWhat+"Files"].length?(RingLogger.information("All media files removed from status",RingLogger.tags.UPLOAD),$scope.resetUpload()):$scope.previewStartAt=$scope.previewStartAt>0?$scope.previewStartAt-1:$scope.previewStartAt}function loadPrevious(){$scope.previewStartAt=$scope.previewStartAt-3>0?$scope.previewStartAt-3:0,RingLogger.information("previewStart: "+$scope.previewStartAt,RingLogger.tags.UPLOAD)}function loadNext(){$scope.previewStartAt=$scope.previewStartAt+3<=fileUploadService[$scope.ddControl.uploadWhat+"Files"].length-4?$scope.previewStartAt+3:fileUploadService[$scope.ddControl.uploadWhat+"Files"].length-3,RingLogger.information("previewStart: "+$scope.previewStartAt,RingLogger.tags.UPLOAD)}function selectAlbum(actionObj){switch(actionObj.action){case"select":$scope.ddControl.selectedAlbum=actionObj.albumMap,fileUploadService.setUploadAlbum(actionObj.albumMap.getId()),RingLogger.information("Selected Album: "+$scope.ddControl.selectedAlbum.getName(),RingLogger.tags.UPLOAD),rgDropdownService.close(),$scope.$rgDigest();break;case"toggleCreate":$scope.ddControl.createAlbum=!$scope.ddControl.createAlbum,$scope.$rgDigest();break;case"create":if(0===$scope.ddControl.albumName.length)break;$scope.ddControl.createAlbum=!1,RingLogger.information("Create Album: "+$scope.ddControl.albumName,RingLogger.tags.UPLOAD),Media.createAlbum({albn:$scope.ddControl.albumName,mdaT:"audio"===$scope.ddControl.uploadWhat?AC.NEWS_FEED_MEDIA_TYPE_AUDIO:AC.NEWS_FEED_MEDIA_TYPE_VIDEO},!0).then(function(albumMap){$scope.ddControl.createAlbum=!1,$scope.ddControl.albumName="",$scope.selectedAlbum=albumMap.getName(),$scope.ddControl.selectedAlbum=albumMap,fileUploadService.setUploadAlbum(albumMap.getId()),rgDropdownService.close(),$scope.$rgDigest()})}}function disableUpload(uploadType){return $scope.uploadProgress?$scope.ddControl.uploadWhat!==uploadType:$scope.ddControl.uploadWhat!==uploadType&&getMedia().length>0}function uploadAudio(){fileUploadService.videoFiles=[],fileUploadService.imageFiles=[];var i,l,input=this;for(i=0;i<input.files.length;i++)totalFileSize+=input.files[i].size;if(input.files.length+fileUploadService.audioFiles.length>AC.AUDIO_UPLOAD_LIMIT)Ringalert.show("Maximum upload limit "+AC.AUDIO_UPLOAD_LIMIT,"warning");else if(totalFileSize>AC.MEDIA_UPLOAD_SIZE_LIMIT)for(Ringalert.show("Maximum allowed total upload files size 500MB!","warning"),i=0;i<input.files.length;i++)totalFileSize-=input.files[i].size;else{$scope.hasOwnProperty("rgUploadAction")&&$scope.rgUploadAction("audio"),0===fileUploadService.audioFiles.length&&($scope.ddControl.uploadWhat="audio",$scope.ddControl.selectedAlbum=null,fileUploadService.setUploadAlbum(-1));var startIndex=fileUploadService.audioFiles.length;for(i=0,l=input.files.length;l>i;i++)validateUpload("audio",input.files[i])?fileUploadService.queueFile("audio",input.files[i]):Ringalert.show("Invalid Audio File: "+input.files[i].name,"error");RingLogger.information("UPLOAD QUEUE",RingLogger.tags.UPLOAD),$rootScope.$broadcast(SystemEvents.FILE_UPLOAD.QUEUE_START),fileUploadService.uploadQueue("audio",startIndex)}input.value=null,$scope.$rgDigest()}function uploadVideo(){var i,l,input=this;for(i=0;i<input.files.length;i++)totalFileSize+=input.files[i].size;if(input.files.length+fileUploadService.videoFiles.length>AC.VIDEO_UPLOAD_LIMIT)Ringalert.show("Maximum upload limit "+AC.VIDEO_UPLOAD_LIMIT,"warning");else if(totalFileSize>AC.MEDIA_UPLOAD_SIZE_LIMIT)for(Ringalert.show("Maximum allowed total upload files size 500MB!","warning"),i=0;i<input.files.length;i++)totalFileSize-=input.files[i].size;else{0===fileUploadService.videoFiles.length&&($scope.ddControl.uploadWhat="video",$scope.ddControl.selectedAlbum=null,fileUploadService.setUploadAlbum(-1)),$scope.hasOwnProperty("rgUploadAction")&&$scope.rgUploadAction("video");var startIndex=fileUploadService.videoFiles.length;for(i=0,l=input.files.length;l>i;i++)validateUpload("video",input.files[i])?fileUploadService.queueFile("video",input.files[i]):Ringalert.show("Invalid Video File: "+input.files[i].name,"error");RingLogger.information("UPLOAD QUEUE",RingLogger.tags.UPLOAD),fileUploadService.uploadQueue("video",startIndex),$rootScope.$broadcast(SystemEvents.FILE_UPLOAD.QUEUE_START)}input.value=null,$scope.$rgDigest()}function uploadImage(){$scope.ddControl.uploadWhat="image";var input=this;switch($scope.rgUploadType){case"coverphoto":case"profilephoto":case"tagchatimage":case"chatimage":if(validateUpload("image",input.files[0])){var uploadFile=fileUploadService.queueFile($scope.rgUploadType,input.files[0]);$scope.hasOwnProperty("rgUploadAction")&&$scope.rgUploadAction()({action:$scope.rgUploadType,uploadFile:uploadFile})}else Ringalert.show("Invalid Image File: "+input.files[0].name,"error");input.value=null;break;case"status":if(input.files.length+fileUploadService.imageFiles.length>AC.IMAGE_UPLOAD_LIMIT){Ringalert.show("Maximum upload limit "+AC.IMAGE_UPLOAD_LIMIT,"warning");break}for(var startIndex=fileUploadService.imageFiles.length,i=0;i<input.files.length;i++)validateUpload("image",input.files[i])?fileUploadService.queueFile("image",input.files[i]):Ringalert.show("Invalid Image File: "+input.files[i].name,"error");RingLogger.information("UPLOAD QUEUE",RingLogger.tags.UPLOAD),$rootScope.$broadcast(SystemEvents.FILE_UPLOAD.QUEUE_START),fileUploadService.uploadQueue("image",startIndex),input.value=null}$scope.$rgDigest()}function validateUpload(fileType,inputFile){var regEx;switch(fileType){case"image":regEx=new RegExp("image/*");break;case"audio":regEx=new RegExp("audio/mp3*");break;case"video":regEx=new RegExp("video/mp4");break;case"default":RingLogger.warning("VALIDATE UPLOAD TYPE DID NOT MATCH",RingLogger.tags.UPLOAD)}return regEx.test(inputFile.type)}var AC=APP_CONSTANTS,totalFileSize=0;$scope.uploadProgress=fileUploadService.uploadProgress,$scope.previewStartAt=0,$scope.statusMediaCount=fileUploadService.statusMediaCount,$scope.tagList=fileUploadService.tagList,$scope.ddHtml="pages/dropdowns/album-dropdown.html",$scope.ddControl={Media:Media,uploadWhat:"image",createAlbum:!1,albumName:"",selectedAlbum:0},$scope.ddAction=selectAlbum,$scope.getMedia_=getMedia,$scope.removeMedia=removeMedia,$scope.loadPrevious=loadPrevious,$scope.loadNext=loadNext,$scope.disableUpload=disableUpload,$scope.uploadAudio=uploadAudio,$scope.uploadVideo=uploadVideo,$scope.uploadImage=uploadImage,$rootScope.$on(SystemEvents.FILE_UPLOAD.UPLOADS_POSTED,resetUpload),$scope.$on("$destroy",function(){var i,l;switch($scope.rgUploadType){case"coverphoto":fileUploadService.coverImageFile&&(fileUploadService.coverImageFile.cancelUpload(),fileUploadService.coverImageFiles=null);break;case"profilephoto":fileUploadService.profileImageFile&&(fileUploadService.profileImageFile.cancelUpload(),fileUploadService.profileImageFiles=null);break;case"tagchatimage":case"chatimage":fileUploadService.chatImageFiles[$scope.rgUploadBoxValue]&&(fileUploadService.chatImageFiles[$scope.rgUploadBoxValue].cancelUpload(),delete fileUploadService.chatImageFiles[$scope.rgUploadBoxValue]);break;case"status":if(fileUploadService.imageFiles.length>0){for(i=0,l=fileUploadService.imageFiles.length;l>i;i++)fileUploadService.imageFiles[i].cancelUpload();fileUploadService.imageFiles=[]}else if(fileUploadService.videoFiles.length>0){for(i=0,l=fileUploadService.videoFiles.length;l>i;i++)fileUploadService.videoFiles[i].cancelUpload();fileUploadService.videoFiles=[]}else if(fileUploadService.audioFiles.length>0){for(i=0,l=fileUploadService.audioFiles.length;l>i;i++)fileUploadService.audioFiles[i].cancelUpload();fileUploadService.audioFiles=[]}}})}UploadController.$inject=["Auth","$scope","mediaMetadata","imageQuality","APP_CONSTANTS","SystemEvents","Ringalert","$$q","$rootScope","rgDropdownService"];var linkFunc=function(scope,element,attr){function toggleTagVisibility(bool){tagDropdownElement.style.display=bool?"block":"none",bool||(fileUploadService.tagSuggestions=[])}function handleHashTag(event){var key=event.keyCode||event.which;!key||27!==key&&13!==key?tagInputElement.value.length>0?(clearTimeout(hashTagTimeout),hashTagTimeout=setTimeout(fetchTags,200)):0===tagInputElement.value.length&&(clearTimeout(hashTagTimeout),toggleTagVisibility(!1)):(event.preventDefault(),scope.addHashTag({sk:tagInputElement.value,ukey:0}),toggleTagVisibility(!1),scope.tagLoading=!1),scope.$rgDigest()}function fetchTags(){scope.tagLoading=!0,Media.fetchHashtagSuggestion(tagInputElement.value).then(function(json){scope.tagLoading&&(clearTimeout(hashTagTimeout),scope.tagLoading=!1,RingLogger.information("HASH TAG SUGGESTION"),RingLogger.print(json,RingLogger.tags.UPLOAD),json.sucs===!0?(toggleTagVisibility(!0),scope.tagSuggestions=json.sgstn):toggleTagVisibility(!1),scope.$rgDigest())}),scope.$rgDigest()}var tagDropdownElement,hashTagTimeout,tagInputElement,imgPreviewElem,inputVideo,inputAudio,uploadType=attr.rgUploadType,template="",inputFile="",imgPreviewTmpl='<div class="to-add" ng-show="ddControl.uploadWhat !== \'image\' && statusMediaCount(ddControl.uploadWhat) > 0" ><span rg-dropdown dd-html="ddHtml" dd-control="ddControl" dd-action="ddAction"><a data-tooltip-post="Add to Album"><label class="icon-play-list"></label></a></span></div><div class="media-tag"><div ng-show="tagList.length" ><ul class="tag-fnd-lst"><li ng-repeat="tag in tagList" ><span class="tag-title" ng-bind="tag.sk" ></span>&nbsp;<span class="icon-close f-11" rg-click="removeTag($event, $index)"></span></li></ul></div></div><textarea id="add-hashtag" ng-model="tagName" ng-show="ddControl.uploadWhat !== \'image\' && statusMediaCount(ddControl.uploadWhat) > 0" type="text"  class="media-tags"  placeholder="Add Hashtag" ></textarea><div id="hashtag-dropdown" class="m-s-height tag-dd active" style="display:none;"><div class="loader-s" ng-show="tagLoading"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div><div class="ringscroll" style="position:relative;width:auto;overflow:hidden;height:100%;"><ul class="m-s-result" rg-scrollbar="true" style="overflow: hidden;"><li ng-repeat="tag in tagSuggestions track by tag.ukey"  class="ng-scope m-t-icon" rg-click="addHashTag({sk: tag.sk, ukey: tag.ukey})"><a href="javascript:void(0)" title="{{tag.sk}}" ng-bind="tag.sk" > abc</a></li></ul></div></div><div class="status-photo-view" style="border-bottom:1px solid #ebebeb;margin:0;padding:0;margin-bottom:10px;" id="img-height" ng-show="statusMediaCount(ddControl.uploadWhat) > 0"><div id="sts-img-preview" style="text-align:center;" class="scroll"><div ng-show="previewStartAt+3 < statusMediaCount(ddControl.uploadWhat)" class="np-box icon-right-arrow"  style="right:0;margin-top:60px;" rg-click="loadNext()"></div><div ng-show="previewStartAt > 0" class="np-box icon-left-arrow" style="left:0;margin-top:60px;"  rg-click="loadPrevious()"></div><div style="margin-top:3px;" class="status-photo-view-thumb" ng-repeat="image in getMedia()"><div ng-show="image.getProgress() !== 100" class="progress-bar-placement" style="position:absolute;width:100%;text-align:center;"><div class="percent">{{image.getProgress()}}%</div><div class="progress-bar"><div class="uploaded" ng-style="{\'width\': image.getProgress()+ \'%\'}"></div></div></div><div  id="singleImage{{$index}}"  style="position:absolute;width:100%;text-align:center;"><input class="add-title" ng-model="image.cptn" ng-model-options="{ getterSetter: true }" type="text" name="" placeholder="Add Photo Title" ng-show="!image.progressVisible" /><div class="photo-view" style="background-image: url({{image.getPreview()}}); background-position:50% 50%; background-size:100% 100%; background-repeat:no-repeat; cursor: pointer;"><div class="status-photo-view-thumb-hover"><span id="closebtn0" class="close" style="display: block;" rg-click="removeMedia($index)" inc="0"><div class="icon-close up-p"></div></span></div></div></div></div></div>';switch(uploadType){case"coverphoto":case"profilephoto":template='<input  id="'+uploadType+'" type="file" name="'+uploadType+'"  accept="image/*" >',element.append($compile(template)(scope));break;case"tagchatimage":case"chatimage":template='<label  class="icon-camera ico-sty ng-binding ng-scope"><input  id="'+uploadType+'" type="file" style="display:none;" accept="image/*" ></label>',element.append($compile(template)(scope));break;case"audio":template='<a data-tooltip-post="Add Audios" href="javascript:void(0)"><label  class="audio-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a>',element.append($compile(template)(scope));break;case"video":template='<a data-tooltip-post="Add Videos" href="javascript:void(0)"><label  class="video-ico ng-binding ng-scope" ng-show="rgUploadEnabled"><input ng-disabled="uploadProgress" id="video" type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a>',element.append($compile(template)(scope));break;case"status":template='<div ng-show="rgUploadEnabled" class="post-b-ico m-l-10"><a data-tooltip-post="Add Photos"  href="javascript:void(0)" class="p-ab"><label  class="camera-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'image\')" id="'+uploadType+'" type="file" style="display:none;" multiple="multiple" accept="image/*"></label></a></div><div ng-show="rgUploadEnabled "class="post-b-ico m-l-10"><a data-tooltip-post="Add Videos" href="javascript:void(0)" class="p-ab"><label  class="video-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'video\')" id="video"type="file" style="display:none;" multiple="multiple" accept="video/mp4"></label></a></div><div ng-show="rgUploadEnabled" class="post-b-ico m-l-10"><a data-tooltip-post="Add Audios" href="javascript:void(0)" class="p-ab"><label  class="audio-ico ng-binding ng-scope" ><input ng-disabled="disableUpload(\'audio\')" id="audio" type="file" style="display:none;" multiple="multiple" accept="audio/mp3"></label></a></div>',element.append($compile(template)(scope)),imgPreviewElem=element.parent().prepend($compile(imgPreviewTmpl)(scope))}scope.removeTag=function(event,index){event.preventDefault(),RingLogger.information("remove tag index: "+index,RingLogger.tags.UPLOAD),fileUploadService.tagList.splice(index,1),scope.$rgDigest()},scope.addHashTag=function(tag){scope.tagList.push(tag),tagDropdownElement.style.display="none",scope.tagSuggestions=[],tagInputElement.value="",scope.$rgDigest()},inputFile=element[0].querySelector("input#"+uploadType),"status"===uploadType?(inputFile.addEventListener("change",scope.uploadImage),inputVideo=element[0].querySelector("input#video"),inputVideo.addEventListener("change",scope.uploadVideo),inputAudio=element[0].querySelector("input#audio"),inputAudio.addEventListener("change",scope.uploadAudio),scope.tagSuggestions=[],scope.tagLoading=!1,tagInputElement=element[0].parentNode.querySelector("textarea#add-hashtag"),tagDropdownElement=element[0].parentNode.querySelector("div#hashtag-dropdown"),tagInputElement.addEventListener("keyup",handleHashTag)):"audio"===uploadType?inputFile.addEventListener("change",scope.uploadAudio):"video"===uploadType?inputFile.addEventListener("change",scope.uploadVideo):inputFile.addEventListener("change",scope.uploadImage),scope.$rgDigest(),scope.$on("$destroy",function(){switch(uploadType){case"status":inputFile.removeEventListener("change",scope.uploadImage),inputAudio.removeEventListener("change",scope.uploadAudio),inputVideo.removeEventListener("change",scope.uploadVideo),tagInputElement.removeEventListener("keyup",handleHashTag);break;case"image":inputFile.removeEventListener("change",scope.uploadImage);break;case"audio":inputFile.removeEventListener("change",scope.uploadAudio);break;case"video":inputFile.removeEventListener("change",scope.uploadVideo)}fileUploadService.removeScope(scope)}),fileUploadService.setScopeForDigest(scope),RingLogger.tags.DIGEST&&scope.$watch(function(){RingLogger.info("from rgUpload Directive",RingLogger.tags.DIGEST)})};return{restrict:"AE",scope:{rgUploadEnabled:"=",rgUploadType:"@",rgUploadAction:"&",rgUploadBoxValue:"="},link:linkFunc,controller:UploadController}}angular.module("ringid.common.rgupload_directive",["ringid.common.services","ringid.common.factories"]).directive("rgUpload",rgUpload),rgUpload.$inject=["$compile","fileUploadService","Media"]}(),function(){"use strict";function rgDropdownService(GlobalEvents){var self=this,_scope=!1,_detachTemplate=!1,closeDropdown=function(){_scope&&angular.isFunction(_scope.ddBeforeClose)&&_scope.ddBeforeClose(),_detachTemplate(),GlobalEvents.unbindHandler("document","click",self.close)},openDropdown=function(){_scope.ddOpened(),GlobalEvents.bindHandler("document","click",self.close)};self.open=function(detachTemplate,scope){_detachTemplate&&closeDropdown(),_detachTemplate=detachTemplate,_scope=scope,openDropdown()},self.close=function(){_detachTemplate&&closeDropdown(),_detachTemplate=!1,_scope=!1}}function rgDropdown($ringhttp,settings,$compile,rgDropdownService,languageConstant){function linkFunc(scope,element){function attachTemplate(){RingLogger.information("DROPDOWN OPEN",RingLogger.tags.DROPDOWN),dropdownOpen=!0,template=$compile(templateHtml)(scope),scope.ddControl&&scope.ddControl.hasOwnProperty("append")&&!scope.ddControl.append?element.after(template):element.append(template);for(var i=0;i<template.length;i++)template[i].addEventListener("click",stopPropagation);scope.ddControl&&scope.ddControl.showOnHover&&(element[0].addEventListener("mouseleave",handleHover),template[template.length-1].addEventListener("mouseenter",handleMouseEnter),template[template.length-1].addEventListener("mouseleave",handleMouseLeave)),scope.$rgDigest()}function detachTemplate(){setTimeout(function(){RingLogger.information("DROPDOWN CLOSE",RingLogger.tags.DROPDOWN),dropdownOpen=!1;for(var i=0;i<template.length;i++)template[i].removeEventListener("click",stopPropagation);scope.ddControl&&scope.ddControl.showOnHover&&(element[0].removeEventListener("mouseleave",handleHover),template[template.length-1].removeEventListener("mouseenter",handleMouseEnter),template[template.length-1].removeEventListener("mouseleave",handleMouseLeave));for(var i=0;i<template.length;i++)template[i].parentNode.removeChild(template[i]);scope.$parent.$rgDigest()})}var template,templateHtml,dropdownOpen=!1,onDropdown=!1;scope.consType=languageConstant.get();var stopPropagation=function(event){event.stopPropagation()},handleDropdown=function(event){dropdownOpen?rgDropdownService.close():(attachTemplate(),rgDropdownService.open(detachTemplate,scope)),stopPropagation(event)},handleHover=function(event){setTimeout(function(){onDropdown?RingLogger.information("IS ON DROPDOWN",RingLogger.tags.DROPDOWN):(RingLogger.information("NOT ON DROPDOWN",RingLogger.tags.DROPDOWN),handleDropdown(event))},500)};element.on("click",handleDropdown),scope.ddHtml||scope.ddTemplate?scope.ddTemplate?templateHtml=scope.ddTemplate:$ringhttp.get(settings.baseUrl+scope.ddHtml).success(function(response){templateHtml=response}).error(function(){RingLogger.warning("DROPDOWN TEMPLATE missing: "+scope.ddHtml,RingLogger.tags.DROPDOWN),scope.$rgDigest()}):RingLogger.error("Please set ddHtml for rg-dropdown.",RingLogger.tags.DROPDOWN);var handleMouseEnter=function(event){RingLogger.information("Mouse Enter",RingLogger.tags.DROPDOWN),onDropdown=!0,element.off("mouseleave",handleHover)},handleMouseLeave=function(event){RingLogger.information("Mouse Leave",RingLogger.tags.DROPDOWN),onDropdown=!1,handleHover(event),element.on("mouseleave",handleHover)};scope.$on("$destory",function(){element[0].removeEventListener("click",handleDropdown),detachTemplate()})}return{restrict:"AE",
link:linkFunc,scope:{ddHtml:"=",ddControl:"=",ddTemplate:"=",ddAction:"&",ddOpened:"&",ddBeforeClose:"&"}}}angular.module("ringid.common.rgdropdown_directive",["ringid.config","ringid.language","ringid.common.rgscrollbar_directive"]).service("rgDropdownService",rgDropdownService).directive("rgDropdown",rgDropdown),rgDropdownService.$inject=["GlobalEvents"],rgDropdown.$inject=["$ringhttp","settings","$compile","rgDropdownService","languageConstant"]}(),function(){"use strict";function rgSearchService(GlobalEvents){var self=this,_scope=!1,_template=!1;self.close=function(){RingLogger.information("CLOSE SEARCH DROPDOWN",RingLogger.tags.SEARCH),_template&&(_scope.searchText="",_template.style.display="none",_scope.$rgDigest(),_template=!1,_scope=!1,GlobalEvents.unbindHandler("document","click",self.close))},self.open=function(template,scope){_template=template,_scope=scope,_template.style.display="block",GlobalEvents.bindHandler("document","click",self.close)}}function rgSearch(rgSearchService){function SearchController($scope,$$stackedMap,userFactory,friendsFactory,InviteFactory,friendsHttpService,$timeout,rgScrollbarService){function checkIfNewSearch(){schPm!==$scope.searchText&&($scope.resetSearch(),searchFailCount=0)}function searchFail(){RingLogger.warning("inside TIMEOUT: ",RingLogger.tags.SEARCH),$scope.noResult=0===$scope.listData.length(),$scope.gotAllResult=$scope.listData.length()>0,$scope.showLoadbar=!1,$scope.$rgDigest()}function doSearch(force){checkIfNewSearch(),(force||!$scope.showLoadbar&&!$scope.gotAllResult)&&(RingLogger.warning("clear TIMEOUT: "+timeOut,RingLogger.tags.SEARCH),clearTimeout(timeOut),$scope.showLoadbar=!0,$scope.showDropdown||rgSearchService.open($scope.template,$scope),schPm=$scope.searchText,RingLogger.information("start search: "+schPm,RingLogger.tags.SEARCH),friendsHttpService.searchContact({schPm:$scope.searchText,st:$scope.listData.length()}).then(getSearchResult,getSearchResult),RingLogger.warning("set TIMEOUT: "+timeOut,RingLogger.tags.SEARCH),timeOut=setTimeout(searchFail,8e3),$scope.$rgDigest())}function getSearchResult(json){if(RingLogger.warning("clear TIMEOUT: "+timeOut,RingLogger.tags.SEARCH),clearTimeout(timeOut),json.sucs===!0){RingLogger.information("total search result: "+json.searchedcontaclist.length,RingLogger.tags.SEARCH);for(var i=0,l=json.searchedcontaclist.length;l>i;i++)user=userFactory.create(json.searchedcontaclist[i]),user&&$scope.listData.save(user.getKey(),user);json.searchedcontaclist.length>0&&rgScrollbarService.recalculate($scope),$scope.showLoadbar=!1,$scope.noResult=0===$scope.listData.length(),$scope.$rgDigest()}else RingLogger.information("SEARCH FAILED: "+json.mg,RingLogger.tags.SEARCH),searchFailCount++,3>searchFailCount?(RingLogger.warning("RETRY SEARCH",RingLogger.tags.SEARCH),doSearch(!0)):(RingLogger.warning("SEARCH FAILED RETRY END",RingLogger.tags.SEARCH),RingLogger.warning("clear TIMEOUT: "+timeOut,RingLogger.tags.SEARCH),clearTimeout(timeOut),searchFail())}var user,timeOut,searchFailCount=0,schPm="";$scope.searchText="",$scope.gotAllResult=!1,$scope.showLoadbar=!1,$scope.noResult=!0,$scope.listData=$$stackedMap.createNew(),$scope.resetSearch=function(){searchFailCount=0,$scope.noResult=!1,$scope.gotAllResult=!1,$scope.listData.reset(),$scope.$rgDigest()},$scope.contactListAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())},$scope.doSearch=doSearch,$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}}}var linkFunc=function(scope,element){function stopPropagate(event){"a"!==event.target.tagName.toLowerCase()&&event.preventDefault(),event.stopPropagation()}var input=element.find("input");scope.template=element[0].querySelector("#search-dropdown"),scope.template.style.display="none",input.on("keypress",function(event){13===event.keyCode&&event.preventDefault()}),scope.doTheSearch=function(){scope.searchText.length>0?(RingLogger.information("NEW SEARCH STRING",RingLogger.tags.SEARCH),scope.doSearch()):rgSearchService.close()},element.on("click",stopPropagate),scope.$on("$destroy",function(){element.off("click",stopPropagate)})};return SearchController.$inject=["$scope","$$stackedMap","userFactory","friendsFactory","InviteFactory","friendsHttpService","$timeout","rgScrollbarService"],{restrict:"E",scope:{placeholder:"@"},templateUrl:"pages/dropdowns/search-dropdown.html",link:linkFunc,controller:SearchController}}angular.module("ringid.common.rgsearch_directive",["ringid.config","ringid.common.user_factory","ringid.friend.friends_factory"]).service("rgSearchService",rgSearchService).directive("rgSearch",rgSearch),rgSearchService.$inject=["GlobalEvents"],rgSearch.$inject=["rgSearchService"]}(),function(){"use strict";function rgScrollbar(){function linkFunc(scope,element,attr){function scroll(pos){var ratio;fastdom.read(function(){scrollbar&&(hiddenHeight=element[0].scrollHeight-element[0].offsetHeight,visibleHeight=element[0].offsetHeight-thumbHeight,ratio=pos/visibleHeight,pos=Math.min(Math.max(pos,0),visibleHeight),fastdom.write(function(){element[0].scrollTop=hiddenHeight*ratio,scrollbarThumb[0].style.top=pos+"px"}),pos==visibleHeight&&angular.isFunction(scope.bottomReached)&&scope.bottomReached())})}function reCalculate(){var ratio,pos,newScrollHeight;fastdom.read(function(){element&&(newScrollHeight=element[0].scrollHeight,offsetHeight=element[0].offsetHeight,scrollHeight=newScrollHeight,hiddenHeight=scrollHeight-offsetHeight,visibleHeight=offsetHeight-thumbHeight,thumbHeight=Math.max(offsetHeight/scrollHeight*offsetHeight,config.minThumbHeight),ratio=visibleHeight/hiddenHeight,pos=element[0].scrollTop*ratio,(isNaN(thumbHeight)||"Infinity"==thumbHeight)&&(thumbHeight=0),display=thumbHeight>=offsetHeight?"none":"block",fastdom.write(function(){scrollbar[0]&&(scrollbar[0].style.display=display,scrollbarThumb[0].style.height=thumbHeight+"px",scrollbarThumb[0].style.display=display,scrollbarThumb[0].style.top=pos+"px")}))})}function hideScrollbar(){config.scrollbarAlways||scrollbarMousedown||(scrollbar.css("opacity",0),scrollbarThumb.css("opacity",0),scrollbarVisible=!1)}function showScrollbar(){reCalculate(),scrollbarVisible=!0,scrollbar.css("opacity",1),scrollbarThumb.css("opacity",1)}var config={scrollbarWidth:6,scrollbarAlways:!1,dragSpeedModifier:5,minThumbHeight:10};if("true"!=attr.disabled&&1!=attr.disabled){var scrollbarContainer=null,scrollbarMousedown=!1,scrollbarVisible=!1,display="none",scrollHeight=0,offsetHeight=0,hiddenHeight=0,visibleHeight=0,thumbHeight=0,scrollbar=angular.element(document.createElement("div")),scrollbarThumb=angular.element(document.createElement("div")),doc=angular.element(document);element.wrap('<div class="ringscroll" style="position:relative;width:auto;overflow:hidden;height:100%;"></div>'),element.css({overflow:"hidden"}),scrollbarContainer=element.parent(),scrollbarContainer.append(scrollbar[0]),scrollbarContainer.append(scrollbarThumb[0]),scrollbar.addClass("scrollbar"),scrollbarThumb.addClass("thumb"),fastdom.write(function(){scrollbar&&(scrollbar[0].style.width=config.scrollbarWidth+"px",scrollbar[0].style.height="100%",scrollbar[0].style.right="1px",scrollbar[0].style.top="px",scrollbar[0].style.position="absolute",scrollbar[0].style.zIndex=1,scrollbarThumb[0].style.width=config.scrollbarWidth+"px",scrollbarThumb[0].style.right="1px",scrollbarThumb[0].style.top="px",scrollbarThumb[0].style.position="absolute",scrollbarThumb[0].style.zIndex=1)});var mousewheel="undefined"!=typeof InstallTrigger?"DOMMouseScroll":"mousewheel";element.on(mousewheel,function(event){if("none"!=display){event.preventDefault(),scrollbarVisible||showScrollbar();var barTop=parseFloat(scrollbarThumb.css("top")),delta=event.wheelDelta?-1/40*event.wheelDelta:3*event.detail,modifier=Math.max(parseInt(2*offsetHeight/scrollHeight*config.dragSpeedModifier),1),newPos=barTop+delta*modifier;scroll(newPos)}}),scrollbarThumb.on("mousedown",function(event){event.preventDefault(),event.stopPropagation(),scrollbarVisible||showScrollbar(),scrollbarMousedown=!0;var mouseY=event.pageY,barTop=parseFloat(scrollbarThumb.css("top"));doc.on("mousemove",function(event){var newPos=barTop+event.pageY-mouseY;scroll(newPos)}),doc.on("mouseup",function(event){event.stopPropagation(),scrollbarMousedown=!1,doc.off("mousemove"),doc.off("mouseup")})}),scrollbarContainer.on("mouseenter",showScrollbar),scrollbarContainer.on("mouseleave",hideScrollbar),scope.$on("scrollTop",function(event){event.stopPropagation&&event.stopPropagation(),setTimeout(function(){scroll(0)},100)}),scope.$on("scrollTo",function(event,percent,dir){switch(event.stopPropagation&&event.stopPropagation(),typeof percent){case"string":var elm=element[0].querySelector(percent);if(percent=0,elm){var elemHeight=dir&&"bottom"==dir?elm.offsetHeight:0;percent=parseInt(100*(elm.offsetTop+elemHeight)/scrollHeight)}break;case"number":percent=parseInt(percent);break;default:percent=parseInt(percent)}var pos=percent*visibleHeight/100;setTimeout(function(){scroll(pos)},10)}),scope.$on("recalculate",function(event){event.stopPropagation&&event.stopPropagation(),reCalculate()}),scope.$on("hasScroll",function(event,$scope){event.stopPropagation&&event.stopPropagation(),$scope.scroll="none"!=display}),scope.$on("$destroy",function(){scrollbarContainer=null,scrollbar=null,scrollbarThumb=null})}}return{restrict:"A",scope:{bottomReached:"&"},link:linkFunc}}function rgScrollbarService(){return{scrollTop:function(scope){scope.$broadcast("scrollTop")},scrollTo:function(scope,percent,dir){scope.$broadcast("scrollTo",percent,dir)},recalculate:function(scope){scope.$broadcast("recalculate")},hasScroll:function(scope){scope.$broadcast("hasScroll",scope)}}}angular.module("ringid.common.rgscrollbar_directive",[]).directive("rgScrollbar",rgScrollbar).factory("rgScrollbarService",rgScrollbarService)}(),function(){"use strict";function rgInvite(){function InviteController($scope,InviteFactory,friendsFactory,$$connector,OPERATION_TYPES){function startChangePeopleInterval(){changePeopleInterval=setInterval(changePeople,5e3)}function stopChangePeopleInterval(){clearInterval(changePeopleInterval)}function changePeople(){if(!$scope.stopChanging||deleteFromSuggList){if($scope.people){var userToRemove=$scope.people.getUtId();$scope.people=InviteFactory.suggestionFriends.next($scope.people.getUtId()),deleteFromSuggList&&(InviteFactory.suggestionFriends.remove(userToRemove),deleteFromSuggList=!1),$scope.people||($scope.people=InviteFactory.suggestionFriends.bottom())}else $scope.people=InviteFactory.suggestionFriends.bottom();$scope.$rgDigest()}}function youMayKnowContacts(response){response.sucs===!0&&response.actn===OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS&&($scope.contactLength=InviteFactory.noOfSuggestions,changePeople())}var changePeopleInterval,OTYPES=OPERATION_TYPES.SYSTEM.FRIENDS,deleteFromSuggList=!1;$scope.people=null,$scope.friendRequestAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){InviteFactory.removeSuggestion(actionObj.friend.getUtId()).then(function(json){json.sucs===!0&&(deleteFromSuggList=!0,$scope.stopChanging=!1),$scope.$rgDigest()}),$scope.$rgDigest()},function(){$scope.stopChanging=!1,$scope.$rgDigest()}),$scope.$rgDigest())},$scope.changePeople=changePeople,$scope.contactLength=InviteFactory.noOfSuggestions,$scope.stopChanging=!1,$scope.removeOutGoingFriends=function(){for(var outGoingUtid=[],findOutGoing=InviteFactory.suggestionFriends.all(),loopLength=InviteFactory.suggestionFriends.length(),i=0;loopLength>i;i++)0!==findOutGoing[i].value.friendshipStatus()&&outGoingUtid.push(findOutGoing[i].value.getUtId());for(var j=0;j<outGoingUtid.length;j++)InviteFactory.suggestionFriends.remove(outGoingUtid[j])},$scope.getSuggestions=function(){return $scope.users=InviteFactory.suggestionFriends,{data:function(){return{target:$scope.users}}}},$scope.removeSugg=function(obj,action){InviteFactory.removeSuggestion(obj.getUtId(),action).then(function(data){data.sucs===!0&&(deleteFromSuggList=!0,changePeople())})},$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}},startChangePeopleInterval(),RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from rgInvite",RingLogger.tags.DIGEST)}),$$connector.subscribe(youMayKnowContacts,{action:[OTYPES.TYPE_PEOPLE_YOU_MAY_KNOW_DETAILS]}),$scope.$on("$destroy",function(){stopChangePeopleInterval()})}return InviteController.$inject=["$scope","InviteFactory","friendsFactory","$$connector","OPERATION_TYPES"],{restrict:"A",controller:InviteController,templateUrl:"pages/partials/friend-invite.html",link:function(scope,element){function stopChange(){scope.stopChanging=!0}function startChange(){scope.stopChanging=!1}element.on("mouseenter",stopChange),element.on("mouseleave",startChange),scope.$on("$destroy",function(){element.off("mouseenter",stopChange),element.off("mouseleave",startChange)})}}}angular.module("ringid.common.rginvite_directive",["ringid.common.invite_factory","ringid.friend.friends_factory"]).directive("rgInvite",rgInvite)}(),function(){"use strict";function rgEmoticon($compile,$timeout,$document,utilsFactory,StickerFactory,rgScrollbarService,$templateCache,$ringhttp){function EmoticonController($scope){function safeDigest(){$scope.$parent&&1!==$scope.$parent.$id?$scope.$parent.$rgDigest():$scope.$rgDigest()}$scope.startAt=0,$scope.getMyStickers=function(){return $scope.myStickerCatIds().slice($scope.startAt,$scope.startAt+4)},$scope.getTopStickers=function(){return RingLogger.information(StickerFactory.getStickerCategories("top"),RingLogger.tags.STICKER),StickerFactory.getStickerCategories("top").slice(0,4)},$scope.loadPrevious=function($event){$scope.startAt=$scope.startAt>0?$scope.startAt-1:0,$event.stopPropagation(),safeDigest()},$scope.loadNext=function($event){$scope.startAt=$scope.startAt+3<$scope.myStickerCatIds().length-1?$scope.startAt+1:$scope.startAt,$event.stopPropagation(),safeDigest()},$scope.myStickerCatIds=StickerFactory.getMyStickerCatIds,$scope.getSticker=StickerFactory.getStickerCategoryObject,$scope.emoticonMap=StickerFactory.getEmoticonMap(),RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from rgEmoticon",RingLogger.tags.DIGEST)})}var linkFunc=function(scope,element,attrs){function safeDigest(){scope.$parent&&1!==scope.$parent.$id?scope.$parent.$rgDigest():scope.$rgDigest()}function handleClick(event){event.preventDefault(),showEmoticon=!showEmoticon,showEmoticon?openEmoticonPopUp(event):closeEmoticonPopup()}function closeEmoticonPopup(e){(!e||"click"!==e.type||e.target!==element[0]&&e.target.parentNode&&e.target.parentNode!==element[0]&&e.target.parentNode.parentNode!==element[0]&&"pt-top"!==e.target.className)&&(showEmoticon=!1,document.removeEventListener("click",closeEmoticonPopup),document.removeEventListener("scroll",closeEmoticonPopup),element[0].removeEventListener("resize",calculatePosition),compiledDom[0].parentNode.removeChild(compiledDom[0]))}function attachTemplate(templateHtml){compiledDom=$compile(templateHtml)(scope),element.append(compiledDom),calculatePosition(),document.addEventListener("click",closeEmoticonPopup),document.addEventListener("scroll",closeEmoticonPopup),window.addEventListener("resize",calculatePosition)}function openEmoticonPopUp(event){openEmoticonEvent=event,$templateCache.get(emoticonListTemplate)?attachTemplate($templateCache.get(emoticonListTemplate)):$ringhttp.get(emoticonListTemplate).then(function(templateHtml){attachTemplate(templateHtml)})}function calculatePosition(){var elemD=0,elemRect=element[0].getBoundingClientRect(),availWidth=utilsFactory.viewport.x-elemRect.width,availHeight=utilsFactory.viewport.y;elemD=Math.floor(elemRect.width/2),openEmoticonEvent.clientX+emoBoxLimit<availWidth&&openEmoticonEvent.clientY+emoBoxLimit<availHeight?(scope.emoWindowStyle.top=elemRect.top+(elemD+15)+"px",scope.emoWindowStyle.left=elemRect.left+(elemD+5)+"px"):openEmoticonEvent.clientX+emoBoxLimit>availWidth&&openEmoticonEvent.clientY+emoBoxLimit>availHeight?(scope.emoWindowStyle.top=elemRect.top-emoBoxHeight+(elemD-5)+"px",scope.emoWindowStyle.left=elemRect.left-emoBoxWidth+(elemD-5)+"px"):openEmoticonEvent.clientX+emoBoxLimit>availWidth?(scope.emoWindowStyle.top=elemRect.top+(elemD+5)+"px",scope.emoWindowStyle.left=elemRect.left-emoBoxWidth+(elemD-5)+"px"):openEmoticonEvent.clientY+emoBoxLimit>availHeight&&(scope.emoWindowStyle.top=elemRect.top-emoBoxHeight+(elemD-5)+"px",scope.emoWindowStyle.left=elemRect.left+(elemD+5)+"px"),safeDigest()}function selectEmoOrSticker(emo,$event){$event.stopPropagation(),attrs.clicked&&scope.$eval(attrs.clicked)(emo,$event),closeEmoticonPopup(),safeDigest()}var compiledDom,openEmoticonEvent,emoticonListTemplate="pages/partials/emoticon-window.html",showEmoticon=!1,emoBoxLimit=400,emoBoxWidth=300,emoBoxHeight="true"==attrs.showSticker?300:260;scope.emoWindowStyle={height:emoBoxHeight+"px",width:emoBoxWidth+"px"},scope.showsticker="true"==attrs.showSticker,scope.selectedStickerCatId=0,element[0].addEventListener("click",handleClick),scope.selectEmoOrSticker=selectEmoOrSticker,scope.selectStickerCatId=function(e,stickerKey){e.stopPropagation(),scope.selectedStickerCatId=stickerKey,StickerFactory.getStickerMapByCatId(stickerKey).then(function(data){scope.emoticonMap=data,safeDigest()}),rgScrollbarService.scrollTop(scope),safeDigest()},scope.showEmoticons=function(e){e.stopPropagation(),scope.emoticonMap=StickerFactory.getEmoticonMap(),safeDigest()},scope.$on("$destroy",function(){document.removeEventListener("click",closeEmoticonPopup),document.removeEventListener("scroll",closeEmoticonPopup),element[0].removeEventListener("resize",calculatePosition)})};return EmoticonController.$inject=["$scope"],{restrict:"A",link:linkFunc,controller:EmoticonController}}angular.module("ringid.common.rgemoticon_directive",[]).directive("rgEmoticon",rgEmoticon),rgEmoticon.$inject=["$compile","$timeout","$document","utilsFactory","StickerFactory","rgScrollbarService","$templateCache","$ringhttp"]}(),function(){"use strict";function rgConditionalClick(){return function(scope,elem,attrs){angular.isFunction(attrs.rgConditionalClick)&&(elem.bind("click",function(e){attrs.rgConditionalClick()}),scope.$on("$destroy",function(){elem.unbind("click")}))}}function rgClick($parse){return{restrict:"A",link:function(scope,element,attrs){function clickfn(event){event.preventDefault(),fn(scope,{$event:event}),scope.$rgDigest()}var fn=$parse(attrs.rgClick);attrs.rgClickNoapply;element.bind("click",clickfn),scope.$on("$destroy",function(){element.unbind("click",clickfn)})}}}function rgImgLoad(){return{restrict:"A",transclude:!0,link:function(scope,element,attrs){element.on("load",function(){})}}}angular.module("ringid.common.rgclick_directive",[]).directive("rgImgLoad",rgImgLoad).directive("rgClick",rgClick).directive("rgConditionalClick",rgConditionalClick),rgConditionalClick.$inject=[],rgClick.$inject=["$parse"]}(),function(){"use strict";function rgImgChange(){return{restrict:"A",controller:["$scope","$element",function($scope,$element){this.setPopupStyle=function(height,width){$element[0].style.height=height+"px",$element[0].style.width=width+"px"}}]}}function rgImg($compile,utilsFactory){return{restrict:"A",require:"^rgImgChange",scope:{rgImgObj:"="},link:function(scope,element,attr,rgImgChangeCntrl){function calculateImgSize(imgH,imgW){imgH>maxH||imgW>maxW?imgW/maxW>=imgH/maxH?(resizedW=maxW,resizedH=Math.floor(maxW/imgW*imgH)):(resizedH=maxH,resizedW=Math.floor(maxH/imgH*imgW)):(resizedH=imgH,resizedW=imgW),image[0].style.width=resizedW+"px",image[0].style.height=resizedH+"px",RingLogger.information("imgW: "+imgW+" resizedW: "+resizedW+" maxW: "+maxW,RingLogger.tags.IMAGE),RingLogger.information("imgH: "+imgH+"resizedH: "+resizedH+" maxH: "+maxH,RingLogger.tags.IMAGE),minW>resizedW&&(resizedW=minW),minH>resizedH&&(resizedH=minH),resizedW=resizedW+leftbarW+imgPadding,resizedH+=imgPadding,rgImgChangeCntrl.setPopupStyle(resizedH,resizedW)}var dH=500,dW=500,minW=0,minH=0,leftbarW=300,imgPadding=60,maxW=0,maxH=0,resizedW=0,resizedH=0,image=$compile('<img src="'+scope.rgImgObj.src()+'" />')(scope);maxW=utilsFactory.viewport.x-40-leftbarW-imgPadding,maxH=utilsFactory.viewport.y-40-imgPadding,minW=maxW-dW>dW?maxW-dW:dW,minH=maxH-dH>dH?maxH-dH:dH,element.append(image),attr.$observe("rgImg",function(newVal){image[0].setAttribute("src",""),image[0].setAttribute("src",newVal),calculateImgSize(scope.rgImgObj.getIh(),scope.rgImgObj.getIw())})}}}angular.module("ringid.common.rgimg_directive",[]).directive("rgImg",rgImg).directive("rgImgChange",rgImgChange),rgImg.$inject=["$compile","utilsFactory"]}(),function(){"use strict";function rgPhotos($window,$document,utilsFactory){function PhotosController(rgScrollbarService,$timeout,$scope,$rootScope,AlbumFactory,$routeParams,profileFactory,fileUploadService,SystemEvents,Auth){function toggleLoading(bool,type){"album"===type?$scope.state.albumsLoading=bool:($scope.state.imagesLoading=bool,rgScrollbarService.recalculate($scope)),$scope.$digest()}$scope.showAlbumPreview=!0,$scope.activeAlbum=null;var profileObj=profileFactory.getProfile($routeParams.uId);$scope.state={imagesLoading:!0,albumsLoading:!0},$scope.albums=AlbumFactory.albums($routeParams.uId),toggleLoading(!0,"album"),AlbumFactory.getAllAlbums($routeParams.uId,$scope).then(function(){$scope.albums=AlbumFactory.albums($routeParams.uId),toggleLoading(!1,"album")}),$scope.loadMoreImage=function(){!AlbumFactory.imagesLoading()&&$scope.activeAlbum.getImages().length()<$scope.activeAlbum.getTotalImageCount()&&(toggleLoading(!0,"image"),AlbumFactory.loadMoreImage($scope.activeAlbum.getKey(),$routeParams.uId).then(function(){toggleLoading(!1,"image")},function(){toggleLoading(!1,"image")}))},$scope.getImageData=function(imageMap){return function(){return{image:imageMap,popupFrom:"profile"}}},$scope.deleteImage=function(imageMap){AlbumFactory.deleteImage(imageMap)},$scope.showAlbumImages=function(album){$scope.activeAlbum=album,$scope.showAlbumPreview=!1,$scope.loadMoreImage(),$scope.activeAlbum.getImages().length()<20&&$scope.loadMoreImage()},$scope.enableAlbumPreview=function(){$scope.showAlbumPreview=!0,$scope.activeAlbum=null,$scope.$rgDigest()},$scope.selectPhoto=function(image){RingLogger.print("selected: "+image.src(),RingLogger.tags.IMAGE),$scope.forSelection&&$rootScope.$broadcast(SystemEvents.IMAGE.DO_REPOSITION,{image:image.src()})},$scope.$on("$destroy",function(){AlbumFactory.resetUserImages(profileObj.isCurrentUser())})}PhotosController.$inject=["rgScrollbarService","$timeout","$scope","$rootScope","AlbumFactory","$routeParams","profileFactory","fileUploadService","SystemEvents","Auth"];var linkFunc=function(scope,element){function handleScroll(){scope.showAlbumPreview||$window.innerHeight+$window.scrollY>=$document[0].body.offsetHeight&&scope.loadMoreImage()}!scope.hasOwnProperty("forSelection")||scope.forSelection!==!0&&"true"!==scope.forSelection?(scope.forSelection=!1,$window.addEventListener("scroll",handleScroll)):(element[0].children[0].children[0].style.overflow="hidden",element[0].children[0].children[0].style.maxHeight=utilsFactory.viewportsize().y-200+"px"),scope.$on("$destroy",function(){$window.removeEventListener("scroll",handleScroll)}),scope.$rgDigest()};return{restrict:"E",controller:PhotosController,link:linkFunc,templateUrl:"pages/partials/photos.html",scope:{forSelection:"@forSelection",$close:"&boxClose"}}}angular.module("ringid.common.rgphotos_directive",["ringid.profile","ringid.ringbox"]).directive("rgPhotos",rgPhotos),rgPhotos.$inject=["$window","$document","utilsFactory"]}(),function(){"use strict";angular.module("ringid.common.rghref_directive",[]).directive("rgHref",["$location","$route","$rootScope",function($location,$route,$rootScope){function clickHandler(value,attrs){var match=/#/g.exec(value);match=match?value.substr(match.index+1):value,$location.path()==match&&"true"===attrs.reloadpage&&$route.reload(),$rootScope.$coreDigest()}return function(scope,element,attrs){var fn;attrs.$observe("rgHref",function(value){return fn&&element.unbind("click",clickHandler),value?(fn=angular.bind(null,clickHandler,value,attrs),element.attr("href",value),void element.bind("click",fn)):void element.removeAttr("href")}),scope.$on("$destroy",function(){fn&&element.unbind("click",fn)})}}])}(),function(){"use strict";angular.module("ringid.common.rgslider_directive",[]).directive("rgSlider",function(){return{link:function(scope,element,atrr){function playSlide(){for(slides.removeClass("active"),slides.eq(nextSlide).addClass("active"),desc.removeClass("active"),desc.eq(nextSlide).addClass("active"),i=0;i<navs.length;i++)navs[i].find("li").removeClass("active"),navs[i].find("li").eq(nextSlide).addClass("active");crsl_data[0]&&playCarousel(findMappedItem(nextSlide)),autoSlide&&(nextSlide=nextSlide+1==slides.length?0:nextSlide+1,setTimer())}function setTimer(){sliderTimer=setTimeout(function(){playSlide()},delay)}function clearTimer(){clearTimeout(sliderTimer)}function index(node){for(var children=node.parentNode.childNodes,num=0,i=0;i<children.length;i++){if(children[i]==node)return num;1==children[i].nodeType&&num++}return-1}function setupEvent(){var nav;for(i=0;i<nav_dom.length;i++)nav=angular.element(nav_dom[i]),navs.push(nav),nav.find("li").on("click",function(e){nextSlide=index(this),clearTimer(),playSlide()});slides.on("mouseenter",function(e){e.stopPropagation(),autoSlide=!1,clearTimer()}),slides.on("mouseleave",function(e){e.stopPropagation(),autoSlide=!1,setTimer()}),desc.on("mouseenter",function(e){e.stopPropagation(),autoSlide=!1,clearTimer()}),desc.on("mouseleave",function(e){e.stopPropagation(),autoSlide=!1,setTimer()})}function initCarousel(){var item_w,item_h,item_opacity,item_left,item_top,depth,separation;for(item_w=crsl_items[0].clientWidth,item_h=crsl_items[0].clientHeight,item_opacity=1,item_left=Math.round(crls_width/2)-Math.round(item_w/2),item_top=Math.round(crls_height/2)-Math.round(item_h/2),crsl_data[center]={w:item_w,h:item_h,o:item_opacity,l:item_left,t:item_top,z:center,i:0},separation=crsl_distance,depth=center,i=center+1;i<crsl_items.length;i++)separation*=crsl_distance_multiplier,item_w=crsl_size_multiplier*crsl_data[i-1].w,item_h=crsl_size_multiplier*crsl_data[i-1].h,item_opacity=crsl_opacity_multiplier*crsl_data[i-1].o,item_left=crsl_data[i-1].l+crsl_data[i-1].w+separation-item_w,--depth,item_top=Math.round(crls_height/2)-Math.round(item_h/2),crsl_data[i]={w:item_w,h:item_h,o:item_opacity,l:item_left,t:item_top,z:depth,i:i};for(separation=crsl_distance,depth=center,i=center-1;i>=0;i--)separation*=crsl_distance_multiplier,item_w=crsl_size_multiplier*crsl_data[i+1].w,item_h=crsl_size_multiplier*crsl_data[i+1].h,item_opacity=crsl_opacity_multiplier*crsl_data[i+1].o,item_left=crsl_data[i+1].l-separation,--depth,item_top=Math.round(crls_height/2)-Math.round(item_h/2),crsl_data[i]={w:item_w,h:item_h,o:item_opacity,l:item_left,t:item_top,z:depth,i:i};for(i=0;i<crsl_items.length;i++)crsl_items[i].orgPos=i,crsl_items[i].crslPos=i,crsl_items[i].addEventListener("click",function(e){this.crslPos!=center&&(nextSlide=this.orgPos,clearTimer(),playSlide(),playCarousel(this))})}function playCarousel(item){moveItem(item),setItemPosition()}function moveItem(item){for(var temp,direction=item.crslPos<center?"forward":"backward";item.crslPos!=center;)for("forward"==direction?(temp=crsl_items.pop(),crsl_items.unshift(temp)):(temp=crsl_items.shift(),crsl_items.push(temp)),i=0;i<crsl_items.length;i++)crsl_items[i].crslPos=i,crsl_items[i].className="";item.className="active"}function setItemPosition(){for(i=0;i<crsl_items.length;i++)crsl_items[i].style.width=crsl_data[i].w+"px",crsl_items[i].style.height=crsl_data[i].h+"px",crsl_items[i].style.opacity=crsl_data[i].o,crsl_items[i].style.left=crsl_data[i].l+"px",crsl_items[i].style.top=crsl_data[i].t+"px",crsl_items[i].style.zIndex=crsl_data[i].z,crsl_data[i].i=i}function findMappedItem(position){for(i=0;i<crsl_items.length;i++)if(position==crsl_items[i].orgPos)return crsl_items[i]}var i,nextSlide=0,autoSlide=!1,sliderTimer=null,navs=[],slider_dom=element[0],nav_selector=atrr.navClass||"",slide_selector=atrr.slideClass||"",desc_selector=atrr.descClass||"",delay=1e3*parseInt(atrr.delay)||3e3,slides=angular.element(slider_dom.querySelectorAll("."+slide_selector)),desc=angular.element(slider_dom.querySelectorAll("."+desc_selector)),nav_dom=slider_dom.querySelectorAll("."+nav_selector)||{},crsl_distance=120,crsl_distance_multiplier=.6,crsl_size_multiplier=.6,crsl_opacity_multiplier=.8,crsl=slider_dom.querySelector(".nav-carousel"),crsl_items=crsl.querySelectorAll("img");crsl_items=Array.prototype.slice.call(crsl_items);var crsl_data=[],crls_width=crsl.clientWidth,crls_height=crsl.clientHeight,center=Math.floor(crsl_items.length/2);setupEvent(),playSlide(),crsl_items[0].src=crsl_items[0].src,crsl_items[0].addEventListener("load",function(){initCarousel(),playCarousel(crsl_items[0]),setTimeout(function(){crsl.style.visibility="visible"},800)})}}})}(),function(){"use strict";function userListFilter(){return function(items,name,tagItems){if(items){for(var tempu,filtered=[],nameMatch=new RegExp(name,"i"),i=0;i<items.length;i++){if(filtered.length>10)return filtered;tempu=items[i].value.getLiteUser(),nameMatch.test(tempu.getName())&&-1===tagItems.indexOf(tempu)&&filtered.push(tempu)}return filtered}}}function rgFriendDropdown(friendsFactory,$filter){return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&",tagItems:"="},templateUrl:function(elem,attrs){return attrs.templateUrl||"pages/dropdowns/tag-friend-dropdown.html"},compile:function(tElement,tAttrs,transclude){return{pre:function(scope,iElement,iAttrs,controller){function setUser(){scope.users=$filter("userListFilter")(friendsFactory.friends.all(),scope.filterText,scope.tagItems)}function searchRequest(){sentRequest||(friendsFactory.searchContact({schPm:scope.filterText},!0).then(function(){scope.$rgDigest()}),scope.loading=!0,sentRequest=!0)}var sentRequest=!1;scope.users=[],scope.$watch(friendsFactory.friends.length,function(newValue,oldValue){setUser(),sentRequest&&(scope.loading=!1,sentRequest=!1)}),scope.$watch("filterText",function(newValue,oldValue){setUser(),sentRequest=!1,scope.users.length<5&&oldValue.length<newValue.length&&searchRequest()}),scope.$watch("users.length",function(newval,oldVal){5>newval&&oldVal>newval&&(scope.filterText.length>0?searchRequest():friendsFactory.getContactDetails()),newval>5&&!sentRequest&&(scope.loading=!1)}),scope.loading=!!scope.users.length,scope.choose=function(item,event){scope.onSelect()(item,event),setUser(),scope.$rgDigest()},scope.close=angular.isFunction(scope.onClose)?scope.onClose():angular.noop,scope.processKeyup=function($event){13===$event.which&&scope.users.length&&(scope.choose(scope.users[0],$event),scope.filterText="",scope.$rgDigest())},scope.activeId=0,scope.setActiveId=function(i){scope.activeId=i},iElement.bind("keydown",function(e,keyCode){13===keyCode?scope.choose(scope.users[scope.activeId],e):38===keyCode?scope.activeId=Math.max(scope.activeId-1,0):40===keyCode&&(scope.activeId=Math.min(scope.activeId+1,scope.users.length-1)),RingLogger.print("keup from dropdown : "+keyCode,"STSTAG"),scope.$rgDigest()}),iElement.bind("mouseleave",function(){scope.activeId=0})},post:function(scope,iElement,iAttrs,controller){iElement.on("click",function(event){event.stopPropagation()}),scope.$rgDigest()}}}}}angular.module("ringid.common.rg_friend_dropdown",["ringid.friend.friends_factory"]).filter("userListFilter",userListFilter).directive("rgFriendDropdown",rgFriendDropdown),rgFriendDropdown.$inject=["friendsFactory","$filter"]}(),function(){"use strict";function rgEditor($rootScope,$document,$compile,utilsFactory){function insertAtCaret(node,container){
var sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){var range=sel.getRangeAt(0);if(range.endContainer!=container&&range.endContainer.parentElement!=container&&range.endContainer.firstElementChild!=container)return container.appendChild(node),void setCaretAtTheEnd(container);container.focus(),range.deleteContents(),range.insertNode(node),sel.removeAllRanges(),range=document.createRange(),range.collapse(!0),range.setStartAfter(node),sel.addRange(range)}else container.appendChild(node),setCaretAtTheEnd(container)}function setCaretAtTheEnd(container){var range,sel;container.focus(),range=document.createRange(),range.selectNodeContents(container),range.collapse(!1),sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(range)}function getCaretCharacterOffsetWithin(element){var sel,caretOffset=0,doc=element.ownerDocument||element.document,win=doc.defaultView||doc.parentWindow;if("undefined"!=typeof win.getSelection){if(sel=win.getSelection(),sel.rangeCount>0){var range=win.getSelection().getRangeAt(0),preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element),preCaretRange.setEnd(range.endContainer,range.endOffset),caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&"Control"!=sel.type){var textRange=sel.createRange(),preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(element),preCaretTextRange.setEndPoint("EndToEnd",textRange),caretOffset=preCaretTextRange.text.length}return caretOffset}function link(scope,element,attrs){function editorKeyup($event){RingLogger.print("keyup fired : "+keyCode,"STSTAG"),$event.stopPropagation();var keyCode=$event.which||$event.keyCode||$event.key;return"true"===attrs.tagFriend&&processAtTagFriend(),27==keyCode&&attrs.onEscape?($rootScope.unloadWarn=!1,DropdownFriendElement?void closeDropdownFriend():void scope.onEscape()()):(scope.updateContent()," "!=editor_container.html()&&"<br>"!=editor_container.html()&&"<p>"!=editor_container.html()&&"<p>&nbsp;</p>"!=editor_container.html()||(editor_container.html(""),setCaretAtTheEnd(editor_container[0])),void(""==editor_container.html()?$rootScope.unloadWarn=!1:$rootScope.unloadWarn=!1))}function processAtTagFriend(){scope.filterFriend=findAtCharWord(getCaretCharacterOffsetWithin(editor_container[0])).word,RingLogger.print("at tag friend called : "+scope.filterFriend,"STSTAG"),scope.filterFriend===!1&&DropdownFriendElement&&(scope.filterFriend="",scope.closeDropdownFriend()),scope.filterFriend&&!DropdownFriendElement&&(DropdownFriendElement=$compile('<rg-friend-dropdown template-url="pages/dropdowns/tag-editor-dropdown.html" tag-items="[]" filter-text="filterFriend" focus-filter="" on-close="closeDropdownFriend" on-select="chooseFriend"></rg-friend-dropdown>')(scope),element.after(DropdownFriendElement))}function findAtCharWord(offset){var ch,space_counter=0,returnValue=!1,content=editor_container.html();content=content.replace(/<a[^>]+>([^<]+)<\/a>/g,"$1"),content=content.replace(/<img[\w\W]+?\/?>/g,"");for(var i=offset-1;i>=0&&(ch=content[i],/\s/.test(ch)&&space_counter++,!(space_counter>1));i--)if(/@/.test(ch)){(0==i||/\s/.test(content[i-1]))&&(returnValue=content.substr(i+1,offset-1-i));break}var range=window.getSelection().getRangeAt(0),offset=getCaretCharacterOffsetWithin(range.endContainer);return currentTagObject={word:returnValue,startOffset:i,endOffset:offset,range:range,stof:offset-(returnValue&&returnValue.length+1||0),endof:offset}}function editorContainerOnKeyDown(e){var keyCode=e.which||e.keyCode||e.key;if(RingLogger.print("keydown fired : "+keyCode,"STSTAG"),DropdownFriendElement){if(38===keyCode||40===keyCode)return e.preventDefault(),e.stopPropagation(),void DropdownFriendElement.triggerHandler(e,keyCode);13===keyCode&&(e.stopPropagation(),e.preventDefault(),DropdownFriendElement.triggerHandler(e,keyCode))}}function editorContainerOnKeyPress(e){e.stopPropagation();var keyCode=e.which||e.keyCode||e.key;if(RingLogger.print("kpress fired : "+keyCode,"STSTAG"),isDisabled){var currentTime=(new Date).getTime();return currentTime-disableTime>3e3&&(isDisabled=!1,editor_container.removeClass("disabled")),void e.preventDefault()}if(13==keyCode){if(scope.editorContent=scope.editorContent.trim(),attrs.onEnter&&("ctrl"!=attrs.newLine||!e.shiftKey&&!e.ctrlKey))return e.preventDefault(),""==scope.editorContent?(editor_container.addClass("error"),isError=!0,editor_container.html(""),void setCaretAtTheEnd(editor_container[0])):(scope.isDisabled&&(isDisabled=!0,disableTime=(new Date).getTime(),editor_container.addClass("disabled")),scope.onEnter()(scope.onEnterArg),attrs.editMode||(editor_container.html(""),setCaretAtTheEnd(editor_container[0])),void($rootScope.unloadWarn=!1));if("off"==attrs.newLine)return void e.preventDefault();if("ctrl"==attrs.newLine&&!e.shiftKey&&!e.ctrlKey)return void e.preventDefault()}isError&&(editor_container.removeClass("error"),isError=!1)}function editorContainerOnPaste(e){e.stopPropagation(),e.preventDefault();var text="";if(e.clipboardData)text=e.clipboardData.getData("text/plain");else if(window.clipboardData)try{text=window.clipboardData.getData("Text")}catch(e){}insertAtCaret(document.createTextNode(text),editor_container[0]),scope.updateContent()}function elementClickCallback(e){e.stopImmediatePropagation(),setCaretAtTheEnd(editor_container[0])}function containerClickCallback(e){e.stopPropagation()}var currentTagObject,DropdownFriendElement,editor_container=element.find("div"),isError=!1,isDisabled=!1,disableTime=0;element.find("span");scope.filterFriend="",scope.editorContent="",scope.placeholder=attrs.placeholder,RingLogger.tags.DIGEST&&scope.$watch(function(){RingLogger.info("from RgEditor",RingLogger.tags.DIGEST)}),scope.updateContent=function(){var editorContent=editor_container.html().replace('class="feed_emo" ',"");editorContent=editorContent.replace("&lt;","<"),editorContent=editorContent.replace("&gt;",">"),editorContent=editorContent.replace(/<img\s(\S+)?\s?title="(\S+)"\s?(\S+)?>/gi,"$2"),editorContent=editorContent.replace(/<\/p>/g,"<br>"),editorContent=editorContent.replace(/<p>/g,""),editorContent=editorContent.replace(/<br>/g,"\n"),editorContent=editorContent.replace(/&nbsp;/g," "),editorContent=editorContent.replace(/<a[^>]+data-link="([^"]+)[^>]+>([^<]+)<\/a>/g,function(match,$1,$2){return"##"+$1+"##"}),editorContent=editorContent.replace(/\u200B/g,""),scope.editorContent=editorContent.trim(),scope.$parent&&1!==scope.$parent.$id?scope.$parent.$rgDigest():scope.$rgDigest()},scope.$on("cleareditor",function(){$rootScope.unloadWarn=!1,attrs.editMode||(editor_container.html(""),setCaretAtTheEnd(editor_container[0]))}),scope.$on("seteditor",function(){editor_container.html(scope.editorContent)}),scope.$watch("isDisabled",function(value){isDisabled&&(editor_container.removeClass("disabled"),isDisabled=!1)}),attrs.focus&&scope.$watch("focus",function(value){value&&setTimeout(function(){setCaretAtTheEnd(editor_container[0])},0)}),scope.insertEmoji=scope.$parent.insertEmoji=function(emoticon){var img=document.createElement("img");img.src=emoticon.src(),img.setAttribute("title",emoticon.symbol()),insertAtCaret(img,editor_container[0]),scope.updateContent()},scope.closeDropdownFriend=function(){DropdownFriendElement&&(DropdownFriendElement.remove(),DropdownFriendElement=void 0)},scope.chooseFriend=function(user,$event){var aEl,linkText,range;if(currentTagObject&&currentTagObject.word){aEl=document.createElement("a"),aEl.innerHTML=user.getName(),aEl.title=user.getName(),aEl.href="#",aEl.setAttribute("data-link",user.getUtId()),aEl.setAttribute("contenteditable","false"),linkText=document.createTextNode("\u200b");var range=document.createRange();range.selectNodeContents(editor_container[0]);var sel=window.getSelection();sel.removeAllRanges(),range.setStart(currentTagObject.range.startContainer,currentTagObject.stof),range.setEnd(currentTagObject.range.endContainer,currentTagObject.endof),sel.addRange(range),insertAtCaret(aEl,editor_container[0]),insertAtCaret(linkText,editor_container[0]),scope.closeDropdownFriend(),scope.updateContent()}},scope.showEmoji=!1,attrs.showEmoji&&(scope.showEmoji=!0),attrs.editMode&&(editor_container.html(scope.editMode()().toString().replace(/<a(?![\w\W]+data-link)[^>]+>([^<]+?)<\/a>/gi,"$1")),scope.updateContent()),element.on("click",elementClickCallback),editor_container.on("click",containerClickCallback),editor_container.on("paste",editorContainerOnPaste),editor_container.on("keyup",editorKeyup),editor_container.on("keypress",editorContainerOnKeyPress),editor_container.on("keydown",editorContainerOnKeyDown),scope.$on("$destroy",function(){element.off("click",elementClickCallback),editor_container.off("click",containerClickCallback),editor_container.off("paste",editorContainerOnPaste),editor_container.off("keyup",editorKeyup),editor_container.off("keypress",editorContainerOnKeyPress),editor_container.on("keydown",editorContainerOnKeyDown),editor_container=null})}return{scope:{editorContent:"=",onEnter:"&",onEscape:"&",onEnterArg:"=",isDisabled:"=",focus:"=",editMode:"&"},restrict:"E",template:'<div placeholder="{{::placeholder}}" contenteditable="true" class="editor"></div><a ng-if="showEmoji" href="javascript:void(0)"><i class="icon-emoticon ico-sty" rg-emoticon="" clicked="insertEmoji" show-sticker="false"></i></a>',link:link}}angular.module("ringid.common.rgeditor_directive",[]).directive("rgEditor",rgEditor),rgEditor.$inject=["$rootScope","$document","$compile","utilsFactory"]}(),function(){"use strict";function rgEmotionDirective($compile,$document,EmotionFactory){return{restrict:"A",scope:{onSelect:"&"},link:function(scope,element){function safeDigest(){scope.$parent&&1!==scope.$parent.$id?scope.$parent.$rgDigest():scope.$rgDigest()}function showBox(event){event.preventDefault(),scope.active?scope.initEMotionList("none",event):scope.initEMotionList("block",event),scope.active=!scope.active,safeDigest()}function checkToHide(e){e.target!==element[0]&&e.target.parentNode&&e.target.parentNode!==element[0]&&e.target.parentNode.parentNode!==element[0]&&"pt-top"!==e.target.className&&scope.close(e)}var emotionDropdownElement;scope.active=!1,scope.emotionFilterText="",scope.initEMotionList=function(display){EmotionFactory.init(),emotionDropdownElement||(emotionDropdownElement=$compile('<rg-emotion-dropdown filter-text="emotionFilterText" focus-filter="active" on-close="close" on-select="choose"></rg-emotion-dropdown>')(scope),element.after(emotionDropdownElement)),emotionDropdownElement.css("display",display)},scope.choose=function(subCat,$event){scope.onSelect({item:subCat}),scope.emotionFilterText="",scope.initEMotionList("none",$event),scope.active=!1,safeDigest()},element.on("click",showBox),$document.on("click",checkToHide),scope.close=function(event){scope.active&&(scope.initEMotionList("none",event),scope.active=!1),safeDigest()},RingLogger.tags.DIGEST&&scope.$watch(function(){RingLogger.info("from rgEmotionDir",RingLogger.tags.DIGEST)}),scope.$on("$destroy",function(){element.off("click",showBox),$document.off("click",checkToHide),emotionDropdownElement=void 0})}}}function rgEmotionDropDOwn(EmotionFactory){function bindClick(event){event.stopPropagation()}return{scope:{filterText:"=filterText",focusFilter:"=",onSelect:"&",onClose:"&onClose"},templateUrl:"pages/dropdowns/emotion-dropdown.html",compile:function(){return{pre:function(scope){scope.emotions={},scope.emotions[0]=EmotionFactory.getEmotions(),scope.setEmotion=function(emotions){scope.emotions[0]=emotions,scope.$rgDigest()},EmotionFactory.setScopeForDigest(scope),scope.updateModel=function(e){scope.filterText=e.target.value,scope.$parent.$rgDigest()},scope.loading=!!scope.emotions.length,scope.choose=angular.isFunction(scope.onSelect)?scope.onSelect():angular.noop,scope.close=angular.isFunction(scope.onClose)?scope.onClose():angular.noop,RingLogger.tags.DIGEST&&scope.$watch(function(){RingLogger.info("from rgEmotionDropdownDir",RingLogger.tags.DIGEST)}),scope.$on("$destroy",function(){EmotionFactory.removeScope(scope)})},post:function(scope,iElement){iElement.on("click",bindClick),scope.$on("$destroy",function(){iElement.off("click",bindClick)}),scope.$rgDigest()}}}}}angular.module("ringid.common.emotion_directives",["ringid.common.emotion_factory"]).directive("rgEmotion",rgEmotionDirective).directive("rgEmotionDropdown",rgEmotionDropDOwn),rgEmotionDirective.$inject=["$compile","$document","EmotionFactory"],rgEmotionDropDOwn.$inject=["EmotionFactory"]}(),function(){"use strict";function rgHovercard($ringhttp,$templateCache,$compile,$window){angular.element(document.querySelector("body"));return{scope:!0,link:function($scope,iElm,iAttrs){function initiateHover(data){function closeHoverELement(){mouseoutFlag&&hoverEl&&(hoverEl.off("mouseenter",hoverElementMouseEnter),hoverEl.off("mouseleave",hoverElementMouseLeave),hoverEl.remove(),hoverEl=void 0),mouseoutFlag=!1}function hoverElementMouseEnter(){mouseoutFlag=!1}function hoverElementMouseLeave(){mouseoutFlag=!0,closeHoverELement()}function directiveElMouseEnter(e){mouseoutFlag||(hoverEl||(hoverEl=angular.element('<div class="fr-menu"></div>'),hoverEl.html(data),iElm.after(hoverEl)),iAttrs.onHoverStart&&"function"==typeof $scope[iAttrs.onHoverStart]&&$scope[iAttrs.onHoverStart](),$compile(hoverEl)($scope),hoverEl.css({display:"block"}),hoverEl.on("mouseleave",hoverElementMouseLeave),hoverEl.on("mouseenter",hoverElementMouseEnter),$scope.$rgDigest())}function directiveElMouseLeave(e){mouseoutFlag=!0,window.setTimeout(closeHoverELement,500),window.clearTimeout(timer),timer=!1,iElm.off("mouseleave",directiveElMouseLeave)}function initiate(e){timer||(timer=window.setTimeout(directiveElMouseEnter.bind(this,e),1200)),iElm.on("mouseleave",directiveElMouseLeave)}var timer,mouseoutFlag=!1;iElm.on("mouseenter",initiate),$scope.$on("$destroy",function(){directiveElMouseLeave(),iElm.off("mouseenter",directiveElMouseEnter),iElm.off("mouseleave",directiveElMouseLeave)})}var hoverEl;"false"!==iAttrs.rgHovercard&&$ringhttp.get(iAttrs.hoverTemplateUrl).success(function(result){initiateHover(result)}),RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from rgHovercard",RingLogger.tags.DIGEST)})}}}angular.module("ringid.common.rghover_card_directive",[]).directive("rgHovercard",rgHovercard),rgHovercard.$inject=["$ringhttp","$templateCache","$compile","$window"]}(),function(){"use strict";function rgTagFriend($compile,$document){return{restrict:"A",scope:{onSelect:"&",tagItems:"="},link:function(scope,element,attr){function bindFn(event){event.preventDefault(),scope.active?(scope.close(event),$document.off("click",bindDocumentClicktoControlClose)):(scope.init(event),$document.on("click",bindDocumentClicktoControlClose))}function bindDocumentClicktoControlClose(e){e.target!=element[0]&&e.target.parentNode!=element[0]&&null!=e.target.parentNode&&e.target.parentNode.parentNode!=element[0]&&"pt-top"!=e.target.className&&scope.close(e)}if("false"===attr.rgTagFriend)return void element.parent().remove();var DropdownElement;scope.active=!1,scope.filterText="",scope.init=function(display,event){DropdownElement||(DropdownElement=$compile('<rg-friend-dropdown tag-items="tagItems" filter-text="filterText" focus-filter="active" on-close="close" on-select="choose"></rg-friend-dropdown>')(scope),element.after(DropdownElement)),scope.active=!0},scope.choose=function(subCat,$event){scope.onSelect({item:subCat}),scope.$parent&&1!==scope.$parent.$id?scope.$parent.$rgDigest():$scope.$rgDigest()},element.on("click",bindFn),scope.close=function(event){scope.active&&(DropdownElement.remove(),DropdownElement=void 0,scope.active=!1)},RingLogger.tags.DIGEST&&scope.$watch(function(){RingLogger.info("from rgTagFriendDirective",RingLogger.tags.DIGEST)}),scope.$on("$destroy",function(){element.off("click",bindFn),$document.off("click",bindDocumentClicktoControlClose),DropdownElement=void 0})}}}angular.module("ringid.common.rg_tag_friend",["ringid.common.rg_friend_dropdown"]).directive("rgTagFriend",rgTagFriend),rgTagFriend.$inject=["$compile","$document"]}(),angular.module("ringid.common.rg_column",[]).directive("rgColumn",["$document","Storage","utilsFactory",function($document,Storage,utilsFactory){return{restrict:"A",controller:["utilsFactory","$scope","SystemEvents","$rootScope",function(utilsFactory,$scope,SystemEvents,$rootScope){$scope.spans=utilsFactory.feedColumn(),$scope.defaultSpan=utilsFactory.getDefaultColumn(),$scope.choose=function(val){utilsFactory.resetScroll(),utilsFactory.animateScroll(),utilsFactory.setFeedColumn(val),$scope.spans=val,$rootScope.$broadcast(SystemEvents.COMMON.COLUMN_CHANGED,val)},$scope.$watch(utilsFactory.feedColumn,function(newValue){$scope.spans=newValue,$rootScope.$broadcast(SystemEvents.COMMON.COLUMN_CHANGED,newValue)}),$scope.$on(SystemEvents.COMMON.WINDOW_RESIZED,function(){$scope.defaultSpan=utilsFactory.getDefaultColumn()})}],template:'<span></span>                        <span></span>                        <span></span>                        <div class="col-area">                        <div class="col-area-wrapper">                            <div data-tooltip-post="3 Column" ng-click="choose(3)" class="list-ico width-26" ng-if="defaultSpan > 2" ng-class="{\'list-act\' : spans == 3 }">                                <span></span>                                <span></span>                                <span></span>                            </div>                            <div data-tooltip-post="2 Column" ng-click="choose(2)" class="list-ico width-17" ng-if="defaultSpan > 1" ng-class="{\'list-act\' : spans == 2 }">                                <span></span>                                <span></span>                            </div>                            <div data-tooltip-post="1 Column" ng-click="choose(1)" class="list-ico width-9" ng-class="{\'list-act\' : spans == 1 }">                                <span></span>                            </div>                            </div>                        </div>',link:function(scope,element,attrs,ctrls){function bindFn(event){event.preventDefault(),dropEl||(dropEl=angular.element(element.find("div")[0]),$document.on("click",bindDocumentClicktoControlClose)),dropEl.toggleClass("colshow")}function bindDocumentClicktoControlClose(e){e.target!=element[0]&&e.target.parentNode!=element[0]&&null!=e.target.parentNode&&e.target.parentNode.parentNode!=element[0]&&"pt-top"!=e.target.className&&closeColumnSelector(e)}function closeColumnSelector(event){dropEl.removeClass("colshow")}var dropEl;element.on("click",bindFn),scope.$on("$destroy",function(){element.off("click",bindFn),$document.off("click",bindDocumentClicktoControlClose),dropEl=void 0})}}}]),function(){"use strict";function rgSrc(){return{restrict:"A",link:function(scope,element,attr){attr.rgSrc&&scope.$watch(attr.rgSrc,function(newValue){null===newValue||void 0===newValue?element.removeAttr("src"):element.attr("src",newValue)})}}}angular.module("ringid.common.rgsrc_directive",[]).directive("rgSrc",rgSrc)}(),function(){"use strict";function rgRepeat($parse,$rootScope,$animate,SystemEvents){function compile(element,attr){return function($scope,$element,$attr,ctrl,$transclude){function update(collection){var index,i,value,childScope,trackID,block,getterLocals,nextNode,clone,length=collection.length,prevNode=$element[0],nextBlockMap=Object.create(null);for($rootScope.$$postDigest(function(){var index,value,block;for(index=0;index<collection.length;index++)value=collection[index],lastBlockMap[value.$TrackID]&&(block=lastBlockMap[value.$TrackID],block.childHead&&(block.scope.$$childHead=block.childHead))}),index=0;length>index;index++)value=collection[index],getterLocals={},getterLocals[valueIdentifier]=value,trackID=getTrackID($scope,getterLocals),lastBlockMap[trackID]?(block=lastBlockMap[trackID],delete lastBlockMap[trackID]):(childScope=$scope.$new(),childScope[valueIdentifier]=value,block={},block.clone=null,block.scope=childScope),collection[index].$TrackID=trackID,nextBlockMap[trackID]=block;for(trackID in lastBlockMap)if(lastBlockMap[trackID]){for(block=lastBlockMap[trackID],i=0;i<block.clone.length;i++)prevNode.parentNode.removeChild(block.clone[i]);block.scope.$destroy()}for(index=0;length>index;index++)value=collection[index],trackID=value.$TrackID,block=nextBlockMap[trackID],block.scope.$index=index,clone=block.clone,clone?(nextNode=prevNode,block.startNode!=nextNode&&$animate.move(block.clone,null,angular.element(prevNode)),prevNode=block.clone[block.clone.length-1],block.childHead=block.scope.$$childHead,block.scope.$$childHead=null):$transclude(block.scope,function(clone){var endNode=rgRepeatEndComment.cloneNode(!1);clone[clone.length++]=endNode,$animate.enter(clone,null,angular.element(prevNode)),prevNode=endNode,block.clone=clone,block.startNode=clone[0]});$scope.target&&$scope.target.getMapKey&&$scope.$emit(SystemEvents.FEED.HEIGHT,$scope.target.getMapKey()),lastBlockMap=nextBlockMap}var lhs,rhs,valueIdentifier,expression=$attr.rgRepeat,match=expression.match(/^\s*(.+)\s+in\s+(.*?)\s+track\s+by\s+(.+)\s*$/),lastBlockMap=Object.create(null);if(!match)throw"Expected expression in form of '_item_ in _collection track by _key_'";var rgRepeatEndComment=document.createComment(" end rgRepeat: "+expression+" ");lhs=match[1],rhs=match[2];var getTrackID=$parse(match[3]);valueIdentifier=match[1],$scope.$watchCollection(rhs,update)}}return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:compile}}angular.module("ringid.common.rgrepeat_directive",[]).directive("rgRepeat",rgRepeat),rgRepeat.$inject=["$parse","$rootScope","$animate","SystemEvents"]}(),function(){"use strict";angular.module("ringid.common.directives",["ringid.common.rgfocus_directive","ringid.common.rgsearch_directive","ringid.common.rgdropdown_directive","ringid.common.rgscrollbar_directive","ringid.common.rground_progress_directive","ringid.common.rginvite_directive","ringid.common.rgemoticon_directive","ringid.common.rgclick_directive","ringid.common.rgimg_directive","ringid.common.rgupload_directive","ringid.common.rgphotos_directive","ringid.common.rg_friend_dropdown","ringid.common.rgeditor_directive","ringid.common.rghref_directive","ringid.common.rgslider_directive","ringid.common.emotion_directives","ringid.common.rghover_card_directive","ringid.common.rg_tag_friend","ringid.common.rgplayer_directive","ringid.common.rgrepeat_directive","ringid.common.rg_column","ringid.common.rgsrc_directive","ringid.common.rgloading_directive","ringid.common.rgRecorder"])}(),function(){"use strict";function profileHttpService($$connector,OPERATION_TYPES,utilsFactory){var self=this,OTYPES=OPERATION_TYPES.SYSTEM.PROFILE,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE;self.basicAndPrivacy=function(utId,iscurrent){var payload;return payload=iscurrent?{actn:OTYPES.TYPE_ACTION_CURRENT_USER_BASICINFO}:{actn:OTYPES.TYPE_ACTION_OTHER_USER_BASICINFO,utId:utId},$$connector.request(payload,REQTYPE.REQUEST)},self.getUserDetails=function(obj,withMutualFriendCount){var payload={actn:OTYPES.TYPE_ACTION_GET_USER_DETAILS,wmfc:!!withMutualFriendCount};return angular.extend(payload,obj),$$connector.request(payload,REQTYPE.REQUEST,!0)},self.fetchPresence=function(uIds){var payload={actn:OTYPES.ACTION_USERS_PRESENCE_DETAILS,uIds:uIds};return $$connector.send(payload,REQTYPE.REQUEST)},self.fetchPresenceAndMood=function(fndId){var payload={actn:OTYPES.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:fndId};return $$connector.request(payload,REQTYPE.REQUEST)},self.changeMood=function(mood){var payload={actn:OTYPES.TYPE_ACTION_USER_MOOD,mood:mood};return $$connector.request(payload,REQTYPE.AUTHENTICATION)},self.getMutualFriends=function(friendId){var payload={actn:OTYPES.FETCH_FRIEND_MUTUAL_FRIEND_LIST,uId:friendId};return $$connector.request(payload,REQTYPE.REQUEST)},self.getUserProfileData=function(utId){var payload;return payload=utId?{actn:OTYPES.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS,utId:utId}:{actn:OTYPES.TYPE_ACTION_LIST_WORK_AND_EDUCATIONS},$$connector.send(payload,REQTYPE.REQUEST)},self.updateProfile=function(userId,obj,dateObj,mobj){1!==mobj&&(mobj=mobj.getTime());var payload={actn:OTYPES.TYPE_ACTION_MODIFY_USER_PROFILE,nOfHd:7,fn:obj.fn.utf8Encode(),hc:obj.hc?obj.hc.utf8Encode():" ",cc:obj.cc?obj.cc.utf8Encode():" ",gr:obj.gr,am:obj.am.utf8Encode(),bDay:dateObj?dateObj.getTime():1,mDay:mobj};return $$connector.request(payload,REQTYPE.UPDATE)},self.updateProfilePrivacy=function(){var payload={actn:OTYPES.TYPE_ACTION_MODIFY_PRIVACY_SETTINGS,pvc:[3,3,3,3,3]};return $$connector.request(payload,REQTYPE.UPDATE)},self.submitNewEducation=function(obj){var payload={actn:OTYPES.TYPE_ACTION_ADD_EDUCATION,request_type:REQTYPE.UPDATE,edu:{af:1,cntn:obj.cntn?obj.cntn.utf8Encode():"",desc:obj.desc?obj.desc.utf8Encode():"",dgr:obj.dgr?obj.dgr.utf8Encode():"",grtd:obj.grtd,iss:obj.iss,scl:obj.scl.utf8Encode(),ft:obj.ft?obj.ft:1,tt:obj.tt?obj.tt:1,ut:0}};return $$connector.request(payload,REQTYPE.UPDATE)},self.deleteEducation=function(id){var payload={actn:OTYPES.TYPE_ACTION_REMOVE_EDUCATION,id:id};return $$connector.request(payload,REQTYPE.UPDATE)},self.updateEducationById=function(obj){var payload={actn:OTYPES.TYPE_ACTION_UPDATE_EDUCATION,edu:{id:obj.id,scl:obj.scl.utf8Encode(),ft:obj.ft?obj.ft:1,tt:obj.tt?obj.tt:1,desc:obj.desc?obj.desc.utf8Encode():"",af:obj.af,grtd:obj.grtd,iss:obj.iss,cntn:obj.cntn?obj.cntn.utf8Encode():"",dgr:obj.dgr?obj.dgr.utf8Encode():""}};return $$connector.request(payload,REQTYPE.UPDATE)},self.getAllSkill=function(){var payload={actn:230};return $$connector.request(payload,REQTYPE.REQUEST)},self.submitNewSkill=function(obj){var payload={actn:OTYPES.TYPE_ACTION_ADD_SKILL,skill:{skl:obj.skl.utf8Encode(),desc:obj.desc.utf8Encode()}};return $$connector.request(payload,REQTYPE.UPDATE)},self.updateSkill=function(obj){var payload={actn:OTYPES.TYPE_ACTION_UPDATE_SKILL,skill:{id:obj.id,skl:obj.skl.utf8Encode(),desc:obj.desc.utf8Encode()}};return $$connector.request(payload,REQTYPE.UPDATE)},self.deleteSkill=function(sid){var payload={actn:OTYPES.TYPE_ACTION_REMOVE_SKILL,id:sid};return $$connector.request(payload,REQTYPE.UPDATE)},self.submitNewWork=function(obj){var payload={actn:OTYPES.TYPE_ACTION_ADD_WORK,request_type:REQTYPE.UPDATE,wrk:{pstn:obj.pstn?obj.pstn.utf8Encode():"",desc:obj.desc?obj.desc.utf8Encode():"",cnm:obj.cnm.utf8Encode(),tt:obj.tt||1,ft:obj.ft||1}};return $$connector.request(payload,REQTYPE.UPDATE)},self.updateWork=function(obj){var payload={actn:OTYPES.TYPE_ACTION_UPDATE_WORK,wrk:{id:obj.id,pstn:obj.pstn.utf8Encode(),cnm:obj.cnm.utf8Encode(),desc:obj.desc.utf8Encode(),tt:obj.tt||1,ft:obj.ft||1}};return $$connector.request(payload,REQTYPE.UPDATE)},self.deleteWork=function(workid){var payload={actn:OTYPES.TYPE_ACTION_REMOVE_WORK,id:workid};return $$connector.request(payload,REQTYPE.UPDATE)},self.changeProfilePicture=function(obj){var payload={actn:OTYPES.TYPE_CHANGE_PROFILE_PIC,type:1,imT:2,pimX:obj.pimX,pimY:obj.pimY,ih:obj.ih,iw:obj.iw,iurl:obj.iurl};return $$connector.request(payload,REQTYPE.UPDATE)},self.changeCoverPicture=function(obj){var payload={actn:OTYPES.TYPE_CHANGE_COVER_PIC,type:1,imT:3,cimX:obj.cimX,cimY:obj.cimY,ih:obj.ih,iw:obj.iw,iurl:obj.iurl};return $$connector.request(payload,REQTYPE.UPDATE)},self.removeProfilePicture=function(prIm){var payload={actn:OTYPES.TYPE_REMOVE_PROFILE_IMAGE,prIm:prIm};return $$connector.request(payload,REQTYPE.UPDATE)},self.removeCoverPicture=function(cIm){var payload={actn:OTYPES.TYPE_REMOVE_COVER_IMAGE,cIm:cIm};return $$connector.request(payload,REQTYPE.UPDATE)},self.changePassword=function(oldPass,newPass){var payload={actn:OTYPES.CHANGE_PASSWORD,oPw:oldPass,nPw:newPass};return $$connector.request(payload,REQTYPE.UPDATE)},self.sendCode=function(obj){var payload={actn:OTYPES.SEND_VERIFICATION_CODE_TO_MAIL,el:obj.email};return $$connector.request(payload,REQTYPE.REQUEST)},self.sendCodeToPhn=function(obj){var payload={actn:OTYPES.SEND_VERIFICATION_CODE_TO_PHONE,mbl:obj.phone,mblDc:obj.countryCode};return $$connector.request(payload,REQTYPE.REQUEST)},self.verifyCode=function(obj){var payload={actn:OTYPES.SEND_VERIFICATION_CODE_TO_MAIL,el:obj.email,vc:obj.code};return $$connector.request(payload,REQTYPE.REQUEST)},self.verifyPhnCode=function(obj){var payload={actn:OTYPES.SEND_VERIFICATION_CODE_TO_PHONE,uId:obj.uId,mbl:obj.phone,mblDc:obj.mblDc,vc:obj.code};return $$connector.request(payload,REQTYPE.REQUEST)},self.verifyCheck=function(){var payload={actn:OTYPES.PHN_MAIL_VERIFICATION_CHECK};return $$connector.request(payload,REQTYPE.REQUEST)},self.changePrivacy=function(obj){var payload={actn:obj.utId,sn:obj.sn,sv:obj.sv};return obj.hasOwnProperty("utId")&&(payload.utId=obj.utId),$$connector.request(payload,REQTYPE.UPDATE)},self.saveCallPvcEdit=function(obj){var payload={actn:obj.actn,sn:obj.sn,sv:obj.sv};return obj.isCurrent||(payload.utId=obj.utId),$$connector.request(payload,REQTYPE.UPDATE)},self.saveChatPvcEdit=function(obj){var payload={actn:obj.actn,sn:obj.sn,sv:obj.sv};return obj.isCurrent||(payload.utId=obj.utId),$$connector.request(payload,REQTYPE.UPDATE)},self.saveFeedPvcEdit=function(obj){var payload={actn:obj.actn,sn:obj.sn,sv:obj.sv};return obj.isCurrent||(payload.utId=obj.utId),$$connector.request(payload,REQTYPE.UPDATE)},self.addSocialAccount=function(obj){var payload={actn:OTYPES.ADD_SOCIAL_NETWORK,it:obj.access_token,smid:obj.id,wk:utilsFactory.getUniqueID()};return"facebook"===obj.platform?payload.smt=4:"twitter"===obj.platform&&(payload.smt=5),$$connector.request(payload,REQTYPE.AUTHENTICATION)},self.saveAchatSetting=function(obj){var payload={actn:OTYPES.TYPE_CHANGE_PRIVACY,sn:obj.sn,sv:obj.sv};return $$connector.request(payload,REQTYPE.UPDATE)}}angular.module("ringid.profile.http_service",["ringid.config"]).service("profileHttpService",profileHttpService),profileHttpService.$inject=["$$connector","OPERATION_TYPES","utilsFactory"]}(),function(){"use strict";angular.module("ringid.profile",["ringid.auth","ringid.profile.http_service","ringid.common.user_factory","ringid.friend.friends_factory","ringid.media","ui.bootstrap","ringid.common.services","angular-svg-round-progress"])}(),function(){"use strict";function rgImgReposition(imageQuality,fileUploadService,$document,APP_CONSTANTS,Ringalert){function linkFunc(scope,element,attrs){function toggleReposition(enable){enable||scope.enabled?(RingLogger.information("ENABLE REPOSITION",RingLogger.tags.PROFILE),element.bind("mousedown",mouseDown),element.bind("mouseup",mouseUp)):(RingLogger.information("DISABLE REPOSITION",RingLogger.tags.PROFILE),element.unbind("mousedown",mouseDown),element.unbind("mouseup",mouseUp)),scope.$rgDigest()}function mouseDown(e){scope.enabled&&(1===e.which&&(x0=e.clientX,y0=e.clientY,calculate=!0),element.bind("mousemove",mouseMove))}function mouseMove(e){var pos,x,y;scope.enabled&&calculate&&(pos=scope.elemStyle.backgroundPosition.match(/(-?\d+).*?\s(-?\d+)/)||[],x=e.clientX,y=e.clientY,xPos=parseInt(pos[1])||0,yPos=parseInt(pos[2])||0,xPos=limit(elementWidth-imageDimensions.width,0,xPos+x-x0,options.bound),yPos=limit(elementHeight-imageDimensions.height,0,yPos+y-y0,options.bound),element.css({backgroundPosition:xPos+"px "+yPos+"px"}))}function mouseUp(e){scope.enabled&&calculate&&(void 0!==xPos&&void 0!==yPos&&(scope.elemStyle.backgroundPosition=xPos+"px "+yPos+"px",fileUploadService.setReposition({cimX:Math.ceil(Math.abs(xPos)/repositionScale)||0,cimY:Math.ceil(Math.abs(yPos)/repositionScale)||0},scope.imgType)),calculate=!1,xPos=void 0,yPos=void 0,element.unbind("mousemove",mouseMove))}function setDimensions(){scope.toggleResizeShow()(scope.imgType,!1);var self=this;imageDimensions.width=self.width,imageDimensions.height=self.height,imageDimensions.width/cropWidth<=imageDimensions.height/cropHeight?(repositionScale=elementWidth/imageDimensions.width,imageDimensions.width=elementWidth,imageDimensions.height=Math.floor(imageDimensions.height*repositionScale),cropToImageRatio=self.width/cropWidth,fileUploadService.setReposition({
iw:Math.ceil(self.width),ih:Math.ceil(cropHeight*cropToImageRatio)},scope.imgType)):(repositionScale=elementHeight/imageDimensions.height,imageDimensions.height=elementHeight,imageDimensions.width=Math.floor(imageDimensions.width*repositionScale),cropToImageRatio=self.height/cropHeight,fileUploadService.setReposition({ih:Math.ceil(self.height),iw:Math.ceil(cropWidth*cropToImageRatio)},scope.imgType)),toggleReposition(!0)}var xPos,yPos,x0,y0,elementWidth=element[0].clientWidth,elementHeight=element[0].clientHeight,cropWidth="profilephoto"===scope.imgType?APP_CONSTANTS.PROFILE_PIC_CROP_WIDTH:APP_CONSTANTS.COVER_PIC_CROP_WIDTH,cropHeight="profilephoto"===scope.imgType?APP_CONSTANTS.PROFILE_PIC_CROP_WIDTH:APP_CONSTANTS.COVER_PIC_CROP_HEIGHT,cropToImageRatio=1,bgSrc="",repositionScale=1,calculate=!1,options={bound:!0},imageDimensions={width:0,height:0};if(scope.selectFromAlbum=fileUploadService.selectFromAlbum,"coverphoto"===scope.imgType){var adjustedHeight=Math.ceil(APP_CONSTANTS.COVER_PIC_CROP_HEIGHT*elementWidth/APP_CONSTANTS.COVER_PIC_CROP_WIDTH);scope.elemStyle.height=adjustedHeight+"px",elementHeight=adjustedHeight}scope.$watch("enabled",function(newVal,oldVal){newVal?scope.repositionExisting?imageQuality.resizeImage((scope.elemStyle.backgroundImage.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],scope.imgType).then(function(){checkImageDimensions()}):checkImageDimensions():toggleReposition(!1)});var checkImageDimensions=function(){var src=scope.elemStyle.backgroundImage;if(bgSrc=(src.match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1]){var image=new Image;image.onload=setDimensions,image.src=bgSrc}}}var limit=function(low,hi,value,bool){if(3===arguments.length||bool){if(low>value)return low;if(value>hi)return hi}return value};return{restrict:"A",replace:!1,scope:{elemStyle:"=",enabled:"=",imgType:"@",repositionExisting:"=",toggleResizeShow:"&"},link:linkFunc}}angular.module("ringid.profile").directive("rgImgReposition",rgImgReposition),rgImgReposition.$inject=["imageQuality","fileUploadService","$document","APP_CONSTANTS","Ringalert"]}(),function(){"use strict";function rgProfile(){function ProfileController($ringbox,$scope,Notification,Storage,friendsFactory,$routeParams,Auth,profileFactory,fileUploadService,imageQuality,ImageFactory,SystemEvents,utilsFactory,Ringalert,languageConstant,$rootScope){var newCoverpic,newPropic,uId=$routeParams.uId;$scope.isOwner=Auth.currentUser().getKey()===uId,$scope.consType=languageConstant.get(),$scope.profilePicDragEnable=!1,$scope.coverPicDragEnable=!1,$scope.processing=!1,$scope.profileDdControl={showOnHover:!0,enableCoverReposition:!0,enableProfileReposition:!0},$scope.showCoverDD=!1,$scope.coverPhotoStyle={backgroundSize:"cover"},$scope.profilePhotoStyle={backgroundSize:"cover"},$scope.link=utilsFactory.getRingRoute("USER_PROFILE",{uId:uId}),void 0===$routeParams.subpage?$scope.subPage="post":($scope.subPage=$routeParams.subpage,"about"===$scope.subPage&&($scope.activeNav="basic")),$scope.subPageLink="pages/profile/profile."+$scope.subPage+".html",$scope.profileObj=profileFactory.getProfile(uId),RingLogger.warning("got user utid: "+$scope.profileObj.getUtId(),RingLogger.tags.PROFILE),profileFactory.init($scope.profileObj).then(function(){updateStyle("coverphoto"),updateStyle("profilephoto")});var updateStyle=function(type){"profilephoto"===type?($scope.profilePhotoStyle.backgroundImage="url("+$scope.profileObj.avatar("thumb")+")",$scope.profilePhotoStyle.backgroundPosition="50% 50%",$scope.profilePhotoStyle.backgroundImage.indexOf("prof.png")>-1?$scope.profileDdControl.enableProfileReposition=!1:$scope.profileDdControl.enableProfileReposition=!0):($scope.coverPhotoStyle.backgroundImage="url("+$scope.profileObj.getCover()+")",$scope.coverPhotoStyle.backgroundPosition="0px 0px",$scope.coverPhotoStyle.backgroundImage.indexOf("default_cover")>-1?$scope.profileDdControl.enableCoverReposition=!1:$scope.profileDdControl.enableCoverReposition=!0),$scope.$rgDigest()};updateStyle("coverphoto"),updateStyle("profilephoto"),$scope.frndAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())},$scope.repositionExisting=!1,$scope.coverDdHtml="pages/dropdowns/coverphoto-dropdown.html",$scope.coverDdAction=function(actionObj){switch(actionObj.action){case"coverphoto":$scope.toggleResizeShow("coverphoto",!0),$scope.uploadAction(actionObj);break;case"toggleReposition":$scope.repositionExisting=!0,$scope.toggleResizeShow("coverphoto",!0),$scope.uploadAction({action:"coverphoto",uploadFile:fileUploadService.queueFile("coverphoto",$scope.profileObj.getCover("original"))});break;case"popupData":return fileUploadService.uploadType="coverphoto",function(){return{popupType:"coverphoto"}}}$scope.$rgDigest()},$scope.profileDdHtml="pages/dropdowns/profilephoto-dropdown.html",$scope.frndActionTemplate='<div class="action friend-settings-dropdown float-right"><a  ng-if="ddControl.friendshipStatus()==0 && !ddControl.isCurrentUser()" rg-click="ddAction()({ action: \'addfriend\', friend: ddControl})" href="#"><span class="icon-addf pro-f"></span><span class="txt">{{consType.add_friend}}</span></a><a  ng-if="ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unfriend\', friend: ddControl})" href="#"> <span class="icon-into-border f-Block"></span><span class="txt">{{consType.unfriend}}</span></a><a  ng-if="ddControl.friendshipStatus()==2" rg-click="ddAction()({ action: \'accept\', friend: ddControl})" href="#"><span class="icon-incoming pro-f"></span><span class="txt">{{consType.accept}}</span></a><a  ng-if="ddControl.friendshipStatus()==3" rg-click="ddAction()({ action: \'remove\', friend: ddControl})" href="#"><span class="icon-minus-cr f-14"></span><span class="txt">{{consType.remove}}</span></a><a  ng-if="ddControl.isBlocked()===0 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'block\', friend: ddControl})" class="border-0" href="#"><span class="icon-block"></span><span class="txt">{{consType.block}}</span></a><a  ng-if="ddControl.isBlocked()===1 && !ddControl.isCurrentUser() && ddControl.friendshipStatus()==1" rg-click="ddAction()({ action: \'unblock\', friend: ddControl})" class="border-0" href="#"><span class="icon-right f-Block"></span><span class="txt">{{consType.unblock}}</span></a></div>',$scope.profileDdAction=function(actionObj){switch(actionObj.action){case"profilephoto":$scope.toggleResizeShow("profilephoto",!0),$scope.uploadAction(actionObj);break;case"toggleReposition":$scope.toggleResizeShow("profilephoto",!0),$scope.repositionExisting=!0,$scope.uploadAction({action:"profilephoto",uploadFile:fileUploadService.queueFile("profilephoto",$scope.profileObj.avatar("original"))});break;case"popupData":return fileUploadService.uploadType="profilephoto",function(){return{popupType:"profilephoto"}}}$scope.$rgDigest()},$scope.toggleResizeShow=function(type,value){"coverphoto"===type?$scope.cvResizeProgressShow=value||!1:$scope.ppResizeProgressShow=value||!1,$scope.$rgDigest()},$scope.$on(SystemEvents.IMAGE.DO_REPOSITION,function(event,args){$scope.toggleResizeShow(fileUploadService.uploadType,!0),$scope.uploadAction({action:fileUploadService.uploadType,uploadFile:fileUploadService.queueFile(fileUploadService.uploadType,args.image)}),$ringbox.closeAll()}),$scope.uploadAction=function(actionObj){var fileToUpload;$scope.repositionExisting=!1,"coverphoto"===actionObj.action?(newCoverpic=actionObj.uploadFile,fileToUpload=newCoverpic):(newPropic=actionObj.uploadFile,fileToUpload=newPropic),fileToUpload&&($rootScope.$broadcast(SystemEvents.LOADING,!0),fileToUpload.fetchMeta(function(result){$rootScope.$broadcast(SystemEvents.LOADING,!1),result.success?"coverphoto"===actionObj.action?$scope.toggleCoverPhotoReposition(fileToUpload.getPreview()):$scope.toggleProfilePhotoReposition(fileToUpload.getPreview()):($scope.toggleResizeShow(actionObj.action,!1),Ringalert.show(result.message,"error")),$scope.$rgDigest()})),$scope.$rgDigest()},$scope.uploadPicture=function(type,event){var fileToUpload;"coverphoto"===type?($scope.cvUploadProgressShow=!0,$scope.coverPicDragEnable=!1,fileToUpload=newCoverpic):"profilephoto"===type&&($scope.ppUploadProgressShow=!0,$scope.profilePicDragEnable=!1,fileToUpload=newPropic),$rootScope.$broadcast(SystemEvents.LOADING,!0),fileToUpload.initUpload().then(function(response){$scope.cvUploadProgressShow=!1,$scope.ppUploadProgressShow=!1,response.sucs===!0?"profilephoto"===type?profileFactory.changeProfilePicture(response).then(function(){$rootScope.$broadcast(SystemEvents.LOADING,!1),$rootScope.$rgDigest(),updateStyle(type)}):"coverphoto"===type&&profileFactory.changeCoverPicture(response).then(function(){$rootScope.$broadcast(SystemEvents.LOADING,!1),$rootScope.$rgDigest(),updateStyle(type)}):(updateStyle(type),RingLogger.warning(response),$rootScope.$broadcast(SystemEvents.LOADING,!1))},function(errorData){RingLogger.warning(errorData),updateStyle(type)}),event&&event.stopPropagation(),$scope.$rgDigest()},$scope.toggleCoverPhotoReposition=function(src,event){var imageFile,originalSrc="",coverXY=$scope.profileObj.getCoverXY();$scope.coverPicDragEnable?($scope.coverPicDragEnable=!1,updateStyle("coverphoto")):(src?originalSrc=src:(src=$scope.profileObj.getCover(),imageFile=src.slice(src.lastIndexOf("/")+1,src.length),originalSrc=src.replace(imageFile,imageFile.replace("crp",""))),$scope.coverPhotoStyle.backgroundImage="url("+originalSrc+")",$scope.coverPhotoStyle.backgroundPosition=-coverXY.x+"px "+-coverXY.y+"px",$scope.coverPicDragEnable=!0,$scope.$rgDigest()),event&&event.stopPropagation()},$scope.$watch("profilePicDragEnable",function(newVal){newVal||$scope.ppUploadProgressShow||updateStyle("profilephoto")}),$scope.$watch("coverPicDragEnable",function(newVal){newVal||$scope.cvUploadProgressShow||updateStyle("coverphoto")}),$scope.toggleProfilePhotoReposition=function(src,event){var imageFile,prefix,originalSrc="";$scope.profilePicDragEnable?($scope.profilePicDragEnable=!1,updateStyle("profilephoto")):(src?originalSrc=src:(src=$scope.profileObj.avatar("original"),imageFile=src.slice(src.lastIndexOf("/")+1,src.length),originalSrc=src.replace(imageFile,imageFile.replace(prefix,""))),$scope.profilePhotoStyle.backgroundImage="url("+originalSrc+")",$scope.profilePhotoStyle.backgroundPosition="0px 0px",$scope.profilePicDragEnable=!0,$scope.$rgDigest()),event&&event.stopPropagation()},$scope.getImageData=function(imageId){return{data:function(){return{imgId:imageId}},promise:ImageFactory.getImageDetails(imageId)}},$scope.cvUploadProgressShow=!1,$scope.cvResizeProgressShow=!1,$scope.ppResizeProgressShow=!1,$scope.uploadStyle=function(){return{width:fileUploadService.progress+"%"}},$scope.roundProgressBarStyle={dataRoundProgressWidth:"200",dataRoundProgressHeight:"200",dataRoundProgressOuterCircleWidth:"4",dataRoundProgressInnerCircleWidth:"8",dataRoundProgressOuterCircleRadius:"85",dataRoundProgressInnerCircleRadius:"85",dataRoundProgressLabelFont:"24",dataRoundProgressOuterCircleBackgroundColor:"#fff",dataRoundProgressOuterCircleForegroundColor:"#f47727",dataRoundProgressInnerCircleColor:"#fff",dataRoundProgressLabelColor:"#fff"},$scope.ppUploadProgressShow=!1,$scope.uploadImageFileSize=function(){return fileUploadService.currentUploadImageSize},$scope.getRoundedProgressTextStyle=function(){return{top:"50%",bottom:"auto",left:"50%",transform:"translateY(-50%) translateX(-50%)","font-size":100/3.5+"px",position:"absolute"}},$scope.roundProgressData=function(){return{label:fileUploadService.progress+"%",percentage:fileUploadService.progress,dataLoaded:fileUploadService.dataLoaded}},$scope.openRingbox=function(type){return"cover"===type?!$scope.coverPicDragEnable&&!$scope.cvResizeProgressShow&&!$scope.cvUploadProgressShow&&$scope.profileDdControl.enableCoverReposition:!$scope.profilePicDragEnable&&!$scope.ppResizeProgressShow&&!$scope.ppUploadProgressShow&&$scope.profileDdControl.enableProfileReposition},$scope.$on(SystemEvents.FILE_UPLOAD.PROGRESS_UPDATE,function(){$scope.$rgDigest()}),$scope.showMenuItems=!1,$scope.toggleMenuItem=function(){$scope.showMenuItems=!$scope.showMenuItems,$scope.$rgDigest()},$scope.closeDropdown=function(){$scope.showMenuItems=!1,$scope.$rgDigest()},$scope.$on("$destroy",function(){RingLogger.warning("$scope destroy"),"about"===$routeParams.subPage&&profileFactory.removeProfileData($scope.profileObj.getUtId())})}ProfileController.$inject=["$ringbox","$scope","Notification","Storage","friendsFactory","$routeParams","Auth","profileFactory","fileUploadService","imageQuality","ImageFactory","SystemEvents","utilsFactory","Ringalert","languageConstant","$rootScope"];var linkFunc=function(scope,element){function handleMouse(event){scope.showCoverDD=!scope.showCoverDD,scope.$rgDigest()}element.on("mouseenter",handleMouse),element.on("mouseleave",handleMouse),scope.$on("$destroy",function(){element.off("mouseenter",handleMouse),element.off("mouseleave",handleMouse)})};return{restrict:"E",scope:!0,templateUrl:"pages/profile/profile-header.html",controller:ProfileController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfile",rgProfile)}(),function(){"use strict";function rgProfileBasic(){function ProfileBasicController(Storage,$scope,utilsFactory,profileFactory,Ringalert,$rootScope){function enableEditBasic(event){event.preventDefault(),$scope.tmpBasic=angular.copy($scope.profileObj.getBasicInfo()),1!==$scope.tmpBasic.mDay&&"1"!==$scope.tmpBasic.mDay||($scope.tmpBasic.marriageDay=null),1!==$scope.tmpBasic.birthDay&&"1"!==$scope.tmpBasic.birthDay||($scope.tmpBasic.birthday=null),$scope.isEditProfile=!0,$scope.$rgDigest()}function cancelUpdateMyBasicInfo(){$scope.isEditProfile=!1,$scope.$rgDigest()}function updateMyBasicInfo(){$scope.processing=!0;var mdateobj=$scope.tmpBasic.marriageDay;null==mdateobj&&(mdateobj=1);var dateobj,datetype=typeof $scope.tmpBasic.birthday,mdatetype=typeof mdateobj;if(RingLogger.print(datetype,RingLogger.tags.PROFILE),"string"===datetype){var data=$scope.tmpBasic.birthday.split("-"),bdDate=parseInt(data[0])+","+parseInt(data[1])+","+parseInt(data[2]);dateobj=new Date(bdDate)}else if(dateobj=$scope.tmpBasic.birthday,1!==$scope.tmpBasic.birthDay&&"1"!==$scope.tmpBasic.birthDay){var frTime=utilsFactory.profileVerbalDate($scope.tmpBasic.birthDay);$scope.tmpBasic.birthday=frTime}if("string"===mdatetype){var mdata=mdateobj.split("-"),mDate=parseInt(mdata[0])+","+parseInt(mdata[1])+","+parseInt(mdata[2]);mdateobj=new Date(mDate)}profileFactory.updateUserProfile($scope.uId,$scope.tmpBasic,dateobj,mdateobj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?($scope.tmpBasic.birthDay=dateobj?dateobj.getTime():"1","object"==typeof dateobj?$scope.currentUser.setBirthday($scope.tmpBasic.birthDay):$scope.currentUser.setBirthday("1"),"object"===mdatetype?$scope.currentUser.setMarriageday(mdateobj.getTime()):$scope.currentUser.setMarriageday("1"),$scope.profileObj.getBasicInfo().birthDay=$scope.tmpBasic.birthDay,$scope.currentUser.setName($scope.tmpBasic.fn),$scope.currentUser.setHomeCity($scope.tmpBasic.hc),$scope.currentUser.setCurrentCity($scope.tmpBasic.cc),$scope.currentUser.setAboutMe($scope.tmpBasic.am),Storage.updateLoginData("fn",$scope.tmpBasic.fn),$scope.currentUser.setGender($scope.tmpBasic.gr),Ringalert.show("Successfully updated","success"),$scope.isEditProfile=!1):($scope.isEditProfile=!1,Ringalert.show(data.mg,"error"),RingLogger.print("something went wrong",RingLogger.tags.PROFILE)),$scope.processing=!1,$rootScope.$rgDigest()})}$scope.isEditProfile=!1,$scope.processing=!1,$scope.enableEditBasic=enableEditBasic,$scope.updateMyBasicInfo=updateMyBasicInfo,$scope.cancelUpdateMyBasicInfo=cancelUpdateMyBasicInfo,$scope.isDatePickerOpen=!1,$scope.model={},$scope.open=function($event,elementOpened){switch(RingLogger.print(elementOpened,RingLogger.tags.PROFILE),$event.preventDefault(),$event.stopPropagation(),elementOpened){case"wcalendar":$scope.model.wcalendarTo=!1;break;case"wcalendarTo":$scope.model.wcalendar=!1;break;case"ecalendar":$scope.model.ecalendarTo=!1;break;case"ecalendarTo":$scope.model.ecalendar=!1;break;case"mcalendar":$scope.model.mcalendar=!1}$scope.model[elementOpened]=!$scope.model[elementOpened]},$scope.dateOptions={showWeeks:"false",startingDay:1};var today=new Date;today.setMonth(today.getMonth()+6),$scope.minDate=new Date,$scope.maxDate=new Date(today.getFullYear(),today.getMonth(),today.getDate())}return ProfileBasicController.$inject=["Storage","$scope","utilsFactory","profileFactory","Ringalert","$rootScope"],{restrict:"E",templateUrl:"pages/profile/profile.about-basic.html",controller:ProfileBasicController}}angular.module("ringid.profile").directive("rgProfileBasic",rgProfileBasic)}(),function(){"use strict";function rgProfilePrivacy(){function ProfilePrivacyController(Storage,rgDropdownService,$timeout,$scope,utilsFactory,friendsFactory,profileFactory,languageConstant){function enablePrivacyEditMode($event){$event.preventDefault(),$scope.isEditProfilePrivacy=!0,$scope.$rgDigest()}function savePvcEdit(fPrivacyInfo){var callobj;$scope.isEditProfilePrivacy=!1,callobj=$scope.profileObj.isCurrentUser()?{actn:216,sv:fPrivacyInfo.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:fPrivacyInfo.callPrivacy,sn:6,utId:$scope.profileObj.getUtId(),isCurrent:!1},$scope.fPrivacyInfo.callPrivacy=fPrivacyInfo.callPrivacy,$timeout(function(){profileFactory.saveCallPvcEdit(callobj).then(function(data){data.sucs===!0?$scope.fPrivacyInfo.callPrivacy=fPrivacyInfo.callPrivacy:$scope.fPrivacyInfo.callPrivacy=0})},100);var chatobj;chatobj=$scope.profileObj.isCurrentUser()?{actn:216,sv:fPrivacyInfo.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:fPrivacyInfo.chatPrivacy,sn:7,utId:$scope.profileObj.getUtId(),isCurrent:!1},$scope.fPrivacyInfo.chatPrivacy=fPrivacyInfo.chatPrivacy,$timeout(function(){profileFactory.saveChatPvcEdit(chatobj).then(function(data){data.sucs===!0?$scope.fPrivacyInfo.chatPrivacy=fPrivacyInfo.chatPrivacy:$scope.fPrivacyInfo.chatPrivacy=0})},200);var feedObj;feedObj=$scope.profileObj.isCurrentUser()?{actn:216,sv:fPrivacyInfo.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:fPrivacyInfo.feedPrivacy,sn:8,utId:$scope.profileObj.getUtId(),isCurrent:!1},$scope.fPrivacyInfo.feedPrivacy=fPrivacyInfo.feedPrivacy,$timeout(function(){profileFactory.saveFeedPvcEdit(feedObj).then(function(data){data.sucs===!0?$scope.fPrivacyInfo.feedPrivacy=fPrivacyInfo.feedPrivacy:$scope.fPrivacyInfo.feedPrivacy=0})},300),$scope.$rgDigest()}function cancelPvcEdit(){$scope.isEditProfilePrivacy=!1,$scope.$rgDigest()}$scope.isEditProfilePrivacy=!1,$scope.callPvcEdit=!1,$scope.chatPvcEdit=!1,$scope.feedPvcEdit=!1,$scope.fPrivacyInfo={callPrivacy:0,chatPrivacy:0,feedPrivacy:0},$scope.enablePrivacyEditMode=enablePrivacyEditMode,$scope.savePvcEdit=savePvcEdit,$scope.cancelPvcEdit=cancelPvcEdit,$scope.profileObj.isCurrentUser()?profileFactory.verifyCheck().then(function(data){data.sucs===!0&&($scope.fPrivacyInfo.callPrivacy=data.cla,$scope.fPrivacyInfo.chatPrivacy=data.chta,$scope.fPrivacyInfo.feedPrivacy=data.fda),$scope.$rgDigest()}):($scope.access=$scope.profileObj.getAccess,$scope.fPrivacyInfo.callPrivacy=$scope.profileObj.getAccess().cla,$scope.fPrivacyInfo.chatPrivacy=$scope.profileObj.getAccess().chta,$scope.fPrivacyInfo.feedPrivacy=$scope.profileObj.getAccess().fda,$scope.fPrivacyInfo.callPrivacy||$scope.fPrivacyInfo.chatPrivacy||$scope.fPrivacyInfo.feedPrivacy||$scope.profileObj.setBlock(1),$scope.$rgDigest())}ProfilePrivacyController.$inject=["Storage","rgDropdownService","$timeout","$scope","utilsFactory","friendsFactory","profileFactory","languageConstant"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-privacy.html",controller:ProfilePrivacyController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfilePrivacy",rgProfilePrivacy)}(),function(){"use strict";function rgProfileEducation(){function ProfileEducationController(Ringalert,$scope,utilsFactory,profileFactory,$routeParams,rgDropdownService){function addNewEducation(){tmpEducation&&($scope.educationlist[contentIndex]=tmpEducation),$scope.isEditEducation=-1,$scope.eduObjInfo.scl="",$scope.eduObjInfo.dgr="",$scope.eduObjInfo.cntn="",$scope.eduObjInfo.toTimeE="",$scope.eduObjInfo.fromTimeE="",$scope.isaddNewEducation=!0,$scope.$rgDigest()}function enableEducationEditMode(index,object){contentIndex=index,$scope.eduObjInfo=$scope.educationlist[index],tmpEducation=angular.copy($scope.educationlist[index]),1===$scope.eduObjInfo.tt&&($scope.eduObjInfo.toTimeE=null),1===$scope.eduObjInfo.ft&&($scope.eduObjInfo.fromTimeE=null),$scope.isaddNewEducation=!1,$scope.isEditEducation=index,$scope.$rgDigest()}function cancelAddEducation(){tmpEducation&&($scope.educationlist[contentIndex]=tmpEducation),$scope.isaddNewEducation=!1,$scope.isEditEducation=-1,$scope.$rgDigest()}function cancelUpdateEducation(){$scope.educationlist[contentIndex]=tmpEducation,$scope.isEditEducation=-1,$scope.$rgDigest()}function updateEducation(){$scope.eduObjInfo.scl||($scope.edusclerror=!0,$scope.$rgDigest()),$scope.eduObjInfo.dgr||($scope.edudgrerror=!0,$scope.$rgDigest()),$scope.eduObjInfo.cntn||($scope.educntnerror=!0,$scope.$rgDigest()),$scope.edusclerror||$scope.edudgrerror||$scope.educntnerror||($scope.processing=!0,$scope.eduObjInfo.fromTimeE?$scope.eduObjInfo.ft=new Date($scope.eduObjInfo.fromTimeE).getTime():$scope.eduObjInfo.ft=1,$scope.eduObjInfo.toTimeE?$scope.eduObjInfo.tt=new Date($scope.eduObjInfo.toTimeE).getTime():$scope.eduObjInfo.tt=1,profileFactory.updateEducation($scope.eduObjInfo).then(function(json){json.sucs===!0?($scope.eduObjInfo.fromTimeE?$scope.eduObjInfo.fromTimeE=utilsFactory.profileVerbalDate($scope.eduObjInfo.ft):($scope.eduObjInfo.ft=1,$scope.eduObjInfo.fromTimeE=""),$scope.eduObjInfo.toTimeE?$scope.eduObjInfo.toTimeE=utilsFactory.profileVerbalDate($scope.eduObjInfo.tt):($scope.eduObjInfo.tt=1,$scope.eduObjInfo.toTimeE=""),$scope.isEditEducation=-1,Ringalert.show("Successfully updated","success")):($scope.isEditEducation=-1,Ringalert.show("Request did not process successfully","error"),RingLogger.print(json,RingLogger.tags.PROFILE)),$scope.processing=!1,$scope.$rgDigest()}))}function submitNewEducation(){$scope.eduObjInfo.scl||($scope.edusclerror=!0,$scope.$rgDigest()),$scope.eduObjInfo.dgr||($scope.edudgrerror=!0,$scope.$rgDigest()),$scope.eduObjInfo.cntn||($scope.educntnerror=!0,$scope.$rgDigest()),$scope.edusclerror||$scope.edudgrerror||$scope.educntnerror||($scope.processing=!0,$scope.eduObjInfo.fromTimeE?$scope.eduObjInfo.ft=new Date(utilsFactory.profileVerbalDate($scope.eduObjInfo.fromTimeE)).getTime():$scope.eduObjInfo.ft=1,$scope.eduObjInfo.toTimeE?$scope.eduObjInfo.tt=new Date(utilsFactory.profileVerbalDate($scope.eduObjInfo.toTimeE)).getTime():$scope.eduObjInfo.tt=1,$scope.eduObjInfo.ut=(new Date).getTime(),$scope.eduObjInfo.af=1,$scope.eduObjInfo.grtd=!1,$scope.eduObjInfo.iss=!0,profileFactory.submitNewEducation($scope.eduObjInfo).then(function(json){if(json.sucs===!0){$scope.eduObjInfo.id=json.id;var obj=angular.copy($scope.eduObjInfo);profileFactory.setProfileData("educationList",obj,$scope.profileObj.getUtId()),Ringalert.show("Education info added successfully","success"),$scope.isaddNewEducation=!1,$scope.isEditEducation=-1}else Ringalert.show("Request did not process successfully","error"),$scope.isaddNewEducation=!1,$scope.isEditEducation=-1;$scope.isaddNewEducation=!1,$scope.isEditEducation=-1,$scope.processing=!1,$scope.$rgDigest()}))}function deleteEducation(index){var eduId=$scope.getProfileData("educationList",$scope.profileObj.getUtId())[index].id;$scope.isEditEducation=-1,profileFactory.deleteEducation(eduId).then(function(data){data.sucs===!0?($scope.getProfileData("educationList",$scope.profileObj.getUtId()).splice(index,1),Ringalert.show("Successfully deleted","success")):Ringalert.show("Request did not process successfully","error"),$scope.$rgDigest()})}var tmpEducation,contentIndex;$scope.profileObj.isCurrentUser()?$scope.isOwner=!0:$scope.isOwner=!1;profileFactory.getUserProfileData({uId:$routeParams.uId},$scope.profileObj.isCurrentUser()),$scope.getProfileData=profileFactory.getProfileData,$scope.educationlist=$scope.getProfileData("educationList",$scope.profileObj.getUtId()),$scope.edusclerror=!1,$scope.edudgrerror=!1,$scope.educntnerror=!1,$scope.$watch("eduObjInfo.scl",function(newval,oldval){newval&&($scope.edusclerror=!1)}),$scope.$watch("eduObjInfo.dgr",function(newval,oldval){newval&&($scope.edudgrerror=!1)}),$scope.$watch("eduObjInfo.cntn",function(newval,oldval){newval&&($scope.educntnerror=!1)}),$scope.ddActionHtml="pages/dropdowns/action-dropdown.html",$scope.actionEduDropdown=function(actionObj){switch(actionObj.event.preventDefault(),rgDropdownService.close(),actionObj.action){case"edit":enableEducationEditMode(actionObj.data.index,actionObj.data.obj);break;case"delete":deleteEducation(actionObj.data.index)}},$scope.isaddNewEducation=!1,$scope.isEditEducation=-1,$scope.eduObjInfo={},$scope.addNewEducation=addNewEducation,$scope.submitNewEducation=submitNewEducation,$scope.updateEducation=updateEducation,$scope.cancelAddEducation=cancelAddEducation,$scope.cancelUpdateEducation=cancelUpdateEducation,$scope.$on("$destroy",function(){})}ProfileEducationController.$inject=["Ringalert","$scope","utilsFactory","profileFactory","$routeParams","rgDropdownService"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-education.html",controller:ProfileEducationController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfileEducation",rgProfileEducation)}(),function(){"use strict";function rgProfileWork(){function ProfileWorkController($scope,utilsFactory,profileFactory,$routeParams,rgDropdownService,Ringalert){function addNewWork(){tmpWork&&($scope.worklist[contentIndex]=tmpWork),$scope.isEditWork=-1,$scope.workObjInfo.cnm="",$scope.workObjInfo.pstn="",$scope.workObjInfo.desc="",$scope.workObjInfo.fromTimeE="",$scope.workObjInfo.toTimeE="",$scope.workObjInfo.ft="",$scope.workObjInfo.tt="",$scope.isAddNewWork=!0,$scope.$rgDigest()}function cancelNewWork(){tmpWork&&($scope.worklist[contentIndex]=tmpWork),$scope.isAddNewWork=!1,$scope.$rgDigest()}function submitNewWork(){$scope.workObjInfo.cnm||($scope.workcnmerror=!0,$scope.$rgDigest()),$scope.workObjInfo.pstn||($scope.workpstnerror=!0,$scope.$rgDigest()),$scope.workcnmerror||$scope.workpstnerror||($scope.processing=!0,$scope.workObjInfo.status===!0?($scope.workObjInfo.tt="0",$scope.workObjInfo.status=!0,$scope.workObjInfo.date_info="Present"):$scope.workObjInfo.toTimeE?$scope.workObjInfo.tt=new Date($scope.workObjInfo.toTimeE).getTime():$scope.workObjInfo.tt=1,$scope.workObjInfo.fromTimeE?$scope.workObjInfo.ft=new Date($scope.workObjInfo.fromTimeE).getTime():$scope.workObjInfo.ft=1,profileFactory.submitNewWork($scope.workObjInfo).then(function(data){if(data.sucs===!0){$scope.workObjInfo.id=data.id,$scope.workObjInfo.ft?$scope.workObjInfo.fromTimeE=utilsFactory.profileVerbalDate($scope.workObjInfo.ft):$scope.workObjInfo.ft=1,$scope.workObjInfo.tt?$scope.workObjInfo.toTimeE=utilsFactory.profileVerbalDate($scope.workObjInfo.tt):$scope.workObjInfo.tt=1;var obj=angular.copy($scope.workObjInfo);profileFactory.setProfileData("workList",obj,$scope.profileObj.getUtId()),Ringalert.show("Career info added successfully","success"),$scope.isAddNewWork=!1,$scope.isEditWork=-1}else Ringalert.show("Request did not process successfully","error"),$scope.isAddNewWork=!1,$scope.isEditWork=-1;$scope.processing=!1,$scope.$rgDigest()}))}function actionWorkDropdown(actionObj){switch(actionObj.event.preventDefault(),actionObj.action){case"edit":enableWorkEditMode(actionObj.data.index),rgDropdownService.close();break;case"delete":deleteWork(actionObj.data.index),rgDropdownService.close()}}function enableWorkEditMode(index){contentIndex=index,$scope.workObjInfo=$scope.worklist[index],tmpWork=angular.copy($scope.worklist[index]),1!==$scope.workObjInfo.tt&&"0"!==$scope.workObjInfo.tt&&0!==$scope.workObjInfo.tt||($scope.workObjInfo.toTimeE=null),1===$scope.workObjInfo.ft&&($scope.workObjInfo.fromTimeE=null),$scope.isAddNewWork=!1,$scope.isEditWork=index,$scope.$rgDigest()}function updateWork(){$scope.workObjInfo.cnm||($scope.workcnmerror=!0,$scope.$rgDigest()),$scope.workObjInfo.pstn||($scope.workpstnerror=!0,$scope.$rgDigest()),$scope.workcnmerror||$scope.workpstnerror||($scope.processing=!0,$scope.workObjInfo.fromTimeE?$scope.workObjInfo.ft=new Date($scope.workObjInfo.fromTimeE).getTime():$scope.workObjInfo.ft=1,$scope.workObjInfo.toTimeE?$scope.workObjInfo.tt=new Date($scope.workObjInfo.toTimeE).getTime():$scope.workObjInfo.tt=1,$scope.workObjInfo.status===!0&&($scope.workObjInfo.tt="0",$scope.workObjInfo.status=!0,$scope.workObjInfo.date_info="Present"),profileFactory.updateWork($scope.workObjInfo).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?($scope.workObjInfo.ft?$scope.workObjInfo.fromTimeE=utilsFactory.profileVerbalDate($scope.workObjInfo.ft):$scope.workObjInfo.ft=1,$scope.workObjInfo.tt?$scope.workObjInfo.toTimeE=utilsFactory.profileVerbalDate($scope.workObjInfo.tt):$scope.workObjInfo.tt=1,$scope.workObjInfo.status===!0&&($scope.workObjInfo.tt=0,$scope.date_info="Present"),Ringalert.show("Updated successfully","success"),$scope.isEditWork=-1):($scope.isEditWork=-1,Ringalert.show("Request did not process successfully","error")),$scope.processing=!1,$scope.$rgDigest()}))}function cancelUpdateWork(){$scope.worklist[contentIndex]=tmpWork,$scope.isEditWork=-1,$scope.$rgDigest()}function deleteWork(index){$scope.isEditWork=-1;var workId=$scope.getProfileData("workList",$scope.profileObj.getUtId())[index].id;profileFactory.deleteWork(workId).then(function(data){data.sucs===!0?($scope.getProfileData("workList",$scope.profileObj.getUtId()).splice(index,1),Ringalert.show("Successfully deleted","success")):Ringalert.show("Request did not process successfully","error"),$scope.$rgDigest()})}$scope.profileObj.isCurrentUser()?$scope.isOwner=!0:$scope.isOwner=!1,profileFactory.getUserProfileData({uId:$routeParams.uId},$scope.profileObj.isCurrentUser()),$scope.getProfileData=profileFactory.getProfileData,$scope.worklist=$scope.getProfileData("workList",$scope.profileObj.getUtId()),$scope.ddActionHtml="pages/dropdowns/action-dropdown.html",$scope.actionWorkDropdown=actionWorkDropdown,$scope.isAddNewWork=!1,$scope.isEditWork=-1,$scope.workObjInfo={};var tmpWork,contentIndex;$scope.addNewWork=addNewWork,$scope.cancelNewWork=cancelNewWork,$scope.submitNewWork=submitNewWork,$scope.cancelUpdateWork=cancelUpdateWork,$scope.updateWork=updateWork,$scope.workcnmerror=!1,$scope.workpstnerror=!1,$scope.$watch("workObjInfo.cnm",function(newval,oldval){newval&&($scope.workcnmerror=!1)}),$scope.$watch("workObjInfo.pstn",function(newval,oldval){newval&&($scope.workpstnerror=!1)}),$scope.$on("$destroy",function(){})}ProfileWorkController.$inject=["$scope","utilsFactory","profileFactory","$routeParams","rgDropdownService","Ringalert"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-work.html",controller:ProfileWorkController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfileWork",rgProfileWork)}(),function(){"use strict";function rgProfileSkill(){function ProfileSkillController($scope,profileFactory,$routeParams,rgDropdownService,Ringalert){function addNewSkill(){tmpSkill&&($scope.skilllist[contentIndex]=tmpSkill),$scope.isEditSkill=-1,$scope.skillObjInfo.skl="",$scope.skillObjInfo.desc="",$scope.isAddNewSkill=!0,$scope.$rgDigest()}function submitNewSkill(){$scope.skillObjInfo.desc||($scope.skilldescerror=!0,$scope.$rgDigest()),$scope.skillObjInfo.skl||($scope.skillsklerror=!0,$scope.$rgDigest()),$scope.skillsklerror||$scope.skilldescerror||($scope.processing=!0,profileFactory.submitNewSkill($scope.skillObjInfo).then(function(data){var obj;data.sucs===!0?($scope.skillObjInfo.id=data.id,
obj=angular.copy($scope.skillObjInfo),profileFactory.setProfileData("skillList",obj,$scope.profileObj.getUtId()),Ringalert.show("Skill info added successfully","success"),$scope.isAddNewSkill=!1):($scope.isAddNewSkill=!1,Ringalert.show("Request did not process successfully","error")),$scope.processing=!1,$scope.$rgDigest()}))}function cancelNewSkill(){tmpSkill&&($scope.skilllist[contentIndex]=tmpSkill),$scope.isAddNewSkill=!1,$scope.$rgDigest()}function updateSkill(){$scope.skillObjInfo.desc||($scope.skilldescerror=!0,$scope.$rgDigest()),$scope.skillObjInfo.skl||($scope.skillsklerror=!0,$scope.$rgDigest()),$scope.skillsklerror||$scope.skilldescerror||($scope.processing=!0,profileFactory.updateSkill($scope.skillObjInfo).then(function(data){data.sucs===!0?($scope.isEditSkill=-1,Ringalert.show("Successfully updated","success")):($scope.isEditSkill=-1,Ringalert.show("Request did not process successfully","error")),$scope.processing=!1,$scope.$rgDigest()}))}function deleteSkill(index){var sid=$scope.getProfileData("skillList",$scope.profileObj.getUtId())[index].id;$scope.isEditSkill=-1,profileFactory.deleteSkill(sid).then(function(data){data.sucs===!0?($scope.getProfileData("skillList",$scope.profileObj.getUtId()).splice(index,1),Ringalert.show("Successfully deleted","success")):Ringalert.show("Request did not process successfully","error"),$scope.$rgDigest()})}function enableSkillEditMode(index){contentIndex=index,$scope.skillObjInfo=$scope.skilllist[index],tmpSkill=angular.copy($scope.skilllist[index]),$scope.isAddNewSkill=!1,$scope.isEditSkill=index,$scope.$rgDigest()}function cancelUpdateSkill(){$scope.skilllist[contentIndex]=tmpSkill,$scope.isEditSkill=-1,$scope.$rgDigest()}$scope.profileObj.isCurrentUser()?$scope.isOwner=!0:$scope.isOwner=!1,$scope.skillsklerror=!1,$scope.skilldescerror=!1,$scope.$watch("skillObjInfo.skl",function(newval,oldval){newval&&($scope.skillsklerror=!1)}),$scope.$watch("skillObjInfo.desc",function(newval,oldval){newval&&($scope.skilldescerror=!1)}),profileFactory.getUserProfileData({uId:$routeParams.uId},$scope.profileObj.isCurrentUser()),$scope.getProfileData=profileFactory.getProfileData,$scope.skilllist=$scope.getProfileData("skillList",$scope.profileObj.getUtId());var tmpSkill,contentIndex;$scope.addNewSkill=addNewSkill,$scope.submitNewSkill=submitNewSkill,$scope.cancelNewSkill=cancelNewSkill,$scope.updateSkill=updateSkill,$scope.cancelUpdateSkill=cancelUpdateSkill,$scope.skillObjInfo={},$scope.ddActionHtml="pages/dropdowns/action-dropdown.html",$scope.actionSkillDropdown=function(actionObj){switch(actionObj.event.preventDefault(),actionObj.action){case"edit":enableSkillEditMode(actionObj.data.index),rgDropdownService.close();break;case"delete":deleteSkill(actionObj.data.index),rgDropdownService.close()}},$scope.isAddNewSkill=!1,$scope.$on("$destroy",function(){})}ProfileSkillController.$inject=["$scope","profileFactory","$routeParams","rgDropdownService","Ringalert"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-skill.html",controller:ProfileSkillController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfileSkill",rgProfileSkill)}(),function(){"use strict";function rgProfilePassword(){function ProfilePasswordController($scope,Ringalert,profileFactory){function enablePassEdit(event){event.preventDefault(),$scope.showPassEdit===!1&&($scope.showPassEdit=!0,$scope.showMessage=!1),$scope.$rgDigest()}function cancelUpdatePassword(){$scope.showPassEdit=!1,$scope.showMessage=!0,$scope.$rgDigest()}function updatePassword(obj){obj.newpassword!=obj.repassword?$scope.IsMatch=!0:obj.newpassword==obj.repassword&&($scope.IsMatch=!1,$scope.oldError=!1,profileFactory.changePassword(obj.oldpassword,obj.newpassword).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?(obj={oldpassword:"",newpassword:"",repassword:""},$scope.showPassEdit=!1,$scope.showMessage=!0,Ringalert.show("Password Changed Successfully","info")):Ringalert.show(data.mg,"info")},function(data){$scope.oldError=!0})),$scope.$rgDigest()}$scope.enablePassEdit=enablePassEdit,$scope.updatePassword=updatePassword,$scope.cancelUpdatePassword=cancelUpdatePassword,$scope.showMessage=!0,$scope.showPassEdit=!1,$scope.IsMatch=!1,$scope.oldError=!1}ProfilePasswordController.$inject=["$scope","Ringalert","profileFactory"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-password.html",controller:ProfilePasswordController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfilePassword",rgProfilePassword)}(),function(){"use strict";function rgProfileRecovery(){function ProfileRecoveryController(rgDropdownService,countryListService,$scope,Ringalert,profileFactory,$routeParams,Auth){function setPrefix(actionObj){actionObj.event.preventDefault(),$scope.phone.countryCode=actionObj.item.code,$scope.countryFlag=actionObj.item.flagcode,rgDropdownService.close()}function addEmail(){$scope.isAddEmail=!0,$scope.showAddEmailButton=!1,$scope.$rgDigest()}function addPhone(){$scope.isAddPhone=!0,$scope.showAddPhoneButton=!1,$scope.$rgDigest()}function cancelAddEmail(){$scope.isAddEmail=!1,$scope.showAddEmailButton=!0,$scope.$rgDigest()}function cancelAddPhone(){$scope.isAddPhone=!1,$scope.showAddPhoneButton=!0,$scope.$rgDigest()}function sendCode(email){profileFactory.sendCode(email).then(function(data){data.sucs===!0?(verifyEmail=data.el,$scope.isAddEmail=!1,$scope.isAddCode=!0,$scope.vemail="",$scope.emailVerified=!1,$scope.emailTitle="Click here to verify your Email",email.email=""):Ringalert.show(data.mg,"info"),$scope.$rgDigest()})}function sendCodeToPhn(phone){var theNumber="";theNumber="+880"===phone.countryCode&&"0"===phone.phone.charAt(0)?phone.phone.substr(1):phone.phone,$scope.phone.phone=theNumber,profileFactory.sendCodeToPhn($scope.phone).then(function(data){data.sucs===!0?($scope.phoneNumber=data.mbl,mblDc=data.mblDc,$scope.isAddPhone=!1,$scope.isAddPhnCode=!0,$scope.phoneVerified=!1,$scope.phoneTitle="Click here to verify your Phone",phone.phone="",Ringalert.show(data.mg,"info")):Ringalert.show(data.mg,"info"),$scope.$rgDigest()})}function verifyCode(obj){obj.email=verifyEmail,profileFactory.verifyCode(obj).then(function(data){data.sucs===!0?($scope.isAddEmail=!1,$scope.isAddCode=!1,$scope.showAddEmailButton=!0,$scope.emailVerified=!0,$scope.emailValue="Verified Email",$scope.emailTitle="Your Email is verified.",$scope.vemail=data.el,obj.code="",obj.email="",Ringalert.show(data.mg,"success")):($scope.isAddEmail=!1,$scope.isAddCode=!1,$scope.showAddEmailButton=!0,$scope.emailVerified=!1,$scope.vemail="",Ringalert.show(data.mg,"info")),$scope.$rgDigest()})}function verifyPhoneCode(obj){var phnObj={};phnObj.phone=$scope.phoneNumber,phnObj.uId=uid,phnObj.mblDc=mblDc,phnObj.code=obj.code,profileFactory.verifyPhnCode(phnObj).then(function(data){data.sucs===!0?($scope.isAddPhone=!1,$scope.isAddPhnCode=!1,$scope.showAddPhoneButton=!0,$scope.phoneVerified=!0,$scope.phoneValue="Verified Phone",$scope.phoneTitle="Your Phone is verified.",obj.code="",Ringalert.show(data.mg,"success")):($scope.isAddPhone=!1,$scope.isAddPhnCode=!1,$scope.showAddPhoneButton=!0,$scope.phoneVerified=!1,Ringalert.show(data.mg,"info")),$scope.$rgDigest()})}$scope.emailVerified=!1,$scope.phoneVerified=!1,$scope.countryList={},$scope.isAddEmail=!1,$scope.isAddPhone=!1,$scope.addEmail=addEmail,$scope.addPhone=addPhone,$scope.isAddCode=!1,$scope.showAddEmailButton=!0,$scope.showAddPhoneButton=!0,$scope.cancelAddEmail=cancelAddEmail,$scope.cancelAddPhone=cancelAddPhone,$scope.sendCode=sendCode,$scope.sendCodeToPhn=sendCodeToPhn,$scope.verifyCode=verifyCode,$scope.verifyPhoneCode=verifyPhoneCode;var verifyEmail,mblDc,uid=$routeParams.uId;$scope.emailValue="Verify Email",$scope.emailTitle="Click here to verify your Email",$scope.phoneValue="Verify Phone",$scope.phoneTitle="Click here to verify your Phone";var countryList=[];$scope.ddTemplate='<div class="country-wrapper" ><ul id="countrylist" class="ringdropdown" rg-scrollbar="scrollbar()"><div class="count-s"><input type="text" ng-model="countryName" placeholder="Search Country"></div><a ng-repeat="item in ddControl.countryList() | filter:countryName" ><li class="flag {{item.flagcode}}" ng-click="ddAction()({event: $event, item: item})" > <span> {{ item.country }}</span></li></a></ul></div>',$scope.ddControl={countryList:function(){return countryList}},$scope.phone={countryCode:Auth.getCountry().login_type},$scope.countryFlag=Auth.getCountry().countryFlag,$scope.setPrefix=setPrefix,countryListService.getList().success(function(data){countryList=data,$scope.$rgDigest()}),profileFactory.verifyCheck().then(function(data){data.sucs===!0&&($scope.emailVerified=data.iev,$scope.phoneVerified=data.imnv,$scope.vemail=data.el,$scope.vnumber=data.mblDc+data.mbl,$scope.emailVerified&&($scope.emailValue="Verified Email",$scope.emailTitle="Your Email is verified."),$scope.phoneVerified&&($scope.phoneValue="Verified Phone",$scope.phoneTitle="Your Phone is verified.")),$scope.$rgDigest()}),$scope.cancelVerification=function(){$scope.isAddCode=!1,$scope.isAddPhnCode=!1,$scope.showAddEmailButton=!0,$scope.showAddPhoneButton=!0,$scope.$rgDigest()},$scope.resendCodeToMail=function(){profileFactory.sendCode({email:verifyEmail}).then(function(data){data.sucs===!0?(verifyEmail=data.el,Ringalert.show(data.mg,"info")):Ringalert.show(data.mg,"info"),$scope.$rgDigest()})},$scope.resendCodeToPhone=function(){profileFactory.sendCodeToPhn({phone:$scope.phoneNumber,countryCode:mblDc}).then(function(data){data.sucs===!0?($scope.phoneNumber=data.mbl,mblDc=data.mblDc,Ringalert.show(data.mg,"info")):Ringalert.show(data.mg,"info"),$scope.$rgDigest()})}}ProfileRecoveryController.$inject=["rgDropdownService","countryListService","$scope","Ringalert","profileFactory","$routeParams","Auth"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-recovery.html",controller:ProfileRecoveryController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfileRecovery",rgProfileRecovery)}(),function(){"use strict";function rgProfileAchat(){function ProfileAchatController($scope,profileFactory,Auth){function enableAchatEditMode($event){$event.preventDefault(),$scope.isEditAchat=!0,$scope.$rgDigest()}function saveAchatSettings(chatsettings){$scope.isEditAchat=!1;var achatobj;$scope.profileObj.isCurrentUser()&&(achatobj={sv:chatsettings.achat,sn:10}),$scope.chatsettings.achat=chatsettings.achat,profileFactory.saveAchatSetting(achatobj).then(function(data){data.sucs===!0?($scope.chatsettings.achat=chatsettings.achat,Auth.setAchatPermission(chatsettings.achat)):$scope.chatsettings.achat=0}),$scope.$rgDigest()}function cancelAchatSettings(){$scope.isEditAchat=!1,$scope.$rgDigest()}$scope.isEditAchat=!1,$scope.chatsettings={achat:Auth.getPermission().ancht},$scope.enableAchatEditMode=enableAchatEditMode,$scope.saveAchatSettings=saveAchatSettings,$scope.cancelAchatSettings=cancelAchatSettings}ProfileAchatController.$inject=["$scope","profileFactory","Auth"];var linkFunc=function(){};return{restrict:"E",templateUrl:"pages/profile/profile.about-achat.html",controller:ProfileAchatController,link:linkFunc}}angular.module("ringid.profile").directive("rgProfileAchat",rgProfileAchat)}(),function(){"use strict";angular.module("ringid.profile").directive("rgRelocateTemplate",function(){return{restrict:"E",template:'<ng-include src="template"></ng-include>',link:function(scope,elem,attr){var twocol=attr.twocol,threecol=attr.threecol;scope.template=threecol,window.innerWidth>1800||window.innerWidth<1200&&scope.template!=threecol?scope.template=threecol:window.innerWidth>1200&&window.innerWidth<1800&&scope.template!=twocol&&(scope.template=twocol),window.onresize=function(){window.innerWidth>1800||window.innerWidth<1200&&scope.template!=threecol?(scope.template=threecol,scope.$apply()):window.innerWidth>1200&&window.innerWidth<1800&&scope.template!=twocol&&(scope.template=twocol,scope.$apply())}}}})}(),function(){"use strict";function profileFactory($routeParams,Storage,Auth,$$connector,$q,Ringalert,profileHttpService,userFactory,OPERATION_TYPES,fileUploadService,utilsFactory){function _addEducation(education,utId){var educationObj=education;educationObj.fromTime=new Date(educationObj.ft),educationObj.toTime=new Date(educationObj.tt),educationObj.fromTimeE=utilsFactory.profileVerbalDate(educationObj.ft),educationObj.toTimeE=utilsFactory.profileVerbalDate(educationObj.tt),_profileData[utId].educationList.push(educationObj)}function _addWork(work,utId){var workObj=work;workObj.fromTime=new Date(workObj.ft),workObj.toTime=new Date(workObj.tt),0===workObj.tt?(workObj.status=!0,workObj.date_info="Present"):workObj.toTimeE=utilsFactory.profileVerbalDate(workObj.tt),workObj.fromTimeE=utilsFactory.profileVerbalDate(workObj.ft),_profileData[utId].workList.push(workObj)}function _addSkill(skill,utId){var skillObj=skill;_profileData[utId].skillList.push(skillObj)}function _setProfileData(type,data,utId){if(_profileData.hasOwnProperty(utId))switch(type){case"educationList":_addEducation(data,utId);break;case"workList":_addWork(data,utId);break;case"skillList":_addSkill(data,utId);break;default:RingLogger.warning("could not decide what PROFILE DATA to set",RingLogger.tags.PROFILE)}}function _getProfileData(whatData,utId){return _profileData.hasOwnProperty(utId)?_profileData[utId][whatData]:[]}function _removeProfileData(utId){delete _profileData[utId]}function getProfile(uId){return _profile||(_profile=Auth.currentUser()),uId===_profile.getKey()?_profile:_otherProfile=userFactory.create({uId:uId})}function init(user){var defer=$q.defer();return profileHttpService.basicAndPrivacy(user.getUtId(),user.isCurrentUser()).then(function(response){RingLogger.information(response,RingLogger.tags.PROFILE),response.sucs===!0?(user.isCurrentUser()?(_profile=userFactory.create(angular.extend({},response,{uId:user.getKey()}),!0,!0),RingLogger.information(_profile.getKey()+": USER PROFILE OF : "+_profile.getName(),RingLogger.tags.PROFILE)):(_otherProfile=userFactory.create(response.userDetails,!0,!1),profileHttpService.fetchPresenceAndMood(user.getKey()).then(function(json){_otherProfile.updateUserObj(json)}),RingLogger.information(_otherProfile.getKey()+": OTHER USER PROFILE OF : "+_otherProfile.getName(),RingLogger.tags.PROFILE)),defer.resolve()):defer.reject()}),defer.promise}function getUserDetailsByUId(uId){var deferred=$q.defer(),user=userFactory.getUser(uId);if(uId=uId||$routeParams.uId,RingLogger.information("Requesting user detail by UID: "+uId,RingLogger.tags.PROFILE),user)RingLogger.warning("getUserDetailsByUId: utid: "+user.getUtId()),deferred.resolve(user);else{RingLogger.information("REQUESTING: ",RingLogger.tags.PROFILE);var userObj=userFactory.create({uId:uId});profileHttpService.getUserDetails({uId:uId}).then(function(response){RingLogger.information("User Fetched"+angular.toJson(response),RingLogger.tags.PROFILE),response.sucs?(userObj=userFactory.create(response.userDetails),deferred.resolve(userObj)):(RingLogger.warning(response,RingLogger.tags.PROFILE),deferred.reject(!1))})}return deferred.promise}function getUserObjectByUId(uId,callback){var userObj=userFactory.getUser(uId);return userObj||(userObj=userFactory.create({uId:uId}),profileHttpService.getUserDetails({uId:uId}).then(function(response){response.sucs&&(userFactory.create(response.userDetails),callback&&callback.call(this))})),userObj}function getMutualFriends(friendId){profileHttpService.getMutualFriends(friendId).then(function(response){response.sucs===!0&&(_otherProfile.updateUserObj({nmf:response.mfIDs.length}),RingLogger.information("MUTUAL FRIEND: "+response.mfIDs.length,RingLogger.tags.PROFILE))},function(){RingLogger.warning("MUTUAL FRIEND FETCH FAIL",RingLogger.tags.PROFILE)})}function getUserProfileData(obj,isCurrent){var user;user=isCurrent?_profile:userFactory.create(obj),_profileData.hasOwnProperty(user.getUtId())||(_profileData[user.getUtId()]={workList:[],educationList:[],skillList:[]},isCurrent?profileHttpService.getUserProfileData():profileHttpService.getUserProfileData(user.getUtId()))}function changeProfilePicture(obj){var defer=$q.defer();return obj||(obj={iurl:_profile.avatar("iurl")}),obj=angular.extend({},obj,fileUploadService.getReposition("profilephoto")),RingLogger.print("log",obj,RingLogger.tags.PROFILE),profileHttpService.changeProfilePicture(obj).then(function(data){data.sucs===!0?(Storage.updateLoginData("prIm",obj.iurl),Storage.updateLoginData("prImId",data.imgId),_profile.setProfileImage(obj.iurl,data.imgId),defer.resolve(data)):(defer.reject(data),RingLogger.warning("Profile picture change info sent failed!",RingLogger.tags.PROFILE))},function(errData){defer.reject(errData),RingLogger.print(errData,RingLogger.tags.PROFILE)}),defer.promise}function changeCoverPicture(obj){var defer=$q.defer();return obj||(obj={iurl:_profile.getCover("iurl")}),obj=angular.extend({},obj,fileUploadService.getReposition("coverphoto")),profileHttpService.changeCoverPicture(obj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs?(RingLogger.information("change cover photo to : "+obj.iurl,RingLogger.tags.PROFILE),_profile.setCover(angular.extend(obj,{cImId:data.imgId})),defer.resolve()):(RingLogger.information("Cover picture change info sent failed!",RingLogger.tags.PROFILE),defer.reject())},function(errData){RingLogger.warning(errData,RingLogger.tags.PROFILE),defer.reject()}),defer.promise}function removeProfilePicture(){var deferred=$q.defer();return _profile.resetAvatar(),profileHttpService.removeProfilePicture(_profile.avatar("iurl")).then(function(data){data.sucs&&deferred.resolve()},function(errData){RingLogger.warning(errData,RingLogger.tags.PROFILE),deferred.reject("Profile picture removal failed")}),deferred.promise}function removeCoverPicture(){var deferred=$q.defer();return _profile.resetCover(),profileHttpService.removeCoverPicture(_profile.getCover("iurl")).then(function(data){data.sucs?deferred.resolve():deferred.reject("Cover picture removal failed")}),deferred.promise}var OTYPES=OPERATION_TYPES.SYSTEM.PROFILE,_profile=Auth.currentUser(),_otherProfile={},_profileData={},_processResponse=function(json){var i;switch(json.actn){case OTYPES.ACTION_USERS_PRESENCE_DETAILS_DATA:RingLogger.information("PRESENCE DETAIL",RingLogger.tags.PROFILE),RingLogger.print(json,RingLogger.tags.PROFILE),json.sucs===!0&&userFactory.create(json);break;case OTYPES.TYPE_ACTION_GET_WORK:if(json.sucs===!0)for(i=0;i<json.workList.length;i++)_addWork(json.workList[i],json.workList[i].utId);else RingLogger.warning("FAILED TO FETCH ANY WORK",RingLogger.tags.PROFILE),RingLogger.log(json,RingLogger.tags.PROFILE);break;case OTYPES.TYPE_ACTION_GET_EDUCATION:if(json.sucs===!0)for(i=0;i<json.educationList.length;i++)_addEducation(json.educationList[i],json.educationList[i].utId);else RingLogger.warning("failed to get education list for user :"+json.utId,RingLogger.tags.PROFILE),RingLogger.log(json,RingLogger.tags.PROFILE);break;case OTYPES.TYPE_ACTION_GET_SKILL:if(json.sucs===!0)for(i=0;i<json.skillList.length;i++)_addSkill(json.skillList[i],json.skillList[i].utId);else RingLogger.warning("failed to get skill list for user :"+json.utId,RingLogger.tags.PROFILE),RingLogger.log(json,RingLogger.tags.PROFILE);break;default:RingLogger.warning("action: "+json.actn+" did not match in profile factory",RingLogger.tags.PROFILE)}};return $$connector.subscribe(_processResponse,{action:[OTYPES.ACTION_USERS_PRESENCE_DETAILS_DATA,OTYPES.TYPE_ACTION_GET_WORK,OTYPES.TYPE_ACTION_GET_EDUCATION,OTYPES.TYPE_ACTION_GET_SKILL]}),{init:init,getProfile:getProfile,getUserDetailsByUId:getUserDetailsByUId,getUserObjectByUId:getUserObjectByUId,getMutualFriends:getMutualFriends,getUserProfileData:getUserProfileData,changeProfilePicture:changeProfilePicture,changeCoverPicture:changeCoverPicture,removeProfilePicture:removeProfilePicture,removeCoverPicture:removeCoverPicture,updateUserProfile:profileHttpService.updateProfile,savePvcEdit:profileHttpService.updateUserPrivacy,submitNewEducation:profileHttpService.submitNewEducation,saveAchatSetting:profileHttpService.saveAchatSetting,getProfileData:_getProfileData,setProfileData:_setProfileData,removeProfileData:_removeProfileData,deleteEducation:profileHttpService.deleteEducation,getAllEducation:profileHttpService.getEducationData,updateEducation:profileHttpService.updateEducationById,submitNewSkill:profileHttpService.submitNewSkill,updateSkill:profileHttpService.updateSkill,deleteSkill:profileHttpService.deleteSkill,submitNewWork:profileHttpService.submitNewWork,updateWork:profileHttpService.updateWork,deleteWork:profileHttpService.deleteWork,changePassword:profileHttpService.changePassword,verifyCheck:profileHttpService.verifyCheck,sendCode:profileHttpService.sendCode,sendCodeToPhn:profileHttpService.sendCodeToPhn,verifyCode:profileHttpService.verifyCode,verifyPhnCode:profileHttpService.verifyPhnCode,changePrivacy:profileHttpService.changePrivacy,saveCallPvcEdit:profileHttpService.saveCallPvcEdit,saveChatPvcEdit:profileHttpService.saveChatPvcEdit,saveFeedPvcEdit:profileHttpService.saveFeedPvcEdit,moodChange:profileHttpService.moodChange,addSocialAccount:profileHttpService.addSocialAccount}}angular.module("ringid.profile").service("profileFactory",profileFactory),profileFactory.$inject=["$routeParams","Storage","Auth","$$connector","$$q","Ringalert","profileHttpService","userFactory","OPERATION_TYPES","fileUploadService","utilsFactory"]}(),function(){"use strict";function ProfileAboutController(Storage,rgDropdownService,$timeout,$scope,utilsFactory,friendsFactory,profileFactory,languageConstant,$routeParams,$$connector,countryListService,$templateCache,Notification,$authSocial,Ringalert){function addSocialAccount(platform){$authSocial.authenticate(platform).then(function(authData){RingLogger.print(authData,RingLogger.tags.PROFILE),profileFactory.addSocialAccount(authData).then(function(response){RingLogger.print(response,RingLogger.tags.PROFILE)})})}function setPrefix(actionObj){RingLogger.print(actionObj,RingLogger.tags.PROFILE),actionObj.event.preventDefault(),$scope.phone.countryCode=actionObj.item.code,$scope.countryFlag=actionObj.item.flagcode,rgDropdownService.close()}function profiledata(data){var workObj,educationObj,skillObj,ftime,ttime,fDate,tDate,i,utid=data.utId;if(234===data.actn)if(data.sucs===!0&&data.utId===utid)for(i=0;i<data.workList.length;i++)workObj=data.workList[i],ftime=workObj.ft,ttime=workObj.tt,workObj.fromTime=new Date(ftime),workObj.toTime=new Date(ttime),0===workObj.tt?(workObj.status=!0,workObj.date_info="Present"):(tDate=utilsFactory.profileVerbalDate(ttime),workObj.toTimeE=tDate),fDate=utilsFactory.profileVerbalDate(ftime),workObj.fromTimeE=fDate,$scope.workInfo.push(workObj);else{for(i=0;i<data.workList.length;i++)workObj=data.workList[i],ftime=workObj.ft,ttime=workObj.tt,workObj.fromTime=new Date(ftime),workObj.toTime=new Date(ttime),0===workObj.tt?(workObj.status=!0,workObj.date_info="Present"):(tDate=utilsFactory.profileVerbalDate(ttime),workObj.toTimeE=tDate),fDate=utilsFactory.profileVerbalDate(ftime),workObj.fromTimeE=fDate,$scope.workInfo.push(workObj);RingLogger.print("failed",RingLogger.tags.PROFILE)}if(235===data.actn)if(data.sucs===!0&&data.utId===utid)for(i=0;i<data.educationList.length;i++)educationObj=data.educationList[i],ftime=educationObj.ft,ttime=educationObj.tt,educationObj.fromTime=new Date(ftime),educationObj.toTime=new Date(ttime),fDate=utilsFactory.profileVerbalDate(ftime),educationObj.fromTimeE=fDate,tDate=utilsFactory.profileVerbalDate(ttime),educationObj.toTimeE=tDate,$scope.educationInfo.push(educationObj);else{for(i=0;i<data.educationList.length;i++)educationObj=data.educationList[i],ftime=educationObj.ft,ttime=educationObj.tt,educationObj.fromTime=new Date(educationObj.ft),educationObj.toTime=new Date(educationObj.tt),fDate=utilsFactory.profileVerbalDate(ftime),educationObj.fromTimeE=fDate,tDate=utilsFactory.profileVerbalDate(ttime),educationObj.toTimeE=tDate,$scope.educationInfo.push(educationObj);RingLogger.print("failed",RingLogger.tags.PROFILE)}if(236===data.actn)if(data.sucs===!0&&data.utId===utid)for(i=0;i<data.skillList.length;i++)skillObj=data.skillList[i],skillObj.fromTime=new Date(skillObj.ft),skillObj.toTime=new Date(skillObj.tt),$scope.skillInfo.push(skillObj);else{for(i=0;i<data.skillList.length;i++)skillObj=data.skillList[i],skillObj.fromTime=new Date(skillObj.ft),skillObj.toTime=new Date(skillObj.tt),$scope.skillInfo.push(skillObj);RingLogger.print("failed",RingLogger.tags.PROFILE)}}function callPvcEditMode(){$scope.callPvcEdit=!0}function cancelCallPvcEdit(){$scope.callPvcEdit=!1}function saveCallPvcEdit(){var obj;obj=$scope.profileObj.isCurrentUser()?{actn:216,sv:$scope.fPrivacyInfo.call,sn:6,isCurrent:!0}:{actn:82,sv:$scope.fPrivacyInfo.call,sn:6,utId:$scope.profileObj.getUtId(),isCurrent:!1},profileFactory.saveCallPvcEdit(obj).then(function(data){$scope.fPrivacyInfo.callPrivacy=$scope.fPrivacyInfo.call,$scope.callPvcEdit=!1})}function chatPvcEditMode(){$scope.chatPvcEdit=!0}function cancelChatPvcEdit(){$scope.chatPvcEdit=!1}function saveChatPvcEdit(){var obj;obj=$scope.profileObj.isCurrentUser()?{actn:216,sv:$scope.fPrivacyInfo.chat,sn:7,isCurrent:!0}:{actn:82,sv:$scope.fPrivacyInfo.chat,sn:7,utId:$scope.profileObj.getUtId(),isCurrent:!1},profileFactory.saveChatPvcEdit(obj).then(function(data){$scope.fPrivacyInfo.chatPrivacy=$scope.fPrivacyInfo.chat,$scope.chatPvcEdit=!1})}function feedPvcEditMode(){$scope.feedPvcEdit=!0}function cancelFeedPvcEdit(){$scope.feedPvcEdit=!1}function saveFeedPvcEdit(obj){RingLogger.print(obj,RingLogger.tags.PROFILE),obj=$scope.profileObj.isCurrentUser()?{actn:216,sv:$scope.fPrivacyInfo.feed,sn:8,isCurrent:!0}:{actn:82,sv:$scope.fPrivacyInfo.feed,sn:8,utId:$scope.profileObj.getUtId(),isCurrent:!1},profileFactory.saveFeedPvcEdit(obj).then(function(data){$scope.fPrivacyInfo.feedPrivacy=$scope.fPrivacyInfo.feed,$scope.feedPvcEdit=!1})}function addEmail(){$scope.isAddEmail=!0,$scope.showAddEmailButton=!1}function addPhone(){$scope.isAddPhone=!0,$scope.showAddPhoneButton=!1}function cancelAddEmail(){$scope.isAddEmail=!1,$scope.showAddEmailButton=!0}function cancelAddPhone(){$scope.isAddPhone=!1,$scope.showAddPhoneButton=!0}function sendCode(email){profileFactory.sendCode(email).then(function(data){RingLogger.print(email,RingLogger.tags.PROFILE),verifyEmail=data.el,$scope.isAddEmail=!1,$scope.isAddCode=!0,Notification.success({message:data.mg})})}function sendCodeToPhn(phone){RingLogger.print(phone,RingLogger.tags.PROFILE),$scope.phone.number=phone.phone,RingLogger.print($scope.phone,RingLogger.tags.PROFILE),profileFactory.sendCodeToPhn($scope.phone).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?($scope.phoneNumber=data.mbl,mblDc=data.mblDc,$scope.isAddPhone=!1,$scope.isAddPhnCode=!0,Notification.success({message:data.mg})):($scope.isAddPhone=!1,$scope.isAddPhnCode=!1,$scope.showAddPhoneButton=!0,$scope.phoneVerified=!1,Notification.error({message:data.mg}))})}function verifyCode(obj){RingLogger.print(obj,RingLogger.tags.PROFILE),obj.email=verifyEmail,profileFactory.verifyCode(obj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?($scope.isAddEmail=!1,$scope.isAddCode=!1,$scope.showAddEmailButton=!0,$scope.emailVerified=!0,$scope.emailValue="Verified Email",$scope.emailTitle="Your Email is verified.",RingLogger.print(data.mg,RingLogger.tags.PROFILE)):($scope.isAddEmail=!1,$scope.isAddCode=!1,$scope.showAddEmailButton=!0,$scope.emailVerified=!1)})}function verifyPhoneCode(obj){var phnObj={};phnObj.phone=$scope.phoneNumber,phnObj.uId=uid,phnObj.mblDc=mblDc,phnObj.code=obj.code,RingLogger.print(phnObj,RingLogger.tags.PROFILE),profileFactory.verifyPhnCode(phnObj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?($scope.isAddPhone=!1,$scope.isAddPhnCode=!1,$scope.showAddPhoneButton=!0,$scope.phoneVerified=!0,$scope.phoneValue="Verified Phone",$scope.phoneTitle="Your Phone is verified."):($scope.isAddPhone=!1,$scope.isAddPhnCode=!1,$scope.showAddPhoneButton=!0,$scope.phoneVerified=!1),RingLogger.print(data.mg,RingLogger.tags.PROFILE)})}function enableEditMode(event){event.preventDefault(),$scope.tmpBasic=angular.copy($scope.profileObj.getBasicInfo()),1==$scope.tmpBasic.mDay&&($scope.tmpBasic.marriageDay=null),1==$scope.tmpBasic.birthDay&&($scope.tmpBasic.birthday=null),$scope.isEditProfile===!1&&($scope.isEditProfile=!0)}function enablePrivacyEditMode(event){event.preventDefault(),$scope.tmpPrivacy=angular.copy($scope.privacyInfo),$scope.isEditPrivacy===!1&&($scope.isEditPrivacy=!0)}function enableAboutEditMode(event){event.preventDefault(),$scope.isEditAbout===!1&&($scope.isEditAbout=!0)}function addNewEducation(){$scope.isaddNewEducation=!0,$scope.isEditEducation=-1}function submitNewEducation(){var fromTime=$scope.eduObjInfo.ft,toTime=$scope.eduObjInfo.tt,fDate=utilsFactory.profileVerbalDate(fromTime);$scope.eduObjInfo.ft=new Date(fDate).getTime();var tDate=utilsFactory.profileVerbalDate(toTime);$scope.eduObjInfo.tt=new Date(tDate).getTime(),$scope.eduObjInfo.ut=(new Date).getTime(),$scope.eduObjInfo.af=1,$scope.eduObjInfo.grtd=!0,$scope.eduObjInfo.iss=!0,profileFactory.submitNewEducation($scope.eduObjInfo).then(function(data){$scope.eduObjInfo.id=data.id,$scope.eduObjInfo.fromTime=fromTime,$scope.eduObjInfo.toTime=toTime;var fDate=utilsFactory.profileVerbalDate(fromTime);$scope.eduObjInfo.fromTimeE=fDate;var tDate=utilsFactory.profileVerbalDate(toTime);$scope.eduObjInfo.toTimeE=tDate,$scope.educationInfo.push(angular.copy($scope.eduObjInfo)),$scope.eduObjInfo.id=0,$scope.eduObjInfo.scl="",$scope.eduObjInfo.dgr="",$scope.eduObjInfo.cntn="",$scope.eduObjInfo.ft="",$scope.eduObjInfo.tt="",$scope.isaddNewEducation=!1})}function updateAbout(event){}function addNewSkill(event){$scope.isAddNewSkill=!0,$scope.isEditSkill=-1}function submitNewSkill(){profileFactory.submitNewSkill($scope.skillObjInfo).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),$scope.skillObjInfo.id=data.id,$scope.skillInfo.push(angular.copy($scope.skillObjInfo)),$scope.skillObjInfo.id=0,$scope.skillObjInfo.skl="",$scope.skillObjInfo.desc="",$scope.isAddNewSkill=!1})}function enableSkillEditMode(event,index){event.preventDefault(),$scope.isAddNewSkill=!1,tmpSkill=angular.copy($scope.skillInfo[index]),$scope.isEditSkill=index}function cancelNewSkill(){$scope.skillObjInfo.skl="",$scope.skillObjInfo.desc="",$scope.isAddNewSkill=!1}function updateSkill(obj){profileFactory.updateSkill(obj).then(function(){RingLogger.print(obj,RingLogger.tags.PROFILE),$scope.isEditSkill=-1})}function deleteSkill(obj){$scope.isEditSkill=-1,profileFactory.deleteSkill(obj).then(function(){var index=$scope.skillInfo.indexOf(obj);$scope.skillInfo.splice(index,1)})}function cancelUpdateSkill(index){$scope.isEditSkill="",$scope.skillInfo[index]=tmpSkill}function addNewWork(){$scope.isAddNewWork=!0,$scope.isEditWork=-1}function cancelNewWork(){$scope.workObjInfo.cnm="",$scope.workObjInfo.pstn="",$scope.workObjInfo.ct="",$scope.workObjInfo.desc="",$scope.workObjInfo.ft="",$scope.workObjInfo.tt="",$scope.isAddNewWork=!1}function submitNewWork(){var fromTime=$scope.workObjInfo.ft,toTime=$scope.workObjInfo.tt,fDate=utilsFactory.profileVerbalDate(fromTime);if($scope.workObjInfo.ft=new Date(fDate).getTime(),$scope.checked===!0)$scope.workObjInfo.tt="0000000000000",$scope.workObjInfo.status=!0,$scope.workObjInfo.date_info="Present",toTime=0;else{$scope.workObjInfo.status=!1;var tDate=utilsFactory.profileVerbalDate(toTime);$scope.workObjInfo.tt=new Date(tDate).getTime()}profileFactory.submitNewWork($scope.workObjInfo).then(function(data){if(1==data.sucs){$scope.workObjInfo.id=data.id,$scope.workObjInfo.fromTime=fromTime,$scope.workObjInfo.toTime=toTime;var fDate=utilsFactory.profileVerbalDate(fromTime);if($scope.workObjInfo.fromTimeE=fDate,$scope.checked!==!0){var tDate=utilsFactory.profileVerbalDate(toTime);
$scope.workObjInfo.toTimeE=tDate}$scope.workInfo.push(angular.copy($scope.workObjInfo)),$scope.workObjInfo.cnm="",$scope.workObjInfo.pstn="",$scope.workObjInfo.ct="",$scope.workObjInfo.desc="",$scope.workObjInfo.ft="",$scope.workObjInfo.tt="",$scope.isAddNewWork=!1,$scope.isEditWork=-1}else $scope.isAddNewWork=!1,$scope.isEditWork=-1,alert("Failed ! Please Try again.")})}function enableWorkEditMode(event,index){event.preventDefault(),$scope.isAddNewWork=!1,$scope.isEditWork=index,1==$scope.workInfo[index].tt&&($scope.workInfo[index].toTimeE=null),1==$scope.workInfo[index].ft&&($scope.workInfo[index].fromTimeE=null),tmpWork=angular.copy($scope.workInfo[index])}function cancelUpdateWork(index){$scope.isEditWork="",$scope.workInfo[index]=tmpWork}function updateWork(obj){obj.ft=new Date(obj.fromTimeE).getTime(),obj.status===!0?(obj.tt="0000000000000",obj.date_info="Present"):obj.tt=new Date(obj.toTimeE).getTime(),profileFactory.updateWork(obj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),1==data.sucs?(obj.ft?obj.fromTime=new Date(obj.ft):obj.ft=1,obj.tt?obj.toTime=new Date(obj.tt):obj.tt=1,$scope.isEditWork=-1):Ringalert.show("Failed ! Please Try Again","info")})}function deleteWork(obj){$scope.isEditWork=-1,profileFactory.deleteWork(obj).then(function(){var index=$scope.workInfo.indexOf(obj);$scope.workInfo.splice(index,1)})}function cancelAddEducation(){$scope.eduObjInfo.scl="",$scope.eduObjInfo.dgr="",$scope.eduObjInfo.cntn="",$scope.eduObjInfo.ft="",$scope.eduObjInfo.tt="",$scope.isaddNewEducation=!1}function enableEducationEditMode(event,index){event.preventDefault(),1==$scope.educationInfo[index].tt&&($scope.educationInfo[index].toTimeE=null),1==$scope.educationInfo[index].ft&&($scope.educationInfo[index].fromTimeE=null),tmpEducation=angular.copy($scope.educationInfo[index]),$scope.isaddNewEducation=!1,$scope.isEditEducation=index}function updateEducation(obj){obj.ft=new Date(obj.fromTimeE).getTime(),obj.tt=new Date(obj.toTimeE).getTime(),profileFactory.updateEducation(obj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),1==data.sucs?(obj.ft?obj.fromTime=new Date(obj.ft):obj.ft=1,obj.tt?obj.toTime=new Date(obj.tt):obj.tt=1,$scope.isEditEducation=-1):Ringalert.show("Failed ! Please Try Again","info")})}function cancelUpdateEducation(index){$scope.isEditEducation="",$scope.educationInfo[index]=tmpEducation}function deleteEducation(edu){$scope.isEditEducation=-1,profileFactory.deleteEducation(edu.id).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE);var index=$scope.educationInfo.indexOf(edu);$scope.educationInfo.splice(index,1)})}function updateMyBasicInfo(){var mdateobj=$scope.tmpBasic.marriageDay;null==mdateobj&&(mdateobj=1);var dateobj;$scope.basicInfo=$scope.tmpBasic;var datetype=typeof $scope.basicInfo.birthday,mdatetype=typeof mdateobj;if(RingLogger.print(datetype,RingLogger.tags.PROFILE),"string"===datetype){var data=$scope.basicInfo.birthday.split("-"),bdDate=parseInt(data[0])+","+parseInt(data[1])+","+parseInt(data[2]);dateobj=new Date(bdDate)}else{dateobj=$scope.basicInfo.birthday;var frTime=utilsFactory.profileVerbalDate($scope.basicInfo.birthDay);$scope.basicInfo.birthday=frTime}if("string"===mdatetype){var mdata=mdateobj.split("-"),mDate=parseInt(mdata[0])+","+parseInt(mdata[1])+","+parseInt(mdata[2]);mdateobj=new Date(mDate)}profileFactory.updateUserProfile($scope.uId,$scope.basicInfo,dateobj,mdateobj).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?($scope.basicInfo.birthDay=dateobj?dateobj.getTime():"1","object"==typeof dateobj?$scope.currentUser.setBirthday($scope.basicInfo.birthDay):$scope.currentUser.setBirthday("1"),"object"===mdatetype?$scope.currentUser.setMarriageday(mdateobj.getTime()):$scope.currentUser.setMarriageday("1"),$scope.profileObj.getBasicInfo().birthDay=$scope.basicInfo.birthDay,$scope.currentUser.setName($scope.basicInfo.fn),$scope.currentUser.setHomeCity($scope.basicInfo.hc),$scope.currentUser.setCurrentCity($scope.basicInfo.cc),$scope.currentUser.setAboutMe($scope.basicInfo.am),Storage.updateLoginData("fn",$scope.basicInfo.fn),$scope.currentUser.setGender($scope.basicInfo.gr),$scope.isEditProfile=!1,$scope.isOwner=!0):RingLogger.print("something went wrong",RingLogger.tags.PROFILE)})}function cancelUpdateMyBasicInfo(){$scope.basicInfo=$scope.tmpBasic,$scope.isEditProfile=!1,$scope.isOwner=!0}function cancelUpdateAbout(){$scope.isEditAbout=!1}function cancelUpdatePrivacySetting(){$scope.privacyInfo=$scope.tmpPrivacy,$scope.isEditPrivacy=!1}function enablePassEdit(event){event.preventDefault(),$scope.showPassEdit===!1&&($scope.showPassEdit=!0,$scope.showMessage=!1)}function updatePassword(obj){obj.newpassword!=obj.repassword?$scope.IsMatch=!0:obj.newpassword==obj.repassword&&($scope.IsMatch=!1,$scope.oldError=!1,profileFactory.changePassword(obj.oldpassword,obj.newpassword).then(function(data){RingLogger.print(data,RingLogger.tags.PROFILE),data.sucs===!0?(obj={oldpassword:"",newpassword:"",repassword:""},$scope.showPassEdit=!1,$scope.showMessage=!0,Notification.success({message:"Password Changed SuccessFully"})):Notification.success({message:data.mg})},function(data){$scope.oldError=!0}))}function cancelUpdatePassword(obj){obj.oldpassword="",obj.newpassword="",obj.repassword="",$scope.IsMatch=!1,$scope.showPassEdit=!1,$scope.showMessage=!0}$scope.activeNav="basic",$scope.addSocialAccount=addSocialAccount;var tmpSkill,tmpEducation,tmpWork,verifyEmail,mblDc,uid=$routeParams.uId;$scope.consType=languageConstant.get(),$scope.ddHtml="pages/dropdowns/country-list-dropdown.html",$scope.status=!1,$scope.isEditProfile=!1,$scope.isEditPrivacy=!1,$scope.isEditAbout=!1,$scope.isEditEducation=-1,$scope.isEditSkill=-1,$scope.isEditWork=-1,$scope.isaddNewEducation=!1,$scope.isAddNewSkill=!1,$scope.emailVerified=!1,$scope.phoneVerified=!1,$scope.isAddNewWork=!1,$scope.educationObj={},$scope.countryList={},$scope.showSuccess=!1,$scope.oldError=!1,$scope.educationInfo=[],$scope.eduObjInfo={},$scope.skillObjInfo={},$scope.skillObj={},$scope.skillInfo=[],$scope.workObjInfo={},$scope.workObj={},$scope.workInfo=[],$scope.fPrivacyInfo={},$scope.enableEditMode=enableEditMode,$scope.enablePrivacyEditMode=enablePrivacyEditMode,$scope.enableAboutEditMode=enableAboutEditMode,$scope.enableEducationEditMode=enableEducationEditMode,$scope.updateAbout=updateAbout,$scope.updateMyBasicInfo=updateMyBasicInfo,$scope.cancelUpdateMyBasicInfo=cancelUpdateMyBasicInfo,$scope.cancelUpdateEducation=cancelUpdateEducation,$scope.cancelUpdatePrivacySetting=cancelUpdatePrivacySetting,$scope.addNewEducation=addNewEducation,$scope.deleteEducation=deleteEducation,$scope.submitNewEducation=submitNewEducation,$scope.cancelAddEducation=cancelAddEducation,$scope.cancelUpdateAbout=cancelUpdateAbout,$scope.updateEducation=updateEducation,$scope.addNewSkill=addNewSkill,$scope.submitNewSkill=submitNewSkill,$scope.cancelNewSkill=cancelNewSkill,$scope.enableSkillEditMode=enableSkillEditMode,$scope.updateSkill=updateSkill,$scope.deleteSkill=deleteSkill,$scope.cancelUpdateSkill=cancelUpdateSkill,$scope.addNewWork=addNewWork,$scope.cancelNewWork=cancelNewWork,$scope.submitNewWork=submitNewWork,$scope.enableWorkEditMode=enableWorkEditMode,$scope.updateWork=updateWork,$scope.cancelUpdateWork=cancelUpdateWork,$scope.deleteWork=deleteWork,$scope.checked=!1,$scope.showPassEdit=!1,$scope.enablePassEdit=enablePassEdit,$scope.updatePassword=updatePassword,$scope.cancelUpdatePassword=cancelUpdatePassword,$scope.showMessage=!0,$scope.isAddEmail=!1,$scope.isAddPhone=!1,$scope.addEmail=addEmail,$scope.addPhone=addPhone,$scope.isAddCode=!1,$scope.showAddEmailButton=!0,$scope.showAddPhoneButton=!0,$scope.cancelAddEmail=cancelAddEmail,$scope.cancelAddPhone=cancelAddPhone,$scope.sendCode=sendCode,$scope.sendCodeToPhn=sendCodeToPhn,$scope.verifyCode=verifyCode,$scope.verifyPhoneCode=verifyPhoneCode,$scope.isFrndsPrivacyEdit=!1,$scope.frndsPrivacyEditMode=function(){$scope.isFrndsPrivacyEdit=!0},$scope.cancelPvcEdit=function(){$scope.isFrndsPrivacyEdit=!1},$scope.profileObj.isCurrentUser()||$scope.profileObj.isFriend()?$scope.showFrndsPvcEditOpt=!0:$scope.showFrndsPvcEditOpt=!1,$scope.savePvcEdit=function(fPrivacyInfo){var callobj;$scope.isFrndsPrivacyEdit=!1,callobj=$scope.profileObj.isCurrentUser()?{actn:216,sv:fPrivacyInfo.callPrivacy,sn:6,isCurrent:!0}:{actn:82,sv:fPrivacyInfo.callPrivacy,sn:6,utId:$scope.profileObj.getUtId(),isCurrent:!1},$scope.fPrivacyInfo.callPrivacy=fPrivacyInfo.callPrivacy,$timeout(function(){profileFactory.saveCallPvcEdit(callobj).then(function(data){data.sucs===!0?$scope.fPrivacyInfo.callPrivacy=fPrivacyInfo.callPrivacy:($scope.fPrivacyInfo.callPrivacy=0,Notification.error({message:data.mg}))})},100);var chatobj;chatobj=$scope.profileObj.isCurrentUser()?{actn:216,sv:fPrivacyInfo.chatPrivacy,sn:7,isCurrent:!0}:{actn:82,sv:fPrivacyInfo.chatPrivacy,sn:7,utId:$scope.profileObj.getUtId(),isCurrent:!1},$scope.fPrivacyInfo.chatPrivacy=fPrivacyInfo.chatPrivacy,$timeout(function(){profileFactory.saveChatPvcEdit(chatobj).then(function(data){data.sucs===!0?$scope.fPrivacyInfo.chatPrivacy=fPrivacyInfo.chatPrivacy:$scope.fPrivacyInfo.chatPrivacy=0})},200);var feedObj;feedObj=$scope.profileObj.isCurrentUser()?{actn:216,sv:fPrivacyInfo.feedPrivacy,sn:8,isCurrent:!0}:{actn:82,sv:fPrivacyInfo.feedPrivacy,sn:8,utId:$scope.profileObj.getUtId(),isCurrent:!1},$scope.fPrivacyInfo.feedPrivacy=fPrivacyInfo.feedPrivacy,$timeout(function(){profileFactory.saveFeedPvcEdit(feedObj).then(function(data){data.sucs===!0?$scope.fPrivacyInfo.feedPrivacy=fPrivacyInfo.feedPrivacy:$scope.fPrivacyInfo.feedPrivacy=0})},300)},$scope.cancelVerification=function(){$scope.isAddCode=!1,$scope.isAddPhnCode=!1,$scope.showAddEmailButton=!0,$scope.showAddPhoneButton=!0},$scope.callPvcEditMode=callPvcEditMode,$scope.callPvcEdit=!1,$scope.saveCallPvcEdit=saveCallPvcEdit,$scope.cancelCallPvcEdit=cancelCallPvcEdit,$scope.chatPvcEditMode=chatPvcEditMode,$scope.chatPvcEdit=!1,$scope.saveChatPvcEdit=saveChatPvcEdit,$scope.cancelChatPvcEdit=cancelChatPvcEdit,$scope.feedPvcEditMode=feedPvcEditMode,$scope.feedPvcEdit=!1,$scope.saveFeedPvcEdit=saveFeedPvcEdit,$scope.cancelFeedPvcEdit=cancelFeedPvcEdit,$scope.emailValue="Verify Email",$scope.emailTitle="Click here to verify your Email",$scope.phoneValue="Verify Phone",$scope.phoneTitle="Click here to verify your Phone",$scope.profileObj=profileFactory.getProfile(uid),$scope.fPrivacyInfo.callPrivacy=0,$scope.fPrivacyInfo.chatPrivacy=0,$scope.fPrivacyInfo.feedPrivacy=0,$scope.ddControl={listData:[]},$scope.phone={countryCode:"+93"},$scope.countryFlag="a93",$scope.setPrefix=setPrefix,countryListService.getList().success(function(data){$scope.ddControl.countryList=data}),$scope.basicInfo=$scope.profileObj.getBasicInfo(),$scope.profileObj.isCurrentUser()?profileFactory.verifyCheck().then(function(data){data.sucs===!0&&($scope.emailVerified=data.iev,$scope.phoneVerified=data.imnv,$scope.fPrivacyInfo.callPrivacy=data.cla,$scope.fPrivacyInfo.chatPrivacy=data.chta,$scope.fPrivacyInfo.feedPrivacy=data.fda,$scope.emailVerified&&($scope.emailValue="Verified Email",$scope.emailTitle="Your Email is verified."),$scope.phoneVerified&&($scope.phoneValue="Verified Phone",$scope.phoneTitle="Your Phone is verified."))}):($scope.access=$scope.profileObj.getAccess,$scope.fPrivacyInfo.callPrivacy=$scope.profileObj.getAccess().cla,$scope.fPrivacyInfo.chatPrivacy=$scope.profileObj.getAccess().chta,$scope.fPrivacyInfo.feedPrivacy=$scope.profileObj.getAccess().fda,$scope.fPrivacyInfo.callPrivacy||$scope.fPrivacyInfo.chatPrivacy||$scope.fPrivacyInfo.feedPrivacy||$scope.profileObj.setBlock(1)),$scope.isDatePickerOpen=!1,$scope.model={},$scope.open=function($event,elementOpened){switch(RingLogger.print(elementOpened,RingLogger.tags.PROFILE),$event.preventDefault(),$event.stopPropagation(),elementOpened){case"wcalendar":$scope.model.wcalendarTo=!1;break;case"wcalendarTo":$scope.model.wcalendar=!1;break;case"ecalendar":$scope.model.ecalendarTo=!1;break;case"ecalendarTo":$scope.model.ecalendar=!1;break;case"mcalendar":$scope.model.mcalendar=!1}$scope.model[elementOpened]=!$scope.model[elementOpened]},$scope.dateOptions={showWeeks:"false",startingDay:1},profileFactory.getUserProfileData({uId:uid},$scope.profileObj.isCurrentUser()),$$connector.subscribe(profiledata,{action:[234,235,236]}),$scope.ddActionHtml="pages/dropdowns/action-dropdown.html",$scope.actionSkillDropdown=function(actionObj){switch(actionObj.event.preventDefault(),actionObj.action){case"edit":enableSkillEditMode(actionObj.event,actionObj.data.index);break;case"delete":deleteSkill(actionObj.data.obj)}},$scope.actionEduDropdown=function(actionObj){switch(actionObj.event.preventDefault(),actionObj.action){case"edit":enableEducationEditMode(actionObj.event,actionObj.data.index);break;case"delete":deleteEducation(actionObj.data.obj)}},$scope.actionWorkDropdown=function(actionObj){switch(actionObj.event.preventDefault(),actionObj.action){case"edit":enableWorkEditMode(actionObj.event,actionObj.data.index);break;case"delete":deleteWork(actionObj.data.obj)}}}angular.module("ringid.profile").controller("ProfileAboutController",ProfileAboutController),ProfileAboutController.$inject=["Storage","rgDropdownService","$timeout","$scope","utilsFactory","friendsFactory","profileFactory","languageConstant","$routeParams","$$connector","countryListService","$templateCache","Notification","$authSocial","Ringalert"]}(),function(){"use strict";angular.module("ringid.chat",["ringid.config","ringid.common.stacked_map","ngWebSocket","ringid.utils","ringid.common.rgemoticon_directive","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat","angularAudioRecorder"]).config(["recorderServiceProvider",function(recorderServiceProvider){}])}(),function(){"use strict";var chatApp=angular.module("ringid.chat"),CHAT_GENERAL_CONSTANTS={MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,TEXT:2,EMOTICON_MESSAGE:3,LOCATION_SHARE:4,LINK_SHARE:5,STICKER:6,IMAGE:7,AUDIO:8,VIDEO:9,CAMERA_IMAGE:10,TYPING:101},USER_PRESENCE:{OFFLINE:1,ONLINE:2,AWAY:3},HISTORY_MAX_MESSAGE:20,TAB_SYNC_MAX_TIME:18e4,TAB_SYNC_ACTIONS:{AUTH_REQUEST:0,CHAT_REQUEST:1,GENERAL_INFO_UPDATE:3,CHAT_BOX_INFO_UPDATE:4,SECRET_CHAT_TIMER:5,CHAT_HISTORY_REFRESH:6,CHAT_MSESSAGE_UPDATE:7},SHARED_WORKER_PATH:"js/worker/chat/shared.js"},CHAT_GLOBAL_VALUES={serverTimeDiff:0,offlineUpdateTime:0},CHAT_GENERAL_INFOS={version:"1.5"},CHAT_STATES={MESSAGE_SENDING:{ONLINE_IP_PORT_REQUEST:0,FIRST_ONLINE:1,PRESENCE_REFRESH:2,SECOND_ONLINE:3,ONLINE_IP_PORT_REFRESH:4,THIRD_ONLINE:5,ONLINE_SUCCESS:6,ONLINE_FAILED:7,FIRST_OFFLINE:101,OFFLINE_IP_PORT_REFRESH:102,SECOND_OFFLINE:102,OFFLINE_FAILED:104,OFFLINE_SUCCESS:105,SUCCESS:201,FAILED:202}},CHAT_FLOWS={SEND_MESSAGE:[CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,CHAT_STATES.MESSAGE_SENDING.FIRST_ONLINE,CHAT_STATES.MESSAGE_SENDING.PRESENCE_REFRESH,CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,CHAT_STATES.MESSAGE_SENDING.ONLINE_FAILED,CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE,CHAT_STATES.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]},CHAT_STATE_INFO={};CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST]={NEXT:[CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE]={NEXT:[CHAT_STATES.MESSAGE_SENDING.ONLINE_SUCCESS,CHAT_STATES.MESSAGE_SENDING.PRESENCE_REFRESH]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.PRESENCE_REFRESH]={NEXT:[CHAT_STATES.MESSAGE_SENDING.ONLINE_SUCCESS,CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH]={NEXT:[CHAT_STATES.MESSAGE_SENDING.ONLINE_SUCCESS,CHAT_STATES.MESSAGE_SENDING.ONLINE_FAILED]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.ONLINE_FAILED]={NEXT:[CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.OFFLINE_SUCCESS]={NEXT:[CHAT_STATES.MESSAGE_SENDING.SUCCESS]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE]={NEXT:[CHAT_STATES.MESSAGE_SENDING.OFFLINE_SUCCESS,CHAT_STATES.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH]={NEXT:[CHAT_STATES.MESSAGE_SENDING.OFFLINE_SUCCESS,CHAT_STATES.MESSAGE_SENDING.OFFLINE_FAILED]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.OFFLINE_FAILED]={NEXT:[CHAT_STATES.MESSAGE_SENDING.FAILED]},CHAT_STATE_INFO[CHAT_STATES.MESSAGE_SENDING.OFFLINE_SUCCESS]={NEXT:[CHAT_STATES.MESSAGE_SENDING.SUCCESS]};for(var chatStates=Object.keys(CHAT_STATES.MESSAGE_SENDING),index=0,length=chatStates.length;length>index;index++){var aChatStateIndex=CHAT_STATES.MESSAGE_SENDING[chatStates[index]];try{CHAT_STATE_INFO[aChatStateIndex].NAME=chatStates[index]}catch(e){CHAT_STATE_INFO[aChatStateIndex]={},CHAT_STATE_INFO[aChatStateIndex].NAME=chatStates[index]}}var CHAT_PACKET_TYPE={CHAT_REGISTER:1,CHAT_FRIEND_UNREGISTERED:2,CHAT_REGISTER_CONFIRMATION:3,CHAT_GROUP_UNREGISTER:4,CHAT_FRIEND:5,CHAT_DELIVERED:6,CHAT_SEEN:7,CHAT_SENT:8,CHAT_TYPING:9,CHAT_IDEL:10,CHAT_GROUP_REGISTER:12,CHAT_GROUP_REG_CONFIRMATION:13,CHAT_GROUP:14,CHAT_GROUP_DELIVERED:15,CHAT_GROUP_SEEN:16,CHAT_GROUP_SENT:17,CHAT_GROUP_TYPING:18,CHAT_GROUP_IDEL:19,CHAT_FRIEND_OFFLINE:20,CHAT_GROUP_OFFLINE:21,CHAT_GET_OFFLINE:22,CHAT_OFFLINE_CONFIRMATION:23,FRIEND_CHAT_DELETE:24,FRIEND_CHAT_DELETE_CONFIRMATION:25,FRIEND_INFORMATION:28,FRIEND_INFORMATION_CONFIRMATION:29,GROUP_CHAT_DELETE:26,GROUP_CHAT_DELETE_CONFIRMATION:27,FILE_TOTAL_SEQUENCE:30,FILE_TOTAL_SEQUENCE_CONFIRMATION:31,FILE_STREAM_SEND:32,FILE_STREAM_SEND_CONFIRMATION:33},CHAT_PACKET_ATTRIBUTE={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,IS_SECRET_VISIBLE:26,MESSAGE_STATUS:27,BLOCK_UNBLOCK_UPDATE_DATE:28},CHAT_PACKET_FORMAT={REGISTER_PKT:{PACKET_NAME:"REGISTER_PKT",PACKET_TYPE:1,FORMAT:[1,2,3,4,5,6]},FRIEND_UNREGISTER_PKT:{PACKET_NAME:"FRIEND_UNREGISTER_PKT",PACKET_TYPE:2,FORMAT:[1,2,3,4,5,9,10]},REGISTER_CONFIRM_PKT:{PACKET_NAME:"REGISTER_CONFIRM_PKT",PACKET_TYPE:3,FORMAT:[1,3,4,5,7,25]},CHAT_MSG:{PACKET_NAME:"CHAT_MSG",PACKET_TYPE:6,FORMAT:[1,2,3,4,5,11,12,15,16,17,26]},CHAT_MSG_OFFLINE:{PACKET_NAME:"CHAT_MSG_OFFLINE",PACKET_TYPE:6,FORMAT:[1,2,3,4,5,11,12,15,16,17,26,6]},DELIVER_PKT:{PACKET_NAME:"DELIVER_PKT",PACKET_TYPE:15,FORMAT:[1,2,3,4,5]},DELIVER_PKT_OFFLINE:{PACKET_NAME:"DELIVER_PKT_OFFLINE",PACKET_TYPE:15,FORMAT:[1,2,3,4,5,6]},SEEN_PKT:{PACKET_NAME:"SEEN_PKT",PACKET_TYPE:17,FORMAT:[1,2,3,4,5,18,4,5,17,27]},SEEN_PKT_CONFIRM:{PACKET_NAME:"SEEN_PKT_CONFIRM",PACKET_TYPE:18,FORMAT:[1,2,3,4,5]},SENT_PKT:{PACKET_NAME:"SENT_PKT",PACKET_TYPE:16,FORMAT:[1,2,3,4,5]},SEEN_PKT_OFFLINE:{PACKET_NAME:"SEEN_PKT_OFFLINE",PACKET_TYPE:17,FORMAT:[1,2,3,4,5,18,4,5,17,27,6]},TYPING_PKT:{PACKET_NAME:"TYPING_PKT",PACKET_TYPE:5,FORMAT:[1,2,3,6]},IDLE_PKT:{PACKET_NAME:"IDLE_PKT",PACKET_TYPE:4,FORMAT:[1,2,3,6]},DELETE_PKT:{PACKET_NAME:"DELETE_PKT",PACKET_TYPE:19,FORMAT:[1,2,3,4,5,18,4,5]},DELETE_PKT_OFFLINE:{PACKET_NAME:"DELETE_PKT_OFFLINE",PACKET_TYPE:19,FORMAT:[1,2,3,4,5,18,4,5,6]},DELETE_CONFIRM_PKT:{PACKET_NAME:"DELETE_CONFIRM_PKT",PACKET_TYPE:20,FORMAT:[1,2,3,4,5]},DELETE_CONFIRM_PKT_OFFLINE:{PACKET_NAME:"DELETE_CONFIRM_PKT_OFFLINE",PACKET_TYPE:20,FORMAT:[1,2,3,4,5,6]},OFFLINE_REGISTER_PKT:{PACKET_NAME:"OFFLINE_REGISTER_PKT",PACKET_TYPE:93,FORMAT:[1,2,4,5,24,28,6]},OFFLINE_CONFIRM_PKT:{PACKET_NAME:"OFFLINE_CONFIRM_PKT",PACKET_TYPE:94,FORMAT:[1,4,5,17]},FRIEND_OFFLINE_PKT:{PACKET_NAME:"FRIEND_OFFLINE_PKT",PACKET_TYPE:95,FORMAT:[1,4,5,18,1,2,4,5,11,12,15,16,17,26]},FRIEND_OFFLINE_CONFIRM_PKT:{PACKET_NAME:"FRIEND_OFFLINE_CONFIRM_PKT",PACKET_TYPE:96,FORMAT:[1,2,4,5,18,4,5,6]}},AUTH_SERVER_ACTIONS={START_F2F_CHAT:175,RECEIVED_F2F_CHAT:375,START_TAG_CHAT:134,RECEIVED_TAG_CHAT:334,ADD_TAG_CHAT_MEMBERS:135,GET_OFFLINE_IP_PORT:83};chatApp.constant("CHAT_PACKET_TYPE",CHAT_PACKET_TYPE),chatApp.constant("CHAT_PACKET_ATTRIBUTE",CHAT_PACKET_ATTRIBUTE),chatApp.constant("CHAT_PACKET_FORMAT",CHAT_PACKET_FORMAT),chatApp.constant("CHAT_GENERAL_CONSTANTS",CHAT_GENERAL_CONSTANTS),chatApp.constant("CHAT_FLOWS",CHAT_FLOWS),chatApp.constant("CHAT_STATE_INFO",CHAT_STATE_INFO),chatApp.constant("CHAT_STATES",CHAT_STATES),chatApp.value("CHAT_GLOBAL_VALUES",CHAT_GLOBAL_VALUES),chatApp.value("CHAT_GENERAL_INFOS",CHAT_GENERAL_INFOS),chatApp.constant("AUTH_SERVER_ACTIONS",AUTH_SERVER_ACTIONS)}(),function(){"use strict";function ChatController($scope,$rootScope,ChatFactory,ChatHelper,tagOfflineChatManager,chatUtilsFactory,settings,SystemEvents,PacketDataParse,friendsFactory,ChatPacketSenderService,chatTabSync,utilsFactory,CHAT_GENERAL_CONSTANTS,chatHistoryFactory,$ringhttp,$$connector,Auth,tagChatManager,PullerSubscriber,$location){function initChatApp(){chatHistoryFactory.init(),chatTabSync.init(),sendOfflineGetRequest(),startChatHearBeatInterval(),openPreviouslyOpenedBoxes()}$scope.chatAppInitiated=!1,$scope.boxes=ChatFactory.getBoxes(),$scope.domBoxLength=function(){for(var count=0,i=0;i<$scope.boxes.length;i++)1==$scope.boxes[i].value.nonDomBox&&count++;return count>10?10:count},$scope.availableNo=ChatFactory.getNumberOfAvailableChatBox(),$scope.getProfileLink=settings.baseUrl+"#/profile/",$scope.goToProfile=function(event,profileLink){$location.path(profileLink),event.stopPropagation()},$rootScope.$on("chatOpened",function(e,data){data.sendToTab&&chatTabSync.sendData(CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE,{boxId:data.user})}),$scope.contactListAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())},$scope.$on(SystemEvents.COMMON.WINDOW_RESIZED,function(event,viewport){RingLogger.print("viewport : X: "+viewport.x+" Y:"+viewport.y,RingLogger.tags.CHAT),$scope.availableNo=ChatFactory.getNumberOfAvailableChatBox(viewport.x),utilsFactory.safeDigest($scope)}),utilsFactory.onCustomEvent(SystemEvents.CHAT.TAB_SYNC_NEW_DATA,function(data){RingLogger.information("TAB SYNC DATA",data,RingLogger.tags.TAB_DATA_RECEIVED),data.type==CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.CHAT_BOX_INFO_UPDATE?ChatFactory.refreshBox(data.boxId):data.type==CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE&&(chatHistoryFactory.loadChatBoxes(),ChatFactory.openAndAddMessage(data.boxId,data.msg))});var startChatHearBeatInterval=function(){window.addEventListener("online",function(e){window.navigator.onLine&&(RingLogger.debug("Browser Gets Online From Offline",RingLogger.tags.CHAT),tagOfflineChatManager.getUnreadMessagesMultipleTimes())});var counter=0,state="online";$$connector.addInterval(function(){$ringhttp.get(settings.chatHeartBeatUrl).success(function(response){response&&"offline"==state&&(state="online",utilsFactory.triggerCustomEvent("online"))}).error(function(response){counter>3?(counter=0,state="offline"):counter++})})},sendOfflineGetRequest=function(){chatUtilsFactory.hasOfflineIpPort()?tagOfflineChatManager.getUnreadMessagesMultipleTimes():ChatPacketSenderService.doUpdateOfflineIpPort().then(function(response){tagOfflineChatManager.getUnreadMessagesMultipleTimes()})},openPreviouslyOpenedBoxes=function(){setTimeout(function(){var storageBoxes=chatHistoryFactory.getAllOpenBoxes();storageBoxes&&Object.keys(storageBoxes).forEach(function(anOpenBoxId,key){var box,anOpenBoxInfo=storageBoxes[anOpenBoxId];if(anOpenBoxInfo.isTagChat)tagChatManager.openPreviouslyOpenedBoxes(anOpenBoxInfo.boxId);else{ChatFactory.openChatBox(anOpenBoxInfo.boxId),box=ChatFactory.getBoxByUId(anOpenBoxInfo.boxId);var historyBox=chatHistoryFactory.getBox(anOpenBoxInfo.boxId);angular.extend(box,historyBox),PullerSubscriber.requestForIp(anOpenBoxInfo.boxId),box&&box.loadHistoryMessages()}})},2e3)},registerChatAppInitEvent=function(){$rootScope.$on("FIRST_FEED_RECEIVED",function(){$scope.chatAppInitiated||($scope.chatAppInitiated=!0,initChatApp())}),setTimeout(function(){$scope.chatAppInitiated||($scope.chatAppInitiated=!0,initChatApp())},6e3)};Auth.isLoggedIn()?registerChatAppInitEvent():$scope.$on(SystemEvents.AUTH.LOGIN,function(event,data){registerChatAppInitEvent()})}angular.module("ringid.chat").controller("ChatController",ChatController),ChatController.$inect=["$scope","$rootScope","ChatFactory","ChatHelper","tagOfflineChatManager","chatUtilsFactory","settings","SystemEvents","PacketDataParse","friendsFactory","ChatPacketSenderService","chatTabSync","utilsFactory","CHAT_GENERAL_CONSTANTS","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","PullerSubscriber","$location"],ChatController.$inject=["$scope","$rootScope","ChatFactory","ChatHelper","tagOfflineChatManager","chatUtilsFactory","settings","SystemEvents","PacketDataParse","friendsFactory","ChatPacketSenderService","chatTabSync","utilsFactory","CHAT_GENERAL_CONSTANTS","chatHistoryFactory","$ringhttp","$$connector","Auth","tagChatManager","PullerSubscriber","$location"]}(),function(){"use strict";function ChatHistoryController($scope,$rootScope,ChatFactory,Storage,Auth,profileFactory,tagChatFactory,userFactory,utilsFactory,chatHistoryFactory,CHAT_GLOBAL_VALUES,TAG_CHAT_GENERAL_CONSTANTS,$$stackedMap,SystemEvents,rgScrollbarService){$scope.selectedLeftBox={key:0,messages:[]},$scope.boxes=$$stackedMap.createNew(!0),$scope.recentMessages=$$stackedMap.createNew(!0),$scope.ready=$rootScope.chatHistoryReady||!1,$scope.selectLeftBox=function(box){$scope.selectedLeftBox=box};var getMessageTime=function(messageDate){var localTime=messageDate-CHAT_GLOBAL_VALUES.serverTimeDiff,localFormatedTime=utilsFactory.verbalDate(localTime);return localFormatedTime};$scope.getMessageTime=getMessageTime;var updateUserObject=function(msgObject,userId){userId&&(msgObject.user=profileFactory.getUserObjectByUId(userId,function(){$scope.$rgDigest()}))},getMessageText=function(message){return message.statusType?"Activity message.":message.messageType==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.PLAIN_MESSAGE?message.text:"Received media message."},getUnreadStatus=function(message){return"Unread"==message.status?!0:"Received"==message.status&&!message.seenSent},getBoxUnreadCount=function(aBox){return chatHistoryFactory.getUnreadMessageCountByBoxId(aBox.key)},getMessageAdaptorObject=function(aHistoryMessageObject){var aMessageObject=angular.copy(aHistoryMessageObject);return aMessageObject.date=getMessageTime(aMessageObject.messageDate),aMessageObject.isUnread=function(){return getUnreadStatus(aMessageObject)},aMessageObject.messageText=function(){return getMessageText(aMessageObject)},aMessageObject.user.getKey&&updateUserObject(aMessageObject,aMessageObject.user),aMessageObject.isSelf=function(){return aHistoryMessageObject.userId==Auth.currentUser().getKey()},aMessageObject},getBoxLastMessage=function(aBoxObject){var lastMessage=!1;return aBoxObject.messages.length>0&&(aBoxObject.messages.sort(function(a,b){return a.messageDate>b.messageDate?1:a.messageDate<b.messageDate?-1:0}),lastMessage=aBoxObject.messages[aBoxObject.messages.length-1]),lastMessage},updateBoxLastMessageByBoxId=function(boxId){var currentUserBoxes=chatHistoryFactory.getChatBoxes(),aHistoryBoxObject=currentUserBoxes[boxId],aBox=$scope.boxes.get(boxId);if(aBox){aBox.messages=aHistoryBoxObject.messages;var lastMessage=getBoxLastMessage(aBox);lastMessage&&(aBox.lastMessage=getMessageAdaptorObject(lastMessage))}},getBoxObject=function(aHistoryBoxObject){var aBoxObject=angular.copy(aHistoryBoxObject),lastMessage=getBoxLastMessage(aBoxObject);if(lastMessage&&(aBoxObject.lastMessage=getMessageAdaptorObject(lastMessage)),aBoxObject.unreadCount=function(){return getBoxUnreadCount(aHistoryBoxObject)},aBoxObject.sortBy=function(){return this.lastMessage.messageDate},aBoxObject.isTagChat){var tagId=aHistoryBoxObject.key;tagChatFactory.getTag(tagId);aBoxObject.getTitle=function(){var tagObject=tagChatFactory.getTag(tagId);return tagObject?tagObject.getTagName():""},aBoxObject.getCover=function(){var tagObject=tagChatFactory.getTag(tagId);return tagObject?tagObject.getPictureFullUrl():""},aBoxObject.shouldVisible=function(){var tagObject=tagChatFactory.getTag(tagId);return tagObject?tagObject.isTagSafeToShow():!1}}else updateUserObject(aBoxObject,aBoxObject.key),aBoxObject.getTitle=function(){return aBoxObject.user.getName()},aBoxObject.getCover=function(){return aBoxObject.user.avatar("thumb")},aBoxObject.shouldVisible=function(){return!0};return aBoxObject};$scope.initBoxMessages=function(aBox){aBox.messages&&angular.forEach(aBox.messages,function(aBoxMessage,index){var aBoxMessage=getMessageAdaptorObject(aBoxMessage);$scope.recentMessages.add(aBoxMessage.key,aBoxMessage)})},$scope.initRecentMessages=function(){var currentUserBoxes=(Auth.currentUser().getKey(),chatHistoryFactory.getChatBoxes());currentUserBoxes&&angular.forEach(currentUserBoxes,function(aBox,key){var aBoxObject=getBoxObject(aBox);aBoxObject.lastMessage&&$scope.boxes.add(aBox.key,aBoxObject)})},$scope.clearRecentMessages=function(){$scope.recentMessages.clear()},$scope.openChatBox=function(boxId,isTagChat){utilsFactory.triggerCustomEvent(SystemEvents.CHAT.UNREAD_MESSAGE_INFO_UPDATED),isTagChat?ChatFactory.openTagChatBox(boxId):ChatFactory.openChatBox(boxId)},$scope.initRecentMessages(),$rootScope.chatHistoryReady||setTimeout(function(){$scope.ready=!0,$rootScope.chatHistoryReady=!0,$scope.$rgDigest(),rgScrollbarService.recalculate($scope)},3e3);var myTagListReceivedEventListener=utilsFactory.onCustomEvent("MY_TAG_LIST_RECEIVED",function(){$scope.$rgDigest()}),taglistupdatedEventListener=utilsFactory.onCustomEvent("taglistupdated",function(){$scope.$rgDigest()}),messageReceivedEventListener=utilsFactory.onCustomEvent(SystemEvents.CHAT.MESSAGE_RECEIVED,function(data){updateBoxLastMessageByBoxId(data.boxId),$scope.$rgDigest()}),newMessageSubmittedEventListener=utilsFactory.onCustomEvent(SystemEvents.CHAT.MESSAGE_SUBMITTED,function(data){updateBoxLastMessageByBoxId(data.boxId),$scope.$rgDigest()});$scope.$on("$destroy",function(){utilsFactory.removeCustomEvent("MY_TAG_LIST_RECEIVED",myTagListReceivedEventListener),utilsFactory.removeCustomEvent("taglistupdated",taglistupdatedEventListener),utilsFactory.removeCustomEvent(SystemEvents.CHAT.MESSAGE_SUBMITTED,newMessageSubmittedEventListener),utilsFactory.removeCustomEvent(SystemEvents.CHAT.MESSAGE_RECEIVED,messageReceivedEventListener)})}angular.module("ringid.chat").controller("ChatHistoryController",ChatHistoryController),ChatHistoryController.$inject=["$scope","$rootScope","ChatFactory","Storage","Auth","profileFactory","tagChatFactory","userFactory","utilsFactory","chatHistoryFactory","CHAT_GLOBAL_VALUES","TAG_CHAT_GENERAL_CONSTANTS","$$stackedMap","SystemEvents","rgScrollbarService"]}(),function(){"use strict";function ChatMediaUploadController($scope,fileUploadService,utilsFactory,$boxInstance){$scope.navSection=0,$scope.sendMedia=function(){if($scope.capturedMedia){var uploadFile=fileUploadService.queueFile("chatimage",utilsFactory.dataURLToBlob($scope.capturedMedia));utilsFactory.triggerCustomEvent("BOX_CAM_UPLOAD",{uploadFile:uploadFile}),$boxInstance.close()}}}angular.module("ringid.chat").controller("ChatMediaUploadController",ChatMediaUploadController),ChatMediaUploadController.$inject=["$scope","fileUploadService","utilsFactory","$boxInstance"]}(),function(){"use strict";function chatUtilsFactory(utilsFactory,settings,CHAT_STATES,CHAT_FLOWS,CHAT_STATE_INFO,CHAT_GLOBAL_VALUES,Auth){function getChatStateName(stateId){try{return CHAT_STATE_INFO[stateId].NAME}catch(e){}}var textParseForLinkAndEmo=function(text){return text=utilsFactory.parseForLE(text,0)},_getOfflineIpPort=function(){var loginData=Auth.loginData,oIpPort={ip:"",port:""};return loginData&&(oIpPort.ip=loginData.oIP,
oIpPort.port=loginData.oPrt),oIpPort},_hasOfflineIpPort=function(){var ipPort=_getOfflineIpPort();return!(!ipPort||!ipPort.ip||!ipPort.port)},getChatServerCurrentTime=function(){return parseInt((new Date).getTime()+CHAT_GLOBAL_VALUES.serverTimeDiff)};return{parseForLE:function(text){return textParseForLinkAndEmo(text)},getChatServerCurrentTime:getChatServerCurrentTime,getOfflineIpPort:_getOfflineIpPort,hasOfflineIpPort:_hasOfflineIpPort,getChatStateName:getChatStateName}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("chatUtilsFactory",chatUtilsFactory),chatUtilsFactory.$inject=["utilsFactory","settings","CHAT_STATES","CHAT_FLOWS","CHAT_STATE_INFO","CHAT_GLOBAL_VALUES","Auth"]}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("ChatFactory",["settings","CHAT_PACKET_FORMAT","ChatPacketSenderService","Storage","$window","$$stackedMap","ChatMap","Auth","utilsFactory","$rootScope","PacketDataParse","$timeout","globalSocketFactory","chatHistoryFactory","profileHttpService","userFactory","friendsFactory","tagChatPacketProcessor","tagChatApiService","tagChatFactory","$interval","$$connector","OPERATION_TYPES","CHAT_GLOBAL_VALUES","AUTH_SERVER_ACTIONS","CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","chatPacketResender","ChatApiService","PLATFORM","profileFactory",function(settings,CHAT_PACKET_FORMAT,ChatPacketSenderService,Storage,$window,$$stackedMap,ChatMap,Auth,utilsFactory,$rootScope,PacketDataParse,$timeout,globalSocketFactory,chatHistoryFactory,profileHttpService,userFactory,friendsFactory,tagChatPacketProcessor,tagChatApiService,tagChatFactory,$interval,$$connector,OPERATION_TYPES,CHAT_GLOBAL_VALUES,AUTH_SERVER_ACTIONS,CHAT_GENERAL_CONSTANTS,TAG_CHAT_PACKET_TYPE,FRIEND_CHAT_PACKET_TYPE,OFFLINE_PACKET_TYPE,chatPacketResender,ChatApiService,PLATFORM,profileFactory){var getUUIDPacketId=(chatPacketResender.ChatPacketSender,tagChatFactory.getUUIDPacketId),boxes=$$stackedMap.createNew(),getNumberOfAvailableChatBox=function(viewportXValue){if(viewportXValue)var avaiable_width=viewportXValue-400-165;else var avaiable_width=utilsFactory.viewport.x-400-165;var box_counter=$window.parseInt(avaiable_width/310);return box_counter},processInMessage=function(message){var friendId=message.friendName.split(",")[0],box=getBox(friendId);if(angular.isArray(message.messageList))for(var i=0;i<message.messageList.length;i++)box.pushMessage(message.messageList[i])},getBoxObjectClass=function(userId){var chatBoxClass={key:userId,isMinimized:!1,isHidden:!1,isFocused:!1,blinkOn:!1,timeout:5,secretChat:!1,nonDomBox:!1,closedBox:!1,offlineStatus:!1,blocked:!1,isSecretVisible:!0,singlePage:!1,lastSeenBar:!0,unreadCount:0,chatBoxClass:"chat-body-opened"};return chatBoxClass},getNewBoxObject=function(userId,isTagChat,boxInfo){userId=userId.toString(),boxInfo||(boxInfo={});var box=boxes.get(userId);if(box!==!1)return box;box=ChatMap.create(userId,isTagChat),isTagChat||(profileFactory.getUserObjectByUId(userId),profileHttpService.fetchPresence([userId]));var boxChatBoxObject=getBoxObjectClass(userId);return boxChatBoxObject.isFocused=!0,boxChatBoxObject.nonDomBox=!0,boxChatBoxObject.isTagChat=isTagChat,boxChatBoxObject.lastLogin=box.getUser()&&box.getUser().lastOnline?box.getUser().lastOnline():"",boxChatBoxObject=angular.extend(box,boxChatBoxObject,boxInfo)},getBox=function(userId,isTagChat){var box=getNewBoxObject(userId,isTagChat);return boxes.save(userId,box),chatHistoryFactory.addBox(box),box},openChatBox=function(userId,sendToTab){userId=userId.toString();var box=boxes.get(userId);box===!1?(box=getBox(userId,!1),$rootScope.$broadcast("chatOpened",{user:userId,sendToTab:sendToTab})):(box.nonDomBox||$rootScope.$broadcast("chatOpened",{user:userId,sendToTab:sendToTab}),box.isFocused=!0,box.nonDomBox=!0,box.blinkOn=!1,chatHistoryFactory.updateBox(box))},openTagChatBox=function(groupId,sendToTab){groupId=groupId.toString();var box=boxes.get(groupId);return box===!1?(box=getBox(groupId,!0),$rootScope.$broadcast("chatOpened",{user:groupId,sendToTab:sendToTab})):(box.nonDomBox||$rootScope.$broadcast("chatOpened",{user:groupId,sendToTab:sendToTab}),box.isFocused=!0,box.nonDomBox=!0,box.blinkOn=!1,chatHistoryFactory.updateBox(box)),box},createNonDomBox=function(userId,isTagChat){userId=userId.toString();var box=ChatMap.create(userId,isTagChat),boxChatBoxObject=getBoxObjectClass(userId);return boxChatBoxObject.closedBox=!0,boxChatBoxObject.isTagChat=isTagChat,boxChatBoxObject=angular.extend(box,boxChatBoxObject),boxes.save(userId,boxChatBoxObject),chatHistoryFactory.addBox(boxChatBoxObject),box},makeVisibleChatBox=function(userId){userId=userId.toString();var boxObject=boxes.get(userId);boxObject!==!1&&(boxes.remove(userId),boxes.save(userId,boxObject))},closeChatBox=function(userId){userId=userId.toString();var box=boxes.get(userId);box.closedBox=!0,chatHistoryFactory.updateBox(box),box.getIp()&&ChatPacketSenderService.sendChatUnRegisterPacket(box),box.stopInterval(),boxes.remove(userId)},closeTagChatBox=function(tagId){tagId=tagId.toString();var box=boxes.get(tagId);box.closedBox=!0,chatHistoryFactory.updateBox(box),box.stopInterval(),boxes.remove(tagId)},minimizeBox=function(userId){userId=userId.toString();var box=boxes.get(userId);box.isMinimized=!box.isMinimized,box.isMinimized?(box.isFocused=!1,box.chatBoxClass="chat-body"):(box.isFocused=!0,box.chatBoxClass="chat-body-opened"),chatHistoryFactory.updateBox(box)},refreshBox=function(boxId){chatHistoryFactory.loadChatBoxes();var historyBox=chatHistoryFactory.getBox(boxId),chatbox=boxes.get(boxId);if(chatbox)historyBox.closedBox?boxes.remove(boxId):(angular.extend(chatbox,historyBox),chatbox.loadHistoryMessages());else if(!historyBox.closedBox){var boxChatBoxObject=getNewBoxObject(boxId,historyBox.isTagChat,historyBox);boxes.save(boxId,boxChatBoxObject),boxChatBoxObject.loadHistoryMessages()}},openAndAddMessage=function(boxId,message){if(message){var currentUser=Auth.currentUser(),box=boxes.get(boxId);if(box)box.nonDomBox=!0,box.pushMessage(message,currentUser);else{if(message.tag_chat){var tag=tagChatFactory.getTag(boxId);tag.isTagSafeToShow()&&openTagChatBox(boxId)}else openChatBox(boxId);box=getBox(boxId,message.tag_chat),box.loadHistoryMessages()}utilsFactory.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:boxId,scroll:"bottom"})}};return{openChatBox:function(userId,sendToTab){openChatBox(userId,sendToTab)},openTagChatBox:openTagChatBox,closeTagChatBox:closeTagChatBox,creatNonDomBox:createNonDomBox,makeVisibleChatBox:makeVisibleChatBox,processInMessage:processInMessage,closeChatBox:closeChatBox,getBoxes:function(){return boxes.all()},ggg:function(){return boxes.nonClosedLength()},getBoxByUId:function(uId){return boxes.get(uId)},refreshBox:refreshBox,minimizeBox:minimizeBox,getNumberOfAvailableChatBox:function(viewportXValue){return getNumberOfAvailableChatBox(viewportXValue)},getNonClosedLength:function(){return boxes.nonClosedLength()},increaseUnreadMessageCount:function(boxId,messageId){chatHistoryFactory.addUnreadMessageInfo(boxId,messageId),chatHistoryFactory.updateUnreadMessageInfos()},decreaseUnreadMessageCount:function(boxId,messageId){chatHistoryFactory.removeUnreadMessageInfo(boxId,messageId),chatHistoryFactory.updateUnreadMessageInfos()},getUnreadMessageCount:function(){return chatHistoryFactory.getUnreadMessageCount()},getUUIDPacketId:getUUIDPacketId,openAndAddMessage:openAndAddMessage}}])}(),function(){"use strict";function ChatApiService($$connector,OPERATION_TYPES,Auth,FRIEND_CHAT_PACKET_TYPE,OFFLINE_PACKET_TYPE,globalSocketFactory,PacketDataParse,CHAT_GENERAL_CONSTANTS,tagChatFactory,AUTH_SERVER_ACTIONS,PLATFORM,utilsFactory,chatUtilsFactory){function _getPacket(requestObject,packetType,format){var packet=PacketDataParse.constructPacket(requestObject,packetType,format);return packet}function _logRequestedPacketInfo(packetName,packetObject){RingLogger.infoblack(packetName,packetObject,RingLogger.tags.CHAT_REQUEST)}var getUUIDPacketId=tagChatFactory.getUUIDPacketId,self=this;self.getFriendOnlineStatus=function(friendId){var presenceRequestObject={actn:OPERATION_TYPES.SYSTEM.PROFILE.TYPE_ACTION_USER_MOOD_PRESENCE,fndId:friendId};return $$connector.request(presenceRequestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.REQUEST)},self.requestForIp=function(friendId){var requestObject={actn:175,fndId:friendId,uId:Auth.loginData.uId};_logRequestedPacketInfo("AUTH "+requestObject.actn,requestObject),$$connector.send(requestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.CHAT)},self.getRegisterForFriendChatRequestObject=function(ip,port,userId,friendId){var registerObject={ip:ip,port:port,packetType:FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_REGISTER,packetId:tagChatFactory.getUUIDPacketId(),userId:userId,friendId:friendId,platform:PLATFORM.WEB};return registerObject};self.getBlankMessageObject=function(friendId){var ipPort=chatUtilsFactory.getOfflineIpPort(),currentUserId=Auth.currentUser().getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),packetId=getUUIDPacketId(messageDate),messageType=CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE,packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG,blankMessageObject={ip:ipPort.ip,port:ipPort.port,packetType:packetType,userId:currentUserId,friendId:friendId,tag_chat:!1,messageType:messageType,message:"",messageDate:messageDate,key:packetId,packetId:packetId,timeout:0,platform:PLATFORM.WEB};return blankMessageObject},self.getFriendInformationPacketObject=function(friendId,friendFullName,friendPlatfrom,friendOnlineStatus,friendAppType,friendDeviceToken,friendMood){var ipPort=chatUtilsFactory.getOfflineIpPort(),currentUserId=Auth.currentUser().getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),packetId=getUUIDPacketId(messageDate),packetType=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_INFORMATION,friendInformationObject={ip:ipPort.ip,port:ipPort.port,packetType:packetType,userId:currentUserId,friendId:friendId,packetId:packetId,fullName:friendFullName,platform:friendPlatfrom,onlineStatus:friendOnlineStatus,friendAppType:friendAppType,friendDeviceToken:friendDeviceToken,userMood:friendMood};return friendInformationObject},self.getIdlePacketObject=function(box){var ip=box.getIp(),port=box.getPort(),currentUserId=Auth.currentUser().getKey(),friendId=box.getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),packetId=getUUIDPacketId(messageDate),packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_IDLE,idlePacketObject={ip:ip,port:port,packetType:packetType,userId:currentUserId,friendId:friendId,packetId:packetId,platform:PLATFORM.WEB};return idlePacketObject},self.getTypingPacketObject=function(box){var ip=box.getIp(),port=box.getPort(),currentUserId=Auth.currentUser().getKey(),friendId=box.getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),packetId=getUUIDPacketId(messageDate),packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_TYPING,typingPacketObject={ip:ip,port:port,packetType:packetType,userId:currentUserId,friendId:friendId,packetId:packetId,platform:PLATFORM.WEB};return typingPacketObject},self.getF2FUnRegisterObject=function(box){var ip=box.getIp(),port=box.getPort(),currentUserId=Auth.currentUser().getKey(),friendId=box.getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),packetId=getUUIDPacketId(messageDate),packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_UNREGISTER_PKT,unregisterObject={ip:ip,port:port,packetType:packetType,packetId:packetId,userId:currentUserId,friendId:friendId,onlineStatus:0,userMood:0};return unregisterObject},self.getF2FMessageDeleteObject=function(box,packetId){var ip=box.getIp(),port=box.getPort(),currentUserId=Auth.currentUser().getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),friendId=box.getKey();FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_TYPING;if(1==box.offlineStatus){var offlineIpPort=chatUtilsFactory.getOfflineIpPort();ip=offlineIpPort.ip,port=offlineIpPort.port}var deleteObject={ip:ip,port:port,packetId:packetId,packetType:FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MULTIPLE_MSG_DELETE,userId:currentUserId,friendId:friendId,noOfMessages:1,packetIds:[packetId],messageDate:messageDate,platform:PLATFORM.WEB};return deleteObject},self.getOfflineIpPort=function(){var currentUserId=Auth.currentUser().getKey(),requestObject={actn:AUTH_SERVER_ACTIONS.GET_OFFLINE_IP_PORT,rid:currentUserId};return $$connector.request(requestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.REQUEST)},self.sendViaGlobalChatSocket=function(requestObject,formatInfo){var requestObjectPacket=_getPacket(requestObject,formatInfo.PACKET_TYPE,formatInfo.FORMAT);return requestObjectPacket&&globalSocketFactory.send(requestObjectPacket),4!=formatInfo.PACKET_TYPE&&5!=formatInfo.PACKET_TYPE&&_logRequestedPacketInfo(formatInfo.PACKET_NAME,requestObject),requestObjectPacket}}angular.module("ringid.chat").service("ChatApiService",ChatApiService),ChatApiService.$inject=["$$connector","OPERATION_TYPES","Auth","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","globalSocketFactory","PacketDataParse","CHAT_GENERAL_CONSTANTS","tagChatFactory","AUTH_SERVER_ACTIONS","PLATFORM","utilsFactory","chatUtilsFactory"]}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("ChatMap",["$$stackedMap","$interval","CHAT_PACKET_FORMAT","globalSocketFactory","userFactory","utilsFactory","$websocket","$rootScope","$sce","Auth","tagChatFactory","profileFactory","chatHistoryFactory","PacketDataParse","settings","tagChatApiService","TAG_CHAT_GENERAL_CONSTANTS","tagChatHelper","tagChatStorage","CHAT_GLOBAL_VALUES","CHAT_GENERAL_CONSTANTS","chatUtilsFactory","rgScrollbarService","chatTabSync","ChatPacketSenderService",function($$stackedMap,$interval,CHAT_PACKET_FORMAT,globalSocketFactory,userFactory,utilsFactory,$websocket,$rootScope,$sce,Auth,tagChatFactory,profileFactory,chatHistoryFactory,PacketDataParse,settings,tagChatApiService,TAG_CHAT_GENERAL_CONSTANTS,tagChatHelper,tagChatStorage,CHAT_GLOBAL_VALUES,CHAT_GENERAL_CONSTANTS,chatUtilsFactory,rgScrollbarService,chatTabSync,ChatPacketSenderService){var getBasicMessageObject=function(message){var key=message.key||message.packetId,mdate=message.messageDate||(new Date).getTime(),basicMsgObj={key:key.toString(),packetId:key.toString(),text:message.message||message.mg||message.text,hrtime:utilsFactory.chatVerbalDate(mdate),status:message.status||0,fullName:message.fullName,tagName:message.tagName||"",messageDate:mdate,isDeleted:!1,messageDateString:message.messageDateString||"",timeout:message.timeout,messageType:message.messageType,tag_chat:message.tag_chat||!1,seenSent:message.seenSent||!1,isSecretVisible:message.isSecretVisible,secretTimedOut:message.secretTimedOut?message.secretTimedOut:!1,lastUpdateTime:(new Date).getTime(),platform:5};return message.tag_chat?(basicMsgObj.packetType=message.packetType||63,basicMsgObj.brokenPacketType=message.brokenPacketType):(basicMsgObj.packetType=message.packetType||6,basicMsgObj.brokenPacketType=message.brokenPacketType),basicMsgObj};return{create:function(userId,isTagChat){var returnob,intervalVar,tagItem,tagId,user,boxId=userId;isTagChat?(tagId=userId,tagItem=tagChatFactory.getTag(tagId)):user=userFactory.create({uId:userId});var ip,port,connection,rPort,rConnection,isTyping=!1,isFriendTyping=!1,lastCommunicationTime=0,tempMessageArray=[],tempSeenMessageArray=[],messages=$$stackedMap.createNew(!0,"asc"),pushMessage=function(message,user,sendToTab){var tempmesg;if(message.type&&101===message.type)return void(isTyping=!0);if(0==message.type&&0===message.status)return tempmesg=messages.get(messages.packetId),void(tempmesg.isDeleted=!0);var parsedMessageText="",basicMsgObj=getBasicMessageObject(message);angular.isObject(user)||(user=profileFactory.getUserObjectByUId(message.userId,function(){utilsFactory.triggerCustomEvent("SINGLE_MESSAGE_UPDATED",{message:basicMsgObj})}));var msgObj={locationInfo:{},ogData:{},seenUserIds:{},deliveredUserIds:{},user:user,sortBy:function(){return message.messageDate},getTextPartition:function(){return parsedMessageText},setTextPartition:function(){parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text),parsedMessageText=$sce.trustAsHtml(parsedMessageText)},getMessageTime:function(){var localTime=message.messageDate-CHAT_GLOBAL_VALUES.serverTimeDiff,localFormatedTime=utilsFactory.chatVerbalDate(localTime);return localFormatedTime},seenUsersCount:function(){return Object.keys(msgObj.seenUserIds).length},deliveredUsersCount:function(){return Object.keys(msgObj.deliveredUserIds).length},addSeenUserId:function(userId){msgObj.seenUserIds[userId]=!0},addDeliveredUserId:function(userId){msgObj.deliveredUserIds[userId]=!0,RingLogger.print(msgObj,RingLogger.tags.CHAT),RingLogger.print(msgObj,RingLogger.tags.CHAT)},updateLocationInfo:function(){var locationInfo,latitude,longitude;try{locationInfo=angular.fromJson(msgObj.text),latitude=locationInfo.la,longitude=locationInfo.lo,msgObj.locationInfo={lat:latitude,"long":longitude,description:locationInfo.loc},msgObj.plainText=locationInfo.loc}catch(e){}},updateLinkShareInfo:function(){msgObj.ogData={};try{var messageLinkJson=angular.fromJson(msgObj.text);msgObj.ogData={lnkDmn:messageLinkJson.u,description:messageLinkJson.d,title:messageLinkJson.t,url:messageLinkJson.u,image:messageLinkJson.i,message:messageLinkJson.m},msgObj.plainText=messageLinkJson.m}catch(e){}},updateMediaInfo:function(){var mediaInfo;try{mediaInfo=angular.fromJson(msgObj.text),msgObj.mediaInfo={url:mediaInfo.u,caption:mediaInfo.c,width:mediaInfo.w,height:mediaInfo.h},msgObj.plainText=mediaInfo.c}catch(e){}}};if(angular.extend(msgObj,basicMsgObj),message.userId=msgObj.userId=msgObj.user.getKey(),message.usersToChange&&(msgObj.usersToChange=message.usersToChange),message.statusType&&(msgObj.statusType=message.statusType),"status_update"!==message.status)if(1!=message.secretTimedOut&&"Deleted"===message.status)msgObj.messageType=2,parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text);else switch(message.messageType){case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.TEXT:parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text);break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LOCATION_SHARE:msgObj.updateLocationInfo();var latitude=msgObj.locationInfo.lat,longitude=msgObj.locationInfo["long"];0!=latitude&&0!=longitude?(msgObj.mapStaticUrl=utilsFactory.getGoogleMapStaticUrl(latitude,longitude),msgObj.mapJsUrl=utilsFactory.getGoogleMapJSUrl(latitude,longitude)):parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text);break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LINK_SHARE:msgObj.updateLinkShareInfo();break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.STICKER:msgObj.stickerUrl=settings.stickerBase+msgObj.text;break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.IMAGE:case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.CAMERA_IMAGE:msgObj.updateMediaInfo();try{msgObj.mediaUrl=settings.imBase+msgObj.mediaInfo.url}catch(e){msgObj.mediaUrl=""}parsedMessageText="";break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.AUDIO:msgObj.updateMediaInfo(),msgObj.isVideo=!1;try{msgObj.mediaUrl=settings.mediaBase+msgObj.mediaInfo.url}catch(e){msgObj.mediaUrl=""}break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.VIDEO:msgObj.updateMediaInfo(),msgObj.isVideo=!0;try{msgObj.mediaUrl=settings.mediaBase+msgObj.mediaInfo.url}catch(e){msgObj.mediaUrl=""}break;default:parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text)}else if(message.usersToChange&&(parsedMessageText=tagChatHelper.getTagChatStatusMessage(message),!parsedMessageText))return;parsedMessageText=$sce.trustAsHtml(parsedMessageText),messages.save(msgObj.key,msgObj),message.fromLocalHistory||updateBoxMessageMinMaxPacketId(msgObj);var boxId=userId.toString();chatHistoryFactory.addMessage(msgObj,boxId),sendToTab&&chatTabSync.sendData(CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:boxId,msg:basicMsgObj,isTagChat:message.tag_chat})},pushDummyMessage=function(message,user){var key=message.key||message.packetId,mdate=message.messageDate-CHAT_GLOBAL_VALUES.serverTimeDiff||(new Date).getTime(),parsedMessageText=[],msgObj={key:key,text:message.message||message.mg||message.text,hrtime:utilsFactory.chatVerbalDate(mdate),status:message.status||0,messageType:message.messageType,uploading:message.uploading,uploadProgress:message.uploadProgress,messageDate:mdate,isDeleted:!1,messageDateString:message.messageDateString||"",mediaUrl:message.mediaUrl,timeout:message.timeout,isSecretVisible:message.isSecretVisible,user:angular.isObject(user)?user:userFactory.getUser(message.userId),lastUpdateTime:(new Date).getTime(),sortBy:function(){return message.messageDate},getTextPartition:function(){return parsedMessageText},setTextPartition:function(){parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text),parsedMessageText=$sce.trustAsHtml(parsedMessageText)}};parsedMessageText=chatUtilsFactory.parseForLE(msgObj.text),parsedMessageText=$sce.trustAsHtml(parsedMessageText),messages.save(msgObj.key,msgObj)},processMessage=function(message,friendId){},setConnection=function(currUserId){connection&&connection.socket===!0&&connection.close(!0),connection=$websocket("ws://"+ip+":"+port+"/"+currUserId+"/"+utilsFactory.getToken),connection.socket.binaryType="arraybuffer",connection.onMessage(function(messageEvent){$rootScope.$broadcast("chatDataReceived",{box:returnob,messageEvent:messageEvent})}),connection.onClose(function(messageEvent){RingLogger.print("socket closed",RingLogger.tags.CHAT),RingLogger.print("socket closed from chat box factory:note: this is not in use",RingLogger.tags.CHAT)})},updateBoxMessageMinMaxPacketId=function(aMessageObject){var box=returnob,packetId=aMessageObject.key||aMessageObject.packetId;if("status_update"==aMessageObject.status)try{packetId=packetId.split("_")[0]}catch(e){RingLogger.alert("History PacketID Split Error",RingLogger.tags.CHAT)}box.messageMaxDate<aMessageObject.messageDate&&(box.messageMaxDate=aMessageObject.messageDate,box.messageMaxPacketId=packetId),(!box.messageMinDate||box.messageMinDate>=aMessageObject.messageDate)&&(box.messageMinDate=aMessageObject.messageDate,box.messageMinPacketId=packetId)};return returnob={ip:ip,port:port,rPort:rPort,lastCommunicationTime:lastCommunicationTime,waitingTime:160,tempMessageArray:tempMessageArray,tempSeenMessageArray:tempSeenMessageArray,boxTitle:"",unreadCount:0,messageMaxPacketId:"",messageMinPacketId:"",messageMaxDate:0,messageMinDate:0,hasHistoryMessage:!1,messages:messages.all(),getTitleString:function(){var box=returnob,title=box.getTitle();return isTagChat||title||(title=box.getKey()),box.unreadCount>0&&(title=title+" ("+box.unreadCount+")"),title},updateUnreadCount:function(){var box=returnob;box.unreadCount=chatHistoryFactory.getUnreadMessageCountByBoxId(boxId)},getProfileLink:function(){var box=returnob;return box.isTagChat?void 0:"/profile/"+box.getUser().getKey()},checkWaitingTimePassed:function(){var currentTime=Math.floor(Date.now()/1e3);return currentTime-this.lastCommunicationTime>this.waitingTime},hasIpPort:function(){return!!returnob.ip&&!!returnob.port},updateLastCommunicationTime:function(){returnob.lastCommunicationTime=Math.floor(Date.now()/1e3)},pushMessage:function(message,user,sendToTab){pushMessage(message,user,sendToTab)},pushDummyMessage:function(message,user){pushDummyMessage(message,user)},sendTabUpdate:function(message){var basicMsgObj=getBasicMessageObject(message);chatTabSync.sendData(CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.CHAT_MSESSAGE_UPDATE,{boxId:boxId,msg:basicMsgObj,isTagChat:message.tag_chat})},processMessage:function(message,friendId){processMessage(message,friendId)},getKey:function(){return userId.toString()},getTagItem:function(){return tagItem},getUser:function(){return tagItem?tagItem:user},getTitle:function(){return tagItem?this.boxTitle=tagItem.getTagName():user&&(this.boxTitle=user.getName()),this.boxTitle},setTitle:function(tagTitleForNonInitingUser){this.boxTitle=tagTitleForNonInitingUser},isConsicutive:function(messageKey){var currentMessage=messages.get(messageKey),previousMessage=messages.previous(messageKey);return!(!previousMessage||"status_update"==previousMessage.status||previousMessage.user.getKey()!==currentMessage.user.getKey())},isSamePacketId:function(messageKey){return!!messages.get(messageKey.toString())},getMessages:function(){return messages.all()},getMessage:function(key){return messages.get(key.toString())},getBottomMessage:function(){return messages.bottom()},getTopMessage:function(){return messages.top()},removeMessage:function(key){messages.remove(key.toString())},updateMessageStatus:function(messageKey,status){var messageObject=messages.get(messageKey);return messageObject?(messageObject.status=status,messageObject):!1},isTyping:function(){return isTyping},setTypingBool:function(bool){isTyping=bool},isFriendTyping:function(){return isFriendTyping},setFriendTypingBool:function(bool){isFriendTyping=bool},setIp:function(ip){this.ip=ip},getIp:function(){return this.ip},setPort:function(port){this.port=port},getPort:function(){return this.port},setRPort:function(rPort){this.rPort=rPort},getRPort:function(){return this.rPort},setIpPort:function(ipAdd,Rport,currUserId){ip=ipAdd,port=Rport,setConnection(currUserId)},setRegisterConnection:function(userSocket){rConnection=userSocket},connect:function(){return connection=$websocket("ws://"+ip+":"+port)},getConnection:function(){return connection},getRConnection:function(){return rConnection},isBoxBindingPortValid:function(){var box=returnob,diff=Math.floor(Date.now()/1e3)-box.lastCommunicationTime;return diff>10&&diff<box.waitingTime},getRemainingRegisteredTime:function(){var box=returnob;return box.waitingTime-(Math.floor(Date.now()/1e3)-box.lastCommunicationTime)},initInterval:function(){intervalVar&&this.stopInterval(),intervalVar=$interval(function(){var box=returnob,currentTime=Math.floor(Date.now()/1e3),diff=currentTime-box.lastCommunicationTime;RingLogger.print("background idle packet init called:"+currentTime+":"+diff+":"+returnob.getKey()+":"+intervalVar.$$intervalId,RingLogger.tags.CHAT),diff>10&&diff<box.waitingTime?(ChatPacketSenderService.sendIdlePacket(box),RingLogger.print("idle packet sent as interval"+currentTime+":"+diff+":"+returnob.getKey()+":"+intervalVar.$$intervalId,RingLogger.tags.CHAT)):diff>box.waitingTime&&box.stopInterval()},15e3)},stopInterval:function(){angular.isDefined(intervalVar)&&(RingLogger.print("interval stopped:"+intervalVar.$$intervalId,RingLogger.tags.CHAT),$interval.cancel(intervalVar))},startTimer:function(){var box=returnob,messages=box.getMessages();if(angular.isArray(messages)&&messages.length>0)for(var m=0;m<messages.length;m++)if(messages[m].value.timeout>0&&0==box.isMinimized&&0==box.isHidden&&!messages[m].value.timerStartFlag)switch(messages[m].value.messageType){case 2:case 3:case 4:case 5:case 6:var timeoutCount=messages[m].value.timeout,mes=messages[m].value;mes.key=mes.packetId,messages[m].value.timerStartFlag=!0;var testTimeoutDeleteFunc=function(me,timeoutCount){RingLogger.print("tT: "+timeoutCount+":meKey:"+me.key,RingLogger.tags.CHAT),$rootScope.$broadcast("timeoutDelete",me.key,timeoutCount)};!function(mes,timeoutCount){$interval(function(){testTimeoutDeleteFunc(mes,timeoutCount--)},1e3,timeoutCount+1)}(mes,timeoutCount)}},send:function(msgObj){connection?(RingLogger.print("connectionState: "+connection.readyState,RingLogger.tags.CHAT),1!==connection.readyState||connection.socket.send(msgObj)):RingLogger.print("connection not ready yet",RingLogger.tags.CHAT)},rSend:function(msgObj){RingLogger.print("Register connectionState: "+rConnection.readyState,RingLogger.tags.CHAT),rConnection.socket.send(msgObj)},updateBoxMessageMinMaxPacketId:updateBoxMessageMinMaxPacketId,loadHistoryMessages:function(){var box=returnob,historyMessages=chatHistoryFactory.getMessages(boxId);if(historyMessages)for(var h=0;h<historyMessages.length;h++){var aHistoryMessage=historyMessages[h];updateBoxMessageMinMaxPacketId(aHistoryMessage),aHistoryMessage.fromLocalHistory=!0,pushMessage(aHistoryMessage,profileFactory.getUserObjectByUId(aHistoryMessage.user))}box.updateUnreadCount(),utilsFactory.triggerCustomEvent("CHAT_HISTORY_LOADED",{boxId:boxId})}}}}}])}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){chatApp=angular.module("ringid.chat",["ringid.config","ringid.common.stacked_map","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}chatApp.factory("globalSocketFactory",["settings","$websocket","utilsFactory","PacketDataParse","$rootScope","$timeout","tagChatPacketProcessor",function(settings,$websocket,utilsFactory,PacketDataParse,$rootScope,$timeout,tagChatPacketProcessor){var globalSocket,logRequestData=function(data){};return{initiate:function(){if(angular.isObject(globalSocket))return void(globalSocket.isOpen()||0===globalSocket.readyState||(RingLogger.print("Global ChatSocket: socket reconnected",RingLogger.tags.CHAT),globalSocket.reconnect()));try{globalSocket=$websocket(settings.socketProtocol+settings.siteUrl+"/ChatSocket"),globalSocket.onError(function(error){RingLogger.print("Global ChatSocket: Conneciton Error",RingLogger.tags.CHAT),RingLogger.alert(error,RingLogger.tags.CHAT)}),globalSocket.onClose(function(event){RingLogger.print("Glbal ChatSocket: socket Closed",RingLogger.tags.CHAT)}),globalSocket.onOpen(function(){RingLogger.print("Global ChatSocket: socket initiated and opened",RingLogger.tags.CHAT)}),globalSocket.onMessage(function(messageEvent){RingLogger.print("byteLength ",messageEvent.data.byteLength,RingLogger.tags.TAG_CHAT),RingLogger.print("chat packet length : "+messageEvent.data.byteLength,"SOCKETTEST");var arrayBuffer=ArrayBuffer.prototype.slice.call(messageEvent.data,8),packetType=PacketDataParse.getPacketType(arrayBuffer);RingLogger.print("Global ChatSocket: socket Message received; PacketType:"+packetType,RingLogger.tags.CHAT),$rootScope.$broadcast("chatDataReceived",{byteData:arrayBuffer})})}catch(e){RingLogger.alert("Global ChatSocket: Error while initializing chatSocket",RingLogger.tags.CHAT),RingLogger.alert(e,RingLogger.tags.CHAT)}},send:function(data){var sendFunction=function(data){if(globalSocket&&globalSocket.isOpen())logRequestData(data),globalSocket.send(data);else try{RingLogger.print("Global ChatSocket not connected yet",RingLogger.tags.CHAT),globalSocket.send(data)}catch(e){RingLogger.alert("Global ChatSocket :chat sendFunction()",RingLogger.tags.CHAT)}};globalSocket&&globalSocket.isOpen()?sendFunction(data):(this.initiate(),$timeout(sendFunction.bind(null,data),2e3,!0))},gs:function(){return globalSocket},reConnect:function(){globalSocket.isOpen()||globalSocket.reConnect()}}}])}(),function(){"use strict";function ChatHelper(SystemEvents,ChatFactory,ChatPacketSenderService,OPERATION_TYPES,PacketDataParse,CHAT_PACKET_FORMAT,globalSocketFactory,Auth,$interval,CHAT_GENERAL_CONSTANTS,tagChatManager,PullerSubscriber,ChatApiService,utilsFactory,chatHistoryFactory,profileFactory){function _getOfflineUpdateTime(){}function _setOfflineUpdateTime(){}function _decreaseUnreadCount(box,number){number?box.unreadCount-number>0?box.unreadCount-=number:box.unreadCount-number<0?box.unreadCount=0:box.unreadCount=0:_resetUnreadCount(box),chatHistoryFactory.updateBox(box),chatHistoryFactory.removeUnreadMessageInfoByBoxId(box.getKey()),utilsFactory.triggerCustomEvent("SINGLE_BOX_UPDATED",{box:box})}function _resetUnreadCount(box){box.unreadCount=0}function _increaseUnreadCount(box,number){box&&box.isFocused===!1&&(box.unreadCount+=number)}function _deleteMessageFromOwn(box,message){if(box&&message.key){box.removeMessage(message.key),chatHistoryFactory.removeMessage(message.key,box.getKey());for(var messages=box.getMessages(),k=0,length=messages.length;length>k;k++)messages[k].value.showDate=messages[k].value.takeDecisionForShowingDate(),messages[k].value.showAvator=messages[k].value.takeDecisionForShowingMessageUserAvator();
utilsFactory.triggerCustomEvent("SINGLE_BOX_UPDATED",{box:box})}}function _startTimerText(scope,messages){if(messages.length<1)return void RingLogger.print("No message to start Timer",RingLogger.tags.CHAT);for(var m=0,l=messages.length;l>m;m++)if(messages[m].value.timeout>0&&!messages[m].value.timerStartFlag)switch(messages[m].value.messageType){case 2:case 3:case 4:case 5:case 6:var timeoutCount=messages[m].value.timeout,mes=messages[m].value;messages[m].value.timerStartFlag=!0;var testTimeoutDeleteFunc=function(me,timeoutCount){RingLogger.print("tT: "+timeoutCount+":meKey:"+me.key,RingLogger.tags.CHAT),scope.$broadcast("timeoutDelete",me.key,timeoutCount)};!function(mes,timeoutCount){$interval(function(){testTimeoutDeleteFunc(mes,timeoutCount--)},1e3,timeoutCount+1)}(mes,timeoutCount)}}function _startTimerOthers(scope,message){if(!message[0].value)return void RingLogger.print("No message to start Timer",RingLogger.tags.CHAT);if(message[0].value.timeout>0&&!message[0].value.timerStartFlag)switch(message[0].value.messageType){case 7:case 8:case 9:case 10:var timeoutCount=message[0].value.timeout,mes=message[0].value;message[0].value.timerStartFlag=!0;var testTimeoutDeleteFunc=function(me,timeoutCount){RingLogger.print("tT: "+timeoutCount+":meKey:"+me.key,RingLogger.tags.CHAT),scope.$broadcast("timeoutDelete",me.key,timeoutCount)};!function(mes,timeoutCount){$interval(function(){testTimeoutDeleteFunc(mes,timeoutCount--)},1e3,timeoutCount+1)}(mes,timeoutCount)}}function _updateBoxSessionIfRequired(boxId,box){box||(box=ChatFactory.getBoxByUId(boxId)),box.checkWaitingTimePassed()&&(box.isTagChat?tagChatManager.requestForIp(boxId):PullerSubscriber.requestForIp(boxId))}function _updateFriendPresence(friendId,box){_getOnlineStatus(friendId).then(function(jsonPresence){box||(box=ChatFactory.getBoxByUId(friendId)),jsonPresence.sucs&&jsonPresence.psnc==CHAT_GENERAL_CONSTANTS.USER_PRESENCE.ONLINE?box.offlineStatus=!1:box.offlineStatus=!0})}function _sendChatSeenConfirmation(ip,port,userId,friendId,packetId){var seenConfirmationObject={ip:ip,port:port,packetType:18,packetId:packetId,userId:userId,friendId:friendId,platform:5},seenConfirmationPacket=PacketDataParse.constructPacket(seenConfirmationObject,18,CHAT_PACKET_FORMAT.SEEN_PKT_CONFIRM.FORMAT);seenConfirmationPacket&&globalSocketFactory.send(seenConfirmationPacket)}function _registerForFriendChat(ip,port,userId,friendId){var registerObject=ChatApiService.getRegisterForFriendChatRequestObject(ip,port,userId,friendId),registerPacket=PacketDataParse.constructPacket(registerObject,1,CHAT_PACKET_FORMAT.REGISTER_PKT.FORMAT);registerPacket&&globalSocketFactory.send(registerPacket)}function _getOnlineStatus(friendId){return ChatApiService.getFriendOnlineStatus(friendId)}function _hasChatFriendSession(friendId,box){return box||(box=ChatFactory.getBoxByUId(friendId)),!box.checkWaitingTimePassed()}function _executeAfterRegisterEvent(friendId,func,args,immidiate){if(immidiate)func.call(null,args);else{var eventHandler=function(event){event.data.friendId.toString()===friendId.toString()&&(func.call(null,args),document.removeEventListener(SystemEvents.CHAT.CHAT_REGISTER,eventHandler))};document.addEventListener(SystemEvents.CHAT.CHAT_REGISTER,eventHandler)}}function _sendAfterRegisterIdlePacket(boxId,box){box||(box=ChatFactory.getBoxByUId(boxId));var counter=0,lastIncrement=1,hitValue=1,idleIntervalKey=setInterval(function(){lastIncrement>15&&(clearInterval(idleIntervalKey),box.initInterval()),counter&&counter!=hitValue||(ChatPacketSenderService.sendIdlePacket(box),lastIncrement++,hitValue+=lastIncrement),counter++},1e3)}function _loadHistoryMessageForF2FChat(boxId,box){box||(box=ChatFactory.getBoxByUId(boxId)),box&&box.loadHistoryMessages()}return{executeAfterRegisterEvent:_executeAfterRegisterEvent,hasChatFriendSession:_hasChatFriendSession,getOnlineStatus:_getOnlineStatus,getOfflineUpdateTime:_getOfflineUpdateTime,setOfflineUpdateTime:_setOfflineUpdateTime,updateFriendPresence:_updateFriendPresence,registerForFriendChat:_registerForFriendChat,sendChatSeenConfirmation:_sendChatSeenConfirmation,updateBoxSessionIfRequired:_updateBoxSessionIfRequired,sendAfterRegisterIdlePacket:_sendAfterRegisterIdlePacket,startTimerText:_startTimerText,startTimerOthers:_startTimerOthers,decreaseUnreadCount:_decreaseUnreadCount,increaseUnreadCount:_increaseUnreadCount,deleteMessageFromOwn:_deleteMessageFromOwn,loadHistoryMessageForF2FChat:_loadHistoryMessageForF2FChat}}angular.module("ringid.chat").factory("ChatHelper",ChatHelper),ChatHelper.$inject=["SystemEvents","ChatFactory","ChatPacketSenderService","OPERATION_TYPES","PacketDataParse","CHAT_PACKET_FORMAT","globalSocketFactory","Auth","$interval","CHAT_GENERAL_CONSTANTS","tagChatManager","PullerSubscriber","ChatApiService","utilsFactory","chatHistoryFactory","profileFactory"]}(),function(){"use strict";function ChatSeenSend(PullerSubscriber,ChatFactory,chatHistoryFactory,utilsFactory,Auth,tagChatApiService,tagChatFactory,tagChatManager,CHAT_GLOBAL_VALUES,ChatHelper,CHAT_GENERAL_CONSTANTS,tagChatHelper,chatPacketResender,FRIEND_CHAT_PACKET_TYPE,$q,TAG_CHAT_PACKET_TYPE,chatUtilsFactory){var executeAfterTagRegisterEvent=tagChatHelper.executeAfterTagRegisterEvent,registerTag=tagChatManager.registerTag,USER_PRESENCE=CHAT_GENERAL_CONSTANTS.USER_PRESENCE,ChatPacketResender=chatPacketResender.ChatPacketResender,ChatPacketSender=chatPacketResender.ChatPacketSender,_sendSeenPacket=function(box,messages){if(messages.length<1)return void RingLogger.print("No message to send seen packet",RingLogger.tags.CHAT);var currentUserId=Auth.loginData.uId,seenPartialMsgObjects=getSeenPartialMsgObjects(messages),isTagChat=box.isTagChat;if(isTagChat){var tagId=box.getKey(),isRegisterNeeded=registerTag(tagId,1);executeAfterTagRegisterEvent(tagId,function(){sendTagChatSeenPackets(currentUserId,tagId,seenPartialMsgObjects)},null,!isRegisterNeeded)}else{var friendId=box.getKey(),packetId=utilsFactory.getUniqueID("cseen"),isOffline=box.offlineStatus,hasSentSeenPackets=!1,hasChatFriendSession=ChatHelper.hasChatFriendSession(friendId,box);hasChatFriendSession?isOffline?sendF2fSeenPacketOffline(friendId,seenPartialMsgObjects,packetId):sendF2fSeenPacketOnline(box.ip,box.port,friendId,seenPartialMsgObjects,packetId):PullerSubscriber.requestForIp(friendId,!0).then(function(response){hasSentSeenPackets||(response.sucs===!0&&response.psnc==USER_PRESENCE.ONLINE?(ChatHelper.registerForFriendChat(box.ip,box.rPort,currentUserId,friendId),ChatHelper.executeAfterRegisterEvent(friendId,function(){hasSentSeenPackets=!0,sendF2fSeenPacketOnline(box.ip,box.port,friendId,seenPartialMsgObjects,packetId)},null,hasChatFriendSession)):sendF2fSeenPacketOffline(friendId,seenPartialMsgObjects,packetId))})}},_updateMessageSeenSentProperty=function(boxId,seenPartialMsgObjects){for(var box=ChatFactory.getBoxByUId(boxId),messagesToUpdate=[],index=0;index<seenPartialMsgObjects.length;index++)if(box){var aMessage=box.getMessage(seenPartialMsgObjects[index].key);aMessage&&(aMessage.seenSent=!0,messagesToUpdate.push(aMessage))}chatHistoryFactory.updateMessages(messagesToUpdate,boxId)},_doSendATagChatSeenPacketMultipleTimes=function(userId,friendId,packetId,tagObject){var aChatResender;aChatResender=new ChatPacketResender,aChatResender.setPacketType(TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN),aChatResender.setPacketId(packetId),aChatResender.on("send",function(){tagChatApiService.sendTagMsgSeenPacket(userId,tagObject,friendId,packetId)}),aChatResender.start()},sendTagChatSeenPackets=function(userId,tagId,seenPartialMsgObjects){var tagObject=tagChatFactory.getTag(tagId),currentUserId=Auth.loginData.uId;if(tagObject){for(var index=0;index<seenPartialMsgObjects.length;index++){var packetId=seenPartialMsgObjects[index].key,friendId=seenPartialMsgObjects[index].senderId;try{_doSendATagChatSeenPacketMultipleTimes(currentUserId,friendId,packetId,tagObject)}catch(e){RingLogger.alert("Tag Seen Sending  Exception ",e,RingLogger.tags.TAG_CHAT)}}_updateMessageSeenSentProperty(tagId,seenPartialMsgObjects)}else RingLogger.print("TagSeen packet not send, tagObject not found.")},sendChatSeenPackets=function(ip,port,friendId,seenPartialMsgObjects,packetId){for(var defer=$q.defer(),seenObject={ip:ip,port:port,packetId:packetId,packetType:17,userId:Auth.loginData.uId,friendId:friendId,messages:[],platform:5},messageDate=parseInt((new Date).getTime()+CHAT_GLOBAL_VALUES.serverTimeDiff),index=0;index<seenPartialMsgObjects.length;index++)seenObject.messages[index]={packetId:seenPartialMsgObjects[index].key,messageDate:messageDate,status:getStatusByMessageType(seenPartialMsgObjects[index].messageType)};var aChatSender,aChatSenderInstance;return aChatSender=new ChatPacketSender,aChatSender.setPacketObject(seenObject),aChatSender.setBrokenPacketType(FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN),aChatSenderInstance=aChatSender.getInstance(),aChatSenderInstance.on("success",function(response){RingLogger.print("F2F Seen packet Success",RingLogger.tags.CHAT),_updateMessageSeenSentProperty(friendId,seenPartialMsgObjects),defer.resolve("success")}),aChatSenderInstance.on("failure",function(response){RingLogger.print("F2F Seen packet Failure",RingLogger.tags.CHAT),defer.reject("failed")}),aChatSenderInstance.start(),defer.promise},getSeenPartialMsgObjects=function(messages){for(var seenPartialMsgObjects=[],index=0;index<messages.length;index++)seenPartialMsgObjects.push({key:messages[index].key,messageType:messages[index].value.messageType,senderId:messages[index].value.user.getKey()});return seenPartialMsgObjects},sendF2fSeenPacketOnline=function(ip,port,friendId,seenPartialMsgObjects,packetId){sendChatSeenPackets(ip,port,friendId,seenPartialMsgObjects,packetId).then(function(){},function(){sendF2fSeenPacketOffline(friendId,seenPartialMsgObjects,packetId)})},sendF2fSeenPacketOffline=function(friendId,seenPartialMsgObjects,packetId){var offlineIpPort=chatUtilsFactory.getOfflineIpPort(),ip=offlineIpPort.ip,port=offlineIpPort.port;sendChatSeenPackets(ip,port,friendId,seenPartialMsgObjects,packetId)},getStatusByMessageType=function(messageType){var messageStatus=0;switch(messageType){case 2:case 3:case 4:case 5:case 6:messageStatus=CHAT_GENERAL_CONSTANTS.MESSAGE_STATUS.SEEN;break;case 7:case 8:case 9:case 10:messageStatus=CHAT_GENERAL_CONSTANTS.MESSAGE_STATUS.VIEWED}return messageStatus};return{sendSeenPacket:_sendSeenPacket}}angular.module("ringid.chat").factory("ChatSeenSend",ChatSeenSend),ChatSeenSend.$inject=["PullerSubscriber","ChatFactory","chatHistoryFactory","utilsFactory","Auth","tagChatApiService","tagChatFactory","tagChatManager","CHAT_GLOBAL_VALUES","ChatHelper","CHAT_GENERAL_CONSTANTS","tagChatHelper","chatPacketResender","FRIEND_CHAT_PACKET_TYPE","$q","TAG_CHAT_PACKET_TYPE","chatUtilsFactory"]}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("chatHistoryFactory",["Storage","Auth","userFactory","CHAT_GENERAL_CONSTANTS","CHAT_GENERAL_INFOS","chatTabSync","SystemEvents","utilsFactory",function(Storage,Auth,userFactory,CHAT_GENERAL_CONSTANTS,CHAT_GENERAL_INFOS,chatTabSync,SystemEvents,utilsFactory){var chatOpenedBoxes={},chatBoxes={},unreadMessageInfos={},unreadMessageCount=0,loadChatBoxes=function(){chatOpenedBoxes=Storage.getData("chatOpenedBoxes")||{},chatBoxes=Storage.getData("chatBoxes")||{}},loadUnreadMessageInfos=function(){var _unreadMessageInfos=Storage.getData("unreadMessageIds");unreadMessageCount=0,_unreadMessageInfos?Object.keys(_unreadMessageInfos).forEach(function(aBoxId,key){unreadMessageInfos[aBoxId]={},_unreadMessageInfos[aBoxId].forEach(function(packetId,key){unreadMessageInfos[aBoxId][packetId]=!0,unreadMessageCount++})}):unreadMessageInfos={}},_updateUnreadMessageInfos=function(async){async!==!1&&(async=!0);var _unreadMessageInfos={};Object.keys(unreadMessageInfos).forEach(function(aBoxId,key){_unreadMessageInfos[aBoxId]=Object.keys(unreadMessageInfos[aBoxId])}),Storage.setData("unreadMessageIds",_unreadMessageInfos,async),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.UNREAD_MESSAGE_INFO_UPDATED)},migrateLocalDb=function(){chatOpenedBoxes={},chatBoxes={},_updateChatBoxes(!1),_updateChatOpenBoxes(!1),_updateUnreadMessageInfos(!1),saveChatGeneralInfo(CHAT_GENERAL_INFOS,!1)},loadChatGeneralInfo=function(){var cgInf=Storage.getData("cgInf");cgInf&&cgInf.version&&cgInf.version==CHAT_GENERAL_INFOS.version||migrateLocalDb(),cgInf?angular.extend(CHAT_GENERAL_INFOS,cgInf):saveChatGeneralInfo()},saveChatGeneralInfo=function(info,async){async!==!1&&(async=!0),info&&angular.extend(CHAT_GENERAL_INFOS,info),Storage.setData("cgInf",CHAT_GENERAL_INFOS,async)},getHistoryMessageObject=function(message){message.user||(message.user=userFactory.create(message.user));var messageObject={key:message.key,packetId:message.packetId||message.key,packetType:message.packetType||6,brokenPacketType:message.brokenPacketType||8,platform:message.platform||5,text:message.text||message.message||message.mg,hrtime:message.hrtime,status:message.status||0,seenSent:message.seenSent||!1,messageDate:message.messageDate,isDeleted:message.isDeleted,latitude:message.latitude,longitude:message.longitude,messageDateString:message.messageDateString||"",timeout:message.timeout,messageType:message.messageType,tag_chat:message.tag_chat,isSecretVisible:message.isSecretVisible,secretTimedOut:message.secretTimedOut?message.secretTimedOut:!1,user:message.user.getKey()};return message.usersToChange&&(messageObject.usersToChange=message.usersToChange),message.statusType&&(messageObject.statusType=message.statusType),messageObject},_updateChatBoxes=function(async){async!==!1&&(async=!0),Storage.setData("chatBoxes",chatBoxes,async)},_updateChatOpenBoxes=function(async){async!==!1&&(async=!0),Storage.setData("chatOpenedBoxes",chatOpenedBoxes,async)},_addOpenBoxes=function(boxId,isTagChat){chatOpenedBoxes||(chatOpenedBoxes={}),chatOpenedBoxes[boxId]||(chatOpenedBoxes[boxId]={boxId:boxId,isTagChat:isTagChat}),_updateChatOpenBoxes()},_getMessageByPacketId=function(boxId,packetId){if(chatBoxes[boxId]){var messages=chatBoxes[boxId].messages;if(messages)for(var index=0,length=messages.length;length>index;index++)if(messages[index].key==packetId)return messages[index]}return!1},_addUnreadMessageInfo=function(boxId,messageId){unreadMessageInfos[boxId]||(unreadMessageInfos[boxId]={}),unreadMessageInfos[boxId][messageId]||(unreadMessageInfos[boxId][messageId]=!0,unreadMessageCount++)},_removeUnreadMessageInfo=function(boxId,messageId){unreadMessageInfos[boxId]&&unreadMessageInfos[boxId][messageId]&&(delete unreadMessageInfos[boxId][messageId],unreadMessageCount--,_updateUnreadMessageInfos())},_removeUnreadMessageInfoByBoxId=function(boxId){chatBoxes[boxId];if(unreadMessageInfos[boxId]){var boxUnreadCount=Object.keys(unreadMessageInfos[boxId]).length;delete unreadMessageInfos[boxId],unreadMessageCount-=boxUnreadCount,0>unreadMessageCount&&(unreadMessageCount=0),_updateUnreadMessageInfos()}},_getUnreadMessageInfos=function(){return unreadMessageInfos},_getUnreadMessageCount=function(){return unreadMessageCount},_getUnreadMessageCountByBoxId=function(boxId){return unreadMessageInfos[boxId]?Object.keys(unreadMessageInfos[boxId]).length:0},_init=function(){loadChatGeneralInfo(),loadChatBoxes(),loadUnreadMessageInfos()},ReturnOb={init:_init,loadChatBoxes:loadChatBoxes,loadChatGeneralInfo:loadChatGeneralInfo,saveChatGeneralInfo:saveChatGeneralInfo,updateChatOpenBoxes:_updateChatOpenBoxes,updateChatBoxes:_updateChatBoxes,addUnreadMessageInfo:_addUnreadMessageInfo,removeUnreadMessageInfo:_removeUnreadMessageInfo,updateUnreadMessageInfos:_updateUnreadMessageInfos,getUnreadMessageInfos:_getUnreadMessageInfos,getUnreadMessageCount:_getUnreadMessageCount,getUnreadMessageCountByBoxId:_getUnreadMessageCountByBoxId,removeUnreadMessageInfoByBoxId:_removeUnreadMessageInfoByBoxId,getMessageByPacketId:_getMessageByPacketId,getChatOpenBoxes:function(){return chatOpenedBoxes},getChatBoxes:function(){return chatBoxes},addOpenBox:_addOpenBoxes,removeOpenBox:function(boxId){chatOpenedBoxes[boxId]&&delete chatOpenedBoxes[boxId],_updateChatOpenBoxes()},countOpenBoxes:function(){return chatOpenedBoxes?Object.keys(chatOpenedBoxes).length:0},getAllOpenBoxes:function(){return chatOpenedBoxes&&Object.keys(chatOpenedBoxes).length>0?chatOpenedBoxes:!1},addBox:function(box){_addOpenBoxes(box.key,box.isTagChat);var box={key:box.key,ip:box.ip,rPort:box.rPort,closedBox:box.closedBox,isMinimized:box.isMinimized,isHidden:box.isHidden,isFocused:box.isFocused,blinkOn:box.blinkOn,timeout:box.timeout,secretChat:box.secretChat,nonDomBox:box.nonDomBox,offlineStatus:box.offlineStatus,isTagChat:box.isTagChat,chatBoxClass:box.chatBoxClass,unreadCount:box.unreadCount,isSecretVisible:box.isSecretVisible,blocked:box.blocked,messages:[]};chatBoxes||(chatBoxes={}),chatBoxes[box.key]||(chatBoxes[box.key]=box),_updateChatBoxes()},updateBox:function(box){var box={key:box.key,ip:box.ip,rPort:box.rPort,closedBox:box.closedBox,isMinimized:box.isMinimized,isHidden:box.isHidden,isFocused:box.isFocused,blinkOn:box.blinkOn,timeout:box.timeout,secretChat:box.secretChat,nonDomBox:box.nonDomBox,offlineStatus:box.offlineStatus,isTagChat:box.isTagChat,isSecretVisible:box.isSecretVisible,blocked:box.blocked,chatBoxClass:box.chatBoxClass,unreadCount:box.unreadCount};chatBoxes||(chatBoxes={}),chatBoxes[box.key]?angular.extend(chatBoxes[box.key],box):chatBoxes[box.key]=box,_updateChatBoxes()},getBox:function(key){return chatBoxes[key]?chatBoxes[key]:!1},addMessage:function(message,boxId){if(chatBoxes[boxId]){message.user&&message.user.getKey||(message.user=userFactory.create(message.user));var messageObject={key:message.key||message.packetId,packetId:message.packetId||message.key,packetType:message.packetType||6,brokenPacketType:message.brokenPacketType||8,platform:message.platform||5,text:message.text||message.message||message.mg,hrtime:message.hrtime||"",status:message.status||0,fullName:message.fullName||"",tagName:message.tagName||"",messageDate:message.messageDate,seenSent:message.seenSent||!1,isDeleted:message.isDeleted||!1,messageDateString:message.messageDateString||"",timeout:message.timeout||0,messageType:message.messageType,tag_chat:message.tag_chat,isSecretVisible:message.isSecretVisible,secretTimedOut:message.secretTimedOut?message.secretTimedOut:!1,user:message.user.getKey(),userId:message.user.getKey()};message.user||RingLogger.error("Invalid User",message),message.statusType&&(messageObject.statusType=message.statusType),message.usersToChange&&(messageObject.usersToChange=message.usersToChange),chatBoxes[boxId].messages||(chatBoxes[boxId].messages=[]);var messageKeyFlag=0;try{for(var j=0;j<chatBoxes[boxId].messages.length;j++)if(chatBoxes[boxId].messages[j].key===messageObject.key){messageKeyFlag=1;break}}catch(e){RingLogger.error("Error Check",e)}if(0===messageKeyFlag){if(ReturnOb.countMessage(boxId)>=CHAT_GENERAL_CONSTANTS.HISTORY_MAX_MESSAGE){chatBoxes[boxId].messages.shift()}chatBoxes[boxId].messages.push(messageObject)}}_updateChatBoxes()},removeMessage:function(messageKey,boxId){var removed=!1;if(chatBoxes&&chatBoxes[boxId])for(var j=0;j<chatBoxes[boxId].messages.length;j++)chatBoxes[boxId].messages[j].key===messageKey&&(chatBoxes[boxId].messages.splice(j,1),removed=!0);removed&&_updateChatBoxes()},updateMessage:function(message,boxId){Auth.loginData.uId;if(chatBoxes[boxId]){angular.isObject(message.user)||(message.user=userFactory.create(message.user));var messageObject={key:message.key,packetId:message.packetId||message.key,packetType:message.packetType||6,brokenPacketType:message.brokenPacketType||8,platform:message.platform||5,text:message.text||message.message||message.mg,hrtime:message.hrtime,status:message.status||0,seenSent:message.seenSent||!1,messageDate:message.messageDate,isDeleted:message.isDeleted,latitude:message.latitude,longitude:message.longitude,messageDateString:message.messageDateString||"",timeout:message.timeout,messageType:message.messageType,isSecretVisible:message.isSecretVisible,tag_chat:message.tag_chat,secretTimedOut:message.secretTimedOut?message.secretTimedOut:!1,user:message.user.getKey()};message.usersToChange&&(messageObject.usersToChange=message.usersToChange),message.statusType&&(messageObject.statusType=message.statusType);for(var j=0;j<chatBoxes[boxId].messages.length;j++)if(chatBoxes[boxId].messages[j].key==messageObject.key){chatBoxes[boxId].messages[j]=messageObject;break}}_updateChatBoxes()},updateMessages:function(messages,boxId){if(messages.length){for(var messagesCache={},index=0,len=messages.length;len>index;index++)messagesCache[messages[index].key]=messages[index];if(chatBoxes)for(var currentUserBox=chatBoxes[boxId],j=0;j<currentUserBox.messages.length;j++){var historyMessage=currentUserBox.messages[j],cachedMessage=messagesCache[historyMessage.key];cachedMessage&&(currentUserBox.messages[j]=getHistoryMessageObject(cachedMessage))}_updateChatBoxes()}},isInLocalStorageChatMsgMap:function(boxId,packetId){try{return!!chatBoxes[boxId][packetId]}catch(e){return!1}},countMessage:function(boxId){Auth.loginData.uId;if(chatBoxes[boxId]){var box=chatBoxes[boxId];return box.messages?box.messages.length:0}return!1},getMessages:function(boxId){if(chatBoxes[boxId]){var box=chatBoxes[boxId];return box.messages}return[]},getMessage:function(boxId,packetId){if(chatBoxes[boxId]&&chatBoxes[boxId].messages)for(var j=0;j<chatBoxes[boxId].messages.length;j++)if(chatBoxes[boxId].messages[j].key==packetId)return chatBoxes[boxId].messages[j];return!1}};return ReturnOb}])}(),function(){"use strict";function PullerSubscriber(OPERATION_TYPES,ChatFactory,userFactory,Auth,$$connector,friendsFactory,chatHistoryFactory,$q,CHAT_GENERAL_CONSTANTS,ChatPacketSenderService,ChatApiService,tagChatApiService,chatPacketResender){var ChatPacketResender=chatPacketResender.ChatPacketResender,USER_PRESENECE=CHAT_GENERAL_CONSTANTS.USER_PRESENCE,sendFriendInformation=function(friendObj){var friendInfoObject=ChatApiService.getFriendInformationPacketObject(friendObj.getUId(),friendObj.getName(),friendObj.getPlatform(),friendObj.getOnlineStatus(),friendObj.getAppType(),friendObj.getDeviceToken(),friendObj.getUserMood());tagChatApiService.sendViaGlobalChatSocket(friendInfoObject,friendInfoObject.packetType)},sendBlankOfflineMesssage=function(friendId){ChatPacketSenderService.sendBlankMessage(friendId)},_getBox=function(friendId){var box=ChatFactory.getBoxByUId(friendId);return box||(box=ChatFactory.creatNonDomBox(friendId,!1),box.loadHistoryMessages()),box},sendF2FRegisterRequest=function(ip,port,userId,friendId){var registerObject=ChatApiService.getRegisterForFriendChatRequestObject(ip,port,userId,friendId),chatPacketResender=new ChatPacketResender;chatPacketResender.setPacketType(registerObject.packetType),chatPacketResender.setPacketObject(registerObject),chatPacketResender.on("failure",function(response){var box=_getBox(userId);ChatPacketSenderService.sendTemporaryMessages(box,!0)}),chatPacketResender.start()},subscribePuller=function(){$$connector.subscribe(function(message){RingLogger.print("175.375 RESPONSE ",message,RingLogger.tags.CHAT);var dataObj=message,friendId=dataObj.fndId,box=_getBox(friendId);box.platform=dataObj.dvc;var friendObject=userFactory.create({uId:dataObj.fndId,utId:dataObj.utId,fn:dataObj.nm});friendsFactory.getContactDetailsByUtIds([dataObj.utId]);var friendPreviousOnlineStatus=friendObject.getOnlineStatus();if(friendObject.setOnlineStatus(dataObj.psnc),dataObj.mood&&friendObject.setUserMood(dataObj.mood),dataObj.dt&&friendObject.setDeviceToken(dataObj.dt),dataObj.apt&&friendObject.setAppType(dataObj.apt),dataObj.dvc&&friendObject.setPlatform(dataObj.dvc),friendPreviousOnlineStatus!=friendObject.getOnlineStatus()&&sendFriendInformation(friendObject),dataObj.sucs===!0&&dataObj.psnc==USER_PRESENECE.ONLINE){var ip=dataObj.chIp,port=parseInt(dataObj.chRp),userId=Auth.loginData.uId;box.setIp(ip),box.setRPort(port),box.offlineStatus=!1,sendF2FRegisterRequest(ip,port,userId,friendId),chatHistoryFactory.updateBox(box)}else 1==dataObj.rc?box.blocked=!0:(box.offlineStatus=!0,dataObj.psnc==USER_PRESENECE.OFFLINE&&sendBlankOfflineMesssage(friendId),ChatPacketSenderService.sendTemporaryMessages(box,!0)),chatHistoryFactory.updateBox(box)},{action:[175,375]})}(),RequestForIp=function(friendId,returnPromise){var requestObject={actn:175,fndId:friendId,uId:Auth.loginData.uId};if(returnPromise){var defer=$q.defer();return $$connector.request(requestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.CHAT).then(function(response){var box=_getBox(response.fndId);response.sucs===!0&&response.psnc==USER_PRESENECE.ONLINE?(box.offlineStatus=!1,box.ip=response.chIp,box.platform=response.dvc,box.rPort=parseInt(response.chRp)):(box.platform=response.dvc,box.offlineStatus=!0),defer.resolve(response)},function(response){defer.reject(response)}),defer.promise}$$connector.send(requestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.CHAT)};return{subscribePuller:function(){subscribePuller()},requestForIp:function(friendId,returnPromise){return RequestForIp(friendId,returnPromise)}}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("PullerSubscriber",PullerSubscriber),PullerSubscriber.$inject=["OPERATION_TYPES","ChatFactory","userFactory","Auth","$$connector","friendsFactory","chatHistoryFactory","$q","CHAT_GENERAL_CONSTANTS","ChatPacketSenderService","ChatApiService","tagChatApiService","chatPacketResender"]}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){chatApp=angular.module("ringid.chat",["ringid.config","ringid.common.stacked_map","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}chatApp.factory("PacketDataParse",["CHAT_PACKET_ATTRIBUTE",function(CHAT_PACKET_ATTRIBUTE){return{getPacketType:function(packetData){var dView=new DataView(packetData),packetType=dView.getIntByByte(0,1);return packetType},getPacketId:function(packetData){},copyBufferArray:function(bufferArrayData,offsetByteLength){for(var array=new Uint8Array(bufferArrayData),array2=new Uint8Array(array.length-offsetByteLength),i=0;i<array.length-offsetByteLength;i++)array2[i]=array[i+offsetByteLength];return array2},ipToLong:function(ipAddress){for(var ipAddressInArray=ipAddress.split("."),longValue=0,i=0;i<ipAddressInArray.length;i++){var power=i,ip=parseInt(ipAddressInArray[i]);longValue+=ip*Math.pow(256,power)}return longValue},longToIp:function(longValue){for(var ipAddress="",i=3;i>=0;i--)ipAddress+=255&longValue,i>0&&(ipAddress+="."),longValue>>=8;return ipAddress},ipToByte:function(ipAddress,startPoint){for(var ipAddressArray=ipAddress.split("."),ipAddressByte=new Uint8Array(4),k=startPoint;startPoint+4>k;k++)ipAddressByte[k]=ipAddressArray[k-startPoint];return ipAddressByte},byteToIp:function(ipByte){for(var ipAddress="",k=0;4>k;k++)ipAddress=ipByte[k],3>k&&(ipAddress+=".");return ipAddress},integerToByte:function(integerValue,byteLength,startPoint){for(var bytes=new Uint8Array(byteLength),k=byteLength-1;k>=0;k--)bytes[k]=255&integerValue,integerValue/=256;return bytes},byteToInteger:function(byteArray,byteLength,startPoint){for(var res=0,bit=8*(byteLength-1),k=startPoint;byteLength+startPoint-1>k;k++)res+=byteArray[k]<<bit,bit-=8;return res+=byteArray[startPoint+byteLength-1]},Bytes2Float32:function(bytes){var sign=2147483648&bytes?-1:1,exponent=(bytes>>23&255)-127,significand=8388607&bytes;if(128==exponent)return sign*(significand?Number.NaN:Number.POSITIVE_INFINITY);if(-127==exponent){if(0==significand)return 0*sign;exponent=-126,significand/=1<<22}else significand=(significand|1<<23)/(1<<23);return sign*significand*Math.pow(2,exponent)},Float32ToInt:function(floatData){var view=new DataView(new ArrayBuffer(4));return view.setFloat32(0,floatData),view.getInt32(0)},constructRegisterPacket:function(registerJson){for(var array=new Uint8Array(25+registerJson.packetId.length),i=0,ipArray=this.ipToByte(registerJson.ip,0),j=0;j<ipArray.length;j++)array[i++]=ipArray[j];for(var portArray=this.integerToByte(registerJson.port,2,i),j=0;j<portArray.length;j++)array[i++]=portArray[j];array[i++]=1;for(var userId=this.integerToByte(registerJson.userId,8,i),j=0;j<userId.length;j++)array[i++]=userId[j];for(var friendId=this.integerToByte(registerJson.friendId,8,i),j=0;j<friendId.length;j++)array[i++]=friendId[j];array[i++]=registerJson.packetId.length;for(var j=0;j<registerJson.packetId.length;j++)array[i++]=registerJson.packetId.charCodeAt(j);return array[i++]=5,array},constructTagRegisterPacket:function(tagRegisterObject){for(var array=new Uint8Array(14+tagRegisterObject.sessionId.length+tagRegisterObject.userId.length+tagRegisterObject.packetId.length),i=0,ipArray=this.integerToByte(this.ipToLong(registerJson.ip),8,0),j=0;j<ipArray.length;j++)array[i++]=ipArray[j];for(var portArray=this.integerToByte(registerJson.port,2,i),j=0;j<portArray.length;j++)array[i++]=portArray[j];array[i++]=12,array[i++]=5,array[i++]=tagRegisterObject.packetId.length;for(var j=0;j<tagRegisterObject.packetId.length;j++)array[i++]=tagRegisterObject.packetId.charCodeAt(j);array[i++]=tagRegisterObject.userId.length;for(var j=0;j<tagRegisterObject.userId.length;j++)array[i++]=tagRegisterObject.userId.charCodeAt(j);array[i++]=tagRegisterObject.fullName.length;for(var j=0;j<tagRegisterObject.fullName.length;j++)array[i++]=tagRegisterObject.fullName.charCodeAt(j);for(var tempArrayTagId=this.integerToByte(tagRegisterObject.tagId,8,i),j=0;j<tempArrayTagId.length;j++)array[i++]=tempArrayTagId[j];return array},constructUnregisterPacket:function(unregisterObject){for(var array=new Uint8Array(24),i=0,ipArray=this.ipToByte(unregisterObject.ip,0),j=0;j<ipArray.length;j++)array[i++]=ipArray[j];for(var portArray=this.integerToByte(unregisterObject.port,2,i),j=0;j<portArray.length;j++)array[i++]=portArray[j];array[i++]=2;for(var userId=this.integerToByte(unregisterObject.userId,8,i),j=0;j<userId.length;j++)array[i++]=userId[j];for(var friendId=this.integerToByte(unregisterObject.friendId,8,i),j=0;j<friendId.length;j++)array[i++]=friendId[j];return array[i++]=1,array},parseRegisterPacket:function(registerPacket){var array=new Uint8Array(registerPacket),registerJson={},i=0;registerJson.packetType=array[i++],registerJson.friendId=this.byteToInteger(array,8,i),i+=8,registerJson.packetId=this.getIndPckData(array,i+1,array[i]),i=i+1+array[i];var port=this.byteToInteger(array,4,i);return registerJson.port=port,registerJson},parseTagRegisterPacket:function(tagRegisterPacket){var array=new Uint8Array(tagRegisterPacket),tagRegisterObject={},bit2=56,tagId=0;tagRegisterObject.packetType=array[0];var port=this.byteToInteger(array,4,1);tagRegisterObject.port=port,tagRegisterObject.packetId=this.getIndPckData(tagRegisterPacket,6,array[5]);for(var i=1;8>i;i++)tagId+=array[i]<<bit2,bit2-=8;return tagId+=array[8],tagRegisterObject.tagId=tagId,tagRegisterObject},processUnregisterPacket:function(unregisterPacket){var array=new Uint8Array(unregisterPacket),unregisterObject={},headPointer=0;return unregisterObject.packetType=array[headPointer++],unregisterObject.userId=this.byteToInteger(array,8,headPointer),headPointer+=8,unregisterObject.friendId=this.byteToInteger(array,8,headPointer),headPointer+=8,unregisterObject.onlineStatus=1,unregisterObject},constructPacket:function(object,packetType,format){if(!object.ip)return RingLogger.print("ip not provided in packet",RingLogger.tags.CHAT),!1;if(object.message||""===object.message){var encodedMessage=object.message;encodedMessage=encodedMessage.utf8Encode();var encodedMessageLength=encodedMessage.length}for(var noOfByte=6,x=0;x<format.length;x++){switch(format[x]){case 1:noOfByte+=1;break;case 2:noOfByte+=8;break;case 3:noOfByte+=8;break;case 4:noOfByte+=1;break;case 5:noOfByte+=object.packetId.length;break;case 6:noOfByte+=1;break;case 7:noOfByte+=4;break;case 8:noOfByte+=8;break;case 9:noOfByte+=1;break;case 10:noOfByte+=1;
break;case 11:noOfByte+=1;break;case 12:noOfByte+=2;break;case 13:noOfByte+=4;break;case 14:noOfByte+=4;break;case 15:noOfByte+=2;break;case 16:noOfByte+=encodedMessageLength;break;case 17:noOfByte+=8;break;case 18:noOfByte+=1;for(var repeatFormat=format.slice(x),z=0;z<object.noOfMessages;z++)for(var p=0;p<repeatFormat.length;p++)switch(repeatFormat[p]){case 4:noOfByte+=1;break;case 5:noOfByte+=object.packetIds[z].length}break;case 19:noOfByte+=1;break;case 20:noOfByte+=object.fullName.length;break;case 21:noOfByte+=1;break;case 22:noOfByte+=1;break;case 23:noOfByte+=2,noOfByte+=8*object.noOfMembers;break;case 24:noOfByte+=8;break;case 26:noOfByte++;break;case 27:noOfByte++;break;case 28:noOfByte+=8;break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH:noOfByte+=1;break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME:noOfByte+=object.tagName.length;break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH:noOfByte+=1;break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL:noOfByte+=object.tagPictureUrl.length;break;case CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS:noOfByte+=1;var repeatFormat=format.slice(x+1);for(z=0;z<object.tagMembers.length;z++)for(var p=0;p<repeatFormat.length;p++)switch(repeatFormat[p]){case CHAT_PACKET_ATTRIBUTE.USER_ID:noOfByte+=8;break;case CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH:noOfByte+=1;break;case CHAT_PACKET_ATTRIBUTE.FULL_NAME:noOfByte+=object.tagMembers[z].fullName.length;break;case CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE:noOfByte+=1;break;case CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_ADDED_BY:noOfByte+=8}}if(18==format[x]||23==format[x]||37==format[y])break}6!=format[format.length-1]||58!=object.packetType&&59!=object.packetType&&19!=object.packetType||(noOfByte+=1);for(var dViewPacket=new DataView(new ArrayBuffer(noOfByte)),i=0,ipArray=object.ip.split("."),j=0;j<ipArray.length;j++)dViewPacket.setUint8(i++,ipArray[j]);dViewPacket.setUint16(i,object.port),i+=2;for(var y=0;y<format.length;y++){switch(format[y]){case 1:dViewPacket.setUint8(i++,object.packetType);break;case 2:dViewPacket.setUint64(i,object.userId),i+=8;break;case 3:dViewPacket.setUint64(i,object.friendId),i+=8;break;case 4:dViewPacket.setUint8(i++,object.packetId.length);break;case 5:for(var j=0;j<object.packetId.length;j++)dViewPacket.setUint8(i++,object.packetId.charCodeAt(j));break;case 6:dViewPacket.setUint8(i++,object.platform);break;case 7:dViewPacket.setUint32(i,object.port),i+=4;break;case 8:dViewPacket.setUint64(i,object.tagId),i+=8;break;case 9:dViewPacket.setUint8(i++,object.onlineStatus);break;case 10:dViewPacket.setUint8(i++,object.userMood);break;case 11:dViewPacket.setUint8(i++,object.messageType);break;case 12:dViewPacket.setUint16(i,object.timeout),i+=2;break;case 13:dViewPacket.setUint32(i,object.latitude),i+=4;break;case 14:dViewPacket.setUint32(i,object.longitude),i+=4;break;case 15:dViewPacket.setUint16(i,encodedMessageLength),i+=2;break;case 16:for(var j=0;encodedMessageLength>j;j++)dViewPacket.setUint8(i++,encodedMessage.charCodeAt(j));break;case 17:dViewPacket.setUint64(i,object.messageDate),i+=8;break;case 18:dViewPacket.setUint8(i++,object.noOfMessages);for(var repeatFormat=format.slice(y),z=0;z<object.noOfMessages;z++)for(var p=0;p<repeatFormat.length;p++)switch(repeatFormat[p]){case 4:dViewPacket.setUint8(i++,object.packetIds[z].length);break;case 5:for(var j=0;j<object.packetIds[z].length;j++)dViewPacket.setUint8(i++,object.packetIds[z].charCodeAt(j))}break;case 19:dViewPacket.setUint8(i++,object.fullName.length);break;case 20:for(var j=0;j<object.fullName.length;j++)dViewPacket.setUint8(i++,object.fullName.charCodeAt(j));break;case 21:dViewPacket.setUint8(i++,object.noOfPackets);break;case 22:dViewPacket.setUint8(i++,object.sequenceNo);break;case 23:dViewPacket.setUint16(i,object.noOfMembers),i+=2;for(var z=0;z<object.noOfMembers;z++)dViewPacket.setUint64(i,object.userIds[z]),i+=8;break;case 24:dViewPacket.setUint64(i,object.updateTime),i+=8;break;case 26:dViewPacket.setUint8(i++,object.isSecretVisible);break;case 27:dViewPacket.setUint8(i++,object.messageStatus);break;case 28:dViewPacket.setUint64(i,object.blockUnblockUpdateDate),i+=8;break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH:dViewPacket.setUint8(i++,object.tagName.length);break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME:for(var j=0;j<object.tagName.length;j++)dViewPacket.setUint8(i++,object.tagName.charCodeAt(j));break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH:dViewPacket.setUint8(i++,object.tagPictureUrl.length);break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL:for(var j=0;j<object.tagPictureUrl.length;j++)dViewPacket.setUint8(i++,object.tagPictureUrl.charCodeAt(j));break;case CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS:dViewPacket.setUint8(i,object.tagMembers.length),i+=1;var repeatFormat=format.slice(x+1);for(z=0;z<object.tagMembers.length;z++)for(var p=0;p<repeatFormat.length;p++)switch(repeatFormat[p]){case CHAT_PACKET_ATTRIBUTE.USER_ID:dViewPacket.setUint64(i,object.tagMembers[z].userId),i+=8;break;case CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH:dViewPacket.setUint8(i,object.tagMembers[z].fullName.length),i+=1;break;case CHAT_PACKET_ATTRIBUTE.FULL_NAME:for(var j=0;j<object.tagMembers[z].fullName.length;j++)dViewPacket.setUint8(i,object.tagMembers[z].fullName.charCodeAt(j)),i+=1;break;case CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE:dViewPacket.setUint8(i,object.tagMembers[z].status),i+=1;break;case CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_ADDED_BY:dViewPacket.setUint64(i,object.tagMembers[z].addedBy),i+=8}}if(18==format[y]||23==format[y]||37==format[y])break}return 6!=format[format.length-1]||58!=object.packetType&&59!=object.packetType&&19!=object.packetType||dViewPacket.setUint8(i++,object.platform),dViewPacket},parsePacket:function(packet,packetType,format){for(var dViewObject={},dView=new DataView(packet),i=0,y=0;y<format.length;y++){switch(format[y]){case 1:dViewObject.packetType=dView.getIntByByte(i++,1);break;case 2:dViewObject.userId=dView.getIntByByte(i,8),i+=8;break;case 3:dViewObject.friendId=dView.getIntByByte(i,8),i+=8;break;case 4:dViewObject.packetIdLength=dView.getIntByByte(i++,1);break;case 5:dViewObject.packetId="",dViewObject.packetId=dView.getString(i,dViewObject.packetIdLength),i+=dViewObject.packetIdLength;break;case 6:dViewObject.platform=dView.getIntByByte(i++,1);break;case 7:dViewObject.port=dView.getIntByByte(i,4),i+=4;break;case 8:dViewObject.tagId=dView.getIntByByte(i,8),i+=8;break;case 9:dViewObject.onlineStatus=dView.getIntByByte(i++,1);break;case 10:dViewObject.userMood=dView.getIntByByte(i++,1);break;case 11:dViewObject.messageType=dView.getIntByByte(i++,1);break;case 12:dViewObject.timeout=dView.getIntByByte(i,2),i+=2;break;case 13:dViewObject.latitude=dView.getIntByByte(i,4,!0),i+=4;break;case 14:dViewObject.longitude=dView.getIntByByte(i,4,!0),i+=4;break;case 15:dViewObject.messageLength=dView.getIntByByte(i,2),i+=2;break;case 16:dViewObject.message="",dViewObject.message=dView.getString(i,dViewObject.messageLength),i+=dViewObject.messageLength;break;case 17:dViewObject.messageDate=dView.getIntByByte(i,8),i+=8;break;case 18:dViewObject.noOfMessages=dView.getIntByByte(i++,1);var repeatFormat=format.slice(y);dViewObject.packetData=[];for(var z=0;z<dViewObject.noOfMessages;z++){dViewObject.packetData[z]={};for(var p=0;p<repeatFormat.length;p++)switch(repeatFormat[p]){case 1:dViewObject.packetData[z].packetType=dView.getIntByByte(i++,1);break;case 2:dViewObject.packetData[z].userId=dView.getIntByByte(i,8),i+=8;break;case 3:dViewObject.packetData[z].friendId=dView.getIntByByte(i,8),i+=8;break;case 4:dViewObject.packetData[z].packetIdLength=dView.getIntByByte(i++,1);break;case 5:dViewObject.packetData[z].packetId="",dViewObject.packetData[z].packetId=dView.getString(i,dViewObject.packetData[z].packetIdLength),i+=dViewObject.packetData[z].packetIdLength;break;case 8:dViewObject.packetData[z].tagId=dView.getIntByByte(i,8),i+=8;break;case 11:dViewObject.packetData[z].messageType=dView.getIntByByte(i++,1);break;case 12:dViewObject.packetData[z].timeout=dView.getIntByByte(i,2),i+=2;break;case 13:dViewObject.packetData[z].latitude=dView.getIntByByte(i,4),i+=4;break;case 14:dViewObject.packetData[z].longitude=dView.getIntByByte(i,4),i+=4;break;case 15:dViewObject.packetData[z].messageLength=dView.getIntByByte(i,2),i+=2;break;case 16:dViewObject.packetData[z].message="",dViewObject.packetData[z].message=dView.getString(i,dViewObject.packetData[z].messageLength),i+=dViewObject.packetData[z].messageLength;break;case 17:dViewObject.packetData[z].messageDate=dView.getIntByByte(i,8),i+=8;break;case 19:dViewObject.packetData[z].fullNameLength=dView.getIntByByte(i++,1);break;case 20:dViewObject.packetData[z].fullName="",dViewObject.packetData[z].fullName=dView.getString(i,dViewObject.packetData[z].fullNameLength),i+=dViewObject.packetData[z].fullNameLength;break;case 21:dViewObject.packetData[z].noOfPackets=dView.getIntByByte(i++,1);break;case 22:dViewObject.packetData[z].sequenceNo=dView.getIntByByte(i++,1);break;case 24:dViewObject.packetData[z].updateTime=dView.getIntByByte(i,8),i+=8;break;case 25:dViewObject.packetData[z].serverDate=dView.getIntByByte(i,8),i+=8;break;case 26:dViewObject.packetData[z].isSecretVisible=dView.getIntByByte(i++,1);break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH:dViewObject.packetData[z].tagNameLength=dView.getIntByByte(i++,1);break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME:dViewObject.packetData[z].tagName="",dViewObject.packetData[z].tagName=dView.getString(i,dViewObject.packetData[z].tagNameLength),i+=dViewObject.packetData[z].tagNameLength;break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH:dViewObject.packetData[z].tagPictureUrlLength=dView.getIntByByte(i++,1);break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL:dViewObject.packetData[z].tagPictureUrlLength>0?(dViewObject.packetData[z].tagPictureUrl=dView.getString(i,dViewObject.packetData[z].tagPictureUrlLength),i+=dViewObject.packetData[z].tagPictureUrlLength):dViewObject.packetData[z].tagPictureUrl=""}}break;case 19:dViewObject.fullNameLength=dView.getIntByByte(i++,1);break;case 20:dViewObject.fullName="",0!=dViewObject.fullNameLength&&(dViewObject.fullName=dView.getString(i,dViewObject.fullNameLength),i+=dViewObject.fullNameLength);break;case 21:dViewObject.noOfPackets=dView.getIntByByte(i++,1);break;case 22:dViewObject.sequenceNo=dView.getIntByByte(i++,1);break;case 23:for(dViewObject.noOfMembers=dView.getIntByByte(i,2),i+=2,dViewObject.userIds=[],z=0;z<dViewObject.noOfMembers;z++)dViewObject.userIds[z]=dView.getIntByByte(i,8),i+=8;break;case 24:dViewObject.updateTime=dView.getIntByByte(i,8),i+=8;break;case 25:dViewObject.serverDate=dView.getIntByByte(i,8),i+=8;break;case 26:dViewObject.isSecretVisible=dView.getIntByByte(i++,1);break;case 27:dViewObject.messageStatus=dView.getIntByByte(i++,1);break;case 28:dViewObject.blockUnblockUpdateDate=dView.getIntByByte(i,8),i+=8;break;case CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS:var noOfTagMembers=dView.getIntByByte(i,1);i+=1;var repeatFormat=format.slice(y+1);for(dViewObject.tagMembers=[],z=0;noOfTagMembers>z;z++){dViewObject.tagMembers[z]={};for(var p=0;p<repeatFormat.length;p++)switch(repeatFormat[p]){case CHAT_PACKET_ATTRIBUTE.USER_ID:dViewObject.tagMembers[z].userId=dView.getIntByByte(i,8),i+=8;break;case CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH:dViewObject.tagMembers[z].fullNameLength=dView.getIntByByte(i,1),i+=1;break;case CHAT_PACKET_ATTRIBUTE.FULL_NAME:dViewObject.tagMembers[z].fullName="",dViewObject.tagMembers[z].fullName=dView.getString(i,dViewObject.tagMembers[z].fullNameLength),i+=dViewObject.tagMembers[z].fullNameLength;break;case CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE:dViewObject.tagMembers[z].status=dView.getIntByByte(i,1),i+=1;break;case CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_ADDED_BY:dViewObject.tagMembers[z].addedBy=dView.getIntByByte(i,8),i+=8}}break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH:dViewObject.tagNameLength=dView.getIntByByte(i++,1);break;case CHAT_PACKET_ATTRIBUTE.TAG_NAME:dViewObject.tagName="",dViewObject.tagName=dView.getString(i,dViewObject.tagNameLength),i+=dViewObject.tagNameLength;break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH:dViewObject.tagPictureUrlLength=dView.getIntByByte(i++,1);break;case CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL:dViewObject.tagPictureUrlLength>0?(dViewObject.tagPictureUrl=dView.getString(i,dViewObject.tagPictureUrlLength),i+=dViewObject.tagPictureUrlLength):dViewObject.tagPictureUrl=""}if(18==format[y]||23==format[y]||37==format[y])break}return dViewObject},buildPacketID:function(){return"ring"+Math.floor(Math.random()*(new Date).getTime())},getIndPckData:function(data,startPoint,length){for(var value="",j=startPoint;length+startPoint>j;j++)value+=String.fromCharCode(data[j]);return value}}}])}(),function(){"use strict";function ChatPacketSenderService(CHAT_PACKET_FORMAT,Auth,utilsFactory,tagChatApiService,tagChatFactory,CHAT_GENERAL_CONSTANTS,TAG_CHAT_PACKET_TYPE,FRIEND_CHAT_PACKET_TYPE,OFFLINE_PACKET_TYPE,chatPacketResender,ChatApiService,PLATFORM,chatUtilsFactory,CHAT_STATES,$q,chatHistoryFactory,chatTabSync){var self=this,ChatPacketSender=chatPacketResender.ChatPacketSender,getUUIDPacketId=tagChatFactory.getUUIDPacketId,processMsgForLinkShare=function(msgObj,ogData){if(ogData&&ogData.url){var plainText=msgObj.message,jsonMessage={u:ogData.url,d:ogData.description,t:ogData.title,i:ogData.image,m:plainText};msgObj.message=angular.toJson(jsonMessage)}return msgObj},processMsgForLocationShare=function(msgObj,locationData){if(locationData&&locationData.lat){msgObj.la=locationData.lat,msgObj.lo=locationData.lng,msgObj.loc=locationData.description;var jsonMessage={lo:msgObj.lo,la:msgObj.la,loc:msgObj.loc};msgObj.message=angular.toJson(jsonMessage)}return msgObj},processMsgForMedia=function(msgObj,mediaData){if(mediaData&&mediaData.url){var jsonMessage={u:mediaData.url,c:mediaData.caption,w:mediaData.width,h:mediaData.height};msgObj.message=angular.toJson(jsonMessage),msgObj.mediaUrl=mediaData.url,msgObj.plainText=mediaData.caption}return msgObj},pushToTemporaryArray=function(box,message,messageData){message.fromTemporary=!0,message.messageData=messageData,box.tempMessageArray.push(message)},getMessageObject=function(box,message,messageType,messageData){var msgObj,keyOrPacketId,packetType,brokenPacketType,isEditedMessage=!1,currentUser=Auth.currentUser(),currentUserId=Auth.currentUser().getKey(),messageDate=chatUtilsFactory.getChatServerCurrentTime(),isTagChat=box.isTagChat,ip=box.getIp(),port=box.getPort();if(box.editMessageKey?(keyOrPacketId=box.editMessageKey,box.editMessageKey=void 0,messageDate=box.editMessageDate,box.editMessageDate=void 0,isEditedMessage=!0,isTagChat?(packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_EDIT,brokenPacketType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT):(packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG_EDIT,brokenPacketType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG_EDIT)):(keyOrPacketId=getUUIDPacketId(messageDate),isTagChat?(packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG,brokenPacketType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG):(packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG,brokenPacketType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG)),msgObj={isEdit:isEditedMessage,tag_chat:!1,ip:ip,port:port,packetType:packetType,brokenPacketType:brokenPacketType,fullName:currentUser.getName(),userId:currentUserId,messageType:messageType,messageDate:messageDate,message:message,key:keyOrPacketId,packetId:keyOrPacketId,isSecretVisible:box.isSecretVisible?1:0,timeout:0,platform:PLATFORM.WEB},isTagChat){var tagId=box.getKey(),tagObject=tagChatFactory.getOrCreateTag(tagId);!ip&&tagObject.getChatIp()&&(ip=tagObject.getChatIp(),box.setIp(ip)),!box.getPort()&&tagObject.getChatBindingPort()&&(port=tagObject.getChatBindingPort(),box.setPort(port),box.lastCommunicationTime=tagObject.getLastCommunicationTime()),msgObj.tag_chat=!0,msgObj.tagId=tagId}else msgObj.friendId=box.getUser().getKey(),box.secretChat?msgObj.timeout=box.timeout:msgObj.timeout=0;return msgObj},messagePreSendProcess=function(msgObj,messageData){switch(utilsFactory.hasEmoticon(msgObj.message)&&(msgObj.messageType=3),msgObj.messageType){case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LOCATION_SHARE:processMsgForLocationShare(msgObj,messageData.locationData);break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LINK_SHARE:processMsgForLinkShare(msgObj,messageData.ogData);break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.IMAGE:case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.CAMERA_IMAGE:case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.VIDEO:processMsgForMedia(msgObj,messageData.mediaData)}},utf8EncodeMessageObject=function(msgObj){msgObj.message=msgObj.message||msgObj.text,msgObj.message=msgObj.message.utf8Encode()},_doAfterTagSendFailure=function(box,msgObj,messageData){pushToTemporaryArray(box,msgObj,messageData),utilsFactory.triggerCustomEvent("RE_REGISTER_TAG",{tagId:box.getKey()}),RingLogger.alert("Unable to send tag msg ",msgObj,RingLogger.tags.TAG_CHAT)},getFriendOnlineStatusMultipleTime=function(friendId){var func=ChatApiService.getFriendOnlineStatus,args=[friendId];return utilsFactory.requestMultipleTime(func,args)},getF2FIpPortMultipleTime=function(friendId){ChatApiService.requestForIp(friendId)},_doAfterChatMsgSendFailure=function(box,msgObj,messageData){var boxMessageObject=box.getMessage(msgObj.packetId),currentState=msgObj.SENDING_STATE;0!=boxMessageObject.status&&"Pending"!=boxMessageObject.status||getFriendOnlineStatusMultipleTime(msgObj.userId).then(function(response){RingLogger.debug("SEND MESSAGE USER PRESENCE ",response,RingLogger.tags.CHAT_SEND_MESSAGE),response.sucs&&response.psnc==CHAT_GENERAL_CONSTANTS.USER_PRESENCE.ONLINE?(msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.SECOND_ONLINE,doSendMessage(box,msgObj,messageData)):(msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE,doSendMessage(box,msgObj,messageData,!0),RingLogger.debug("CHAT MSG SENDING FAILED, PRESENCE STATUS SUCS FALSE",RingLogger.tags.CHAT)),logSendMessageStateChange(msgObj,currentState)},function(response){msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,pushToTemporaryArray(box,msgObj,messageData),ChatApiService.requestForIp(msgObj.friendId),logSendMessageStateChange(msgObj,currentState)})},doUpdateOfflineIpPort=function(){var defer=$q.defer();return ChatApiService.getOfflineIpPort().then(function(response){response.sucs?(Auth.loginData.oIP=response.oIP,Auth.loginData.oPrt=response.oPrt,Auth.updateLocalStorageLoginData(Auth.loginData),RingLogger.debug("OFFLINE_IP_PORT_UPDATED",response,RingLogger.tags.CHAT_SEND_MESSAGE),defer.resolve(response)):(RingLogger.debug("OFFLINE_IP_PORT_UPDATE_FAILED",response,RingLogger.tags.CHAT_SEND_MESSAGE),defer.reject(response))},function(response){RingLogger.debug("OFFLINE_IP_PORT_UPDATE_FAILED",response,RingLogger.tags.CHAT_SEND_MESSAGE),defer.reject(response)}),defer.promise},logSendMessageStateChange=function(msgObj,previousState){msgObj.SENDING_STATE!=previousState&&(angular.isDefined(previousState)?RingLogger.debug(chatUtilsFactory.getChatStateName(previousState)," -> ",chatUtilsFactory.getChatStateName(msgObj.SENDING_STATE),msgObj.message,RingLogger.tags.CHAT_SEND_MESSAGE):RingLogger.debug(chatUtilsFactory.getChatStateName(msgObj.SENDING_STATE),msgObj.message,RingLogger.tags.CHAT_SEND_MESSAGE))},updateMessageObjectIpPort=function(box,msgObj,sendOffline){if(sendOffline){var offlineIpPort=chatUtilsFactory.getOfflineIpPort();msgObj.ip=offlineIpPort.ip,msgObj.port=offlineIpPort.port}else msgObj.ip=box.getIp(),msgObj.port=box.getPort();return msgObj},updateBoxMessageStatus=function(box,msgObj,status){var boxMessageObject=box.getMessage(msgObj.packetId);boxMessageObject&&(boxMessageObject.status=status,chatHistoryFactory.updateMessage(boxMessageObject,box.getKey()),utilsFactory.triggerCustomEvent("SINGLE_BOX_UPDATED",{box:box}))},doSendMessage=function(box,msgObj,messageData,sendOffline){var afterFailureCallback,aChatSender,aChatSenderInstance;updateMessageObjectIpPort(box,msgObj,sendOffline),utf8EncodeMessageObject(msgObj),msgObj.fromTemporary=!1,afterFailureCallback=msgObj.tag_chat?_doAfterTagSendFailure:_doAfterChatMsgSendFailure,logSendMessageStateChange(msgObj);try{aChatSender=new ChatPacketSender,aChatSender.setPacketObject(msgObj),aChatSender.setBrokenPacketType(msgObj.brokenPacketType),aChatSenderInstance=aChatSender.getInstance(),aChatSenderInstance.on("failure",function(){var currentState=msgObj.SENDING_STATE;switch(msgObj.SENDING_STATE){case CHAT_STATES.MESSAGE_SENDING.FIRST_ONLINE:box.isTagChat?msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH:msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.PRESENCE_REFRESH,afterFailureCallback.call(this,box,msgObj,messageData);break;case CHAT_STATES.MESSAGE_SENDING.SECOND_ONLINE:box.isTagChat?(msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_FAILED,updateBoxMessageStatus(box,msgObj,"Failed")):(msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH,pushToTemporaryArray(box,msgObj,messageData),ChatApiService.requestForIp(msgObj.friendId));break;case CHAT_STATES.MESSAGE_SENDING.THIRD_ONLINE:msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE,doSendMessage(box,msgObj,msgObj.messageData,!0);break;case CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE:msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.OFFLINE_IP_PORT_REFRESH,doUpdateOfflineIpPort().then(function(){msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.SECOND_OFFLINE,doSendMessage(box,msgObj,msgObj.messageData,!0)},function(){msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.OFFLINE_FAILED,updateBoxMessageStatus(box,msgObj,"Failed")});break;case CHAT_STATES.MESSAGE_SENDING.SECOND_OFFLINE:msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.OFFLINE_FAILED,updateBoxMessageStatus(box,msgObj,"Failed")}logSendMessageStateChange(msgObj,currentState)}),aChatSenderInstance.on("success",function(){var currentState=msgObj.SENDING_STATE;switch(msgObj.SENDING_STATE){case CHAT_STATES.MESSAGE_SENDING.FIRST_ONLINE:case CHAT_STATES.MESSAGE_SENDING.SECOND_ONLINE:case CHAT_STATES.MESSAGE_SENDING.THIRD_ONLINE:msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_SUCCESS;break;case CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE:case CHAT_STATES.MESSAGE_SENDING.SECOND_OFFLINE:msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.OFFLINE_SUCCESS}logSendMessageStateChange(msgObj,currentState)}),aChatSenderInstance.start()}catch(e){RingLogger.alert("Tag Create  Exception ",e,RingLogger.tags.TAG_CHAT)}},doRetryMessage=function(box,msgObj,messageData){msgObj.tag_chat?msgObj.tagId=box.getKey():msgObj.friendId=box.getKey(),box.checkWaitingTimePassed()||!box.hasIpPort()?(msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,pushToTemporaryArray(box,msgObj,messageData),ChatApiService.requestForIp(msgObj.friendId)):(msgObj.SENDING_STATE=msgObj.SENDING_STATE||CHAT_STATES.MESSAGE_SENDING.FIRST_ONLINE,updateMessageObjectIpPort(box,msgObj),doSendMessage(box,msgObj,messageData))},sendTemporaryMessages=function(box,sendOffline){for(;angular.isArray(box.tempMessageArray)&&box.tempMessageArray.length>0;){var individualMsgObject=box.tempMessageArray.shift(),currentState=individualMsgObject.SENDING_STATE;switch(individualMsgObject.SENDING_STATE){case CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REFRESH:box.isTagChat?individualMsgObject.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.SECOND_ONLINE:sendOffline?individualMsgObject.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE:individualMsgObject.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.THIRD_ONLINE,doSendMessage(box,individualMsgObject,individualMsgObject.messageData,sendOffline);break;case CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST:box.isTagChat||!sendOffline?individualMsgObject.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.FIRST_ONLINE:individualMsgObject.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE,doSendMessage(box,individualMsgObject,individualMsgObject.messageData,sendOffline)}logSendMessageStateChange(individualMsgObject,currentState)}},processAndSendMessage=function(box,message,messageType,messageData){var msgObj=getMessageObject(box,message,messageType,messageData),currentUser=Auth.currentUser();messagePreSendProcess(msgObj,messageData),updateMessageObjectIpPort(box,msgObj),msgObj.fromTemporary||box.pushMessage(msgObj,currentUser,!0),box.checkWaitingTimePassed()||!box.hasIpPort()?(msgObj.SENDING_STATE=CHAT_STATES.MESSAGE_SENDING.ONLINE_IP_PORT_REQUEST,pushToTemporaryArray(box,msgObj,messageData),ChatApiService.requestForIp(msgObj.friendId)):(msgObj.SENDING_STATE=msgObj.SENDING_STATE||CHAT_STATES.MESSAGE_SENDING.FIRST_ONLINE,doSendMessage(box,msgObj,messageData))},sendTypingPacket=function(box){if(box.isTagChat){if(box.getIp()){var tagObject=tagChatFactory.getTag(box.getKey());tagChatApiService.sendTagMsgTypingPacket(Auth.currentUser().getKey(),tagObject)}}else if(box.getIp()&&box.getPort()){var typingPacketObject=ChatApiService.getTypingPacketObject(box);ChatApiService.sendViaGlobalChatSocket(typingPacketObject,CHAT_PACKET_FORMAT.TYPING_PKT)}},sendIdlePacket=function(box){if(box.isTagChat){var tagObject=tagChatFactory.getTag(box.getKey());tagObject&&tagChatApiService.sendTagIdlePacket(Auth.currentUser().getKey(),tagObject)}else{var idlePacketObject=ChatApiService.getIdlePacketObject(box);ChatApiService.sendViaGlobalChatSocket(idlePacketObject,CHAT_PACKET_FORMAT.IDLE_PKT)}},sendBlankMessage=function(friendId){var blankMessageObject=ChatApiService.getBlankMessageObject(friendId);ChatApiService.sendViaGlobalChatSocket(blankMessageObject,CHAT_PACKET_FORMAT.CHAT_MSG_OFFLINE)},processAndSendOfflineMessage=function(box,message,messageType,previousPacketId,messageData){var msgObj=getMessageObject(box,message,messageType,messageData),currentUser=Auth.currentUser();previousPacketId&&(msgObj.packetId=previousPacketId,msgObj.key=previousPacketId),messagePreSendProcess(msgObj,messageData),msgObj.SENDING_STATE=msgObj.SENDING_STATE||CHAT_STATES.MESSAGE_SENDING.FIRST_OFFLINE,msgObj.fromTemporary||previousPacketId||(box.pushMessage(msgObj,currentUser,!0),utilsFactory.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:box.getKey(),scroll:"bottom"})),RingLogger.debug("SEND OFFLINE MSG OBJECT : ",msgObj,RingLogger.tags.CHAT),doSendMessage(box,msgObj,messageData,!0)},sendChatUnRegisterPacket=function(box){var unRegisterPacket=ChatApiService.getF2FUnRegisterObject(box);ChatApiService.sendViaGlobalChatSocket(unRegisterPacket,CHAT_PACKET_FORMAT.FRIEND_UNREGISTER_PKT)};self.processAndSendMessage=processAndSendMessage,self.sendMessage=doSendMessage,self.retryMessage=doRetryMessage,self.sendTypingPacket=sendTypingPacket,self.sendIdlePacket=sendIdlePacket,self.sendBlankMessage=sendBlankMessage,self.sendChatUnRegisterPacket=sendChatUnRegisterPacket,self.sendTemporaryMessages=sendTemporaryMessages,self.processAndSendOfflineMessage=processAndSendOfflineMessage,self.doUpdateOfflineIpPort=doUpdateOfflineIpPort,self.getF2FIpPortMultipleTime=getF2FIpPortMultipleTime}angular.module("ringid.chat").service("ChatPacketSenderService",ChatPacketSenderService),ChatPacketSenderService.$inject=["CHAT_PACKET_FORMAT","Auth","utilsFactory","tagChatApiService","tagChatFactory","CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","chatPacketResender","ChatApiService","PLATFORM","chatUtilsFactory","CHAT_STATES","$q","chatHistoryFactory","chatTabSync"]}(),function(){"use strict";function CrossTab(){function NotSupported(){var errorMsg="CrossTab not supported",reasons=[];throw localStorage||reasons.push("localStorage not available"),window.addEventListener||reasons.push("addEventListener not available"),reasons.length>0&&(errorMsg+=": "+reasons.join(", ")),new Error(errorMsg)}function now(){return(new Date).getTime()}function onStorageEvent(event){if(event&&"__CROSSTAB"==event.key){var eventValue;try{eventValue=event.newValue?JSON.parse(event.newValue):{}}catch(e){eventValue={}}eventValue&&eventValue.id&&eventValue.id!==CrossTab.id&&(event.newValue===lastNewValue&&event.oldValue===lastOldValue||(lastNewValue=event.newValue,lastOldValue=event.oldValue,callbacks.message?callbacks.message.call(this,eventValue.data):RingLogger.warning("On Message Handler Not Set",RingLogger.tags.DEBUG)))}}function setLocalStorageItem(key,data){var storageItem={id:tabId,data:data,timestamp:now()};localStorage.setItem(key,JSON.stringify(storageItem))}function swapUnloadEvents(){window.removeEventListener("beforeunload",unload,!1),window.addEventListener("unload",unload,!1)}function unload(){}function pad(num,width,padChar){padChar=padChar||"0";var numStr=num.toString();return numStr.length>=width?numStr:new Array(width-numStr.length+1).join(padChar)+numStr}function broadcast(data){CrossTab.supported||NotSupported();var message={data:data,origin:tabId};setLocalStorageItem("__CROSSTAB",message)}var lastNewValue,lastOldValue,tabId,callbacks={},generateId=function(){return now().toString()+pad(2147483647*Math.random()|0,10)};this.on=function(name,callback){callbacks[name]=callback},this.setId=function(id){tabId=id},this.getId=function(){return tabId},this.broadcast=broadcast,this.init=function(){CrossTab.supported=!!localStorage&&window.addEventListener,CrossTab.supported?(tabId=generateId(),window.addEventListener("storage",onStorageEvent,!1),window.addEventListener("beforeunload",unload,!1),window.addEventListener("DOMContentLoaded",swapUnloadEvents,!1)):CrossTab.broadcast=NotSupported}}function chatTabSync(Storage,utilsFactory,CHAT_GENERAL_CONSTANTS,SystemEvents){var myTabId,worker,corssTab,tabSender,isSharedWorkerSupported=!!window.SharedWorker,isLocalStorageSupported=!!window.localStorage,sendViaSharedWorker=function(type,data){try{worker.port.postMessage({origin:myTabId,data:angular.extend(data,{type:type})})}catch(e){RingLogger.alert("Tab Sync Exception",e,RingLogger.tags.CHAT)}},sendViaLocalStorage=function(type,data){try{corssTab.broadcast(angular.extend(data,{type:type}))}catch(e){RingLogger.alert("Tab Sync Exception",e,RingLogger.tags.CHAT)}},initSharedWorker=function(){myTabId=utilsFactory.getUniqueID("t"),worker=new SharedWorker(CHAT_GENERAL_CONSTANTS.SHARED_WORKER_PATH),worker.port.addEventListener("message",function(event){var message=event.data;message.origin!==myTabId&&(RingLogger.debug("TAB DATA RECEIVED VIA SHARED WORKER",message,RingLogger.tags.TAB_DATA_RECEIVED),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.TAB_SYNC_NEW_DATA,message.data))}.bind(this),!1),worker.port.start()},initShareViaLocalStorage=function(){corssTab=new CrossTab,corssTab.init(),myTabId=corssTab.getId(),corssTab.on("message",function(message){message.origin!==myTabId&&(RingLogger.debug("TAB DATA RECEIVED VIA LOCAL STORAGE",message,RingLogger.tags.TAB_DATA_RECEIVED),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.TAB_SYNC_NEW_DATA,message.data))})},_sendData=function(type,data){tabSender&&tabSender.call(this,type,data)},_init=function(){isSharedWorkerSupported?(initSharedWorker(),tabSender=sendViaSharedWorker):isLocalStorageSupported?(initShareViaLocalStorage(),tabSender=sendViaLocalStorage):(tabSender=function(){},RingLogger.alert("LOCAL STORAGE NOT SUPPORTED, CROSS TAB SENDING FAIED",RingLogger.tags.TAG_CHAT))};return{init:_init,sendData:_sendData}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.factory("chatTabSync",chatTabSync),chatTabSync.$inejct=["Storage","utilsFactory","CHAT_GENERAL_CONSTANTS","SystemEvents"],chatTabSync.$inject=["Storage","utilsFactory","CHAT_GENERAL_CONSTANTS","SystemEvents"]}(),function(){"use strict";function openBox(ChatFactory,PullerSubscriber,tagChatFactory,tagChatManager,rgDropdownService,utilsFactory,Auth,ChatHelper,rgScrollbarService,$rootScope){return{link:function(scope,element,attrs){element.on("click",function(event){var boxId=attrs.boxId?attrs.boxId:!1,isTagChat="true"==attrs.isTagChat;if(!boxId)return void RingLogger.alert("Invalid ChatBoxId to open box",RingLogger.tags.CHAT);if(attrs.openChatBox==Auth.currentUser().getKey())return void RingLogger.alert("Same User ChatBox",RingLogger.tags.CHAT);rgDropdownService.close();var tagObject,tagChatBoxOpened=!1;
isTagChat?(tagObject=tagChatFactory.getTag(boxId),tagObject&&tagObject.isTagSafeToShow()&&(tagChatFactory.isTagRegistered(boxId)||tagChatManager.requestForIp(boxId),tagChatBoxOpened=!0,ChatFactory.openTagChatBox(boxId,!0))):(ChatFactory.openChatBox(boxId,!0),PullerSubscriber.requestForIp(boxId));var box=ChatFactory.getBoxByUId(boxId);box&&(box.loadHistoryMessages(),ChatHelper.decreaseUnreadCount(box),tagChatBoxOpened&&box.setTitle(tagObject.getTagName())),utilsFactory.safeDigest(scope),event.preventDefault(),event.stopPropagation()})}}}function openChatBox(ChatFactory,PullerSubscriber,utilsFactory,Auth,$rootScope,ChatHelper){return{link:function(scope,element,attrs){element.on("click",function(event){if(!attrs.openChatBox)return void RingLogger.alert("Invalid ChatBoxId to open box",RingLogger.tags.CHAT);if(attrs.openChatBox==Auth.currentUser().getKey())return void RingLogger.alert("Same User ChatBox",RingLogger.tags.CHAT);utilsFactory.safeDigest(scope),ChatFactory.openChatBox(attrs.openChatBox,!0);var box=ChatFactory.getBoxByUId(attrs.openChatBox);if(1==box.getUser().friendshipStatus())PullerSubscriber.requestForIp(attrs.openChatBox);else{var permission=Auth.getPermission();if(1==permission.ancht)PullerSubscriber.requestForIp(attrs.openChatBox);else{var box=ChatFactory.getBoxByUId(attrs.openChatBox);box.blocked=!0}}box&&(box.loadHistoryMessages(),ChatHelper.decreaseUnreadCount(box)),event.preventDefault(),event.stopPropagation()})}}}function openTagChatBox(ChatFactory,tagChatApiService,tagChatFactory,tagChatManager,Auth,$rootScope,ChatHelper){return{link:function(scope,element,attrs){element.on("click",function(){var tagId=attrs.openTagChatBox;if(0>=tagId)return void RingLogger.alert("Invalid TagId to open box",RingLogger.tags.TAG_CHAT);if(attrs.openChatBox==Auth.currentUser().getKey())return void RingLogger.alert("Same User ChatBox",RingLogger.tags.CHAT);var tagObject=tagChatFactory.getTag(tagId),box=ChatFactory.openTagChatBox(tagId,!0);box.setTitle(tagObject.getTagName()),tagObject&&tagObject.isTagSafeToShow()&&(tagChatFactory.isTagRegistered(tagId)?RingLogger.print("Skipping Initiator Request",RingLogger.tags.TAG_CHAT):(tagChatFactory.setTagChatInitiator(tagId),tagObject&&tagChatApiService.createOrGetTagFromAuth(tagObject,tagObject.getMemberUserIds()).then(function(response){response.isInitiated=!0,tagChatManager.doOnTagChatRequestStartResponse(response)}))),box&&(box.loadHistoryMessages(),ChatHelper.decreaseUnreadCount(box))})}}}function makeVisibleChatBox(ChatFactory,$rootScope){return{link:function(scope,element,attrs){element.on("click",function(){scope.rbox.value.isFocused=!0,ChatFactory.makeVisibleChatBox(attrs.makeVisibleChatBox),$rootScope.$broadcast("focusOn",scope.rbox.value.getKey()),element.parent().parent().children().eq(0).removeClass("blink")})}}}function showHiddenBoxes(ChatFactory,$rootScope){return{link:function(scope,element,attrs){element.on("click",function(){ChatFactory.openChatBox(attrs.openChatBox)})}}}function closeBox(ChatFactory,chatHistoryFactory,tagChatFactory){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(){ChatFactory.closeChatBox(scope.box.value.getKey()),chatHistoryFactory.removeOpenBox(scope.box.value.getKey());var tagObject=tagChatFactory.getTag(scope.box.value.getKey());tagObject&&tagObject.initMessages(),scope.$parent.$digest()})}}}function minimizeBox(ChatFactory){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(event){scope.box.value.blinkOn&&!scope.box.value.isMinimized?(scope.$broadcast("blinkerOff",scope.box.value.getKey()),scope.$broadcast("focusOn",scope.box.value.getKey())):scope.box.value.blinkOn&&scope.box.value.isMinimized?(ChatFactory.minimizeBox(scope.box.value.getKey()),scope.$broadcast("blinkerOff",scope.box.value.getKey()),scope.$broadcast("focusOn",scope.box.value.getKey())):scope.box.value.blinkOn||scope.box.value.isMinimized?!scope.box.value.blinkOn&&scope.box.value.isMinimized&&(ChatFactory.minimizeBox(scope.box.value.getKey()),scope.$broadcast("focusOn",scope.box.value.getKey())):ChatFactory.minimizeBox(scope.box.value.getKey()),scope.$digest(),event.stopPropagation()})}}}function maximizeBox(ChatFactory){return{scope:!1,restrict:"A",link:function(scope,element,attrs){}}}function tagChatEdit(ChatFactory,rgDropdownService,$compile){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(event){scope.showDropdown=!scope.showDropdown,event.stopPropagation()})},controller:["$scope","tagChatFactory","tagChatManager","Auth","Ringalert","$compile",function($scope,tagChatFactory,tagChatManager,Auth,Ringalert,$compile){function tagMemberDDActions(actionObj){switch(actionObj.action){case"edit":case"view":return rgDropdownService.close(),function(){return{tagId:actionObj.tagId}};case"delete":rgDropdownService.close();var tagObject=tagChatFactory.getTag(actionObj.tagId);tagObject.setObjectLock(),tagChatManager.leaveFromTag(actionObj.tagId,currentUser.getKey()).then(function(response){tagObject.removeObjectLock(),Ringalert.show(response,"info")},function(response){tagObject.removeObjectLock(),Ringalert.show(response,"error")});break;default:RingLogger.log("Err. no matching action")}}$scope.showDropdown=!1,$scope.hasTagObjectLock=function(tagId){var tagObject=tagChatFactory.getTag(tagId);return tagObject?tagObject.hasObjectLock():!1},$scope.getTagDDControl=function(tagId){var tagObject=tagChatFactory.getTag(tagId),currentUserMemberObject=tagObject.getMember(Auth.loginData.uId);return{tagId:tagId,isOwner:currentUserMemberObject?currentUserMemberObject.isOwner():!1}},$scope.tagMemberDDActions=tagMemberDDActions,$scope.tagMemberDDHtml="pages/partials/tag-chat/member-actions-dropdown.html"}]}}function chatScrollBottom($rootScope,rgScrollbarService){return{restrict:"A",link:function(scope,element,attrs){scope.$on("ScrollToBottom",function(event,userId){userId==scope.box.value.getKey()&&(event.preventDefault(),rgScrollbarService.scrollTo(scope,100))}),$rootScope.$on("ScrollToBottom",function(event,userId){userId==scope.box.value.getKey()&&(event.preventDefault(),rgScrollbarService.scrollTo(scope,100))}),$rootScope.$on("ScrollToUnread",function(event,userId){userId==scope.box.value.getKey()&&(event.preventDefault(),rgScrollbarService.scrollTo(scope,".status-Unread","down"))})}}}function chatBlinker($window,chatHistoryFactory){return{restrict:"A",link:function(scope,element,attrs){scope.box.value.blinkOn===!0&&element.addClass("blink"),scope.$on("blinkerEvent",function(event,userId){userId.toString()===scope.box.value.getKey()&&(scope.box.value.isMinimized?scope.box.value.isFocused===!1&&(element.addClass("blink"),scope.box.value.blinkOn=!0):scope.box.value.isFocused===!1&&(element.addClass("blink"),scope.box.value.blinkOn=!0),chatHistoryFactory.updateBox(scope.box.value))}),scope.$on("blinkerOff",function(event,userId){userId.toString()===scope.box.value.getKey()&&(element.removeClass("blink"),scope.box.value.blinkOn=!1,chatHistoryFactory.updateBox(scope.box.value))})}}}function chatBlinkerH($window,chatHistoryFactory){return{restrict:"A",link:function(scope,element,attrs){scope.$on("blinkerEvent",function(event,userId){userId.toString()===scope.rbox.value.getKey()&&(element.addClass("blink"),element.parent().parent().children().eq(0).addClass("blink"),chatHistoryFactory.updateBox(scope.rbox.value))})}}}function chatSelectEmo(ChatPacketSenderService){return{restrict:"A",link:function(scope,element,attrs){scope.selectEmoticon=function(emoticon){scope.messageText=scope.messageText+emoticon.symbol()}}}}function chatBindOutsideClick($document,utilsFactory){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(e){e.stopPropagation()}),$document.bind("click",function(){scope.showHidden=!1,utilsFactory.safeDigest(scope)})}}}function sharedContent(utilsFactory){return{restrict:"A",link:function(scope){scope.initMessageData=function(){scope.messageData={ogData:{},locationData:{}}},scope.resetOgInfo=function(){scope.messageData.ogData={},scope.ogStatus={preview:!1,loading:!1,filterOnProgress:!1}},scope.resetMessageLocation=function(){scope.messageData.locationData={description:"",lat:"",lng:""}},scope.resetMessageText=function(){scope.messageText=""},scope.resetBottomMenu=function(){scope.showBottomMenu=!1},scope.resetMessageInput=function(digest){scope.initMessageData(),scope.resetBottomMenu(),scope.resetMessageText(),scope.resetOgInfo(),scope.resetMessageLocation(),digest&&utilsFactory.safeDigest(scope)},scope.resetMessageInput(!1)}}}openBox.$inject=["ChatFactory","PullerSubscriber","tagChatFactory","tagChatManager","rgDropdownService","utilsFactory","Auth","ChatHelper","rgScrollbarService","$rootScope"],openChatBox.$inject=["ChatFactory","PullerSubscriber","utilsFactory","Auth","$rootScope","ChatHelper"],openTagChatBox.$inject=["ChatFactory","tagChatApiService","tagChatFactory","tagChatManager","Auth","$rootScope","ChatHelper"],makeVisibleChatBox.$inject=["ChatFactory","$rootScope"],showHiddenBoxes.$inject=["ChatFactory","$rootScope"],closeBox.$inject=["ChatFactory","chatHistoryFactory","tagChatFactory"],minimizeBox.$inject=["ChatFactory"],maximizeBox.$inject=["ChatFactory"],tagChatEdit.$inject=["ChatFactory","rgDropdownService","$compile"],chatScrollBottom.$inject=["$rootScope","rgScrollbarService"],chatBlinker.$inject=["$window","chatHistoryFactory"],chatBlinkerH.$inject=["$window","chatHistoryFactory"],chatSelectEmo.$inject=["ChatPacketSenderService"],chatBindOutsideClick.$inject=["$document","utilsFactory"],sharedContent.$inject=["utilsFactory"],angular.module("ringid.chat").directive("openBox",openBox).directive("openChatBox",openChatBox).directive("openTagChatBox",openTagChatBox).directive("makeVisibleChatBox",makeVisibleChatBox).directive("showHiddenBoxes",showHiddenBoxes).directive("closeBox",closeBox).directive("minimizeBox",minimizeBox).directive("maximizeBox",maximizeBox).directive("tagChatEdit",tagChatEdit).directive("chatScrollBottom",chatScrollBottom).directive("chatBlinkerH",chatBlinkerH).directive("chatBindOutsideClick",chatBindOutsideClick).directive("sharedContent",sharedContent)}(),function(){"use strict";function doSendHistoryRequest(scope,requestMethod,chatBox,direction,packetId,limit){var boxId=chatBox.getKey();scope.historyLoading=!0,requestMethod.call(this,boxId,direction,packetId,limit).then(function(response){response.sucs&&(scope.historyLoading=!1)},function(){scope.historyLoading=!1,chatBox.hasHistoryMessage=!0})}function chatBoxUi(ChatFactory,tagOfflineChatManager,utilsFactory,TAG_CHAT_GENERAL_CONSTANTS,rgScrollbarService,$rootScope){var templateUrl="pages/chatbox.html";return{restrict:"E",replace:!0,scope:!0,templateUrl:templateUrl,link:function(scope){var doHistoryRequest=function(boxId){var chatBox=ChatFactory.getBoxByUId(boxId);if(chatBox&&chatBox.nonDomBox){var topPacketId,bottomPacketId,bottomMessage=chatBox.getBottomMessage(),topMessage=chatBox.getTopMessage();if(topMessage||bottomMessage?(bottomPacketId=chatBox.messageMinPacketId,topPacketId=chatBox.messageMaxPacketId):topPacketId=bottomPacketId=ChatFactory.getUUIDPacketId(),!chatBox.hasHistoryMessage){var historyRequestMethod=tagOfflineChatManager.getHistoryRequestMethodByBox(chatBox),isSameMessage=topPacketId==bottomPacketId,limit=20;doSendHistoryRequest(scope,historyRequestMethod,chatBox,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.UP,bottomPacketId,limit),isSameMessage||doSendHistoryRequest(scope,historyRequestMethod,chatBox,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.DOWN,topPacketId,limit)}}utilsFactory.safeDigest(scope)};utilsFactory.onCustomEvent("CHAT_HISTORY_LOADED",function(chatHistoryLoadedData){doHistoryRequest(chatHistoryLoadedData.boxId)})}}}function extraChatBoxes(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/extra-chatboxes.html"}}function singleChatBox(rgScrollbarService,utilsFactory){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-chatbox.html",link:function(scope,elem,attr){var doSomethingOnMessageReceived=function(data){data.boxId.toString()==scope.box.key&&(rgScrollbarService.recalculate(scope),rgScrollbarService.hasScroll(scope),"bottom"!==data.scroll&&"received"!=data.type||setTimeout(function(){rgScrollbarService.scrollTo(scope,100),utilsFactory.safeDigest(scope)},101),utilsFactory.safeDigest(scope))};utilsFactory.onCustomEvent("NEW_MESSAGE_PUSHED",function(data){data.type="pushed",doSomethingOnMessageReceived(data)}),utilsFactory.onCustomEvent("MESSAGE_RECEIVED",function(event){scope.$broadcast("blinkerEvent",event.boxId),event.type="received",doSomethingOnMessageReceived(event)}),utilsFactory.onCustomEvent("SINGLE_BOX_UPDATED",function(data){var box=data.box;box.getKey()==scope.box.value.getKey()&&utilsFactory.safeDigest(scope)})}}}function chatBoxTopBar(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-topbar.html"}}function chatBoxTopBarMenu(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-topbar-menu.html",link:function(scope){var box=scope.box.value;scope.hideTopbar=!0,setTimeout(function(){scope.hideTopbar=!1,scope.$rgDigest()},3e3),scope.shouldShowLastOnlineBar=function(){return box.offlineStatus&&box.lastSeenBar&&!!box.getUser().lastOnline&&box.getUser().lastOnline()},scope.shouldShowFriendSuggestion=function(){return!box.hideSuggestion&!box.isTagChat&&!!box.getUser()&&1!=box.getUser().friendshipStatus()&&!box.offlineStatus},scope.shouldShowChatBoxTopbarMenu=function(){return!box.isTagChat&&(scope.shouldShowLastOnlineBar()||scope.shouldShowFriendSuggestion())}}}}function chatBoxUrlPreview(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-url-preview.html"}}function chatBoxBottom(utilsFactory,$document){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-bottom.html",link:function(scope,elem,attr){scope.toggleMenu=function(){scope.showBottomMenu=!scope.showBottomMenu,utilsFactory.safeDigest(scope)}}}}function chatBoxLocationInfo(){return{restrict:"E",replace:!0,link:function(scope){},templateUrl:"pages/partials/chat/chatbox-location-info.html"}}function chatBoxBottomMenu(utilsFactory){return{restrict:"E",replace:!0,link:function(scope,elem,attr){elem.on("mouseover",function(){scope.$parent.bottomMenuHover=!0}),elem.on("mouseleave",function(){scope.$parent.bottomMenuHover=!1})},templateUrl:"pages/partials/chat/chatbox-bottom-menu.html"}}function chatBoxMiddle(rgScrollbarService,$rootScope,utilsFactory){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-middle.html",link:function(scope){utilsFactory.onCustomEvent("CHAT_HISTORY_LOADED",function(chatHistoryLoadedData){rgScrollbarService.recalculate(scope),rgScrollbarService.hasScroll(scope),$rootScope.$broadcast("ScrollToBottom",chatHistoryLoadedData.boxId)})}}}function chatSingleMessage(utilsFactory,$ringbox){return{restrict:"E",replace:!0,link:function(scope,element,attr){var boxInstance,singleMessageUpdatedEventReference=utilsFactory.onCustomEvent("SINGLE_MESSAGE_UPDATED",function(data){var message=data.message;message.key==scope.message.key&&utilsFactory.safeDigest(scope)});scope.openRingboxContent=function(message){boxInstance=$ringbox.open({type:"remote",scopeData:{message:message},resolve:{data:{}},onBackDropClickClose:!0,templateUrl:"pages/partials/chat/media-preview.html"})},utilsFactory.onCustomEvent("SINGLE_MESSAGE_TIMEDOUT",function(data){data.box;boxInstance&&boxInstance.close()}),scope.$on("$destroy",function(){utilsFactory.removeCustomEvent("SINGLE_MESSAGE_UPDATED",singleMessageUpdatedEventReference)})},templateUrl:"pages/partials/chat/message/single.html"}}function chatFileUploadProgress(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/message/upload-progress.html"}}function singleMessageStatus(CHAT_GLOBAL_VALUES,utilsFactory){var getMessageStatusText=function(isTagChat,messageStatus){var statusText=messageStatus?messageStatus:"Pending";return isTagChat&&"Sent"===statusText&&(statusText="Delivered"),statusText},getMessageTime=function(messageDate){var localTime=messageDate-CHAT_GLOBAL_VALUES.serverTimeDiff,localFormatedTime=utilsFactory.chatVerbalDate(localTime);return localFormatedTime};return{restrict:"E",replace:!0,link:function(scope,elem,attrs){scope.$watch("message.status",function(){scope.message.statusText=getMessageStatusText(scope.box.value.isTagChat,scope.message.status),scope.message.statusDate=getMessageTime(scope.message.messageDate),scope.message.statusUserName=scope.message.user.getName()})},template:'<div class="t-chat" ><p ><span title="{{ message.statusUserName }}">{{ message.statusUserName }}</span>  {{ message.statusDate }}  <a data-tooltip-post=" {{message.statusText}} " class=" {{message.statusText}} "></a></p></div>'}}function chatHistoryLoader(tagOfflineChatManager,tagChatFactory,TAG_CHAT_GENERAL_CONSTANTS){return{restrict:"E",replace:!0,link:function(scope,elem,attrs){scope.historyLoading=!1,elem.on("click",function(){var bottomPacketId,chatBox=scope.box.value,bottomMessage=chatBox.getBottomMessage();bottomPacketId=bottomMessage?chatBox.messageMinPacketId:tagChatFactory.getUUIDPacketId();var historyRequestMethod=tagOfflineChatManager.getHistoryRequestMethodByBox(chatBox);doSendHistoryRequest(scope,historyRequestMethod,chatBox,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.UP,bottomPacketId,10)})},templateUrl:"pages/partials/chat/history-loader-view.html"}}function singlePageChatUI(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/home.html",controller:"ChatHistoryController"}}function chatSinglePageTop(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/top.html"}}function chatSinglePageLeft(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/left.html"}}function chatSinglePageRight(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/right.html"}}function chatLeftSingleBox(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/left-single-box.html"}}function chatRightSingleBox(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/right-single-box.html"}}function chatMessageBox(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/single-page/message-box.html"}}function chatBoxTopBarStatus(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/chat/chatbox-topbar-status.html",link:function(scope,elem){}}}chatBoxUi.$inject=["ChatFactory","tagOfflineChatManager","utilsFactory","TAG_CHAT_GENERAL_CONSTANTS","rgScrollbarService","$rootScope"],singleChatBox.$inject=["rgScrollbarService","utilsFactory"],chatBoxBottom.$inject=["utilsFactory","$document"],chatBoxBottomMenu.$inject=["utilsFactory"],chatBoxMiddle.$inject=["rgScrollbarService","$rootScope","utilsFactory"],chatSingleMessage.$inject=["utilsFactory","$ringbox"],singleMessageStatus.$inject=["CHAT_GLOBAL_VALUES","utilsFactory"],chatHistoryLoader.$inject=["tagOfflineChatManager","tagChatFactory","TAG_CHAT_GENERAL_CONSTANTS"],angular.module("ringid.chat").directive("chatBoxUi",chatBoxUi).directive("chatBoxTopBar",chatBoxTopBar).directive("chatBoxMiddle",chatBoxMiddle).directive("chatBoxBottom",chatBoxBottom).directive("extraChatBoxes",extraChatBoxes).directive("chatBoxUrlPreview",chatBoxUrlPreview).directive("chatBoxTopBarStatus",chatBoxTopBarStatus).directive("chatBoxTopBarMenu",chatBoxTopBarMenu).directive("chatBoxBottomMenu",chatBoxBottomMenu).directive("chatBoxLocationInfo",chatBoxLocationInfo).directive("chatSingleMessage",chatSingleMessage).directive("chatFileUploadProgress",chatFileUploadProgress).directive("singleMessageStatus",singleMessageStatus).directive("chatHistoryLoader",chatHistoryLoader).directive("singleChatBox",singleChatBox).directive("chatSinglePageTop",chatSinglePageTop).directive("chatSinglePageLeft",chatSinglePageLeft).directive("chatLeftSingleBox",chatLeftSingleBox).directive("chatSinglePageRight",chatSinglePageRight).directive("chatRightSingleBox",chatRightSingleBox).directive("chatMessageBox",chatMessageBox).directive("singlePageChatUI",singlePageChatUI)}(),function(){"use strict";function chatFocusDirective(fileUploadService,chatHistoryFactory,$document,$rootScope,utilsFactory,Auth,CHAT_GLOBAL_VALUES,ChatHelper,CHAT_GENERAL_CONSTANTS,settings,ChatSeenSend,ChatPacketSenderService,SystemEvents,chatTabSync,Ringalert){return{controller:["$scope","ChatSeenSend","ChatHelper","Auth","rgScrollbarService",function($scope,ChatSeenSend,ChatHelper,Auth,rgScrollbarService){$scope.onViewedCalled=function(message){var box=$scope.box.value,isTagChat=$scope.box.value.isTagChat,messages=[{key:message.key,value:message}],filterMessagesByViewPort=function(messages){for(var filteredMessages=[],index=0,length=messages.length;length>index;index++)messages[index].value.user.getKey()!==Auth.loginData.uId&&"Deleted"!==messages[index].value.status&&"Played"!==messages[index].value.status&&"Viewed"!==messages[index].value.status&&"status_update"!==messages[index].value.status&&1!=messages[index].value.seenSent&&filteredMessages.push(messages[index]);return filteredMessages};if(angular.isArray(messages)&&messages.length>0){if(messages=filterMessagesByViewPort(messages),messages.length<1)return;ChatSeenSend.sendSeenPacket(box,messages),isTagChat||ChatHelper.startTimerOthers($scope,messages)}},$scope.showUnreadMessages=function(){RingLogger.print("Unread Messages shown",RingLogger.tags.CHAT);var box=$scope.box.value;ChatHelper.decreaseUnreadCount(box),$rootScope.$broadcast("ScrollToBottom",box.getKey())}}],link:function(scope,element,attrs){scope.uploadBoxValue=scope.box.value.getKey(),scope.uploadAction=function(actionObj){RingLogger.print(actionObj,RingLogger.tags.CHAT);var keyOrPacketId=utilsFactory.getUniqueID("ring"),dummyMsgObj={key:keyOrPacketId,uploadProgress:actionObj.uploadFile.getProgress,uploading:!0,message:" ",mediaUrl:actionObj.uploadFile.getPreview(),messageDate:parseInt((new Date).getTime()+CHAT_GLOBAL_VALUES.serverTimeDiff),messageType:CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.IMAGE,packetId:keyOrPacketId,sessionId:utilsFactory.getToken,timeout:0,status:0,getMessageTime:function(){var localTime=dummyMsgObj.messageDate-CHAT_GLOBAL_VALUES.serverTimeDiff,localFormatedTime=utilsFactory.chatVerbalDate(localTime);return localFormatedTime},fileUploadObject:actionObj.uploadFile};scope.box.value.pushDummyMessage(dummyMsgObj,Auth.currentUser(),!0),fileUploadService.setScopeForDigest(scope),utilsFactory.safeDigest(scope);var afterUploadCallback=function(imgData){if(RingLogger.print(imgData,RingLogger.tags.CHAT),fileUploadService.removeScope(scope),imgData.sucs){var box=scope.box.value,isTagChat=box.isTagChat,mediaData=(box.offlineStatus,{url:imgData.url,caption:imgData.caption,width:imgData.iw,height:imgData.ih}),msg=settings.imBase+imgData.url;box.removeMessage(keyOrPacketId),isTagChat||ChatHelper.updateFriendPresence(box.getKey()),ChatHelper.updateBoxSessionIfRequired(box.getKey(),box),ChatPacketSenderService.processAndSendMessage(box,msg,CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.IMAGE,{mediaData:mediaData}),scope.resetMessageInput(),utilsFactory.safeDigest(scope),scope.$broadcast("ScrollToBottom",scope.box.value.getKey())}},uploadFailedCallback=function(response){Ringalert.show({mg:"Image Upload Failed, please try again"},"error"),box.removeMessage(keyOrPacketId)};actionObj.uploadFile.fetchMeta(function(){dummyMsgObj.message=actionObj.uploadFile.getPreview(),dummyMsgObj.uploading=!0,actionObj.uploadFile.initUpload().then(function(imgData){dummyMsgObj.uploading=!1,afterUploadCallback(imgData)},function(response){dummyMsgObj.uploading=!1,uploadFailedCallback(response)})})},utilsFactory.onCustomEvent("BOX_CAM_UPLOAD",function(data){scope.uploadAction(data)}),$document.on("click",function(event){scope.box.value.isFocused=!1});var messages=scope.box.value.getMessages(),box=scope.box.value,isTagChat=scope.box.value.isTagChat,filterMessageByMessageType=function(messages){for(var filteredMessages=[],index=0,length=messages.length;length>index;index++)switch(messages[index].value.messageType){case 2:case 3:case 4:case 5:case 6:filteredMessages.push(messages[index])}return filteredMessages},filterMessagesByViewPort=function(messages){for(var filteredMessages=[],index=0,length=messages.length;length>index;index++)messages[index].value.user.getKey()!==Auth.loginData.uId&&"Deleted"!==messages[index].value.status&&"Played"!==messages[index].value.status&&"Viewed"!==messages[index].value.status&&"status_update"!==messages[index].value.status&&1!=messages[index].value.seenSent&&filteredMessages.push(messages[index]);return filteredMessages},updateMessagesStatus=function(messages){for(var messagesToUpdate=[],index=0,length=messages.length;length>index;index++)"Unread"!=messages[index].value.status||messages[index].value.timeout&&0!=messages[index].value.timeout||(messages[index].value.status="Received",messagesToUpdate.push(messages[index].value));chatHistoryFactory.updateMessages(messagesToUpdate,box.getKey())},decreaseGlobalUnreadCount=function(boxId){chatHistoryFactory.removeUnreadMessageInfoByBoxId(boxId)};utilsFactory.onCustomEvent(SystemEvents.CHAT.TAB_SYNC_NEW_DATA,function(data){if(CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER==data.type&&(RingLogger.information("TAB_FOCUS_TIMER",data,RingLogger.tags.CHAT),data.boxId==box.getKey()&&angular.isArray(messages)&&messages.length>0)){updateMessagesStatus(messages);var filteredMessages;if(filteredMessages=filterMessagesByViewPort(messages),filteredMessages=filterMessageByMessageType(filteredMessages),filteredMessages.length<1)return;decreaseGlobalUnreadCount(data.boxId),box.updateUnreadCount(),isTagChat||ChatHelper.startTimerText(scope,filteredMessages)}}),utilsFactory.onCustomEvent("WAS_FOCUSED",function(data){var chatBox=data.box,filteredMessages=data.filteredMessages;chatBox.getKey()==box.getKey()&&(chatBox.isTagChat||ChatHelper.startTimerText(scope,filteredMessages),chatTabSync.sendData(CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:chatBox.getKey()}))});var onFocusCallback=function(event){event.stopPropagation();var boxId=scope.box.value.getKey(),box=scope.box.value,needDigest=!1;box.unreadCount>0&&(decreaseGlobalUnreadCount(boxId),box.updateUnreadCount(),needDigest=!0),RingLogger.print("Focus Called",RingLogger.tags.CHAT),scope.bottomMenuHover||scope.bottomMenuButtonHover||(scope.showBottomMenu=!1,needDigest=!0),needDigest&&utilsFactory.safeDigest(scope);for(var i=0;i<scope.boxes.length;i++)scope.boxes[i].value.isFocused=!1;if(box.isMinimized===!0?box.isFocused=!1:box.isFocused=!0,scope.$broadcast("blinkerOff",boxId),scope.$broadcast("focusOn",boxId),angular.isArray(messages)&&messages.length>0){updateMessagesStatus(messages);var filteredMessages;if(filteredMessages=filterMessagesByViewPort(messages),filteredMessages=filterMessageByMessageType(filteredMessages),filteredMessages.length<1)return;ChatSeenSend.sendSeenPacket(box,filteredMessages),isTagChat||ChatHelper.startTimerText(scope,filteredMessages),chatTabSync.sendData(CHAT_GENERAL_CONSTANTS.TAB_SYNC_ACTIONS.SECRET_CHAT_TIMER,{boxId:box.getKey()})}event.stopPropagation()};element.on("click",onFocusCallback)}}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("chatFocus",chatFocusDirective),chatFocusDirective.$inject=["fileUploadService","chatHistoryFactory","$document","$rootScope","utilsFactory","Auth","CHAT_GLOBAL_VALUES","ChatHelper","CHAT_GENERAL_CONSTANTS","settings","ChatSeenSend","ChatPacketSenderService","SystemEvents","chatTabSync","Ringalert"]}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("messageDirective",["Auth","profileFactory","$compile","chatHistoryFactory","$interval","ChatHelper","utilsFactory",function(Auth,profileFactory,$compile,chatHistoryFactory,$interval,ChatHelper,utilsFactory){return{restrict:"A",scope:!0,link:function(scope,element,attrs){var box=scope.$eval(attrs.messageBox);box=box.value;var avatorDom,dateLineDom,message=scope.$eval(attrs.messageMsg),takeDecisionForShowingMessageUserAvator=function(){return!box.isConsicutive(message.key)};if(scope.message.takeDecisionForShowingMessageUserAvator=takeDecisionForShowingMessageUserAvator,scope.message.showAvator=takeDecisionForShowingMessageUserAvator(),message.user.isCurrentUser()){if(element.addClass("cm-box-r"),"status_update"!==message.status){avatorDom=angular.element('<img ng-show="message.showAvator" class="chat-img-r chat-img" src="'+message.user.avatar("thumb")+'" />');var compiledAvatorDom=$compile(avatorDom)(scope);element.append(compiledAvatorDom)}}else if(element.addClass("cm-box"),"status_update"!==message.status){avatorDom=angular.element('<img ng-show="message.showAvator" class="chat-img-l chat-img" src="'+message.user.avatar("thumb")+'" />');var compiledAvatorDom=$compile(avatorDom)(scope);element.prepend(compiledAvatorDom)}var takeDecisionForShowingDate=function(){var currentMessageDate=Math.floor(message.messageDate/864e5);return box.previousDate!=currentMessageDate?(box.previousDate=currentMessageDate,RingLogger.print("PPP: "+box.previousDate+":::",RingLogger.tags.CHAT),RingLogger.print("PPP: "+scope.$id+":::",RingLogger.tags.CHAT),!0):!1};scope.message.takeDecisionForShowingDate=takeDecisionForShowingDate,scope.message.showDate=takeDecisionForShowingDate(),dateLineDom=angular.element('<div class="line" ng-show="message.showDate"><div class="line-m">{{ message.messageDate | date }}</div></div><div ng-show="message.showDate" class="clear"></div>');var compiledDateLineDom=$compile(dateLineDom)(scope);element.prepend(compiledDateLineDom),scope.$on("timeoutDelete",function(event,messageKey,timeoutCount){if(messageKey===message.key)if(RingLogger.log(messageKey+":"+timeoutCount),timeoutCount>0)scope.message.timeout=timeoutCount;else{var messageUserKey=message.user.getKey();if(messageUserKey==Auth.loginData.uId){switch(scope.message.timeout=0,scope.message.secretTimedOut=!0,scope.message.messageType){case 2:case 3:case 4:case 5:case 6:scope.message.status="Deleted";break;case 8:scope.message.status="Played";case 7:case 9:case 10:scope.message.status="Viewed"}chatHistoryFactory.updateMessage(scope.message,box.getKey())}else ChatHelper.deleteMessageFromOwn(box,message),utilsFactory.triggerCustomEvent("SINGLE_MESSAGE_TIMEDOUT",{box:box})}})}}}]).directive("editMessage",["$rootScope","CHAT_GLOBAL_VALUES",function($rootScope,CHAT_GLOBAL_VALUES){return{restrict:"EA",link:function(scope,element,attrs){element.on("click",function(event){$rootScope.$broadcast("editMessageEvent",attrs.editMessage,scope.message)});var calculateOneHourFilter=function(messageDate){var currentTime=Math.floor(Date.now()),messageDateInLocalTime=messageDate-CHAT_GLOBAL_VALUES.serverTimeDiff,diff=currentTime-messageDateInLocalTime,oneHour=36e5;return!(diff>oneHour)};scope.message.canEdit=function(){return scope.message.user.isCurrentUser()&&calculateOneHourFilter(scope.message.messageDate)&&-1===[4,6,7,8,9,10].indexOf(scope.message.messageType)&&!(scope.message.timeout>0||1==scope.message.secretTimedOut)&&-1===["Deleted","status_update","Viewed","Played"].indexOf(scope.message.status)}}}}]).directive("retryMessage",["ChatPacketSenderService","CHAT_STATES","ChatApiService",function(ChatPacketSenderService,CHAT_STATES,ChatApiService){return{restrict:"EA",link:function(scope,element,attrs){element.on("click",function(event){ChatPacketSenderService.retryMessage(scope.box.value,scope.message,scope.messageData)})}}}]).directive("deleteMessage",["Storage","PacketDataParse","utilsFactory","Auth","globalSocketFactory","CHAT_PACKET_FORMAT","tagChatFactory","tagChatApiService","CHAT_GLOBAL_VALUES","ChatApiService","ChatHelper",function(Storage,PacketDataParse,utilsFactory,Auth,globalSocketFactory,CHAT_PACKET_FORMAT,tagChatFactory,tagChatApiService,CHAT_GLOBAL_VALUES,ChatApiService,ChatHelper){return{restrict:"EA",link:function(scope,element,attrs){scope.message.canDelete=function(){
return-1===["status_update"].indexOf(scope.message.status)},element.on("click",function(event){if(ChatHelper.deleteMessageFromOwn(scope.box.value,scope.message),scope.message.user.getKey().toString()===Auth.loginData.uId.toString())if(scope.box.value.isTagChat)for(var tagId=scope.box.value.getKey(),tagObject=tagChatFactory.getTag(tagId),messagePacketId=scope.message.key,packetId=tagChatFactory.getUUIDPacketId(),index=0;5>index;index++)setTimeout(function(){tagChatApiService.deleteTagMultipleMsgInChatServer(Auth.loginData.uId,tagObject,packetId,[messagePacketId])},100);else if(1!=scope.message.secretTimedOut||scope.message.timeout>0){scope.box.value.sendTabUpdate(scope.message);for(var deleteObject=ChatApiService.getF2FMessageDeleteObject(scope.box.value,scope.message.key),index=0;5>index;index++)setTimeout(function(){ChatApiService.sendViaGlobalChatSocket(deleteObject,CHAT_PACKET_FORMAT.DELETE_PKT_OFFLINE)},100)}})}}}]).directive("chatMessageReact",["profileFactory",function(profileFactory){return{restrict:"A",link:function(scope,element,attrs){var message=scope.$eval(attrs.chatMessageReact),SClasses=["status_pending","status_delivered","status_seen","status_sent"],doUpdateStatus=function(){"status_update"==message.status?element.addClass("status_update"):message.user.isCurrentUser()?element.addClass("status_received"):SClasses[message.status]&&element.addClass(SClasses[message.status])};angular.isObject(message.user)?doUpdateStatus():profileFactory.getUserDetailsByUId(message.user).then(function(userObj){userObj&&(message.user=userObj,doUpdateStatus())})}}}]).directive("sendMessageDirective",["ChatFactory","$timeout","PacketDataParse","PullerSubscriber","tagChatApiService","tagChatFactory","tagChatManager","$$connector","OPERATION_TYPES","AUTH_SERVER_ACTIONS","CHAT_GENERAL_CONSTANTS","ChatPacketSenderService","ChatHelper","utilsFactory","SystemEvents","Ringalert",function(ChatFactory,$timeout,PacketDataParse,PullerSubscriber,tagChatApiService,tagChatFactory,tagChatManager,$$connector,OPERATION_TYPES,AUTH_SERVER_ACTIONS,CHAT_GENERAL_CONSTANTS,ChatPacketSenderService,ChatHelper,utilsFactory,SystemEvents,Ringalert){return{restrict:"A",link:function(scope,element,attrs){scope.messageText="",scope.selectedLocation=function(){scope.$emit("ScrollToBottom",scope.box.value.getKey()),utilsFactory.getUserLocation().then(function(location){location.sucs?(scope.messageData.locationData=location,ChatHelper.updateBoxSessionIfRequired(scope.box.value.getKey(),scope.box.value),location.lat&&9999!=location.lat?ChatPacketSenderService.processAndSendMessage(scope.box.value,"",CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LOCATION_SHARE,scope.messageData):RingLogger.alert("Location Lat not found.",location,RingLogger.tags.CHAT),scope.$rgDigest(),scope.$emit("ScrollToBottom",scope.box.value.getKey())):(Ringalert.show({mg:"Please Enable Browser Location Tracking."},"error"),RingLogger.alert(location.error,RingLogger.tags.CHAT))}),scope.resetMessageInput(!0)},scope.selectEmoticonChat=function(emoticon){if(emoticon.isSticker()||emoticon.isLargeEmoticon()){if(scope.resetMessageInput(),!scope.box.value.isTagChat){var friendId=scope.box.value.getKey();ChatHelper.updateFriendPresence(friendId,scope.box.value)}scope.box.value.offlineStatus===!0?ChatPacketSenderService.processAndSendOfflineMessage(scope.box.value,emoticon.srcWithoutBase(),6):(ChatHelper.updateBoxSessionIfRequired(scope.box.value.getKey(),scope.box.value),ChatPacketSenderService.processAndSendMessage(scope.box.value,emoticon.srcWithoutBase(),6),scope.messageText=""),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_SUBMITTED,{boxId:scope.box.value.getKey()}),scope.messageText="",scope.$emit("ScrollToBottom",scope.box.value.getKey())}else scope.messageText=scope.messageText+""+emoticon.symbol(),element[0].focus()};var bindEvent=function(){element.on("keyup",function(event){var messageType=CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.TEXT;scope.messageData.locationData.lat?messageType=CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LOCATION_SHARE:scope.messageData.ogData.url&&(messageType=CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LINK_SHARE);var sendTypingPacket=function(){var doSendTypingPacket=function(){scope.box.value.isTyping()===!1&&(ChatPacketSenderService.sendTypingPacket(scope.box.value),scope.box.value.setTypingBool(!0),$timeout(function(){scope.box.value.setTypingBool(!1)},5e3))};scope.box.value.checkWaitingTimePassed()||(scope.box.value.isTagChat?doSendTypingPacket():scope.box.value.offlineStatus===!1&&doSendTypingPacket())};if(scope.box.value.isTagChat)if(13===event.which){if(scope.messageText=scope.messageText.replace(/\n/g,""),""!==scope.messageText){if(scope.box.value.checkWaitingTimePassed()){var tagId=scope.box.value.getKey();tagChatManager.requestForIp(tagId)}element.attr("messageKey")&&(scope.box.value.editMessageKey=element.attr("messageKey"),element.removeAttr("messageKey"),scope.box.value.editMessageDate=element.attr("messageDate"),element.removeAttr("messageDate"),element.removeClass("editing")),ChatPacketSenderService.processAndSendMessage(scope.box.value,scope.messageText,messageType,scope.messageData),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_SUBMITTED,{boxId:scope.box.value.getKey()}),scope.resetMessageInput(!0),scope.$emit("ScrollToBottom",scope.box.value.getKey())}}else sendTypingPacket();else if(13===event.which){if(""!==scope.messageText){scope.messageText=scope.messageText.replace(/\n/g,"");scope.box.value.getKey();element.attr("messageKey")&&(scope.box.value.editMessageKey=element.attr("messageKey"),element.removeAttr("messageKey"),scope.box.value.editMessageDate=element.attr("messageDate"),element.removeAttr("messageDate")),scope.box.value.offlineStatus===!0?ChatPacketSenderService.processAndSendOfflineMessage(scope.box.value,scope.messageText,messageType,!1,scope.messageData):(ChatHelper.updateBoxSessionIfRequired(scope.box.value.getKey(),scope.box.value),ChatPacketSenderService.processAndSendMessage(scope.box.value,scope.messageText,messageType,scope.messageData)),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_SUBMITTED,{boxId:scope.box.value.getKey()}),element.removeClass("editing"),scope.$emit("ScrollToBottom",scope.box.value.getKey()),scope.resetMessageInput(!0)}}else sendTypingPacket()})},unbindEvent=function(){element.off("keyup")};bindEvent(),scope.$on("$destroy",unbindEvent),scope.box.value.isFocused===!0&&element[0].focus(),scope.$on("editMessageEvent",function(event,boxKey,messageObj){if(scope.box.value.getKey()==boxKey){var messageType=messageObj.messageType;switch(messageType){case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.TEXT:scope.messageText=messageObj.text;break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LOCATION_SHARE:scope.locationData=messageObj.locationInfo;break;case CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.LINK_SHARE:angular.fromJson(messageObj.text);scope.messageText=messageObj.ogData.message||messageObj.ogData.description}element.addClass("editing"),element.attr("messageKey",messageObj.key),element.attr("messageDate",messageObj.messageDate),utilsFactory.safeDigest(scope)}})}}}])}(),function(){"use strict";function chatSubscriber(SystemEvents,fileUploadService,PullerSubscriber,ChatFactory,profileFactory,PacketDataParse,userFactory,utilsFactory,$interval,$timeout,globalSocketFactory,Storage,CHAT_PACKET_FORMAT,Auth,chatHistoryFactory,TAG_CHAT_PACKET_TYPE,TAG_CHAT_GENERAL_CONSTANTS,tagChatFactory,tagChatApiService,tagChatManager,tagChatHelper,CHAT_GLOBAL_VALUES,tagChatPacketProcessor,ChatHelper,ChatPacketSenderService){function safeExecute(func){try{func.call()}catch(e){RingLogger.alert(e.stack,"chat-safe-execute",RingLogger.tags.CHAT)}}return{scope:!1,restrict:"A",link:function(scope,element,attrs){scope.offlineConfirmReceived=!1;var chatDataReceivedCallback=function(event,dataObj){var byteData=dataObj.byteData,packetType=PacketDataParse.getPacketType(byteData);safeExecute(function(){switch(packetType){case 2:var unregisterObject=PacketDataParse.parsePacket(byteData,2,CHAT_PACKET_FORMAT.FRIEND_UNREGISTER_PKT.FORMAT),box=ChatFactory.getBoxByUId(unregisterObject.userId);unregisterObject.userId===box.getKey()&&ChatFactory.closeChatBox(box.getKey());break;case 3:var confirmRegisterObject=PacketDataParse.parsePacket(byteData,3,CHAT_PACKET_FORMAT.REGISTER_CONFIRM_PKT.FORMAT),box=ChatFactory.getBoxByUId(confirmRegisterObject.friendId);CHAT_GLOBAL_VALUES.serverTimeDiff=confirmRegisterObject.serverDate-Date.now(),box||(box=ChatFactory.creatNonDomBox(confirmRegisterObject.friendId,!1)),box.setPort(confirmRegisterObject.port),box.lastCommunicationTime=Math.floor(Date.now()/1e3),ChatHelper.sendAfterRegisterIdlePacket(box.getKey(),box),ChatPacketSenderService.sendIdlePacket(box),ChatPacketSenderService.sendTemporaryMessages(box),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.CHAT_REGISTER,{friendId:confirmRegisterObject.friendId});break;case 4:var idleObject=PacketDataParse.parsePacket(byteData,10,CHAT_PACKET_FORMAT.IDLE_PKT.FORMAT),box=ChatFactory.getBoxByUId(idleObject.userId);box&&box.setFriendTypingBool(!1);break;case 5:var boxId,typingObject=PacketDataParse.parsePacket(byteData,9,CHAT_PACKET_FORMAT.TYPING_PKT.FORMAT);boxId=typingObject.userId==Auth.currentUser().getKey()?typingObject.friendId:typingObject.userId;var box=ChatFactory.getBoxByUId(boxId);box&&(box.setFriendTypingBool(!0),box.lastCommunicationTime=Math.floor(Date.now()/1e3),chatHistoryFactory.updateBox(box),$timeout(function(){box.setFriendTypingBool(!1)},3e3));break;case 6:break;var box,deliverObject;case 7:break;var box,deliverObject;case 15:var boxId,deliverObject=PacketDataParse.parsePacket(byteData,6,CHAT_PACKET_FORMAT.DELIVER_PKT.FORMAT);boxId=deliverObject.userId==Auth.currentUser().getKey()?deliverObject.friendId:deliverObject.userId;var box=ChatFactory.getBoxByUId(boxId);box||(ChatFactory.creatNonDomBox(boxId,!1),box=ChatFactory.getBoxByUId(boxId),box.nonDomBox=!1,PullerSubscriber.requestForIp(box.getKey()),box.loadHistoryMessages()),box.lastCommunicationTime=Math.floor(Date.now()/1e3),chatHistoryFactory.updateBox(box);var msgObj=box.getMessage(deliverObject.packetId);msgObj&&("Seen"!=msgObj.status&&"Deleted"!=msgObj.status&&"Viewed"!=msgObj.status&&"Played"!=msgObj.status&&(msgObj.status="Delivered"),chatHistoryFactory.updateMessage(msgObj,box.getKey()),box.sendTabUpdate(msgObj));break;case 16:var boxId,sentObject=PacketDataParse.parsePacket(byteData,7,CHAT_PACKET_FORMAT.SENT_PKT.FORMAT);boxId=sentObject.userId==Auth.currentUser().getKey()?sentObject.friendId:sentObject.userId;var box=ChatFactory.getBoxByUId(boxId);box||(ChatFactory.creatNonDomBox(boxId,!1),box=ChatFactory.getBoxByUId(boxId),box.nonDomBox=!1,PullerSubscriber.requestForIp(box.getKey()),box.loadHistoryMessages()),box.lastCommunicationTime=Math.floor(Date.now()/1e3),chatHistoryFactory.updateBox(box);var msgObj=box.getMessage(sentObject.packetId);msgObj&&("Seen"!=msgObj.status&&"Deleted"!=msgObj.status&&"Viewed"!=msgObj.status&&"Played"!=msgObj.status&&(msgObj.status="Delivered"),chatHistoryFactory.updateMessage(msgObj,box.getKey()),box.sendTabUpdate(msgObj));break;case 17:var boxId,seenObject=tagChatPacketProcessor.parseRawPacket(byteData),sendConfirmation=!0;seenObject.userId==Auth.currentUser().getKey()?(boxId=seenObject.friendId,sendConfirmation=!1):boxId=seenObject.userId;var box=ChatFactory.getBoxByUId(boxId),ip=box.ip,port=box.port;box||(ChatFactory.creatNonDomBox(boxId,!1),box=ChatFactory.getBoxByUId(boxId),box.nonDomBox=!1,PullerSubscriber.requestForIp(box.getKey()),box.loadHistoryMessages()),box.lastCommunicationTime=Math.floor(Date.now()/1e3),chatHistoryFactory.updateBox(box);for(var index=0;index<seenObject.messages.length;index++){var aBoxMessage=box.getMessage(seenObject.messages[index].packetId);aBoxMessage&&(3==seenObject.messages[index].status?(aBoxMessage.status="Seen",ChatHelper.startTimerText(scope,[{key:seenObject.messages[index].packetId,value:aBoxMessage}])):4==seenObject.messages[index].status&&(aBoxMessage.status="Viewed",ChatHelper.startTimerOthers(scope,[{key:seenObject.messages[index].packetId,value:aBoxMessage}])),chatHistoryFactory.updateMessage(aBoxMessage,box.getKey()),box.sendTabUpdate(aBoxMessage))}sendConfirmation&&ChatHelper.sendChatSeenConfirmation(ip,port,Auth.currentUser().getKey(),seenObject.userId,seenObject.packetId);break;case 18:var seenConfirmObject=PacketDataParse.parsePacket(byteData,18,CHAT_PACKET_FORMAT.SEEN_PKT_CONFIRM.FORMAT);RingLogger.information("SEEN_PACKET_CONFIRMATION",seenConfirmObject);break;case 19:var boxId,deleteObject=PacketDataParse.parsePacket(byteData,19,CHAT_PACKET_FORMAT.DELETE_PKT.FORMAT),sendConfirmation=!0,ownMessage=!1;deleteObject.userId==Auth.currentUser().getKey()?(boxId=deleteObject.friendId,sendConfirmation=!1,ownMessage=!0):boxId=deleteObject.userId;var box=ChatFactory.getBoxByUId(boxId);box||(ChatFactory.creatNonDomBox(boxId,!1),box=ChatFactory.getBoxByUId(boxId),box.nonDomBox=!1,PullerSubscriber.requestForIp(box.getKey()),box.loadHistoryMessages()),box.lastCommunicationTime=Math.floor(Date.now()/1e3),chatHistoryFactory.updateBox(box);for(var k=0;k<deleteObject.noOfMessages;k++){var msgKey=deleteObject.packetData[k].packetId,msgObj=box.getMessage(msgKey);msgObj&&(ownMessage?box.removeMessage(msgKey):(msgObj.text="This message has been deleted",msgObj.setTextPartition(),msgObj.status="Deleted"),chatHistoryFactory.updateMessage(msgObj,box.getKey()),box.sendTabUpdate(msgObj))}if(sendConfirmation){var deleteConfirmObject={sessionId:utilsFactory.getToken,ip:box.getIp(),port:box.getPort(),packetId:deleteObject.packetId,packetType:20,userId:deleteObject.friendId,friendId:deleteObject.userId},constructDeleteConfirmPacket=PacketDataParse.constructPacket(deleteConfirmObject,20,CHAT_PACKET_FORMAT.DELETE_CONFIRM_PKT.FORMAT);globalSocketFactory.send(constructDeleteConfirmPacket)}break;case 20:var deleteConfirmObject=PacketDataParse.parsePacket(byteData,20,CHAT_PACKET_FORMAT.DELETE_CONFIRM_PKT.FORMAT),box=ChatFactory.getBoxByUId(deleteConfirmObject.userId);box||(ChatFactory.creatNonDomBox(deleteConfirmObject.userId,!1),box=ChatFactory.getBoxByUId(deleteConfirmObject.userId),box.nonDomBox=!1,PullerSubscriber.requestForIp(box.getKey()),box.loadHistoryMessages()),box.lastCommunicationTime=Math.floor(Date.now()/1e3),chatHistoryFactory.updateBox(box);break;case 94:var offlineConfirmationObject=PacketDataParse.parsePacket(byteData,94,CHAT_PACKET_FORMAT.OFFLINE_CONFIRM_PKT.FORMAT);CHAT_GLOBAL_VALUES.serverTimeDiff=offlineConfirmationObject.messageDate-Date.now(),scope.offlineConfirmReceived=!0,RingLogger.print(offlineConfirmationObject,RingLogger.tags.CHAT),RingLogger.print("Offline: offline confirmation received",RingLogger.tags.CHAT);break;case 95:break;var box,msgObj,k}}),scope.$digest()};scope.$on("chatDataReceived",chatDataReceivedCallback)}}}var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){}chatApp.directive("chatSubscriber",chatSubscriber),chatSubscriber.$inject=["SystemEvents","fileUploadService","PullerSubscriber","ChatFactory","profileFactory","PacketDataParse","userFactory","utilsFactory","$interval","$timeout","globalSocketFactory","Storage","CHAT_PACKET_FORMAT","Auth","chatHistoryFactory","TAG_CHAT_PACKET_TYPE","TAG_CHAT_GENERAL_CONSTANTS","tagChatFactory","tagChatApiService","tagChatManager","tagChatHelper","CHAT_GLOBAL_VALUES","tagChatPacketProcessor","ChatHelper","ChatPacketSenderService"]}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){chatApp=angular.module("ringid.chat",["ringid.config","ringid.common.stacked_map","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}chatApp.directive("setTimeout",["ChatFactory","$compile","$document",function(ChatFactory,$compile,$document){return{restrict:"EA",template:'<a><span class="icon-timer-s"></span></a>',link:function(scope,element,attrs){var timeoutBarCompiledDom,openTimeoutPopup=function(){scope.showTimeout=!0,scope.closeSettingPopup(),$document.bind("click",closeTimeoutPopup);var timeoutBarDom=angular.element("<set-timeout-bar ></set-timeout-bar>");timeoutBarCompiledDom=$compile(timeoutBarDom)(scope),element.parent().parent().parent().next().prepend(timeoutBarCompiledDom)},closeTimeoutPopup=function(){scope.showTimeout=!1,$document.unbind("click",closeTimeoutPopup),timeoutBarCompiledDom&&timeoutBarCompiledDom.remove()};scope.closeTimeoutPopup=function(){closeTimeoutPopup()},scope.showTimeout=!1,element.on("click",function(event){scope.showTimeout?closeTimeoutPopup():openTimeoutPopup(),event.stopPropagation()})}}}]).directive("setTimeoutBar",["ChatFactory","$compile",function(ChatFactory,$compile){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="enable-secret-chat">Enable Secret Chat:</span><div class="switchnew"><input class="float-left" ng-model="box.value.secretChat" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="correct-sec icon-close-b"></a>\n<a href="#" ng-click="showValueBox($event)" class="timeout-sec icon-time"><p>sec</p><span>{{ timeout>4 ? timeout : 5}}</span></a></div></div>',link:function(scope,element,attrs){var timeoutVaueCompiledDom;scope.timeout=scope.box.value.timeout,scope.showTimeoutBox=!1,scope.cancel=function($event){scope.closeTimeoutPopup(),$event&&($event.preventDefault(),$event.stopPropagation())},scope.showValueBox=function($event){if(scope.showTimeoutBox)scope.hideValueBox();else{scope.showTimeoutBox=!0;var timeoutValueDom=angular.element("<set-timeout-Value ></set-timeout-Value>");timeoutVaueCompiledDom=$compile(timeoutValueDom)(scope),element.children(0).append(timeoutVaueCompiledDom)}$event&&($event.preventDefault(),$event.stopPropagation())},scope.hideValueBox=function($event){scope.showTimeoutBox=!1,timeoutVaueCompiledDom&&timeoutVaueCompiledDom.remove(),$event&&($event.preventDefault(),$event.stopPropagation())},element.on("click",function(event){event.stopPropagation()})}}}]).directive("setTimeoutValue",["ChatFactory",function(ChatFactory){return{restrict:"EA",templateUrl:"pages/partials/chat-timeout-value-box.html",link:function(scope,element,attrs){scope.selectTimeout=function($event,time){scope.box.value.timeout=scope.timeout=time,scope.hideValueBox($event)}}}}])}(),function(){"use strict";var chatApp;try{chatApp=angular.module("ringid.chat")}catch(e){chatApp=angular.module("ringid.chat",["ringid.config","ringid.common.stacked_map","ngWebSocket","ringid.utils","ringid.common.chat_factory","ngStorage","ringid.common.rgemoticon_directive","ringid.puller","ringid.connector","ringid.common.rgupload_directive","ringid.tagchat"])}chatApp.directive("setting",["ChatFactory","$compile","$document",function(ChatFactory,$compile,$document){return{restrict:"EA",template:'<a><span class="icon-g-settings"></span></a>',link:function(scope,element,attrs){var settingBarCompiledDom,openSettingPopup=function(){scope.showSetting=!0,scope.closeTimeoutPopup(),$document.bind("click",closeSettingPopup);var settingBarDom=angular.element("<setting-bar ></setting-bar>");settingBarCompiledDom=$compile(settingBarDom)(scope),element.parent().parent().parent().next().prepend(settingBarCompiledDom)},closeSettingPopup=function(){scope.showSetting=!1,$document.unbind("click",closeSettingPopup),settingBarCompiledDom&&settingBarCompiledDom.remove()};scope.closeSettingPopup=function(){closeSettingPopup()},scope.showSetting=!1,element.on("click",function(event){scope.showSetting?closeSettingPopup():openSettingPopup(),event.stopPropagation()})}}}]).directive("settingBar",["ChatFactory","$compile",function(ChatFactory,$compile){return{restrict:"E",template:'<div class="timeout-area-with-popup"><div class="timeoutDivnew">\n<span class="secret-visible">Timer:</span><div class="switch-secret-visible"><input class="float-left" ng-model="box.value.isSecretVisible" type="checkbox"><label><i></i></label></div>\n<a href="#" ng-click="cancel($event)" ng-disabled="!box.value.secretChat" class="correct-sec icon-close-b"></a>\n</div></div>',link:function(scope,element,attrs){scope.cancel=function($event){scope.closeSettingPopup(),$event&&($event.preventDefault(),$event.stopPropagation())},element.on("click",function(event){event.stopPropagation()})}}}])}(),function(){"use strict";var app=angular.module("ringid.tagchat",["ringid"]);app.filter("prettyJSON",function(){function prettyPrintJson(json){return JSON?JSON.stringify(json,null,"  "):"your browser doesnt support JSON so cant pretty print"}return prettyPrintJson})}(),function(){"use strict";var itemKey,itemValue,itemPropKey,itemPropValue,tagChatApp=angular.module("ringid.tagchat"),TAG_CHAT_GENERAL_CONSTANTS={LOCAL_CHAT:!1,LOCAL_CHAT_REG_IP:"192.168.1.125",LOCAL_CHAT_REG_PORT:1500,LOCAL_CHAT_OFFLINE_IP:"192.168.1.125",LOCAL_CHAT_OFFLINE_PORT:1200,API_VERSION:3,API_VERSION_PORT_OFFSET:0,PACKET_IP_SIZE:4,PACKET_PORT_SIZE:2,PACKET_DYNAMIC_ATTRIBUTE:-1,PACKET_RAW_BYTE_ATTRIBUTE:-2,ONE_BYTE_SIZE:1,TWO_BYTE_SIZE:2,FOUR_BYTE_SIZE:4,EIGHT_BYTE_SIZE:8,TAG_ID_NO_OF_TIME_DIGIT:10,TAG_ID_NO_OF_USER_ID_DIGIT:6,PACKET_MAX_SIZE:512,AUTH_UID_LIST_LIMIT:15,ACTUAL_TAG_REGISTER_TIMEOUT:180,TAG_REGISTER_TIMEOUT:150,API_FETCH_RETRY_COUNT:5,API_FETCH_RETRY_DELAY:3e3,RETRY_COUNT:5,REQUEST_TIMEOUT:18e3,BOX_WAITING_TIME:180,UDP_SERVER_KEEP_ALIVE_INTERVAL:1e4,REQUEST_CACHE_VALIDITY:3e3,RESPONSE_CACHE_VALIDITY:3e3,ATTRIBUTE_TYPE:{INTEGER:1,STRING:2,BYTE:3},MEMBER_STATUS:{MEMBER:1,ADMIN:2,OWNER:3,REMOVED:4,LEAVE:5},MEMBER_MOODS:{ONLINE:1,AWAY:2,OFFLINE:3,DO_NOT_DISTURB:4},REGISTRATION_TYPES:{CREATE:1,ONLY_REGISTER:2,CHAT_INVITE:3},MESSAGE_STATUS:{UNREAD:-1,DELETED:0,SENT:1,DELIVERED:2,SEEN:3,VIEWED:4,PLAYED:4},MESSAGE_TYPES:{DELETE_MESSAGE:0,BLANK_MESSAGE:1,PLAIN_MESSAGE:2,EMOTICON_MESSAGE:3,LOCATION_MESSAGE:4,LINK_MESSAGE:5,DOWNLOAD_STICKER_MESSAGE:6,IMAGE_FILE_FROM_GALLERY:7,AUDIO_FILE:8,VIDEO_FILE:9,IMAGE_FILE_FROM_CAMERA:10,FILE_STREAM:11,HISTORY_RE_FETCH:14,GROUP_ACTIVITY:20},STATUS_MESSAGE_TYPES:{TAG_MEMBER_ADD:1,TAG_MEMBER_DELETE:2,TAG_MEMBER_LEAVE:3,TAG_MEMBER_STATUS_CHANGE_OWNER:4,TAG_MEMBER_STATUS_CHANGE_ADMIN:5,TAG_MEMBER_STATUS_CHANGE_MEMBER:6,TAG_NAME_CHANGE:7,TAG_PICTURE_CHANGE:8,TAG_INFO_UPDATED:9,TAG_ADMIN_ADD:10},PAGE_DIRECTION:{UP:1,DOWN:2},ONLINE_STATUS:{OFFLINE:1,ONLINE:2,AWAY:3},ONLINE_MOOD:{ALIVE:1,DONT_DISTURB:2,BUSY:3,INVISIBLE:4},SECRET_VISIBILITY:{NON_VISIBLE:0,VISIBLE:1},TAG_ACTIVITY_TYPE:{DELETED:0,ADDED:1,LEAVE:2,TAG_RENAME:3,MEMBER_TYPE_CHANGE:4,TAG_URL_RENAME:5,TAG_CREATED:6}};for(itemKey in TAG_CHAT_GENERAL_CONSTANTS)if(itemValue=TAG_CHAT_GENERAL_CONSTANTS[itemKey],angular.isObject(itemValue)){TAG_CHAT_GENERAL_CONSTANTS[itemKey+"_VALUE"]=[];for(itemPropKey in itemValue)itemPropValue=itemValue[itemPropKey],TAG_CHAT_GENERAL_CONSTANTS[itemKey+"_VALUE"][itemPropValue]=itemPropKey}var FRIEND_CHAT_PACKET_TYPE={FRIEND_CHAT_REGISTER:1,FRIEND_CHAT_UNREGISTER:2,FRIEND_CHAT_REGISTER_CONFIRMATION:3,FRIEND_CHAT_IDLE:4,FRIEND_CHAT_TYPING:5,FRIEND_CHAT_MSG:6,FRIEND_CHAT_MSG_EDIT:7,FRIEND_CHAT_BROKEN_MSG:8,FRIEND_CHAT_BROKEN_MSG_EDIT:9,FRIEND_CHAT_MULTIPLE_MSG:10,FRIEND_CHAT_DELIVERED:15,FRIEND_CHAT_SENT:16,FRIEND_CHAT_SEEN:17,FRIEND_CHAT_SEEN_CONFIRMATION:18,FRIEND_CHAT_MULTIPLE_MSG_DELETE:19,FRIEND_CHAT_MSG_DELETE_CONFIRMATION:20,FRIEND_BROKEN:24,FRIEND_BROKEN_CONFIRMATION:25,FRIEND_CHAT_BLOCK:27,FRIEND_CHAT_UNBLOCK:28,FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION:29},TAG_CHAT_PACKET_TYPE={TAG_CHAT_TAG_REGISTER:41,TAG_CHAT_TAG_UNREGISTER:42,TAG_CHAT_TAG_REGISTER_CONFIRMATION:43,TAG_CHAT_TAG_INFORMATION:46,TAG_CHAT_TAG_INFORMATION_CONFIRMATION:47,TAG_CHAT_TAG_MEMBER_ADD:51,TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION:52,TAG_CHAT_MEMBER_REMOVE_LEAVE:53,TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION:54,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE:55,TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION:56,TAG_CHAT_IDLE:61,TAG_CHAT_TYPING:62,TAG_CHAT_MSG:63,TAG_CHAT_MSG_EDIT:64,TAG_CHAT_BROKEN_MSG:65,TAG_CHAT_BROKEN_MSG_EDIT:66,TAG_CHAT_MULTIPLE_MSG:67,TAG_CHAT_DELIVERED:68,TAG_CHAT_SENT:69,TAG_CHAT_SEEN:70,TAG_CHAT_SEEN_CONFIRMATION:71,TAG_CHAT_MULTIPLE_MSG_DELETE:72,TAG_CHAT_MSG_DELETE_CONFIRMATION:73,TAG_CHAT_GENERAL_BROKEN_PACKET:74,TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION:75},OFFLINE_PACKET_TYPE={OFFLINE_FRIEND_INFORMATION:91,OFFLINE_FRIEND_INFORMATION_CONFIRMATION:92,OFFLINE_GET_REQUEST:93,OFFLINE_GET_REQUEST_CONFIRMATION:94,OFFLINE_FRIEND_UNREAD_MESSAGE:95,OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:96,OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST:97,OFFLINE_FRIEND_HISTORY_MESSAGE:98,OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION:99,OFFLINE_GET_FRIEND_MESSAGE_STATUS:100,OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION:101,OFFLINE_TAG_INFORMATION_ACTIVITY:104,OFFLINE_MY_TAG_LIST:105,OFFLINE_TAG_UNREAD_MESSAGE:106,OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:107,OFFLINE_TAG_CREATE_TAG:108,OFFLINE_TAG_CREATE_TAG_CONFIRMATION:109,OFFLINE_TAG_HISTORY_MESSAGE_REQUEST:110,OFFLINE_TAG_HISTORY_MESSAGE:111,OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS:112,OFFLINE_TAG_INFORMATION_WITH_MEMBERS:113,OFFLINE_TAG_CONFIRMATION:117,OFFLINE_BROKEN_HISTORY_PACKET:118,OFFLINE_BROKEN_PACKET:119,OFFLINE_BROKEN_PACKET_CONFIRMATION:120},TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP={};TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MULTIPLE_MSG_DELETE]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_DELETE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG]=[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT,TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED,TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_EDIT]=[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT,TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED,TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG]=[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT,TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED,TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT]=[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT,TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED,TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED]=[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN,TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN_CONFIRMATION],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN]=TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG]=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST]=OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE]=OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET]=OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_HISTORY_PACKET]=OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_REGISTER]=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_REGISTER_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG]=[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG_EDIT]=[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG]=[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG_EDIT]=[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED]=[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN_CONFIRMATION],TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN]=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[FRIEND_CHAT_PACKET_TYPE.FRIEND_BROKEN]=FRIEND_CHAT_PACKET_TYPE.FRIEND_BROKEN_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_INFORMATION]=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_INFORMATION_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE]=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE]=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[OFFLINE_PACKET_TYPE.OFFLINE_GET_FRIEND_MESSAGE_STATUS]=OFFLINE_PACKET_TYPE.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION;var TAG_CHAT_PACKET_ATTRIBUTE={PACKET_TYPE:1,USER_ID:2,FRIEND_ID:3,PACKET_ID_LENGTH:4,PACKET_ID:5,PLATFORM:6,CHAT_BINDING_PORT:7,TAG_ID:8,ONLINE_STATUS:9,USER_MOOD:10,MESSAGE_TYPE:11,TIMEOUT:12,LATITUDE:13,LONGITUDE:14,MESSAGE_LENGTH:15,MESSAGE:16,MESSAGE_DATE:17,NO_OF_MESSAGE:18,FULL_NAME_LENGTH:19,FULL_NAME:20,NO_OF_PACKET:21,SEQUENCE_NO:22,NO_OF_MEMBERS:23,UPDATE_TIME:24,SERVER_DATE:25,LAST_ONLINE_TIME:26,NO_OF_ITEMS:27,BLOCK_UNBLOCK_DATE:28,MESSAGE_STATUS:29,IS_ADD_TO_DB:30,TAG_NAME_LENGTH:31,TAG_NAME:32,TAG_PICTURE_URL_LENGTH:33,TAG_PICTURE_URL:34,TAG_MEMBER_TYPE:35,TAG_MEMBER_ADDED_BY:36,TAG_NO_OF_MEMBERS:37,TAG_NO_OF_BROKEN_PKT:38,TAG_INFORMATION_UPDATE_FLAG:39,TAG_INFORMATION_TAG_NO_OF_MEMBERS:40,REGISTRATION_TYPE:41,PAGE_DIRECTION:42,PAGE_LIMIT:43,ACTIVITY_TYPE:45,ACTIVITY_VALUE_LENGTH:46,ACTIVITY_VALUE:47,CHANGED_BY_USER_ID:48,FRIEND_APP_TYPE:60,FRIEND_DEVICE_TOKEN_LENGTH:61,FRIEND_DEVICE_TOKEN:62,IS_SECRET_VISIBLE:63,APP_VERSION:64,RAW_DATA_BYTE:80},TAG_CHAT_PACKET_ATTRIBUTE_INFO={};TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE]={NAME:"PACKET_TYPE",VAR_NAME:"packetType",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.USER_ID]={NAME:"USER_ID",VAR_NAME:"userId",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID]={NAME:"FRIEND_ID",
VAR_NAME:"friendId",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH]={NAME:"PACKET_ID_LENGTH",VAR_NAME:"packetIdLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]={NAME:"PACKET_ID",VAR_NAME:"packetId",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]={NAME:"PLATFORM",VAR_NAME:"platform",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.CHAT_BINDING_PORT]={NAME:"CHAT_BINDING_PORT",VAR_NAME:"chatBindingPort",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:4},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID]={NAME:"TAG_ID",VAR_NAME:"tagId",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.ONLINE_STATUS]={NAME:"ONLINE_STATUS",VAR_NAME:"onlineStatus",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.USER_MOOD]={NAME:"USER_MOOD",VAR_NAME:"userMood",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE]={NAME:"MESSAGE_TYPE",VAR_NAME:"messageType",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT]={NAME:"TIMEOUT",VAR_NAME:"timeout",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.LATITUDE]={NAME:"LATITUDE",VAR_NAME:"latitude",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:4},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.LONGITUDE]={NAME:"LONGITUDE",VAR_NAME:"longitude",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:4},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH]={NAME:"MESSAGE_LENGTH",VAR_NAME:"messageLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE]={NAME:"MESSAGE",VAR_NAME:"message",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]={NAME:"MESSAGE_DATE",VAR_NAME:"messageDate",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE]={NAME:"NO_OF_MESSAGE",VAR_NAME:"messagesLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"messages",SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH]={NAME:"FULL_NAME_LENGTH",VAR_NAME:"fullNameLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME]={NAME:"FULL_NAME",VAR_NAME:"fullName",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET]={NAME:"NO_OF_PACKET",VAR_NAME:"packetsLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"packets",SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO]={NAME:"SEQUENCE_NO",VAR_NAME:"sequenceNo",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MEMBERS]={NAME:"NO_OF_MEMBERS",VAR_NAME:"membersLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"members",SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.UPDATE_TIME]={NAME:"UPDATE_TIME",VAR_NAME:"updateTime",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.SERVER_DATE]={NAME:"SERVER_DATE",VAR_NAME:"serverDate",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.LAST_ONLINE_TIME]={NAME:"LAST_ONLINE_TIME",VAR_NAME:"lastOnlineTime",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_ITEMS]={NAME:"NO_OF_ITEMS",VAR_NAME:"noOfItems",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"items",SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.BLOCK_UNBLOCK_DATE]={NAME:"BLOCK_UNBLOCK_DATE",VAR_NAME:"blockUnblockDate",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_STATUS]={NAME:"MESSAGE_STATUS",VAR_NAME:"status",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.IS_ADD_TO_DB]={NAME:"IS_ADD_TO_DB",VAR_NAME:"isAddToDb",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH]={NAME:"TAG_NAME_LENGTH",VAR_NAME:"tagNameLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME]={NAME:"TAG_NAME",VAR_NAME:"tagName",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH]={NAME:"TAG_PICTURE_URL_LENGTH",VAR_NAME:"tagPictureUrlLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL]={NAME:"TAG_PICTURE_URL",VAR_NAME:"tagPictureUrl",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE]={NAME:"TAG_MEMBER_TYPE",VAR_NAME:"status",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_ADDED_BY]={NAME:"TAG_MEMBER_ADDED_BY",VAR_NAME:"addedBy",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS]={NAME:"TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"tagMembers",SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_BROKEN_PKT]={NAME:"TAG_NO_OF_BROKEN_PKT",VAR_NAME:"brokenPacketsLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,VAR_CONTAINER_NAME:"brokenPackets",SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_INFORMATION_UPDATE_FLAG]={NAME:"TAG_INFORMATION_UPDATE_FLAG",VAR_NAME:"updateFlag",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.TAG_INFORMATION_TAG_NO_OF_MEMBERS]={NAME:"TAG_INFORMATION_TAG_NO_OF_MEMBERS",VAR_NAME:"tagMembersCount",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.REGISTRATION_TYPE]={NAME:"REGISTRATION_TYPE",VAR_NAME:"registrationType",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.PAGE_DIRECTION]={NAME:"PAGE_DIRECTION",VAR_NAME:"pageDirection",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.PAGE_LIMIT]={NAME:"PAGE_LIMIT",VAR_NAME:"pageLimit",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_TYPE]={NAME:"ACTIVITY_TYPE",VAR_NAME:"activityType",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,CONDITIONAL:!0,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_VALUE_LENGTH]={NAME:"ACTIVITY_VALUE_LENGTH",VAR_NAME:"activityValueLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_VALUE]={NAME:"ACTIVITY_VALUE",VAR_NAME:"activityValue",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.CHANGED_BY_USER_ID]={NAME:"CHANGED_BY_USER_ID",VAR_NAME:"changedByUserId",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:8},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_APP_TYPE]={NAME:"FRIEND_APP_TYPE",VAR_NAME:"friendAppType",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_DEVICE_TOKEN_LENGTH]={NAME:"FRIEND_DEVICE_TOKEN_LENGTH",VAR_NAME:"friendDeviceTokenLength",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_DEVICE_TOKEN]={NAME:"FRIEND_DEVICE_TOKEN",VAR_NAME:"friendDeviceToken",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING,SIZE:-1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE]={NAME:"IS_SECRET_VISIBLE",VAR_NAME:"isSecretVisible",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:1},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.APP_VERSION]={NAME:"APP_VERSION",VAR_NAME:"appVersion",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER,SIZE:2},TAG_CHAT_PACKET_ATTRIBUTE_INFO[TAG_CHAT_PACKET_ATTRIBUTE.RAW_DATA_BYTE]={NAME:"RAW_DATA_BYTE",VAR_NAME:"bytes",VAR_TYPE:TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.BYTE,SIZE:-2};var TAG_CHAT_PACKET_INFO={};TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_REGISTER]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_REGISTER_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.CHAT_BINDING_PORT,TAG_CHAT_PACKET_ATTRIBUTE.SERVER_DATE]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG_EDIT]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG_EDIT]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MULTIPLE_MSG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE]]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_STATUS],TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_BROKEN]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.RAW_DATA_BYTE]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_BROKEN_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BLOCK]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.BLOCK_UNBLOCK_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_ADD_TO_DB]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_UNBLOCK]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.BLOCK_UNBLOCK_DATE]},TAG_CHAT_PACKET_INFO[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BLOCK_UNBLOCK_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_UNREGISTER]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.ONLINE_STATUS,TAG_CHAT_PACKET_ATTRIBUTE.USER_MOOD]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.CHAT_BINDING_PORT,TAG_CHAT_PACKET_ATTRIBUTE.SERVER_DATE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS,[TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE]]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS,[TAG_CHAT_PACKET_ATTRIBUTE.USER_ID]]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS,[TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE]]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_IDLE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TYPING]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_EDIT]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MULTIPLE_MSG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MULTIPLE_MSG_DELETE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_DELETE_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.RAW_DATA_BYTE]},TAG_CHAT_PACKET_INFO[TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_INFORMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM,TAG_CHAT_PACKET_ATTRIBUTE.ONLINE_STATUS,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_APP_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_DEVICE_TOKEN_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_DEVICE_TOKEN,TAG_CHAT_PACKET_ATTRIBUTE.USER_MOOD]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_INFORMATION_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.UPDATE_TIME,TAG_CHAT_PACKET_ATTRIBUTE.BLOCK_UNBLOCK_DATE,TAG_CHAT_PACKET_ATTRIBUTE.APP_VERSION,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.SERVER_DATE]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PAGE_DIRECTION,TAG_CHAT_PACKET_ATTRIBUTE.PAGE_LIMIT,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TIMEOUT,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE,TAG_CHAT_PACKET_ATTRIBUTE.IS_SECRET_VISIBLE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_STATUS],TAG_CHAT_PACKET_ATTRIBUTE.PAGE_DIRECTION]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_GET_FRIEND_MESSAGE_STATUS]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID],TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_GET_FRIEND_MESSAGE_STATUS_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.FRIEND_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_INFORMATION_ACTIVITY]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_ITEMS,[TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_VALUE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.ACTIVITY_VALUE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.CHANGED_BY_USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.UPDATE_TIME]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_MY_TAG_LIST]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_ITEMS,[TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_ADDED_BY,TAG_CHAT_PACKET_ATTRIBUTE.TAG_INFORMATION_TAG_NO_OF_MEMBERS]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS,[TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE],TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]
},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PAGE_DIRECTION,TAG_CHAT_PACKET_ATTRIBUTE.PAGE_LIMIT,TAG_CHAT_PACKET_ATTRIBUTE.APP_VERSION,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_MESSAGE,[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE,TAG_CHAT_PACKET_ATTRIBUTE.MESSAGE_DATE],TAG_CHAT_PACKET_ATTRIBUTE.PAGE_DIRECTION]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.TAG_PICTURE_URL,TAG_CHAT_PACKET_ATTRIBUTE.TAG_NO_OF_MEMBERS,[TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.FULL_NAME,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_MEMBER_ADDED_BY]]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.TAG_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_HISTORY_PACKET]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.RAW_DATA_BYTE]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.NO_OF_PACKET,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO,TAG_CHAT_PACKET_ATTRIBUTE.RAW_DATA_BYTE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PLATFORM]},TAG_CHAT_PACKET_INFO[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET_CONFIRMATION]={FORMAT:[TAG_CHAT_PACKET_ATTRIBUTE.PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE.USER_ID,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID_LENGTH,TAG_CHAT_PACKET_ATTRIBUTE.PACKET_ID,TAG_CHAT_PACKET_ATTRIBUTE.SEQUENCE_NO]};for(var ALL_PACKET_TYPES=angular.extend({},TAG_CHAT_PACKET_TYPE,FRIEND_CHAT_PACKET_TYPE,OFFLINE_PACKET_TYPE),ALL_PACKET_TYPES_KEYS=Object.keys(ALL_PACKET_TYPES),index=0,length=ALL_PACKET_TYPES_KEYS.length;length>index;index++)try{TAG_CHAT_PACKET_INFO[ALL_PACKET_TYPES[ALL_PACKET_TYPES_KEYS[index]]].PACKET_NAME=ALL_PACKET_TYPES_KEYS[index]}catch(e){TAG_CHAT_PACKET_INFO[ALL_PACKET_TYPES[ALL_PACKET_TYPES_KEYS[index]]]={PACKET_NAME:ALL_PACKET_TYPES_KEYS[index]}}tagChatApp.constant("TAG_CHAT_PACKET_TYPE",TAG_CHAT_PACKET_TYPE),tagChatApp.constant("FRIEND_CHAT_PACKET_TYPE",FRIEND_CHAT_PACKET_TYPE),tagChatApp.constant("OFFLINE_PACKET_TYPE",OFFLINE_PACKET_TYPE),tagChatApp.constant("FRIEND_CHAT_PACKET_TYPE",FRIEND_CHAT_PACKET_TYPE),tagChatApp.constant("TAG_CHAT_PACKET_ATTRIBUTE",TAG_CHAT_PACKET_ATTRIBUTE),tagChatApp.constant("TAG_CHAT_PACKET_ATTRIBUTE_INFO",TAG_CHAT_PACKET_ATTRIBUTE_INFO),tagChatApp.constant("TAG_CHAT_PACKET_INFO",TAG_CHAT_PACKET_INFO),tagChatApp.constant("TAG_CHAT_GENERAL_CONSTANTS",TAG_CHAT_GENERAL_CONSTANTS),tagChatApp.constant("TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP",TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP)}(),function(){"use strict";var tagChatApp=angular.module("ringid.tagchat"),TAG_CHAT_LANG={STATUS_MESSAGES:{SELF_ADD_MEMBER:"You added {new_member_name} as Group {new_member_type}.",SELF_ADD_MULTIPLE_MEMBER:"You added {new_member_name} and {rest_count} as Group {new_member_type}.",SELF_REMOVE_MEMBER:"You removed {old_member_name} from the group.",SELF_REMOVE_MULTIPLE_MEMBER:"You removed {old_member_name} and {rest_count} from the group.",OTHER_ADD_MEMBER:"{member_name} added {new_member_name} as Group {new_member_type}.",OTHER_ADD_MULTIPLE_MEMBER:"{member_name} added {new_member_name} and {rest_count} as Group {new_member_type}.",OTHER_REMOVE_MEMBER:"{member_name} removed {old_member_name} from the group.",OTHER_REMOVE_MULTIPLE_MEMBER:"{member_name} removed {old_member_name} and {rest_count} from the group.",SELF_LEAVE_GROUP:"You left this conversation.",OTHER_LEAVE_GROUP:"{member_name} left this conservation.",SELF_RENAME_GROUP:"You named the group {group_name}.",OTHER_RENAME_GROUP:"{member_name} named the group {group_name}.",SELF_CHANGE_GROUP_PIC:"You changed the group photo.",OTHER_CHANGE_GROUP_PIC:"{member_name} changed the group photo.",SELF_UPDATE_GROUP_INFO:"You named the group {group_name} and changed the group photo.",OTHER_UPDATE_GROUP_INFO:"{member_name} named the group {group_name} and changed the group photo.",SELF_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} Group Admin.",OTHER_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} as Admin.",SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"You made {old_member_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:"{member_name} made {old_member_name} and {rest_count} as Group admin.",SELF_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} from Admin.",OTHER_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} from Group Admin.",SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"You removed {old_admin_name} and {rest_count} as Group admin.",OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:"{admin_name} removed {old_admin_name} and {rest_count} from Group Admin.",SELF_REMOVED_FROM_ADMIN_BY_SELF:"You removed yourself from Admin",OTHER_REMOVED_FROM_ADMIN_BY_SELF:"{admin_name} removed himself/herself from Admin",SELF_USER_ADDED_AS_OWNER:"{member_name} made you owner.",OTHER_USER_ADDED_AS_OWNER:"{member_name} made {admin_name} Owner. ",SELF_NOT_GROUP_MEMBER:"You are no longer member of this group"},DEFAULT_FAILURE_MESSAGE:"Request has not been processed successfully. Please try again",DEFAULT_SUCCESS_MESSAGE:"Request has been processed successfully."};tagChatApp.constant("TAG_CHAT_LANG",TAG_CHAT_LANG)}(),function(){"use strict";function tagChatApiService($$connector,$q,OPERATION_TYPES,AUTH_SERVER_ACTIONS,TAG_CHAT_PACKET_TYPE,PLATFORM,globalSocketFactory,utilsFactory,tagChatPacketProcessor,tagChatFactory,TAG_CHAT_GENERAL_CONSTANTS,OFFLINE_PACKET_TYPE,FRIEND_CHAT_PACKET_TYPE,Auth,tagChatExceptions,settings,CHAT_GENERAL_CONSTANTS,chatTabSync){function _sendMultipleViaGlobalChatSocket(requestObject,packetType){var packetSize=tagChatPacketProcessor.getPacketSizeByObject(requestObject,packetType);if(!(packetSize>TAG_CHAT_GENERAL_CONSTANTS.PACKET_MAX_SIZE))return _sendViaGlobalChatSocket(requestObject,packetType);var requestSplittedObjects=tagChatPacketProcessor.splitAndGetMultipleObjects(requestObject,packetType);if(requestSplittedObjects){var packetId=requestSplittedObjects[0].packetId;_sendViaGlobalChatSocket(requestSplittedObjects[0],packetType);for(var index=1;index<requestSplittedObjects.length;index++)requestSplittedObjects[index].packetId=packetId+"_"+index,_sendViaGlobalChatSocket(requestSplittedObjects[index],packetType)}}function _getPacket(requestObject,packetType){var requestObjectPacket=tagChatPacketProcessor.constructPacket(requestObject,packetType);return requestObjectPacket}function _getBrokenPacketObjects(brokenPacketType,packet,requestObject){var packetType,packets,aBrokenPacket,packetsLength,brokenContainer,brokenPacketSplitter,isMultipleBroken,brokenPackets=[];requestObject||(requestObject=tagChatPacketProcessor.parseRawPacket(packet)),packetType=requestObject.packetType,packet||(packet=_getPacket(requestObject,packetType)),packet=packet.copy(6,packet.byteLength-6),brokenContainer=tagChatPacketProcessor.getBrokenContainerByPacketType(brokenPacketType),brokenPacketSplitter=tagChatPacketProcessor.getBrokenPacketSplitter(brokenPacketType,packetType,requestObject,packet),isMultipleBroken=tagChatPacketProcessor.isMultipleBrokenPacket(packetType),packets=brokenPacketSplitter(),packetsLength=packets.length;for(var index=0;packetsLength>index;index++)aBrokenPacket=angular.copy(requestObject),aBrokenPacket.platform=PLATFORM.WEB,aBrokenPacket.packetsLength=packetsLength,aBrokenPacket[brokenContainer]=packets[index][brokenContainer],aBrokenPacket.packetType=brokenPacketType,isMultipleBroken?aBrokenPacket.packetId=aBrokenPacket.packetId+"_"+index:aBrokenPacket.sequenceNo=index,brokenPackets.push(aBrokenPacket);return brokenPackets}function _sendViaGlobalChatSocket(requestObject,packetType){var requestObjectPacket=_getPacket(requestObject,packetType);return requestObjectPacket&&globalSocketFactory.send(requestObjectPacket),_logRequestedPacketInfo(packetType,requestObject),requestObjectPacket}function sendPacketViaGlobalChatSocket(packet){packet&&globalSocketFactory.send(packet)}function _noIpPortException(aTagObject,name){RingLogger.warning("Called From : ",name,"TagID, No Ip/Register Port/Binding Port",aTagObject.getChatIp(),aTagObject.getChatRegisterPort(),aTagObject.getChatBindingPort(),RingLogger.tags.TAG_CHAT),utilsFactory.triggerCustomEvent("tagChatNoIpOrPort",{tagId:aTagObject.getTagId()})}function _getOfflineIpPort(){var ip,port,loginData=Auth.loginData;return TAG_CHAT_GENERAL_CONSTANTS.LOCAL_CHAT?(ip=TAG_CHAT_GENERAL_CONSTANTS.LOCAL_CHAT_OFFLINE_IP,port=TAG_CHAT_GENERAL_CONSTANTS.LOCAL_CHAT_OFFLINE_PORT):(ip=loginData.oIP,port=loginData.oPrt+TAG_CHAT_GENERAL_CONSTANTS.API_VERSION_PORT_OFFSET),{ip:ip,port:port}}function _logRequestedPacketInfo(packetType,packetObject){var packetName=tagChatPacketProcessor.getPacketName(packetType);RingLogger.infoblack(packetName,packetObject,RingLogger.tags.TAG_CHAT_REQUEST)}var ChatPacketException=tagChatExceptions.ChatPacketException,self=this;self.createOrGetTagFromAuth=function(aTagObject,newMemberUIds,packetId){var returnPromise,requestObject={actn:AUTH_SERVER_ACTIONS.START_TAG_CHAT,tid:aTagObject.getTagId(),uIds:newMemberUIds,pckId:packetId};return tagChatFactory.shouldProcessRequest(requestObject)||(RingLogger.infoblack("Skipping Getting Ip/Register Port from Auth",requestObject,RingLogger.tags.TAG_CHAT),returnPromise={sucs:!1}),RingLogger.infoblack("START_TAG_CHAT",requestObject,RingLogger.tags.TAG_CHAT_REQUEST),tagChatFactory.setInTagChatRequestCache(tagChatFactory.getAuthRequestKey(requestObject.tid,requestObject.actn),requestObject),returnPromise=$$connector.request(requestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.CHAT),$q.when(returnPromise)},self.addTagMembersInAuth=function(aTagObject,newMemberUIds){var returnPromise,requestObject={actn:AUTH_SERVER_ACTIONS.ADD_TAG_CHAT_MEMBERS,tid:aTagObject.getTagId(),chRp:aTagObject.getChatRegisterPort(),chIp:aTagObject.getChatIp(),uIds:newMemberUIds};return tagChatFactory.shouldProcessRequest(requestObject)||(RingLogger.warning("Skipping Add Tag Members in Auth Request",requestObject,RingLogger.tags.TAG_CHAT),returnPromise={sucs:!1}),RingLogger.infoblack("ADD_TAG_CHAT_MEMBERS",requestObject,RingLogger.tags.TAG_CHAT_REQUEST),returnPromise=$$connector.request(requestObject,OPERATION_TYPES.SYSTEM.REQUEST_TYPE.CHAT),$q.when(returnPromise)},self.sendFriendChatDeliveryPacket=function(box,userId,friendId,packetId){var offlineIpPort=_getOfflineIpPort(),ip=!!box&&box.getIp()||offlineIpPort.ip,port=!!box&&box.getPort()||offlineIpPort.port;if(!ip||!port)return void RingLogger.infoblack("Sending Friend Delivery Ip/Port Exception ",box,RingLogger.tags.TAG_CHAT);var packetType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED,requestObject={ip:ip,port:port,packetId:packetId,packetType:packetType,userId:userId,friendId:friendId};return _sendViaGlobalChatSocket(requestObject,packetType)},self.registerTagInChatServer=function(userId,aTagObject,packetId,regType){if(!aTagObject.getChatIp()||!aTagObject.getChatRegisterPort())return void _noIpPortException(aTagObject," Tag Register Packet ");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatRegisterPort(),packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId(),platform:PLATFORM.WEB};return tagChatFactory.setInTagChatRequestCache(aTagObject.getTagId(),requestObject),_sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagInformationToChatServer=function(userId,aTagObject,activityType,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatRegisterPort())return void _noIpPortException(aTagObject," Sending Tag Information Packet ");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,activityType:activityType,userId:userId,tagId:aTagObject.getTagId(),tagName:aTagObject.getTagName().utf8Encode(),tagPictureUrl:aTagObject.getPictureUrl()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.getTagInformationWithMemberFromChatServer=function(userId,aTagObject,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Get Tag Info Packet ");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_GET_TAG_INFORMATION_WITH_MEMBERS,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.addTagMemberInChatServer=function(userId,aTagObject,tagMemberSerializedObjects,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatRegisterPort())return void _noIpPortException(aTagObject,"add Tag Member Packet ");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,tagMembers:tagMemberSerializedObjects,userId:userId,tagId:aTagObject.getTagId()};return _sendMultipleViaGlobalChatSocket(requestObject,packetType)},self.removeTagMembersFromChatServer=function(userId,aTagObject,tagMemberSerializedObjects,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Remove Tag Member Packet ");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,tagMembers:tagMemberSerializedObjects,userId:userId,tagId:aTagObject.getTagId()};return tagChatFactory.setInTagChatRequestCache(requestObject.packetId,requestObject),_sendMultipleViaGlobalChatSocket(requestObject,packetType)},self.changeTagMemberStatusInChatServer=function(userId,aTagObject,tagMemberSerializedObjects,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Change Tag Member Status Packet ");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,tagMembers:tagMemberSerializedObjects,userId:userId,tagId:aTagObject.getTagId()};return _sendMultipleViaGlobalChatSocket(requestObject,packetType)},self.sendTagIdlePacket=function(userId,aTagObject){if(aTagObject.getChatIp()&&aTagObject.getChatBindingPort()){var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_IDLE,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetType:packetType,tagId:aTagObject.getTagId(),userId:userId,platform:PLATFORM.WEB};return _sendViaGlobalChatSocket(requestObject,packetType)}},self.sendTagMsgTypingPacket=function(userId,aTagObject){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Msg Typing Packet");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TYPING,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetType:packetType,tagId:aTagObject.getTagId(),userId:userId,platform:PLATFORM.WEB};return _sendViaGlobalChatSocket(requestObject,packetType)},self.getSendTagMsgRequestObject=function(userId,aTagObject,aTagMessageObject,isOffline,isEdit){var ip,port;if(isOffline){var offlineIpPort=_getOfflineIpPort();ip=offlineIpPort.ip,port=offlineIpPort.port}else ip=aTagObject.getChatIp(),port=aTagObject.getChatBindingPort();if(!ip||!port)throw isOffline?ChatPacketException("Offline ip/port not set for tagId ",aTagObject.getTagId()):ChatPacketException("Ip/port is not set for tag msg send for tagId ",aTagObject.getTagId());var packetType=isEdit?TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_EDIT:TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:aTagMessageObject.getPacketId(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId(),messageType:aTagMessageObject.getMessageType(),messageDate:aTagMessageObject.getMessageDate(),message:aTagMessageObject.getMessageText()};return requestObject},self.sendTagMsgInChatServer=function(userId,aTagObject,aTagMessageObject,isOffline){var requestObject=self.getSendTagMsgRequestObject(userId,aTagObject,aTagMessageObject,isOffline);return _sendViaGlobalChatSocket(requestObject,requestObject.packetType)},self.editTagMsgInChatServer=function(userId,aTagObject,aTagMessageObject,isOffline){var requestObject=self.getSendTagMsgRequestObject(userId,aTagObject,aTagMessageObject,isOffline,!0);return _sendViaGlobalChatSocket(requestObject,requestObject.packetType)},self.sendTagBrokenMsgInChatServer=function(userId,aTagObject,aTagMessageObject){},self.sendTagBrokenMsgEditInChatServer=function(userId,aTagObject,aTagMessageObject){},self.sendTagMultipleMsgInChatServer=function(userId,aTagObject,aTagMessageObject){},self.sendTagMsgDeliveredPacket=function(userId,aTagObject,aTagMessageObject){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Msg Delivered Packet");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetType:packetType,userId:userId,friendId:aTagMessageObject.getUserId(),packetId:aTagMessageObject.getPacketId(),tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagMsgSentPacket=function(aTagObject){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Msg Sent Packet");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:aTagObject.getPacketId(),packetType:packetType,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagMsgSeenPacket=function(userId,aTagObject,friendId,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Msg Seen Packet");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,packetType:packetType,userId:userId,friendId:friendId,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.deleteTagMultipleMsgInChatServer=function(userId,aTagObject,packetId,messagePacketIds){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"delete Tag Msg Packet");for(var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MULTIPLE_MSG_DELETE,packetsIds=[],index=0;index<messagePacketIds.length;index++)packetsIds.push({packetId:messagePacketIds[index]});var requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId(),packetId:packetId,packets:packetsIds};return tagChatFactory.setInTagChatRequestCache(requestObject.packetId,requestObject),_sendViaGlobalChatSocket(requestObject,packetType)},self.sendOfflineGetRequest=function(userId,updateTime,packetId){var offlineIpPort=_getOfflineIpPort();if(offlineIpPort.ip&&offlineIpPort.port){var packetType=OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetType:packetType,userId:userId,packetId:packetId||tagChatFactory.getUUIDPacketId(),updateTime:updateTime||0,blockUnblockDate:0,appVersion:settings.apiVersion,platform:PLATFORM.WEB};return _sendViaGlobalChatSocket(requestObject,packetType)}},self.getFriendUnreadMessageConfirmationObject=function(userId,packetId,messagePacketIds){for(var offlineIpPort=_getOfflineIpPort(),ip=offlineIpPort.ip,port=offlineIpPort.port,packetType=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION,packetsIds=[],index=0;index<messagePacketIds.length;index++)packetsIds.push({packetId:messagePacketIds[index]});var requestObject={ip:ip,port:port,packetId:packetId,userId:userId,packets:packetsIds,packetType:packetType};return requestObject},self.sendFriendUnreadMessageConfirmation=function(userId,friendId,packetId){var requestObject=self.getFriendUnreadMessageConfirmationObject(userId,friendId,packetId);return _sendViaGlobalChatSocket(requestObject,requestObject.packetType)},self.getFriendHistoryMessageGetRequestObject=function(userId,friendId,pageDirection,packetId,pageLimit){var offlineIpPort=_getOfflineIpPort();if(offlineIpPort.ip&&offlineIpPort.port){var packetType=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetType:packetType,userId:userId,friendId:friendId,packetId:packetId||tagChatFactory.getUUIDPacketId(),pageLimit:pageLimit||10,pageDirection:pageDirection,appVersion:settings.apiVersion,platform:PLATFORM.WEB};return requestObject}},self.sendHistoryMessageGetRequest=function(userId,friendId,pageDirection,packetId,pageLimit){var requestObject=self.getFriendHistoryMessageGetRequestObject(userId,friendId,pageDirection,packetId,pageLimit),packetType=requestObject.packetType;return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendFriendHistoryMessageOfflineConfirmation=function(userId,friendId,packetId){var offlineIpPort=_getOfflineIpPort(),ip=offlineIpPort.ip,port=offlineIpPort.port,packetType=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION,requestObject={ip:ip,port:port,packetId:packetId,packetType:packetType,friendId:friendId};return _sendViaGlobalChatSocket(requestObject,packetType)},self.createTagInOfflineServer=function(userId,aTagObject,packetId){var offlineIpPort=_getOfflineIpPort();if(offlineIpPort.ip&&offlineIpPort.port){var packetType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId(),tagName:aTagObject.getTagName().utf8Encode(),tagPictureUrl:aTagObject.getPictureUrl(),tagMembers:aTagObject.getSerializedMembers(),platform:PLATFORM.WEB};return _sendViaGlobalChatSocket(requestObject,packetType)}},self.sendHistoryMessageGetRequest=function(userId,tagId,pageDirection,packetId,pageLimit){var offlineIpPort=_getOfflineIpPort();if(offlineIpPort.ip&&offlineIpPort.port){var packetType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetType:packetType,userId:userId,tagId:tagId,packetId:packetId||tagChatFactory.getUUIDPacketId(),pageLimit:pageLimit||10,pageDirection:pageDirection,appVersion:settings.apiVersion,platform:PLATFORM.WEB};return _sendViaGlobalChatSocket(requestObject,packetType)}},self.getTagInformationWithMemberFromOfflineServer=function(userId,tagId,packetId){var offlineIpPort=_getOfflineIpPort();if(offlineIpPort.ip&&offlineIpPort.port){var packetType=OFFLINE_PACKET_TYPE.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,userId:userId,tagId:tagId,platform:PLATFORM.WEB};return _sendViaGlobalChatSocket(requestObject,packetType)}},self.sendOfflineBrokenPacket=function(userId,tagId,packetId){},self.getTagCreateRequestObject=function(userId,aTagObject,packetId){var offlineIpPort=_getOfflineIpPort();if(offlineIpPort.ip&&offlineIpPort.port){var packetType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId(),tagName:aTagObject.getTagName().utf8Encode(),tagPictureUrl:aTagObject.getPictureUrl(),tagMembers:aTagObject.getSerializedMembers(),platform:PLATFORM.WEB};return requestObject}},self.sendTagRegisterConfirmation=function(aTagObject,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Register Confirmation");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,packetType:packetType,tagId:aTagObject.getTagId(),serverDate:aTagObject.serverDate};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagInformationConfirmation=function(userId,aTagObject,packetId){var offlineIpPort=_getOfflineIpPort(),ip=aTagObject.getChatIp()||offlineIpPort.ip,port=aTagObject.getChatBindingPort()||offlineIpPort.port;if(!ip||!port)return void RingLogger.infoblack("Sending Tag Info Confirmation Ip/Port Exception ",aTagObject,RingLogger.tags.TAG_CHAT);var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION_CONFIRMATION,requestObject={ip:ip,port:port,packetId:packetId,userId:userId,packetType:packetType,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagMemberAddConfirmation=function(userId,aTagObject,packetId){if(aTagObject.getChatIp()&&aTagObject.getChatBindingPort()){var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,userId:userId,packetType:packetType,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)}},self.sendTagChatMemberRemoveLeaveConfirmation=function(userId,aTagObject,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Remove Leave Confirmation");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,userId:userId,packetType:packetType,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagMemberStatusChangeConfirmation=function(userId,aTagObject,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Member status change confirmation");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,userId:userId,packetType:packetType,tagId:aTagObject.getTagId()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagMsgSeenConfirmation=function(userId,aTagObject,packetId){},self.sendTagChatMsgDeleteConfirmation=function(userId,aTagObject,packetId,friendId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void _noIpPortException(aTagObject,"Sending Tag Msg Delete Confirmation");var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_DELETE_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,userId:userId,packetType:packetType,tagId:aTagObject.getTagId(),friendId:friendId};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagGeneralBrokenPacketConfirmation=function(userId,aTagObject,packetId,sequenceNo){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void RingLogger.infoblack(aTagObject,"Sending Tag General Broken Confirmation",RingLogger.tags.TAG_CHAT);var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,userId:userId,packetType:packetType,tagId:aTagObject.getTagId(),sequenceNo:sequenceNo};_sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagCreateConfirmation=function(userId,aTagObject,packetId){if(!aTagObject.getChatIp()||!aTagObject.getChatBindingPort())return void RingLogger.infoblack(aTagObject,"Sending Tag Create Confirmation",RingLogger.tags.TAG_CHAT);var packetType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG_CONFIRMATION,requestObject={ip:aTagObject.getChatIp(),port:aTagObject.getChatBindingPort(),packetId:packetId,packetType:packetType,tagId:aTagObject.getTagId(),userId:userId};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendTagInformationToOfflineServer=function(userId,aTagObject,packetId){var offlineIpPort=_getOfflineIpPort();if(!offlineIpPort.ip||!offlineIpPort.port)return void RingLogger.warning("Offline ip/port not set for create tag for tag ",aTagObject);var packetType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetId:packetId||tagChatFactory.getUUIDPacketId(),packetType:packetType,userId:userId,tagId:aTagObject.getTagId(),tagName:aTagObject.getTagName().utf8Encode(),tagPictureUrl:aTagObject.getPictureUrl(),tagMembers:aTagObject.getSerializedMembers()};return _sendViaGlobalChatSocket(requestObject,packetType)},self.getTagUnreadMessageConfirmationObject=function(userId,packetId,messagePacketIds){var offlineIpPort=_getOfflineIpPort();if(!offlineIpPort.ip||!offlineIpPort.port)return void RingLogger.warning("Offline ip/port not set for unread chat confirmation for packet id ",packetId,RingLogger.tags.TAG_CHAT);for(var packetType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION,packetsIds=[],index=0;index<messagePacketIds.length;index++)packetsIds.push({packetId:messagePacketIds[index]});var requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetType:packetType,userId:userId,packetId:packetId,packets:packetsIds};return requestObject},self.sendTagUnreadChatMsgConfirmation=function(userId,packetId,messagePacketIds){var requestObject=self.getTagUnreadMessageConfirmationObject(userId,packetId,messagePacketIds);return _sendViaGlobalChatSocket(requestObject,requestObject.packetType)},self.sendTagOfflineConfirmation=function(userId,tagId,packetId){var offlineIpPort=_getOfflineIpPort(),ip=offlineIpPort.ip,port=offlineIpPort.port,packetType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_CONFIRMATION,requestObject={
ip:ip,port:port,packetId:packetId,packetType:packetType,tagId:tagId};return _sendViaGlobalChatSocket(requestObject,packetType)},self.sendOfflineBrokenPacketConfirmation=function(userId,packetId,sequenceNo){var offlineIpPort=_getOfflineIpPort();if(!offlineIpPort.ip||!offlineIpPort.port)return void RingLogger.warning("Offline Ip/port not set for sending offline broken packet confirmation",RingLogger.tags.TAG_CHAT);var packetType=OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET_CONFIRMATION,requestObject={ip:offlineIpPort.ip,port:offlineIpPort.port,packetType:packetType,userId:userId,packetId:packetId,sequenceNo:sequenceNo};_sendViaGlobalChatSocket(requestObject,packetType)},self.sendToSelf=function(constructedPacket){utilsFactory.triggerCustomEvent("sendTagChatPacketToSelf",{byteData:constructedPacket.buffer.slice(6)})},self.sendViaGlobalChatSocket=_sendViaGlobalChatSocket,self.getPacket=_getPacket,self.getBrokenPacketObjects=_getBrokenPacketObjects,self.logRequestedPacketInfo=_logRequestedPacketInfo,self.sendPacketViaGlobalChatSocket=sendPacketViaGlobalChatSocket}angular.module("ringid.tagchat").service("tagChatApiService",tagChatApiService),tagChatApiService.$inject=["$$connector","$q","OPERATION_TYPES","AUTH_SERVER_ACTIONS","TAG_CHAT_PACKET_TYPE","PLATFORM","globalSocketFactory","utilsFactory","tagChatPacketProcessor","tagChatFactory","TAG_CHAT_GENERAL_CONSTANTS","OFFLINE_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","Auth","tagChatExceptions","settings","CHAT_GENERAL_CONSTANTS","chatTabSync"]}(),function(){"use strict";function tagChatModels($$stackedMap,profileFactory,userFactory,utilsFactory,Auth,TAG_CHAT_GENERAL_CONSTANTS,AUTH_SERVER_CONFIG,settings){function TagObject(){var self=this,tag={id:0,name:"Group",pictureUrl:"",userId:0,packetId:0,memberCount:0,chIp:"",chRp:0,chBp:0,serverDate:0,serverDateDiff:0,members:$$stackedMap.createNew(),messages:$$stackedMap.createNew(),objectLock:!1,lastCommunicationTime:0,ownerUserId:0,creationTime:0};this.getTagId=function(){return tag.id},this.setTagId=function(tagId){tag.id=tagId,tag.creationTime=tagId.toString().substr(0,TAG_CHAT_GENERAL_CONSTANTS.TAG_ID_NO_OF_TIME_DIGIT)},this.getTagCreationTime=function(){return tag.creationTime},this.getUserId=function(){return tag.userId},this.setUserId=function(userId){tag.userId=userId},this.getPacketId=function(){return tag.packetId},this.setPacketId=function(packetId){tag.packetId=packetId},this.renewPacketId=function(){self.setPacketId(utilsFactory.getUniqueID("tgrc"))},this.getChatIp=function(){return LOCAL_CHAT?TAG_CHAT_GENERAL_CONSTANTS.LOCAL_CHAT_REG_IP:tag.chIp},this.setChatIp=function(chIp){tag.chIp=chIp},this.resetChatIp=function(chIp){tag.chIp=""},this.getChatRegisterPort=function(){return LOCAL_CHAT?TAG_CHAT_GENERAL_CONSTANTS.LOCAL_CHAT_REG_PORT:tag.chRp?tag.chRp+API_VERSION_PORT_OFFSET:tag.chRp},this.setChatRegisterPort=function(chRp){tag.chRp=chRp},this.resetChatRegisterPort=function(chRp){tag.chRp=0},this.getChatBindingPort=function(){return tag.chBp},this.hasChatIp=function(){return!!tag.chIp},this.hasChatBindingPort=function(){return!!tag.chBp},this.hasChatRegisterPort=function(){return!!tag.chRp},this.resetChatBindingPort=function(){tag.chBp=0},this.setChatBindingPort=function(chBp){tag.chBp=chBp},this.getTagName=function(){return tag.name},this.setTagName=function(tagName){tag.name=tagName},this.setPictureUrl=function(pictureUrl){tag.pictureUrl=pictureUrl},this.getPictureUrl=function(){return tag.pictureUrl.trim()},this.getPictureFullUrl=function(){return""!=this.getPictureUrl()?settings.imBase+this.getPictureUrl():"images/prof.png"},this.setServerDate=function(serverDate){tag.serverDate=serverDate,self.setServerDateDiff(serverDate-parseInt((new Date).getTime()))},this.getServerDate=function(){return tag.serverDate},this.setServerDateDiff=function(serverDateDiff){tag.serverDateDiff=serverDateDiff},this.getServerDateDiff=function(){return tag.serverDateDiff},this.getMembersCount=function(){return tag.memberCount},this.setMembersCount=function(memberCount){tag.memberCount=memberCount},this.isTagSafeToShow=function(){return self.getMembersObjectMap().length()>1&&self.isUserMember(Auth.currentUser().getKey())},this.initMembers=function(){tag.members=$$stackedMap.createNew()},this.addMember=function(memberObj){tag.members||(tag.members=self.initMembers()),memberObj.isOwner()&&(tag.ownerUserId=memberObj.getId()),tag.members.save(memberObj.getId(),memberObj)},this.updateMember=function(updatedMemberObj){this.addMember(updatedMemberObj)},this.removeMember=function(memberObjOrId){memberObjOrId instanceof TagMember?tag.members.remove(memberObjOrId.getId()):tag.members.remove(memberObjOrId)},this.membersLength=function(){return tag.members?tag.members.length():0},this.getMember=function(memberUserId){return tag.members.get(memberUserId)},this.getMemberObjects=function(){return tag.members.values()},this.getMemberUserIds=function(){return tag.members.keys()},this.getMembersObjectMap=function(){return tag.members},this.setMembersObjectMap=function(memberObj){tag.members=memberObj},this.initMemberObjects=function(){for(var tagMembers=tag.members.all(),index=0;index<tag.members.length();index++){var aTagMember=tagMembers[index].value;setTimeout(function(aTagMember){aTagMember.initUserObjects()}.bind(null,aTagMember),AUTH_SERVER_CONFIG.REQUEST_DELAY)}},this.getSerializedMembers=function(){for(var allTagMembers=tag.members.all(),serializedObjectArray=[],tagMembersIndex=0;tagMembersIndex<allTagMembers.length;tagMembersIndex++){var aTagMember=allTagMembers[tagMembersIndex].value;serializedObjectArray.push(aTagMember.serialize())}return serializedObjectArray},this.isUserMember=function(userId){return tag.members?!!tag.members.get(userId):!1},this.isCurrentUserStatusAdmin=function(userId){var userObj=!!tag.members&&tag.members.get(userId);return userObj?userObj.isAdmin():!1},this.isCurrentUserStatusMember=function(userId){var userObj=!!tag.members&&tag.members.get(userId);return userObj?userObj.isMember():!1},this.setObjectLock=function(){tag.objectLock=!0},this.removeObjectLock=function(){tag.objectLock=!1},this.hasObjectLock=function(){return tag.objectLock},this.getLastCommunicationTime=function(){return tag.lastCommunicationTime},this.setLastCommunicationTime=function(lastCommunicationTime){tag.lastCommunicationTime=lastCommunicationTime},this.resetLastCommunicationTime=function(){tag.lastCommunicationTime=0},this.updateLastCommunicationTime=function(){tag.lastCommunicationTime=Math.floor(Date.now()/1e3)},this.setOwnerUserId=function(ownerUserId){tag.ownerUserId=ownerUserId},this.getOwnerUserId=function(){return tag.ownerUserId},this.initMessages=function(){tag.messages=$$stackedMap.createNew()},this.addMessage=function(messageObj){tag.messages||(tag.messages=self.initMessages()),tag.messages.save(messageObj.getPacketId(),messageObj)},this.removeMessage=function(messageObjOrId){messageObjOrId instanceof TagMessage?tag.messages.remove(messageObjOrId.getId()):tag.messages.remove(messageObjOrId)},this.messagesLength=function(){return tag.messages?tag.messages.length():0},this.getMessage=function(messagePacketId){return tag.messages.get(messagePacketId)},this.getMessageObjects=function(){return tag.messages.values()},this.getMessageUserIds=function(){return tag.messages.keys()},this.getMessagesObjectMap=function(){return tag.messages},this.setMessagesObjectMap=function(messageObj){tag.messages=messageObj},this.debug=function(){return tag}}function TagMember(){var self=this,tagMember={tagId:0,userId:0,fullName:"",status:0,statusValue:"",addedBy:0,user:{},addedByUser:{}};this.initWithUserMapObject=function(anUserMapObject){self.setId(anUserMapObject.getKey()),self.setFullName(anUserMapObject.getName()),self.setUserObj(anUserMapObject)},this.setTagId=function(tagId){tagMember.tagId=tagId},this.getTagId=function(){return tagMember.tagId},this.setId=function(memberId){tagMember.userId=memberId.toString()},this.getId=function(){return tagMember.userId},this.getUser=function(){return userFactory.getUser(tagMember.userId)},this.setFullName=function(fullName){tagMember.fullName=fullName},this.getFullName=function(){return tagMember.fullName},this.getPictureUrl=function(){return self.getUser().getUserAvatar?settings.imBase+self.getUser().getUserAvatar():"images/prof.png"},this.getName=function(){return""!==tagMember.fullName?tagMember.fullName:self.getUser()?self.getUser().getName():tagMember.userId},this.getStatus=function(){return tagMember.status},this.getStatusValue=function(){return tagMember.status===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN?"admin":tagMember.status===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER?"member":"owner"},this.setStatus=function(status){tagMember.status=status},this.setAddedBy=function(addedBy){tagMember.addedBy=addedBy},this.getAddedBy=function(){return tagMember.addedBy},this.getAddedByUser=function(){return userFactory.getUser(tagMember.addedBy)},this.getAddedByUserName=function(){return!!self.getAddedByUser()&&self.getAddedByUser().getName()},this.setAddedByUserObj=function(userObj){tagMember.addedByUser=userObj},this.setUserObj=function(userObj){tagMember.user=userObj},this.initUserObjects=function(){profileFactory.getUserDetailsByUId(tagMember.userId),setTimeout(function(tagMember){profileFactory.getUserDetailsByUId(tagMember.addedBy)}.bind(null,tagMember),AUTH_SERVER_CONFIG.REQUEST_DELAY)},this.isCurrentUser=function(){return self.getId()===Auth.currentUser().getKey()},this.isAdmin=function(){return tagMember.status==TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN},this.isMember=function(){return tagMember.status==TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER},this.isOwner=function(){return tagMember.status==TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.OWNER},this.isRemoved=function(){return tagMember.status==TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.REMOVED},this.makeAdmin=function(){tagMember.status=TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN},this.makeMember=function(){tagMember.status=TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER},this.makeOwner=function(){tagMember.status=TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.OWNER},this.serialize=function(){return{userId:self.getId(),fullName:self.getName().utf8Encode(),status:self.getStatus(),addedBy:self.getAddedBy()}}}function TagMessage(){var self=this,tagMessage={tagId:0,text:"",hrtime:"",status:"",messageDate:"",isDeleted:!1,messageDateString:"",timeout:0,userId:0,fullName:"",type:0,packetId:0,user:{},seenPacketSent:!1,deliveredPacketSent:!1,statusType:"",seenUsers:[],deliveredUsers:[],usersToChange:{},tagName:""};this.getTagId=function(){return tagMessage.tagId},this.setTagId=function(tagId){tagMessage.tagId=tagId},this.getHumanReadableTime=function(){return tagMessage.hrtime},this.setHumanReadableTime=function(hrtime){tagMessage.hrtime=hrtime},this.setFullName=function(fullName){tagMessage.fullName=fullName.substring(0,127)},this.getFullName=function(){return tagMessage.fullName},this.getPacketId=function(){return tagMessage.packetId},this.setPacketId=function(packetId){tagMessage.packetId=packetId},this.getMessageText=function(messageText){return tagMessage.text},this.setMessageText=function(messageText){tagMessage.text=messageText},this.setStatus=function(messageStatus){tagMessage.status=messageStatus},this.getStatus=function(){return tagMessage.status},this.setMessageDate=function(messageDate){tagMessage.messageDate=messageDate},this.getMessageDate=function(){return tagMessage.messageDate},this.markAsDeleted=function(){tagMessage.isDeleted=!0},this.unMarkFromDeleted=function(){tagMessage.isDeleted=!1},this.getIsDeleted=function(){return tagMessage.isDeleted},this.setMessageDateString=function(messageDateString){tagMessage.messageDateString=messageDateString},this.setTimeout=function(timeout){tagMessage.timeout=timeout},this.setUserId=function(userId){tagMessage.userId=userId},this.getMessageDateString=function(){return tagMessage.messageDateString},this.getTimeout=function(){return tagMessage.timeout},this.getUserId=function(){return tagMessage.userId},this.getUser=function(){return userFactory.getUser(tagMessage.userId)},this.getMessageType=function(){return tagMessage.type},this.setMessageType=function(messageType){return tagMessage.type=messageType},this.initUserObjects=function(){profileFactory.getUserDetailsByUId(tagMessage.userId).then(function(userObj){userObj&&(tagMessage.user=userObj)})},this.getSeenPacketSent=function(){return tagMessage.seenPacketSent},this.getDeliveredPacketSent=function(){return tagMessage.deliveredPacketSent},this.setSeenPacketSent=function(seenPacketSent){tagMessage.seenPacketSent=seenPacketSent},this.setDeliveredPacketSent=function(deliveredPacketSent){tagMessage.deliveredPacketSent=deliveredPacketSent},this.addSeenUserId=function(userId){tagMessage.seenUsers.push(userId)},this.addDeliveredUserId=function(userId){tagMessage.deliveredUsers.push(userId)},this.setUsersToChange=function(usersToChange){tagMessage.usersToChange=usersToChange},this.getUsersToChange=function(usersToChange){return tagMessage.usersToChange},this.setStatusType=function(statusType){tagMessage.statusType=statusType},this.getStatusType=function(){return tagMessage.statusType},this.getTagName=function(){return tagMessage.tagName},this.setTagName=function(tagName){tagMessage.tagName=tagName},this.serialize=function(){return{tagId:self.getTagId(),userId:self.getUserId(),user:self.getUserId(),packetId:self.getPacketId(),fullName:self.getFullName().utf8Encode(),status:self.getStatus(),statusType:self.getStatusType(),type:self.getMessageType(),hrtime:self.getHumanReadableTime(),messageDate:self.getMessageDate(),isDeleted:tagMessage.isDeleted,timeout:self.getTimeout(),text:self.getMessageText().utf8Encode(),seenPacketSent:self.getSeenPacketSent(),deliveredPacketSent:self.getDeliveredPacketSent(),usersToChange:Object.keys(tagMessage.usersToChange),messageType:self.getMessageType(),tag_chat:!0,tagName:self.getTagName()}}}var LOCAL_CHAT=TAG_CHAT_GENERAL_CONSTANTS.LOCAL_CHAT,API_VERSION_PORT_OFFSET=TAG_CHAT_GENERAL_CONSTANTS.API_VERSION_PORT_OFFSET;return TagObject.prototype.copy=function(){var newTag=new TagObject;return newTag.setTagId(this.getTagId()),newTag.setTagName(this.getTagName()),newTag.setPictureUrl(this.getPictureUrl()),newTag.setUserId(this.getUserId()),newTag.setPacketId(this.getPacketId()),newTag.setChatBindingPort(this.getChatBindingPort()),newTag.setChatIp(this.getChatIp()),newTag.setChatRegisterPort(this.getChatRegisterPort()),newTag.setServerDate(this.getServerDate()),newTag.setMembersObjectMap(this.getMembersObjectMap().copy()),newTag},TagObject.prototype.update=function(newTagObj){newTagObj.getTagName()&&this.setTagName(newTagObj.getTagName()),newTagObj.getPictureUrl()&&this.setPictureUrl(newTagObj.getPictureUrl()),newTagObj.getUserId()&&this.setUserId(newTagObj.getUserId()),newTagObj.getPacketId()&&this.setPacketId(newTagObj.getPacketId()),newTagObj.getChatBindingPort()&&this.setChatBindingPort(newTagObj.getChatBindingPort()),newTagObj.getChatIp()&&this.setChatIp(newTagObj.getChatIp()),newTagObj.getChatRegisterPort()&&this.setChatRegisterPort(newTagObj.getChatRegisterPort()),newTagObj.getServerDate()&&this.setServerDate(newTagObj.getServerDate())},TagObject.prototype.sortBy=function(){return this.getTagCreationTime()},TagMessage.prototype.update=function(newTagMessageObj){newTagMessageObj.getFullName()&&this.setFullName(newTagMessageObj.getFullName()),newTagMessageObj.getStatus()&&this.setStatus(newTagMessageObj.getStatus()),newTagMessageObj.getStatusType()&&this.setStatusType(newTagMessageObj.getStatusType()),newTagMessageObj.getMessageType()&&this.setMessageType(newTagMessageObj.getMessageType()),newTagMessageObj.getMessageDate()&&this.setMessageDate(newTagMessageObj.getMessageDate()),newTagMessageObj.getMessageText()&&this.setMessageText(newTagMessageObj.getMessageText()),newTagMessageObj.getUsersToChange()&&this.setUsersToChange(newTagMessageObj.getUsersToChange()),newTagMessageObj.getMessageType()&&this.setMessageType(newTagMessageObj.getMessageType()),newTagMessageObj.getSeenPacketSent()&&this.setSeenPacketSent(newTagMessageObj.getSeenPacketSent()),newTagMessageObj.getDeliveredPacketSent()&&this.setDeliveredPacketSent(newTagMessageObj.getDeliveredPacketSent()),newTagMessageObj.getDeliveredPacketSent()&&this.setDeliveredPacketSent(newTagMessageObj.getDeliveredPacketSent()),newTagMessageObj.getTimeout()&&this.setTimeout(newTagMessageObj.getTimeout()),newTagMessageObj.getIsDeleted()&&this.markAsDeleted(),newTagMessageObj.getHumanReadableTime()||this.setHumanReadableTime(newTagMessageObj.getHumanReadableTime())},{TagObject:TagObject,TagMember:TagMember,TagMessage:TagMessage}}var tagChatApp=angular.module("ringid.tagchat");tagChatApp.factory("tagChatModels",tagChatModels),tagChatModels.$inject=["$$stackedMap","profileFactory","userFactory","utilsFactory","Auth","TAG_CHAT_GENERAL_CONSTANTS","AUTH_SERVER_CONFIG","settings"]}(),function(){"use strict";function tagChatFactory($$stackedMap,$$connector,TAG_CHAT_GENERAL_CONSTANTS,TAG_CHAT_PACKET_TYPE,TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP,FRIEND_CHAT_PACKET_TYPE,AUTH_SERVER_ACTIONS,userFactory,friendsFactory,profileFactory,Auth,utilsFactory,CHAT_GLOBAL_VALUES,tagChatModels,tagChatPacketProcessor){function getTagId(){var userId=Auth.currentUser().getKey().toString(),currentTime=(new Date).getTime().toString(),tagId=currentTime.substr(0,TAG_CHAT_GENERAL_CONSTANTS.TAG_ID_NO_OF_TIME_DIGIT);return tagId+=userId.substr(userId.length-TAG_CHAT_GENERAL_CONSTANTS.TAG_ID_NO_OF_USER_ID_DIGIT)}function _getTags(){return tagChatTags}function _getTag(key){return tagChatTags.get(key)}function _removeTagObject(key){return tagChatTags.remove(key)}function _createNewTag(object,tagObject){return tagObject||(tagObject=new tagChatModels.TagObject),object.tagId?tagObject.setTagId(object.tagId):tagObject.setTagId(getTagId()),object.packetId&&tagObject.setPacketId(object.packetId),object.userId&&tagObject.setUserId(object.userId),object.tagName&&tagObject.setTagName(object.tagName),object.tagPictureUrl&&tagObject.setPictureUrl(object.tagPictureUrl),object.chIp&&tagObject.setChatIp(object.chIp),object.chRp&&tagObject.setChatRegisterPort(object.chRp),object.serverDate&&tagObject.setServerDate(object.serverDate),object.tagMembersCount&&tagObject.setMembersCount(object.tagMembersCount),tagObject}function _createNewTagMember(tagId,object,userObjectInit){var tagMemberObject=new tagChatModels.TagMember;return tagId&&tagMemberObject.setTagId(tagId),object&&(object.userId&&tagMemberObject.setId(object.userId),object.fullName&&tagMemberObject.setFullName(object.fullName),object.addedBy&&tagMemberObject.setAddedBy(object.addedBy),object.status?tagMemberObject.setStatus(object.status):tagMemberObject.setStatus(TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER)),tagMemberObject}function _createNewTagMessage(tagId,object,userObjectInit){var tagMessageObject=new tagChatModels.TagMessage;return tagId&&tagMessageObject.setTagId(tagId),object&&(object.userId&&tagMessageObject.setUserId(object.userId),object.user&&tagMessageObject.setUserId(object.user),object.fullName&&tagMessageObject.setFullName(object.fullName),object.message&&tagMessageObject.setMessageText(object.message),object.hrtime&&tagMessageObject.setHumanReadableTime(object.hrtime),object.messageDate&&tagMessageObject.setMessageDate(object.messageDate),object.isDeleted&&tagMessageObject.markAsDeleted(object.isDeleted),object.messageDateString&&tagMessageObject.setMessageDateString(object.messageDateString),object.timeout&&tagMessageObject.setTimeout(object.timeout),object.messageType&&tagMessageObject.setMessageType(object.messageType),object.status&&tagMessageObject.setStatus(object.status),object.packetId&&tagMessageObject.setPacketId(object.packetId),object.usersToChange&&tagMessageObject.setUsersToChange(object.usersToChange),object.statusType&&tagMessageObject.setStatusType(object.statusType),object.tagName&&tagMessageObject.setTagName(object.tagName)),tagMessageObject}function _createTagStatusMessage(packetId,tagId,userId,messageType,usersToChangeArray,restInfo){var statusMessageObject={},tagObject=_getTag(tagId);if(tagObject){var messageDate;messageDate=restInfo.messageDate?restInfo.messageDate:parseInt((new Date).getTime())+tagObject.getServerDateDiff(),profileFactory.getUserDetailsByUId(userId);var userObject=userFactory.getUser(userId);if(statusMessageObject={message:"",fullName:userObject.getName(),status:"status_update",statusType:messageType,tagName:restInfo?restInfo.tagName:"",messageDate:messageDate,messageType:2,tag_chat:!0,userId:userId,user:userId,packetId:packetId},statusMessageObject.usersToChange={},usersToChangeArray.length>0)for(var index=0;index<usersToChangeArray.length;index++){var changedUserObject=usersToChangeArray[index],tagMemberObject=_createNewTagMember(tagObject.getTagId(),changedUserObject,!0);statusMessageObject.usersToChange[tagMemberObject.getName()]=!0}var tagMessage=_createNewTagMessage(tagId,statusMessageObject);return tagMessage}return!1}function _getTagLastMessageObject(messageObject){var tagLastMessageObject={key:messageObject.key,text:messageObject.text,messageType:messageObject.messageType,messageDate:messageObject.messageDate};return tagLastMessageObject}function _addTagObject(aNewTagObject){if(!(aNewTagObject instanceof tagChatModels.TagObject))return!1;var aFactoryTagObj=tagChatTags.get(aNewTagObject.getTagId());return aFactoryTagObj?aFactoryTagObj.update(aNewTagObject):tagChatTags.add(aNewTagObject.getTagId(),aNewTagObject),!0}function _getOrCreateTag(tagId,newTagInfo){newTagInfo||(newTagInfo={tagId:tagId});var tagObj=_getTag(tagId);return tagObj=tagObj?_createNewTag(newTagInfo,tagObj):_createNewTag(newTagInfo),tagChatTags.save(tagId,tagObj),tagObj}function _updateTag(tagId,newTagInfo,oldTagObj){return oldTagObj||(oldTagObj=_getTag(tagId)),oldTagObj=_createNewTag(newTagInfo,oldTagObj),tagChatTags.save(tagId,oldTagObj),oldTagObj}function _getOrCreateMessage(tagId,newTagMessageInfo){var newTagInfo={tagId:tagId};newTagMessageInfo||(newTagMessageInfo={tagId:tagId});var tagObj=_getTag(tagId);tagObj||(tagObj=_createNewTag(newTagInfo),tagChatTags.save(tagId,tagObj));var newTagMessageObj=_createNewTagMessage(tagId,newTagMessageInfo,!0),oldTagMessageObj=tagObj.getMessage(newTagMessageInfo.packetId);return oldTagMessageObj?oldTagMessageObj.update(newTagMessageObj):(oldTagMessageObj=newTagMessageObj,tagObj.addMessage(oldTagMessageObj)),oldTagMessageObj}function _updateTagRegisteredTime(tagId,updateTime){registeredTags[tagId]=updateTime||(new Date).getTime()/1e3}function _isTagRegisteredValid(tagId){return registeredTags[tagId]?!((new Date).getTime()/1e3-registeredTags[tagId]>TAG_CHAT_GENERAL_CONSTANTS.TAG_REGISTER_TIMEOUT):!1}function _isTagRegistered(tagId){return!!registeredTags[tagId]&&_isTagRegisteredValid(tagId)}function _unRegisterTag(tagId){delete registeredTags[tagId]}function _markTagAsRegistered(tagId){_updateTagRegisteredTime(tagId),utilsFactory.triggerCustomEvent("tagregistered",{tagId:tagId})}function _setTagChatInitiator(tagId){tagInitiator[tagId]=!0,setTimeout(function(){RingLogger.debug("Tag Initiator Reseted",RingLogger.tags.TAG_CHAT),tagInitiator[tagId]=!1},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)}function _resetTagChatInitiator(tagId){tagInitiator[tagId]=!1}function _isTagChatInitiator(tagId){return!!tagInitiator[tagId]}function _getAuthRequestKey(tagId,actionId){return tagId+"-"+actionId}function _setInTagChatRequestCache(packetId,requestObject){_startProcessRequest&&(tagChatRequestCache[packetId]=requestObject,_initTagChatRequestCacheClearInterval(packetId))}function _resetInTagChatRequestCache(packetId){delete tagChatRequestCache[packetId]}function _getFromTagChatRequestCache(key){return tagChatRequestCache[key]}function _isInRequestCacheForChat(packetId){return!!_getFromTagChatRequestCache(packetId)}function _isInRequestCacheForAuth(tagId,actn){var key=_getAuthRequestKey(tagId,actn);return!!_getFromTagChatRequestCache(key)}function _resetInTagChatRequestCacheForAuth(tagId,actn){var key=_getAuthRequestKey(tagId,actn);_resetInTagChatRequestCache(key)}function _initTagChatRequestCacheClearInterval(key){setTimeout(function(){_resetInTagChatRequestCache(key)},TAG_CHAT_GENERAL_CONSTANTS.REQUEST_CACHE_VALIDITY)}function _getTagChatResponseCacheKey(packetId,responseObject){if(responseObject.packetType==TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED||responseObject.packetType==FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED||responseObject.packetType==FRIEND_CHAT_PACKET_TYPE.TAG_CHAT_SENT||responseObject.packetType==FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT){var packetIdParts=packetId.split("_");2==packetIdParts.length&&(responseObject.packetId=packetIdParts[0],responseObject.sequenceNo=packetIdParts[1])}return responseObject.sequenceNo||(responseObject.sequenceNo=0),packetId+"_"+responseObject.sequenceNo+"_"+responseObject.packetType}function _setInTagChatResponseCache(packetId,responseObject){var key=_getTagChatResponseCacheKey(packetId,responseObject);tagChatResponseCache[key]=responseObject,_initTagChatResponseCacheClearInterval(key)}function __doResetFromTagChatResponseCache(key){delete tagChatResponseCache[key]}function _resetFromTagChatResponseCache(packetId,packetType){var key=_getTagChatResponseCacheKey(packetId,{packetType:packetType});__doResetFromTagChatResponseCache(key)}function _getFromTagChatResponseCache(responseObject){var key=_getTagChatResponseCacheKey(responseObject.packetId,responseObject);return tagChatResponseCache[key]}function _initTagChatResponseCacheClearInterval(key){setTimeout(function(){__doResetFromTagChatResponseCache(key)},TAG_CHAT_GENERAL_CONSTANTS.RESPONSE_CACHE_VALIDITY)}function _setInTagChatResponseCacheForAuth(tagId,actnId){_setInTagChatResponseCache(tagId,{packetType:actnId})}function _isInTagChatResponseCacheForAuth(tagId,actnId){return!!_getFromTagChatResponseCache({packetId:tagId,packetType:actnId})}function __hasReceivedConfirmationByConfirmationPacketType(confirmationPacketType,packetId,sequenceNo){var responseObject={packetId:packetId,packetType:confirmationPacketType,sequenceNo:sequenceNo};return!!_getFromTagChatResponseCache(responseObject)}function _hasReceivedConfirmation(packetId,packetType,sequenceNo){sequenceNo||(sequenceNo=0);var confirmationPacketType=TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP[packetType];if(confirmationPacketType){var receivedConfirmation=!1;if(angular.isArray(confirmationPacketType)){for(var index=0,length=confirmationPacketType.length;length>index;index++)if(__hasReceivedConfirmationByConfirmationPacketType(confirmationPacketType[index],packetId,sequenceNo)){receivedConfirmation=!0;break}}else receivedConfirmation=__hasReceivedConfirmationByConfirmationPacketType(confirmationPacketType,packetId,sequenceNo)}else;return receivedConfirmation}function _getIdleIntervalIdByTagId(tagId){return tagIdleIntervals[tagId]}function _setIdleIntervalIdByTagId(tagId,intervalId){tagIdleIntervals[tagId]=intervalId}function _resetIdleIntervalIdByTagId(tagId){delete tagIdleIntervals[tagId]}function _shouldProcessRequest(request){if(request.actn){var tagId=request.tid||request.tagId,isInRequestCache=_isInRequestCacheForAuth(tagId,request.actn);return!isInRequestCache}}function _getUUIDPacketId(packetTime,isPacketIdStamp){var timestamp;return isPacketIdStamp||packetTime?timestamp=packetTime:(packetTime=(new Date).getTime(),timestamp=parseInt(packetTime+CHAT_GLOBAL_VALUES.serverTimeDiff)),timestamp||RingLogger.alert("Invalid Timestamp",RingLogger.tags.CHAT),PacketIDGenerator.create(Auth.currentUser().getKey(),timestamp,isPacketIdStamp)}var tagChatTags=$$stackedMap.createNew(!0),registeredTags={},tagInitiator={},tagChatRequestCache={},tagChatResponseCache={},tagIdleIntervals={},_startProcessRequest=!0;return{createNewTag:_createNewTag,createNewTagMember:_createNewTagMember,createNewTagMessage:_createNewTagMessage,createTagStatusMessage:_createTagStatusMessage,addTagObject:_addTagObject,removeTagObject:_removeTagObject,getTags:_getTags,getTag:_getTag,generateNewTagId:getTagId,getOrCreateTag:_getOrCreateTag,getOrCreateMessage:_getOrCreateMessage,updateTag:_updateTag,getTagLastMessageObject:_getTagLastMessageObject,isTagRegistered:_isTagRegistered,markTagAsRegistered:_markTagAsRegistered,unRegisterTag:_unRegisterTag,updateTagRegisteredTime:_updateTagRegisteredTime,setTagChatInitiator:_setTagChatInitiator,resetTagChatInitiator:_resetTagChatInitiator,isTagChatInitiator:_isTagChatInitiator,setInTagChatRequestCache:_setInTagChatRequestCache,resetInTagChatRequestCache:_resetInTagChatRequestCache,resetInTagChatRequestCacheForAuth:_resetInTagChatRequestCacheForAuth,getFromTagChatRequestCache:_getFromTagChatRequestCache,getAuthRequestKey:_getAuthRequestKey,isInRequestCacheForAuth:_isInRequestCacheForAuth,isInRequestCacheForChat:_isInRequestCacheForChat,setInTagChatResponseCache:_setInTagChatResponseCache,resetFromTagChatResponseCache:_resetFromTagChatResponseCache,getFromTagChatResponseCache:_getFromTagChatResponseCache,setInTagChatResponseCacheForAuth:_setInTagChatResponseCacheForAuth,isInTagChatResponseCacheForAuth:_isInTagChatResponseCacheForAuth,getIdleIntervalIdByTagId:_getIdleIntervalIdByTagId,setIdleIntervalIdByTagId:_setIdleIntervalIdByTagId,resetIdleIntervalIdByTagId:_resetIdleIntervalIdByTagId,hasReceivedConfirmation:_hasReceivedConfirmation,shouldProcessRequest:_shouldProcessRequest,startProcessingRequest:_startProcessRequest,getUUIDPacketId:_getUUIDPacketId}}angular.module("ringid.tagchat").factory("tagChatFactory",tagChatFactory),tagChatFactory.$inject=["$$stackedMap","$$connector","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","TAG_CHAT_PACKET_TYPE_CONFIRMATION_MAP","FRIEND_CHAT_PACKET_TYPE","AUTH_SERVER_ACTIONS","userFactory","friendsFactory","profileFactory","Auth","utilsFactory","CHAT_GLOBAL_VALUES","tagChatModels","tagChatPacketProcessor"]}(),function(){"use strict";function tagChatStorage(Storage,Auth,utilsFactory){function _getStoreKey(){return"tagc-store-"+Auth.currentUser().getKey()}function __writeToLocalStorage(data){Storage.setData(_getStoreKey(),angular.toJson(data))}function _savePacket(packetId,packetData){StorageObjectModel.packets[packetId]=utilsFactory.arrayBuffer2String(packetData.buffer.slice(6)),__writeToLocalStorage(StorageObjectModel)}function _getPacket(packetId){return utilsFactory.string2ArrayBuffer(StorageObjectModel.packets[packetId])}function _getAllPackets(){return StorageObjectModel.packets}var StorageObjectModel={packets:{}};return Auth.isLoggedIn(),{savePacket:_savePacket,getPacket:_getPacket,getAllPackets:_getAllPackets}}angular.module("ringid.tagchat").factory("tagChatStorage",tagChatStorage),tagChatStorage.$inject=["Storage","Auth","utilsFactory"]}(),function(){"use strict";function tagChatManager($$connector,$q,$timeout,Auth,tagChatFactory,tagChatApiService,tagChatPacketProcessor,tagChatUI,tagChatHelper,ChatFactory,chatHistoryFactory,userFactory,utilsFactory,profileFactory,tagChatStorage,OPERATION_TYPES,Ringalert,TAG_CHAT_GENERAL_CONSTANTS,TAG_CHAT_PACKET_TYPE,TAG_CHAT_LANG,AUTH_SERVER_ACTIONS,OFFLINE_PACKET_TYPE,FRIEND_CHAT_PACKET_TYPE,chatPacketResender,chatUtilsFactory){function _requestForIp(tagId){var tagObject=tagChatFactory.getOrCreateTag(tagId);tagObject&&tagChatApiService.createOrGetTagFromAuth(tagObject,tagObject.getMemberUserIds()).then(function(response){response.isInitiated=!0,_doOnTagChatRequestStartResponse(response)})}function _updateTagIpPort(tagId,updateInfo){var ip=updateInfo.chIp,port=updateInfo.chRp,tagObject=tagChatFactory.getTag(updateInfo.tid),chatBox=ChatFactory.getBoxByUId(updateInfo.tid);tagObject.setChatIp(ip),tagObject.setChatRegisterPort(port),chatBox&&(chatBox.setIp(updateInfo.chIp),chatBox.setRPort(updateInfo.chRp))}function _doOnTagChatRequestStartResponse(response){response.sucs&&(_updateTagIpPort(response.tid,response),response.isInitiated?_registerTag(response.tid,TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.CHAT_INVITE):_registerTag(response.tid,TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),
RingLogger.print("Tag Chat Request Start ",response,RingLogger.tags.TAG_CHAT))}function _subscribeForAuthUpdate(){var openedBox;$$connector.subscribe(function(message){RingLogger.print("tag-update",message,RingLogger.tags.TAG_CHAT);var tagId=message.tid;if(message.sucs&&tagChatFactory.startProcessingRequest)switch(message.actn){case OPERATION_TYPES.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_START:if(RingLogger.print("Received Auth Update Start",message,RingLogger.tags.TAG_CHAT),tagChatFactory.isInRequestCacheForAuth(tagId,AUTH_SERVER_ACTIONS.START_TAG_CHAT))return void RingLogger.print("Skipping update start coz, Self Request ",tagId,RingLogger.tags.TAG_CHAT);if(tagChatFactory.isInTagChatResponseCacheForAuth(tagId,message.actn))return void RingLogger.print("Skipping update start coz, Already Received an Update Start Within 15sec for ",tagId,RingLogger.tags.TAG_CHAT);var tagObject=tagChatFactory.getTag(tagId);tagObject?(_updateTagIpPort(tagId,message),tagChatFactory.isTagRegistered(tagId)||_registerTag(tagId)):(tagObject=tagChatFactory.getOrCreateTag(tagId),openedBox=ChatFactory.getBoxByUId(tagId),openedBox||(openedBox=ChatFactory.creatNonDomBox(tagId,!0)),_updateTagIpPort(tagId,message),_requestForTagInformationMultipleTimes(tagId).then(function(response){response.sucs&&(tagChatFactory.isTagRegistered(tagId)||_registerTag(tagId))}));break;case OPERATION_TYPES.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_ADD_MEMBER:if(RingLogger.print("Received Auth Add Member ",message,RingLogger.tags.TAG_CHAT),tagChatFactory.isInRequestCacheForAuth(tagId,AUTH_SERVER_ACTIONS.ADD_TAG_CHAT_MEMBERS))return void RingLogger.print("Skipping update add member coz, Self Request ",tagId,RingLogger.tags.TAG_CHAT);if(tagChatFactory.isInTagChatResponseCacheForAuth(message.tid,message.actn))return void RingLogger.print("Skipping auth add member coz, Already Received an add memebr Within 15sec for ",message.tid,RingLogger.tags.TAG_CHAT);tagChatFactory.setInTagChatResponseCacheForAuth(message.tid,message.actn);var tagObject=tagChatFactory.getTag(tagId);tagObject?tagChatFactory.isTagRegistered(tagId)||_registerTag(tagId):(tagObject=tagChatFactory.getOrCreateTag(tagId),openedBox=ChatFactory.getBoxByUId(tagId),openedBox||(openedBox=ChatFactory.creatNonDomBox(tagId,!0)),_requestForTagInformationMultipleTimes(tagId).then(function(response){response.sucs&&(tagChatFactory.isTagRegistered(tagId)||_registerTag(tagId))})),message.uIds?angular.forEach(message.uIds,function(aMessageUId){tagObject.addMember(tagChatFactory.createNewTagMember(tagObject.getTagId(),{userId:aMessageUId},!0))}):RingLogger.error("No Member Info Send Via Auth Update",message,RingLogger.tags.TAG_CHAT);break;default:RingLogger.error("This message shouldn't be printed",RingLogger.tags.TAG_CHAT)}else RingLogger.print(message,RingLogger.tags.TAG_CHAT)},{action:[OPERATION_TYPES.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_START,OPERATION_TYPES.SYSTEM.TAG_CHAT.TAG_CHAT_UPDATE_ADD_MEMBER]})}function _getIpPortForTag(tagId,tagObject){tagObject||(tagObject=tagChatFactory.getTag(tagId));var success=!1,deferred=$q.defer(),packetId=utilsFactory.getUniqueID(),doCreateOrGetTagFromAuth=function(){tagChatApiService.createOrGetTagFromAuth(tagObject,tagObject.getMemberUserIds(),packetId).then(function(response){response.sucs&&response.tid?(_updateTagIpPort(response.tid,response),success=!0):success=!1},function(response){success=!1})};return callXTimeAfterYIntervalStopOnSuccess(function(){success||doCreateOrGetTagFromAuth()},function(currentExecutionCount){return success&&deferred.resolve(success),success},function(){deferred.resolve(success)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY),deferred.promise}function __doRequestForTagRegister(tagObject,regType){var currentUser=Auth.currentUser();return tagChatFactory.getFromTagChatRequestCache(tagObject.getTagId())?(RingLogger.information("Skipping Register Request as One Request is Already in Progress for tagId ",tagObject.getTagId(),RingLogger.tags.TAG_CHAT),!1):(tagChatApiService.registerTagInChatServer(currentUser.getKey(),tagObject,null,regType),!0)}function _registerTag(tagId,regType){if(!tagChatFactory.isTagRegistered(tagId)){var tagObject=tagChatFactory.getTag(tagId);return tagObject?tagObject.membersLength()<2?(RingLogger.print("Member List Length < 2, Chat Session Initiate Korlam na.",RingLogger.tags.TAG_CHAT),-1):(tagObject.hasChatRegisterPort()?__doRequestForTagRegister(tagObject,regType):tagChatFactory.isInRequestCacheForAuth(tagId,AUTH_SERVER_ACTIONS.START_TAG_CHAT)?RingLogger.print("Skipping Ip/Port Get Request as One Request is Already in Progress",tagObject.getTagId(),RingLogger.tags.TAG_CHAT):_getIpPortForTag(tagId,tagObject).then(function(sucs){sucs?(RingLogger.print("Got Ip Port Info",RingLogger.tags.TAG_CHAT),tagChatFactory.isTagRegistered(tagId)||(tagObject=tagChatFactory.getTag(tagId),__doRequestForTagRegister(tagObject,regType))):RingLogger.print("Failed to get Ip port from Auth For Tag",tagObject.getTagId(),sucs,RingLogger.tags.TAG_CHAT)}),!0):(RingLogger.print("Tag Nai, Register Korlam na",RingLogger.tags.TAG_CHAT),-1)}return!1}function _createTag(object){var aTag,aTagMemberObjectParam,aTagMemberObject,aTagAdminObjectParam,aTagAdminObject,currentUser=Auth.currentUser(),deferred=$q.defer();object.tagMembersCount=object.memberUIds.length+object.adminUIds.length+1,aTag=tagChatFactory.createNewTag(object),aTagMemberObjectParam={userId:currentUser.getKey(),addedBy:currentUser.getKey(),status:TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.OWNER},aTagMemberObject=tagChatFactory.createNewTagMember(aTag.getTagId(),aTagMemberObjectParam,!0),aTag.addMember(aTagMemberObject);for(var tagMemberIndex=0;tagMemberIndex<object.memberUIds.length;tagMemberIndex++){var aTagMemberUId=object.memberUIds[tagMemberIndex];aTagMemberObjectParam={userId:aTagMemberUId,addedBy:currentUser.getKey(),status:TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER},aTagMemberObject=tagChatFactory.createNewTagMember(aTag.getTagId(),aTagMemberObjectParam,!0),aTag.addMember(aTagMemberObject)}for(var tagAdminIndex=0;tagAdminIndex<object.adminUIds.length;tagAdminIndex++){var aTagAdminUId=object.adminUIds[tagAdminIndex];aTagAdminObjectParam={userId:aTagAdminUId,addedBy:currentUser.getKey(),status:TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN},aTagAdminObject=tagChatFactory.createNewTagMember(aTag.getTagId(),aTagAdminObjectParam,!0),aTag.addMember(aTagAdminObject)}aTag.setObjectLock(),tagChatFactory.addTagObject(aTag),object.uIds=object.adminUIds.concat(object.memberUIds);var doTagChatCreateRequestInAuth=function(){tagChatApiService.createOrGetTagFromAuth(aTag,object.uIds).then(function(response){response.isInitiated=!0,_doOnTagChatRequestStartResponse(response)})},_doAfterTagCreateInChat=function(){doTagChatCreateRequestInAuth()};try{var requestObject,aChatSender,aChatSenderInstance;requestObject=tagChatApiService.getTagCreateRequestObject(currentUser.getKey(),aTag),aChatSender=new ChatPacketSender,aChatSender.setPacketObject(requestObject),aChatSender.setBrokenPacketType(OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET),aChatSenderInstance=aChatSender.getInstance(),aChatSenderInstance.on("success",function(response){response.sucs&&(aTag.removeObjectLock(),_doAfterTagCreateInChat(),deferred.resolve({sucs:!0}))}),aChatSenderInstance.on("failure",function(response){tagChatFactory.removeTagObject(aTag.getTagId()),deferred.reject({sucs:!1,msg:"Unable create tag in offline server."}),RingLogger.alert("Unable create tag in offline server ",aTag.getTagId(),RingLogger.tags.TAG_CHAT)}),aChatSenderInstance.start()}catch(e){RingLogger.alert("Tag Create  Exception ",e,RingLogger.tags.TAG_CHAT),tagChatFactory.removeTagObject(aTag.getTagId()),deferred.reject({sucs:!1,msg:"Unable create tag in offline server."}),RingLogger.alert("Unable create tag in offline server ",aTag.getTagId(),RingLogger.tags.TAG_CHAT)}return deferred.promise}function __getMembersForCRUD(oldTagObj,memberUIdsToSet,adminUIdsToSet){var oldTagMemberListCopy,oldTagMembersAndAdminsMap,allOldTagMembersAndAdminsMap,aTagMemberObject,statusChanged,aNewMember,newTagMemberObject,aNewAdmin,newTagAdminObject,currentUser=Auth.currentUser(),serializedMemberAdminsToRemove=[],serializedMemberAdminsToStatusChange=[],serializedNewMemberAdminsToAdd=[],membersAdminToAddOnSuccess=[],membersAdminToRemoveOnSuccess=[],membersAdminToUpdateOnSuccess=[],newMemberUIdsToSetCache={},newAdminUIdsToSetCache={},oldMembersUIdCache={};oldTagMemberListCopy=oldTagObj.getMembersObjectMap().copy(),oldTagMembersAndAdminsMap=oldTagMemberListCopy,allOldTagMembersAndAdminsMap=oldTagMembersAndAdminsMap.all(),angular.forEach(memberUIdsToSet,function(aMemberUId){newMemberUIdsToSetCache[aMemberUId]=!0}),angular.forEach(adminUIdsToSet,function(anAdminUId){newAdminUIdsToSetCache[anAdminUId]=!0});for(var oldTagMembersAndAdminsMapIndex=0;oldTagMembersAndAdminsMapIndex<allOldTagMembersAndAdminsMap.length;oldTagMembersAndAdminsMapIndex++)aTagMemberObject=allOldTagMembersAndAdminsMap[oldTagMembersAndAdminsMapIndex].value,aTagMemberObject.isOwner()||(oldMembersUIdCache[aTagMemberObject.getId()]=!0,newAdminUIdsToSetCache[aTagMemberObject.getId()]||newMemberUIdsToSetCache[aTagMemberObject.getId()]?(statusChanged=!1,aTagMemberObject.isAdmin()?newMemberUIdsToSetCache[aTagMemberObject.getId()]&&(aTagMemberObject.makeMember(),statusChanged=!0):aTagMemberObject.isMember()&&newAdminUIdsToSetCache[aTagMemberObject.getId()]&&(aTagMemberObject.makeAdmin(),statusChanged=!0),statusChanged&&(serializedMemberAdminsToStatusChange.push(aTagMemberObject.serialize()),membersAdminToUpdateOnSuccess.push(aTagMemberObject))):(serializedMemberAdminsToRemove.push(aTagMemberObject.serialize()),membersAdminToRemoveOnSuccess.push(aTagMemberObject)));return angular.forEach(memberUIdsToSet,function(aMemberUId){oldMembersUIdCache[aMemberUId]||aMemberUId===currentUser.getKey()||(aNewMember=userFactory.getUser(aMemberUId),newTagMemberObject=tagChatFactory.createNewTagMember(oldTagObj.getTagId(),{userId:aMemberUId,addedBy:currentUser.getKey(),fullName:aNewMember.getName(),status:TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER},!0),membersAdminToAddOnSuccess.push(newTagMemberObject),serializedNewMemberAdminsToAdd.push(newTagMemberObject.serialize()))}),angular.forEach(adminUIdsToSet,function(anAdminUId){oldMembersUIdCache[anAdminUId]||anAdminUId===currentUser.getKey()||(aNewAdmin=userFactory.getUser(anAdminUId),newTagAdminObject=tagChatFactory.createNewTagMember(oldTagObj.getTagId(),{userId:anAdminUId,addedBy:currentUser.getKey(),fullName:aNewAdmin.getName(),status:TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN},!0),membersAdminToAddOnSuccess.push(newTagAdminObject),serializedNewMemberAdminsToAdd.push(newTagAdminObject.serialize()))}),{serializedMemberAdminsToRemove:serializedMemberAdminsToRemove,serializedMemberAdminsToStatusChange:serializedMemberAdminsToStatusChange,serializedNewMemberAdminsToAdd:serializedNewMemberAdminsToAdd,membersAdminToAddOnSuccess:membersAdminToAddOnSuccess,membersAdminToRemoveOnSuccess:membersAdminToRemoveOnSuccess,membersAdminToUpdateOnSuccess:membersAdminToUpdateOnSuccess}}function __hasTagUpdated(oldTagObj,newTagName,newPictureFileName,serializedNewMemberAdminsToAdd,serializedMemberAdminsToRemove,serializedMemberAdminsToStatusChange){return serializedNewMemberAdminsToAdd.length>0||serializedMemberAdminsToRemove.length>0||serializedMemberAdminsToStatusChange.length>0||oldTagObj.getTagName()!==newTagName||oldTagObj.getPictureUrl()!==newPictureFileName}function __addNewMembers(oldTagObj,serializedNewMemberAdminsToAdd,membersAdminToAddOnSuccess){var addTagMembersInAuthFailed,serializedNewMemberAdminsUserIds,addTagMemberInChatServerChatSocketCallPacketId,addTagMemberInChatServerChatSocketCallSuccessStatus,tagMemberAddConfirmation,currentUser=Auth.currentUser(),deferred=$q.defer();if(serializedNewMemberAdminsToAdd.length>0){addTagMembersInAuthFailed=!1,serializedNewMemberAdminsUserIds=serializedNewMemberAdminsToAdd.keyValues("userId"),tagChatApiService.addTagMembersInAuth(oldTagObj,serializedNewMemberAdminsUserIds).then(function(response){RingLogger.print(response,"tagchat-update-auth-result",RingLogger.tags.TAG_CHAT)},function(response){RingLogger.alert(response,"tagchat-update-auth-result-failed",RingLogger.tags.TAG_CHAT),deferred.reject({sucs:!1,mg:"Auth Update Failed"}),addTagMembersInAuthFailed=!0}),addTagMemberInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),addTagMemberInChatServerChatSocketCallSuccessStatus=!1;var serverCurrentTime=chatUtilsFactory.getChatServerCurrentTime();callXTimeAfterYIntervalStopOnSuccess(function(){if(!addTagMemberInChatServerChatSocketCallSuccessStatus){var isRegisterRequired=_registerTag(oldTagObj.getTagId(),TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),doAddTagMemberInChatServerChatSocketCall=function(){tagChatApiService.addTagMemberInChatServer(currentUser.getKey(),oldTagObj,serializedNewMemberAdminsToAdd,addTagMemberInChatServerChatSocketCallPacketId)};_executeAfterTagRegisterEvent(oldTagObj.getTagId(),doAddTagMemberInChatServerChatSocketCall,null,!isRegisterRequired)}},function(currentExecutionCount){return RingLogger.print("Retry Count",currentExecutionCount,"update-tag-tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT),addTagMembersInAuthFailed?(deferred.reject({sucs:!1,mg:"Failed to send tag new member add packet to auth server."}),!0):(tagMemberAddConfirmation=hasReceivedConfirmation(addTagMemberInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD),tagMemberAddConfirmation&&!addTagMemberInChatServerChatSocketCallSuccessStatus&&(addTagMemberInChatServerChatSocketCallSuccessStatus=!0,angular.forEach(membersAdminToAddOnSuccess,function(aMemberToAdd){oldTagObj.addMember(aMemberToAdd)}),oldTagObj.setMembersCount(oldTagObj.getMembersCount()+membersAdminToAddOnSuccess.length),tagChatUI.showTagMembersAddStatusMessage(oldTagObj.getTagId(),currentUser.getKey(),serializedNewMemberAdminsToAdd,serverCurrentTime,addTagMemberInChatServerChatSocketCallPacketId),deferred.resolve({sucs:!0,mg:"Member( "+membersAdminToAddOnSuccess.length+" ) Added in "+oldTagObj.getTagName()})),tagMemberAddConfirmation)},function(){deferred.reject({sucs:!1,mg:"Unable to send tag new member add packet to chat server."}),RingLogger.alert("Unable to send tag new member add packet to chat server",oldTagObj.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)}else deferred.resolve({sucs:!1});return deferred.promise}function __removeOldMembers(oldTagObj,serializedMemberAdminsToRemove,membersAdminToRemoveOnSuccess){var removeTagMemberInChatServerChatSocketCallPacketId,removeTagMemberInChatServerChatSocketCallSuccessStatus,currentUser=Auth.currentUser(),deferred=$q.defer();if(serializedMemberAdminsToRemove.length>0){removeTagMemberInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),removeTagMemberInChatServerChatSocketCallSuccessStatus=!1;var serverCurrentTime=chatUtilsFactory.getChatServerCurrentTime();callXTimeAfterYIntervalStopOnSuccess(function(){if(!removeTagMemberInChatServerChatSocketCallSuccessStatus){var isRegisterRequired=_registerTag(oldTagObj.getTagId(),TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),doRemoveTagMembersInChatServerChatSocketCall=function(){tagChatApiService.removeTagMembersFromChatServer(currentUser.getKey(),oldTagObj,serializedMemberAdminsToRemove,removeTagMemberInChatServerChatSocketCallPacketId)};_executeAfterTagRegisterEvent(oldTagObj.getTagId(),doRemoveTagMembersInChatServerChatSocketCall,null,!isRegisterRequired)}},function(currentExecutionCount){RingLogger.print("Retry Count",currentExecutionCount,"update-tag-tag-chat-member-remove-in-chat-retry-count",RingLogger.tags.TAG_CHAT);var tagMemberRemoveConfirmation=hasReceivedConfirmation(removeTagMemberInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE);return tagMemberRemoveConfirmation&&!removeTagMemberInChatServerChatSocketCallSuccessStatus&&(removeTagMemberInChatServerChatSocketCallSuccessStatus=!0,angular.forEach(membersAdminToRemoveOnSuccess,function(aMemberToRemove){oldTagObj.removeMember(aMemberToRemove)}),oldTagObj.setMembersCount(oldTagObj.getMembersCount()-membersAdminToRemoveOnSuccess.length),tagChatUI.showTagMembersRemoveStatusMessage(oldTagObj.getTagId(),currentUser.getKey(),serializedMemberAdminsToRemove,serverCurrentTime,removeTagMemberInChatServerChatSocketCallPacketId),deferred.resolve({sucs:!0,mg:"Member( "+membersAdminToRemoveOnSuccess.length+" ) Removed from "+oldTagObj.getTagName()})),tagMemberRemoveConfirmation},function(){deferred.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."}),RingLogger.alert("Unable to send tag  member remove packet to chat server",oldTagObj.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)}else deferred.resolve({sucs:!1});return deferred.promise}function __changeMemberStatus(oldTagObj,serializedMemberAdminsToStatusChange,membersAdminToUpdateOnSuccess){var tagMemberStatusChangeInChatServerChatSocketCallPacketId,tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus,tagMemberStatusChangeInChatServerChatSocketCallConstructedRawPacketObject,currentUser=Auth.currentUser(),deferred=$q.defer(),serverCurrentTime=chatUtilsFactory.getChatServerCurrentTime();return serializedMemberAdminsToStatusChange.length>0?(tagMemberStatusChangeInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus=!1,tagMemberStatusChangeInChatServerChatSocketCallConstructedRawPacketObject={},callXTimeAfterYIntervalStopOnSuccess(function(){if(!tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus){var isRegisterRequired=_registerTag(oldTagObj.getTagId(),TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),doTagMembersStatusChangeInChatServerChatSocketCall=function(){tagMemberStatusChangeInChatServerChatSocketCallConstructedRawPacketObject=tagChatApiService.changeTagMemberStatusInChatServer(currentUser.getKey(),oldTagObj,serializedMemberAdminsToStatusChange,tagMemberStatusChangeInChatServerChatSocketCallPacketId)};_executeAfterTagRegisterEvent(oldTagObj.getTagId(),doTagMembersStatusChangeInChatServerChatSocketCall,null,!isRegisterRequired)}},function(currentExecutionCount){RingLogger.print("Retry Count",currentExecutionCount,"update-tag-tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT);var tagMemberStatusChangeConfirmation=hasReceivedConfirmation(tagMemberStatusChangeInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE);return tagMemberStatusChangeConfirmation&&!tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus&&(tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus=!0,angular.forEach(membersAdminToUpdateOnSuccess,function(aMemberToUpdate){oldTagObj.updateMember(aMemberToUpdate)}),tagChatUI.showMemberTypeChangeStatusMessage(oldTagObj.getTagId(),currentUser.getKey(),serializedMemberAdminsToStatusChange,serverCurrentTime,tagMemberStatusChangeInChatServerChatSocketCallPacketId),deferred.resolve({sucs:!0,mg:"Member( "+membersAdminToUpdateOnSuccess.length+" ) Status Updated for "+oldTagObj.getTagName()})),tagMemberStatusChangeConfirmation},function(){deferred.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."}),RingLogger.alert("Unable to send tag  member status change packet to chat server",oldTagObj.getTagId()," tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)):deferred.resolve({sucs:!1}),deferred.promise}function __updateTagInformation(oldTagObj,newTagName,newPictureFileName){var tagInfoChangeStatusMessageType,activityType,updateTagInfoTagNameInChatServerChatSocketCallPacketId,updateTagInfoTagNameInChatServerChatSocketCallSuccessStatus,updateTagInfoTagPictureUrlUpdatedInChatServerChatSocketCallPacketId,updateTagInfoTagPictureUrlInChatServerChatSocketCallSuccessStatus,currentUser=Auth.currentUser(),deferred=$q.defer(),oldTagName=oldTagObj.getTagName(),oldTagPictureUrl=oldTagObj.getPictureUrl(),tagNameUpdated=oldTagObj.getTagName()!==newTagName,tagPictureUrlUpdated=oldTagObj.getPictureUrl()!==newPictureFileName,tagInfoUpdateConstructedRawPacketObject={},tagInfoUpdated=tagNameUpdated||tagPictureUrlUpdated;return tagInfoUpdated?(tagInfoChangeStatusMessageType=tagChatUI.getTagInfoChangeStatusMessage(oldTagObj.getTagId(),{tagName:newTagName||"",tagPictureUrl:newPictureFileName||""}),tagNameUpdated&&(oldTagObj.setTagName(newTagName),activityType=TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_RENAME,updateTagInfoTagNameInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),updateTagInfoTagNameInChatServerChatSocketCallSuccessStatus=!1,callXTimeAfterYIntervalStopOnSuccess(function(){if(!updateTagInfoTagNameInChatServerChatSocketCallSuccessStatus){var isRegisterRequired=_registerTag(oldTagObj.getTagId(),TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),doUpdateTagInfo=function(){tagInfoUpdateConstructedRawPacketObject=tagChatApiService.sendTagInformationToChatServer(currentUser.getKey(),oldTagObj,activityType,updateTagInfoTagNameInChatServerChatSocketCallPacketId)};_executeAfterTagRegisterEvent(oldTagObj.getTagId(),doUpdateTagInfo,null,!isRegisterRequired)}},function(currentExecutionCount){RingLogger.print("Retry Count",currentExecutionCount,"update-tag-send-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT);var tagInfoTagNameSendConfirmation=hasReceivedConfirmation(updateTagInfoTagNameInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION);return tagInfoTagNameSendConfirmation&&!updateTagInfoTagNameInChatServerChatSocketCallSuccessStatus&&(updateTagInfoTagNameInChatServerChatSocketCallSuccessStatus=!0,tagChatUI.showTagInfoChangeStatusMessage(oldTagObj.getTagId(),currentUser.getKey(),{statusMessageType:tagInfoChangeStatusMessageType,tagName:newTagName}),deferred.resolve({sucs:!0,mg:"Updated Group Info of "+oldTagObj.getTagName()})),tagInfoTagNameSendConfirmation},function(){tagNameUpdated&&oldTagObj.setTagName(oldTagName),deferred.reject({sucs:!1,mg:"Unable to send tag info tag name change packet to chat server."}),RingLogger.alert("Unable to send tag  member info tag name change packet to chat server",oldTagObj.getTagId()," update-tag-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)),tagPictureUrlUpdated&&(oldTagObj.setPictureUrl(newPictureFileName),activityType=TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_URL_RENAME,updateTagInfoTagPictureUrlUpdatedInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),updateTagInfoTagPictureUrlInChatServerChatSocketCallSuccessStatus=!1,callXTimeAfterYIntervalStopOnSuccess(function(){if(!updateTagInfoTagPictureUrlInChatServerChatSocketCallSuccessStatus){var isRegisterRequired=_registerTag(oldTagObj.getTagId(),TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),doUpdateTagInfo=function(){tagInfoUpdateConstructedRawPacketObject=tagChatApiService.sendTagInformationToChatServer(currentUser.getKey(),oldTagObj,activityType,updateTagInfoTagPictureUrlUpdatedInChatServerChatSocketCallPacketId)};_executeAfterTagRegisterEvent(oldTagObj.getTagId(),doUpdateTagInfo,null,!isRegisterRequired)}},function(currentExecutionCount){RingLogger.print("Retry Count",currentExecutionCount,"update-tag-send-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT);var tagInfoTagPictureUrlSendConfirmation=hasReceivedConfirmation(updateTagInfoTagNameInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION);return tagInfoTagPictureUrlSendConfirmation&&!updateTagInfoTagPictureUrlInChatServerChatSocketCallSuccessStatus&&(updateTagInfoTagPictureUrlInChatServerChatSocketCallSuccessStatus=!0,tagChatUI.showTagInfoChangeStatusMessage(oldTagObj.getTagId(),currentUser.getKey(),{statusMessageType:tagInfoChangeStatusMessageType,tagName:newTagName}),deferred.resolve({sucs:!0,mg:"Updated Group Info of "+oldTagObj.getTagName()})),tagInfoTagPictureUrlSendConfirmation},function(){tagPictureUrlUpdated&&oldTagObj.setPictureUrl(oldTagPictureUrl),deferred.reject({sucs:!1,mg:"Unable to send tag info tag picture url packet to chat server."}),RingLogger.alert("Unable to send tag info tag picture url packet to chat server",oldTagObj.getTagId()," update-tag-tag-chat-info-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY))):deferred.resolve({sucs:!1}),deferred.promise}function _updateTag(oldTagObj,newTagName,newPictureFileName,memberUIdsToSet,adminUIdsToSet){function doUpdate(){__addNewMembers(oldTagObj,serializedNewMemberAdminsToAdd,membersAdminToAddOnSuccess).then(function(response){response.sucs&&(successCount++,deferred.notify(response))},deferred.reject),__removeOldMembers(oldTagObj,serializedMemberAdminsToRemove,membersAdminToRemoveOnSuccess).then(function(response){response.sucs&&(successCount++,deferred.notify(response))},deferred.reject),__changeMemberStatus(oldTagObj,serializedMemberAdminsToStatusChange,membersAdminToUpdateOnSuccess).then(function(response){response.sucs&&(successCount++,deferred.notify(response))},deferred.reject),__updateTagInformation(oldTagObj,newTagName,newPictureFileName).then(function(response){response.sucs&&(successCount++,deferred.notify(response))},deferred.reject)}var membersForCRUD,serializedNewMemberAdminsToAdd,membersAdminToAddOnSuccess,serializedMemberAdminsToRemove,membersAdminToRemoveOnSuccess,serializedMemberAdminsToStatusChange,membersAdminToUpdateOnSuccess,deferred=(Auth.currentUser(),$q.defer());membersForCRUD=__getMembersForCRUD(oldTagObj,memberUIdsToSet,adminUIdsToSet),serializedNewMemberAdminsToAdd=membersForCRUD.serializedNewMemberAdminsToAdd,membersAdminToAddOnSuccess=membersForCRUD.membersAdminToAddOnSuccess,serializedMemberAdminsToRemove=membersForCRUD.serializedMemberAdminsToRemove,membersAdminToRemoveOnSuccess=membersForCRUD.membersAdminToRemoveOnSuccess,serializedMemberAdminsToStatusChange=membersForCRUD.serializedMemberAdminsToStatusChange,membersAdminToUpdateOnSuccess=membersForCRUD.membersAdminToUpdateOnSuccess;var needRegistering=!1;__hasTagUpdated(oldTagObj,newTagName,newPictureFileName,serializedNewMemberAdminsToAdd,serializedMemberAdminsToRemove,serializedMemberAdminsToStatusChange)?needRegistering=_registerTag(oldTagObj.getTagId(),TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER):deferred.resolve({sucs:!1});var successCount=0;return needRegistering?_executeAfterTagRegisterEvent(oldTagObj.getTagId(),function(){doUpdate()},!needRegistering):doUpdate(),setTimeout(function(){successCount?deferred.resolve({sucs:!0}):deferred.reject({sucs:!1})},18e3),deferred.promise}function _leaveFromTag(tagId){var tagObject=tagChatFactory.getTag(tagId),currentOwner=tagObject.getMember(Auth.currentUser().getKey());return _removeTagMember(tagId,[currentOwner.serialize()],[currentOwner])}function _removeTagMember(tagId,tagMemberUserIdsToRemove,membersAdminToRemoveOnSuccess){var currentUser=Auth.currentUser(),deferred=$q.defer(),tagObject=tagChatFactory.getTag(tagId),isSuccess=!1,doRemove=function(){var removeTagMemberInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),removeTagMemberInChatServerChatSocketCallSuccessStatus=!1;callXTimeAfterYIntervalStopOnSuccess(function(){tagObject=tagChatFactory.getTag(tagId);var doRemoveTagMembersInChatServerChatSocketCall=function(){tagChatApiService.removeTagMembersFromChatServer(currentUser.getKey(),tagObject,tagMemberUserIdsToRemove,removeTagMemberInChatServerChatSocketCallPacketId)};doRemoveTagMembersInChatServerChatSocketCall()},function(currentExecutionCount){RingLogger.print("Retry Count",currentExecutionCount,"leave-tag-tag-chat-member-remove-in-chat-retry-count",RingLogger.tags.TAG_CHAT);var tagMemberRemoveConfirmation=hasReceivedConfirmation(removeTagMemberInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE);if(tagMemberRemoveConfirmation&&!removeTagMemberInChatServerChatSocketCallSuccessStatus){removeTagMemberInChatServerChatSocketCallSuccessStatus=!0,tagObject=tagChatFactory.getTag(tagId);for(var statusMsg="Member( "+membersAdminToRemoveOnSuccess.length+" ) Removed from "+tagObject.getTagName(),index=0;index<membersAdminToRemoveOnSuccess.length;index++){var aMemberToRemove=membersAdminToRemoveOnSuccess[index];aMemberToRemove.getId()===currentUser.getKey()&&(statusMsg="You left from ("+tagObject.getTagName()+") conversation ",deferred.resolve({sucs:!0,mg:statusMsg})),tagObject.removeMember(aMemberToRemove)}deferred.resolve({sucs:!0,mg:statusMsg})}return tagMemberRemoveConfirmation},function(){deferred.reject({sucs:!1,mg:"Unable to send tag member remove packet to chat server."}),RingLogger.alert("Unable to send tag  member remove packet to chat server",tagObject.getTagId()," tag-chat-new-member-add-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)},needRegistering=_registerTag(tagId,TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER);return needRegistering?_executeAfterTagRegisterEvent(tagId,function(){doRemove()},!needRegistering):doRemove(),setTimeout(function(){isSuccess?deferred.resolve({sucs:!0}):deferred.reject({sucs:!1})},25e3),deferred.promise}function _changeTagMemberStatus(tagId,serializedStatusToChangeMembers,membersAdminToUpdateOnSuccess){var currentUser=Auth.currentUser(),deferred=$q.defer(),tagObject=tagChatFactory.getTag(tagId),isSuccess=!1,needRegistering=_registerTag(tagId,TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER),doChangeMembershipStatus=function(){var tagMemberStatusChangeInChatServerChatSocketCallPacketId=tagChatFactory.getUUIDPacketId(),tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus=!1;callXTimeAfterYIntervalStopOnSuccess(function(){var doTagMembersStatusChangeInChatServerChatSocketCall=function(){tagChatApiService.changeTagMemberStatusInChatServer(currentUser.getKey(),tagObject,serializedStatusToChangeMembers,tagMemberStatusChangeInChatServerChatSocketCallPacketId)};doTagMembersStatusChangeInChatServerChatSocketCall()},function(currentExecutionCount){RingLogger.print("Retry Count",currentExecutionCount,"tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT);var tagMemberStatusChangeConfirmation=hasReceivedConfirmation(tagMemberStatusChangeInChatServerChatSocketCallPacketId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE);return tagMemberStatusChangeConfirmation&&!tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus&&(tagMemberStatusChangeInChatServerChatSocketCallSuccessStatus=!0,angular.forEach(membersAdminToUpdateOnSuccess,function(aMemberToUpdate){tagObject.updateMember(aMemberToUpdate)}),deferred.resolve({sucs:!0,mg:"Member( "+serializedStatusToChangeMembers.length+" ) Status Updated for "+tagObject.getTagName()})),tagMemberStatusChangeConfirmation},function(){deferred.reject({sucs:!1,mg:"Unable to send tag member status change packet to chat server."}),RingLogger.alert("Unable to send tag  member status change packet to chat server",tagObject.getTagId()," tag-chat-member-status-change-in-chat-retry-count",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)};return needRegistering?_executeAfterTagRegisterEvent(tagId,function(){doChangeMembershipStatus()},!needRegistering):doChangeMembershipStatus(),setTimeout(function(){
isSuccess?deferred.resolve({sucs:!0}):deferred.reject({sucs:!1})},25e3),deferred.promise}function _initTagIdleInterval(tagId,tagObject){var tagIdleIntervalId,currentUser=Auth.currentUser();tagObject||(tagObject=tagChatFactory.getTag(tagId)),tagIdleIntervalId=tagChatFactory.getIdleIntervalIdByTagId(tagId),tagIdleIntervalId&&(clearInterval(tagIdleIntervalId),tagChatFactory.resetIdleIntervalIdByTagId(tagId),RingLogger.print("Net Tag Idle Interval Init, Clearing Old Interval",tagId,RingLogger.tags.TAG_CHAT)),tagChatFactory.setIdleIntervalIdByTagId(tagId,tagIdleIntervalId),tagIdleIntervalId=setInterval(function(){var currentTime=Math.floor(Date.now()/1e3),diff=currentTime-tagObject.getLastCommunicationTime();diff<TAG_CHAT_GENERAL_CONSTANTS.BOX_WAITING_TIME?tagChatApiService.sendTagIdlePacket(currentUser.getKey(),tagObject):(clearInterval(tagIdleIntervalId),tagChatFactory.resetIdleIntervalIdByTagId(tagId),RingLogger.print("Tag Idle Interval Cleared",tagId))},TAG_CHAT_GENERAL_CONSTANTS.UDP_SERVER_KEEP_ALIVE_INTERVAL)}function _requestForTagInformationMultipleTimes(tagId){var returnPromise,tagInfoWithMemberGetPacketId,defer=$q.defer(),currentUser=Auth.currentUser(),requestCacheKey=tagId+"-"+OFFLINE_PACKET_TYPE.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS;return returnPromise=defer.promise,tagChatFactory.isInRequestCacheForChat(requestCacheKey)&&(returnPromise={sucs:!1,timeout:!1}),tagChatFactory.setInTagChatRequestCache(requestCacheKey,{}),tagInfoWithMemberGetPacketId=tagChatFactory.getUUIDPacketId(),callXTimeAfterYIntervalStopOnSuccess(function(){tagChatApiService.getTagInformationWithMemberFromOfflineServer(currentUser.getKey(),tagId,tagInfoWithMemberGetPacketId)},function(){var tagInfoWithMemberReceived=hasReceivedConfirmation(tagInfoWithMemberGetPacketId,OFFLINE_PACKET_TYPE.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS),tagObject=tagChatFactory.getTag(tagId);return tagObject.membersLength()?(tagInfoWithMemberReceived&&defer.resolve({sucs:!0,timeout:!1}),tagInfoWithMemberReceived):(tagChatFactory.resetFromTagChatResponseCache(tagInfoWithMemberGetPacketId,OFFLINE_PACKET_TYPE.OFFLINE_TAG_INFORMATION_WITH_MEMBERS),!1)},function(){defer.resolve({sucs:!1,timeout:!0}),RingLogger.print("Failed to get tag information for tag id",tagId,RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY),$q.when(returnPromise)}function _sendTagMessageDeliveryPacketMultipleTimes(tagId,packetId,tagMessageModelObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey();callXTimeAfterYIntervalStopOnSuccess(function(){var tagObject=tagChatFactory.getTag(tagId);tagChatApiService.sendTagMsgDeliveredPacket(currentUserId,tagObject,tagMessageModelObject)},function(currentExecutionCount){var success=hasReceivedConfirmation(packetId,TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED);return success},function(){},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT-2,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)}function _sendFriendMessageDeliveryPacketMultipleTimes(friendId,chatBox,packetId){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey();callXTimeAfterYIntervalStopOnSuccess(function(){tagChatApiService.sendFriendChatDeliveryPacket(chatBox,currentUserId,friendId,packetId)},function(currentExecutionCount){var success=hasReceivedConfirmation(packetId,FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED);return success},function(){},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT-2,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)}function _executeAfterX(func,wait,immidiate){immidiate?func.call():setTimeout(func,wait)}function _executeXTimesAfterY(func,wait,immidiate,noOfTimes){var intervalRef,count=0;noOfTimes||(noOfTimes=TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT),immidiate&&(func.call(),count=1),intervalRef=setInterval(function(){count++,func.call(),count===noOfTimes&&clearInterval(intervalRef)},wait)}function _openPreviouslyOpenedBoxes(tagId){callXTimeAfterYIntervalStopOnSuccess(function(){var tagObject=tagChatFactory.getTag(tagId);if(tagObject&&tagObject.isTagSafeToShow()){var tagChatBox=ChatFactory.getBoxByUId(tagId);_openTagChatBoxIfClosed(tagId,tagChatBox)}},function(iterationCount){var tagObject=tagChatFactory.getTag(tagId);return!(!tagObject||!tagObject.isTagSafeToShow())},function(){},5,5e3)}function _openTagChatBoxIfClosed(tagId,box){var shouldLoadHistory=!1;if(!box){shouldLoadHistory=!0;var tagObject=tagChatFactory.getOrCreateTag(tagId);if(tagObject.isTagSafeToShow()){ChatFactory.openTagChatBox(tagId),box=ChatFactory.getBoxByUId(tagId);var users=tagObject.getMemberUserIds();tagChatFactory.isTagRegistered(tagId)?(box.setIp(tagObject.getChatIp()),box.setRPort(tagObject.getChatRegisterPort()),box.setPort(tagObject.getChatBindingPort()),box.setTitle(tagObject.getTagName())):tagChatApiService.createOrGetTagFromAuth(tagObject,users||[]).then(function(response){var tagObject=tagChatFactory.getTag(response.tid);tagObject.setChatIp(response.chIp),tagObject.setChatRegisterPort(response.chRp),box.setIp(response.chIp),box.setRPort(response.chRp)})}else box=ChatFactory.creatNonDomBox(tagId,!0),box.setIp(tagObject.getChatIp()),box.setRPort(tagObject.getChatRegisterPort()),box.setPort(tagObject.getChatBindingPort()),box.setTitle(tagObject.getTagName())}return shouldLoadHistory&&box.loadHistoryMessages(),box}function _sendTemporaryStoredMessages(tagId,chatBox){var doSendTemporaryStoredMesssage=(Auth.currentUser(),function(){for(chatBox||(chatBox=ChatFactory.getBoxByUId(tagId));angular.isArray(chatBox.tempMessageArray)&&chatBox.tempMessageArray.length>0;){var individualMsgObject=chatBox.tempMessageArray.shift();individualMsgObject.ip=chatBox.getIp(),individualMsgObject.port=chatBox.getPort()}});setTimeout(doSendTemporaryStoredMesssage,1e3)}function _sendTagIdlePacket(tagId){var tagObject=tagChatFactory.getTag(tagId);tagObject&&tagChatApiService.sendTagIdlePacket(Auth.currentUser().getKey(),tagObject)}var callXTimeAfterYIntervalStopOnSuccess=utilsFactory.callXTimeAfterYIntervalStopOnSuccess,hasReceivedConfirmation=tagChatFactory.hasReceivedConfirmation,_executeAfterTagRegisterEvent=tagChatHelper.executeAfterTagRegisterEvent,ChatPacketSender=chatPacketResender.ChatPacketSender;return utilsFactory.onCustomEvent("tagChatNoIpOrPort",function(data){_registerTag(data.tagId,TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.ONLY_REGISTER)}),utilsFactory.onCustomEvent("RE_REGISTER_TAG",function(data){tagChatFactory.unRegisterTag(data.tagId),_registerTag(data.tagId,TAG_CHAT_GENERAL_CONSTANTS.REGISTRATION_TYPES.CHAT_INVITE)}),{createTag:_createTag,updateTag:_updateTag,leaveFromTag:_leaveFromTag,removeTagMember:_removeTagMember,changeTagMemberStatus:_changeTagMemberStatus,subscribeForAuthUpdate:_subscribeForAuthUpdate,doOnTagChatRequestStartResponse:_doOnTagChatRequestStartResponse,registerTag:_registerTag,initTagIdleInterval:_initTagIdleInterval,openTagChatBoxIfClosed:_openTagChatBoxIfClosed,openPreviouslyOpenedBoxes:_openPreviouslyOpenedBoxes,requestForTagInformationMultipleTimes:_requestForTagInformationMultipleTimes,sendTagMessageDeliveryPacketMultipleTimes:_sendTagMessageDeliveryPacketMultipleTimes,sendFriendMessageDeliveryPacketMultipleTimes:_sendFriendMessageDeliveryPacketMultipleTimes,sendTemporaryStoredMessages:_sendTemporaryStoredMessages,sendTagIdlePacket:_sendTagIdlePacket,requestForIp:_requestForIp,getIpPortForTag:_getIpPortForTag,executeXTimesAfterY:_executeXTimesAfterY,executeAfterX:_executeAfterX}}angular.module("ringid.tagchat").factory("tagChatManager",tagChatManager),tagChatManager.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatApiService","tagChatPacketProcessor","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","utilsFactory","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","TAG_CHAT_LANG","AUTH_SERVER_ACTIONS","OFFLINE_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE","chatPacketResender","chatUtilsFactory"]}(),function(){"use strict";function tagOfflineChatManager($$connector,$q,$timeout,Auth,tagChatFactory,tagChatApiService,tagChatPacketProcessor,tagChatUI,tagChatHelper,ChatFactory,chatHistoryFactory,userFactory,utilsFactory,profileFactory,tagChatStorage,OPERATION_TYPES,Ringalert,TAG_CHAT_GENERAL_CONSTANTS,TAG_CHAT_PACKET_TYPE,TAG_CHAT_LANG,AUTH_SERVER_ACTIONS,CHAT_GLOBAL_VALUES,OFFLINE_PACKET_TYPE,chatPacketResender,chatUtilsFactory){var callXTimeAfterYIntervalStopOnSuccess=utilsFactory.callXTimeAfterYIntervalStopOnSuccess,hasReceivedConfirmation=tagChatFactory.hasReceivedConfirmation,ChatPacketResender=(tagChatHelper.executeAfterTagRegisterEvent,chatPacketResender.ChatPacketResender),ChatPacketSender=chatPacketResender.ChatPacketSender,_checkAndStopIfDuplicateRequest=function(tagId,requestPacketType){var requestCacheKey=tagId+"-"+requestPacketType;return tagChatFactory.isInRequestCacheForChat(requestCacheKey)?!0:(tagChatFactory.setInTagChatRequestCache(requestCacheKey,{}),!1)},_getUnreadMessagesMultipleTimes=function(){var currentUser=Auth.currentUser(),requestPacketType=OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST,offlineUpdateTime=CHAT_GLOBAL_VALUES.offlineUpdateTime;if(_checkAndStopIfDuplicateRequest(0,requestPacketType))return void RingLogger.information("Frequent Offline Get Request Rejected ",RingLogger.tags.TAG_CHAT);var requestServerTime=chatUtilsFactory.getChatServerCurrentTime(),tagOfflineUnreadMessagesGetPacketId=tagChatFactory.getUUIDPacketId();callXTimeAfterYIntervalStopOnSuccess(function(){tagChatApiService.sendOfflineGetRequest(currentUser.getKey(),offlineUpdateTime,tagOfflineUnreadMessagesGetPacketId)},function(){var offlineConfirmationReceived=hasReceivedConfirmation(tagOfflineUnreadMessagesGetPacketId,OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST);return offlineConfirmationReceived&&(CHAT_GLOBAL_VALUES.offlineUpdateTime=requestServerTime),offlineConfirmationReceived},function(){RingLogger.information("Failed to get unread messages",RingLogger.tags.TAG_CHAT)},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)},_getHistoryMessagesMultipleTimes=function(tagId,pageDirection,packetId,limit){var defer=$q.defer(),returnPromise=defer.promise,limit=limit||10,currentUser=Auth.currentUser(),requestPacketType=OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST,duplicateCheckPacketId=tagId;packetId&&(duplicateCheckPacketId+="-"+packetId),_checkAndStopIfDuplicateRequest(duplicateCheckPacketId,requestPacketType)&&(RingLogger.information("Frequent History Get Request Rejected for Tag ",tagId,RingLogger.tags.TAG_CHAT),returnPromise={sucs:!1});var tagHistoryMessagesGetPacketId=packetId||tagChatFactory.getUUIDPacketId();return callXTimeAfterYIntervalStopOnSuccess(function(){tagChatApiService.sendHistoryMessageGetRequest(currentUser.getKey(),tagId,pageDirection,tagHistoryMessagesGetPacketId,limit)},function(){var historyGetConfirmationReceived=hasReceivedConfirmation(tagHistoryMessagesGetPacketId,OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST);return historyGetConfirmationReceived&&defer.resolve({sucs:!0}),historyGetConfirmationReceived},function(){RingLogger.information("Failed to get tag history messages for tag id",tagId,RingLogger.tags.TAG_CHAT),defer.reject({sucs:!1})},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY),$q.when(returnPromise)},_getFriendHistoryMessagesMultipleTimes=function(friendId,pageDirection,packetId,limit){var defer=$q.defer(),returnPromise=defer.promise,limit=limit||10,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),requestPacketType=OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_REQUEST,duplicateCheckPacketId=friendId;packetId&&(duplicateCheckPacketId+="-"+packetId),_checkAndStopIfDuplicateRequest(duplicateCheckPacketId,requestPacketType)&&(RingLogger.debug("Frequent History Get Request Rejected for Friend ",friendId,RingLogger.tags.TAG_CHAT),returnPromise={sucs:!1});var friendHistoryMessagesGetPacketId=packetId||tagChatFactory.getUUIDPacketId(),friendHistoryMessageRequestObject=tagChatApiService.getFriendHistoryMessageGetRequestObject(currentUserId,friendId,pageDirection,friendHistoryMessagesGetPacketId,limit),chatPacketResender=new ChatPacketResender;return chatPacketResender.setPacketType(requestPacketType),chatPacketResender.setPacketId(friendHistoryMessagesGetPacketId),chatPacketResender.setPacketObject(friendHistoryMessageRequestObject),chatPacketResender.on("success",function(response){defer.resolve(response)}),chatPacketResender.on("failure",function(response){defer.reject(response)}),chatPacketResender.start(),$q.when(returnPromise)},_sendTagUnreadMessageConfirmation=function(userId,messagePacketIds){var packetId=tagChatFactory.getUUIDPacketId(),requestObject=tagChatApiService.getTagUnreadMessageConfirmationObject(userId,packetId,messagePacketIds);try{var aChatSender=new ChatPacketSender;aChatSender.setPacketObject(requestObject),aChatSender.setBrokenPacketType(requestObject.packetType),aChatSender.setIgnoreConfirmation(!0),aChatSender.getInstance().start()}catch(e){RingLogger.alert("Tag Unread Message Confirmation  Exception ",e,RingLogger.tags.TAG_CHAT)}},sendFriendUnreadMessageOfflineConfirmation=function(userId,packetId,messagePacketIds){var requestObject=tagChatApiService.getFriendUnreadMessageConfirmationObject(userId,packetId,messagePacketIds);try{var aChatSender=new ChatPacketSender;aChatSender.setPacketObject(requestObject),aChatSender.setBrokenPacketType(requestObject.packetType),aChatSender.setIgnoreConfirmation(!0),aChatSender.getInstance().start()}catch(e){RingLogger.alert("Friend Unread Message Offline Confiramtion Exception ",e,RingLogger.tags.TAG_CHAT)}},getHistoryRequestMethodByBox=function(chatBox){var historyRequestMethod;return historyRequestMethod=chatBox.isTagChat?_getHistoryMessagesMultipleTimes:_getFriendHistoryMessagesMultipleTimes};return{getUnreadMessagesMultipleTimes:_getUnreadMessagesMultipleTimes,getHistoryMessagesMultipleTimes:_getHistoryMessagesMultipleTimes,getFriendHistoryMessagesMultipleTimes:_getFriendHistoryMessagesMultipleTimes,getHistoryRequestMethodByBox:getHistoryRequestMethodByBox,sendTagUnreadMessageConfirmation:_sendTagUnreadMessageConfirmation,sendFriendUnreadMessageOfflineConfirmation:sendFriendUnreadMessageOfflineConfirmation}}angular.module("ringid.tagchat").factory("tagOfflineChatManager",tagOfflineChatManager),tagOfflineChatManager.$inject=["$$connector","$q","$timeout","Auth","tagChatFactory","tagChatApiService","tagChatPacketProcessor","tagChatUI","tagChatHelper","ChatFactory","chatHistoryFactory","userFactory","utilsFactory","profileFactory","tagChatStorage","OPERATION_TYPES","Ringalert","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_PACKET_TYPE","TAG_CHAT_LANG","AUTH_SERVER_ACTIONS","CHAT_GLOBAL_VALUES","OFFLINE_PACKET_TYPE","chatPacketResender","chatUtilsFactory"]}(),function(){"use strict";function tagChatSubscriber(SystemEvents,ChatFactory,profileFactory,PacketDataParse,utilsFactory,$timeout,Auth,chatHistoryFactory,TAG_CHAT_PACKET_TYPE,TAG_CHAT_GENERAL_CONSTANTS,tagChatPacketProcessor,tagChatFactory,tagChatApiService,tagChatManager,tagChatUI,tagChatHelper,CHAT_GLOBAL_VALUES,AUTH_SERVER_ACTIONS,FRIEND_CHAT_PACKET_TYPE,OFFLINE_PACKET_TYPE,ChatHelper,tagOfflineChatManager,ChatApiService,ChatPacketSenderService,chatUtilsFactory,ChatSeenSend,CHAT_GENERAL_CONSTANTS,chatTabSync){function safeExecute(func){try{func.call()}catch(e){RingLogger.alert(e.stack,"tag-chat-safe-execute",RingLogger.tags.TAG_CHAT)}}function getPacketProcessorInfo(packetType){return packetProcessorMap[packetType]}function _checkForDuplicatePacket(parsedPacketObject){var oldParsedObject=tagChatFactory.getFromTagChatResponseCache(parsedPacketObject);return oldParsedObject?!0:(tagChatFactory.setInTagChatResponseCache(parsedPacketObject.packetId,parsedPacketObject),!1)}function _processPacketData(packet){return _processUpdates(null,{byteData:packet})}function __logReceivedPacketInfo(packetType,packetObject){var packetName=tagChatPacketProcessor.getPacketName(packetType);RingLogger.information(packetName,packetObject,RingLogger.tags.TAG_CHAT_RESPONSE)}function _processUpdates(event,dataObj){var byteData=dataObj.byteData,packetType=PacketDataParse.getPacketType(byteData),packetProcessorInfo=getPacketProcessorInfo(packetType);if(!packetProcessorInfo)return RingLogger.warning("Packet Processor Not Implemented. Packet Type ",packetType,RingLogger.tags.TAG_CHAT),!1;var parsedPacketObject=tagChatPacketProcessor.parseRawPacket(byteData);return DEBUG&&LOG_DUPLICATE&&__logReceivedPacketInfo(packetType,parsedPacketObject),!tagChatFactory.startProcessingRequest||!parsedPacketObject||parsedPacketObject.packetId&&_checkForDuplicatePacket(parsedPacketObject)?void 0:(safeExecute(function(){DEBUG&&!LOG_DUPLICATE&&__logReceivedPacketInfo(packetType,parsedPacketObject),packetProcessorInfo.processor.call(this,parsedPacketObject)}),packetProcessorInfo.scopeUpdate)}function _processFriendChatNewMessage(parsedPacketObject){if(parsedPacketObject.fromHistory||!chatHistoryFactory.isInLocalStorageChatMsgMap(parsedPacketObject.packetId)){var scrollType,packetId=(parsedPacketObject.friendId,parsedPacketObject.packetId),userId=parsedPacketObject.userId,boxId=parsedPacketObject.boxId,sendConfirmation=!parsedPacketObject.fromHistory,currentUserId=Auth.currentUser().getKey();boxId||(boxId=parsedPacketObject.userId),boxId==currentUserId&&(boxId=parsedPacketObject.friendId,sendConfirmation=!1);var chatBox=ChatFactory.getBoxByUId(boxId);if(parsedPacketObject.fromHistory||parsedPacketObject.messageType!==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.DELETE_MESSAGE)parsedPacketObject.messageType>TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE&&(chatBox?parsedPacketObject.fromHistory||(chatBox.nonDomBox=!0):(ChatFactory.openChatBox(boxId),ChatApiService.requestForIp(boxId),ChatHelper.loadHistoryMessageForF2FChat(boxId,chatBox)),chatBox=ChatFactory.getBoxByUId(boxId),safeExecute(function(){chatBox.setFriendTypingBool(!1),parsedPacketObject.fromHistory?parsedPacketObject.seenSent=!0:scrollType="bottom",parsedPacketObject.fromHistory&&parsedPacketObject.fromOffline||(__updateLastCommunicationTime(userId,chatBox),chatBox&&!chatBox.isFocused?(parsedPacketObject.status="Unread",scrollType="unread"):parsedPacketObject.status=parsedPacketObject.status||"Received"),parsedPacketObject.tag_chat=!1;var friendId=chatBox.getKey();if("Edited"==parsedPacketObject.status||!chatBox.isSamePacketId(packetId)){if(parsedPacketObject.user=profileFactory.getUserObjectByUId(userId),"Unread"==parsedPacketObject.status&&(ChatFactory.increaseUnreadMessageCount(boxId,parsedPacketObject.packetId),chatBox.updateUnreadCount()),chatBox.pushMessage(parsedPacketObject,chatBox.getKey()),sendConfirmation&&(tagChatManager.sendFriendMessageDeliveryPacketMultipleTimes(friendId,chatBox,packetId),chatBox.isFocused)){var filteredMessages=[{key:parsedPacketObject.packetId,value:chatBox.getMessage(parsedPacketObject.packetId)}];ChatSeenSend.sendSeenPacket(chatBox,filteredMessages),utilsFactory.triggerCustomEvent("WAS_FOCUSED",{box:chatBox,filteredMessages:filteredMessages})}chatHistoryFactory.updateBox(chatBox)}parsedPacketObject.fromHistory||utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_RECEIVED,{boxId:boxId,scroll:scrollType})}));else if(parsedPacketObject.userId==currentUserId)chatBox&&chatBox.removeMessage(packetId),chatHistoryFactory.removeMessage(packetId,boxId);else{var msgObj;msgObj=chatBox?chatBox.getMessage(packetId):chatHistoryFactory.getMessage(boxId,packetId),msgObj&&(msgObj.text="This message has been deleted",msgObj.status="Deleted",chatHistoryFactory.updateMessage(msgObj,boxId))}}}function _processFriendChatEditMessage(parsedPacketObject){RingLogger.print("friend chat : new friend edit msg received ",parsedPacketObject,RingLogger.tags.TAG_CHAT),parsedPacketObject.status="Edited",_processFriendChatNewMessage(parsedPacketObject)}function _processFriendBrokenPacketChatMessage(parsedPacketObject){var genericSequenceNo=parsedPacketObject.sequenceNo,key=parsedPacketObject.packetId+"_"+genericSequenceNo;if(!brokenPacketMap[key]){brokenPacketMap[key]=parsedPacketObject,__hasReceivedAllBrokenPacket(parsedPacketObject.packetId,parsedPacketObject.packetsLength)&&safeExecute(function(){var combinedParsedPacketObject=__getCombinedParsedPacketFromTextBrokenPacket(parsedPacketObject.packetId,parsedPacketObject.packetsLength);combinedParsedPacketObject.originPacketType?_processFriendChatEditMessage(combinedParsedPacketObject):(combinedParsedPacketObject.originPacketType=FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG,_processFriendChatNewMessage(combinedParsedPacketObject)),__clearBrokenPacketsMap(parsedPacketObject.packetId,parsedPacketObject.packetsLength)});var packetId=key,currentUserId=Auth.currentUser().getKey(),friendId=parsedPacketObject.userId,chatBox=ChatFactory.getBoxByUId(friendId);chatBox?tagChatApiService.sendFriendChatDeliveryPacket(chatBox,currentUserId,friendId,packetId):(ChatApiService.requestForIp(friendId),ChatHelper.executeAfterRegisterEvent(friendId,function(){var chatBox=ChatFactory.getBoxByUId(friendId);tagChatApiService.sendFriendChatDeliveryPacket(chatBox,currentUserId,friendId,packetId)}))}}function _processFriendEditBrokenPacketChatMessage(parsedPacketObject){parsedPacketObject.originPacketType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT,_processFriendBrokenPacketChatMessage(parsedPacketObject)}function _processFriendChatSeenConfirmation(parsedPacketObject){}function _processTagRegister(parsedPacketObject){}function _processTagUnRegister(parsedPacketObject){}function _processTagRegisterConfirmation(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;CHAT_GLOBAL_VALUES.serverTimeDiff=parsedPacketObject.serverDate-Date.now();var tagObject=tagChatFactory.getOrCreateTag(tagId);if(tagObject){if(tagObject.setChatBindingPort(parsedPacketObject.chatBindingPort),tagChatFactory.markTagAsRegistered(tagObject.getTagId()),tagChatFactory.isTagChatInitiator(tagId)){var tagMessageObject=tagChatHelper.getTagEmptyMessageObject(tagId);tagChatApiService.sendTagMsgInChatServer(currentUserId,tagObject,tagMessageObject,!0)}var chatBox=__getChatBox(tagId,tagObject);chatBox.setPort(parsedPacketObject.chatBindingPort),__updateLastCommunicationTime(tagId,chatBox,tagObject),ChatHelper.sendAfterRegisterIdlePacket(tagId,chatBox),ChatPacketSenderService.sendTemporaryMessages(chatBox),utilsFactory.triggerCustomEvent("taglistupdated")}else RingLogger.error("Invalid Tag Register Confirmation Info",parsedPacketObject,RingLogger.tags.TAG_CHAT)}function _processTagCreate(parsedPacketObject){var aNewTag,chatBox,currentUser=Auth.currentUser(),tagId=(currentUser.getKey(),parsedPacketObject.tagId),chatBox=__getChatBox(tagId,aNewTag);parsedPacketObject.fromHistory||parsedPacketObject.fromOffline||(aNewTag=tagChatFactory.createNewTag(parsedPacketObject),tagChatFactory.addTagObject(aNewTag),__updateLastCommunicationTime(tagId,chatBox,aNewTag),tagChatFactory.addTagObject(aNewTag),parsedPacketObject.tagMembers.length>0&&__addMembersToTagObject(aNewTag,parsedPacketObject.tagMembers,parsedPacketObject.userId)),chatBox.updateBoxMessageMinMaxPacketId(parsedPacketObject),utilsFactory.triggerCustomEvent("taglistupdated")}function _processTagCreateConfirmation(parsedPacketObject){}function _processTagInformation(parsedPacketObject){var packetId,oldTagObject,aNewTag,chatBox,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;if(packetId=parsedPacketObject.packetId,oldTagObject=tagChatFactory.getTag(tagId),oldTagObject?(tagChatUI.showTagInfoChangeStatusMessage(tagId,parsedPacketObject.userId,parsedPacketObject),parsedPacketObject.fromHistory||(aNewTag=tagChatFactory.updateTag(tagId,parsedPacketObject,oldTagObject))):parsedPacketObject.fromHistory||(aNewTag=tagChatFactory.createNewTag(parsedPacketObject),tagChatFactory.addTagObject(aNewTag)),!parsedPacketObject.fromHistory&&!parsedPacketObject.fromOffline){var chatBox=__getChatBox(tagId,aNewTag);__updateLastCommunicationTime(tagId,chatBox,aNewTag),tagChatApiService.sendTagInformationConfirmation(currentUserId,aNewTag,packetId)}utilsFactory.triggerCustomEvent("taglistupdated")}function _processTagInformationConfirmation(parsedPacketObject){}function _processTagMemberAddUpdate(parsedPacketObject){var tagObject,chatBox,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;tagObject=tagChatFactory.getOrCreateTag(tagId),tagChatUI.showTagMembersAddStatusMessage(tagId,parsedPacketObject.userId,parsedPacketObject.tagMembers,parsedPacketObject.messageDate,parsedPacketObject.packetId,tagObject),tagObject&&!parsedPacketObject.fromHistory&&(__addMembersToTagObject(tagObject,parsedPacketObject.tagMembers,parsedPacketObject.userId),chatBox=__getChatBox(tagId,tagObject),__updateLastCommunicationTime(tagId,chatBox,tagObject),tagChatApiService.sendTagMemberAddConfirmation(currentUserId,tagObject,parsedPacketObject.packetId))}function _processTagMemberAddConfirmation(parsedPacketObject){}function _processTagMemberRemoveLeave(parsedPacketObject){if(parsedPacketObject.tagMembers){var chatBox,packetId,tagObject,currentUserRemoved,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;packetId=parsedPacketObject.packetId,delete parsedPacketObject.packetId,tagObject=tagChatFactory.getOrCreateTag(parsedPacketObject.tagId),tagChatUI.showTagMembersRemoveStatusMessage(parsedPacketObject.tagId,parsedPacketObject.userId,parsedPacketObject.tagMembers,parsedPacketObject.messageDate,packetId,tagObject),parsedPacketObject.fromHistory||(currentUserRemoved=__removeMembersFromTagObject(tagObject,parsedPacketObject.tagMembers),currentUserRemoved&&__doAfterCurrentUserRemovedFromTag(tagId),chatBox=__getChatBox(tagId,tagObject),__updateLastCommunicationTime(tagId,chatBox,tagObject),tagChatApiService.sendTagChatMemberRemoveLeaveConfirmation(currentUserId,tagObject,packetId))}}function _processTagMemberRemoveLeaveConfirmation(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;parsedPacketObject.userId===currentUserId&&tagChatFactory.unRegisterTag(tagId)}function _processTagMemberStatusChange(parsedPacketObject){if(parsedPacketObject.tagMembers){var chatBox,tagObject,currentUser=Auth.currentUser(),tagId=(currentUser.getKey(),parsedPacketObject.tagId);tagObject=tagChatFactory.getOrCreateTag(tagId),tagChatUI.showMemberTypeChangeStatusMessage(tagId,parsedPacketObject.userId,parsedPacketObject.tagMembers,parsedPacketObject.messageDate,parsedPacketObject.packetId),parsedPacketObject.fromHistory||(__updateMemberStatusInTagObject(tagObject,parsedPacketObject.tagMembers),chatBox=__getChatBox(tagId,tagObject),__updateLastCommunicationTime(tagId,chatBox,tagObject)),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_RECEIVED,{boxId:tagId})}}function _processTagMemberStatusChangeConfirmation(parsedPacketObject){}function _processTagChatIdleUpdate(parsedPacketObject){}function _processTagChatTypingUpdate(parsedPacketObject){var chatBox,tagObject,tagId=parsedPacketObject.tagId;tagObject=tagChatFactory.getTag(tagId),safeExecute(function(){tagObject&&(chatBox=__getChatBox(tagId,tagObject),chatBox&&(__updateLastCommunicationTime(tagId,chatBox,tagObject),chatBox.setFriendTypingBool(!0),$timeout(function(){chatBox.setFriendTypingBool(!1)},3e3),chatHistoryFactory.updateBox(chatBox),utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_RECEIVED,{boxId:tagId})))})}function _processTagChatNewMessage(parsedPacketObject){if(parsedPacketObject.fromHistory||!chatHistoryFactory.isInLocalStorageChatMsgMap(parsedPacketObject.packetId)){var tagId=parsedPacketObject.tagId,tagObject=tagChatFactory.getTag(tagId);tagObject||(tagChatManager.requestForTagInformationMultipleTimes(tagId),tagObject=tagChatFactory.getOrCreateTag(tagId));var scrollType,chatBox=ChatFactory.getBoxByUId(tagId);if(parsedPacketObject.messageType===TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.DELETE_MESSAGE){if(parsedPacketObject.userId==Auth.currentUser().getKey())chatBox&&chatBox.removeMessage(parsedPacketObject.packetId),chatHistoryFactory.removeMessage(parsedPacketObject.packetId,tagId);else{var msgObj;msgObj=chatBox?chatBox.getMessage(parsedPacketObject.packetId):chatHistoryFactory.getMessage(tagId,parsedPacketObject.packetId),msgObj&&(msgObj.text="This message has been deleted",msgObj.status="Deleted",chatHistoryFactory.updateMessage(msgObj,tagId))}chatBox&&chatBox.removeMessage(parsedPacketObject.packetId),chatHistoryFactory.removeMessage(parsedPacketObject.packetId,parsedPacketObject.tagId)}else parsedPacketObject.fromHistory||parsedPacketObject.fromUnread||!parsedPacketObject.fromOffline||parsedPacketObject.messageType!==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE||tagChatFactory.isTagRegistered(parsedPacketObject.tagId)||!tagChatHelper.hasChatSession(parsedPacketObject.messageDate)?parsedPacketObject.messageType>TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE&&(chatBox=tagChatManager.openTagChatBoxIfClosed(parsedPacketObject.tagId,chatBox),safeExecute(function(){parsedPacketObject.fromHistory||(scrollType="bottom"),parsedPacketObject.fromHistory&&parsedPacketObject.fromOffline||(chatBox&&!chatBox.isFocused?(parsedPacketObject.status="Unread",scrollType="unread"):parsedPacketObject.status=parsedPacketObject.status||"Received"),parsedPacketObject.tag_chat=!0;var tagId=chatBox.getKey();if(!chatBox.isSamePacketId(parsedPacketObject.packetId)){parsedPacketObject.user=profileFactory.getUserObjectByUId(parsedPacketObject.userId),!parsedPacketObject.fromHistory&&tagObject&&tagObject.isTagSafeToShow()&&(chatBox.nonDomBox=!0,__updateLastCommunicationTime(tagId,chatBox));var tagMessageModelObject=tagChatFactory.getOrCreateMessage(parsedPacketObject.tagId,parsedPacketObject);if(tagMessageModelObject.setStatus(parsedPacketObject.status),parsedPacketObject.fromHistory?parsedPacketObject.seenSent=!0:"Unread"==tagMessageModelObject.getStatus()&&(ChatFactory.increaseUnreadMessageCount(tagId,parsedPacketObject.packetId),chatBox.updateUnreadCount()),chatBox.pushMessage(parsedPacketObject,chatBox.getKey()),!parsedPacketObject.fromOffline){var packetId=parsedPacketObject.packetId;tagChatManager.sendTagMessageDeliveryPacketMultipleTimes(parsedPacketObject.tagId,packetId,tagMessageModelObject)}utilsFactory.triggerCustomEvent(SystemEvents.CHAT.MESSAGE_RECEIVED,{boxId:tagId,scroll:scrollType}),chatHistoryFactory.updateBox(chatBox)}})):tagChatManager.requestForTagInformationMultipleTimes(parsedPacketObject.tagId)}}function _processTagChatEditMessage(parsedPacketObject){RingLogger.print("tag chat : new tag edit msg received ",parsedPacketObject,RingLogger.tags.TAG_CHAT),parsedPacketObject.status="Edited",_processTagChatNewMessage(parsedPacketObject)}function _processTagBrokenPacketChatMessage(parsedPacketObject){var genericSequenceNo=parsedPacketObject.sequenceNo,key=parsedPacketObject.packetId+"_"+genericSequenceNo;brokenPacketMap[key]||(brokenPacketMap[key]=parsedPacketObject,__hasReceivedAllBrokenPacket(parsedPacketObject.packetId,parsedPacketObject.packetsLength)&&safeExecute(function(){var combinedParsedPacketObject=__getCombinedParsedPacketFromTextBrokenPacket(parsedPacketObject.packetId,parsedPacketObject.packetsLength);combinedParsedPacketObject.originPacketType?_processTagChatEditMessage(combinedParsedPacketObject):(combinedParsedPacketObject.originPacketType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG,_processTagChatNewMessage(combinedParsedPacketObject))}))}function _processTagEditBrokenPacketChatMessage(parsedPacketObject){parsedPacketObject.originPacketType=TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT,_processTagBrokenPacketChatMessage(parsedPacketObject)}function _processTagMultipleChatMessage(parsedPacketObject){}function _processTagChatDeliveredUpdate(parsedPacketObject){
var tagId=parsedPacketObject.tagId,tagObject=tagChatFactory.getTag(parsedPacketObject.tagId),chatBox=__getChatBox(tagId,tagObject);safeExecute(function(){__updateLastCommunicationTime(tagId,chatBox,tagObject);var boxMessageObject=chatBox.getMessage(parsedPacketObject.packetId);if(boxMessageObject&&("Seen"!==boxMessageObject.status&&(boxMessageObject.status="Delivered"),chatHistoryFactory.updateMessage(boxMessageObject,chatBox.getKey())),tagObject){var tagMessageObject=tagObject.getMessage(parsedPacketObject.packetId);tagMessageObject&&"Seen"!==tagMessageObject.getStatus()&&tagMessageObject.setStatus("Delivered")}chatHistoryFactory.updateBox(chatBox)})}function _processTagChatSentUpdate(parsedPacketObject){var tagObject,chatBox,tagId=parsedPacketObject.tagId;tagObject=tagChatFactory.getTag(tagId),chatBox=ChatFactory.getBoxByUId(tagId),safeExecute(function(){chatBox=__getChatBox(tagId,chatBox),__updateLastCommunicationTime(tagId,chatBox,tagObject);var boxMessageObject=chatBox.updateMessageStatus(parsedPacketObject.packetId,"Sent");if(boxMessageObject&&chatHistoryFactory.updateMessage(boxMessageObject,chatBox.getKey()),tagObject){var tagMessageObject=tagObject.getMessage(parsedPacketObject.packetId);tagMessageObject&&tagMessageObject.setStatus("Sent")}chatHistoryFactory.updateBox(chatBox)})}function _processTagChatSeenUpdate(parsedPacketObject){var tagObject,chatBox,tagId=parsedPacketObject.tagId;tagObject=tagChatFactory.getTag(tagId),chatBox=ChatFactory.getBoxByUId(tagId),safeExecute(function(){__updateLastCommunicationTime(tagId,chatBox,tagObject),chatBox=__getChatBox(tagId,chatBox);var boxMessageObject=chatBox.updateMessageStatus(parsedPacketObject.packetId,"Seen");if(boxMessageObject&&chatHistoryFactory.updateMessage(boxMessageObject,chatBox.getKey()),tagObject){var tagMessageObject=tagObject.getMessage(parsedPacketObject.packetId);tagMessageObject&&tagMessageObject.setStatus("Seen")}chatHistoryFactory.updateBox(chatBox)})}function _processTagChatSeenConfirmationUpdate(parsedPacketObject){}function _processTagChatMultipleDelete(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey();if(angular.isArray(parsedPacketObject.packets)){_doProcessTagChatMultipleDelete(parsedPacketObject.tagId,parsedPacketObject.userId,parsedPacketObject.packets);var tagObject=tagChatFactory.getTag(parsedPacketObject.tagId);tagObject&&tagChatApiService.sendTagChatMsgDeleteConfirmation(currentUserId,tagObject,parsedPacketObject.packetId,parsedPacketObject.userId)}}function _processTagChatMsgDeleteConfirmation(parsedPacketObject){var deleteRequestObject=tagChatFactory.getFromTagChatRequestCache(parsedPacketObject.packetId);deleteRequestObject&&_doProcessTagChatMultipleDelete(parsedPacketObject.tagId,parsedPacketObject.userId,deleteRequestObject.packets)}function _processTagBrokenPacket(parsedPacketObject){var isProcessed,chatBox,tagObject,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;isProcessed=_doProcessTagBrokenPacket(parsedPacketObject),isProcessed&&(tagObject=tagChatFactory.getTag(tagId),tagChatApiService.sendTagGeneralBrokenPacketConfirmation(currentUserId,tagObject,parsedPacketObject.packetId,parsedPacketObject.sequenceNo),chatBox=__getChatBox(tagId))}function _processTagBrokenConfirmationPacket(parsedPacketObject){}function _processOfflineGetRequestConfirmation(parsedPacketObject){}function _processOfflineFriendUnreadMessages(parsedPacketObject){for(var currentUser=Auth.currentUser(),boxIds={},currentUserId=currentUser.getKey(),packetId=parsedPacketObject.packetId,packetIds=[],index=0;index<parsedPacketObject.messages.length;index++){var anUnreadMessage=parsedPacketObject.messages[index];anUnreadMessage.fromOffline=!0,anUnreadMessage.status="Unread",_processFriendChatNewMessage(anUnreadMessage),boxIds[anUnreadMessage.userId]=!0,anUnreadMessage.messageType!=TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE&&packetIds.push(anUnreadMessage.packetId)}for(var boxIdList=Object.keys(boxIds),index=0,length=boxIdList.length;length>index;index++)utilsFactory.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:boxIdList[index]});packetIds.length>0&&tagOfflineChatManager.sendFriendUnreadMessageOfflineConfirmation(currentUserId,packetId,packetIds)}function _processFriendHistoryMessage(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),packetId=parsedPacketObject.packetId,friendId=parsedPacketObject.friendId,packetIds=[],chatBox=ChatFactory.getBoxByUId(friendId);if(chatBox||(chatBox=ChatFactory.creatNonDomBox(friendId)),parsedPacketObject.messages.length||parsedPacketObject.pageDirection==TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.DOWN){for(var preProcessMessageDate=chatUtilsFactory.getChatServerCurrentTime(),lowestMessageDate=preProcessMessageDate,processed=!1,index=0;index<parsedPacketObject.messages.length;index++){var aHistoryMessage=parsedPacketObject.messages[index];aHistoryMessage.messageType==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.HISTORY_RE_FETCH?_doRequestForHistoryMessage(friendId,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.UP,packetId):aHistoryMessage.messageType!=TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.DELETE_MESSAGE&&(processed=!0,aHistoryMessage.userId.toString()===currentUserId.toString()?(aHistoryMessage.status=_getMessageStatus(aHistoryMessage.status)||"Delivered",aHistoryMessage.friendId=friendId):(aHistoryMessage.status<TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_STATUS.SEEN?aHistoryMessage.status="Unread":aHistoryMessage.status="Received",aHistoryMessage.friendId=currentUserId),aHistoryMessage.boxId=friendId,aHistoryMessage.fromOffline=!0,aHistoryMessage.fromHistory=!0,_processFriendChatNewMessage(aHistoryMessage)),aHistoryMessage.messageDate<lowestMessageDate&&(lowestMessageDate=aHistoryMessage.messageDate),packetIds.push(aHistoryMessage.packetId)}if(processed)chatBox.hasHistoryMessage=!0,utilsFactory.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:friendId});else if(lowestMessageDate!=preProcessMessageDate){var newPacketId=tagChatFactory.getUUIDPacketId(lowestMessageDate,!0);_doRequestForHistoryMessage(friendId,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.UP,newPacketId)}}else chatBox.hasHistoryMessage=!1;tagChatApiService.sendFriendHistoryMessageOfflineConfirmation(currentUserId,friendId,packetId)}function _processGetFriendHistoryMessageConfirmation(parsedPacketObject){}function _processTagInformationOfflineActivity(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),packetId=parsedPacketObject.packetId,tagId=parsedPacketObject.tagId;if(parsedPacketObject.items.length>0)for(var index=0,length=parsedPacketObject.items.length;length>index;index++){var item=parsedPacketObject.items[index];_processAGroupActivity(tagId,packetId,item)}tagChatApiService.sendTagOfflineConfirmation(currentUserId,tagId,packetId)}function _processMyTagList(parsedPacketObject){for(var aTagObject,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),packetId=parsedPacketObject.packetId,index=0;index<parsedPacketObject.items.length;index++)aTagObject=tagChatFactory.createNewTag(parsedPacketObject.items[index]),tagChatFactory.addTagObject(aTagObject),setTimeout(function(tagId){tagChatManager.requestForTagInformationMultipleTimes(tagId).then(function(response){!response.sucs&&response.timeout&&tagChatManager.requestForTagInformationMultipleTimes(tagId)})}.bind(this,aTagObject.getTagId()),100);utilsFactory.triggerCustomEvent("MY_TAG_LIST_RECEIVED"),tagChatApiService.sendTagOfflineConfirmation(currentUserId,0,packetId)}function _processTagUnreadMessage(parsedPacketObject){for(var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),packetIds=(parsedPacketObject.packetId,[]),index=0;index<parsedPacketObject.messages.length;index++){var anUnreadMessage=parsedPacketObject.messages[index];anUnreadMessage.status="Unread",anUnreadMessage.fromUnread=!0,anUnreadMessage.fromOffline=!0,anUnreadMessage.messageType==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.GROUP_ACTIVITY?_processGroupActivityMessage(anUnreadMessage):_processTagChatNewMessage(anUnreadMessage),anUnreadMessage.messageType!=TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE&&packetIds.push(anUnreadMessage.packetId)}packetIds.length>0&&tagOfflineChatManager.sendTagUnreadMessageConfirmation(currentUserId,packetIds)}function _processTagUnreadMessageConfirmation(parsedPacketObject){}function _processTagHistoryMessageRequest(parsedPacketObject){}function _processTagHistoryMessage(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),packetId=parsedPacketObject.packetId,tagId=parsedPacketObject.tagId,packetIds=[],chatBox=__getChatBox(tagId);if(parsedPacketObject.messages.length||parsedPacketObject.pageDirection==TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.DOWN){for(var packetIds=[],preProcessMessageDate=chatUtilsFactory.getChatServerCurrentTime(),lowestMessageDate=preProcessMessageDate,processed=!1,index=0;index<parsedPacketObject.messages.length;index++){var aHistoryMessage=parsedPacketObject.messages[index];aHistoryMessage.tagId=tagId,aHistoryMessage.fromHistory=!0,aHistoryMessage.messageType==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.GROUP_ACTIVITY?(processed=!0,_processGroupActivityMessage(aHistoryMessage)):parsedPacketObject.messages.messageType==TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.HISTORY_RE_FETCH?_doRequestForHistoryMessage(tagId,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.UP,aHistoryMessage.packetId):aHistoryMessage.messageType!=TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.DELETE_MESSAGE&&(processed=!0,aHistoryMessage.userId===currentUserId?aHistoryMessage.status="Seen":aHistoryMessage.status="Received",aHistoryMessage.tagId=tagId,aHistoryMessage.fromOffline=!0,aHistoryMessage.fromHistory=!0,_processTagChatNewMessage(aHistoryMessage)),aHistoryMessage.messageDate<lowestMessageDate&&(lowestMessageDate=aHistoryMessage.messageDate),packetIds.push(aHistoryMessage.packetId)}if(processed)chatBox.hasHistoryMessage=!0,utilsFactory.triggerCustomEvent("NEW_MESSAGE_PUSHED",{boxId:tagId});else if(lowestMessageDate!=preProcessMessageDate){var newPacketId=tagChatFactory.getUUIDPacketId(lowestMessageDate,!0);_doRequestForHistoryMessage(tagId,TAG_CHAT_GENERAL_CONSTANTS.PAGE_DIRECTION.UP,newPacketId,!1)}}else chatBox.hasHistoryMessage=!1;tagChatApiService.sendTagOfflineConfirmation(currentUserId,tagId,packetId)}function _processGetTagInformationWithMember(parsedPacketObject){}function _processTagInformationWithMember(parsedPacketObject){var currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId,tagObject=tagChatFactory.getOrCreateTag(tagId,parsedPacketObject);__addMembersToTagObject(tagObject,parsedPacketObject.tagMembers);var chatBox=__getChatBox(tagId,tagObject);tagChatFactory.isTagRegistered(tagId)&&__updateLastCommunicationTime(tagId,chatBox,tagObject),tagChatApiService.sendTagOfflineConfirmation(currentUserId,tagId,parsedPacketObject.packetId),utilsFactory.triggerCustomEvent("taglistupdated")}function _processTagOfflineConfirmation(parsedPacketObject){}function _processOfflineBrokenHistoryPacket(parsedPacketObject){var isProcessed,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey();parsedPacketObject.fromOffline=!0,parsedPacketObject.fromHistory=!0,isProcessed=_doProcessTagBrokenPacket(parsedPacketObject),isProcessed&&tagChatApiService.sendOfflineBrokenPacketConfirmation(currentUserId,parsedPacketObject.packetId,parsedPacketObject.sequenceNo)}function _processOfflineBrokenPacket(parsedPacketObject){var isProcessed,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey();parsedPacketObject.tagId;parsedPacketObject.fromOffline=!0,isProcessed=_doProcessTagBrokenPacket(parsedPacketObject),isProcessed&&tagChatApiService.sendOfflineBrokenPacketConfirmation(currentUserId,parsedPacketObject.packetId,parsedPacketObject.sequenceNo)}function _processOfflineBrokenPacketConfirmation(parsedPacketObject){}function _processAGroupActivity(tagId,packetId,activityItem){if(activityItem.changedByUserId!=activityItem.userId||activityItem.status!=TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.OWNER)switch(activityItem.activityType){case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.DELETED:_processTagMemberRemoveLeave({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagMembers:[{userId:activityItem.userId}],fromHistory:activityItem.fromHistory});break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.ADDED:_processTagMemberAddUpdate({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagMembers:[{userId:activityItem.userId,status:activityItem.status,fullName:activityItem.activityValue}],fromHistory:activityItem.fromHistory});break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.LEAVE:_processTagMemberRemoveLeave({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagMembers:[{userId:activityItem.userId}],fromHistory:activityItem.fromHistory});break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_RENAME:_processTagInformation({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagName:activityItem.activityValue,fromHistory:activityItem.fromHistory});break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.MEMBER_TYPE_CHANGE:_processTagMemberStatusChange({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagMembers:[{userId:activityItem.userId,status:activityItem.status}],fromHistory:activityItem.fromHistory});break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:_processTagInformation({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagPictureUrl:activityItem.activityValue,fromHistory:activityItem.fromHistory});break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_CREATED:_processTagCreate({userId:activityItem.changedByUserId,packetId:packetId,tagId:tagId,messageDate:activityItem.activityDate,tagName:activityItem.activityValue,tagMembers:[],fromHistory:activityItem.fromHistory})}}function _processGroupActivityMessage(groupActivityMessage){RingLogger.information("GROUP ACTIVITY MSG",groupActivityMessage,RingLogger.tags.TAG_CHAT_RESPONSE);var message,activityType=groupActivityMessage.packetType,tagId=(groupActivityMessage.userId,groupActivityMessage.tagId),packetId=groupActivityMessage.packetId,activityDate=groupActivityMessage.messageDate;try{message=angular.fromJson(groupActivityMessage.message)}catch(e){return void RingLogger.alert("INVALID JSON IN GROUP ACTIVITY MESSAGE",groupActivityMessage.message,RingLogger.tags.TAG_CHAT)}var activityItem={changedByUserId:groupActivityMessage.userId,userId:message.mId,status:message.mT,activityValue:message.n,activityType:activityType,activityDate:activityDate,fromHistory:groupActivityMessage.fromHistory||!1};_processAGroupActivity(tagId,packetId,activityItem)}function _processTagChatMsgDelete(parsedPacketObject){var chatBox,tagObject,currentUser=Auth.currentUser(),currentUserId=currentUser.getKey(),tagId=parsedPacketObject.tagId;chatBox=ChatFactory.getBoxByUId(tagId),chatBox=__getChatBox(tagId),tagObject=tagChatFactory.getTag(parsedPacketObject.tagId),safeExecute(function(){if(tagChatFactory.isTagRegistered(tagId)&&__updateLastCommunicationTime(tagId,chatBox,tagObject),parsedPacketObject.userId===currentUserId)chatBox&&chatBox.removeMessage(parsedPacketObject.packetId),chatHistoryFactory.removeMessage(parsedPacketObject.packetId,parsedPacketObject.tagId);else{var boxMessageObject=chatBox.updateMessageStatus(parsedPacketObject.packetId,"Deleted");if(boxMessageObject&&(boxMessageObject.text="This message has been deleted",boxMessageObject.setTextPartition(),chatHistoryFactory.updateMessage(boxMessageObject,chatBox.getKey())),tagObject){var tagMessageObject=tagObject.getMessage(parsedPacketObject.packetId);tagMessageObject&&(tagMessageObject.setStatus("Deleted"),tagMessageObject.markAsDeleted())}}chatHistoryFactory.updateBox(chatBox)})}function _doProcessTagChatMultipleDelete(tagId,userId,packets){for(var singleTagChatMsgDeleteParam={tagId:tagId,userId:userId},index=0;index<packets.length;index++){var aPacket=packets[index];singleTagChatMsgDeleteParam.packetId=aPacket.packetId,_processTagChatMsgDelete(singleTagChatMsgDeleteParam)}}function _doProcessTagBrokenPacket(parsedPacketObject){var key=parsedPacketObject.packetId+"_"+parsedPacketObject.sequenceNo;if(brokenPacketMap[key])return RingLogger.info("Ignoring Duplicate Packets"),!1;if(brokenPacketMap[key]=parsedPacketObject.bytes,__hasReceivedAllBrokenPacket(parsedPacketObject.packetId,parsedPacketObject.packetsLength)){var brokenPacketParsedPacketObject=__mergeTagBrokenPacket(parsedPacketObject.packetId,parsedPacketObject.packetsLength);brokenPacketParsedPacketObject.fromOffline=parsedPacketObject.fromOffline||!1,brokenPacketParsedPacketObject.fromHistory=parsedPacketObject.fromHistory||!1;var packetProcessorInfo=getPacketProcessorInfo(brokenPacketParsedPacketObject.packetType);safeExecute(function(){__logReceivedPacketInfo(brokenPacketParsedPacketObject.packetType,brokenPacketParsedPacketObject),packetProcessorInfo.processor.call(this,brokenPacketParsedPacketObject),__clearBrokenPacketsMap(parsedPacketObject.packetId,parsedPacketObject.packetsLength)})}return!0}function _doRequestForHistoryMessage(tagOrFriendId,direction,packetId,forFriendChat){if(forFriendChat){var chatBox=__getChatBox(tagOrFriendId);tagOfflineChatManager.getFriendHistoryMessagesMultipleTimes(tagOrFriendId,direction,packetId).then(function(response){response.sucs&&(chatBox.historyLoading=!1)},function(){chatBox.historyLoading=!1})}else{var chatBox=__getFriendChatBox(tagOrFriendId);tagOfflineChatManager.getHistoryMessagesMultipleTimes(tagOrFriendId,direction,packetId).then(function(response){response.sucs&&(chatBox.historyLoading=!1)},function(){chatBox.historyLoading=!1})}}function _getMessageStatus(statusNo){var statusValue=TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_STATUS_VALUE[statusNo];return statusValue&&(statusValue=statusValue.charAt(0)+statusValue.substr(1).toLowerCase()),statusValue}function __getFriendChatBox(friendId){var chatBox=ChatFactory.getBoxByUId(friendId);return chatBox||(chatBox=ChatFactory.creatNonDomBox(friendId,!0),chatBox.loadHistoryMessages()),chatBox}function __getChatBox(tagId,tagObject){tagObject||(tagObject=tagChatFactory.getTag(tagId));var chatBox=ChatFactory.getBoxByUId(tagId);return chatBox||(chatBox=ChatFactory.creatNonDomBox(tagId,!0),!chatBox.getIp()&&tagObject&&tagObject.getChatIp()&&(chatBox.setIp(tagObject.getChatIp()),chatBox.setRPort(tagObject.getChatRegisterPort()),chatBox.setTitle(tagObject.getTagName())),chatBox.loadHistoryMessages()),chatBox}function __updateLastCommunicationTime(tagId,chatBox,tagObject){chatBox||(chatBox=__getChatBox(tagId)),chatBox.updateLastCommunicationTime(),tagObject||(tagObject=tagChatFactory.getTag(tagId)),tagChatFactory.updateTagRegisteredTime(tagId,chatBox.lastCommunicationTime)}function __addMembersToTagObject(aTag,members,addedByUserId){for(var tagMemberIndex=0;tagMemberIndex<members.length;tagMemberIndex++){var memberObject=members[tagMemberIndex];addedByUserId&&(memberObject.addedBy=addedByUserId);var tagMemberObject=tagChatFactory.createNewTagMember(aTag.getTagId(),memberObject,!0);tagMemberObject.isRemoved()||aTag.addMember(tagMemberObject)}}function __removeMembersFromTagObject(aTag,tagMembers){for(var hasCurrentUser=!1,index=0;index<tagMembers.length;index++){var tagMemberObject=aTag.getMember(tagMembers[index].userId);tagMemberObject&&(hasCurrentUser=tagMemberObject.isCurrentUser(),aTag.removeMember(tagMemberObject))}return hasCurrentUser}function __updateMemberStatusInTagObject(aTag,tagMembers){for(var index=0;index<tagMembers.length;index++){var aTagMember=tagMembers[index];if(aTag){var tagMemberObject=aTag.getMember(aTagMember.userId);tagMemberObject&&tagMemberObject.setStatus(aTagMember.status)}}}function __doAfterCurrentUserRemovedFromTag(tagId){var chatBox=ChatFactory.getBoxByUId(tagId);chatBox&&(ChatFactory.closeChatBox(chatBox.getKey()),chatHistoryFactory.removeOpenBox(chatBox.getKey())),tagChatFactory.unRegisterTag(tagId)}function __hasReceivedAllBrokenPacket(packetId,totalLength){for(var index=0;totalLength>index;index++){var keyIndex=packetId+"_"+index;if(!brokenPacketMap[keyIndex])return!1}return!0}function __getCombinedParsedPacketFromTextBrokenPacket(packetId,length){for(var combinedParsedPacketObject={},index=0;length>index;index++){var keyIndex=packetId+"_"+index,aChunkPacket=brokenPacketMap[keyIndex];0===index?combinedParsedPacketObject=aChunkPacket:combinedParsedPacketObject.message+=aChunkPacket.message}return combinedParsedPacketObject.messageLength=combinedParsedPacketObject.message.length,combinedParsedPacketObject}function __clearBrokenPacketsMap(packetId,length){for(var index=0;length>index;index++){var keyIndex=packetId+"_"+index;delete brokenPacketMap[keyIndex],RingLogger.debug("CLEARED KEY {0}".format(keyIndex),RingLogger.tags.CHAT_BROKEN_CACHE)}}function __mergeTagBrokenPacket(packetId,packetsLength){var index,totalPacketView,packetType,brokenPacketParsedPacketObject,dataviewArray=[];for(index=0;packetsLength>index;index++){var keyIndex=packetId+"_"+index;dataviewArray.push(brokenPacketMap[keyIndex])}return totalPacketView=dataviewArray.joinAsDataView(),packetType=totalPacketView.getIntByByte(0,1),RingLogger.print("Inside Broken Packet: Packet Type ",packetType,RingLogger.tags.TAG_CHAT),brokenPacketParsedPacketObject=tagChatPacketProcessor.parseRawPacket(totalPacketView.buffer),brokenPacketParsedPacketObject.fromBrokenPacket=!0,brokenPacketParsedPacketObject}var DEBUG=!0,LOG_DUPLICATE=!0,packetProcessorMap={},brokenPacketMap={};tagChatManager.initTagIdleInterval;return packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_REGISTER_CONFIRMATION]={processor:function(){},scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG]={processor:_processFriendChatNewMessage,scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG_EDIT]={processor:_processFriendChatEditMessage,scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG]={processor:_processFriendBrokenPacketChatMessage,scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG_EDIT]={processor:_processFriendEditBrokenPacketChatMessage,scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_DELIVERED]={processor:function(){},scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SENT]={processor:function(){},scopeUpdate:!0},packetProcessorMap[FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN_CONFIRMATION]={processor:_processFriendChatSeenConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER]={processor:_processTagRegister,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_UNREGISTER]={processor:_processTagUnRegister,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_REGISTER_CONFIRMATION]={processor:_processTagRegisterConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION]={processor:_processTagInformation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION_CONFIRMATION]={processor:_processTagInformationConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD]={processor:_processTagMemberAddUpdate,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_ADD_CONFIRMATION]={processor:_processTagMemberAddConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE]={processor:_processTagMemberRemoveLeave,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MEMBER_REMOVE_LEAVE_CONFIRMATION]={processor:_processTagMemberRemoveLeaveConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE]={processor:_processTagMemberStatusChange,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_MEMBER_TYPE_CHANGE_CONFIRMATION]={processor:_processTagMemberStatusChangeConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_IDLE]={processor:_processTagChatIdleUpdate,scopeUpdate:!1},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_TYPING]={processor:_processTagChatTypingUpdate,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG]={processor:_processTagChatNewMessage,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_EDIT]={processor:_processTagChatEditMessage,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG]={processor:_processTagBrokenPacketChatMessage,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT]={processor:_processTagEditBrokenPacketChatMessage,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MULTIPLE_MSG]={processor:_processTagMultipleChatMessage,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_DELIVERED]={processor:_processTagChatDeliveredUpdate,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT]={processor:_processTagChatSentUpdate,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN]={processor:_processTagChatSeenUpdate,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_SEEN_CONFIRMATION]={processor:_processTagChatSeenConfirmationUpdate,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MULTIPLE_MSG_DELETE]={processor:_processTagChatMultipleDelete,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_DELETE_CONFIRMATION]={processor:_processTagChatMsgDeleteConfirmation,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET]={processor:_processTagBrokenPacket,scopeUpdate:!0},packetProcessorMap[TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET_CONFIRMATION]={processor:_processTagBrokenConfirmationPacket,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_GET_REQUEST_CONFIRMATION]={processor:_processOfflineGetRequestConfirmation,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE]={processor:_processOfflineFriendUnreadMessages,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE]={processor:_processFriendHistoryMessage,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_HISTORY_MESSAGE_CONFIRMATION]={processor:_processGetFriendHistoryMessageConfirmation,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_INFORMATION_ACTIVITY]={processor:_processTagInformationOfflineActivity,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_MY_TAG_LIST]={processor:_processMyTagList,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE]={processor:_processTagUnreadMessage,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION]={processor:_processTagUnreadMessageConfirmation,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG]={processor:_processTagCreate,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CREATE_TAG_CONFIRMATION]={processor:_processTagCreateConfirmation,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE_REQUEST]={processor:_processTagHistoryMessageRequest,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_HISTORY_MESSAGE]={processor:_processTagHistoryMessage,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_GET_TAG_INFORMATION_WITH_MEMBERS]={processor:_processGetTagInformationWithMember,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_INFORMATION_WITH_MEMBERS]={processor:_processTagInformationWithMember,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_TAG_CONFIRMATION]={processor:_processTagOfflineConfirmation,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_HISTORY_PACKET]={processor:_processOfflineBrokenHistoryPacket,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET]={processor:_processOfflineBrokenPacket,scopeUpdate:!0},packetProcessorMap[OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET_CONFIRMATION]={processor:_processOfflineBrokenPacketConfirmation,scopeUpdate:!0},{processUpdates:_processUpdates,processPacketData:_processPacketData}}angular.module("ringid.tagchat").factory("tagChatSubscriber",tagChatSubscriber),tagChatSubscriber.$inject=["SystemEvents","ChatFactory","profileFactory","PacketDataParse","utilsFactory","$timeout","Auth","chatHistoryFactory","TAG_CHAT_PACKET_TYPE","TAG_CHAT_GENERAL_CONSTANTS","tagChatPacketProcessor","tagChatFactory","tagChatApiService","tagChatManager","tagChatUI","tagChatHelper","CHAT_GLOBAL_VALUES","AUTH_SERVER_ACTIONS","FRIEND_CHAT_PACKET_TYPE","OFFLINE_PACKET_TYPE","ChatHelper","tagOfflineChatManager","ChatApiService","ChatPacketSenderService","chatUtilsFactory","ChatSeenSend","CHAT_GENERAL_CONSTANTS","chatTabSync"]}(),function(){"use strict";function tagChatUI(ChatFactory,utilsFactory,chatHistoryFactory,TAG_CHAT_GENERAL_CONSTANTS,tagChatFactory,Ringalert){function __getMemberStatusValue(memberStatusString){var memberStatusValue;return memberStatusValue="admin"===memberStatusString?TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:"member"===memberStatusString?TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER}function __getTagMemberByStatusGroup(changedTagMembers){for(var statusChangeGroup={},index=0;index<changedTagMembers.length;index++){var statusValue,aTagMember=changedTagMembers[index];statusValue=angular.isString(aTagMember.status)?__getMemberStatusValue(aTagMember.status):aTagMember.status,statusChangeGroup[statusValue]||(statusChangeGroup[statusValue]=[]),statusChangeGroup[statusValue].push(aTagMember)}return statusChangeGroup}function _showMemberTypeChangeStatusMessage(tagId,userId,changedTagMembers,messageDate,packetId){var chatBox=ChatFactory.getBoxByUId(tagId),statusChangeGroup=__getTagMemberByStatusGroup(changedTagMembers),restInfo={};messageDate&&(packetId=tagChatFactory.getUUIDPacketId(messageDate,!0),restInfo.messageDate=messageDate);var packetIndex=1;for(var statusType in statusChangeGroup)if(statusChangeGroup.hasOwnProperty(statusType)){packetIndex||(packetId=packetId+"_"+packetIndex);var statusMessageType="";statusType=parseInt(statusType),statusMessageType=statusType===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN?TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:statusType===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER?TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER;var tagStatusMessage=tagChatFactory.createTagStatusMessage(packetId,tagId,userId,statusMessageType,statusChangeGroup[statusType],restInfo);if(!tagStatusMessage)continue;var serializedStatusMessageObject=tagStatusMessage.serialize();chatBox?chatBox.pushMessage(serializedStatusMessageObject,userId):chatHistoryFactory.addMessage(serializedStatusMessageObject,tagId)}}function _getTagInfoChangeStatusMessage(tagId,changedTagInfo,tagObject){tagObject||(tagObject=tagChatFactory.getTag(tagId));var tagStatusMessageType=0;return tagObject&&(changedTagInfo.tagName&&changedTagInfo.tagPictureUrl&&tagObject.getTagName()!==changedTagInfo.tagName&&tagObject.getPictureUrl()!==changedTagInfo.tagPictureUrl.trim()?tagStatusMessageType=TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:(changedTagInfo.tagName&&tagObject.getTagName()!==changedTagInfo.tagName&&(tagStatusMessageType=TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE),
changedTagInfo.tagPictureUrl&&tagObject.getPictureUrl()!==changedTagInfo.tagPictureUrl.trim()&&(tagStatusMessageType=TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE))),tagStatusMessageType}function _showTagInfoChangeStatusMessage(tagId,userId,changedTagInfo,packetId,tagObject){tagObject||(tagObject=tagChatFactory.getTag(tagId)),packetId||(packetId=tagChatFactory.getUUIDPacketId());var tagStatusMessageType=changedTagInfo.statusMessageType;if(tagStatusMessageType||(tagStatusMessageType=_getTagInfoChangeStatusMessage(tagId,changedTagInfo,tagObject)),changedTagInfo.messageDate&&(packetId=tagChatFactory.getUUIDPacketId(changedTagInfo.messageDate,!0)),0!==tagStatusMessageType){var chatBox=ChatFactory.getBoxByUId(tagId),tagStatusMessage=tagChatFactory.createTagStatusMessage(packetId,tagId,userId,tagStatusMessageType,[],changedTagInfo);if(!tagStatusMessage)return;var serializedStatusMessageObject=tagStatusMessage.serialize();chatBox?chatBox.pushMessage(serializedStatusMessageObject,userId):chatHistoryFactory.addMessage(serializedStatusMessageObject,tagId)}}function _showTagMembersAddStatusMessage(tagId,userId,changedMembers,messageDate,packetId,tagObject){tagObject||(tagObject=tagChatFactory.getTag(tagId));var chatBox=ChatFactory.getBoxByUId(tagId),changedMembersByStatus=__getTagMemberByStatusGroup(changedMembers),restInfo={};messageDate&&(restInfo.messageDate=messageDate);for(var statusType in changedMembersByStatus)if(changedMembersByStatus.hasOwnProperty(statusType)){var typePacketId=packetId+"_"+statusType,statusMessageType="";statusType=parseInt(statusType),statusType===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN?statusMessageType=TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:statusType===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER?statusMessageType=TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:statusType===TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.OWNER&&(statusMessageType=TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER);var tagStatusMessage=tagChatFactory.createTagStatusMessage(typePacketId,tagId,userId,statusMessageType,changedMembersByStatus[statusType],restInfo);if(!tagStatusMessage)continue;var serializedStatusMessageObject=tagStatusMessage.serialize();chatBox?chatBox.pushMessage(serializedStatusMessageObject,userId):chatHistoryFactory.addMessage(serializedStatusMessageObject,tagId)}}function _showTagMembersRemoveStatusMessage(tagId,userId,changedMembers,messageDate,packetId,tagObject){tagObject||(tagObject=tagChatFactory.getTag(tagId)),packetId||(packetId=tagChatFactory.getUUIDPacketId(messageDate,!0));for(var chatBox=ChatFactory.getBoxByUId(tagId),index=0;index<changedMembers.length;index++){var tagMember=tagObject.getMember(changedMembers[index].userId);tagMember&&(changedMembers[index].fullName=tagMember.getName())}var restInfo={};messageDate&&(restInfo.messageDate=messageDate,packetId=tagChatFactory.getUUIDPacketId(messageDate,!0));var tagStatusMessage=tagChatFactory.createTagStatusMessage(packetId,tagId,userId,TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE,changedMembers,restInfo);if(tagStatusMessage){var serializedStatusMessageObject=tagStatusMessage.serialize();chatBox?chatBox.pushMessage(serializedStatusMessageObject,userId):chatHistoryFactory.addMessage(serializedStatusMessageObject,tagId)}}return{getTagInfoChangeStatusMessage:_getTagInfoChangeStatusMessage,showTagInfoChangeStatusMessage:_showTagInfoChangeStatusMessage,showMemberTypeChangeStatusMessage:_showMemberTypeChangeStatusMessage,showTagMembersAddStatusMessage:_showTagMembersAddStatusMessage,showTagMembersRemoveStatusMessage:_showTagMembersRemoveStatusMessage}}angular.module("ringid.tagchat").factory("tagChatUI",tagChatUI),tagChatUI.$inject=["ChatFactory","utilsFactory","chatHistoryFactory","TAG_CHAT_GENERAL_CONSTANTS","tagChatFactory","Ringalert"]}(),function(){"use strict";function tagChatHelper(TAG_CHAT_GENERAL_CONSTANTS,TAG_CHAT_LANG,Auth,tagChatFactory,profileFactory,CHAT_GLOBAL_VALUES,Storage){function __getMemberType(statusType){var memberType;return statusType===TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD?memberType="member":statusType===TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD&&(memberType="admin"),memberType}function _getTagChatStatusMessage(chatMessageObject){var tagId,tagObject,isSelf,currentUser=Auth.currentUser(),statusMessage=(currentUser.getKey(),""),firstName=chatMessageObject.usersToChange[0],allNameJoined=chatMessageObject.usersToChange.slice(1).join(", "),totalMinusOne=chatMessageObject.usersToChange.length-1,senderFullName=chatMessageObject.fullName,groupNewName=chatMessageObject.tagName;if(tagId=chatMessageObject.tagId,tagObject=tagChatFactory.getOrCreateTag(tagId),isSelf=currentUser.getKey()===chatMessageObject.userId.toString(),!tagObject)return void RingLogger.warning("No Tag Found to Show Status Message",chatMessageObject,RingLogger.tags.TAG_CHAT);if(!senderFullName){var sendMemberObject=tagObject.getMember(chatMessageObject.userId);senderFullName=sendMemberObject?sendMemberObject.getName():chatMessageObject.userId}var langTemplateString,memberType,templateParams={},langTemplate=TAG_CHAT_LANG.STATUS_MESSAGES;switch(chatMessageObject.statusType){case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_ADD:case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_ADMIN_ADD:memberType=__getMemberType(chatMessageObject.statusType),templateParams.member_name=senderFullName,templateParams.new_member_name=firstName==currentUser.getName()?"you":firstName,templateParams.new_member_type=memberType,templateParams.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(allNameJoined,totalMinusOne),langTemplateString=isSelf?totalMinusOne?langTemplate.SELF_ADD_MULTIPLE_MEMBER:langTemplate.SELF_ADD_MEMBER:totalMinusOne?langTemplate.OTHER_ADD_MULTIPLE_MEMBER:langTemplate.OTHER_ADD_MEMBER;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_DELETE:templateParams.member_name=senderFullName,templateParams.old_member_name=firstName==currentUser.getName()?"you":firstName,templateParams.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(allNameJoined,totalMinusOne),langTemplateString=isSelf?totalMinusOne?langTemplate.SELF_REMOVE_MULTIPLE_MEMBER:firstName===senderFullName?langTemplate.SELF_LEAVE_GROUP:langTemplate.SELF_REMOVE_MEMBER:totalMinusOne?langTemplate.OTHER_REMOVE_MULTIPLE_MEMBER:firstName===senderFullName?langTemplate.OTHER_LEAVE_GROUP:langTemplate.OTHER_REMOVE_MEMBER;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_LEAVE:templateParams.member_name=senderFullName,langTemplateString=isSelf?langTemplate.SELF_LEAVE_GROUP:langTemplate.OTHER_LEAVE_GROUP;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_ADMIN:templateParams.member_name=senderFullName,templateParams.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(allNameJoined,totalMinusOne),firstName!==currentUser.getName()?templateParams.old_member_name=firstName:templateParams.old_member_name="you",langTemplateString=isSelf?totalMinusOne?langTemplate.SELF_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:langTemplate.SELF_MEMBER_CHANGE_TO_ADMIN:totalMinusOne?langTemplate.OTHER_MULTIPLE_MEMBER_CHANGE_TO_ADMIN:langTemplate.OTHER_MEMBER_CHANGE_TO_ADMIN;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_MEMBER:templateParams.admin_name=senderFullName,firstName!==currentUser.getName()?templateParams.old_admin_name=firstName:templateParams.old_admin_name="you",templateParams.rest_count="<a href='javascript:void(0);' title='{0}'>{1} others</a>".format(allNameJoined,totalMinusOne),langTemplateString=isSelf?totalMinusOne?langTemplate.SELF_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:firstName===senderFullName?langTemplate.SELF_REMOVED_FROM_ADMIN_BY_SELF:langTemplate.SELF_ADMIN_CHANGE_TO_MEMBER:totalMinusOne?langTemplate.OTHER_MULTIPLE_ADMIN_CHANGE_TO_MEMBER:firstName===senderFullName?langTemplate.OTHER_REMOVED_FROM_ADMIN_BY_SELF:langTemplate.OTHER_ADMIN_CHANGE_TO_MEMBER;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_MEMBER_STATUS_CHANGE_OWNER:templateParams.member_name=senderFullName,templateParams.admin_name=firstName,langTemplateString=firstName!==currentUser.getName()?langTemplate.OTHER_USER_ADDED_AS_OWNER:langTemplate.SELF_USER_ADDED_AS_OWNER;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_INFO_UPDATED:templateParams.member_name=senderFullName,templateParams.group_name=groupNewName,langTemplateString=isSelf?langTemplate.SELF_UPDATE_GROUP_INFO:langTemplate.OTHER_UPDATE_GROUP_INFO;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_NAME_CHANGE:templateParams.member_name=senderFullName,templateParams.group_name=groupNewName,langTemplateString=isSelf?langTemplate.SELF_RENAME_GROUP:langTemplate.OTHER_RENAME_GROUP;break;case TAG_CHAT_GENERAL_CONSTANTS.STATUS_MESSAGE_TYPES.TAG_PICTURE_CHANGE:templateParams.member_name=senderFullName,templateParams.group_name=groupNewName,langTemplateString=isSelf?langTemplate.SELF_CHANGE_GROUP_PIC:langTemplate.OTHER_CHANGE_GROUP_PIC}return langTemplateString&&(statusMessage=langTemplateString.supplant(templateParams)),statusMessage}function _getTagEmptyMessageObject(tagId){var currentUser=Auth.currentUser(),object=(currentUser.getKey(),{tagId:tagId,userId:currentUser.getKey(),fullName:currentUser.getName(),message:" ",messageDate:(new Date).getTime(),messageType:TAG_CHAT_GENERAL_CONSTANTS.MESSAGE_TYPES.BLANK_MESSAGE,packetId:tagChatFactory.getUUIDPacketId()}),tagMessageObject=tagChatFactory.createNewTagMessage(tagId,object);return tagMessageObject}function _getCurrentChatServerTime(){var chatServerTime=CHAT_GLOBAL_VALUES.serverTimeDiff,lcoalTimeInServerTime=(new Date).getTime()-chatServerTime;return lcoalTimeInServerTime}function _hasChatSession(serverReceivedTime){var serverTime=_getCurrentChatServerTime();return serverTime-serverReceivedTime<TAG_CHAT_GENERAL_CONSTANTS.ACTUAL_TAG_REGISTER_TIMEOUT}function _executeAfterTagRegisterEvent(tagId,func,args,immidiate){if(immidiate)func.call(null,args);else{var eventHandler=function(event){event.data.tagId.toString()===tagId.toString()&&(func.call(null,args),document.removeEventListener("tagregistered",eventHandler))};document.addEventListener("tagregistered",eventHandler)}}return{getTagChatStatusMessage:_getTagChatStatusMessage,getTagEmptyMessageObject:_getTagEmptyMessageObject,getCurrentChatServerTime:_getCurrentChatServerTime,hasChatSession:_hasChatSession,executeAfterTagRegisterEvent:_executeAfterTagRegisterEvent}}angular.module("ringid.tagchat").factory("tagChatHelper",tagChatHelper),tagChatHelper.$inject=["TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_LANG","Auth","tagChatFactory","profileFactory","CHAT_GLOBAL_VALUES","Storage"]}(),function(){"use strict";function tagChatPacketProcessor(TAG_CHAT_PACKET_ATTRIBUTE_INFO,TAG_CHAT_PACKET_INFO,CHAT_PACKET_FORMAT,TAG_CHAT_PACKET_TYPE,TAG_CHAT_PACKET_ATTRIBUTE,TAG_CHAT_GENERAL_CONSTANTS,OFFLINE_PACKET_TYPE,FRIEND_CHAT_PACKET_TYPE){function isTagPacket(packetType){return!!TAG_CHAT_PACKET_INFO[packetType]}function getPacketFormat(packetType){return TAG_CHAT_PACKET_INFO[packetType].FORMAT}function getPacketName(packetType){return TAG_CHAT_PACKET_INFO[packetType].PACKET_NAME}function getAttributeSize(attributeNo){return TAG_CHAT_PACKET_ATTRIBUTE_INFO[attributeNo].SIZE}function getRawAttributeSize(packetLength,offset){return packetLength-offset}function getRawAttributeSizeFromObject(object,attributeNo){var rawAttributeName=getAttributeName(attributeNo);return object[rawAttributeName].byteLength}function getAttributeName(attributeNo){return TAG_CHAT_PACKET_ATTRIBUTE_INFO[attributeNo].VAR_NAME}function getAttributeType(attributeNo){return TAG_CHAT_PACKET_ATTRIBUTE_INFO[attributeNo].VAR_TYPE}function isConditionalAttribute(attributeNo){return TAG_CHAT_PACKET_ATTRIBUTE_INFO[attributeNo].CONDITIONAL}function getSubObjectContainerName(attributeNo){try{return TAG_CHAT_PACKET_ATTRIBUTE_INFO[attributeNo].VAR_CONTAINER_NAME}catch(e){return RingLogger.warning("invalid `attribute no` for `container name` or `container name` not defined for `attribute no` : ",attributeNo),-1}}function getAttributeValue(object,attributeNo){try{var variableName=TAG_CHAT_PACKET_ATTRIBUTE_INFO[attributeNo].VAR_NAME;if(~variableName.indexOf("Length")){var VariableNameWithoutLength=variableName.replace("Length","");return object[variableName]||object[VariableNameWithoutLength].length}return object[variableName]}catch(e){return RingLogger.warning("object attribute no not defined : ",attributeNo),""}}function getDynamicAttributeSize(object,attributeName){try{return object[attributeName+"Length"]}catch(e){return RingLogger.warning("object[attribute_name + Length] not set",attributeName),-1}}function isDynamicAttribute(attributeNo){return getAttributeSize(attributeNo)==TAG_CHAT_GENERAL_CONSTANTS.PACKET_DYNAMIC_ATTRIBUTE}function isRawByteAttribute(attributeNo){return getAttributeSize(attributeNo)==TAG_CHAT_GENERAL_CONSTANTS.PACKET_RAW_BYTE_ATTRIBUTE}function getIpPortSize(){return TAG_CHAT_GENERAL_CONSTANTS.PACKET_IP_SIZE+TAG_CHAT_GENERAL_CONSTANTS.PACKET_PORT_SIZE}function getDateViewPacket(packetSize){return new DataView(new ArrayBuffer(packetSize))}function getDataViewByPacket(packet){return new DataView(packet)}function getPacketSize(object,packetType,packetFormat){for(var packetSize=0,packetFormatLength=packetFormat.length,lastAttributeValue=-1,packetFormatIndex=0;packetFormatLength>packetFormatIndex;packetFormatIndex++){var anAttributeNoOrSubFormat=packetFormat[packetFormatIndex];if(angular.isArray(anAttributeNoOrSubFormat)){var noOfSubFormatPacket=lastAttributeValue;if(noOfSubFormatPacket>0)for(var previousAttributeNo=packetFormat[packetFormatIndex-1],subObjectContainerName=getSubObjectContainerName(previousAttributeNo),subObjects=object[subObjectContainerName],subFormatPacketIndex=0;noOfSubFormatPacket>subFormatPacketIndex;subFormatPacketIndex++){var subFormatSize=getPacketSize(subObjects[subFormatPacketIndex],packetType,anAttributeNoOrSubFormat);packetSize+=subFormatSize}}else{var attributeValue=getAttributeValue(object,anAttributeNoOrSubFormat);if(isDynamicAttribute(anAttributeNoOrSubFormat))packetSize+=attributeValue.length;else if(isRawByteAttribute(anAttributeNoOrSubFormat)){var attributeNo=anAttributeNoOrSubFormat;packetSize+=getRawAttributeSizeFromObject(object,attributeNo)}else{var attributeNo=anAttributeNoOrSubFormat;packetSize+=getAttributeSize(attributeNo),isConditionalAttribute(attributeNo)&&(packetFormat=_updatePacketFormat(packetType,packetFormat,packetFormatIndex,attributeValue),packetFormatLength=packetFormat.length)}lastAttributeValue=attributeValue}}return packetSize}function setDataViewOffset(dataview,offset,size,value,valueType){if(valueType==TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER)value=parseInt(value),size==TAG_CHAT_GENERAL_CONSTANTS.ONE_BYTE_SIZE?dataview.setUint8(offset,value):size==TAG_CHAT_GENERAL_CONSTANTS.TWO_BYTE_SIZE?dataview.setUint16(offset,value):size==TAG_CHAT_GENERAL_CONSTANTS.FOUR_BYTE_SIZE?dataview.setUint32(offset,value):size==TAG_CHAT_GENERAL_CONSTANTS.EIGHT_BYTE_SIZE&&dataview.setUint64(offset,value);else if(valueType==TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING)for(var valueIndex=0;valueIndex<value.length;valueIndex++)dataview.setUint8(offset,value.charCodeAt(valueIndex)),offset+=1;else if(valueType==TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.BYTE)for(var valueIndex=0;size>valueIndex;valueIndex++)dataview.setUint8(offset+valueIndex,value.getUint8(valueIndex))}function getValueFromDataView(dataview,offset,size,valueType){var value="";return valueType==TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER?value=dataview.getIntByByte(offset,size):valueType==TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.STRING?size>0&&(value=dataview.getString(offset,size)):valueType==TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.BYTE&&size>0&&(value=dataview.copy(offset,size)),value}function getIpParts(ip){var ipArray=[];try{ipArray=ip.split(".")}catch(e){RingLogger.warning("Invalid ip provided in object",ip)}return ipArray}function getIpPortFromPacket(packet){for(var ip,port,ipPart=[],index=0;4>index;index++)ipPart.push(getValueFromDataView(packet,index,1,TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER));return ip=ipPart.join("."),port=getValueFromDataView(packet,4,2,TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER),{ip:ip,port:port}}function getPacketType(packet){return getValueFromDataView(packet,0,1,TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER)}function getUserId(packet){return getValueFromDataView(packet,1,8,TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER)}function setDataViewWithIpPort(dataview,offset,ip,port){for(var ipArray=getIpParts(ip),ipArrayIndex=0;ipArrayIndex<ipArray.length;ipArrayIndex++)setDataViewOffset(dataview,offset,TAG_CHAT_GENERAL_CONSTANTS.ONE_BYTE_SIZE,ipArray[ipArrayIndex],TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER),offset+=TAG_CHAT_GENERAL_CONSTANTS.ONE_BYTE_SIZE;return setDataViewOffset(dataview,offset,TAG_CHAT_GENERAL_CONSTANTS.TWO_BYTE_SIZE,port,TAG_CHAT_GENERAL_CONSTANTS.ATTRIBUTE_TYPE.INTEGER),offset+=TAG_CHAT_GENERAL_CONSTANTS.TWO_BYTE_SIZE}function setDataViewWithObject(dataview,offset,object,packetType,packetFormat){for(var lastAttributeValue=-1,offsetStart=offset,packetFormatIndex=0;packetFormatIndex<packetFormat.length;packetFormatIndex++){var anAttributeNoOrSubFormat=packetFormat[packetFormatIndex];if(angular.isArray(anAttributeNoOrSubFormat)){var subPacketFormat=anAttributeNoOrSubFormat,noOfSubFormatPacket=lastAttributeValue;if(noOfSubFormatPacket>0)for(var previousAttributeNo=packetFormat[packetFormatIndex-1],subObjectContainerName=getSubObjectContainerName(previousAttributeNo),subObjects=object[subObjectContainerName],subFormatPacketIndex=0;noOfSubFormatPacket>subFormatPacketIndex;subFormatPacketIndex++){var subFormatSize=setDataViewWithObject(dataview,offset,subObjects[subFormatPacketIndex],packetType,subPacketFormat);offset+=subFormatSize}}else{var attributeSize,attributeNo=anAttributeNoOrSubFormat,attributeValue=getAttributeValue(object,attributeNo),attributeType=getAttributeType(attributeNo);attributeSize=isDynamicAttribute(attributeNo)?attributeValue.length:isRawByteAttribute(attributeNo)?getRawAttributeSizeFromObject(object,attributeNo):getAttributeSize(attributeNo),setDataViewOffset(dataview,offset,attributeSize,attributeValue,attributeType),offset+=attributeSize,lastAttributeValue=attributeValue,isConditionalAttribute(attributeNo)&&(packetFormat=_updatePacketFormat(packetType,packetFormat,packetFormatIndex,attributeValue))}}return offset-offsetStart}function _constructPacket(object,packetType){var packetFormat=getPacketFormat(packetType),packetSize=getPacketSize(object,packetType,packetFormat)+getIpPortSize();if(!packetSize)return RingLogger.error("Unable to define Packet Size, Check Payload",object,"packetType",packetType,RingLogger.tags.TAG_CHAT),!1;packetSize>512&&RingLogger.warn("Packet Size > 512",object,"packetType",packetType,"packetSize",packetSize,RingLogger.tags.TAG_CHAT);var dataViewPacket=getDateViewPacket(packetSize),dataViewOffsetIndex=0;return dataViewOffsetIndex=setDataViewWithIpPort(dataViewPacket,dataViewOffsetIndex,object.ip,object.port),dataViewOffsetIndex=setDataViewWithObject(dataViewPacket,dataViewOffsetIndex,object,packetType,packetFormat),dataViewPacket}function _updatePacketFormat(packetType,packetFormat,packetFormatIndex,attributeValue){if(packetType==TAG_CHAT_PACKET_TYPE.TAG_CHAT_TAG_INFORMATION)switch(packetFormat=angular.copy(packetFormat),attributeValue){case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_RENAME:packetFormat=packetFormat.slice(0,-2);break;case TAG_CHAT_GENERAL_CONSTANTS.TAG_ACTIVITY_TYPE.TAG_URL_RENAME:packetFormat.splice(packetFormatIndex+1,2)}return packetFormat}function getObjectFromDataView(dataview,dataViewOffsetIndex,object,packetType,packetFormat){for(var anAttributeNoOrSubFormat,attributeNo,attributeName,attributeType,attributeSize,attributeValue,subPacketFormat,subFormatContainer,previousAttributeNo,subObjectContainerName,noOfSubFormatPacket,subFormatPacketIndex,subFormatSize,subFormatObject,lastAttributeValue=-1,dataViewOffsetStartIndex=dataViewOffsetIndex,packetFormatIndex=0;packetFormatIndex<packetFormat.length;packetFormatIndex++)if(anAttributeNoOrSubFormat=packetFormat[packetFormatIndex],angular.isArray(anAttributeNoOrSubFormat)){if(subPacketFormat=anAttributeNoOrSubFormat,subFormatContainer=[],previousAttributeNo=packetFormat[packetFormatIndex-1],subObjectContainerName=getSubObjectContainerName(previousAttributeNo),noOfSubFormatPacket=lastAttributeValue,noOfSubFormatPacket>0)for(subFormatPacketIndex=0;noOfSubFormatPacket>subFormatPacketIndex;subFormatPacketIndex++)subFormatObject={},subFormatSize=getObjectFromDataView(dataview,dataViewOffsetIndex,subFormatObject,packetType,subPacketFormat),dataViewOffsetIndex+=subFormatSize,subFormatContainer.push(subFormatObject);object[subObjectContainerName]=subFormatContainer}else attributeNo=anAttributeNoOrSubFormat,attributeName=getAttributeName(attributeNo),dataViewOffsetIndex>=dataview.byteLength?object[attributeName]="":(attributeType=getAttributeType(attributeNo),attributeSize=isDynamicAttribute(attributeNo)?getDynamicAttributeSize(object,attributeName):isRawByteAttribute(attributeNo)?getRawAttributeSize(dataview.byteLength,dataViewOffsetIndex):getAttributeSize(attributeNo),attributeValue=getValueFromDataView(dataview,dataViewOffsetIndex,attributeSize,attributeType),dataViewOffsetIndex+=attributeSize,object[attributeName]=attributeValue,lastAttributeValue=attributeValue),isConditionalAttribute(attributeNo)&&(packetFormat=_updatePacketFormat(packetType,packetFormat,packetFormatIndex,attributeValue));return dataViewOffsetIndex-dataViewOffsetStartIndex}function _postParseProcess(object){if(object.packetType==TAG_CHAT_PACKET_TYPE.TAG_CHAT_SENT){object.originalPacketId=object.packetId;try{var packetIdSequenceNo=object.packetId.split("_");object.packetId=packetIdSequenceNo[0],object.sequenceNo=packetIdSequenceNo[1]}catch(e){object.sequenceNo=0}}return object}function _parsePacket(packet,packetType,packetFormat){packetFormat||(packetFormat=getPacketFormat(packetType));var dataView=getDataViewByPacket(packet),dataViewOffsetIndex=0,parsedObject={};getObjectFromDataView(dataView,dataViewOffsetIndex,parsedObject,packetType,packetFormat);return parsedObject=_postParseProcess(parsedObject)}function _parseRawPacket(packetData){var dataView=new DataView(packetData),packetType=dataView.getIntByByte(0,1);if(isTagPacket(packetType))try{return _parsePacket(packetData,packetType)}catch(e){dataView.print_r(!0)}}function _getPacketSizeByObject(object,packetType){var packetFormat=getPacketFormat(packetType);return getPacketSize(object,packetType,packetFormat)}function _sliceObjectValue(objectValue,isArray,start,end){return isArray?objectValue.slice(start,end):objectValue.substring(start,end)}function _getSplittedRequestObject(requestObject,packetType,keyToSplit,splittedObjects){var packetFormat=getPacketFormat(packetType),requestObjectSize=getPacketSize(requestObject,packetType,packetFormat),isKeyValueArray=!!angular.isArray(requestObject[keyToSplit]);if(requestObjectSize>TAG_CHAT_GENERAL_CONSTANTS.PACKET_MAX_SIZE){var length=requestObject[keyToSplit].length,leftRequestObject=angular.copy(requestObject),rightRequestObject=angular.copy(requestObject);leftRequestObject[keyToSplit]=_sliceObjectValue(requestObject[keyToSplit],isKeyValueArray,0,length/2),rightRequestObject[keyToSplit]=_sliceObjectValue(requestObject[keyToSplit],isKeyValueArray,length/2,length);var leftRequestObjectSize=getPacketSize(leftRequestObject,packetType,packetFormat),rightRequestObjectSize=getPacketSize(rightRequestObject,packetType,packetFormat);leftRequestObjectSize>TAG_CHAT_GENERAL_CONSTANTS.PACKET_MAX_SIZE?splittedObjects.concat(_getSplittedRequestObject(leftRequestObject,packetType,keyToSplit,splittedObjects)):splittedObjects.push(leftRequestObject),rightRequestObjectSize>TAG_CHAT_GENERAL_CONSTANTS.PACKET_MAX_SIZE?splittedObjects.concat(_getSplittedRequestObject(rightRequestObject,packetType,keyToSplit,splittedObjects)):splittedObjects.push(rightRequestObject)}else splittedObjects.push(requestObject);return splittedObjects}function splitAndGetMultipleObjects(requestObject,packetType){var keyToSplit=getBrokenContainerByPacketType(packetType);return _getSplittedRequestObject(requestObject,packetType,keyToSplit,[])}function _splitAndGetBrokenPackets(packet){var index,lastPacketSize,aBrokenPacket,packetSize=packet.byteLength,packetMaxSize=TAG_CHAT_GENERAL_CONSTANTS.PACKET_MAX_SIZE,noOfPacket=Math.floor(packetSize/packetMaxSize),packets=[],startOffset=0;for(index=0;noOfPacket>index;index++)aBrokenPacket=packet.copy(startOffset,packetMaxSize),packets.push(aBrokenPacket),startOffset+=TAG_CHAT_GENERAL_CONSTANTS.PACKET_MAX_SIZE;return lastPacketSize=packetSize-startOffset,lastPacketSize>0&&(aBrokenPacket=packet.copy(startOffset,lastPacketSize),packets.push(aBrokenPacket)),packets}function getBrokenContainerByPacketType(packetType){switch(packetType){case OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET:return"bytes";case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG_EDIT:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG_EDIT:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_MSG_EDIT:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT:return"message";case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN:return"messages";case OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:case OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:return"packets"}}function getBrokenPacketSplitter(brokenPacketType,packetType,object,packet){switch(brokenPacketType){case OFFLINE_PACKET_TYPE.OFFLINE_BROKEN_PACKET:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_GENERAL_BROKEN_PACKET:return function(){return _splitAndGetBrokenPackets(packet)};case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_MSG_EDIT:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_BROKEN_MSG_EDIT:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG:case TAG_CHAT_PACKET_TYPE.TAG_CHAT_BROKEN_MSG_EDIT:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN:case OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:case OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:return function(){return splitAndGetMultipleObjects(object,packetType)}}}function isMultipleBrokenPacket(packetType){switch(packetType){case OFFLINE_PACKET_TYPE.OFFLINE_FRIEND_UNREAD_MESSAGE_CONFIRMATION:case OFFLINE_PACKET_TYPE.OFFLINE_TAG_UNREAD_MESSAGE_CONFIRMATION:case FRIEND_CHAT_PACKET_TYPE.FRIEND_CHAT_SEEN:return!0}return!1}return{isTagPacket:isTagPacket,constructPacket:_constructPacket,parsePacket:_parsePacket,parseRawPacket:_parseRawPacket,getPacketSizeByObject:_getPacketSizeByObject,splitAndGetMultipleObjects:splitAndGetMultipleObjects,splitAndGetBrokenPackets:_splitAndGetBrokenPackets,getObjectFromDataView:getObjectFromDataView,getIpPortFromPacket:getIpPortFromPacket,getPacketType:getPacketType,getPacketName:getPacketName,getUserId:getUserId,getBrokenContainerByPacketType:getBrokenContainerByPacketType,getBrokenPacketSplitter:getBrokenPacketSplitter,isMultipleBrokenPacket:isMultipleBrokenPacket}}angular.module("ringid.tagchat").factory("tagChatPacketProcessor",tagChatPacketProcessor),tagChatPacketProcessor.$inject=["TAG_CHAT_PACKET_ATTRIBUTE_INFO","TAG_CHAT_PACKET_INFO","CHAT_PACKET_FORMAT","TAG_CHAT_PACKET_TYPE","TAG_CHAT_PACKET_ATTRIBUTE","TAG_CHAT_GENERAL_CONSTANTS","OFFLINE_PACKET_TYPE","FRIEND_CHAT_PACKET_TYPE"]}(),function(){"use strict";function chatPacketResender(utilsFactory,globalSocketFactory,tagChatFactory,tagChatApiService,TAG_CHAT_GENERAL_CONSTANTS,tagChatExceptions){function BaseChatPacketResender(){this._config=this._config||{},this._requiredConfigs=this._requiredConfigs||["packetType"],this._callbacks=this._callbacks||{},this.init=function(){this._config=angular.extend(this._config,{packetType:0,packet:"",packetId:0,sequenceNo:0,packetObject:{},sendFailed:!1,sendSuccess:!1,isBroken:!1,isOffline:!1,terminated:!1,ignoreConfirmation:!1})},this.initCallbacks=function(){this._callbacks=angular.extend(this._callbacks,{_send:this.onSend,_successCheck:this.onSuccessCheck,_failure:this.onFailure,_success:this.onSuccess})},this.init.call(this),this.initCallbacks.call(this)}function ChatPacketResender(){var self=this;self.onSend=function(){var packet;self.hasPacket()?self.hasPacketId()||self.setPacketId(tagChatFactory.getUUIDPacketId()):self.hasPacketObject()&&(packet=tagChatApiService.getPacket(self.getPacketObject(),self.getPacketType()),self.setPacket(packet),!self.hasPacketId()&&self.getPacketObject().packetId&&self.setPacketId(self.getPacketObject().packetId)),self.hasPacket()?(self.getPacketObject()?tagChatApiService.logRequestedPacketInfo(self.getPacketType(),self.getPacketObject()):RingLogger.infoblack("Raw Packet ",self.getPacket(),RingLogger.tags.TAG_CHAT_REQUEST),globalSocketFactory.send(self.getPacket())):RingLogger.error("Skipped empty packet send",self.getPacketObject(),RingLogger.tags.TAG_CHAT)},self.start=function(){self.preProcess(),self.validateConfig();var hasReceivedSuccess=!1;callXTimeAfterYIntervalStopOnSuccess(function(){return self.isCallbackDefined("beforeSend")&&self.getCallback("beforeSend").call(),self.isCallbackDefined("send")?self.getCallback("send").call():self.getDefaultCallback("send").call(self)},function(currentExecutionCount){return self.getIgnoreConfirmation()?!1:(self.isTerminated()||(self.isCallbackDefined("beforeSuccessCheck")&&self.getCallback("beforeSuccessCheck").call(null,currentExecutionCount),hasReceivedSuccess=self.isCallbackDefined("successCheck")?self.getCallback("successCheck").call(null,currentExecutionCount):self.getDefaultCallback("successCheck").call(self,currentExecutionCount),self.isCallbackDefined("afterSuccessCheck")&&self.getCallback("afterSuccessCheck").call(null,currentExecutionCount,hasReceivedSuccess),self.isSendSuccess(hasReceivedSuccess)),self.isSendSuccess()&&self.callSuccessCallback(currentExecutionCount),self.isTerminated()||self.isSendSuccess())},function(){self.getIgnoreConfirmation()?(self.isSendSuccess(!0),self.callSuccessCallback()):(self.isSendSuccess(!1),self.callFailureCallback())},TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_DELAY)},BaseChatPacketResender.call(this)}function ChatPacketBrokenResender(){function _sendABrokenPacket(packetObject){var aChatResender;try{aChatResender=new ChatPacketResender,aChatResender.setPacketType(packetObject.packetType),aChatResender.setSequenceNo(packetObject.sequenceNo),aChatResender.setPacketObject(packetObject),aChatResender.on("afterSuccessCheck",function(currentExecutionCount,hasSuccess){self.isTerminated()&&aChatResender.isTerminated(!0)}),aChatResender.on("success",function(response){packetObject.sequenceNo||(packetObject.sequenceNo=0),response.sucs&&self.onBrokenSuccess(response,packetObject)}),aChatResender.on("failure",function(response){packetObject.sequenceNo||(packetObject.sequenceNo=0),self.onBrokenFailure(response,packetObject)}),aChatResender.start()}catch(e){RingLogger.print("A single broken packet send exception ",e,RingLogger.tags.TAG_CHAT)}}var self=this;this._config={packetObjects:[],confirmations:{}},this.setPacketObjects=function(packetObjects){self._config.packetObjects=packetObjects},this.getPacketObjects=function(){return self._config.packetObjects},this.hasPacketObjects=function(){return self._config.packetObjects.length>0},this.onSuccessCheck=function(currentExecutionCount){return Object.keys(self._config.confirmations).length===self._config.packetObjects.length;
},this._checkForSuccess=function(currentExecutionCount){var hasBrokenSuccess=self.getDefaultCallback("successCheck").call(self,currentExecutionCount);return self.isSendSuccess(hasBrokenSuccess),hasBrokenSuccess},this.addBrokenConfirmation=function(packetId,sequenceNo){self._config.confirmations[packetId+"_"+sequenceNo]=!0},this.onBrokenSuccess=function(response,packetObject){self.addBrokenConfirmation(packetObject.packetId,packetObject.sequenceNo),self._checkForSuccess(response.tryCount)&&self.callSuccessCallback(response.tryCount)},this.onBrokenFailure=function(response,packetObject){!self.isTerminated()&&self._checkForSuccess(response.tryCount)?self.callSuccessCallback(response.tryCount):self.isTerminated()||(self.isTerminated(!0),self.callFailureCallback())},BaseChatPacketResender.call(this),this.setPacketObjects=function(packetObjects){self._config.packetObjects=packetObjects},this.start=function(){var packetObjects;self.hasPacketObjects()?packetObjects=self.getPacketObjects():(self.preProcess(),self.validateConfig(),packetObjects=tagChatApiService.getBrokenPacketObjects(self.getBrokenPacketType(),self.getPacket(),self.getPacketObject()),self.setPacketObjects(packetObjects));for(var noOfPacketsToSend=packetObjects.length,index=0;noOfPacketsToSend>index;index++)_sendABrokenPacket(packetObjects[index])}}function ChatPacketSender(){function _getSenderInstance(isBroken){return isBroken?new ChatPacketBrokenResender:new ChatPacketResender}var self=this;this._config={brokenPacketType:0,packet:"",packetObject:{},packetObjects:[],ignoreConfirmation:!1},this.setPacket=function(packet){self._config.packet=packet},this.getPacket=function(){return self._config.packet},this.hasPacket=function(){return!!self.getPacket()},this.setBrokenPacketType=function(brokenPacketType){self._config.brokenPacketType=brokenPacketType},this.getBrokenPacketType=function(){return self._config.brokenPacketType},this.hasBrokenPacketType=function(){return!!self.getBrokenPacketType()},this.setPacketObject=function(packetObject){self._config.packetObject=packetObject},this.setIgnoreConfirmation=function(ignoreConfirmation){self._config.ignoreConfirmation=ignoreConfirmation},this.getIgnoreConfirmation=function(){return self._config.ignoreConfirmation},this.getPacketObject=function(){return self._config.packetObject},this.hasPacketObject=function(){return Object.keys(self._config.packetObject).length>0},this.setPacketObjects=function(packetObjects){self._config.packetObjects=packetObjects},this.getPacketObjects=function(packetObjects){return self._config.packetObjects},this.hasPacketObjects=function(){return self._config.packetObjects.length>0},this._validate=function(isBroken){if(isBroken&&!self.getBrokenPacketType())throw ChatPacketResenderException("Broken PacketType needs to be set for When Broken Packet is Set.")},this.getInstance=function(isBroken){var senderInstance,packetObjects;if(self._validate(isBroken),packetObjects=tagChatApiService.getBrokenPacketObjects(self.getBrokenPacketType(),self.getPacket(),self.getPacketObject()),!packetObjects.length)throw ChatPacketResenderException("Broken Packet Build Error");return(isBroken||packetObjects.length>1)&&(self.setPacketObjects(packetObjects),isBroken=!0),senderInstance=_getSenderInstance(isBroken),senderInstance.setIgnoreConfirmation(self.getIgnoreConfirmation()),self.hasPacket()&&!isBroken?senderInstance.setPacket(self.getPacket()):(self.hasPacketObjects()?senderInstance.setPacketObjects(self.getPacketObjects()):senderInstance.setPacketObject(self.getPacketObject()),senderInstance.setPacketType(self.getBrokenPacketType())),senderInstance}}var callXTimeAfterYIntervalStopOnSuccess=utilsFactory.callXTimeAfterYIntervalStopOnSuccess,hasReceivedConfirmation=tagChatFactory.hasReceivedConfirmation,ChatPacketResenderException=tagChatExceptions.ChatPacketException;return BaseChatPacketResender.prototype={preProcess:function(){!this.getPacket()&&this.hasPacketObject()&&this.setPacketType(this.getPacketObject().packetType)},on:function(event,callback){this._callbacks[event]=callback},onSend:function(){},onSuccessCheck:function(currentExecutionCount){return hasReceivedConfirmation(this.getPacketId(),this.getPacketType(),this.getSequenceNo())},onFailure:function(){},onSuccess:function(){},setPacketType:function(packetType){this._config.packetType=packetType},getPacketType:function(){return this._config.packetType},hasPacketType:function(){return!!this._config.packetType},setSequenceNo:function(sequenceNo){this._config.sequenceNo=sequenceNo},getSequenceNo:function(){return this._config.sequenceNo},hasSequenceNo:function(){return!!this._config.sequenceNo},hasPacket:function(){return""!=this._config.packet},getPacket:function(){return this._config.packet},setPacket:function(packet){this._config.packet=packet},setPacketObject:function(object){this._config.packetObject=object},getPacketObject:function(){return this._config.packetObject},hasPacketObject:function(){return Object.keys(this._config.packetObject).length>0},setPacketId:function(packetId){this._config.packetId=packetId},hasPacketId:function(){return 0!=this._config.packetId},getPacketId:function(){return this._config.packetId},setIgnoreConfirmation:function(ignoreConfirmation){this._config.ignoreConfirmation=ignoreConfirmation},getIgnoreConfirmation:function(){return this._config.ignoreConfirmation},isBroken:function(isBroken){return"undefined"!=typeof isBroken&&(this._config.isBroken=isBroken),this._config.isBroken},isOffline:function(isOffline){return"undefined"!=typeof isOffline&&(this._config.isOffline=isOffline),this._config.isOffline},isTerminated:function(terminated){return"undefined"!=typeof terminated&&(this._config.terminated=terminated),this._config.terminated},stop:function(){this._config.terminated=!0},isSendSuccess:function(sendSuccess){return"undefined"!=typeof sendSuccess&&(this._config.sendSuccess=sendSuccess),this._config.sendSuccess},validateConfig:function(){if(!this._config.packet&&!this._config.packetObject)throw ChatPacketResenderException("packet or objectToSend needs to be defined");if(this._config.packet&&!this._config.packetType)throw ChatPacketResenderException("sending raw packet needs packetType to be given");var index;for(index=0;index<this._requiredConfigs.length;index++){var key=this._requiredConfigs[index];if(!this._config[key])throw ChatPacketResenderException(key+" Not Defined")}},isCallbackDefined:function(name){return!!this._callbacks[name]},getCallback:function(callbackName){return this._callbacks[callbackName]},getDefaultCallback:function(callbackName){return this._callbacks["_"+callbackName]},getResponseObject:function(success,tryCount,timeout,terminated){return{sucs:success,tryCount:tryCount,timeout:!!timeout,terminated:!!terminated}},callSuccessCallback:function(currentExecutionCount){this.isCallbackDefined("success")?this.getCallback("success").call(this,this.getResponseObject(!0,currentExecutionCount)):this.getDefaultCallback("success").call(this,this.getResponseObject(!0,currentExecutionCount))},callFailureCallback:function(){this.isCallbackDefined("failure")?this.getCallback("failure").call(null,this.getResponseObject(!1,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,!1,this.isTerminated())):this.getDefaultCallback("failure").call(this,this.getResponseObject(!1,TAG_CHAT_GENERAL_CONSTANTS.API_FETCH_RETRY_COUNT,!1,this.isTerminated()))}},ChatPacketResender.prototype=BaseChatPacketResender.prototype,ChatPacketBrokenResender.prototype=BaseChatPacketResender.prototype,{ChatPacketResender:ChatPacketResender,ChatPacketBrokenResender:ChatPacketBrokenResender,ChatPacketSender:ChatPacketSender}}var tagChatApp;try{tagChatApp=angular.module("ringid.tagchat")}catch(e){}tagChatApp.factory("chatPacketResender",chatPacketResender),chatPacketResender.$inject=["utilsFactory","globalSocketFactory","tagChatFactory","tagChatApiService","TAG_CHAT_GENERAL_CONSTANTS","tagChatExceptions"]}(),function(){"use strict";function TagChatController($scope,$templateCache,$timeout,settings,$$connector,Auth,Ringalert,CHAT_GLOBAL_VALUES,rgDropdownService,ChatFactory,utilsFactory,tagChatStorage,friendsFactory,tagChatFactory,tagChatManager,tagChatSubscriber,tagOfflineChatManager,ChatHelper,SystemEvents){function getTagDDControl(aTagObj){return{tagId:aTagObj.getTagId(),isOwner:viewModel.isCurrentUserOwner(aTagObj)}}function getTagPictureImageByMemberAvatars(aTag){for(var images=[],allMembersObjects=aTag.getMembersObjectMap().all(),imageCount=0,index=0;index<allMembersObjects.length&&3>imageCount;index++){var aMemberObject=allMembersObjects[index].value,pictureUrl=aMemberObject.getPictureUrl();""!==pictureUrl&&(images.push(pictureUrl),imageCount++)}return images}function getLastMessageOnATag(aTag){var message=tagChatStorage.getLastMessageByTag(aTag.getTagId());return message?message.value:!1}function memberDDActions(actionObj){switch(actionObj.action){case"edit":case"view":return rgDropdownService.close(),function(){return{tagId:actionObj.tagId}};case"delete":rgDropdownService.close();var tagObject=tagChatFactory.getTag(actionObj.tagId);tagObject.setObjectLock(),tagChatManager.leaveFromTag(actionObj.tagId,currentUser.getKey()).then(function(response){tagObject.removeObjectLock(),Ringalert.show(response,"info")},function(response){tagObject.removeObjectLock(),Ringalert.show(response,"error")})}}var viewModel=this;viewModel.memberDDHtml="pages/partials/tag-chat/member-actions-dropdown.html",viewModel.memberDDActions=memberDDActions,viewModel.getTagDDControl=getTagDDControl,viewModel.ready=!1,viewModel.groupFilter="groups";try{viewModel.debug=RingLogger.conditions[RingLogger.tags.TAG_CHAT]}catch(e){viewModel.debug=!1}var currentUser=Auth.currentUser();viewModel.isCurrentUserOwner=function(tagObj){return tagObj.getOwnerUserId()==currentUser.getKey()},viewModel.isCurrentUserMember=function(tagObj){return tagObj.isUserMember(currentUser.getKey())},tagChatManager.subscribeForAuthUpdate(),viewModel.allTags=tagChatFactory.getTags(),viewModel.changeGroupFilter=function(filterName){viewModel.groupFilter=filterName||"groups"},viewModel.showGroupLogs=function(filterName){return"logs"===viewModel.groupFilter},viewModel.showGroups=function(filterName){return"groups"===viewModel.groupFilter},viewModel.getTagPictureImageByMemberAvatars=getTagPictureImageByMemberAvatars,viewModel.getLastMessageOnATag=getLastMessageOnATag,viewModel.imageBase=settings.imBase,viewModel.getUserAvatar=function(user){return user&&user.avatar()?user.avatar():"images/prof.png"},viewModel.getLastMessageText=function(boxMessageObject){return 2===boxMessageObject.messageType?boxMessageObject.text:-1!==[6,7,8,9].indexOf(boxMessageObject.messageType)?"Media":!1};$scope.$on("chatDataReceived",function(event,dataObj){tagChatSubscriber.processUpdates(event,dataObj)}),$scope.shouldShow=function(){return viewModel.ready},utilsFactory.onCustomEvent("MY_TAG_LIST_RECEIVED",function(){viewModel.ready=!0,viewModel.allTags=tagChatFactory.getTags(),utilsFactory.safeDigest($scope)}),$timeout(function(){viewModel.ready=!0},8e3)}angular.module("ringid.tagchat").controller("TagChatController",TagChatController),TagChatController.$inject=["$scope","$templateCache","$timeout","settings","$$connector","Auth","Ringalert","CHAT_GLOBAL_VALUES","rgDropdownService","ChatFactory","utilsFactory","tagChatStorage","friendsFactory","tagChatFactory","tagChatManager","tagChatSubscriber","tagOfflineChatManager","ChatHelper","SystemEvents"]}(),function(){"use strict";angular.module("ringid.tagchat").directive("rgTagChatList",function(){return{restrict:"E",templateUrl:"pages/partials/tag-chat/tag-chat-list.html"}})}(),function(){"use strict";function TagChatPopupController($timeout,$scope,$boxInstance,$$stackedMap,Auth,fileUploadService,tagChatFactory,tagChatManager,friendsFactory,localData,Ringalert,utilsFactory,settings,TAG_CHAT_GENERAL_CONSTANTS,TAG_CHAT_LANG,profileFactory,rgScrollbarService){function initAdminMemberOwnerList(){$scope.memberList=$$stackedMap.createNew(),$scope.adminList=$$stackedMap.createNew()}function reInitFriends(){$timeout(function(){$scope.friends=friendsFactory.friends.copy(),utilsFactory.safeDigest($scope)},2e3)}function isCurrentUserOwner(tagObj){return!!tagObj&&tagObj.getOwnerUserId()===Auth.currentUser().getKey()}function canAddMember(tagMemberObject){return!0}function canRemoveMember(tagMemberObject){if(tagMemberObject.getId()===currentUserUId)return!1;if($scope.tag&&!isCurrentUserOwner($scope.tag)){var isAddedByCurrentUser=tagMemberObject.getAddedBy()!==Auth.currentUser().getKey();if($scope.tag.isCurrentUserStatusAdmin(currentUserUId))if(tagMemberObject.isAdmin()&&isAddedByCurrentUser);else if(!tagMemberObject.isMember())return!1;if($scope.tag.isCurrentUserStatusMember(currentUserUId)&&isAddedByCurrentUser)return!1}return!0}function canUpdateTagInfo(){return!$scope.editMode||!$scope.tag.isCurrentUserStatusMember(currentUserUId)}function loadMoreFriends(){$scope.state.loading||$scope.friends.length()===friendsFactory.totalFriends("friends")||(toggleLoading(!0),friendsFactory.getContactDetails().then(function(){$scope.friends=friendsFactory.getFriends("friends"),RingLogger.information("FRIENDS LENGTH: "+$scope.friends.length(),RingLogger.tags.FRIEND),toggleLoading(!1)},function(){toggleLoading(!1),RingLogger.alert("friend Details fetch fail",RingLogger.tags.FRIEND)}),setTimeout(function(){$scope.state.loading=!1},3e3))}function createChatTag(){if(!validateTag())return void utilsFactory.safeDigest($scope);var tagName=$scope.models.tagName,memberUIds=$scope.memberList.keys(),adminUIds=$scope.adminList.keys(),tagId=$scope.models.tagId,pictureFileName=$scope.models.pictureFileName;tagChatManager.createTag({tagName:tagName,memberUIds:memberUIds,adminUIds:adminUIds,tagId:tagId,tagPictureUrl:pictureFileName}).then(function(data){data.sucs&&Ringalert.show("Group Created.","success")},function(response){Ringalert.show(TAG_CHAT_LANG.DEFAULT_FAILURE_MESSAGE,"error"),RingLogger.alert(response,"on-tag-chat-tag-create",RingLogger.tags.TAG_CHAT)},function(response){RingLogger.information(response,"on-tag-chat-tag-create-progress",RingLogger.tags.TAG_CHAT)}),utilsFactory.triggerCustomEvent("MY_TAG_LIST_RECEIVED"),$boxInstance.close()}function removeTagObjectLock(tagId){var oldTagObj=tagChatFactory.getTag($scope.tag.getTagId());oldTagObj.removeObjectLock()}function updateChatTag(){if(!validateTag())return void utilsFactory.safeDigest($scope);var oldTagObj=tagChatFactory.getTag($scope.tag.getTagId()),newTagName=$scope.models.tagName,pictureFileName=$scope.models.pictureFileName,memberUIdsToSet=$scope.memberList.keys(),adminUIdsToSet=$scope.adminList.keys();$scope.tag.setObjectLock(),tagChatManager.updateTag(oldTagObj,newTagName,pictureFileName,memberUIdsToSet,adminUIdsToSet).then(function(response){removeTagObjectLock($scope.tag.getTagId()),response.sucs&&Ringalert.show(response,"success")},function(response){removeTagObjectLock($scope.tag.getTagId()),Ringalert.show(TAG_CHAT_LANG.DEFAULT_FAILURE_MESSAGE,"error"),RingLogger.alert(response,"on-tag-chat-tag-update",RingLogger.tags.TAG_CHAT)},function(response){response.sucs&&(removeTagObjectLock($scope.tag.getTagId()),Ringalert.show(response,"success"))}),$scope.editMode=!1,utilsFactory.triggerCustomEvent("MY_TAG_LIST_RECEIVED"),$boxInstance.close()}function toggleLoading(bool){$timeout(function(){$scope.state.loading=bool,bool||rgScrollbarService.recalculate($scope)})}function addToTag(member,type){$scope.memberList.length()+$scope.adminList.length()>$scope.friends.length()-10&&loadMoreFriends();var tagId=$scope.tag?$scope.tag.getTagId():$scope.models.tagId,aTagMemberObject=tagChatFactory.createNewTagMember(tagId,{status:"member"==type?TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.MEMBER:TAG_CHAT_GENERAL_CONSTANTS.MEMBER_STATUS.ADMIN,addedBy:currentUserUId},!1);return canAddMember(aTagMemberObject)?($scope.tag&&aTagMemberObject.setTagId($scope.tag.getTagId()),aTagMemberObject.initWithUserMapObject(member),"admin"===type?$scope.adminList.add(aTagMemberObject.getId(),aTagMemberObject):$scope.memberList.add(aTagMemberObject.getId(),aTagMemberObject),void utilsFactory.safeDigest($scope)):void Ringalert.show("Permission Denied","error")}function removeMember(tagMemberObj){canRemoveMember(tagMemberObj)?(tagMemberObj.isAdmin()?$scope.adminList.remove(tagMemberObj.getId()):$scope.memberList.remove(tagMemberObj.getId()),utilsFactory.safeDigest($scope)):Ringalert.show("Permission Denied","error")}function isMemberSelected(tagMember){return $scope.newOwnerTagMember&&tagMember.getId()===$scope.newOwnerTagMember.getId()}function setNewOwner(tagMember){$scope.newOwnerTagMember=tagMember,utilsFactory.safeDigest($scope)}function selectNewOwner(){var tagMember=$scope.newOwnerTagMember,tag=$scope.tag;$scope.newOwnerTagMember=!1,RingLogger.print("Selected New Owner",tagMember.getName(),"tag-chat");var oldTagMemberStatus=tagMember.getStatus();tagMember.makeOwner();var currentOwner=tag.getMember(Auth.currentUser().getKey());currentOwner.makeMember();var revertChanges=function(){tagMember.setStatus(oldTagMemberStatus),currentOwner.makeOwner(),tag.removeObjectLock()},tagMembersStatusToChange=[tagMember.serialize(),currentOwner.serialize()],membersAdminToUpdateOnSuccess=[tagMember,currentOwner];tag.setObjectLock(),tagChatManager.changeTagMemberStatus(tag.getTagId(),tagMembersStatusToChange,membersAdminToUpdateOnSuccess).then(function(){tagChatManager.leaveFromTag(tag.getTagId()).then(function(memberLeaveResponse){tag.removeObjectLock(),Ringalert.show(memberLeaveResponse,"info")},function(){Ringalert.show(TAG_CHAT_LANG.DEFAULT_FAILURE_MESSAGE,"error"),revertChanges()})},function(){Ringalert.show(TAG_CHAT_LANG.DEFAULT_FAILURE_MESSAGE,"error"),revertChanges()}),utilsFactory.safeDigest($scope),$boxInstance.close()}function cancel(){$scope.newOwnerTagMember=!1,$boxInstance.close(),utilsFactory.safeDigest($scope)}function validateTag(){return $scope.models.tagName.length>100?$scope.models.errTagName="Maximum 100 alpha numeric characters":$scope.models.errTagName="",$scope.models.errMemberList=$scope.memberList.length()+$scope.adminList.length()<2,!$scope.models.errMemberList&&!$scope.models.errTagName}$scope.state={loading:!1,noData:!1};var oldMemberList={};$scope.friends=friendsFactory.getFriends("friends"),$scope.friendName="",$scope.editMode=!1,$scope.addToTag=addToTag,$scope.removeMember=removeMember,$scope.createChatTag=createChatTag,$scope.updateChatTag=updateChatTag,$scope.loadMoreFriends=loadMoreFriends,$scope.cancel=cancel,$scope.validateTag=validateTag,$scope.newOwnerTagMember=!1,$scope.models={popupTitle:"Create New Group Chat",tagName:"",pictureUrl:"",pictureFileName:"",tagId:tagChatFactory.generateNewTagId()},$scope.uploading=!1,$scope.selectNewOwner=selectNewOwner,$scope.setNewOwner=setNewOwner,$scope.isMemberSelected=isMemberSelected,$scope.canRemoveMember=canRemoveMember,$scope.canUpdateTagInfo=canUpdateTagInfo,$scope.getPicturePreviewUrl=function(){return settings.tagChatImBase+$scope.models.pictureUrl},$scope.contactListAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())},$scope.uploadAction=function(actionObj){actionObj.uploadFile.fetchMeta(function(){$scope.models.pictureUrl=actionObj.uploadFile.getPreview(),$scope.uploading=!0,utilsFactory.safeDigest($scope),utilsFactory.safeDigest($scope),actionObj.uploadFile.initUpload().then(function(imgData){$scope.uploading=!1,$scope.models.pictureFileName=imgData.iurl,$scope.models.pictureUrl=settings.imBase+imgData.url,utilsFactory.safeDigest($scope)},function(response){$scope.uploading=!1})})};var currentUserUId=Auth.currentUser().getKey();if(localData&&localData.tagId){$scope.tag=tagChatFactory.getTag(localData.tagId),oldMemberList=$scope.memberList;var memberObjectMap=$scope.tag.getMembersObjectMap();memberObjectMap?($scope.memberAdminList=memberObjectMap.copy(),initAdminMemberOwnerList(),$scope.tag.initMemberObjects(),angular.forEach($scope.memberAdminList.all(),function(aMemberList){aMemberList.value.isMember()?$scope.memberList.add(aMemberList.key,aMemberList.value):$scope.adminList.add(aMemberList.key,aMemberList.value)})):initAdminMemberOwnerList(),$scope.models.tagName=$scope.tag.getTagName(),$scope.models.popupTitle="Update Group chat",$scope.models.pictureUrl=$scope.tag.getPictureFullUrl(),$scope.models.pictureFileName=$scope.tag.getPictureUrl(),$scope.editMode=!0}else initAdminMemberOwnerList();$scope.$watch("friendName",function(newVal,oldVal){""!=newVal&&(friendsFactory.searchContact({schPm:newVal},!0),reInitFriends())}),$scope.$watch(function(){return $scope.friends.length()-$scope.adminList.length()-$scope.memberList.length()},function(newVal,oldVal){10>newVal&&loadMoreFriends()}),$scope.$watch("friendName",function(newVal){newVal&&newVal.length>1&&(toggleLoading(!0),friendsFactory.searchContact({schPm:newVal},!0).then(function(){$scope.friends=friendsFactory.getFriends("friends"),toggleLoading(!1)},function(){toggleLoading(!1)}))})}angular.module("ringid.tagchat").controller("TagChatPopupController",TagChatPopupController),TagChatPopupController.$inject=["$timeout","$scope","$boxInstance","$$stackedMap","Auth","fileUploadService","tagChatFactory","tagChatManager","friendsFactory","localData","Ringalert","utilsFactory","settings","TAG_CHAT_GENERAL_CONSTANTS","TAG_CHAT_LANG","profileFactory","rgScrollbarService"]}(),function(){"use strict";function TagChatDebugInfoController($scope,$boxInstance,Auth,ChatFactory,tagChatFactory,tagChatManager,friendsFactory,tagChatApiService,localData,Ringalert,utilsFactory,settings,TAG_CHAT_GENERAL_CONSTANTS,profileFactory){function registerTag(){tagChatManager.registerTag($scope.tag.getTagId())}function unregisterTag(){tagChatApiService.unRegisterFromChatServer($scope.tag)}$scope.currentUserUId=Auth.currentUser().getKey(),$scope.registerTag=registerTag,$scope.unregisterTag=unregisterTag,localData&&localData.tagId&&($scope.tag=tagChatFactory.getTag(localData.tagId),$scope.tagDebugInfo={},$scope.tagDebugInfo.isTagRegistered=tagChatFactory.isTagRegistered(localData.tagId),$scope.chatBox=ChatFactory.getBoxByUId(localData.tagId))}angular.module("ringid.tagchat").controller("TagChatDebugInfoController",TagChatDebugInfoController),TagChatDebugInfoController.$inject=["$scope","$boxInstance","Auth","ChatFactory","tagChatFactory","tagChatManager","friendsFactory","tagChatApiService","localData","Ringalert","utilsFactory","settings","TAG_CHAT_GENERAL_CONSTANTS","profileFactory"]}(),function(){"use strict";function tagChatExceptions(){function ChatPacketException(msg,code){code?RingLogger.alert("msg "+msg,RingLogger.tags.CHAT_EXCEPTIONS):RingLogger.alert("code : "+code," msg "+msg,RingLogger.tags.CHAT_EXCEPTIONS)}return{ChatPacketException:ChatPacketException}}var tagChatApp=angular.module("ringid.tagchat");tagChatApp.factory("tagChatExceptions",tagChatExceptions),tagChatExceptions.$inject=[]}(),function(){"use strict";angular.module("ringid.circle",["ringid.ringbox","ringid.common.rgdropdown_directive","ringid.friend.friends_factory","ringid.common.user_factory","ringid.common.stacked_map"])}(),function(){"use strict";function circleHttpService($$connector,OPERATION_TYPES){var self=this,OTYPES=OPERATION_TYPES.SYSTEM.CIRCLE,REQTYPE=OPERATION_TYPES.SYSTEM.REQUEST_TYPE;self.go=function(data,method){return method=method||"post",$$connector.request(data)},self.getCircleMembers=function(circleId,pvtid,lim){var payload={actn:OTYPES.TYPE_GROUP_MEMBERS_LIST,grpId:circleId,scl:1,lmt:lim||40,pvtid:pvtid||0};return $$connector.send(payload,REQTYPE.REQUEST)},self.createCircle=function(obj){var payload={actn:OTYPES.TYPE_CREATE_GROUP,gNm:obj.tg.utf8Encode(),uId:obj.uId,groupMembers:obj.alluser};return $$connector.request(payload,REQTYPE.UPDATE)},self.getCircles=function(){var payload={actn:OTYPES.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return $$connector.send(payload,REQTYPE.REQUEST)},self.getCircle=function(key){return $$connector.request({actn:OTYPES.TYPE_GROUP_DETAILS,grpId:key},REQTYPE.REQUEST)},self.getCirclesInfo=function(){var payload={actn:OTYPES.TYPE_GROUP_LIST,ut:-1,gpmut:-1};return $$connector.request(payload,REQTYPE.REQUEST)},self.addMembers=function(obj){var payload={actn:OTYPES.TYPE_ADD_GROUP_MEMBER,grpId:obj.grpId,groupMembers:obj.members};return $$connector.request(payload,REQTYPE.UPDATE)},self.removeMember=function(obj){var payload={actn:OTYPES.TYPE_REMOVE_GROUP_MEMBER,grpId:obj.grpId,groupMembers:[{uId:obj.uId}]};return $$connector.request(payload,REQTYPE.UPDATE)},self.removeMembers=function(obj){var payload={actn:OTYPES.TYPE_REMOVE_GROUP_MEMBER,grpId:obj.grpId,groupMembers:obj.members};return $$connector.request(payload,REQTYPE.UPDATE)},self.addRemoveAdmins=function(obj){var payload={actn:OTYPES.TYPE_EDIT_GROUP_MEMBER,grpId:obj.grpId,groupMembers:obj.members};return $$connector.request(payload,REQTYPE.UPDATE)},self.addRemoveAdmin=function(obj){var payload={actn:OTYPES.TYPE_EDIT_GROUP_MEMBER,grpId:obj.grpId,groupMembers:[{admin:obj.admin,uId:obj.uId}]};return $$connector.request(payload,REQTYPE.UPDATE)},self.leaveCircle=function(obj){var payload={actn:OTYPES.TYPE_LEAVE_GROUP,grpId:obj.grpId};return $$connector.request(payload,REQTYPE.UPDATE)},self.deleteCircle=function(obj){var payload={actn:OTYPES.TYPE_DELETE_GROUP,grpId:obj.grpId};return $$connector.request(payload,REQTYPE.UPDATE)},self.getMemberResult=function(param,cid,stval){var payload={actn:OTYPES.TYPE_GROUP_MEMBERS_SEARCH_RESULT,grpId:cid,schPm:param,st:stval||0};return $$connector.send(payload,REQTYPE.REQUEST)}}angular.module("ringid.circle").service("circleHttpService",circleHttpService),circleHttpService.$inject=["$$connector","OPERATION_TYPES"]}(),function(){"use strict";function circleMap(userFactory,friendsFactory,$$stackedMap,settings,utilsFactory){return{create:function(obj){function _log(){RingLogger.print(circle.grpId,circle.adminIds,circle.memberIds,RingLogger.tags.CIRCLE)}function _removeAdminId(uId){var index=circle.memberIds.indexOf(uId);-1!==index&&circle.memberIds.splice(index,1)}function _removeMemberId(uId){var index=circle.adminIds.indexOf(uId);-1!==index&&circle.adminIds.splice(index,1)}function _refreshLength(){circle.mc=circle.allMembersMap.length()}function _update(obj){angular.extend(circle,obj)}var circle={gNm:"",grpId:0,ists:0,sAd:"",ut:0,mc:"",mt:"",groupMembers:"",memberList:[],members:{},allMembersMap:$$stackedMap.createNew(),adminIds:[],memberIds:[]};angular.isObject(obj)&&(circle=angular.extend({},circle,obj));var ObjectToReturn={sortBy:function(){return circle.gNm.toLowerCase()},update:_update,addMember:function(uId,isAdmin){var user=userFactory.create(uId);circle.allMembersMap.save(user.getKey(),user),isAdmin?ObjectToReturn.promoteToAdmin(user.getKey()):ObjectToReturn.removeFromAdmin(user.getKey()),_refreshLength()},isAdmin:function(){return 1===circle.mt},isMember:function(){return 0===circle.mt},isSuperAdmin:function(uId){return circle.sAd===uId},getSuperAdminUId:function(){return circle.sAd},promoteToAdmin:function(uId){_removeMemberId(uId),circle.adminIds.push(uId),circle.allMembersMap.get(uId).setGroupAdmin(circle.grpId),_log()},removeFromAdmin:function(key){_removeAdminId(key),circle.memberIds.push(key),circle.allMembersMap.get(key).removeGroupAdmin(circle.grpId),_log()},getAdmins:function(){for(var adminsMap=circle.allMembersMap.copy(),i=0;i<circle.memberIds.length;i++)adminsMap.remove(circle.memberIds[i]);return adminsMap},getMember:function(uId){return circle.allMembersMap.get(uId)},getMembers:function(){for(var membersMap=circle.allMembersMap.copy(),i=0;i<circle.adminIds.length;i++)membersMap.remove(circle.adminIds[i]);return membersMap},setMembers:function(newMembers){angular.forEach(newMembers,function(aNewMember){if(!aNewMember.ists){var member=userFactory.create(aNewMember);circle.allMembersMap.save(member.getKey(),member),aNewMember.admin?-1!==circle.adminIds.indexOf(member.getKey())?circle.adminIds.push(member.getKey()):ObjectToReturn.promoteToAdmin(member.getKey()):-1!==circle.memberIds.indexOf(member.getKey())?circle.memberIds.push(member.getKey()):ObjectToReturn.removeFromAdmin(member.getKey())}}),_log()},resetMembers:function(){circle.allMembersMap.reset(),circle.adminIds=[],circle.memberIds=[]},removeMember:function(memberKey){var removedMember;removedMember=circle.allMembersMap.remove(memberKey),_removeAdminId(memberKey),_removeMemberId(memberKey),_refreshLength(),RingLogger.print("REMOVED",removedMember,RingLogger.tags.CIRCLE)},getAllMembers:function(){return circle.allMembersMap},getMemberIds:function(){return circle.memberIds.slice()},getAdminIds:function(){return circle.adminIds.slice()},getMembersObjectCount:function(){return circle.allMembersMap.length()},getMembersCount:function(){return circle.mc},getMemberType:function(){return circle.mt},setMemberCount:function(count){circle.mc=count},getLink:function(subPage){return subPage=subPage||"",settings.baseUrl+utilsFactory.getRingRoute("CIRCLE_HOME",{circleId:circle.grpId,subpage:subPage})},getLinkOnly:function(subPage){return subPage=subPage||"",utilsFactory.getRingRoute("CIRCLE_HOME",{circleId:circle.grpId,subpage:subPage}).slice(1)},getKey:function(){return circle.grpId},getName:function(){return circle.gNm},getAnchor:function(){return'<a class="cir-title" href="/#/circle/'+circle.grpId+'" >'+circle.gNm+"</a>"}};return ObjectToReturn}}}angular.module("ringid.circle").factory("circleMap",circleMap),circleMap.$inject=["userFactory","friendsFactory","$$stackedMap","settings","utilsFactory"]}(),function(){"use strict";function circlesManager($routeParams,$location,$rootScope,$$connector,OPERATION_TYPES,StorageFactory,$$stackedMap,$q,circleMap,UserFactory,circleHttpService,Notification,SystemEvents,Ringalert,Auth){function _removeLocalCircle(circleId){circlesOfMe.remove(circleId),$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_REMOVED,{circleId:circleId})}function doCreateCircle(circleMapObject,aGroup){var circle=circleMapObject.get(aGroup.grpId);return circle?circle.update(aGroup):circle=circleMap.create(aGroup),circleMapObject.save(circle.getKey(),circle),circle}function CreateAndSaveCircle(aGroup){var circle;return aGroup.ists||(circle=aGroup.sAd==Auth.currentUser().getKey()?doCreateCircle(myCircles,aGroup):doCreateCircle(circlesOfMe,aGroup)),circle}function _processCircleList(circleList){angular.forEach(circleList,CreateAndSaveCircle)}function redirect(circleId){RingLogger.information("route circleid: "+$routeParams.circleId,NaN+circleId,RingLogger.tags.CIRCLE),$routeParams.circleId&&$routeParams.circleId==circleId&&(Ringalert.show("Circle Deleted","success"),$location.path("/"))}function redirectHome(){Ringalert.show("Circle does not exist!","warning"),$location.path("/")}function processCircleUpdates(json){RingLogger.information("CIRCLE UPDATE: "+json.actn,RingLogger.tags.CIRCLE),RingLogger.print(json,RingLogger.tags.CIRCLE);var circleId,circleToUpdate;if(json.sucs)switch(json.actn){case OTYPES.TYPE_UPDATE_EDIT_GROUP_MEMBER:case OTYPES.TYPE_UPDATE_ADD_GROUP_MEMBER:circleId=json.grpId,circleToUpdate=getCircle(circleId),circleToUpdate?circleToUpdate.setMembers(json.groupMembers):RingLogger.warning("circle not found: ",RingLogger.tags.CIRCLE);break;case OTYPES.TYPE_UPDATE_DELETE_GROUP:circleId=json.grpId,circleToUpdate=getCircle(circleId),circleToUpdate?(_removeLocalCircle(circleToUpdate.getKey()),redirect(json.grpId)):RingLogger.warning("circle not found: ",RingLogger.tags.CIRCLE);break;case OTYPES.TYPE_UPDATE_REMOVE_GROUP_MEMBER:circleId=json.grpId,circleToUpdate=getCircle(circleId),json.removedMembers&&circleToUpdate?angular.forEach(json.removedMembers,function(aMemberUId){circleToUpdate.removeMember(aMemberUId)}):RingLogger.warning("circle not found: ",RingLogger.tags.CIRCLE);break;case OTYPES.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND:json.groupList=[{gNm:json.gNm,grpId:json.grpId,mc:json.mc,sAd:json.sAd}],_processCircleList(json.groupList),processCircleMembersData(json.groupMembers);
}}function circleUpdateFilter(json){return json.actn===OTYPES.TYPE_UPDATE_EDIT_GROUP_MEMBER||json.actn===OTYPES.TYPE_UPDATE_ADD_GROUP_MEMBER||json.actn===OTYPES.TYPE_UPDATE_DELETE_GROUP||json.actn===OTYPES.TYPE_UPDATE_REMOVE_GROUP_MEMBER||json.actn===OTYPES.TYPE_UPDATE_ADD_TO_GROUP_BY_FRIEND}function processCirclesData(json){json.actn===OTYPES.TYPE_GROUP_LIST&&json.sucs===!0&&(_processCircleList(json.groupList),$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_LIST_PROCESS_COMPLETE))}function processCircleMembersData(json){if(json.sucs===!0&&angular.isArray(json.groupMembers)&&json.groupMembers.length){for(var j=0;j<json.groupMembers.length;j++)maxUserId=json.groupMembers[j].id;var circle=myCircles.get(json.groupMembers[0].grpId);if(circle||(circle=circlesOfMe.get(json.groupMembers[0].grpId)),!circle)return;circle.setMembers(json.groupMembers)}$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:!0})}function processCircleSearchMembersData(json){if(stVal=json.tr,json.sucs===!0&&angular.isArray(json.groupMembers)&&json.groupMembers.length){var circle=myCircles.get(json.groupMembers[0].grpId);if(circle||(circle=circlesOfMe.get(json.groupMembers[0].grpId)),!circle)return;circle.setMembers(json.groupMembers)}$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,{success:json.sucs})}function getCircle(circleKey){return myCircles.get(circleKey)||circlesOfMe.get(circleKey)}function getCirclePromise(key){var circle=getCircle(key),defer=$q.defer();return circle?setTimeout(function(){defer.resolve(circle)}):circleHttpService.getCircle(key).then(function(json){json.sucs?(json.grpId=key,json.ists=0,circle=CreateAndSaveCircle(json),defer.resolve(circle)):defer.reject(!1)},function(reason){}),defer.promise}function getCircles(circleCreatedByMe){return circleCreatedByMe?myCircles:circlesOfMe}function createCircle(circleObj){var deferred=$q.defer();return circleHttpService.createCircle(circleObj).then(function(data){data.sucs===!0&&(circleHttpService.getCircles(),Notification.info("Your circle "+circleObj.tg+" created successfully.")),deferred.resolve(data)}),deferred.promise}function getCircleMembers(circleid,pvtid,lim){0===pvtid&&(maxUserId=pvtid),circleHttpService.getCircleMembers(circleid,maxUserId,lim)}function getMemberResult(param,cid){circleHttpService.getMemberResult(param,cid,stVal)}function leaveGroup(circle){var deferred=$q.defer();return circleHttpService.leaveCircle({grpId:circle.getKey()}).then(function(data){var response=angular.fromJson(data);response.sucs===!0?(myCircles.remove(circle.getKey()),circlesOfMe.remove(circle.getKey()),deferred.resolve(response)):deferred.reject("Failed")}),deferred.promise}function deleteCircle(circle){var deferred=$q.defer();return circleHttpService.deleteCircle({grpId:circle.getKey()}).then(function(response){response.sucs===!0?(myCircles.remove(circle.getKey()),circlesOfMe.remove(circle.getKey()),deferred.resolve(response)):deferred.reject("Failed")}),deferred.promise}function addMembers(members,circle){var obj={grpId:circle.getKey(),members:members};angular.forEach(members,function(aMember){circle.addMember(aMember.uId,aMember.admin)}),circle.setMemberCount(circle.getMembersObjectCount()),circleHttpService.addMembers(obj).then(function(data){RingLogger.print(data,RingLogger.tags.CIRCLE),data.sucs!==!0&&(angular.forEach(members,function(aMember){circle.removeMember(aMember.uId)}),circle.setMemberCount(circle.getMembersObjectCount())),$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(errData){RingLogger.print(errData,RingLogger.tags.CIRCLE)})}function removeMember(memberKey,circle){var param={grpId:circle.getKey(),uId:memberKey},removedMember=circle.removeMember(memberKey);circleHttpService.removeMember(param).then(function(data){data.sucs!==!0&&(circle.addMember(removedMember),Ringalert.show(data,"error")),$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(errData){RingLogger.print(errData,RingLogger.tags.CIRCLE)})}function removeMembers(membersUIds,circle){var param={grpId:circle.getKey(),members:[]};angular.forEach(membersUIds,function(aMemberUId){param.members.push({uId:aMemberUId}),circle.removeMember(aMemberUId)}),circle.setMemberCount(circle.getMembersObjectCount()),circleHttpService.removeMembers(param).then(function(data){data.sucs!==!0&&(angular.forEach(membersUIds,function(aMemberUId){circle.addMember(aMemberUId)}),circle.setMemberCount(circle.getMembersObjectCount()),Ringalert.show(data,"error")),$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)},function(errData){RingLogger.print(errData,RingLogger.tags.CIRCLE)})}function toggleMembership(obj,circle){circleHttpService.addRemoveAdmin(obj).then(function(data){if(RingLogger.print(data,RingLogger.tags.CIRCLE),data.sucs===!0){var groupMember=data.groupMembers[0];groupMember.uId===obj.uId&&groupMember.admin===!0?(RingLogger.print("became admin",RingLogger.tags.CIRCLE),circle.promoteToAdmin(obj.uId)):groupMember.uId===obj.uId&&groupMember.admin===!1&&(RingLogger.print("became member",RingLogger.tags.CIRCLE),circle.removeFromAdmin(obj.uId)),$rootScope.$broadcast(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE)}},function(errData){RingLogger.print(errData,RingLogger.tags.CIRCLE)})}var maxUserId,stVal,myCircles=$$stackedMap.createNew(!0,"asc"),circlesOfMe=$$stackedMap.createNew(!0,"asc"),OTYPES=OPERATION_TYPES.SYSTEM.CIRCLE;return $$connector.subscribe(processCircleUpdates,{action:[OTYPES.TYPE_UPDATE_DELETE_GROUP,OTYPES.TYPE_UPDATE_REMOVE_GROUP_MEMBER,OTYPES.TYPE_UPDATE_ADD_GROUP_MEMBER,OTYPES.TYPE_UPDATE_EDIT_GROUP_MEMBER]}),$$connector.subscribe(processCirclesData,{action:[OTYPES.TYPE_GROUP_LIST]}),Auth.isLoggedIn()?setTimeout(circleHttpService.getCircles,5e3):$rootScope.$on(SystemEvents.AUTH.LOGIN,function(){setTimeout(circleHttpService.getCircles,5e3)}),{processCircleUpdates:processCircleUpdates,circleUpdateFilter:circleUpdateFilter,processCirclesData:processCirclesData,processCircleMembersData:processCircleMembersData,processCircleSearchMembersData:processCircleSearchMembersData,getCircle:getCircle,getCirclePromise:getCirclePromise,getCircles:getCircles,createCircle:createCircle,getCircleMembers:getCircleMembers,leaveGroup:leaveGroup,deleteCircle:deleteCircle,addMembers:addMembers,removeMember:removeMember,removeMembers:removeMembers,toggleMembership:toggleMembership,redirectHome:redirectHome,getMemberResult:getMemberResult}}angular.module("ringid.circle").factory("circlesManager",circlesManager),circlesManager.$inject=["$routeParams","$location","$rootScope","$$connector","OPERATION_TYPES","Storage","$$stackedMap","$$q","circleMap","userFactory","circleHttpService","Notification","SystemEvents","Ringalert","Auth"]}(),function(){"use strict";function CirclePopupController($scope,$$connector,circlesManager,$boxInstance,friendsFactory,$$stackedMap,localData,Ringalert,Auth,rgScrollbarService){function createCircle(){if(validateCircle()){for(var frndIds=$scope.memberList.keys(),adminIds=$scope.adminList.keys(),frnds=[],i=0;i<frndIds.length;i++)frnds[i]={admin:"false",uId:frndIds[i]};for(var admins=[],j=0;j<adminIds.length;j++)admins[j]={admin:"true",uId:adminIds[j]};var allUser=admins.concat(frnds),circleObj={tg:$scope.models.circleName,alluser:allUser};circlesManager.createCircle(circleObj),$scope.close()}}function updateCircle(){if(validateCircle()){var newMemberIds=$scope.memberList.keys(),newAdminIds=$scope.adminList.keys(),previousMemberIds=$scope.circle.getMemberIds(),previousAdminIds=$scope.circle.getAdminIds(),newMembersToAdd=newMemberIds.difference(previousMemberIds),previousMembersToRemove=previousMemberIds.difference(newMemberIds),newAdminsToAdd=newAdminIds.difference(previousAdminIds),previousAdminsToRemove=previousAdminIds.difference(newAdminIds),newMemberAndAdminToAdd=[];angular.forEach(newMembersToAdd,function(aNewMemberUId){newMemberAndAdminToAdd.push({admin:!1,uId:aNewMemberUId})}),angular.forEach(newAdminsToAdd,function(aNewAdminUId){newMemberAndAdminToAdd.push({admin:!0,uId:aNewAdminUId})}),RingLogger.print(newMemberAndAdminToAdd,RingLogger.tags.CIRCLE),newMemberAndAdminToAdd.length>0&&circlesManager.addMembers(newMemberAndAdminToAdd,$scope.circle);var memberKeysToRemove=previousMembersToRemove;memberKeysToRemove=memberKeysToRemove.concat(previousAdminsToRemove),RingLogger.print(memberKeysToRemove,RingLogger.tags.CIRLCE),memberKeysToRemove.length>0&&circlesManager.removeMembers(memberKeysToRemove,$scope.circle),Ringalert.show("Circle Updated","success"),$scope.close()}}function needMoreFriends(){$scope.memberList.length()+$scope.adminList.length()>$scope.friends.length()-10&&loadMoreFriends()}function addToCircle(member){needMoreFriends(),$scope.memberList.add(member.getKey(),member),$scope.$rgDigest()}function removeMember(member){$scope.memberList.remove(member.getKey()),$scope.$rgDigest()}function addToAdmin(admin){needMoreFriends(),$scope.adminList.add(admin.getKey(),admin),$scope.$rgDigest()}function removeAdmin(admin){$scope.adminList.remove(admin.getKey()),$scope.$rgDigest()}function toggleLoading(bool){$scope.state.loading=bool,bool||rgScrollbarService.recalculate($scope),$scope.$$phase||$scope.$root.$$phase||$scope.$digest()}function loadMoreFriends(){$scope.state.loading||$scope.friends.length()===friendsFactory.totalFriends("friends")||(toggleLoading(!0),friendsFactory.getContactDetails().then(function(){$scope.friends=friendsFactory.getFriends("friends"),RingLogger.information("FRIENDS LENGTH: "+$scope.friends.length(),RingLogger.tags.FRIEND),toggleLoading(!1)},function(){toggleLoading(!1),RingLogger.alert("friend Details fetch fail",RingLogger.tags.FRIEND)}),setTimeout(function(){$scope.state.loading=!1},3e3),$scope.$rgDigest())}function validateCircle(){return $scope.models.circleName.length>60?$scope.models.errCircleName="Maximum 60 characters":0===$scope.models.circleName.length?$scope.models.errCircleName="Name required":$scope.models.errCircleName="",$scope.models.errMemberList=$scope.memberList.length()<1,0===$scope.models.errCircleName.length&&!$scope.models.errMemberList}$scope.friends=friendsFactory.getFriends("friends"),$scope.circleAddMode=!1,$scope.state={loading:!1,noData:!1},$scope.models={errCircleName:!1,errMemberList:!1,errAdminList:!1},localData.circleId||($scope.circleAddMode=!0),$scope.editMode=!1,localData&&localData.circleId?($scope.circle=circlesManager.getCircle(localData.circleId),$scope.memberList=$scope.circle.getMembers(),$scope.adminList=$scope.circle.getAdmins(),$scope.isCurrentUserSuperAdmin=$scope.circle.isSuperAdmin(Auth.currentUser().getKey()),$scope.models.popupTitle="Edit Group",$scope.models.circleName=$scope.circle.getName(),$scope.editMode=!0):($scope.models.popupTitle="Create New Circle",$scope.models.circleName="",$scope.memberList=$$stackedMap.createNew(!0,"asc"),$scope.adminList=$$stackedMap.createNew(!0,"asc")),$scope.addToCircle=addToCircle,$scope.addToAdmin=addToAdmin,$scope.removeMember=removeMember,$scope.removeAdmin=removeAdmin,$scope.createCircle=createCircle,$scope.updateCircle=updateCircle,$scope.close=$boxInstance.close,$scope.validateCircle=validateCircle,$scope.loadMoreFriends=loadMoreFriends,$scope.$watch("friendName",function(newVal){newVal&&newVal.length>1&&(toggleLoading(!0),friendsFactory.searchContact({schPm:newVal},!0).then(function(){$scope.friends=friendsFactory.getFriends("friends"),toggleLoading(!1),$scope.$rgDigest()},function(){toggleLoading(!1),$scope.$rgDigest()}))})}angular.module("ringid.circle").controller("CirclePopupController",CirclePopupController),CirclePopupController.$inject=["$scope","$$connector","circlesManager","$boxInstance","friendsFactory","$$stackedMap","localData","Ringalert","Auth","rgScrollbarService"]}(),function(){"use strict";function CirclePageController($scope,$routeParams,$location,circlesManager,friendsFactory,Auth,$ringbox,SystemEvents,$$connector,OPERATION_TYPES,circleHttpService,$timeout,APP_CONSTANTS,Ringalert,rgDropdownService,$rootScope){function pageInit(){vm.circle&&($scope.isPageReady=!0,setMembers(),setPageSettings())}function setPageSettings(){vm.isCurrentUserAdmin=$scope.currentUser.isAdmin(vm.circle.getKey()),vm.isCurrentUserSuperAdmin=vm.circle.isSuperAdmin(Auth.currentUser().getKey()),vm.ddControl.isAdmin=vm.isCurrentUserAdmin,vm.ddControl.isSuperAdmin=vm.isCurrentUserSuperAdmin}function setMembers(){$scope.circleMembers=vm.circle.getAllMembers(),$scope.$rgDigest()}function requestForCircleMembers(){circlesManager.getCircleMembers(circleId,0)}function removeMember(memberKey){circlesManager.removeMember(memberKey,vm.circle)}function circleMemberAction(actionObj){switch(RingLogger.print(actionObj,RingLogger.tags.CIRCLE),actionObj.action){case"remove":circlesManager.removeMember(actionObj.member.getKey(),vm.circle);break;case"changemember":circlesManager.toggleMembership({grpId:vm.circle.getKey(),uId:actionObj.member.getKey(),admin:Boolean(actionObj.admin)},vm.circle);break;case"addFriend":friendsFactory.addFriend({friend:actionObj.member,ct:2});break;case"cancel":friendsFactory.rejectFriendRequest({friend:actionObj.member});break;default:RingLogger.warning("ERR! No matching action",RingLogger.tags.CIRCLE)}$scope.$rgDigest()}function openConfirmation(actionObj){var message="Are you sure you want to "+actionObj.action+" "+vm.circle.getName()+"?",boxInstance=$ringbox.open({type:"remote",scope:!1,controller:"RingBoxConfirmController",resolve:{localData:{message:message}},templateUrl:"pages/partials/ringbox-confirm.html"});boxInstance.result.then(function(confirmed){confirmed&&circleAction(actionObj)})}function circleAction(actionObj){switch(RingLogger.print(actionObj.action,RingLogger.tags.CIRCLE),actionObj.action){case"delete":circlesManager.deleteCircle(vm.circle).then(function(response){RingLogger.print(response,RingLogger.tags.CIRCLE),response.sucs===!0?($location.path("/"),$rootScope.$rgDigest()):$scope.$rgDigest()},function(errData){RingLogger.warning(errData,RingLogger.tags.CIRCLE),$scope.$rgDigest()});break;case"leave":circlesManager.leaveGroup(vm.circle).then(function(response){RingLogger.print(response,RingLogger.tags.CIRCLE),response.sucs===!0&&$location.path("/"),$scope.$rgDigest()},function(errData){RingLogger.warning(errData,RingLogger.tags.CIRCLE),$scope.$rgDigest()});break;default:RingLogger.warning("ERR! No matching action",RingLogger.tags.CIRCLE)}}var vm=this,circleId=$routeParams.circleId,subpage=$routeParams.subpage;$scope.loadMoreCircleMember=!1,$scope.showSearchLoader=!1,$scope.hideLoadButton=!1,$scope.currentUserUId=Auth.currentUser().getUId(),circlesManager.getCirclePromise(circleId).then(function(circle){circle?(vm.circle=circle,$scope.isCurrentUserAdmin=vm.circle.isAdmin(),$scope.isCurrentUserSuperAdmin=vm.circle.isSuperAdmin($scope.currentUserUId),"members"===subpage&&requestForCircleMembers(),pageInit()):circlesManager.redirectHome()},function(reason){circlesManager.redirectHome()}),vm.ddHtml="pages/dropdowns/circle-edit-dropdown.html",vm.ddAction=openConfirmation,vm.ddControl={isAdmin:$scope.isCurrentUserAdmin,isSuperAdmin:$scope.isCurrentUserSuperAdmin,getCircleData:function(){return rgDropdownService.close(),{circleId:circleId}}},vm.ddMemberHtml="pages/dropdowns/circle-member-dropdown.html",vm.ddMemberAction=circleMemberAction,vm.removeMember=removeMember,angular.isUndefined($routeParams.subpage)?vm.subPage="post":vm.subPage=$routeParams.subpage,vm.subPageLink="pages/home/circle."+vm.subPage+".html",vm.isCurrentUserAdmin=!1,vm.isCurrentUserSuperAdmin=!1,vm.getFriendType=function(memberObj){return memberObj.friendshipStatus()},vm.circle?($scope.isPageReady=!1,$scope.circleMembers.length||requestForCircleMembers()):$scope.isPageReady=!1;var friendStatuses=[APP_CONSTANTS.NOT_FRIEND,APP_CONSTANTS.OUTGOING_FRIEND];vm.shouldShowMemberEditMenu=function(memberObj){return!memberObj.isCurrentUser()&&(vm.isCurrentUserSuperAdmin||vm.isCurrentUserAdmin&&!memberObj.isAdmin(circleId)||-1!==friendStatuses.indexOf(memberObj.friendshipStatus()))&&!vm.circle.isSuperAdmin(memberObj.getKey())},vm.memberListSubscriptionKey=$$connector.subscribe(circlesManager.processCircleMembersData,{action:OPERATION_TYPES.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_LIST}),vm.searchListSubscriptionKey=$$connector.subscribe(circlesManager.processCircleSearchMembersData,{action:OPERATION_TYPES.SYSTEM.CIRCLE.TYPE_GROUP_MEMBERS_SEARCH_RESULT}),$scope.$on(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,function(event,data){RingLogger.print(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_PROCESS_COMPLETE,RingLogger.tags.CIRCLE),$scope.loadMoreCircleMember=!1,$scope.showSearchLoader=!1,data.success?$scope.hideLoadButton=!1:$scope.hideLoadButton=!0,pageInit(),$scope.$rgDigest()}),$scope.$on(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,function(){RingLogger.print(SystemEvents.CIRCLE.MY_CIRCLE_MEMBER_LIST_UPDATE_COMPLETE,RingLogger.tags.CIRCLE),setMembers(),$scope.$rgDigest()}),$scope.$on(SystemEvents.CIRCLE.MY_CIRCLE_REMOVED,function($event,data){RingLogger.print(data,RingLogger.tags.CIRCLE),data.circleId===$routeParams.circleId&&(Ringalert.show("Circle has been Removed OR You have been removed from the circle.","info"),$timeout(function(){$location.path("/")}))}),$scope.cMemberSearch=function(){vm.searchParam?($scope.showSearchLoader=!0,circlesManager.getMemberResult(vm.searchParam,circleId)):$scope.hideLoadButton=!1,$scope.$rgDigest()},$scope.loadMoreMembers=function(){if(vm.searchParam)$scope.showSearchLoader=!0,circlesManager.getMemberResult(vm.searchParam,circleId);else{var lim=20;$scope.loadMoreCircleMember=!0,circlesManager.getCircleMembers(circleId,null,lim)}$scope.$rgDigest()},$scope.$on("$destroy",function(){vm.circle&&vm.circle.resetMembers(),$$connector.unsubscribe(vm.memberListSubscriptionKey),$$connector.unsubscribe(vm.searchListSubscriptionKey)})}angular.module("ringid.circle").controller("CirclePageController",CirclePageController),CirclePageController.$inject=["$scope","$routeParams","$location","circlesManager","friendsFactory","Auth","$ringbox","SystemEvents","$$connector","OPERATION_TYPES","circleHttpService","$timeout","APP_CONSTANTS","Ringalert","rgDropdownService","$rootScope"]}(),function(){"use strict";var feedApp;feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.utils","ringid.config","ringid.connector"])}(),function(){"use strict";function $$feedMap(Auth,settings,$$stackMap,$$imageMap,Media,$$mediaAlbumMap,$$mediaMap,User,utilsFactory,circlesManager,$sce,EmotionFactory,MESSAGES,OPERATION_TYPES){function feedConditionalReplacer(str,conditions){var i=0;return conditions=conditions||[],str=str.replace(/(\w+)?\|\|(\w+)?/g,function(match,p1,p2){return void 0!==conditions[i]?conditions[i]?p1:p2:""}),str.replace(/(\s){2,}/g," ")}function __getRawFeedObject(_d){var key=keyPrefix+_d.nfId;return{key:key,nfId:_d.nfId||0,utId:_d.utId||0,isNew:_d.isNew||0,location:_d.lctn||"",lat:_d.lat||9999,lng:_d.lng||9999,groupName:_d.gNm||"",grpId:_d.grpId||0,text:_d.sts||"",stsTags:_d.stsTags||[],imageTotal:_d.tim||0,imageType:_d.imT||0,medias:[],audios:[],album:{},friend:_d.fndId?User.getUser(_d.fndId):!1,whoShare:_d.whoShare||{},type:_d.type||0,mdLst:_d.mdLst||[],tm:_d.tm?_d.tm:Date.now(),at:_d.at?_d.at:Date.now(),ic:_d.ic||0,il:_d.il||0,is:_d.is||0,nc:_d.nc||0,nl:_d.nl||0,ns:_d.ns||0,sc:_d.sc,tfc:_d.tfc||0,stp:_d.stp||0,fc:_d.fc||0,orginal:{},message:"",subMessage:"",activity:_d.actvt||0,afn:_d.afn||"",auId:_d.auId||0,pending:_d.pending||!1,lnkDmn:_d.lnkDmn||"",lnkDsc:_d.lnkDsc||"",lnkTtl:_d.lnkTtl||"",lnkURL:_d.lnkURL||"",lnlImgURL:_d.lnlImgURL||"",viewColumn:_d.viewColumn||"",fTgLst:_d.fTgLst||[],oldMessage:"",ogData:{}}}function __updateRawFeedObject(feed,json,doNotupdateTm){json.lat&&(feed.lat=json.lat,feed.lng=json.lng),json.lctn?(feed.lctn=json.lctn,feed.location=json.lctn):9999===json.lat&&(feed.location="",feed.lctn=""),json.gNm&&(feed.gNm=json.gNm,feed.groupName=json.gNm),json.grpId&&(feed.grpId=grpId),json.sts&&(feed.text=json.sts),json.tim&&(feed.imageTotal=json.tim),json.imT&&(feed.imageType=json.imT),json.mdLst&&(feed.mdLst=json.mdLst),json.ic&&(feed.ic=json.ic),json.il&&(feed.il=json.il),json.is&&(feed.is=json.is),json.nc&&(feed.nc=json.nc),json.nl&&(feed.nl=json.nl),json.ns&&(feed.ns=json.ns),json.sc&&(feed.sc=json.sc),json.tfc&&(feed.tfc=json.tfc),json.actvt&&(feed.activity=json.actvt),json.afn&&(feed.afn=json.afn),json.auId&&(feed.auId=json.auId),json.lnkDmn&&(feed.lnkDmn=json.lnkDmn),json.lnkDsc&&(feed.lnkDsc=json.lnkDsc),json.lnkTtl&&(feed.lnkTtl=json.lnkTtl),json.lnkURL&&(feed.lnkURL=json.lnkURL),json.lnlImgURL&&(feed.lnlImgURL=json.lnlImgURL),json.fTgLst&&(feed.fTgLst=json.fTgLst),doNotupdateTm||(feed.tm=json.tm||Date.now())}function __getUtf8Fields(){return["location","lctn","lnkDmn","lnkDsc","lnkTtl","lnkURL","lnlImgURL"]}function __getUserCardString(){return'<user-card user="feed.user()"></user-card>'}function __setFeedUser(feed,_d,user){if(angular.isDefined(user))feed.user=user;else if(_d.utId?feed.user=User.getByUtId(_d.utId):_d.uId?feed.user=User.getUser(_d.uId):feed.user=!1,!feed.user){var uOb={};_d.uId&&(uOb.uId=_d.uId),_d.utId&&(uOb.utId=_d.utId),_d.fn&&(uOb.fn=_d.fn),_d.prIm&&(uOb.prIm=_d.prIm),feed.user=User.create(uOb)}}function __initImageMap(imageList,$images,feed){var temp;if(imageList){var loopIndex=0;if(angular.isArray(imageList)&&imageList[loopIndex].getMapKey)for(loopIndex=0;loopIndex<imageList.length;loopIndex++)$images.add(imageList[loopIndex].getMapKey(),imageList[loopIndex]);else{try{temp=angular.isString(imageList)?angular.fromJson(imageList):imageList}catch(e){}var imlength=temp.length>3?3:temp.length;for(loopIndex=0;imlength>loopIndex;loopIndex++)temp[loopIndex].nfId=feed.nfId,temp[loopIndex]=$$imageMap.create(temp[loopIndex],feed.user),$images.add(temp[loopIndex].getMapKey(),temp[loopIndex])}}switch(feed.images=$images,$images.length()){case 1:feed.imlayout=5;break;case 2:feed.imlayout=4;break;default:feed.imlayout=feed.nfId%4}}function __initFeedMedias(feed,mdaCntntLst,$medias,$audios){if(mdaCntntLst){var albumMap,user=feed.stp>0?null:feed.user;mdaCntntLst.length>0&&(albumMap=Media.getAlbum(mdaCntntLst[0].albId),albumMap||(albumMap=$$mediaAlbumMap.createAlbum({albId:mdaCntntLst[0].albId,albn:mdaCntntLst[0].albn,mdaT:mdaCntntLst[0].mdaT}))),albumMap.isAudio()?$audios=albumMap.pushContent(mdaCntntLst,user,feed.nfId,$audios):albumMap.isVideo()&&($medias=albumMap.pushContent(mdaCntntLst,user,feed.nfId,$medias)),feed.album=albumMap,feed.medias=$medias,feed.audios=$audios}}function __checkForFriendFeed(feed,friendId,friendFirstName,friendLastName){friendId&&!feed.friend&&(feed.friend=User.create({uId:friendId,fn:friendFirstName,ln:friendLastName}))}function __initFeedFeelings(feed){feed.feelings={},feed.mdLst.length&&(feed.feelings=EmotionFactory.getEmotion(feed.mdLst[0],!0))}function _setTagUsers(feed,feedTagList,feedTagFriendCount){if(feedTagList?feed.fTgLst=feedTagList:feedTagList=feed.fTgLst,feed.tagUsers.length=0,feedTagList&&feedTagList.length)for(var i=0;i<feedTagList.length;i++)feedTagList[i].fn=feedTagList[i].nm,feed.tagUsers.push(User.createByUtId(feedTagList[i]));angular.isDefined(feedTagFriendCount)&&(feed.tfc=feedTagFriendCount)}function __initFeedTags(feed,feedTagList){feed.tagUsers=[],_setTagUsers(feed,feedTagList)}function __setFeedTopMessage(feed,ob){if(feed.activity>0){if(ob&&(feed.afn=ob.fn,feed.activity=2),feed.subMessage="",feed.activity&&MESSAGES.FEED["ACT_"+feed.activity]){var activity_user=User.getByUtId(feed.auId),acmessage="<b>You</b>";activity_user?activity_user.isCurrentUser()||(acmessage='<user-card user="feed.getActivityUser()"></user-card>'):Auth.currentUser().getUtId()!==feed.auId&&(activity_user=User.createByUtId({fn:feed.afn,utId:feed.auId},!0),acmessage='<user-card user="feed.getActivityUser()"></user-card>'),feed.activityUser=activity_user,acmessage=MESSAGES.FEED["ACT_"+feed.activity].format(acmessage),feed.subMessage=acmessage}feed.subMessage=$sce.trustAsHtml(feed.subMessage)}}function __initFeedTime(feed){feed.at?feed.time=utilsFactory.verbalDate(feed.at):feed.time=""}function __parseStatus(feed){var usr,text_spilit=[];if(feed.text||feed.stsTags){if(feed.stsTags&&feed.stsTags.length){var end,start=0;feed.stsTags.sort(function(a,b){return b.pstn>a.pstn?-1:1});for(var i=0;i<feed.stsTags.length;i++)end=feed.stsTags[i].pstn-start,usr=User.create(feed.stsTags[i]),end>0&&text_spilit.push(utilsFactory.parseForLE(feed.text.substr(start,end))),text_spilit.push(usr.getLink({"class":"sts-tag",contenteditable:"false","data-link":usr.getUtId()})),start=feed.stsTags[i].pstn;end=feed.text.length-start,end>0&&text_spilit.push(utilsFactory.parseForLE(feed.text.substr(start,end))),RingLogger.print(text_spilit,"STSTAG"),feed.feedHtml=text_spilit.join("")}else feed.feedHtml=utilsFactory.parseForLE(feed.text);feed.feedHtml=$sce.trustAsHtml(feed.feedHtml)}else feed.feedHtml=""}function __addPostfixMessage(feed){feed.message=feed.oldMessage,feed.mdLst.length&&(feed.message+='<span class="feelings-text">&nbsp;feeling</span> <img class="feed_emo" src="'+feed.feelings.url+'" />&nbsp;'+feed.feelings.nm),feed.tagUsers.length&&(feed.message+='&nbsp;<feed-tag-more-user tag-feed="feed"></feed-tag-more-user>'),feed.location&&(feed.message+='<location-card feed="feed"></location-card>')}function __processFeedMessage(feed,userCardString){var subtype,circleGroupPrefix="";feed.friend?circleGroupPrefix="F":feed.grpId&&(feed.circle=circlesManager.getCircle(feed.grpId),circleGroupPrefix="C");var replacer=[userCardString];switch(feed.type){case OTYPES.NEWS_FEED_TYPE_IMAGE:feed.images.length()>0?(feed.message=messages["TYPE_1"+feed.images.top().getImageType()+circleGroupPrefix]||messages.TYPE_D,feed.message=feedConditionalReplacer(feed.message,[feed.user.isCurrentUser()])):feed.message=messages.TYPE_D;break;case OTYPES.NEWS_FEED_TYPE_STATUS:feed.message=messages["TYPE_2"+circleGroupPrefix];break;case OTYPES.NEWS_FEED_TYPE_MULTIPLE_IMAGE:feed.message=messages["TYPE_"+feed.type],feed.message=feedConditionalReplacer(feed.message,[feed.user.isCurrentUser()]),replacer.push(feed.imageTotal);break;case OTYPES.NEWS_FEED_TYPE_ALBUM:case OTYPES.NEWS_FEED_TYPE_AUDIO:case OTYPES.NEWS_FEED_TYPE_VIDEO:subtype=feed.stp||0,feed.message=messages["TYPE_"+feed.type+subtype],replacer.push('<user-card class="share-user" user="feed.getSingleContent().user()"></user-card>');break;default:feed.message=messages.TYPE_D}feed.friend?feed.message+=" "+messages.F_POSTFIX.format('<user-card class="wall-user" user="feed.getTargetWall()"></user-card>'):feed.grpId&&(feed.message+=" "+messages.C_POSTFIX.format(angular.equals({},feed.circle)?feed.circle.getAnchor():feed.groupName)),feed.message=feed.message.format(replacer),feed.oldMessage=feed.message}function __setStatusMessageForShareFeed(feed,userCardString){var temstr=userCardString;feed.orginal.getTotalShare()>1&&(temstr+="and "+(feed.orginal.getTotalShare()-1)+" other people");var repl=[userCardString];feed.message=messages.TYPE_SHARE,repl.push('<user-card class="share-user" user="feed.getOrginalFeed().user()"></user-card>'),feed.message=feed.message.format(repl),feed.oldMessage=feed.message,__addPostfixMessage(feed)}function __initOgData(feed){feed.ogData.image=feed.lnlImgURL,feed.ogData.description=feed.lnkDsc,feed.ogData.title=feed.lnkTtl,feed.ogData.url=feed.lnkURL,feed.ogData.lnkDmn=feed.lnkDmn}function __initLocationData(feed){9999!==feed.lat?feed.locationData={description:feed.location,lat:feed.lat,lng:feed.lng}:feed.locationData={description:feed.location}}function __feedInit(feed,_d,user,$images,$medias,$audios,userCardString,utf8fields){feed.circle={},__setFeedUser(feed,_d,user),__initImageMap(_d.imageList,$images,feed),__initFeedMedias(feed,_d.mdaCntntLst,$medias,$audios),__checkForFriendFeed(feed,_d.fndId,_d.ffn,_d.fln),__initFeedFeelings(feed),__initFeedTags(feed,_d.fTgLst),__initFeedTime(feed),__setFeedTopMessage(feed),__processFeedMessage(feed,userCardString),__addPostfixMessage(feed),__initOgData(feed),__initLocationData(feed),__parseStatus(feed)}var keyPrefix="nf_",sortBy="tm",messages=MESSAGES.FEED,OTYPES=OPERATION_TYPES.SYSTEM;return{getPrefix:function(){return keyPrefix},setSortKey:function(key){sortBy=key},setPrefix:function(prefix){keyPrefix=prefix},getSortIndex:function(){return sortBy},makeKey:function(key){return keyPrefix+key},create:function(_d,user){function isSingleContentFeed(){return 1===feed.images.length()||1===feed.medias.length()||1===feed.audios.length()}function getSingleContent(){return feed.images.length()&&feed.images.bottom()||feed.medias.length()&&feed.medias.bottom()||feed.audios.length()&&feed.audios.bottom()||feedMapObjectToReturn}var feed,key,$images,$medias,$audios,userCardString,utf8fields,shareUsers,identicalFeed;if(utf8fields=__getUtf8Fields(),userCardString=__getUserCardString(),shareUsers=[],$images||($images=$$stackMap.createNew(!0,"asc"),$medias=$$stackMap.createNew(),$audios=$$stackMap.createNew()),key=keyPrefix+_d.nfId,feed=__getRawFeedObject(_d),feed.images=$images,feed.medias=$medias,feed.audios=$audios,__feedInit(feed,_d,user,$images,$medias,$audios,userCardString,utf8fields),isSingleContentFeed()){var content=getSingleContent();feed.images.length()||(feed.is=content.share(),feed.ns=content.getTotalShare()),feed.ic=content.selfComment(),feed.nc=content.getTotalComment()}var feedMapObjectToReturn={getFeedRaw:function(){return feed},ddControl:{feedKey:feed.nfId,showEdit:function(){return!!(feed.user.isCurrentUser()&&feed.nl<1)},feedUser:function(){return feed.user},tagButtonText:function(){return feed.tagUsers.length?"Edit Tag":"Add Tag"},showDelete:function(){return feed.user.isCurrentUser()||feed.friend&&feed.friend.isCurrentUser()},showTagButton:function(){return feed.user.isCurrentUser()&&!feed.grpId}},isEmpty:function(ignore){return ignore=ignore||{},!feed.text||ignore.tagUsers&&feed.tagUsers.length},isSpecial:function(){return feed.fc>0},isFeed:!0,setIdenticalFeed:function(f){identicalFeed=f},getByProperty:function(property_name,return_default){return return_default=return_default||!1,feed.hasOwnProperty(property_name)?feed[property_name]:return_default},showMore:function(){return!!feed.sc},getKey:function(){return feed.nfId},sortBy:function(){return feed[sortBy]||feed.tm},getMapKey:function(){return feed.key},setFeedKey:function(key){feed.nfId=key},getFeedKey:function(key){return feed.nfId},user:function(){return feed.user},isTimelinePost:function(){return feed.friend&&feed.friend.isCurrentUser()},checkMessageUpdated:function(){return feed.message+feed.location+feed.tagUsers.reduce(function(prev,curr){return prev.toString()+curr.toString()},"")+feed.tfc},getMessageText:function(){return feed.message},isWallPost:function(){return!!feed.friend},isCirclePost:function(){return feed.grpId>0},getTargetWall:function(){return feed.friend},getTargetCircle:function(){return angular.equals({},feed.circle)?feed.groupName:feed.circle},text:function(){return feed.text},getDynamicText:function(){return feed.feedHtml},getDynamicTextMore:function(words,uid){words=parseInt(words)>0?parseInt(words):20;for(var text,ptrn="(",fhtml=utilsFactory.parseForLE(feed.text),i=words;i>0;i--)ptrn+="[\\S]+\\s";return ptrn+=")(.*)",text=fhtml.replace(new RegExp(ptrn),'<span class="with-more"><input id="read'+uid+'" type="checkbox" /><span class="less">$1</span><span class="more">$2</span><label for="read'+uid+'" class="trigger"></label></span>'),$sce.trustAsHtml(text)},hasActivityMessage:function(){return feed.activity>0},setActivity:function(json){feed.activity=json.actvt||0,feed.afn=json.afn,feed.auId=json.auId,__setFeedTopMessage(feed)},setFeedTopMessage:function(){__setFeedTopMessage(feed)},getActivityMessage:function(i,k,fe){return feed.subMessage},getActivityUser:function(){return feed.activityUser},getLocationText:function(){return feed.location},getLocationShortText:function(){if(feed.location){var location=feed.location,parts=feed.location.split(",");return parts.length>2&&(location=parts[0].replace("(","")),
location.length>30&&(location=location.substr(0,30)+"..."),location}},setLocationText:function(location){return feed.location=location,__addPostfixMessage(feed),location},resetLocationText:function(){feed.location=""},isMediaShared:function(){return feed.stp>0},isSingleContentFeed:isSingleContentFeed,getContentType:function(){var a;return a=feed.images.length()?"image":feed.medias.length()?"media":feed.audios.length()?"media":"feed"},getSingleContent:getSingleContent,hasLocationInfo:function(){return!(""===feed.location||feed.lnkURL||feed.text||feed.images.length()||feed.medias.length()||feed.audios.length())},validateForUpdateTag:function(){return""!==feed.location||feed.lnkURL||feed.text||feed.images.length()||feed.medias.length()||feed.audios.length()},getLocationInfo:function(){return feed.locationData},getLocationUrl:function(){return $sce.trustAsResourceUrl(utilsFactory.getGoogleMapJSUrl(feed.lat,feed.lng,feed.location,!1))},getLocationEmbedUrl:function(){return $sce.trustAsResourceUrl(utilsFactory.getGoogleMapJSUrl(feed.lat,feed.lng,feed.location,!0))},getLocationStaticEmbedUrl:function(){return $sce.trustAsResourceUrl(utilsFactory.getGoogleMapStaticUrl(feed.lat,feed.lng))},setLocationInfo:function(location){feed.location=location.description,feed.lat=location.lat,feed.lng=location.lng,__initLocationData(feed),__addPostfixMessage(feed)},setText:function(sts,stsTags){feed.text=sts,stsTags&&(feed.stsTags=stsTags),__parseStatus(feed)},time:function(){return feed.time},setTime:function(tm){feed.tm=tm},updateTime:function(){feed.time=utilsFactory.verbalDate(feed.at)},getTimestamp:function(){return feed.tm},getAtTime:function(){return feed.at},incomingLike:function(type){return type&&++feed.nl||--feed.nl},like:function(dolike,totalLike){return dolike?(feed.il=1^feed.il,totalLike?feed.nl=totalLike:feed.nl=feed.il?feed.nl+1:feed.nl-1,identicalFeed&&identicalFeed.like(dolike),feed.il):feed.il},setTotalLikes:function(nl,il){feed.nl=nl,angular.isDefined(il)&&(feed.il=il),identicalFeed&&identicalFeed.setTotalLikes(nl)},getTotalLikes:function(){return feed.nl},setTotalComment:function(loc,ic){feed.nc=loc,angular.isDefined(ic)&&(feed.ic=ic),identicalFeed&&identicalFeed.setTotalComment(loc)},getTotalComment:function(){return feed.nc},selfComment:function(){return feed.ic},getTotalImages:function(){return feed.imageTotal},getTotalShare:function(){return feed.ns},getShareUsers:function(){return feed.orginal.getShareUsers()},addShareUser:function(usr){return"array"==typeof usr?shareUsers=shareUsers.concat(usr):shareUsers.push(usr),shareUsers},updateShareMessage:function(){__setStatusMessageForShareFeed(feed,userCardString)},share:function(doShare,totalShare){return doShare?(feed.is=1^feed.is,totalShare?feed.ns=totalShare:feed.ns=feed.is?feed.ns+1:feed.ns-1,feed.is):feed.is},shares:function(mainFeed){feed.orginal=mainFeed,feed.orginal.addShareUser(feed.user),__setStatusMessageForShareFeed(feed,userCardString)},getWhoShares:function(){return feed.whoShare},getOrginalFeed:function(){return feed.orginal},hasSharedFeed:function(){return!angular.equals({},feed.orginal)},setImages:function(imageList){_,__initImageMap(imageList,$images,feed)},hasMedia:function(){return feed.images.length()>0||feed.medias.length()>0||feed.audios.length()>0},getImages:function(map){return map?feed.images:feed.images.all()},getTotalImage:function(){return feed.imageTotal},getAlbum:function(){return feed.album},getMedias:function(){return feed.medias},getAudios:function(){return feed.audios},getStrmURL:function(){return feed.strmURL},getLinkDomain:function(){return feed.lnkDmn},getLinkUrl:function(){return feed.lnkURL},getLinkTitle:function(){return feed.lnkTtl},getLinkDescription:function(){return feed.lnkDsc},getLinkImageUrl:function(){return feed.lnlImgURL},hasOgData:function(){return!!(feed.lnlImgURL||feed.lnkTtl||feed.lnkDsc)},getOgData:function(){return feed.ogData},setOgData:function(ogData){feed.lnkDsc=ogData.lnkDsc||ogData.description||"",feed.lnkTtl=ogData.lnkTtl||ogData.title||"",feed.lnkURL=ogData.lnkURL||ogData.url||"",feed.lnlImgURL=ogData.lnlImgURL||ogData.image||"",feed.lnkDmn=ogData.lnkDmn||ogData.domain||"",__initOgData(feed)},parseMoreText:function(feedObj){feed=angular.extend({},feed,feedObj),feed.text=feedObj.sts,__parseStatus(feed)},isPending:function(val){return void 0!==val&&(feed.pending=!!val),feed.pending},setViewColumn:function(column){feed.viewColumn=column},getViewColumn:function(){return feed.viewColumn},getUrl:function(){return utilsFactory.getRingRoute("SINGLE_FEED",{feedId:feed.nfId,shared:feedMapObjectToReturn.hasSharedFeed()})},getWhoShareUrl:function(){var feedId;return feedId=feedMapObjectToReturn.hasSharedFeed()?feedMapObjectToReturn.getOrginalFeed().getKey():feedMapObjectToReturn.getKey(),utilsFactory.getRingRoute("WHO_SHARED_FEED",{feedId:feedId})},update:function(json,doNotupdateTm){__updateRawFeedObject(feed,json,doNotupdateTm),__initFeedFeelings(feed),__initFeedTags(feed),__initFeedTime(feed),__setFeedTopMessage(feed),__processFeedMessage(feed,userCardString),__addPostfixMessage(feed),__parseStatus(feed)},hasFeelings:function(){return!!feed.mdLst.length},getFeelings:function(){return feed.feelings},setFeelings:function(feelings){feelings&&feelings.id?(feed.feelings=feelings,feed.mdLst[0]=feelings.id):(feed.feelings={},feed.mdLst=[]),__addPostfixMessage(feed)},isShareAble:function(returnWithMessage){var rc,sucs=!0,content=feedMapObjectToReturn.isSingleContentFeed()&&!feed.images.length(),f=feedMapObjectToReturn.getSingleContent();return feed.user.isCurrentUser()||content&&f.user().isCurrentUser()?(rc="RC15",sucs=!1):feed.friend?(rc="CRCFS1",sucs=!1):feed.grpId?(rc="CRCFS2",sucs=!1):feed.is&&!content&&(rc="CRCFS3",sucs=!1),returnWithMessage?{sucs:sucs,rc:rc}:sucs},hasTagUsers:function(){return!!feed.tagUsers.length},getTagUsers:function(){return feed.tagUsers},hasMoreTagUsers:function(){return feed.tfc>feed.tagUsers.length},getMoreTagUsers:function(){return feed.tfc-feed.tagUsers.length},getTotalTag:function(){return feed.tfc},updateTagUser:function(obTag){_setTagUsers(feed,obTag.fTgLst,obTag.tfc),__addPostfixMessage(feed)},encodeUtf8Fields:function(){for(var utf8fieldsIndex=0;utf8fieldsIndex<utf8fields.length;utf8fieldsIndex++){var feedUtf8AttributeName=utf8fields[utf8fieldsIndex];feed[feedUtf8AttributeName]?feed[feedUtf8AttributeName]=feed[feedUtf8AttributeName].utf8Encode():feed[feedUtf8AttributeName]=""}},getImageLayout:function(withCLass){return feed.imlayout}};return feedMapObjectToReturn}}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config","ringid.media"])}feedApp.factory("$$feedMap",$$feedMap),$$feedMap.$inject=["Auth","settings","$$stackedMap","$$imageMap","Media","$$mediaAlbumMap","$$mediaMap","userFactory","utilsFactory","circlesManager","$sce","EmotionFactory","MESSAGES","OPERATION_TYPES"]}(),function(undefined){"use strict";function feedFactory(fileUploadService,$$connector,$q,$$stackedMap,$$feedMap,helper,OPERATION_TYPES,APP_CONSTANTS,Ringalert,Auth,MIN_TIMESTAMP,$rootScope,SystemEvents){function setSortBy(key){$$feedMap.setSortKey(key)}function getIndexedFeed(){return feedList.hasOwnProperty(feed_index)?feedList[feed_index].data:$$stackedMap.createNew()}function getIndexedRemovedFeed(){return feedList.hasOwnProperty(feed_index)?feedList[feed_index].removed:$$stackedMap.createNew()}function getCurrentPageValue(){var keyParts=[];try{keyParts=feed_index.split(".",2)}catch(e){return!1}return 2!=keyParts.length?!1:{action:parseInt(keyParts[0]),page:keyParts[1]}}function updateTime(){for(var feeds=getIndexedFeed(),i=0;i<feeds.length();i++){var timediff=Date.now()-feeds.all()[i].value.getTimestamp();36e5>timediff&&feeds.all()[i].value.updateTime()}}function init(ob){var $feed=getIndexedFeed();return $feed.length()<10?(requestForFeed(ob),!0):!1}function reset(){getIndexedFeed().reset(),getIndexedRemovedFeed().reset(),incomingFeedData.length=0}function getMinTm(){var sortIndex=$$feedMap.getSortIndex(),$feed=getIndexedFeed();if("tm"===sortIndex)return $feed.length()?$feed.top().getTimestamp():MIN_TIMESTAMP;var mintimestamp=$feed.length()?$feed.top().getAtTime():MIN_TIMESTAMP;return mintimestamp}function createFeed(json,user){return $$feedMap.create(json,user)}function DashboardFeedFilter(){return!0}function singlePageFilter(message,pageValue){return message.nfId==pageValue.page||message.whShrLst&&message.whShrLst[0].nfId==pageValue.page}function GroupNewsFeedFilter(message,pageValue){return!!message.grpId&&message.grpId==pageValue.page}function CurrentUserPageFilter(tempData,pageValue){return pageValue||(pageValue=getCurrentPageValue()),pageValue.page===tempData.uId||tempData.fndId&&pageValue.page===tempData.fndId?!0:!(!tempData.orgFd||pageValue.page!==tempData.orgFd.uId)}function processCurrentUserFriendFeed(feedData){processCurrentUserFeed(feedData)}function processCurrentUserFeed(feedData){processAllFeed(feedData,CurrentUserPageFilter,{processWhoShare:function(tempData,$feed,pageValue){var _d1,_d;tempData.uId===pageValue.page&&tempData.orgFd&&(_d=createFeed(tempData.orgFd),_d1=createFeed(tempData),_d1.shares(_d),$feed.save(_d1.getMapKey(),_d1))}})}function processGroupNewsFeed(feedData){processAllFeed(feedData,GroupNewsFeedFilter)}function processDashboardFeed(feedData){processAllFeed(feedData,DashboardFeedFilter)}function processSpecialFeed(json){var _d;feedList.special||(feedList.special=$$stackedMap.createNew($$feedMap.getSortIndex(),"desc")),_d=createFeed(json),feedList.special.save(_d.getMapKey(),_d)}function processAllFeed(feedData,filterFunc,options){options=options||{},angular.isFunction(filterFunc)||(filterFunc=function(){return!0});var message=angular.isArray(feedData)?feedData:feedData.newsFeedList;if(angular.isArray(message))for(var _d,_d1,tempData,pageValue=getCurrentPageValue(),$feed=getIndexedFeed(),i=0;i<message.length;i++)tempData=message[i],tempData.fc>0?processSpecialFeed(message[i]):filterFunc(tempData,pageValue)&&(tempData.deleted?deleteFromIndexedFeed(tempData.nfId):tempData.whShrLst||tempData.orgFd?options.processWhoShare&&angular.isFunction(options.processWhoShare)?options.processWhoShare.call(null,tempData,$feed,pageValue):(tempData.orgFd?(_d=createFeed(tempData),(_d1=_getFeed(tempData.orgFd.nfId))||(_d1=createFeed(tempData.orgFd))):(_d=createFeed(tempData.whShrLst[0]),(_d1=_getFeed(tempData.nfId))||(_d1=createFeed(tempData))),_d.shares(_d1),$feed.save(_d.getMapKey(),_d),saveOrginalFeedIntoRemoved(_d1,_d.getKey())):(_d=createFeed(tempData),$feed.save(_d.getMapKey(),_d)))}function processSingleFeed(feedData){processAllFeed(feedData,singlePageFilter)}function getCurrentPageFilter(pageValue){switch(pageValue||(pageValue=getCurrentPageValue()),pageValue.action){case OTYPES.TYPE_MY_NEWS_FEED:case OTYPES.TYPE_FRIEND_NEWSFEED:return CurrentUserPageFilter;case OTYPES.TYPE_GROUP_NEWS_FEED:return GroupNewsFeedFilter;case OTYPES.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:return singlePageFilter;case OTYPES.TYPE_NEWS_FEED:default:return DashboardFeedFilter}}function pushFeed(feedData){var pageValue=getCurrentPageValue();switch(pageValue.action){case OTYPES.TYPE_MY_NEWS_FEED:processCurrentUserFeed(feedData);break;case OTYPES.TYPE_FRIEND_NEWSFEED:processCurrentUserFriendFeed(feedData);break;case OTYPES.TYPE_GROUP_NEWS_FEED:processGroupNewsFeed(feedData);break;case OTYPES.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:processSingleFeed(feedData);break;case OTYPES.TYPE_NEWS_FEED:default:processDashboardFeed(feedData)}}function processIncomingFeed(){for(var tempData;incomingFeedData.length&&pushInIncomingFeed;)tempData=incomingFeedData.shift(),tempData.callback?tempData.callback.call(null,tempData,!0):pushFeed([tempData])}function saveOrginalFeedIntoRemoved(feed,reference,removedMap){removedMap||(removedMap=getIndexedRemovedFeed()),feed.reference=reference,removedMap.save(feed.getMapKey(),feed)}function _getRemovedFeed(nfId,removedMap){return removedMap||(removedMap=getIndexedRemovedFeed()),nfId=$$feedMap.getPrefix()+nfId,removedMap.get(nfId)}function _getFeed(nfId){var $feed;return $feed=getIndexedFeed(),nfId=$$feedMap.getPrefix()+nfId,$feed.get(nfId)}function _addFeed(feed){var $feed=getIndexedFeed();$feed.add(feed.getMapKey(),feed)}function deleteFeed(key,$feed){return $feed||($feed=getIndexedFeed()),$feed.remove($$feedMap.makeKey(key))}function synchLike(nfId,il,loc){if(nfId){var f=getFeed(nfId);return f&&f.isSingleContentFeed()?(f.setTotalLikes(loc,il),FEED_SCOPES[nfId]):void 0}}function synchComment(nfId,total,is){if(nfId){var f=FEED_SCOPES[nfId];return f&&f.feed.isSingleContentFeed()?(f.feed.setTotalComment(total,is),f):void 0}}function processUpdates(json){var f=_getFeed(json.nfId),scope=FEED_SCOPES[json.nfId];if(f&&scope){switch(json.actn){case OTYPES.TYPE_UPDATE_EDIT_STATUS:f.update(json);break;case OTYPES.TYPE_UPDATE_LIKE_STATUS:case OTYPES.TYPE_UPDATE_UNLIKE_STATUS:f.setTotalLikes(json.loc),f.setFeedTopMessage();break;case OTYPES.TYPE_UPDATE_ADD_STATUS_COMMENT:case OTYPES.TYPE_UPDATE_DELETE_STATUS_COMMENT:f.setTotalComment(json.loc),f.setFeedTopMessage()}return scope}}function updateDeleteStatus(json){deleteFeed(json.nfId)}function updateShareStatus(json,forceProcess,selfShared,currentUser){if(pushInIncomingFeed&&!forceProcess){json.callback=updateShareStatus;var filterFunc=getCurrentPageFilter();return void(filterFunc.call(null,json.newsFeed)&&incomingFeedData.push(json))}var key=json.newsFeed.orgFd&&json.newsFeed.orgFd.nfId;if(key){var f=_getFeed(key),$removed=getIndexedRemovedFeed();if(f){if(selfShared)return f.setActivity(json.newsFeed.orgFd),FEED_SCOPES[f.getKey()];saveOrginalFeedIntoRemoved(f,json.newsFeed.nfId,$removed),deleteFeed(f.getKey())}else if(f=_getRemovedFeed(key,$removed)){var filterFunc=getCurrentPageFilter();return void processAllFeed([json.newsFeed],filterFunc,{processWhoShare:function(message,$feed,pageValue){var _d,orginal=_getFeed(f.reference);if(!orginal)return void pushFeed([message]);if(pageValue.page!=OTYPES.TYPE_FRIEND_NEWSFEED&&pageValue.page!=OTYPES.TYPE_MY_NEWS_FEED){if(f.update(message,!0),selfShared)return f.addShareUser(currentUser),orginal.updateShareMessage(),orginal.setActivity(message),FEED_SCOPES[orginal.getKey()];_d=createFeed(message),_d.setActivity(message.orgFd),deleteFeed(f.reference),_d.shares(f),$feed.save(_d.getMapKey(),_d)}}})}pushFeed([json.newsFeed])}}function updateAddStatus(json){if(json.imageList||1!==json.type||(json.imageList=[json]),pushInIncomingFeed){var filterFunc=getCurrentPageFilter();filterFunc.call(null,json,getCurrentPageValue())&&incomingFeedData.push(json)}else pushFeed([json])}function _process(json){var i,ignore=!1,feedData=angular.isArray(json)?json[0]:json;if(ignoreActions.length)for(i=0;i<ignoreActions.length;i++)ignoreActions[i].action===feedData.actn&&(ignore=ignoreActions[i].callback.call(null,feedData));return processorFunctions[feedData.actn]&&!ignore?processorFunctions[feedData.actn].call(null,feedData):void 0}function getFeed(key){return _getFeed(key)}function addIgnoreFilter(action,callback){var key=helper.getUniqueID();return ignoreActions.push({key:key,action:action,callback:callback}),key}function removeIgnoreFilter(key){for(var idx=-1,i=0;i<ignoreActions.length;i++)ignoreActions[i].key===key&&(idx=i);return-1!=idx?ignoreActions.splice(idx,1):[]}function setFactoryKey(key){feed_index=key,feedList.hasOwnProperty(feed_index)||(feedList[feed_index]={data:$$stackedMap.createNew($$feedMap.getSortIndex(),"desc"),removed:$$stackedMap.createNew(),no_more_feed:!1})}function process(json){return _process(json)}function getFeedFilter(){return function(m){return!!processorFunctions[m.actn]}}function getRawFeeds(){return getIndexedFeed().all()}function getFeeds(){var $feed=getIndexedFeed();return $feed.all()}function noMoreFeed(){return feedList.hasOwnProperty(feed_index)?feedList[feed_index].no_more_feed:!1}function requestForFeed(ob){return ob=angular.copy(ob||{}),ob.lmt=ob.lmt||AC.FEED_LIMIT,$$connector.send(ob,OTYPES.REQUEST_TYPE.REQUEST)}function initFeedRequest(ob){ob=angular.copy(ob||{}),ob.lmt=10,ob.scl=2,requestForFeed(ob)}function requestForMoreFeed(ob,scl){var timestamp=getMinTm();return ob=angular.copy(ob||{}),ob.scl=scl||2,ob.tm=timestamp?timestamp:MIN_TIMESTAMP,requestForFeed(ob)}function getSingleFeed(feedId,whoShare){var payload={actn:OTYPES.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:feedId},deffer=$q.defer(),feedObj=getFeed(feedId);return feedObj?deffer.resolve(feedObj):$$connector.request(payload,OTYPES.REQUEST_TYPE.REQUEST).then(function(feedData){if(feedData.sucs===!0){var message=angular.isArray(feedData)?feedData:feedData.newsFeedList[0];if(whoShare&&message.orgFd){if(message.orgFd){feedObj=createFeed(message);var orginalFeed=createFeed(message.orgFd);feedObj.shares(orginalFeed)}}else feedObj=createFeed(message);if(feedObj){var $feed=getIndexedFeed();$feed.save(feedObj.getMapKey(),feedObj)}deffer.resolve(feedObj)}else deffer.resolve(!1)},function(errData){deffer.reject(errData)}),deffer.promise}function addFeed(ob,user,content_shared){var _d,defer=$q.defer(),lengthPadding=0,$feed=getIndexedFeed(),nfId=helper.getUniqueID();ob.stsTags=[];var tempText="",tempText="";ob.text&&(tempText=ob.text.replace(/##([\d]+)##/g,function(match,$1,index){var offset;return offset=index-lengthPadding,ob.stsTags.push({pstn:offset,utId:$1}),lengthPadding+=match.length,""}),ob.text=tempText),content_shared?_d=ob.feed?ob.feed:getFeed(ob.nfId):(_d=createFeed({nfId:nfId,fpvc:ob.fpvc,sts:ob.text,lat:ob.lat||9999,lng:ob.lng||9999,grpId:ob.group||"",friendId:ob.friend||"",fndId:ob.friend||"",mdLst:ob.mdIds,isNew:1,pending:!0,lctn:ob.lctn||"",lnkDmn:ob.lnkDmn||"",lnkDsc:ob.lnkDsc||"",lnkTtl:ob.lnkTtl||"",lnkURL:ob.lnkURL||"",lnlImgURL:ob.lnlImgURL||""},user),$feed.save(_d.getMapKey(),_d));var newFeedData={};if(ob.cntntIDLst&&(newFeedData.cntntIDLst=ob.cntntIDLst),ob.group&&(newFeedData.grpId=ob.group),ob.friend&&(newFeedData.fndId=ob.friend),ob.lctn&&(newFeedData.lctn=ob.lctn.utf8Encode()),ob.lnkDmn&&(newFeedData.lnkDmn=ob.lnkDmn.utf8Encode()),ob.lnkDsc&&(newFeedData.lnkDsc=ob.lnkDsc.utf8Encode()),ob.lnkTtl&&(newFeedData.lnkTtl=ob.lnkTtl.utf8Encode()),ob.lnkURL&&(newFeedData.lnkURL=ob.lnkURL.utf8Encode()),ob.lnlImgURL&&(newFeedData.lnlImgURL=ob.lnlImgURL.utf8Encode()),ob.stsTags.length&&(newFeedData.stsTags=ob.stsTags),newFeedData.actn=OTYPES.TYPE_ADD_STATUS,ob.images&&ob.images.length>0)if(1===ob.images.length)newFeedData.type=OTYPES.NEWS_FEED_TYPE_IMAGE,newFeedData=angular.extend({},newFeedData,ob.images[0].getAuthData());else{newFeedData.actn=OTYPES.TYPE_ADD_MULTI_IMAGE,newFeedData.type=OTYPES.NEWS_FEED_TYPE_MULTIPLE_IMAGE,newFeedData.imageList=[];for(var i=0,lt=ob.images.length;lt>i;i++)newFeedData.imageList.push(ob.images[i].getAuthData())}else if(ob.videos&&ob.videos.length>0){newFeedData.mdaCntntDTO={albId:fileUploadService.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:AC.NEWS_FEED_MEDIA_TYPE_VIDEO,lnkT:AC.NEWS_FEED_MEDIA_TYPE_VIDEO},newFeedData.type=OTYPES.NEWS_FEED_TYPE_VIDEO;for(var i=0,lt=ob.videos.length;lt>i;i++)newFeedData.mdaCntntDTO.mdaLst.push(ob.videos[i].getAuthData(!0)),0===i&&(newFeedData.mdaCntntDTO.htgLst=newFeedData.mdaCntntDTO.mdaLst[0].htgLst)}else if(ob.audios&&ob.audios.length>0){newFeedData.mdaCntntDTO={albId:fileUploadService.getUploadAlbum(),htgLst:[],mdaLst:[],mdaT:AC.NEWS_FEED_MEDIA_TYPE_AUDIO,lnkT:AC.NEWS_FEED_MEDIA_TYPE_AUDIO},newFeedData.type=OTYPES.NEWS_FEED_TYPE_AUDIO;for(var i=0,lt=ob.audios.length;lt>i;i++)newFeedData.mdaCntntDTO.mdaLst.push(ob.audios[i].getAuthData(!0)),0===i&&(newFeedData.mdaCntntDTO.htgLst=newFeedData.mdaCntntDTO.mdaLst[0].htgLst)}else newFeedData.actn=OTYPES.TYPE_ADD_STATUS,content_shared?newFeedData.type=ob.audio?OTYPES.NEWS_FEED_TYPE_AUDIO:OTYPES.NEWS_FEED_TYPE_VIDEO:newFeedData.type=OTYPES.NEWS_FEED_TYPE_STATUS;return ob.mdIds&&(newFeedData.mdIds=ob.mdIds),ob.tFrndIds&&(newFeedData.tFrndIds=ob.tFrndIds),newFeedData.vldt=ob.vldt||"-1",newFeedData.lng=ob.lng||9999,newFeedData.lat=ob.lat||9999,newFeedData.sts=ob.text.utf8Encode(),newFeedData.fpvc=ob.fpvc,RingLogger.print(newFeedData,RingLogger.tags.FEED),$$connector.request(newFeedData,OTYPES.REQUEST_TYPE.UPDATE).then(function(json){$rootScope.$broadcast(SystemEvents.FILE_UPLOAD.UPLOADS_POSTED),RingLogger.debug(json),json.sucs?(content_shared?_d&&_d.share(json.mdaCntntLst[0].is,json.mdaCntntLst[0].ns):($feed.remove(_d.getMapKey()),json.type===OTYPES.TYPE_SINGLE_IMAGE_STATUS&&(json.imageList=[json]),pushFeed([json]),Ringalert.show(json,"success")),defer.resolve(json)):(content_shared||($feed.remove(_d.getMapKey()),Ringalert.show(json,"error")),defer.reject(json))},function(reason){content_shared||($feed.remove(_d.getMapKey()),Ringalert.show(json,"error")),defer.reject(json)}),defer.promise}function shareFeed(ob){if(ob.addShare)return addFeed(ob,ob.user,!0);var defer=$q.defer(),data={actn:OTYPES.ACTION_SHARE_STATUS,sfId:ob.feed.getKey(),type:2,sts:ob.text.utf8Encode()};return ob.mdIds&&(data.mdIds=ob.mdIds),ob.tFrndIds&&(data.tFrndIds=ob.tFrndIds),ob.location&&(ob.location.description&&(data.lctn=ob.location.description.utf8Encode()),ob.location.lat&&(data.lat=ob.location.lat,data.lng=ob.location.lng)),$$connector.request(data,OTYPES.REQUEST_TYPE.UPDATE).then(function(json){json.sucs?(updateShareStatus(json,!0,!0,Auth.currentUser()),ob.feed.share(!0),defer.resolve(json)):defer.reject(json)},function(reason){defer.reject(reason)}),defer.promise}function deleteFeedService(user,key){var defer=$q.defer(),feed=_getFeed(key),$feed=getIndexedFeed();return feed?(feed.user().isCurrentUser(user.getKey())||setTimeout(function(){defer.reject("You are not authorized to delete this feed.")},100),feed!==!1?(deleteFeed(feed.getKey(),$feed),$$connector.request({actn:OTYPES.TYPE_DELETE_STATUS,nfId:key},OTYPES.REQUEST_TYPE.UPDATE).then(function(json){json.sucs?defer.resolve(json):(_addFeed(feed),defer.reject(json))},function(json){_addFeed(feed),defer.reject(json)})):setTimeout(function(){defer.reject("Feed Not Found!")},100),defer.promise):(setTimeout(function(){defer.reject("Can't Delete Invalid Feed")}),defer.promise)}function updateFeed(user,key,status,location,ogData,feedEmotions,taggedFriends){var defer=$q.defer(),feed=_getFeed(key);feed.getMapKey();if(feed.user().isCurrentUser(user.getKey())){var tempText,oldText=feed.text(),oldLocation=feed.getLocationInfo(),oldOgData=feed.getOgData(),oldEmotions=feed.getFeelings(),stsTags=[],lengthPadding=0;status&&(tempText=status.replace(/##([\d]+)##/g,function(match,$1,index){var offset;return offset=index-lengthPadding,ob.stsTags.push({pstn:offset,utId:$1}),lengthPadding+=match.length,""}),status=tempText);var dataToUpdate={actn:OTYPES.TYPE_EDIT_STATUS,nfId:key,sts:status.utf8Encode()};stsTags.length&&(dataToUpdate.stsTags=stsTags),location=location||{},dataToUpdate.lctn=location.description?location.description.utf8Encode():"",dataToUpdate.lat=location.lat||9999,dataToUpdate.lng=location.lng||9999;var shouldUpdateLinkShareInfo=!feed.hasOgData()||feed.getLinkUrl()!=ogData.url;shouldUpdateLinkShareInfo&&(dataToUpdate.lnkDmn=ogData.domain||"",dataToUpdate.lnkDsc=ogData.description?ogData.description.utf8Encode():"",dataToUpdate.lnkTtl=ogData.title?ogData.title.utf8Encode():"",dataToUpdate.lnkURL=ogData.url?ogData.url.utf8Encode():"",dataToUpdate.lnlImgURL=ogData.image||"");var shouldUpdateFeedEmotion=!1;return feedEmotions&&feedEmotions.id?(dataToUpdate.mdIds=[feedEmotions.id],shouldUpdateFeedEmotion=!0):(dataToUpdate.mdIds=[],shouldUpdateFeedEmotion=!0),taggedFriends&&(taggedFriends.removed&&(dataToUpdate.rTFrndIds=taggedFriends.removed),taggedFriends["new"]&&(dataToUpdate.tFrndIds=taggedFriends["new"])),feed!==!1&&(feed.setText(status,stsTags),feed.setLocationInfo(location),shouldUpdateFeedEmotion&&feed.setFeelings(feedEmotions),shouldUpdateLinkShareInfo&&feed.setOgData(ogData),$$connector.request(dataToUpdate,OTYPES.REQUEST_TYPE.UPDATE).then(function(json){json.sucs===!1?(feed.setText(oldText),feed.setLocationInfo(oldLocation),shouldUpdateFeedEmotion&&feed.setFeelings(oldEmotions),shouldUpdateLinkShareInfo&&feed.setOgData(oldOgData),defer.reject(json)):defer.resolve(json)},function(json){feed.setText(oldText),feed.setLocationInfo(oldLocation),shouldUpdateFeedEmotion&&feed.setFeelings(oldEmotions),shouldUpdateLinkShareInfo&&feed.setOgData(oldOgData),defer.reject(json)})),defer.promise}}function moreFeedText(feed){var defer=$q.defer(),payload={actn:OTYPES.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS,nfId:feed.getKey()};return $$connector.request(payload,OTYPES.REQUEST_TYPE.REQUEST).then(function(json){json.sucs?(json.newsFeedList?feed.parseMoreText(json.newsFeedList[0]):feed.parseMoreText(json),defer.resolve(json)):(Ringalert.show(json,"error"),defer.reject())},function(reason){Ringalert.show(reason,"error"),defer.reject()}),defer.promise}function getTagUsers(feed){return $$connector.pull({actn:OTYPES.TYPE_TAG_USER_LIST,nfId:feed.getKey()},OTYPES.REQUEST_TYPE.REQUEST)}function getSingleFeedPageKey(feedId){return OTYPES.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS+"."+feedId}function getWhoShareFeedId(rawFeedData){var message=angular.isArray(rawFeedData)?rawFeedData:rawFeedData.newsFeedList;return message.length>0&&message[0].whShrLst[0]?message[0].whShrLst[0].nfId:!1}var OTYPES=OPERATION_TYPES.SYSTEM,AC=APP_CONSTANTS,feed_index=OTYPES.TYPE_NEWS_FEED+".all",feedList={},incomingFeedData=[],pushInIncomingFeed=!1,ignoreActions=[],processorFunctions={},FEED_SCOPES={};return processorFunctions[OTYPES.TYPE_NEWS_FEED]=pushFeed,processorFunctions[OTYPES.TYPE_MY_NEWS_FEED]=pushFeed,processorFunctions[OTYPES.TYPE_FRIEND_NEWSFEED]=pushFeed,processorFunctions[OTYPES.TYPE_GROUP_NEWS_FEED]=pushFeed,processorFunctions[OTYPES.TYPE_UPDATE_ADD_STATUS]=updateAddStatus,processorFunctions[OTYPES.ACTION_UPDATE_SHARE_STATUS]=updateShareStatus,processorFunctions[OTYPES.TYPE_UPDATE_DELETE_STATUS]=updateDeleteStatus,processorFunctions[OTYPES.TYPE_UPDATE_EDIT_STATUS]=processUpdates,processorFunctions[OTYPES.TYPE_UPDATE_LIKE_STATUS]=processUpdates,processorFunctions[OTYPES.TYPE_UPDATE_UNLIKE_STATUS]=processUpdates,processorFunctions[OTYPES.TYPE_UPDATE_ADD_STATUS_COMMENT]=processUpdates,processorFunctions[OTYPES.TYPE_UPDATE_DELETE_STATUS_COMMENT]=processUpdates,{init:init,addScope:function(nfId,$scope){FEED_SCOPES[nfId]=$scope},removeScope:function(nfId){FEED_SCOPES[nfId]&&delete FEED_SCOPES[nfId]},getFeed:getFeed,updateTime:updateTime,pushFeed:pushFeed,processIncomingFeed:processIncomingFeed,setpushInIncomingFeed:function(val){pushInIncomingFeed=!!val},getPushIncomingFeed:function(){return pushInIncomingFeed},hasUnprocessedFeed:function(){return incomingFeedData.length},addIgnoreFilter:addIgnoreFilter,removeIgnoreFilter:removeIgnoreFilter,setFactoryKey:setFactoryKey,createFeed:createFeed,process:process,getFeedFilter:getFeedFilter,noMoreFeed:noMoreFeed,requestForFeed:requestForFeed,initFeedRequest:initFeedRequest,getSingleFeed:getSingleFeed,requestForMoreFeed:requestForMoreFeed,getRawFeeds:getRawFeeds,getFeeds:getFeeds,addFeed:addFeed,shareFeed:shareFeed,deleteFeed:deleteFeedService,updateFeed:updateFeed,reset:reset,moreFeedText:moreFeedText,getSingleFeedPageKey:getSingleFeedPageKey,getWhoShareFeedId:getWhoShareFeedId,getTagUsers:getTagUsers,setSortBy:setSortBy,getCurrentPageValue:getCurrentPageValue,hasSpecialFeed:function(){var pageValue=getCurrentPageValue();return OTYPES.TYPE_NEWS_FEED===pageValue.action&&feedList.special&&feedList.special.length()>0},getSpecialFeedList:function(){return feedList.special&&feedList.special.all()},synchLike:synchLike,synchComment:synchComment}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config","ringid.notification"])}feedApp.factory("feedFactory",feedFactory),feedFactory.$inject=["fileUploadService","$$connector","$$q","$$stackedMap","$$feedMap","utilsFactory","OPERATION_TYPES","APP_CONSTANTS","Ringalert","Auth","MIN_TIMESTAMP","$rootScope","SystemEvents"]}(),function(){"use strict";function rgFeedSubscriber($$connector,feedFactory,$window,$$rgsyncher,OPERATION_TYPES,REASON_CODES,$rootScope){return function(cscope,element,attrs){function processFeed(message){var targetScope;ignored||(ignored=!0,scope.addIgnore(),setTimeout(function(){$rootScope.$broadcast("FIRST_FEED_RECEIVED")},1e3)),!message.sucs&&message.rc>0&&message.rc==REASON_CODES.NO_MORE_FEED?scope.setNoMoreFeed(!0):targetScope=feedFactory.process(message),targetScope?targetScope.$rgDigest():(counter_current++,scope.feeds=feedFactory.getFeeds(),scope.busy&&(scope.busy=!1,scope.clearRequestTimer()),timeout_set===!1&&(timeout_set=!0,requestAnimationFrame(function(){scope.$rgDigest(),timeout_set=!1})))}var scope=cscope.$parent,counter_current=0,timeout_set=(OPERATION_TYPES.SYSTEM,!1),ignored=!1,subKey=$$connector.subscribe(processFeed,{filter:feedFactory.getFeedFilter(),callWithUnresolved:!0}),syncher_key=$$rgsyncher.add(function(){feedFactory.requestForFeed(scope.params,1)});scope.$on("$destroy",function(){$$connector.unsubscribe(subKey),feedFactory.reset(),$$rgsyncher.remove(syncher_key),ignored&&scope.removeIgnore()})}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.directive("rgFeedSubscriber",rgFeedSubscriber),rgFeedSubscriber.$inject=["$$connector","feedFactory","$window","$$rgsyncher","OPERATION_TYPES","REASON_CODES","$rootScope"]}(),function(){"use strict";function feedImage(utilsFactory,SystemEvents,$compile){function getHeightByWidth(ob,width){return width*ob.height/ob.width}function getImageTemplate(index,template){return'<div class="img'+(index+1)+'" style="background-image:url(\'{{::feedimages['+index+'].value.src(600)}}\')" rg-ringbox="true"ringbox-controller="RingBoxImagePopupController" ringbox-type="remote" ringbox-animation="true" ringbox-target="pages/partials/notification/'+(template||"image-popup.html")+'" ringbox-data="getImageData(feedimages['+index+'].value, feed)"></div>'}var layoutHtmls={layout_0:'<div class="grid">'+getImageTemplate(0)+'</div><div class="grid">'+getImageTemplate(1)+getImageTemplate(2)+"</div>",layout_2:'<div class="grid">'+getImageTemplate(0)+getImageTemplate(1)+'</div><div class="grid">'+getImageTemplate(2)+"</div>",layout_4:'<div class="grid">'+getImageTemplate(0)+getImageTemplate(1)+"</div>",layout_5:getImageTemplate(0)};layoutHtmls.layout_1=layoutHtmls.layout_0,layoutHtmls.layout_3=layoutHtmls.layout_2,layoutHtmls.layout_6=layoutHtmls.layout_5;var layoutHtmls2={layout_0:'<div class="grid">'+getImageTemplate(0,"image-popup-special.html")+'</div><div class="grid">'+getImageTemplate(1,"image-popup-special.html")+getImageTemplate(2,"image-popup-special.html")+"</div>",layout_2:'<div class="grid">'+getImageTemplate(0,"image-popup-special.html")+getImageTemplate(1,"image-popup-special.html")+'</div><div class="grid">'+getImageTemplate(2,"image-popup-special.html")+"</div>",layout_4:'<div class="grid">'+getImageTemplate(0,"image-popup-special.html")+getImageTemplate(1,"image-popup-special.html")+"</div>",layout_5:getImageTemplate(0,"image-popup-special.html")};return layoutHtmls2.layout_1=layoutHtmls2.layout_0,layoutHtmls2.layout_3=layoutHtmls2.layout_2,layoutHtmls2.layout_6=layoutHtmls2.layout_5,{restrict:"A",scope:!0,link:function(scope,element,attr){var layouts;if("shared"===attr.feedImage&&(scope.feed=scope.feed.getOrginalFeed()),scope.layout_id=scope.feed.getImageLayout(),scope.feedimages=scope.feed.getImages(),5===scope.layout_id&&(scope.feedimages[0].value.offset().width<600&&scope.feedimages[0].value.offset().height<400?scope.layout_id=6:getHeightByWidth(scope.feedimages[0].value.offset(),600)<400&&(scope.layout_id=6)),element.addClass("img-layout-"+scope.layout_id),scope.feedimages.length){layouts=attr.popupTemplate?layoutHtmls2:layoutHtmls;var html=$compile(layouts["layout_"+scope.layout_id])(scope);
scope.feed.getTotalImage()>3&&(html[1].lastChild.innerHTML='<div class="img-bg-opa"></div>    <div class="img-bg-counter">+'+(scope.feed.getTotalImage()-3)+"</div>"),element.html(""),element.append(html)}}}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.directive("feedImage",feedImage),feedImage.$inject=["utilsFactory","SystemEvents","$compile"]}(),function(){"use strict";function rgMoreFeed(feedFactory,SystemEvents){return{restrict:"A",link:function(scope,element,attr){function setFeedText(){var content=feed.getDynamicText();content.toString()?(element.html(content.toString()),scope.editorEnabled?element.addClass("ng-hide"):element.removeClass("ng-hide")):element.addClass("ng-hide"),SetShowMoreButton()}function SetShowMoreButton(){if(feed.showMore()&&!updatedText){var moreel=angular.element('<span class="showpointer showmore"> Show More</span>');element.append(moreel),moreel.bind("click",moreFeedText),scope.$on("$destroy",function(){moreel&&(moreel.unbind("click"),moreel=null)})}}function moreFeedText(){feedFactory.moreFeedText(feed).then(function(json){scope[attr.rgMoreFeed]=feed,element.html(feed.getDynamicText().toString()),moreel.unbind("click"),moreel=null,scope.$rgDigest(),updatedText=!0})}var feed=scope.$eval(attr.rgMoreFeed),updatedText=!1,count=0;setFeedText(),scope.$on(SystemEvents.FEED.UPDATED,function(event,data){data.id===feed.getKey()&&setFeedText()}),scope.$on(SystemEvents.FEED.RESET,function(event,f){f.getKey()===feed.getKey()&&(feed=f,setFeedText())}),scope.$watch("feed.text()",function(oldVal,newVal){count>0&&setFeedText(),count++}),scope.$watch("editorEnabled",function(oldVal,newVal){setFeedText()})}}}angular.module("ringid.feed").directive("rgMoreFeed",rgMoreFeed),rgMoreFeed.$inject=["feedFactory","SystemEvents"]}(),function(){"use strict";function rgIncomingFeed(feedFactory,$window,utilsFactory,OPERATION_TYPES){return{restrict:"A",link:function(scope,element,attr){function position(){var diff,top,scrollP=utilsFactory.viewport.yo;extraHeight>0&&(top=extraHeight+75,diff=top-scrollP,diff>0&&(75>diff?element.css("top","75px"):element.css("top",diff+"px")))}function updateClass(){feedFactory.hasUnprocessedFeed()?element.hasClass("active")||element.addClass("active"):element.removeClass("active")}function update(){utilsFactory.viewport.yo>500?feedFactory.setpushInIncomingFeed(!0):feedFactory.hasUnprocessedFeed()&&previousScrollTop>utilsFactory.viewport.yo?(feedFactory.processIncomingFeed(),feedFactory.setpushInIncomingFeed(!1),updateClass()):feedFactory.setpushInIncomingFeed(!1),element.hasClass("active")&&position(),previousScrollTop=utilsFactory.viewport.yo}var previousScrollTop,windowEl=angular.element($window),pageValue=feedFactory.getCurrentPageValue(),extraHeight=0,OTYPES=OPERATION_TYPES.SYSTEM;switch(pageValue.action){case OTYPES.TYPE_MY_NEWS_FEED:case OTYPES.TYPE_FRIEND_NEWSFEED:extraHeight=492;break;case OTYPES.TYPE_GROUP_NEWS_FEED:extraHeight=250;break;case OTYPES.TYPE_SINGLE_STATUS_NOTIFICATION_OR_SHARE_DETAILS:case OTYPES.TYPE_NEWS_FEED:default:extraHeight=0}scope.$watch(feedFactory.hasUnprocessedFeed,function(newV,oldV){newV>oldV&&updateClass()}),element.on("click",function(){feedFactory.processIncomingFeed(),feedFactory.setpushInIncomingFeed(!1),updateClass(),utilsFactory.resetScroll(),utilsFactory.animateScroll(),scope.setFeed(),scope.$rgDigest()}),windowEl.bind("scroll",update);var cleanupEvents=function(){windowEl.unbind("scroll",update),element.off("click")};updateClass(),scope.$on("$destroy",cleanupEvents)}}}angular.module("ringid.feed").directive("rgIncomingFeed",rgIncomingFeed),rgIncomingFeed.$inject=["feedFactory","$window","utilsFactory","OPERATION_TYPES"]}(),function(){"use strict";function feedTimoutOption(){return{restrict:"E",replace:!0,templateUrl:"pages/partials/feed-timeout-option.html",link:function(scope){scope.$rgDigest()},controller:["$scope",function($scope){$scope.rows=[1,9,17],$scope.cols=[0,1,2,3,4,5,6,7],$scope.lastCols=[25,26,27,28,29,30],$scope.select=function(v){angular.isFunction($scope.onSelect)&&$scope.onSelect({item:v}),$scope.close(),$scope.$parent.$rgDigest()}}]}}function feedTimeoutSelect(){return function(scope,element,attr){element.on("click",function(e){e.stopPropagation(),scope.select(attr.feedTimeoutSelect)}),scope.$on("$destroy",function(){element.off("click")})}}function feedTimeoutMenu($document,$compile){return{restrict:"A",scope:{onSelect:"&ringOnOptionSelect",value:"=selectedValue"},link:function(scope,element,attr){function checkClickedOnElement(e){e.target!=element[0]&&e.target.parentNode!=element[0]&&e.target.parentNode.parentNode!=element[0]&&"pt-top"!=e.target.className&&scope.close()}var menuDom,isOpen=!1;scope.close=function(){menuDom&&menuDom.remove(),menuDom=null,isOpen=!1,$document.off("click",checkClickedOnElement)},scope.$watch("value",function(newval,oldval){parseInt(newval)>-1?element.addClass("active"):element.removeClass("active")}),element.on("click",function(event){return isOpen?(scope.close(),""):(menuDom||(menuDom=$compile(angular.element("<feed-timout-option></feed-timout-option>"))(scope)),element.after(menuDom),isOpen=!0,void $document.on("click",checkClickedOnElement))}),scope.$on("$destroy",function(){element.off("click"),$document.off("click",checkClickedOnElement)})}}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){return}feedApp.directive("feedTimeoutSelect",feedTimeoutSelect),feedApp.directive("feedTimoutOption",feedTimoutOption),feedApp.directive("feedTimeoutMenu",feedTimeoutMenu),feedTimeoutMenu.$inject=["$document","$compile"]}(),function(){"use strict";function feedRepeat($parse,$compile,$templateCache,$http,helper,$rootScope,SystemEvents,$sniffer,feedFactory){function compile(element,attr){return function($scope,$element,$attr,ctrl,$transclude){function deferFeedHeight(key){fastdom.defer(3,function(){lastBlockMap&&lastBlockMap[key]&&(lastBlockMap[key].height=lastBlockMap[key].clone.offsetHeight+12)})}function eventTranstionEnd(){this.removeEventListener(prefix+"TransitionEnd",eventTranstionEnd),this.removeEventListener("transitionend",eventTranstionEnd),this.parentNode.removeChild(this)}function update(collection){RingLogger.print("update called","RGREPEAT");var index,value,childScope,cellIndex,trackID,block,nextNode,parent,clone,length=collection.length,prevNode=[],nextBlockMap=Object.create(null),special=0;if(onFeedProcesing=!0,readyToFeed&&cells){if(0==collection.length&&first)return void($scope.noMoreFeed&&requestAnimationFrame(function(){$scope.$rgDigest()}));for(RingLogger.info("first called: ("+collection.length+")"+(window.performance.now()-t0),RingLogger.tags.DIGEST),$rootScope.$$postDigest(function(){var index,value,block;for(index=0;index<collection.length;index++)value=collection[index],trackID=value.key,lastBlockMap[trackID]&&(block=lastBlockMap[trackID],block.childHead&&(block.scope.$$childHead=block.childHead))}),feedFactory.hasSpecialFeed()&&(specials=feedFactory.getSpecialFeedList(),special=specials.length),index=0;length>index;index++)cellIndex=(index+special)%column,value=collection[index],trackID=value.key,lastBlockMap[trackID]?(block=lastBlockMap[trackID],block.cell=cellIndex,delete lastBlockMap[trackID]):(childScope=$scope.$new(),childScope[valueIdentifier]=value,block={},block.clone=null,block.cell=cellIndex,block.scope=childScope,block.height=110,block.key=trackID,block.serial=-1),nextBlockMap[trackID]=block;for(index=0;column>index;index++)prevNode[index]||(prevNode[index]=0==index&&cells[index].element.firstElementChild?cells[index].element.firstElementChild:cells[index].element.firstChild);for(trackID in lastBlockMap)lastBlockMap[trackID]&&(block=lastBlockMap[trackID],block.clone.style.opacity=0,block.clone.RG_DELETE=!0,block.clone.addEventListener(prefix+"TransitionEnd",eventTranstionEnd),block.clone.addEventListener("transitionend",eventTranstionEnd),block.scope.$destroy());var defer=2,nodesToBeAppeard=[];if(specialTpl&&special>0)for(index=0;special>index;index++)value=specials[index],trackID=value.key,cellIndex=index%column,nextNode=prevNode[cellIndex],parent=nextNode.parentNode,specialBlockMap[trackID]?(block=specialBlockMap[trackID],clone=block.clone,block.cell=cellIndex,clone!=nextNode.nextSibling&&parent.insertBefore(clone,nextNode.nextSibling),prevNode[block.cell]=clone):(childScope=$scope.$new(),childScope[valueIdentifier]=value.value,clone=$compile(specialTpl)(childScope),parent.insertBefore(clone[0],nextNode.nextSibling),nextNode=clone[0],nextNode.style.opacity=1,block={},block.clone=clone[0],block.cell=cellIndex,block.scope=childScope,block.height=110,block.key=trackID,block.serial=index,block.serialElm=block.clone.querySelector("[feed-serial]"),prevNode[cellIndex]=nextNode,specialBlockMap[trackID]=block,function(nextNode,block){fastdom.defer(1,function(){block&&(block.height=nextNode.offsetHeight+12)})}(nextNode,block)),block.serialElm&&(block.serialElm.innerHTML=index+1);for(index=0;length>index;index++){if(value=collection[index],trackID=value.key,block=nextBlockMap[trackID],block.scope.$index=index,nextNode=prevNode[block.cell],parent=nextNode.parentNode,clone=block.clone){do nextNode=nextNode.nextSibling;while(nextNode&&nextNode.RG_DELETE);clone!=nextNode&&parent.insertBefore(clone,nextNode),prevNode[block.cell]=clone,block.childHead=block.scope.$$childHead,block.scope.$$childHead=null}else $transclude(block.scope,function(clone){parent.insertBefore(clone[0],nextNode.nextSibling),nextNode=clone[0],function(nextNode,block){fastdom.defer(++defer,function(){block&&(block.height=nextNode.offsetHeight+12)})}(nextNode,block),!doAnimation||first||10>totalFeeds?nextNode.style.opacity=1:nodesToBeAppeard.push(nextNode),block.clone=nextNode,prevNode[block.cell]=nextNode,block.serialElm=block.clone.querySelector("[feed-serial]"),totalFeeds++});block.serial!=index+special&&block.serialElm&&(block.serialElm.innerHTML=special+index+1,block.serial=index+special)}RingLogger.info("first called end "+(window.performance.now()-t0),RingLogger.tags.DIGEST),nodesToBeAppeard.length>0&&fastdom.defer(2,function(){if(!nodesToBeAppeard)return!1;for(index=0;index<nodesToBeAppeard.length;index++)nodesToBeAppeard[index].style.opacity=1;nodesToBeAppeard=null}),$scope.busy!=busy&&(busy=$scope.busy,showLoader(busy)),lastBlockMap=nextBlockMap,lastCollection=collection,onFeedProcesing=!1,nextBlockMap=null,first=!1,block=null,clone=null,parent=null,nextNode=null,prevNode=null,childScope=null,collection.length<=10&&requestAnimationFrame(function(){$scope.$rgDigest()})}}var index,lhs,rhs,valueIdentifier,cell,elm,expression=$attr.feedRepeat,match=expression.match(/^\s*(.+)\s+in\s+(.*?)\s*$/),cells=[],maxColumn=3,column=helper.feedColumn(),lastBlockMap=Object.create(null),lastCollection=[],onFeedProcesing=!1,wrapper=document.querySelector("div.middle"),wh=(document.getElementById("feeds-container"),helper.viewport.y),hwh=wh/2,wst=0,scrollHeight=0,prefix=$sniffer.vendorPrefix.toLowerCase(),doAnimation="moz"!=prefix&&"ms"!=prefix,busy=!1,first=!0,totalFeeds=0,specialTpl="",specials=[],readyToFeed=!1,lastLoader=!1,lastLoaderFrame=!1,specialBlockMap=Object.create(null),t0=window.performance.now();lhs=match[1],rhs=match[2];match[3]?$parse(match[3]):"";for(valueIdentifier=match[1],index=0;maxColumn>index;index++){cell={},elm=document.createElement("div"),elm.className="cell cell-id"+index,elm.appendChild(document.createComment("cell: "+index)),cell.element=elm;var loader=document.createElement("div");loader.innerHTML='<div class="rf-box"><div class="rf-top"><div class="rf-cir"><span class="icon-logo-circle"></span></div><div class="rf-line"></div></div><div class="rc-feed"> </div><div class="rc-feed rc2"> </div><div class="rc-feed rc3"> </div><div class="rf-ics"></div></div>',loader.style.display="none",elm.appendChild(loader),cell.loader=loader,cells[index]=cell,$attr.postbox&&0==index&&!function(elm){$http.get($attr.postbox,{cache:$templateCache}).then(function(result){var template=$compile(result.data)($scope);elm.insertBefore(template[0],elm.firstChild.nextSibling),readyToFeed=!0,requestAnimationFrame(function(){update($scope[rhs])}),$scope.$rgDigest()})}(elm),loader=null}for($http.get("pages/partials/special-feed.html",{cache:$templateCache}).then(function(result){specialTpl=result.data}),index=0;maxColumn>index;index++)$element[0].appendChild(cells[index].element);var showLoader=function(display){lastLoader==display||lastLoaderFrame||(requestAnimationFrame(function(){for(var index=0;column>index;index++)cells&&cells[index].loader&&(cells[index].loader.style.display=display?"block":"none");lastLoaderFrame=!1}),lastLoaderFrame=!0,lastLoader=display)},setCellVisibility=function(){for(var index=0;maxColumn>index;index++)column>index?cells[index].element.style.display="block":cells[index].element.style.display="none"},doColumnChange=function(){update($scope[rhs]),onScrollEvent(!1),busy=!1,showLoader(busy),setCellVisibility()};wrapper.style.height=wh+"px",element[0].className="cols-"+column,setCellVisibility(),busy=!0,showLoader(busy);var offsetTop=-1*wh*4,offsetBottom=4*wh;document.documentElement.scrollTop=0,document.body.parentNode.scrollTop=0,document.body.scrollTop=0;var onScrollEvent=function(loadFeed){readyToFeed&&cells&&requestAnimationFrame(function(){var loadThreshold;if(scrollHeight=$element[0].scrollHeight,loadThreshold=scrollHeight-helper.viewport.y-helper.viewport.y,helper.viewport.yo>loadThreshold&&loadFeed){if($scope.LoadMoreData(),$scope.noMoreFeed)return;$scope.busy!=busy&&(busy=$scope.busy,showLoader(busy))}if(!(onFeedProcesing||Math.abs(helper.viewport.yo-wst)<hwh)){var col,trackID,value,block,height,cols=[139,0,0],show=[],hide=[],pt=[0,0,0],pb=[0,0,0];for(wst=helper.viewport.yo,index=0;index<specials.length;index++)value=specials[index],trackID=value.key,specialBlockMap[trackID]&&(block=specialBlockMap[trackID],height=block.height,col=block.cell,cols[col]+=height,cols[col]>=offsetTop+wst&&cols[col]<=wst+wh+offsetBottom?block.clone.RG_HIDDEN&&show.push(block.clone):(cols[col]<offsetTop+wst&&(pt[col]+=height),cols[col]>=offsetTop+wst&&cols[col]>wst+wh+offsetBottom&&(pb[col]+=height),block.clone.RG_HIDDEN||hide.push(block.clone)));for(index=0;index<lastCollection.length;index++)value=lastCollection[index],trackID=value.key,lastBlockMap[trackID]&&(block=lastBlockMap[trackID],height=block.height,col=block.cell,cols[col]+=height,cols[col]>=offsetTop+wst&&cols[col]<=wst+wh+offsetBottom?block.clone.RG_HIDDEN&&show.push(block.clone):(cols[col]<offsetTop+wst&&(pt[col]+=height),cols[col]>=offsetTop+wst&&cols[col]>wst+wh+offsetBottom&&(pb[col]+=height),block.clone.RG_HIDDEN||hide.push(block.clone)));value=null,block=null;var max=Math.max(Math.max.apply(null,cols),wh);wrapper.style.height=max+hwh+"px";for(var i=0;i<cells.length;i++)cells[i].element.style.paddingTop=pt[i]+"px";for(var i=0;i<show.length;i++)show[i].style.display="block",show[i].RG_HIDDEN=!1;for(var i=0;i<hide.length;i++)hide[i].style.display="none",hide[i].RG_HIDDEN=!0}})};window.addEventListener("scroll",onScrollEvent),$scope.$on(SystemEvents.COMMON.COLUMN_CHANGED,function(event,newVal){column=newVal,element[0].className="cols-"+column,doColumnChange()}),$scope.$on(SystemEvents.COMMON.WINDOW_RESIZED,function(event,newVal){column=helper.feedColumn(),element[0].className="cols-"+column,doColumnChange()}),$scope.$watchCollection(rhs,update),$scope.$on("$destroy",function(){lastBlockMap=lastCollection=elm=cells=cell=specialBlockMap=specials=specialTpl=null,window.removeEventListener("scroll",onScrollEvent)}),$scope.$on(SystemEvents.FEED.HEIGHT,function($event,key){$event.stopPropagation(),lastBlockMap[key]&&deferFeedHeight(key)}),$scope.$on(SystemEvents.FEED.BUSY,function($event,isBusy){busy=isBusy,showLoader(busy)})}}return{restrict:"A",transclude:!0,priority:1e3,terminal:!0,compile:compile}}angular.module("ringid.feed").directive("feedRepeat",feedRepeat),feedRepeat.$inject=["$parse","$compile","$templateCache","$http","utilsFactory","$rootScope","SystemEvents","$sniffer","feedFactory"]}(),function(){"use strict";function feedLocationViewItem(){return{restrict:"E",scope:{onHover:"&",onSelect:"&",location:"="},templateUrl:"pages/partials/feed_location/item.html",link:function(scope,element,attr){element.on("click",function(e){e.stopPropagation(),scope.onSelect&&scope.onSelect({location:scope.location})}),scope.onHover&&element.on("mouseover",function(event){scope.onHover({location:scope.location})}),scope.$on("$destroy",function(){element.off("click"),element.off("mouseover")})}}}function feedLocationView(utilsFactory){function eventStopPropogate(e){e.stopPropagation()}return{restrict:"E",replace:!0,templateUrl:"pages/partials/feed_location/view.html",compile:function(tElement,tAttrs,transclude){return{pre:function(scope,iElement,iAttrs,controller){scope.initLocation(iElement)},post:function(scope,iElement,iAttrs,controller){scope.$rgDigest(),iElement.on("click",eventStopPropogate),scope.$on("$destroy",function(){iElement.off("click",eventStopPropogate)})}}},controller:["$scope",function($scope){function onLocationItemHover(location){try{updateMapPreviewByPlaceId(location.place_id),showMapPreview()}catch(e){}}function getPlaceInfo(placeId){placesService.getDetails({placeId:placeId},function(place,status){status==google.maps.places.PlacesServiceStatus.OK&&(placeInfos[placeId]=place,$scope.suggestedLocations[placeId]=angular.extend({},$scope.suggestedLocations[placeId],place)),updateSocpe()})}function showLoader(){$scope.loadingData=!0}function hideLoader(){$scope.loadingData=!1}function showMapPreview(){$scope.showLocationMap=!0}function resetPredictions(){$scope.suggestedLocations=[],updateSocpe()}function setPredictions(newPredictions){$scope.suggestedLocations=newPredictions,updateSocpe()}function updateSocpe(){$scope.$rgDigest()}function initMap(location){map=new google.maps.Map(document.getElementById("feed-location-map"),{center:location,zoom:13}),location.description&&AutoCompleteService.getPlacePredictions({input:location.description},processPredictions)}function updateMapPreviewByPlaceId(placeId){var place=placeInfos[placeId];place&&(marker&&marker.setMap(null),map.setCenter(place.geometry.location),marker=new google.maps.Marker({map:map,place:{placeId:placeId,location:place.geometry.location}}))}function search(searchKey){resetPredictions(),showLoader(),AutoCompleteService.getPlacePredictions({input:searchKey},processPredictions)}function watchKeyword(e){var newValue=e.target.value;newValue&&newValue.length>3?search(newValue):resetPredictions(),$scope.keyword=e.target.value}$scope.keyword="",$scope.showLocationMap=!0,$scope.suggestedLocations={},$scope.loadingData=!1,$scope.onLocationItemSelect=function(selectedItem){if(angular.isFunction($scope.onItemSelect)){try{var data={description:selectedItem.terms[0].value}}catch(e){var data={description:selectedItem.description}}data.lat=9999,data.lng=9999,selectedItem.geometry&&selectedItem.geometry.location&&(data.lat=selectedItem.geometry.location.lat(),data.lng=selectedItem.geometry.location.lng()),$scope.onItemSelect({location:data}),$scope.$parent.$rgDigest()}$scope.close()},$scope.shareUserLocation=function(){utilsFactory.getUserLocation().then(function(location){location.sucs?($scope.onItemSelect({location:location}),$scope.$rgDigest(),$scope.close()):(Ringalert.show({mg:"Unable to detect user location"},"error"),RingLogger.aert(error,RingLogger.tags.FEED))})},$scope.onLocationItemHover=onLocationItemHover;var marker,map,placesService,AutoCompleteService,searchInput,placeInfos={};$scope.initLocation=function(iElement){searchInput=iElement.find("input")[0],placesService=new google.maps.places.PlacesService(searchInput),AutoCompleteService=new google.maps.places.AutocompleteService,searchInput.focus(),utilsFactory.getUserLocation().then(function(location){initMap(location.sucs?location:{lat:23.7,lng:90.4})}),$scope.keyword=$scope.value?$scope.value.description:""};var processPredictions=function(predictions,status){if(status!=google.maps.places.PlacesServiceStatus.OK)return void hideLoader();var locations={};angular.forEach(predictions,function(prediction){var placeId=prediction.place_id;placeInfos[placeId]||getPlaceInfo(placeId),locations[placeId]=prediction}),locations&&(setPredictions(locations),hideLoader(),updateSocpe()),updateSocpe()};$scope.processKeyup=utilsFactory.debounce(watchKeyword,500)}]}}function feedLocationPreview(){return{replace:!0,template:'<span ng-if="!!feed.getLocationInfo().lat" ><a ng-href="{{ feed.getLocationUrl() }}"  rg-ringbox="true" ringbox-type="remote" ringbox-target="pages/partials/google-map-preview.html" scope-data="{url : feed.getLocationEmbedUrl() }">  <img height="170px" width="100%" ng-src="{{ feed.getLocationStaticEmbedUrl()}}" alt="location-hover" /> </a>'}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){return}feedApp.directive("feedLocationViewItem",feedLocationViewItem),feedApp.directive("feedLocationView",feedLocationView),feedLocationView.$inject=["utilsFactory"],feedApp.directive("feedLocationPreview",feedLocationPreview)}(),function(){"use strict";function feedLocationMenu($document,$compile,utilsFactory){return{restrict:"A",scope:{onItemSelect:"&feedLocationMenuOnSelect",value:"=selectedValue",viewWidth:"@",viewHeight:"@",autoAdjust:"@"},link:function(scope,element,attr){function checkClickedOnElement(e){e.target!=element[0]&&e.target.parentNode!=element[0]&&e.target.parentNode.parentNode!=element[0]&&"pt-top"!=e.target.className&&(scope.close(),"false"!==scope.autoAdjust&&adjustView(event))}function adjustView(event){window.eventFix(event);var viewportSize=utilsFactory.viewportsize();!directionProvided&&event.pageY+scope.viewHeight+slackSpaceWidth>viewportSize.y&&window.scrollToYOffset(event.pageY-viewportSize.y/2,500),event.pageX+scope.viewWidth+slackSpaceWidth>viewportSize.x-200&&(scope.viewDirection+=" left")}var menuDom,directionProvided,isOpen=!1,slackSpaceWidth=20;scope.viewDirection="right",attr.feedLocationMenuDirection&&(scope.viewDirection=attr.feedLocationMenuDirection,directionProvided=!0),scope.viewWidth=scope.viewWidth||600,scope.viewHeight=scope.viewHeight||466,scope.close=function(){menuDom&&menuDom.remove(),menuDom=null,isOpen=!1,$document.off("click",checkClickedOnElement)},scope.$watch("value",function(newval,oldval){newval.description?element.addClass("active"):element.removeClass("active")}),element.on("click",function(event){return isOpen?(scope.close(),""):("false"!==scope.autoAdjust&&adjustView(event),menuDom||(menuDom=$compile(angular.element("<feed-location-view></feed-location-view>"))(scope)),element.after(menuDom),isOpen=!0,void $document.on("click",checkClickedOnElement))}),scope.$on("$destroy",function(){menuDom&&menuDom.remove(),element.off("click"),$document.off("click",checkClickedOnElement)}),scope.$rgDigest()}}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){return}feedApp.directive("feedLocationMenu",feedLocationMenu),feedLocationMenu.$inject=["$document","$compile","utilsFactory"]}(),function(){"use strict";function LikeHttpService($$connector,OPERATION_TYPES){function likeUnlike(ob){var payload={};switch(ob.type){case"feed":payload.actn=1===ob.il?OTYPES.TYPE_LIKE_STATUS:OTYPES.TYPE_UNLIKE_STATUS;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_LIKE_IMAGE,payload.imgId=ob.target.getKey(),payload.lkd=ob.il;break;case"media":payload.actn=OTYPES.MEDIA.ACTION_LIKE_UNLIKE_MEDIA,payload.cntntId=ob.target.getKey(),payload.lkd=ob.il;break;default:throw new Error("comment type not familiar")}return ob.target.getFeedKey()&&(payload.nfId=ob.target.getFeedKey()),$$connector.request(payload,OTYPES.REQUEST_TYPE.UPDATE)}function likeUnlikeComment(ob){var payload={};switch(ob.type){case"feed":payload.actn=ob.il?OTYPES.TYPE_LIKE_COMMENT:OTYPES.TYPE_UNLIKE_COMMENT,payload.nfId=ob.key;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_LIKE_UNLIKE_IMAGE_COMMENT,payload.imgId=ob.key,payload.lkd=ob.il;break;case"media":payload.actn=OTYPES.MEDIA.ACTION_LIKE_UNLIKE_MEDIA_COMMENT,payload.cntntId=ob.key,payload.lkd=ob.il;break;default:throw new Error("comment type not familiar")}return ob.parentKey&&(payload.nfId=ob.parentKey),payload.cmnId=ob.target.getKey(),$$connector.request(payload,OTYPES.REQUEST_TYPE.UPDATE)}function fetchWhoLikesComment(ob){var payload={};switch(ob.type){case"feed":payload.actn=OTYPES.TYPE_LIST_LIKES_OF_COMMENT,payload.nfId=ob.key;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_IMAGE_COMMENT_LIKES,payload.imgId=ob.key;break;case"media":payload.actn=OTYPES.MEDIA.ACTION_MEDIACOMMENT_LIKE_LIST,payload.cntntId=ob.key;break;default:throw new Error("comment type not familiar")}return ob.parentKey&&(payload.nfId=ob.parentKey),payload.st=ob.st||0,payload.cmnId=ob.target.getKey(),$$connector.pull(payload,OTYPES.REQUEST_TYPE.REQUEST)}function fetchWhoLikes(ob){var payload={};switch(ob.type){case"feed":payload.actn=OTYPES.TYPE_LIKES_FOR_STATUS,payload.nfId=ob.target.getKey();break;case"image":payload.actn=OTYPES.IMAGE.TYPE_LIKES_FOR_IMAGE,payload.imgId=ob.target.getKey();break;case"media":payload.actn=OTYPES.MEDIA.ACTION_MEDIA_LIKE_LIST,payload.cntntId=ob.target.getKey();break;default:throw new Error("comment type not familiar")}return ob.target.getFeedKey()&&(payload.nfId=ob.target.getFeedKey()),payload.st=ob.st||0,$$connector.pull(payload,OTYPES.REQUEST_TYPE.REQUEST)}var ob,OTYPES=OPERATION_TYPES.SYSTEM;return ob={likeUnlike:likeUnlike,likeUnlikeComment:likeUnlikeComment,fetchWhoLikes:fetchWhoLikes,fetchWhoLikesComment:fetchWhoLikesComment}}function WhoLikeController($scope,LikeHttpService,rgScrollbarService,userFactory,friendsFactory,InviteFactory,Auth){function loadMoreUser(){var reqData,reqFn="fetchWhoLikes";$scope.users.length<$scope.target.getTotalLikes()&&(reqData={target:$scope.target,type:$scope.likeType,st:$scope.users.length},"true"==$scope.likeComment&&(reqFn="fetchWhoLikesComment",reqData.parentKey=$scope.targetOwner(),reqData.key=$scope.targetParent()),$scope.loading=!0,LikeHttpService[reqFn](reqData).then(function(json){if($scope.loading=!1,!json.sucs)return void $scope.$close();var i,usr;for(i=0;i<json.likes.length;i++)usr=userFactory.createByUtId(json.likes[i],!0,!0),$scope.users.push(usr),usr.commonFriends(!0,!0).then(function(){$scope.$rgDigest()});rgScrollbarService.recalculate($scope),$scope.$rgDigest()},function(reason){$scope.$close()},function(json){}))}$scope.loading=!0,$scope.users=[],$scope.contactListAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())},$scope.isCurrentUser=function(user){return user.equals(Auth._currentUser)},$scope.loadmore=function(){$scope.loading||loadMoreUser()},loadMoreUser(),$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}}}function LikeController($scope,LikeHttpService,Ringalert,$ringbox,feedFactory){function failedLike(reason){$scope.target.like(!0,reason.loc?reason.loc:!1),Ringalert.show(reason,"error"),$scope.anchorCallback.call(null,$scope.target.like()),$scope.buttonCallback.call(null,$scope.target.like()),$scope.$rgDigest()}$scope.anchorCallback=angular.noop,$scope.buttonCallback=angular.noop,RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from rgLikeDirective",RingLogger.tags.DIGEST)}),$scope.LikeUnlike=function(){var reqData,reqFn="likeUnlike";reqData={target:$scope.target,type:$scope.likeType},"true"==$scope.likeComment&&(reqFn="likeUnlikeComment",reqData.parentKey=$scope.targetOwner(),reqData.key=$scope.targetParent()),reqData.il=$scope.target.like(!0),$scope.anchorCallback.call(null,reqData.il),$scope.buttonCallback.call(null,reqData.il),LikeHttpService[reqFn](reqData).then(function(json){if(json.sucs){if("feed"!==$scope.likeType&&"true"!==$scope.likeComment&&json.nfId){var sc=feedFactory.synchLike(json.nfId,reqData.il,json.loc);sc&&sc.$rgDigest()}}else failedLike(json)},failedLike),$scope.$rgDigest()},$scope.$watch("target",function(newValue){$scope.anchorCallback.call(null,newValue.like()),$scope.buttonCallback.call(null,newValue.like(),!0)}),$scope.showWhoLike=function(){if($scope.target.getTotalLikes()){$ringbox.open({type:"remote",scope:$scope,controller:"WhoLikeController",templateUrl:"pages/home/wholikes.html"})}}}function rgLikerButton(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a><i class="lc-ico"></i><b>Like</b></a>',link:function(scope,elem,attrs,parentCtrl){function iLikeChange(v,stopAnimation){v?(elem[0].firstChild.className=elem[0].firstChild.className.replace("icon-like","").trim(),elem[0].firstChild.className=elem[0].firstChild.className.replace("icon-like-h","").trim(),elem[0].firstChild.className+=" icon-like-h",stopAnimation||(elem[0].firstChild.innerHTML='<span class="like-ani"></span>',window.setTimeout(function(){elem&&(elem[0].firstChild.innerHTML="")},2e3))):(elem[0].firstChild.className=elem[0].firstChild.className.replace("icon-like-h","").trim(),elem[0].firstChild.className=elem[0].firstChild.className.replace("icon-like","").trim(),elem[0].firstChild.className+=" icon-like")}scope.buttonCallback=iLikeChange,iLikeChange(scope.target.like(),!0),elem.bind("click",scope.LikeUnlike),scope.$on("$destroy",function(){elem.unbind("click",scope.likeUnlike)})}}}function rgLikerAnchor(){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">Like</a>',link:function(scope,elem,attrs,parentCtrl){elem.bind("click",scope.LikeUnlike),scope.$on("$destroy",function(){elem.unbind("click",scope.likeUnlike)})}}}function rgWhoLike($ringbox){return{restrict:"E",require:"^rgLikes",replace:!0,template:'<a class="lcs_button ">{{target.getTotalLikes()}}</a>',link:function(scope,elem,attrs,parentCtrl){elem.bind("click",scope.showWhoLike),scope.$on("$destroy",function(){elem.unbind("click",scope.showWhoLike)})}}}function rgLikes(){return{restrict:"EA",scope:{target:"=",likeType:"@",targetParent:"&",targetOwner:"&",likeComment:"@"},controller:"LikeController",template:"<rg-liker-button></rg-liker-button><rg-who-like></rg-who-like>",link:function(scope,element,attr){function iLikeChange(iLikeValue){iLikeValue?element.addClass("active"):element.removeClass("active")}scope.anchorCallback=iLikeChange,iLikeChange(scope.target.like()),scope.$watch("target.like()",function(){iLikeChange(scope.target.like()),scope.buttonCallback.call(null,scope.target.like(),!0)})}}}angular.module("ringid.feed").factory("LikeHttpService",LikeHttpService).controller("LikeController",LikeController).controller("WhoLikeController",WhoLikeController).directive("rgLikes",rgLikes).directive("rgLikerAnchor",rgLikerAnchor).directive("rgWhoLike",rgWhoLike).directive("rgLikerButton",rgLikerButton),LikeHttpService.$inject=["$$connector","OPERATION_TYPES"],WhoLikeController.$inject=["$scope","LikeHttpService","rgScrollbarService","userFactory","friendsFactory","InviteFactory","Auth"],LikeController.$inject=["$scope","LikeHttpService","Ringalert","$ringbox","feedFactory"],rgLikerButton.$inject=[],rgLikerAnchor.$inject=[],rgWhoLike.$inject=["$ringbox"],rgLikes.$inject=[]}(),function(){"use strict";function CommentHttpService($$connector,OPERATION_TYPES){function getComment(ob){var payload={};switch(ob.type){case"feed":payload.cmntT=1,payload.nfId=ob.key;break;case"image":payload.cmntT=2,payload.imgId=ob.key;break;case"media":payload.cmntT=3,payload.cntntId=ob.key;break;default:throw new Error("comment type not familiar")}return payload.actn=OTYPES.ACTION_GET_FULL_COMMENT,payload.cmnId=ob.commentId,$$connector.request(payload,OTYPES.REQUEST_TYPE.REQUEST)}function getComments(ob,timeOffset,before){var payload={};if(!ob.key||!ob.type)throw new Error("key and type must needed for fetcing comment");switch(ob.type){case"feed":payload.actn=OTYPES.TYPE_COMMENTS_FOR_STATUS,payload.nfId=ob.key;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_COMMENTS_FOR_IMAGE,
payload.imgId=ob.key,ob.target.getFeedKey()&&(payload.nfId=ob.target.getFeedKey());break;case"media":payload.actn=OTYPES.MEDIA.ACTION_MEDIA_COMMENT_LIST,payload.cntntId=ob.key,ob.target.getFeedKey()&&(payload.nfId=ob.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return timeOffset?(payload.scl=before?before:1,payload.tm=timeOffset):payload.st=ob.st||0,$$connector.pull(payload,OTYPES.REQUEST_TYPE.REQUEST)}function addComment(ob){var payload={};switch(ob.type){case"feed":payload.actn=OTYPES.TYPE_ADD_STATUS_COMMENT,payload.nfId=ob.key;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_ADD_IMAGE_COMMENT,payload.imgId=ob.key,ob.target.getFeedKey()&&(payload.nfId=ob.target.getFeedKey());break;case"media":payload.actn=OTYPES.MEDIA.ACTION_ADD_COMMENT_ON_MEDIA,payload.cntntId=ob.key,ob.target.getFeedKey()&&(payload.nfId=ob.target.getFeedKey());break;default:throw new Error("comment type not familiar")}return payload.cmn=ob.text.utf8Encode(),$$connector.request(payload,OTYPES.REQUEST_TYPE.UPDATE)}function updateComment(ob){var payload={};switch(ob.type){case"feed":payload.actn=OTYPES.TYPE_EDIT_STATUS_COMMENT,payload.nfId=ob.key;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_EDIT_IMAGE_COMMENT,payload.imgId=ob.key;break;case"media":payload.actn=OTYPES.MEDIA.ACTION_EDIT_COMMENT_ON_MEDIA,payload.cntntId=ob.key;break;default:throw new Error("comment type not familiar")}return payload.cmnId=ob.commentId,payload.cmn=ob.text.utf8Encode(),$$connector.request(payload,OTYPES.REQUEST_TYPE.UPDATE)}function deleteComment(ob){var payload={};switch(ob.type){case"feed":payload.actn=OTYPES.TYPE_DELETE_STATUS_COMMENT,payload.nfId=ob.key;break;case"image":payload.actn=OTYPES.IMAGE.TYPE_DELETE_IMAGE_COMMENT,payload.imgId=ob.key;break;case"media":payload.actn=OTYPES.MEDIA.ACTION_DELETE_COMMENT_ON_MEDIA,payload.cntntId=ob.key;break;default:throw new Error("comment type not familiar")}return payload.cmnId=ob.commentId,$$connector.request(payload,OTYPES.REQUEST_TYPE.UPDATE)}function getUpdateFilter(type,value){var mainActionsSet,key,actionUpdateFeedSet=[OTYPES.TYPE_UPDATE_ADD_STATUS_COMMENT,OTYPES.TYPE_UPDATE_LIKE_COMMENT,OTYPES.TYPE_UPDATE_UNLIKE_COMMENT,OTYPES.TYPE_UPDATE_DELETE_STATUS_COMMENT,OTYPES.TYPE_UPDATE_EDIT_STATUS_COMMENT],actionUpdateImageSet=[OTYPES.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT,OTYPES.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT,OTYPES.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT,OTYPES.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT],actionUpdateMediaSet=[OTYPES.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT,OTYPES.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT,OTYPES.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT,OTYPES.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT];switch(type){case"feed":mainActionsSet=actionUpdateFeedSet,key="nfId";break;case"image":mainActionsSet=actionUpdateImageSet,key="imgId";break;case"media":mainActionsSet=actionUpdateMediaSet,key="cntntId";break;default:return[1111111]}return function(message){return-1!==mainActionsSet.indexOf(message.actn)&&message[key]===value}}var ob,OTYPES=OPERATION_TYPES.SYSTEM;return ob={getComment:getComment,getComments:getComments,addComment:addComment,updateComment:updateComment,deleteComment:deleteComment,getUpdateFilter:getUpdateFilter}}function CommentsController($scope,$$connector,Ringalert,utilsFactory,CommentHttpService,Auth,$$stackMap,$$commentMap,rgDropdownService,OPERATION_TYPES,rgScrollbarService,feedFactory){function safeDigest(){$scope.$parent&&1!==$scope.$parent.$id?$scope.$parent.$rgDigest():$scope.$rgDigest()}function enableCommentEditor(commentKey,commentText){commentKey&&($scope.commentEditorEnabled=!0,$scope.commentKey=commentKey,$scope.models.commentedittext=commentText,safeDigest())}function setLoading(val){$scope.loadingComment=val,RingLogger.print("Loading... comment "+val,"rgComments"),loadingTimeout&&(window.clearTimeout(loadingTimeout),loadingTimeout=void 0)}function setupInitials(){commentSubsriberKey=$$connector.subscribe(function(json){switch(json.actn){case OTYPES.TYPE_UPDATE_ADD_STATUS_COMMENT:case OTYPES.IMAGE.TYPE_UPDATE_ADD_IMAGE_COMMENT:case OTYPES.MEDIA.ACTION_UPDATE_ADD_MEDIA_COMMENT:pushComments({comments:[json]});break;case OTYPES.TYPE_UPDATE_EDIT_STATUS_COMMENT:case OTYPES.IMAGE.TYPE_UPDATE_EDIT_IMAGE_COMMENT:case OTYPES.MEDIA.ACTION_UPDATE_EDIT_MEDIA_COMMENT:var com=$scope.comments.get(json.cmnId);com&&com.setComment(json.cmn);break;case OTYPES.TYPE_UPDATE_LIKE_COMMENT:case OTYPES.TYPE_UPDATE_UNLIKE_COMMENT:case OTYPES.IMAGE.TYPE_UPDATE_LIKE_UNLIKE_IMAGE_COMMENT:case OTYPES.MEDIA.ACTION_UPDATE_LIKE_UNLIKE_MEDIA_COMMENT:var com=$scope.comments.get(json.cmnId);com&&com.incomingLike(json.loc);break;case OTYPES.TYPE_UPDATE_DELETE_STATUS_COMMENT:case OTYPES.IMAGE.TYPE_UPDATE_DELETE_IMAGE_COMMENT:case OTYPES.MEDIA.ACTION_UPDATE_DELETE_MEDIA_COMMENT:$scope.comments.remove(json.cmnId)}safeDigest()},{filter:CommentHttpService.getUpdateFilter($scope.commentType,$scope.target.getKey())}),$scope.$on("$destroy",function(){commentSubsriberKey&&$$connector.unsubscribe(commentSubsriberKey),commentSubsriberKey=!1})}function loadPreviousComment(force){var comment,timeOffset=!1;$scope.comments.length()&&(comment=$scope.comments.getByIndex(0),timeOffset=comment.getTimestamp()),fetchComments(timeOffset,1,force)}function processPreviousComment(json){json.comments&&(json.comments.length>5&&$scope.target.getTotalComment()>$scope.comments.length()+json.comments.length?(json.comments.sort(function(a,b){return a.tm>b.tm?1:-1}),pushComments({comments:json.comments.splice(0)}),$scope.previousComment=!0):($scope.previousComment=!1,pushComments(json)))}function loadMoreComment(){var timeOffset=!1;if(parseInt($scope.activeCommentId)>0){var comment;$scope.comments.length()&&(comment=$scope.comments.getByIndex($scope.comments.length()-1),timeOffset=comment.getTimestamp())}fetchComments(timeOffset,2)}function processAfterComment(json){json.comments&&(json.comments.length>5&&$scope.target.getTotalComment()>$scope.comments.length()+json.comments.length?(json.comments.sort(function(a,b){return a.tm<b.tm?1:-1}),pushComments({comments:json.comments.splice(0)}),$scope.afterComment=!0):($scope.afterComment=!1,pushComments(json)))}function initialCommentRequest(){if(parseInt($scope.activeCommentId)>0){var type=$scope.commentType,target=$scope.target;"feed"===$scope.commentType&&$scope.target.isSingleContentFeed()&&(target=$scope.target.getSingleContent(),type=$scope.target.getContentType()),CommentHttpService.getComment({key:target.getKey(),type:type,commentId:parseInt($scope.activeCommentId)}).then(function(json){json.sucs?(pushComments({comments:[json.cmntDTO]}),loadMoreComment(),setTimeout(function(){loadPreviousComment(!0)},500)):($scope.activeCommentId=0,fetchComments()),safeDigest()},function(reason){fetchComments()})}else fetchComments()}function fetchComments(timeOffset,before,force){if(!$scope.target.getTotalComment()||(1===before&&!$scope.showPreviousButton()||2===before&&!$scope.showMoreButton())&&!force)return void RingLogger.print("fetched all comments or already loading or no comments","rgcomments");setLoading(!0);var type=$scope.commentType,target=$scope.target;"feed"===$scope.commentType&&$scope.target.isSingleContentFeed()&&(target=$scope.target.getSingleContent(),type=$scope.target.getContentType()),loadingTimeout=setTimeout(setLoading.bind($scope,!1),3e3),CommentHttpService.getComments({key:target.getKey(),type:type,st:$scope.comments.length(),target:target},timeOffset,before).then(function(json){RingLogger.print(json,"rgComments"),json.sucs&&(parseInt($scope.activeCommentId)?1===before?processPreviousComment(json):processAfterComment(json):pushComments(json)),setLoading(!1),safeDigest()},function(json){RingLogger.print(json,"rgCommentsError")},function(json){RingLogger.print(json,"rgCommentsNotified")}),safeDigest()}function pushComments(message){var commentMap,i;for(i=0;i<message.comments.length;i++)commentMap=$$commentMap.create(message.comments[i]),$scope.comments.save(commentMap.getKey(),commentMap)}function addComment(){var cmnId,commData,text=$scope.commenttext,target=$scope.target,type=$scope.commentType;$scope.canComment=!1,validateComment()&&(cmnId=utilsFactory.getUniqueID(),commData={cmnId:cmnId,cmn:text,deleted:!1,isNew:!0,edited:!1,pending:!0},"feed"===$scope.commentType&&$scope.target.isSingleContentFeed()&&(target=$scope.target.getSingleContent(),type=$scope.target.getContentType()),$scope.comments.add(cmnId,$$commentMap.create(commData,$scope.currentUser)),CommentHttpService.addComment({key:target.getKey(),type:type,text:text,target:target}).then(function(json){if(json.sucs===!0){$scope.comments.remove(cmnId),commData.cmnId=json.cmnId,commData.pending=!1,angular.extend(json,commData);var comment=$$commentMap.create(json,$scope.currentUser);if($scope.comments.add(comment.getKey(),comment),$scope.target.setTotalComment(json.loc,1),"feed"===$scope.commentType&&$scope.target.isSingleContentFeed())target.setTotalComment(json.loc,1);else if("feed"!==$scope.commentType){var sc=feedFactory.synchComment($scope.target.getFeedKey(),json.loc,1);sc&&sc.$rgDigest()}$scope.canComment=!0,$scope.commenttext="",safeDigest()}else $scope.comments.remove(cmnId),$scope.canComment=!0,Ringalert.show(json,"error"),$scope.commenttext=text,safeDigest()},function(reason){$scope.comments.remove(cmnId),$scope.canComment=!0,Ringalert.show(reason,"error"),$scope.commenttext=text,safeDigest()}),rgScrollbarService.scrollTop($scope))}function updateComment(comment){if(!comment.user().isCurrentUser())return void($scope.commentEditorEnabled=!1);var text=$scope.models.commentedittext.trim(),type=$scope.commentType,target=$scope.target,oldText=comment.text();comment.setComment(text),comment.isPending(!0),"feed"===$scope.commentType&&$scope.target.isSingleContentFeed()&&(target=$scope.target.getSingleContent(),type=$scope.target.getContentType()),""!==text?CommentHttpService.updateComment({key:target.getKey(),type:type,commentId:comment.getKey(),text:$scope.models.commentedittext}).then(function(json){json.sucs||(comment.setComment(oldText),Ringalert.show(json,"error")),comment.isPending(!1),$scope.models.commentedittext="",$scope.commentEditorEnabled=!1,safeDigest()},function(reason){comment.setComment(oldText),Ringalert.show(json,"error"),safeDigest()}):Ringalert.show("Please write something","error"),safeDigest()}function deleteComment(comm){var type=$scope.commentType,target=$scope.target;comm.isPending(!0),"feed"===$scope.commentType&&$scope.target.isSingleContentFeed()&&(target=$scope.target.getSingleContent(),type=$scope.target.getContentType()),CommentHttpService.deleteComment({key:target.getKey(),type:type,commentId:comm.getKey()}).then(function(json){if(json.sucs){if($scope.comments.remove(json.cmnId),$scope.target.setTotalComment(json.loc,json.ic),"feed"===$scope.commentType&&$scope.target.isSingleContentFeed())target.setTotalComment(json.loc,json.ic);else if("feed"!==$scope.commentType){var sc=feedFactory.synchComment($scope.target.getFeedKey(),json.loc,json.ic);sc&&sc.$rgDigest()}}else comm.isPending(!1),Ringalert.show(json,"error");safeDigest()},function(json){comm.isPending(!1),Ringalert.show(json,"error"),safeDigest()}),safeDigest()}function validateComment(){return $scope.commenttext.length<1?($scope.commentErrorClass="inputerror",$scope.canComment=!0,!1):($scope.commentErrorClass="",!0)}var commentSubsriberKey,loadingTimeout,OTYPES=OPERATION_TYPES.SYSTEM,firstTimeChangedTarget=!1;$scope.comments=$$stackMap.createNew(!0,"desc"),$scope.loadingComment=!1,$scope.canComment=!0,$scope.commentEditorEnabled=!1,$scope.commentKey="",$scope.commenttext="",$scope.ddCommentHtml="pages/dropdowns/comment-edit-dropdown.html",$scope.previousComment=!1,$scope.afterComment=!!$scope.target.getTotalComment(),$scope.models={commentedittext:""},$scope.currentUser=Auth.currentUser(),$scope.openRingboxLike=function(comment){return comment.getTotalLikes()>0},$scope.loadMoreComment=loadMoreComment,$scope.loadPreviousComment=loadPreviousComment,$scope.addComment=addComment,$scope.updateComment=updateComment,"feed"===$scope.commentType&&$scope.target.isSingleContentFeed()?($scope.target.getMedias().length()||$scope.target.getAudios().length()?$scope.likeType="media":$scope.target.getImages(!0).length()&&($scope.likeType="image"),$scope.parentKey=$scope.target.getSingleContent().getKey()):($scope.likeType=$scope.commentType,$scope.parentKey=$scope.target.getKey()),$scope.hideScroll=!!$scope.hideScroll&&"false"!==$scope.hideScroll,$scope.showPreviousButton=function(){return $scope.target.getTotalComment()>$scope.comments.length()&&$scope.previousComment&&!$scope.loadingComment},$scope.showMoreButton=function(){return $scope.target.getTotalComment()>$scope.comments.length()&&$scope.afterComment&&!$scope.loadingComment},$scope.cancelEdit=function(){$scope.commentEditorEnabled=!1,safeDigest()},$scope.actionCommentDropdown=function(actionObj){switch(rgDropdownService.close(),actionObj.event.preventDefault(),actionObj.action){case"edit":enableCommentEditor(actionObj.commentMap.getKey(),actionObj.commentMap.text());break;case"delete":deleteComment(actionObj.commentMap)}},RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from rgComments directive",RingLogger.tags.DIGEST)}),$scope.$watch("showCommentBox",function(newVal){newVal&&(commentSubsriberKey||setupInitials(),$scope.comments.length()||initialCommentRequest())}),$scope.$watch("target.getKey()",function(newVal){firstTimeChangedTarget&&(commentSubsriberKey&&($$connector.unsubscribe(commentSubsriberKey),setupInitials(),$scope.comments.reset()),$scope.comments.length()||initialCommentRequest()),firstTimeChangedTarget=!0})}function rgComments(){return{restrict:"E",controller:CommentsController,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@",hideScroll:"@"},template:'<div class="feed_comment"><div rg-scrollbar="scrollbar()" disabled="{{::hideScroll}}" ng-class="!hideScroll ? \'comm-scroll-height\':\'\'"><ul class="media-list"><li class="item b-none bd" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item" rg-repeat="comm in comments.all() track by comm.key" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),comment_blink: (comment.getKey() == activeCommentId)}"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{ comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{comment.user().link()}}">{{comment.user().getName()}}</a></p><p class="comment_text" onmousedown="return false" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-show="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="models.commentedittext" new-line="ctrl" on-enter="updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="comment.getDynamicText" show-emoji="true" focus="$parent.commentEditorEnabled" placeholder="Write your comment..."></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></p></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class="" style="position: relative"><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="comment" dd-action="actionCommentDropdown" ng-class="comment.user().isCurrentUser() ? \'icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div><div class="comm-l"><ul class="comment_like_menu 1000" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"><!-- <a ng-class="{active:comment.like()}" rg-click="like(comment)"><i class="icon-like lc-ico" rg-like="comment.like()" ng-class="{\'icon-like-h\':comment.like()}"></i></a> <a ng-class="{active:comment.like()}" rg-click="like(comment)">&nbsp;Like</a> <a ng-class="{active:comment.like()}" class="counter" href="javascript:void(0)" rg-ringbox="{{::comment.getTotalLikes() > 0}}" ringbox-open="openRingboxLike(comment)" ringbox-controller="fetchLikeController" ringbox-target="pages/home/wholikes.html" ringbox-type="remote" ringbox-data="fetchWhoLikes(comment)">{{comment.getTotalLikes()}}</a> --></li><li class="mar-top-7 feed-m"><span class="time"><i class="icon-dt"></i> {{comment.time()}}</span></li></ul></div></li></ul></div><div ng-show="loadingComment" style="text-align:center;margin-top:10px"><div class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></div></div><div class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></div><div ng-if="target.getTotalComment() > comments.length()" class="divider"></div><div class="mar-top-10"><div class="comment-w" ng-class="commentErrorClass"><div class="comment-editor"><rg-editor class="editor" editor-content="commenttext" new-line="ctrl" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div>'}}function rgImageComments(){return{restrict:"E",controller:CommentsController,scope:{target:"=",showCommentBox:"=",commentType:"@",commentOrder:"@",activeCommentId:"@"},template:'<div class="feed-comment-wrapper" style="height:calc(100% - 165px)"><div class="feed_comment" rg-scrollbar="scrollbar()"><ul class="feed-img-l"><li class="item b-none" style="border:none" ng-show="showPreviousButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadPreviousComment()">load previous comments</a></div><div class="clear"></div></li><li class="item pv-item" ng-repeat="comm in comments.all()" ng-init="comment = comm.value" ng-class="{ half_opacity:comment.isPending(),active: (comment.getKey() == activeCommentId) }"><div class="comment-area"><div class="pro_img_bg_30 mar-right-10" style="flex:none"><img ng-src="{{::comment.user().avatar(\'thumb\')}}" alt=""></div><div class="comm-p"><p class="unm"><a ng-href="{{::comment.user().link()}}">{{::comment.user().getName()}}</a></p><p onmousedown="return false" class="txt_justify" ng-hide="(commentEditorEnabled && commentKey == comment.getKey())" ng-bind-html="comment.getDynamicText()"></p><p ng-show="(commentEditorEnabled && commentKey == comment.getKey())"><span class="comment"><rg-editor class="editor" editor-content="models.commentedittext" new-line="ctrl" on-enter="updateComment" on-enter-arg="comment" on-escape="cancelEdit" edit-mode="comment.getDynamicText" show-emoji="true" focus="$parent.commentEditorEnabled" placeholder="Write something...." style="width: 94%"></rg-editor><span class="esc-to-cancel">Press Esc to <a rg-click="cancelEdit()">cancel</a></span></span></p></div><div class="comm-sett"><div ng-show="target.user().isCurrentUser() || comment.user().isCurrentUser()" class=""><div rg-dropdown="dropdown()" dd-html="ddCommentHtml" dd-control="comment" dd-action="actionCommentDropdown" ng-class="comment.user().isCurrentUser() ? \'icon-ds-arrow\' : \'\'" class="ico-f arrow-b"></div></div></div><div class="clear"></div></div><div class="comm-l"><ul class="comment_like_menu" ng-hide="comment.isPending() || (commentEditorEnabled && commentKey == comment.getKey())"><li rg-likes="" like-type="{{::likeType}}" target="comment" target-parent="parentKey" target-owner="target.getFeedKey()" like-comment="true"><!-- <a ng-class="{active:comment.like()}" rg-click="like(comment)"><i ng-class="{\'icon-like-h\':comment.like() > 0}" class="icon-like lc-ico" rg-like="comment.like()"></i></a> <a ng-class="{active:comment.like()}" rg-click="like(comment)">&nbsp;Like</a> <a ng-class="{active:comment.like()}" class="counter" href="javascript:void(0)" rg-ringbox="{{::comment.getTotalLikes() > 0}}" ringbox-open="openRingboxLike(comment)" ringbox-controller="fetchLikeController" ringbox-target="pages/home/wholikes.html" ringbox-type="remote" ringbox-data="fetchWhoLikes(comment)">{{comment.getTotalLikes()}}</a> --></li><li class="mar-left-60"><span class="time"><i class="icon-dt"></i> {{comment.time()}}</span></li></ul></div></li><li ng-show="loadingComment" class="loader-s"><div class="lr1"></div><div class="lr2"></div><div class="lr3"></div></li><li class="item b-none" style="border:none" ng-show="showMoreButton()"><div class="float-right gray font-12 margin-10"><a class="view_more" rg-click="loadMoreComment()">More comments</a></div><div class="clear"></div></li></ul></div><div class="pv-c-top"><div class="width-100-percent"><div class="pv-pro float-left"><img ng-src="{{::currentUser.avatar(\'thumb\')}}" alt=""></div><div class="comment-w" style="width:85%" ng-class="commentErrorClass"><div class="comment-editor popimgcmnt-box"><rg-editor class="editor" editor-content="commenttext" new-line="ctrl" on-enter="addComment" show-emoji="true" is-disabled="!canComment" focus="showCommentBox" placeholder="Write something...."></rg-editor></div></div></div></div></div>'}}angular.module("ringid.feed").factory("CommentHttpService",CommentHttpService).controller("CommentsController",CommentsController).directive("rgComments",rgComments).directive("rgImageComments",rgImageComments),CommentHttpService.$inject=["$$connector","OPERATION_TYPES"],CommentsController.$inject=["$scope","$$connector","Ringalert","utilsFactory","CommentHttpService","Auth","$$stackedMap","$$commentMap","rgDropdownService","OPERATION_TYPES","rgScrollbarService","feedFactory"]}(),function(){"use strict";function rgNewsFeedTop($templateCache){return{scope:{feed:"=",serial:"=",ddTemplate:"=",actionFeedDropdown:"=",dropdown:"&",singleFeed:"@",showdroparrow:"="},restrict:"E",template:$templateCache.get("top.html")}}angular.module("ringid.feed").directive("rgNewsFeedTop",rgNewsFeedTop),rgNewsFeedTop.$inject=["$templateCache"]}(),function(){"use strict";function rgNewsFeedBottom($templateCache){return{restrict:"E",template:$templateCache.get("bottom.html")}}angular.module("ringid.feed").directive("rgNewsFeedBottom",rgNewsFeedBottom),rgNewsFeedBottom.$inject=["$templateCache"]}(),function(){"use strict";function rgNewsFeedDetails(){return{restrict:"E",templateUrl:"pages/partials/news_feed/details.html"}}angular.module("ringid.feed").directive("rgNewsFeedDetails",rgNewsFeedDetails)}(),function(){"use strict";function rgNewsFeedSharedFeed(){return{restrict:"E",templateUrl:"pages/partials/news_feed/shared_feed.html"}}angular.module("ringid.feed").directive("rgNewsFeedSharedFeed",rgNewsFeedSharedFeed)}(),function(){"use strict";function rgNewsFeedMenu($compile,SystemEvents,$templateCache,MESSAGES,Ringalert){return{restrict:"E",template:$templateCache.get("menu.html"),link:function(scope,element,attrs){function clickHandler(e){if(e.target.hasAttribute("data-event-share")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-share")){e.stopPropagation();var f=scope.feed.hasSharedFeed()?scope.feed.getOrginalFeed():scope.feed,shareablle=f.isShareAble(!0);if(!shareablle.sucs)return void Ringalert.show(MESSAGES[shareablle.rc],"warning");shareHandler()}(e.target.hasAttribute("data-event-comment")||e.target.parentNode&&e.target.parentNode.hasAttribute("data-event-comment"))&&(e.stopPropagation(),commentHandler()),scope.$rgDigest()}function shareHandler(){return scope.showCommentBox&&(wrapper.removeChild(comment),scope.showCommentBox=!1),scope.showShareBox?scope.showShareBox?(wrapper.removeChild(share),scope.showShareBox=!1,void scope.$emit(SystemEvents.FEED.HEIGHT,scope.feed.getMapKey())):void scope.$emit("$feedHeight",scope.feed.getMapKey()):(share=share?share:$compile("<feed-inline-share-view></feed-inline-share-view>")(scope)[0],wrapper.appendChild(share),scope.showShareBox=!0,void scope.$emit(SystemEvents.FEED.HEIGHT,scope.feed.getMapKey()))}function commentHandler(){var templateComment;return templateComment='<rg-comments target = "feed" show-comment-box="showCommentBox" comment-type = "feed" comment-order = "desc"></rg-comments>',scope.showShareBox&&(wrapper.removeChild(share),scope.showShareBox=!1),scope.showCommentBox?scope.showCommentBox?(wrapper.removeChild(comment),scope.showCommentBox=!1,void scope.$emit(SystemEvents.FEED.HEIGHT,scope.feed.getMapKey())):void 0:(comment=comment?comment:$compile(templateComment)(scope)[0],wrapper.appendChild(comment),scope.showCommentBox=!0,void scope.$emit(SystemEvents.FEED.HEIGHT,scope.feed.getMapKey()))}var comment=null,share=null,eventListner=element[0].querySelector("[data-events]"),wrapper=element[0].closest("[data-feed-bottom]");eventListner.addEventListener("click",clickHandler),scope.closeShareBox=function(){scope.showShareBox=!0,shareHandler(),scope.$rgDigest()},scope.closeCommentBox=function(){scope.showCommentBox=!0,commentHandler(),scope.$rgDigest()},scope.$on("$destroy",function(){eventListner.removeEventListener("click",clickHandler),eventListner=null,wrapper=null,comment=null,share=null})}}}angular.module("ringid.feed").directive("rgNewsFeedMenu",rgNewsFeedMenu),rgNewsFeedMenu.$inject=["$compile","SystemEvents","$templateCache","MESSAGES","Ringalert"]}(),function(){"use strict";function rgNewsFeedComment(){return{restrict:"E",templateUrl:"pages/partials/news_feed/comment.html"}}angular.module("ringid.feed").directive("rgNewsFeedComment",rgNewsFeedComment)}(),function(){"use strict";function feedMessage($compile){return{restrict:"A",scope:{feed:"=feedMessage"},link:function(scope,element,attrs){scope.$watch("feed.checkMessageUpdated()",function(value){element.html(scope.feed.getMessageText()),$compile(element.contents())(scope)})}}}function feedTagMoreUser(){return{restrict:"E",scope:{feed:"=tagFeed"},controller:["$scope","feedFactory",function(scope,feedFactory){if(scope.getTagUsers=function(feed){return{data:function(){return{target:feed}},promise:feedFactory.getTagUsers(feed)}},scope.tooltip="",scope.feed.getTotalTag()>2){var users=scope.feed.getTagUsers();users.length>1&&(scope.tooltip+=users[1].getName(),users[2]&&(scope.tooltip+="\n"+users[2].getName(),scope.feed.getTotalTag()>3&&(scope.tooltip+="\nand "+(scope.feed.getTotalTag()-3)+" others")))}}],template:'<span class="">with&nbsp;</span><span class="tag-people"><user-card user="feed.getTagUsers()[0]"></user-card></span><span ng-if="::feed.getTotalTag() > 1">&nbsp;and&nbsp;<span class="tag-people" ng-if="::feed.getTotalTag() == 2"><user-card user="feed.getTagUsers()[1]"></user-card></span><span class="" ng-if="::feed.getTotalTag() > 2"><a rg-ringbox="true" ringbox-controller="feedTagUserListController" ringbox-type="remote"ringbox-target="pages/home/tag-user-list.html"ringbox-data="getTagUsers(feed)" class="tag-f-msg" data-tooltip="{{::tooltip}}">{{::feed.getTotalTag() -1}} others peoples</a></span></span>'}}angular.module("ringid.feed").directive("locationCard",function(){return{restrict:"E",replace:!0,scope:{feed:"="},template:'<span class="location">&nbsp;at&nbsp;<a ng-href="{{ feed.getLocationEmbedUrl() }}" target="_blank" title="{{ ::feed.getLocationText() }}" rg-hovercard hover-template-url="pages/partials/hovercards/location-hover.html">{{::feed.getLocationShortText()}}</a></span>'}}).directive("userCard",function(){return{restrict:"E",replace:!0,controller:["$scope","profileHttpService","InviteFactory","friendsFactory",function($scope,profileHttpService,InviteFactory,friendsFactory){$scope.getUserDetail=function(){$scope.showMfc=!1,profileHttpService.getUserDetails({utId:$scope.user.getUtId()},!0).then(function(json){json.sucs&&($scope.mfc=json.userDetails.mfc,$scope.showMfc=!0,$scope.user.setUid(json.userDetails.uId),$scope.$rgDigest())})},$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}},$scope.contactListAction=function(actionObj){actionObj.friend.isLoading()||(friendsFactory.friendAction(actionObj,!0).then(function(){$scope.$rgDigest()},function(){$scope.$rgDigest()}),$scope.$rgDigest())}}],scope:{user:"="},template:'<span class="user"><a ng-href="{{user.link()}}" rg-hovercard="{{::!user.isCurrentUser()}}" on-hover-start="getUserDetail" hover-template-url="pages/partials/hovercards/profile-hover.html">{{::user.getName()}}</a></span>'}}).directive("feedMessage",feedMessage).directive("feedTagMoreUser",feedTagMoreUser),feedMessage.$inject=["$compile"],feedTagMoreUser.$inject=[]}(),function(){"use strict";function rgSingleFeedBody(){return{restrict:"E",templateUrl:"pages/partials/single_feed/body.html"}}function rgSingleFeedHeader(){return{restrict:"E",templateUrl:"pages/partials/single_feed/header.html"}}function rgSingleFeedMenu(){return{restrict:"E",templateUrl:"pages/partials/single_feed/menu.html"}}angular.module("ringid.feed").directive("rgSingleFeedHeader",rgSingleFeedHeader).directive("rgSingleFeedBody",rgSingleFeedBody).directive("rgSingleFeedMenu",rgSingleFeedMenu)}(),function(){"use strict";function rgSingleFeedDetails(){return{restrict:"E",templateUrl:"pages/partials/single_feed/details.html"}}angular.module("ringid.feed").directive("rgSingleFeedDetails",rgSingleFeedDetails)}(),function(){"use strict";function rgSingleFeedComments(){return{restrict:"E",scope:{feed:"=",commentType:"@",user:"&",addComment:"&",updateComment:"&",cancelEdit:"&",likeComment:"&",fetchWhoLikes:"&",canComment:"=",commentErrorClass:"=",commentText:"=",allComments:"=",commentKey:"=",commentEditorEnabled:"=",commentEditText:"=",ddCommentHtml:"=",actionCommentDropdown:"&",showCommentBox:"=",loadMoreComments:"&",loadPreviousComments:"&",activeCommentId:"="},templateUrl:"pages/partials/single_feed/comments.html",link:function(scope,elem,attr){scope.updateCommentAdaptor=function(comment){return scope.updateComment({comment:comment})},scope.actionCommentDropdownAdaptor=function(actionObj){scope.actionCommentDropdown({actionObj:actionObj})},scope.addCommentAdaptor=function($event){switch(scope.commentType){case"feed":scope.addComment({feed:scope.feed});break;case"image":scope.addComment({event:$event})}},scope.likeCommentAdaptor=function(comment){switch(scope.commentType){case"feed":scope.likeComment({feedKey:scope.feed.getKey(),commentKey:comment.getKey()});break;case"image":scope.likeComment({comment:comment})}}}}}angular.module("ringid.feed").directive("rgSingleFeedComments",rgSingleFeedComments)}(),function(){"use strict";function feedInlineShareView(GlobalEvents,$compile,$ringhttp){return{restrict:"E",template:'<div class="status-box noselect inline-share"><form enctype="multipart/form-data"><div style="padding:10px"><div class="float-left"><div class="thumbnail"><div class="icon-logo-circle pss-logo"><a><img class="responsive-all" rg-src="currentUser.avatar(\'thumb\')"></a></div></div></div><div class="post-t float-right"><div class="inline-share-box"><rg-editor class="editor" editor-content="feedText" new-line="on" on-escape="closeShareBox" focus="showShareBox" placeholder="Write something...."></rg-editor><span class="esc-cancel" rg-click="closeShareBox()">Press Esc to <a>Cancel</a></span><p ng-if="emotions.length" class="pst-loc-txt"><span class="feelings-text">feeling</span> <img class="feed_emo" rg-src="emotions[0].url"> {{emotions[0].nm}} &nbsp;<span class="icon-close f-8" rg-click="emotions.length = 0"></span></p><div ng-if="tagList.length"><ul class="tag-fnd-lst"><span class="tag-with">With :</span><li ng-repeat="usr in tagList"><span class="tag-title">{{::usr.getName()}}</span>&nbsp;<span class="icon-close f-11" rg-click="removeTag(usr)"></span></li></ul></div><p ng-if="feedLocation.description" class="pst-loc-txt">{{ feedLocation.description}} <span class="showpointer icon-close f-8" rg-click="resetFeedLocation()"></span></p><p ng-show="!boxIsLoading && errorMessage" class="s-error">{{errorMessage}}</p><!--<p ng-show="!boxIsLoading && !errorMessage" class="s-info"><b>Enter</b> to SHARE, <b>ESC</b> to Cancel</p>--><rg-loader-view2 is-loading="boxIsLoading"></rg-loader-view2></div></div><div class="clear"></div></div><div class="status-photo-box" style="margin:0;padding:0;border-top:1px solid #ebebeb;width:100%"><div class="pad-7-0"><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Feeling" rg-emotion on-select="chooseEmotion(item)" class="p-ab"><span class="feeling-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Tag Friends" rg-tag-friend="" show-if="showAddTag" tag-items="tagList" on-select="addTag(item)" class="p-ab"><span class="tag-f-ico"></span></a></div><div class="post-b-ico m-l-5"><a data-tooltip-post="Add Location" feed-location-menu="" feed-location-menu-on-select="updateFeedLocation(location)" autoAdjust="{{::autoAdjustScroll}}" selected-value="feedLocation" class="p-ab"><span class="location-ico"></span></a></div><div class="float-right"><input type="button" ng-disabled="inputDisabled" rg-click="shareFeed()" class="share_btn float-right" value="Share"></div><!--<p>Press escape to cancel</p>--></div></div></form><div class="clear"></div></div>',
controller:"feedInlineShareController",link:function(scope,elemnet,attr){}}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){return}feedApp.directive("feedInlineShareView",feedInlineShareView),feedInlineShareView.$inject=["GlobalEvents","$compile","$ringhttp"]}(),function(){"use strict";var feedApp;feedApp=angular.module("ringid.feed"),feedApp.controller("FeedMainController",["$scope","$timeout","feedFactory","utilsFactory","$rootScope","SystemEvents",function($scope,$timeout,feedFactory,helper,$rootScope,SystemEvents){function initTialFeedRequest(){$scope.feeds.length?initFeedInterval&&(clearInterval(initFeedInterval),initFeedInterval=null):(feedFactory.initFeedRequest($scope.params),initFeedInterval||(initFeedInterval=setInterval(initTialFeedRequest,6e3)))}feedFactory.reset(),$scope.noMoreFeed=!1,$scope.feeds=feedFactory.getFeeds(),feedFactory.setFactoryKey($scope.pagekey),feedFactory.setSortBy($scope.sortBy||"tm"),$scope.busy=!0;var feedUpdateTimer=setInterval(function(){feedFactory.updateTime(),$scope.$rgDigest()},3e5);$scope.setFeed=function(forceDigest){$scope.feeds=[],$scope.feeds=feedFactory.getFeeds(),forceDigest&&$scope.$rgDigest()},$scope.forAdd=$scope.forAdd||"my",$scope.getFeeds=function(){return $scope.feeds&&0!==$scope.feeds.length||$scope.setFeed(),$scope.feeds};var busyTimer,previousFeedLength;$scope.LoadMoreData=function(syncher){previousFeedLength=$scope.feeds.length,$scope.busy!==!1||$scope.noMoreFeed||($scope.busy=!0,feedFactory.requestForMoreFeed($scope.params),$scope.clearRequestTimer(),busyTimer=setTimeout(function(){$scope.busy&&previousFeedLength===$scope.feeds.length&&($scope.busy=!1,$scope.$broadcast(SystemEvents.FEED.BUSY,$scope.busy))},6e3))},$scope.clearRequestTimer=function(a){busyTimer&&clearTimeout(busyTimer),busyTimer=a},$rootScope.$on("FeedListChanged",function(){$scope.setFeed()}),$scope.setNoMoreFeed=function(state){$scope.noMoreFeed=state,feedFactory.noMoreFeed(state),$scope.busy=!1,$scope.$broadcast(SystemEvents.FEED.BUSY,$scope.busy)},$scope.noDataYet=function(){return $scope.noMoreFeed&&0==$scope.feeds.length},RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from FeedMainController",RingLogger.tags.DIGEST)});var initFeedInterval;initTialFeedRequest(),$scope.$on("$destroy",function(){initFeedInterval&&(clearInterval(initFeedInterval),initFeedInterval=null),feedUpdateTimer&&(clearInterval(feedUpdateTimer),feedUpdateTimer=null)}),$scope.$on(SystemEvents.COMMON.COLUMN_CHANGED,function(){$scope.$rgDigest()})}])}(),function(){"use strict";var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("SingleFeedSubController",["$$feedMap","$scope","$controller","$routeParams","feedFactory","Auth","SystemEvents","utilsFactory","$location",function($$feedMap,$scope,$controller,$routeParams,feedFactory,Auth,SystemEvents,utilsFactory,$location){function getSingleFeed(){feedFactory.getSingleFeed($scope.feedId,$scope.shared).then(function(feed){feed?($scope.feed=feed,$scope.isReady=!0,initFeedView()):($scope.feed=!1,$scope.isReady=!0,$scope.noData=!0),$scope.$rgDigest()})}function initFeedView(){$scope.feed&&($scope.serial=$scope.feed.serial,$scope.feedstatus=$scope.feed.text(),$scope.keyid=$scope.feed.getKey(),$scope.imageslength=$scope.feed.getImages().length,$scope.shareMenuDisabled=$scope.feed.isCirclePost(),$scope.ogData=$scope.feed.getOgData(),$scope.ogShowPreview=$scope.feed.hasOgData(),$scope.showCommentBox=!0,$controller("FeedSubController",{$scope:$scope}),utilsFactory.safeDigest($scope),$scope.$broadcast(SystemEvents.FEED.RESET,$scope.feed))}$scope.feedId=parseInt($routeParams.feedId||0),$scope.shared=!!$routeParams.shared,$scope.activeCommentId=parseInt($routeParams.commentId||0),$scope.isReady=!1,$scope.noData=!1,$scope.pagekey=feedFactory.getSingleFeedPageKey($scope.feedId),feedFactory.setFactoryKey($scope.pagekey),$scope.singleFeed=!0,$scope.ogData={},$scope.currentUser=Auth.currentUser(),getSingleFeed(),$scope.setFeed=function(deleted){deleted?$location.path("/"):getSingleFeed()},$scope.skipSaveScope=!0,$controller("FeedSubController",{$scope:$scope})}])}(),function(){"use strict";function FeedSubController(rgDropdownService,$rootScope,$scope,$location,feedFactory,Ringalert,MESSAGES,SystemEvents,$ringbox,Media,utilsFactory){function validateUpdate(){return!($scope.feedText||$scope.feedLocation.description||$scope.ogData.url||$scope.feelings&&$scope.feelings.id||$scope.feed.hasMedia()||$scope.feed.hasTagUsers())}function goToFeed(feedUrl){feedUrl&&$location.path(feedUrl)}function openRingBoxToEditTag(){var boxInstance=$ringbox.open({type:"remote",scope:!1,controller:"feedEditTagController",resolve:{localData:{feed:$scope.feed},remoteData:function(){return $scope.feed.hasTagUsers()?feedFactory.getTagUsers($scope.feed):{}}},templateUrl:"pages/home/feed-tag-user-edit.html"});boxInstance.result.then(function(updatedFeed){updatedFeed&&($scope.feed=updatedFeed),$scope.cancelEdit()})}$scope.showdroparrow=0,$scope.showCommentBox=!1,$scope.showShareBox=!1,$scope.showCommentView=!0,$scope.showShareForm=!1,$scope.editorEnabled=!1,$scope.errorImageEdit=!1,$scope.feedLocation={},$scope.ogData=$scope.ogData||{},$scope.filterOnProgress=!1,$scope.ogDataLoading=!1,$scope.ogShowPreview=!1,$scope.previousFeedLocation="",$scope.emotions={};var f=$scope.feed&&$scope.feed.value?$scope.feed.value:$scope.feed;if(f&&f.isSingleContentFeed()?(f.getMedias().length()||f.getAudios().length()?$scope.likeType="media":f.getImages(!0).length()&&($scope.likeType="image"),$scope.likeTarget=f.getSingleContent()):($scope.likeType="feed",$scope.likeTarget=f),$scope.shareMenuDisabled=$scope.shareMenuDisabled?$scope.shareMenuDisabled:!1,$scope.toggleCommentBox=function(event){event.stopPropagation(),$scope.showCommentBox=!$scope.showCommentBox,$scope.showCommentBox&&($scope.showShareBox=!1)},$scope.feedEditChooseEmotion=function(subCat){$scope.emotions.length=0,$scope.emotions.push(subCat),$scope.$rgDigest()},$scope.ddTemplate='<div class="ng-cloak action feed-ac float-right"><div class="feed-line" ng-if="ddControl.showEdit()"><span class="icon-edit-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edit\', feedKey: ddControl.feedKey})" href="#">Edit</a></div><div class="feed-line" ng-if="ddControl.showTagButton()"><span class="icon-add-tag feed-font"></span><a rg-click="ddAction()({event: $event, action:\'edittag\', feedKey: ddControl.feedKey})" href="#" class="border-0">{{ddControl.tagButtonText()}}</a></div><div class="feed-line"><span class="icon-delete-p feed-font"></span><a rg-click="ddAction()({event: $event, action:\'delete\', feedKey: ddControl.feedKey})" href="#" class="border-0">Delete</a></div></div>',$scope.actionFeedDropdown=function(actionObj){switch(rgDropdownService.close(),actionObj.event.preventDefault(),actionObj.action){case"edit":$scope.enableEditor(actionObj.feedKey);break;case"edittag":openRingBoxToEditTag();break;case"delete":$scope.deleteFeed(actionObj.feedKey)}},$scope.enableEditor=function(feedKey){$scope.showdroparrow=feedKey,$scope.editorEnabled=!0;var feedObj=feedFactory.getFeed(feedKey);$scope.feedText=feedObj.text(),$scope.feedLocation=angular.copy(feedObj.getLocationInfo()),$scope.ogData=angular.copy(feedObj.getOgData()),$scope.ogShowPreview=feedObj.hasOgData(),$scope.emotions=[feedObj.getFeelings()];var obj={feedText:$scope.feedText,feedLocation:$scope.feedLocation,feedKey:feedKey,ogData:$scope.ogData};$rootScope.$broadcast("enableeditor",obj),$scope.$rgDigest()},$scope.cancelEdit=function(){$scope.editorEnabled=!1,$scope.errorImageEdit=!1,$scope.$rgDigest()},$scope.updateFeed=function(){$scope.feedText=$scope.feedText.trim(),$scope.emotions.length?($scope.feelings=$scope.emotions[0],$scope.emotions.length=0):$scope.feelings=!1,validateUpdate()?($scope.errorImageEdit=!0,$scope.editorEnabled=!0):feedFactory.updateFeed($scope.currentUser,$scope.keyid,$scope.feedText,$scope.feedLocation,$scope.ogData,$scope.feelings).then(function(json){$scope.editorEnabled=!1,$scope.errorImageEdit=!1,$scope.$rgDigest(),$scope.$broadcast(SystemEvents.FEED.UPDATED,{id:$scope.keyid})},function(json){Ringalert.show(json,"error"),$scope.$rgDigest()}),$scope.$rgDigest()},$scope.deleteFeed=function(key){feedFactory.deleteFeed($scope.currentUser,key).then(function(json){$scope.setFeed(!0),Ringalert.show(json,"success")},function(errJson){$scope.setFeed(!0),Ringalert.show(errJson,"error")})},$scope.getShareData=function(){return function(){return{keyid:$scope.keyid,feed:$scope.feed.hasSharedFeed()?$scope.feed.getOrginalFeed():$scope.feed}}},$scope.getImageData=function(image,feed){return function(){return{image:image,feed:feed}}},$scope.getMediaData=function(media,feed){return{data:function(){return{media:media,album:feed.getAlbum(),feedTime:feed.time()}},promise:Media.fetchContentDetails(media.getKey(),!0,media.user())}},$scope.selectedFeedLocation=function(location){$scope.feedLocation=location,utilsFactory.safeDigest($scope)},$scope.resetFeedLocation=function(){$scope.feedLocation={}},$scope.goToFeed=goToFeed,$scope.isShareAble=function(f){return f=f.hasSharedFeed()?f.getOrginalFeed():f,f.isShareAble()},$scope.openRingBoxLike=function(){return $scope.feed.getTotalLikes()>0},$scope.openRingboxShare=function(){return($scope.feed.hasSharedFeed()?$scope.feed.getOrginalFeed().getTotalShare()>0:$scope.feed.getTotalShare())>0&&!$scope.feed.isMediaShared()&&!$scope.feed.isSingleContentFeed()},$scope.whoShareFalsyFunc=function(){$scope.feed.isSingleContentFeed()&&Ringalert.show("Oops! This feature is coming soon","info"),RingLogger.print("print from who share falsy func",RingLogger.tags.TEST)},!$scope.skipSaveScope){var key=$scope.feed.value?$scope.feed.value.getKey():$scope.feed.getKey();feedFactory.addScope(key,$scope),$scope.$on("$destroy",function(){feedFactory.removeScope($scope.feed.getKey())})}RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from FeedSubController : "+($scope.$index+1),RingLogger.tags.DIGEST)})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedSubController",FeedSubController),FeedSubController.$inject=["rgDropdownService","$rootScope","$scope","$location","feedFactory","Ringalert","MESSAGES","SystemEvents","$ringbox","Media","utilsFactory"]}(),function(){"use strict";function FeedWhoShareController($$connector,$scope,$$feedMap,feedFactory,OPERATION_TYPES,$rootScope,Ringalert){function startRequest(){$scope.boxIsLoading=!0,$scope.feeds.length<$scope.params.feed.getTotalShare()&&!$scope.busy&&($$connector.send({actn:OTYPES.TYPE_WHO_SHARES_LIST,nfId:$scope.params.feed.getKey(),st:$scope.feeds.length},OTYPES.REQUEST_TYPE.REQUEST),$scope.busy=!0,setTimeout(function(){$scope.busy=$scope.busy&&!1,$scope.$rgDigest()},3e3),$scope.$rgDigest())}var subKey,ignoreCommKey,ignoreLikeKey,i,OTYPES=OPERATION_TYPES.SYSTEM;$scope.feeds=[],$scope.message="",$scope.boxIsLoading=$scope.params.boxIsLoading?$scope.params.boxIsLoading:!0;var dashboardFeed;$scope.params&&(dashboardFeed=feedFactory.getFeed($scope.params.keyid)),$scope.showMessage=!1,$scope.shareMenuDisabled=!0,$scope.singleFeed=!0,$scope.busy=!1,$scope.boxHeight=$rootScope.windowHeight-20,subKey=$$connector.subscribe(function(json){if($scope.boxIsLoading=!1,$scope.isReady=!0,$scope.busy=!1,!json.sucs)return $scope.$close(),void Ringalert.show(json.mg||"Opps ! Looks Like Something Went Wrong ! Please Try Later.","error");if(json.newsFeedList.length)for(i=0;i<json.newsFeedList.length;i++){var aFeedMapObject=$$feedMap.create(json.newsFeedList[i]);aFeedMapObject.getKey()===dashboardFeed.getKey()&&aFeedMapObject.setIdenticalFeed(dashboardFeed),$scope.feeds.push(aFeedMapObject)}$scope.$rgDigest()},{action:OTYPES.TYPE_WHO_SHARES_LIST}),$scope.loadMore=startRequest,$scope.loadMore(),$scope.$on("$destroy",function(){feedFactory.removeIgnoreFilter(ignoreCommKey),feedFactory.removeIgnoreFilter(ignoreLikeKey),$$connector.unsubscribe(subKey)}),$scope.skipSaveScope=!0,RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from FeedWhoShareController",RingLogger.tags.DIGEST)})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedWhoShareController",FeedWhoShareController),FeedWhoShareController.$inject=["$$connector","$scope","$$feedMap","feedFactory","OPERATION_TYPES","$rootScope","Ringalert"]}(),function(){"use strict";function FeedRingboxWhoShareController($controller,$scope,localData){$scope.viewType="ringbox",$scope.params=localData,$controller("FeedWhoShareController",{$scope:$scope})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedRingboxWhoShareController",FeedRingboxWhoShareController),FeedRingboxWhoShareController.$inject=["$controller","$scope","localData"]}(),function(){"use strict";function FeedSingleWhoShareController($controller,$scope,$routeParams,feedFactory){function initFeedView(){$scope.feed&&($scope.serial=!1,$scope.feedstatus=$scope.feed.text(),$scope.keyid=$scope.feed.getKey(),$scope.imageslength=$scope.feed.getImages().length)}$scope.viewType="singleWhoShareFeed",$scope.isReady=!1,$scope.$close=angular.noop,$scope.feedId=$routeParams.feedId,$scope.pagekey=feedFactory.getSingleFeedPageKey($scope.feedId),$scope.params={},feedFactory.getSingleFeed($scope.feedId).then(function(feed){feed?($scope.params.feed=feed,$scope.params.boxIsLoading=!1,initFeedView(),$controller("FeedWhoShareController",{$scope:$scope})):($scope.params.boxIsLoading=!1,$scope.noData=!0)})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedSingleWhoShareController",FeedSingleWhoShareController),FeedSingleWhoShareController.$inject=["$controller","$scope","$routeParams","feedFactory"]}(),function(){"use strict";function feedShareController($scope,AuthFactory,feedFactory,$rootScope,Ringalert,utilsFactory){function shareFeed(ob){var data=getFeedShareData();disablePostInput(),showLoader(),resetErrorMessage(),feedFactory.shareFeed(data).then(function(json){hideLoader(),resetFeedText(),enablePostInput(),resetErrorMessage(),resetFeedLocation(),emitFeedListChangedEvent(),afterShareCallback(),showSuccessMsg(json),$scope.media?($scope.media.share(!0),$scope.$close()):$scope.$parent.$rgDigest()},function(responseObj){hideLoader(),enablePostInput(),processErorr(responseObj),$scope.$parent.$rgDigest()}),$scope.$rgDigest()}function disablePostInput(){$scope.inputDisabled=!0}function enablePostInput(){$scope.inputDisabled=!1}function showLoader(){$scope.boxIsLoading=!0}function hideLoader(){$scope.boxIsLoading=!1}function resetErrorMessage(){$scope.errorMessage=""}function resetFeedText(){$scope.feedText=""}function setFeedLocation(location){$scope.feedLocation=location}function resetFeedLocation(location){$scope.feedLocation=""}function updateFeedLocation(location){setFeedLocation(location),$scope.$rgDigest()}function emitFeedListChangedEvent(){$rootScope.$broadcast("FeedListChanged"),$scope.$broadcast("cleareditor")}function showSuccessMsg(json){Ringalert.show(json,"success")}function getFeedShareData(){var i,feed=$scope.media?null:$scope.feed,data={text:$scope.feedText,feed:feed&&feed.hasSharedFeed()?feed.getOrginalFeed():feed,location:$scope.feedLocation},content=$scope.media;if($scope.emotions.length&&(data.mdIds=[$scope.emotions[0].id],$scope.emotions.length=0),$scope.tagList.length){for(data.tFrndIds=[],i=0;i<$scope.tagList.length;i++)data.tFrndIds.push($scope.tagList[i].getUtId());$scope.tagList.length=0}return(content||feed&&feed.isSingleContentFeed()&&(feed.getMedias().length()||feed.getAudios().length()))&&(content=content||feed.getSingleContent(),data.audio=content.isAudio(),data.cntntIDLst=[content.getKey()],data.addShare=!0,data.user=$scope.currentUser),data}function afterShareCallback(){$scope.afterShareCallback&&$scope.afterShareCallback()}function processErorr(responseObj){var msg=utilsFactory.getReasonMessageFromResponse(responseObj);""==msg&&(msg="Unable To Share Status. Please Try Again Later"),$scope.errorMessage=msg}$scope.feed=$scope.params.feed,$scope.afterShareCallback=$scope.params.afterShareCallback,$scope.updateFeedLocation=updateFeedLocation,$scope.resetFeedLocation=resetFeedLocation,$scope.currentUser=AuthFactory.currentUser(),resetFeedLocation(),resetFeedText(),resetErrorMessage(),enablePostInput(),hideLoader(),$scope.shareFeed=shareFeed,$scope.emotions=[],$scope.tagList=[],$scope.addTag=function(item){var index=$scope.tagList.indexOf(item);-1===index&&$scope.tagList.push(item)},$scope.removeTag=function(usr){var index=$scope.tagList.indexOf(usr);index>=0&&$scope.tagList.splice(index,1)},$scope.chooseEmotion=function(subCat){$scope.emotions.length=0,$scope.emotions.push(subCat)}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("feedShareController",feedShareController),feedShareController.$inject=["$scope","Auth","feedFactory","$rootScope","Ringalert","utilsFactory"]}(),function(){"use strict";function feedRingboxShareController($scope,$boxInstance,$controller,localData){$scope.params={feed:localData.feed,afterShareCallback:$scope.$close,showSharePostBox:!0},$controller("feedShareController",{$scope:$scope})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("feedRingboxShareController",feedRingboxShareController),feedRingboxShareController.$inject=["$scope","$boxInstance","$controller","localData"]}(),function(){"use strict";function feedInlineShareController($scope,$controller){$scope.params={feed:$scope.feed,afterShareCallback:$scope.closeShareBox,showSharePostBox:!0},$controller("feedShareController",{$scope:$scope})}function feedMediaShareController($scope,$controller){$scope.params={feed:null,afterShareCallback:angular.noop,showSharePostBox:!0},$scope.closeShareBox=function(){$scope.$close()},$scope.autoAdjustScroll="false",$controller("feedShareController",{$scope:$scope})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("feedMediaShareController",feedMediaShareController),feedApp.controller("feedInlineShareController",feedInlineShareController),feedInlineShareController.$inject=["$scope","$controller"],feedMediaShareController.$inject=["$scope","$controller"]}(),function(){"use strict";var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedAddController",["fileUploadService","$rootScope","$scope","feedFactory","$timeout","$routeParams","SystemEvents","OPERATION_TYPES","rgDropdownService","PrivacySet",function(fileUploadService,$rootScope,$scope,feedFactory,$timeout,$routeParams,SystemEvents,OPERATION_TYPES,rgDropdownService,PrivacySet){$scope.privacySet=PrivacySet,"circle"==$scope.forAdd||"friend"===$scope.forAdd?$scope.showPrivacy=!1:($scope.showPrivacy=!0,$scope.privacy=PrivacySet.PVC2),$scope.setPrivacy=function(actionObj){actionObj.event.preventDefault(),$scope.privacy=PrivacySet["PVC"+actionObj.privacy],rgDropdownService.close(),$scope.$rgDigest()},$scope.privacyTemplate='<div class="ng-cloak action  ab-drop postbox-action"><div class="a-box" ><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC1.value})" href="#"><span class="{{::ddControl.PVC1.icon}} ab-delete"></span> {{::ddControl.PVC1.text}}</a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC2.value})" href="#"><span class="{{::ddControl.PVC2.icon}} ab-delete"></span> {{::ddControl.PVC2.text}} </a></div><div class="a-box"><a rg-click="ddAction()({event: $event, privacy:ddControl.PVC3.value})" href="#"><span class="{{::ddControl.PVC3.icon}} ab-delete"></span> {{::ddControl.PVC3.text}}</a></div></div>',$scope.feedText="",$scope.feedLocation={},$scope.ogData={},$scope.filterOnProgress=!1,$scope.ogDataLoading=!1,$scope.ogShowPreview=!1,$scope.inputDisabled=!1,$scope.getValidityValues=function(){return new Array(30)},$scope.showTimeout=!1,$scope.validity=-1;var gdata={vldt:$scope.validity};"friend"===$scope.forAdd?gdata.friend=$routeParams.uId:"circle"===$scope.forAdd&&(gdata.group=$routeParams.circleId),$rootScope.$on(SystemEvents.FILE_UPLOAD.QUEUE_START,function(){$scope.inputDisabled=!0,$scope.$rgDigest()}),$rootScope.$on(SystemEvents.FILE_UPLOAD.QUEUE_COMPLETE,function(){$scope.inputDisabled=!1,$scope.$rgDigest()}),$scope.shouldDisableInput=function(){return $scope.inputDisabled||$scope.ogDataLoading||$scope.filterOnProgress};var now,i,lastAddStatusTime=(new Date).getTime();for($scope.addFeed=function(){function canPostEmptyStatus(){return!!data.text||!!data.lnkURL||data.images.length>0||data.videos.length>0||data.audios.length>0||!!data.mdIds&&data.mdIds.length>0||!!data.lctn||!!data.tFrndIds&&data.tFrndIds.length>0}function addFeedRequest(){lastAddStatusTime=now,feedFactory.addFeed(data,$scope.currentUser).then(function(json){$scope.setFeed(),$scope.$parent.$rgDigest()},function(){$scope.setFeed(),$scope.feedText=originalFeedText,$scope.$broadcast("seteditor"),$scope.$parent.$rgDigest()},function(state){}),fileUploadService.imageFiles.length=0,fileUploadService.imageFiles=[],fileUploadService.videoFiles.length=0,fileUploadService.videoFiles=[],fileUploadService.audioFiles.length=0,fileUploadService.audioFiles=[],$scope.feedText="",$scope.validity=-1,$scope.feedLocation={},$scope.ogData={},$scope.ogShowPreview=!1,$scope.inputDisabled=!1,$scope.errorMessage=!1,$scope.setFeed(),$scope.$broadcast("cleareditor"),$scope.$rgDigest()}var data={vldt:$scope.validity};if($scope.inputDisabled=!0,data=angular.extend({},gdata,{text:$scope.feedText,vldt:$scope.validity,images:fileUploadService.imageFiles,videos:fileUploadService.videoFiles,audios:fileUploadService.audioFiles}),$scope.privacy&&(data.fpvc=$scope.privacy.value),$scope.feedLocation.description&&(data.lctn=$scope.feedLocation.description,data.lat=$scope.feedLocation.lat,data.lng=$scope.feedLocation.lng),$scope.ogData.url&&(data.lnkDmn=$scope.ogData.lnkDmn||$scope.ogData.url||"",data.lnkDsc=$scope.ogData.description||"",data.lnkTtl=$scope.ogData.title||"",data.lnkURL=$scope.ogData.url||"",data.lnlImgURL=$scope.ogData.image||""),$scope.emotions.length&&(data.mdIds=[$scope.emotions[0].id],$scope.emotions.length=0),$scope.tagList.length){for(data.tFrndIds=[],i=0;i<$scope.tagList.length;i++)data.tFrndIds.push($scope.tagList[i].getUtId());$scope.tagList.length=0}var originalFeedText=$scope.feedText;if(""!=data.text&&data.lnkURL){var dataTextProtocolStriped=data.text.replace("https","").replace("http",""),feedLinkUrlProtocolStriped=data.lnkURL.replace("https","").replace("http","");"/"==dataTextProtocolStriped[dataTextProtocolStriped.length-1]&&(dataTextProtocolStriped=dataTextProtocolStriped.slice(0,-1)),"/"==feedLinkUrlProtocolStriped[feedLinkUrlProtocolStriped.length-1]&&(feedLinkUrlProtocolStriped=feedLinkUrlProtocolStriped.slice(0,-1)),dataTextProtocolStriped==feedLinkUrlProtocolStriped&&(data.text="")}canPostEmptyStatus()||""!==data.text?(now=(new Date).getTime(),200>now-lastAddStatusTime?setTimeout(addFeedRequest,200):addFeedRequest()):($scope.feedText="",$scope.inputDisabled=!1,$scope.errorMessage=!0,$scope.ogShowPreview=!1,$scope.$rgDigest())},$scope.selectOptions=[],$scope.selectOptions[0]={value:-1,title:"Unlimited"},i=1;30>=i;i++)$scope.selectOptions[i]={value:i,title:i+" Day"};$scope.selectedTimeout=function(item){$scope.validity=item,$scope.$rgDigest()},$scope.selectedLocation=function(location){$scope.feedLocation=location,$scope.$rgDigest()},$scope.resetFeedLocation=function(){$scope.feedLocation={},$scope.$rgDigest()},$scope.emotions=[],$scope.tagList=[],$scope.addTag=function(item){var index=$scope.tagList.indexOf(item);-1===index&&$scope.tagList.push(item),$scope.$rgDigest()},$scope.removeTag=function(usr){var index=$scope.tagList.indexOf(usr);index>=0&&$scope.tagList.splice(index,1),$scope.$rgDigest()},$scope.chooseEmotion=function(subCat){$scope.emotions.length=0,$scope.emotions.push(subCat),$scope.$rgDigest()};var pageVal=feedFactory.getCurrentPageValue();$scope.showAddTag=pageVal.action!==OPERATION_TYPES.SYSTEM.TYPE_GROUP_NEWS_FEED,RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from FeedAddController",RingLogger.tags.DIGEST)})}])}(),function(){"use strict";var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedDashboardController",["$scope","$controller","OPERATION_TYPES","Ringalert",function($scope,$controller,OPERATION_TYPES,Ringalert){$scope.pagekey=OPERATION_TYPES.SYSTEM.TYPE_NEWS_FEED+".all",$scope.action=OPERATION_TYPES.SYSTEM.TYPE_NEWS_FEED,$scope.params={actn:OPERATION_TYPES.SYSTEM.TYPE_NEWS_FEED},$scope.forAdd="my",$controller("FeedMainController",{$scope:$scope})}])}(),function(){"use strict";var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedProfileController",["$scope","$controller","$routeParams","OPERATION_TYPES",function($scope,$controller,$routeParams,OPERATION_TYPES){var helperob,action,uId=$routeParams.uId,mapkey=uId;$scope.currentUser&&$scope.currentUser.equals(uId)?(helperob="my",action=OPERATION_TYPES.SYSTEM.TYPE_MY_NEWS_FEED):(helperob="friend",action=OPERATION_TYPES.SYSTEM.TYPE_FRIEND_NEWSFEED),mapkey=action+"."+uId,$scope.pagekey=mapkey,$scope.action=action,$scope.params={actn:action,fndId:uId},$scope.forAdd=helperob,$scope.sortBy="at",$controller("FeedMainController",{$scope:$scope})}])}(),function(){"use strict";var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ngWebSocket","ringid.puller","ringid.utils","ringid.config"])}feedApp.controller("FeedCircleController",["$scope","$controller","$routeParams","OPERATION_TYPES","feedFactory",function($scope,$controller,$routeParams,OPERATION_TYPES,feedFactory){var page="circle",cicleId=$routeParams.circleId,mapkey=OPERATION_TYPES.SYSTEM.TYPE_GROUP_NEWS_FEED+"."+cicleId;$scope.pagekey=mapkey,$scope.action=OPERATION_TYPES.SYSTEM.TYPE_GROUP_NEWS_FEED,$scope.params={actn:OPERATION_TYPES.SYSTEM.TYPE_GROUP_NEWS_FEED,grpId:cicleId},$scope.forAdd=page,$scope.shareMenuDisabled=!0,$controller("FeedMainController",{$scope:$scope})}])}(),function(){"use strict";function feedTagUserListController($scope,remoteData,User,InviteFactory){var tagUserIds=remoteData.fTgLst;$scope.usersUtIds=[],$scope.users=[];var usercount=tagUserIds.length;if(usercount){$scope.total=usercount;for(var i=0;i<tagUserIds.length;i++)tagUserIds[i].fn=tagUserIds[i].nm,$scope.users.push(User.createByUtId(tagUserIds[i],!0))}$scope.getMutualFriend=function(user){return{data:function(){return{target:user}},promise:InviteFactory.getMutualFriend(user)}}}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ringid.utils","ringid.config"])}feedApp.controller("feedTagUserListController",feedTagUserListController),feedTagUserListController.$inject=["$scope","remoteData","userFactory","InviteFactory"]}(),function(){"use strict";function feedEditTagController($scope,localData,remoteData,$$connector,feedFactory,OPERATION_TYPES,User,$filter,friendsFactory,Ringalert,Auth){function setUsers(){$scope.users=$filter("filterUserByName")(users,$scope.filterText)}function searchRequest(){sentRequest||(friendsFactory.searchContact({schPm:$scope.filterText},!0),$scope.loading=!0,sentRequest=!0)}function crossMatch(){if("a"!==$scope.currentType)return void setUsers();friendsFactory.friends.doForAll(function(item){var liteu=item.getLiteUser();-1===users.contains(liteu,function(a,b){return a.equals(b,"utId")})&&-1===tagUsers.contains(liteu,function(a,b){return a.equals(b,"utId")})&&users.push(liteu)});var temp=tagUsers.filter(function(templu){return-1===users.contains(templu,function(a,b){return a.equals(b,"utId")})});users=users.concat(temp),setUsers()}var feed=localData.feed,sentRequest=!1,tagUsers=[],tagUsersBackup=[],users=[];$scope.users=[],$scope.filterText="",$scope.loading=!0,$scope.currentType="a";var currentUser=Auth.currentUser();if($scope.$watch("filterText",function(newValue,oldValue){setUsers(),$scope.users.length<5&&newValue.length>oldValue.length?(sentRequest=!1,searchRequest()):(sentRequest=!1,$scope.loading=!1)}),$scope.$watch(friendsFactory.friends.length(),function(newValue,oldValue){crossMatch(),$scope.loading=!1,sentRequest=!1}),remoteData&&remoteData.fTgLst&&remoteData.fTgLst.length){for(var i=0;i<remoteData.fTgLst.length;i++)remoteData.fTgLst[i].fn=remoteData.fTgLst[i].nm,-1===tagUsers.contains(remoteData.fTgLst[i].utId,function(a,b){return a.equals(b,"utId")})&&(tagUsers.push(User.createByUtId(remoteData.fTgLst[i],!0)),tagUsersBackup.push(tagUsers[i]));crossMatch()}$scope.loading=!1,feed.hasTagUsers()||crossMatch(),$scope.toggle=function(type){$scope.currentType!=type&&($scope.currentType=type,"a"==type?(users=[],crossMatch()):(users=tagUsers,setUsers()))},$scope.checked=function(item){return tagUsers.indexOf(item)>-1},$scope.loadMore=function(){$scope.filterText.length?searchRequest():(friendsFactory.getContactDetails(),$scope.loading=!0)},$scope.addRemoveTag=function(event,item){var index=tagUsers.indexOf(item);index>-1?tagUsers.splice(index,1):(tagUsers.push(item),$scope.users.length-tagUsers.length<5&&$scope.loadMore())},$scope.saveTagUser=function(){var index,removed=tagUsersBackup.difference(tagUsers),added=tagUsers.difference(tagUsersBackup);if(!removed.length&&!added.length)return void Ringalert.show("Please Make Your Changes Before Submit","warning");if(0===added.length&&removed.length===tagUsersBackup.length&&!feed.validateForUpdateTag())return void Ringalert.show("You can't submit an empty feed","warning");var removedTaggedFriends={},newTaggedFriends={};if(removed.length)for(index=0;index<removed.length;index++)removedTaggedFriends[removed[index].getUtId()]=!0;if(added.length)for(index=0;index<added.length;index++)newTaggedFriends[added[index].getUtId()]=!0;var tagFriendIds={removed:Object.keys(removedTaggedFriends),"new":Object.keys(newTaggedFriends)};feedFactory.updateFeed(currentUser,feed.getKey(),feed.text(),feed.getLocationInfo(),!1,feed.getFeelings(),tagFriendIds).then(function(json){feed.updateTagUser(json),$scope.$close(feed)},function(json){Ringalert.show(json,"error")})},$scope.$on("$destroy",function(){})}var feedApp;try{feedApp=angular.module("ringid.feed")}catch(e){feedApp=angular.module("ringid.feed",["ringid.utils","ringid.config"])}feedApp.filter("filterUserByName",function(){return function(items,name){if(items){for(var filtered=[],nameMatch=new RegExp(name,"i"),i=0;i<items.length;i++)items[i].getName().match(nameMatch)&&filtered.push(items[i]);return filtered}}}),feedApp.controller("feedEditTagController",feedEditTagController),feedEditTagController.$inject=["$scope","localData","remoteData","$$connector","feedFactory","OPERATION_TYPES","userFactory","$filter","friendsFactory","Ringalert","Auth"]}(),function(){"use strict";var app;app=angular.module("ringid",["ngRoute","ringid.config","ringid.language","ngWebSocket","ui-notification","ringid.connector","ringid.filters","ringid.sticker","ringid.common.factories","ringid.common.services","ringid.common.controllers","ringid.common.ringalert","ringid.notification","ringid.ringbox","ringid.auth","ringid.profile","ringid.friend","ringid.feed","ringid.circle","ringid.tagchat","ringid.chat","ringid.common.directives"]);
}(),function(){"use strict";function ApplicationController(SystemEvents,$scope,$rootScope,$$connector,Storage,Auth,StickerFactory,OPERATION_TYPES,$location,Ringalert,utilsFactory,RING_ROUTES,feedFactory){function appInit(){$scope.isLoggedIn=Auth.isLoggedIn(),$$connector.init(),$scope.isLoggedIn?($$connector.resume(),$$connector.keepAlive(),$scope.templatePath="pages/index-dashboard.html",StickerFactory.initStickerData()):(doSilentLogin(),$scope.templatePath="pages/index-loader.html")}function pauseSystemForLogin(){$$connector.stop(),Auth.clearCookies(!0),$scope.templatePath="pages/index-login.html"}function doLogoutTask(preserveConnection){Auth.logout(!0),RingLogger.print("Doing logout task",RingLogger.tags.AUTH),preserveConnection?$$connector.stop():$$connector.reset(),$scope.$rgDigest()}function doSilentLogin(){$rootScope.doingSilentLogin=!0,RingLogger.print("Requesting silent login",RingLogger.tags.AUTH),Auth.loginFromLocalData().then(function(success){$rootScope.doingSilentLogin=!1,RingLogger.print("Requesting silent login response",success,RingLogger.tags.AUTH),success||pauseSystemForLogin(),$scope.$rgDigest()},function(err){$rootScope.doingSilentLogin=!1,pauseSystemForLogin(),$scope.$rgDigest()}),$scope.$rgDigest()}function checkForValidSession(){var validSessionTimeout,miniuteDiff,msec,now=Date.now();msec=now-lastChecked,miniuteDiff=Math.floor(msec/1e3/60),$$connector.stop(),validSessionTimeout=setTimeout(function(){doLogoutTask(),$scope.$rgDigest()},2e3),Auth.isValidSession().then(function(valid){clearTimeout(validSessionTimeout),lastChecked=now,Storage.setCookie("la",lastChecked),RingLogger.alert(valid,RingLogger.tags.AUTH),Storage.getCookie("sId")===valid.sId?doLogoutTask():($$connector.resume(),$scope.templatePath="pages/index-dashboard.html"),$scope.$rgDigest()},function(invalid){clearTimeout(validSessionTimeout),doLogoutTask(),$scope.$rgDigest()}),$scope.$rgDigest()}var intkey,OTYPES=OPERATION_TYPES.SYSTEM.AUTH,lastChecked=+Storage.getCookie("la");$scope.activePath=null,$scope.currentUser=Auth.currentUser(),$scope.templatePath=Auth.indexTemplate,$scope.isLoggedIn=!1,RingLogger.tags.DIGEST&&$rootScope.$watch(function(){RingLogger.info("from ROOTSCOPE",RingLogger.tags.DIGEST)}),$rootScope.showRightBar=!0,$$connector.subscribe(function(json){json.actn===OTYPES.TYPE_MULTIPLE_SESSION?(RingLogger.print("multiple session warning",json,RingLogger.tags.AUTH),Ringalert.alert({title:"Signed Out!",message:"You are signed in from another device",showCancel:!1,okCallback:doLogoutTask})):(RingLogger.print("invalid session",json,RingLogger.tags.AUTH),json.sucs?(RingLogger.print("Connector resumes on invalid session",RingLogger.tags.AUTH),$$connector.resume(),$scope.templatePath="pages/index-dashboard.html"):$rootScope.doingSilentLogin?RingLogger.print("Not Requested for silent Login",RingLogger.tags.AUTH):(RingLogger.print("Requested for silent Login",RingLogger.tags.AUTH),Auth.isLoggedIn()&&json.actn!==OTYPES.TYPE_SESSION_VALIDATION?checkForValidSession():doLogoutTask(!0))),$scope.$rgDigest()},{action:[OTYPES.TYPE_SESSION_VALIDATION,OTYPES.TYPE_INVALID_LOGIN_SESSION,OTYPES.TYPE_MULTIPLE_SESSION]}),appInit(),$scope.$on(SystemEvents.AUTH.LOGIN,function(event,data){data.silent&&($rootScope.doingSilentLogin=!1),$scope.currentUser=Auth.currentUser(),appInit(),$scope.$rgDigest()}),$scope.$on("CONNECTION_ERROR",function(){var reloaded=Storage.getCookie("reloaded");reloaded?$$connector.reset():Storage.setCookie("reloaded",1)}),$scope.$on("$destroy",function(e){intkey&&$$connector.removeInterval(intkey)}),RingLogger.tags.DIGEST&&$scope.$watch(function(){RingLogger.info("from AppController",RingLogger.tags.DIGEST)}),$scope.send=function(data,request_type){request_type=request_type||OPERATION_TYPES.SYSTEM.REQUEST_TYPE.REQUEST,angular.isString(data)&&(data=angular.fromJson(data)),$$connector.send(data,request_type)}}var app;app=angular.module("ringid").controller("ApplicationController",ApplicationController),ApplicationController.$inject=["SystemEvents","$scope","$rootScope","$$connector","Storage","Auth","StickerFactory","OPERATION_TYPES","$location","Ringalert","utilsFactory","RING_ROUTES","feedFactory"]}(),function(){"use strict";var app;app=angular.module("ringid").run(["$rootScope","$window","$document","$$connector","settings","$ringhttp",function($rootScope,$window,$document,$$connector,settings,$ringhttp){function activeTab(event){"inactive"!==prevEvent&&$rootScope.$broadcast("ringInactive",event),prevEvent="inactive"}function inactiveTab(event){"active"!==prevEvent&&$rootScope.$broadcast("ringActive",event),prevEvent="active"}function windowVisibilityChangeHandler(event){this[vendorPrefix?vendorPrefix+"Hidden":"hidden"]&&"inactive"!==prevEvent?($rootScope.$broadcast("ringInactive",event),prevEvent="inactive"):"active"!==prevEvent&&($rootScope.$broadcast("ringActive",event),prevEvent="active")}var vendorPrefix,prevEvent,windowElement=angular.element($window);$$connector.init(),windowElement.on("inactive",activeTab),windowElement.on("active",inactiveTab),"hidden"in $document?vendorPrefix="":angular.forEach(["moz","webkit","ms"],function(prefix){prefix+"Hidden"in $document[0]&&(vendorPrefix=prefix)}),angular.isDefined(vendorPrefix)&&""!==vendorPrefix&&$document[0].addEventListener(vendorPrefix+"visibilitychange",windowVisibilityChangeHandler)}])}(),function(){"use strict";angular.module("ringid").config(["$compileProvider","$routeProvider","$locationProvider","$httpProvider","RING_ROUTES",function($compileProvider,$routeProvider,$locationProvider,$httpProvider,RING_ROUTES){$compileProvider.debugInfoEnabled(!0),$httpProvider.useApplyAsync(!0),$routeProvider.when(RING_ROUTES.HOME,{templateUrl:"pages/index.html"}).when(RING_ROUTES.LOGIN_SOCIAL,{templateUrl:"pages/index.html"}).when(RING_ROUTES.SIGNUP_SOCIAL,{templateUrl:"pages/index.html"}).when(RING_ROUTES.USER_PROFILE,{templateUrl:"pages/profile/profile.html",resolve:{user:["profileFactory","$route","$location","$q","Ringalert",function(profileFactory,$route,$location,$q,Ringalert){var deferred=$q.defer();return profileFactory.getUserDetailsByUId($route.current.params.uId).then(function(user){deferred.resolve(user)},function(){Ringalert.show("User not found","error"),$location.path().indexOf("profile")>-1&&$location.path("/"),deferred.reject()}),deferred.promise}]}}).when(RING_ROUTES.CIRCLE_HOME,{templateUrl:"pages/home/circle.html"}).when(RING_ROUTES.SINGLE_FEED,{templateUrl:"pages/index-singlefeed.html"}).when(RING_ROUTES.WHO_SHARED_FEED,{templateUrl:"pages/index-who-sharedfeed.html"}).when("/media",{templateUrl:"pages/media-list.html"}).when("/media/:albumtype",{templateUrl:"pages/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when("/media/:stype/:sk?",{templateUrl:"pages/mediasearch/search.result.html",controller:"mSearchResultController"}).when("/media/:albumtype/:utid/:albumid",{templateUrl:"pages/mediasearch/albums.all.html",controller:"allAlbumTypeController"}).when("/chat",{templateUrl:"pages/partials/chat/single-page/home.html",controller:"ChatHistoryController"}).when(RING_ROUTES.FAQ,{redirectTo:function(params,currentPath,currentSearch){window.location.href=location.protocol+"//"+location.host+"/faq.xhtml"}}).when(RING_ROUTES.API_DASHBOARD,{templateUrl:"app/apidashboard/templates/api.index.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","rgDropdownService","rgSearchService","$ringbox","RING_ROUTES","Storage","$browser",function($rootScope,$location,Auth,rgDropdownService,rgSearchService,$ringbox,RING_ROUTES,Storage,$browser){function revertScopes(reset){for(var i=0;i<$rootScope.$ignoreScopes.length;i++)childHead[$rootScope.$ignoreScopes[i].$id]&&($rootScope.$ignoreScopes[i].$$childHead=childHead[$rootScope.$ignoreScopes[i].$id]);childHead=[],reset&&($rootScope.$ignoreScopes=[])}$rootScope.$on("$routeChangeStart",function(event,next,current){Auth.isLoggedIn()||$rootScope.doingSilentLogin||"/"===$location.url()?($ringbox.closeAll(),rgDropdownService.close(),rgSearchService.close()):$location.path("/"),revertScopes(!0)}),requestAnimationFrame(function(){var loader=document.querySelector("#global-loader");loader.style.display="none",loader=null});var $rgQueue=[],$root=Object.getPrototypeOf($rootScope),childHead=[];$rootScope.$ignoreScopes=[],$root.$coreDigest=$root.$digest,$root.$rgDigest=function(){if($rootScope.$$phase){if(-1==$rgQueue.indexOf(this)&&1!=this.$id){$rgQueue.push(this),$rgQueue.sort(function(a,b){return a.$id-b.$id});for(var target,current,parent,queue=[];$rgQueue.length>1;){target=$rgQueue.pop();for(var i=$rgQueue.length-1;i>=0;i--){for(current=$rgQueue[i],parent=target.$parent;parent!=current&&null!=parent;)parent=parent.$parent;if(null!=parent)break}null==parent&&queue.push(target)}for(;target=queue.pop();)$rgQueue.push(target)}$rootScope.$$postDigest(function(){$rgQueue.length>0&&$rgQueue.pop().$rgDigest()})}else{if(1==this.$id&&$rootScope.$ignoreScopes.length>0){for(var i=0;i<$rootScope.$ignoreScopes.length;i++)childHead[$rootScope.$ignoreScopes[i].$id]=$rootScope.$ignoreScopes[i].$$childHead,$rootScope.$ignoreScopes[i].$$childHead=null;$rootScope.$$postDigest(function(){revertScopes()})}this.$coreDigest()}},$root.$digest=function(){this.$rgDigest()},$root.addIgnore=function(){-1==$rootScope.$ignoreScopes.indexOf(this)&&$rootScope.$ignoreScopes.push(this)},$root.removeIgnore=function(){var index;(index=$rootScope.$ignoreScopes.indexOf(this))>-1&&$rootScope.$ignoreScopes.splice(index,1)},$root.calc=function(){var target,current,next,total=0,total_scope=0,t0=window.performance.now();target=this,current=target;do if(total+=current.$$watchers?current.$$watchers.length:0,total_scope++,!(next=current.$$childHead||current!==target&&current.$$nextSibling))for(;current!==target&&!(next=current.$$nextSibling);)current=current.$parent;while(current=next);RingLogger.information("Total watchers: "+total+" & total scopes:"+total_scope+" & traverse Time:"+(window.performance.now()-t0)+"ms",RingLogger.tags.DIGEST)}}])}();